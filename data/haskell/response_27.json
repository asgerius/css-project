[{"tags": ["haskell", "functional-programming", "monads"], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437016085, "post_id": 31442427, "comment_id": 50858335, "body": "You must mean <code>liftM2</code>, <code>liftM3</code> and <code>liftM4</code>, rather. Also, the definitions you give are those of <code>liftA2</code>, <code>liftA3</code> and <code>liftA4</code>. See <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#liftM2\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.0.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437073931, "post_id": 31442427, "comment_id": 50891686, "body": "Right, I swapped the <code>M</code> around; the hazards of answering from a mobile device. But as for the difference between <code>liftA2</code> etc and <code>liftM2</code>, that&#39;s what I meant by the comment about ghc 7.10. After the implementation of AMP, all properly defined Monads have <code>liftM2</code> defined to be identical to <code>liftA2</code>, etc."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437085257, "post_id": 31442427, "comment_id": 50897281, "body": "Despite the AMP taking effect, the <code>liftMn</code> function are still implemented in monadic terms in <code>base</code>; see <a href=\"https://github.com/ghc/ghc/blob/b98ca17e12c7efdc906f4901f25e6263a5399be1/libraries/base/GHC/Base.hs#L566\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/&hellip;</a>"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437100707, "post_id": 31442427, "comment_id": 50901153, "body": "Sure, they are. So? The AMP requires that in a properly defined Monad <code>(&lt;*&gt;)</code> is identical to <code>ap</code>, and <code>fmap</code> to <code>liftM</code>, and the definitions you cite are equivalent to <code>liftM2 f a b = f `liftM` a `ap` b</code>, <code>liftM3 f a b c = f `liftM` a `ap` b `ap` c</code>, etc."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": false, "score": 1, "last_activity_date": 1437073972, "last_edit_date": 1437073972, "creation_date": 1436999784, "answer_id": 31442427, "question_id": 31442080, "link": "https://stackoverflow.com/questions/31442080/haskell-variadic-monadic-lift-function/31442427#31442427", "title": "Haskell: Variadic monadic lift function", "body": "<p>In general, you can't have variadic Haskell functions because functions that take different numbers of parameters have very different types.</p>\n\n<p>However, there is a generalization to <code>liftM2</code> using operators from <code>Control.Applicative</code> that may find interesting:</p>\n\n<pre><code>liftM2 f a b = f &lt;$&gt; a &lt;*&gt; b\nliftM3 f a b c = f &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c\nliftM4 f a b c d = f &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c &lt;*&gt; d\n</code></pre>\n\n<p>(Technically, this applies only if your Monad is also Applicative, but as of ghc 7.10, all Monads are Applicative)</p>\n\n<p>etc. It's worth working through the types to figure out how those expressions work.</p>\n"}], "owner": {"reputation": 71, "user_id": 5083613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/993b39269cd7dbcda880da70cb0d7cc1?s=128&d=identicon&r=PG&f=1", "display_name": "user12596", "link": "https://stackoverflow.com/users/5083613/user12596"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "closed_date": 1436998440, "answer_count": 1, "score": 1, "last_activity_date": 1437073972, "creation_date": 1436998290, "question_id": 31442080, "link": "https://stackoverflow.com/questions/31442080/haskell-variadic-monadic-lift-function", "closed_reason": "Duplicate", "title": "Haskell: Variadic monadic lift function", "body": "<p>I am new to Haskell and I am trying to monads. I read about the liftM2 and I wanted to know if you could make it variadic. </p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "edited": false, "score": 0, "creation_date": 1437050986, "post_id": 31441942, "comment_id": 50876340, "body": "Thank you for the answer. I had a wrong impression how <code>foldr</code> actually works. I thought that the accumulator really accumulates something, not that its initial value is used inside each application of <code>foldr</code>. Reading how it is implemented helped. Your answer pointed me in the right direction, so I accept it."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 8, "last_activity_date": 1436997726, "creation_date": 1436997726, "answer_id": 31441942, "question_id": 31441586, "link": "https://stackoverflow.com/questions/31441586/why-xs-acc-works-when-using-foldr-on-an-infinite-list-but-acc-xs-doesnt/31441942#31441942", "title": "Why xs ++ acc works when using foldr on an infinite list, but acc ++ xs doesn&#39;t?", "body": "<p><code>foldr</code> doesn't evaluate the accumulator at all if it's not forced. <code>fold_cycle</code> works precisely because it doesn't necessarily evaluate <code>acc</code>.</p>\n\n<pre><code>fold_cycle [1, 2]\n</code></pre>\n\n<p>reduces to </p>\n\n<pre><code>[1, 2] ++ ([1, 2] ++ ([1, 2] ++ ([1, 2] ++ ...\n</code></pre>\n\n<p>Which allows us to evaluate prefixes of the result because <code>++</code> lets us traverse the first argument without evaluating the second.</p>\n\n<p>If we use <code>step _ acc = acc ++ xs</code>, the parentheses in the above expression associate to the left instead of right. But since we have an infinite number of appends, the expression ends up like this:</p>\n\n<pre><code>((((((((((((((... -- parentheses all the way down\n</code></pre>\n\n<p>Intuitively, we would have to step over an infinite number of parentheses to inspect the first element of the resulting list. </p>\n"}], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 31441942, "answer_count": 1, "score": 2, "last_activity_date": 1436997726, "creation_date": 1436996207, "question_id": 31441586, "link": "https://stackoverflow.com/questions/31441586/why-xs-acc-works-when-using-foldr-on-an-infinite-list-but-acc-xs-doesnt", "title": "Why xs ++ acc works when using foldr on an infinite list, but acc ++ xs doesn&#39;t?", "body": "<p><em>I know the question title might be misleading, because I'm not concatenating an infinite list with anything here. Feel free to propose something more suitable.</em> </p>\n\n<p>Here is a working implementation of the <code>cycle</code> function from <code>Prelude</code> using <code>foldr</code>:</p>\n\n<pre><code>fold_cycle :: [a] -&gt; [a]\nfold_cycle xs = foldr step [] [1..]\n    where step x acc = xs ++ acc\n</code></pre>\n\n<p>If we switch the operands of <code>++</code> to <code>acc ++ xs</code>, this function no longer works. It produces a stack overflow, which, by my understanding, is the result of trying to produce a never-ending expression for later evaluation. </p>\n\n<p>I have trouble understanding what is the reason behind this. My reasoning is that regardless of the order of operands, <code>foldr</code> should evaluate <code>step</code> once, produce the new accumulator and proceed to evaluate the <code>step</code> function again if necessary. Why is there a difference?</p>\n"}, {"tags": ["json", "haskell", "serialization", "algebraic-data-types", "aeson"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1436991596, "post_id": 31439991, "comment_id": 50849888, "body": "You could just write the <code>ToJSON</code> and <code>FromJSON</code> instances manually to get exactly what you want: <code>toJSON (AttachMsg (Attach tel)) = object [&quot;attach&quot; .= object [&quot;tel&quot; .= tel]]</code>, and similarly for <code>FixMsg</code>.  The <code>parseJSON</code> implementation wouldn&#39;t be much more difficult."}, {"owner": {"reputation": 37702, "user_id": 129805, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/F1gxS.png?s=128&g=1", "display_name": "fadedbee", "link": "https://stackoverflow.com/users/129805/fadedbee"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1436993032, "post_id": 31439991, "comment_id": 50850753, "body": "@bheklilr Thanks, that was really useful.  Could you make it into an answer?  Could you see my updated question..."}], "answers": [{"comments": [{"owner": {"reputation": 37702, "user_id": 129805, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/F1gxS.png?s=128&g=1", "display_name": "fadedbee", "link": "https://stackoverflow.com/users/129805/fadedbee"}, "edited": false, "score": 0, "creation_date": 1436993797, "post_id": 31440586, "comment_id": 50851202, "body": "Thanks for your answer, but I didn&#39;t explain myself clearly enough.  I want the output <code>{&quot;attach&quot;:{&quot;tel&quot;:&quot;+447890&quot;}}</code> from the original <code>MsgIn</code> data type."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1436996033, "post_id": 31440586, "comment_id": 50852311, "body": "This is still useful info, even if it doesn&#39;t answer the question, so I&#39;m upvoting it anyway."}], "tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": false, "score": 4, "last_activity_date": 1436992709, "creation_date": 1436992709, "answer_id": 31440586, "question_id": 31439991, "link": "https://stackoverflow.com/questions/31439991/how-to-serialise-haskell-adts-as-tidy-json-using-aeson/31440586#31440586", "title": "How to serialise Haskell ADTs as tidy JSON, using Aeson?", "body": "<p>You can get aeson to skip null fields automatically. I usually do this in combination with the <code>DeriveGeneric</code> extension:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport qualified Data.ByteString.Lazy.Char8 as BL\nimport GHC.Generics\n\ndata Attach = Attach { tel :: String } deriving (Show, Generic)\n\ndata Fix = Fix { lat :: Double, lng :: Double } deriving (Show, Generic)\n\ndata Msg = Msg { attach :: Attach, fix :: Maybe Fix } deriving (Show, Generic)\n\ninstance ToJSON Attach\ninstance ToJSON Fix\ninstance ToJSON Msg where\n    toJSON = genericToJSON (defaultOptions { omitNothingFields = True })\n\nmain = do\n    let attach = Attach \"+447890\"\n        reply  = Msg attach Nothing\n    BL.putStrLn (encode reply)\n</code></pre>\n\n<p>which gives you:</p>\n\n<pre><code>*Main&gt; main\n{\"attach\":{\"tel\":\"+447890\"}}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37702, "user_id": 129805, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/F1gxS.png?s=128&g=1", "display_name": "fadedbee", "link": "https://stackoverflow.com/users/129805/fadedbee"}, "edited": false, "score": 0, "creation_date": 1436995044, "post_id": 31441133, "comment_id": 50851861, "body": "Thanks, this looks like the right answer - it&#39;s getting late, so I&#39;ll try it tomorrow."}, {"owner": {"reputation": 37702, "user_id": 129805, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/F1gxS.png?s=128&g=1", "display_name": "fadedbee", "link": "https://stackoverflow.com/users/129805/fadedbee"}, "edited": false, "score": 0, "creation_date": 1437131108, "post_id": 31441133, "comment_id": 50913818, "body": "Works perfectly - separate file for defining options isn&#39;t a problem."}], "tags": [], "owner": {"reputation": 141, "user_id": 5121177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a07ec130df782f9b40aec1c8801ed71?s=128&d=identicon&r=PG", "display_name": "gekkio", "link": "https://stackoverflow.com/users/5121177/gekkio"}, "is_accepted": true, "score": 5, "last_activity_date": 1436994886, "last_edit_date": 1436994886, "creation_date": 1436994485, "answer_id": 31441133, "question_id": 31439991, "link": "https://stackoverflow.com/questions/31439991/how-to-serialise-haskell-adts-as-tidy-json-using-aeson/31441133#31441133", "title": "How to serialise Haskell ADTs as tidy JSON, using Aeson?", "body": "<p>Use custom options instead of defaultOptions. You can get the right structure by using <code>sumEncoding = ObjectWithSingleField</code>, which reduces your first example to <code>{\"AttachMsg\":{\"tel\":\"+447890\"}}</code>. You can then customize the constructor tags by using <code>constructorTagModifier = myConstructorTag</code> and by writing a function <code>myConstructorTag</code> that customizes the names to your liking (e.g. AttachMsg -> attach).</p>\n\n<p>As an example, you'll get the output you want by writing this into a separate module, importing it, and using <code>myOptions</code> instead of <code>defaultOptions</code>:</p>\n\n<pre><code>myConstructorTag :: String -&gt; String\nmyConstructorTag \"AttachMsg\" = \"attach\"\nmyConstructorTag x = x\n\nmyOptions :: Options\nmyOptions = defaultOptions {sumEncoding = ObjectWithSingleField, constructorTagModifier = myConstructorTag}\n</code></pre>\n\n<p>A separate module is needed here because of Template Haskell. There's probably a way to define myConstructorTag and myOptions in a better way to satisfy the needs of TH, but I have absolutely no idea how to do that.</p>\n"}], "owner": {"reputation": 37702, "user_id": 129805, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/F1gxS.png?s=128&g=1", "display_name": "fadedbee", "link": "https://stackoverflow.com/users/129805/fadedbee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 2, "accepted_answer_id": 31441133, "answer_count": 2, "score": 5, "last_activity_date": 1436994886, "creation_date": 1436990695, "last_edit_date": 1436993669, "question_id": 31439991, "link": "https://stackoverflow.com/questions/31439991/how-to-serialise-haskell-adts-as-tidy-json-using-aeson", "title": "How to serialise Haskell ADTs as tidy JSON, using Aeson?", "body": "<p>I've spent some time playing around with Aeson, but I can't get Algebraic Data Types to serialise nicely.</p>\n\n<p>What I've tried is:</p>\n\n<pre><code>data Attach = Attach { tel :: String }\n              deriving (Show)\n$(deriveJSON defaultOptions ''Attach)\n\ndata Fix = Fix { lat :: Double, lng :: Double }\n              deriving (Show)\n$(deriveJSON defaultOptions ''Fix)\n\ndata MsgIn = AttachMsg Attach\n           | FixMsg    Fix\n           deriving (Show)\n$(deriveJSON defaultOptions ''MsgIn)\n\ndata MsgIn2 = MsgIn2 { attach :: Maybe Attach, fix :: Maybe Fix }\n            deriving (Show)\n$(deriveJSON defaultOptions ''MsgIn2)\n\nsomeFunc :: IO ()\nsomeFunc = do\n  let attach = Attach \"+447890\"\n  let reply = AttachMsg attach\n  BL.putStrLn (encode reply)\n  let reply2 = MsgIn2 (Just attach) Nothing\n  BL.putStrLn (encode reply2)\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>{\"tag\":\"AttachMsg\",\"contents\":{\"tel\":\"+447890\"}}\n{\"attach\":{\"tel\":\"+447890\"},\"fix\":null}\n</code></pre>\n\n<p>The output I'm looking for is:</p>\n\n<pre><code>{\"attach\":{\"tel\":\"+447890\"}}\n</code></pre>\n\n<p>but from the <code>MsgIn</code> type, rather than <code>MsgIn2</code>.  </p>\n\n<p>(The output of <code>MsgIn2</code> gets quite close, but it's got an explicit <code>null</code>.)</p>\n\n<p>Is there a way of doing this in Aeson?</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>I added:</p>\n\n<pre><code>instance ToJSON MsgIn3 where\n  toJSON (AttachMsg3 (Attach tel)) = object [\"attach\" .= object [\"tel\" .= tel]]\n...\nlet reply3 = AttachMsg3 attach\nBL.putStrLn (encode reply3)\n</code></pre>\n\n<p>and got the answer I wanted: <code>{\"attach\":{\"tel\":\"+447890\"}}</code>.</p>\n\n<p>@bheklilr is there a way to use Attach's (already defined) serialisation, instead of defining it again? </p>\n\n<p>I've tried some nonsense syntax, but understandably it doesn't compile:</p>\n\n<pre><code>instance ToJSON MsgIn3 where\n  toJSON (AttachMsg3 (Attach tel)) = object [\"attach\" .= (toJSON :: Attach)] \n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1436989547, "post_id": 31439511, "comment_id": 50848719, "body": "<code>getVars a fn</code> is a <code>Bool</code> but <code>getVars b</code> expects an <code>ExtractVars b</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436989872, "post_id": 31439511, "comment_id": 50848886, "body": "Is your <code>Parsers</code> GADT correct? what&#39;s that <code>ty</code> doing?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436990075, "post_id": 31439511, "comment_id": 50848991, "body": "Usually the answer is &quot;you forgot that type synonym families are not injective&quot;"}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1436990652, "post_id": 31439511, "comment_id": 50849336, "body": "@gallais but isn&#39;t the type of  <code>getVars a fn</code> is dependant on the type of a here? Eg if <code>a</code> is <code>S a</code> then fn should be a <code>Bool</code>, but if it is <code>V a</code> then fn should be <code>a -&gt; Bool</code> given the type of <code>getVars</code>."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436990867, "post_id": 31439511, "comment_id": 50849463, "body": "@jberryman I believe so. <code>ty</code> here is holding the &#39;label&#39; (V a, S a or C a b) which depends on the constructor used. I then pass this label to the ExtractVars type alias (and thus GetVars type family) to have it transformed into the function signature I desire. That part, at least, seems to be fine :)"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1436992211, "post_id": 31439511, "comment_id": 50850258, "body": "The parameters fed to <code>getVars</code> might depend on <code>p</code> but the function itself is quite clearly returning a <code>Bool</code> no matter what once fully applied: <code>getVars :: Parsers p -&gt; ExtractVars p -&gt; Bool</code>."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "edited": false, "score": 0, "creation_date": 1436995757, "post_id": 31439511, "comment_id": 50852197, "body": "Ah crap sorry I see what you mean now, a silly error on my part \u263a"}], "answers": [{"comments": [{"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "edited": false, "score": 0, "creation_date": 1436995712, "post_id": 31440297, "comment_id": 50852171, "body": "Ah crap now I feel silly! Yes of course getVars wont necessarily return a Bool on the recusing. Also thanks for the DataKinds tip. That was my next step, just wanted to work up to it \u263a"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1436991732, "creation_date": 1436991732, "answer_id": 31440297, "question_id": 31439511, "link": "https://stackoverflow.com/questions/31439511/haskell-playing-with-typefamilies-could-not-deduce-issue/31440297#31440297", "title": "Haskell: playing with TypeFamilies; could not deduce issue", "body": "<p>Just generalize <code>getVars</code>:</p>\n\n<pre><code>getVars :: Parsers p -&gt; GetVars p out -&gt; out\ngetVars (ParVar s)       fn = fn s\ngetVars (ParStatic _)    fn = fn\ngetVars (ParCombine a b) fn = getVars b (getVars a fn)\n</code></pre>\n\n<p>With the original type, <code>getVars a fn :: Bool</code>, but we need <code>getVars a fn :: ExtractVars ty2</code>. In general, if we'd like to do substantial computation on GADTs, we must make sure that we have a type general enough so we can actually make the recursive calls (since the types or type indices might change as we recurse). </p>\n\n<p>As a side note, the idiomatic way to represent the GADT indices is to use <code>DataKinds</code> and lifted types:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\ndata ParserTy a = V a | S a | C (ParserTy a) (ParserTy a)\n\ndata Parsers (ty :: ParserTy *) where\n  ParVar :: a -&gt; Parsers (V a)\n  ParStatic :: a -&gt; Parsers (S a)\n  ParCombine :: Parsers ty1 -&gt; Parsers ty2 -&gt; Parsers (C ty1 ty2)\n</code></pre>\n\n<p>The rest of the code remains the same. This way we can't pollute <code>ParserTy</code> with arbitrary types that don't really belong there, and we can write exhaustive type families over it. </p>\n"}], "owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 31440297, "answer_count": 1, "score": 3, "last_activity_date": 1436991732, "creation_date": 1436988946, "last_edit_date": 1436991323, "question_id": 31439511, "link": "https://stackoverflow.com/questions/31439511/haskell-playing-with-typefamilies-could-not-deduce-issue", "title": "Haskell: playing with TypeFamilies; could not deduce issue", "body": "<p>I am having a play with TypeFamilies and the such in Haskell. I am trying to create a simple example whereby I have a function that takes in some type (<code>Parsers ty</code>) below, and a function that takes a number of arguments dependant on that <code>ty</code>, and outputs some result.</p>\n\n<p>Here's the entire code snippet up front:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances, TypeFamilies,GADTs #-}\n\n\ndata V a   --\"variable\"\ndata S a   --\"static\"\ndata C a b --combination\n\n--define data type:\ndata Parsers ty where\n  ParVar :: a -&gt; Parsers (V a)\n  ParStatic :: a -&gt; Parsers (S a)\n  ParCombine :: Parsers ty1 -&gt; Parsers ty2 -&gt; Parsers (C ty1 ty2)\n\n--basic type alias to below, output set to Bool\ntype ExtractVars parsers = GetVars parsers Bool\n\n--we want to convert some combination of C/S/V\n--types into a function taking, from left to right,\n--each type inside S as parameter\ntype family GetVars parsers output where\n  GetVars (S a) output = output\n  GetVars (V a) output = a -&gt; output\n  GetVars (C a b) output = GetVars a (GetVars b output)\n\n--this function uses the above such that, hopefully,\n--the second argument to be provided will be a function\n--that will take each S type as an argument and return\n--a bool. We then return that bool from the whole thing\ngetVars :: Parsers p -&gt; ExtractVars p -&gt; Bool\ngetVars (ParVar s) fn = fn s\ngetVars (ParStatic _) fn = fn\n-- this is the offending line:\ngetVars (ParCombine a b) fn = getVars b (getVars a fn)\n</code></pre>\n\n<p>My <code>Parsers ty</code> type seems to do the right thing; constructing things with it leads to types I would expect eg:</p>\n\n<pre><code>ParVar \"hi\" \n  :: Parsers (V [Char])\nParCombine (ParVar \"hi\") (ParStatic \"woop\")\n  :: Parsers (C (V [Char]) (S [Char]))\nParCombine (ParVar 'h') (ParCombine (ParStatic True) (ParVar \"hello\"))\n  :: Parsers (C (V Char) (C (S Bool) (V [Char])))\n</code></pre>\n\n<p>Equally, my type family <code>GetVars</code> seems to do the right thing, performing conversions such as:</p>\n\n<pre><code>(C (V a) (V b)) out =&gt; a -&gt; b -&gt; out\n(V a) out           =&gt; a -&gt; out\n(S a) out           =&gt; out\n(C (S a) (V b) out  =&gt; b -&gt; out\n</code></pre>\n\n<p>Basically, correctly picking out the things tagged with <code>V</code> in the correct order and ignoring the <code>S</code>s</p>\n\n<p>My <code>getVars</code> function then uses this in its type signature:</p>\n\n<pre><code>getVars :: Parsers p -&gt; ExtractVars p -&gt; Bool\n</code></pre>\n\n<p>To say that whatever <code>p</code> is, expect a function matching my type alias <code>ExtractVars p</code>, and return a <code>Bool</code>.</p>\n\n<p>Of my <code>getVars</code> function, these two definitions cause no issue:</p>\n\n<pre><code>getVars (ParVar s) fn = fn s\ngetVars (ParStatic _) fn = fn\n</code></pre>\n\n<p>but the final one:</p>\n\n<pre><code>getVars (ParCombine a b) fn = getVars b (getVars a fn)\n</code></pre>\n\n<p>Fails to typecheck, with the errors:</p>\n\n<pre><code>test.hs:74:42:\n    Could not deduce (GetVars ty2 Bool ~ Bool)\n    from the context (p ~ C ty1 ty2)\n      bound by a pattern with constructor\n                 ParCombine :: forall ty1 ty2.\n                               Parsers ty1 -&gt; Parsers ty2 -&gt; Parsers (C ty1 ty2),\n               in an equation for \u2018getVars\u2019\n      at test.hs:74:10-23\n    Expected type: ExtractVars ty2\n      Actual type: Bool\n    Relevant bindings include b :: Parsers ty2 (bound at test.hs:74:23)\n    In the second argument of \u2018getVars\u2019, namely \u2018(getVars a fn)\u2019\n    In the expression: getVars b (getVars a fn)\n\ntest.hs:74:52:\n    Could not deduce (GetVars ty1 Bool\n                      ~ GetVars ty1 (GetVars ty2 Bool))\n    from the context (p ~ C ty1 ty2)\n      bound by a pattern with constructor\n                 ParCombine :: forall ty1 ty2.\n                               Parsers ty1 -&gt; Parsers ty2 -&gt; Parsers (C ty1 ty2),\n               in an equation for \u2018getVars\u2019\n      at test.hs:74:10-23\n    NB: \u2018GetVars\u2019 is a type function, and may not be injective\n    Expected type: ExtractVars ty1\n      Actual type: ExtractVars p\n    Relevant bindings include\n      b :: Parsers ty2 (bound at test.hs:74:23)\n      a :: Parsers ty1 (bound at test.hs:74:21)\n    In the second argument of \u2018getVars\u2019, namely \u2018fn\u2019\n    In the second argument of \u2018getVars\u2019, namely \u2018(getVars a fn)\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>(line 74 is the failing ParCombine definition of getVars)</p>\n\n<p>I've been banging my head against the desk trying to figure out where I'm going wrong to no avail, and really want to get a firm grip on the ins and outs of type families as they seem awesome (the above example for instance- being able to expect some function type depending on input - would be incredibly cool!)</p>\n\n<p>Could anyone point my in the right direction or correct my possibly very silly error?</p>\n\n<p>Thanks!</p>\n\n<p>(PS I'm using GHC 7.10.1 and running this in ghci)</p>\n\n<p><strong>Edit</strong> Just to say this example was somewhat motivated by a paper on type families, specifically the sprintf example <a href=\"https://wiki.haskell.org/Simonpj/Talk:FunWithTypeFuns\" rel=\"nofollow\">here</a>. Perhaps I have skipped something important in attempting to distill what I wanted from it!</p>\n"}, {"tags": ["visual-studio-2010", "haskell"], "comments": [{"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "edited": false, "score": 0, "creation_date": 1437005525, "post_id": 31438420, "comment_id": 50855704, "body": "<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/win32-dlls.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "reply_to_user": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "edited": false, "score": 0, "creation_date": 1437056166, "post_id": 31438420, "comment_id": 50880528, "body": "@TheInternet Those instructions mention linking in \u201cAdder_stub.o\u201d, which is <a href=\"http://stackoverflow.com/a/10983869/371228\">not even produced by recent versions of GHC</a>. The instructions are out of date."}], "answers": [{"comments": [{"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 1, "creation_date": 1437071338, "post_id": 31459030, "comment_id": 50890289, "body": "This seems to work except that my C++ code can\u2019t see the declarations of <code>HsStart</code> and <code>HsEnd</code>. Should those be in \u201cMyLibrary_stub.h\u201d?"}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 1, "creation_date": 1437074262, "post_id": 31459030, "comment_id": 50891867, "body": "I wrote a header file \u201cStartEnd.h\u201d, put in the declarations of <code>HsStart</code> and <code>HsEnd</code>, and added it to my C++ project. Now everything links and compiles nicely\u2026 but I still get <a href=\"http://stackoverflow.com/q/31416185/371228\">this weird error</a>. Not sure where to go from there."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 1, "creation_date": 1437100969, "post_id": 31459030, "comment_id": 50901204, "body": "Sorry, I forgot that you need to prototype those in your code. I&#39;ll update accordingly."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 1, "creation_date": 1437397522, "post_id": 31459030, "comment_id": 50995713, "body": "If it&#39;s helpful, I&#39;ve been using Visual Studio 2013 for this without any issues. It seems that there might be a bug in VS 2010 (from your other SO question)?"}], "tags": [], "owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "is_accepted": true, "score": 3, "last_activity_date": 1437228164, "last_edit_date": 1437228164, "creation_date": 1437062012, "answer_id": 31459030, "question_id": 31438420, "link": "https://stackoverflow.com/questions/31438420/how-can-i-integrate-a-haskell-dll-into-a-c-qt-windows-application/31459030#31459030", "title": "How can I integrate a Haskell DLL into a C++/Qt Windows application?", "body": "<p>I recommend using <code>cabal-install</code> (or <code>stack</code>) for this actually. If you plan on distributing this DLL without LPGL-compatible licensing, you likely want to use a build of GHC using <code>integer-simple</code> instead of <code>integer-gmp</code> (the default).</p>\n\n<hr>\n\n<h2>Haskell side</h2>\n\n<p>First, be familiar with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/win32-dlls.html\" rel=\"nofollow\">this GHC tutorial</a>.</p>\n\n<p>After reading that, you'll realize you need a copy of <code>StartEnd.c</code> somewhere. Let's say it's in <code>src\\</code>.</p>\n\n<p>So here's your <code>MyLibrary.cabal</code> file:</p>\n\n<pre><code>...other cabal stuff...\n\nlibrary\n  exposed-modules:     MyModule\n  --other-modules:\n  other-extensions:    ForeignFunctionInterface\n  build-depends:       base\n  hs-source-dirs:      src\n  c-sources:           src/StartEnd.c  --tells cabal to rebuild if this changes\n  default-language:    Haskell2010\n  --default-extensions:\n\n  -- Add whatever options you need, in addition to these:\n  -- (In my experience, adding `-threaded` can make the DLL \n  --  behave better during debugging; but that's only a guess.)\n  ghc-options:         -O1 -shared src/StartEnd.c\n</code></pre>\n\n<p>Now build it with <code>cabal build</code> (or <code>stack build</code> if you're using <code>stack</code>).</p>\n\n<p><em>Expect to see warnings. Cabal is not quite cognizant of what you're up to.</em></p>\n\n<p>You will find three files important to you, relative to your cabal project:</p>\n\n<ul>\n<li><code>HSdll.dll</code></li>\n<li><code>HSdll.dll.a</code> (Windows calls these <code>.lib</code> files normally; you can rename it if you like)</li>\n<li><code>build\\...\\MyLibrary_stub.h</code></li>\n</ul>\n\n<p><strong>Note that this DLL statically links all Haskell dependencies. So you don't need to tell Visual Studio about anything besides your DLL.</strong></p>\n\n<hr>\n\n<h2>C++ side</h2>\n\n<ul>\n<li>In your C++ code, you need to include the <code>MyLibrary_stub.h</code> file generated above.</li>\n<li><p>You will also need to include prototypes of <code>HsStart</code> and <code>HsEnd</code> somewhere:</p>\n\n<p><code>extern \"C\" {\n  void HsStart();\n  void HsEnd();\n}</code></p></li>\n<li><p>The <code>_stub.h</code> file includes some GHC headers, so you need to add a folder to your \"Additional Includes\" in the VS project: <code>&lt;ghc-folder&gt;\\ghc-7.10.1\\lib\\include</code>.</p>\n\n<ul>\n<li>One trick to doing this is to run <code>where ghc</code>, drop <code>ghc.exe</code>, and append <code>\\..\\lib\\include</code> to the result of that.</li>\n</ul></li>\n</ul>\n\n<p>In your C++ app, make sure you call <code>HsStart()</code> and <code>HsEnd()</code> at the beginning and end of your program. I like to encapsulate those in an RAII structure so I can't forget to do it right.</p>\n\n<hr>\n\n<h3>My experience</h3>\n\n<p>I've tried this with <code>cabal-install</code> 1.2* versions and <code>stack</code>. I've used both GHC 7.8.4 and 7.10.1, each with 32-bit and 64-bit versions.</p>\n\n<p>Please note that <code>Cabal</code> is soon to come out with <a href=\"https://github.com/haskell/cabal/pull/2540\" rel=\"nofollow\">much better support for this</a>.</p>\n\n<hr>\n\n<h3>Naming your DLL</h3>\n\n<p>Until Cabal has better support, the only way I've found to give your DLL a name is by adding <code>-o MyLibrary.dll</code> to <code>ghc-options</code>. Even though it works, GHC gives you warnings when you do this that show it doesn't really know what's going on. To help it out, you can pre-build <code>StartEnd.c</code> into <code>StartEnd.o</code> and link that instead. The command to use is something like this:</p>\n\n<pre><code>cabal exec -- ghc -optc-O -c src/StartEnd.c -o obj/StartEnd.o\n</code></pre>\n\n<p>Now, in <code>ghc-options</code>, replace <code>src/StartEnd.c</code> with <code>obj/StartEnd.o</code>.</p>\n\n<p><em>Replacing <code>cabal</code> with <code>stack</code> should work as well, if you're using <code>stack</code>.</em></p>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "accepted_answer_id": 31459030, "answer_count": 1, "score": 3, "last_activity_date": 1437598181, "creation_date": 1436985333, "last_edit_date": 1437598181, "question_id": 31438420, "link": "https://stackoverflow.com/questions/31438420/how-can-i-integrate-a-haskell-dll-into-a-c-qt-windows-application", "title": "How can I integrate a Haskell DLL into a C++/Qt Windows application?", "body": "<p>I wrote some functions in Haskell and I\u2019d like to build them into a DLL so I can call them from my C++ application. I\u2019m having just an awful time. (It seems like calling a C DLL from Haskell is much more common and better documented.)</p>\n\n<p>My Haskell setup is MinGHC 7.10.1 (32-bit). The C++ project uses Visual Studio 2010 and Qt 5.4; I use qmake to generate the VS project file from a .pro file.  Here\u2019s what I\u2019m doing:</p>\n\n<ol>\n<li>Use cabal-install to install the packages my library needs. (These get installed globally, not in a sandbox.)</li>\n<li>Run <code>ghc -no-hs-main -v SpectrumMath.hs &gt; ghc_output 2&gt;&amp;1</code> to dump GHC\u2019s verbose build output to a file.</li>\n<li>Look at the <code>ghc_output</code> file and find the linker command (it\u2019s the line after \u201c*** Linker:\u201d). Extract the library directories (indicated by the <code>-L</code> flag) and the library names (indicated by the <code>-l</code> flag).</li>\n<li><p>Add these libraries to the Qt .pro file, e.g.</p>\n\n<pre><code>LIBS += \\\n    -Lsome_long_path_here \\\n    -Lsome_other_long_path_here \\\n    -lsome_library_name_here \\\n    -lsome_other_library_name_here\n</code></pre></li>\n<li><p>Run <code>ghc --print-libdir</code>. Append <code>/include</code> to the end of this path and add it to the .pro file:</p>\n\n<pre><code>INCLUDEPATH += \"C:/Program Files (x86)/MinGHC-7.10.1/ghc-7.10.1/lib/include\"\n</code></pre></li>\n<li><p>Run qmake to generate a Visual Studio project.</p></li>\n<li>Open the VS project. Open the project\u2019s properties and navigate to Configuration Properties\u00a0\u2192 Linker\u00a0\u2192 Input and edit the Additional Dependencies field. Qmake helpfully \u201cfixed\u201d the libraries\u2019 names, so replace each instance of \u201cHS<em>something</em>.lib\u201d with \u201clibHS<em>something</em>.a\u201d. Likewise, rename \u201cCffi-6.lib\u201d to \u201clibCffi-6.a\u201d and \u201cHSrts.lib\u201d to \u201clibHSrts.a\u201d.</li>\n</ol>\n\n<p>This crazy process comes from <a href=\"https://wiki.haskell.org/FFI_complete_examples#When_main_is_in_C.2B.2B\" rel=\"nofollow\">this page</a> on the wiki. It assumes that the C++ file will <code>#include \"SpectrumMath_stub.h\"</code>, a file that was generated by GHC in step\u00a02.</p>\n\n<p>I get stuck at this point because I don\u2019t know what to do with the m library (the one that came from the <code>-lm</code> flag). Visual Studio can\u2019t find an \u201cm.lib\u201d but if I remove that library from the list I get dozens of \u201cunresolved externals\u201d messages, so that library <em>is</em> needed. How do I tell Visual Studio about the libm dependency? Or should I be following another process entirely?</p>\n"}, {"tags": ["haskell", "list-comprehension", "evaluation"], "comments": [{"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1436984522, "post_id": 31438138, "comment_id": 50845928, "body": "<code>[(x,y)| x&lt;-[1..2], y&lt;-[x..3]]</code> evaluates to something different. Try it.."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1436984568, "post_id": 31438138, "comment_id": 50845953, "body": "<code>z</code> is used in the predicate <code>odd z</code>, so this will only return pairs whose sum is odd."}, {"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1436984684, "post_id": 31438138, "comment_id": 50846020, "body": "But 2 isn&#39;t odd... I need some more explanation please. It hurts in my brain ^^"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1436984764, "post_id": 31438138, "comment_id": 50846066, "body": "<code>z</code> is the sum of <code>x</code> and <code>y</code> i.e. the sum of the two elements in the pair. <code>1+2</code> is odd and <code>2+3</code> is also odd."}, {"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1436984942, "post_id": 31438138, "comment_id": 50846170, "body": "Ahh now I get it. (1,1) no, (1,2) yes, (1,3) no, (2,2) no, (2,3) yes which leads to [(1,2),(2,3)] Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 0, "creation_date": 1436985189, "post_id": 31438332, "comment_id": 50846329, "body": "Yes, got it. Thanks for your effort!"}], "tags": [], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "is_accepted": true, "score": 4, "last_activity_date": 1436985031, "creation_date": 1436985031, "answer_id": 31438332, "question_id": 31438138, "link": "https://stackoverflow.com/questions/31438138/explanation-of-specific-list-comprehension-in-haskell/31438332#31438332", "title": "Explanation of specific list comprehension in Haskell", "body": "<p>Your predicate is \"z = x + y for all z odd\". If you \"unroll\" the flow:</p>\n\n<p>z = predicate, and y(x) so for: </p>\n\n<pre><code>x = 1,2\ny (1) = 1,2,3\ny (2) = 2,3\n</code></pre>\n\n<p>Based on the combination of the values filtered by the predicate:</p>\n\n<pre><code>x+y &lt;= filter(z)\n\n1+1 = 2 NO\n1+2 = 3 OK\n1+3 = 4 NO\n\n2+2 = 4 NO\n2+3 = 5 OK\n</code></pre>\n\n<p>so the ok answers are for x = 1 and y = 2 and x = 2 and y =3 => <code>[(1,2), (2,3)]</code></p>\n"}], "owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 31438332, "answer_count": 1, "score": 3, "last_activity_date": 1436985031, "creation_date": 1436984359, "question_id": 31438138, "link": "https://stackoverflow.com/questions/31438138/explanation-of-specific-list-comprehension-in-haskell", "title": "Explanation of specific list comprehension in Haskell", "body": "<p>I've a question regarding list comprehension</p>\n\n<pre><code>[(x,y)| x&lt;-[1..2], y&lt;-[x..3], let z = x+y, odd z]\n</code></pre>\n\n<p>Why does this evaluate to:</p>\n\n<pre><code>[(1,2),(2,3)]\n</code></pre>\n\n<p>?</p>\n\n<p>Where is the z going?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "monad-transformers", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 1, "last_activity_date": 1436983698, "last_edit_date": 1436983698, "creation_date": 1436982483, "answer_id": 31437527, "question_id": 31437398, "link": "https://stackoverflow.com/questions/31437398/hackage-where-is-the-monadreader-implementation-for-readert-defined/31437527#31437527", "title": "Hackage - Where is the MonadReader implementation for ReaderT defined?", "body": "<p>That file contains the import statement</p>\n\n<pre><code>import qualified Control.Monad.Trans.Reader as ReaderT (ask, local, reader)\n</code></pre>\n\n<p>so <code>ReaderT.ask</code> etc. refer to <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Control-Monad-Trans-Reader.html\" rel=\"nofollow\">that module</a>, from the <code>transformers-0.3.0.0</code> package (the only listed dependency of <code>mtl-2.1.2</code>. If you look on the main Hackage page of each package you may note that these are not the newest versions of either package.)</p>\n\n<p>In general, <code>transformers</code> and <code>mtl</code> define many functions of the same name, except that the <code>transformers</code> versions work only on the transformer type directly implementing the relevant effect, while <code>mtl</code> uses the <code>Monad*</code> class system to make them methods that can lift automatically to other, wrapping transformers.</p>\n\n<p>For the directly implementing transformer, like in your case, the particular method instance used in <code>mtl</code> is usually just refering to the corresponding <code>transformer</code> function.</p>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 31437527, "answer_count": 1, "score": 1, "last_activity_date": 1436983698, "creation_date": 1436982090, "question_id": 31437398, "link": "https://stackoverflow.com/questions/31437398/hackage-where-is-the-monadreader-implementation-for-readert-defined", "title": "Hackage - Where is the MonadReader implementation for ReaderT defined?", "body": "<p>I seem unable to find where two relatively simple Haskell methods are defined.</p>\n\n<p>It's about <code>ReaderT</code>. I am looking for its implementation of <code>ask</code> and <code>local</code>, as requested by the <code>MonadReader</code> contract.</p>\n\n<p>At <a href=\"https://hackage.haskell.org/package/mtl-2.1.2/docs/src/Control-Monad-Reader-Class.html#ask\" rel=\"nofollow\">https://hackage.haskell.org/package/mtl-2.1.2/docs/src/Control-Monad-Reader-Class.html#ask</a> I read:</p>\n\n<pre><code>instance Monad m =&gt; MonadReader r (ReaderT r m) where\n  ask = ReaderT.ask\n  local = ReaderT.local\n</code></pre>\n\n<p>but then I cannot find neither <code>ReaderT.ask</code> nor <code>ReaderT.local</code> anywhere.</p>\n\n<p>It is the first time that I find no implementation by perusing Hackage.</p>\n\n<p>Am I missing something?</p>\n"}, {"tags": ["haskell", "reflection", "types", "algebra", "reification"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1436994177, "creation_date": 1436994177, "answer_id": 31441037, "question_id": 31435668, "link": "https://stackoverflow.com/questions/31435668/cant-show-due-to-ambiguous-type-while-using-data-reflection-in-haskell/31441037#31441037", "title": "Can&#39;t show due to ambiguous type while using Data.Reflection in Haskell", "body": "<p>In this particular example, <code>Zn</code> is an internal implementation detail and it shouldn't be used for constructing numbers. Ideally, <code>Zn</code> shouldn't be even exported from a library. Instead, we're supposed to construct using <code>fromInteger</code> and numeric literals. </p>\n\n<p>The modulus is introduced in <code>fromInteger</code> by reflection, and we only store it in <code>Zn</code> to avoid further use of <code>reflect</code>, for performance reasons (although I believe <code>reflect</code> doesn't have much overhead by default, so we might not gain much by this scheme). If we only use <code>fromInteger</code> to create new <code>Zn</code>-s, the moduli will be uniform over the whole computation with the <code>Reifies</code> constraint. On the other hand, if we manually plug in the modulus into <code>Zn</code>, then that piece of <code>Zn</code> will always have that modulus, and <code>reify</code> (the way by which we supply implicit configuration) won't affect it at all. In other words, it messes up our supposed invariant.</p>\n\n<p>Example use:</p>\n\n<pre><code>foo :: (Integral a, Reifies s a) =&gt; Zn s a -&gt; Zn s a -&gt; Zn s a\nfoo a b = e where\n  c = 123\n  d = a * b - 3\n  e = negate (d + c)\n\nshowAFooResult = reify 12 (\\(Proxy :: Proxy s) -&gt; show (foo 3 4 :: Zn s Int))\n-- fooResult == \"(0 mod 12)\"\n</code></pre>\n\n<p>Inside the body of <code>foo</code> everything will have <code>12</code> as modulus after we plugged it in using <code>reify</code>. </p>\n\n<p>If we squint a bit, <code>foo</code> is just a function that expects an extra <code>Integral</code> argument which it uses internally as modulus. We can use <code>reify</code> to supply the argument, using the the <code>s</code> index in <code>Proxy</code>. </p>\n\n<p>If we don't supply any value to plug in the <code>Reifies</code> hole, then we can't pull out a value. And of course we can't print it, much like we can't print a function. </p>\n\n<p>We can print <code>Zn 5 5</code> because it has type <code>Num a =&gt; Zn n a</code>, so we have no    hole to fill. On the other hand, <code>Zn 5 5 + Zn 5 5</code> has type <code>(Integral a, Reifies n a) =&gt; Zn n a</code>, because we specified the <code>Reifies n a</code> constraint in the <code>Num</code> instance, and of course the use of <code>+</code> demands a <code>Num</code> instance. Here we must use <code>reify</code> (or some other helper function that calls it) to pull out a result. </p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1436999365, "creation_date": 1436999365, "answer_id": 31442345, "question_id": 31435668, "link": "https://stackoverflow.com/questions/31435668/cant-show-due-to-ambiguous-type-while-using-data-reflection-in-haskell/31442345#31442345", "title": "Can&#39;t show due to ambiguous type while using Data.Reflection in Haskell", "body": "<p>For comparison, here's an implementation that doesn't store the modulus and always uses <code>reflect</code>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE RankNTypes #-}\n\nimport Data.Reflection\nimport Data.Proxy\nimport Text.Printf\n\nnewtype Zn a s = Zn { getZ :: a }\n\ninstance (Integral a, Show a, Reifies s a) =&gt; Show (Zn a s) where\n       show x = \n           let \n               p = reflect (Proxy::Proxy s)           \n           in\n               printf \"(%s mod %s)\" (show (mod (getZ x) p)) (show p)\n\ninstance (Integral a, Reifies s a) =&gt; Num (Zn a s) where\n      Zn x + Zn y = Zn (mod (x + y) (reflect (Proxy::Proxy s)))\n      Zn x - Zn y = Zn (mod (x - y) (reflect (Proxy::Proxy s)))\n      Zn x * Zn y = Zn (mod (x * y) (reflect (Proxy::Proxy s)))\n      negate (Zn x) = Zn ((reflect (Proxy::Proxy s)) - x)\n      abs = id\n      signum x@(Zn 0) = x\n      signum _ = Zn 1\n      fromInteger x = Zn (mod (fromInteger x) p)\n            where p = reflect (Proxy :: Proxy s)\n</code></pre>\n\n<p>Some auxiliary functions:</p>\n\n<pre><code>znToIntegral :: Integral a =&gt; Zn a s -&gt; a\nznToIntegral (Zn x) = fromIntegral x\n\n-- Convince the compiler that the phantom type in the proxy\n-- is the same as the one in the Zn\nlikeProxy :: Proxy s -&gt; Zn a s -&gt; Zn a s\nlikeProxy _ = id\n\nwithZn :: Integral a =&gt; a -&gt; (forall s. Reifies s a =&gt; Zn a s) -&gt; a\nwithZn p z = reify p $ \\proxy -&gt; znToIntegral . likeProxy proxy $ z \n</code></pre>\n\n<p>An example of use:</p>\n\n<pre><code>main :: IO ()\nmain = print $ withZn (7::Int) (Zn 3 + Zn 5)\n</code></pre>\n\n<p><code>withZn</code> works also from ghci.</p>\n"}], "owner": {"reputation": 91, "user_id": 2921585, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DjRye.jpg?s=128&g=1", "display_name": "hatgirl", "link": "https://stackoverflow.com/users/2921585/hatgirl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 31441037, "answer_count": 2, "score": 2, "last_activity_date": 1436999365, "creation_date": 1436976632, "question_id": 31435668, "link": "https://stackoverflow.com/questions/31435668/cant-show-due-to-ambiguous-type-while-using-data-reflection-in-haskell", "title": "Can&#39;t show due to ambiguous type while using Data.Reflection in Haskell", "body": "<p>I'm very new to Haskell and am trying to create a type that will represent any instance of Integral over some modulus. I found <a href=\"http://permalink.gmane.org/gmane.comp.lang.haskell.cafe/101430\" rel=\"nofollow\">some example code online</a> and am working with that, so my type definition looks like this:</p>\n\n<pre><code>data Zn n a = Zn !a !a\n</code></pre>\n\n<p>Most things are working as I'd like; I can show, add, subtract, etc. </p>\n\n<pre><code>instance (Integral a, Show a) =&gt; Show (Zn n a) where\n   show (Zn n x) = printf \"(%s mod %s)\" (show (mod x n)) (show n)\n\ninstance (Integral a, Reifies n a) =&gt; Num (Zn n a) where\n  Zn n x + Zn _ y = Zn n (mod (x + y) n)\n  Zn n x - Zn _ y = Zn n (mod (x - y) n)\n  Zn n x * Zn _ y = Zn n (mod (x * y) n)\n  negate (Zn n x) = Zn n (n - x)\n  abs = id\n  signum x@(Zn _ 0) = x\n  signum (Zn n _) = Zn n 1\n  fromInteger x = Zn n (mod (fromInteger x) n)\n    where n = reflect (Proxy :: Proxy n)\n\n\nznToIntegral :: Integral a =&gt; Zn n a -&gt; a\nznToIntegral (Zn n x) = fromIntegral x\n</code></pre>\n\n<p>However, I can't show the results of arithmetic operations on these types. For example, in GHCi:</p>\n\n<pre><code>*Main&gt; let x = Zn 5 3\n*Main&gt; x\n(3 mod 5)\n*Main&gt; let y = Zn 5 7\n(2 mod 5)\n*Main&gt; let z = x + y\n*Main&gt; z\n&lt;interactive&gt;:6:1:\n    No instance for (Integral a0) arising from a use of \u2018print\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Integral GHC.Int.Int16 -- Defined in \u2018GHC.Int\u2019\n      instance Integral GHC.Int.Int32 -- Defined in \u2018GHC.Int\u2019\n      instance Integral GHC.Int.Int64 -- Defined in \u2018GHC.Int\u2019\n      ...plus 9 others\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I've found this issue has come up in a number of other ways that I've tried to implement these numbers, and understanding how the Data.Reflection package works is giving me some troubles. I'd also be curious about any other implementations that seem more natural to others. I had originally tried doing something like</p>\n\n<pre><code>newtype Zn n a = Zn a\n</code></pre>\n\n<p>and switched because I thought that it would simplify things, which it hasn't in particular. Cheers! </p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436969121, "post_id": 31432515, "comment_id": 50835702, "body": "I did see that and have tried building the <code>bench</code> directory both from itself and from its parent. Error is shown in update"}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 1, "creation_date": 1436970013, "post_id": 31432515, "comment_id": 50836399, "body": "It&#39;s likely that the benchmarks won&#39;t run. The <code>bench</code> directory has not been updated for two years. It looks like it was tested with GHC 7.0.3 and Criterion 0.5. Current versions are GHC 7.10.1 and Criterion 1.1.0.0. I would <a href=\"https://github.com/haskell/bytestring/issues/new\" rel=\"nofollow noreferrer\">open an issue against ByteString</a> if you want to run the benchmarks."}], "tags": [], "owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "is_accepted": true, "score": 2, "last_activity_date": 1436968722, "creation_date": 1436968722, "answer_id": 31432515, "question_id": 31431798, "link": "https://stackoverflow.com/questions/31431798/cabal-benchmark-bytestring-package-has-no-benchmark/31432515#31432515", "title": "cabal benchmark bytestring: package has no benchmark", "body": "<p>The <code>bench</code> directory has a separate Cabal file, <a href=\"https://github.com/haskell/bytestring/blob/0.10.6.0/bench/bench-bytestring.cabal\" rel=\"nofollow\"><code>bench-bytestring.cabal</code></a>. You should be able to <code>cd</code> into that directory and do <code>cabal run</code> to run the benchmarks.</p>\n\n<p>That package's description explains why it works this way:</p>\n\n<blockquote>\n  <p>This package is not meant for public release. It fixes a problem with the current benchmarking support in cabal, which has trouble compiling because criterion depends on bytestring. Here, we just include the whole source of the bytestring library directly.</p>\n</blockquote>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 31432515, "answer_count": 1, "score": 1, "last_activity_date": 1436969030, "creation_date": 1436966971, "last_edit_date": 1436969030, "question_id": 31431798, "link": "https://stackoverflow.com/questions/31431798/cabal-benchmark-bytestring-package-has-no-benchmark", "title": "cabal benchmark bytestring: package has no benchmark", "body": "<p>When I tried to run <code>cabal benchmark</code> on <a href=\"https://github.com/haskell/bytestring\" rel=\"nofollow\">bytestring</a> I got <code>package has no benchmark</code>. Indeed, the <code>.cabal</code> file does not have benchmark configs. But the repo does have a bench directory. How does this work? Should I not try to benchmark it? </p>\n\n<p>edit: </p>\n\n<p>When running <code>cabal build</code> in the <code>bench</code> directory I got the following error: </p>\n\n<pre><code>Building bench-bytestring-0.1.0.0...\nPreprocessing executable 'bench-bytestring-builder' for\nbench-bytestring-0.1.0.0...\n[18 of 18] Compiling Main ( BenchAll.hs, dist/build/bench-bytestring-builder/bench-bytestring-builder-tmp/Main.o )\n\nBenchAll.hs:133:46:\nCouldn't match expected type \u2018Benchmarkable\u2019\n            with actual type \u2018IO ()\u2019\nIn the second argument of \u2018($)\u2019, namely \u2018benchIntEncodingB nRepl e\u2019\nIn the expression:\n  bench (name ++ \" (\" ++ show nRepl ++ \")\")\n  $ benchIntEncodingB nRepl e\n</code></pre>\n"}, {"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1436979423, "post_id": 31431607, "comment_id": 50842904, "body": "I suppose <code>intList</code> is going to be persisted in as SQL table, as a field of a record. If this is correct, this effectively breaks 1NF and SQL queries won&#39;t support it. I can imagine that objects are serialized for storage using <code>show</code>, so you&#39;ll end up with <code>[1, 2, 3]</code> which you could look up for individual elements as a string using <code>LIKE</code>, albeit inefficiently."}, {"owner": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437000883, "post_id": 31431607, "comment_id": 50854224, "body": "It&#39;s serialized as a varchar &quot;[1,2,3]&quot;. Yes, <code>LIKE</code> comes to mind but it&#39;s rather inelegant if I need to drop down to raw SQL to perform a query on something defined in Haskell."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437012620, "post_id": 31431607, "comment_id": 50857456, "body": "I&#39;d rather add a 1:N table and made an extra join, operating in a well-understood 2NF/3NF relational world."}], "owner": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1436966487, "creation_date": 1436966487, "question_id": 31431607, "link": "https://stackoverflow.com/questions/31431607/querying-content-of-data-persist-list", "title": "Querying content of Data.Persist list", "body": "<p>I can define a model like this:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nModel\n  intList [Int]\n|]\n</code></pre>\n\n<p>Is there a way to run a <code>selectList</code> such that it would return a collection of models that contain a given value? For example, if I insert:</p>\n\n<pre><code>m1 &lt;- insert $ Model [1,2,3]\nm2 &lt;- insert $ Model [3,4,5]\nm3 &lt;- insert $ Model [5,6,7]\n</code></pre>\n\n<p>I would like to run a query to return all records that contain <code>3</code> in their <code>intList</code>, that is <code>m1</code> and <code>m2</code>.</p>\n"}, {"tags": ["json", "rest", "haskell", "persistent"], "comments": [{"owner": {"reputation": 193, "user_id": 2976249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637930bba1a0591613b72bfee4c8fc2a?s=128&d=identicon&r=PG&f=1", "display_name": "dganti", "link": "https://stackoverflow.com/users/2976249/dganti"}, "edited": false, "score": 0, "creation_date": 1436974826, "post_id": 31431512, "comment_id": 50839945, "body": "Each entity has a &lt;EntityName&gt;Id field that can be used to persist. I have found using unique constraints to help me query the underlying entitiy. One could also use uuid as columns to generate a unique entity for subsequent use. Also, in persistent Entity json will serialize and deserialize <a href=\"https://github.com/yesodweb/persistent/wiki/Persistent-entity-syntax\" rel=\"nofollow noreferrer\">json objects</a>"}, {"owner": {"reputation": 193, "user_id": 2976249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637930bba1a0591613b72bfee4c8fc2a?s=128&d=identicon&r=PG&f=1", "display_name": "dganti", "link": "https://stackoverflow.com/users/2976249/dganti"}, "edited": false, "score": 0, "creation_date": 1436975662, "post_id": 31431512, "comment_id": 50840577, "body": "To add a single problem with multiple solutions in a single call, this example should <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">help</a>"}], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1436966226, "creation_date": 1436966226, "question_id": 31431512, "link": "https://stackoverflow.com/questions/31431512/retrieve-and-create-persistent-entities-with-relations-using-json", "title": "Retrieve and create Persistent entities with relations using JSON", "body": "<p>Haskell <code>persistent</code> library allows me to create entities with relations. I would like to be able to get entities (and also create them) using REST JSON calls. But I don't seem to understand how to approach the problem of combining a resulting entity when it is split amongst tables or how to split it when I need to save it (so that the needed parts are saved into needed tables).</p>\n\n<p>An example:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nProblem\n  name T.Text\n  description T.Text\nSolution\n  problemId ProblemId\n  author T.Text\n  solution T.Text\n|]\n</code></pre>\n\n<p>So, let's say we have a single problem and multiple solutions to it. How can I get a combined information (which is a problem with all related solutions). Do I need to create a data type which could look something like this:</p>\n\n<pre><code>data Solution =\n  Solution { author :: T.Text\n           , solution :: T.Text\n           }\n\ndata Problem =\n  Problem { name :: T.Text\n          , description :: T.Text\n          , solutions :: [Solution]\n          }\n</code></pre>\n\n<p>... and then define <code>toJSON</code>, so that I can send it to the caller? Or is there some other approach?</p>\n\n<p>And what about creating entries in DB when I want to add a problem with several solutions (from a single REST call). How would that look like?</p>\n\n<p>I hope I explained my problem correctly and you understand what I am struggling with.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["java", "haskell", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1436959628, "post_id": 31429065, "comment_id": 50828566, "body": "It seems like this forces me to put the behaviour <i>inside</i> the <code>Mode</code> implementations, is that correct? What if I have various code paths that want to do different things based on the mode? In fact, this is part of a library, so users of the library need to be able to add their own behaviours for different modes."}, {"owner": {"reputation": 1366, "user_id": 3314423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1dcc9420e3a196fd77c68649f5a313e?s=128&d=identicon&r=PG&f=1", "display_name": "xp500", "link": "https://stackoverflow.com/users/3314423/xp500"}, "reply_to_user": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1436960350, "post_id": 31429065, "comment_id": 50829024, "body": "@ChrisTaylor Java 8 supports passing functions as parameters. So instead of declaring a no-arg method. You can declare a function that receives the actual task to be done. So then <code>RealTime</code> will just call that function constantly and <code>Sampled</code> will call it every x seconds or whatever. Another approach could be declaring a couple of methods <code>ifRealTime(f)</code> and <code>ifSampled(f)</code> to the interface and in the concrete implementations, the <code>RealTime</code> will call the function in <code>ifRealTime</code> and do nothing in <code>ifSampled</code>. Hope I made myself clear"}, {"owner": {"reputation": 7920, "user_id": 4040817, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52cdc098ebfbeb386eb8cdf33d125aef?s=128&d=identicon&r=PG&f=1", "display_name": "Little Santi", "link": "https://stackoverflow.com/users/4040817/little-santi"}, "edited": false, "score": 0, "creation_date": 1436960605, "post_id": 31429065, "comment_id": 50829192, "body": "The principle of <i>abstraction</i> is to design an interface (or abstract class) which encapsulates completely all possible behaviours concerning a funcionality. So, if there are several points in your code that depend on how is this funcionality implemented, each one of them deserves a proper <i>method</i> in that interface."}], "tags": [], "owner": {"reputation": 1366, "user_id": 3314423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1dcc9420e3a196fd77c68649f5a313e?s=128&d=identicon&r=PG&f=1", "display_name": "xp500", "link": "https://stackoverflow.com/users/3314423/xp500"}, "is_accepted": false, "score": 2, "last_activity_date": 1436959438, "creation_date": 1436959438, "answer_id": 31429065, "question_id": 31428870, "link": "https://stackoverflow.com/questions/31428870/simulating-adts-in-java/31429065#31429065", "title": "Simulating ADTs in Java", "body": "<p>You can declare an interface <code>Mode</code></p>\n\n<pre><code>public interface Mode {\n    void doSmth();\n}\n</code></pre>\n\n<p>And then you can have two classes implementing that interface</p>\n\n<pre><code>public class Realtime implements Mode {\n    @Override\n    public void doSmth() {\n        // Do realtime stuff\n    }\n}\n\npublic class Sampled implements Mode {\n    private final int interval;\n\n    public Sampled(final int interval) {\n        this.interval = interval;\n    }\n\n    @Override\n    public void doSmth() {\n        // Do sampled stuff\n    }\n}\n</code></pre>\n\n<p>Then you declare a variable of type <code>Mode</code></p>\n\n<pre><code>final Mode mode = ... // Initialize however you want, calling one of the constructors.\n</code></pre>\n\n<p>And then, since <code>mode</code> is of type <code>Mode</code>, you will only be able to access what's declared in the interface. So you can just call <code>mode.doSmth()</code> and, depending on how you initialized <code>mode</code>, it will run realtime or sampled.</p>\n\n<p>If the classes share some code, then you can declare an <code>abstract</code> class instead of an <code>interface</code>, and have both classes <code>extend</code> that class. So then they can call the common methods that are declared in the <code>abstract</code> class (which should be declared with <code>protected</code> visibility, so that only subclasses can see them)</p>\n"}, {"comments": [{"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1436961676, "post_id": 31429384, "comment_id": 50829891, "body": "This doesn&#39;t cover how one could define arbitrary functions by case analysis on <code>Mode</code>s, without modifying the <code>Mode</code>s themselves. Which is the whole point to <a href=\"https://en.wikipedia.org/wiki/Algebraic_data_type\" rel=\"nofollow noreferrer\">algebraic data types</a>."}, {"owner": {"reputation": 7920, "user_id": 4040817, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52cdc098ebfbeb386eb8cdf33d125aef?s=128&d=identicon&r=PG&f=1", "display_name": "Little Santi", "link": "https://stackoverflow.com/users/4040817/little-santi"}, "reply_to_user": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1436966363, "post_id": 31429384, "comment_id": 50833423, "body": "Yes, you are right: That is because I preferred to focus on the abstraction pattern. For that matter, the visitor pattern you have proposed is a good choice, and also the listener pattern."}], "tags": [], "owner": {"reputation": 7920, "user_id": 4040817, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52cdc098ebfbeb386eb8cdf33d125aef?s=128&d=identicon&r=PG&f=1", "display_name": "Little Santi", "link": "https://stackoverflow.com/users/4040817/little-santi"}, "is_accepted": false, "score": 0, "last_activity_date": 1436960381, "creation_date": 1436960381, "answer_id": 31429384, "question_id": 31428870, "link": "https://stackoverflow.com/questions/31428870/simulating-adts-in-java/31429384#31429384", "title": "Simulating ADTs in Java", "body": "<p>Yes, of corse it is possible, altough it dependes on the level of complexity you are ready to achieve.</p>\n\n<p>If you want to achieve the highest level of type-safeness, I recommend you to declare an <em>abstraction</em> (named <code>AbstractModeManager</code>) which responsibility will be to query the state of the world and store it in instance variables, which should be accesible through public getter methods. And it must also know when there has been an update:</p>\n\n<pre><code>abstract class AbstractModeManager\n{\n    // Instance variables to contain the last state read.\n    private ... state;\n\n    protected void queryTheStateOfTheWorld(...) throws ...\n    {\n        ... fill this.state ...\n    }\n\n    public ... getState()\n    {\n        return this.state;\n    }\n\n    public abstract void updateOccurred(...);\n}\n</code></pre>\n\n<p>Under that, you must code two implementations: One for the real time, and another for the sampled:</p>\n\n<pre><code>class RealTimeModeManager extends AbstractModeManager\n{\n    public void updateOccurred(...)\n    {\n        // In this implementation, every time there has been an update, \n        // a query must be performed:\n        queryTheStateOfTheWorld(...);\n    }\n}\n\nclass SampledModeManager extends AbstractModeManager\n{\n    public SampledModeManager(int interval)\n    {\n        ... program a timer to call the queryTheStateOfTheWorld ...\n    }\n\n    public void updateOccurred(...)\n    {\n        // Do nothing.\n    }\n}\n</code></pre>\n\n<p>And last, you have to decide which of them must be used in each case, store it in a variable:</p>\n\n<pre><code>private AbstractModeManager mode=...\n</code></pre>\n\n<p>... And invoke <em>systematically</em> it at every update in the system:</p>\n\n<pre><code>mode.updateOccurred(...)\n</code></pre>\n\n<p>In this way, after initializing that variable, you won't care which mode the system is running: That behaviour is left to your <em>abstraction</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1436973230, "post_id": 31429621, "comment_id": 50838787, "body": "Thanks, this looks like the best way to go. Can we avoid defining the <code>ModeVisitor</code> class in Java 8 by using lambdas instead (eg <code>public &lt;T&gt; accept(Function&lt;Mode, T&gt; visitor)</code>) or do you lose something by doing that?"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1436973863, "post_id": 31429621, "comment_id": 50839225, "body": "@ChrisTaylor: You need the visitor, because the <code>visit</code> method itself is overloaded, and each <code>Mode</code> subclass has to select its corresponding overload."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1436974932, "post_id": 31429621, "comment_id": 50840027, "body": "@ChrisTaylor: A concrete visitor actually can be thought as a package containing <i>several</i> lambdas: one for each ADT variant. Visitors are analogous to the result of applying the <code>maybe</code> and <code>either</code> functions (from Haskell&#39;s standard library) to two arguments: <code>maybe foo bar</code> will use <code>foo</code> to visit <code>Nothing</code> and <code>bar</code> to visit <code>Just x</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1436978189, "post_id": 31429621, "comment_id": 50842143, "body": "Church encoding is just a hack for those, who don&#39;t have adequate mechanism for defining data types, because primitive recursion is <a href=\"http://www.sciencedirect.com/science/article/pii/0304397591900395\" rel=\"nofollow noreferrer\">too weak</a>. ADTs are OK, everything that resembles Scott encoding (paramorphisms, dependent eliminators, Scott encoding itself) is OK, Church encoding is not OK."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436978593, "post_id": 31429621, "comment_id": 50842367, "body": "@user3237465: I don&#39;t disagree that Church encodings are a hack. But, does Java give you anything better for this situation?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1436980295, "post_id": 31429621, "comment_id": 50843408, "body": "@Eduardo Le&#243;n, I don&#39;t know Java, so I can&#39;t tell. But I feel like you use Scott encoding actually. In the <code>data Mode = RealTime | Sampled Int</code> case these two are equivalent, but the encodings differ for recursive data types. Church-encoded lists are <code>newtype Church a = Church { runChurch :: forall r. (a -&gt; r       -&gt; r) -&gt; r -&gt; r }</code>, Scott-encoded lists are <code>newtype Scott  a = Scott  { runScott  :: forall r. (a -&gt; Scott a -&gt; r) -&gt; r -&gt; r }</code>. Am I right, that you use the second representation?"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436980597, "post_id": 31429621, "comment_id": 50843593, "body": "@user3237465: Let me see if I understand correctly. The Scott encoding ensures that the tail is also a Scott-encoded list, right? (By the way, if you&#39;re on Freenode, we can continue the discussion there. My nick is pyon, and I&#39;m in #haskell.)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436981377, "post_id": 31429621, "comment_id": 50844044, "body": "@Eduardo Le&#243;n, yes the tail of a Scott-encoded list is also a Scott-encoded list. I don&#39;t know what Freenode is, but we can go to <a href=\"http://chat.stackoverflow.com/rooms/139/java\">the Java chat</a> at stackoverflow."}], "tags": [], "owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "is_accepted": true, "score": 9, "last_activity_date": 1461601765, "last_edit_date": 1461601765, "creation_date": 1436961113, "answer_id": 31429621, "question_id": 31428870, "link": "https://stackoverflow.com/questions/31428870/simulating-adts-in-java/31429621#31429621", "title": "Simulating ADTs in Java", "body": "<p>The traditional way to emulate closed algebraic data types in a language like Java that only provides open classes (that can be inherited anytime) in a type-safe way is the <a href=\"https://en.wikipedia.org/wiki/Visitor_pattern\" rel=\"nofollow\">Visitor pattern</a>:</p>\n\n<pre><code>abstract class Mode {\n    public abstract &lt;T&gt; T accept(ModeVisitor&lt;T&gt; visitor);\n}\n\nfinal class RealTime extends Mode {\n    public RealTime() {}\n\n    public &lt;T&gt; T accept(ModeVisitor&lt;T&gt; visitor) {\n        return visitor.visit(this);\n    }\n}\n\nfinal class Sampled extends Mode {\n    private final int interval;\n\n    public Sampled(int interval) {\n        this.interval = interval;\n    }\n\n    public int getInterval() {\n        return this.interval;\n    }\n\n    public &lt;T&gt; T accept(ModeVisitor&lt;T&gt; visitor) {\n        return visitor.visit(this);\n    }\n}\n\n// The recursion principle itself\nabstract class ModeVisitor&lt;T&gt; {\n    public abstract T visit(RealTime mode);\n    public abstract T visit(Sampled mode);\n}\n\n// Concrete uses of the recursion principle\nfinal class ModeShow extends ModeVisitor&lt;String&gt; {\n    private ModeShow() {}\n\n    public static String show(Mode mode) {\n        return mode.accept(new ModeShow());\n    }\n\n    public String visit(RealTime mode) {\n        return \"RealTime\";\n    }\n\n    public String visit(Sampled mode) {\n        return \"Sampled \" + mode.getInterval();\n    }\n}\n</code></pre>\n\n<p>As @user3237465 remarked, several encodings of data types are possible, which <em>happen</em> to coincide when the data type isn't recursive: The Church encoding is a fold: it allows you to accumulate a value by recursion over the Church-encoded datatype. The Scott encoding corresponds to actual pattern matching. In any case, visitors can be used to implement all of these encodings. Thanks for the nudge, @user3237465!</p>\n"}], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 2, "accepted_answer_id": 31429621, "answer_count": 3, "score": 9, "last_activity_date": 1461601765, "creation_date": 1436958883, "question_id": 31428870, "link": "https://stackoverflow.com/questions/31428870/simulating-adts-in-java", "title": "Simulating ADTs in Java", "body": "<p>\nAn application may operate in two modes - \"real time\" where it looks at every update to the state of the world, or \"sampled\" where it only looks at the state of the world every T milliseconds.</p>\n\n<p>If I were writing Haskell (or any language with ADTs) I would model this as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Mode = RealTime | Sampled Int\n</code></pre>\n\n<p>which can be used as follows in a type-safe way</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>case mode of\n    RealTime         -&gt; -- do realtime stuff\n    Sampled interval -&gt; -- do sample stuff with 'interval'\n</code></pre>\n\n<p>I say that it is \"type-safe\" because if you are running in real-time mode, you are prevented from trying to access the <code>interval</code> field (which is provided at just the time you need it if you are operating in sampled mode).</p>\n\n<p>How can I model the same thing in Java in a type-safe way? That is, I want</p>\n\n<ul>\n<li>To define a class (or enum) that distinguishes between the two modes, and</li>\n<li>To prohibit access to the <code>interval</code> field when in real-time mode, and</li>\n<li>To have all of this checked by the compiler.</li>\n</ul>\n\n<p>Is this possible in Java? If not, what is the idiomatic way to achieve this kind of type-safety?</p>\n"}, {"tags": ["haskell", "xml-conduit"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436981327, "post_id": 31425811, "comment_id": 50844018, "body": "Can you supply an example of your HTML input?"}, {"owner": {"reputation": 1, "user_id": 5118513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irLnS.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5118513/tom"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1437039645, "post_id": 31425811, "comment_id": 50868923, "body": "I am loading a Utf8 encoded local file. i would like all the ancestors of the elements in the &lt;ol&gt; element to be &quot;collapsed&quot; and stored as Text with their tags, and the special characters therein, retained and stored as Text. In fact I noticed, I made a mistake above. following example html:  <code>&lt;ol&gt;    &lt;li&gt; Hi there &lt;i&gt; user05402 &lt;&#47;i&gt; &lt;&#47;li&gt; &lt;&#47;ol&gt;</code>  should be  ` &quot;&lt;li&gt; Hi there &lt;i&gt; user05402 &lt;/i&gt; &lt;/li&gt;&quot; :: Text `"}, {"owner": {"reputation": 1, "user_id": 5118513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irLnS.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5118513/tom"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1437040196, "post_id": 31425811, "comment_id": 50869299, "body": "(ran out of editing time, sorry)  Where as I am getting &quot;\\u003cli\\u003e Hi there \\u003ci\\u003euser05402\\u003e\\u003c/i\\u003e \\u003e\\u003c/li\\u003e&quot;  Also, special chars within the content, e.g. &quot;, are then turned into &amp;quot;"}], "owner": {"reputation": 1, "user_id": 5118513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irLnS.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5118513/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437427769, "creation_date": 1436950624, "last_edit_date": 1437427769, "question_id": 31425811, "link": "https://stackoverflow.com/questions/31425811/how-can-i-extract-the-tags-and-content-of-children-using-xml-conduit", "title": "How can I extract the tags and content of children using xml-conduit?", "body": "<p><strong>UPDATE: After many different attempts I have for now concluded that the behaviour seen below is expected and that I am only running into difficulties because I am using ToJson later on. Will update if I solve it completely.</strong></p>\n\n<p><strong>==============================================================</strong></p>\n\n<p>I am trying to use xml-conduit to achieve this: </p>\n\n<ul>\n<li>go down the cursor of a document to the  element of an html document. </li>\n<li>treat any descendants of this node as text. i.e. don't only get the content as text, but also the tags themselves. </li>\n</ul>\n\n<p>so for example, <strong>I edited this example as per my comments below</strong> </p>\n\n<blockquote>\n<pre><code>&lt;ol&gt; \n   &lt;li class=\"c1\"&gt; \n      this is really \"good work\" &lt;i&gt;John&lt;/i&gt;.\n   &lt;/li&gt;\n&lt;/ol&gt;\n</code></pre>\n</blockquote>\n\n<p>should return </p>\n\n<blockquote>\n<pre><code>\"&lt;li class=\"c1\"&gt; this is really \"good work\" &lt;i&gt;John&lt;/i&gt; &lt;/li&gt;\" \n</code></pre>\n</blockquote>\n\n<p>Whereas I'm getting </p>\n\n<blockquote>\n  <p>\" \"\\u003cli class=\\\"c1\\\"\\u003e this is really &quot;good work&quot;\\u003ci\\u003eJohn\\u003c/i\\u003e\\u003c/li\\u003e</p>\n</blockquote>\n\n<p>So there is something going on within the tags that is different from what is happening to the content. I think perhaps the ToHtml instance isnt quite what i want really. I just want to <em>collapse</em> all descendants, turn their tags and content into text. I can't find a way though.</p>\n\n<pre><code>import Text.Blaze.Html                           (toHtml, preEscapedToHtml)\nimport Text.Blaze.Html.Renderer.Utf8             (renderHtml)\n--import Text.Blaze.Html.Renderer.String           (renderHtml)\n--import Text.Blaze.Html.Renderer.Text             (renderHtml)\nimport           Data.Text.Encoding              (decodeUtf8)\nimport           Data.ByteString.Lazy            (toStrict)\n\n\nextractAllParas :: Cursor -&gt; [ Text ]\nextractAllParas c = do\n  let mt' = c $/ laxElement \"body\"  &amp;// laxElement \"ol\" &amp;/ anyElement\n      mt =  (map (decodeUtf8 . toStrict . renderHtml . toHtml . node) $ mt')\n  case mt of\n    [ \"\" ] -&gt; []\n    paras -&gt; formatParas paras\n</code></pre>\n\n<p>formatParas :: [ Text ] -> [ Text ]</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436946623, "post_id": 31421237, "comment_id": 50820462, "body": "I&#39;d have used a guard: <code>Just (Just s) | not (null s) -&gt; Just s</code>."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436973924, "post_id": 31421237, "comment_id": 50839265, "body": "Although yours is not the case, it is good to know such pattern can <a href=\"http://stackoverflow.com/questions/15627849/turn-off-lazy-evaluation-in-haskell\">force strictness</a> (see Daniel Wagner&#39;s comment under the first answer)."}], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "is_accepted": true, "score": 11, "last_activity_date": 1507011692, "last_edit_date": 1507011692, "creation_date": 1436933693, "answer_id": 31421393, "question_id": 31421237, "link": "https://stackoverflow.com/questions/31421237/how-does-it-work-in-pattern-matching/31421393#31421393", "title": "@(_:_), how does it work in pattern matching", "body": "<p><code>_</code> is a wildcard. It says make sure there is a value here but I don't want to bind it to any variable. <code>:</code> is the constructor for a list. On the left is one value and the right is the rest of the list. The rest of the list can be empty. So if you do something like this:</p>\n\n<pre><code>(x:xs)\n</code></pre>\n\n<p>x is the first element of the list and xs can be an empty list or it can be an infinite amount of elements.</p>\n\n<pre><code>(x:y:xs)\n</code></pre>\n\n<p>Would only match lists with at least 2 elements. The <code>@</code> is the at pattern. It binds the entirety of the right expression to the left variable.</p>\n\n<pre><code>m@(Just _)\n</code></pre>\n\n<p>Here <code>m</code> would have the type <code>Maybe a</code>. The <code>_</code> is just used because <code>Just</code> is of type <code>a -&gt; Maybe a</code> and we need to have a placeholder for its argument. So <code>m</code> binds to the whole value of (Just _). In your example.</p>\n\n<pre><code>s@(_:_)\n</code></pre>\n\n<p><code>s</code> is the whole list. And <code>(_:_)</code> specifies that the list must have at least one element or the match will fail. If we wrote:</p>\n\n<pre><code>s@(x:xs)\n</code></pre>\n\n<p><code>x</code> would be the first element and <code>xs</code> would be the tail of the list. <code>s == x:xs</code> would return <code>True</code>. But since we don't need the head or the tail we simply use <code>_</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1436934921, "post_id": 31421486, "comment_id": 50815134, "body": "<code>Just (Just [6])</code> does match since <code>[6] = 6 : []</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1436935158, "last_edit_date": 1436935158, "creation_date": 1436934317, "answer_id": 31421486, "question_id": 31421237, "link": "https://stackoverflow.com/questions/31421237/how-does-it-work-in-pattern-matching/31421486#31421486", "title": "@(_:_), how does it work in pattern matching", "body": "<p>An explanation by examples...</p>\n\n<p>Let \"the pattern\" refer to <code>Just (Just s@(_:_))</code>. Below is a list of various values and whether or not those values match the pattern. If there is a match then <code>s</code> will be set to a part of the value and can be used on the RHS of the pattern guard.</p>\n\n<ol>\n<li><p>value = <code>Nothing</code> - does not match</p></li>\n<li><p>value = <code>Just Nothing</code> - does not match</p></li>\n<li><p>value = <code>Just (Just [])</code> - does not match</p></li>\n<li><p>value = <code>Just (Just [3,4,5])</code> - matches and <code>s = [3,4,5]</code></p></li>\n<li><p>value = <code>Just (Just [6])</code> - does match and <code>s = [6]</code></p></li>\n<li><p>value = <code>Just (Just [1,2])</code> - matches and <code>s = [1,2]</code></p></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 1, "accepted_answer_id": 31421393, "answer_count": 2, "score": 4, "last_activity_date": 1507011692, "creation_date": 1436932697, "question_id": 31421237, "link": "https://stackoverflow.com/questions/31421237/how-does-it-work-in-pattern-matching", "title": "@(_:_), how does it work in pattern matching", "body": "<p>This is an example taken from o' reilly - <a href=\"https://github.com/cyga/real-world-haskell/blob/master/ch15/MovieReview.hs#L34\" rel=\"nofollow\">real world haskell</a>.</p>\n\n<pre><code>maybeReview alist = do\n  title &lt;- lookup1 \"title\" alist\n  return (MovieReview title)'\n\nlookup1 key alist = case lookup key alist of\n                      Just (Just s@(_:_)) -&gt; Just s\n                      _ -&gt; Nothing\n</code></pre>\n\n<p>How does the <code>@</code> symbol work here in the line,</p>\n\n<pre><code>Just (Just s@(_:_)) -&gt; Just s\n</code></pre>\n\n<p>How does it match a non-empty value?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1436949490, "post_id": 31421624, "comment_id": 50822197, "body": "You can put it on the same line simply by adding brackets to the <code>let</code> as well: <code>do { let { a = 1 }; print a }</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436951402, "post_id": 31421624, "comment_id": 50823431, "body": "@DanielWagner Yep. <i>everything</i> in Haskell which requires line breaks or indentation can be considered syntactic sugar for appropriately placed <code>{ ; }</code> characters. (<i>Brace for counterexample</i>)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1436935093, "creation_date": 1436935093, "answer_id": 31421624, "question_id": 31420176, "link": "https://stackoverflow.com/questions/31420176/do-block-with-flower-brackets-in-ghci-throws-error/31421624#31421624", "title": "do block with flower brackets in ghci throws error", "body": "<p>Once you start a <code>let</code> statement, the rest of the line is considered to be additional <code>let</code> assignments. Consider this error message:</p>\n\n<pre><code>ghci&gt; do print 1; let c = 2; d = 3\n&lt;interactive&gt;:3:13:\n    The last statement in a 'do' block must be an expression\n      let c = 2\n          d = 3\n</code></pre>\n\n<p>Note that the <code>let</code> keyword is not needed for <code>d = 3</code>.</p>\n\n<p>To add a monadic statement after a <code>let</code> you'll need to put it on a separate line (with the correct indentation):</p>\n\n<pre><code>ghci&gt; :{\n    | do print 1; let a = 2; b = 3\n    |    print b\n    | :}\n1\n3\n</code></pre>\n\n<p>AFAIK, there is no way to put a monadic statement after a <code>let</code> on the same line.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 31421624, "answer_count": 1, "score": 2, "last_activity_date": 1436935093, "creation_date": 1436924921, "question_id": 31420176, "link": "https://stackoverflow.com/questions/31420176/do-block-with-flower-brackets-in-ghci-throws-error", "title": "do block with flower brackets in ghci throws error", "body": "<p>I have a code that works with print inside do block as,</p>\n\n<pre><code>do { print ([(n, 2^n) | n &lt;- [0..19]]) }\n</code></pre>\n\n<p>Then i tried a much simpler version to print a variable value,</p>\n\n<pre><code>do { let a = 1; print (a) }\n</code></pre>\n\n<p>It throws error as <code>parse error on input }</code></p>\n\n<p>What else, i tried with no success ---</p>\n\n<pre><code>ghci&gt; let a = 1; print (a)\n</code></pre>\n\n<p>And</p>\n\n<pre><code>ghci&gt; :{\n    |  let a = 1;\n    |  print (a)\n    |  :}\n</code></pre>\n"}, {"tags": ["file", "haskell", "io", "path"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 5, "last_activity_date": 1436921567, "last_edit_date": 1436921567, "creation_date": 1436921253, "answer_id": 31419712, "question_id": 31419429, "link": "https://stackoverflow.com/questions/31419429/filter-a-list-of-paths-to-only-include-files/31419712#31419712", "title": "Filter a list of paths to only include files", "body": "<p>For Unix systems, the package <code>unix</code> exposes these API's:</p>\n\n<ul>\n<li><p><a href=\"https://hackage.haskell.org/package/unix-2.5.0.0/docs/System-Posix-Files.html#v:isRegularFile\" rel=\"noreferrer\">isRegularFile</a></p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/unix-2.5.0.0/docs/System-Posix-Files.html#v:isSymbolicLink\" rel=\"noreferrer\">isSymbolicLink</a></p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/unix-2.5.0.0/docs/System-Posix-Files.html#v:isDirectory\" rel=\"noreferrer\">isDirectory</a></p></li>\n</ul>\n\n<p>You can use the combination of them to achieve what you want. A sample demo of using them in GHCI:</p>\n\n<pre><code>\u03bb&gt; import System.Posix.Files\n\u03bb&gt; status &lt;- getFileStatus \"/home/sibi\"\n\u03bb&gt; isDirectory status\nTrue\n\u03bb&gt; isRegularFile status\nFalse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1436950883, "post_id": 31419717, "comment_id": 50823082, "body": "This is one heck of an answer. Well played."}, {"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 1, "creation_date": 1436984104, "post_id": 31419717, "comment_id": 50845711, "body": "While I appreciate your answer and effort, it doesn&#39;t seem to work! Try the edited code sample I just posted (or maybe just tell me what&#39;s wrong with it if I&#39;ve made an error)."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 1, "creation_date": 1436984117, "post_id": 31419717, "comment_id": 50845718, "body": "@Langston: Oh jeez, I&#39;ve run into that before, but I forgot!  <code>getDirectoryContents</code> returns paths that are <i>relative to its argument</i>; <code>doesDirectoryExist</code> treats paths as <i>relative to the current working directory</i>.  Sorry about that!  I&#39;ll add code to this answer which fixes that."}, {"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 0, "creation_date": 1436986307, "post_id": 31419717, "comment_id": 50846944, "body": "@AntalS-Z Please comment when you get the time to fix that, so I know :)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 1, "creation_date": 1436986707, "post_id": 31419717, "comment_id": 50847164, "body": "@Langston: Done, in a few different ways :-)  (Plus I correctly used <code>doesFileExist</code> instead of <code>doesDirectoryExist</code> \u2013 oops!)"}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 1, "creation_date": 1504531124, "post_id": 31419717, "comment_id": 79036069, "body": "<code>map (fp &lt;&#47;&gt;) . filter (`notElem` [&quot;.&quot;,&quot;..&quot;]) &lt;$&gt; getDirectoryContents fp</code> could be squashed to <code>map (fp &lt;&#47;&gt;) &lt;$&gt; listDirectory fp</code>.  See <a href=\"http://hackage.haskell.org/package/directory-1.3.1.1/docs/System-Directory.html#v:listDirectory\" rel=\"nofollow noreferrer\">System.Direcotry.listDirectory</a>"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 21, "last_activity_date": 1436986689, "last_edit_date": 1436986689, "creation_date": 1436921307, "answer_id": 31419717, "question_id": 31419429, "link": "https://stackoverflow.com/questions/31419429/filter-a-list-of-paths-to-only-include-files/31419717#31419717", "title": "Filter a list of paths to only include files", "body": "<p>To find standard library functions, <a href=\"https://www.haskell.org/hoogle/\" rel=\"noreferrer\">Hoogle</a> is a great resource; it's a Haskell search engine that lets you search <em>by type</em>.  Using it requires figuring out how to think about types the Haskell Way\u2122, though, which your proposed type signatures doesn't quite work with.  So:</p>\n\n<ol>\n<li><p>You're looking for <code>[Filepath] -&gt; [Filepath]</code>.  Remember, the Haskell spelling is <code>FilePath</code>.  So\u2026</p></li>\n<li><p>You're looking for <code>[FilePath] -&gt; [FilePath]</code>.  This is unnecessary; if you want to filter things, you should use <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:filter\" rel=\"noreferrer\"><code>filter</code></a>.  So\u2026</p></li>\n<li><p>You're looking for a function of type <code>FilePath -&gt; Bool</code> that you can pass to <code>filter</code>.  But this can't quite be right: this function needs to query the file system, which is an effect, and Haskell tracks effects in the type system using <code>IO</code>.  So\u2026</p></li>\n<li><p>You're looking for a function of type <code>FilePath -&gt; IO Bool</code>.</p></li>\n</ol>\n\n<p>And <a href=\"https://www.haskell.org/hoogle/?q=FilePath+-%3E+IO+Bool\" rel=\"noreferrer\">if we search for that on Hoogle</a>, the first result is <a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html#v:doesFileExist\" rel=\"noreferrer\"><code>doesFileExist :: FilePath -&gt; IO Bool</code></a> from <a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html\" rel=\"noreferrer\"><code>System.Directory</code></a>.  From the docs:</p>\n\n<blockquote>\n  <p>The operation <a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html#v:doesFileExist\" rel=\"noreferrer\"><code>doesFileExist</code></a> returns <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Data-Bool.html#v:True\" rel=\"noreferrer\"><code>True</code></a> if the argument file exists and is not a directory, and <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Data-Bool.html#v:False\" rel=\"noreferrer\"><code>False</code></a> otherwise.</p>\n</blockquote>\n\n<p>So <code>System.Directory.doesFileExist</code> is exactly what you want.  (Well\u2026 only with a little extra work!  See below.)</p>\n\n<p>Now, how do you use it?  You can't use <code>filter</code> here, because you have an effectful function.  You could use Hoogle again \u2013 if <code>filter</code> has the type <code>(a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, then annotating the results of the functions with a monad <code>m</code> gives you the new type <a href=\"https://www.haskell.org/hoogle/?q=Monad+m+%3D%3E+(a+-%3E+m+Bool)+-%3E+%5Ba%5D+-%3E+m+%5BBool%5D\" rel=\"noreferrer\"><code>Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [Bool]</code></a> \u2013 but there's an easier \"cheap trick\".  In general, if <code>func</code> is a function with an effectful/monadic version, that effectful/monadic version is called <code>funcM</code>, and it often lives in <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html\" rel=\"noreferrer\"><code>Control.Monad</code></a>.\u00b9  And indeed, there is a function <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:filterM\" rel=\"noreferrer\"><code>Control.Monad.filterM :: Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]</code></a>.</p>\n\n<p><em>However!</em>  Much as we hate to admit it, even in Haskell, types don't provide all the information you need.  Importantly, we're going to have a problem here:</p>\n\n<ul>\n<li>File paths given as arguments to functions are interpreted <em>relative to the current directory</em>, but\u2026</li>\n<li><a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html#v:getDirectoryContents\" rel=\"noreferrer\"><code>getDirectoryContents</code></a> returns paths <em>relative to its argument</em>.</li>\n</ul>\n\n<p>Thus, there are two approaches we can take to fix things.  The first is to adjust the results of <code>getDirectoryContents</code> so that they can be interpreted correctly.  (We also discarding the <code>.</code> and <code>..</code> results, although if you're just looking for regular files they won't hurt anything.)  This will return file names which include the directory whose contents are being examined.  The adjust <code>getDirectoryContents</code> function looks like this:</p>\n\n<pre><code>getQualifiedDirectoryContents :: FilePath -&gt; IO [FilePath]\ngetQualifiedDirectoryContents fp =\n    map (fp &lt;/&gt;) . filter (`notElem` [\".\",\"..\"]) &lt;$&gt; getDirectoryContents fp\n</code></pre>\n\n<p>The <code>filter</code> gets rid of the special directories, and the <code>map</code> prepends the argument directory to all the results.  This makes the returned files acceptable arguments to <code>doesFileExist</code>.  (If you haven't seen them before, <a href=\"http://hackage.haskell.org/package/filepath-1.4.0.0/docs/System-FilePath-Windows.html#v:-60--47--62-\" rel=\"noreferrer\"><code>(System.FilePath.&lt;/&gt;)</code></a> appends two file paths; and <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#v:-60--36--62-\" rel=\"noreferrer\"><code>(Control.Applicative.&lt;$&gt;)</code></a>, also available as <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"noreferrer\"><code>(Data.Functor.&lt;$&gt;)</code></a>, is an infix synonym for <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:fmap\" rel=\"noreferrer\"><code>fmap</code></a>, which is like <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:liftM\" rel=\"noreferrer\"><code>liftM</code></a> but more broadly applicable.)</p>\n\n<p>Putting that all together, your final code becomes:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport System.FilePath\nimport System.Directory\n\ngetQualifiedDirectoryContents :: FilePath -&gt; IO [FilePath]\ngetQualifiedDirectoryContents fp =\n    map (fp &lt;/&gt;) . filter (`notElem` [\".\",\"..\"]) &lt;$&gt; getDirectoryContents fp\n\nmain :: IO ()\nmain = do\n  contents  &lt;- getQualifiedDirectoryContents \"/foo/bar\"\n  onlyFiles &lt;- filterM doesFileExist contents\n  print onlyFiles\n</code></pre>\n\n<p>Or, if you feel like being fancy/point-free:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport System.FilePath\nimport System.Directory\n\ngetQualifiedDirectoryContents :: FilePath -&gt; IO [FilePath]\ngetQualifiedDirectoryContents fp =\n    map (fp &lt;/&gt;) . filter (`notElem` [\".\",\"..\"]) &lt;$&gt; getDirectoryContents fp\n\nmain :: IO ()\nmain =   print\n     =&lt;&lt; filterM doesFileExist\n     =&lt;&lt; getQualifiedDirectoryContents \"/foo/bar\"\n</code></pre>\n\n<p>The second approach is to adjust things so that <code>doesFileExist</code> runs with the appropriate current directory.  This will return just the file name relative to the directory whose contents are being examined.  To do this, we want to use the <a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html#v:withCurrentDirectory\" rel=\"noreferrer\"><code>withCurrentDirectory :: FilePath -&gt; IO a -&gt; IO a</code></a> function (but see below), and then pass <code>getDirectoryContents</code> the current directory <code>\".\"</code> argument.  The documentation for <code>withCurrentDirectory</code> says (in part):</p>\n\n<blockquote>\n  <p>Run an <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/System-IO.html#t:IO\" rel=\"noreferrer\"><code>IO</code></a> action with the given working directory and restore the original working directory afterwards, even if the given action fails due to an exception.</p>\n</blockquote>\n\n<p>Putting all this together gives us the following code</p>\n\n<pre><code>import Control.Monad\nimport System.Directory\n\nmain :: IO ()\nmain = withCurrentDirectory \"/foo/bar\" $\n         print =&lt;&lt; filterM doesFileExist =&lt;&lt; getDirectoryContents \".\"\n</code></pre>\n\n<p>This is what we want, but unfortunately, it's only available in version 1.3.2.0 of the <code>directory</code> package \u2013 as of this writing, the most recent one, and not the one I have.  Luckily, it's an easy function to implement; such set-a-value-locally functions are usually implemented in terms of <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception.html#v:bracket\" rel=\"noreferrer\"><code>Control.Exception.bracket :: IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c</code></a>.  The <code>bracket</code> function is run as <code>bracket before after action</code>, and it correctly handles exceptions.  So we can define <code>withCurrentDirectory</code> ourselves:</p>\n\n<pre><code>withCurrentDirectory :: FilePath -&gt; IO a -&gt; IO a\nwithCurrentDirectory fp m =\n  bracket getCurrentDirectory setCurrentDirectory $ \\_ -&gt; do\n    setCurrentDirectory fp\n    m\n</code></pre>\n\n<p>And then use this to get the final code:</p>\n\n<pre><code>import Control.Exception\nimport Control.Monad\nimport System.Directory\n\nwithCurrentDirectory :: FilePath -&gt; IO a -&gt; IO a\nwithCurrentDirectory fp m =\n  bracket getCurrentDirectory setCurrentDirectory $ \\_ -&gt; do\n    setCurrentDirectory fp\n    m\n\nmain :: IO ()\nmain = withCurrentDirectory \"/foo/bar\" $\n         print =&lt;&lt; filterM doesFileExist =&lt;&lt; getDirectoryContents \".\"\n</code></pre>\n\n<hr>\n\n<p>Also, one quick note about <code>let</code>s in <code>do</code>s: in a <code>do</code> block,</p>\n\n<pre><code>do ...foo...\n   let x = ...bar...\n   ...baz...\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>do ...foo...\n   let x = ...bar... in\n     do ...baz...\n</code></pre>\n\n<p>So your example code doesn't need the <code>in</code> in the <code>let</code> and can outdent the <code>print</code> call.</p>\n\n<hr>\n\n<p>\u00b9 Not always: sometimes you want different classes of effects!  Use <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#t:Applicative\" rel=\"noreferrer\"><code>Applicative</code></a> from <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html\" rel=\"noreferrer\"><code>Control.Applicative</code></a> when possible; more things are <code>Applicative</code>s than are <code>Monad</code>s (although this means you can do less with them).  In that case, the effectful functions may live there, or also in <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Foldable.html\" rel=\"noreferrer\"><code>Data.Foldable</code></a> or <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Traversable.html\" rel=\"noreferrer\"><code>Data.Traversable</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5116653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b493949531b107287176c04b282c5dc?s=128&d=identicon&r=PG&f=1", "display_name": "anton-k", "link": "https://stackoverflow.com/users/5116653/anton-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1436996168, "creation_date": 1436996168, "answer_id": 31441577, "question_id": 31419429, "link": "https://stackoverflow.com/questions/31419429/filter-a-list-of-paths-to-only-include-files/31441577#31441577", "title": "Filter a list of paths to only include files", "body": "<p>You can use a library <a href=\"https://hackage.haskell.org/package/shelly\" rel=\"nofollow\">shelly</a>. It's dedicated to do a shell scripting with Haskell. Here is the solution with shelly:</p>\n\n<pre><code>module Sh where\n\nimport Control.Monad\nimport Data.String \n\nimport Shelly\n\ndir = fromString \"/home/me\"\n\nprintAll = mapM_ print\n\nmain = do\n    files &lt;- shelly $ filterM test_f =&lt;&lt; ls dir\n    printAll files\n</code></pre>\n\n<p>We use the functions: </p>\n\n<p>ls - for listing the directory content.</p>\n\n<pre><code>ls :: FilePath -&gt; Sh [FilePath]\n</code></pre>\n\n<p>test_f - for testing if the directory is a file:</p>\n\n<pre><code>test_f :: FilePath -&gt; Sh Bool\n</code></pre>\n\n<p>shelly - to execute the script:</p>\n\n<pre><code>shelly :: MonadIO m =&gt; Sh a -&gt; m a\n</code></pre>\n\n<p>also we use fromString to create a shelly's FilePath. There is a dedicated type it's not just a string.</p>\n"}, {"tags": [], "owner": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "is_accepted": false, "score": 1, "last_activity_date": 1516936499, "creation_date": 1516936499, "answer_id": 48455309, "question_id": 31419429, "link": "https://stackoverflow.com/questions/31419429/filter-a-list-of-paths-to-only-include-files/48455309#48455309", "title": "Filter a list of paths to only include files", "body": "<p>I happened to need a way to list only regular files in a directory, and this is how I do it. I thought it might be helpful:</p>\n\n<pre><code>import System.Directory\n\nlistFilesInDirectory :: FilePath -&gt; IO [FilePath]\nlistFilesInDirectory dir = do\n    rawList &lt;- listDirectory dir\n    filterM doesFileExist (map (dir &lt;/&gt;) rawList)\n</code></pre>\n"}], "owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2162, "favorite_count": 3, "accepted_answer_id": 31419717, "answer_count": 4, "score": 11, "last_activity_date": 1516936499, "creation_date": 1436918998, "last_edit_date": 1501964415, "question_id": 31419429, "link": "https://stackoverflow.com/questions/31419429/filter-a-list-of-paths-to-only-include-files", "title": "Filter a list of paths to only include files", "body": "<p>If I have a list of <code>FilePaths</code>, how can I filter them to return only the ones that are regular files (namely, not symlinks or directories)? </p>\n\n<p>For example, using <code>getDirectoryContents</code></p>\n\n<pre><code>main = do\n    contents &lt;- getDirectoryContents \"/foo/bar\"\n    let onlyFiles = filterFunction contents in\n        print onlyFiles\n</code></pre>\n\n<p>where \"filterFunction\" is a function that returns only the <code>FilePaths</code> that represent files.</p>\n\n<p>The answer may just work on Linux, but cross platform support is preferred. </p>\n\n<p>[EDIT] Just using doesDirectoryExist doesn't work as expected. This script prints a list of everything in the directory, not just files:</p>\n\n<pre><code>module Main where\n\nimport System.Directory\nimport Control.Monad (filterM, liftM)\n\ngetFiles :: FilePath -&gt; IO [FilePath]\ngetFiles root = do\n    contents &lt;- getDirectoryContents root\n    filesHere &lt;- filterM (liftM not . doesDirectoryExist) contents\n    subdirs &lt;- filterM doesDirectoryExist contents\n    return filesHere\n\nmain = do\n    files &lt;- getFiles \"/\"\n    print $ files\n</code></pre>\n\n<p>Additionally, the variable subdirs will only contain <code>\".\"</code> and <code>\"..\"</code>.</p>\n"}, {"tags": ["c++", "haskell", "dll"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1436904087, "post_id": 31416185, "comment_id": 50805061, "body": "<i>&quot;What could be going wrong here?&quot;</i> Too many things to give you a concise answer."}, {"owner": {"reputation": 112, "user_id": 4243160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e79370ec0f5fc4c9f638acfa3f84d77?s=128&d=identicon&r=PG&f=1", "display_name": "userNishant", "link": "https://stackoverflow.com/users/4243160/usernishant"}, "edited": false, "score": 0, "creation_date": 1437116209, "post_id": 31416185, "comment_id": 50905732, "body": "copy your dll file into system32 directory of windows and then try."}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "reply_to_user": {"reputation": 112, "user_id": 4243160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e79370ec0f5fc4c9f638acfa3f84d77?s=128&d=identicon&r=PG&f=1", "display_name": "userNishant", "link": "https://stackoverflow.com/users/4243160/usernishant"}, "edited": false, "score": 0, "creation_date": 1437141126, "post_id": 31416185, "comment_id": 50919971, "body": "@userNishant This is part of an application that will be distributed to customers and installed on their computers. There\u2019s no way I\u2019m installing anything in system32."}], "answers": [{"comments": [{"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 0, "creation_date": 1437141079, "post_id": 31473693, "comment_id": 50919940, "body": "Yes, I use a .def file to define the exports from SpectrumMath.dll and I have verified (with Dependency Walker) that the expected functions are visible."}, {"owner": {"reputation": 7948, "user_id": 4899330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/857a19fa016a8fc6c0a3250f03f108a9?s=128&d=identicon&r=PG&f=1", "display_name": "doqtor", "link": "https://stackoverflow.com/users/4899330/doqtor"}, "reply_to_user": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 0, "creation_date": 1437229747, "post_id": 31473693, "comment_id": 50947767, "body": "@bdesham In dependency walker there is one panel showing dll exports and another what exe is importing, it&#39;s easy to get confused by this, did you check in the correct panel? Another way to check the same: <code>dumpbin &#47;imports your.exe</code>. Anyway even you see the imports there is clearly something broken in VS2010 Release mode, you could try with newer version of Visual Studio as I wrote in my <a href=\"http://stackoverflow.com/a/31486183/4899330\">answer</a> (probably without .def file to exclude possibility of something being wrong in .def file too)."}], "tags": [], "owner": {"reputation": 125, "user_id": 1818640, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1591bfe20a646d63c3ccc64712336f0b?s=128&d=identicon&r=PG", "display_name": "Caldur", "link": "https://stackoverflow.com/users/1818640/caldur"}, "is_accepted": false, "score": 2, "last_activity_date": 1437128718, "creation_date": 1437128718, "answer_id": 31473693, "question_id": 31416185, "link": "https://stackoverflow.com/questions/31416185/the-procedure-entry-point-could-not-be-located-in-the-wrong-dll/31473693#31473693", "title": "\u201cThe procedure entry point\u2026 could not be located\u201d in the wrong DLL", "body": "<p>Have you tried using .def file to define exports? <a href=\"https://msdn.microsoft.com/en-us/library/d91k01sh.aspx\" rel=\"nofollow\">https://msdn.microsoft.com/en-us/library/d91k01sh.aspx</a></p>\n\n<p>After you create it, you must edit project properties Linker->Input->Module definition file</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1437237181, "post_id": 31486183, "comment_id": 50949944, "body": "I&#39;m confused. The question does not include the source, or even a link to the source. How do you know what it does in a different version?"}, {"owner": {"reputation": 7948, "user_id": 4899330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/857a19fa016a8fc6c0a3250f03f108a9?s=128&d=identicon&r=PG&f=1", "display_name": "doqtor", "link": "https://stackoverflow.com/users/4899330/doqtor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1437246146, "post_id": 31486183, "comment_id": 50952488, "body": "@dfeuer &quot;Hello World&quot; type of Haskell dll is facing a similar problem - works with Debug but not with Release exe when build under VS 2010. OP will need to post a reproducible example if that&#39;s not the same problem."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1437397450, "post_id": 31486183, "comment_id": 50995659, "body": "Wow, interesting. I&#39;m using VS 2013 and have never had a problem with Haskell DLLs. I&#39;ve never tried VS 2010."}, {"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 0, "creation_date": 1437597890, "post_id": 31486183, "comment_id": 51102182, "body": "I\u2019m tied to VS 2010 for the moment so this is a bummer. I appreciate the research, though."}], "tags": [], "owner": {"reputation": 7948, "user_id": 4899330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/857a19fa016a8fc6c0a3250f03f108a9?s=128&d=identicon&r=PG&f=1", "display_name": "doqtor", "link": "https://stackoverflow.com/users/4899330/doqtor"}, "is_accepted": true, "score": 8, "last_activity_date": 1437210291, "last_edit_date": 1437210291, "creation_date": 1437175854, "answer_id": 31486183, "question_id": 31416185, "link": "https://stackoverflow.com/questions/31416185/the-procedure-entry-point-could-not-be-located-in-the-wrong-dll/31486183#31486183", "title": "\u201cThe procedure entry point\u2026 could not be located\u201d in the wrong DLL", "body": "<p>This looks to be a bug in Visual Studio 2010 Release mode (Haskell dll functions are not imported by exe built in Release mode hence Haskell dll is not loaded, in Debug imports are present and it works fine).</p>\n\n<p>The same exe project built in Release mode using Visual Studio 2013 Update 4 and Visual Studio 2015 RC works fine.</p>\n"}], "owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2157, "favorite_count": 0, "accepted_answer_id": 31486183, "answer_count": 2, "score": 10, "last_activity_date": 1608230960, "creation_date": 1436904019, "last_edit_date": 1608230960, "question_id": 31416185, "link": "https://stackoverflow.com/questions/31416185/the-procedure-entry-point-could-not-be-located-in-the-wrong-dll", "title": "\u201cThe procedure entry point\u2026 could not be located\u201d in the wrong DLL", "body": "<p>I have created a DLL from Haskell code and I am calling this DLL from C++. My application works fine when I run it in Debug mode in Visual Studio 2010, but when I make a Release build and install it, I get the error</p>\n<blockquote>\n<p>The procedure entry point GetDataChunk could not be located in the dynamic link library AdvancedMath.dll.</p>\n</blockquote>\n<p>AdvancedMath.dll is my Haskell-based DLL. The weird thing is that the function GetDataChunk isn\u2019t in that DLL\u2014it\u2019s in another DLL I link against, and nothing about <em>that</em> DLL or my application\u2019s use of it changed when I added the Haskell DLL.</p>\n<p>This error message seems to be saying that Windows is confused about which functions live in which DLLs. What could be going wrong here?</p>\n"}, {"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 2, "creation_date": 1436904506, "post_id": 31415883, "comment_id": 50805284, "body": "As for type, the type you have above is fine. Why restrict it to <code>PersistEntity</code>? But, as for your first question: it already exists! It&#39;s called <code>(&lt;|&gt;)</code> in the module <code>Control.Applicative</code>."}, {"owner": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "reply_to_user": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1436908395, "post_id": 31415883, "comment_id": 50807532, "body": "<code>Alternative</code>! That&#39;s what I was looking for!"}], "answers": [{"comments": [{"owner": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "edited": false, "score": 0, "creation_date": 1436909107, "post_id": 31417183, "comment_id": 50807860, "body": "Oh, so in this case <code>fmap</code> transforms &quot;Maybe value&quot; into &quot;Maybe an IO action on the value&quot;, chain of  <code>&lt;|&gt;</code>&#39;s returns first non-Nothing action and then <code>runSqlite</code> actually performs it. Do I get it right?"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "edited": false, "score": 0, "creation_date": 1436909408, "post_id": 31417183, "comment_id": 50808005, "body": "Yep. Except that specifically <code>fmap insert_</code> transforms &quot;Maybe value&quot; to &quot;May an IO action using value that returns <code>()</code>&quot;, which was necessary to get the same type whether the heavy computation was returning a Model1 or a Model2"}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1436907345, "creation_date": 1436907345, "answer_id": 31417183, "question_id": 31415883, "link": "https://stackoverflow.com/questions/31415883/polymorphic-chaining-function-for-persistent-models/31417183#31417183", "title": "Polymorphic chaining function for Persistent models", "body": "<p>In my comment, I hadn't quite seen that your problem was that you were trying to combine two different types, <code>Maybe Model1</code> and <code>Maybe Model2</code>.</p>\n\n<p>That won't work - you can't find a function to combine them nicely. (You can combine them with a nasty branching <code>Either</code> mess, but I assume you don't want that)</p>\n\n<p>However, because these two models share the same <code>PersistentEntityBackend</code>, these expressions all have the same type:</p>\n\n<pre><code>fmap insert_ (heavyComputation1 input)\nfmap insert_ (heavyComputation2 input)\nfmap insert_ (heavyComputation3 input)\nfmap insert_ (heavyComputation4 input)\n</code></pre>\n\n<p>That type is <code>(MonadIO m) =&gt; Maybe (ReaderT SqlBackend m ())</code>, but the important part is that the type is <code>Maybe a</code> for some <code>a</code>, and also that they don't represent having actually done any SQL persistence yet, but just represent the action to do some SQL persistence. Now that they're the same type, we can tie them together with <code>&lt;|&gt;</code> as:</p>\n\n<pre><code>{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n\nimport Database.Persist\nimport Database.Persist.TH\nimport Database.Persist.Sqlite\nimport Control.Applicative\nimport Data.Foldable (mapM_)\nimport Prelude hiding (mapM_)\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nModel1\n  fieldA Int\n  fieldB String\n\nModel2\n  fieldC String\n  fieldD Double Maybe\n|]\n\nheavyComputation1 :: [String] -&gt; Maybe Model1\nheavyComputation1 input = undefined\n\nheavyComputation2 :: [String] -&gt; Maybe Model1\nheavyComputation2 input = undefined\n\nheavyComputation3 :: [String] -&gt; Maybe Model2\nheavyComputation3 input = undefined\n\nheavyComputation4 :: [String] -&gt; Maybe Model2\nheavyComputation4 input = undefined\n\ndoTheWork :: [String] -&gt; IO ()\ndoTheWork input =\n  mapM_ (runSqlite \"base.db\") $\n    (insert_ &lt;$&gt; heavyComputation1 input)\n    &lt;|&gt; (insert_ &lt;$&gt; heavyComputation2 input)\n    &lt;|&gt; (insert_ &lt;$&gt; heavyComputation3 input)\n    &lt;|&gt; (insert_ &lt;$&gt; heavyComputation4 input)\n\nmain :: IO ()\nmain = doTheWork [\"hi\"]\n</code></pre>\n\n<p>Here I used the alias for fmap (<code>&lt;$&gt;</code>) that <code>Control.Applicative</code> provides.</p>\n"}], "owner": {"reputation": 3192, "user_id": 9622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b0616783225972991e011625600e818?s=128&d=identicon&r=PG", "display_name": "Tomo", "link": "https://stackoverflow.com/users/9622/tomo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 31417183, "answer_count": 1, "score": 1, "last_activity_date": 1436907345, "creation_date": 1436902969, "question_id": 31415883, "link": "https://stackoverflow.com/questions/31415883/polymorphic-chaining-function-for-persistent-models", "title": "Polymorphic chaining function for Persistent models", "body": "<p>Consider the following code:</p>\n\n<pre><code>import Database.Persist\nimport Database.Persist.TH\nimport Database.Persist.Sqlite\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nModel1\n  fieldA Int\n  fieldB String\n\nModel2\n  fieldC String\n  fieldD Double Maybe\n|]\n\n(&gt;-&gt;) :: Maybe a -&gt; Maybe a -&gt; Maybe a\n(&gt;-&gt;) (Just x) _ = Just x\n(&gt;-&gt;) _ b        = b\n\nheavyComputation1 :: [String] -&gt; Maybe Model1\nheavyComputation1 input = undefined\n\nheavyComputation2 :: [String] -&gt; Maybe Model1\nheavyComputation2 input = undefined\n\nheavyComputation3 :: [String] -&gt; Maybe Model2\nheavyComputation3 input = undefined\n\nheavyComputation4 :: [String] -&gt; Maybe Model2\nheavyComputation4 input = undefined\n\ndoTheWork :: [String] -&gt; IO ()\ndoTheWork input = do\n  let result = (heavyComputation1 input)\n               &gt;-&gt; (heavyComputation2 input)\n               &gt;-&gt; (heavyComputation3 input)\n               &gt;-&gt; (heavyComputation4 input)\n  case result of\n    Just x  -&gt; runSqlite \"base.db\" $ do insert x; return ()\n    Nothing -&gt; return ()\n</code></pre>\n\n<p>It does not compile (of course). Only one of the <code>heavyComputation</code>s will produce value for a given input. <code>(&gt;-&gt;)</code> is supposed to stop CPU-heavy computation when the first value is produced.</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>Is there anything like my <code>(&gt;-&gt;)</code> already defined?</li>\n<li>What type should the <code>(&gt;-&gt;)</code> have? I was trying to do something like <code>(&gt;-&gt;) :: forall a. PersistEntity a =&gt; Maybe a -&gt; Maybe a -&gt; Maybe a</code> but I clearly do not understand <code>forall</code> as it doesn't seem to help. </li>\n</ol>\n\n<p>Maybe all my design is wrong. The idea is to get one of the <code>Model</code>s constructed from the input and skip unnecessary computation without such monstrosity:</p>\n\n<pre><code>doTheWorkUgly :: [String] -&gt; IO ()\ndoTheWorkUgly input = do\n  case heavyComputation1 input of\n    Just x -&gt; runSqlite \"abc.db\" $ do insert x; return ()\n    Nothing -&gt; case heavyComputation2 input of\n                 Just x -&gt; runSqlite \"abc.db\" $ do insert x; return ()\n                 Nothing -&gt; case heavyComputation3 input of\n                              Just x -&gt; runSqlite \"abc.db\" $ do insert x; return ()\n                              Nothing -&gt; case heavyComputation4 input of\n                                           Just x -&gt; runSqlite \"abc.db\" $ do insert x; return ()\n                                           Nothing -&gt; return ()\n</code></pre>\n\n<p>My idea is to have <code>result</code> be any of the models. <code>insert</code> can polymorphically write the to the DB. I would like to have my short-circuiting \"chain\" operator be polymorphic as well. Help!</p>\n"}, {"tags": ["haskell", "types", "declaration"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1436946241, "post_id": 31414746, "comment_id": 50820212, "body": "For short expressions you can write things like <code>[x, y] = [3, 4 :: Int]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "edited": false, "score": 0, "creation_date": 1436899511, "post_id": 31414780, "comment_id": 50802575, "body": "REALLY!? Can&#39;t believe I tried with parentheses but not without. Maybe this was to obvious for me to find when googling. Either way, THANK YOU!"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "edited": false, "score": 2, "creation_date": 1436899610, "post_id": 31414780, "comment_id": 50802633, "body": "@EFTH Hehe I feel you :P who hasn&#39;t been there. I&#39;m going to update my answer to show it in the language spec. Best of luck!"}], "tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": true, "score": 17, "last_activity_date": 1436900180, "last_edit_date": 1436900180, "creation_date": 1436899314, "answer_id": 31414780, "question_id": 31414746, "link": "https://stackoverflow.com/questions/31414746/haskell-declaring-the-type-of-multiple-functions/31414780#31414780", "title": "Haskell - Declaring the type of multiple functions", "body": "<p>Do what you tried without the parentheses.</p>\n\n<pre><code>funcA, funcB, funcC, funcD :: FuncType\n</code></pre>\n\n<hr />\n\n<p>In the <a href=\"https://www.haskell.org/onlinereport/haskell2010/\">Haskell 2010 report</a>, you can see in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-620004\">chapter 4 (Declarations and Bindings)</a> that a type signature (<code>gendecl</code>) looks like this:</p>\n\n<pre><code>vars :: [context =&gt;] type\n</code></pre>\n\n<p>and <code>vars</code> look like this:</p>\n\n<pre><code>var-1 , \u2026 , var-n\n</code></pre>\n\n<p>Which is exactly the form you're looking for.</p>\n\n<hr />\n\n<p>Sidenote: Haddock will apply a documentation if it finds it around that type signature <em>to every symbol</em> in that (<code>vars</code>) list.</p>\n"}, {"comments": [{"owner": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "edited": false, "score": 0, "creation_date": 1436942999, "post_id": 31418524, "comment_id": 50818246, "body": "<code>FuncType</code> in the question is (or was at least in my mind when I wrote it) a longer type that has been given a more convenient name with a type declaration. I felt however that having <code>FuncType</code> appear repeatedly in the code still was too much too type. Though, I do agree that this isn&#39;t always the best way to go. I often prefer having the type signature right next to the definition, but sometimes that isn&#39;t the case."}, {"owner": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "edited": false, "score": 0, "creation_date": 1436943122, "post_id": 31418524, "comment_id": 50818309, "body": "For clarity, what I wanted in the context of the code you preseneted:<code>foo, bar :: GoodName</code>"}, {"owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "reply_to_user": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "edited": false, "score": 0, "creation_date": 1436949684, "post_id": 31418524, "comment_id": 50822316, "body": "I added the <code>foo, bar :: GoodName</code> to the question, and also mentioned type inference. I understand that you&#39;re happy with MasterMastic&#39;s answer, but I want to chart the design space for future readers."}], "tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": false, "score": 4, "last_activity_date": 1436949549, "last_edit_date": 1436949549, "creation_date": 1436913019, "answer_id": 31418524, "question_id": 31414746, "link": "https://stackoverflow.com/questions/31414746/haskell-declaring-the-type-of-multiple-functions/31418524#31418524", "title": "Haskell - Declaring the type of multiple functions", "body": "<p>Alternatively to MasterMastic's answer, you can also <em>actually</em> give the repeated type a name using a type declaration:</p>\n\n<pre><code>-- | why GoodName is a good name\ntype GoodName = Complicated -&gt; Function -&gt; Type\n\n-- | Foo explanation.\nfoo :: GoodName\nfoo = ...\n\n-- | Bar explanation.\nbar :: GoodName\nbar = ...\n</code></pre>\n\n<p>This way, you only need to repeat the name instead of the potentially much longer type. Benefits of this style over <code>foo, bar :: Complicated -&gt; Function -&gt; Type</code> include:</p>\n\n<ul>\n<li>the named type serves as documentation</li>\n<li>the named type can be reused elsewhere</li>\n<li>the function definitions and type signatures are next to each other</li>\n<li>you can have different haddock comments for the different functions</li>\n<li>your source code looks more regular</li>\n<li>if only one of the functions later gets refactored to take additional arguments, the change is more local.</li>\n</ul>\n\n<p>Of course, you can also combine these approaches as <code>foo, bar :: GoodName</code>. Because of type inference, you can usually even leave out the type signature altogether and let the compiler figure out the type.</p>\n"}], "owner": {"reputation": 405, "user_id": 2635850, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/39a57604c381b02500ba3306bd484597?s=128&d=identicon&r=PG", "display_name": "EFTH", "link": "https://stackoverflow.com/users/2635850/efth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 1, "accepted_answer_id": 31414780, "answer_count": 2, "score": 12, "last_activity_date": 1436949549, "creation_date": 1436899223, "question_id": 31414746, "link": "https://stackoverflow.com/questions/31414746/haskell-declaring-the-type-of-multiple-functions", "title": "Haskell - Declaring the type of multiple functions", "body": "<p>I often find myself writing multiple functions with the same type. Let's call this type <code>FuncType</code>. I might write something like this:</p>\n\n<pre><code>funcA :: FuncType\nfuncB :: FuncType\nfuncC :: FuncType\nfuncD :: FuncType\n\n-- Implementations\n</code></pre>\n\n<p>This feels like a lot of unnecessary typing (typing as in tapping on the keyboard, not declaring types of functions). Is there maybe some way to do this more concisely? What I want would look something along the lines of:</p>\n\n<pre><code>(funcA, funcB, funcC, funcD) :: FuncType\n\n-- Implementations\n</code></pre>\n\n<p>I really tried to google this but I came up empty. If this isn't a feature of the language, why not? Am I missing something? Am I doing something wrong if I find myself needing this?</p>\n"}, {"tags": ["algorithm", "haskell", "if-statement"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1436898801, "post_id": 31414550, "comment_id": 50802130, "body": "I think you want <code>or</code>, not <code>any</code>. Also you could use <code>||</code> instead, or use <code>and</code> instead of the <code>&amp;&amp;</code>s."}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 5, "last_activity_date": 1436901920, "last_edit_date": 1436901920, "creation_date": 1436898664, "answer_id": 31414550, "question_id": 31414337, "link": "https://stackoverflow.com/questions/31414337/how-would-you-express-this-in-haskell/31414550#31414550", "title": "How would you express this in Haskell?", "body": "<p>Since there are just three paths in this decision tree that leads to a BOILERPLATE state, I'd just iterate and simplify them:</p>\n\n<pre><code>isBoilerplate =\n  prev_linkDensity   &lt;= 0.555556 &amp;&amp; curr_numWords &lt;= 16 &amp;&amp; prev_numWords &lt;= 4\n  || prev_linkDensity &gt; 0.555556 &amp;&amp; curr_numWords &lt;= 40 &amp;&amp; next_numWords &lt;= 17\n  || curr_linkDensity &gt; 0.333333\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1436899032, "post_id": 31414587, "comment_id": 50802274, "body": "For the first method, the <code>MultiWayIf</code> extension allows you to write that prettier, replacing <code>case () of _</code> by <code>if</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1436902200, "post_id": 31414587, "comment_id": 50804050, "body": "Minor comment: I have a personal distaste for guards which are meant to cover all cases (i.e. be exhaustive) and do not use <code>otherwise</code> for the last guard. I use <code>otherwise</code> because I find it to express the intent better, I do not have to repeat the condition twice, and is more efficient that anything else. Also, when an inner <code>if</code> has non-exhaustive branches, it&#39;s very easy (for me, at least) to think that Haskell will backtrack to the next outer <code>if</code> branch. This is however not the case, and a non-exhaustive match runtime error arises. For these reasons I strongly prefer the last alternative"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1436952032, "post_id": 31414587, "comment_id": 50823840, "body": "@chi As far as I can remember, GHC still lacks a proper syntax for nested branching patterns/guards which <i>do</i> backtrack, although I think it&#39;s been discussed before."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 11, "last_activity_date": 1436987772, "last_edit_date": 1436987772, "creation_date": 1436898781, "answer_id": 31414587, "question_id": 31414337, "link": "https://stackoverflow.com/questions/31414337/how-would-you-express-this-in-haskell/31414587#31414587", "title": "How would you express this in Haskell?", "body": "<p>Not simplifying the logic manually (assuming you might generate this code automatically), I think using <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#multiwayif\" rel=\"nofollow\"><code>MultiWayIf</code></a> is pretty clean and direct.</p>\n\n<pre><code>{-# LANGUAGE MultiWayIf #-}\n\ndata Stats = Stats {\n    curr_linkDensity :: Double,\n    prev_linkDensity :: Double,\n    ...\n}\n\ndata Classification = Content | Boilerplate\n\nclassify :: Stats -&gt; Classification\nclassify s = if\n    | curr_linkDensity s &lt;= 0.333333 -&gt; if\n      | prev_linkDensity s &lt;= 0.555556 -&gt; if\n        | curr_numWords s &lt;= 16 -&gt; if\n          | next_numWords s &lt;= 15 -&gt; if\n            | prev_numWords s &lt;= 4 -&gt; Boilerplate\n            | prev_numWords s &gt; 4 -&gt; Content\n          | next_numWords s &gt; 16 -&gt; Content\n      ...\n</code></pre>\n\n<p>and so on. </p>\n\n<p>However, since this is so structured -- just a tree of if/else with comparisons, also consider creating a decision tree data structure and writing an interpreter for it.  This will allow you to do transformations, manipulations, inspections.  Maybe it will buy you something; defining miniature languages for your specifications can be surprisingly beneficial.</p>\n\n<pre><code>data DecisionTree i o \n    = Comparison (i -&gt; Double) Double (DecisionTree i o) (DecisionTree i o)\n    | Leaf o\n\nrunDecisionTree :: DecisionTree i o -&gt; i -&gt; o\nrunDecisionTree (Comparison f v ifLess ifGreater) i\n    | f i &lt;= v  = runDecisionTree ifLess i\n    | otherwise = runDecisionTree ifGreater i\nrunDecisionTree (Leaf o) = o\n\n-- DecisionTree is an encoding of a function, and you can write\n-- Functor, Applicative, and Monad instances!\n</code></pre>\n\n<p>Then</p>\n\n<pre><code> classifier :: DecisionTree Stats Classification\n classifier =\n     Comparison curr_linkDensity 0.333333\n       (Comparison prev_linkDensity 0.555556\n         (Comparison curr_numWords 16\n           (Comparison next_numWords 15\n             (Comparison prev_numWords 4\n               (Leaf Boilerplate)\n               (Leaf Content))\n             (Leaf Content)\n           ...\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 31414550, "answer_count": 2, "score": 5, "last_activity_date": 1436987772, "creation_date": 1436897974, "question_id": 31414337, "link": "https://stackoverflow.com/questions/31414337/how-would-you-express-this-in-haskell", "title": "How would you express this in Haskell?", "body": "<p>Would you use if/else to write this algorithm in Haskell? Is there a way to express it without them? It's hard to extract functions out of the middle that have meaning. This is just the output of a machine learning system. </p>\n\n<p>I'm implementing the algorithm for classifying segments of html content as Content or Boilerplate described <a href=\"https://code.google.com/p/boilerpipe/wiki/WSDM2010Paper\">here</a>. This has the weights already hard coded. </p>\n\n<pre><code>curr_linkDensity &lt;= 0.333333\n| prev_linkDensity &lt;= 0.555556\n| | curr_numWords &lt;= 16\n| | | next_numWords &lt;= 15\n| | | | prev_numWords &lt;= 4: BOILERPLATE\n| | | | prev_numWords &gt; 4: CONTENT\n| | | next_numWords &gt; 15: CONTENT\n| | curr_numWords &gt; 16: CONTENT\n| prev_linkDensity &gt; 0.555556\n| | curr_numWords &lt;= 40\n| | | next_numWords &lt;= 17: BOILERPLATE\n| | | next_numWords &gt; 17: CONTENT\n| | curr_numWords &gt; 40: CONTENT\ncurr_linkDensity &gt; 0.333333: BOILERPLATE\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1436892130, "post_id": 31412444, "comment_id": 50798157, "body": "I believe <a href=\"https://hackage.haskell.org/package/haskell-src-meta\" rel=\"nofollow noreferrer\">haskell-src-meta</a> provides this"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1436908582, "post_id": 31412444, "comment_id": 50807624, "body": "@luqui I am a little confused by that package. It writes something is &quot;not 100% complete yet&quot; in the description. Shouldn&#39;t this functionality be already present within GHC? It must be, because it takes <code>[|(1+)|]</code> and is perfectly capable to turn that into <code>(InfixE _)</code>. So why is there a need for a third party package that may or may not parse correctly? Or am I misinterpreting and that is the canonical code GHC uses too? Or GHC just doesn&#39;t expose this function at all perhaps? I would be grateful for some clarity around this. :)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1436909051, "post_id": 31412444, "comment_id": 50807831, "body": "AFAIU GHC does not expose this code, but I am no TH expert"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1436909463, "post_id": 31412444, "comment_id": 50808035, "body": "@luqui if that is the case, wouldn&#39;t it be much more elegant to expose it under -- say, for instance <code>Language.Haskell.TH.Parser.parse :: String -&gt; Q Exp</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1436913814, "post_id": 31412444, "comment_id": 50809811, "body": "It would be <i>way</i> more elegant if GHC exposed it, but it can&#39;t have that type.  It needs a type that includes all of the possible options that can affect parsing.  When it gets there, you end up having circular dependency issues between the <code>ghc</code> and <code>template-haskell</code> packages."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1436922766, "post_id": 31412444, "comment_id": 50812231, "body": "Hmm. But isn&#39;t it strange that there are third party, <i>duplicate</i> solutions to a functionality that is built right in to GHC? When you say circular dependencies, do you mean that it would be impossible or prohibitively difficult to expose this one single function? Also, thanks for your point about the parsing-modifier options. Fair point. A record or list passed in would be sufficient for that, right?"}, {"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1436944861, "post_id": 31412444, "comment_id": 50819355, "body": "If this <code>parse</code> function existed, what would it&#39;s type be?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1436951239, "post_id": 31412444, "comment_id": 50823320, "body": "I asked almost this exact question a while ago, and it seems that no, TH doesn&#39;t have this obviously useful functionality. Which just seems weird to me..."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1437821165, "post_id": 31412444, "comment_id": 51198990, "body": "@luqui I&#39;ve started using <code>haskell-src-meta</code>, and it seems to work well so far. Want to add it as an answer so I can accept it for now?"}, {"owner": {"reputation": 3142, "user_id": 2474792, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/327964b28dd74fd6bbbe669aac4edf04?s=128&d=identicon&r=PG", "display_name": "Demi", "link": "https://stackoverflow.com/users/2474792/demi"}, "edited": false, "score": 0, "creation_date": 1472494511, "post_id": 31412444, "comment_id": 65763975, "body": "You <i>can</i> create such a function, since the Q Monad has a means of running IO actions, so you could pass the information via some global or thread-local state.  But it would be very un-ideomatic."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1476688974, "post_id": 31412444, "comment_id": 67434008, "body": "As for me, I still don&#39;t get how the template would be spliced. I thought splices can be performed during compilation only."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1480992889, "post_id": 40985623, "comment_id": 69183306, "body": "Why would fixity not be known till type checking? Isn&#39;t that conceptually a layer over the parser to produce a more complete AST? Why would fancy stuff happen before that?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1480994312, "post_id": 40985623, "comment_id": 69183660, "body": "@dfeuer Fixities are filled in during the renaming phase (which occurs right before type checking), so type-checking is the first phase where fixities are fully present. I&#39;m probably not understanding your question..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481004079, "post_id": 40985623, "comment_id": 69186404, "body": "I thought the renamer was tied up with the type checker; maybe that was wrong."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481006111, "post_id": 40985623, "comment_id": 69187138, "body": "@dfeuer No you understood correctly - the renamer and the type checker do feed back into each other, but only when dealing with top-level splices. The point remains that fixities for a particular block aren&#39;t even known until the end of renaming (and consequently the AST related to infix operators <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/src/RnTypes.html#mkOpAppRn\" rel=\"nofollow noreferrer\">may need to be rearranged</a>)."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502716164, "post_id": 40985623, "comment_id": 78307977, "body": "I&#39;m stumped with the exact same problem at <a href=\"https://stackoverflow.com/questions/45674757/how-to-splice-in-literal-strings-of-haskell-code-via-template-haskell\" title=\"how to splice in literal strings of haskell code via template haskell\">stackoverflow.com/questions/45674757/&hellip;</a> How does TH work? Is the AST converted to literal source code, which is then fed into the &quot;regular GHC&quot;, or does GHC use the AST directly? If it&#39;s the former, then isn&#39;t haskell-src-meta a fairly inefficient solution where the same code is being parsed twice -- once by haskell-src-meta and once by actual GHC?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1502746337, "post_id": 40985623, "comment_id": 78324729, "body": "@SaurabhNanda The AST inside the splice is parsed by GHC at the same time as the AST outside the splice. Critically, this all happens at compile time. You can <i>never</i> feed run-time strings into quasi quotes (or GHC), but you can feed run-time strings to <code>haskell-src-meta</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1480982715, "creation_date": 1480982715, "answer_id": 40985623, "question_id": 31412444, "link": "https://stackoverflow.com/questions/31412444/template-haskell-is-there-a-function-or-special-syntax-that-parses-a-string-a/40985623#40985623", "title": "Template Haskell: Is there a function (or special syntax) that parses a String and returns Q Exp?", "body": "<p>As everyone has already said <a href=\"https://hackage.haskell.org/package/haskell-src-meta/docs/Language-Haskell-Meta-Parse.html\" rel=\"nofollow noreferrer\"><code>haskell-src-meta</code></a> provides </p>\n\n<pre><code>parsePat :: String -&gt; Either String Pat\nparseExp :: String -&gt; Either String Exp\nparseType :: String -&gt; Either String Type\nparseDecs :: String -&gt; Either String [Dec]\n</code></pre>\n\n<p>where <code>Pat</code>, <code>Exp</code>, <code>Type</code>, and <code>Dec</code> are the same as from <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html\" rel=\"nofollow noreferrer\"><code>Language.Haskell.TH.Syntax</code></a>.</p>\n\n<hr>\n\n<blockquote>\n  <p>Why doesn't GHC expose its own parser?</p>\n</blockquote>\n\n<p>It does. Fire up GHCi with <code>ghci -package ghc</code> (<code>ghc</code> is a hidden package by default) and you can import the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/Parser.html\" rel=\"nofollow noreferrer\"><code>Parser</code></a>. It has functions to parse <code>String</code> into preliminary ASTs (whose data declarations are in <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/HsSyn.html\" rel=\"nofollow noreferrer\"><code>HsSyn</code></a>) for patterns, expressions, types, and declarations.</p>\n\n<blockquote>\n  <p>OK, then why does there not exist a library that uses this parser and converts its output to be the AST from <code>template-haskell</code> (the one in <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html\" rel=\"nofollow noreferrer\"><code>Language.Haskell.TH.Syntax</code></a>)?</p>\n</blockquote>\n\n<p>Looking inside <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/HsSyn.html\" rel=\"nofollow noreferrer\"><code>HsSyn</code></a>, its obvious that the AST isn't quite the same as the one in <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html\" rel=\"nofollow noreferrer\"><code>Language.Haskell.TH.Syntax</code></a>. Open up both <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/HsExpr.html#t:HsExpr\" rel=\"nofollow noreferrer\"><code>HsExpr</code></a> and <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html#t:Exp\" rel=\"nofollow noreferrer\"><code>Exp</code></a> and side by side you'll see that the latter is filled with types like <code>PostTc id &lt;some-other-type&gt;</code> and <code>PostRn id &lt;some-other-type&gt;</code>. As the AST is passed from the parser to the renamer to the type checker, these bits and pieces are all slowly filled in. For example, we don't even know the fixities of operators until we get to type-checking!</p>\n\n<p>In order to make the functions we want, we would need to run much more than just the parser (at least the renamer and type checker too, maybe more). Imagine that: every time you want to parse even a small expression like <code>\"1 + 2\"</code> you'll still have to type check a bunch of imports. Even then, converting back to the <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html\" rel=\"nofollow noreferrer\"><code>Language.Haskell.TH.Syntax</code></a> wouldn't be a walk in the park: GHC has a variety of peculiarities like its own special global way of storing names and identifiers.</p>\n\n<blockquote>\n  <p>Hmmm... but what does GHC do with quasi-quotes?</p>\n</blockquote>\n\n<p>That's the cool part! Unlike <code>Exp</code>, <code>HsExpr</code> has <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/libraries/ghc-8.0.1/HsExpr.html#t:HsSplice\" rel=\"nofollow noreferrer\"><code>HsSplice</code></a> for representing splices. Look at the types for the first two constructors:</p>\n\n<pre><code>HsTypedSplice :: id -&gt; LHsExpr id -&gt; HsSplice id.   -- things like [|| 1 + 2 ||]\nHsUntypedSplice :: id -&gt; LHsExpr id -&gt; HsSplice id  -- things like [| 1 + 2 |]\n</code></pre>\n\n<p>Notice that they aren't storing <code>String</code>, they are storing an AST already! Splices get parsed at the same time as the rest of the AST. And just like the rest of the AST, the splices will get passed along to the renamer, type checker, etc. where missing information will be filled in.</p>\n\n<blockquote>\n  <p>So is it fundamentally impossible to use GHC's parser</p>\n</blockquote>\n\n<p>Probably not. But extricating it from the rest of GHC may be quite difficult. If to use GHC's parser we have to also run the type-checker and the renamer, it may be more elegant and simple to just use a standalone parser like <code>haskell-src-exts</code> (which is what <code>Haskell-src-meta</code> depends on) that is able to do everything in one pass (fixities, for example, are one of the things you have to give <em>ahead of time</em> to this parser).</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1186, "favorite_count": 4, "accepted_answer_id": 40985623, "answer_count": 1, "score": 20, "last_activity_date": 1480982715, "creation_date": 1436891706, "last_edit_date": 1437821361, "question_id": 31412444, "link": "https://stackoverflow.com/questions/31412444/template-haskell-is-there-a-function-or-special-syntax-that-parses-a-string-a", "title": "Template Haskell: Is there a function (or special syntax) that parses a String and returns Q Exp?", "body": "<p>I am trying to learn a bit of Template Haskell and Quasi Quotation, and I am looking for a function that takes a <code>String</code> and parses it to <code>Q Exp</code>, so the type is:</p>\n\n<pre><code>String -&gt; Q Exp\n</code></pre>\n\n<p>Tried searching hoogle, but the results I saw had to do with lifting String literals to <code>Q Exp</code>, and the closest I found was <code>Language.Haskell.TH.dyn</code> which does quite what I want, but only for a single variable.</p>\n\n<p>Are there other options? E.g. a special syntax? I'm just in the process of familiarizing myself with <code>[||]</code> and <code>$()</code>, so maybe there is something for this purpose too?</p>\n\n<p>An example of how I imagine it would work:</p>\n\n<pre><code>runQ (parse \"(1+)\") == InfixE (Just (LitE (IntegerL 1))) (VarE GHC.Num.+) Nothing\n</code></pre>\n\n<p>Also, I am aware of this</p>\n\n<pre><code>runQ [| (1+) |] == InfixE (Just (LitE (IntegerL 1))) (VarE GHC.Num.+) Nothing\n</code></pre>\n\n<p>but this wont work with variable strings because -- understandably -- the string inside is taken as a literal.</p>\n\n<pre><code>runQ [| \"(1+)\" |] == LitE (StringL \"(1+)\")\n</code></pre>\n\n<p><strong>Edit (2015-07-25):</strong> I've started using <code>haskell-src-meta</code>, and it seems to work well so far. However it does take quite a bit of time to <code>cabal install</code> (about 10 minutes on my machine). Which is a shame, my package is actually rather small, and I would like if install could be quick. Anyone knows of a solution that has smaller dependencies? </p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1436953772, "post_id": 31411203, "comment_id": 50824955, "body": "Isn&#39;t the answer in the other question sufficient enough, e.g. configure your <code>~&#47;.cabal&#47;config</code>?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1436966514, "post_id": 31411203, "comment_id": 50833543, "body": "That still requires reinstalling the platform if you encounter a package that depends on some infrastructures, e.g. haddock uses cabal."}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436888325, "creation_date": 1436888325, "last_edit_date": 1495541167, "question_id": 31411203, "link": "https://stackoverflow.com/questions/31411203/how-to-prevent-profiling-dependency-issue-before-genesis", "title": "How to prevent profiling dependency issue before Genesis", "body": "<p>It is well know that <a href=\"https://stackoverflow.com/questions/1704421/cabal-not-installing-dependencies-when-needing-profiling-libraries\">profiling large packages almost always require destroying and rebuilding the world</a>. However, is there anyway to avoid this when starting fresh? How can I enable benchmark and profiling the first time I install GHC platform on a new machine? </p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 635, "user_id": 860338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/782e20b78bb80f4207cbea38f88c922a?s=128&d=identicon&r=PG", "display_name": "ImAlsoGreg", "link": "https://stackoverflow.com/users/860338/imalsogreg"}, "edited": false, "score": 0, "creation_date": 1436885002, "post_id": 31409317, "comment_id": 50793045, "body": "Auth snaplet backends all need to be able to serialize the <code>AuthUser</code> structure - so including your user data within <code>AuthUser</code> would be somewhat limiting. Instead, it&#39;s common to treat your user data like all other data in your app (separately handled), and relate it back to the <code>AuthUser</code> by the <code>AuthUser.userLogin</code>  (edit: spelling)"}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "reply_to_user": {"reputation": 635, "user_id": 860338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/782e20b78bb80f4207cbea38f88c922a?s=128&d=identicon&r=PG", "display_name": "ImAlsoGreg", "link": "https://stackoverflow.com/users/860338/imalsogreg"}, "edited": false, "score": 0, "creation_date": 1436886295, "post_id": 31409317, "comment_id": 50794028, "body": "@ImAlsoGreg Why do you suggest using <code>AuthUser.userLogin</code> instead of <code>AuthUser.userId</code>?"}, {"owner": {"reputation": 635, "user_id": 860338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/782e20b78bb80f4207cbea38f88c922a?s=128&d=identicon&r=PG", "display_name": "ImAlsoGreg", "link": "https://stackoverflow.com/users/860338/imalsogreg"}, "edited": false, "score": 0, "creation_date": 1436897006, "post_id": 31409317, "comment_id": 50801050, "body": "Oh, thanks. As @mightybyte mentioned elsewhere, <code>AuthUser.userId</code> is a better choice, for those times when you might let users change their login name."}], "answers": [{"tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 2, "last_activity_date": 1436893178, "creation_date": 1436893178, "answer_id": 31412889, "question_id": 31409317, "link": "https://stackoverflow.com/questions/31409317/user-management-in-snap/31412889#31412889", "title": "User management in snap", "body": "<p>The way I usually deal with additional user data is to put it in a separate table keyed by the key from the AuthUser type.</p>\n"}], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 31412889, "answer_count": 1, "score": 2, "last_activity_date": 1436893178, "creation_date": 1436883559, "question_id": 31409317, "link": "https://stackoverflow.com/questions/31409317/user-management-in-snap", "title": "User management in snap", "body": "<p>I've just begun my first Snap application, and there is something I do not quite understand. How exactly am I supposed to manage my users?</p>\n\n<p>There already appears to be an <a href=\"https://hackage.haskell.org/package/snap/docs/Snap-Snaplet-Auth.html#t:AuthUser\" rel=\"nofollow\"><code>AuthUser</code></a> type for dealing with user authentication. My question is more about additional user data. Such as collecting their name, location, etc.</p>\n\n<p>I have found the <a href=\"https://github.com/snapframework/snap-auth#usage-example-1\" rel=\"nofollow\">snap-auth</a> module on GitHub outlining the creation of a <code>User</code> type that has the <code>AuthUser</code> embedded inside. My only concern is that it is quite old and may not be the current best practise in this area.</p>\n"}, {"tags": ["haskell", "compiler-errors", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1436879711, "last_edit_date": 1436879711, "creation_date": 1436879403, "answer_id": 31407594, "question_id": 31407256, "link": "https://stackoverflow.com/questions/31407256/data-family-instance-binding-illegally-to-built-in-syntax/31407594#31407594", "title": "Data family instance binding illegally to built in syntax: ()", "body": "<p>With data families, you're supposed to provide an ADT or GADT definition on the right side of the equation. <code>()</code> is not a valid definition of a constructor. <code>data instance F Int = Bool</code> declares a single constructor with the name <code>Bool</code>, which works, but doesn't have anything to do with the type <code>Bool</code>. It's just that <code>Bool</code> is available as a constructor name.</p>\n\n<p>What you're trying to do can be realized with type families instead:</p>\n\n<pre><code>type family F a\ntype instance F Int = ()\n\n-- or in closed form\ntype family F a where\n    F Int = ()\n</code></pre>\n\n<p>Or you can give a right hand side for the data instance which's equivalent to <code>()</code>:</p>\n\n<pre><code>data instance F Int = FUnit\n</code></pre>\n"}], "owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 31407594, "answer_count": 1, "score": 3, "last_activity_date": 1436879711, "creation_date": 1436878587, "question_id": 31407256, "link": "https://stackoverflow.com/questions/31407256/data-family-instance-binding-illegally-to-built-in-syntax", "title": "Data family instance binding illegally to built in syntax: ()", "body": "<p>I'm trying to define a <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow\">data type family</a>, one of whose parameters results in the type of the empty tuple <code>()</code>, but it doesn't compile. Here is a minimal working example:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata family F a\ndata instance F Int = ()\n</code></pre>\n\n<p>The compiler error thrown says \"Illegal binding of built-in syntax: <code>()</code>\". Why am I getting this error, even though I'm not trying to change the definition of <code>()</code>, but rather set it as the output of some computation (evaluation of a type family)?</p>\n\n<p>For what it's worth, the program compiled when <code>()</code> is changed to <code>Bool</code> instead.</p>\n"}, {"tags": ["performance", "haskell", "math", "file-io"], "comments": [{"owner": {"reputation": 4409, "user_id": 1041673, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ece0340af48315f6d696049c3fae7705?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/1041673/cthulhu"}, "edited": false, "score": 2, "creation_date": 1436866810, "post_id": 31402977, "comment_id": 50780078, "body": "Hi, welcome to StackOverflow. What exactly is your question?"}, {"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "reply_to_user": {"reputation": 4409, "user_id": 1041673, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ece0340af48315f6d696049c3fae7705?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/1041673/cthulhu"}, "edited": false, "score": 0, "creation_date": 1436866990, "post_id": 31402977, "comment_id": 50780214, "body": "Hi :) Sorry - my question is how to make it run faster."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1436867316, "post_id": 31402977, "comment_id": 50780417, "body": "It&#39;s 0.8 sec for your Haskell and 1.2 sec for your Python script on my machine."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436868137, "post_id": 31402977, "comment_id": 50780929, "body": "I have a slow hardware here and it takes 1.6 sec for your Haskell script and 2 sec for your Python 2.7 script."}, {"owner": {"reputation": 292363, "user_id": 37213, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=128&d=identicon&r=PG", "display_name": "duffymo", "link": "https://stackoverflow.com/users/37213/duffymo"}, "edited": false, "score": 1, "creation_date": 1436868959, "post_id": 31402977, "comment_id": 50781428, "body": "Benchmarks like these aren&#39;t that meaningful, in my opinion."}, {"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 0, "creation_date": 1436870673, "post_id": 31402977, "comment_id": 50782458, "body": "I&#39;ve never said that they are. I was just a little surprising for me. I expected compiled Haskell to run two times faster than scripts. (BTW. Running this code with <code>runhaskell</code> takes ages.)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1436871599, "post_id": 31402977, "comment_id": 50783073, "body": "Related: <a href=\"http://stackoverflow.com/questions/29186541/why-is-this-haskell-program-so-much-slower-than-an-equivalent-python-one\" title=\"why is this haskell program so much slower than an equivalent python one\">stackoverflow.com/questions/29186541/&hellip;</a>"}, {"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1436875506, "post_id": 31402977, "comment_id": 50785726, "body": "@Luke <code>runhaskell</code> or rather <code>runghc</code> compiles the program first, and since we don&#39;t have a fast interpreter, it will be perhaps the slowest solution you can come up with, so the comparison isn&#39;t fair.  You should compile your program with <code>ghc -O2 yourfile.hs</code> and then time the resulting executable instead."}, {"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1436878009, "post_id": 31402977, "comment_id": 50787590, "body": "@Sarah: I know, it was only a minor point. I was comparing an executable with Python and Ruby scripts."}], "answers": [{"comments": [{"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 0, "creation_date": 1436870131, "post_id": 31403364, "comment_id": 50782139, "body": "Thanks, that might be the root of the problem. I&#39;ve heard that GHC produces only a bit slower (less than two times) code than gcc, so I expected the same would apply to strings and file IO. Can something be done using only standard library?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 1, "creation_date": 1436871235, "post_id": 31403364, "comment_id": 50782825, "body": "@Luke: you could probably do it by manual juggling with <code>putChar</code> and buffer settings... but that&#39;s awful. Again: you shouldn&#39;t really need to care about IO performance, unless you&#39;re working on a big project that handles lots of network activity or data too big to fit in RAM. For those projects, you definitely want bytestrings / streaming libraries. For anything simpler, just <i>don&#39;t output stuff you won&#39;t need anyway</i>! That&#39;s not just Haskell advice; in any language, needless IO will greatly diminish performance."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 1, "creation_date": 1436871574, "post_id": 31403364, "comment_id": 50783055, "body": "And BTW, for high-performance IO you should use binary formats, not text."}, {"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 0, "creation_date": 1436874223, "post_id": 31403364, "comment_id": 50784848, "body": "Sure, but then it wouldn&#39;t be readable outside hex editor or my own program. Could you recommend a source introducing to binary access to file system in Haskell?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 1, "creation_date": 1436877104, "post_id": 31403364, "comment_id": 50786870, "body": "How about <a href=\"https://wiki.haskell.org/Dealing_with_binary_data\" rel=\"nofollow noreferrer\">wiki.haskell.org/Dealing_with_binary_data</a>. Of course, Real World Haskell also <a href=\"http://book.realworldhaskell.org/read/code-case-study-parsing-a-binary-data-format.html\" rel=\"nofollow noreferrer\">has a chapter on it</a>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 10, "last_activity_date": 1436871522, "last_edit_date": 1436871522, "creation_date": 1436867711, "answer_id": 31403364, "question_id": 31402977, "link": "https://stackoverflow.com/questions/31402977/simple-math-and-saving-to-file-takes-too-much-time-compared-to-other-languages/31403364#31403364", "title": "Simple math and saving to file takes too much time, compared to other languages", "body": "<p>First off, benchmarks where you perform some simple calculation and write each result to a file are <em>only useful to test the IO system</em>. They say nothing at all about computation efficiency, because most of the time is spent with file accesses. If you want to compare how fast languages are for calculating things, you need to do something processor-intensive (e.g. summing all those square values) and then output only that single result.</p>\n\n<p>If you actually want to compare file-output performance, the main problem in Haskell is its <code>String</code> type. It's a simple list of characters, handy for doing simple text manipulations by hand but with ridiculous overhead for standard tasks. For faster performance, use <a href=\"http://hackage.haskell.org/package/bytestring\">bytestrings</a> or <a href=\"http://hackage.haskell.org/package/text\"><code>Text</code></a>. Specifically, you need a faster alternative to <code>show</code>. Check out the <a href=\"http://hackage.haskell.org/package/text-format\">text-format package</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 0, "creation_date": 1436880132, "post_id": 31407412, "comment_id": 50789296, "body": "I see that <code>ByteString</code> version is much faster, but how can I easily convert an <code>Int</code> to <code>ByteString</code>, without using non-standard libraries? Currently your solution is faster, but it doesn&#39;t solve the main problem (which is saving integers in the file)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 0, "creation_date": 1436881546, "post_id": 31407412, "comment_id": 50790345, "body": "That&#39;s the rub - I don&#39;t know of any standard, faster ways of formatting integers to strings or byte strings. Note - my program does save data to a file - it just doesn&#39;t save the right data. I wrote it to demonstrate where the real problem is."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 2, "creation_date": 1436886005, "post_id": 31407412, "comment_id": 50793831, "body": "@Luke: <code>ByteString</code> is itself not in <code>base</code>, so obviously you can&#39;t convert to it without using \u201cnonstandard libraries\u201d! However, a lot of libraries (<code>vector</code>, <code>bytestring</code>, <code>lens</code>) are so common you may well consider them standard. And really... it&#39;s no big deal to use othe hackage libraries, either. Get used to it."}, {"owner": {"reputation": 1042, "user_id": 898435, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13ce5b59868b7bb438dcd717a556f4b9?s=128&d=identicon&r=PG", "display_name": "Marqin", "link": "https://stackoverflow.com/users/898435/marqin"}, "reply_to_user": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "edited": false, "score": 1, "creation_date": 1436906237, "post_id": 31407412, "comment_id": 50806226, "body": "@Luke the easiest way, if you don&#39;t want to use other packages, is to use <code>pack</code> function from <code>ByteString</code> to convert from string, as I&#39;ve in my answer."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1436878930, "creation_date": 1436878930, "answer_id": 31407412, "question_id": 31402977, "link": "https://stackoverflow.com/questions/31402977/simple-math-and-saving-to-file-takes-too-much-time-compared-to-other-languages/31407412#31407412", "title": "Simple math and saving to file takes too much time, compared to other languages", "body": "<p>The problems are: 1) using <code>String</code>, and 2) the formatting of integer values to character data (either <code>ByteString</code> or <code>String</code>).</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport System.IO\nimport qualified Data.ByteString.Char8 as BS\n\n-- saveLine fh x = hPutStrLn fh $ show x ++ \"\\t\" ++ show (x^2) -- original version\n-- saveLine fh x = hPutStrLn fh \"123456\\t123456789012\" -- String version\nsaveLine fh x = BS.hPutStrLn fh \"123456\\t123456789012\" -- ByteString version\n\nmain = do\n    fh &lt;- openFile \"haskell.txt\" WriteMode\n    mapM_ (saveLine fh) [1..999999]\n    hClose fh\n</code></pre>\n\n<p>The run times on my machine are (GHC 7.8.3):</p>\n\n<pre><code>original version:   1.6 secs\nString version:     0.7 secs\nByteString version: 0.3 secs\n</code></pre>\n\n<p>Thus, the run time can be significantly improved if one can find a faster way to format integer values to ByteStrings.</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436935475, "post_id": 31416736, "comment_id": 50815306, "body": "You should benchmark this against the <code>String</code> version, and I think you&#39;ll find that it is only about 20% faster (using GHC 7.8.3)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1436935713, "post_id": 31416736, "comment_id": 50815388, "body": "In fact, I think using <code>mapM_</code> instead of <code>mapM</code> accounts for most of the timing difference between the two versions."}, {"owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436945890, "post_id": 31416736, "comment_id": 50819975, "body": "@user5402 Which means that it wasn&#39;t only the <code>String</code>&#39;s fault."}, {"owner": {"reputation": 1042, "user_id": 898435, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13ce5b59868b7bb438dcd717a556f4b9?s=128&d=identicon&r=PG", "display_name": "Marqin", "link": "https://stackoverflow.com/users/898435/marqin"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436958283, "post_id": 31416736, "comment_id": 50827748, "body": "@user5402 You should keep in mind that this code is still using Strings, and had additional overhead ( packing Strings into ByteString ) with only concat and hPutStrLn used from ByteString."}], "tags": [], "owner": {"reputation": 1042, "user_id": 898435, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13ce5b59868b7bb438dcd717a556f4b9?s=128&d=identicon&r=PG", "display_name": "Marqin", "link": "https://stackoverflow.com/users/898435/marqin"}, "is_accepted": true, "score": 1, "last_activity_date": 1436958257, "last_edit_date": 1495541167, "creation_date": 1436905970, "answer_id": 31416736, "question_id": 31402977, "link": "https://stackoverflow.com/questions/31402977/simple-math-and-saving-to-file-takes-too-much-time-compared-to-other-languages/31416736#31416736", "title": "Simple math and saving to file takes too much time, compared to other languages", "body": "<p>First, you should avoid using <strong>-O3</strong>, because it could sometimes break your code ( even in gcc ). Just stick to <strong>-O2</strong>.</p>\n\n<hr>\n\n<p>Second, <strong>Haskell Strings are <a href=\"https://honza.ca/2012/10/haskell-strings\" rel=\"nofollow noreferrer\">really slow</a></strong>.</p>\n\n<p><strong>But, <a href=\"https://wiki.haskell.org/Performance/Strings\" rel=\"nofollow noreferrer\">there are faster alternatives</a></strong> - and for me, the easiest one is to use is Data.ByteString ( <a href=\"http://agentzh.blogspot.com/2008/06/optimizing-haskell-code-from-string-to.html\" rel=\"nofollow noreferrer\">little and old tutorial</a> ).</p>\n\n<hr>\n\n<p>Third, if you don't need Maybe results from mapM <a href=\"https://stackoverflow.com/questions/27609062/what-is-the-difference-between-mapm-and-mapm-in-haskell\">use mapM_</a> - it's <strong>much faster</strong>!</p>\n\n<hr>\n\n<p>Finally, here is my version of your code, using Data.ByteString:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n--  that line is so You could use \"\\t\" instead of T.pack \"\\t\"\n\nimport System.IO\nimport qualified Data.ByteString.Char8 as T\n\nhelperFun x = T.concat [y, \"\\t\", z]\n          where\n            y = T.pack $ show x\n            z = T.pack $ show $ x^2\n\nsaveLine fh x = T.hPutStrLn fh $ helperFun x\n\nmain = do\n    fh &lt;- openFile \"haskell.txt\" WriteMode\n    mapM_ (saveLine fh) [1..999999]\n    hClose fh\n</code></pre>\n\n<hr>\n\n<p><strong>Edit:</strong>\n<em>user5402</em> said in comments it's not so \"much faster\" then Strings version.</p>\n\n<p>You should keep in mind that this code is still using Strings, and had additional overhead ( packing Strings into ByteString ) with only <code>concat</code> and <code>hPutStrLn</code> used from ByteString.</p>\n"}], "owner": {"reputation": 1235, "user_id": 5114473, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/iTwYV.png?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/5114473/luke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 31416736, "answer_count": 3, "score": 1, "last_activity_date": 1436958257, "creation_date": 1436866614, "last_edit_date": 1436867022, "question_id": 31402977, "link": "https://stackoverflow.com/questions/31402977/simple-math-and-saving-to-file-takes-too-much-time-compared-to-other-languages", "title": "Simple math and saving to file takes too much time, compared to other languages", "body": "<p>Recently me and my friends were benchmarking different programming languages. As I'm learning Haskell lately, I wanted to show that a functional language will perform nearly as good as C with simpler code. But the code I pasted below, compiled with GHC's -O3 option, was executing about 1.6 s on my machine. Equivalent scripts in Python and Ruby executed faster (it was a simple for loop).</p>\n\n<pre><code>import System.IO\n\nsaveLine fh x = hPutStrLn fh $ show x ++ \"\\t\" ++ show (x^2)\n\nmain = do\n    fh &lt;- openFile \"haskell.txt\" WriteMode\n    mapM (saveLine fh) [1..999999]\n    hClose fh\n</code></pre>\n\n<p>You can check out <a href=\"http://pastebin.com/7T5hpXCq\" rel=\"nofollow\">codes in other languages here</a> (I wrote only the ones in Python and Ruby).</p>\n\n<p>The question is - how to make it run faster?</p>\n"}, {"tags": ["haskell", "opengl"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1436876984, "post_id": 31402328, "comment_id": 50786784, "body": "Where are your shaders? What context version is it?"}], "answers": [{"tags": [], "owner": {"reputation": 20370, "user_id": 1364206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/16c1ef3ec3d82fb7e2eb80d479c64414?s=128&d=identicon&r=PG", "display_name": "Kai Sellgren", "link": "https://stackoverflow.com/users/1364206/kai-sellgren"}, "is_accepted": true, "score": 0, "last_activity_date": 1436883031, "creation_date": 1436883031, "answer_id": 31409121, "question_id": 31402328, "link": "https://stackoverflow.com/questions/31402328/rendering-a-texture-on-screen/31409121#31409121", "title": "Rendering a texture on screen", "body": "<p>It seems I had incorrect coordinates, because this works well:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>renderEntity :: Entity -&gt; IO ()\nrenderEntity e = do\n    GL.activeTexture GL.$= GL.TextureUnit 0\n    GL.textureBinding GL.Texture2D GL.$= Just (texture $ model e)\n    GL.renderPrimitive GL.Quads $ do\n       v 100 100\n       t 0 1\n       v 100 (-100)\n       t 1 1\n       v (-100) (-100)\n       t 1 0\n       v (-100) 100\n       t 0 0\n     where v x y = GL.vertex (GL.Vertex2 x y :: GL.Vertex2 GL.GLfloat)\n           t u v = GL.texCoord (GL.TexCoord2 u v :: GL.TexCoord2 GL.GLfloat)\n</code></pre>\n"}], "owner": {"reputation": 20370, "user_id": 1364206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/16c1ef3ec3d82fb7e2eb80d479c64414?s=128&d=identicon&r=PG", "display_name": "Kai Sellgren", "link": "https://stackoverflow.com/users/1364206/kai-sellgren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "accepted_answer_id": 31409121, "answer_count": 1, "score": 4, "last_activity_date": 1436883031, "creation_date": 1436864828, "question_id": 31402328, "link": "https://stackoverflow.com/questions/31402328/rendering-a-texture-on-screen", "title": "Rendering a texture on screen", "body": "<p>I'm new to both Haskell and OpenGL and I'm trying to render a texture on the screen.</p>\n\n<p>Here's what I've got so far:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>makeTexture :: FilePath -&gt; IO GL.TextureObject\nmakeTexture f = do\n    t &lt;- either error id &lt;$&gt; GLU.readTexture f\n    GL.textureFilter GL.Texture2D GL.$= ((GL.Linear', Nothing), GL.Linear')\n    GLU.texture2DWrap GL.$= (GL.Mirrored, GL.ClampToEdge)\n    return t\n\n\nrenderEntity :: Entity -&gt; IO ()\nrenderEntity e = do\n    GL.activeTexture GL.$= GL.TextureUnit 0\n    GL.textureBinding GL.Texture2D GL.$= Just (texture $ model e)\n    -- I see a white triangle on the screen.\n    renderTriangle $ fmap (vadd $ position e) (points $ model e :: [Vector2])\n\n    -- I do not see this. Nor is the triangle textured either.\n    GL.renderPrimitive GL.Quads $ do\n        n 0 1 0\n        t 0 1 &gt;&gt; v 10 (-10) 10\n        t 1 1 &gt;&gt; v 10 (-10) (-10)\n        t 1 0 &gt;&gt; v (-10) (-10) (-10)\n        t 0 0 &gt;&gt; v (-10) (-10) 10\n      where v x y z = GL.vertex (GL.Vertex3 x y z :: GL.Vertex3 GL.GLfloat)\n            n x y z = GL.normal (GL.Normal3 x y z :: GL.Normal3 GL.GLfloat)\n            t u v = GL.texCoord (GL.TexCoord2 u v :: GL.TexCoord2 GL.GLfloat)\n</code></pre>\n\n<p>Where <code>Entity</code> looks like:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>texMetal &lt;- makeTexture \"texture/metal.jpg\"\n\nlet \n    entity        = Entity\n      { angle = 0\n      , position = (0, 0) :: Vector2\n      , velocity = (5, 5) :: Vector2\n      , model = Model\n        { points = [(-60, -40), (60, -40), (0, 60)] :: [Vector2]\n        , texture = texMetal\n        }\n      }\n</code></pre>\n\n<p>And when I'm initializing I have these:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>GL.viewport   GL.$= (pos, size)\nGL.matrixMode GL.$= GL.Projection\nGL.texture    GL.Texture2D GL.$= GL.Enabled\nGL.normalize  GL.$= GL.Enabled\nGL.loadIdentity\nGL.ortho2D (-fromIntegral width / 2)\n           (fromIntegral width / 2)\n           (-fromIntegral height / 2)\n           (fromIntegral height / 2)\nGL.matrixMode GL.$= GL.Modelview 0\nGL.loadIdentity\n</code></pre>\n\n<p>And the resulting picture:</p>\n\n<p><img src=\"https://i.stack.imgur.com/POAqv.png\" alt=\"enter image description here\"></p>\n\n<p>It has two triangles because I have two 'entities' set in my code. But I don't see my quad nor do I see any sign of texturing.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1436855315, "creation_date": 1436855315, "answer_id": 31399243, "question_id": 31398994, "link": "https://stackoverflow.com/questions/31398994/not-in-scope-data-constructor-simple-code/31399243#31399243", "title": "Not in scope: data constructor simple code", "body": "<p>Functions may not start with an uppercase letter. Only types, type constructors, classes, modules or data constructors may start with an uppercase letter:</p>\n\n<pre><code>removeOdd nums =\n    if null nums\n    then []\n    else \n        if mod (head nums) 2 == 0\n        then (head nums) : (removeOdd (tail nums))\n        else removeOdd (tail nums)\n\nmain = removeOdd [1,2,3,4,5,6,7,8]\n</code></pre>\n\n<p>That being said, you should probably have a look at pattern matching, and <code>filter</code>, since <code>removeOdd = filter even</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 2638240, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100001717691584/picture?type=large", "display_name": "Aloska Averianov", "link": "https://stackoverflow.com/users/2638240/aloska-averianov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 31399243, "answer_count": 1, "score": -1, "last_activity_date": 1436855315, "creation_date": 1436854546, "question_id": 31398994, "link": "https://stackoverflow.com/questions/31398994/not-in-scope-data-constructor-simple-code", "title": "Not in scope: data constructor simple code", "body": "<p>My first program in haskell doesn't compile:</p>\n\n<pre><code>RemoveOdd nums =\n    if null nums\n    then []\n    else \n        if mod (head nums) 2 == 0\n        then (head nums) : (RemoveOdd (tail nums))\n        else RemoveOdd (tail nums)\n\nmain=RemoveOdd [1,2,3,4,5,6,7,8]        \n</code></pre>\n\n<p>my.hs:1:1: Not in scope: data constructor `RemoveOdd'</p>\n\n<p>my.hs:6:37: Not in scope: data constructor `RemoveOdd'</p>\n\n<p>my.hs:7:22: Not in scope: data constructor `RemoveOdd'</p>\n\n<p>my.hs:9:6: Not in scope: data constructor `RemoveOdd'</p>\n"}, {"tags": ["haskell", "free-monad", "church-encoding", "scott-encoding"], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1436905116, "creation_date": 1436905116, "answer_id": 31416479, "question_id": 31398516, "link": "https://stackoverflow.com/questions/31398516/how-do-i-use-the-church-encoding-for-free-monads/31416479#31416479", "title": "How do I use the Church encoding for Free Monads?", "body": "<p>Your</p>\n\n<pre><code>matchF\n  :: Functor f\n  =&gt; (a -&gt; r)\n  -&gt; (f (F f a) -&gt; r)\n  -&gt; F f a\n  -&gt; r\n</code></pre>\n\n<p>looks like the Scott-encoded Free monad. The Church-encoded version is just</p>\n\n<pre><code>matchF\n  :: Functor f\n  =&gt; (a -&gt; r)\n  -&gt; (f r -&gt; r)\n  -&gt; F f a\n  -&gt; r\nmatchF kp kf f = runF f kp kf\n</code></pre>\n\n<p>Here are Church- and Scott-encoded lists for comparison:</p>\n\n<pre><code>newtype Church a = Church { runChurch :: forall r. (a -&gt; r       -&gt; r) -&gt; r -&gt; r }\nnewtype Scott  a = Scott  { runScott  :: forall r. (a -&gt; Scott a -&gt; r) -&gt; r -&gt; r }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1436906763, "post_id": 31416537, "comment_id": 50806566, "body": "&quot;predecessor implemented using Church numeral is linear in the size of the natural number&quot; \u2014 there is a <a href=\"http://okmij.org/ftp/Haskell/car-fstream.lhs\" rel=\"nofollow noreferrer\">trick</a> (but <code>split_fstream</code> doesn&#39;t really deconstruct a list: zipping is still O(n^2) or maybe even worse, but you can zip infinite lists, i.e. the whole structure is not traversed)."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1436964927, "post_id": 31416537, "comment_id": 50832306, "body": "Thanks, that was interesting, but your open and close functions are similar to toF and fromF, and as I mentioned in the question, I already understand I can use them to solve the problem."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 1, "creation_date": 1436968218, "post_id": 31416537, "comment_id": 50834973, "body": "@Anupam Jain, they are quite different, since <code>open</code> and <code>close</code> are pure System F terms, while <code>toF</code> and <code>fromF</code> are not. I.e. gallais&#39; solution doesn&#39;t leave the Church-encoded world, while your leaves. And splitting the structure (splitting \u2014 not converting to another (like with <code>fromF</code>)) is necessary, if you want to use functions with Scott-like type signatures (like your <code>matchF</code>) on Church-encoded data (like <code>F</code>)."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1437019966, "post_id": 31416537, "comment_id": 50859232, "body": "I guess it&#39;s a philosophical distinction then. Because your Open data type is exactly the definition of Free (except using Either instead of Free). Thanks for an informative answer though!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 1, "creation_date": 1437029951, "post_id": 31416537, "comment_id": 50863073, "body": "@Anupam Jain, <code>Open</code> is non-recursive, <code>Free</code> is recursive."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1437042355, "post_id": 31416537, "comment_id": 50870728, "body": "Yep you are right! I glossed over the definition earlier."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1436905322, "creation_date": 1436905322, "answer_id": 31416537, "question_id": 31398516, "link": "https://stackoverflow.com/questions/31398516/how-do-i-use-the-church-encoding-for-free-monads/31416537#31416537", "title": "How do I use the Church encoding for Free Monads?", "body": "<p>It's a bit of a nasty one. This problem is a more general version of a puzzle everyone struggles with the first time they're exposed to it: defining the predecessor of a natural number encoded as a Church numeral (think: <code>Nat ~ Free Id ()</code>).</p>\n\n<p>I've split my module into a lot of intermediate definitions to highlight the solution's structure. I've also uploaded <a href=\"https://gist.github.com/gallais/f20ffe68d9282a2dd7c6\" rel=\"nofollow\">a self-contained gist</a> for ease of use.</p>\n\n<p>I start with nothing exciting: redefining <code>F</code> given that I don't have this package installed at the moment.</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\nmodule MatchFree where\n\nnewtype F f a = F { runF :: forall r. (a -&gt; r) -&gt; (f r -&gt; r) -&gt; r }\n</code></pre>\n\n<p>Now, even before considering pattern-matching, we can start by defining the counterpart of the usual datatype's constructors:</p>\n\n<pre><code>pureF :: a -&gt; F f a\npureF a = F $ const . ($ a)\n\nfreeF :: Functor f =&gt; f (F f a) -&gt; F f a\nfreeF f = F $ \\ pr fr -&gt; fr $ fmap (\\ inner -&gt; runF inner pr fr) f\n</code></pre>\n\n<p>Next, I'm introducing two types: <code>Open</code> and <code>Close</code>. <code>Close</code> is simply the <code>F</code> type but <code>Open</code> corresponds to having observed the content of an element of <code>F f a</code>: it's <code>Either</code> a pure <code>a</code> or an <code>f (F f a)</code>.</p>\n\n<pre><code>type Open  f a = Either a (f (F f a))\ntype Close f a = F f a\n</code></pre>\n\n<p>As hinted by my hand-wavy description, these two types are actually equivalent and we can indeed write functions converting back and forth between them:</p>\n\n<pre><code>close :: Functor f =&gt; Open f a -&gt; Close f a\nclose = either pureF freeF\n\nopen :: Functor f =&gt; Close f a -&gt; Open f a\nopen f = runF f Left (Right . fmap close)\n</code></pre>\n\n<p>Now, we can come back to your problem and the course of action should be pretty clear: <code>open</code> the <code>F f a</code> and then apply either <code>kp</code> or <code>kf</code> depending on what we got. And it indeed works:</p>\n\n<pre><code>matchF\n  :: Functor f\n  =&gt; (a -&gt; r)\n  -&gt; (f (F f a) -&gt; r)\n  -&gt; F f a\n  -&gt; r\nmatchF kp kf = either kp kf . open\n</code></pre>\n\n<p>Coming back to the original comment about natural numbers: predecessor implemented using Church numeral is <em>linear</em> in the size of the natural number when we could reasonably expect a simple case analysis to be constant time. Well, just like for natural numbers, this case analysis is pretty expensive because, as show by the use of <code>runF</code> in the definition of <code>open</code>, the <strong>whole</strong> structure is traversed.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 5, "last_activity_date": 1436907647, "creation_date": 1436907647, "answer_id": 31417279, "question_id": 31398516, "link": "https://stackoverflow.com/questions/31398516/how-do-i-use-the-church-encoding-for-free-monads/31417279#31417279", "title": "How do I use the Church encoding for Free Monads?", "body": "<p>Let me describe the difference for a simpler scenario - lists. Let's focus on how one can consume lists:</p>\n\n<ul>\n<li><p>By a <a href=\"https://en.wikipedia.org/wiki/Catamorphism\" rel=\"noreferrer\">catamorphism</a>, which essentially means that we can express it using</p>\n\n<pre><code>foldr :: (a -&gt; r -&gt; r) -&gt; r -&gt; [a] -&gt; r\n</code></pre>\n\n<p>As we can see, the folding functions never get hold of the list tail, only its processed value.</p></li>\n<li><p>By pattern matching we can do somewhat more, in particular we can construct a generalized fold of type</p>\n\n<pre><code>foldrGen :: (a -&gt; [a] -&gt; r) -&gt; r -&gt; [a] -&gt; r\n</code></pre>\n\n<p>It's easy to see that one can express <code>foldr</code> using <code>foldrGen</code>. However, as <code>foldrGen</code> isn't recursive, this expression involves recursion.</p></li>\n<li><p>To generalize both concepts, we can introduce</p>\n\n<pre><code>foldrPara :: (a -&gt; ([a], r) -&gt; r) -&gt; r -&gt; [a] -&gt; r\n</code></pre>\n\n<p>which gives the consuming function even more power: Both the reduced value of the tail, as well as the tail itself. Clearly this is more generic than both previous ones. This corresponds to a <a href=\"https://en.wikipedia.org/wiki/Paramorphism\" rel=\"noreferrer\">paramorphism</a> which \u201ceats its argument and keeps it too\u201d.</p></li>\n</ul>\n\n<p>But it's also possible to do it the other way round. Even though paramorphisms are more general, they can be expressed using catamorphisms (at some overhead cost) by re-creating the original structure on the way:</p>\n\n<pre><code>foldrPara :: (a -&gt; ([a], r) -&gt; r) -&gt; r -&gt; [a] -&gt; r\nfoldrPara f z = snd . foldr f' ([], z)\n  where\n    f' x t@(xs, r) = (x : xs, f x t)\n</code></pre>\n\n<p>Now Church-encoded data structures encode the catamorphism pattern, for lists it's everything that can be constructed using <code>foldr</code>:</p>\n\n<pre><code>newtype List a = L (forall r . r -&gt; (a -&gt; r -&gt; r) -&gt; r)\n\nnil :: List a\nnil = L $ \\n _ -&gt; n\n\ncons :: a -&gt; List a -&gt; List a\ncons x (L xs) = L $ \\n c -&gt; c x (xs n c)\n\nfromL :: List a -&gt; [a]\nfromL (L f) = f [] (:)\n\ntoL :: [a] -&gt; List a\ntoL xs = L (\\n c -&gt; foldr c n xs)\n</code></pre>\n\n<p>In order to see the sub-lists, we have take the same approach: re-create them on the way:</p>\n\n<pre><code>foldrParaL :: (a -&gt; (List a, r) -&gt; r) -&gt; r -&gt; List a -&gt; r\nfoldrParaL f z (L l) = snd $ l (nil, z) f'\n  where\n    f' x t@(xs, r) = (x `cons` xs, f x t)\n</code></pre>\n\n<hr>\n\n<p>This applies generally to Church-encoded data structures, like to the encoded free monad. They express catamorphisms, that is folding without seeing the parts of the structure, only with the recursive results. To get hold of sub-structures during the process, we need to recreate them on the way.</p>\n"}, {"comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 2, "creation_date": 1436964692, "post_id": 31418011, "comment_id": 50832122, "body": "That was very helpful! Thanks!"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 10, "last_activity_date": 1491459430, "last_edit_date": 1491459430, "creation_date": 1436910638, "answer_id": 31418011, "question_id": 31398516, "link": "https://stackoverflow.com/questions/31398516/how-do-i-use-the-church-encoding-for-free-monads/31418011#31418011", "title": "How do I use the Church encoding for Free Monads?", "body": "<p>You asked for the \"general pattern you are missing\". Let me give my own attempt at explaining it, though Petr Pudl\u00e1k's answer is also pretty good. As user3237465 says, there are two encodings that we can use, Church and Scott, and you're using Scott rather than Church. So here's the general review.</p>\n\n\n\n<h1>How encodings work</h1>\n\n<p>By continuation passing, we can describe any value of type <code>x</code> by some unique function of type</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Identity x = Id { runId :: x } \n{- ~ - equivalent to - ~ -} \nnewtype IdentityFn x = IdFn { runIdFn ::  forall z. (x -&gt; z) -&gt; z }\n</code></pre>\n\n<p>The \"forall\" here is very important, it says that this type leaves <code>z</code> as an unspecified parameter. The bijection is that <code>Id . ($ id) . runIdFn</code> goes from <code>IdentityFn</code> to <code>Identity</code> while <code>IdFn . flip ($) . runId</code> goes the other way. The equivalence comes because there is essentially nothing one can do with the type <code>forall z. z</code>, no manipulations are sufficiently universal. We can equivalently state that <code>newtype UnitFn = UnitFn { runUnitFn :: forall z. z -&gt; z }</code> has only one element, namely <code>UnitFn id</code>, which means that it corresponds to the unit type <code>data Unit = Unit</code> in a similar way.</p>\n\n<p>Now the currying observation that <code>(x, y) -&gt; z</code> is isomorphic to <code>x -&gt; y -&gt; z</code> is the tip of a continuation-passing iceberg which allows us to represent data structures in terms of pure functions, with no data structures, because clearly the type <code>Identity (x, y)</code> is equivalent therefore to <code>forall z. (x -&gt; y -&gt; z) -&gt; z</code>. So \"gluing\" together two items is the same as creating a value of this type, which just uses pure functions as \"glue\".</p>\n\n<p>To see this equivalence, we have to just handle two other properties. </p>\n\n<p>The first is sum-type constructors, in the form of <code>Either x y -&gt; z</code>. See, <code>Either x y -&gt; z</code> is isomorphic to </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype EitherFn x y = EitherFn { runEitherFn :: forall z. (x -&gt; z) -&gt; (y -&gt; z) -&gt; z }\n</code></pre>\n\n<p>from which we get the basic idea of the pattern:</p>\n\n<ol>\n<li>Take a fresh type variable <code>z</code> that does not appear in the body of the expression.</li>\n<li>For each constructor of the data type, create a function-type which takes all of its type-arguments as parameters, and returns a <code>z</code>. Call these \"handlers\" corresponding to the constructors. So the handler for <code>(x, y)</code> is <code>(x, y) -&gt; z</code> which we curry to <code>x -&gt; y -&gt; z</code>, and the handlers for <code>Left x | Right y</code> are <code>x -&gt; z</code> and <code>y -&gt; z</code>. If there are no parameters, you can just take a value <code>z</code> as your function rather than the more cumbersome <code>() -&gt; z</code>. </li>\n<li>Take all of those handlers as parameters to an expression <code>forall z. Handler1 -&gt; Handler2 -&gt; ... -&gt; HandlerN -&gt; z</code>.</li>\n<li>One half of the isomorphism is basically just to hand the constructors in as the desired handlers; the other pattern-matches on the constructors and applies the correponding handlers.</li>\n</ol>\n\n<h2>Subtle missing things</h2>\n\n<p>Again, it's fun to apply these rules to various things; for example as I noted above, if you apply this to <code>data Unit = Unit</code> you find that any unit type is the identity function <code>forall z. z -&gt; z</code>, and if you apply this to <code>data Bool = False | True</code> you find the logic functions <code>forall z. z -&gt; z -&gt; z</code> where <code>false = const</code> while <code>true = const id</code>. But if you do play with it you will notice that something's missing still. Hint: if we look at </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data List x = Nil | Cons x (List x)\n</code></pre>\n\n<p>we see that the pattern should look like: </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data ListFn x = ListFn { runListFn :: forall z. z -&gt; (x -&gt; ??? -&gt; z) -&gt; z }\n</code></pre>\n\n<p>for some <code>???</code>. The above rules don't pin down what goes there. </p>\n\n<p>There are two good options: either we use the power of the <code>newtype</code> to its fullest to put <code>ListFn x</code> there (the \"Scott\" encoding), or we can preemptively reduce it with the functions we've been given, in which case it becomes a <code>z</code> using the functions that we already have (the \"Church\" encoding). Now since the recursion is already being performed for us up-front, the Church encoding is only perfectly equivalent for <em>finite</em> data structures; the Scott encoding can handle infinite lists and such. It can also be hard to understand how to encode mutual recursion in the Church form whereas the Scott form is usually a little more straightforward.</p>\n\n<p>Anyway, the Church encoding is a little harder to think about, but a little more magical because we get to approach it with wishful thinking: \"assume that this <code>z</code> is already whatever you're trying to accomplish with <code>tail list</code>, then combine it with <code>head list</code> in the appropriate way.\" And this wishful thinking is precisely why people have trouble understanding <code>foldr</code>, as the one side of this bijection is precisely the <code>foldr</code> of the list. </p>\n\n<p>There are some other problems like \"what if, like <code>Int</code> or <code>Integer</code>, the number of constructors is big or infinite?\". The answer to this particular question is to use the functions</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data IntFn = IntFn { runIntFn :: forall z. (z -&gt; z) -&gt; z -&gt; z }\n</code></pre>\n\n<p>What is this, you ask? Well, a smart person (Church) has worked out that this is a way to represent integers as the repetition of composition: </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>zero f x = x\none f x = f x\ntwo f x = f (f x)\n{- ~ - increment an `n` to `n + 1` - ~ -}\nsucc n f = f . n f\n</code></pre>\n\n<p>Actually on this account <code>m . n</code> is the product of the two.  But I mention this because it is not too hard to insert a <code>()</code> and flip arguments around to find that this is actually <code>forall z. z -&gt; (() -&gt; z -&gt; z) -&gt; z</code> which is the list type <code>[()]</code>, with values given by <code>length</code> and addition given by <code>++</code> and multiplication given by <code>&gt;&gt;</code>. </p>\n\n<p>For greater efficiency, you might Church-encode <code>data PosNeg x = Neg x | Zero | Pos x</code> and use the Church encoding (keeping it finite!) of <code>[Bool]</code> to form the Church encoding of <code>PosNeg [Bool]</code> where each <code>[Bool]</code> implicitly ends with an unstated <code>True</code> at its most-significant bit at the end, so that <code>[Bool]</code> represents the numbers from +1 to infinity.</p>\n\n<h2>An extended example: BinLeaf / BL</h2>\n\n<p>One more nontrivial example, we might think about the binary tree which stores all of its information in leaves, but also contains annotations on the internal nodes: <code>data BinLeaf a x = Leaf x | Bin a (BinLeaf a x) (BinLeaf a x)</code>. Following the recipe for Church encoding we do:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype BL a x = BL { runBL :: forall z. (x -&gt; z) -&gt; (a -&gt; z -&gt; z -&gt; z) -&gt; z}\n</code></pre>\n\n<p>Now instead of <code>Bin \"Hello\" (Leaf 3) (Bin \"What's up?\" (Leaf 4) (Leaf 5)</code> we construct instances in lowercase:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>BL $ \\leaf bin -&gt; bin \"Hello\" (leaf 3) (bin \"What's up?\" (leaf 4) (leaf 5)\n</code></pre>\n\n<p>The isomorphism is thus very easy one way: <code>binleafFromBL f = runBL f Leaf Bin</code>. The other side has a case dispatch, but is not too bad.</p>\n\n<p>What about recursive algorithms on the recursive data? This is where it gets magical: <code>foldr</code> and <code>runBL</code> of Church encoding have both run whatever our functions were on the subtrees before we get to the trees themselves. Suppose for example that we want to emulate this function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sumAnnotate :: (Num n) =&gt; BinLeaf a n -&gt; BinLeaf (n, a) n\nsumAnnotate (Leaf n) = Leaf n\nsumAnnotate (Bin a x y) = Bin (getn x' + getn y', a) x' y' \n    where x' = sumAnnotate x\n          y' = sumAnnotate y\n          getn (Leaf n) = n\n          getn (Bin (n, _) _ _) = n\n</code></pre>\n\n<p>What do we have to do?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- pseudo-constructors for BL a x.\nmakeLeaf :: x -&gt; BL a x\nmakeLeaf x = BL $ \\leaf _ -&gt; leaf x\n\nmakeBin :: a -&gt; BL a x -&gt; BL a x -&gt; BL a x\nmakeBin a l r = BL $ \\leaf bin -&gt; bin a (runBL l leaf bin) (runBL r leaf bin)\n\n-- actual function\nsumAnnotate' :: (Num n) =&gt; BL a n -&gt; BL n n\nsumAnnotate' f = runBL f makeLeaf (\\a x y -&gt; makeBin (getn x + getn y, a) x y) where\n    getn t = runBL t id (\\n _ _ -&gt; n)\n</code></pre>\n\n<p>We pass in a function <code>\\a x y -&gt; ... :: (Num n) =&gt; a -&gt; BL (n, a) n -&gt; BL (n, a) n -&gt; BL (n, a) n</code>. Notice that the two \"arguments\" are of the same type as the \"output\" here. With Church encoding, <strong>we have to program as if we've already succeeded</strong> -- a discipline called \"wishful thinking\".</p>\n\n<h1>The Church encoding for the Free monad</h1>\n\n<p>The Free monad has normal form</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Free f x = Pure x | Roll f (Free f x)\n</code></pre>\n\n<p>and our Church encoding procedure says that this becomes:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Fr f x = Fr {runFr :: forall z. (x -&gt; z) -&gt; (f z -&gt; z) -&gt; z}\n</code></pre>\n\n<p>Your function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>matchFree p _ (Pure x) = p x\nmatchFree _ f (Free x) = f x\n</code></pre>\n\n<p>becomes simply</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>matchFree' p f fr = runFr fr p f\n</code></pre>\n"}], "owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 4, "accepted_answer_id": 31418011, "answer_count": 4, "score": 10, "last_activity_date": 1557362206, "creation_date": 1436852745, "last_edit_date": 1557362206, "question_id": 31398516, "link": "https://stackoverflow.com/questions/31398516/how-do-i-use-the-church-encoding-for-free-monads", "title": "How do I use the Church encoding for Free Monads?", "body": "<p>I've been using the <code>Free</code> datatype in <code>Control.Monad.Free</code> from the <code>free</code> package. Now I'm trying to convert it to use <code>F</code> in <code>Control.Monad.Free.Church</code> but can't figure out how to map the functions.</p>\n\n<p>For example, a simple pattern matching function using <code>Free</code> would look like this -</p>\n\n<pre><code>-- Pattern match Free\nmatchFree\n  :: (a -&gt; r)\n  -&gt; (f (Free f a) -&gt; r)\n  -&gt; Free f a\n  -&gt; r\nmatchFree kp _ (Pure a) = kp a\nmatchFree _ kf (Free f) = kf f\n</code></pre>\n\n<p>I can easily convert it to a function that uses <code>F</code> by converting to/from <code>Free</code> -</p>\n\n<pre><code>-- Pattern match F (using toF and fromF)\nmatchF\n  :: Functor f\n  =&gt; (a -&gt; r)\n  -&gt; (f (F f a) -&gt; r)\n  -&gt; F f a\n  -&gt; r\nmatchF kp kf = matchF' . fromF\n  where\n    matchF' (Pure a) = kp a\n    matchF' (Free f) = kf (fmap toF f)\n</code></pre>\n\n<p>However I can't figure out how to get it done without using <code>toF</code> and <code>fromF</code> -</p>\n\n<pre><code>-- Pattern match F (without using toF)???\n-- Doesn't compile\nmatchF\n  :: Functor f\n  =&gt; (a -&gt; r)\n  -&gt; (f (F f a) -&gt; r)\n  -&gt; F f a\n  -&gt; r\nmatchF kp kf f = f kp kf\n</code></pre>\n\n<p>There must be a general pattern I am missing. Can you help me figure it out?</p>\n"}, {"tags": ["haskell", "audio", "io", "pulseaudio"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1436852498, "last_edit_date": 1436852498, "creation_date": 1436852127, "answer_id": 31398390, "question_id": 31397655, "link": "https://stackoverflow.com/questions/31397655/saving-a-pulse-audio-stream-with-haskell-bindings/31398390#31398390", "title": "Saving a Pulse Audio stream with Haskell bindings", "body": "<p>Seems like the <code>Data.WAVE</code> module from the <a href=\"http://hackage.haskell.org/package/WAVE-0.1.3/docs/Data-WAVE.html\" rel=\"nofollow\">WAVE package</a> should do the job.</p>\n\n<p>Convert your <code>[Float]</code> to <code>[Int32]</code> and that constitutes the <code>waveSamples</code> field of the <code>WAVE</code> record. Fill in the rest of the <code>WAVEHeader</code> and write the file using <code>putWAVEFile</code>.</p>\n\n<pre><code>import Data.WAVE\n\nwriteWaveFile :: String -&gt; [Float] -&gt; IO ()\nwriteWaveFile path floats = putWAVEFile path wave\n  where wave = WAVE wHeader wSamples\n        wHeader = WAVEHeader { waveNumChannels = 1\n                             , waveFrameRate = 44100\n                             , waveBitsPerSample = 32 -- or maybe 8?\n                             , waveFrames = Nothing\n                             }\n        wSamples = [[ ... | x &lt;- floats ]]\n</code></pre>\n\n<p>Fill in <code>...</code> with a suitable <code>Float -&gt; Int32</code> function.</p>\n"}], "owner": {"reputation": 221, "user_id": 4005988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84134c950b0b002689b67c899f051deb?s=128&d=identicon&r=PG", "display_name": "HEGX64", "link": "https://stackoverflow.com/users/4005988/hegx64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1436852498, "creation_date": 1436848084, "question_id": 31397655, "link": "https://stackoverflow.com/questions/31397655/saving-a-pulse-audio-stream-with-haskell-bindings", "title": "Saving a Pulse Audio stream with Haskell bindings", "body": "<p>Using the <a href=\"https://hackage.haskell.org/package/pulse-simple\" rel=\"nofollow\">pulse-simple</a> package I have made the following code:</p>\n\n<pre><code>main=do\n    s&lt;-simpleNew Nothing \"example\" Record Nothing \"this is an example application\"\n      (SampleSpec (F32 LittleEndian) 44100 1) Nothing Nothing\n    xs&lt;-simpleRead s $ 44100*10 :: IO [Float]\n    simpleFree s\n    play xs\n\nplay :: [Float] -&gt; IO ()\nplay d = do\n    s&lt;-simpleNew Nothing \"example\" Play Nothing \"this is an example application\"\n        (SampleSpec (F32 LittleEndian) 44100 1) Nothing Nothing\n    simpleWrite s d\n    simpleDrain s\n    simpleFree s\n</code></pre>\n\n<p>This works and records 10 seconds of audio and then plays it back.</p>\n\n<p>I now want to encode and save the audio file (as a .wav rr whatever) so it can be played in another program or converted. I think that this is more of an audio question so for the non Haskell people I basically have an array of floats which is 44100*10 long. I suspect I'll need some other library.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1436821682, "post_id": 31393419, "comment_id": 50763338, "body": "Please change the title of your question. &quot;What am I doing wrong&quot; doesn&#39;t tell anyone anything about the contents of your question."}, {"owner": {"reputation": 1119, "user_id": 2796613, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1286068684/picture?type=large", "display_name": "Hernan", "link": "https://stackoverflow.com/users/2796613/hernan"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436821961, "post_id": 31393419, "comment_id": 50763476, "body": "You are right, i changed it."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436822666, "post_id": 31393560, "comment_id": 50763796, "body": "It won&#39;t. That&#39;s what the second part of the answer is for."}, {"owner": {"reputation": 1119, "user_id": 2796613, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1286068684/picture?type=large", "display_name": "Hernan", "link": "https://stackoverflow.com/users/2796613/hernan"}, "edited": false, "score": 0, "creation_date": 1436823771, "post_id": 31393560, "comment_id": 50764294, "body": "Thanks @Cubic! Another question. Lets say that i dont wont to use uncurry and i can change the function...if i change it to <code>mapo::(Float-&gt;Float-&gt;Float)-&gt;[(Float,Float)]-&gt;[Float]</code> Im receiving an error at compile time. How would you do it?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436823838, "post_id": 31393560, "comment_id": 50764315, "body": "Just do the uncurry in <code>mapo</code>."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 3, "last_activity_date": 1436821828, "creation_date": 1436821828, "answer_id": 31393560, "question_id": 31393419, "link": "https://stackoverflow.com/questions/31393419/error-passing-parameters-through-haskell-function/31393560#31393560", "title": "Error passing parameters through haskell function", "body": "<p>Your problem is merely a syntactic error; When you want to partially apply an operator you need to wrap it in parentheses; So instead of </p>\n\n<pre><code>mapo + [(1,2)]\n</code></pre>\n\n<p>write</p>\n\n<pre><code>mapo (+) [(1,2)]\n</code></pre>\n\n<p>Otherwise it parses as adding <code>mapo</code> to <code>[(1,2)]</code> (i.e. <code>(+) mapo [(1,2)]</code> which is clearly not what you want.</p>\n\n<p>Next thing is getting the type right: </p>\n\n<p><code>(+) :: Float -&gt; Float -&gt; Float</code> (in your case, its real type is more general) - but your function wants <code>(Float,Float) -&gt; Float</code>. These two types aren't equal, but they express pretty much the same thing so you can easily map between them with the <code>curry :: ((a,b) -&gt; c) -&gt; a -&gt; b -&gt; c</code> and <code>uncurry :: (a -&gt; b -&gt; c) -&gt; (a,b) -&gt; c</code> functions. In this case you need to pass <code>uncurry (+)</code> to your <code>mapo</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1436821935, "creation_date": 1436821935, "answer_id": 31393593, "question_id": 31393419, "link": "https://stackoverflow.com/questions/31393419/error-passing-parameters-through-haskell-function/31393593#31393593", "title": "Error passing parameters through haskell function", "body": "<p><code>(+)</code> does not have type <code>(Float, Float) -&gt; Float</code>, but <code>uncurry (+)</code> does:</p>\n\n<pre><code>mapo (uncurry (+)) [(1,2)]\n\n-&gt; [3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "is_accepted": false, "score": 0, "last_activity_date": 1436821994, "creation_date": 1436821994, "answer_id": 31393603, "question_id": 31393419, "link": "https://stackoverflow.com/questions/31393419/error-passing-parameters-through-haskell-function/31393603#31393603", "title": "Error passing parameters through haskell function", "body": "<pre><code>*Main&gt; mapo (\\(a,b) -&gt; a+b) [(1,2)]\n[3.0]\n</code></pre>\n\n<p>Your problem is that mapo expects a function of the tuple <code>(Float,Float)</code> but addition is a function on two <code>Floats</code>, rather than a tuple.</p>\n\n<pre><code>*Main&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>You can use <code>mapo</code> as-is, as long as you remember to pass it a function which expects <code>(Float,Float)</code> and returns <code>Float</code>.</p>\n"}], "owner": {"reputation": 1119, "user_id": 2796613, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1286068684/picture?type=large", "display_name": "Hernan", "link": "https://stackoverflow.com/users/2796613/hernan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 31393560, "answer_count": 3, "score": 0, "last_activity_date": 1436874536, "creation_date": 1436821319, "last_edit_date": 1436874536, "question_id": 31393419, "link": "https://stackoverflow.com/questions/31393419/error-passing-parameters-through-haskell-function", "title": "Error passing parameters through haskell function", "body": "<p>I'm receiving an error and don't know why.</p>\n\n<pre><code>mapo :: ((Float, Float) -&gt; Float) -&gt; [(Float, Float)] -&gt; [Float]\nmapo f [] = []\nmapo f (x:y) = f x : mapo f y\n</code></pre>\n\n<p>Compiles ok.</p>\n\n<pre><code>*Main&gt; mapo + [(1,2)]\n\nCouldn't match type `(Float, Float) -&gt; (Float, Float)' with `Float'\nExpected type: (Float, Float) -&gt; Float\n  Actual type: (Float, Float) -&gt; (Float, Float) -&gt; (Float, Float)\nIn the first argument of `mapo', namely `(+)'\nIn the expression: mapo (+) [(1, 2)]\nIn an equation for `it': it = mapo (+) [(1, 2)]\n</code></pre>\n\n<p>The purpose of this function is to receive an operator (let's say <code>+</code> or <code>-</code>), a list of pairs of numbers (<code>Float</code>) and return the result of using that operator with each of the pairs of parameters of the list.</p>\n"}, {"tags": ["haskell", "ghc", "stackage", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1436820938, "creation_date": 1436820938, "answer_id": 31393300, "question_id": 31393189, "link": "https://stackoverflow.com/questions/31393189/why-doesnt-stack-add-packages-to-the-ghc-package-database/31393300#31393300", "title": "Why doesn&#39;t stack add packages to the ghc package database?", "body": "<p>Stack never touches global packages database. It uses layered database approach</p>\n\n<ol>\n<li>global database - untouched</li>\n<li>packages in the <a href=\"http://www.stackage.org/\">stackage</a> snapshot are installed into snapshot database</li>\n<li>other packages are installed locally per project</li>\n</ol>\n\n<p>Thus instead of polluting global database, most packages are installed in snapshot database(s), so most packages can be shared. As packages in stackage snapshots are compatible (i.e. always compile together), we don't run into <em>Cabal hell</em>.</p>\n\n<p>You can use <code>stack ghci</code> or <code>stack ghc</code> to run corresponding commands with package database configured.</p>\n\n<p>The more precise explanation is in the <a href=\"https://github.com/commercialhaskell/stack/wiki/Architecture#databases\">stack wiki</a></p>\n"}], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 1, "accepted_answer_id": 31393300, "answer_count": 1, "score": 6, "last_activity_date": 1436904013, "creation_date": 1436820564, "last_edit_date": 1436904013, "question_id": 31393189, "link": "https://stackoverflow.com/questions/31393189/why-doesnt-stack-add-packages-to-the-ghc-package-database", "title": "Why doesn&#39;t stack add packages to the ghc package database?", "body": "<p>I've decided to try giving stack a shot. I've installed it and used it to install the latest version of ghc. I've used stack to install some packages but the packages are not visible to ghc and when I list packages with ghc-pkg I see that the packages that I've installed through stack are not there. Why is this? Am I misunderstanding the purpose of stack?</p>\n"}, {"tags": ["python", "haskell", "pyparsing", "parsec"], "comments": [{"owner": {"reputation": 3013, "user_id": 2215919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56acf65278ba1b47c7630ba68b456184?s=128&d=identicon&r=PG", "display_name": "CoupleWavyLines", "link": "https://stackoverflow.com/users/2215919/couplewavylines"}, "edited": false, "score": 0, "creation_date": 1436819402, "post_id": 31392505, "comment_id": 50762175, "body": "Would you be able to show &quot;actual Python result&quot; vs &quot;desired Python result&quot; for those not familiar with Haskell?"}], "answers": [{"comments": [{"owner": {"reputation": 55852, "user_id": 165216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U7Xse.jpg?s=128&g=1", "display_name": "PaulMcG", "link": "https://stackoverflow.com/users/165216/paulmcg"}, "edited": false, "score": 0, "creation_date": 1436822812, "post_id": 31393431, "comment_id": 50763859, "body": "This works very nicely - Groups will keep multiple results with the same name from clashing."}, {"owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 0, "creation_date": 1436823591, "post_id": 31393431, "comment_id": 50764218, "body": "That&#39;s was I was looking for!"}], "tags": [], "owner": {"reputation": 3013, "user_id": 2215919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56acf65278ba1b47c7630ba68b456184?s=128&d=identicon&r=PG", "display_name": "CoupleWavyLines", "link": "https://stackoverflow.com/users/2215919/couplewavylines"}, "is_accepted": true, "score": 2, "last_activity_date": 1436821351, "creation_date": 1436821351, "answer_id": 31393431, "question_id": 31392505, "link": "https://stackoverflow.com/questions/31392505/acccumulate-using-pyparsing/31393431#31393431", "title": "acccumulate using pyparsing", "body": "<p>I'm not 100% sure I understand what you're asking, and am rusty with pyparsing, but I think <a href=\"https://pythonhosted.org/pyparsing/pyparsing.pyparsing.Group-class.html\" rel=\"nofollow\"><code>Group</code></a> will help you.</p>\n\n<pre><code>from pyparsing import *\n\ntext = 'abc123xyz456def789'\nfoo = Word(alphas)\nbar = Word(nums)\nfun = OneOrMore(Group(foo.setResultsName(\"foo\") + bar.setResultsName(\"bar\")))\n\nresults = fun.parseString(text)\n\n#Print all foo\nprint [r.foo for r in results]\n#Print all bar\nprint [r.bar for r in results]\n</code></pre>\n"}], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 31393431, "answer_count": 1, "score": 2, "last_activity_date": 1436824185, "creation_date": 1436818218, "last_edit_date": 1436824185, "question_id": 31392505, "link": "https://stackoverflow.com/questions/31392505/acccumulate-using-pyparsing", "title": "acccumulate using pyparsing", "body": "<p>I have some data that can be parsed using the <code>OneorMore</code> function from pyparsing. Something like,</p>\n\n<pre><code>fun = OneorMore( foo.setResultsName(\"foo\") +  bar.setResultsname(\"bar\") )\n</code></pre>\n\n<p>where <code>bar</code> and <code>foo</code> are 2 parsers.</p>\n\n<p>The problem with this function is that everytime that <code>OneorMore</code> match foo and bar parsers in the data stream, the corresponding values associated with the keys <code>\"foo\"</code> and <code>\"bar\"</code> are updated.But, \nhow can I accumulate all the matched values of <code>foo</code> and <code>bar</code>?</p>\n\n<p>I'm trying to implement something like the <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec.html\" rel=\"nofollow\">many1</a> monadic parser in Haskell, saving the result of parsing <code>foo</code> and <code>bar</code> in an Algebraic Data type, like</p>\n\n<pre><code>data FooBar a = FooBar a a\n\nmany1 :: ParsecT s u m a -&gt; ParsecT s u m [a]\n\nmany1 parserFooBar :: ParsecT s u m [FooBar a]\n</code></pre>\n\n<p>How can I do this in python?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1436840204, "post_id": 31392378, "comment_id": 50768868, "body": "luqui explains the essence of the problem, but note also that the class context on your <code>unWT</code> function does nothing whatsoever useful."}, {"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1436845433, "post_id": 31392378, "comment_id": 50770052, "body": "@dfeuer - I&#39;d disagree, but please elaborate, possibly in the form of an answer. I define such unwrappers/runners all the time rather than using record syntax."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1436846492, "post_id": 31392378, "comment_id": 50770322, "body": "If you delete the class context from that function type, it will continue to work in all situations where it does now, but will also work in others. Under the hood, it takes two instance dictionary arguments which it then ignores completely. I&#39;m not going to make that an answer because it&#39;s not the cause of your problem, which luqui resolves adequately."}, {"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436846700, "post_id": 31392378, "comment_id": 50770374, "body": "Aah, I see what you mean! Thank you. I was just trying to be picky :-)"}], "answers": [{"comments": [{"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1436865180, "post_id": 31392582, "comment_id": 50778999, "body": "What an eye opener! Thank you. Letting aside the fact that bind in this case is impossible, what would you say of the code I wrote to extract (mb,w2) by nesting a do-notation that deep? Is it allowed? Is it frowned upon? Could it be rewritten in a &quot;better&quot; way?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 1, "creation_date": 1436879528, "post_id": 31392582, "comment_id": 50788799, "body": "Stylistically it&#39;s fine. I would have used explicit bind operations probably, but I have seen others do this and don&#39;t think poorly of it."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1436843454, "last_edit_date": 1436843454, "creation_date": 1436818476, "answer_id": 31392582, "question_id": 31392378, "link": "https://stackoverflow.com/questions/31392378/defining-bind-for-home-made-monad-transformer/31392582#31392582", "title": "Defining bind for home-made monad transformer", "body": "<p>Imagine the following computation:</p>\n\n<pre><code>tellLine :: WT String IO ()\ntellLine = do\n    input &lt;- WT (getLine, \"\")\n    WT (return (), input)\n\nimpossible :: String\nimpossible = snd (unWT tellLine)\n</code></pre>\n\n<p>If this works as \"expected\", we should get that <code>impossible</code> is the string that the user entered. However, we cannot do this outside of <code>IO</code>; such an <code>impossible</code> could not be a pure <code>String</code> as it is here.  So it is not possible to yield a <code>w</code> that was recieved as the result of a computation in the monad.</p>\n\n<p>Another possibility is simply to return the <code>w</code> that occurred before the first bind, so we don't have to depend on any monadic actions.  Alas, one of the identity laws thwarts us.</p>\n\n<pre><code>return x &gt;&gt;= f = f x\n</code></pre>\n\n<p>Here we can see that \"before the first bind\" cannot be a meaningful concept, since there is a bind on the left but not on the right.  So returning the <code>w</code> that occurs before the first bind will surely violate this monad law.</p>\n\n<p>The only remaining possibility is for the <code>w</code> to always be <code>mempty</code>.  But this does not work either, because of the other identity law.</p>\n\n<pre><code>m &gt;&gt;= return = m\n</code></pre>\n\n<p>so if <code>m</code> has a non-<code>mempty</code> value of <code>w</code>, the bind would annihilate it and violate this law.</p>\n\n<p>This <code>WT</code> cannote be a monad transformer.  There is a <code>WriterT</code> transfomer, but it is defined as <code>m (a,w)</code> which avoids these problems.</p>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 31392582, "answer_count": 1, "score": 3, "last_activity_date": 1436843454, "creation_date": 1436817743, "last_edit_date": 1436818172, "question_id": 31392378, "link": "https://stackoverflow.com/questions/31392378/defining-bind-for-home-made-monad-transformer", "title": "Defining bind for home-made monad transformer", "body": "<p>I have defined my own version of WriterT along with a function to unwrap it:</p>\n\n<pre><code>newtype WT w m a = WT (m a, w)\n\nunWT :: (Monoid w, Monad m) =&gt; WT w m a -&gt; (m a, w)\nunWT (WT cmaw) = cmaw\n</code></pre>\n\n<p>Now I am trying to define the monad <code>(WT w m)</code>, without success:</p>\n\n<pre><code>instance (Monoid w, Monad m) =&gt; Monad (WT w m) where\n  return x = WT (return x, mempty)\n  wtwma &gt;&gt;= fawtwmb = WT $ let (ma, w1) = unWT wtwma\n                               (mb, w2) = unWT $ do a &lt;- ma\n                                                    fawtwmb a\n                           in (mb, mappend w1 w2)\n</code></pre>\n\n<p>Error is located in the do-expression, at the point where I try to extract <code>a</code> from <code>ma</code>:</p>\n\n<pre><code>Expected type: WT w m a, Actual type: m a\n</code></pre>\n\n<p>I have tried a few variations, always with similar outcome. I am unable to define <code>bind</code> for this monad.</p>\n\n<p>My main question is: <strong>if the monad is inside a couple, how do I extract its value?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1436814348, "post_id": 31391358, "comment_id": 50759438, "body": "For <code>Either</code> there are lots of functions that do the pattern matching for you in <code>Data.Either</code>.  For example, <a href=\"https://www.haskell.org/hoogle/?hoogle=rights\" rel=\"nofollow noreferrer\"><code>rights</code></a>.  Is this sort of what you want?  How about <code>either print print</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1436816404, "post_id": 31391358, "comment_id": 50760531, "body": "Also, you might want to check out <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">monad transformers</a> (in particular <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error.html#v:ErrorT\" rel=\"nofollow noreferrer\"><code>ErrorT e IO</code></a>)."}, {"owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "edited": false, "score": 0, "creation_date": 1436819267, "post_id": 31391358, "comment_id": 50762098, "body": "Thanks. Monad transformers are exactly what I&#39;m looking for."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1436820072, "post_id": 31391358, "comment_id": 50762520, "body": "Just don&#39;t go nuts lifting functions and going in/out of transformers - that is sometimes a strong sign you haven&#39;t made a sufficient set of functions to support your level of abstraction.  In short - doing lots of lifting makes Peter a dull boy; pick a monad stack, make an API (sort of a DSL almost) and be content."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1436820041, "creation_date": 1436820041, "answer_id": 31393036, "question_id": 31391358, "link": "https://stackoverflow.com/questions/31391358/either-propagation-with-io/31393036#31393036", "title": "&#39;Either&#39; propagation with IO()", "body": "<p>Here's how to do it with <code>runEitherT</code> which requires some lifting and hoisting to get the types right:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Control.Error\n\nimport Data.List (isInfixOf)\n\ntype Entry = String\ntype Result a = Either String a\n\nsampleEntries = [ \"good 1\", \"good 2\", \"good 3\", \"bad 4\", \"good 5\", \"bad 6\", \"good 7\" ]\n\ngetEntries :: Int -&gt; IO (Result [Entry])\ngetEntries n = if n &gt;= 0 &amp;&amp; n &lt;= length sampleEntries\n                 then return $ Right $ take n sampleEntries\n                 else return $ Left $ \"invalid n: \" ++ show n\n\nfilterEntries :: [Entry] -&gt; Result [Entry]\nfilterEntries ents = if all isGood ents\n                       then Right $ ents\n                       else Left \"found a bad entry\"\n  where isGood str = isInfixOf \"good\" str\n\nprintEntries :: [Entry] -&gt; IO ()\nprintEntries ents = forM_ (zip [1..] ents) $ \\(i,e) -&gt; print (i,e)\n\ndoit n = do\n  ents &lt;- (lift $ getEntries n) &gt;&gt;= hoistEither\n  filtered &lt;- hoistEither $ filterEntries ents\n  lift $ printEntries filtered\n\nmain n = do result &lt;- runEitherT $ doit n\n            case result of\n              Left e -&gt; putStrLn $ \"Error: \" ++ e\n              Right _ -&gt; putStrLn $ \"no errors\"\n</code></pre>\n\n<p>Note the following behavior:</p>\n\n<ul>\n<li><code>main 100</code> fails because <code>getEntries</code> returns an error</li>\n<li><code>main 4</code> fails because <code>filterEntries</code> returns an error</li>\n<li><code>main 3</code> succeeds</li>\n</ul>\n"}], "owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 31393036, "answer_count": 1, "score": 0, "last_activity_date": 1436820041, "creation_date": 1436814045, "question_id": 31391358, "link": "https://stackoverflow.com/questions/31391358/either-propagation-with-io", "title": "&#39;Either&#39; propagation with IO()", "body": "<p>I am learning Haskell, and having a great time. One of the things I especially enjoy is using the monad error types to propagate error conditions behind the scene in fmap or >>=. For example, in this code, I am using hoauth2 for an authenticated connection. It defines OAuth2Result using Either...</p>\n\n<pre><code>type OAuth2Result a = Either ByteString a  -- from OAuth2\n\ngetEntries :: Manager -&gt; AccessToken -&gt; IO(OAuth2Result [Entry])\n  -- code omitted\n\nfilterResults :: [Entry] -&gt; OAuth2Result [Entry]\nfilterResults = return $ filter hasUrl \n\nprintEntries :: [Entry] -&gt; IO()   -- What type can I use here?\nprintEntries Left l  =  -- code omitted\nprintEntries Right r =  -- code omitted\n\nmain = do\n    entriesResult &lt;- getEntries mgr token  -- This is an OAuth2Result\n    let filtered = entriesResult &gt;&gt;= filterResults\n\n    printEntries filtered\n</code></pre>\n\n<p>The problem that I am having is when a function has IO like printEntries. In this case, I have to explicitly pattern match to do the error handling. I would sure love to be able to hide it somehow as I did with the filterResults call. </p>\n\n<p>How can I do this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghc", "cabal-install"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436839761, "post_id": 31389627, "comment_id": 50768790, "body": "Arithmoi is not terribly stable at the moment, and its code is frankly terrifying. Don&#39;t use its prime sieve code (it sometimes segfaults) and think twice about using the rest. The package has a new maintainer, who intends to replace large sections of the codebase. It may be wise to wait for that."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1436808489, "creation_date": 1436808489, "answer_id": 31389739, "question_id": 31389627, "link": "https://stackoverflow.com/questions/31389627/cannot-install-arithmoi-on-os-x-yosemite-haskell-version-ghc-7-10-1/31389739#31389739", "title": "Cannot install arithmoi on OS X Yosemite Haskell version ghc 7.10.1", "body": "<p>Run <code>cabal update</code>.  Arithmoi version 0.4.1.3 is out, which fixes the bound issue on integer-gmp.</p>\n"}], "owner": {"reputation": 171, "user_id": 4133743, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ba4bd0c196057243f4fb27b8ed5792c?s=128&d=identicon&r=PG&f=1", "display_name": "Helix", "link": "https://stackoverflow.com/users/4133743/helix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 31389739, "answer_count": 1, "score": 0, "last_activity_date": 1436808489, "creation_date": 1436808137, "question_id": 31389627, "link": "https://stackoverflow.com/questions/31389627/cannot-install-arithmoi-on-os-x-yosemite-haskell-version-ghc-7-10-1", "title": "Cannot install arithmoi on OS X Yosemite Haskell version ghc 7.10.1", "body": "<p>I have been trying to install the \"arithmoi\" package on ghc 7.10.1 OS X Yosemite, but when I try <code>cabal install arithmoi</code> I keep getting the error:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: arithmoi-0.4.1.2 (user goal)\nnext goal: base (dependency of arithmoi-0.4.1.2)\nrejecting: base-4.8.0.0/installed-901... (conflict: base =&gt;\ninteger-gmp==1.0.0.0/installed-3c9..., arithmoi =&gt; integer-gmp&lt;1)\nrejecting: base-4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1, 4.6.0.0, 4.5.1.0,\n4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0,\n4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint requires installed\ninstance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Any suggestions? Thank you.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1436792255, "last_edit_date": 1436792255, "creation_date": 1436790488, "answer_id": 31383431, "question_id": 31382532, "link": "https://stackoverflow.com/questions/31382532/get-data-and-append-it-to-list-until-finished/31383431#31383431", "title": "Get data and append it to list until finished", "body": "<p>You have to accumulate the items yourself like this:</p>\n\n<pre><code>where loopTillEmpty ref items = do\n        commit &lt;- getCommit git ref\n        putStrLn $ show ref\n        case commitParents commit of\n            []    -&gt; return items\n            (p:_) -&gt; loopTillEmpty p (ref:items)\n</code></pre>\n\n<p>and then call it with:</p>\n\n<pre><code>items &lt;- loopTillEmpty ref []\n</code></pre>\n\n<p>Note - this accumulates the items in reverse order. It you need in the visited order just reverse it before using it or just before returning it, e.g.:</p>\n\n<pre><code>case commitParents commit of\n  []    -&gt; return (reverse items)\n  (p:_) -&gt; ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 3, "last_activity_date": 1436790668, "creation_date": 1436790668, "answer_id": 31383506, "question_id": 31382532, "link": "https://stackoverflow.com/questions/31382532/get-data-and-append-it-to-list-until-finished/31383506#31383506", "title": "Get data and append it to list until finished", "body": "<p>Well right now you are printing in output the refs when you visit them and then loop. What you need is to accumulate those refs instead of printing them and that's the perfect task for a list. The important bits:</p>\n\n<pre><code>getRefs :: Revision -&gt; Git -&gt; IO [Ref]\ngetRefs revision git = do\n    ref &lt;- maybe (error \"revision cannot be found\") id &lt;$&gt; resolveRevision git revision\n    loopTillEmpty ref\n  where loopTillEmpty ref = do\n          commit &lt;- getCommit git ref\n          nextRefs &lt;- case commitParents commit of\n                            []    -&gt; return []\n                            (p:_) -&gt; loopTillEmpty p\n          return $ ref : nextRefs\n</code></pre>\n\n<p>So your base case is <code>return []</code>, when there are no more refs after the current one, and <code>loopTillEmpty p</code> in the other case. The last line combines the current <code>ref</code> with the <code>nextRefs</code> into the resultant list. You can then <code>map show</code> on the result of <code>getRefs</code> to get the list of commits strings.</p>\n"}], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 31383506, "answer_count": 2, "score": 2, "last_activity_date": 1436792255, "creation_date": 1436788001, "last_edit_date": 1436788342, "question_id": 31382532, "link": "https://stackoverflow.com/questions/31382532/get-data-and-append-it-to-list-until-finished", "title": "Get data and append it to list until finished", "body": "<p>I am working with the <code>Commit</code> type of <code>hit</code> package.\nI have the next function but i want for it to return a list with all the <code>ref</code>s from <code>loopTillEmpty</code> function not only print them. Is that possible?</p>\n\n<pre><code>getRefs revision git = do\n    ref &lt;- maybe (error \"revision cannot be found\") id &lt;$&gt; resolveRevision git revision\n    loopTillEmpty ref\n    where loopTillEmpty ref = do\n            commit &lt;- getCommit git ref\n            putStrLn $ show ref\n            case commitParents commit of\n                []    -&gt; return ()\n                (p:_) -&gt; loopTillEmpty p\n</code></pre>\n\n<p>A sample output is</p>\n\n<pre><code>5cecfbca98fbc4b02b06ea315a857c97605ef135\ne6e4a017be111eba85baad539c502bae2dacb14e\n()\n</code></pre>\n\n<p>this shows us the refs and it return <code>()</code> when empty. The datatype looks like:</p>\n\n<pre><code>Commit {commitParents = []} -- when empty\nCommit {commitParents = [e6e4a017be111eba85baade]} -- when not empty\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "docker"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1436782696, "post_id": 31380559, "comment_id": 50739314, "body": "You&#39;re probably interested in <a href=\"https://www.fpcomplete.com/blog/2015/05/haskell-web-server-in-5mb\" rel=\"nofollow noreferrer\">this article</a>."}, {"owner": {"reputation": 222, "user_id": 2051432, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a802810986fbce9e8fcfe7e1deb89652?s=128&d=identicon&r=PG", "display_name": "sgillis", "link": "https://stackoverflow.com/users/2051432/sgillis"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1436788685, "post_id": 31380559, "comment_id": 50742948, "body": "That article is actually the reason I decided to try my hand at recreating the same thing but using a static binary. I did try to run my static binary starting from <code>dysinger&#47;haskell-scratch</code>, but this results in error code 139."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1436811263, "post_id": 31380559, "comment_id": 50757700, "body": "Wasn&#39;t sure about this, since you&#39;ve used <code>scratch</code>, not <code>haskell-scratch</code> as mentioned in the article, see <a href=\"https://github.com/snoyberg/haskell-scratch\" rel=\"nofollow noreferrer\">github.com/snoyberg/haskell-scratch</a>."}], "answers": [{"comments": [{"owner": {"reputation": 222, "user_id": 2051432, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a802810986fbce9e8fcfe7e1deb89652?s=128&d=identicon&r=PG", "display_name": "sgillis", "link": "https://stackoverflow.com/users/2051432/sgillis"}, "edited": false, "score": 0, "creation_date": 1436810117, "post_id": 31385803, "comment_id": 50757056, "body": "I tried again with the <code>haskell-scratch</code> image, but this time with <code>snoyberg&#47;haskell-scratch</code>. That did the trick. When 7.10.2 is out I&#39;ll try again and see if I can really start from <code>scratch</code> then. Thanks!"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1436858267, "post_id": 31385803, "comment_id": 50774824, "body": "This is more a feature of iconv than of GHC (the only thing special about GHC is that its base package uses iconv extensively),"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 4, "last_activity_date": 1436796944, "creation_date": 1436796944, "answer_id": 31385803, "question_id": 31380559, "link": "https://stackoverflow.com/questions/31380559/statically-linked-haskell-program-in-docker/31385803#31385803", "title": "Statically linked Haskell program in Docker", "body": "<p>You encountered a feature of GHC runtime system. Even the application is static, it needs some auxiliary files, locale files are one of them. </p>\n\n<p>See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7695\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/7695</a> and <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10298\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/10298</a></p>\n\n<p>As you can see, that will be fixed in 7.10.2 (which at the moment is right behind the corner).</p>\n\n<p><a href=\"https://github.com/snoyberg/haskell-scratch\" rel=\"nofollow\">https://github.com/snoyberg/haskell-scratch</a> image lists hopefully all files you need in the minimal container. </p>\n"}], "owner": {"reputation": 222, "user_id": 2051432, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a802810986fbce9e8fcfe7e1deb89652?s=128&d=identicon&r=PG", "display_name": "sgillis", "link": "https://stackoverflow.com/users/2051432/sgillis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 2, "accepted_answer_id": 31385803, "answer_count": 1, "score": 7, "last_activity_date": 1436796944, "creation_date": 1436782241, "question_id": 31380559, "link": "https://stackoverflow.com/questions/31380559/statically-linked-haskell-program-in-docker", "title": "Statically linked Haskell program in Docker", "body": "<p>I'm trying to build a statically linked binary from Haskell source code, and copy this binary to a minimal Docker image so that my production image is as small as possible.</p>\n\n<p>As a test case I'm using a hello world program:</p>\n\n<pre><code>main = print \"Hello world\"\n</code></pre>\n\n<p>The <code>test.cabal</code> file is the default generated by <code>cabal init</code>, except that I added</p>\n\n<pre><code>ghc-options: -static -optc-static -optl-static -optl-threaded\n</code></pre>\n\n<p>To build I run</p>\n\n<pre><code>$ docker run -it -v $(pwd):/src haskell:7.10 /bin/bash\n# cd src\n# cabal build\n</code></pre>\n\n<p>The build gives the following error:</p>\n\n<pre><code>opt/ghc/7.10.1/lib/ghc-7.10.1/rts/libHSrts.a(Linker.o): In function `internal_dlopen': (.text+0x727): warning: Using 'dlopen' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking\n</code></pre>\n\n<p>From what I understood, this means that I need to make sure I have the correct version of glibc in order to be able to execute the binary. Executing the binary works fine in the same container:</p>\n\n<pre><code># ./dist/build/test/test\n\"Hello world\"\n</code></pre>\n\n<p>It's also statically linked as expected:</p>\n\n<pre><code># ldd ./dist/build/test/test\nnot a dynamic executable\n</code></pre>\n\n<p>To create my minimal image, I create a Dockerfile (the <code>libc.so.6</code> file is copied from the <code>haskell:7.10</code> image):</p>\n\n<pre><code>FROM scratch\nADD dist/build/test/test /test\nADD libc.so.6 /lib/x86_64-linux-gnu/libc.so.6\nCMD [\"/test\"]\n</code></pre>\n\n<p>This does not work when I try to build and run it</p>\n\n<pre><code>$ docker build -t test .\n$ docker run -it test\ntest: out of memory (requested 1048576 bytes)\n</code></pre>\n\n<p>I tried the same thing starting from a <code>busybox</code> image (without adding <code>libc.so.6</code>) but this did not work either. Adding it to a <code>ubuntu:14.04</code> did work (this is probably because <code>haskell:7.10</code> is based on this image).</p>\n\n<p>I tried running <code>strace</code> on the command, but was not able to make much sense of it. The <code>strace</code> output is here: <a href=\"http://pastebin.com/SNHT14Z9\" rel=\"noreferrer\">http://pastebin.com/SNHT14Z9</a></p>\n\n<p>Can I make this work from <code>scratch</code>? Or is this impossible due to the 'dlopen' issue?</p>\n"}, {"tags": ["haskell", "clojure", "currying"], "comments": [{"owner": {"reputation": 4527, "user_id": 1783752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42524cd717a94c82256fcccc3ad9a6d9?s=128&d=identicon&r=PG", "display_name": "guilespi", "link": "https://stackoverflow.com/users/1783752/guilespi"}, "edited": false, "score": 1, "creation_date": 1436746093, "post_id": 31373507, "comment_id": 50726687, "body": "I assume at least part of the reason is Clojure is not 100% lazy and application cannot be deferred"}, {"owner": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 3, "creation_date": 1436788029, "post_id": 31373507, "comment_id": 50742532, "body": "Your first sentence is not accurate.  Haskell curries <i>all</i> functions, no matter how many arguments are supplied.  In truth, all Haskell functions take one input and return one output.  <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">wiki.haskell.org/Currying</a> <a href=\"https://wiki.haskell.org/Composing_functions_with_multiple_values\" rel=\"nofollow noreferrer\">wiki.haskell.org/Composing_functions_with_multiple_values</a> .  In Haskell the <b>uncurry</b> function doesn&#39;t actually uncurry; instead, it takes the first two functions in the chain and composes them into one function which takes a <b>pair</b> as its single input."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 3, "creation_date": 1436791343, "post_id": 31373507, "comment_id": 50744574, "body": "paying homage to Haskell Curry."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1436826413, "post_id": 31373507, "comment_id": 50765287, "body": "I&#39;m pretty sure this is because java functions can be polyvariadic (having variable argument numbers), so clojure should follow suit."}, {"owner": {"reputation": 6166, "user_id": 25358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d9e66bb7361fea87a658ceecb2f547d6?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/25358/mario"}, "edited": false, "score": 0, "creation_date": 1531164748, "post_id": 31373507, "comment_id": 89484465, "body": "In short, fixed-parameter functions are well-suited to auto-currying while multi-arity functions are not. Thus, when you develop an api, if you want auto-currying, avoid the latter and prefer the former."}], "answers": [{"comments": [{"owner": {"reputation": 6166, "user_id": 25358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d9e66bb7361fea87a658ceecb2f547d6?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/25358/mario"}, "edited": false, "score": 3, "creation_date": 1436751520, "post_id": 31374215, "comment_id": 50727701, "body": "I was working on a bit Clojure inspired code and trying to make currying and variadic functions work in tandem and I had discovered the same problems you mention.  It&#39;s reaffirming to hear it from you."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 5, "creation_date": 1436758768, "post_id": 31374215, "comment_id": 50729039, "body": "To give a concrete example for posterity and for people who don&#39;t necessarily know what &quot;arities&quot; are, you need <code>(+ 1 2)</code> to simultaneously be <code>3</code> and a composable function because you&#39;re asking for both <code>(print (+ 1 2))</code> to put <code>3</code> to the console (normal evaluation), and <code>((+ 1 2) 3)</code> to be an expression yielding <code>6</code> (currying). Ways we know that do both (e.g. &quot;Church numerals&quot;) tend to fail on expressions like <code>((* 1 2) 3)</code> also being <code>6</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1436798410, "post_id": 31374215, "comment_id": 50749401, "body": "whereas in haskell a function&#39;s arity is statically-known part of its type (e.g. <code>f :: Int -&gt; (Int -&gt; (Int -&gt; Int))</code>), and at each stage of partial application the type checker tracks its type (e.g. <code>f 41 42 :: Int -&gt; Int</code>)"}], "tags": [], "owner": {"reputation": 768, "user_id": 1594086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ec67a40aabf1da9346212b6b6cd1b87?s=128&d=identicon&r=PG", "display_name": "Ivan Pierre", "link": "https://stackoverflow.com/users/1594086/ivan-pierre"}, "is_accepted": true, "score": 27, "last_activity_date": 1436760513, "last_edit_date": 1436760513, "creation_date": 1436750182, "answer_id": 31374215, "question_id": 31373507, "link": "https://stackoverflow.com/questions/31373507/rich-hickeys-reason-for-not-auto-currying-clojure-functions/31374215#31374215", "title": "Rich Hickey&#39;s reason for not auto-currying Clojure functions?", "body": "<p>As functions can have multiple arities, you could have a direct function call instead of a currying function. Next, if in case you have only one arity, and you miss an argument, arity error is not detected and instead generate a currying function. A very bad and hard case to debug, especially if the function returns a function with the same asked arity, or if function is passed as an argument to another function.</p>\n\n<p>So specifically creating a currying function seems legit.</p>\n"}], "owner": {"reputation": 6166, "user_id": 25358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d9e66bb7361fea87a658ceecb2f547d6?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/25358/mario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2823, "favorite_count": 5, "accepted_answer_id": 31374215, "answer_count": 1, "score": 25, "last_activity_date": 1453124902, "creation_date": 1436742999, "last_edit_date": 1453124902, "question_id": 31373507, "link": "https://stackoverflow.com/questions/31373507/rich-hickeys-reason-for-not-auto-currying-clojure-functions", "title": "Rich Hickey&#39;s reason for not auto-currying Clojure functions?", "body": "<p>Haskell curries its functions.  Clojure does not though it permits <code>partial</code> and function macros as a comparable approach for doing the same.</p>\n\n<p>I thought I recalled hearing/reading the reason behind Hickey's decision.  Does someone recall what that reason was or where I could find it?  </p>\n\n<p>I was hoping to learn something from the rationale.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1436771215, "post_id": 31373070, "comment_id": 50732983, "body": "You should always define <b>all</b> the operations in the minimal complete definition before consider the data type as an instance of a class..."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 2, "creation_date": 1436773253, "post_id": 31373070, "comment_id": 50734061, "body": "The real problem here is that you&#39;re making <code>Vec3</code> an instance of <code>Num</code> even though vectors aren&#39;t numbers."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436815302, "post_id": 31373070, "comment_id": 50759895, "body": "To expand on @rightfold - don&#39;t make something instance of Num just because you want + - vectors aren&#39;t numbers even if some of the operators you use on vectors tend to have the same name as number operators. (although you <i>can</i> treat vectors as numbers if by &#39;vector&#39; you just mean &#39;fixed size collection of numbers&#39; instead of vector in a geometrical or physical sense)."}, {"owner": {"reputation": 1198, "user_id": 3288829, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9ff590bcafe14e259723706bcaaff552?s=128&d=identicon&r=PG&f=1", "display_name": "user3288829", "link": "https://stackoverflow.com/users/3288829/user3288829"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436817119, "post_id": 31373070, "comment_id": 50760914, "body": "@Cubic I understand where you&#39;re coming from. I&#39;m used to overloading operators in C++, and it seems unfortunate that I can&#39;t robustly define a single operator for a data type in Haskell without it needing to be a number or without hiding <code>(+)</code> and doing a qualified import of Prelude. <code>vec3Add a b</code> is more annoying to type than <code>a + b</code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436817502, "post_id": 31373070, "comment_id": 50761163, "body": "The <code>vectorspace</code> package introduces functions like <code>^+^</code>, <code>^*</code>, <code>*^</code> etc for vector operations. Remember you&#39;re not limited to some fixed set of operators like in C++."}], "answers": [{"comments": [{"owner": {"reputation": 1198, "user_id": 3288829, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9ff590bcafe14e259723706bcaaff552?s=128&d=identicon&r=PG&f=1", "display_name": "user3288829", "link": "https://stackoverflow.com/users/3288829/user3288829"}, "edited": false, "score": 1, "creation_date": 1436740079, "post_id": 31373158, "comment_id": 50725416, "body": "That makes sense. Tangential question, but where do I find the implementations of these common functions? I tried looking, but didn&#39;t know where to look"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 1198, "user_id": 3288829, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9ff590bcafe14e259723706bcaaff552?s=128&d=identicon&r=PG&f=1", "display_name": "user3288829", "link": "https://stackoverflow.com/users/3288829/user3288829"}, "edited": false, "score": 0, "creation_date": 1436740174, "post_id": 31373158, "comment_id": 50725433, "body": "@user3288829 The source file is <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/src/GHC-Num.html\" rel=\"nofollow noreferrer\"><code>GHC.Num</code></a>."}, {"owner": {"reputation": 1198, "user_id": 3288829, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9ff590bcafe14e259723706bcaaff552?s=128&d=identicon&r=PG&f=1", "display_name": "user3288829", "link": "https://stackoverflow.com/users/3288829/user3288829"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1436740271, "post_id": 31373158, "comment_id": 50725457, "body": "Thanks @phadej and AJFarmar, I&#39;m still new to Haskell. I&#39;ll make sure to check those sources first next time"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1436740411, "post_id": 31373158, "comment_id": 50725476, "body": "Yet the functions in <code>base</code> are hard to find, <code>sum</code> on lists is well hidden: <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-List.html#sum\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.0.0/docs/src/&hellip;</a>  It&#39;s own exercise to lookup where it is in base-4.7 :)"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1465728891, "post_id": 31373158, "comment_id": 63014550, "body": "obscure error messages like this make Haskell occasionally time wasting - i was puzzled  for a while and did not see how to give an implementation for fromInteger in a similar case (despite using Haskell for probably close to 20 years). perhaps somebody could add the example implementation in an easy to find place (e.g. in the Haddock comment of Num)."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 9, "last_activity_date": 1436740579, "last_edit_date": 1436740579, "creation_date": 1436739793, "answer_id": 31373158, "question_id": 31373070, "link": "https://stackoverflow.com/questions/31373070/why-does-sum-need-ghc-num-frominteger/31373158#31373158", "title": "why does sum need GHC.Num.fromInteger?", "body": "<p>Here's how sum is implemented:</p>\n\n<pre><code>sum = foldl (+) 0\n</code></pre>\n\n<p>Notice the <code>0</code> literal. Let's check it's type in GHCi:</p>\n\n<pre><code>\u03bb&gt; :t 0\n0 :: Num a =&gt; a\n</code></pre>\n\n<p>As it turns out, numeric literals are sugar for <code>fromInteger</code>. Ie, <code>0</code> is actually <code>fromInteger 0</code>.</p>\n\n<p>Thus, <code>sum</code> requires <code>fromInteger</code>, because the above definition is sugar for:</p>\n\n<pre><code>sum = foldl (+) (fromInteger 0)\n</code></pre>\n\n<hr>\n\n<p>The implementation of <code>fromInteger</code> is easy:</p>\n\n<pre><code>instance Num Vec3 where\n    fromInteger n = let a = (fromInteger n) in Vec3 a a a\n</code></pre>\n\n<p>Furthermore, I would highly recommend that, whenever making an instance, always define it completely to avoid unforeseen trouble like this.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 4, "last_activity_date": 1436741050, "last_edit_date": 1436741050, "creation_date": 1436740102, "answer_id": 31373198, "question_id": 31373070, "link": "https://stackoverflow.com/questions/31373070/why-does-sum-need-ghc-num-frominteger/31373198#31373198", "title": "why does sum need GHC.Num.fromInteger?", "body": "<p>What should <code>sum [] :: Vec3</code> return?</p>\n\n<hr>\n\n<p>The <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/src/Data-List.html#sum\" rel=\"nofollow\"><code>sum</code></a> function could be defined as</p>\n\n<pre><code>sum :: (Num a) =&gt; [a] -&gt; a\nsum =  foldl (+) 0\n</code></pre>\n\n<p>The <code>0</code> there is actually <code>fromInteger (0 :: Integer)</code>, thus you need <code>fromInteger</code> to use <code>sum</code>.</p>\n\n<p><em>Actually</em> in base-4.8 <code>sum</code> is defined in terms of <code>Sum</code> <code>Monoid</code> and <code>Foldable</code>, but that's different story. You still need <code>fromInteger (0 :: Integer)</code> there.</p>\n"}], "owner": {"reputation": 1198, "user_id": 3288829, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9ff590bcafe14e259723706bcaaff552?s=128&d=identicon&r=PG&f=1", "display_name": "user3288829", "link": "https://stackoverflow.com/users/3288829/user3288829"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 0, "accepted_answer_id": 31373158, "answer_count": 2, "score": 6, "last_activity_date": 1436741050, "creation_date": 1436739039, "last_edit_date": 1436740348, "question_id": 31373070, "link": "https://stackoverflow.com/questions/31373070/why-does-sum-need-ghc-num-frominteger", "title": "why does sum need GHC.Num.fromInteger?", "body": "<p>I have a 3d vector data type defined as 3 floats. I understand that if I provide a <code>Num</code> instance for my class and define the normal mathematical operators, I can use them on my class. </p>\n\n<pre><code>data Vec3 = Vec3 { x :: Float\n                 , y :: Float\n                 , z :: Float\n                 } deriving (Show, Eq)\n\ninstance Num Vec3 where\n  (+) v1 v2 = Vec3 (x v1 + x v2) (y v1 + y v2) (z v1 + z v2)\n</code></pre>\n\n<p>When I load my file into ghci, I get warnings because I didn't define all the functions in <code>Num</code>, which makes sense.</p>\n\n<pre><code>Prelude&gt; :l temp.hs\n[1 of 1] Compiling Main             ( temp.hs, interpreted )\n\ntemp.hs:6:10: Warning:\n    No explicit method or default declaration for `*'\n    In the instance declaration for `Num Vec3'\n\ntemp.hs:6:10: Warning:\n    No explicit method or default declaration for `abs'\n    In the instance declaration for `Num Vec3'\n\ntemp.hs:6:10: Warning:\n    No explicit method or default declaration for `signum'\n    In the instance declaration for `Num Vec3'\n\ntemp.hs:6:10: Warning:\n    No explicit method or default declaration for `fromInteger'\n    In the instance declaration for `Num Vec3'\nOk, modules loaded: Main.\n</code></pre>\n\n<p>However, I can still use the ones I've defined.</p>\n\n<pre><code>*Main&gt; let a = Vec3 1.0 2.0 3.0\n*Main&gt; let b = Vec3 2.0 4.0 5.0\n*Main&gt; a + b\nVec3 {x = 3.0, y = 6.0, z = 8.0}\n</code></pre>\n\n<p>My confusion comes from the following error I get when trying to use the sum function</p>\n\n<pre><code>*Main&gt; sum [a,b]\nVec3 {x = *** Exception: temp.hs:6:10-17: No instance nor default method for class operation GHC.Num.fromInteger\n</code></pre>\n\n<p>Why does sum need a <code>fromInteger</code> definition for my <code>Vec3</code> data type? For one, I would have figured that sum only uses the <code>+</code> function, and for another, my data type doesn't use  <code>Integer</code>.</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 245, "user_id": 5107220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0gF6d.jpg?s=128&g=1", "display_name": "Maroon", "link": "https://stackoverflow.com/users/5107220/maroon"}, "edited": false, "score": 0, "creation_date": 1436731912, "post_id": 31372091, "comment_id": 50723328, "body": "Note: I&#39;m a complete beginner to Haskell. It is possible I simply don&#39;t know the syntax well enough, particularly since I&#39;ve generally found documentation for other languages I&#39;ve used easier to read, but I feel like that&#39;s not the only problem here."}, {"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "edited": false, "score": 2, "creation_date": 1436732400, "post_id": 31372091, "comment_id": 50723463, "body": "It looks like you&#39;d like to use recursion in the last case, and have something like <code>compare (S x) (S y) = compare x y</code>. Also you can use the underscore <code>_</code> to describe that you don&#39;t care about a detailed case, like <code>compare (S _) Zero = \u2026</code> to note that you don&#39;t care for the size of the first number provided you know its &gt;= 1 and the second is Zero."}], "answers": [{"comments": [{"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "edited": false, "score": 0, "creation_date": 1436732570, "post_id": 31372179, "comment_id": 50723510, "body": "It also makes sense to use <code>_</code> for cases where the distance between both numbers is <code>&gt; 1</code> .)"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1436732647, "post_id": 31372179, "comment_id": 50723531, "body": "You probably meant <code>S _</code> instead of <code>S Zero</code> in the second and third branches."}, {"owner": {"reputation": 3647, "user_id": 371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e1caa49eebfe37ffe3ef64e19364b0b3?s=128&d=identicon&r=PG", "display_name": "Silly Freak", "link": "https://stackoverflow.com/users/371191/silly-freak"}, "edited": false, "score": 2, "creation_date": 1436733800, "post_id": 31372179, "comment_id": 50723868, "body": "For homework questions in particular, I don&#39;t think a code-only answer is appropriate."}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": false, "score": 3, "last_activity_date": 1436736140, "last_edit_date": 1436736140, "creation_date": 1436732495, "answer_id": 31372179, "question_id": 31372091, "link": "https://stackoverflow.com/questions/31372091/efficient-way-to-write-ordering-instances/31372179#31372179", "title": "Efficient way to write ordering instances?", "body": "<p>Your <code>compare</code> function needs to be recursive.  You will want your last case to capture the situation where both arguments are the successor of something, and then recurse on what they are the successor of.  Additionally, your middle two cases, are probably not what you want, as they will only capture the following cases:</p>\n\n<ol>\n<li><code>1 &gt; 0</code></li>\n<li><code>0 &lt; 1</code></li>\n</ol>\n\n<p>You would like this to be more general, so that you can handle cases like:</p>\n\n<ol>\n<li><code>S x &gt; 0</code>, for all <code>x</code></li>\n<li><code>0 &lt; S x</code>, for all <code>x</code></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1439, "user_id": 627277, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/NNSDL.jpg?s=128&g=1", "display_name": "rburny", "link": "https://stackoverflow.com/users/627277/rburny"}, "is_accepted": false, "score": 8, "last_activity_date": 1436732901, "last_edit_date": 1436732901, "creation_date": 1436732574, "answer_id": 31372190, "question_id": 31372091, "link": "https://stackoverflow.com/questions/31372091/efficient-way-to-write-ordering-instances/31372190#31372190", "title": "Efficient way to write ordering instances?", "body": "<p>You'll need to organize your instances in a way that will cover all possible patterns. To make it simpler, remember how your numbers are defined:</p>\n\n<pre><code>one = S Zero\ntwo = S one  -- or S (S Zero)\n</code></pre>\n\n<p>and think in terms of <code>S</code> and <code>Zero</code>, not <code>one</code>, <code>two</code> etc. (they are merely aliases). Once you do this, it should become clear that you're missing a case like:</p>\n\n<pre><code>compare (S x) (S y) = compare x y\n</code></pre>\n\n<p>Edit:\nLike Jakob Runge noticed, also the following base clauses should be improved:</p>\n\n<pre><code>compare Zero (S Zero)  = LT\ncompare (S Zero) Zero  = GT\n</code></pre>\n\n<p>As they're written, they allow comparison only between zero and one. You should change them to cover comparison between zero and any positive number:</p>\n\n<pre><code>compare Zero (S _)  = LT\ncompare (S _) Zero  = GT\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 245, "user_id": 5107220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0gF6d.jpg?s=128&g=1", "display_name": "Maroon", "link": "https://stackoverflow.com/users/5107220/maroon"}, "edited": false, "score": 0, "creation_date": 1436733259, "post_id": 31372240, "comment_id": 50723699, "body": "This makes sense. I felt like recursion was supposed to be in there somewhere, (and now thinking about it, I have no idea why I replaced <code>compare Zero (S _)</code> with <code>compare Zero (S Zero)</code> at some point) but could not quite figure out how for some reason (bizarrely enough, despite something similar having shown up in the <code>Eq</code> instances)."}], "tags": [], "owner": {"reputation": 3647, "user_id": 371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e1caa49eebfe37ffe3ef64e19364b0b3?s=128&d=identicon&r=PG", "display_name": "Silly Freak", "link": "https://stackoverflow.com/users/371191/silly-freak"}, "is_accepted": true, "score": 13, "last_activity_date": 1436732919, "last_edit_date": 1592644375, "creation_date": 1436732919, "answer_id": 31372240, "question_id": 31372091, "link": "https://stackoverflow.com/questions/31372091/efficient-way-to-write-ordering-instances/31372240#31372240", "title": "Efficient way to write ordering instances?", "body": "<p>What this task focuses on is finding base cases and recursion rules. The first two lines you were given were</p>\n<pre><code>instance Ord NaturalNumber where\n    compare Zero Zero   = EQ\n</code></pre>\n<p>This is the first base case, in words:</p>\n<blockquote>\n<p>zero is equal to zero</p>\n</blockquote>\n<p>The other two base cases are:</p>\n<blockquote>\n<p>zero is less than the successor of any <code>NaturalNumber</code></p>\n<p>the successor of any <code>NaturalNumber</code> is greater than zero</p>\n</blockquote>\n<p>Note that your lines three and four only say that <code>0 &lt; 1</code> and <code>1 &gt; 0</code>, but nothing about any other nonzero numbers.</p>\n<p>The recursion rule, then, is that it makes no difference if you compare two nonzero numbers, or the numbers they are successors of:</p>\n<blockquote>\n<p>comparing <code>1 + x</code> and <code>1 + y</code> is the same as comparing <code>x</code> and <code>y</code>.</p>\n</blockquote>\n<p>Codifying that into Haskell should give you the solution to this exercise.</p>\n"}], "owner": {"reputation": 245, "user_id": 5107220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0gF6d.jpg?s=128&g=1", "display_name": "Maroon", "link": "https://stackoverflow.com/users/5107220/maroon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 31372240, "answer_count": 3, "score": 14, "last_activity_date": 1436736140, "creation_date": 1436731855, "question_id": 31372091, "link": "https://stackoverflow.com/questions/31372091/efficient-way-to-write-ordering-instances", "title": "Efficient way to write ordering instances?", "body": "<p>I'm working on a basic Haskell exercise that is set up as follows: a data definition is made, where <code>Zero</code> is declared to be a <code>NaturalNumber</code>, and a series of numbers (printed out by name, so, for instance, <code>four</code>) up to <code>ten</code> is constructed with this.</p>\n\n<p>I didn't have too much trouble with understanding how the declaration of <code>Eq</code> instances works (apart from not having been given an exact explanation for the syntax), but I'm having trouble with declaring all instances I need for <code>Ord</code> -- I need to be able to construct an ordering over the entire set of numbers, such that I'll get <code>True</code> if I input \"ten > nine\" or something.</p>\n\n<p>Right now, I have this snippet of code. The first two lines should be correct, as I copied them (as I was supposed to) from the exercise itself.</p>\n\n<pre><code>instance Ord NaturalNumber where\n    compare Zero Zero   = EQ\n    compare Zero (S Zero)  = LT\n    compare (S Zero) Zero  = GT\n    compare x    (S x)  = LT\n</code></pre>\n\n<p>The first four lines work fine, but they can't deal with cases like \"compare four five\", and anything similar to what I typed in the last doesn't work even if I type in something like <code>compare four four = EQ</code>: I get a \"conflicting definitions\" error, presumably because the <code>x</code> appears twice. If I write something like <code>compare two one = GT</code> instead, I get a \"pattern match(es) are overlapped\" warning, but it works. However, I also get the result <code>GT</code> when I input <code>compare one two</code> into the actual Haskell platform, so clearly something isn't working. This happens even if I add <code>compare one two = LT</code> below that line.</p>\n\n<p>So clearly I can't finish off this description of <code>Ord</code> instances by writing every instance I could possibly need, and even if I could, it would be incredibly inefficient to write out all 100 instances by hand.</p>\n\n<p>Might anyone be able to provide me with a hint as to how I can resolve this problem and finish off the construction of an ordering mechanism?</p>\n"}, {"tags": ["haskell", "functor", "applicative", "function-composition"], "comments": [{"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 1, "creation_date": 1436718463, "post_id": 31369918, "comment_id": 50719182, "body": "<code>composeApplicative p q = (.) &lt;$&gt; p &lt;*&gt; q</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1436718496, "post_id": 31369918, "comment_id": 50719198, "body": "Is this homework? What have you tried?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1436719076, "post_id": 31369918, "comment_id": 50719405, "body": "I&#39;m voting to close this question as off-topic because it likely is homework and the OP has shown no effort."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1436719399, "post_id": 31369918, "comment_id": 50719506, "body": "Not homework, I tried and got to <code>(\\x -&gt; f &lt;*&gt; g &lt;*&gt; x)</code> which obviously wasn&#39;t what I was looking for. I was trying to make a newtype wrapped applicative function a member of Control.Category. Seeing the answer now it looks obvious but I bashed around for about 20 minutes and got nowhere near it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1436719579, "post_id": 31369918, "comment_id": 50719560, "body": "@Clinton Then would it be so difficult to show what you&#39;ve tried, and state your problem in a way that expresses that you&#39;ve encountered a problem, not plainly asking for code. You&#39;ve had downvotes because you&#39;ve put so little effort into this question."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1436719944, "post_id": 31369918, "comment_id": 50719680, "body": "I didn&#39;t think it would help people answering the question nor future people reading it for reference, who wouldn&#39;t be interested in my life story. I&#39;ve asked other questions which I give lots of background when I think it helps people answer the question I have."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1436720754, "post_id": 31369918, "comment_id": 50719915, "body": "@Clinton You could have at least opened your question with &quot;<i>I&#39;m trying to make a newtype wrapped applicative function a member of Control.Category</i>, but [...]&quot;. That would have given visitors some context."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1436724721, "post_id": 31369918, "comment_id": 50721105, "body": "@Clinton You may say that, but the fact that you&#39;ve been downvoted indicates that <i>it&#39;s a bad idea</i>. Please put effort into a question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1442994324, "post_id": 31369918, "comment_id": 53308774, "body": "I am quite fond of this function. I even <a href=\"https://duplode.github.io/posts/applicative-archery.html\" rel=\"nofollow noreferrer\">wrote a little about it</a> a while ago, though you probably won&#39;t find it very interesting, as by now you likely have figured it all."}], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1436812297, "post_id": 31370051, "comment_id": 50758283, "body": "&quot;As a minor technical note, when doing equational reasoning, the left- and right-hand sides of equations must be separated with a single equals sign (=). The double-equals sign (==) is reserved for decidable runtime equality checks.&quot; This is not a consensus rule; plenty of high-profile Haskellers use <code>==</code> for equational reasoning. Not even the GHC documentation follows it consistently; see e.g. <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#t:Functor\" rel=\"nofollow noreferrer\">the docs for <code>Functor</code> and <code>Monad</code></a>."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1436814710, "post_id": 31370051, "comment_id": 50759625, "body": "@LuisCasillas: Point taken. But I think it&#39;s useful to distinguish between equality as a <i>proposition</i> (which may or may not be decidable), and <i>decision procedure</i> for equality (which in general doesn&#39;t exist for arbitrary types)."}], "tags": [], "owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "is_accepted": true, "score": 6, "last_activity_date": 1436738681, "last_edit_date": 1436738681, "creation_date": 1436718753, "answer_id": 31370051, "question_id": 31369918, "link": "https://stackoverflow.com/questions/31369918/composing-applicative-functions/31370051#31370051", "title": "Composing applicative functions", "body": "<p>It can be done:</p>\n\n<pre><code>composeApplicative p q = (.) &lt;$&gt; p &lt;*&gt; q\n</code></pre>\n\n<p>For more information, <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html\" rel=\"nofollow\">read the documentation for Applicative functors</a>, more specifically, the composition law. It is effectively a statement that any <code>Applicative</code> instance, <code>composeApplicative f g &lt;*&gt; x</code> must always be equal to <code>f &lt;*&gt; (g &lt;*&gt; x)</code>.</p>\n\n<p>As a minor technical note, when doing equational reasoning, the left- and right-hand sides of equations must be separated with a single equals sign (<code>=</code>). The double-equals sign (<code>==</code>) is reserved for <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html\" rel=\"nofollow\">decidable runtime equality checks</a>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "closed_date": 1437965155, "accepted_answer_id": 31370051, "answer_count": 1, "score": -6, "last_activity_date": 1436738681, "creation_date": 1436717996, "last_edit_date": 1436718881, "question_id": 31369918, "link": "https://stackoverflow.com/questions/31369918/composing-applicative-functions", "closed_reason": "Needs more focus", "title": "Composing applicative functions", "body": "<p>Please implement the function:</p>\n\n<pre><code>composeApplicative :: (Applicative f) =&gt; f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)\n</code></pre>\n\n<p>Such that:</p>\n\n<pre><code>(composeApplicative f g) &lt;*&gt; x == f &lt;*&gt; (g &lt;*&gt; x)\n</code></pre>\n\n<p>Or alternatively, explain why this can not be done?</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 12, "creation_date": 1436717824, "post_id": 31369835, "comment_id": 50718992, "body": "It&#39;s got nothing to do with laziness.  It&#39;s just regular overloading."}, {"owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1436722834, "post_id": 31369835, "comment_id": 50720504, "body": "@augustss OK, now I know that also a single values can be overloaded in Haskell (so my example was unnecessarily complicated ;). But I still think this is somehow dependent on laziness. If the value wouldn&#39;t be evalueted when it&#39;s value is needed, it wouldn&#39;t be possible to overload it, right?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1436724246, "post_id": 31369835, "comment_id": 50720959, "body": "@MartinJi\u0159i\u010dka Values with a polymorphic type don&#39;t actually behave lazily - they behave like functions. That is they are evaluated every time you use them, rather than just the first time. So it doesn&#39;t work because of laziness (it wouldn&#39;t work with laziness), but rather because polymorphic values get special treatment compared to monomorphic ones."}, {"owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "edited": false, "score": 0, "creation_date": 1436724565, "post_id": 31369835, "comment_id": 50721062, "body": "I respond to myself: No, it is not about laziness, because it is not about when the value is calculated but which value is chosen (according the expected type). But now I find my original example with a function still a little bit different than this case."}, {"owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1436724783, "post_id": 31369835, "comment_id": 50721134, "body": "@sepp2k Yes, thank you. But one more question: why it wouldn&#39;t work with laziness?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436772559, "post_id": 31369835, "comment_id": 50733699, "body": "Keep in mind that overloading is a compile time (static) feature and laziness is a runtime (dynamic) feature."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1436786973, "post_id": 31369835, "comment_id": 50741883, "body": "Also, the idea is that <code>g</code> really is some sort of closure (which is made explicit when I made it into a function from <code>Applicative f</code> to <code>f (a -&gt; a)</code>) and, as such, it is <i>already</i> a value. The subtlety is that its argument gets picked at its use site by the compiler rather than the user."}], "answers": [{"comments": [{"owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "edited": false, "score": 0, "creation_date": 1436722048, "post_id": 31370103, "comment_id": 50720286, "body": "Whoa, thank you for your answer! Unfortunately it is too complicated for me. Am I got it right that instead of &quot;invisible&quot; overloading of a function <i>pure</i> one can pass the &quot;correct&quot; version of the method explicitly to <i>g</i> via parameter, so it is visible that return value of <i>g</i> depends on expected type of the returned value?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "edited": false, "score": 0, "creation_date": 1436727769, "post_id": 31370103, "comment_id": 50722068, "body": "That&#39;s the idea: instead of overloading, you can have what we call &quot;dictionary passing&quot; (a record containing the definitions of these overloaded operators)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1436771337, "post_id": 31370103, "comment_id": 50733066, "body": "Note that you need just <code>Rank2Types</code> not <code>RankNTypes</code> (at least in the case you have shown)."}, {"owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "edited": false, "score": 0, "creation_date": 1436906883, "post_id": 31370103, "comment_id": 50806632, "body": "@gallais I am going to mark your answer as accepted. It would be great if you could extend your answer with the information about the &quot;dictionary&quot;. I find it quite important notice and I think it should be in the answer and not only in a comment."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1436907092, "post_id": 31370103, "comment_id": 50806759, "body": "You&#39;re quite right. I&#39;ve added a sentence to the introductory paragraph naming the technique used here."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 7, "last_activity_date": 1436907065, "last_edit_date": 1436907065, "creation_date": 1436719132, "answer_id": 31370103, "question_id": 31369835, "link": "https://stackoverflow.com/questions/31369835/might-laziness-also-mean-a-value-of-function-depends-on-context-where-it-is-call/31370103#31370103", "title": "Might laziness also mean a value of function depends on context where it is called?", "body": "<p>As @augustss said, it has nothing to do with laziness but rather the fact that you are working with a typeclass. To make this clearer, you can model typeclasses by explicitly passing along a record packing all the functions the class defines. This technique is called <em>dictionary passing</em> in case you want to look up more info about it.</p>\n\n<p>We start with a few extensions.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes      #-}\n{-# LANGUAGE RecordWildCards #-}\n</code></pre>\n\n<p>And then give the record type packing the functions an <code>Applicative</code> is supposed to have (in practice you'd also have a field saying that <code>f</code> is a <code>Functor</code> but I omit it here for brevity).</p>\n\n<pre><code>data Applicative f =\n  Applicative { pure :: forall a. a -&gt; f a\n              , app  :: forall a b. f (a -&gt; b) -&gt; f a -&gt; f b\n              }\n</code></pre>\n\n<p>And we can define your function <code>g</code> as taking a record saying that <code>f</code> is an <code>Applicative</code> and delivering the behaviour you were describing (I kept <code>Num</code> as a class constraint but, similarly, it could be translated to record passing).</p>\n\n<pre><code>g :: Num a =&gt; Applicative f -&gt; f (a -&gt; a)\ng Applicative{..} = pure (2*)\n</code></pre>\n\n<p>Your two functions <code>f1</code> and <code>f2</code> are still valid definitions:</p>\n\n<pre><code>f1 :: Num a =&gt; [a -&gt; a] -&gt; a\nf1 (g:[]) = g 3\n\nf2 :: Num a =&gt; Maybe (a -&gt; a) -&gt; a\nf2 (Just g) = g 4\n</code></pre>\n\n<p>Now, we want to apply them to <code>g</code> but there's an issue: <code>g</code> has a function type expecting an <code>Applicative f</code> record being passed. Well, we can define the <code>[]</code> and <code>Maybe</code> instances of <code>Applicative</code>:</p>\n\n<pre><code>applicativeList :: Applicative []\napplicativeList =\n  Applicative { pure = (:[])\n              , app  = \\ fs as -&gt; fs &gt;&gt;= \\ f -&gt; fmap f as\n              }\n\napplicativeMaybe :: Applicative Maybe\napplicativeMaybe =\n  Applicative { pure = Just\n              , app  = \\ fs as -&gt; fs &gt;&gt;= \\ f -&gt; fmap f as\n              }\n</code></pre>\n\n<p>And we then have to pick the right one for the application to typecheck (<code>[]</code> for <code>f1</code> and <code>Maybe</code> for <code>f2</code>):</p>\n\n<pre><code>f1g = f1 (g applicativeList)\nf2g = f2 (g applicativeMaybe)\n</code></pre>\n"}], "owner": {"reputation": 470, "user_id": 3144697, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b11dc7da8beeeceb7fe3164dcaf83637?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Ji\u0159i\u010dka", "link": "https://stackoverflow.com/users/3144697/martin-ji%c5%99i%c4%8dka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 31370103, "answer_count": 1, "score": 3, "last_activity_date": 1436907065, "creation_date": 1436717500, "last_edit_date": 1436741108, "question_id": 31369835, "link": "https://stackoverflow.com/questions/31369835/might-laziness-also-mean-a-value-of-function-depends-on-context-where-it-is-call", "title": "Might laziness also mean a value of function depends on context where it is called?", "body": "<p>I'm trying to learn Haskell, and whilst playing with applicative functors, one thing I found puzzles me.</p>\n\n<p>Let's define following function <em>g</em> that returns some functor:</p>\n\n<pre><code>*Main&gt; let g = pure (2*)\n*Main&gt; :t g\ng :: (Num a, Applicative f) =&gt; f (a -&gt; a)\n</code></pre>\n\n<p>Since a return type is <strong>some</strong> functor, I can use <em>g</em> as a parameter in both of these functions:</p>\n\n<pre><code>f1 :: (Num a) =&gt; [a -&gt; a] -&gt; a\nf1 (g:[]) = g 3\n\nf2 :: (Num a) =&gt; Maybe (a -&gt; a) -&gt; a\nf2 (Just g) = g 4\n</code></pre>\n\n<p>But it means that a value the function <em>g</em> returns depends also on context in which will be evaluated! (It might be both List and Maybe.) Is this also a property of laziness? Because until now I was thinking about laziness in a way that a value is <strong>calculated</strong> when is needed, but it is already determined when it is defined (for <em>g</em> in <em>let</em> expression).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1436716697, "post_id": 31369573, "comment_id": 50718673, "body": "Define a function that builds your special events."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1436717208, "post_id": 31369573, "comment_id": 50718802, "body": "To echo n.m.&#39;s comment, this should be of interest: <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">wiki.haskell.org/Smart_constructors</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1436718013, "post_id": 31369573, "comment_id": 50719056, "body": "What you want cannot be done. However you may be interested in <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructors</a>"}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "edited": false, "score": 0, "creation_date": 1437598378, "post_id": 31369573, "comment_id": 51102445, "body": "Thanks, smart constructors look like a good solution. Reid&#39;s answer offers the other standard approach, smart destructors, and I am inclined to accept that as it is the only answer offered. And smart destructors don&#39;t seem to require one to hide the constructors (and give up on pattern-matching)."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1436718955, "creation_date": 1436718955, "answer_id": 31370086, "question_id": 31369573, "link": "https://stackoverflow.com/questions/31369573/literal-values-in-value-constructor/31370086#31370086", "title": "Literal values in value constructor", "body": "<p>You can just let your type represent the data you have, and put the logic in \"smart destructors\", i.e., functions. Try</p>\n\n<pre><code>data Event = Event String String String\n           | FaultyEvent String\n\ntag :: Event -&gt; String\ntag (Event t _ _) = t\ntag FaultyEvent = \"unknown-tag\"\n\n-- etc.\n</code></pre>\n\n<p>Of course you are not restricted to <code>tag :: Event -&gt; String</code>, you could define <code>tag :: Event -&gt; Maybe String</code> instead if it's more useful, without changing the definition of Event.</p>\n"}], "owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1436718955, "creation_date": 1436715768, "question_id": 31369573, "link": "https://stackoverflow.com/questions/31369573/literal-values-in-value-constructor", "title": "Literal values in value constructor", "body": "<p>I have a data type called Event. It looks like this:</p>\n\n<pre><code>data Event = Event { tag :: String\n                   , description :: String\n                   , date :: String\n                   } deriving (Eq, Show)\n</code></pre>\n\n<p>I want to make a special kind of Event that would always have a fallback value in the <code>tag</code> and <code>date</code> fields. Basically, I would like to write something like this (please excuse the incorrect syntax):</p>\n\n<pre><code>data GeneralEvent =       Event String String String\n                  | FaultyEvent \"unknown-tag\" String \"unknown-date\"\n</code></pre>\n\n<p>Using record syntax for defining <code>FaultyEvent</code> also doesn't seem to offer a solution either (again, please excuse the incorrect syntax): :</p>\n\n<pre><code>data FaultyEvent = FaultyEvent { \"unknown-tag\" :: String\n                               , description :: String\n                               , date :: String\n                               } deriving (Eq, Show)\n</code></pre>\n\n<p>Is there a nice way of creating a special kind of <code>Event</code> in Haskell? Or are my syntactical problems caused by not thinking in the proper Haskell way?</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "edited": false, "score": 0, "creation_date": 1436730206, "post_id": 31370758, "comment_id": 50722843, "body": "Yep, that was it.  Anyone else having a similar problem, will need to download the source for cabal from <a href=\"https://www.haskell.org/cabal/download.html\" rel=\"nofollow noreferrer\">here</a>.  Doing <code>cabal install cabal-install</code> will end up giving you the same errors that I mentioned in my question.  Thanks"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1436723305, "creation_date": 1436723305, "answer_id": 31370758, "question_id": 31369531, "link": "https://stackoverflow.com/questions/31369531/cabal-file-in-tar-archive-is-not-in-the-expected-directory/31370758#31370758", "title": "Cabal: File in tar archive is not in the expected directory", "body": "<p>That version of cabal-install had a big making it almost completely unusable. Upgrading should solve this problem.</p>\n"}], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 31370758, "answer_count": 1, "score": 2, "last_activity_date": 1436723305, "creation_date": 1436715499, "question_id": 31369531, "link": "https://stackoverflow.com/questions/31369531/cabal-file-in-tar-archive-is-not-in-the-expected-directory", "title": "Cabal: File in tar archive is not in the expected directory", "body": "<p>I have been unable to install any packages using Cabal, getting an error saying that the tar archive is not in the expected directory.  For example, if I try to do, <code>cabal install mtl</code>, I get the following error:</p>\n\n<blockquote>\n  <p>Resolving dependencies...\n  Failed to install text-1.2.1.1\n  cabal: Error: some packages failed to install:\n  text-1.2.1.1 failed while unpacking the package. The exception was:\n  user error (File in tar archive is not in the expected directory. Expected:\n  \".\" but got the following hierarchy: [\"text-1.2.1.1\"])</p>\n</blockquote>\n\n<p>I have run <code>cabal update</code>, and <code>cabal --version</code> gives the following:</p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.22.5.0 \nusing version 1.22.4.0 of the Cabal library \n</code></pre>\n\n<p>Anyone have any ideas as to why this might be happening?  Let me know if you need any additional information.</p>\n"}, {"tags": ["haskell", "fold", "monoids"], "comments": [{"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 2, "creation_date": 1436714373, "post_id": 31369244, "comment_id": 50717965, "body": "&quot;fold&quot; isn&#39;t a datatype, is it, so it can&#39;t be a monoid... Did you mean why numbers aren&#39;t monoids?"}, {"owner": {"reputation": 199, "user_id": 5013037, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83ee8393e5374303ec3b868da2d9a66d?s=128&d=identicon&r=PG&f=1", "display_name": "fragant", "link": "https://stackoverflow.com/users/5013037/fragant"}, "reply_to_user": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 0, "creation_date": 1436714827, "post_id": 31369244, "comment_id": 50718107, "body": "I meant fold can bee applied on structures which can build monoids or even not"}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 0, "creation_date": 1436714927, "post_id": 31369244, "comment_id": 50718147, "body": "Then are you asking if list is a monoid? Yes it is."}, {"owner": {"reputation": 199, "user_id": 5013037, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83ee8393e5374303ec3b868da2d9a66d?s=128&d=identicon&r=PG&f=1", "display_name": "fragant", "link": "https://stackoverflow.com/users/5013037/fragant"}, "edited": false, "score": 0, "creation_date": 1436715849, "post_id": 31369244, "comment_id": 50718425, "body": "The definition of my lecture says: A quantity M with a binary operation (o) :: M x M -&gt; M is called monoid if the operation (o) is associative and there is a neutral element e. So the example for a structure which doesn&#39;t build a monoid is the foldr applied to <code>(\\_ n -&gt; 1+n) 0</code> which is the definition of the length function. But why is this especially an example for the opposite of the definition? I fullfills it"}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 1, "creation_date": 1436719008, "post_id": 31369244, "comment_id": 50719380, "body": "@fragant &quot;foldr applied to (\\_ n -&gt; 1+n) 0&quot; has type <code>[a] -&gt; Integer</code>, it is indeed not a monoid."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1436722244, "creation_date": 1436722244, "answer_id": 31370589, "question_id": 31369244, "link": "https://stackoverflow.com/questions/31369244/folds-above-functions-monoids/31370589#31370589", "title": "Folds above functions - monoids", "body": "<p>It is hard for me to understand what you're really asking, and I have a suspicion that the exact phrasing of the claim from your lecture might matter.</p>\n\n<p>But by the most intuitive interpretation I can think of you are right, as mathematically, the <code>length</code> function <em>is</em> a \"monoid homomorphism\", mapping the monoid of lists with the concatenation operation to the monoid of integers with the addition operation.</p>\n\n<p>It's technically not so in Haskell, but mostly for the reason that number types haven't been given a <code>Monoid</code> instance because there are two obvious operations to choose between, addition and multiplication. Another reason is that lists in Haskell can be infinite, so <code>length</code> doesn't always give a result.</p>\n"}], "owner": {"reputation": 199, "user_id": 5013037, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83ee8393e5374303ec3b868da2d9a66d?s=128&d=identicon&r=PG&f=1", "display_name": "fragant", "link": "https://stackoverflow.com/users/5013037/fragant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 31370589, "answer_count": 1, "score": 0, "last_activity_date": 1436722244, "creation_date": 1436713739, "question_id": 31369244, "link": "https://stackoverflow.com/questions/31369244/folds-above-functions-monoids", "title": "Folds above functions - monoids", "body": "<p>Why is the fold above the length of a list no monoid?</p>\n\n<p><code>length = foldr (\\_ n -&gt; 1+n) 0</code> </p>\n\n<p>Isn't it associative and has the neutral element <code>0</code> so that it should be a monoid?</p>\n"}, {"tags": ["macos", "haskell", "utf-8", "compiler-errors"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1436706955, "post_id": 31366964, "comment_id": 50715813, "body": "Please copy&amp;paste the code you are trying to compile <i>and</i> the <b>full</b> error message you get."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1436719097, "post_id": 31366964, "comment_id": 50719412, "body": "Probably your program is not really in UTF-8 encoding. Check the settings in your editor."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1436721954, "post_id": 31366964, "comment_id": 50720257, "body": "^^ your program <i>file</i> that is, as saved by your editor. try saving it as ASCII, or UTF-8 ."}], "answers": [{"tags": [], "owner": {"reputation": 239, "user_id": 1325072, "user_type": "registered", "accept_rate": 29, "profile_image": "https://graph.facebook.com/100003490794241/picture?type=large", "display_name": "Dmytro Nasyrov", "link": "https://stackoverflow.com/users/1325072/dmytro-nasyrov"}, "is_accepted": true, "score": 1, "last_activity_date": 1436734780, "creation_date": 1436734780, "answer_id": 31372532, "question_id": 31366964, "link": "https://stackoverflow.com/questions/31366964/utf-8-decoding-error-haskell/31372532#31372532", "title": "UTF-8 decoding error, haskell", "body": "<p>Saved my program in UTF-8. Thanks Reid, Will</p>\n"}], "owner": {"reputation": 239, "user_id": 1325072, "user_type": "registered", "accept_rate": 29, "profile_image": "https://graph.facebook.com/100003490794241/picture?type=large", "display_name": "Dmytro Nasyrov", "link": "https://stackoverflow.com/users/1325072/dmytro-nasyrov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1488, "favorite_count": 0, "accepted_answer_id": 31372532, "answer_count": 1, "score": 1, "last_activity_date": 1436734780, "creation_date": 1436698338, "question_id": 31366964, "link": "https://stackoverflow.com/questions/31366964/utf-8-decoding-error-haskell", "title": "UTF-8 decoding error, haskell", "body": "<p>I'm trying to compile my first haskell program. Have created a simple text file as input for my .hs. But get an error: lexical error (UTF-8 decoding error).\nI have seen there is a workaround for windows - <code>set LANG=C</code>. I'm on mac and next exports doesn't work for me:</p>\n\n<pre><code>export LANG=C\nexport LANG=en_US.UTF-8\n</code></pre>\n\n<p>Any suggestions?\nThanks</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "nix"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 7, "last_activity_date": 1437404126, "last_edit_date": 1437404126, "creation_date": 1436702388, "answer_id": 31367533, "question_id": 31366543, "link": "https://stackoverflow.com/questions/31366543/where-does-haskell-packages-in-nixpkgs-go/31367533#31367533", "title": "where does haskell packages in nixpkgs go?", "body": "<p>I remember seeing in the mailing list (although I cannot find the exact link now) from Peter Simons that the searching has been disabled through nix-env for Haskell packages from the top-level namespace since they are very big and nix-env was already quite slow. Instead all haskell packages are in a separate namespace named <code>haskellPackages</code>. For more information, see <a href=\"https://hydra.nixos.org/build/23816503/download/1/nixpkgs/manual.html#how-to-install-haskell-packages\" rel=\"noreferrer\">here</a>. To install a Haskell package like <code>text</code>, you can use this command:</p>\n\n<pre><code>nix-env -i -A nixpkgs.haskellPackages.text\n</code></pre>\n\n<p>To find a package name, use this command:</p>\n\n<pre><code>nix-env -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages | grep text\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "is_accepted": false, "score": 6, "last_activity_date": 1447933745, "creation_date": 1447933745, "answer_id": 33803111, "question_id": 31366543, "link": "https://stackoverflow.com/questions/31366543/where-does-haskell-packages-in-nixpkgs-go/33803111#33803111", "title": "where does haskell packages in nixpkgs go?", "body": "<p>Citing from <a href=\"http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure\" rel=\"noreferrer\">http://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure</a>:</p>\n\n<blockquote>\n  <p>Nixpkgs distributes build instructions for all Haskell packages registered on\n  <a href=\"http://hackage.haskell.org/\" rel=\"noreferrer\">Hackage</a>, but strangely enough normal Nix package\n  lookups don't seem to discover any of them, except for the default version of\n  ghc, cabal-install, and stack:</p>\n\n<pre><code>$ nix-env -i alex\nerror: selector \u2018alex\u2019 matches no derivations\n$ nix-env -qa ghc\nghc-7.10.2\n</code></pre>\n  \n  <p>The Haskell package set is not registered in the top-level namespace because it\n  is <em>huge</em>. If all Haskell packages were visible to these commands, then\n  name-based search/install operations would be much slower than they are now. We\n  avoided that by keeping all Haskell-related packages in a separate attribute\n  set called <code>haskellPackages</code>, which the following command will list:</p>\n\n<pre><code>$ nix-env -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages\nhaskellPackages.a50         a50-0.5\nhaskellPackages.abacate     haskell-abacate-0.0.0.0\nhaskellPackages.abcBridge   haskell-abcBridge-0.12\nhaskellPackages.afv         afv-0.1.1\nhaskellPackages.alex        alex-3.1.4\nhaskellPackages.Allure      Allure-0.4.101.1\nhaskellPackages.alms        alms-0.6.7\n[... some 8000 entries omitted  ...]\n</code></pre>\n  \n  <p>To install any of those packages into your profile, refer to them by their\n  attribute path (first column):</p>\n\n<pre><code>$ nix-env -f \"&lt;nixpkgs&gt;\" -iA haskellPackages.Allure ...\n</code></pre>\n  \n  <p>The attribute path of any Haskell packages corresponds to the name of that\n  particular package on Hackage: the package <code>cabal-install</code> has the attribute\n  <code>haskellPackages.cabal-install</code>, and so on.</p>\n</blockquote>\n"}], "owner": {"reputation": 1622, "user_id": 1926094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LFTLH.jpg?s=128&g=1", "display_name": "TorosFanny", "link": "https://stackoverflow.com/users/1926094/torosfanny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1290, "favorite_count": 1, "accepted_answer_id": 31367533, "answer_count": 2, "score": 4, "last_activity_date": 1447933745, "creation_date": 1436695124, "last_edit_date": 1436695479, "question_id": 31366543, "link": "https://stackoverflow.com/questions/31366543/where-does-haskell-packages-in-nixpkgs-go", "title": "where does haskell packages in nixpkgs go?", "body": "<p>I once used <code>nix-env -qaP &lt;haskell-package-name&gt;</code> to search for a haskell package. But since I updated my nix channel some time ago, all haskell packages gone.</p>\n\n<p>To be specific:\nqs@BF:~$ nix-channel --list\nnixpkgs <a href=\"https://nixos.org/channels/nixpkgs-unstable\" rel=\"nofollow\">https://nixos.org/channels/nixpkgs-unstable</a></p>\n\n<p>qs@BF:~$ nix-env --version\nnix-env (Nix) 1.9</p>\n\n<p>qs@BF:~$ uname -a\nLinux BF 3.13.0-35-generic #62-Ubuntu SMP Fri Aug 15 01:58:42 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</p>\n\n<p>I wonder if I need to add some other channels which may contain haskell packages. Is there any thing to do with Haskell NG?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "design-patterns"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 9, "creation_date": 1436691396, "post_id": 31365973, "comment_id": 50712018, "body": "It looks like you can just make <code>Transformation</code> be <code>Image -&gt; Image</code>? Then each transform can be constructed from a function taking an extra state required e.g. <code>resizeTransformation = Int -&gt; Int -&gt; Imgae -&gt; Image</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 11, "creation_date": 1436691917, "post_id": 31365973, "comment_id": 50712130, "body": "In the FP world, Transformation would be a function. Whenever you see a one-method class in OO, you can immediately translate it to a function in FP."}, {"owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "edited": false, "score": 0, "creation_date": 1436691978, "post_id": 31365973, "comment_id": 50712146, "body": "Ok, I see, thank you! I am going to try refactoring this in a function."}], "answers": [{"tags": [], "owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "is_accepted": true, "score": 0, "last_activity_date": 1440397372, "creation_date": 1440397372, "answer_id": 32175651, "question_id": 31365973, "link": "https://stackoverflow.com/questions/31365973/pattern-for-oo-abstract-types-in-haskell/32175651#32175651", "title": "Pattern for OO abstract types in Haskell", "body": "<p>Thanks to the comments, I managed to get the application working,\nso I will answer my question describing how I proceeded.</p>\n\n<p>Disclaimer: It is the first time I write a real\nworld application in Haskell, so I am not sure all these are best practices.</p>\n\n<h2>Single method class/interface</h2>\n\n<p>As told in the comments of my question, I used a function for what would have been a single method class or interface in Java.</p>\n\n<pre><code>abstract class Transformation {\n    public abstract void transform(Image image);\n}\n</code></pre>\n\n<p>However, given than I also needed information about the transformation,\nI used a record and included a function in it, so instead of</p>\n\n<pre><code>class Transformation a where\n  transform :: Image -&gt; a -&gt; Image\n\ndata Resize = Resize\n    { newHeight :: Int\n    , newWidth  :: Int\n    } deriving (Show)\n\ninstance Transformation Resize where\n    transform image resize = -- resize the image\n</code></pre>\n\n<p>I ended up with something like</p>\n\n<pre><code>type Processor = Image -&gt; Image\ndata Transformation = Transformation\n                      { name      :: String\n                      , args      :: String\n                      , processor :: Processor\n                      }\n\nparseTransformation :: String -&gt; String -&gt; Maybe Transformation\nparseProcessor      :: String -&gt; String -&gt; Maybe Processor\n\nresizeProcessor :: ResizeInfo -&gt; Processor\ncropProcessor   :: CropInfo -&gt; Processor\n</code></pre>\n\n<p>I parsed the <code>ResizeInfo</code> or <code>CropInfo</code> in <code>parseProcessor</code> depending on the\ngiven transformation name.\nSo after parsing all the transformations, I get an list of <code>Transformation</code>\nwith everything needed to process the images and keep some info about the\ntransformations.</p>\n\n<h2>Injected interface</h2>\n\n<p>The second issue I got was what could be solved by DI in Java.\nHere is a simplified example:</p>\n\n<pre><code>public interface Storage {\n    public void load(StoredObject o);\n    public void save(StoredObject o);\n}\n\npublic class S3Storage implements Storage {\n    // some implementation\n}\n\npublic class LocalStorage implements Storage {\n    // some implementation\n}\n</code></pre>\n\n<p>With this definition, I could simply instanciate the storage\ndepending on a settings file or whatever, and have it injected\nin the rest of my application.</p>\n\n<p>Well this is actually not so different of what I ended up doing in Haskell,\nand it worked fine.</p>\n\n<p>I used a Storage class defined like this</p>\n\n<pre><code>data StoredObject = StoredObject\n                  { uniqueId      :: String\n                  , content       :: Maybe ByteString\n                  } deriving (Show)\n\nclass Storage a where\n    load :: a -&gt; StoredObject -&gt; IO (Either StorageError StoredObject)\n    save :: a -&gt; StoredObject -&gt; IO (Either StorageError ())\n</code></pre>\n\n<p>and then simply created <code>LocalStorage</code> and <code>S3Storage</code> and wrote a <code>Storage</code> instance for each.</p>\n\n<pre><code>data LocalStorage = LocalStorage\n                  { baseDir :: String\n                  }\ninstance Storage LocalStorage where\n    save = -- implementation\n    load = -- implementation\n</code></pre>\n\n<p>I changed the functions I used to abstract the used storage with something like this</p>\n\n<pre><code>downloadHandler :: (Storage a) =&gt; a -&gt; IO ()\ndownloadHandler storage = -- process download\n</code></pre>\n\n<p>Finally, I simply parsed the configuration when loading the application,\ncreated the storage I wanted based it, and passed it around.\nIt roughly looks something like this.</p>\n\n<pre><code>runApp :: String -&gt; IO ()\nrunApp \"local\" = run makeLocalStorage\nrunApp \"s3\"    = run makeS3Storage\nrunApp storage = putStrLn (\"no storage named \" ++ storage) &gt;&gt; exitFailure\n\nrun :: (Storage a) =&gt; a -&gt; IO ()\nrun storage = -- run with my storage\n</code></pre>\n\n<p>With the two above patterns above I managed to get things DRY and extensible enough for now.</p>\n"}], "owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 32175651, "answer_count": 1, "score": 4, "last_activity_date": 1440397372, "creation_date": 1436690424, "last_edit_date": 1436734840, "question_id": 31365973, "link": "https://stackoverflow.com/questions/31365973/pattern-for-oo-abstract-types-in-haskell", "title": "Pattern for OO abstract types in Haskell", "body": "<p>I come from OO languages, and am currently trying to develop an application in Haskell.\nI am trying use what would be an abstract class in OO languages, but this does not seem to fit well with Haskell (and probably most functional languages) type system.</p>\n\n<p>In, let's say Java, a minimal code of what I am trying to express would probably look something like this</p>\n\n<pre><code>abstract class Transformation {\n    public abstract void transform(Image image);\n}\n\nclass ResizeTransformation extends Transformation {\n    public void transform(Image image) {\n        // resize the image\n    }\n}\n\n// some other classes extending Transformation\n\nclass Worker {\n    public void applyTransformations(Image image, Transformation[] trs) {\n        for (Transformation t: trs) {\n            t.transform(image);\n        }\n    }\n}\n\nclass Parser {\n    public Transformation parseTransformation(String rawTransformation) {\n        // return ResizeTransformation or some other concrete transformation\n    }\n}\n</code></pre>\n\n<p>I tried to express this in Haskell with a <code>Transformation</code> class, and creating some instances for each transformation, but I get stuck for the Parser, as it does not seem to be possible to return an abstract type.</p>\n\n<p>Here is more or less what my Haskell code looks like now:</p>\n\n<pre><code>class Transformation a where\n  transform :: Image -&gt; a -&gt; Image\n\ndata Resize = Resize\n    { newHeight :: Int\n    , newWidth  :: Int\n    } deriving (Show)\n\n\ninstance Transformation Resize where\n    transform image resize = -- resize the image\n\napplyTransformations :: (Transformation a) =&gt; Image -&gt; [a] -&gt; Image\napplyTransformations image transformations = foldl transform image transformations\n</code></pre>\n\n<p>And I would like to have a function with a signature like this</p>\n\n<pre><code>parseTransformation :: (Transformation a) =&gt; String -&gt; Maybe a\n</code></pre>\n\n<p>but I do not think it is possible, as returning <code>Maybe Resize</code> results in <code>could not deduce a ~ Resize</code>, which I can understand.</p>\n\n<p>Am I missing something here, or is what I am trying to do an anti-pattern in Haskell.\nIf this seems to be a bad approach, I would love to have a hint of what would be a better way to handle such a case in Haskell.</p>\n"}, {"tags": ["haskell", "generic-programming", "aeson"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1436711499, "post_id": 31365904, "comment_id": 50717083, "body": "If <code>ActionM</code> is a <code>data</code> or <code>newtype</code> you could just define a <code>ToJSON</code> instance for it which which encodes it as some simple JSON value (e.g. 0 or &quot;&quot;.) Then you can auto-derive the ToJSON for <code>Foo</code>. It still wold contain an extra simple value, but it would save you a lot of work."}], "answers": [{"comments": [{"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1436728082, "post_id": 31370887, "comment_id": 50722163, "body": "how would you extend this to also cover <code>Bar</code>?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1436857636, "post_id": 31370887, "comment_id": 50774505, "body": "@ajp I have expanded my answer to cover <code>Bar</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1436857611, "last_edit_date": 1436857611, "creation_date": 1436724115, "answer_id": 31370887, "question_id": 31365904, "link": "https://stackoverflow.com/questions/31365904/possible-to-generically-remove-function-types-from-datatype-to-allow-derivejson/31370887#31370887", "title": "Possible to generically remove function types from datatype, to allow deriveJSON?", "body": "<p>This is a simplistic solution, but couldn't you do something like</p>\n\n<pre><code>data Foo' = Foo' Int\n\ntype Foo = (ActionM String, Foo')\n</code></pre>\n\n<p>and simply obtain the second element of the tuple when you want to serialize?</p>\n\n<p>Tuples are an instance of <a href=\"http://hackage.haskell.org/package/comonad-4.2.6/docs/Control-Comonad-Env.html\" rel=\"nofollow\"><code>ComonadEnv</code></a>, so you could also use functions like <code>ask</code> and <code>extract</code>.</p>\n\n<p><strong>Edit.</strong> <code>Bar</code> is a more complicated case because it is a recursive type. But it could be handled using the <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/Control-Comonad-Trans-Cofree.html\" rel=\"nofollow\"><code>CofreeT</code></a> comonad transformer:</p>\n\n<pre><code>import Data.Functor.Identity\nimport Data.Bifunctor (second)\nimport Control.Comonad -- from 'comonad'\nimport Control.Comonad.Hoist.Class\nimport Control.Comonad.Trans.Cofree -- from 'free'\n\n-- Orphan ComonadHoist instance that will likely be added in future\n-- versions of free\ninstance Functor f =&gt; ComonadHoist (CofreeT f) where\n    cohoist g = CofreeT . fmap (second (cohoist g)) . g . runCofreeT\n\ntype Bar = CofreeT Maybe ((,) (ActionM ())) Foo\ntype Bar' = Cofree Maybe Foo'\n\napplyMagic :: Bar -&gt; Bar'\napplyMagic = cohoist (Identity . extract) . fmap extract\n</code></pre>\n\n<p><code>CofreeT Maybe ((,) (ActionM ())) Foo</code> is a non-empty list of <code>Foo</code> values that have been annotated with <code>ActionM ()</code> values.</p>\n\n<p><code>Cofree Maybe Foo'</code> is a non-empty list of <code>Foo'</code> values, without extra annotations (<code>Cofree Maybe Foo</code> is a synonym for <code>CofreeT Maybe Identity Foo'</code>, where <code>Identity</code> works as the trivial comonad.).</p>\n\n<p>To transform one into the other, <code>applyMagic</code> first uses <code>fmap extract</code> to transform all the <code>Foo</code>s into <code>Foo'</code>s, and then uses <a href=\"http://hackage.haskell.org/package/comonad-4.2.6/docs/Control-Comonad-Hoist-Class.html\" rel=\"nofollow\"><code>cohoist</code></a> from <code>ComonadHoist</code> to remove the \"annotation layer\" underneath <code>CofreeT</code>.</p>\n\n<p>In general, values with \"extra context\" can often be modeled with comonads.</p>\n"}], "owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1436857611, "creation_date": 1436689806, "question_id": 31365904, "link": "https://stackoverflow.com/questions/31365904/possible-to-generically-remove-function-types-from-datatype-to-allow-derivejson", "title": "Possible to generically remove function types from datatype, to allow deriveJSON?", "body": "<p>I have several datatypes representing the state of an application. In various places in the datatype, I have embedded functions or monadic actions, eg.</p>\n\n<pre><code>data Foo = Foo Int (ActionM String)\ndata Bar = Bar Foo (Maybe Bar) (ActionM ())\n</code></pre>\n\n<p>I need to encode most of these datatypes as json so I can send it to the browser for display. Using deriveJSON (from the Aeson package) doesn't work because instances for ActionM can't be derived. However, I don't actually want those bits to be sent anyway. I currently have an approach which works but is basically copy-pasting the full set of datatypes and manually removing the embeded ActionM fields.</p>\n\n<p>I (think I) need one of a couple of things. Either</p>\n\n<ul>\n<li>a way to tell deriveJSON to just ignore fields that it can't figure out, and maybe parse them back into <code>undefined</code>. As far as I can tell this doesn't exist</li>\n<li>a way to automatically generate a parallel set of datatypes with these fields removed. So I want to write something like</li>\n</ul>\n\n<p><code>applyMagic Bar\n</code></p>\n\n<p>and get back</p>\n\n<pre><code>data Foo' = Foo' Int\ndata Bar' = Bar' Foo' (Maybe Bar')\n</code></pre>\n\n<p>Is any of this possible, and how would I do it?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1436717037, "post_id": 31368388, "comment_id": 50718759, "body": "renderRoute only get relative url string from (Route a) ,but i want to get the whole absolute route..which is easy to embed into hamlet by @{} notation..."}, {"owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "reply_to_user": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1436720036, "post_id": 31368388, "comment_id": 50719705, "body": "@doofin Here&#39;s what I&#39;ve used (sorry if it doesn&#39;t fit your usecase): <a href=\"https://git.gnu.io/snowdrift/snowdrift/blob/master/tests/TestImport.hs#L548\" rel=\"nofollow noreferrer\">git.gnu.io/snowdrift/snowdrift/blob/master/tests/&hellip;</a> <a href=\"https://git.gnu.io/snowdrift/snowdrift/blob/master/Handler/User.hs#L87\" rel=\"nofollow noreferrer\">git.gnu.io/snowdrift/snowdrift/blob/master/Handler/User.hs#L&zwnj;&#8203;87</a> Both give an absolute url."}, {"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1436839110, "post_id": 31368388, "comment_id": 50768653, "body": "i see : render :: RenderRoute App =&gt; Text -&gt; Route App -&gt; Text render appRoot = ((appRoot &lt;&gt; &quot;/&quot;) &lt;&gt;) . T.intercalate &quot;/&quot; . fst . renderRoute                   ,but the type of approot function defined in yesod typeclass is not text..so what do u give to render function as the first argument? we can define a approot string of course,but this should already be done by yesod"}, {"owner": {"reputation": 894, "user_id": 994643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6a3e2fbf6abc8e31d4ac4223631c425c?s=128&d=identicon&r=PG", "display_name": "chreekat", "link": "https://stackoverflow.com/users/994643/chreekat"}, "reply_to_user": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1451167867, "post_id": 31368388, "comment_id": 56693038, "body": "@doofin <code>getUrlRender</code> gets the whole absolute route."}], "tags": [], "owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "is_accepted": false, "score": 1, "last_activity_date": 1436708548, "creation_date": 1436708548, "answer_id": 31368388, "question_id": 31365371, "link": "https://stackoverflow.com/questions/31365371/how-to-get-string-from-approotsite-url/31368388#31368388", "title": "how to get string from approot(site url)?", "body": "<p>Are you looking for <code>getUrlRender</code> from <code>Yesod.Core.Handler</code> or maybe <code>renderRoute</code> from <code>Yesod.Core</code>?</p>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436708548, "creation_date": 1436685393, "question_id": 31365371, "link": "https://stackoverflow.com/questions/31365371/how-to-get-string-from-approotsite-url", "title": "how to get string from approot(site url)?", "body": "<p>i looked though yesod tutorial and source code but find no way to do such trival thing...must i use pattern match?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/yesod-core-1.2.2/docs/Yesod-Core.html\" rel=\"nofollow\">https://hackage.haskell.org/package/yesod-core-1.2.2/docs/Yesod-Core.html</a></p>\n\n<p>source:</p>\n\n<pre>\n-- | How to determine the root of the application for constructing URLs.\n--\n-- Note that future versions of Yesod may add new constructors without bumping\n-- the major version number. As a result, you should /not/ pattern match on\n-- @Approot@ values.\ndata Approot master = ApprootRelative -- ^ No application root.\n                    | ApprootStatic !Text\n                    | ApprootMaster !(master -> Text)\n                    | ApprootRequest !(master -> W.Request -> Text)\n</pre>\n"}, {"tags": ["function", "haskell", "types", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1436741344, "post_id": 31364451, "comment_id": 50725703, "body": "If you feel there is a suitable answer below, please consider accepting it by clicking the tick, @user12596."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1436752752, "last_edit_date": 1436752752, "creation_date": 1436676664, "answer_id": 31364473, "question_id": 31364451, "link": "https://stackoverflow.com/questions/31364451/pattern-matching-on-ints/31364473#31364473", "title": "Pattern matching on Ints", "body": "<p>The formatting of your code is a bit off so it is difficult to know what you're asking but you can using pattern matching for input of type Int. An example would be </p>\n\n<pre><code>add x 0 = x\nadd x y = x + y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": false, "score": 13, "last_activity_date": 1436678657, "last_edit_date": 1436678657, "creation_date": 1436676722, "answer_id": 31364480, "question_id": 31364451, "link": "https://stackoverflow.com/questions/31364451/pattern-matching-on-ints/31364480#31364480", "title": "Pattern matching on Ints", "body": "<p>There is an extension that lets you do that, but instead you should simply pattern match on <code>y</code>, and subtract <code>1</code> manually:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>add x y = 1 + x + add x (y - 1)\n</code></pre>\n\n<p>The extension is called <code>NPlusKPatterns</code>. If you <em>really</em> want to use it (keep in mind it's deprecated in haskell 2010), it can be enabled by either passing a <code>-XNPlusKPatterns</code> parameter to GHC, or putting a <code>{-# LANGUAGE NPlusKPatterns #-}</code> at the top of your file.</p>\n"}, {"comments": [{"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 1, "creation_date": 1436785361, "post_id": 31373406, "comment_id": 50740939, "body": "To be fair, in haskell98 you could match for <code>(x + 5)</code>, and such match would fail for numbers less than 5, and succeed and subtract 5 for all other numbers. The functionality was found useless and was removed from haskell2010, and GHC supports it as an extension."}], "tags": [], "owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "is_accepted": false, "score": 2, "last_activity_date": 1436741968, "creation_date": 1436741968, "answer_id": 31373406, "question_id": 31364451, "link": "https://stackoverflow.com/questions/31364451/pattern-matching-on-ints/31373406#31373406", "title": "Pattern matching on Ints", "body": "<p>Pattern matching isn't arbitrary case analysis. It's a disciplined, but limited form of case analysis, where the cases are the <em>constructors</em> of a data type.</p>\n\n<p>In the specific case of pattern matching integers, the constructors are taken to be the integer <em>values</em>. So you can use integer values as the cases for pattern-matching:</p>\n\n<pre><code>foo 0 = ...\nfoo 2 = ...\nfoo x = ...\n</code></pre>\n\n<p>But you can't use arbitrary expressions. The following code is illegal:</p>\n\n<pre><code>foo (2 * x) = ...\nfoo (2 * x + 1) = ...\n</code></pre>\n\n<p><em>You</em> may know that ever integer is either of the form <code>2 * x</code> or <code>2 * x + 1</code>. But the type system doesn't know.</p>\n"}], "owner": {"reputation": 71, "user_id": 5083613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/993b39269cd7dbcda880da70cb0d7cc1?s=128&d=identicon&r=PG&f=1", "display_name": "user12596", "link": "https://stackoverflow.com/users/5083613/user12596"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1436752752, "creation_date": 1436676358, "last_edit_date": 1436741153, "question_id": 31364451, "link": "https://stackoverflow.com/questions/31364451/pattern-matching-on-ints", "title": "Pattern matching on Ints", "body": "<p>I am a beginner in learning Haskell, and I wanted to know if you could pattern match on <code>Int</code>s like so:</p>\n\n<pre><code> add x 0 = x\n add x (1 + y) = 1 + x  + add x y,\n</code></pre>\n\n<p>Or maybe in this way:</p>\n\n<pre><code> add x 0 = x\n add x (successor y) = 1 + x + add x y\n</code></pre>\n"}, {"tags": ["database", "haskell", "esqueleto"], "answers": [{"tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": true, "score": 1, "last_activity_date": 1440802081, "creation_date": 1440802081, "answer_id": 32280835, "question_id": 31363424, "link": "https://stackoverflow.com/questions/31363424/haskell-persistent-w-esqueleto-read-entire-table-and-count-records/32280835#32280835", "title": "Haskell persistent w/ esqueleto: read entire table, and count records", "body": "<ol>\n<li><p>You use a function like <a href=\"https://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Sql.html#v:runSqlPersistM\" rel=\"nofollow\"><code>runSqlPersistM</code></a> or <a href=\"https://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Sql.html#v:runSqlPersistMPool\" rel=\"nofollow\"><code>runSqlPersistMPool</code></a> to evaluate your query in the <code>IO</code> monad. For example:\n</p>\n\n<pre><code>dumpDbTbl :: (MonadIO m) =&gt; SqlPersistT m [AdminChan]\ndumpDbTbl = map entityVal &lt;$&gt; (select . from $ return)\n\nmain :: IO ()\nmain = runStderrLoggingT $ withSqlitePool \":memory:\" 4 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n\n        admins &lt;- dumpDbTbl\n\n        liftIO $ print (admins :: [AdminChan])\n</code></pre></li>\n<li><p>Yes, you can, but you have to include some extra constraints:\n</p>\n\n<pre><code>dumpDbTbl :: (PersistEntity b, MonadIO m,\n              PersistEntityBackend b ~ SqlBackend) =&gt; SqlPersistT m [b]\ndumpDbTbl = map entityVal &lt;$&gt; (select . from $ return)\n</code></pre></li>\n<li><p>You use the esqueleto function <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.1/docs/Database-Esqueleto-Internal-Language.html#v:countRows\" rel=\"nofollow\"><code>countRows</code></a>:\n</p>\n\n<pre><code>countHostBans :: (MonadIO m) =&gt; SqlPersistT m [(T.Text, Int)]\ncountHostBans =\n    map (\\(Value v, Value c) -&gt; (v, c)) &lt;$&gt; (select $ from $ \\banHost -&gt; do\n        let c = countRows\n        groupBy (banHost ^. BanHostHost)\n        return (banHost ^. BanHostHost, c))\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 32280835, "answer_count": 1, "score": 2, "last_activity_date": 1440802081, "creation_date": 1436663702, "question_id": 31363424, "link": "https://stackoverflow.com/questions/31363424/haskell-persistent-w-esqueleto-read-entire-table-and-count-records", "title": "Haskell persistent w/ esqueleto: read entire table, and count records", "body": "<p>I have the following schema:</p>\n\n<pre><code>share [ mkPersist sqlSettings, mkMigrate \"migrateAll\" ] [persistLowerCase|\nAdminChan\n  timestamp T.Text\n  name      T.Text\n  msg       T.Text\nBanHost\n  timestamp T.Text\n  host      T.Text\n  isBanned  Bool\n  reason    T.Text\n|]\n</code></pre>\n\n<p>Now say I want to get all the records in the <code>admin_chan</code> table in the form of <code>[AdminChan]</code>. How can I do that? I have this function:</p>\n\n<pre><code>dumpDbTbl :: SqlPersistT IO [AdminChan]\ndumpDbTbl = map entityVal &lt;$&gt; (select . from $ return)\n</code></pre>\n\n<p>1) But how do I get the <code>[AdminChan]</code> out of the <code>SqlPersistT IO</code> stack? (Note that I'm not using <code>yesod</code>.)</p>\n\n<p>2) Also, is it possible to rewrite the above function such that it becomes polymorphic and can also work with the <code>BanHost</code> table?</p>\n\n<p>3) How can I write a function, using <code>esqueleto</code>, that will return the number of records in a table?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "types", "type-inference", "unification"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1436656754, "post_id": 31362643, "comment_id": 50706206, "body": "What do you mean by &#39;general&#39;? Should the types be generalized? The transformations? Please explain."}, {"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1436658451, "post_id": 31362643, "comment_id": 50706511, "body": "The types should be generalized.For instance : typ(map) = typ(iterate) = typ(map iterate) or typ(iterate) = typ(map) = typ(iterate map).But i am not sure about the transformations."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436660691, "post_id": 31362643, "comment_id": 50706857, "body": "Tell us what you&#39;ve tried, and what prevented the attempt from succeeding."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436662565, "post_id": 31362643, "comment_id": 50707164, "body": "Another thought that occurs to me: this sounds a lot like a homework question; if it is, your teacher (or teacher&#39;s assistant) would probably be willing to discuss this with you in person in great detail."}, {"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1436666547, "post_id": 31362643, "comment_id": 50707725, "body": "Here is what I&#39;ve tried for (map iteration): I have the parameter (a -&gt; b) of map to the parameter (a -&gt; a) of iteration,[a] of map to a of iteration and [b] of map to [a] of iteration applied.Both functions have same number of inputs and outputs,that&#39;s why I thought that I could apply every parameter to each other.  Type(map iteration) = (a -&gt; b) -&gt; [a] -&gt; [b]  It is not a homework but it&#39;s a relevant question to the examination,that&#39;s  why I&#39;ve been trying to find an answer with explanation.In 2 days I have exam and I&#39;m not sure if I can catch my professor to ask :/"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436667247, "post_id": 31362643, "comment_id": 50707835, "body": "What do you mean by the product of these functions? You seem to mean the results of applying each to the other, but that doesn&#39;t seem to be what you&#39;re doing in your comment."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1436667311, "post_id": 31362643, "comment_id": 50707846, "body": "Also, have you tried checking your intuition against the type GHCi infers?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1436674600, "post_id": 31364259, "comment_id": 50709093, "body": "Note that <code>~</code> is type equality? That&#39;s likely not obvious to the OP."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1436707077, "post_id": 31364259, "comment_id": 50715844, "body": "Also, the question seemed possibly to be talking about <code>iterate map</code> and <code>map iterate</code> rather than the compositions (it wasn&#39;t clear)."}, {"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1436741306, "post_id": 31364259, "comment_id": 50725695, "body": "I wrote them down one more time on a paper and tried to understand what you wrote,and i finally understood it.Thanks a lot,but i have a few more questions.  Can we also write for &quot;r&quot; of the first function composition map.iterate : r~ b -&gt; [b] and then t~ [b] -&gt; [[b]].Because you showed &quot;r&quot; for iterate.map but not for map.iterate thats why i was little confused.  And second questions is,whats the difference between (a-&gt;a) and (a-&gt;b) ?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1436744967, "post_id": 31364259, "comment_id": 50726482, "body": "Vucicasena: Sorry about the confustion. I mentioned <code>r ~ b -&gt; b</code> earlier when discussing the type of <code>iterate</code> in <code>map . iterate</code>, and it still holds at the end.  As for your second question, the difference between <code>a -&gt; a</code> and <code>a -&gt; b</code> is that the latter matches <i>any</i> function, while the former only matches automorphisms, that is, functions from a type <code>a</code> to itself."}, {"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1436789038, "post_id": 31364259, "comment_id": 50743126, "body": "So it&#39;s not correct to write r~b -&gt; [b] instead of r~b -&gt; b?And would it make difference if we had for map (a -&gt; a) instead of (a -&gt; b) or would we get the same result ?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1436795073, "post_id": 31364259, "comment_id": 50747076, "body": "Given <code>automap :: (a -&gt; a) -&gt; [a] -&gt; [a]</code>, an analog of <code>map</code> with <code>a -&gt; a</code> instead of <code>a-&gt; b</code>, then <code>automap . iterate</code> won&#39;t compile as <code>a -&gt; a</code> can&#39;t unify with <code>x -&gt; [x]</code>, the type of <code>iterate f</code> for any function <code>f</code>."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 5, "last_activity_date": 1436675188, "last_edit_date": 1436675188, "creation_date": 1436673944, "answer_id": 31364259, "question_id": 31362643, "link": "https://stackoverflow.com/questions/31362643/the-most-general-type-of-product-of-two-functions-in-haskell/31364259#31364259", "title": "The most general type of &quot;product&quot; of two functions in Haskell", "body": "<p>Let's ask GHCi:</p>\n\n<pre><code>ghci&gt; :type map . iterate\nmap . iterate :: (a -&gt; a) -&gt; [a] -&gt; [[a]]\nghci&gt; :type iterate . map\niterate . map :: (a -&gt; a) -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>Let's see how it got them:</p>\n\n<p>Given</p>\n\n<pre><code>map     :: (x -&gt; y) -&gt; [x] -&gt; [y]\niterate :: (b -&gt; b) -&gt; b -&gt; [b]\n(.)     :: (s -&gt; t) -&gt; (r -&gt; s) -&gt; (r -&gt; t)\n</code></pre>\n\n<p>And using <code>a ~ b</code> to mean \"types <code>a</code> and <code>b</code> are equal\".</p>\n\n<p>Then in <code>map . iterate</code> we have</p>\n\n<pre><code>map :: s -&gt; t where\n s ~ x -&gt; y\n t ~ [x] -&gt; [y]\n\niterate :: r -&gt; s where\n r ~ b -&gt; b\n s ~ b -&gt; [b]\n\nso\n x -&gt; y ~ s ~ b -&gt; [b]\n=&gt;\n x ~ b\n y ~ [b]\n t ~ [b] -&gt; [[b]]\n</code></pre>\n\n<p>So <code>map . iterate :: (b -&gt; b) -&gt; [b] -&gt; [[b]]</code>.</p>\n\n<p>Then in <code>iterate . map</code> we have</p>\n\n<pre><code>iterate :: r -&gt; s where\n s ~ b -&gt; b\n t ~ b -&gt; [b]\n\nmap :: s -&gt; t where\n r ~ x -&gt; y\n s ~ [x] -&gt; [y]\n\nso\n b -&gt; b ~ s ~ [x] -&gt; [y]\n b ~ [x]\n b ~ [y]\n x ~ y\n r ~ x -&gt; x\n t ~ [x] -&gt; [[x]]\n</code></pre>\n\n<p>So <code>iterate . map :: (x -&gt; x) -&gt; [x] -&gt; [[x]]</code>.</p>\n\n<p>While these functions have identical types, they have quite different behaviours.</p>\n\n<ul>\n<li><code>iterate . map</code> will, given a function and a list of length <code>k</code>, produce an infinite list of lists of length <code>k</code>.</li>\n<li><code>map . iterate</code> will, given a function and a list of length <code>k</code>, produce a list of length <code>k</code> of infinite lists.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1436812516, "post_id": 31379021, "comment_id": 50758394, "body": "I&#39;m confused now,wasn&#39;t it correct what rampion wrote?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1436831712, "post_id": 31379021, "comment_id": 50766838, "body": "@Vucicasena his answer is about type of functional composition of two functions (<code>f . g</code>); I show it for an application (<code>f g</code>)."}, {"owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1437343446, "post_id": 31379021, "comment_id": 50975644, "body": "My exercise was about a function application,not functional composition?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "edited": false, "score": 0, "creation_date": 1437348446, "post_id": 31379021, "comment_id": 50976707, "body": "@Vucicasena that&#39;s what I thought. but you were a bit unclear on that. :) but since <code>(.)</code> is a function in its own right too, you can take this methodology and use it for a case of functional composition: <code>f . g === (.) f g === ((.) f) g</code>. If you do, you&#39;ll see that <code>(.)</code> has its own rule for types: its type is <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</code>, so for <code>f . g</code> to make sense, <code>f</code> must be of type <code>b -&gt; c</code> and <code>g :: a -&gt; b</code>, i.e. output type of <code>g</code> must be unifyable with input type of <code>f</code>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1436777680, "last_edit_date": 1436777680, "creation_date": 1436777370, "answer_id": 31379021, "question_id": 31362643, "link": "https://stackoverflow.com/questions/31362643/the-most-general-type-of-product-of-two-functions-in-haskell/31379021#31379021", "title": "The most general type of &quot;product&quot; of two functions in Haskell", "body": "<p>First of all, write out explicitly all the omitted parentheses. </p>\n\n<p>To derive the type of application of a function of type <code>a -&gt; b</code> and a value of type <code>c</code>, we need to unify the types <code>a</code> and <code>c</code>, noting any resulting type equivalences. Then the type of the application is <code>b</code>, under the said equivalences. The rule is:</p>\n\n<pre><code>f   ::     a \u2192 b\nx   ::     c\n        ----------\nf x ::         b      , { a ~ c }\n</code></pre>\n\n<p>To find this semi-mechanically, just align the types and note the equivalences:</p>\n\n<pre><code>map ::    (   a1     \u2192     b1     ) \u2192 ([a1] \u2192 [b1]) \niterate :: (a2 \u2192 a2) \u2192 (a2 \u2192 [a2])\n          --------------------------\n        { a1 ~ (a2 \u2192 a2) , b1 ~ (a2 \u2192 [a2]) }\n</code></pre>\n\n<p>So,</p>\n\n<pre><code>map iterate :: [a1] \u2192 [b1]\n</code></pre>\n\n<p>Substituting from the equivalences, we get</p>\n\n<pre><code>            :: [a2 \u2192 a2] -&gt; [a2 \u2192 [a2]]\n</code></pre>\n\n<p>Now we can rename <code>a2</code> back to <code>a</code>, or <code>t</code>, or whatever. Your second example is similar:</p>\n\n<pre><code>iterate :: (   a2     \u2192       a2     ) \u2192 (a2 \u2192 [a2])\nmap ::      (a1 \u2192 b1) \u2192 ([a1] \u2192 [b1]) \n           ---------------------------\n        { a2 ~ a1 \u2192 b1 ,  a2 ~ [a1] \u2192 [b1] }\n</code></pre>\n\n<p>Since <code>a2 ~ a2</code>, we get <code>a1 \u2192 b1 ~ [a1] \u2192 [b1]</code>:</p>\n\n<pre><code>               a1  \u2192  b1\n              [a1] \u2192 [b1]\n            --------------\n        { a1 ~ [a1] ,  b1 ~ [b1] }\n</code></pre>\n\n<p>Both equivalences are impossible, define an infinite type. So the second example has no type in Haskell:</p>\n\n<blockquote>\n  <p>*Main> :t map iterate <br />\n  map iterate :: [a -> a] -> [a -> [a]]  <br />\n   <br />\n  *Main> :t iterate map  <br />\n    <br />\n  :1:9:  <br />\n      Occurs check: cannot construct the infinite type: a ~ [a]  <br />\n      Expected type: (a -> b) -> a -> b  <br />\n        Actual type: (a -> b) -> [a] -> [b]  <br />\n      In the first argument of 'iterate', namely 'map'  <br />\n      In the expression: iterate map  <br />\n    <br />\n  :1:9:  <br />\n      Occurs check: cannot construct the infinite type: b ~ [b]  <br />\n      Expected type: (a -> b) -> a -> b  <br />\n        Actual type: (a -> b) -> [a] -> [b]  <br />\n      In the first argument of 'iterate', namely 'map'  <br />\n      In the expression: iterate map </p>\n</blockquote>\n"}], "owner": {"reputation": 69, "user_id": 5037716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608f09160b5db7f02bb1198ff51c5fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Vucicasena", "link": "https://stackoverflow.com/users/5037716/vucicasena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 1, "accepted_answer_id": 31379021, "answer_count": 2, "score": 0, "last_activity_date": 1436777680, "creation_date": 1436655214, "last_edit_date": 1436721311, "question_id": 31362643, "link": "https://stackoverflow.com/questions/31362643/the-most-general-type-of-product-of-two-functions-in-haskell", "title": "The most general type of &quot;product&quot; of two functions in Haskell", "body": "<p>I must find the most general type from given functions in Haskell, or rather find  the most general type of the \"product\" of two functions, if it exists. I am not sure but maybe I should use Robinson unification algorithm, but I can't understand it. I need a detailed solution, step by step, so I can understand.</p>\n\n<p>Functions :</p>\n\n<pre><code>map :: (a \u2192 b) \u2192 [a] \u2192 [b] \niterate :: (a \u2192 a) \u2192 a \u2192 [a]\n</code></pre>\n\n<p>How to find the most general type for</p>\n\n<ol>\n<li><code>map iterate</code> </li>\n<li><code>iterate map</code></li>\n</ol>\n\n<p>This is not a homework.</p>\n"}, {"tags": ["haskell", "typeclass", "functor", "coercion", "difference-lists"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 2, "creation_date": 1436653036, "post_id": 31362222, "comment_id": 50705466, "body": "See the <a href=\"http://hackage.haskell.org/package/dlist-0.7.1.1\" rel=\"nofollow noreferrer\"><code>dlist</code></a> package. It uses <code>foldr</code> for these instances."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1436653294, "post_id": 31362222, "comment_id": 50705517, "body": "@cchalmers So, it converts to standard lists, maps, and returns to difference lists. I wonder if that preserves the performance features of difference lists."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1436653824, "post_id": 31362222, "comment_id": 50705615, "body": "@chi My thoughts exactly."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436656426, "post_id": 31362222, "comment_id": 50706133, "body": "@WillNess It seems to work just fine for me. Try it out in GHCi?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436656719, "post_id": 31362222, "comment_id": 50706197, "body": "yes, it works. hmm. but it really shouldn&#39;t?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1436657224, "post_id": 31362222, "comment_id": 50706274, "body": "@WillNess It does <i>NOT</i> work if you <code>mappend</code> anything other than an empty list to the result of <code>fmap</code>. E.g. try <code>runHughes $ (fmap fromIntegral $ mkHughes [1,2]) `mappend` mkHughes [3.0]</code>. With a bit more ingenuity you could crash GHC this way."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1436657405, "post_id": 31362222, "comment_id": 50706306, "body": "was just going to type this,  <code>?_ (`unHughes` []) $ fmap (:[2]) $ Hughes (1:) `mappend` Hughes ([10,100]++)</code> --&gt;  <code>[[1,2],[10,2],[100,2]]</code> ; <b>but</b>    <code>?_ (`unHughes` [[4,5,6]]) $ fmap (:[2]) $ Hughes (1:) `mappend` Hughes ([10,100]++)</code> --&gt;  <code>[[1,2],[10,2],[100,2],[ *** CRASH ***</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436662225, "post_id": 31362222, "comment_id": 50707104, "body": "the real problem is,   <code>(`unHughes` []) ( (f &lt;$&gt; Hughes (a++)) &lt;&gt; Hughes (b++))</code> is the same as <code>(`unHughes` b) (f &lt;$&gt; Hughes (a++))</code> which is <code>f &lt;$&gt; (a++b)</code> with your Functor definition, but the types of <code>a</code> and <code>b</code> are just different so <code>a++b</code> is impossible. So it only works - with coercion - when <code>b == []</code>. IOW your Functor says <code>fmap</code> works over the whole list, when the difflist is finally run, but Monoid definition says it works only on the prefix (as does Data.DList too)."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1436726830, "post_id": 31362222, "comment_id": 50721791, "body": "I&#39;m not sure what you mean by &quot;keep the performance improvement&quot;, <code>DList</code> has O(1) concatenation and O(n) map. One a <code>DList</code> has been mapped it still has O(1) concatenation. Your preposed <code>fmap</code> is O(n) (and wrong). The <code>dlist</code> package has been around a while, I don&#39;t think anyone knows a faster way of doing it."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1436693477, "post_id": 31364220, "comment_id": 50712470, "body": "the equivalent Data.DList.Dlist type has a Functor instance defined by <code>fmap f = (fromList . map f . toList)</code> essentially. Does this mean it is invalid in some way?"}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436707800, "post_id": 31364220, "comment_id": 50716041, "body": "@WillNess It&#39;s only valid if <code>[a] -&gt; [a]</code> has the right form. This is fine for <code>DList</code> because the constructor is hidden."}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436709257, "post_id": 31364220, "comment_id": 50716461, "body": "@WillNess It would be invalid if you could pass <i>arbitrary</i> functions to the DList constructor, which you can not."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436720620, "post_id": 31364220, "comment_id": 50719867, "body": "@mniip could you give an example of a problematic function? I think that OP would have no objections to using only <code>singleton</code>, <code>fromList</code> and <code>empty</code>, as that module does. would that make defining a Functor instance possible?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1436720816, "post_id": 31364220, "comment_id": 50719928, "body": "@cchalmers what form is right? or is it some kind of terminology... then what does it mean please, &quot;the right form&quot;?"}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1436724420, "post_id": 31364220, "comment_id": 50721013, "body": "@WillNess By &quot;right form&quot; I meant it makes a valid <code>DList</code>, i.e. isomorphic to a list: <code>(fromList . toList) == id</code>, <code>(toList . fromList) == id</code>. If you&#39;re function was something like <code>map (+1)</code>, which isn&#39;t isomorphic to a list, you couldn&#39;t make a valid <code>Functor</code> out of it. Since the <code>dlist</code> package only lets you make valid <code>Dlist</code>s, it&#39;s safe to have that <code>Functor</code> instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436728962, "post_id": 31364220, "comment_id": 50722453, "body": "A good reason to use a more concrete representation. The simplest one works: <code>data L a = Plain [a] | Pair (L a) (L a) deriving (Foldable, Traversable, Functor)</code>. Conversion from a list is free; conversion to a list uses the default definition."}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436735485, "post_id": 31364220, "comment_id": 50724318, "body": "@dfeuer That&#39;s just <code>Seq</code>, isn&#39;t it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436755670, "post_id": 31364220, "comment_id": 50728515, "body": "@mniip, no, not even close. It&#39;s (approximately) the free magma over lists. <code>Seq</code> is a length-annotated finger tree, a much richer and more flexible structure with somewhat more overhead and slower appends."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1436918145, "post_id": 31364220, "comment_id": 50811084, "body": "@dfeuer <i>&quot;conversion to a list uses the default definition&quot;</i> isn&#39;t that just  the same functional composition, under the covers, that DL does directly anyway, though? Except for the solitary <code>Plain [a]</code> case maybe -- is <code>deriving Foldable</code> smart enough to just return the list? Even then it&#39;s only a constant factor improvement over a corner case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436934929, "post_id": 31364220, "comment_id": 50815135, "body": "@WillNess, the closest data structury thing to a dlist is probably <code>data CNE a = Inj a | Cat (CNE a) (CNE a) ; data L a = Empty | NonEmpty (CNE a)</code>. The free magma over lists has the advantage of free conversion <i>from</i> lists. It may retain more space by a constant factor, but probably allocates less. I haven&#39;t done any performance testing. Either of these approaches, however, will offer a bona fide, no cheating required, <code>Functor</code> instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1436935151, "post_id": 31364220, "comment_id": 50815214, "body": "@WillNess, I&#39;m fairly well convinced that unless there&#39;s a serious performance reason to prefer dlists, they&#39;re nice to use by hand but not worthy of library code. Once you build an API, there are nicer implementations."}], "tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": true, "score": 7, "last_activity_date": 1436732182, "last_edit_date": 1436732182, "creation_date": 1436673342, "answer_id": 31364220, "question_id": 31362222, "link": "https://stackoverflow.com/questions/31362222/avoiding-use-of-unsafecoerce-in-hughes-list-functor-instance/31364220#31364220", "title": "Avoiding use of unsafeCoerce in Hughes&#39; list functor instance", "body": "<p><strong>There is no way to implement a <code>Functor Hughes</code> instance.</strong></p>\n\n<p>Let's examine the definition of <code>Hughes</code>:</p>\n\n<pre><code>data Hughes a = Hughes ([a] -&gt; [a])\n                         ^\n</code></pre>\n\n<p>We can see that the parameter <code>a</code> appears contravariant in the marked location. A <code>Functor</code> instance can only exist when all appearances of the last type parameter are covariant.</p>\n\n<p>Basically you are asked to define a function <code>fmap :: (a -&gt; b) -&gt; ([a] -&gt; [a]) -&gt; [b] -&gt; [b]</code>. The problem is that you can't do anything with <code>[b]</code>, there is no function that accepts <code>[b]</code> or <code>b</code>. You can ignore it, but then the functor law <code>fmap id = id</code> will not hold.</p>\n\n<p>As for DList, the <code>Functor</code> instance is valid because the implementation doesn't export the actual data constructor, only smart constructors. As a result, you cannot constuct dlist values that are arbitrary list processing functions. With provided smart constructors you can only construct dlists that are isomorphic to <code>[a]</code>, which is why the functor laws hold.</p>\n\n<p>If you were to somehow hack (bring) the constructor into the scope, you would find that the functor laws don't actually hold for arbitrary functions, for example that <code>fmap id x /= x</code> if <code>x</code> is something like <code>DList (map negate)</code>.</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 31364220, "answer_count": 1, "score": 4, "last_activity_date": 1436732182, "creation_date": 1436651695, "last_edit_date": 1436663360, "question_id": 31362222, "link": "https://stackoverflow.com/questions/31362222/avoiding-use-of-unsafecoerce-in-hughes-list-functor-instance", "title": "Avoiding use of unsafeCoerce in Hughes&#39; list functor instance", "body": "<p>I have a newtype to represent Hughes' list (ie, list construction):</p>\n\n<pre><code>newtype Hughes a = Hughes {unHughes :: [a] -&gt; [a]}\n</code></pre>\n\n<p>With some functions to work on it:</p>\n\n<pre><code>mkHughes :: [a] -&gt; Hughes a\nmkHughes = Hughes . (++)\n\nrunHughes :: Hughes a -&gt; [a]\nrunHughes h = unHughes h []\n</code></pre>\n\n<p>The <code>Monoid</code> instance is as easy as the functions above are:</p>\n\n<pre><code>instance Monoid (Hughes a) where\n    mempty = Hughes id\n    mappend (Hughes f) (Hughes g) = Hughes (f . g)\n</code></pre>\n\n<p>...but trouble arises when I get to the <code>Functor</code> and <code>Applicative</code> instances. This is what I've come up with so far:</p>\n\n<pre><code>instance Functor Hughes where\n    fmap f (Hughes h) = Hughes $ unsafeCoerce $ fmap f . h\n\ninstance Applicative Hughes where\n    pure = Hughes . (:)\n    (&lt;*&gt;) (Hughes f) (Hughes v) = Hughes $ unsafeCoerce $\n                                  (&lt;*&gt;) &lt;$&gt; f &lt;*&gt; unsafeCoerce v\n</code></pre>\n\n<p>The problem I have is that I don't like using <code>unsafeCoerce</code>. Is there a way to design the <code>Functor</code> instance without using it, or is it unavoidable?</p>\n\n<p>Furthermore, how would I implement the <code>Monad</code> instance for this datatype?</p>\n\n<p>EDIT: Unlike in the <code>DList</code> package, I want to keep the performance improvement, ie, not evaluating the <code>[a] -&gt; [a]</code> but mapping it.</p>\n"}, {"tags": ["haskell", "monads", "genetic-programming", "existential-type"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "edited": false, "score": 0, "creation_date": 1436829759, "post_id": 31362605, "comment_id": 50766338, "body": "Thanks. That worked! :) IntExp is like a wrapper right?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "edited": false, "score": 0, "creation_date": 1436843516, "post_id": 31362605, "comment_id": 50769619, "body": "In a sense. It is a way of constructing an <code>IntExp</code> from an <code>Int</code>."}, {"owner": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "edited": false, "score": 0, "creation_date": 1436951574, "post_id": 31362605, "comment_id": 50823548, "body": "Ahh I see. A totally different question, if you can help me out. I get an error when I make my &#39;data Expr&#39; an instance of Data. The code and error: <a href=\"http://lpaste.net/136444\" rel=\"nofollow noreferrer\">lpaste.net/136444</a>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "edited": false, "score": 0, "creation_date": 1436955802, "post_id": 31362605, "comment_id": 50826243, "body": "How about just: <code>deriving instance Typeable (Expr)</code> - does that work for you?"}, {"owner": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "edited": false, "score": 0, "creation_date": 1436992893, "post_id": 31362605, "comment_id": 50850671, "body": "The error regarding instance of Data still exists. I have updated the same lpaste and you can take a look at it. When I asked on irc, they said GADTs are not supposed to work with Data. If possible, some re-work with Data class would be needed to done."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1436654868, "creation_date": 1436654868, "answer_id": 31362605, "question_id": 31362219, "link": "https://stackoverflow.com/questions/31362219/how-to-correctly-qualify-types-for-working-with-the-random-monads/31362605#31362605", "title": "How to correctly qualify types for working with the random monads", "body": "<p>Try:</p>\n\n<pre><code>instance IsGenExp IntExp where\n   randomGen = do\n    r &lt;- getRandomR (0, 100)\n    return $ IntExp r\n</code></pre>\n\n<p>Note:</p>\n\n<ul>\n<li><code>r</code> is a number</li>\n<li><code>IntExp r</code> is an <code>IntExp</code></li>\n<li><code>return $ IntExp r</code> is a <code>m IntExp</code> for the monad type <code>m</code></li>\n</ul>\n"}], "owner": {"reputation": 33, "user_id": 4957617, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wncSuY46gOE/AAAAAAAAAAI/AAAAAAAAALY/E9uVUF7FPZ0/photo.jpg?sz=128", "display_name": "Kaivan Shah", "link": "https://stackoverflow.com/users/4957617/kaivan-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31362605, "answer_count": 1, "score": 1, "last_activity_date": 1436654868, "creation_date": 1436651676, "question_id": 31362219, "link": "https://stackoverflow.com/questions/31362219/how-to-correctly-qualify-types-for-working-with-the-random-monads", "title": "How to correctly qualify types for working with the random monads", "body": "<p>I want to create a data structure that comprises of defined functions based on: fold, Boolean operations, numeric operations (arithmetic and comparisons), and basic string operations. I'll be trying to evolve these class of functions. Here I am getting an error with MonadRandom.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>-- The following language extensions need to be enabled:\n-- DeriveDataTypeable, FlexibleInstances, MultiParamTypeClasses\n\n{-# LANGUAGE FlexibleContexts, DeriveDataTypeable, FlexibleInstances, MultiParamTypeClasses, StandaloneDeriving, ExistentialQuantification , GADTs #-}\n{-# LANGUAGE RankNTypes #-}\n\nimport GenProg\nimport GenProg.GenExpr\nimport GenProg.GenExpr.Data\nimport Data.Generics\nimport Control.Monad\nimport Control.Monad.Random\nimport Data.Fixed\nimport Data.Typeable\nimport Data.Data\n\nclass IsGenExp t where\n      mutate :: (MonadRandom m) =&gt; t -&gt; m t\n      crossOver :: (MonadRandom m) =&gt; t -&gt; t -&gt; m t\n      randomGen :: (MonadRandom m) =&gt; m t\n\ndata GenExp = forall t . IsGenExp t =&gt; GenExp t\n\ndata IntExp = IntExp Int\ndata FloatExp = FloatExp Float\ndata ListExp = ListExp [GenExp]\ndata ArithExp = Add GenExp GenExp | Sub GenExp GenExp | Mul GenExp GenExp\ndata CompExp = Eq GenExp GenExp | Lt GenExp GenExp | Gt GenExp GenExp\n\ninstance IsGenExp IntExp where\n --  randomGen = (getRandomR (IntExp 1,IntExp 3))\n   randomGen = do\n    r &lt;- getRandomR (0, 100)\n    return r\n</code></pre>\n\n<p>And the error I get:</p>\n\n<pre><code>GADT.hs:33:10:\n    Could not deduce (Random IntExp) arising from a use of `getRandomR'\n    from the context (MonadRandom m)\n      bound by the type signature for\n                 randomGen :: MonadRandom m =&gt; m IntExp\n      at GADT.hs:32:4-12\n    In a stmt of a 'do' block: r &lt;- getRandomR (0, 100)\n    In the expression:\n      do { r &lt;- getRandomR (0, 100);\n           return r }\n    In an equation for `randomGen':\n        randomGen\n          = do { r &lt;- getRandomR (0, 100);\n                 return r }\n\nGADT.hs:33:22:\n    Could not deduce (Num IntExp) arising from the literal `0'\n    from the context (MonadRandom m)\n      bound by the type signature for\n                 randomGen :: MonadRandom m =&gt; m IntExp\n      at GADT.hs:32:4-12\n    In the expression: 0\n    In the first argument of `getRandomR', namely `(0, 100)'\n    In a stmt of a 'do' block: r &lt;- getRandomR (0, 100)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>How do I fix this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1436652689, "creation_date": 1436652689, "answer_id": 31362340, "question_id": 31361428, "link": "https://stackoverflow.com/questions/31361428/shortest-way-to-create-a-date/31362340#31362340", "title": "Shortest way to create a date", "body": "<p>I would say that your code is quite clean and you don't need to worry. But if you are still interested this is somewhat shorter than your code:</p>\n\n<pre><code>import Data.Time.Format\nimport Data.Text (Text, unpack, pack)\nimport Data.Time.Calendar\n\ngetDate :: Text -&gt; Text -&gt; Text -&gt; String\ngetDate year month day = formatTime defaultTimeLocale \"%B %d %Y\" (fromGregorian (toInt year) (toInt month) (toInt day)) \n    where\n      toInt :: (Read a, Num a) =&gt; Text -&gt; a\n      toInt = read . unpack\n</code></pre>\n\n<p>Or if you can change the interface slightly then it can be even more short:</p>\n\n<pre><code>getDate2 :: Integer -&gt; Int -&gt; Int -&gt; String\ngetDate2 year month day = formatTime defaultTimeLocale \"%B %d %Y\" (fromGregorian year month day)\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 31362340, "answer_count": 1, "score": 2, "last_activity_date": 1436652689, "creation_date": 1436645936, "question_id": 31361428, "link": "https://stackoverflow.com/questions/31361428/shortest-way-to-create-a-date", "title": "Shortest way to create a date", "body": "<p>I am building a date in a specific format starting from year, month and day available:</p>\n\n<pre><code>import Data.Time\nimport Data.Time.Format\n\ngetDate :: Text -&gt; Text -&gt; Text -&gt; String\ngetDate year month day = formatTime defaultTimeLocale \"%B %d %Y\" date\n                         where date = buildTime defaultTimeLocale oldDate :: UTCTime\n                               oldDate = zip \"Ymd\" $ map unpack [year, month, day]\n</code></pre>\n\n<p>Anyway what I am doing here it looks too long (before I put values in a format and then convert that format in another format). Is there a way to make only one single conversion? I look through the API but I am not sure there is something like that available.</p>\n"}, {"tags": ["haskell", "sudoku"], "answers": [{"comments": [{"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 0, "creation_date": 1436714360, "post_id": 31361604, "comment_id": 50717958, "body": "Okay great, the code works but would it be possible for you to please add a bit of explanation for your solution?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 1, "creation_date": 1436714644, "post_id": 31361604, "comment_id": 50718048, "body": "Just trace out the execution - first look at <code>map groupBy3 boxes</code>, then <code>transpose $ map groupBy3 boxes</code>, then <code>concat $ transpose $ map groupBy3 boxes</code>, etc. and you&#39;ll see how it works. And if you found this answer helpful, an upvote would be appreciated."}, {"owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "edited": false, "score": 0, "creation_date": 1436715245, "post_id": 31361604, "comment_id": 50718237, "body": "Thanks, I&#39;m going to add an edit with type signatures and the code I actually used and all if you don&#39;t mind."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1436654009, "last_edit_date": 1436654009, "creation_date": 1436647135, "answer_id": 31361604, "question_id": 31360775, "link": "https://stackoverflow.com/questions/31360775/find-9-3x3-blocks-of-sudoku-board-haskell/31361604#31361604", "title": "Find 9 3x3 &quot;blocks&quot; of Sudoku board (Haskell)", "body": "<p>First, write a <code>groupBy3</code> function which groups a list by three elements:</p>\n\n<pre><code>groupBy3 :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>Then use the following chain of operations:</p>\n\n<ul>\n<li><code>map groupBy3</code></li>\n<li><code>transpose</code></li>\n<li><code>concat</code></li>\n<li><code>groupBy3</code></li>\n<li><code>map concat</code></li>\n</ul>\n\n<p>Written on my phone, so it's untested but it should be close.</p>\n\n<p>Update: I verified that this works:</p>\n\n<pre><code>groupBy3 (a:b:c:ds) = [a,b,c] : groupBy3 ds\ngroupBy3 []         = []\ngroupBy3 as         = [ as ]  -- won't happen\n\nboxes =  map concat . groupBy3 . concat . transpose . map groupBy3\n\ngrid = [ [ [i,j] | j &lt;- ['1'..'9'] ] | i &lt;- ['a'..'i'] ]\n\ntest1 = boxes grid\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1436953183, "post_id": 31367028, "comment_id": 50824556, "body": "Sudoku solvers are one of the problem domains where <code>Data.Map</code> usually offers better performance than mutable arrays (because some sudoku puzzles can&#39;t be solved without trial and error, and in general the simpler a solver is the more trial and error it will use on a given puzzle)"}], "tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": false, "score": 0, "last_activity_date": 1436698735, "creation_date": 1436698735, "answer_id": 31367028, "question_id": 31360775, "link": "https://stackoverflow.com/questions/31360775/find-9-3x3-blocks-of-sudoku-board-haskell/31367028#31367028", "title": "Find 9 3x3 &quot;blocks&quot; of Sudoku board (Haskell)", "body": "<p>Not an exact answer for this problem but you're much better off using arrays rather than lists. Since you need to change elements, you'll probably want to use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/array/Data-Array-ST.html\" rel=\"nofollow\">mutable arrays</a>.</p>\n\n<p>You could then implement blocks as \"views\" of the base array, simply by applying different offsets to the index operations, there is no need to copy them.</p>\n"}, {"tags": [], "owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "is_accepted": false, "score": 0, "last_activity_date": 1483729236, "creation_date": 1483729236, "answer_id": 41512508, "question_id": 31360775, "link": "https://stackoverflow.com/questions/31360775/find-9-3x3-blocks-of-sudoku-board-haskell/41512508#41512508", "title": "Find 9 3x3 &quot;blocks&quot; of Sudoku board (Haskell)", "body": "<p>Another approach, although perhaps not as elegant as the accepted answer:</p>\n\n<pre><code>map concat [(map  (take 3 . drop i) . (take 3 . drop j)) grid | i &lt;- [0, 3, 6], j &lt;- [0, 3, 6]]\n</code></pre>\n\n<p>where <code>grid</code> is the 9x9 Sudoku grid.</p>\n"}], "owner": {"reputation": 641, "user_id": 3861396, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5461c6b9136f38ca27541a6b45a6cc?s=128&d=identicon&r=PG&f=1", "display_name": "2016rshah", "link": "https://stackoverflow.com/users/3861396/2016rshah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "accepted_answer_id": 31361604, "answer_count": 3, "score": 0, "last_activity_date": 1483729236, "creation_date": 1436641595, "last_edit_date": 1495540911, "question_id": 31360775, "link": "https://stackoverflow.com/questions/31360775/find-9-3x3-blocks-of-sudoku-board-haskell", "title": "Find 9 3x3 &quot;blocks&quot; of Sudoku board (Haskell)", "body": "<p>I am learning Haskell and I decided to embark on a small sudoku solver as a project. I have been using <a href=\"http://www.cse.chalmers.se/edu/year/2014/course/TDA555/lab3.html\" rel=\"nofollow noreferrer\">this assignment</a> as a guide and I recently hit a wall on sub-problem <code>D2</code> which is to create a function that will generate the sudoku blocks (9 3x3 grids) from a Sudoku board (a 9x9 grid).</p>\n\n<p>I started writing the following code but I quickly realized it was a terrible idea. It is clunky code that is not idiomatic Haskell (in my opinion) and completely violates the DRY principle.      </p>\n\n<pre><code>type Block = [Maybe Int]\ndata Sudoku = Sudoku [[Maybe Int]]\n\nblocks :: Sudoku -&gt; [Block]\nblocks (Sudoku rs) = block1 : block2 : block3 : block4 : block5 : block6 : block7 : block8 : block9 : []\n  where block1 = [(rs!!0)!!0] ++ [(rs!!0)!!1] ++ [(rs!!0)!!2] ++ [(rs!!1)!!0] ++ [(rs!!1)!!1] ++ [(rs!!1)!!2]++ [(rs!!2)!!0] ++ [(rs!!2)!!1] ++ [(rs!!2)!!2]  \n        block2 = ...\n        block3 = ...\n        ...\n</code></pre>\n\n<p><strong>I was wondering how to write a more concise and idiomatic function to complete the task?</strong> How would you implement it? Any ideas are appreciated!</p>\n\n<p>I have also consulted <a href=\"https://stackoverflow.com/questions/21270501/how-to-create-lists-of-3x3-sudoku-block-in-python\">this</a> previous and possibly related SO question but I was not sure how to convert the pythonic solution to Haskell and whether or not I even should. I have also seen <a href=\"https://stackoverflow.com/questions/4851802/haskell-get-block-for-sudoku-solver\">this</a> question but I have structured my Sudoku board differently. </p>\n\n<p>All of my current code can be found <a href=\"https://github.com/2016rshah/sudoku-solver/blob/master/src/Main.hs\" rel=\"nofollow noreferrer\">here</a>. Also, let me know if I can clarify anything. </p>\n"}, {"tags": ["haskell", "hlist"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1436664109, "creation_date": 1436664109, "answer_id": 31363461, "question_id": 31360724, "link": "https://stackoverflow.com/questions/31360724/fixing-type-inference-in-hlists/31363461#31363461", "title": "Fixing type inference in HLists", "body": "<p>There is no functional dependency on the <code>ApplyAB</code> class, so when GHC tries to select an instance, the input types don't determine the result type.  In this case, this causes all the intermediate types in the <code>hFoldr</code> chain to become ambiguous, and GHC doesn't know which instances to select.</p>\n\n<p>To solve this, you can use a trick, where you keep the result type completely general in the head of the instance, and use an equational <code>~</code> constraint to restrict it <em>after</em> GHC has selected the instance (only the head of an instance is used for selection).</p>\n\n<p>If you do <code>:i ApplyAB</code> in GHCi, you will notice that several of the pre-defined instances use such equational constraints.</p>\n\n<p>Using this (and adding <code>TypeFamilies</code>) makes your code work for me:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Lib\n    ( y\n    ) where\n\nimport Data.HList\n\ndata HConcat2 = HConcat2\ninstance s ~ String =&gt; ApplyAB HConcat2 (String, String) s where\n  applyAB _ (a,b) = a ++ b\ninstance s ~ String =&gt; ApplyAB HConcat2 (Int, String) s where\n  applyAB _ (_,a) = a\n\nx :: HList '[Int, String, Int, String]\nx = 3 .*. \"Hello\" .*. 4 .*. \" World\" .*. HNil\n\ny :: String\ny = hFoldr HConcat2 \"Result: \" x\n</code></pre>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31363461, "answer_count": 1, "score": 3, "last_activity_date": 1436664109, "creation_date": 1436641232, "last_edit_date": 1436644770, "question_id": 31360724, "link": "https://stackoverflow.com/questions/31360724/fixing-type-inference-in-hlists", "title": "Fixing type inference in HLists", "body": "<p>I've been trying to get the some code to compile. It's meant to take a <code>HList</code>, extract out the strings and concatenate them together.</p>\n\n<pre><code>\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n\nmodule Lib\n    ( y\n    ) where\n\nimport Data.HList\n\ndata HConcat2 = HConcat2\ninstance ApplyAB HConcat2 (String, String) String where\n  applyAB _ (a,b) = a ++ b\ninstance ApplyAB HConcat2 (Int, String) String where\n  applyAB _ (_,a) = a\n\nx :: HList '[Int, String, Int, String]\nx = 3 .*. \"Hello\" .*. 4 .*. \" World\" .*. HNil\n\ny :: String\ny = hFoldr HConcat2 \"Result: \" x\n</code></pre>\n\n<p>Unfortunately, when I try to compile this it gives me</p>\n\n<pre>\n    No instance for (ApplyAB HConcat2 ([Char], [Char]) r2)\n      arising from a use of \u2018hFoldr\u2019\n    The type variable \u2018r2\u2019 is ambiguous\n    Note: there is a potential instance available:\n      instance ApplyAB HConcat2 (String, String) String\n        -- Defined at src/Web/Rusalka/Condition.hs:274:10\n    In the expression: hFoldr HConcat2 \"Result: \" x\n    In an equation for \u2018y\u2019: y = hFoldr HConcat2 \"Result: \" x\n</pre>\n\n<p>How do I convince it to use the instances I've declared?</p>\n"}, {"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 1, "creation_date": 1436823019, "post_id": 31359894, "comment_id": 50763956, "body": "Is <code>LiftIO</code> a typo, should be <code>liftIO</code>? Also <code>try</code> cannot change the monad it is running in (<code>runDB</code> is not returning an <code>IO</code> and you are trying to make it return <code>IO</code>). In fact it looks like <code>try</code> might work just fine against <code>runDB</code> itself."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 1, "creation_date": 1436878511, "post_id": 31359894, "comment_id": 50788017, "body": "You should provide a type signature for <code>runDb</code>. Both @Guvante&#39;s comment and my answer should make it clear that <code>runDB</code> does not return an <code>IO</code>. Since the exception you are using has only one value, the <code>Maybe</code>/<code>MaybeT</code> monad is sufficiently powerful for what you are doing. See the last part of my answer. If you still have trouble, you should include the code you elided in the <code>runMaybeT</code> block."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1436898850, "post_id": 31359894, "comment_id": 50802164, "body": "@Guvante, you are right <code>LiftIO</code> was a typo and also your observation is correct. I ended up going down the rabbit hole because of my type signature."}], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436898797, "post_id": 31407016, "comment_id": 50802124, "body": "Thank you for the detailed response @Andrew. I had posted this on Reddit as well and someone had suggested what you and @Guvante had mentioned as well. The short story is I had provided type signature for <code>try</code> to suppress one error message but it lead to more problems later on. Just removing the <code>liftIO</code> and using <code>try</code> directly works as long as I move the type signature to the case expression. <a href=\"https://www.reddit.com/r/haskell/comments/3d5kdm/help_with_catching_exceptions/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3d5kdm/&hellip;</a>"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436904860, "post_id": 31407016, "comment_id": 50805464, "body": "@Ecognium That does work, but as I tried to explain in my last code block, your use of <code>try</code> is entirely unnecessary. You are converting a <code>Maybe</code> to an <code>Exception</code>, catching the <code>Exception</code> as an <code>Either</code>, and then pattern matching to get back to an <code>Exception</code>. My suggestion is to just use <code>MaybeT</code> for early termination and then pattern matching on the result of that to turn it into an exception. If you put up your the entire contents of your function somewhere (maybe on another question), then I can show you what I mean better."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436915047, "post_id": 31407016, "comment_id": 50810213, "body": "Thanks. The reason I am throwing an Exception is that&#39;s the only way to &#39;rollback&#39; the transaction.  I was just using MaybeT before and a <code>Nothing</code> value does not rollback so need to <code>throwIO Exception</code>.  There are bunch of insert statements in my <code>MaybeT</code> which you will not know from my question, of course."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 1, "creation_date": 1436961797, "post_id": 31407016, "comment_id": 50829977, "body": "As an alternative, there is also <a href=\"https://hackage.haskell.org/package/persistent-2.2/docs/Database-Persist-Sql.html\" rel=\"nofollow noreferrer\">transactionUndo</a>, which can roll back a transaction without using the special exception-handling behavior. Just in case you ever need it."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436999315, "post_id": 31407016, "comment_id": 50853688, "body": "Oh nice. I did not know about that at all. I will try to use it instead of <code>throwIO</code> and may make things cleaner."}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "edited": false, "score": 0, "creation_date": 1512918965, "post_id": 31407016, "comment_id": 82440583, "body": "Hi I had the exact same confusion and just wanted to say that this answer really helped me a lot, thank you!"}], "tags": [], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "is_accepted": true, "score": 4, "last_activity_date": 1436877994, "creation_date": 1436877994, "answer_id": 31407016, "question_id": 31359894, "link": "https://stackoverflow.com/questions/31359894/catching-an-exception-from-rundb/31407016#31407016", "title": "Catching an Exception from runDb", "body": "<p>General type signature for <code>try</code>:</p>\n\n<pre><code>(MonadBaseControl IO m, Exception e) =&gt; m a -&gt; m (Either e a)\n</code></pre>\n\n<p>Specialized type signature for <code>try</code> (as it appears in your code):</p>\n\n<pre><code>IO Auth -&gt; IO (Either MyException Auth)\n</code></pre>\n\n<p>So, the monadic value that is the argument to <code>try</code> has type:</p>\n\n<pre><code>IO Auth\n</code></pre>\n\n<p>Everything listed above, you probably already understood. If we look at the type signature for your <code>runDb</code>, we get this:</p>\n\n<pre><code>runDb :: (MonadReader Config m, MonadIO m) =&gt; SqlPersistT m a -&gt; m a\n</code></pre>\n\n<p>I sort of had to guess because you didn't provide a type signature, but that is probably what it is. So now, the problem should be a little clearer. You are trying to use <code>runDb</code> to create a monadic value for something that's supposed to be in <code>IO</code>. But <code>IO</code> doesn't satisfy the <code>MonadReader Config</code> instance that you need.</p>\n\n<p>To make the mistake more clear, let's make <code>runDb</code> more monomorphic. You could give it this type signature instead: </p>\n\n<pre><code>type AppM = ReaderT Config (EitherT ServantErr IO)\nrunDb :: SqlPersistT AppM a -&gt; AppM a\n</code></pre>\n\n<p>And now if you tried to compile your code, you would get an even better error. Instead of telling you </p>\n\n<pre><code>No instance for (Control.Monad.Reader.Class.MonadReader Config IO)\n</code></pre>\n\n<p>It would tell you that <code>IO</code> doesn't match <code>AppM</code> (although it would probably expand the type synonym). Practically, what this means is that you can't get the shared pool of database connections magically out of <code>IO</code>. You need the <code>ReaderT Config</code> that was passing it around everywhere.</p>\n\n<p>The easiest fix I can think of would be to stop using exceptions where they aren't necessary:</p>\n\n<pre><code>mauth &lt;- runDb $ runMaybeT $ do\n            ... -- Same stuff you were doing earlier \ncase mauth of\n    Just auth -&gt; return auth\n    Nothing   -&gt; lift $ left err400 { errBody = \"Could not create user\"}\n</code></pre>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 2, "accepted_answer_id": 31407016, "answer_count": 1, "score": 3, "last_activity_date": 1436877994, "creation_date": 1436635817, "last_edit_date": 1495539911, "question_id": 31359894, "link": "https://stackoverflow.com/questions/31359894/catching-an-exception-from-rundb", "title": "Catching an Exception from runDb", "body": "<p>This is a follow-up to my previous post. <a href=\"https://stackoverflow.com/questions/31310736/maybet-and-transactions-in-rundb/31323697\">MaybeT and Transactions in runDb</a></p>\n\n<p>I thought this will be a simple thing to do but I have been trying to figure this out for over a day and still haven't made much progress. So thought I will give up and ask! </p>\n\n<p>I just added a <code>try</code> function (from <code>Control.Exception.Lifted</code>) to my previous code and I couldn't get the code to type check. Variants like <code>catch</code> and <code>handle</code> had similar issues. </p>\n\n<pre><code>eauth &lt;- LiftIO (\n           try( runDb $ do\n                ma &lt;- runMaybeT $ do\n                   valid &lt;- ... \n                case ma of\n                  Just a -&gt; return a\n                  Nothing -&gt; liftIO $ throwIO MyException\n            )  :: IO (Either MyException Auth) \n          )\ncase eauth of\n    Right auth -&gt; return auth\n    Left _     -&gt; lift $ left err400 { errBody = \"Could not create user\"}\n</code></pre>\n\n<p>My <code>runDb</code> looks like this (I also tried a variant where I removed <code>liftIO</code>):</p>\n\n<pre><code>runDb query = do\n    pool &lt;- asks getPool\n    liftIO $ runSqlPool query pool\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>No instance for (Control.Monad.Reader.Class.MonadReader Config IO)\n  arising from a use of \u2018runDb\u2019\nIn the expression: runDb\nIn the first argument of \u2018try\u2019, namely\n  \u2018(runDb\n    $ do { ma &lt;- runMaybeT ... \n</code></pre>\n\n<p>I am running inside servant handler and my return type is <code>AppM Auth</code> where </p>\n\n<pre><code> type AppM = ReaderT Config (EitherT ServantErr IO)\n</code></pre>\n\n<p>I have tried many combinations of lifting but doesn't seem to be helping. I thought I will take this opportunity to figure out things from scratch and I hit a wall as well. If someone could suggest how you arrived at the answer, it will be super instructive for me. </p>\n\n<p>This has been my thought process: </p>\n\n<ol>\n<li>I see <code>runSqlConn :: MonadBaseControl IO m =&gt; SqlPersistT m a -&gt; Connection -&gt; m a</code></li>\n<li>So that seems to imply it will be in the <code>IO</code> monad, which means <code>try</code> should work</li>\n<li>I think check the definition of <code>MonadBaseControl</code> which has <code>class MonadBase b m =&gt; MonadBaseControl b m | m -&gt; b</code>. At this point I am confused. This functional dependency logic seems to be suggest type <code>m</code> dictates what <code>b</code> will be but in the previous one <code>b</code> was specified as <code>IO</code>. </li>\n<li>I check <code>MonadBase</code> and that did not give me any clue either. </li>\n<li>I check <code>SqlPersistT</code> and got no clues either. </li>\n<li>I reduced the problem to something very simple like <code>result &lt;- liftIO (try (evaluate (5 `div` 0)) :: IO (Either SomeException Int))</code> and that worked. So I was even more confused at this time. Doesn't <code>runDb</code> work in <code>IO</code> so shouldn't the same thing work for my original code?</li>\n</ol>\n\n<p>I thought I can figure this out by backtracking but it seems like my level of Haskell knowledge is just not sufficient to get at the root of the problem. Appreciate if people can provide step by step pointers as to arrive at the right solution. </p>\n\n<p>Thanks! </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1436642335, "post_id": 31359890, "comment_id": 50702658, "body": "You need to inline <code>(*)</code>."}, {"owner": {"reputation": 2195, "user_id": 786174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f746c3fbce45d6501d78d63dcc88c98?s=128&d=identicon&r=PG", "display_name": "SvenK", "link": "https://stackoverflow.com/users/786174/svenk"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1436645074, "post_id": 31359890, "comment_id": 50703396, "body": "Ah, this solves the issue. If you turn this into an answer, I will accept it. Thanks cchalmers."}], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 3, "last_activity_date": 1436647769, "creation_date": 1436647769, "answer_id": 31361693, "question_id": 31359890, "link": "https://stackoverflow.com/questions/31359890/haskell-rewrite-rules-not-firing-in-different-module/31361693#31361693", "title": "Haskell Rewrite Rules not firing in different module", "body": "<p><code>(*)</code> needs to be inlined so the rules have a chance to fire.</p>\n\n<p>The rules work within the module because ghc is free to inline functions in the same module.</p>\n"}], "owner": {"reputation": 2195, "user_id": 786174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f746c3fbce45d6501d78d63dcc88c98?s=128&d=identicon&r=PG", "display_name": "SvenK", "link": "https://stackoverflow.com/users/786174/svenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 31361693, "answer_count": 1, "score": 3, "last_activity_date": 1436647769, "creation_date": 1436635806, "question_id": 31359890, "link": "https://stackoverflow.com/questions/31359890/haskell-rewrite-rules-not-firing-in-different-module", "title": "Haskell Rewrite Rules not firing in different module", "body": "<p>I defined a module with a stream datatype and a bunch of rewrite rules. The rewrite rules work perfectly in the <code>Stream</code> module, but if I import the <code>Stream</code> module in a different module, the rules don't get triggered anymore. What am I doing wrong?</p>\n\n<p>If everything would work as expected, then the rules <code>zip/fmap/left</code> and <code>zip/unfold</code> would get triggered a couple of times.</p>\n\n<p>I'm using GHC 7.10.1.</p>\n\n<hr>\n\n<p>Stream.hs:</p>\n\n<pre><code>module Stream (Stream,map,scan,unfold,zip,zipWith,take) where\n\nimport Prelude hiding (zipWith,head,repeat,take,splitAt,map,zip)\nimport Control.Arrow\n\ndata Stream a = Cons !a (Stream a)\n\nmap :: (a -&gt; b) -&gt; Stream a -&gt; Stream b\nmap f (Cons x xs) = Cons (f x) (map f xs)\n{-# NOINLINE map #-}\n\ninstance Functor Stream where\n  fmap = map\n\ninstance Num n =&gt; Num (Stream n) where\n  (+) = zipWith (+)\n  (*) = zipWith (*)\n  (-) = zipWith (-)\n  negate = fmap negate\n  abs = fmap abs\n  signum = fmap signum\n  fromInteger = repeat . fromInteger\n\nscan :: (a -&gt; b -&gt; a) -&gt; a -&gt; Stream b -&gt; Stream a\nscan f a (Cons b bs) = Cons a (scan f (f a b) bs)\n{-# NOINLINE scan #-}\n\nunfold :: (s -&gt; (a,s)) -&gt; s -&gt; Stream a\nunfold f s0 =\n  let (a,s) = f s0\n  in Cons a (unfold f s)\n{-# NOINLINE unfold #-}\n\nzip :: Stream a -&gt; Stream b -&gt; Stream (a,b)\nzip (Cons a as) (Cons b bs) = Cons (a,b) (zip as bs)\n{-# NOINLINE zip #-}\n\nzipWith :: (a -&gt; b -&gt; c) -&gt; Stream a -&gt; Stream b -&gt; Stream c\nzipWith f as bs = fmap (uncurry f) (zip as bs)\n{-# INLINE zipWith #-}\n\ntake :: Int -&gt; Stream a -&gt; [a]\ntake 0 _           = []\ntake n (Cons x xs) = x : take (n-1) xs\n\nhead :: Stream a -&gt; a\nhead (Cons a _) = a\n{-# INLINE CONLIKE head #-}\n\nrepeat :: a -&gt; Stream a\nrepeat = unfold (\\b -&gt; (b,b))\n{-# INLINE repeat #-}\n\n{-# RULES\n\"zip/unfold\"       forall f g z0 z1. zip (unfold f z0) (unfold g z1) = unfold (\\(s0,s1) -&gt; let (a,s0') = f s0; (b,s1') = g s1 in ((a,b),(s0',s1'))) (z0,z1)\n\"map/map\"          forall f g as. map f (map g as) = map (f . g) as\n\"map/id\"           forall as. map id as = as\n\"scan/fmap\"        forall f g as z. scan f z (map g as) = scan (\\a b -&gt; f a (g b)) z as\n\"scan/scan\"        forall f g as z0 z1. scan f z0 (scan g z1 as) = map fst $ scan (\\(a,b) c -&gt; let gbc = g b c in (f a gbc,gbc)) (z0,z1) as\n\"scan/zip/left\"    forall f z0 as bs. zip (scan f z0 as) bs = scan (\\(s,_) (a,b) -&gt; (f s a,b)) (z0,head bs) (zip as bs)\n\"scan/zip/right\"   forall f z0 as bs. zip as (scan f z0 bs) = scan (\\(_,s) (a,b) -&gt; (a,f s b)) (head as,z0) (zip as bs)\n\"zip/fmap/left\"    forall f as bs. zip (map f as) bs = map (first f) (zip as bs)\n\"zip/fmap/right\"   forall f as bs. zip as (map f bs) = map (second f) (zip as bs)\n  #-}\n</code></pre>\n\n<hr>\n\n<p>Test.hs</p>\n\n<pre><code>module Test(test,main) where\n\nimport Prelude hiding (take)\nimport Stream\n\ntest :: Stream Int\ntest = (1 :: Stream Int) * (2 :: Stream Int) * (3 :: Stream Int) * (4 :: Stream Int)\n\nmain = take 5 test\n</code></pre>\n\n<hr>\n\n<p>On the console:</p>\n\n<pre><code>$ ghc -O2 -fforce-recomp -ddump-rule-firings Stream.hs Test.hs\nTest.hs\n[1 of 2] Compiling Stream           ( Stream.hs, Stream.o )\nRule fired: Class op -\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: Class op fmap\nRule fired: SC:take0\nRule fired: SC:take0\n[2 of 2] Compiling Test             ( Test.hs, Test.o )\nRule fired: Class op fromInteger\nRule fired: Class op fromInteger\nRule fired: Class op *\nRule fired: Class op fromInteger\nRule fired: Class op *\nRule fired: Class op fromInteger\nRule fired: Class op *\nRule fired: SC:take0\nRule fired: Class op fromInteger\nRule fired: Class op fromInteger\nRule fired: Class op *\nRule fired: Class op fromInteger\nRule fired: integerToInt\nRule fired: Class op fromInteger\nRule fired: integerToInt\nRule fired: Class op fromInteger\nRule fired: integerToInt\nRule fired: Class op fromInteger\nRule fired: integerToInt\nRule fired: Class op *\nRule fired: Class op *\nRule fired: Class op *\nRule fired: Class op *\n</code></pre>\n"}, {"tags": ["haskell", "monads", "continuation"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 4, "last_activity_date": 1436643503, "creation_date": 1436643503, "answer_id": 31361060, "question_id": 31358856, "link": "https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell/31361060#31361060", "title": "Continuation monad for a yield/await function in Haskell", "body": "<p>That type is a Mealy machine.  See <a href=\"https://hackage.haskell.org/package/machines-0.5.1/docs/Data-Machine-Mealy.html\" rel=\"nofollow\">https://hackage.haskell.org/package/machines-0.5.1/docs/Data-Machine-Mealy.html</a> for a bunch of instances - but note that the <code>Monad</code> instance is always going to be slow, because it's required to diagonalize by the monad laws.</p>\n\n<p>It sounds like what you really want is the <a href=\"https://hackage.haskell.org/package/auto\" rel=\"nofollow\">auto package</a> anyway.</p>\n"}, {"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1436807155, "post_id": 31369911, "comment_id": 50755264, "body": "Almost exactly what I wanted, except that &quot;yield&quot; also takes in a new input for the next state transition, so it should be &quot;yield :: o -&gt; Auto i o i&quot;. So presumably &quot;yield x = liftF (AutoF $ \\v -&gt; (x, v))&quot;. However, thanks for the great insight that free monads are what I needed. I&#39;ve read about them in the past, but didn&#39;t connect them with this particular problem. Now, of course, its blindingly obvious."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1436810948, "post_id": 31369911, "comment_id": 50757511, "body": "Indeed, this would be the correct definition of <code>yield</code> with the semantic you want."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1436813531, "post_id": 31369911, "comment_id": 50758992, "body": "Also you might consider using <a href=\"https://hackage.haskell.org/package/kan-extensions-4.2.2/docs/Control-Monad-Codensity.html\" rel=\"nofollow noreferrer\"><code>Codensity</code></a> for better asymptotic performance."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 3, "last_activity_date": 1436717952, "last_edit_date": 1495540308, "creation_date": 1436717952, "answer_id": 31369911, "question_id": 31358856, "link": "https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell/31369911#31369911", "title": "Continuation monad for a yield/await function in Haskell", "body": "<p>You could extend your automaton in the spirit of <code>Conduit</code>, that is, allow it to exit and return a value on finitely many inputs:</p>\n\n<pre><code>data Auto i o a\n    = Step (i -&gt; (o, Auto i o a))\n    | End a\n</code></pre>\n\n<p>Then you can define a monad instance that concatenates two automata using <code>&gt;&gt;=</code>: When the first one finishes, the second one continues.</p>\n\n<p>The good news is that you don't need to implement it yourself. Returning a value or nesting using a functor is exactly what the <a href=\"https://stackoverflow.com/q/13352205/1333025\">free monad</a> does (see <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html#t:Free\" rel=\"nofollow noreferrer\">its haddock docs</a>). So let's define</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\nimport Control.Monad.Free\nimport Data.Void\n\n-- | A functor describing one step of the automaton\nnewtype AutoF i o t = AutoF (i -&gt; (o, t))\n  deriving (Functor)\n</code></pre>\n\n<p>Then the original <code>Auto</code> type can be defined just as an alias:</p>\n\n<pre><code>type Auto i o = Free (AutoF i o)\n</code></pre>\n\n<p>This automatically gives you all the instances of <code>Free</code>, and you can also define your original functions:</p>\n\n<pre><code>-- | If @a@ is 'Void', the machine runs forever:\nrunAuto :: Auto i o Void -&gt; i -&gt; (o, Auto i o Void)\nrunAuto (Pure v)  _         = absurd v\nrunAuto (Free (AutoF f)) i  = f i\n\nyield :: o -&gt; Auto i o ()\nyield x = liftF (AutoF $ \\_ -&gt; (x, ()))\n</code></pre>\n\n<p>Note that using the same functor with <a href=\"http://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Trans-Free.html#t:FreeT\" rel=\"nofollow noreferrer\"><code>FreeT</code></a> you get the corresponding monad transformer:</p>\n\n<pre><code>import Control.Monad.Trans.Free\n\ntype AutoT i o = FreeT (AutoF i o)\n\nyieldT :: (Monad m) =&gt; o -&gt; AutoT i o m ()\nyieldT x = liftF (AutoF $ \\_ -&gt; (x, ()))\n\n...\n</code></pre>\n"}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "accepted_answer_id": 31369911, "answer_count": 2, "score": 5, "last_activity_date": 1442520652, "creation_date": 1436629233, "last_edit_date": 1442520652, "question_id": 31358856, "link": "https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell", "title": "Continuation monad for a yield/await function in Haskell", "body": "<p>I want to create an automata type with a type like this:</p>\n\n<pre><code>newtype Auto i o = Auto {runAuto :: i -&gt; (o, Auto i o)}\n</code></pre>\n\n<p>I know this is the type of the <a href=\"https://hackage.haskell.org/package/arrows-0.4.4.1/docs/Control-Arrow-Transformer-Automaton.html\" rel=\"nofollow\">Automata arrow</a>, but I'm not looking for an arrow. I want to make this a monad, so presumably its going to have a type like</p>\n\n<pre><code>newtype Auto i o a = ???? What goes here?\n</code></pre>\n\n<p>with a function like this:</p>\n\n<pre><code>yield :: o -&gt; Auto i o i\n</code></pre>\n\n<p>So when I call \"yield\" from within the Auto monad the \"runAuto\" function returns a pair consisting of the argument to \"yield\" and the continuation function. When the application program calls the continuation function the argument is then returned within the monad as the result of \"yield\".</p>\n\n<p>I know this is going to require some flavour of continuation monad, but despite having wrangled with continuations in the past I can't see how to code this one.</p>\n\n<p>I also know that this rather resembles Michael Snoyman's <a href=\"https://hackage.haskell.org/package/conduit-1.2.4.2\" rel=\"nofollow\">Conduit monad</a>, except that he splits up \"yield\" and \"await\". This monad has to have exactly one output for every input.</p>\n\n<p>Background: I'm writing some code that responds to GUI events in a complicated way. Rather than turning this into a hand-coded state machine I'm hoping to be able to write code that accepts a series of inputs in return for yielding updates to the screen as the user interaction progresses.</p>\n\n<p><strong><em>Edit</em></strong></p>\n\n<p>All this turned out to be subtly wrong. I wrote the code suggested by Petr Pudl\u00e1k in his reply, and it seemed to work, but the \"yield\" operation always yielded the output from the <em>previous</em> yield. Which was wierd.</p>\n\n<p>After much staring at the screen I finally figured out that I needed the code pasted here. The crucial difference is in the AutoF type. Compare the one below with the one proposed by Petr.</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Control.Monad.State.Class\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.Free\nimport Data.Void\n\nclass (Monad m) =&gt; AutoClass i o m | m -&gt; i, m -&gt; o where\n   yield :: o -&gt; m i\n\ndata AutoF i o a = AutoF o (i -&gt; a)\n\ninstance Functor (AutoF i o) where\n   fmap f (AutoF o nxt) = AutoF o $ \\i -&gt; f $ nxt i\n\nnewtype AutoT i o m a = AutoT (FreeT (AutoF i o) m a)\n   deriving (Functor, Applicative, Monad, MonadIO, MonadTrans, MonadState s)\n\ninstance (Monad m) =&gt; AutoClass i o (AutoT i o m) where\n   yield v = AutoT $ liftF $ AutoF v id\n\nrunAutoT :: (Monad m) =&gt; AutoT i o m Void -&gt; m (o, i -&gt; AutoT i o m Void)\nrunAutoT (AutoT step) = do\n   f &lt;- runFreeT step\n   case f of\n      Pure v -&gt; absurd v\n      Free (AutoF o nxt) -&gt; return (o, AutoT . nxt)\n\n\n-- Quick test\n--\n-- &gt; runTest testStart\ntestStart :: Int -&gt; AutoT Int Int IO Void\ntestStart x = do\n   liftIO $ putStrLn $ \"My state is \" ++ show x\n   y &lt;- liftIO $ do\n      putStrLn \"Give me a number: \"\n      read &lt;$&gt; getLine\n   v1 &lt;- yield $ x + y\n   liftIO $ putStrLn $ \"I say \" ++ show v1\n   v2 &lt;- yield $ 2 * v1\n   testStart v2\n\nrunTest auto = do\n   putStrLn \"Next input:\"\n   v1 &lt;- read &lt;$&gt; getLine\n   (v2, nxt) &lt;- runAutoT $ auto v1\n   putStrLn $ \"Output = \" ++ show v2\n   runTest nxt\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 6, "last_activity_date": 1436965020, "last_edit_date": 1436965020, "creation_date": 1436629204, "answer_id": 31358854, "question_id": 31358351, "link": "https://stackoverflow.com/questions/31358351/how-can-i-parse-a-float-with-a-comma-in-place-of-the-decimal-point/31358854#31358854", "title": "How can I parse a float with a comma in place of the decimal point?", "body": "<p>Replacing <code>,</code> by <code>.</code> and then call <code>read</code> is straightforward enough; you just need to remember to use your own specialized function instead of plain old <code>read</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readFloatWithComma :: String -&gt; Float\nreadFloatWithComma = read . sanitize\n  where\n    sanitize = map (\\c -&gt; if c == ',' then '.' else c)\n</code></pre>\n\n<p>In GHCi:</p>\n\n<pre><code>\u03bb&gt; readFloatWithComma \"23,46\"\n23.46\n</code></pre>\n\n<hr>\n\n<p>Regarding the <code>parsec</code> approach, despite what <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/parsing-floats-with-parsec\" rel=\"nofollow noreferrer\">the article you link to suggest</a>, the monomorphism restriction needs not be a worry, as long as you have type signatures for all your top-level bindings. In particular, the following code doesn't need any language extensions to compile properly (at least, in GHC 7.10.1):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Text.Parsec\nimport Text.Parsec.String         ( Parser )\nimport Control.Applicative hiding ( (&lt;|&gt;) )\n\ninfixr 5 &lt;++&gt;\n(&lt;++&gt;) :: Applicative f =&gt; f [a] -&gt; f [a] -&gt; f [a]\na &lt;++&gt; b = (++) &lt;$&gt; a &lt;*&gt; b\n\ninfixr 5 &lt;:&gt;\n(&lt;:&gt;) :: Applicative f =&gt; f a -&gt; f [a] -&gt; f [a]\na &lt;:&gt;  b = (:) &lt;$&gt; a &lt;*&gt; b\n\nnumber :: Parser String\nnumber = many1 digit\n\nplus :: Parser String\nplus = char '+' *&gt; number\n\nminus :: Parser String\nminus = char '-' &lt;:&gt; number\n\ninteger :: Parser String\ninteger = plus &lt;|&gt; minus &lt;|&gt; number\n\nfloat :: Parser Float\nfloat = fmap rd $ integer &lt;++&gt; decimal &lt;++&gt; exponent\n    where rd       = read :: String -&gt; Float\n          decimal  = option \"\" $ ('.' &lt;$ char ',') &lt;:&gt; number\n          exponent = option \"\" $ oneOf \"eE\" &lt;:&gt; integer\n</code></pre>\n\n<p>In GHCi:</p>\n\n<pre><code>\u03bb&gt; parseTest float \"23,46\"\n23.46\n</code></pre>\n"}], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 31358854, "answer_count": 1, "score": 4, "last_activity_date": 1438168075, "creation_date": 1436625982, "last_edit_date": 1436653216, "question_id": 31358351, "link": "https://stackoverflow.com/questions/31358351/how-can-i-parse-a-float-with-a-comma-in-place-of-the-decimal-point", "title": "How can I parse a float with a comma in place of the decimal point?", "body": "<p>I want to parse <code>Float</code> values from a file where they are stored using comma as the decimal separator. Thus i need a function <code>myParse :: String -&gt; Float</code> such that, for instance, <code>myParse \"23,46\" == 23.46</code>.</p>\n\n<p>I have some ideas about how to do this, but they all seem overcomplicated, for example:</p>\n\n<ul>\n<li>replace <code>,</code> with a <code>.</code> in the string and use <code>read</code>; or</li>\n<li>follow <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/parsing-floats-with-parsec\" rel=\"nofollow\">this FP Complete blogpost (entitled <em>Parsing Floats With Parsec</em>)</a>, and challenge the curse of the monomorphism restriction.</li>\n</ul>\n\n<p>Is there a simpler way, or do I really need to use a parsing library? In the second case, could you please paste some suggestions in order to get me started? The monomorphism restriction scares me, and I believe that there has to be a way to do this without using language extensions.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1436611718, "post_id": 31356310, "comment_id": 50694246, "body": "That works perfectly, thank you. However, in that case I&#39;m lucky that <code>reads</code> exists, would that be possible to catch the error send by <code>read</code> ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1436611988, "post_id": 31356310, "comment_id": 50694323, "body": "@mb14 You can only catch thrown errors in <code>IO</code>. <code>reads</code> etc. are more flexible since you can detect parse errors in pure code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1436612713, "post_id": 31356310, "comment_id": 50694538, "body": "Indeed. In Haskell APIs throwing an error as <code>read</code> does, i.e. using partial functions, is considered by many a bad design. It&#39;s OK-ish for IO operations, but not for much else, IMHO."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1436611348, "creation_date": 1436611348, "answer_id": 31356310, "question_id": 31356255, "link": "https://stackoverflow.com/questions/31356255/how-to-catch-read-error-in-haskell/31356310#31356310", "title": "How to catch read error in Haskell", "body": "<pre><code>case reads yourString of\n  [(x,\"\")] -&gt; correctlyParsed x\n  _        -&gt; errorHandling\n</code></pre>\n\n<p>otherwise, you can use <code>readMaybe :: Read a =&gt; String -&gt; Maybe a</code> as follows</p>\n\n<pre><code>import Text.Read\n\ncase readMaybe yourString of\n  Just x  -&gt; correctlyParsed x\n  Nothing -&gt; errorHandling\n</code></pre>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 31356310, "answer_count": 1, "score": 1, "last_activity_date": 1436611348, "creation_date": 1436611004, "question_id": 31356255, "link": "https://stackoverflow.com/questions/31356255/how-to-catch-read-error-in-haskell", "title": "How to catch read error in Haskell", "body": "<p>I have the following problem, I'm parsing a file a use <code>read</code> to convert <code>Int</code> to <code>String</code>. The problem is when it fails, I have no way to display the string which fails to be parsed. I just get <code>Exception: Prelude.read : no parse</code>.</p>\n\n<p>I tried to write my own <code>myRead</code> function which will use <code>read</code> and throw a more meaningful message but I don't know how to catch the error thrown by <code>read</code>.</p>\n\n<p>Alternatively, is there any other way to find what's not been read properly (using debugger or trace ?)</p>\n"}, {"tags": ["macos", "haskell", "sqlite", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "edited": false, "score": 1, "creation_date": 1436632429, "post_id": 31359187, "comment_id": 50699766, "body": "Yes it is strange, the example is taken from the book Learning Haskell Data Analysis. The example works perfectly fine without libghc.. so not sure why the author includes it..."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1436631553, "creation_date": 1436631553, "answer_id": 31359187, "question_id": 31354678, "link": "https://stackoverflow.com/questions/31354678/getting-hdbc-working-on-mac/31359187#31359187", "title": "Getting HDBC working on Mac", "body": "<p>I'm not sure you need to <code>apt-get install libghc-hdbc-sqlite3-dev</code>.</p>\n\n<p>Have a look at <a href=\"http://apt-browse.org/browse/ubuntu/trusty/universe/amd64/libghc-hdbc-sqlite3-dev/2.3.3.0-3build1/\" rel=\"nofollow\">this page</a> for a manifest of that Debian package. It looks like it just contains a compiled version of the <code>HDBC-sqlite3</code> Haskell package, and you are already installing that with your <code>cabal install ...</code> command.</p>\n"}], "owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 31359187, "answer_count": 1, "score": 1, "last_activity_date": 1436631553, "creation_date": 1436600127, "question_id": 31354678, "link": "https://stackoverflow.com/questions/31354678/getting-hdbc-working-on-mac", "title": "Getting HDBC working on Mac", "body": "<p>Im trying to understand how to work with SQL databases using Haskell and HDBC on my Mac.</p>\n\n<p>To get HDBC working with Debian I can use the following setup:</p>\n\n<pre><code>sudo apt-get install sqlite3\nsudo apt-get install libghc-hdbc-sqlite3-dev\ncabal install HDBC sqlite HDBC-sqlite3\n</code></pre>\n\n<p>My questions are:\nHow do I get and install libghc-hdbc-sqlite3-dev on a Mac?\nWhy do I need libghc-hdbc-sqlite3-dev? \nWhy can I not use cabal for libghc-hdbc-sqlite3-dev?\nWhy do I need both sqlite and HDBC-sqlite3, is not sqlite a dependency for HDBC-sqlite3 and downloaded automatically?</p>\n"}, {"tags": ["haskell", "pipe"], "comments": [{"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1436602683, "post_id": 31354604, "comment_id": 50692070, "body": "Your code doesn&#39;t compile. Check the type signature of <code>return</code>: <code>return :: Monad m =&gt; a -&gt; m a</code>. Maybe you could take a look at <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">learnyouahaskell.com/input-and-output</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1436602938, "post_id": 31354604, "comment_id": 50692145, "body": "removed the <code>return</code>... but still errors and am debugging it"}, {"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1436603026, "post_id": 31354604, "comment_id": 50692162, "body": "You can go to <a href=\"http://chat.stackoverflow.com/rooms/83002/haskell-room\">chat.stackoverflow.com/rooms/83002/haskell-room</a> to discuss it in the chat"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1436609563, "post_id": 31354604, "comment_id": 50693652, "body": "<code>getArgs</code> does not read from stdin."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1436609896, "post_id": 31354604, "comment_id": 50693735, "body": "thanks sepp2k.. din&#39;t know, that getArgs is for process arguments..."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 9, "last_activity_date": 1436601923, "creation_date": 1436601923, "answer_id": 31354922, "question_id": 31354604, "link": "https://stackoverflow.com/questions/31354604/redirect-last-actions-stdout-using-in-haskell/31354922#31354922", "title": "Redirect last action&#39;s stdout using &gt;&gt;= in haskell", "body": "<p>No, <code>&gt;&gt;=</code> doesn't have anything to do with stdout. You can use <code>capture_</code> function from the <a href=\"https://hackage.haskell.org/package/silently\">silently</a> package:</p>\n\n<pre><code> do x &lt;- capture_ (putStrLn \"hello world\")\n    print x\n</code></pre>\n\n<p>or just <code>capture_ (putStrLn \"hello world\") &gt;&gt;= print</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 31354922, "answer_count": 1, "score": 4, "last_activity_date": 1436603576, "creation_date": 1436599577, "last_edit_date": 1436603576, "question_id": 31354604, "link": "https://stackoverflow.com/questions/31354604/redirect-last-actions-stdout-using-in-haskell", "title": "Redirect last action&#39;s stdout using &gt;&gt;= in haskell", "body": "<p>How can i get the output from previous action and print it using <code>&gt;&gt;=</code> in haskell?</p>\n\n<p>In shell, it is like,</p>\n\n<pre><code>echo \"hello world\" | { read test; echo test=$test; }\n</code></pre>\n\n<p>In haskell, i am looking for something like,</p>\n\n<pre><code>putStrLn \"hello world\" &gt;&gt;= {x &lt;- getArgs; print x}\n</code></pre>\n\n<p>getArgs stdin must take its input from putStrLn's stdout.</p>\n\n<p>Edit#1,\nAlexey &amp;  aochagavia, thanks for your inputs. This works.</p>\n\n<pre><code>x :: IO String\nx = return \"hello world\"\n\nmain = do\n  x &gt;&gt;= print\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "generic-programming"], "comments": [{"owner": {"reputation": 718, "user_id": 1078763, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9392833e02aba05610a0428ca1d8dd57?s=128&d=identicon&r=PG", "display_name": "user1078763", "link": "https://stackoverflow.com/users/1078763/user1078763"}, "edited": false, "score": 0, "creation_date": 1436593245, "post_id": 31353771, "comment_id": 50690040, "body": "<code>foo :: Constructor c =&gt; (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) c (f :: * -&gt; *) a -&gt; [Char]</code> works, bug or feature?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436593627, "post_id": 31353771, "comment_id": 50690127, "body": "Yeah, that should work too, since the kinds are inferred from place to place within the signature it doesn&#39;t matter on which type variable you fix it."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1436593949, "last_edit_date": 1436593949, "creation_date": 1436593309, "answer_id": 31353841, "question_id": 31353771, "link": "https://stackoverflow.com/questions/31353771/how-to-give-a-type-signature-to-polymorphic-functions-when-polykinds-is-enabled/31353841#31353841", "title": "How to give a type signature to polymorphic functions when PolyKinds is enabled?", "body": "<p>Note that the discrepancy is</p>\n\n<pre><code>t0 :: * -&gt; (* -&gt; *) -&gt; * -&gt; *\nt :: * -&gt; (* -&gt; *) -&gt; k -&gt; *\n</code></pre>\n\n<p>That is, in one of the signatures GHC thinks that the third argument of <code>t</code> should have kind <code>*</code>, and in the other it thinks it should have polymorphic kind <code>k</code>.</p>\n\n<p>I think that the former signature (with <code>*</code>) comes from <code>conName</code>, while the latter with <code>k</code> implicitly comes from your signature for <code>foo</code> \u2013 the <code>k</code> appears because now that you have <code>PolyKinds</code> enabled, all your type signatures are interpreted with polymorphic kinds when possible. Also, by design, a signature is considered to give the the full \"API\" for a function, which means no attempt to infer the kind from the rest of the function is done when you specify the signature explicitly.</p>\n\n<p>In your signature the third argument of the <code>t</code> type is <code>a</code>, so you can fix it by adding a kind annotation to that to make it consistent with what <code>conName</code> wants:</p>\n\n<pre><code>foo :: Constructor c =&gt; t c (f :: * -&gt; *) (a :: *) -&gt; [Char]\nfoo = conName\n</code></pre>\n"}], "owner": {"reputation": 718, "user_id": 1078763, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9392833e02aba05610a0428ca1d8dd57?s=128&d=identicon&r=PG", "display_name": "user1078763", "link": "https://stackoverflow.com/users/1078763/user1078763"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1436605799, "creation_date": 1436592530, "last_edit_date": 1436605799, "question_id": 31353771, "link": "https://stackoverflow.com/questions/31353771/how-to-give-a-type-signature-to-polymorphic-functions-when-polykinds-is-enabled", "title": "How to give a type signature to polymorphic functions when PolyKinds is enabled?", "body": "<p>When enabling <code>PolyKinds</code>, previously valid type signatures can become invalid.</p>\n\n<p>The following code compiles without <code>PolyKinds</code>.</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\nimport GHC.Generics\n\nfoo :: Constructor c =&gt; t c (f :: * -&gt; *) a -&gt; [Char]\nfoo = conName\n</code></pre>\n\n<p>When I enable <code>PolyKinds</code> it fails to compile.</p>\n\n<pre><code>Kind incompatibility when matching types:\n  t0 :: * -&gt; (* -&gt; *) -&gt; * -&gt; *\n  t :: * -&gt; (* -&gt; *) -&gt; k -&gt; *\nExpected type: t c f a -&gt; [Char]\n  Actual type: t0 c f a0 -&gt; [Char]\nRelevant bindings include\n  foo :: t c f a -&gt; [Char] (bound at Gen.hs:8:1)\nIn the expression: conName\nIn an equation for \u2018foo\u2019: foo = conName\n</code></pre>\n\n<p>Is there a way to give a type signature for <code>foo</code> when <code>PolyKinds</code> is enabled?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 7, "last_activity_date": 1436583252, "creation_date": 1436583252, "answer_id": 31352949, "question_id": 31352839, "link": "https://stackoverflow.com/questions/31352839/bizarre-precedence-and-associativity/31352949#31352949", "title": "Bizarre precedence and associativity", "body": "<p>I'm assuming the <code>&lt;&amp;&gt;</code> you're talking about is from the lens package. In that case, the lens operators are really set up to get along with the other lens operators, and they don't really worry so much about the regular operators, so <code>&lt;&amp;&gt;</code> and <code>&amp;</code> are probably a coincidence. The other two, however, are more thought out.</p>\n\n<p><code>$</code> is the lowest precedence, by definition. That is why it exists; to change the order of text so drastically that it can reduce the need for parentheses quite a bit. So it's naturally set at 0. Meanwhile, <code>&lt;$&gt;</code> is an application inside a context, something that you actually need to do, as opposed to <code>$</code> which is just syntax help. So <code>&lt;$&gt;</code> is of a higher precedence to get along with other operators like it, for example the Alternative class operator <code>&lt;|&gt;</code> is at a lower precedence so that those calls can be chained with <code>&lt;$&gt;</code> appropriately.</p>\n\n<p>As for the associativity, that's simply in how the operators are used. <code>$</code> is often used for simpler function composition. One might write <code>f $ g $ x</code> to mean <code>f (g x)</code>. Whereas <code>&lt;$&gt;</code> is almost always chained with <code>&lt;*&gt;</code>, which is also <code>infixl 4</code>. That way, statements like the following are valid.</p>\n\n<pre><code>(+) &lt;$&gt; [1, 2, 3] &lt;*&gt; [10, 20, 30]\n</code></pre>\n\n<p>That expression will parse as the following, due to the left associativity.</p>\n\n<pre><code>((+) &lt;$&gt; [1, 2, 3]) &lt;*&gt; [10, 20, 30]\n</code></pre>\n\n<p>Which is exactly what we want. The function (+) is curried and accepts two parameters which should be passed in one-by-one. With right associativity, the following would occur.</p>\n\n<pre><code>(+) &lt;$&gt; ([1, 2, 3] &lt;*&gt; [10, 20, 30])\n</code></pre>\n\n<p>This says to apply all of the numbers in the first list to the numbers in the second list and then add the result to... something. Needless to say, that would not typecheck.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31352949, "answer_count": 1, "score": 2, "last_activity_date": 1436583252, "creation_date": 1436581945, "question_id": 31352839, "link": "https://stackoverflow.com/questions/31352839/bizarre-precedence-and-associativity", "title": "Bizarre precedence and associativity", "body": "<p>Looking through operator associativity and precedence I found the following:</p>\n\n<pre><code>infixr 0 $\ninfixl 1 &amp;\ninfixl 4 &lt;$&gt;\ninfixl 1 &lt;&amp;&gt;\n</code></pre>\n\n<p>This seems bizarre. <code>&amp;</code> and <code>&lt;&amp;&gt;</code> have the same precedence, but <code>$</code> and <code>&lt;$&gt;</code> not only have widely different precedence, but also associate in different directions.</p>\n\n<p>Is there any good reason for this, or is this just an historical wart? If it's an historical wart, how would you go about changing it?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1436565902, "post_id": 31350897, "comment_id": 50685069, "body": "This works with runghc, but that won&#39;t create an executable."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1436784244, "post_id": 31350897, "comment_id": 50740218, "body": "What are you actually trying to achieve? To run some piece of Haskell code, or to actually compile it into a stand-alone binary? Depending on what you&#39;re after, there may be easier ways than manually invoking the GHC binary."}], "answers": [{"tags": [], "owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "is_accepted": false, "score": 2, "last_activity_date": 1436565701, "creation_date": 1436565701, "answer_id": 31350999, "question_id": 31350897, "link": "https://stackoverflow.com/questions/31350897/is-it-possible-to-pipe-source-code-to-ghc-through-standard-input/31350999#31350999", "title": "Is it possible to pipe source code to GHC through standard input?", "body": "<p>Typically ghc is used as a compiler and you run it on files (on which ghc can seek and infer types from endings etc) and specify output files as flags.</p>\n\n<p>You can, however, of course, use </p>\n\n<pre><code>filename=$(mktemp --suffix=.hs)\necho \"main = print 1\" &gt;&gt; $filename\nghc -o executable $filename \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1436578242, "post_id": 31351005, "comment_id": 50687721, "body": "simpler #4: <code>echo &#39;main = print 1&#39; | ghc -x hs &#47;dev&#47;stdin</code>"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1436565750, "creation_date": 1436565750, "answer_id": 31351005, "question_id": 31350897, "link": "https://stackoverflow.com/questions/31350897/is-it-possible-to-pipe-source-code-to-ghc-through-standard-input/31351005#31351005", "title": "Is it possible to pipe source code to GHC through standard input?", "body": "<p>As far as I can tell, the answer is no. My attempts:</p>\n\n<ol>\n<li><p><code>$ echo 'main = print 1' | ghc \nghc: no input files</code></p></li>\n<li><p><code>$ echo 'main = print 1' | ghc -\nghc: unrecognised flag: -</code></p></li>\n<li><p><code>$ echo 'main = print 1' | ghc /dev/stdin\ntarget \u2018/dev/stdin\u2019 is not a module name or a source file</code></p></li>\n<li><p><code>$ ln -s /dev/stdin stdin.hs; echo 'main = print 1' | ghc stdin.hs\nstdin.hs: hFileSize: inappropriate type (not a regular file)</code></p></li>\n</ol>\n\n<p>The problems: ghc uses suffixes like <code>.hs</code>, <code>.lhs</code>, or <code>.o</code> to decide what to do with a file (this is why #3 fails). Even if you hack around that (#4), ghc really wants to <code>stat()</code> the file to get its size, which fails on pipes.</p>\n"}, {"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1436774588, "post_id": 31352356, "comment_id": 50734793, "body": "I am marking this as a solution for now because this is the most concise way to achieve what I was looking for. If someone posts a similarly-succinct  version that works outside zsh (e.g. I&#39;ve tried <code>ghc -o executable $(echo &quot;main = print 1&quot; | mktemp --suffix=.hs)</code> without success yet) or GHC implements support internally, then I will change my answer accordingly."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 5, "last_activity_date": 1436578887, "last_edit_date": 1436578887, "creation_date": 1436576152, "answer_id": 31352356, "question_id": 31350897, "link": "https://stackoverflow.com/questions/31350897/is-it-possible-to-pipe-source-code-to-ghc-through-standard-input/31352356#31352356", "title": "Is it possible to pipe source code to GHC through standard input?", "body": "<p>Even though this isn't possible with normal <a href=\"https://en.wikipedia.org/wiki/Process_substitution\" rel=\"nofollow\">process substitution</a>, zsh provides a <a href=\"http://zsh.sourceforge.net/Intro/intro_7.html#IDX49\" rel=\"nofollow\">special kind of process substitution-like behavior</a> that allows the \"file\" to act like more of a real file than traditional process substitution does (by creating an actual temporary file):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>% ghc -o Main -x hs =( echo 'main = print 1' )\n[1 of 1] Compiling Main             ( /tmp/zshjlS99o, /tmp/zshjlS99o.o )\nLinking Main ...\n% ./Main\n1\n% \n</code></pre>\n\n<p>The <code>-x hs</code> option tells <code>ghc</code> to act as though the file name given ends in <code>.hs</code>.</p>\n\n<p>Overall, this is essentially a shortcut around manually creating and deleting a temporary file.</p>\n\n<p>I'm not sure if there are other shells that support this kind of thing. I don't think bash does, at least.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 3, "accepted_answer_id": 31352356, "answer_count": 3, "score": 10, "last_activity_date": 1436578887, "creation_date": 1436565259, "question_id": 31350897, "link": "https://stackoverflow.com/questions/31350897/is-it-possible-to-pipe-source-code-to-ghc-through-standard-input", "title": "Is it possible to pipe source code to GHC through standard input?", "body": "<p>I mean something like this:</p>\n\n<pre><code>echo 'main = print 1' | ghc &gt; executable\n</code></pre>\n\n<p>To which GHC replies: <code>ghc: no input files</code></p>\n\n<p>Am I missing something? Is this possible somehow?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 2, "last_activity_date": 1436566553, "last_edit_date": 1436566553, "creation_date": 1436566109, "answer_id": 31351081, "question_id": 31350843, "link": "https://stackoverflow.com/questions/31350843/haskell-error-on-number-operations/31351081#31351081", "title": "Haskell error on number operations", "body": "<p>Haskell won't let you add the <code>Fractional</code> (<code>3/2</code>) to the <code>Integral</code> </p>\n\n<pre><code>((n - n `mod` 3) + 3)\n</code></pre>\n\n<p>without explicitly telling it that you want to by adding a <code>fromIntegral</code> to the latter. So </p>\n\n<pre><code>solution n = 3/2 * fromIntegral ((n-n`mod`3)+3)\n</code></pre>\n\n<p>should work.</p>\n\n<p>There's quite a good overview of all the numeric types in <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html#numerictypes.summary\" rel=\"nofollow\">Real World haskell</a>. I never remember the details though, and mostly just add in a <code>fromIntegral</code> whenever it's required.</p>\n"}], "owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 31351081, "answer_count": 1, "score": 1, "last_activity_date": 1436566553, "creation_date": 1436565008, "question_id": 31350843, "link": "https://stackoverflow.com/questions/31350843/haskell-error-on-number-operations", "title": "Haskell error on number operations", "body": "<p>I've been searching for god knows how long, but couldn't get this piece of code to work:</p>\n\n<pre><code>solution n = 3/2*((n-n`mod`3)+3)\n</code></pre>\n\n<p>It compiles but when I call it, it throws two errors, the first one being</p>\n\n<pre><code>No instance for (Integral a0) arising from a use of `solution'\n</code></pre>\n\n<p>Here is what I'm trying to achieve</p>\n\n<pre><code>solution 9 = 3/2* ((n-n`mod`3)+3) = 3/2 * ((9-0)+3) = 3/2 * (12) = 18\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": false, "score": 4, "last_activity_date": 1436563379, "creation_date": 1436563379, "answer_id": 31350492, "question_id": 31350470, "link": "https://stackoverflow.com/questions/31350470/can-i-apply-list-range-as-a-function/31350492#31350492", "title": "can I apply list range as a function?", "body": "<p>Its <code>enumFromTo</code>:</p>\n\n<pre><code>Prelude&gt; :t enumFromTo\nenumFromTo :: Enum a =&gt; a -&gt; a -&gt; [a]\nPrelude&gt; enumFromTo 1 5\n[1,2,3,4,5]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 4, "creation_date": 1436563962, "post_id": 31350497, "comment_id": 50684316, "body": "I believe <code>&quot;(..)&quot;</code> is explicitly defined as <code>enumFromTo</code>. If you make your own <code>enumFromTo</code> function, haskell will use it anytime you do <code>[x..y]</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1436582906, "post_id": 31350497, "comment_id": 50688401, "body": "@PyRulez In standard Haskell, you cannot define your own standalone <code>enumFromTo</code> and have it used this way. You have to define an <code>Enum</code> class instance for your type. The <code>RebindableSyntax</code> extension allows redefining e.g. <code>&gt;&gt;=</code>, but doesn&#39;t seem to work for <code>enumFromTo</code> yet."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436583379, "post_id": 31350497, "comment_id": 50688458, "body": "@&#216;rjanJohansen When defining an <code>Enum</code> instance, you can define a <code>enumFromTo</code>."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 5, "last_activity_date": 1436563402, "creation_date": 1436563402, "answer_id": 31350497, "question_id": 31350470, "link": "https://stackoverflow.com/questions/31350470/can-i-apply-list-range-as-a-function/31350497#31350497", "title": "can I apply list range as a function?", "body": "<p>You can't do this with <code>..</code>, as it's a syntactic element built into the language rather than a function.  However, there <em>is</em> a function that does the same thing as \"<code>(..)</code>\" or your <code>\\x y -&gt; [x..y]</code> would do: <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/Prelude.html#v:enumFromTo\" rel=\"noreferrer\"><code>enumFromTo</code></a>.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 31350497, "answer_count": 2, "score": 2, "last_activity_date": 1436563402, "creation_date": 1436563212, "question_id": 31350470, "link": "https://stackoverflow.com/questions/31350470/can-i-apply-list-range-as-a-function", "title": "can I apply list range as a function?", "body": "<p>I am new to haskell.</p>\n\n<p>I know that I can use a tuple operator as a function: <code>(,) 1 2</code>.</p>\n\n<p>Can I do the same with the list range <code>..</code>? As in <code>[0..9]</code>. Or is it not a function?</p>\n\n<p>Basically I have two values that I need to create a list from. The explicit lambda expression works: <code>\\x y -&gt; [x..y]</code>. I was trying to figure out how to make it shorter.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1436559558, "post_id": 31349556, "comment_id": 50682288, "body": "It is definitely possible to code something like this using TH."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436561031, "post_id": 31349556, "comment_id": 50683056, "body": "<code>let x = 1 in printf &quot;x=%d, x+1=%d&quot; x (x+1)</code>?"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1436561194, "post_id": 31349556, "comment_id": 50683125, "body": "@DanielWagner Yes, that would work for a few simple expressions, but it would get hairy when I want to examine more than just a few simple ones, e.g. <code>d, 1&#47;d, f d, f $ 1&#47;d, dist</code>"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 1, "creation_date": 1436633402, "post_id": 31349556, "comment_id": 50700099, "body": "If you scroll down a bit on <a href=\"https://github.com/leonidas/codeblog/blob/master/2011/2011-12-27-template-haskell.md\" rel=\"nofollow noreferrer\">this TH tutorial</a> it has a <code>showField</code> function. I don&#39;t know TH, but I tried to use that as a guide to learn enough to create the function you&#39;re looking for. I failed, but I&#39;d really love for someone more knowledgeable to answer."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1436774343, "post_id": 31349556, "comment_id": 50734642, "body": "StackOverflow tells me there were some down-votes to this question. Care to tell me why? Am I missing an obvious and simpler solution? Or maybe there is something I can improve about the question?"}], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1436744186, "post_id": 31373522, "comment_id": 50726353, "body": "Nice, thanks for your efforts so far. I might take a stab at trying to improve it tomorrow."}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 5, "last_activity_date": 1436743185, "creation_date": 1436743185, "answer_id": 31373522, "question_id": 31349556, "link": "https://stackoverflow.com/questions/31349556/is-there-a-template-haskell-library-that-would-allow-me-to-print-dump-a-few-lo/31373522#31373522", "title": "Is there a (Template) Haskell library that would allow me to print/dump a few local bindings with their respective names?", "body": "<p>I've actually almost solved the problem now. Not exactly what you imagined, but fairly close. Maybe someone else can use this as a basis for a better version. Either way, with</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, LambdaCase #-}\n\nimport Language.Haskell.TH\n\ndump :: ExpQ -&gt; ExpQ\ndump tuple =\n    listE . map dumpExpr . getElems =&lt;&lt; tuple\n  where\n    getElems = \\case { TupE xs -&gt; xs; _ -&gt; error \"not a tuple in splice!\" }\n    dumpExpr exp = [| $(litE (stringL (pprint exp))) ++ \" = \" ++ show $(return exp)|]\n</code></pre>\n\n<p>you get the ability to do something like</p>\n\n<pre><code>\u03bb&gt; let x = True\n\u03bb&gt; print $(dump [|(not x, x, x == True)|])\n[\"GHC.Classes.not x_1627412787 = False\",\"x_1627412787 = True\",\"x_1627412787 GHC.Classes.== GHC.Types.True = True\"]\n</code></pre>\n\n<p>which is almost what you wanted. As you see, it's a problem that the <code>pprint</code> function includes module prefixes and such, which makes the result... less than ideally readable. I don't yet know of a fix for that, but other than that I think it is fairly usable.</p>\n\n<p>It's a bit syntactically heavy, but that is because it's using the regular <code>[|</code> quote syntax in Haskell. If one wanted to write their own quasiquoter, as you suggest, I'm pretty sure one would also have to re-implement parsing Haskell, which would suck a bit.</p>\n"}, {"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 1, "creation_date": 1437414606, "post_id": 31484580, "comment_id": 51007214, "body": "I&#39;ll give your code more than a cursory glance later tonight perhaps, but it looks like you solved it beautifully. Thanks for sharing too!"}], "tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": true, "score": 5, "last_activity_date": 1437384856, "last_edit_date": 1495540282, "creation_date": 1437166574, "answer_id": 31484580, "question_id": 31349556, "link": "https://stackoverflow.com/questions/31349556/is-there-a-template-haskell-library-that-would-allow-me-to-print-dump-a-few-lo/31484580#31484580", "title": "Is there a (Template) Haskell library that would allow me to print/dump a few local bindings with their respective names?", "body": "<h2><strong>TL;DR</strong> There is <a href=\"http://hackage.haskell.org/package/dump\" rel=\"nofollow noreferrer\">this package</a> which contains a complete solution.</h2>\n\n<ul>\n<li><p>install it via <code>cabal install dump</code></p>\n\n<p>and/or</p></li>\n<li><p>read <a href=\"http://hackage.haskell.org/package/dump-0.1.2/docs/src/Debug-Dump.html#d\" rel=\"nofollow noreferrer\">the source code</a></p></li>\n</ul>\n\n<p>Example usage:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport Debug.Dump\n\nmain = print [d|a, a+1, map (+a) [1..3]|]\n  where a = 2\n</code></pre>\n\n<p>which prints:</p>\n\n<pre><code>(a) = 2   (a+1) = 3       (map (+a) [1..3]) = [3,4,5]\n</code></pre>\n\n<p>by turnint this String</p>\n\n<pre><code>\"a, a+1, map (+a) [1..3]\"\n</code></pre>\n\n<p>into this expression</p>\n\n<pre><code>( \"(a) = \" ++ show (a)            ++ \"\\t  \" ++\n  \"(a+1) = \" ++ show (a + 1)      ++ \"\\t  \" ++\n  \"(map (+a) [1..3]) = \" ++ show (map (+ a) [1 .. 3])\n)\n</code></pre>\n\n<h1>Background</h1>\n\n<p>Basically, I found that there are two ways to solve this problem:</p>\n\n<ol>\n<li><code>Exp -&gt; String</code> The bottleneck here is pretty-printing haskell source code from <code>Exp</code> and cumbersome syntax upon usage.</li>\n<li><code>String -&gt; Exp</code> The bottleneck here is parsing haskell to <code>Exp</code>.</li>\n</ol>\n\n<h2><code>Exp -&gt; String</code></h2>\n\n<p>I started out with what <a href=\"https://stackoverflow.com/a/31373522/499478\">@kqr</a> put together, and tried to write a parser to turn this </p>\n\n<pre><code>[\"GHC.Classes.not x_1627412787 = False\",\"x_1627412787 = True\",\"x_1627412787 GHC.Classes.== GHC.Types.True = True\"]\n</code></pre>\n\n<p>into this</p>\n\n<pre><code>[\"not x = False\",\"x = True\",\"x == True = True\"]\n</code></pre>\n\n<p>But after trying for a day, <a href=\"https://github.com/Wizek/kqr-stackoverflow/blob/6e7e1d5b43032eb4af5fff88492c499f211560a7/Th.hs#L22\" rel=\"nofollow noreferrer\">my parsec-debugging-skills have proven insufficient to date</a>, so instead I went with a simple regular expression:</p>\n\n<pre><code>simplify :: String -&gt; String\nsimplify s = subRegex (mkRegex \"_[0-9]+|([a-zA-Z]+\\\\.)+\") s \"\"\n</code></pre>\n\n<p>For most cases, the output is greatly improved.\nHowever, I suspect this to likely mistakenly remove things it shouldn't.</p>\n\n<p>For example:</p>\n\n<pre><code>$(dump [|(elem 'a' \"a.b.c\", True)|])\n</code></pre>\n\n<p>Would likely return:</p>\n\n<pre><code>[\"elem 'a' \\\"c\\\" = True\",\"True = True\"]\n</code></pre>\n\n<p>But this could be solved with proper parsing.</p>\n\n<p>Here is the version that works with the regex-aided simplification: <a href=\"https://github.com/Wizek/kqr-stackoverflow/blob/master/Th.hs\" rel=\"nofollow noreferrer\">https://github.com/Wizek/kqr-stackoverflow/blob/master/Th.hs</a></p>\n\n<p>Here is a list of downsides / unresolved issues I've found with the <code>Exp -&gt; String</code> solution:</p>\n\n<ul>\n<li>As far as I know, not using Quasi Quotation requires cumbersome syntax upon usage, like: <code>$(d [|(a, b)|])</code> -- as opposed to the more succinct <code>[d|a, b|]</code>. If you know a way to simplify this, please do tell!</li>\n<li>As far as I know, <code>[||]</code> needs to contain fully valid Haskell, which pretty much necessitates the use of a tuple inside further exacerbating the syntactic situation. There is some upside to this too, however: at least we don't need to scratch our had where to split the expressions since GHC does that for us.</li>\n<li>For some reason, the tuple only seemed to accept Booleans. Weird, I suspect this should be possible to fix somehow.</li>\n<li>Pretty pretty-printing Exp is not very straight-forward. A more complete  solution does require a parser after all.</li>\n<li>Printing an AST scrubs the original formatting for a more uniform looks. I hoped to preserve the expressions letter-by-letter in the output.  </li>\n</ul>\n\n<p>The deal-breaker was the syntactic over-head. I knew I could get to a simpler solution like <code>[d|a, a+1|]</code> because I have seen that API provided in other packages. I was trying to remember where I saw that syntax. What is the name...?</p>\n\n<h2><code>String -&gt; Exp</code></h2>\n\n<p>Quasi Quotation is the name, I remember!</p>\n\n<p>I remembered seeing packages with heredocs and interpolated strings, like: </p>\n\n<pre><code>string = [qq|The quick {\"brown\"} $f {\"jumps \" ++ o} the $num ...|]\n  where f = \"fox\"; o = \"over\"; num = 3\n</code></pre>\n\n<p>Which, as far as I knew, during compile-time, turns into</p>\n\n<pre><code>string = \"The quick \" ++ \"brown\" ++ \" \" ++ $f ++ \"jumps \" ++ o ++ \" the\" ++ show num ++ \" ...\"\n  where f = \"fox\"; o = \"over\"; num = 3\n</code></pre>\n\n<p>And I thought to myself: if they can do it, I should be able to do it too!</p>\n\n<p>A bit of digging in their source code revealed the QuasiQuoter type.</p>\n\n<pre><code>data QuasiQuoter = QuasiQuoter {quoteExp :: String -&gt; Q Exp}\n</code></pre>\n\n<p>Bingo, this is what I want! Give me the source code as string! Ideally, I wouldn't mind returning string either, but maybe this will work. At this point I still know quite little about <code>Q Exp</code>.</p>\n\n<p>After all, in theory, I would just need to split the string on commas, map over it, duplicate the elements so that first part stays string and the second part becomes Haskell source code, which is passed to show.</p>\n\n<p>Turning this:</p>\n\n<pre><code>[d|a+1|]\n</code></pre>\n\n<p>into this:</p>\n\n<pre><code>\"a+1\" ++ \" = \" ++ show (a+1)\n</code></pre>\n\n<p>Sounds easy, right?</p>\n\n<p>Well, it turns out that even though GHC most obviously is capable to parse haskell source code, it doesn't expose that function. Or <a href=\"https://stackoverflow.com/questions/31412444/template-haskell-is-there-a-function-or-special-syntax-that-parses-a-string-a\">not in any way we know of</a>.</p>\n\n<p>I find it strange that we need a third-party package (which thankfully there is at least one called <code>haskell-src-meta</code>) to parse haskell source code for meta programming. Looks to me such an obvious duplication of logic, and potential source of mismatch -- resulting in bugs.</p>\n\n<p>Reluctantly, I started looking into it. After all, if it is good enough for the interpolated-string folks (those packaged did rely on <code>haskell-src-meta</code>) then maybe it will work okay for me too for the time being.</p>\n\n<p>And alas, it does contain the desired function:</p>\n\n<pre><code>Language.Haskell.Meta.Parse.parseExp :: String -&gt; Either String Exp\n</code></pre>\n\n<p><em><a href=\"https://hackage.haskell.org/package/haskell-src-meta-0.6.0.10/docs/Language-Haskell-Meta-Parse.html\" rel=\"nofollow noreferrer\">Language.Haskell.Meta.Parse</a></em></p>\n\n<p>From this point it was rather straightforward, <strike>except for splitting on commas.</p>\n\n<p>Right now, I do a very simple split on all commas, but that doesn't account for this case:</p>\n\n<pre><code>[d|(1, 2), 3|]\n</code></pre>\n\n<p>Which fails unfortunatelly. To handle this, <a href=\"https://github.com/Wizek/dump/blob/e8bca65bfcdfe7edb5c0f32b4e23b9108f634d82/src/Utils.hs#L23\" rel=\"nofollow noreferrer\">I begun writing a parsec parser (again) which turned out to be more difficult than anticipated (again)</a>. At this point, I am open to suggestions. Maybe you know of a simple parser that handles the different edge-cases? If so, tell me in a comment, please! I plan on resolving this issue with or without parsec.</p>\n\n<p>But for the most use-cases: it works.</strike></p>\n\n<blockquote>\n  <p><strong>Update at 2015-06-20</strong></p>\n  \n  <p>Version 0.2.1 and later correctly parses expressions even if they contain commas inside them. Meaning <code>[d|(1, 2), 3|]</code> and similar expressions are now supported.</p>\n</blockquote>\n\n<p>You can</p>\n\n<ul>\n<li><p>install it via <code>cabal install dump</code></p>\n\n<p>and/or</p></li>\n<li><p>read <a href=\"http://hackage.haskell.org/package/dump-0.1.2/docs/src/Debug-Dump.html#d\" rel=\"nofollow noreferrer\">the source code</a></p></li>\n</ul>\n\n<h1>Conclusion</h1>\n\n<p>During the last week I've learnt quite a bit of Template Haskell and QuasiQuotation, cabal sandboxes, publishing a package to hackage, building haddock docs and publishing them, and some things about Haskell too.\nIt's been fun.</p>\n\n<p>And perhaps most importantly, I now am able to use this tool for debugging and development, the absence of which has been bugging me for some time. Peace at last.</p>\n\n<p>Thank you <a href=\"https://stackoverflow.com/a/31373522/499478\">@kqr</a>, your engagement with my original question and attempt at solving it gave me enough spark and motivation to continue writing up a full solution.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 456, "favorite_count": 1, "accepted_answer_id": 31484580, "answer_count": 2, "score": 9, "last_activity_date": 1437384856, "creation_date": 1436559385, "question_id": 31349556, "link": "https://stackoverflow.com/questions/31349556/is-there-a-template-haskell-library-that-would-allow-me-to-print-dump-a-few-lo", "title": "Is there a (Template) Haskell library that would allow me to print/dump a few local bindings with their respective names?", "body": "<p>For instance:</p>\n\n<pre><code>let x = 1 in putStrLn [dump|x, x+1|]\n</code></pre>\n\n<p>would print something like </p>\n\n<pre><code>x=1, (x+1)=2\n</code></pre>\n\n<p>And even if there isn't anything like this currently, would it be possible to write something similar?</p>\n"}, {"tags": ["sorting", "haskell", "data-structures", "word-frequency"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436555201, "post_id": 31348236, "comment_id": 50680271, "body": "If you only need an estimate you would do well by just random sampling (english words are zipf-distributed, so stop sampling when you observe such a distribution I guess). Otherwise you could use a hash table and maintain a <code>(maxCountSoFar, word)</code> tuple which you update as you increment the counters in your hash table"}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436555479, "post_id": 31348236, "comment_id": 50680400, "body": "@jberryman No, I want process the entire dataset instead of estimation. The tuples you mention is what I want, but the dataset is extremely large, so I&#39;m asking for the most efficient approach."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436555729, "post_id": 31348236, "comment_id": 50680516, "body": "&quot;estimation&quot; is not really the right word actually. You&#39;ll probably get the right answer, but you won&#39;t know for sure. Also I&#39;m not sure now that I think about it how random sampling would work on the n-gram dataset, since it&#39;s already capturing word frequency. Anyway, just use the hashtable approach then, which is optimal."}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1436555823, "post_id": 31348236, "comment_id": 50680552, "body": "@jberryman I just want to get the most frequent words for further processing, not check their distribution."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1436559996, "post_id": 31348236, "comment_id": 50682504, "body": "How can you filter out the exactly most frequent words without effectively building a histogram? You can <i>approximate</i> the number, try to take a look at links in <a href=\"http://cstheory.stackexchange.com/questions/19802/top-k-frequent-items-in-data-stream\" title=\"top k frequent items in data stream\">cstheory.stackexchange.com/questions/19802/&hellip;</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1436560220, "post_id": 31348236, "comment_id": 50682635, "body": "9000: According to the type in in the example code above and the linked dataset description, the dataset contains the histogram, so firegurafiku doesn&#39;t need to generate it."}], "answers": [{"comments": [{"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436557135, "post_id": 31348931, "comment_id": 50681180, "body": "The problem is that I know how to do it in an imperative language: just a linked list with binary search, but how to do that <i>efficiently</i> in pure functional Haskell?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "reply_to_user": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 2, "creation_date": 1436558727, "post_id": 31348931, "comment_id": 50681912, "body": "@firegurafiku: A heap or a tree are efficiently &#39;mutable&#39;, in the sense that you create a new (updated) structure which reuses most of the previous structure, in sub-linear time (better than a linked list)."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1436558954, "post_id": 31348931, "comment_id": 50681999, "body": "Make sure the counts get evaluated eagerly. If you let them be lazy, it&#39;ll eat many GB of RAM even for tiny datasets. (In the code above, I believe the <code>&lt;</code> operator should prevent any space leaks.)"}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436559214, "post_id": 31348931, "comment_id": 50682128, "body": "@rampion Thank you for your code! It look a bit cryptic, so let me test it first."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1436559593, "post_id": 31348931, "comment_id": 50682310, "body": "firegurafiku: added some comments. let me know if you can&#39;t follow anything."}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436793740, "post_id": 31348931, "comment_id": 50746194, "body": "@rampion: Surprisingly, this seems to be working with almost no additional memory footprint."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1436559556, "last_edit_date": 1436559556, "creation_date": 1436556863, "answer_id": 31348931, "question_id": 31348236, "link": "https://stackoverflow.com/questions/31348236/most-efficient-data-structure-for-finding-most-frequent-items/31348931#31348931", "title": "Most efficient data structure for finding most frequent items", "body": "<p>How about </p>\n\n<ul>\n<li>using <code>splitAt</code> to divide the data set into the first 5000 items and the rest.</li>\n<li>sort the first 5000 items by frequency (ascending)</li>\n<li>go through the rest\n\n<ul>\n<li>if a item has greater frequency than the lowest freq in the sorted items</li>\n<li>drop the lowest frequency item from the sorted items</li>\n<li>insert the new item in its proper place in the sorted items</li>\n</ul></li>\n</ul>\n\n<p>The process then becomes effectively linear, though the coefficient is improved if you use a data structure for the sorted 5000 elements that has sublinear min-delete and insertion.</p>\n\n<p>For example, using <a href=\"https://hackage.haskell.org/package/heap-1.0.0/docs/Data-Heap.html\" rel=\"nofollow\"><code>Data.Heap</code> from the <code>heap</code> package</a>:</p>\n\n<pre><code>import Data.List (foldl')\nimport Data.Maybe (fromJust)\nimport Data.Heap hiding (splitAt)\n\nmostFreq :: Int -&gt; [(String, Int)] -&gt; [(String, Int)]\nmostFreq n dataset = final\n  where\n    -- change our pairs from (String,Int) to (Int,String)\n    pairs = map swap dataset\n    -- get the first `n` pairs in one list, and the rest of the pairs in another\n    (first, rest) = splitAt n pairs\n    -- put all the first `n` pairs into a MinHeap\n    start = fromList first :: MinHeap (Int, String)\n    -- then run through the rest of the pairs\n    stop = foldl' step start rest\n    -- modifying the heap to replace its least frequent pair\n    -- with the new pair if the new pair is more frequent\n    step heap pair = if viewHead heap &lt; Just pair\n                       then insert pair (fromJust $ viewTail heap)\n                       else heap\n    -- turn our heap of (Int, String) pairs into a list of (String,Int) pairs\n    final = map swap (toList stop)\n    swap ~(a,b) = (b,a)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 1, "creation_date": 1436565179, "post_id": 31350101, "comment_id": 50684775, "body": "I haven&#39;t tried yet, but I understand that there is no chance for compiler to optimize the <code>take &amp; sort</code> approach into completely different algorithm. Sorting would require loading the whole dataset into memory which is not affordable. But after you said that, I decided to actually measure performance for naive implementation and you implementation, as well as @rampion&#39;s one."}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436566865, "post_id": 31350101, "comment_id": 50685409, "body": "I&#39;ve just tried your code in GHCi and, unfortunately, it issues two errors: <code>Not in scope: dps&#39;</code> and <code>Not in scope: i</code>"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436567388, "post_id": 31350101, "comment_id": 50685565, "body": "Sorry, <code>dps&#39;</code> should be <code>strs&#39;</code> and <code>i</code> should be <code>f</code>. I didn&#39;t test it in GHCi; I just dumped my thoughts out into SO: you need something which limits the size less than 5000 so that it can grow to 5000 and then have the bottom-most elements chopped off, and you need to be able to add elements."}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 1, "creation_date": 1436570324, "post_id": 31350101, "comment_id": 50686333, "body": "I&#39;ve just figured out the fact that Haskell IO is increadibly slow. It seems like it&#39;s file reading and parsing that takes the most of time."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436753308, "post_id": 31350101, "comment_id": 50728063, "body": "Indeed @firegurafiku, when you use the built-in <code>String</code> types, defined as <code>[Char]</code>, you create a pointer and memory cell for every character read in, which can take a while. Sometimes it seems like the compiler gets to skip this overhead; I don&#39;t know the internals that well. Usually people use the <code>ByteStream</code> type or so to make this faster."}, {"owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "edited": false, "score": 0, "creation_date": 1436793424, "post_id": 31350101, "comment_id": 50745974, "body": "Finally, I came to a solution using <a href=\"https://hackage.haskell.org/package/conduit-1.2.4.2\" rel=\"nofollow noreferrer\"><code>Data.Conduit</code></a> for IO and @rampion&#39;s function. Sorry, I haven&#39;t tested your solution, because his answer seems to be simpler and has almost zero memory footprint. In contrast, when I implemented naive approach, the program, as I predicted, tried to allocate more memory then available and got terminated by operating system."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1436561655, "creation_date": 1436561655, "answer_id": 31350101, "question_id": 31348236, "link": "https://stackoverflow.com/questions/31348236/most-efficient-data-structure-for-finding-most-frequent-items/31350101#31350101", "title": "Most efficient data structure for finding most frequent items", "body": "<p>Have you <em>tried</em> this or are you just <em>guessing</em>? Because many Haskell sort functions respect <em>laziness</em>  and when you ask for only the top 5000 they'll happily avoid sorting the rest of those elements.</p>\n\n<p>Similarly, be very careful with \"it produces a new map on each alteration\". Most insert operations are going to be O(log n) on this sort of data structure, with n bounded to 5000: so you might be allocating ~30 new cells in the heap on each alteration, but that's not a particularly huge cost, certainly not as huge as 5000. </p>\n\n<p>What you'd want instead, if <code>Data.List.sort</code> doesn't work well enough, is something like:</p>\n\n<pre><code>import Data.List (foldl')\nimport Data.IntMap.Strict (IntMap)\nimport qualified Data.IntMap.Strict as IM\n\ntype Freq = Int\ntype Count = Int\ndata Summarizer x = Summ {tracking :: !IntMap [x], least :: !Freq, \n                        size :: !Count, size_of_least :: !Count }\n\ninserting :: x -&gt; Maybe [x] -&gt; Maybe [x]\ninserting x Nothing = Just [x]\ninserting x (Just xs) = Just (x:xs)\n\nsizeLimit :: Summarizer x -&gt; Summarizer x\nsizeLimit skip@(Summ strs f_l tot lst) \n    | tot - lst &lt; 5000 = skip\n    | otherwise        = Summ strs' f_l' tot' lst'\n        where (discarded, strs') = IM.deleteFindMin strs\n              (f_l', new_least) = IM.findMin dps'\n              tot' = tot - length discarded\n              lst' = length new_least\n\naddEl :: (x, Freq) -&gt; Summarizer x -&gt; Summarizer x\naddEl (str, f) skip@(Summ strs f_l tot lst)\n    | i &lt; f_l &amp;&amp; tot &gt;= 5000 = skip\n    | otherwise              = sizeLimit $ Summ strs' f_l' tot' lst'\n        where strs' = IM.alter (inserting str) f strs\n              tot' = tot + 1\n              f_l' = min f_l f\n              lst' = case compare f_l f of LT -&gt; lst; EQ -&gt; lst + 1; GT -&gt; 1\n</code></pre>\n\n<p>Notice that we store lists of strings to handle duplicate frequencies; we mostly skip updating, and when we <em>do</em> update it's an O(log n) operation to put the new element in and sometimes (depending on duplication again) an O(log n) operation to prune out the smallest elements, and an O(log n) operation to find the new smallest ones.</p>\n"}], "owner": {"reputation": 2471, "user_id": 1447225, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8daac16747c58e2c892e1a398919295c?s=128&d=identicon&r=PG", "display_name": "firegurafiku", "link": "https://stackoverflow.com/users/1447225/firegurafiku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 31348931, "answer_count": 2, "score": 1, "last_activity_date": 1436798763, "creation_date": 1436554321, "last_edit_date": 1492087236, "question_id": 31348236, "link": "https://stackoverflow.com/questions/31348236/most-efficient-data-structure-for-finding-most-frequent-items", "title": "Most efficient data structure for finding most frequent items", "body": "<p>I want to extract most frequent words from the <a href=\"http://storage.googleapis.com/books/ngrams/books/datasetsv2.html\" rel=\"nofollow noreferrer\">Google N-Grams dataset</a> which is about 20 GB in its uncompressed form. I don't want the whole data set resorted, just most frequent 5000 of them. But if I write</p>\n\n<pre><code>take 5000 $ sortBy (flip $ comparing snd) dataset\n-- dataset :: IO [(word::String, frequency::Int)]\n</code></pre>\n\n<p>it's going to be an endless waiting. But what should I do instead?</p>\n\n<p>I know there is <a href=\"http://hackage.haskell.org/package/array-0.1.0.0/docs/Data-Array-MArray.html\" rel=\"nofollow noreferrer\">Data.Array.MArray</a> package available for in-place array computation, but I cannot see any function for items modification on its documentation page. There is also <a href=\"http://hackage.haskell.org/package/hashtables-1.2.0.2/docs/Data-HashTable-IO.html\" rel=\"nofollow noreferrer\">Data.HashTable.IO</a>, but it's an unordered data structure.</p>\n\n<p>I'd like to use simple <a href=\"https://hackage.haskell.org/package/containers-0.5.0.0/docs/Data-IntMap-Strict.html\" rel=\"nofollow noreferrer\"><code>Data.IntMap.Strict</code></a> (with its convenient <code>lookupLE</code> function), but I don't think it would be very efficient because it produces a new map on each alteration. Could <code>ST</code> monad improve that?</p>\n\n<p><strong>UPD:</strong> I've also posted the final version of program on <a href=\"https://codereview.stackexchange.com/questions/96778\">CoreReview.SX</a>. </p>\n"}, {"tags": ["haskell", "types", "lambda-calculus"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1436610283, "post_id": 31349038, "comment_id": 50693846, "body": "I think <code>data Term = Lam (Term -&gt; Term) | App Term Term | Var Int</code> would be a more straightforward solution."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1436613583, "post_id": 31349038, "comment_id": 50694794, "body": "@Andr&#225;s Kov&#225;cs, did you mean <code>Lam Term</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1436615353, "post_id": 31349038, "comment_id": 50695227, "body": "@user3237465 no, I meant <code>Term -&gt; Term</code>. We can do a <a href=\"http://lpaste.net/136328\" rel=\"nofollow noreferrer\">similar answer</a> as above, but IMO cleaner."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1436615810, "post_id": 31349038, "comment_id": 50695346, "body": "@Andr&#225;s Kov&#225;cs, ah, see now. This is much like <code>quote</code> from <a href=\"http://fplab.bitbucket.org/posts/2008-04-13-the-shortest-betanormaliz.html\" rel=\"nofollow noreferrer\">the shortest beta-normalizer</a> (other authors call this function <code>readback</code>)."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 4, "last_activity_date": 1436557402, "creation_date": 1436557402, "answer_id": 31349038, "question_id": 31348141, "link": "https://stackoverflow.com/questions/31348141/adventures-with-the-untyped-lambda-calculus/31349038#31349038", "title": "Adventures with the untyped lambda calculus", "body": "<p>OK, I've found <em>a</em> solution:</p>\n\n<p>The code above has <code>Term x</code>, parameterised by the result type for <code>R</code>. Instead of doing that (and freaking out the type checker), construct some type <code>Value</code> that can represent every result type you will ever want to return. Now we have</p>\n\n<pre><code>data Term = F (Term -&gt; Term) | R (Term -&gt; Value)\n</code></pre>\n\n<p>Having collapsed all possible result types into a single opaque <code>Value</code> type, we can do our work.</p>\n\n<p>Concretely, the type I chose is</p>\n\n<pre><code>data Value = V Int [Term]\n</code></pre>\n\n<p>So a <code>Value</code> is an <code>Int</code> representing an ADT value constructor, followed by one <code>Term</code> for each field of that constructor. With this definition, we can finally do</p>\n\n<pre><code>decode :: Term -&gt; Maybe Term\ndecode tmx =\n  case tmx ! R (\\ _ -&gt; V 0 []) ! R (\\ tx -&gt; V 1 [tx]) of\n    V 0 []   -&gt; Nothing\n    V 1 [tx] -&gt; Just tx\n    _        -&gt; error \"not a Maybe\"\n</code></pre>\n\n<p>Similarly, you can encode and decode lists like so:</p>\n\n<pre><code>null =                        F $ \\ n -&gt; F $ \\ c -&gt; n\ncons = F $ \\ x -&gt; n $ \\ xs -&gt; F $ \\ n -&gt; F $ \\ c -&gt; c ! x ! xs\n\nencode :: [Term] -&gt; Term\nencode (  []) = null\nencode (x:xs) = cons ! x ! encode xs\n\ndecode :: Term -&gt; [Term]\ndecode txs =\n  case out $ txs ! R (\\ txs -&gt; V 0 []) ! F (\\ tx -&gt; R $ \\ txs -&gt; V 1 [tx, txs]) of\n    V 0 []        -&gt; []\n    V 1 [tx, txs] -&gt; tx : decode txs\n    _             -&gt; error \"not a list\"\n</code></pre>\n\n<p>Of course, you have to <em>guess</em> which decode function(s) you need to apply. But that's the untyped lambda calculus for you!</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1436612179, "creation_date": 1436612179, "answer_id": 31356437, "question_id": 31348141, "link": "https://stackoverflow.com/questions/31348141/adventures-with-the-untyped-lambda-calculus/31356437#31356437", "title": "Adventures with the untyped lambda calculus", "body": "<p>This is not an answer, but commenting is too restrictive.</p>\n\n<p><code>R Just</code> is ill-typed, because its type is recursive, but we can always wrap this type-level recursion in a data type:</p>\n\n<pre><code>data Fix2 g f = Fix2 { run :: g (f (Fix2 g f)) }\n</code></pre>\n\n<p><code>Fix2</code> can be represented in terms of <code>Fix</code> and composition of type constructors, but I don't want to complicate things.</p>\n\n<p>Then we can define <code>decode</code> as</p>\n\n<pre><code>decode :: Term (Fix2 Maybe Term) -&gt; Maybe (Term (Fix2 Maybe Term))\ndecode tmx = run $ out $ tmx ! R (Fix2 . const Nothing) ! R (Fix2 . Just)\n</code></pre>\n\n<p>Some tests:</p>\n\n<pre><code>isSomething :: Term (Fix2 Maybe Term) -&gt; Bool\nisSomething = isJust . decode\n\ni = F id\n\nmain = do\n    print $ isSomething (something ! i) -- True\n    print $ isSomething  nothing        -- False\n</code></pre>\n\n<p>But clearly <code>Term (Fix2 Maybe Term)</code> is far from <code>Term a</code>.</p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "answer_count": 2, "score": 12, "last_activity_date": 1436612179, "creation_date": 1436553973, "question_id": 31348141, "link": "https://stackoverflow.com/questions/31348141/adventures-with-the-untyped-lambda-calculus", "title": "Adventures with the untyped lambda calculus", "body": "<p>We occasionally have people ask about implementing the untyped lambda calculus in Haskell. [Naturally, I now cannot <em>find</em> any of these questions, but I'm sure I've seen them!] Just for giggles, I thought I'd spend some time playing with this.</p>\n\n<p>It's trivial enough to do something like</p>\n\n<pre><code>i = \\ x -&gt; x\nk = \\ x y -&gt; x\ns = \\ f g x -&gt; (f x) (g x)\n</code></pre>\n\n<p>This works perfectly. However, as soon as you try to do something like</p>\n\n<pre><code>s i i\n</code></pre>\n\n<p>the type-checker rightly complains about an infinite type. Basically <em>everything</em> in the untyped lambda calculus is a function &mdash; which essentially means all functions have <em>infinite</em> arity. But Haskell only allows functions of finite arity. (Because, really, why would you want infinite arity?)</p>\n\n<p>Well, it turns out we can easily side-step that limitation:</p>\n\n<pre><code>data Term = T (Term -&gt; Term)\n\nT f ! x = f x\n\ni = T $ \\ x -&gt; x\nk = T $ \\ x -&gt; T $ \\ y -&gt; x\ns = T $ \\ f -&gt; T $ \\ g -&gt; T $ \\ x -&gt; (f ! x) ! (g ! x)\n</code></pre>\n\n<p>This works perfectly, and allows arbitrary lambda expressions to be constructed and executed. For example, we can easily build a function to turn an <code>Int</code> into a Church numeral:</p>\n\n<pre><code>zero = k ! i\nsucc = s ! (s ! (k ! s) ! k)\n\nencode 0 = zero\nencode n = succ ! (encode $ n-1)\n</code></pre>\n\n<p>Again, this works perfectly.</p>\n\n<p>Now write a decode function.</p>\n\n<p>&hellip;yeah, good luck with that! The trouble is, we can <em>create</em> arbitrary lambda terms, but we can't <em>inspect</em> them in any way. So we need to add some way to do that.</p>\n\n<hr>\n\n<p>So far, the best idea I've come up with is this:</p>\n\n<pre><code>data Term x = F (Term x -&gt; Term x) | R (Term x -&gt; x)\n\nF f ! x =            f x\nR f ! x = R $ \\ _ -&gt; f x\n\nout :: Term x -&gt; x\nout (R f) = f (error \"mu\")\nout (F _) =   (error \"nu\")\n\ni = F $ \\ x -&gt; x\nk = F $ \\ x -&gt; F $ \\ y -&gt; x\ns = F $ \\ f -&gt; F $ \\ g -&gt; F $ \\ x -&gt; (f ! x) ! (g ! x)\n</code></pre>\n\n<p>I can now do something like</p>\n\n<pre><code>decode :: Term Int -&gt; Int\ndecode ti = out $ ti ! R (\\ tx -&gt; 1 + out tx) ! R (\\ tx -&gt; 0)\n</code></pre>\n\n<p>This works great for Church Bools and Church numerals.</p>\n\n<hr>\n\n<p>Things start to go horribly wrong when I start trying to do anything high-order. Having thrown away all the type information to implement the <em>untyped</em> lambda calculus, I'm now struggling to convince the type checker to let me do what I want to do.</p>\n\n<p>This works:</p>\n\n<pre><code>something = F $ \\ x -&gt; F $ \\ n -&gt; F $ \\ s -&gt; s ! x\nnothing   =            F $ \\ n -&gt; F $ \\ s -&gt; n\n\nencode :: Maybe x -&gt; Term x\nencode (Nothing) = nothing\nencode (Just  x) = something ! x\n</code></pre>\n\n<p>This does not:</p>\n\n<pre><code>decode :: Term x -&gt; Maybe (Term x)\ndecode tmx = out $ tmx ! R (\\ tx -&gt; Nothing) ! R (\\ tx -&gt; Just tx)\n</code></pre>\n\n<p>I've tried a dozen slight variations on this; none of them type-check. It's not that I don't understand why it fails, but rather than I can't figure out any way for it to succeed. (Most particularly, <code>R Just</code> is clearly ill-typed.)</p>\n\n<p>It's almost as if I want a function <code>forall x y. Term x -&gt; Term y</code>. Because, for <em>pure</em> untyped terms, this should always be possible. It's only terms involving <code>R</code> where that won't work. But I can't figure out how to phrase that in the Haskell type system.</p>\n\n<p>(For example, try changing the type of <code>F</code> to <code>forall x. Term x -&gt; Term x</code>. Now the definition of <code>k</code> is ill-typed, since the inner <code>F $ \\ y -&gt; x</code> cannot actually return <em>any</em> type, but only the [now fixed] type of <code>x</code>.)</p>\n\n<p>Any anybody smarter than me have a better idea?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1436548361, "post_id": 31346467, "comment_id": 50676742, "body": "Sorry, what should <code>convDBInfo</code> do?"}, {"owner": {"reputation": 127, "user_id": 4270616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3a4832cbc4dad09193b766410eec381?s=128&d=identicon&r=PG&f=1", "display_name": "svr", "link": "https://stackoverflow.com/users/4270616/svr"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1436548770, "post_id": 31346467, "comment_id": 50676941, "body": "Sorry I wasn&#39;t clear. Edited to add the information."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1436548820, "post_id": 31346467, "comment_id": 50676965, "body": "If you know there won\u2019t be an error, why does it need to return an <code>Either</code>?"}, {"owner": {"reputation": 127, "user_id": 4270616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3a4832cbc4dad09193b766410eec381?s=128&d=identicon&r=PG&f=1", "display_name": "svr", "link": "https://stackoverflow.com/users/4270616/svr"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1436548999, "post_id": 31346467, "comment_id": 50677069, "body": "A <code>lookup</code> of <code>t</code> from <code>DBInfo</code> could be a failure (<code>Maybe TableInfo</code>) even though it wouldn&#39;t happen."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1436551574, "post_id": 31346467, "comment_id": 50678331, "body": "Why not use HashMap&#39;s <code>foldWithKey</code>?"}, {"owner": {"reputation": 127, "user_id": 4270616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3a4832cbc4dad09193b766410eec381?s=128&d=identicon&r=PG&f=1", "display_name": "svr", "link": "https://stackoverflow.com/users/4270616/svr"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1436583512, "post_id": 31346467, "comment_id": 50688474, "body": "Rephrased the question. @Arnon, I can&#39;t follow. What is the idea?"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1436601962, "post_id": 31346467, "comment_id": 50691887, "body": "@svr - you use <code>foldWithKey</code> to traverse over the HashMap and your custom function (that you call with <code>fold</code>) transforms each element into a safe element accordingly. That way, when you finish your fold you have a new structure that is safe"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1450180154, "last_edit_date": 1450180154, "creation_date": 1436597682, "answer_id": 31354366, "question_id": 31346467, "link": "https://stackoverflow.com/questions/31346467/build-a-graph-structure-in-haskell/31354366#31354366", "title": "Build a graph structure in haskell", "body": "<p>We can tie a knot the following way:</p>\n\n<pre><code>convDBInfo :: DBInfo -&gt; SafeDBInfo\nconvDBInfo dbi = safeDbi where\n  safeDbi = H.map (H.map go) dbi\n  go (CIFKey colName tblName) = SCIFKey colName $ safeDbi H.! tblName\n  go (CISimple colName)       = SCISimple colName\n</code></pre>\n\n<p>We get <code>safeDbi</code> by mapping over the column entries in the input. The important point is that we look up the tables from <code>safeDbi</code> in the definition of <code>go</code>, so the tables in <code>SCIFKey</code>-s will be from the resulting hashmap.</p>\n\n<p>Example:</p>\n\n<pre><code>foo :: DBInfo\nfoo = H.fromList [\n  (\"table1\", H.fromList [\n       (\"col1\", CIFKey \"a\" \"table2\")\n       ]),\n  (\"table2\", H.fromList [\n       (\"col2\", CIFKey \"b\" \"table1\")\n       ])\n  ]\n\nbar = convDBInfo foo\nSCIFKey _ tbl2 = (bar H.! \"table1\") H.! \"col1\"\nSCIFKey name _ = tbl2 H.! \"col2\"\n-- name == \"b\"\n</code></pre>\n\n<p>Note though that knotty data structures are often inconvenient to use, because they are indistinguishable from lazy infinite structures, so we have to give it extra thought when we'd like to print, serialize or compare them. Most of the time explicitly keyed graphs are easier to use, and not much worse performance wise.</p>\n"}], "owner": {"reputation": 127, "user_id": 4270616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3a4832cbc4dad09193b766410eec381?s=128&d=identicon&r=PG&f=1", "display_name": "svr", "link": "https://stackoverflow.com/users/4270616/svr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 31354366, "answer_count": 1, "score": 4, "last_activity_date": 1450180154, "creation_date": 1436547832, "last_edit_date": 1436583433, "question_id": 31346467, "link": "https://stackoverflow.com/questions/31346467/build-a-graph-structure-in-haskell", "title": "Build a graph structure in haskell", "body": "<p>I'm modelling the type information of a relational database. I would like to build the following graph:</p>\n\n<ol>\n<li><p>The vertices are tables.</p></li>\n<li><p>An edge exists from table A to table B for every column in A which is a foreign key to B.</p></li>\n</ol>\n\n<p>This is the initial data I have for building the graph.</p>\n\n<pre><code>newtype TableName = TableName T.Text\nnewtype ColName = ColName T.Text\nnewtype ColType = ColType T.Text\n\ntype DBInfo = H.HashMap TableName TableInfo\ntype TableInfo = H.HashMap ColName ColInfo\ndata ColInfo = CISimple ColType\n             -- Forms the basis for building the graph\n             | CIFKey ColType TableName -- col type, referenced table\n\ngetDBInfo :: IO (DBInfo)\n</code></pre>\n\n<p>These are the types of the graph structure I'm expecting.</p>\n\n<pre><code>data SafeColInfo = SCISimple ColType \n                 -- This captures an edge between two tables\n                 | SCIFKey ColType SafeTableInfo\ntype SafeTableInfo = H.HashMap TableName SafeColInfo\ntype SafeDBInfo = ..\n</code></pre>\n\n<p>I would like to write this function :</p>\n\n<pre><code>convDBInfo :: DBInfo -&gt; Either String SafeDBInfo\n</code></pre>\n\n<p><code>convDBInfo</code> should build the above graph. The information about <code>t</code> in any foreign key <code>(CIFKey ctype t)</code> can be found by looking up <code>t</code> in <code>DBInfo</code>. If it is not found, the input data is inconsistent and is an error. </p>\n\n<p>This is fairly straightforward in an imperative language with references. However, I can't think of a way to solve this in Haskell. As I understand, this looks like a good fit for the 'Tying the knot' paradigm, but I can't seem to wrap my head around it. How do I write this function?</p>\n"}, {"tags": ["haskell", "sqlite", "readonly", "yesod", "persistent"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1436561791, "post_id": 31345498, "comment_id": 50683378, "body": "sqlite, being a file based database, doesn&#39;t have the concept of &#39;connection strings&#39;. It doesn&#39;t even have connections, because the dbms here is just a library in your program."}], "answers": [{"comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1436591061, "post_id": 31348972, "comment_id": 50689634, "body": "It seems reasonable to open an issue on Persistent about this @ruben.moor. It might not be too difficult to implement yourself, either."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1436652827, "post_id": 31348972, "comment_id": 50705416, "body": "I&#39;ll try out the approach with simple read-only permission on the db file. It sounds sufficient for all practical purposes. One might argue though, that a read-only access specified in the haskell code is cleaner (depending on the circumstances) and I&#39;ll take a look into the necessary changes for that, as well."}], "tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": false, "score": 3, "last_activity_date": 1436557073, "creation_date": 1436557073, "answer_id": 31348972, "question_id": 31345498, "link": "https://stackoverflow.com/questions/31345498/how-to-open-a-sqlite3-database-in-read-only-mode-with-persistent/31348972#31348972", "title": "How to open a Sqlite3 database in read-only mode with persistent?", "body": "<p>I think that's .NET specific information you're linking to, so it probably doesn't apply here.</p>\n\n<p>If you look at <a href=\"https://github.com/yesodweb/persistent/blob/persistent-sqlite/2.2/persistent-sqlite/Database/Sqlite.hs#L188\" rel=\"nofollow\">the code</a>, persistent just calls the SQLite C function <a href=\"https://www.sqlite.org/c3ref/open.html\" rel=\"nofollow\"><code>sqlite3_open</code></a> which only takes the filename of the database.</p>\n\n<p>It looks like it would need to use <code>sqlite3_open_v2</code> which take additional flags, if you wanted to make the connection read-only.</p>\n\n<p>You can probably achieve the same thing using file permissions though, since a user won't be able to write the SQLite DB file if they don't have permission to do so.</p>\n"}, {"tags": [], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "is_accepted": true, "score": 1, "last_activity_date": 1466404529, "creation_date": 1466404529, "answer_id": 37915959, "question_id": 31345498, "link": "https://stackoverflow.com/questions/31345498/how-to-open-a-sqlite3-database-in-read-only-mode-with-persistent/37915959#37915959", "title": "How to open a Sqlite3 database in read-only mode with persistent?", "body": "<p>Persistent now supports Sqlite3-URI-syntax in connection strings, as documented here:</p>\n\n<p><a href=\"https://github.com/yesodweb/persistent/wiki/Database-Configuration\" rel=\"nofollow\">https://github.com/yesodweb/persistent/wiki/Database-Configuration</a></p>\n\n<p>Thus, for read-only something like this works:</p>\n\n<p>URI filename style, relative path, read-only: \"file:sqlite3.db?mode=ro\"</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3241, "favorite_count": 0, "accepted_answer_id": 37915959, "answer_count": 2, "score": 2, "last_activity_date": 1466404529, "creation_date": 1436544555, "question_id": 31345498, "link": "https://stackoverflow.com/questions/31345498/how-to-open-a-sqlite3-database-in-read-only-mode-with-persistent", "title": "How to open a Sqlite3 database in read-only mode with persistent?", "body": "<p>I currently use <code>createSqlitePool</code> from persistent-sqlite:</p>\n\n<pre><code>import Database.Persist.Sqlite\n\ncreateSqlitePool \"mydb.db\" 10\n</code></pre>\n\n<p>According to Sqlite3 documentation I can pass additional parameters in connection strings, e.g.</p>\n\n<pre><code>\"Data Source=c:\\mydb.db;Version=3;Read Only=True;\"\n</code></pre>\n\n<p>Cf. <a href=\"https://www.connectionstrings.com/sqlite-net-provider/read-only-connection/\" rel=\"nofollow\">https://www.connectionstrings.com/sqlite-net-provider/read-only-connection/</a></p>\n\n<p>Apparently, it's not possible to simply pass this connection string to <code>createSqlitePool</code>. Is there a way to tell persistent-sqlite to open my database read-only?</p>\n"}, {"tags": ["haskell", "random", "transactions", "transactional-memory"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1436605998, "creation_date": 1436605998, "answer_id": 31355484, "question_id": 31345458, "link": "https://stackoverflow.com/questions/31345458/adding-random-number-generation-to-the-stm-monad-in-haskell/31355484#31355484", "title": "Adding random number generation to the STM monad in Haskell", "body": "<p>STM is a base monad, think what <code>atomically</code>, which is currently <code>STM a -&gt; IO a</code> should look like, if we had <code>STMT</code>.</p>\n\n<p>I have few solutions to your particular problem in mind. Simpler one is probably to re-arrange the code:</p>\n\n<pre><code>write :: Int -&gt; RandT StdGen STM [Int]\nwrite n = do\n   -- random list of indexes, so you don't need to interleave random and stm code at all\n   rn &lt;- getRandomRs (0, numTVars) \n   lift $ go rn\n   where go []     = return []\n         go (i:is) = do tvars &lt;- tvars -- this is redundant, could be taken out of the loop\n                        temp &lt;-  readArray tvars i\n                        writeArray tvars i (temp + 1)\n                        rands &lt;- go is\n                        return $ i : rands\n</code></pre>\n\n<hr>\n\n<p>Yet the <code>RandT</code> is essentially <code>StateT</code> with <code>lift</code>:</p>\n\n<pre><code>instance MonadTrans (StateT s) where\n    lift m = StateT $ \\ s -&gt; do\n        a &lt;- m\n        return (a, s)\n</code></pre>\n\n<p>So the code of form:</p>\n\n<pre><code>do x &lt;- lift baseAction1\n   y &lt;- lift baseAction2\n   return $ f x y\n</code></pre>\n\n<p>Will be</p>\n\n<pre><code>do x &lt;- StateT $ \\s -&gt; do { a &lt;- baseAction1; return (a, s) }\n   y &lt;- StateT $ \\s -&gt; do { a &lt;- baseAction2; return (a, s) }\n   return $ f x y\n</code></pre>\n\n<p>which is after desugaring do notation</p>\n\n<pre><code>StateT (\\s -&gt; do { a &lt;- baseAction1; return (a, s) }) &gt;&gt;= \\ x -&gt;\nStateT (\\s -&gt; do { a &lt;- baseAction2; return (a, s) }) &gt;&gt;= \\ y -&gt;\nreturn $ f x y\n</code></pre>\n\n<p>inlining first <code>&gt;&gt;=</code></p>\n\n<pre><code>StateT $ \\s -&gt; do\n  ~(a, s') &lt;- runStateT (StateT (\\s -&gt; do { a &lt;- baseAction1; return (a, s) })) s\n  runStateT ((\\ x -&gt; StateT (\\s -&gt; do { a &lt;- baseAction2; return (a, s) }) &gt;&gt;= \\ y -&gt; return $ f x y) a) s'\n</code></pre>\n\n<p><code>StateT</code> and <code>runStateT</code> cancel out:</p>\n\n<pre><code>StateT $ \\s -&gt; do\n  ~(x, s') &lt;- do { a &lt;- baseAction1; return (a, s) }))\n  runStateT ((\\ x -&gt; StateT (\\s -&gt; do { a &lt;- baseAction2; return (a, s) }) &gt;&gt;= \\ y -&gt; return $ f x y) x) s'\n</code></pre>\n\n<p>And after few inlining / reduction steps:</p>\n\n<pre><code>StateT $ \\s -&gt; do\n  ~(x, s') &lt;- do { a &lt;- baseAction1; return (a, s) }))\n  ~(y, s'') &lt;- do { a &lt;- baseAction2; return (a, s') }))\n  return (f x y, s'')\n</code></pre>\n\n<p>Probably GHC is smart enough to reduce this is even further, so state is just passed thru without creating intermediate pairs (yet I'm not sure, one should use monad laws to justify that):</p>\n\n<pre><code>StateT $ \\s -&gt; do\n   x &lt;- baseAction1\n   y &lt;- baseAction2\n   return (f x y, s)\n</code></pre>\n\n<p>which is what you get from</p>\n\n<pre><code>lift do x &lt;- baseAction1\n        y &lt;- baseAction2\n        return $ f x y\n</code></pre>\n"}], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 31355484, "answer_count": 1, "score": 4, "last_activity_date": 1436605998, "creation_date": 1436544375, "last_edit_date": 1436563649, "question_id": 31345458, "link": "https://stackoverflow.com/questions/31345458/adding-random-number-generation-to-the-stm-monad-in-haskell", "title": "Adding random number generation to the STM monad in Haskell", "body": "<p>I am currently working on some transactional memory benchmarks in Haskell and would like to be able to make use of random numbers within a transaction.  I am currently using the Random monad/monad transformer from <a href=\"http://hackage.haskell.org/package/MonadRandom-0.1.3/docs/Control-Monad-Random.html\" rel=\"nofollow\">here</a>.  In the following example, I have an array of TVars containing integers and a transaction that randomly selects 10 tvars in the array to increment, such as:</p>\n\n<pre><code>tvars :: STM (TArray Int Int)\ntvars = newArray (0, numTVars) 0\n\nwrite :: Int -&gt; RandT StdGen STM [Int]\nwrite 0 = return []\nwrite i = do\n    tvars &lt;- lift tvars\n    rn &lt;- getRandomR (0, numTVars)\n    temp &lt;- lift $ readArray tvars rn\n    lift $ writeArray tvars rn (temp + 1)\n    rands &lt;- write (i-1)\n    lift $ return $ rn : rands\n</code></pre>\n\n<p>I guess my question is \"Is this the best way to go about doing this?\"  It seems like it would be more natural/efficient to go the other way around, i.e. lift the random monad into the STM monad.  Each transaction does a lot of STM operations, and very few random operations.  I would assume that each <code>lift</code> adds some amount of overhead.  Wouldn't it be more efficient to only <code>lift</code> the random computations and leave the STM computations alone?  Is this even safe to do?  It seems that defining an STM monad transformer would break the nice static separation properties that we get with the STM monad (i.e. We could lift IO into the STM monad, but then we have to worry about undoing IO actions if a transaction aborts which presents a number of issues).  My knowledge of monad transformers is pretty limited.  A brief explanation regarding the performance and relative overhead of using a transformer would be much appreciated.</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436540836, "post_id": 31343829, "comment_id": 50672323, "body": "I got <code>fatal error: dist&#47;build&#47;autogen&#47;cabal_macros.h: No such file or directory</code>. From the source I see it&#39;s looking for <code>HASKELL_DIST_DIR</code>, do I not have it?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 1, "creation_date": 1436545735, "post_id": 31343829, "comment_id": 50675392, "body": "Depends: are you using a cabal sandbox? If so, I can&#39;t help you, I don&#39;t know where it stores things. If you&#39;re using stack, try running <code>stack path --dist-dir</code>."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436547091, "post_id": 31343829, "comment_id": 50676095, "body": "unfortunately I am using sandbox. but thanks anyways"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1436539768, "creation_date": 1436539768, "answer_id": 31343829, "question_id": 31343246, "link": "https://stackoverflow.com/questions/31343246/get-package-version-to-cpp/31343829#31343829", "title": "get package version to cpp", "body": "<p>You can use the very idiomatic (/s) options:</p>\n\n<pre><code>ghc -optP-include -optPdist/build/autogen/cabal_macros.h\n</code></pre>\n\n<p>I happen to have just been writing a pull request to doctest about this, you may be interested in referencing it:</p>\n\n<p><a href=\"https://github.com/sol/doctest/pull/109/files#diff-438bc19bd41887f8cacb796eaa990b0aR81\" rel=\"nofollow\">https://github.com/sol/doctest/pull/109/files#diff-438bc19bd41887f8cacb796eaa990b0aR81</a></p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436539768, "creation_date": 1436538209, "question_id": 31343246, "link": "https://stackoverflow.com/questions/31343246/get-package-version-to-cpp", "title": "get package version to cpp", "body": "<p>When parsing source codes with c preprocessor enabled, the parser doesn't like undefined macros like <code>MIN_VERSION_packagename(a,b,c)</code>. How can I get cabal/ghc tell cpp the package info and add the macro definitons? </p>\n"}, {"tags": ["haskell", "ssh", "libssh2"], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1436537980, "creation_date": 1436536812, "last_edit_date": 1436537980, "question_id": 31342724, "link": "https://stackoverflow.com/questions/31342724/haskell-libssh2-module-throws-error-known-hosts", "title": "Haskell libssh2 module throws ERROR_KNOWN_HOSTS", "body": "<p>I am trying to ssh to my local machine using <a href=\"https://github.com/portnov/libssh2-hs/blob/master/libssh2/ssh-client.hs#L12\" rel=\"nofollow\"><code>libssh2-hs</code></a> module. The command i used is,</p>\n\n<pre><code>runhaskell ssh-client.hs command sk localhost 22 ls\n</code></pre>\n\n<p>And it throws,</p>\n\n<pre><code>ssh-client.hs: ERROR_KNOWN_HOSTS\n</code></pre>\n\n<p>When i run ssh client as,</p>\n\n<pre><code>ssh sk@localhost\n</code></pre>\n\n<p>it goes through successfully.</p>\n\n<p>This error message is inadequate.. (or) is there any other haskell ssh library, i can use.</p>\n\n<p>I deleted all host fingerprints in /home/sk/.ssh/known_hosts and it throws <code>Authentication failure</code>. And surprisingly, the <a href=\"https://github.com/portnov/libssh2-hs/blob/master/libssh2/ssh-client.hs#L12\" rel=\"nofollow\">cli tool</a> is not having any traces of taking a password/privat key argument.</p>\n"}, {"tags": ["file", "haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1436538339, "post_id": 31342833, "comment_id": 50670525, "body": "You&#39;ve correctly pointed out the problem, but your solution is needlessly complicated."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436538703, "post_id": 31342833, "comment_id": 50670772, "body": "@leftaroundabout Is bheklilr&#39;s approach what you would recommend?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436538996, "post_id": 31342833, "comment_id": 50670983, "body": "Yes, <code>readFile</code> is what I&#39;d recommend unless there&#39;s a reason not to (performance etc.), or you&#39;re already using <code>conduit</code> or <code>pipes</code> in the project."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1436543569, "post_id": 31342833, "comment_id": 50674064, "body": "The write-to-new-file-and-rename approach is actually better anyways, since it doesn&#39;t risk losing data in the case of a crash in the middle of the write."}], "tags": [], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "is_accepted": true, "score": 6, "last_activity_date": 1436537672, "last_edit_date": 1436537672, "creation_date": 1436537085, "answer_id": 31342833, "question_id": 31342012, "link": "https://stackoverflow.com/questions/31342012/read-and-writing-to-file-in-haskell/31342833#31342833", "title": "Read and writing to file in Haskell", "body": "<p>I think your problem is that hGetContents is lazy. The contents of the file are not immediately read in when you use hGetContents. They are read in when they are needed.</p>\n\n<p>In your first example you open the file and say that you want the contents, but then close the file before you do anything with them. Then you write to the file. When you write to an existing file the contents are cleared, but since you closed the file you no longer have access to the file contents.</p>\n\n<p>In the second example you open the file and then try to write to the file, but because the contents are not really read until they are needed (when they are transformed and written back) you end up trying to write to and read from the same file at the same time.</p>\n\n<p>You could write to a file named file2.txt then when you are done, delete file.txt and rename file2.txt to file.txt</p>\n"}, {"comments": [{"owner": {"reputation": 10281, "user_id": 1033448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d64fdbd293e80580b1c702998cb6e740?s=128&d=identicon&r=PG", "display_name": "Anton Guryanov", "link": "https://stackoverflow.com/users/1033448/anton-guryanov"}, "edited": false, "score": 0, "creation_date": 1436537499, "post_id": 31342911, "comment_id": 50669946, "body": "And the second attempt failed, because OP tried to open a file for writing, which was already opened for writing (because of <code>ReadWriteMode</code>)"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1436537634, "post_id": 31342911, "comment_id": 50670049, "body": "Anton Guryanov: in my experiments, it failed even when the file was just opend with <code>ReadMode</code>."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1454430679, "post_id": 31342911, "comment_id": 58035844, "body": "By calling length on newContents, you are forcing newContents to be evaluated completely before you write the file. Is that correct?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1454432435, "post_id": 31342911, "comment_id": 58037140, "body": "@bwroga <code>length newContents</code> won&#39;t force anything by itself, it&#39;s when we force the evaluation of the entire expression <code>length newContents &gt; 0</code> that <code>newContents</code> gets evaluated."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1454434141, "post_id": 31342911, "comment_id": 58038252, "body": "And because the first argument to when is evaluated before the second?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1454434934, "post_id": 31342911, "comment_id": 58038789, "body": "@bwroga it necessarily is since it has to choose a branch."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 9, "last_activity_date": 1436537340, "creation_date": 1436537340, "answer_id": 31342911, "question_id": 31342012, "link": "https://stackoverflow.com/questions/31342012/read-and-writing-to-file-in-haskell/31342911#31342911", "title": "Read and writing to file in Haskell", "body": "<p>Lazy IO is bad, and this is generally considered to be a pain point in Haskell.  Basically the <code>contents</code> isn't evaluated until you go to write it back to disk, at which point it can't be evaluated because the file is already closed.  You can fix this in several ways, without resorting to extra libraries you can use the <code>readFile</code> function and then check the length before writing back out:</p>\n\n<pre><code>import Control.Monad (when)\n\nmain = do\n    contents &lt;- readFile \"file.txt\"\n    let newContents = map toUpper contents\n    when (length newContents &gt; 0) $\n        writeFile \"file.txt\" newContents\n</code></pre>\n\n<p>I would say this code is actually better anyway because you don't write back out to a file that is already empty, a pointless operation.</p>\n\n<p>Another way would be to use a streaming library, <code>pipes</code> is a popular choice with some good tutorials and a solid mathematical foundation, and that would be my choice as well.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1436537963, "post_id": 31342939, "comment_id": 50670260, "body": "Please don&#39;t recommend kludges to get <code>Handle</code>s to work, without also mentioning some of the better alternatives. FWIW, <code>hGetContents&#39;</code>would better be implemented with <a href=\"http://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#v:deepseq\" rel=\"nofollow noreferrer\">deepseq</a> (it&#39;s in fact the example on that page)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1438341567, "post_id": 31342939, "comment_id": 51423174, "body": "or just <code>hGetContents&#39; h = do { c &lt;- hGetContents h ; if (length c &gt; 0) then return c else return &quot;&quot; }</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1438384900, "post_id": 31342939, "comment_id": 51446741, "body": "Will Ness: that doesn&#39;t prevent the handle from being put in a semi-closed state"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1438505164, "post_id": 31342939, "comment_id": 51471355, "body": "yes, but the returned <code>c</code> contains contents of the whole file already, <code>length</code> forces it through to the end, so there&#39;s nothing more to read from the file. I tested it with <code>c &lt;- hGetContents&#39; h; hClose h; ... use c...</code> and it worked."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1438509597, "post_id": 31342939, "comment_id": 51472398, "body": "Will Ness: while that&#39;s a valid answer to OP&#39;s question, my answer&#39;s about using a single handle for read and write, so I don&#39;t see the relevance."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1438519713, "post_id": 31342939, "comment_id": 51474728, "body": "ah, yes, the <code>hSeek</code> operation fails with an error &quot;the handle is closed&quot;, using the shorter code. I wonder if using <code>deepseq</code> would cause the same problem."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 4, "last_activity_date": 1436537424, "creation_date": 1436537424, "answer_id": 31342939, "question_id": 31342012, "link": "https://stackoverflow.com/questions/31342012/read-and-writing-to-file-in-haskell/31342939#31342939", "title": "Read and writing to file in Haskell", "body": "<p>There's a couple things going on here</p>\n\n<p>You opened the file in <code>ReadWriteMode</code>, but only read the contents. Why not use the same handle for both?</p>\n\n<pre><code>main = do\n    handle &lt;- openFile \"file.txt\" ReadWriteMode\n    contents &lt;- hGetContents' handle\n    hSeek handle AbsoluteSeek 0\n    hPutStr handle (map toUpper contents)\n    hClose handle\n    return ()\n</code></pre>\n\n<p><code>hGetContents</code> will put the handle in a semi-closed state, so you'll need something else to read the file contents:</p>\n\n<pre><code>hGetContents' :: Handle -&gt; IO String\nhGetContents' h = do\n  eof &lt;- hIsEOF h\n  if eof\n    then\n      return []\n    else do\n      c &lt;- hGetChar h\n      fmap (c:) $ hGetContents' h\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 5, "last_activity_date": 1436538061, "creation_date": 1436538061, "answer_id": 31343190, "question_id": 31342012, "link": "https://stackoverflow.com/questions/31342012/read-and-writing-to-file-in-haskell/31343190#31343190", "title": "Read and writing to file in Haskell", "body": "<p>@bwroga's answer is perfectly correct. Here is an implementation of the suggested approach (writing to temporary file &amp; renaming):</p>\n\n<pre><code>import Data.Char (toUpper)\nimport System.Directory (renameFile, getTemporaryDirectory)\nimport System.Environment (getArgs)\n\nmain = do\n    [file] &lt;- getArgs\n    tmpDir &lt;- getTemporaryDirectory\n    let tmpFile = tmpDir ++ \"/\" ++ file\n    readFile file &gt;&gt;= writeFile tmpFile . map toUpper\n    renameFile tmpFile file\n</code></pre>\n"}], "owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14237, "favorite_count": 4, "accepted_answer_id": 31342833, "answer_count": 4, "score": 11, "last_activity_date": 1436538061, "creation_date": 1436534844, "last_edit_date": 1436535327, "question_id": 31342012, "link": "https://stackoverflow.com/questions/31342012/read-and-writing-to-file-in-haskell", "title": "Read and writing to file in Haskell", "body": "<p>I am trying to read the contents of a file, turn the text to upper-case and then write it back.</p>\n\n<p>Here is the code I had written:</p>\n\n<pre><code>import System.IO\nimport Data.Char\n\nmain = do\n    handle &lt;- openFile \"file.txt\" ReadWriteMode\n    contents &lt;- hGetContents handle\n    hClose handle\n    writeFile \"file.txt\" (map toUpper contents)\n    return ()\n</code></pre>\n\n<p>However, this writes nothing to the file, in fact, it even clears it.</p>\n\n<p>I made some changes:</p>\n\n<pre><code>main = do\n    handle &lt;- openFile \"file.txt\" ReadWriteMode\n    contents &lt;- hGetContents handle\n    writeFile \"file.txt\" (map toUpper contents)\n    hClose handle\n    return ()\n</code></pre>\n\n<p>However, I get the error <code>resource busy (file is locked)</code>. How can I get this working and <strong>why</strong> it didn't work in both cases?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 2, "creation_date": 1436536642, "post_id": 31342598, "comment_id": 50669295, "body": "You can do it with <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO-Unsafe.html#v:unsafeInterleaveIO\" rel=\"nofollow noreferrer\"><code>unsafeInterleaveIO</code></a>: <code>g = do {r &lt;- randomRIO (1,6); rs &lt;- unsafeInterleaveIO g; return (r:rs)}</code>. But unless I had a reason, I&#39;d use your approach."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1436536972, "post_id": 31342598, "comment_id": 50669558, "body": "I generally pretend the <code>unsafeXyzIO</code> functions don&#39;t exist. (But you&#39;re right, this could actually be a safe use case... but I don&#39;t see any benefit over <code>randomRs</code>.)"}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1436539861, "post_id": 31342598, "comment_id": 50671618, "body": "I can&#39;t compile <code>randomRsIO</code>. <code>Couldn&#39;t match type \u2018[a]\u2019 with \u2018([a], StdGen)\u2019</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436540293, "post_id": 31342598, "comment_id": 50671949, "body": "Right, that&#39;s because <code>randomRs</code> doesn&#39;t return an updated generator. Fixed."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1436546108, "post_id": 31342598, "comment_id": 50675572, "body": "Thank you for introducing me to <code>Arrow</code> :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436585658, "post_id": 31342598, "comment_id": 50688813, "body": "I think you mean <code>IO</code>, not <code>State</code> - some kinds of lazy <code>mapM</code> work just fine in <code>State</code>, e.g. the <code>mapM return [1..]</code> in your link. (Just don&#39;t try to get at the &quot;afterward&quot; state.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436603078, "post_id": 31342598, "comment_id": 50692174, "body": "@&#216;rjanJohansen well, e.g. <code>mapM return [1..] &gt;&gt; state (const((),()))</code> terminates, it&#39;s true. But that&#39;s basically just a way of decoupling a \u201cthread\u201d of state. That thread will never terminate."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1436604856, "post_id": 31342598, "comment_id": 50692563, "body": "Because of laziness, &quot;never terminate&quot; doesn&#39;t mean it cannot be useful. Another example that actually <i>uses</i> the state: <code>evalState (mapM (\\x -&gt; modify (+x) &gt;&gt; get) $ [1..]) 0</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1436603359, "last_edit_date": 1495535308, "creation_date": 1436536498, "answer_id": 31342598, "question_id": 31342002, "link": "https://stackoverflow.com/questions/31342002/how-to-generate-an-infinite-list-of-random-numbers-using-randomrio/31342598#31342598", "title": "How to generate an infinite list of random numbers using randomRIO?", "body": "<p>Well, you can't, for much the same <a href=\"https://stackoverflow.com/questions/3270255/is-haskells-mapm-not-lazy\">reason why you can't lazily <code>mapM</code> over <code>State</code></a> (and then use the result state afterwards). <code>randomRIO</code> produces a single value and only hands on the monadic program flow after this value has been produced.</p>\n\n<p>The way to produce infinite streams of random values is of course <code>randomRs</code>. You can easily couple it with <a href=\"http://hackage.haskell.org/package/random-1.1/docs/System-Random.html#globalrng\" rel=\"nofollow noreferrer\"><code>getStdRandom</code></a> to produce such streams right in <code>IO</code>:</p>\n\n<pre><code>import Control.Arrow\n\nrandomRsIO :: Random a =&gt; (a,a) -&gt; IO [a]\nrandomRsIO range = getStdRandom $ split &gt;&gt;&gt; first (randomRs range)\n</code></pre>\n\n<p>With that,</p>\n\n<pre><code>g :: IO [Integer]\ng = randomRsIO (1,6)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436536681, "post_id": 31342622, "comment_id": 50669328, "body": "This won&#39;t work correctly: <code>getStdGen</code> does not update the global RNG state, like <code>randomRIO</code> does. You need <code>getStdRandom</code> to achieve this effect."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1436536902, "last_edit_date": 1436536902, "creation_date": 1436536576, "answer_id": 31342622, "question_id": 31342002, "link": "https://stackoverflow.com/questions/31342002/how-to-generate-an-infinite-list-of-random-numbers-using-randomrio/31342622#31342622", "title": "How to generate an infinite list of random numbers using randomRIO?", "body": "<p>The problem with your code is that it never teminates. Whenever you execute <code>g</code>, it initially calcuates the first random number and stores it in <code>n</code>. Then it again recursively calls back to the same function <code>g</code> which goes on and on. To get an infinite list you can use the <code>randomRs</code> function:</p>\n\n<pre><code>g2 :: IO [Integer]\ng2 = do\n  g &lt;- newStdGen\n  return $ randomRs (1,6) g\n</code></pre>\n\n<p>And then you can produce any number of random numbers using it:</p>\n\n<pre><code>\u03bb&gt; g2 &gt;&gt;= \\x -&gt; return $ take 5 $ x\n[5,4,6,5,6]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "is_accepted": false, "score": 0, "last_activity_date": 1459493588, "creation_date": 1459493588, "answer_id": 36349835, "question_id": 31342002, "link": "https://stackoverflow.com/questions/31342002/how-to-generate-an-infinite-list-of-random-numbers-using-randomrio/36349835#36349835", "title": "How to generate an infinite list of random numbers using randomRIO?", "body": "<p>You wanted an answer using randomRIO. I know its been a long time since the question was asked.</p>\n\n<p>This is using liftM where you can generate a random number in range low <code>l</code> to high <code>h</code> and keep appending to a list num times. So we have a list of length <code>num</code> of random numbers.</p>\n\n<pre><code>import Control.Monad\nimport System.Random\ngx :: Int -&gt; Int -&gt; Int -&gt; IO [Int]\ngx l h num = do\n        x &lt;- randomRIO(l,h)\n        if num &lt;=1 then return [x] else liftM (x:) (gx l h (num-1))\n</code></pre>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1299, "favorite_count": 0, "accepted_answer_id": 31342622, "answer_count": 3, "score": 4, "last_activity_date": 1459493588, "creation_date": 1436534806, "question_id": 31342002, "link": "https://stackoverflow.com/questions/31342002/how-to-generate-an-infinite-list-of-random-numbers-using-randomrio", "title": "How to generate an infinite list of random numbers using randomRIO?", "body": "<p>I'm trying to generate an infinite list of random numbers using randomRIO.   </p>\n\n<pre><code>import System.Random\n\ng :: IO [Integer]\ng = do\n  n &lt;- randomRIO (1,6) :: IO Integer\n  f &lt;- g\n  return (n : f)\n</code></pre>\n\n<p>It compiles but hangs when run.</p>\n"}, {"tags": ["haskell", "haskell-prelude"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1436533956, "post_id": 31341553, "comment_id": 50667383, "body": "What do you mean by &quot;run this function in prelude&quot; ?"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1436534314, "creation_date": 1436534314, "answer_id": 31341813, "question_id": 31341553, "link": "https://stackoverflow.com/questions/31341553/make-and-run-beginswithu-function-in-prelude/31341813#31341813", "title": "Make and run, beginsWithU function in prelude", "body": "<blockquote>\n  <p>How can i define, run this function in prelude</p>\n</blockquote>\n\n<p>You cannot define and run a function in prelude. Prelude is a standard module which comes along with the base package which is shipped with ghc.</p>\n\n<p>Assuming that you want to define and run the code in <code>ghci</code>, this is what you have to do:</p>\n\n<pre><code>\u03bb&gt; let beginsWithU (c:_) = c == 'u' || c == 'U'; beginsWithU _ = False\n\u03bb&gt; beginsWithU \"UHello\"\nTrue\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10281, "user_id": 1033448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d64fdbd293e80580b1c702998cb6e740?s=128&d=identicon&r=PG", "display_name": "Anton Guryanov", "link": "https://stackoverflow.com/users/1033448/anton-guryanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1436534440, "creation_date": 1436534440, "answer_id": 31341859, "question_id": 31341553, "link": "https://stackoverflow.com/questions/31341553/make-and-run-beginswithu-function-in-prelude/31341859#31341859", "title": "Make and run, beginsWithU function in prelude", "body": "<p>I think you want to run it inside ghci.\nYou can use multiline input for this, the commands are <code>:{</code> to start it and <code>:}</code> to end it.</p>\n\n<p>Here's the example</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let beginsWithU (c:_) = c == 'u' || c == 'U'\nPrelude|     beginsWithU _ = False\nPrelude| :}\nPrelude&gt; beginsWithU \"umbrella\"\nTrue\nPrelude&gt; beginsWithU \"mbrella\"\nFalse\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 31341859, "answer_count": 2, "score": 0, "last_activity_date": 1512974172, "creation_date": 1436533544, "last_edit_date": 1512974172, "question_id": 31341553, "link": "https://stackoverflow.com/questions/31341553/make-and-run-beginswithu-function-in-prelude", "title": "Make and run, beginsWithU function in prelude", "body": "<p>How can i define, run this function in prelude,</p>\n\n<pre><code>let beginsWithU (c:_) = c == 'u' || c == 'U'\n   beginsWithU _ = False\n</code></pre>\n\n<p>Line number 2, gives <code>parse error on input \u2018=\u2019</code>. I cannot use let again since it will override the pattern in line 1.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1436525310, "post_id": 31338823, "comment_id": 50661817, "body": "<code>renderValue</code> requires a <code>Value</code> argument while you are trying to provide a <code>String</code> (which is an alias of <code>[Char]</code>). You need to use <code>renderValue (String &quot;bye, saravana&quot;)</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1436525661, "post_id": 31338823, "comment_id": 50662044, "body": "@Lee You should post that as an answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1436525989, "post_id": 31338823, "comment_id": 50662248, "body": "i tried this, <code>renderValue([Char] s) = show s</code>. It fails with <code>parse error on [Char]</code>. Then, i tried <code>import Data.Char</code> and <code>renderValue(Char s:xs) = show s</code>. It still complains, <code>Not in scope: data constructor &#39;Char&#39;</code>...."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1436526411, "post_id": 31339086, "comment_id": 50662489, "body": "Why does n&#39;t haskell interpret &quot;bye, saravana&quot; s type as String, and call the right implementation. isn&#39;t explicit casting of a String constant as String, redundant?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1436527088, "post_id": 31339086, "comment_id": 50662890, "body": "@MadhavanKumar - In <code>renderValue</code> you aren&#39;t casting, you are matching on the named constructors <code>Number</code>, <code>String</code>, <code>Bool</code>. Those constructors also define functions to create <code>Value</code> values e.g. <code>Number</code> is a function <code>Int -&gt; Value</code>. You aren&#39;t creating a type which can be either an <code>Int</code>, <code>String</code> or <code>Bool</code> you are creating a type with three cases which contain an <code>Int</code>, <code>String</code> or <code>Bool</code>. I suggest you rename you constructors to <code>VString</code>, <code>VNumber</code> and <code>VBool</code> which may make things clearer."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1436525950, "creation_date": 1436525950, "answer_id": 31339086, "question_id": 31338823, "link": "https://stackoverflow.com/questions/31338823/render-number-bool-string-as-string-fails-in-haskell/31339086#31339086", "title": "Render Number, Bool, String as String fails in haskell", "body": "<p>Your <code>data</code> declaration defines a type <code>Value</code> along with three constructors: <code>Number</code>, <code>Bool</code> and <code>String</code>. Your <code>renderValue</code> function requires a <code>Value</code> argument, while in</p>\n\n<pre><code>renderValue \"bye, saravana\"\n</code></pre>\n\n<p>you are providing a <code>String</code> (which is an alias for <code>[Char]</code>) argument. You need to provide a <code>Value</code> i.e.</p>\n\n<pre><code>renderValue (String \"bye, saravana\")\n</code></pre>\n\n<p>you should also consider renaming your constructors for <code>Value</code> since they clash with the existing <code>String</code> and <code>Bool</code> types which may be causing some confusion.</p>\n"}, {"tags": [], "owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "is_accepted": false, "score": -1, "last_activity_date": 1436527496, "last_edit_date": 1436527496, "creation_date": 1436527051, "answer_id": 31339426, "question_id": 31338823, "link": "https://stackoverflow.com/questions/31338823/render-number-bool-string-as-string-fails-in-haskell/31339426#31339426", "title": "Render Number, Bool, String as String fails in haskell", "body": "<ol>\n<li><p>Note that you don't need to use <code>show</code> in the <code>String</code> case since it already has the right type.</p></li>\n<li><p>No need to derive <code>Show</code> and <code>Eq</code> if you don't use them.</p></li>\n<li><p>Your code doesn't define a case for <code>Bool False</code> (verify by compiling with <code>-Wall</code>), you can reuse the <code>Show</code> instance of <code>Bool</code> to handle <code>False</code> and <code>True</code> at the same time.</p></li>\n</ol>\n\n<p>Here's the code:</p>\n\n<pre><code>module Main where\n\nimport Data.Char\n\ndata Value = Number Int\n           | Bool Bool\n           | String String\n\nrenderValue :: Value -&gt; String\nrenderValue (String s) = s\nrenderValue (Bool b)   = toLower &lt;$&gt; show b\nrenderValue (Number n) = show n\n\nmain :: IO ()\nmain = putStrLn $ renderValue $ String \"bye, saravana\"\n</code></pre>\n\n<p>Alternatively, you can use the <code>OverloadedStrings</code> extension if you want to avoid typing <code>String</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Data.Char\nimport Data.String\n\ndata Value = Number Int\n           | Bool Bool\n           | String String\n\ninstance IsString Value where\n  fromString = String\n\nrenderValue :: Value -&gt; String\nrenderValue (String s) = s\nrenderValue (Bool b)   = toLower &lt;$&gt; show b\nrenderValue (Number n) = show n\n\nmain :: IO ()\nmain = putStrLn $ renderValue \"bye, saravana\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1436527496, "creation_date": 1436525039, "question_id": 31338823, "link": "https://stackoverflow.com/questions/31338823/render-number-bool-string-as-string-fails-in-haskell", "title": "Render Number, Bool, String as String fails in haskell", "body": "<p>I have a small program, that takes any one of Boolean, Number, String and renders it as a String.</p>\n\n<pre><code>module Main () where\n\ndata Value = Number Int\n       | Bool Bool\n       | String String\n    deriving (Eq, Show)\n\nrenderValue :: Value -&gt; String\nrenderValue (String s) = show s\nrenderValue(Bool True) = \"true\"\nrenderValue(Number n) = show n\n\nmain = do\n  putStrLn $ renderValue \"bye, saravana\"\n</code></pre>\n\n<p>renderValue is an overloaded method that is supposed to take String inputs. But the last line,</p>\n\n<pre><code>putStrLn $ renderValue \"bye, saravana\"\n</code></pre>\n\n<p>prints error as,</p>\n\n<pre><code>Couldn't match expected type \u2018Value\u2019 with actual type \u2018[Char]\u2019\nIn the first argument of \u2018renderValue\u2019, namely \u2018\"bye, saravana\"\u2019\nIn the second argument of \u2018($)\u2019, namely\n  \u2018renderValue \"bye, saravana\"\u2019\nIn a stmt of a 'do' block: putStrLn $ renderValue \"bye, saravana\"\n</code></pre>\n\n<p>Why is <code>Value = Number | Bool | String</code> not taking string inputs?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 2, "creation_date": 1436505067, "post_id": 31332033, "comment_id": 50650768, "body": "I don&#39;t think cabal is getting an uninstall command anytime soon.  However, you may try using &#39;stack&#39; instead of cabal which uses sandboxes to great effect and almost eliminate the need to delete individual packages. Experimental and project-specific packages are always installed in your local project directory, and you can simply run &#39;stack clean&#39; to clear all local packages."}], "answers": [{"comments": [{"owner": {"reputation": 2097, "user_id": 4756173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e50f7e8bb3963d1dc749e278c3d8d33?s=128&d=identicon&r=PG", "display_name": "Philippe Fanaro", "link": "https://stackoverflow.com/users/4756173/philippe-fanaro"}, "edited": false, "score": 0, "creation_date": 1618691597, "post_id": 35640607, "comment_id": 118680726, "body": "What a lazy implementation of a package manager. And that&#39;s lazy in a really bad sense. I know a lot of people who simply quit Haskell because the package management is so difficult to deal with. We need to abstract away these issues."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 8, "last_activity_date": 1456443564, "creation_date": 1456443564, "answer_id": 35640607, "question_id": 31332033, "link": "https://stackoverflow.com/questions/31332033/how-to-completly-remove-packages-installed-by-cabal/35640607#35640607", "title": "How to completly remove packages installed by cabal?", "body": "<p>You can delete the files yourself from the packages directory. However, the reason no command to do so is provided is there's in general no guarantee something may not have linked against them elsewhere, and so such deletions may cause breakages. That said, there's also a tool that goes and does the deletion for you if you <em>really</em> want it.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/cabal-uninstall\" rel=\"noreferrer\">http://hackage.haskell.org/package/cabal-uninstall</a></p>\n\n<p>And there's a tool with a bit more functionality that also lets you figure out what packages have no reverse deps, so at least no other <em>packages</em> break:</p>\n\n<p><a href=\"https://github.com/iquiw/cabal-delete\" rel=\"noreferrer\">https://github.com/iquiw/cabal-delete</a></p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10822, "favorite_count": 2, "answer_count": 1, "score": 17, "last_activity_date": 1456443564, "creation_date": 1436499345, "question_id": 31332033, "link": "https://stackoverflow.com/questions/31332033/how-to-completly-remove-packages-installed-by-cabal", "title": "How to completly remove packages installed by cabal?", "body": "<p>I am trying to learn cabal, and have tested several my own little projects, now I want to clean them up.</p>\n\n<p>Basically, if I am working without a <code>sandbox</code>, my workflow is:</p>\n\n<ol>\n<li>run <code>cabal init</code></li>\n<li>edit <code>src/Mylib.hs</code>, and then edit <code>mylibname.cabal</code> file</li>\n<li>run <code>cabal build</code></li>\n<li>run <code>cabal repl</code> and test my code</li>\n<li>run <code>cabal install</code></li>\n</ol>\n\n<p>Now, I see my own project:</p>\n\n<ol>\n<li>installed into <code>~/.cabal/lib/x86-64-linux-ghc-7.10.1</code></li>\n<li>registered in <code>~/.ghc/package.conf.d</code></li>\n</ol>\n\n<p>I can write <code>import Mylib</code> in my other haskell source code, so I think the package is successfully installed.</p>\n\n<p>Then I want to uninstall the package, as the package itself is just meaningless experiment code.</p>\n\n<p>I read <a href=\"https://wiki.haskell.org/Cabal-Install\">this</a> article, who says that:</p>\n\n<blockquote>\n  <p>There is no \"cabal uninstall\" command. You can only unregister\n  packages with ghc-pkg:</p>\n\n<pre><code> ghc-pkg unregister\n</code></pre>\n</blockquote>\n\n<p>so I run </p>\n\n<pre><code>ghc-pkg unregister mylibname \n</code></pre>\n\n<p>Now, it seems that the package is unregistered in <code>~/ghc/package.conf.d</code>, however, there is still a compiled library in  <code>~/.cabal/lib/x86-64-linux-ghc-7.10.1</code>.</p>\n\n<p>So, how could I completly remove my project, could I just <code>rm -rf</code> the library in <code>~/.cabal</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 153, "user_id": 3781722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/091f671580ceda99dc67e803d3e3bbd4?s=128&d=identicon&r=PG&f=1", "display_name": "ammoh", "link": "https://stackoverflow.com/users/3781722/ammoh"}, "edited": false, "score": 2, "creation_date": 1436488730, "post_id": 31330113, "comment_id": 50646819, "body": "I guess that MAIN means expressions which have no notations. My source code doesn&#39;t have no SCC notations and --library-profiling doesn&#39;t give ghc -fprof-auto option."}], "answers": [{"tags": [], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "is_accepted": false, "score": 1, "last_activity_date": 1440648656, "creation_date": 1440648656, "answer_id": 32240565, "question_id": 31330113, "link": "https://stackoverflow.com/questions/31330113/what-is-main-ghc-profiling/32240565#32240565", "title": "What is `MAIN` ? (ghc profiling)", "body": "<p>I was in the same spot a few days ago. What I deduced is the same thing, MAIN is expressions without anotations. It's counts shrink significantly if you add \"-fprof-auto\" and \"-caf-all\". Those options will also let you find a lot of interesting things happening in your code. </p>\n"}], "owner": {"reputation": 153, "user_id": 3781722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/091f671580ceda99dc67e803d3e3bbd4?s=128&d=identicon&r=PG&f=1", "display_name": "ammoh", "link": "https://stackoverflow.com/users/3781722/ammoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1440648656, "creation_date": 1436485014, "question_id": 31330113, "link": "https://stackoverflow.com/questions/31330113/what-is-main-ghc-profiling", "title": "What is `MAIN` ? (ghc profiling)", "body": "<p>I build an old big project, <a href=\"https://github.com/perl6/Pugs.hs\" rel=\"nofollow\">Pugs</a>, with ghc 7.10.1 using <code>stack build</code> (I wrote my own <code>stack.yaml</code>). Then I run <code>stack build --library-profiling --executable-profiling</code> and <code>.stack-work/install/x86_64-osx/nightly-2015-06-26/7.10.1/bin/pugs -e 'my $i=0; for (1..100_000) { $i++ }; say $i' +RTS -pa</code> and output the following <code>pugs.prof</code> file.</p>\n\n<pre><code>\n        Fri Jul 10 00:10 2015 Time and Allocation Profiling Report  (Final)\n\n           pugs +RTS -P -RTS -e my $i=0; for (1..10_000) { $i++ }; say $i\n\n        total time  =        0.60 secs   (604 ticks @ 1000 us, 1 processor)\n        total alloc = 426,495,472 bytes  (excludes profiling overheads)\n\nCOST CENTRE MODULE   %time %alloc  ticks     bytes\n\nMAIN        MAIN      92.2   90.6    557 386532168\nCAF         Pugs.Run   2.8    5.2     17  22191000\n\n\n                                                                                  individual     inherited\nCOST CENTRE                 MODULE                              no.     entries  %time %alloc   %time %alloc  ticks     bytes\n\nMAIN                        MAIN                                287           0   92.2   90.6   100.0  100.0    557 386532168\n listAssocOp                Pugs.Parser.Operator                841          24    0.0    0.0     0.0    0.0      0       768\n nassocOp                   Pugs.Parser.Operator                840          24    0.0    0.0     0.0    0.0      0       768\n lassocOp                   Pugs.Parser.Operator                839          24    0.0    0.0     0.0    0.0      0       768\n rassocOp                   Pugs.Parser.Operator                838          24    0.0    0.0     0.0    0.0      0       768\n postfixOp                  Pugs.Parser.Operator                837          24    0.0    0.0     0.0    0.0      0       768\n termOp                     Pugs.Parser.Operator                824          24    0.0    0.5     0.7    1.2      0   2062768\n  insert                    Data.HashTable.ST.Basic             874           1    0.0    0.0     0.0    0.0      0       152\n   checkOverflow            Data.HashTable.ST.Basic             890           1    0.0    0.0     0.0    0.0      0        80\n    readDelLoad             Data.HashTable.ST.Basic             893           0    0.0    0.0     0.0    0.0      0       184\n    writeLoad               Data.HashTable.ST.Basic             892           0    0.0    0.0     0.0    0.0      0       224\n    readLoad                Data.HashTable.ST.Basic             891           0    0.0    0.0     0.0    0.0      0       184\n   _values                  Data.HashTable.ST.Basic             889           1    0.0    0.0     0.0    0.0      0         0\n   _keys                    Data.HashTable.ST.Basic             888           1    0.0    0.0     0.0    0.0      0         0\n.. snip ..\n</code></pre>\n\n<p><code>MAIN</code> costs 92.2% of time, however, I don't know what <code>MAIN</code> means. What does <code>MAIN</code> label mean?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1436522507, "post_id": 31329907, "comment_id": 50660036, "body": "As a general note, Haskell almost <i>never</i> does any auto-conversion of anything. It&#39;s all manual. If something is an <code>Int</code> and you want a <code>Float</code>, <i>you</i> have to call something to do the conversion."}], "answers": [{"comments": [{"owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 1, "creation_date": 1436484699, "post_id": 31330007, "comment_id": 50645823, "body": "Wow I tried <code>fromIntegral</code> on everything but <code>r</code>. I don&#39;t understand this type system."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 0, "creation_date": 1436484837, "post_id": 31330007, "comment_id": 50645864, "body": "@Czipperz It&#39;s simple, with experience you will get intuition. In your case <code>d</code> already has a type of <code>Floating a</code> whereas <code>r</code> was still `Int. So, all you had to do was do the type conversion there."}, {"owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 0, "creation_date": 1436485262, "post_id": 31330007, "comment_id": 50645985, "body": "in every other language I&#39;ve programmed in, there has never been an error with upcasting. This seems outright strange to me."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 1, "creation_date": 1436487446, "post_id": 31330007, "comment_id": 50646538, "body": "@Czipperz: what does &quot;upcasting&quot; mean in Haskell?"}, {"owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436511438, "post_id": 31330007, "comment_id": 50653343, "body": "@ErikAllik in Haskell? I don&#39;t think it is a concept in Haskell. Upcasting means that you expand the memory used by a value to that of the thing it is being multiplied/added/subtracted/divided against."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1436526325, "post_id": 31330007, "comment_id": 50662430, "body": "but the cast from <code>int</code> to <code>float</code> isn&#39;t merely a question of expanding memory in the first place. and even if it were, Haskell wouldn&#39;t &quot;cast&quot; an <code>Int</code> to <code>Floating a =&gt; a</code> for you automatically, just as it wouldn&#39;t cast anything else ever (not even e.g. <code>Int</code> to <code>Integer</code>)."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1436534624, "post_id": 31330007, "comment_id": 50667845, "body": "One of the reasons you use haskell is that you know what type things are at all time, which rules out the possibility of converting a type to another automatically."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 7, "last_activity_date": 1436484285, "creation_date": 1436484285, "answer_id": 31330007, "question_id": 31329907, "link": "https://stackoverflow.com/questions/31329907/no-instance-for-floating-int-arising-from-a-use-of-sqrt/31330007#31330007", "title": "No instance for (Floating Int) arising from a use of `sqrt`", "body": "<p>Change the <code>Circ</code> handling code to this and it will typecheck:</p>\n\n<pre><code>inside (x,y) (Circ (xc,yc) r) =\n  let hd = fromIntegral $ xc - x\n      vd = fromIntegral $ yc - y\n      d = sqrt (hd*hd + vd*vd) in \n  if d &lt;= (fromIntegral r) then True else False\n</code></pre>\n\n<p>The type of <code>sqrt</code> is <code>sqrt :: Floating a =&gt; a -&gt; a</code> and you have to do proper type conversion using <code>fromIntegral</code> to make it typecheck.</p>\n"}], "owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4253, "favorite_count": 0, "accepted_answer_id": 31330007, "answer_count": 1, "score": 5, "last_activity_date": 1547308979, "creation_date": 1436483705, "last_edit_date": 1547308979, "question_id": 31329907, "link": "https://stackoverflow.com/questions/31329907/no-instance-for-floating-int-arising-from-a-use-of-sqrt", "title": "No instance for (Floating Int) arising from a use of `sqrt`", "body": "<p>I'm doing some basic work in Haskell and don't understand why this isn't compiling. Here's the error:</p>\n\n<pre><code>shapes.hs:35:11:\n    No instance for (Floating Int) arising from a use of `sqrt'\n    In the expression: sqrt (hd * hd + vd * vd)\n    In an equation for `d': d = sqrt (hd * hd + vd * vd)\n    In the expression:\n      let\n        hd = xc - x\n        vd = yc - y\n        d = sqrt (hd * hd + vd * vd)\n      in if d &lt;= r then True else False\n</code></pre>\n\n<p>Related code:</p>\n\n<pre><code>type Point = (Int,Int)\ndata Figure = Rect Point Point | Circ Point Int\ninside :: Point -&gt; Figure -&gt; Bool\ninside (x,y) (Rect (left,bot) (right,top)) =\n  if x &lt;= left &amp;&amp; x &gt;= right &amp;&amp;\n     y &lt;= bot &amp;&amp; y &gt;= top\n  then True\n  else False\ninside (x,y) (Circ (xc,yc) r) =\n  let hd = xc - x\n      vd = yc - y\n      d = sqrt (hd*hd + vd*vd) in -- line 35 is here\n  if d &lt;= r then True else False\n</code></pre>\n\n<p>The sqrt function's type is <code>Floating a =&gt; a -&gt; a -&gt; a</code>. Doesn't Num auto convert to Floating, or is this not the problem?</p>\n"}, {"tags": ["haskell", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1436461974, "creation_date": 1436461974, "answer_id": 31324107, "question_id": 31323990, "link": "https://stackoverflow.com/questions/31323990/source-database-for-testing-optimizer/31324107#31324107", "title": "source database for testing optimizer", "body": "<p>The suite used by GHC itself to measure its own optimization quality is called <code>nofib</code>, and is located at <a href=\"https://github.com/ghc/nofib\" rel=\"noreferrer\">https://github.com/ghc/nofib</a></p>\n\n<p>It's probably one of the best benchmark suites available for Haskell code.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 31324107, "answer_count": 1, "score": 2, "last_activity_date": 1436461974, "creation_date": 1436461552, "question_id": 31323990, "link": "https://stackoverflow.com/questions/31323990/source-database-for-testing-optimizer", "title": "source database for testing optimizer", "body": "<p>I need to test my haskell optimizer on a collection of source code, and I'm currently trying to run the optimizer on the packages tagged as <code>program</code> on hackage. However it is a pain in the neck to compile them (dependencies) and get them up running (inputs). </p>\n\n<p>Are there source code databases that contain programs easy to build and run? It would be even better if they have some code that uses strictness annotation to improve performance (since that's what my optimizer does). </p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1436521384, "post_id": 31321304, "comment_id": 50659274, "body": "Followed up by the usual <code>cabal install --only-dependencies</code> this seems to work. Thank you :)"}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": true, "score": 3, "last_activity_date": 1436454087, "creation_date": 1436454087, "answer_id": 31321304, "question_id": 31319424, "link": "https://stackoverflow.com/questions/31319424/is-it-possible-to-reinit-a-cabal-sandbox/31321304#31321304", "title": "Is it possible to reinit a cabal sandbox?", "body": "<p>Delete everything except <code>add-source-timestamps</code> and <code>packages/</code> in <code>.cabal-sandbox</code>.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 1, "accepted_answer_id": 31321304, "answer_count": 1, "score": 2, "last_activity_date": 1436454087, "creation_date": 1436449543, "question_id": 31319424, "link": "https://stackoverflow.com/questions/31319424/is-it-possible-to-reinit-a-cabal-sandbox", "title": "Is it possible to reinit a cabal sandbox?", "body": "<p>I find myself running the following commands often to \"reinit\" a sandbox to a clean state.</p>\n\n<pre><code>cabal sandbox delete\ncabal sandbox init\ncabal sandbox add-source Foo\ncabal sandbox add-source Bar\ncabal sandbox add-source Baz\n</code></pre>\n\n<p>Is there a way to make the sandbox \"remember\" the <code>add-sources</code> entries? Or is my approach just flawed? I most often run these commands because of \"cabal hell\" that is if cabal complains about misconfigured packages.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1436449535, "post_id": 31318755, "comment_id": 50625809, "body": "#1 is acceptable to me; #2 <code>cabal install &#47;home&#47;me&#47;mylib</code>"}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1436493924, "post_id": 31318755, "comment_id": 50648039, "body": "@josejuan is it so that if I run <code>cabal install</code> after <code>cabal sandbox init</code>, the package would be installed into current directory, while if no <code>sandbox</code> used, it would be intalled into <code>.cabal</code> and become a global package?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1436510859, "post_id": 31318755, "comment_id": 50653037, "body": "yep! if you are into some sandbox then you&#39;ll install into that sandbox if not, into global cabal packages :)  (have you seen <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack</a> ? although I recommend learn cabal way anyway)"}], "answers": [{"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 2, "last_activity_date": 1436471432, "creation_date": 1436471432, "answer_id": 31326945, "question_id": 31318755, "link": "https://stackoverflow.com/questions/31318755/what-is-the-common-workflow-of-using-cabal-for-personal-project/31326945#31326945", "title": "What is the common workflow of using cabal for personal project?", "body": "<p>I've never used <code>cabal sandbox</code> so I can't speak much to it.</p>\n\n<p><code>cabal build</code> compiles your source code into your <code>dist</code> directory.</p>\n\n<p><code>cabal install</code> takes your compiled source code and sends it to your <code>~/.cabal</code> directory, and registers it in your <code>~/.ghc</code> directory.  Now you can <code>import</code> it into other code just as you would any other library you've installed with cabal.</p>\n\n<p>In my personal projects, I use <code>cabal configure</code>, <code>cabal build</code>, <code>cabal repl</code>, and <code>cabal install</code>.  And <code>configure</code> is kind of optional.</p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1436471432, "creation_date": 1436448040, "question_id": 31318755, "link": "https://stackoverflow.com/questions/31318755/what-is-the-common-workflow-of-using-cabal-for-personal-project", "title": "What is the common workflow of using cabal for personal project?", "body": "<p>Assume I want to creat my own local library called <em>MyLib</em>, my workflow is:</p>\n\n<pre><code>$ cabal init\n# # edit the \".cabal\" file, set the \"exposed-modules\" as \"MyLib\"\n# # edit \"MyLib.hs\" located in \"src\"\n$ cabal sandbox init\n$ cabal install\n</code></pre>\n\n<p>So my question is</p>\n\n<ul>\n<li>is my workflow an acceptable one, or could it be better?</li>\n<li>now I have a compiled library in  <em>.cabal-sandbox/lib</em>, how could I use it or <code>import MyLib</code> from my another haskell project? It seems that packages downloaded from hackage through <code>cabal install</code> are stored in <em>~/.cabal</em>, while my own locally installed package is not there.</li>\n<li>what is the difference between <code>cabal build</code> and <code>cabal install</code>, it seems that after running <code>cabal build</code>, I could already run my lib through <code>cabal repl</code>, so what extra jobs does <code>cabal install</code> do?</li>\n</ul>\n"}, {"tags": ["haskell", "command-line-arguments", "applicative", "arrows", "optparse-applicative"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1436607706, "creation_date": 1436607706, "answer_id": 31355741, "question_id": 31318643, "link": "https://stackoverflow.com/questions/31318643/optparse-applicative-how-to-handle-no-arguments-situation-in-arrow-syntax/31355741#31355741", "title": "optparse-applicative: How to handle no-arguments situation in Arrow syntax", "body": "<p><code>A</code> in <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Arrows.html\" rel=\"nofollow\">https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Arrows.html</a> isn't <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Arrow.html#t:ArrowPlus\" rel=\"nofollow\">ArrowPlus</a>. I'm not sure if it can be (given that <code>f</code> is <code>Alternative</code>), but for now you have to use <code>Alternative</code> syntax:</p>\n\n<pre><code>subparser (command \"foo\" ... ...) &lt;|&gt; pure DefaultCommand\n</code></pre>\n"}], "owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 5, "answer_count": 1, "score": 4, "last_activity_date": 1505238457, "creation_date": 1436447781, "last_edit_date": 1505238457, "question_id": 31318643, "link": "https://stackoverflow.com/questions/31318643/optparse-applicative-how-to-handle-no-arguments-situation-in-arrow-syntax", "title": "optparse-applicative: How to handle no-arguments situation in Arrow syntax", "body": "<p>There is example: <a href=\"https://github.com/pcapriotti/optparse-applicative/blob/master/tests/Examples/Cabal.hs#L46-L62\" rel=\"nofollow\">https://github.com/pcapriotti/optparse-applicative/blob/master/tests/Examples/Cabal.hs#L46-L62</a></p>\n\n<pre><code>parser :: Parser Args\nparser = runA $ proc () -&gt; do\n  opts &lt;- asA commonOpts -&lt; ()\n  cmds &lt;- (asA . hsubparser)\n            ( command \"install\"\n              (info installParser\n                    (progDesc \"Installs a list of packages\"))\n           &lt;&gt; command \"update\"\n              (info updateParser\n                    (progDesc \"Updates list of known packages\"))\n           &lt;&gt; command \"configure\"\n              (info configureParser\n                    (progDesc \"Prepare to build the package\"))\n           &lt;&gt; command \"build\"\n              (info buildParser\n                    (progDesc \"Make this package ready for installation\")) ) -&lt; ()\n  A version &gt;&gt;&gt; A helper -&lt; Args opts cmds\n</code></pre>\n\n<p>...</p>\n\n<pre><code>pinfo :: ParserInfo Args\npinfo = info parser\n  ( progDesc \"An example modelled on cabal\" )\n\nmain :: IO ()\nmain = do\n  r &lt;- execParser pinfo\n  print r\n</code></pre>\n\n<p>So and by default when I don't use arguments it shows Usage info. I want to use case with no arguments, and also with one [Custom argument] (with custom one I'm getting error: <code>Invalid argument 'regreg'</code>)</p>\n\n<p>How can I handle empty and custom arguments here?</p>\n"}, {"tags": ["haskell", "ghc", "type-kinds", "constraint-kinds"], "answers": [{"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 29, "last_activity_date": 1436478025, "last_edit_date": 1495542369, "creation_date": 1436477253, "answer_id": 31328543, "question_id": 31317159, "link": "https://stackoverflow.com/questions/31317159/constraintkinds-explained-on-a-super-simple-example/31328543#31328543", "title": "ConstraintKinds explained on a super simple example", "body": "<p>Well, I'll mention two practical things it allows you to do:</p>\n\n<ol>\n<li>Parametrize a type by a type class constraint</li>\n<li>Write type classes that allow their instances to specify constraints that they need.</li>\n</ol>\n\n<p>Maybe it's best to illustrate this with an example.  One of the classic Haskell warts is that you cannot make a <code>Functor</code> instance for types that impose a class constraint on their type parameter; for example, the <code>Set</code> class in the <code>containers</code> library, which requires an <code>Ord</code> constraint on its elements.  The reason is that in \"vanilla\" Haskell, you'd have to have the constraint on the class itself:</p>\n\n<pre><code>class OrdFunctor f where\n    fmap :: Ord b =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>...but then this class only works for types that require specifically an <code>Ord</code> constraint.  Not a general solution!</p>\n\n<p>So what if we could take that class definition and abstract away the <code>Ord</code> constraint, allowing individual instances to say what constraint they require?  Well, <code>ConstraintKinds</code> plus <code>TypeFamilies</code> allow that:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, TypeFamilies, FlexibleInstances #-}\n\nimport Prelude hiding (Functor(..))\nimport GHC.Exts (Constraint)\nimport Data.Set (Set)\nimport qualified Data.Set as Set\n\n-- | A 'Functor' over types that satisfy some constraint.\nclass Functor f where\n   -- | The constraint on the allowed element types.  Each\n   -- instance gets to choose for itself what this is.\n   type Allowed f :: * -&gt; Constraint\n\n   fmap :: Allowed f b =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n\ninstance Functor Set where\n    -- | 'Set' gets to pick 'Ord' as the constraint.\n    type Allowed Set = Ord\n    fmap = Set.map\n\ninstance Functor [] where\n    -- | And `[]` can pick a different constraint than `Set` does.\n    type Allowed [] = NoConstraint\n    fmap = map\n\n-- | A dummy class that means \"no constraint.\"\nclass NoConstraint a where\n\n-- | All types are trivially instances of 'NoConstraint'.\ninstance NoConstraint a where\n</code></pre>\n\n<p>(Note that this isn't the only obstacle to making a <code>Functor</code> instance to <code>Set</code>; see <a href=\"https://www.reddit.com/r/haskell/comments/1njlqr/laws_for_the_eq_class/\" rel=\"noreferrer\">this discussion</a>.  Also, <a href=\"https://stackoverflow.com/a/29011341/1094403\">credit to this answer for the <code>NoConstraint</code> trick</a>.)</p>\n\n<p>This sort of solution hasn't been generally adopted just yet, though, because <code>ConstraintKinds</code> are still more or less a new feature.</p>\n\n<hr>\n\n<p>Another use of <code>ConstraintKinds</code> is to parametrize a type by a class constraint or class.  I'll reproduce <a href=\"https://gist.github.com/sacundim/8511f98d6173d8d46533\" rel=\"noreferrer\">this Haskell \"Shape Example\" code that I wrote</a>:</p>\n\n<pre><code>{-# LANGUAGE GADTs, ConstraintKinds, KindSignatures, DeriveDataTypeable #-}\n{-# LANGUAGE TypeOperators, ScopedTypeVariables, FlexibleInstances #-}\n\nmodule Shape where\n\nimport Control.Applicative ((&lt;$&gt;), (&lt;|&gt;))\nimport Data.Maybe (mapMaybe)\nimport Data.Typeable\nimport GHC.Exts (Constraint)\n\n-- | Generic, reflective, heterogeneous container for instances\n-- of a type class.\ndata Object (constraint :: * -&gt; Constraint) where\n    Obj :: (Typeable a, constraint a) =&gt; a -&gt; Object constraint\n           deriving Typeable\n\n-- | Downcast an 'Object' to any type that satisfies the relevant\n-- constraints.\ndowncast :: forall a constraint. (Typeable a, constraint a) =&gt;\n            Object constraint -&gt; Maybe a\ndowncast (Obj (value :: b)) = \n  case eqT :: Maybe (a :~: b) of\n    Just Refl -&gt; Just value\n    Nothing -&gt; Nothing\n</code></pre>\n\n<p>Here the parameter of the <code>Object</code> type is a type class (kind <code>* -&gt; Constraint</code>), so you can have types like <code>Object Shape</code> where <code>Shape</code> is a class:</p>\n\n<pre><code>class Shape shape where\n  getArea :: shape -&gt; Double\n\n-- Note how the 'Object' type is parametrized by 'Shape', a class \n-- constraint.  That's the sort of thing ConstraintKinds enables.\ninstance Shape (Object Shape) where\n    getArea (Obj o) = getArea o\n</code></pre>\n\n<p>What the <code>Object</code> type does is a combination of two features:</p>\n\n<ol>\n<li>An existential type (enabled here by <code>GADTs</code>), which allows us to store values of heterogeneous types inside the same <code>Object</code> type.</li>\n<li><code>ConstraintKinds</code>, which allows us to, instead of hardcoding <code>Object</code> to some specific set of class constraints, have the users of the <code>Object</code> type specify the constraint they want as a parameter to the <code>Object</code> type.</li>\n</ol>\n\n<p>And now with that we can not only make a heterogeneous list of <code>Shape</code> instances:</p>\n\n<pre><code>data Circle = Circle { radius :: Double }\n            deriving Typeable\n\ninstance Shape Circle where\n  getArea (Circle radius) = pi * radius^2\n\n\ndata Rectangle = Rectangle { height :: Double, width :: Double }\n               deriving Typeable\n\ninstance Shape Rectangle where\n  getArea (Rectangle height width) = height * width\n\nexampleData :: [Object Shape]\nexampleData = [Obj (Circle 1.5), Obj (Rectangle 2 3)]\n</code></pre>\n\n<p>...but thanks to the <code>Typeable</code> constraint in <code>Object</code> we can <strong>downcast</strong>: if we correctly guess the type contained inside an <code>Object</code>, we can recover that original type:</p>\n\n<pre><code>-- | For each 'Shape' in the list, try to cast it to a Circle.  If we\n-- succeed, then pass the result to a monomorphic function that \n-- demands a 'Circle'.  Evaluates to:\n--\n-- &gt;&gt;&gt; example\n-- [\"A Circle of radius 1.5\",\"A Shape with area 6.0\"]\nexample :: [String]\nexample = mapMaybe step exampleData\n  where step shape = describeCircle &lt;$&gt; (downcast shape)\n                 &lt;|&gt; Just (describeShape shape)\n\ndescribeCircle :: Circle -&gt; String\ndescribeCircle (Circle radius) = \"A Circle of radius \" ++ show radius\n\ndescribeShape :: Shape a =&gt; a -&gt; String\ndescribeShape shape = \"A Shape with area \" ++ show (getArea shape)\n</code></pre>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3929, "favorite_count": 11, "accepted_answer_id": 31328543, "answer_count": 1, "score": 22, "last_activity_date": 1494790844, "creation_date": 1436444005, "last_edit_date": 1494790844, "question_id": 31317159, "link": "https://stackoverflow.com/questions/31317159/constraintkinds-explained-on-a-super-simple-example", "title": "ConstraintKinds explained on a super simple example", "body": "<p>What is a <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#the-constraint-kind\" rel=\"noreferrer\">Constraint kind</a>?</p>\n\n<p>Why would someone use it (in practice)?  </p>\n\n<p>What is it good for? </p>\n\n<p>Could you give a simple code example to illustrate the answers to the previous two questions?</p>\n\n<p>Why is it used in <a href=\"https://github.com/ryantrinkle/reflex-todomvc/blob/develop/src/Reflex/TodoMVC.hs\" rel=\"noreferrer\">this</a> code for example?</p>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation", "fold"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1436444105, "post_id": 31317036, "comment_id": 50621548, "body": "I believe there is already more than one question about <code>foldl</code> vs <code>foldr</code> vs <code>foldl&#39;</code> etc. and  I believe they probably already answer everything you are asking. Try to search for them on SO and eventually, if they aren&#39;t satisfying, please link to them and state clearly what do they miss."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1436444430, "post_id": 31317036, "comment_id": 50621767, "body": "Thank you @Bakuriu for you suggestion, in my opinion, what they miss (which for me makes it clearer to understand), is the equivalence between the folds and the longer version functions, because it makes easier to see the patterns"}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1436455951, "post_id": 31317036, "comment_id": 50630802, "body": "Note: it&#39;s &#39;infinite lists&#39; not &#39;infinity lists&#39;."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1436473139, "post_id": 31317036, "comment_id": 50640959, "body": "I suggest that you define <code>inside recursion</code> and <code>outside recursion</code> more explicitly to receive a high quality answer"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437533560, "post_id": 31317036, "comment_id": 51064004, "body": "Late note (I had seen this question a while ago but forgot to comment): If I understood you well, a technical term for what you called &quot;outside recursion&quot; is &quot;tail recursive&quot;, though by now you likely have figured it out on your own. FWIW, a link to another highly-relevant question: <a href=\"http://stackoverflow.com/questions/3429634/foldl-is-tail-recursive-so-how-come-foldr-runs-faster-than-foldl\">foldl is tail recursive, so how come foldr runs faster than foldl?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1436545410, "post_id": 31335443, "comment_id": 50675196, "body": "I used <b>inside</b> and <b>outside</b> mainly because it is easier for me to imagine whether the recursive calls will happen inside (passed as argument to the given function), or the result of the given function will be used inside the recursion (outside) - Thank you for pointing out that <i>it&#39;s not in the standart literature</i> and for giving us more explanations about the whole subject."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 2, "last_activity_date": 1436516320, "last_edit_date": 1436516320, "creation_date": 1436515080, "answer_id": 31335443, "question_id": 31317036, "link": "https://stackoverflow.com/questions/31317036/are-these-premises-about-folds-and-recursion-right/31335443#31335443", "title": "Are these premises about folds and recursion right?", "body": "<p>Aside from the fact that foldr is the natural catamorphism of a list, while foldl and foldl' are not, a few guidelines for their use:</p>\n\n<ol>\n<li>you are correct on that foldr will always return, even on infinite lists, <em>as long as the function is non-strict in its second argument</em>, since the elements of the list are made available to the first argument of the function immediately (as opposed to foldl and foldl', where the elements of the list are not available to the first argument of the function until the list has been entirely consumed);</li>\n<li>foldl' will be a better choice for non-infinite lists if you want to ensure constant space, since it's tail recursive, but <em>it will always parse the entire list regardless of the strictness in the evaluation of the arguments to the function passed to it</em>;</li>\n<li>in general, foldr is equivalent to recursion, while foldl and foldl' are analogous to loops;</li>\n<li>because of the fact that foldr is the natural catamorphism, if your function needs to recreate the list (for example, if your function is just the list constructor ':'), foldr would be more adequate;</li>\n<li>with respect to foldl vs. foldl', foldl' is usually preferable because it will not build a huge thunk but, if the function passed to it is non strict in its first argument and the list is not infinite, foldl may return while foldl' may give an error (there is a good example in the <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow\">Haskell wiki</a>). </li>\n</ol>\n\n<p>As a side note, I believe that you are using the term \"inside recursion\" to define foldr and \"outside recursion\" for foldl and foldl', but I haven't seen these terms before in the literature. More commonly these functions are just referred to as folding from the right and folding from the left respectively, terms that while may not be exactly correct, they give a good notion of the order in which the elements of the list are passed to the function.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 1, "accepted_answer_id": 31335443, "answer_count": 1, "score": 1, "last_activity_date": 1436516320, "creation_date": 1436443686, "last_edit_date": 1495540704, "question_id": 31317036, "link": "https://stackoverflow.com/questions/31317036/are-these-premises-about-folds-and-recursion-right", "title": "Are these premises about folds and recursion right?", "body": "<p>When using <code>foldr</code>, the recursion occours inside the function, so,\nwhen the given function doesn't <em>strictly</em> evaluate both sides, and \ncan return based on the first one, <code>foldr</code> must be a good solution, \nbecause it will work on <strong>infinity lists</strong></p>\n\n<pre><code>findInt :: Int -&gt; [Int] -&gt; Bool\nfindInt z [] = False\n-- The recursion occours inside de given function\nfindInt z (x:xs) \n  | z == x = True\n  | otherwise = findInt z xs \n</code></pre>\n\n<p>equivalent to:</p>\n\n<pre><code>findInt' :: Int -&gt; [Int] -&gt; Bool\nfindInt' z = foldr (\\x r -&gt; if z == x then True else r) False\n-- Where False is the \"default value\" (when it finds [], ex: findInt z [] = False) \n</code></pre>\n\n<p>A situation when <code>foldr</code> is not appropriate:</p>\n\n<pre><code>addAll :: Int -&gt; [Int] -&gt; Int\naddAll z [] = z\n-- The recursion occours outside the given function (+)\naddAll z (x:xs) = addAll (z + x) xs \n</code></pre>\n\n<p>In this case, because + is strict (needs to evaluate both sides to return)\nit would be greately useful if we applied it in some way which we could\nhave a <strong>redex</strong> <em>(reducible expression)</em>, to make it possible to avoid thunks\nand (<em>when forced to run with previous evaluation, not lazy</em>) in constant\nspace and without pushing to much onto the stack \n<em>(similar to the advantages of a for loop in imperative algorithms)</em></p>\n\n<pre><code>addAll' :: Int -&gt; [Int] -&gt; Int\naddAll' z [] = z\naddAll' z (x:xs) = let z' = z + x\n                  in seq z' $ addAll' z' xs\n</code></pre>\n\n<p>equivalent to:</p>\n\n<pre><code>addAll'' :: Int -&gt; [Int] -&gt; Int\naddAll'' z = foldl' (+) z\n</code></pre>\n\n<p>In this little case, using foldr (inside recursion) doesn't make sense\nbecause it wouldn't make redexes.\nIt would be like this:</p>\n\n<pre><code>addAll''' :: Int -&gt; [Int] -&gt; Int\naddAll''' z [] = z\naddAll''' z (x:xs) = (+) x $ addAll''' z xs\n</code></pre>\n\n<p>The main objective of this question is first, <em>know whether my premises are \nright</em> or where they <em>could be better</em> and second, help to <em>make it more clear \nfor others</em> who are also learning <strong>Haskell</strong> the <strong>differences between inside and \noutside recursion</strong>, among the approaches, to have it clear in mind which one \ncould be more appropriated to a given situation</p>\n\n<p>Helpful links: </p>\n\n<p><a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\">Haskell Wiki</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/384797/implications-of-foldr-vs-foldl-or-foldl\">Stackoverflow - Implications of foldr vs. foldl (or foldl')</a></p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1436440797, "creation_date": 1436440797, "answer_id": 31315917, "question_id": 31314477, "link": "https://stackoverflow.com/questions/31314477/define-type-synonym-using-a-specific-class/31315917#31315917", "title": "Define type synonym using a specific class", "body": "<p>So first off, <code>type</code> in Haskell does not declare a new type. <code>type</code> is strictly a type alias, and what you're asking for at a minimum requires an actual new type of the kind you get with <code>data</code> or <code>newtype</code>.</p>\n\n<p>Now, that being said what you want can't completely be done in haskell - that is, you can't say \"Anytime you see <code>Edge l</code>, there's an implicit constraint on <code>l</code> that says <code>(Label l)</code>\".</p>\n\n<p>What you <em>can</em> do, with the <code>GADTs</code> language extension, is require that any time an <code>Edge</code> is constructed, the type it's constructed with meets the restriction <code>(Label l)</code>. You do that like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nclass (Eq l, Show l) =&gt; Label l -- assume there might be some `where ...`\n\ndata Edge l where\n  Edge :: (Label l) =&gt; (Int, l, Int) -&gt; Edge l\n\ntype Graph l = [Edge l]  -- does not implicitly provide a (Label l)\n                         -- constraint on the type, but any actual object\n                         -- will necessarily meet that type\n\ninstance Show (Edge l) where\n  show (Edge a) = \"Edge \" ++ show a\n\naddEdge :: Graph l -&gt; Edge l -&gt; Graph l\naddEdge g e = e : g\n\ndata MyLabel = A | B | C deriving (Eq, Show)\ninstance Label MyLabel\n\nmain :: IO ()\nmain = do\n    print $ addEdge [] $ Edge (1, A, 2) -- producing Graph MyLabel\n--    print $ addEdge [] $ Edge (1, 3, 2) -- not passing type checks\n</code></pre>\n\n<p>Note that I had to add an instance for <code>Show (Edge l)</code> - if you need them, you'll need to manually make instances for <code>Eq</code> and <code>Ord</code> too.</p>\n\n<p>Now, what I said above about this providing a constraint on the constructor but not the type: let's imagine that there's a method added to <code>Label l</code> like this:</p>\n\n<pre><code>class (Eq l, Show l) =&gt; Label l where\n  defLabel :: l\n</code></pre>\n\n<p>With the instance declaration for <code>Label MyLabel</code> modified to say:</p>\n\n<pre><code>instance Label MyLabel where\n  defLabel = A\n</code></pre>\n\n<p>Then if you tried to write this method, it wouldn't work:</p>\n\n<pre><code>newGraph :: Int -&gt; Graph l  -- won't work with this type\nnewGraph n = zipWith (\\f t -&gt; Edge (f, defLabel, t)) [1..n-1] [2..]\n</code></pre>\n\n<p>Instead, you'd need to add the <code>(Label l)</code> constraint as:</p>\n\n<pre><code>newGraph :: (Label l) =&gt; Int -&gt; Graph l  -- works with this type\nnewGraph n = zipWith (\\f t -&gt; Edge (f, defLabel, t)) [1..n-1] [2..]\n</code></pre>\n\n<p>However, if you're dealing only with already constructed <code>Edge</code>s, you can rely on an implicit <code>(Label l)</code> being used when the <code>Edge</code> was constructed. For example, this compiles:</p>\n\n<pre><code>isAllDefault :: Graph l -&gt; Bool  -- Look, no Label constraint\nisAllDefault [] = True\nisAllDefault (Edge (_, l, _):gs) = l == defLabel &amp;&amp; isAllDefault gs\n                        -- but I can still use defLabel here\n                        -- and can rely on (Eq l) from the Label definition\n</code></pre>\n\n<hr>\n\n<p>Style note: Most people would write the <code>Edge</code> constructor as:</p>\n\n<pre><code>  Edge :: (Label l) =&gt; Int -&gt; l -&gt; Int -&gt; Edge l\n</code></pre>\n\n<p>so that you'd then invoke it as <code>Edge 2 A 1</code>. I chose to use a tuple to make some code above that wasn't the main point of this answer shorter, but as a matter of general Haskell style you should know that tuples as input types are frowned upon.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "accepted_answer_id": 31315917, "answer_count": 1, "score": 2, "last_activity_date": 1436440797, "creation_date": 1436436775, "question_id": 31314477, "link": "https://stackoverflow.com/questions/31314477/define-type-synonym-using-a-specific-class", "title": "Define type synonym using a specific class", "body": "<p>I'm still sometime lost in syntax of Haskell but this time I am not sure it is possible to do what I am trying to do.</p>\n\n<p>What I would like to have is</p>\n\n<pre><code>import System.IO\n\nclass (Eq l, Show l) =&gt; Label l -- assume there might be some `where ...`\n\ntype Edge l = Label l =&gt; (Int, l, Int) -- my attempt on restricting l to be Label\ntype Graph l = [Edge l] -- inherently requiring l to be Label\n\naddEdge :: Graph l -&gt; Edge l -&gt; Graph l\naddEdge g e = e : g\n\ndata MyLabel = A | B | C deriving (Eq, Show)\ninstance Label MyLabel\n\nmain :: IO ()\nmain = do\n    putStrLn $ show $ addEdge [] (1, A, 2) -- producing Graph MyLabel\n    putStrLn $ show $ addEdge [] (1, 3, 2) -- not passing type checks\n</code></pre>\n\n<p>What I could do, is add the <code>Label l =&gt;</code> contexts to all functions like <code>addEdge</code> but that would still allow instances of <code>Graph</code> with labels not conforming to the class <code>Label</code> and it would also duplicate the constraints. On the other hand, having the constraint in the type (somehow) would save a lot of work (there could never simply be any instance of <code>Edge</code>/<code>Graph</code> without the proper label type).</p>\n\n<p>Can I somehow do it in Haskell?</p>\n"}, {"tags": ["haskell", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436462873, "post_id": 31323697, "comment_id": 50635146, "body": "Thanks, Michael. I have updated my question with the snippet that seems to be working."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 1, "creation_date": 1436475979, "post_id": 31323697, "comment_id": 50642529, "body": "Cool. Have a look at <code>Control.Exception.Lifted</code> from <code>lifted-base</code> for a way forward on catching that exception."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1436478132, "post_id": 31323697, "comment_id": 50643593, "body": "Thanks. Will do. I am also trying to figure out how to use <code>EitherT</code> so I can actually return error messages for each failure, not just my validation errors. This way I can keep my validation code pure and avoid checking for uniqueness within it. I may have a question if I cannot make it work though :)"}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1437069589, "post_id": 31323697, "comment_id": 50889303, "body": "In case someone comes here looking for something like this.  @AndrewThaddeusMartin suggested I use <code>transactionUndo</code> in <code>Database.Persist.Sql</code>  and that makes my code much nicer and not have to deal with Exceptions."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1436460638, "creation_date": 1436460638, "answer_id": 31323697, "question_id": 31310736, "link": "https://stackoverflow.com/questions/31310736/maybet-and-transactions-in-rundb/31323697#31323697", "title": "MaybeT and Transactions in runDb", "body": "<p>Returning <code>Nothing</code> is not the same thing as a failure. You'd need to throw a runtime exception (via something like <code>throwIO</code>) for Persistent to treat it as a rollback situation.</p>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 2, "accepted_answer_id": 31323697, "answer_count": 1, "score": 4, "last_activity_date": 1436462978, "creation_date": 1436426681, "last_edit_date": 1436462978, "question_id": 31310736, "link": "https://stackoverflow.com/questions/31310736/maybet-and-transactions-in-rundb", "title": "MaybeT and Transactions in runDb", "body": "<p>For my previous question on chaining failures, Michael Snoyman had suggested I use <code>MaybeT</code> to run them so if any of them fails, it will just short-circuit to <code>Nothing</code>. </p>\n\n<p>I was under the impression <code>runDb</code> runs everything in a transaction. So shouldn't a failure at any point in code automatically rollback the transaction?</p>\n\n<pre><code>mauth &lt;- runDb $ runMaybeT $ do\n            valid    &lt;- MaybeT $ return $ listToMaybe errs \n            uid      &lt;- MaybeT $ insertUnique u \n            vid     &lt;- MaybeT $ getBy $ UniqueField v -- this step fails but previous insert does not roll back\n            auth     &lt;- liftIO $ createAuthToken uid\n            return auth\n</code></pre>\n\n<p>When I run the above code, the <code>getBy</code> fails but user was still inserted. Am I misunderstanding that <code>runDb</code> will rollback on a <code>Nothing</code> inside <code>MaybeT</code>? Do I need to use some other Monad for this to work? </p>\n\n<p>Appreciate your thoughts on how to best rollback on failure.</p>\n\n<p><strong>Update</strong>: \nThis is what I ended up doing per Michael's suggestion. </p>\n\n<pre><code>mauth &lt;- runDb $ do\n          ma &lt;- runMaybeT $ do\n                   valid &lt;- ... \n          case ma of\n            Just _ -&gt; return ma\n            Nothing -&gt; liftIO $ throwIO MyException\n</code></pre>\n\n<p>Now I need to figure out how to catch this exception nicely outside and return a proper error message back.</p>\n\n<p>Thanks!  </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 0, "creation_date": 1436482801, "post_id": 31310636, "comment_id": 50645240, "body": "This is a pain in the ass."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 0, "creation_date": 1436514326, "post_id": 31310636, "comment_id": 50655047, "body": "What, that you need <code>fromIntegral</code> or that you should write type signatures? Signatures have a number of big benefits, foremostly they make your code easier to understand because you first learn what the functions deals with, and very broadly its purpose, before being heaped with implementation details. \u2014 Regarding <code>fromIntegral</code>: you wouldn&#39;t need it if <code>Point</code> didn&#39;t use integers for the coordinates. On an integral space, shapes like circles don&#39;t really make sense, so it&#39;s quite reasonable that you first need to explicitly embed them into a continuous space."}, {"owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "edited": false, "score": 0, "creation_date": 1436515222, "post_id": 31310636, "comment_id": 50655555, "body": "No no, type signatures are great, what I meant was that in every other language I&#39;ve used it doesn&#39;t need explicit conversion from <code>Int</code> to <code>Double</code> but it does need explicit conversion the other way around. (Assuming <code>Num</code> is like a Double)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1436426868, "last_edit_date": 1495541165, "creation_date": 1436426391, "answer_id": 31310636, "question_id": 31310213, "link": "https://stackoverflow.com/questions/31310213/no-instance-for-fractional-int-in-expression-pi-r-r/31310636#31310636", "title": "No instance for (Fractional Int) in expression `pi * r&#39; * r&#39;`", "body": "<p><a href=\"https://stackoverflow.com/tags/haskell/info\">Always use type signatures</a>. In this case, you evidently want the result to be <code>Double</code>. Once you make that explicit, the compiler error will become perfectly clear to understand.</p>\n\n<hr>\n\n<p>The reason the error is not clear to understand at the moment is this: from the first clause</p>\n\n<pre><code>area (Rect (x1,y1) (x2,y2)) = (x2 - x1) * (y1 - y2)\n</code></pre>\n\n<p>the compiler infers that the result of <code>area</code> has the type of <code>(x2 - x1) * (y1 - y2)</code>, which is the same type as <code>x\u2c7c</code> and <code>y\u2c7c</code> themselves: <code>Int</code>. When the compiler then checks the second clause it finds <code>fromIntegral'</code>. That can produce any number type, including <code>Int</code>, so no problem here. The multiplication is thus inferred to be integral too. But that means <code>pi</code> needs to be <code>Int</code> as well, which is obviously nonsense!</p>\n\n<p>With the correct signature,</p>\n\n<pre><code>area :: Figure -&gt; Double\n</code></pre>\n\n<p>the compiler will stop right at the first clause, complaining correctly that <code>Int</code> doesn't match <code>Double</code>. You need another <code>fromIntegral</code> here.</p>\n"}, {"tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": false, "score": 5, "last_activity_date": 1436426699, "creation_date": 1436426699, "answer_id": 31310743, "question_id": 31310213, "link": "https://stackoverflow.com/questions/31310213/no-instance-for-fractional-int-in-expression-pi-r-r/31310743#31310743", "title": "No instance for (Fractional Int) in expression `pi * r&#39; * r&#39;`", "body": "<h1>The Problem</h1>\n\n<p>The first equation of your function has as return type <code>Int</code>, but the second equation has a return type of <code>Floating a =&gt; a</code>. Now the compiler tries to unify the <code>a</code> with <code>Int</code>, but <code>Int</code> is not an instance of <code>Floating</code> (as the compiler tells you), so the compailation fails with a type error.</p>\n\n<h1>Why ghci accepts it.</h1>\n\n<p>When you type those lines into ghci, it does not treat the second equation for <code>area</code> as extension to the function defintion, but instead overwrites it.\nSo if you try to use <code>area</code> in ghci with a <code>Rect</code> it will fail.</p>\n"}, {"tags": [], "owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "is_accepted": false, "score": 5, "last_activity_date": 1436427424, "creation_date": 1436427424, "answer_id": 31310998, "question_id": 31310213, "link": "https://stackoverflow.com/questions/31310213/no-instance-for-fractional-int-in-expression-pi-r-r/31310998#31310998", "title": "No instance for (Fractional Int) in expression `pi * r&#39; * r&#39;`", "body": "<p>You're not getting the error in ghci because you're overwriting your definition of <code>area</code> for <code>Rect</code>.</p>\n\n<p>If you do it this way, you'll get the error:</p>\n\n<pre><code>let area (Rect (x1,y1) (x2,y2)) = (x2 - x1) * (y1 - y2); area (Circ _ r) = pi * r'^2 where r' = fromIntegral r\n</code></pre>\n\n<p>And here's your code (with <code>-Wall</code> enabled):</p>\n\n<pre><code>Prelude&gt; :set -Wall\nPrelude&gt; type Point = (Int, Int)\nPrelude&gt; data Figure = Rect Point Point | Circ Point Int\nPrelude&gt; let area (Rect (x1,y1) (x2,y2)) = (x2 - x1) * (y1 - y2)\n\n&lt;interactive&gt;:5:5: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018area\u2019: Patterns not matched: Circ _ _\nPrelude&gt; let area (Circ _ r) = pi * r'^2 where r' = fromIntegral r\n\n&lt;interactive&gt;:6:5: Warning:\n    This binding for \u2018area\u2019 shadows the existing binding\n      defined at &lt;interactive&gt;:5:5\n\n&lt;interactive&gt;:6:5: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018area\u2019: Patterns not matched: Rect _ _\n\n&lt;interactive&gt;:6:30: Warning:\n    Defaulting the following constraint(s) to type \u2018Integer\u2019\n      (Integral b0) arising from a use of \u2018^\u2019 at &lt;interactive&gt;:6:30\n      (Num b0) arising from the literal \u20182\u2019 at &lt;interactive&gt;:6:31\n    In the second argument of \u2018(*)\u2019, namely \u2018r' ^ 2\u2019\n    In the expression: pi * r' ^ 2\n    In an equation for \u2018area\u2019:\n        area (Circ _ r)\n          = pi * r' ^ 2\n          where\n              r' = fromIntegral r\n</code></pre>\n\n<p>In general, it's always a good idea to use <code>-Wall</code>.</p>\n"}], "owner": {"reputation": 3046, "user_id": 1692584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b95bf73cfe4dc84cf414371aabb825?s=128&d=identicon&r=PG", "display_name": "Czipperz", "link": "https://stackoverflow.com/users/1692584/czipperz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 31310636, "answer_count": 3, "score": 2, "last_activity_date": 1436427424, "creation_date": 1436425048, "question_id": 31310213, "link": "https://stackoverflow.com/questions/31310213/no-instance-for-fractional-int-in-expression-pi-r-r", "title": "No instance for (Fractional Int) in expression `pi * r&#39; * r&#39;`", "body": "<p>I'm trying to make a very simple area program:</p>\n\n<pre><code>type Point = (Int, Int)\ndata Figure = Rect Point Point | Circ Point Int\narea (Rect (x1,y1) (x2,y2)) = (x2 - x1) * (y1 - y2)\narea (Circ _ r) = pi * r'^2 where r' = fromIntegral r\n</code></pre>\n\n<p>When I type this manually into <code>ghci</code>, it has no errors and works as expected.</p>\n\n<p>However, compiling this program yeilds the following error:</p>\n\n<pre><code>No instance for (Floating Int) arising from a use of `pi'\nIn the first argument of `(*)', namely `pi'\nIn the expression: pi * r' ^ 2\nIn an equation for `area':\n    area (Circ _ r)\n      = pi * r' ^ 2\n      where\n          r' = fromIntegral r\n</code></pre>\n\n<p>What's going on here?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "state-monad"], "comments": [{"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1436419106, "post_id": 31308180, "comment_id": 50606130, "body": "Though not exactly the same, have you looked at <a href=\"http://stackoverflow.com/questions/3270255/is-haskells-mapm-not-lazy\" title=\"is haskells mapm not lazy\">stackoverflow.com/questions/3270255/is-haskells-mapm-not-laz&zwnj;&#8203;y</a> ?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1436426221, "post_id": 31310364, "comment_id": 50609632, "body": "I think this could be a valid argument, but you still need to show that an infinite <code>do</code> chain can&#39;t just be skipped lazily, like many other things in Haskell."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436426831, "post_id": 31310364, "comment_id": 50610022, "body": "Yes - there are monads where an do infinite chain does not have to be completely evaluated - e.g. the Maybe monad."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1436427089, "post_id": 31310364, "comment_id": 50610176, "body": "so, why is the argument valid for <code>State</code> then?"}, {"owner": {"reputation": 31, "user_id": 4312135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/946fe5321278ef33e0bb5ef303c9543b?s=128&d=identicon&r=PG&f=1", "display_name": "rohansumant", "link": "https://stackoverflow.com/users/4312135/rohansumant"}, "edited": false, "score": 0, "creation_date": 1438843787, "post_id": 31310364, "comment_id": 51618006, "body": "Okay this being said, is there any way that a queue could be implemented via some other monad? Could the desired laziness be enforced via some other monad?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1438853211, "post_id": 31310364, "comment_id": 51623758, "body": "Just remove the <code>mapM_ push [1..]</code> from <code>queueManip</code> and run your computation with <code>runState queueManip [1..]</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1436430009, "last_edit_date": 1436430009, "creation_date": 1436425548, "answer_id": 31310364, "question_id": 31308180, "link": "https://stackoverflow.com/questions/31308180/why-does-this-haskell-code-not-terminate/31310364#31310364", "title": "Why does this haskell code not terminate", "body": "<p>Note that <code>do mapM_ push [1..3]; something</code> is the same as:</p>\n\n<pre><code>do push 1; push 2; push 3; something\n</code></pre>\n\n<p>so that should explain why</p>\n\n<pre><code>do mapM_ push [1..]; something\n</code></pre>\n\n<p>never gets around to executing <code>something</code>.</p>\n\n<p>If you look at the definition of the State monad:</p>\n\n<pre><code>type State s a = s -&gt; (a, s)\n\ninstance Monad (State s) where\n  return a = \\s -&gt; (a,s)\n  m &gt;&gt;= g = wpAB\n    where\n      wpAB = \\s1 -&gt; let (v2, s2) = m s1\n                        (v3, s3) = g v2 s2\n                    in (v3, s3)\n\n-- (newtypes and such have been removed to declutter the code)\n</code></pre>\n\n<p>you see that the value of <code>m &gt;&gt;= g</code> always depends on <code>g</code>. Contrast that with the definition of <code>Maybe</code> monad:</p>\n\n<pre><code>instance Monad Maybe where\n    return x = Just x\n    (&gt;&gt;=) m g = case m of\n                  Nothing -&gt; Nothing\n                  Just x  -&gt; g x\n</code></pre>\n\n<p>where <code>m &gt;&gt;= g</code> can be independent of <code>g</code> which explains how the <code>Maybe</code> monad can short-circuit a do-chain.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1436429320, "last_edit_date": 1436429320, "creation_date": 1436425970, "answer_id": 31310494, "question_id": 31308180, "link": "https://stackoverflow.com/questions/31308180/why-does-this-haskell-code-not-terminate/31310494#31310494", "title": "Why does this haskell code not terminate", "body": "<p>What if I'm evil and use</p>\n\n<pre><code>push' :: Int -&gt; State (Queue Int) ()\npush' 1052602983 = state $ \\_ -&gt; ((), []) -- \"Muarhar!\"\npush' x = state $ \\xs -&gt; ((),xs++[x])\n</code></pre>\n\n<p>Then <code>mapM push' [1..]</code> should clearly render the state as <code>[1052602983, 1052602984 ..]</code>. It would be wrong for <code>pop</code> to yield <code>1</code>. But <code>mapM</code> can't possibly know this, without first evaluating a billion other numbers. Actually pushing them to the state is irrelevant here, and it also doesn't matter that <code>push</code> could be completely lazy: <code>mapM</code> at least has to give it a <em>chance</em> to check any given number, before handing on the monadic program flow.</p>\n"}], "owner": {"reputation": 31, "user_id": 4312135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/946fe5321278ef33e0bb5ef303c9543b?s=128&d=identicon&r=PG&f=1", "display_name": "rohansumant", "link": "https://stackoverflow.com/users/4312135/rohansumant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1436430009, "creation_date": 1436416324, "last_edit_date": 1436418626, "question_id": 31308180, "link": "https://stackoverflow.com/questions/31308180/why-does-this-haskell-code-not-terminate", "title": "Why does this haskell code not terminate", "body": "<pre><code>import Control.Monad.State.Lazy\n\ntype Queue a = [a]\n\npush :: a -&gt; State (Queue a) ()\npush x = state (\\xs -&gt; ((),xs++[x]))\n\npop :: State (Queue a) a\npop = state (\\(x:xs) -&gt; (x,xs))\n\nqueueManip :: State (Queue Int) Int\nqueueManip =\n  do\n    mapM_ push [1..]\n    a &lt;- pop\n    return a\n\nmain :: IO()\nmain = do\n  let (a,_) = runState queueManip []\n  print a\n</code></pre>\n\n<p>Shouldn't the <code>mapM_</code> be lazy ? Besides for implementing a queue shouldn't the complexity be <code>O(1)</code>?  </p>\n\n<p>Because the append <code>(++)</code> itself is lazy ...</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1436420012, "post_id": 31307960, "comment_id": 50606482, "body": "Sorry, I believe I worded my question poorly and I&#39;ve reworded it now.  I understand higher rank types of the form for <code>test2</code> in my original example.  But you didn&#39;t address the way the type in <code>test1</code> works, which is where my confusion is."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1436420443, "post_id": 31307960, "comment_id": 50606660, "body": "@MikeIzbicki I&#39;m almost positive that, in <code>test1</code>, there is actually an implicit <code>forall x.</code> inside of the parentheses, shadowing the original <code>x</code> and making it equivalent to <code>test2</code>. Note that <code>(Show x =&gt; x) -&gt; String</code> (without an explicit <code>forall</code>) has the same behavior and also requires <code>RankNTypes</code>."}, {"owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1436422909, "post_id": 31307960, "comment_id": 50607727, "body": "This can&#39;t be the case because <code>test1 a = show (a :: Char)</code> does not compile."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "edited": false, "score": 0, "creation_date": 1436481136, "post_id": 31307960, "comment_id": 50644672, "body": "@MikeIzbicki Oops, you&#39;re right. Andr&#225;s Kov&#225;cs explained that nicely."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 2, "last_activity_date": 1436415286, "last_edit_date": 1436415286, "creation_date": 1436414952, "answer_id": 31307960, "question_id": 31307731, "link": "https://stackoverflow.com/questions/31307731/constraints-within-rankntypes/31307960#31307960", "title": "Constraints within RankNTypes", "body": "<p>It's not that you don't have access to it, it's that the control over type instantiation is reversed: using a rank-2 type, you change who gets to pick the type.</p>\n\n<p>In your example, the <code>test2</code> function gets to pick the type of its argument. So, for instance, this compiles:</p>\n\n<pre><code>test2 :: (forall x. Show x =&gt; x) -&gt; String\ntest2 a = show (a :: Char)\n</code></pre>\n\n<p>This is because the argument <code>a</code> must literally work <em>for all</em> types that are an instance of <code>Show</code>. As a result, we can never call <code>test2</code> since we can never provide a value that can take on all possible types that are instances of <code>Show</code>.</p>\n\n<p>Note that had we written</p>\n\n<pre><code>test2 :: Show x =&gt; x -&gt; String\ntest2 a = ...\n</code></pre>\n\n<p>The <em>caller</em> of <code>test2</code> gets to pick the type of <code>a</code> and <code>test2</code> is the one that must work for all instances of <code>Show</code>.</p>\n\n<p>Lets look at a slightly more useful example:</p>\n\n<pre><code>example :: (forall x. Show x =&gt; x -&gt; Int) -&gt; Int\nexample f = 10 * f True\n</code></pre>\n\n<p>We can see that, again, we (that is, <code>example</code>) get to pick the type represented by the <code>x</code> type variable (it <em>instantiates</em> that type variable to a certain type). Here, we are picking the type <code>Bool</code>. Here is how you might call this function:</p>\n\n<pre><code>ghci&gt; example (length . show)\n40\n</code></pre>\n\n<p>Here's another example:</p>\n\n<pre><code>example2 :: (forall x. [x] -&gt; [x]) -&gt; [Int]\nexample2 f = f [1, 2, 3]\n</code></pre>\n\n<p>We can give it any function on lists <em>as long as</em> that function cannot care about the actual values in that list. Since the function doesn't know the type of those values, it can't inspect them in any way (this property is called <a href=\"http://bartoszmilewski.com/2014/09/22/parametricity-money-for-nothing-and-theorems-for-free/\" rel=\"nofollow\">parametricity</a>).</p>\n\n<p>So, we can do something like this:</p>\n\n<pre><code>ghci&gt; example2 reverse\n[3,2,1]\n</code></pre>\n\n<p>... but not something like this:</p>\n\n<pre><code>ghci&gt; let addOne :: Int -&gt; Int\n   |&gt;     addOne a = a + 1\n   |&gt; \nghci&gt; example2 (map addOne)\n\n&lt;interactive&gt;:33:15:\n    Couldn't match type \u2018x\u2019 with \u2018Int\u2019\n      \u2018x\u2019 is a rigid type variable bound by\n          a type expected by the context: [x] -&gt; [x] at &lt;interactive&gt;:33:1\n    Expected type: x -&gt; x\n      Actual type: Int -&gt; Int\n    In the first argument of \u2018map\u2019, namely \u2018addOne\u2019\n    In the first argument of \u2018example2\u2019, namely \u2018(map addOne)\u2019\n</code></pre>\n\n<p>As far as practical utility goes, rank-n types are used extensively in (for instance) the <code>lens</code> library. This allows you to express the idea that a function uses a <code>Functor</code> instance without knowing which specific <code>Functor</code> instance it is (that is, it just uses <code>fmap</code> on it). Because of that, when you pass it around, you can give it any <code>Functor</code> instance you like.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1436433189, "last_edit_date": 1436433189, "creation_date": 1436428108, "answer_id": 31311212, "question_id": 31307731, "link": "https://stackoverflow.com/questions/31307731/constraints-within-rankntypes/31311212#31311212", "title": "Constraints within RankNTypes", "body": "<p>It's useful to think of class constraints as inferred function arguments, as they desugar to functions and function application in GHC Core. </p>\n\n<p>Let's desugar the type in question:</p>\n\n<pre><code>newtype ShowDict a = ShowDict (a -&gt; String)\ntest1 :: forall x. (ShowDict x -&gt; x) -&gt; String\n</code></pre>\n\n<p>Or more simply:</p>\n\n<pre><code>test1 :: forall x. ((x -&gt; String) -&gt; x) -&gt; String\n</code></pre>\n\n<p>This type isn't really useful. By parametricity, its implementations must be constant functions returning some string.</p>\n\n<p>With the original non-desugared type, we can't even do anything with the <code>(Show x =&gt; x)</code> argument, since there isn't any <code>Show</code> dictionary around for our universally quantified <code>x</code>.</p>\n\n<blockquote>\n  <p>So my question is: Is there ever a case where we it's useful to have\n  constraints in a type signature that the final -> doesn't have access\n  to?</p>\n</blockquote>\n\n<p>This is a bit vaguely phrased, but I can argue the following: function argument types of the form <code>(c x =&gt; t)</code> (with <code>x</code> possibly quantified in an outer scope) never make sense in Haskell. </p>\n\n<p>Class coherence implies that there is at most a single instance for each type, therefore abstracting over <code>c x</code> makes no computational difference whatsoever. If there is no <code>c x</code>, then the (desugared) function can never be applied, but if we already know there is a unique <code>c x</code>, then why depend on it?</p>\n"}], "owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "accepted_answer_id": 31311212, "answer_count": 2, "score": 4, "last_activity_date": 1436433189, "creation_date": 1436413289, "last_edit_date": 1436419936, "question_id": 31307731, "link": "https://stackoverflow.com/questions/31307731/constraints-within-rankntypes", "title": "Constraints within RankNTypes", "body": "<p>The function below doesn't type check.</p>\n\n<pre><code>test1 :: forall x. (Show x =&gt; x) -&gt; String\ntest1 = show\n</code></pre>\n\n<p>This is because the last <code>-&gt;</code> doesn't have access to the constraint.  (This probably isn't the proper terminology, but hopefully it makes sense.)  I've been trying to find a use for type signatures similar to the above where the final <code>-&gt;</code> doesn't have access to the constraint.  But I can't think of any examples.</p>\n\n<p>So my question is: Is there ever a case where we it's useful to have constraints in a type signature that the final <code>-&gt;</code> doesn't have access to?</p>\n\n<hr>\n\n<p>Notice that <code>test1</code> is different than the rank 2 function below.</p>\n\n<pre><code>test2 :: (forall x. Show x =&gt; x) -&gt; String\ntest2 = show\n</code></pre>\n\n<p>I'm interested in the the first case, not this case.  The reason <code>RankNTypes</code> is in the title is because that extension needs to be enabled to create the type signature for <code>test1</code>.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 0, "creation_date": 1436414406, "post_id": 31307845, "comment_id": 50604751, "body": "Seems to work. I&#39;m having trouble fixing the expression. I might make another question for that"}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": true, "score": 6, "last_activity_date": 1436414110, "creation_date": 1436414110, "answer_id": 31307845, "question_id": 31307713, "link": "https://stackoverflow.com/questions/31307713/equation-has-different-number-of-arguments/31307845#31307845", "title": "Equation has different number of arguments", "body": "<p>The second instance needs more parentheses:</p>\n\n<pre><code>instance Show Chord where\n  show (EmptyChord a) = init $ take (a * 2) ['-', '\\n' ..]\n  show (Chord (x : xs)) = x : '\\n' : show xs\n</code></pre>\n"}], "owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4051, "favorite_count": 1, "accepted_answer_id": 31307845, "answer_count": 1, "score": 2, "last_activity_date": 1518513672, "creation_date": 1436413187, "last_edit_date": 1518513672, "question_id": 31307713, "link": "https://stackoverflow.com/questions/31307713/equation-has-different-number-of-arguments", "title": "Equation has different number of arguments", "body": "<p>I made these data types to represent guitar tabs and I'm trying to write the <code>show</code> function to print them as real guitar tabs. <code>data</code>s are not my specialty and I'm having trouble matching up the types.</p>\n\n<p>The error is</p>\n\n<blockquote>\n  <p>Equations for `show' have different numbers of arguments\n      In the instance declaration for GHC.Show.Show Tabs.Chord'</p>\n</blockquote>\n\n<p>The code:</p>\n\n<pre><code>type Strings = Int\n\ndata Fret = None | Note Int\n\ninstance Show Fret where\n  show None = \"-\"\n  show (Note a) = show a\n\ndata Chord = EmptyChord Strings | Chord [Fret]\n\ninstance Show Chord where\n  show EmptyChord a = init $ take (a * 2) ['-', '\\n' ..]\n  show Chord (x : xs) = x : '\\n' : show xs\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "state-machine", "robotics", "control-theory"], "comments": [{"owner": {"reputation": 4642, "user_id": 1709762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4353b60aa07056fb7b915e32d21f249?s=128&d=identicon&r=PG", "display_name": "itsbruce", "link": "https://stackoverflow.com/users/1709762/itsbruce"}, "edited": false, "score": 0, "creation_date": 1436437910, "post_id": 31306798, "comment_id": 50617432, "body": "Most interesting question I&#39;ve seen here in quite some time.  Will follow with great interest."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1436494904, "post_id": 31306798, "comment_id": 50648275, "body": "Something like <a href=\"https://hackage.haskell.org/package/atom\" rel=\"nofollow noreferrer\">Atom</a>, maybe?"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1436495494, "post_id": 31306798, "comment_id": 50648427, "body": "Yes and no, @Cactus . Implementation in terms of Atom or something like it might be desirable to provide timeliness guarantees in addition to correctness guarantees, but up one or two levels of abstraction how can we structure systems so that in addition to doing the correct thing they can tell us what they are doing, why they are doing it, and what they plan on doing next? How can we modularly support predicting the future?"}], "answers": [{"comments": [{"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1436837607, "post_id": 31372009, "comment_id": 50768318, "body": "Very interesting. They seem to be tackling a lot of problems in verification that I would have thought impossible. These problems don&#39;t trouble me so much as a hobbyist, but they are certainly interesting when I wear my industrial controls hat. I have lots of new reading to do and a new reason to learn about theorem provers. Thanks. :)"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "edited": false, "score": 0, "creation_date": 1436838101, "post_id": 31372009, "comment_id": 50768434, "body": "Also should note that this tackles the much more difficult problem of statically predicting some things about all futures. Suspect the existence of simpler strategies for dynamically predicting some things about some futures with a particle filter. Agree that the self-description problem is to some degree inherently complicated, or to put it another way, may require program structure that isn&#39;t the most natural one arising when programs must only convey their dynamic semantics and not the reasons behind them. At the very least you need a grammar with certain required &quot;comments&quot;."}], "tags": [], "owner": {"reputation": 517, "user_id": 865792, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4d5cb3205c92a7148447bf81a4748b10?s=128&d=identicon&r=PG", "display_name": "user_48349383", "link": "https://stackoverflow.com/users/865792/user-48349383"}, "is_accepted": false, "score": 1, "last_activity_date": 1436731347, "creation_date": 1436731347, "answer_id": 31372009, "question_id": 31306798, "link": "https://stackoverflow.com/questions/31306798/functional-approaches-to-designing-the-discrete-side-of-hybrid-systems/31372009#31372009", "title": "Functional approaches to designing the discrete side of hybrid systems", "body": "<p>Okay, so I would say the \"real\" answer to your question is that some of things that you are asking for are open areas of research --- in particular I think some of the self-describing features you desire may necessitate some degree of \"spaghetti\" simply because the problem you are trying to solve is inherently complicated. </p>\n\n<p>That being said, your focus on modularity is exactly the right approach. I would say, take a look at <a href=\"http://symbolaris.com/info/KeYmaera.html\" rel=\"nofollow\">Keymaera</a> as I believe it has the features you are looking for despite being in Java. I would also recommend looking at the publications page on the Keymaera website as this should provide you valuable insight to the problem in general.</p>\n\n<p>If you do not like Keymaera's approach you can also look into using Timed Automata which is another direction modeling-wise that should be sufficient for your problem description.</p>\n"}], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 5, "answer_count": 1, "score": 7, "last_activity_date": 1436731347, "creation_date": 1436406681, "question_id": 31306798, "link": "https://stackoverflow.com/questions/31306798/functional-approaches-to-designing-the-discrete-side-of-hybrid-systems", "title": "Functional approaches to designing the discrete side of hybrid systems", "body": "<p>I'm working on developing controllers for hybrid systems in Haskell.</p>\n\n<p>FRP libraries (right now I'm using <a href=\"http://hackage.haskell.org/package/netwire\" rel=\"noreferrer\">netwire</a>, but there are several good ones and a lot of interesting research on future ones) provide a great solution for the continuous-time side of the problem. Augmenting them with signal names, dimensions, preferred units, and so forth gets you a system that has modularity, is self-describing, and has a straightforward path to confidence in correctness.</p>\n\n<p>I'm looking for information, folklore, or papers that provide similar properties for the discrete-time side. In some sense the problem is much easier, state machines are well-studied and simple. In other senses it's more difficult, I'll briefly explain how.</p>\n\n<p>Correctness is obviously the most important thing, and thankfully it's also straightforward.</p>\n\n<p>Self-description is more of a problem. You'd like the controller not just to be in the correct state, but to be capable of telling you what state it's in. Also how it got there. And where it might go next. So you can tack names on to everything, and it works, but it conflicts somewhat with modularity. You'd also like to be able to build complex discrete time behaviors from simpler ones. But when you ask the system what state it's in, generally the high-level answer is more interesting (or at least, as interesting) as the low level answer. How do you get this cleanly? I've tried a few naive approaches and have wrapped myself in spaghetti a few different ways, but it seems like there must be elegant solutions?</p>\n\n<p>Another problem I've had with self-description is that I'd like to have a list of self-describing conditions (generally comparisons: has it been 10 seconds? am I within 3 feet of the next waypoint? has the battery power fallen below 15%? etc) that are being monitored which might trigger the next state transition. There are tricky questions of what even are the desirable semantics here, since it seems like some of these events are better handled \"from the bottom up\" (e.g. expected termination conditions of whatever low level step you are performing) and some \"from the top down\" (e.g. equipment failure detection, geofencing, ...). This can lead to spaghetti of its own even if you relax the goal of self-description.</p>\n\n<p>In addition to diagnostics, accurate self-description information here could also be very useful for abstract interpretation, projecting the state of the system into the future by guessing which events are likely to occur when. Many of the event conditions lead themselves to fairly simple guesses (e.g. using velocity made good, fuel consumption rate, timers). Others are more complicated but might still be worth the effort to develop projections for some applications (e.g. expected orders from operators, weather forecasts, projected tracks for moving objects of interest). It would be nice to find a design that annotates conditions not only with names, but also with functions for this sort of stuff.</p>\n\n<p>Does anyone have experience with this that they are willing to share?</p>\n"}, {"tags": ["haskell", "coq"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 5, "creation_date": 1436405991, "post_id": 31306654, "comment_id": 50602714, "body": "Somewhat relevant: you can definitely go <a href=\"http://stackoverflow.com/questions/13334863/can-i-extract-a-coq-proof-as-a-haskell-function\">the other direction</a>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1436410672, "post_id": 31306654, "comment_id": 50603830, "body": "This isn&#39;t an answer to the question, but you might also be interested in HERMIT. It is a toolkit for proving theorems about Haskell code (among other things). If you do decide to check it out I would suggest looking at HERMIT-shell, which is the new (and currently under active development) shell for the system. Full disclosure: I work on HERMIT and HERMIT-shell as part of my job."}, {"owner": {"reputation": 811, "user_id": 2400640, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2fbdcc76241f68e4ad67520072f477d6?s=128&d=identicon&r=PG", "display_name": "xywang", "link": "https://stackoverflow.com/users/2400640/xywang"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1436410915, "post_id": 31306654, "comment_id": 50603890, "body": "@DavidYoung Can HERMIT help to prove arbitrary property or just optimized code equivalence? The short introduction seems to indicate the latter one."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1436411343, "post_id": 31306654, "comment_id": 50603977, "body": "@xywang You can use it to prove properties of a Haskell program, too. There are examples of this in the examples/laws directory. Here is the HERMIT-shell version: <a href=\"https://github.com/ku-fpg/hermit-shell/tree/master/examples/laws\" rel=\"nofollow noreferrer\">github.com/ku-fpg/hermit-shell/tree/master/examples/laws</a>. The Haskell file &quot;under scrutiny&quot; here is <code>ListLaws.hs</code> and the other files are HERMIT-shell script files (also written in Haskell, using the HERMIT-shell DSL) that prove theorems about the code in the <code>ListLaws.hs</code> file. The GHC <code>RULES</code> get turned into lemmas, which can then be proven."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1436495373, "post_id": 31306654, "comment_id": 50648388, "body": "<a href=\"https://github.com/jwiegley/coq-haskell\" rel=\"nofollow noreferrer\">coq-haskell</a> might also be relevant"}, {"owner": {"reputation": 4636, "user_id": 931925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48de4c7e6e37c23feb7a43e6ec3fdff9?s=128&d=identicon&r=PG", "display_name": "minopret", "link": "https://stackoverflow.com/users/931925/minopret"}, "edited": false, "score": 5, "creation_date": 1493391234, "post_id": 31306654, "comment_id": 74412257, "body": "Perhaps this belongs at softwarerecs.stackexchange.com - New info about it though, Antal Spector-Zabusky posted software project <a href=\"https://github.com/antalsz/ha-to-coq\" rel=\"nofollow noreferrer\">hs-to-coq</a> &quot;in fairly good shape&quot;, funded under a grant NSF 1521602 <a href=\"http://DeepSpec.org\" rel=\"nofollow noreferrer\">&quot;DeepSpec&quot;</a> with principal investigator Andrew Appel at Princeton University."}], "answers": [{"comments": [{"owner": {"reputation": 25686, "user_id": 975097, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dbbc1b2bc18739858cfa3b7ddcba7362?s=128&d=identicon&r=PG", "display_name": "Anderson Green", "link": "https://stackoverflow.com/users/975097/anderson-green"}, "edited": false, "score": 1, "creation_date": 1549580708, "post_id": 31423142, "comment_id": 95964286, "body": "There is a paper that describes a method for <a href=\"https://www.cis.upenn.edu/~criz/publications/hs_to_coq.pdf\" rel=\"nofollow noreferrer\">converting &quot;total functional programs&quot;</a> from Haskell into Coq."}], "tags": [], "owner": {"reputation": 5765, "user_id": 341499, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/39cad3119923abe9ac6eeb7b5e3dfb6b?s=128&d=identicon&r=PG&f=1", "display_name": "Vinz", "link": "https://stackoverflow.com/users/341499/vinz"}, "is_accepted": true, "score": 5, "last_activity_date": 1436942363, "creation_date": 1436942363, "answer_id": 31423142, "question_id": 31306654, "link": "https://stackoverflow.com/questions/31306654/is-there-a-translator-from-haskell-to-coq/31423142#31423142", "title": "Is there a translator from Haskell to Coq?", "body": "<p>The main issue I see in such a translation is that Haskell programs (as well as Ocaml ones) can perform any kind of recursion algorithm, and might contain loops.</p>\n\n<p>In Coq, there is no build-in notion of loops, and any recursive function <em>has</em> to terminate, and be explicit why it terminates.</p>\n\n<p>To the best of my knowledge, there is no such tool at the moment.</p>\n"}], "owner": {"reputation": 811, "user_id": 2400640, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2fbdcc76241f68e4ad67520072f477d6?s=128&d=identicon&r=PG", "display_name": "xywang", "link": "https://stackoverflow.com/users/2400640/xywang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 1, "closed_date": 1493390189, "accepted_answer_id": 31423142, "answer_count": 1, "score": 4, "last_activity_date": 1493388904, "creation_date": 1436405533, "last_edit_date": 1436432817, "question_id": 31306654, "link": "https://stackoverflow.com/questions/31306654/is-there-a-translator-from-haskell-to-coq", "closed_reason": "Not suitable for this site", "title": "Is there a translator from Haskell to Coq?", "body": "<p>If I want to write proofs and algorithms/semantics using Coq on a Haskell program. How can I translate from Haskell to Coq to do this?</p>\n\n<p>It seems that there are tools to translate OCaml programs. But how about Haskell?</p>\n"}, {"tags": ["linux", "macos", "haskell", "libraries", "dynamic-linking"], "owner": {"reputation": 163, "user_id": 5075794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1567b434ed6dfd5fe053b7280f659e01?s=128&d=identicon&r=PG&f=1", "display_name": "chalkandpaste", "link": "https://stackoverflow.com/users/5075794/chalkandpaste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1436401202, "creation_date": 1436401202, "question_id": 31306089, "link": "https://stackoverflow.com/questions/31306089/linking-a-dynamic-haskell-library-missing-symbols", "title": "Linking a Dynamic Haskell Library, Missing Symbols", "body": "<p>I've got a bit of an issue. I've been working on linking some Rust code I'm developing with some heavy-lifting algorithms that have been written in Haskell. I have gotten cargo to play nicely with ghc and cabal, and have my code working the the Fibonacci test and now I'm trying to get everything properly linked with my algorithms in Haskell. </p>\n\n<p>The problem: Everything seems to generate correctly, but when running, I'm missing a symbol: <code>_attoparseczm0zi13zi0zi0_DataziAttoparsecziByteStringziBuffer_Buf_con_info</code></p>\n\n<p>I tracked down the symbol to part of the haskell-platform package installed, but then, when I try to compile with:</p>\n\n<pre><code>ghc -o target/debug/build/shroudbase-algorithms-c299ade0066a2dda/out/libshroudbase.so -shared -dynamic -fPIC dist/build/Shroudbase/C.o cbits/wrapper.o -lHSrts -lffi -lHSattoparsec-0.13.0.0 -L.cabal-sandbox/lib/x86_64-osx-ghc-7.8.4/attoparsec-0.13.0.0`\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>ld: illegal text-relocation to '_base_DataziEither_Left_con_info' in /Applications/ghc-7.8.4.app/Contents/lib/ghc-7.8.4/base-4.7.0.2/libHSbase-4.7.0.2-ghc7.8.4.dylib from '_c3uyl_info' in .cabal-sandbox/lib/x86_64-osx-ghc-7.8.4/attoparsec-0.13.0.0/libHSattoparsec-0.13.0.0.a(Lazy.o) for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>I can't seem to get the right libraries to link to get main body of Rust code running with the included dynamic library.</p>\n\n<p>Let me know if I can give additional information.</p>\n\n<p>EDIT1: previous information can be found <a href=\"https://stackoverflow.com/questions/31196449/calling-dynamically-linked-haskell-code-from-rust\">here</a></p>\n"}]