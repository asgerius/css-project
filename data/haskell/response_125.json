[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 12426, "user_id": 570682, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f9d9bb1af07214310ce8bd601760492a?s=128&d=identicon&r=PG", "display_name": "Lambdageek", "link": "https://stackoverflow.com/users/570682/lambdageek"}, "edited": false, "score": 1, "creation_date": 1496265897, "post_id": 44294860, "comment_id": 75596110, "body": "Are you up for changing the definition of your datatype?  (e.g. can you change to <code>data Asdf = One (TrivialEq Char) | Two Char Char</code> where <code>TrivialEq a</code> is a newtype that always returns <code>True</code> for <code>(==)</code>?)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1496265914, "post_id": 44294860, "comment_id": 75596117, "body": "Related: <a href=\"https://stackoverflow.com/questions/28665917/accessing-the-default-show-in-haskell\" title=\"accessing the default show in haskell\">stackoverflow.com/questions/28665917/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496266408, "post_id": 44294860, "comment_id": 75596308, "body": "Perhaps there&#39;s some Template Haskell library that can define the method of the default instance under a different binding. I&#39;m not aware of it, though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1496266634, "post_id": 44294860, "comment_id": 75596396, "body": "I&#39;m not sure if writing an <code>Eq</code> instance that disagrees with &quot;observational&quot; equality is wrong per se but it doesn&#39;t exactly feel right."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1496284108, "post_id": 44294860, "comment_id": 75600968, "body": "@ReinHenrichs, it&#39;s definitely not <i>inherently</i> wrong. For example, most interesting data structures admit multiple representations of most abstract values. There are also structures that cache redundant information that <code>Eq</code> needn&#39;t consider. It&#39;s a bit shadier, but still common, to define an <code>Eq</code> instance that ignores information that&#39;s <i>almost never</i> important. For example, a language implementation will often decree two expressions equal if they are alpha-equivalent, even if it would print them differently."}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 2, "creation_date": 1496299916, "post_id": 44295315, "comment_id": 75606067, "body": "It can also be enhanced with pattern synonyms to avoid having to match <code>A (E x)</code> everywhere."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 8, "last_activity_date": 1496267928, "creation_date": 1496267928, "answer_id": 44295315, "question_id": 44294860, "link": "https://stackoverflow.com/questions/44294860/overriding-default-eq-definition-for-specific-pattern/44295315#44295315", "title": "overriding default Eq definition for specific pattern", "body": "<p>To do what you're trying to do, you have to define it yourself, and that means you have to define it for every pattern.</p>\n\n\n\n<p>Basically <code>data MyType x = A x | B x x deriving (Eq)</code> will add a default derivation equivalent to,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Eq x =&gt; Eq (MyType x) where\n    A x1    == A x2     = x1 == x2\n    B x1 x2 == B x3 x4  = x1 == x3 &amp;&amp; x2 == x4\n    _       == _        = False\n</code></pre>\n\n<p>Note that it figures out the necessary dependencies (the <code>Eq x =&gt;</code> part above) as well as fills in the diagonal cases -- the special cases among the <em>n</em><sup>2</sup> possible matches where the same constructor was used.</p>\n\n<p>As far as I know, it does this definition all-at-once and there is no way to dig into an existing instance declaration to mess with it -- and there is a good reason for this; if they let you do this then that would mean that as codebases grow, you could not look at an instance derivation or a <code>deriving (Eq)</code> clause and be confident that you know exactly what it means, since some other part of the code might monkey-patch that <code>Eq</code> instance to do something nefarious.</p>\n\n<p>So one way is to redefine the diagonal yourself. But <em>that's not the only way</em>. There is at least one alternative which may work if it's easier to modify several usage sites than to shove all <em>n</em> constructors into a single thing:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype EverythingIsEqual x = E x deriving (Show)\ninstance Eq (EverythingIsEqual x) where\n    _ == _ = True\n\ndata MyType x = A (EverythingIsEqual x) | B x x deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>This <code>newtype</code> allows you to strategically modify certain terms to have a different <code>Eq</code> relation at no runtime cost -- in fact this is pretty much one of the two central arguments for newtypes; aside from the lesser one where \"I want to have a type-level difference between these two Strings but they ARE just strings and I don't want to pay any performance penalty,\" there is the greater argument of \"sometimes we want to tell Haskell to use a different <code>Ord</code> dictionary without messing with any of the values that this dictionary acts upon, we just want to swap out the functions.\"</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 5, "last_activity_date": 1496286794, "creation_date": 1496286794, "answer_id": 44297881, "question_id": 44294860, "link": "https://stackoverflow.com/questions/44294860/overriding-default-eq-definition-for-specific-pattern/44297881#44297881", "title": "overriding default Eq definition for specific pattern", "body": "<p>This question discusses how to do something very similar for the <code>Show</code> instance, using the <a href=\"https://hackage.haskell.org/package/generic-deriving\" rel=\"noreferrer\">https://hackage.haskell.org/package/generic-deriving</a> package: <a href=\"https://stackoverflow.com/questions/28665917/accessing-the-default-show-in-haskell\">Accessing the &quot;default show&quot; in Haskell?</a></p>\n\n<p>See this answer in particular: <a href=\"https://stackoverflow.com/a/35385768/936310\">https://stackoverflow.com/a/35385768/936310</a></p>\n\n<p>I recently used it for the <code>Show</code> instance recently, and it worked wonderfully. You can similarly derive <code>Eq</code> as well for your type, assuming it's regular enough.</p>\n"}], "owner": {"reputation": 464, "user_id": 5803067, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24c214b5a2bb45dabb3122be0dfef109?s=128&d=identicon&r=PG", "display_name": "Aneesh Durg", "link": "https://stackoverflow.com/users/5803067/aneesh-durg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 1, "accepted_answer_id": 44297881, "answer_count": 2, "score": 4, "last_activity_date": 1496286794, "creation_date": 1496265638, "question_id": 44294860, "link": "https://stackoverflow.com/questions/44294860/overriding-default-eq-definition-for-specific-pattern", "title": "overriding default Eq definition for specific pattern", "body": "<p>Suppose I have defined some data type that derives Eq but want to insert my own definition of (==) for some pattern. Is there any way to do this or do I have to define (==) for every pattern?</p>\n\n<p>e.g. </p>\n\n<pre><code>data Asdf = One Char | Two Char Char --(deriving Eq)\ninstance Eq Asdf where\n  (==) (One _) (One _) = True\n  --otherwise use what the derived definition would have done\n  --can I do this without defining these patterns myself?\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 719, "user_id": 893959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Y5izK.jpg?s=128&g=1", "display_name": "Adam Hammes", "link": "https://stackoverflow.com/users/893959/adam-hammes"}, "is_accepted": true, "score": 16, "last_activity_date": 1496249298, "last_edit_date": 1496249298, "creation_date": 1496248445, "answer_id": 44290219, "question_id": 44290218, "link": "https://stackoverflow.com/questions/44290218/how-do-you-remove-accents-from-a-string-in-haskell/44290219#44290219", "title": "How do you remove accents from a string in Haskell?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/text-icu-0.7.0.1/docs/Data-Text-ICU.html\" rel=\"noreferrer\"><code>text-icu</code></a> library contains a variety of Unicode utilities. We will also need the <a href=\"https://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html\" rel=\"noreferrer\"><code>text</code></a> library in order to convert our <code>String</code>s to <code>Text</code>. I installed them by adding the following two lines to <code>build-depends</code> in my cabal file:</p>\n\n<pre><code>build-depends:     --- other packages...\n                   , text-icu &gt;= 0.7.0.1 &amp;&amp; &lt; 1\n                   , text\n</code></pre>\n\n<p>With those dependencies installed, we can remove accents with the following process:</p>\n\n<ol>\n<li>Convert the input <code>String</code> to <code>Text</code></li>\n<li>Normalize the input (see the <a href=\"https://hackage.haskell.org/package/text-icu-0.7.0.1/docs/Data-Text-ICU-Normalize.html\" rel=\"noreferrer\">documentation</a> for why this is necessary)</li>\n<li>Filter out the accents</li>\n<li>Convert back to <code>String</code>.</li>\n</ol>\n\n<p>Keeping all that in mind, we come up with the following function:</p>\n\n<pre><code>import Data.List\nimport qualified Data.Text as T\nimport Data.Text.ICU.Char\nimport Data.Text.ICU.Normalize\n\ncanonicalForm :: String -&gt; String\ncanonicalForm s = T.unpack noAccents\n  where\n    noAccents = T.filter (not . property Diacritic) normalizedText\n    normalizedText = normalize NFD (T.pack s)\n</code></pre>\n\n<p>If you don't need to convert from a <code>String</code>, you can skip the <code>T.pack</code> and <code>T.unpack</code> calls.</p>\n"}], "owner": {"reputation": 719, "user_id": 893959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Y5izK.jpg?s=128&g=1", "display_name": "Adam Hammes", "link": "https://stackoverflow.com/users/893959/adam-hammes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 1, "accepted_answer_id": 44290219, "answer_count": 1, "score": 10, "last_activity_date": 1496249298, "creation_date": 1496248445, "last_edit_date": 1496249280, "question_id": 44290218, "link": "https://stackoverflow.com/questions/44290218/how-do-you-remove-accents-from-a-string-in-haskell", "title": "How do you remove accents from a string in Haskell?", "body": "<p>I would like a function to remove accents from a string. Example input/output:</p>\n\n<pre><code>regard\u00e9 -&gt; regarde\nf\u00eate    -&gt; fete\n</code></pre>\n"}, {"tags": ["haskell", "xml-conduit"], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 0, "last_activity_date": 1496246924, "creation_date": 1496246924, "answer_id": 44289697, "question_id": 44289549, "link": "https://stackoverflow.com/questions/44289549/select-nodes-matching-one-of-several-conditions-or/44289697#44289697", "title": "Select nodes matching one of several conditions (OR)", "body": "<p>There's <code>checkElement</code> which accepts a predicate.</p>\n\n<pre><code>checkElement :: Boolean b =&gt; (Element -&gt; b) -&gt; Axis\n</code></pre>\n\n<p>So with that, and knowing that your <code>extract</code> is an <code>Axis</code><sup>1</sup>:</p>\n\n<pre><code>extract :: Axis\nextract = checkElement yourPredicate\n  where\n    yourPredicate (Element name _ _) = any (== name) [\"p\", \"h1\"]`\n</code></pre>\n\n<p>Adding the class check should be easy then; match the 2nd element from <code>Element</code> constructor, look for the <code>class</code> attribute, then inspect its value for <code>myclass</code> presence.</p>\n\n<hr>\n\n<p><sup>1</sup> <a href=\"https://hackage.haskell.org/package/xml-conduit-1.5.1/docs/Text-XML-Cursor.html#Axis\" rel=\"nofollow noreferrer\"><code>type Axis = Cursor -&gt; [Cursor]</code></a></p>\n"}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496246924, "creation_date": 1496246509, "question_id": 44289549, "link": "https://stackoverflow.com/questions/44289549/select-nodes-matching-one-of-several-conditions-or", "title": "Select nodes matching one of several conditions (OR)", "body": "<p>Using <code>Text.XML.Cursor</code>, is there a convenient way of selecting nodes matching one of <em>several</em> conditions (like an <code>or</code> function)? </p>\n\n<p>How can I get the cursors of all <code>&lt;p class=\"myclass\"&gt;</code> <strong>and</strong> <code>&lt;h1&gt;</code> nodes (in the right order) in the following example?</p>\n\n<pre><code>&lt;div&gt;\n    &lt;p&gt;&lt;/p&gt;\n    &lt;div&gt;&lt;/div&gt;\n    &lt;h1&gt;&lt;/h1&gt;\n    &lt;hr&gt;\n    &lt;p class=\"myclass\"&gt;&lt;/p&gt;\n    &lt;h1&gt;&lt;/h1&gt;\n&lt;/div&gt;\n\nextract :: Cursor -&gt; [Cursor]\n-- Returns 3 cursors [h1, p, h1]\n</code></pre>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "lazy-evaluation"], "comments": [{"owner": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "edited": false, "score": 0, "creation_date": 1496247032, "post_id": 44289542, "comment_id": 75586105, "body": "I&#39;d love some explanation of all these shorthand variable names"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1496247090, "post_id": 44289542, "comment_id": 75586134, "body": "<code>join</code> should be <code>tx =&gt; Lazy(tx())</code>"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1496247158, "post_id": 44289542, "comment_id": 75586169, "body": "This looks a lot like the Continuation monad - but harder to thread data thru the computation"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "edited": false, "score": 0, "creation_date": 1496247394, "post_id": 44289542, "comment_id": 75586296, "body": "@evolutionxbox Which specifically? <code>t</code> probably stands for thunk, <code>f</code> for function, and <code>x</code> is just an x."}, {"owner": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496247439, "post_id": 44289542, "comment_id": 75586332, "body": "@Bergi so tx is &quot;thunk of x&quot; and tf is &quot;thunk function&quot;?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "edited": false, "score": 0, "creation_date": 1496247503, "post_id": 44289542, "comment_id": 75586368, "body": "@evolutionxbox exactly. Or with &quot;for&quot; as joiner."}, {"owner": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496247579, "post_id": 44289542, "comment_id": 75586417, "body": "@Bergi and <code>() -&gt; a</code> is a function signature?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "edited": false, "score": 1, "creation_date": 1496247992, "post_id": 44289542, "comment_id": 75586663, "body": "@evolutionxbox <code>tx</code> = fancy type, <code>ft</code> = function that returns a fancy type, fancy type = a type that represents a context with a value (the context of <code>Lazy</code> is lazy evaluation and thunks respectively. <code>() -&gt; a</code> is the signature of a thunk, at least in Javascript)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1496248432, "post_id": 44289542, "comment_id": 75586930, "body": "@naomik exactly, great that you saw it too (<code>Lazy.join</code>)!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496278600, "post_id": 44289542, "comment_id": 75599759, "body": "I don&#39;t know if this is helpful, but I like to think in &quot;reverse&quot; from it seems like how you are.  Not &quot;can laziness be implemented by a monad?&quot; but &quot;is this thunk type I made which models laziness a monad? / what algebraic structure does it have?&quot;  Start with the type and discover the structure."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1496279976, "post_id": 44289542, "comment_id": 75600036, "body": "I think a lot of your type signatures would make more sense if you used <code>Lazy a</code> instead of <code>(() -&gt; a)</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496308324, "post_id": 44289542, "comment_id": 75611728, "body": "@luqui This kind of implicit knowledge is frequently very helpful, thanks. I guess I&#39;ve committed the common mistake (of a rookie) of trying to wrap each effect into a monad."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496248094, "post_id": 44289681, "comment_id": 75586720, "body": "Ya, <code>join</code> has to be lazy too."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496248346, "post_id": 44289681, "comment_id": 75586863, "body": "&quot;<i>sharing of results</i>&quot; makes absolutely sense. I will look at this more closely. You saved my day again, thanks!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496306159, "post_id": 44289681, "comment_id": 75610164, "body": "Sorry, one more thing: &quot;<i>drop the <code>Lazy</code> wrapper</i>&quot; - isn&#39;t a monad just a type constraint, i.e. needs a type to exist? What type would this be then, if I drop my <code>(() -&gt; a) -&gt; (() -&gt; b)</code>? Simply the function type?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496328657, "post_id": 44289681, "comment_id": 75627029, "body": "@ftor I meant to call to the <code>Lazy</code> function, not the type wrapper (which is more like an alias even in your case, given <code>Lazy == id</code>). You might have more interesting results with <code>const Lazy = thunk =&gt; ({run: thunk});</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496492272, "post_id": 44289681, "comment_id": 75690566, "body": "<code>{runX :: Type}</code> in Haskell is just a convenient way to retrieve the underlying value without having to explicitly define a global function. In Javascript you can just get the value, but maybe the calling code is more clear with <code>.runLazy</code>. I think it&#39;s funny that people define all these <code>.getX</code> and <code>.runY</code> in Javascript, although they are not in the global namespace. If they were merely <code>.run</code>/<code>.get</code> then one could define correpsonding generic getters and write <code>run(tf)</code> or <code>get(tx)</code> instead of <code>tf.runLazy()</code> or <code>tx.getConst()</code>."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 1, "last_activity_date": 1496248052, "last_edit_date": 1496248052, "creation_date": 1496246891, "answer_id": 44289681, "question_id": 44289542, "link": "https://stackoverflow.com/questions/44289542/can-lazy-evaluation-be-implemented-by-a-monadic-type/44289681#44289681", "title": "Can lazy evaluation be implemented by a monadic type?", "body": "<blockquote>\n  <p>this evidently makes no sense, since the action sequence isn't lazy at all. <code>Lazy.join</code> simply triggers the evaluation prematurely</p>\n</blockquote>\n\n<p>Yes. So just don't do that:</p>\n\n<pre><code>// (() -&gt; (() -&gt; a)) -&gt; (() -&gt; a)\nLazy.join = ttx =&gt; Lazy(() =&gt; ttx()());\n//                         ^^ this function prevents `ttx` from being evaluated immediately\n</code></pre>\n\n<p>(though you can, and possible should for performance reasons, drop the <code>Lazy</code> wrapper or make <code>Lazy = id</code>)</p>\n\n<blockquote>\n  <p>are sequences of monadic actions in Haskell always eagerly evaluated?</p>\n</blockquote>\n\n<p>No, Haskell doesn't evaluate anything until you tell it to do. Monads are no exception, they work like any other data type.</p>\n\n<blockquote>\n  <p>is lazy evaluation an effect that cannot be implemented by a monad in a strictly evaluated language?</p>\n</blockquote>\n\n<p>No, it works perfectly fine. </p>\n\n<p>However, you might want to notice that you haven't yet implemented <a href=\"https://en.wikipedia.org/wiki/Lazy_evaluation\" rel=\"nofollow noreferrer\">lazy implementation</a> completely, which also implies sharing of results instead of re-evaluation. This does require mutability though, and works well only if the evaluated functions are pure.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496276693, "post_id": 44295413, "comment_id": 75599303, "body": "If you want some more fun, try implementing <code>map</code>, <code>ap</code> and <code>join</code> without <code>runLazy</code>, only in terms of <code>.chain()</code> and <code>of()</code> :-)"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496276789, "post_id": 44295413, "comment_id": 75599322, "body": "<code>Lazy</code> is not a monoid. What you were doing in <code>concat</code> is implement <code>Monoid a =&gt; Monoid(Lazy a)</code>, speaking in Haskell terms. But I don&#39;t think that&#39;s really useful. (Edit: Hm, Haskell <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#g:1\" rel=\"nofollow noreferrer\"><i>does</i> implement</a> <code>Monoid a =&gt; Monoid (Identity a)</code> and other similar stuff, so well...)"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496280047, "post_id": 44295413, "comment_id": 75600055, "body": "Bergi intriguing challenge. I&#39;ll try it tonight ^^"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1496280787, "post_id": 44295413, "comment_id": 75600186, "body": "I believe <code>empty</code> would be <code>return Lazy($ =&gt; this.runLazy().empty())</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1496281363, "post_id": 44295413, "comment_id": 75600301, "body": "@4castle No. There&#39;s no <code>this</code> in arrow functions, and nothing you can <code>runLazy</code> on. <code>empty</code> needs to produce a value out of thin air. You can only write the monoid instance when you know what data type you&#39;re going to wrap - then you can use <code>Lazy.of(A.empty())</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496307322, "post_id": 44295413, "comment_id": 75610993, "body": "&quot;<i>Your monadic return (or of in this case) is also broken</i>&quot; I&#39;ve never made my peace with <code>of</code> in Javascript. As I understand the function, it is essentially required to prove the monad laws - please correct me, if I&#39;m mistaken. In the end, it generates a value simply by using the constructor as well. It offers a bit of convenience in the <code>Lazy</code> case, though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496307381, "post_id": 44295413, "comment_id": 75611039, "body": "You have to pass the empty value explicitly to your <code>empty</code> method, since JS doesn&#39;t have type inference (I don&#39;t use the prototype system at all and therefore have to pass <code>concat</code> to the binary operation too). Is there a special reason that <code>empty</code> is a function?"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496984633, "post_id": 44295413, "comment_id": 75896266, "body": "@Bergi, fun exercise; <a href=\"https://repl.it/I4rU\" rel=\"nofollow noreferrer\">my results</a> - this has me thinking about the various ways to implement functional data structures and control flow in js"}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 1, "last_activity_date": 1496280015, "last_edit_date": 1592644375, "creation_date": 1496268432, "answer_id": 44295413, "question_id": 44289542, "link": "https://stackoverflow.com/questions/44289542/can-lazy-evaluation-be-implemented-by-a-monadic-type/44295413#44295413", "title": "Can lazy evaluation be implemented by a monadic type?", "body": "<p><strong>Playing around</strong></p>\n<p>Your question is fun and I haven't yet explored such a monad so I wanted to play around with it.</p>\n<p>As Bergi points out, there's no need for the additional thunk wrapper in your data constructor \u2013 ie, <code>Lazy</code> expects its argument to be a thunk already.</p>\n<p>Your <code>join</code> was broken \u2013 as counter-intuitive as it might seem, you have to make sure you wrap the unwrapping process! Think of it as adding one wrapper, but removing two; you still remove one layer of nesting, which achieves the intended result</p>\n<p>Your monadic <code>return</code> (or <code>of</code> in this case) is also broken; <code>return</code> is not always the same as your data constructor \u2013 ie <code>Lazy.of(2)</code> should be equivalent to <code>Lazy($ =&gt; 2)</code></p>\n<p>Your code inspired me, so I tinkered with it until I wound up with this. I think you will be pleased ^_^ Bergi also suggested that <code>Lazy</code> should not re-evaluated its result. I handled that with a safe memoisation inside the <code>runLazy</code> method. Feedback on this would be appreciated &lt;3</p>\n<blockquote>\n<p><strong>personal code style</strong></p>\n<p>As a convention, I write thunks as <code>$ =&gt; expr</code> instead of <code>() =&gt; expr</code>. When writing functional programs in JavaScript, you end up with a lot of <code>()</code>s, often times adjacent to other <code>()</code>s which can sometimes hurt readability. I think <code>Lazy($ =&gt; f())</code> reads (at least) slightly better than <code>Lazy(() =&gt; f())</code>. Since this is meant to be an educational site, I figure this is worth mentioning. I <em>feel</em> like small change helps with readability, but I also don't want to confuse anyone.</p>\n<p>For anyone that's stuck, feel free to substitute <code>()</code> for all <code>$</code> in the code below. Moving along now ...</p>\n</blockquote>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// data Lazy = Lazy (Unit -&gt; a)\nconst Lazy = t =&gt; ({\n  memo: undefined,\n  // runLazy :: Lazy a -&gt; Unit -&gt; a\n  runLazy () {\n    return this.memo === undefined\n      // console.log call just for demonstration purposes; remove as you wish\n      ? (this.memo = t(), console.log('computed:', this.memo), this.memo)\n      : this.memo\n  },\n  // chain :: Lazy a -&gt; (a -&gt; Lazy b) -&gt; Lazy b\n  chain (f) {\n    return Lazy($ =&gt; f(this.runLazy()).runLazy())\n  }\n})\n\n// Lazy.of :: a -&gt; Lazy a\nLazy.of = x =&gt;\n  Lazy($ =&gt; x)\n  \n// repeat :: Int -&gt; (a -&gt; a) -&gt; a -&gt; Lazy a\nconst repeat = n =&gt; f =&gt; x =&gt;\n  n === 0\n    ? Lazy.of(x)\n    : Lazy.of(f(x)).chain(repeat (n-1) (f))\n\n// m :: Lazy Number\nconst m = repeat (5) (x =&gt; x * 2) (1)\n\nconsole.log('computations pending...')\n// ...\nconsole.log(m.runLazy()) // (1 * 2 * 2 * 2 * 2 * 2) =&gt; 32\nconsole.log(m.runLazy()) // =&gt; 32</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>As for satisfying the other categories, here's some more method implementations for <code>Lazy</code>. I got hung up on the Monoid for <code>empty</code>, but maybe you or someone else has some ideas there !</p>\n<p>I also saw that you derived <code>chain</code> from <code>f =&gt; join(map(f))</code> which is perfectly fine too</p>\n<p><strong>Functor</strong></p>\n<pre><code>// map :: Lazy a -&gt; (a -&gt; b) -&gt; Lazy b\nmap (f) {\n  return Lazy($ =&gt; f(this.runLazy()))\n}\n</code></pre>\n<p><strong>Applicative</strong></p>\n<pre><code>// apply :: (a -&gt; b) -&gt; a -&gt; b\nconst apply = f =&gt; x =&gt; f (x)\n\n// ap :: Lazy (a -&gt; b) -&gt; Lazy a -&gt; Lazy b\nap (m) {\n  return Lazy($ =&gt; apply (this.runLazy()) (m.runLazy()))\n}\n</code></pre>\n<p><strong>Monad</strong></p>\n<pre><code>// Lazy.of :: a -&gt; Lazy a\nLazy.of = x =&gt;\n  Lazy($ =&gt; x)\n\n// chain :: Lazy a -&gt; (a -&gt; Lazy b) -&gt; Lazy b\nchain (f) {\n  return Lazy($ =&gt; f(this.runLazy()).runLazy())\n}\n\n// join :: Lazy (Lazy a) -&gt; Lazy a\njoin () {\n  return Lazy($ =&gt; this.runLazy().runLazy())\n}\n</code></pre>\n<p><strong>Monoid</strong></p>\n<pre><code>// empty\nempty () {\n  // unsure on this one\n}\n\n// concat :: (Monoid a) =&gt; Lazy a -&gt; Lazy a -&gt; Lazy a\nconcat (m) {\n  return Lazy($ =&gt; this.runLazy().concat(m.runLazy()))\n}\n</code></pre>\n<hr />\n<p><strong>open exploration</strong></p>\n<p>This topic is very fun for me so I'm happy to discuss anything I've written about here or any other comments about the ideas presented in this question/answer. Let's have more fun!</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516205828, "post_id": 44297693, "comment_id": 83596069, "body": "<i>...it will move more towards a call-by-name translation.</i> You&#39;re absolutely right! When you have a monadic computation based on the <code>Delay</code> type and inject an expression into the monad, this expression is immediately evaluated, because for the initial computation step it isn&#39;t wrapped in a thunk yet (<code>const of = x =&gt; Delay(() =&gt; x)</code> where <code>x</code> is evaluated immediately in JS). So indeed it is &quot;just a bit&quot; off and &quot;correcting&quot;."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 3, "last_activity_date": 1496285230, "creation_date": 1496285230, "answer_id": 44297693, "question_id": 44289542, "link": "https://stackoverflow.com/questions/44289542/can-lazy-evaluation-be-implemented-by-a-monadic-type/44297693#44297693", "title": "Can lazy evaluation be implemented by a monadic type?", "body": "<p>It depends on what you mean by \"implementing lazy evaluation\".  You can certainly make a \"Delay\" type and it will be a monad. But normally we think of a function with type <code>A -&gt; State S B</code> as being a \"stateful function from <code>A</code> to <code>B</code>\". With something like <code>A -&gt; Delay B</code>, it seems that for the argument <code>A</code> we've already \"forced\" it.  It seems like we'd really want something more like <code>Delay A -&gt; Delay B</code>.</p>\n\n<p>It turns out that there are multiple ways of converting an expression to monadic style.  A call-by-value way, which is the usual way, and a call-by-name way.  This is discussed by Phil Wadler in his 1992 paper <a href=\"https://doi.org/10.1145/91556.91592\" rel=\"nofollow noreferrer\">Comprehending Monads</a> (<a href=\"https://ncatlab.org/nlab/files/WadlerMonads.pdf\" rel=\"nofollow noreferrer\">PDF</a>). Not surprisingly, these are related to a similar fact that there are two translations into continuation-passing style (CPS): a call-by-value one and a call-by-name one. Indeed, these are exactly the call-by-value/-name monadic style translations just with the continuation monad.  The purpose of CPS was to separate the order of evaluation of a target, implementation language from the order of evaluation of the source language. If you use the call-by-value CPS transform to implement a source language, it will have call-by-value semantics regardless of what the evaluation order of the target language is.  Similarly, if you use the call-by-name CPS transform, you will likewise get call-by-name semantics regardless of the evaluation order of the target language.</p>\n\n<p>I don't know exactly how things would play out when using a call-by-value translation with a <code>Delay</code> monad, but I suspect it will often be \"just a bit\" off and \"correcting\" it will move more towards a call-by-name translation.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 1, "accepted_answer_id": 44297693, "answer_count": 3, "score": 5, "last_activity_date": 1496313060, "creation_date": 1496246493, "last_edit_date": 1496313060, "question_id": 44289542, "link": "https://stackoverflow.com/questions/44289542/can-lazy-evaluation-be-implemented-by-a-monadic-type", "title": "Can lazy evaluation be implemented by a monadic type?", "body": "<p>I'm currently studying lazy evaluation in conjunction with monads in Javascript and what use cases may evolve from these. So I tried to implement a lazy type, which implements the functor/monad type class. The corresponding constructor is meant to be lazy in its arguments and in its result. Here is what I came up with:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// a lazy type\r\n\r\n// (() -&gt; a) -&gt; () -&gt; b\r\nconst Lazy = thunk =&gt; () =&gt; thunk();\r\n\r\n// (b -&gt; a -&gt; b) -&gt; b -&gt; Lazy a -&gt; b\r\nLazy.fold = f =&gt; acc =&gt; tx =&gt; f(acc) (tx());\r\n\r\n// (a -&gt; b) -&gt; Lazy a -&gt; Lazy b\r\nLazy.map = f =&gt; tx =&gt; Lazy(() =&gt; f(tx()));\r\n\r\n// Lazy (a -&gt; b) -&gt; Lazy a -&gt; Lazy b\r\nLazy.ap = tf =&gt; tx =&gt; Lazy(() =&gt; tf() (tx()));\r\n\r\nLazy.of = Lazy;\r\n\r\n// Lazy (Lazy a) -&gt; Lazy a\r\nLazy.join = ttx =&gt; ttx();\r\n\r\n// (a -&gt; Lazy b) -&gt; Lazy a -&gt; Lazy b\r\nLazy.chain = ft =&gt; tx =&gt; Lazy.join(Lazy.map(ft) (tx));\r\n\r\n// recursive bind (or chain in Javascript)\r\n\r\n// Number -&gt; (a -&gt; b) -&gt; a -&gt; Lazy b\r\nconst repeat = n =&gt; f =&gt; x =&gt; {\r\n  const aux = m =&gt; y =&gt; m === 0\r\n   ? Lazy(() =&gt; y)\r\n   : Lazy.chain(aux(m - 1)) (Lazy(() =&gt; f(y)));\r\n\r\n  return aux(n) (x);\r\n};\r\n\r\n// impure function to observe the computation\r\n\r\nconst inc = x =&gt; (console.log(++x), x);\r\n\r\n// and run\r\n\r\nconsole.log(repeat(5) (inc) (0)); // logs 1, 2, 3, 4, 5, () =&gt; thunk()</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Now this evidently makes no sense, since the action sequence isn't lazy at all. <code>Lazy.join</code> simply triggers the evaluation prematurely. Hence, the following questions have emerged:</p>\n\n<ul>\n<li>are sequences of monadic actions in Haskell always eagerly evaluated?</li>\n<li>is lazy evaluation an effect that cannot be implemented by a monad in a strictly evaluated language?</li>\n</ul>\n\n<p>I am not even sure if my research makes any sense, so feel free to vote for closing this question.</p>\n"}, {"tags": ["haskell", "currying", "pointfree"], "comments": [{"owner": {"reputation": 145, "user_id": 6840642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e5097e226bafec8ac922e683f1ad195?s=128&d=identicon&r=PG&f=1", "display_name": "Hapal", "link": "https://stackoverflow.com/users/6840642/hapal"}, "edited": false, "score": 0, "creation_date": 1496342077, "post_id": 44288658, "comment_id": 75635049, "body": "<a href=\"https://hackage.haskell.org/package/pointfree\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pointfree</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1496313446, "last_edit_date": 1496313446, "creation_date": 1496244529, "answer_id": 44288863, "question_id": 44288658, "link": "https://stackoverflow.com/questions/44288658/f-x-y-3-y-x-in-point-free-form/44288863#44288863", "title": "f x y = 3 + y/x in point free form", "body": "<p>The type signature of the <code>.</code> is <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. As you can see, this only works if the <strong>second</strong> function (in your answer <code>flip (/)</code>) has <strong>one argument</strong>. In case it has two arguments, we can use the \"owl operator\" <code>(.) . (.)</code>, which has type:</p>\n\n<pre><code>(.) . (.) :: (b -&gt; c) -&gt; (a -&gt; a1 -&gt; b) -&gt; a -&gt; a1 -&gt; c\n</code></pre>\n\n<p>Or we can use currying. By using <code>uncurry :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c</code> on the <code>flip (/)</code> part, we construct a function:</p>\n\n<pre><code>uncurry (flip (/)) :: Fractional c =&gt; (c, c) -&gt; c\n</code></pre>\n\n<p>so now we work with a <em>single</em> tuple (thus one argument), and then we use <code>curry :: ((a, b) -&gt; c) -&gt; a -&gt; b -&gt; c</code> to \"unpack\" the resulting first argument tuple again.</p>\n\n<h1>Alternatives</h1>\n\n<p>As discussed before, we can use the <em>owl operator</em>:</p>\n\n<pre><code>   <b>((.) . (.))</b> (3.0+)  (flip (/))\n-- ^   owl   ^</code></pre>\n\n<p>Or we can use a syntactically more complex version of the owl operator:</p>\n\n<pre><code>((3 +) .) . flip (/)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8086500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d95f9d69cd4be6200257afe5b6d3da2?s=128&d=identicon&r=PG&f=1", "display_name": "Nicrophorus", "link": "https://stackoverflow.com/users/8086500/nicrophorus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 44288863, "answer_count": 1, "score": 2, "last_activity_date": 1524561386, "creation_date": 1496243953, "last_edit_date": 1524561386, "question_id": 44288658, "link": "https://stackoverflow.com/questions/44288658/f-x-y-3-y-x-in-point-free-form", "title": "f x y = 3 + y/x in point free form", "body": "<p>I'm trying to figure out the point free form of <code>f x y = 3 + y/x</code> in Haskell. I thought it would be <code>f = (3.0+) . flip (/)</code>, but the answer is <code>f2 = curry $ (3.0+) . (uncurry  $ flip (/))</code>, which is the same as <code>f1 = curry ((3.0+) . (uncurry (flip (/))))</code>, e.g. the answer I got but with uncurry before flip and curry at the beginning.</p>\n\n<p>I see how that version works, but I'm not sure why the curry and uncurry functions are needed, and why my version doesn't work? The type of <code>(3.0+)</code> is <code>a -&gt; a</code>, which I thought would work if you fed that function with the result form <code>flip (/)</code> via function composition, but <code>(3.0+) . flip (/) 2 10</code> results in an error (why?) and does not yield 8. Isn't it redundant to uncurry and then curry again?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8002700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577a8683fba9c28274c3b3ec40c158e4?s=128&d=identicon&r=PG&f=1", "display_name": "oxsaulxo", "link": "https://stackoverflow.com/users/8002700/oxsaulxo"}, "edited": false, "score": 0, "creation_date": 1496239879, "post_id": 44287055, "comment_id": 75580924, "body": "Thanks!! Solved !"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1496239732, "creation_date": 1496239732, "answer_id": 44287055, "question_id": 44286949, "link": "https://stackoverflow.com/questions/44286949/print-elements-of-a-list-in-the-same-line/44287055#44287055", "title": "Print elements of a list in the same line", "body": "<p>You can use <code>show :: Show a =&gt; a -&gt; String</code> to convert an element (here an integer), to its textual representation as a <code>String</code>.</p>\n\n<p>Furthermore we can use <code>concat :: [[a]] -&gt; [a]</code> to convert a list of lists of elements to a list of elements (by concatenating these lists together). In the context of a <code>String</code>, we can thus use <code>concat :: [String] -&gt; String</code> to join the numbers together.</p>\n\n<p>So we can then use:</p>\n\n<pre><code>printConcat :: Show a =&gt; [a] -&gt; IO ()\nprintConcat = putStrLn . concat . map show\n</code></pre>\n\n<p>This then generates:</p>\n\n<pre><code>Prelude&gt; printConcat [1,2,3,4]\n1234\n</code></pre>\n\n<p>Note that the <code>printConcat</code> function is <em>not</em> limited to numbers (integers), it can take any type of objects that are a type instance of the <code>Show</code> class.</p>\n"}], "owner": {"reputation": 23, "user_id": 8002700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577a8683fba9c28274c3b3ec40c158e4?s=128&d=identicon&r=PG&f=1", "display_name": "oxsaulxo", "link": "https://stackoverflow.com/users/8002700/oxsaulxo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 0, "accepted_answer_id": 44287055, "answer_count": 1, "score": 2, "last_activity_date": 1496281317, "creation_date": 1496239439, "last_edit_date": 1496281317, "question_id": 44286949, "link": "https://stackoverflow.com/questions/44286949/print-elements-of-a-list-in-the-same-line", "title": "Print elements of a list in the same line", "body": "<p>I'm new at haskell and  I'm trying to print the elements of a list in a same line . For example:</p>\n\n<pre><code>[1,2,3,4] = 1234 \n</code></pre>\n\n<p>If elements are Strings I can print it with <code>mapM_ putStr [\"1\",\"2\",\"3\",\"\\n\"]</code> \nbut they aren't.. Someone knows a solution to make a function and print that?</p>\n\n<p>I try <code>dignum xs = [ mapM_ putStr x | x &lt;- xs ]</code> too buts don't work ..</p>\n"}, {"tags": ["sqlite", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 8091732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18eb5b76f634ae165d082e74a4afffe3?s=128&d=identicon&r=PG&f=1", "display_name": "mitch", "link": "https://stackoverflow.com/users/8091732/mitch"}, "edited": false, "score": 0, "creation_date": 1496266262, "post_id": 44284570, "comment_id": 75596262, "body": "This worked, thanks. But the next question... is the Hackage example incorrect? The largest issue here is that I assumed that the example code was definitely correct. Should I be more wary as I learn the language?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 73, "user_id": 8091732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18eb5b76f634ae165d082e74a4afffe3?s=128&d=identicon&r=PG&f=1", "display_name": "mitch", "link": "https://stackoverflow.com/users/8091732/mitch"}, "edited": false, "score": 0, "creation_date": 1496299046, "post_id": 44284570, "comment_id": 75605542, "body": "It&#39;s incorrect in the sense that the types are ambiguous. It&#39;s correct in the sense that the query works. I&#39;m not sure whether that package is a canonical starting point to learn Haskell, though."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1496232944, "creation_date": 1496232944, "answer_id": 44284570, "question_id": 44284380, "link": "https://stackoverflow.com/questions/44284380/haskell-sqlite-simple-type-error/44284570#44284570", "title": "Haskell SQLite-Simple type error", "body": "<p>You can <code>query</code> many types, therefore it's not clear what type <code>x</code> has. All GHC knows about <code>x</code> is that its an instance of <code>FromField</code> (due to <code>query_</code>) and an instance of <code>Show</code> (due to <code>print</code>).</p>\n\n<p>You have to specify <em>which</em> type you want to query, e.g.</p>\n\n<pre><code>print (x :: Integer)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>printInt :: Int -&gt; IO ()\nprintInt = print\n\nmain = do\n  \u2026\n  printInt x\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 8091732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18eb5b76f634ae165d082e74a4afffe3?s=128&d=identicon&r=PG&f=1", "display_name": "mitch", "link": "https://stackoverflow.com/users/8091732/mitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 44284570, "answer_count": 1, "score": 2, "last_activity_date": 1496232944, "creation_date": 1496232386, "question_id": 44284380, "link": "https://stackoverflow.com/questions/44284380/haskell-sqlite-simple-type-error", "title": "Haskell SQLite-Simple type error", "body": "<p>I am trying to run an example using sqlite-simple from <a href=\"https://hackage.haskell.org/package/sqlite-simple-0.4.13.0/docs/Database-SQLite-Simple.html#g:13/%22this%20page%22\" rel=\"nofollow noreferrer\">this Hackage page</a>: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\nimport Database.SQLite.Simple\n\nmain :: IO ()\nmain = do\n  conn &lt;- open \"test.db\"\n  [[x]] &lt;- query_ conn \"select 2 + 2\"\n  print x\n</code></pre>\n\n<p>But I get this error:</p>\n\n<pre><code>Prelude&gt; :load sqltest.hs\n[1 of 1] Compiling Main             ( sqltest.hs, interpreted )\n\nsqltest.hs:9:12: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018query_\u2019\n      prevents the constraint \u2018(Database.SQLite.Simple.FromField.FromField\n                                  a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Database.SQLite.Simple.FromField.FromField Integer\n          -- Defined in \u2018Database.SQLite.Simple.FromField\u2019\n        instance Database.SQLite.Simple.FromField.FromField a =&gt;\n                 Database.SQLite.Simple.FromField.FromField (Maybe a)\n          -- Defined in \u2018Database.SQLite.Simple.FromField\u2019\n        instance Database.SQLite.Simple.FromField.FromField Bool\n          -- Defined in \u2018Database.SQLite.Simple.FromField\u2019\n        ...plus five others\n        ...plus 15 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In a stmt of a 'do' block: [[x]] &lt;- query_ conn \"select 2 + 2\"\n      In the expression:\n        do { conn &lt;- open \"test.db\";\n             [[x]] &lt;- query_ conn \"select 2 + 2\";\n             print x }\n      In an equation for \u2018main\u2019:\n          main\n            = do { conn &lt;- open \"test.db\";\n                   [[x]] &lt;- query_ conn \"select 2 + 2\";\n                   print x }\n\nsqltest.hs:10:3: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Relevant bindings include x :: a0 (bound at sqltest.hs:9:5)\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n        instance Show Integer -- Defined in \u2018GHC.Show\u2019\n        instance Show FormatError -- Defined in \u2018Database.SQLite.Simple\u2019\n        ...plus 28 others\n        ...plus 35 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In a stmt of a 'do' block: print x\n      In the expression:\n        do { conn &lt;- open \"test.db\";\n             [[x]] &lt;- query_ conn \"select 2 + 2\";\n             print x }\n      In an equation for \u2018main\u2019:\n          main\n            = do { conn &lt;- open \"test.db\";\n                   [[x]] &lt;- query_ conn \"select 2 + 2\";\n                   print x }\nFailed, modules loaded: none. \n</code></pre>\n\n<p>I installed sqlite-simple using Cabal. Then I tried to load the example code into GHCI. I am new to Haskell and am just trying simple examples.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1496227852, "post_id": 44282422, "comment_id": 75572009, "body": "What is reason for this converting?"}], "answers": [{"comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1496229740, "post_id": 44283148, "comment_id": 75573247, "body": "I like that answer more than mine. The code is easier understood in my opinion."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 2, "last_activity_date": 1496228891, "creation_date": 1496228891, "answer_id": 44283148, "question_id": 44282422, "link": "https://stackoverflow.com/questions/44282422/haskell-converting-high-order-function-to-recursive-function/44283148#44283148", "title": "Haskell - converting High Order Function to recursive function", "body": "<p>You can do like that:</p>\n\n<pre><code>single p = lookupFirst\n  where\n    lookupFirst []                  = False\n    lookupFirst (x:xs)  | p x       = lookupSecond xs\n                        | otherwise = lookupFirst xs\n    lookupSecond []                 = True\n    lookupSecond (x:xs) | p x       = False\n                        | otherwise = lookupSecond xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 0, "last_activity_date": 1496230387, "last_edit_date": 1496230387, "creation_date": 1496229273, "answer_id": 44283296, "question_id": 44282422, "link": "https://stackoverflow.com/questions/44282422/haskell-converting-high-order-function-to-recursive-function/44283296#44283296", "title": "Haskell - converting High Order Function to recursive function", "body": "<p>We can use a <code>none</code> predicate that checks if the remainder of the list does not satisfy the condition:</p>\n\n<pre><code>single :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nsingle p []     = False\nsingle p (x:xs) | p x       = none p xs\n                | otherwise = single p xs\n\nnone :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nnone _ [] = True\nnone p (x:xs) = not (p x) &amp;&amp; none p xs\n</code></pre>\n\n<p>We thus also defined a <code>none</code> function that checks that no element in the given list satisfies a given predicate.</p>\n\n<p>Or without passing the predicate through the recursion:</p>\n\n<pre><code>single :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nsingle p = helper\n    where helper []     = False\n          helper (x:xs) | p x = none xs\n                        | otherwise = helper xs\n          none []     = True\n          none (x:xs) = not (p x) &amp;&amp; none xs\n</code></pre>\n\n<p>The above written functions will also immediately stop from the moment a second item is found that satisfies the predicate. This can be useful if we work for instance with an <em>infinite</em> list. If there is a second item that satisfies the constraint, then the function will stop, if no such element or only one such element will ever be generated, we will however get stuck in an infinite loop (there is no much we can do about this). For example:</p>\n\n<pre><code>*Main&gt; single even [1..] -- two or more elements satisfy the constraint\nFalse\n*Main&gt; single even [1,3..] -- no element satisfies the constraint\n^CInterrupted.\n*Main&gt; single even ([1,2]++[3,5..]) -- one element satisfies the constraint\n^CInterrupted.\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1496238103, "post_id": 44285268, "comment_id": 75579605, "body": "So what&#39;s <code>single even [1,2,3,4,5,6]</code> in the first two versions?"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1496239682, "post_id": 44285268, "comment_id": 75580778, "body": "@AlexeyRomanov uff you totally schooled me \u2013 I overlooked that! I&#39;m re-thinking the <code>xor</code> approach now. Any other input here?"}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1496340297, "post_id": 44285268, "comment_id": 75634134, "body": "Excellent explanations. These kind of answers are more useful to me then ten articles. I liked especially the answer with the helper function, because of its wide implication to other problems."}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 0, "last_activity_date": 1496236306, "last_edit_date": 1496236306, "creation_date": 1496234870, "answer_id": 44285268, "question_id": 44282422, "link": "https://stackoverflow.com/questions/44282422/haskell-converting-high-order-function-to-recursive-function/44285268#44285268", "title": "Haskell - converting High Order Function to recursive function", "body": "<p><strong><code>xor</code> and <code>foldl</code></strong></p>\n\n<p>The most intuitive thing I can thing of is to just fold <code>xor</code> (exclusive or) and your function <code>f</code> thru the list. In case you're not familiar with the binary function <code>xor</code>, it returns <code>True</code> only when (at most) 1 of its arguments are <code>True</code>; otherwise <code>False</code></p>\n\n<pre><code>xor :: Bool -&gt; Bool -&gt; Bool\nxor True  b = not b\nxor False b = b\n\nsingle :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nsingle f [] = False\nsingle f xs = foldl (\\acc -&gt; xor acc . f) False xs\n\nmain = do\n  putStrLn $ show (single even [])        -- False\n  putStrLn $ show (single even [1])       -- False\n  putStrLn $ show (single even [2])       -- True\n  putStrLn $ show (single even [1,2])     -- True\n  putStrLn $ show (single even [1,2,3])   -- True\n  putStrLn $ show (single even [1,2,3,4]) -- False\n</code></pre>\n\n<hr>\n\n<p><strong><code>Xor</code> monoid</strong></p>\n\n<p><code>xor</code> can be nicely encoded as a Monoid tho, which lends <code>single</code> to a more algebraic implementation using <code>foldMap</code>.</p>\n\n<pre><code>data Xor = Xor Bool\n\ninstance Monoid Xor where\n  mempty                      = Xor False\n  mappend (Xor True)  (Xor b) = Xor (not b)\n  mappend (Xor False) (Xor b) = Xor b\n\nsingle f xs = aux $ foldMap (Xor . f) xs\n  where\n    aux (Xor b) = b\n\nmain = do\n  putStrLn $ show (single even [])        -- False\n  putStrLn $ show (single even [1])       -- False\n  putStrLn $ show (single even [2])       -- True\n  putStrLn $ show (single even [1,2])     -- True\n  putStrLn $ show (single even [1,2,3])   -- True\n  putStrLn $ show (single even [1,2,3,4]) -- False\n</code></pre>\n\n<hr>\n\n<p><strong>auxiliary helper</strong></p>\n\n<p>This is another way you can do it with an <code>auxiliary</code> helper. This one has an added benefit in that it exits immediately (stops iteration thru the list) after an answer is determined</p>\n\n<pre><code>single :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nsingle f xs = aux False f xs\n  where\n    aux b     f []     = b\n    aux True  f (x:xs) = if (f x) then False else aux True f (xs)\n    aux False f (x:xs) = aux (f x) f xs  \n\nmain = do\n  putStrLn $ show (single even [])        -- False\n  putStrLn $ show (single even [1])       -- False\n  putStrLn $ show (single even [2])       -- True\n  putStrLn $ show (single even [1,2])     -- True\n  putStrLn $ show (single even [1,2,3])   -- True\n  putStrLn $ show (single even [1,2,3,4]) -- False\n</code></pre>\n\n<hr>\n\n<p><strong>feedback welcome!</strong></p>\n\n<p>I'm a Haskell newbie but maybe these ideas are interesting to you. Or maybe they're bad! Leave me a comment if there's anything I can do to improve the answer ^_^</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1496236306, "creation_date": 1496226965, "last_edit_date": 1496229197, "question_id": 44282422, "link": "https://stackoverflow.com/questions/44282422/haskell-converting-high-order-function-to-recursive-function", "title": "Haskell - converting High Order Function to recursive function", "body": "<p>requirement:write function single - Tests whether exactly one element of a list satisfies a given condition.</p>\n\n<pre><code>single :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>I wrote this function:</p>\n\n<pre><code>single p xs = count p xs == 1\n    where count pred  = length . filter pred \n</code></pre>\n\n<p>Question: What is the easy (correct) way to convert the above functions into one recursive function without using \" High Order Functions\"?</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1496251693, "last_edit_date": 1496251693, "creation_date": 1496180701, "answer_id": 44272470, "question_id": 44272380, "link": "https://stackoverflow.com/questions/44272380/couldnt-match-type-persistentitybackend-entity-a-with-sqlbackend/44272470#44272470", "title": "Couldn&#39;t match type \u2018PersistEntityBackend (Entity a)\u2019 with \u2018SqlBackend\u2019", "body": "<p>Add the constraint to the signature of <code>insertEnt</code>. You'll also need a <code>PersistEntity</code> constraint.</p>\n\n<pre><code>insertEnt\n  :: ( PersistEntity (Entity a)\n     , PersistEntityBackend (Entity a) ~ SqlBackend)\n  =&gt; Entity a -&gt; IO (Key (Entity a))\n</code></pre>\n\n<hr>\n\n<p>To deduce that (other than just giving the compiler what it's indirectly asking), you may look at <a href=\"https://hackage.haskell.org/package/persistent-2.7.0/docs/Database-Persist-Class.html#v:insert\" rel=\"nofollow noreferrer\">the type of <code>insert</code></a></p>\n\n<pre><code>insert\n  :: ( PersistStoreWrite backend\n     , MonadIO m\n     , PersistRecordBackend record backend)\n  =&gt; record -&gt; ReaderT backend m (Key record)\n</code></pre>\n\n<p>We also have</p>\n\n<pre><code>type PersistRecordBackend record backend =\n  ( PersistEntity record\n  , PersistEntityBackend record ~ BaseBackend backend)\n</code></pre>\n\n<p>Furthermore, in your application you have some concrete types:</p>\n\n<pre><code>backend ~ SqlBackend\nm ~ (some concrete transformer stack on top of IO)\nrecord ~ Entity a\n</code></pre>\n\n<p>These concrete types discharge <code>PersistStoreWrite backend</code> and <code>MonadIO m</code>, and since <code>Entity a</code> is still mostly abstract, you are left with the two constraints that define <code>PersistRecordBackend</code>. You could in fact use that synonym as a shorthand:</p>\n\n<pre><code>insertEnt\n  :: PersistRecordBackend (Entity a) SqlBackend\n  =&gt; Entity a -&gt; IO (Key (Entity a))\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "accepted_answer_id": 44272470, "answer_count": 1, "score": 1, "last_activity_date": 1496251693, "creation_date": 1496180308, "question_id": 44272380, "link": "https://stackoverflow.com/questions/44272380/couldnt-match-type-persistentitybackend-entity-a-with-sqlbackend", "title": "Couldn&#39;t match type \u2018PersistEntityBackend (Entity a)\u2019 with \u2018SqlBackend\u2019", "body": "<p>I've got the following:</p>\n\n<pre><code>asSqlBackendReader :: ReaderT SqlBackend m a -&gt; ReaderT SqlBackend m a\nasSqlBackendReader = id\n\ninsertEnt :: (Entity a) -&gt; IO (Key (Entity a))\ninsertEnt x = runWithDb $ do\n  insert $ x\n  where runWithDb = runSqlite \"test.db\" . asSqlBackendReader\n</code></pre>\n\n<p>The purpose of the <code>asSqlBAckendReader</code> is due to <a href=\"https://stackoverflow.com/questions/44249710/persistent-selectlist-causing-error-of-couldnt-match-type-basebackend-backend\">Persistent selectList causing error of &quot;Couldn&#39;t match type \u2018BaseBackend backend0\u2019 with \u2018SqlBackend\u2019&quot;</a>.</p>\n\n<p>I'm running into an error of: </p>\n\n<pre><code>\u2022 Couldn't match type \u2018PersistEntityBackend (Entity a)\u2019\n                 with \u2018SqlBackend\u2019\n    arising from a use of \u2018insert\u2019\n\u2022 In a stmt of a 'do' block: insert $ x\n  In the second argument of \u2018($)\u2019, namely \u2018do { insert $ x }\u2019\n  In the expression: runWithDb $ do { insert $ x }\n</code></pre>\n"}, {"tags": ["haskell", "fold", "type-constraints", "foldable"], "answers": [{"comments": [{"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "edited": false, "score": 0, "creation_date": 1496181502, "post_id": 44271511, "comment_id": 75553070, "body": "I see my mistake, I was trying to write type declaration for foldl which is not what I intended to do. Thanks."}], "tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": true, "score": 3, "last_activity_date": 1496176738, "creation_date": 1496176738, "answer_id": 44271511, "question_id": 44271342, "link": "https://stackoverflow.com/questions/44271342/using-foldl-in-a-function/44271511#44271511", "title": "Using foldl in a function", "body": "<p>Annotate you definition of <code>genderStatsOfClients</code>to tell the compiler that your foldable is a list :</p>\n\n<pre><code>genderStatsOfClients :: [Client] -&gt; [GenderStat]\n</code></pre>\n"}], "owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 44271511, "answer_count": 1, "score": 1, "last_activity_date": 1496176738, "creation_date": 1496175997, "last_edit_date": 1496176414, "question_id": 44271342, "link": "https://stackoverflow.com/questions/44271342/using-foldl-in-a-function", "title": "Using foldl in a function", "body": "<p>I have a question about the type definition for using foldl in Haskell, I have the types:</p>\n\n<pre><code>data Client = GovOrg String\n            | Company String Integer Person String\n            | Individual Person Bool\n            deriving Show\n\ndata Person = Person String String Gender\n            deriving Show\n\ndata Gender = Male | Female | Unknown\n  deriving (Show, Eq, Ord)\n\ndata GenderStat = GenderStat Gender Integer deriving Show\n</code></pre>\n\n<p>The foldl is defined using the following functions:</p>\n\n<pre><code>clientGender :: Client -&gt; Gender\nclientGender client = case client of\n                          Company  _ _ (Person _ _ gender) _ -&gt; gender\n                          Individual (Person _ _ gender) _   -&gt; gender\n                          _                                  -&gt; Unknown\n\nincrementGenderStat :: GenderStat -&gt; GenderStat\nincrementGenderStat (GenderStat gender num) = GenderStat gender (num + 1)\n\ngenderStats:: [GenderStat] -&gt; Client -&gt; [GenderStat]\ngenderStats [maleStat, femaleStat, unknownStat] client = case clientGender client of\n                                                           Male -&gt; [incrementGenderStat maleStat, femaleStat, unknownStat]\n                                                           Female -&gt; [maleStat, incrementGenderStat femaleStat, unknownStat]\n                                                           Unknown -&gt; [maleStat, femaleStat, incrementGenderStat unknownStat]\n\n-- genderStatsOfClients :: Client a -&gt; \ngenderStatsOfClients = foldl genderStats [GenderStat Male 0, GenderStat Female 0, GenderStat Unknown 0]\n</code></pre>\n\n<p>When I try and load my module into <code>ghci</code>, it throws the error:</p>\n\n<pre><code>  \u2022 Ambiguous type variable \u2018t0\u2019 arising from a use of \u2018foldl\u2019                                      \u2502\n      prevents the constraint \u2018(Foldable t0)\u2019 from being solved.                                      \u2502\n      Relevant bindings include                                                                       \u2502\n        genderStatsOfClients :: t0 Client -&gt; [GenderStat]                                             \u2502\n          (bound at src/Section2/DataTypes.hs:82:1)                                                   \u2502\n      Probable fix: use a type annotation to specify what \u2018t0\u2019 should be.                             \u2502\n      These potential instances exist:                                                                \u2502\n        instance Foldable (Either a) -- Defined in \u2018Data.Foldable\u2019                                    \u2502\n        instance Foldable Maybe -- Defined in \u2018Data.Foldable\u2019                                         \u2502                                                                \n        instance Foldable ((,) a) -- Defined in \u2018Data.Foldable\u2019                                       \u2502                                                                \n        ...plus one other                                                                             \u2502                                                                \n        ...plus 22 instances involving out-of-scope types                                             \u2502                                                                \n        (use -fprint-potential-instances to see them all)                                             \u2502                                                                \n    \u2022 In the expression:                                                                              \u2502\n        foldl                                                                                         \u2502\n          genderStats                                                                                 \u2502\n          [GenderStat Male 0, GenderStat Female 0, GenderStat Unknown 0]                              \u2502\n      In an equation for \u2018genderStatsOfClients\u2019:                                                      \u2502\n          genderStatsOfClients                                                                        \u2502\n            = foldl                                                                                   \u2502\n                genderStats                                                                           \u2502\n                [GenderStat Male 0, GenderStat Female 0, GenderStat Unknown 0]                        \u2502\nFailed, modules loaded: none. \n</code></pre>\n\n<p>I have attempted to rectify this by providing a type annotation for the function as suggested:</p>\n\n<pre><code>-- genderStatsOfClients :: Foldable Client =&gt; ([GenderStat] -&gt; a -&gt; [GenderStat]) -&gt; [GenderStat] -&gt; [a] -&gt; [GenderStat]\n</code></pre>\n\n<p>I want to know how can I provide an appropriate type constraint here, if I use <code>Foldable Client a</code>, it says it was expecting one fewer argument to <code>Foldable</code>.</p>\n\n<p>I have also tried the type definition:</p>\n\n<pre><code>genderStatsOfClients :: (Foldable f, Client a) =&gt; ([GenderStat] -&gt; (f a) -&gt; [GenderStat]) -&gt; [GenderStat] -&gt; [(f a)] -&gt; [GenderStat]\ngenderStatsOfClients = foldl genderStats [GenderStat Male 0, GenderStat Female 0, GenderStat Unknown 0]\n</code></pre>\n\n<p>which throws the error:</p>\n\n<pre><code>src/Section2/DataTypes.hs:81:38: error:                                                               \u2502\n    \u2022 Expecting one fewer argument to \u2018Client\u2019                                                        \u2502\n      Expected kind \u2018* -&gt; Constraint\u2019, but \u2018Client\u2019 has kind \u2018*\u2019                                      \u2502\n    \u2022 In the type signature:                                                                          \u2502\n        genderStatsOfClients :: (Foldable f, Client a) =&gt;                                             \u2502\n                                ([GenderStat] -&gt; (f a) -&gt; [GenderStat])                               \u2502\n                                -&gt; [GenderStat] -&gt; [(f a)] -&gt; [GenderStat]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1496168831, "post_id": 44269043, "comment_id": 75546779, "body": "Is this for you to exercise, if not maybe you can use Parsec <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/parsec</a>"}, {"owner": {"reputation": 81, "user_id": 4932134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/92c3a3b5f55c987f250998225c44aa4b?s=128&d=identicon&r=PG&f=1", "display_name": "JayL", "link": "https://stackoverflow.com/users/4932134/jayl"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1496168947, "post_id": 44269043, "comment_id": 75546847, "body": "Yes, it is my exercise, so unfortunately I can&#39;t use it."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1496170159, "post_id": 44269043, "comment_id": 75547511, "body": "Maybe you can still use it for inspiration, like for example build some small parser and then combine them."}, {"owner": {"reputation": 81, "user_id": 4932134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/92c3a3b5f55c987f250998225c44aa4b?s=128&d=identicon&r=PG&f=1", "display_name": "JayL", "link": "https://stackoverflow.com/users/4932134/jayl"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1496171645, "post_id": 44269043, "comment_id": 75548324, "body": "Well, as a beginner I must admit that I have no idea how to do it, but I&#39;ll give it a try."}], "answers": [{"comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1496170300, "post_id": 44269594, "comment_id": 75547596, "body": "If it&#39;s for an exercise, I&#39;d think that using a <code>Read</code> instance is a bit cheating."}, {"owner": {"reputation": 81, "user_id": 4932134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/92c3a3b5f55c987f250998225c44aa4b?s=128&d=identicon&r=PG&f=1", "display_name": "JayL", "link": "https://stackoverflow.com/users/4932134/jayl"}, "edited": false, "score": 0, "creation_date": 1496170668, "post_id": 44269594, "comment_id": 75547804, "body": "Thank you, it works perfectly, but I&#39;m afraid I can&#39;t use <code>System.Environment</code> nor <code>Text.Read</code>."}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": false, "score": 2, "last_activity_date": 1496170195, "last_edit_date": 1496170195, "creation_date": 1496169620, "answer_id": 44269594, "question_id": 44269043, "link": "https://stackoverflow.com/questions/44269043/haskell-get-list-of-strings-from-file/44269594#44269594", "title": "Haskell: get list of strings from file", "body": "<p>This is how it could be done:</p>\n\n<pre><code>import System.Environment\nimport System.IO\nimport Data.Maybe\nimport Text.Read\n\nreadStringList :: String -&gt; Maybe [String]\nreadStringList = readMaybe\n\nmain = do --print \"Enter file name\"\n        handle &lt;- openFile \"1.txt\" ReadMode\n        hSeek handle AbsoluteSeek 8 \n        file &lt;- hGetContents handle\n        let list = fromJust (readStringList file )\n        print list\n        let filterThis = \",\" :: String\n        let filtered = filter (/=filterThis) list\n        print filtered\n</code></pre>\n\n<p>To get first command line argument, use <code>getArgs</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 4932134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/92c3a3b5f55c987f250998225c44aa4b?s=128&d=identicon&r=PG&f=1", "display_name": "JayL", "link": "https://stackoverflow.com/users/4932134/jayl"}, "edited": false, "score": 0, "creation_date": 1496173715, "post_id": 44270363, "comment_id": 75549470, "body": "Actually I think I can use <code>Read</code> instance, so that would be it. Thanks!"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1496174476, "post_id": 44270363, "comment_id": 75549893, "body": "Maybe you can use it only if you implement it yourself. Deriving <code>Read</code> might be &quot;too easy&quot;."}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1496175401, "post_id": 44270363, "comment_id": 75550318, "body": "This answer inspired me to learn Haskell even more. You solution is very &quot;functional&quot;."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1496241517, "last_edit_date": 1496241517, "creation_date": 1496172304, "answer_id": 44270363, "question_id": 44269043, "link": "https://stackoverflow.com/questions/44269043/haskell-get-list-of-strings-from-file/44270363#44270363", "title": "Haskell: get list of strings from file", "body": "<p>Well, you could cheat by defining a datatype with a <code>Read</code> instance that matches your existing input:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall -Werror -Wno-name-shadowing #-}\nmodule Main where\n\ndata Input = Plaster [String] deriving (Read, Show)\n\nmain :: IO ()\nmain = do\n  Plaster xs &lt;- readIO =&lt;&lt; readFile \"1.txt\"\n  _ &lt;- traverse print (zip [0 :: Int ..] xs)\n  return ()\n</code></pre>\n\n<p>This works perfectly for me with ghc-8.0.2:</p>\n\n<pre><code>$ cat \"1.txt\"\nPlaster [\"BD..\", \".GA.D\", \".FEG\", \"ABDCF\", \"E...\"]\n$ ghc --make SO44269043.hs &amp;&amp; ./SO44269043\n(0,\"BD..\")\n(1,\".GA.D\")\n(2,\".FEG\")\n(3,\"ABDCF\")\n(4,\"E...\")\n</code></pre>\n\n<hr>\n\n<p>Alternately, you could define your own read instance:</p>\n\n<pre><code>data Input = Plaster [String]\n\ninstance Read Input where\n  readsPrec p = readParen (p &gt;= 10) . runR $ do\n    Plaster &lt;$&gt; (string \"Plaster\" *&gt; many1 whitespace *&gt; R readList)\n</code></pre>\n\n<p>If you're unfamiliar with <code>&lt;$&gt;</code> and <code>*&gt;</code>, it may be a little easier to read this as</p>\n\n<pre><code>  readsPrec p = readParen (p &gt;= 10) . runR $ do\n    _ &lt;- string \"Plaster\"\n    _ &lt;- many1 whitespace\n    xs &lt;- R readList\n    return (Plaster xs)\n</code></pre>\n\n<p>Even without imports, it's not a lot of code to define a parser type <code>R</code>, basically just a wrapper that lets you define a monad instance for <code>String -&gt; [(a, String)]</code>:</p>\n\n<pre><code>newtype R a = R { runR :: ReadS a }\n\ninstance Functor R where\n  fmap f = R . fmap (map (\\(a, s) -&gt; (f a, s))) . runR\n\ninstance Applicative R where\n  pure a = R $ \\s -&gt; [(a, s)]\n  mf &lt;*&gt; ma = R $ \\s -&gt; do\n    (f, s) &lt;- runR mf s\n    (a, s) &lt;- runR ma s\n    return (f a, s)\n\ninstance Monad R where\n  m &gt;&gt;= f = R $ \\s -&gt; do\n    (a, s) &lt;- runR m s\n    runR (f a) s\n</code></pre>\n\n<p>The <code>&gt;&gt;=</code> (or bind) operator just means \"parse some of the string\nwith the parser on the left, then parse the rest of the string\nwith the after passing the resulting value to the function on the right.\"</p>\n\n<p>We get <code>R readList :: R [String]</code> for free now, so all we need to do\nis skip the initial \"Plaster\" and any whitespace between that and the \nlist of strings:</p>\n\n<pre><code>string :: String -&gt; R String\nstring = traverse char\n\nmany1 :: R a -&gt; R [a]\nmany1 r = loop where\n  loop = (:) &lt;$&gt; r &lt;*&gt; (loop &lt;|&gt; return [])\n\nwhitespace :: R Char\nwhitespace = char ' ' &lt;|&gt; char '\\t' &lt;|&gt; char '\\n' &lt;|&gt; char '\\r'\n</code></pre>\n\n<p>Normally we'd use <code>&lt;|&gt;</code> from <code>GHC.Base</code>, but it's not hard to define a one-off here. Basically\n<code>r &lt;|&gt; r'</code> means \"try to parse with <code>r</code>, and if it fails, try to parse with <code>r'</code> instead\"</p>\n\n<pre><code>(&lt;|&gt;) :: R a -&gt; R a -&gt; R a\nr &lt;|&gt; r' = R $ \\s -&gt; runR r s ++ runR r' s\n</code></pre>\n\n<p>And now all we need is the ability to match a single character:</p>\n\n<pre><code>char :: Char -&gt; R Char\nchar c = R $ \\s -&gt; case s of\n  (c' : s) | c == c'  -&gt; [(c, s)]\n  _                   -&gt; []\n</code></pre>\n\n<hr>\n\n<p>If even using <code>Prelude.readList</code> is too easy, we can define our own parsers for lists and quoted strings:</p>\n\n<pre><code>  readsPrec p = readParen (p &gt;= 10) . runR $ do\n    Plaster &lt;$&gt; (string \"Plaster\" *&gt; many1 whitespace *&gt; listOf quotedString)\n</code></pre>\n\n<p>Where lists just have a leading '[', a trailing ']', and some number of delimited terms:</p>\n\n<pre><code>listOf :: R a -&gt; R [a]\nlistOf term = char '[' *&gt; (term `sepBy` string \", \") &lt;* char ']'\n\nsepBy :: R a -&gt; R b -&gt; R [a]\nsepBy term delim = sepBy1 term delim &lt;|&gt; return []\n\nsepBy1 :: R a -&gt; R b -&gt; R [a]\nsepBy1 term delim = loop where\n  loop = (:) &lt;$&gt; term &lt;*&gt; ((delim *&gt; loop) &lt;|&gt; return [])\n</code></pre>\n\n<p>Similarly, a quoted string just has a leading '\"', a trailing '\"', and some number of escaped characters:</p>\n\n<pre><code>quotedString :: R String\nquotedString = char '\"' *&gt; many escapedChar &lt;* char '\"'\n\nmany :: R a -&gt; R [a]\nmany r = many1 r &lt;|&gt; return []\n\nescapedChar :: R Char\nescapedChar = R $ \\s -&gt; case s of\n  '\\\\' : '\\\\' : s               -&gt; [('\\\\', s)]\n  '\\\\' : '\"' : s                -&gt; [('\"', s)]\n  c : s | c /= '\\\\' &amp;&amp; c /= '\"' -&gt; [(c, s)]\n  _                             -&gt; []\n</code></pre>\n\n<hr>\n\n<p>It's worth noting the similarity between <code>many/many1</code> and <code>sepBy/sepBy1</code> - if we were really\nlazy, we could define one in terms of the other:</p>\n\n<pre><code>many1 r = r `sepBy1` return ()\nterm `sepBy1` delim = (:) &lt;$&gt; term &lt;*&gt; many (delim *&gt; term)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": false, "score": 1, "last_activity_date": 1496174346, "creation_date": 1496174346, "answer_id": 44270881, "question_id": 44269043, "link": "https://stackoverflow.com/questions/44269043/haskell-get-list-of-strings-from-file/44270881#44270881", "title": "Haskell: get list of strings from file", "body": "<p>Here is a quick and dirty parser.\nBe careful, it only works for well formed input, is not performant and code is not factorised. But there is no cheating ;)\nMaybe it could give you some inspiration to solve your exercise.</p>\n\n<pre><code>plaster :: String -&gt; String\nplaster ('P':'l':'a':'s':'t':'e':'r':' ':xs) = xs\nplaster s = undefined\n\n\nbrackets :: String -&gt; String\nbrackets ('[':xs) = brackets xs\nbrackets (x:']':_) = [x]\nbrackets (x:xs) = x:brackets xs\n\n\nquotes :: String -&gt; String\nquotes ('\"':xs) = quotes xs\nquotes (x:'\"':_) = [x]\nquotes (x:xs) = x:quotes xs\n\n\nsepByComma :: String -&gt; [String]\nsepByComma s = go s \"\"\n  where\n    go [] acc = [acc] \n    go (',':' ':xs) acc  = [acc] ++ go xs \"\"\n    go (x:xs) acc = go xs (acc ++ [x])\n\n\nparse :: String -&gt; [String]\nparse s = map quotes . sepByComma . brackets . plaster $ s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 0, "last_activity_date": 1496185179, "last_edit_date": 1496185179, "creation_date": 1496183229, "answer_id": 44272885, "question_id": 44269043, "link": "https://stackoverflow.com/questions/44269043/haskell-get-list-of-strings-from-file/44272885#44272885", "title": "Haskell: get list of strings from file", "body": "<p>Here is an alternative using only the very basics, no <code>Monads</code>, <code>Functors</code> or <code>Applicative</code> operators.</p>\n\n<pre><code>main :: IO()\nmain = do\n  input &lt;- getLine\n  let output = parse input\n  print output\n\nparse :: String -&gt; [String]\nparse = map stripQuotes . parse' . tokenize []\n  where\n    parse' :: [String] -&gt; [String]\n    -- If the input matches the pattern, call parseList on the inner tokens.\n    -- Does not nest brackets!  This is a simple regex match.\n    parse' (\"Plaster\":\"[\":tokens) | last tokens == \"]\" =\n      parseList [] (removeLast tokens)\n    parse' _ = error \"The input does not have the form \\\"Plaster [...]\\\".\"\n\nparseList :: [String] -&gt; [String] -&gt; [String]\n-- Empty list.\nparseList tokens [] = tokens\n-- Unexpected tokens.\nparseList _ (\",\":_) = error \"Unexpected comma.\"\nparseList _ (\"[\":_) = error \"No support for nested brackets.\"\nparseList _ (\"]\":_) = error \"Unexpected input after \\\"]\\\".\"\n-- One-element list.\nparseList tokens [x] = tokens ++ [x]\n-- Comma-separated list with at least two elements.\nparseList tokens (x:\",\":y:ys) = parseList (tokens ++ [x]) (y:ys)\n-- Comma at end of list, so we don\u2019t want to give the \"expected comma\" error!\nparseList _ [_,\",\"] = error \"Extra comma at end of list.\"\n-- More than one element not separated by commas.\nparseList _ (x:_) = error $ \"Expected comma after \\\"\" ++ x ++ \"\\\".\"\n\nstripQuotes :: String -&gt; String\nstripQuotes ('\"':xs) | last xs == '\"' = removeLast xs\nstripQuotes xs = error $ \"Expected string literal instead of \" ++ xs ++ \".\"\n\nremoveLast :: [a] -&gt; [a]\nremoveLast xs = take ((length xs) - 1) xs\n\nwhitespace :: [Char]\nwhitespace = [' ', '\\n', '\\t'] -- Incomplete, but sufficient.\n\nisWhitespace :: Char -&gt; Bool\nisWhitespace c = elem c whitespace\n\ntokenize :: [String] -&gt; String -&gt; [String]\n-- If we\u2019ve consumed all the input, we\u2019re done.\ntokenize tokens [] = tokens\n-- We\u2019d need something a little more complicated for longer operators:\ntokenize tokens ('[':xs) = tokenize (tokens ++ [\"[\"]) xs\ntokenize tokens (']':xs) = tokenize (tokens ++ [\"]\"]) xs\ntokenize tokens (',':xs) = tokenize (tokens ++ [\",\"]) xs\n-- Not currently processing a token, so skip whitespace.\n-- Otherwise, start a new token.\ntokenize tokens (x:xs) | isWhitespace x = tokenize tokens xs\n                       | otherwise      = tokenize' tokens [x] xs\n  where\n    tokenize' :: [String] -&gt; String -&gt; String -&gt; [String]\n-- If we\u2019ve consumed all the input, the current token is the last.\n    tokenize' ts t [] = ts ++ [t]\n-- If we encounter an operator, it is the token after the current one.\n    tokenize' ts t ('[':ys) = tokenize (ts ++ [t] ++ [\"[\"]) ys\n    tokenize' ts t (']':ys) = tokenize (ts ++ [t] ++ [\"]\"]) ys\n    tokenize' ts t (',':ys) = tokenize (ts ++ [t] ++ [\",\"]) ys\n-- Whitespace means the current token is complete.\n-- Otherwise, append y to the current token and continue.\n    tokenize' ts t (y:ys) | isWhitespace y = tokenize (ts ++ [t]) ys\n                          | otherwise      = tokenize' ts (t ++ [y]) ys\n</code></pre>\n\n<p>You wouldn\u2019t do this in production code; this is simple enough to do with a regex, and parsing is (more or less) a solved problem.  Parser combinators are the trendy way to go.</p>\n"}], "owner": {"reputation": 81, "user_id": 4932134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/92c3a3b5f55c987f250998225c44aa4b?s=128&d=identicon&r=PG&f=1", "display_name": "JayL", "link": "https://stackoverflow.com/users/4932134/jayl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 44270363, "answer_count": 4, "score": 1, "last_activity_date": 1496241517, "creation_date": 1496167620, "last_edit_date": 1496170774, "question_id": 44269043, "link": "https://stackoverflow.com/questions/44269043/haskell-get-list-of-strings-from-file", "title": "Haskell: get list of strings from file", "body": "<p>My input is:</p>\n\n<pre><code>Plaster [\"BD..\", \".GA.D\", \".FEG\", \"ABDCF\", \"E...\"]\n</code></pre>\n\n<p>What I'm trying to get:</p>\n\n<p><code>[\"BD..\", \".GA.D\", \".FEG\", \"ABDCF\", \"E...\"]</code></p>\n\n<p>My code for now:</p>\n\n<pre><code>go = do --print \"Enter file name\"\n        --path &lt;- getLine\n        file &lt;- (readFile \"1.txt\")\n        print file\n        let list = consume file \n        print list\n        let content = (wordsWhen (=='\"') list) \n        print content\n        print (content !! 0)\n        print (content !! 1)\n        print (content !! 2)\n\n\nwordsWhen :: (Char -&gt; Bool) -&gt; String -&gt; [String]\nwordsWhen p s =  case dropWhile p s of\n                      \"\" -&gt; []\n                      \", \" -&gt; []\n                      s' -&gt; w : wordsWhen p s''\n                            where (w, s'') = break p s'\n\nconsume []       = []\nconsume ('[':xs) = consume' xs\nconsume (_  :xs) = consume xs\n\nconsume' []       = [] \nconsume' (']':xs) = []\nconsume' (x  :xs) = x : consume' xs\n</code></pre>\n\n<p>So what I'm doing is</p>\n\n<ul>\n<li>Read file from destination (now hardcoded for testing)</li>\n<li>Get rid of the word \"Plaster\" with <code>consume</code></li>\n<li>Get all strings from file with <code>wordsWhen</code></li>\n</ul>\n\n<p>I tried different separators for <code>wordsWhen</code>, but I can't get what I need. In current form the output is:</p>\n\n<pre><code>\"Plaster [\\\"BD..\\\", \\\".GA.D\\\", \\\".FEG\\\", \\\"ABDCF\\\", \\\"E...\\\"]\"\n\"\\\"BD..\\\", \\\".GA.D\\\", \\\".FEG\\\", \\\"ABDCF\\\", \\\"E...\\\"\"\n[\"BD..\",\", \",\".GA.D\",\", \",\".FEG\",\", \",\"ABDCF\",\", \",\"E...\"]\n\"BD..\"\n\", \"\n\".GA.D\"\n</code></pre>\n\n<p>Which is quite accurate, but I want to get rid of this words that contains only commas. I can change the separator to comma (which it's supposed to be, I think), but then output is given with all this slashes and quotation marks, like this:</p>\n\n<pre><code>\"Plaster [\\\"BD..\\\", \\\".GA.D\\\", \\\".FEG\\\", \\\"ABDCF\\\", \\\"E...\\\"]\"\n\"\\\"BD..\\\", \\\".GA.D\\\", \\\".FEG\\\", \\\"ABDCF\\\", \\\"E...\\\"\"\n[\"\\\"BD..\\\"\",\" \\\".GA.D\\\"\",\" \\\".FEG\\\"\",\" \\\"ABDCF\\\"\",\" \\\"E...\\\"\"]\n\"\\\"BD..\\\"\"\n\" \\\".GA.D\\\"\"\n\" \\\".FEG\\\"\"\n</code></pre>\n\n<p>Is there a way to fix my code? Or should I do it in a different way?</p>\n\n<p>EDIT: As it is my exercise, I can only use standard types and functions. </p>\n"}, {"tags": ["haskell", "recursion", "directory", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1496212095, "post_id": 44271498, "comment_id": 75561511, "body": "I haven&#39;t thought about de-composing the problem as you did. Very nice. Probably this is a question for another SO question, but with this approach we might reach the limit of open directories since we&#39;re visiting them in a depth first search order, right?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1496243629, "post_id": 44271498, "comment_id": 75583778, "body": "@DamianNadales I don&#39;t think directories work like that. You don&#39;t open one and get a handle to it and use that like a cursor to list its contents . You just have a file path and make a syscall that gives you a list of the contents of that path at the time the syscall was made."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1496243726, "post_id": 44271498, "comment_id": 75583845, "body": "I thought I was using the directory stream as a cursor, since I&#39;m opening it, and iterating through its contents using: <code>readDirStream stream</code>..."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 3, "last_activity_date": 1496176670, "creation_date": 1496176670, "answer_id": 44271498, "question_id": 44267928, "link": "https://stackoverflow.com/questions/44267928/listing-all-the-files-under-a-directory-recursively-using-pipes/44271498#44271498", "title": "Listing all the files under a directory recursively, using Pipes", "body": "\n\n<p>Simply change this line:</p>\n\n<pre><code>| isDirectory stat = enumFiles path\n</code></pre>\n\n<p>to</p>\n\n<pre><code>| isDirectory stat = enumFiles path &gt;&gt; loop ds\n</code></pre>\n\n<p>The code was missing the recursion in this recursive case.</p>\n\n<p>You can also break this producer up into a composition of smaller producers and pipes:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nmodule Main where\n\nimport qualified Pipes.Prelude as P\nimport qualified Pipes.Safe as PS\n\nimport           Control.Monad\nimport           Pipes\nimport           System.FilePath.Posix\nimport           System.Posix.Directory\nimport           System.Posix.Files\n\nreadDirStream' :: FilePath -&gt; Producer' FilePath (PS.SafeT IO) ()\nreadDirStream' dirpath =\n  PS.bracket (openDirStream dirpath) closeDirStream (forever . loop)\n  where\n    loop stream =\n      liftIO (readDirStream stream) &gt;&gt;= yield\n\nenumFiles :: FilePath -&gt; Producer' FilePath (PS.SafeT IO) ()\nenumFiles path =\n  readDirStream' path\n    &gt;-&gt; P.takeWhile (/= \"\")\n    &gt;-&gt; P.filter (not . flip elem [\".\", \"..\"])\n    &gt;-&gt; P.map (path &lt;/&gt;)\n    &gt;-&gt; forever (do\n                    entry &lt;- await\n                    status &lt;- liftIO $ getSymbolicLinkStatus entry\n                    when (isDirectory status) (enumFiles entry)\n                    when (isRegularFile status) (yield entry))\n\nmain :: IO ()\nmain =\n  PS.runSafeT $ runEffect (enumFiles \"/tmp\" &gt;-&gt; P.stdoutLn)\n</code></pre>\n\n<p>I find it's often helpful to use <code>forever</code> from <code>Control.Monad</code> or one of the combinators from <code>Pipe.Prelude</code> instead of manual recursion; it helps cut down on small typos like this one. However, as the kids say, your mileage may very well vary.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 0, "accepted_answer_id": 44271498, "answer_count": 1, "score": 2, "last_activity_date": 1496176670, "creation_date": 1496163459, "question_id": 44267928, "link": "https://stackoverflow.com/questions/44267928/listing-all-the-files-under-a-directory-recursively-using-pipes", "title": "Listing all the files under a directory recursively, using Pipes", "body": "<p>I finished reading the <a href=\"https://hackage.haskell.org/package/pipes-4.3.3/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">Pipes tutorial</a>, and I wanted to write a function to list all the files in a directory, recursively. I tried with the following code:</p>\n\n<pre><code>enumFiles :: FilePath -&gt; Producer' FilePath (PS.SafeT IO) ()\nenumFiles path =\n  PS.bracket (openDirStream path) (closeDirStream) loop\n  where\n    loop :: DirStream -&gt; Producer' FilePath (PS.SafeT IO) ()\n    loop ds = PS.liftBase (readDirStream ds) &gt;&gt;= checkName\n      where\n        checkName :: FilePath -&gt; Producer' FilePath (PS.SafeT IO) ()\n        checkName \"\"   = return ()\n        checkName \".\"  = loop ds\n        checkName \"..\" = loop ds\n        checkName name = PS.liftBase (getSymbolicLinkStatus newPath)\n                         &gt;&gt;= checkStat newPath\n          where newPath = path &lt;/&gt; name\n\n        checkStat path stat\n          | isRegularFile stat = yield path &gt;&gt; loop ds\n          | isDirectory stat = enumFiles path\n          | otherwise = loop ds\n</code></pre>\n\n<p>However this producer will terminate as soon as the <code>return ()</code> is reached. I guess I'm not composing it in the right way, but I fail to see what is the correct way of doing this.</p>\n"}, {"tags": ["haskell", "yesod", "hspec", "haskell-persistent"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496170312, "post_id": 44266943, "comment_id": 75547600, "body": "I didn&#39;t even know you <i>could</i> mix qualified imports with import lists"}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 4, "last_activity_date": 1496160066, "creation_date": 1496160066, "answer_id": 44266943, "question_id": 44265492, "link": "https://stackoverflow.com/questions/44265492/how-does-import-database-persist-as-x-hiding-get-from-the-yesod-sqlite-templ/44266943#44266943", "title": "How does &quot;import Database.Persist as X hiding (get)&quot; from the yesod-sqlite template works", "body": "<p>The import line is importing everything in the <code>Database.Persist</code> module <strong>except</strong> <code>get</code>, optionally qualified.</p>\n\n<p>If I'm understanding correctly and you want to import <strong>only</strong> <code>get</code> qualified, and everything else unqualified, you could use:</p>\n\n<pre><code>import Database.Persist hiding (get)\nimport qualified Database.Persist as X (get)\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 44266943, "answer_count": 1, "score": 2, "last_activity_date": 1496160066, "creation_date": 1496155792, "question_id": 44265492, "link": "https://stackoverflow.com/questions/44265492/how-does-import-database-persist-as-x-hiding-get-from-the-yesod-sqlite-templ", "title": "How does &quot;import Database.Persist as X hiding (get)&quot; from the yesod-sqlite template works", "body": "<p>I am using the yesod-sqlite template and trying to use the <code>get</code> function from <code>Database.Persist</code> in a test.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>[Entity _ task] &lt;- runDB $ selectList [TaskName ==. name] []\n...\nuser &lt;- runDB $ X.get (taskUserId task)\n</code></pre>\n\n<p>And the error I am getting:</p>\n\n<pre><code>my_project/test/Handler/TaskSpec.hs:47:29: error:\nNot in scope: \u2018X.get\u2019\nNo module named \u2018X\u2019 is imported.\n</code></pre>\n\n<p>In the <code>TestImport.hs</code> file, I saw this line:</p>\n\n<pre><code>import Database.Persist      as X hiding (get)\n</code></pre>\n\n<p>To my understanding it should be hidding the <code>get</code> function from the HSpec module, so I could use <code>X.get</code> for database retrieving. I also tried with <code>Database.Persist.get</code> and just <code>get</code> with the same result.</p>\n\n<p>So my doubt is: what that line in <code>TestImport.hs</code> is doing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13788, "user_id": 3222797, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/H5JG2.png?s=128&g=1", "display_name": "gobrewers14", "link": "https://stackoverflow.com/users/3222797/gobrewers14"}, "edited": false, "score": 5, "creation_date": 1496156023, "post_id": 44265408, "comment_id": 75539236, "body": "How is it not working?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1496156445, "post_id": 44265408, "comment_id": 75539543, "body": "Guessing: the test <code>typeOfInt 27</code> must not be written inside the .hs file, but is an expression to be evaluated inside GHCi."}, {"owner": {"reputation": 9, "user_id": 8086319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e123b922263a80f3aaebdcc92de8b3f7?s=128&d=identicon&r=PG&f=1", "display_name": "Will", "link": "https://stackoverflow.com/users/8086319/will"}, "edited": false, "score": 0, "creation_date": 1496174410, "post_id": 44265408, "comment_id": 75549850, "body": "Thank you!!! Now I know."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 2, "creation_date": 1496217009, "post_id": 44265408, "comment_id": 75564468, "body": "Just a note, in future it&#39;s helpful to include the error message you receive."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 8086319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e123b922263a80f3aaebdcc92de8b3f7?s=128&d=identicon&r=PG&f=1", "display_name": "Will", "link": "https://stackoverflow.com/users/8086319/will"}, "edited": false, "score": 0, "creation_date": 1496174240, "post_id": 44266150, "comment_id": 75549764, "body": "Thanks a lot, very helpful !"}], "tags": [], "owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "is_accepted": false, "score": 7, "last_activity_date": 1496157717, "creation_date": 1496157717, "answer_id": 44266150, "question_id": 44265408, "link": "https://stackoverflow.com/questions/44265408/haskell-function-not-working-can-anyone-tell-me-why/44266150#44266150", "title": "haskell function not working, can anyone tell me why?", "body": "<p>The code itself it's ok and works, but it looks like you tried to evaluate the function in a Pythonic way, not exactly how you should use the functions in Haskell. You have to options here:</p>\n\n<ol>\n<li><p><strong>Using the REPL</strong>, by running <code>ghci</code> in the directory and then loading the file inside it (using the command <code>:l &lt;filename&gt;.hs</code>). Once in there, you can use the function interactively, by calling it like you are doing inside the file (<code>typeOfInt 27</code>) or with other functions (<code>map typeOfInt [1, 2, 3, 4, 5]</code>).</p></li>\n<li><p><strong>Creating a main method and compiling the file</strong>. The main method in Haskell has to be a <code>main :: IO ()</code> method, and that is what will be executed once you run a compiled file. </p></li>\n</ol>\n\n<p>For your example, you can use <code>putStrLn</code> to get the results that you seem to be looking for:</p>\n\n<pre><code>main :: IO ()\nmain = putStrLn $ typeOfInt 27\n</code></pre>\n\n<p>As you can see, in this case it is arguably more useful to use the <code>ghci</code> and play with the functions instead of compiling.</p>\n"}], "owner": {"reputation": 9, "user_id": 8086319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e123b922263a80f3aaebdcc92de8b3f7?s=128&d=identicon&r=PG&f=1", "display_name": "Will", "link": "https://stackoverflow.com/users/8086319/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496157717, "creation_date": 1496155531, "question_id": 44265408, "link": "https://stackoverflow.com/questions/44265408/haskell-function-not-working-can-anyone-tell-me-why", "title": "haskell function not working, can anyone tell me why?", "body": "<p>I am trying to tell the user if a given number is even or odd, but it doen't seem to work...</p>\n\n<pre><code>typeOfInt :: Int -&gt; String\n\ntypeOfInt integerValue\n  |integerValue `mod` 2 == 0 = \"even number\"\n  |otherwise = \"odd number\"\n\ntypeOfInt 27\n</code></pre>\n"}, {"tags": ["variables", "haskell", "scope"], "comments": [{"owner": {"reputation": 7141, "user_id": 1360803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/078e321f88c6fc29e2fa02e377b1c443?s=128&d=identicon&r=PG", "display_name": "Polygnome", "link": "https://stackoverflow.com/users/1360803/polygnome"}, "edited": false, "score": 2, "creation_date": 1496153407, "post_id": 44264567, "comment_id": 75537111, "body": "Where is <code>delete</code> defined?"}, {"owner": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "reply_to_user": {"reputation": 7141, "user_id": 1360803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/078e321f88c6fc29e2fa02e377b1c443?s=128&d=identicon&r=PG", "display_name": "Polygnome", "link": "https://stackoverflow.com/users/1360803/polygnome"}, "edited": false, "score": 0, "creation_date": 1496153825, "post_id": 44264567, "comment_id": 75537427, "body": "I was under the impression that that was a built-in function in Haskell: <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:delete\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496156599, "post_id": 44264567, "comment_id": 75539643, "body": "By the way, your <code>if</code> can be rewritten in a more readable form as <code>elem x ys &amp;&amp; subset ...</code>. Usually, we tend to avoid <code>==False</code> and <code>if..then False</code> in Haskell. Also <code>tail xs</code> looks wrong, are you sure you don&#39;t want <code>xs</code> instead ?"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "edited": false, "score": 0, "creation_date": 1496154339, "post_id": 44264848, "comment_id": 75537906, "body": "Thanks, I didn&#39;t know I had to import it. I think the result of that should be false though, since there is only a single 1 in the second list in your example"}, {"owner": {"reputation": 532, "user_id": 4461978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65cbeec2e15d270f994a402c72f9ee0f?s=128&d=identicon&r=PG&f=1", "display_name": "crvv", "link": "https://stackoverflow.com/users/4461978/crvv"}, "reply_to_user": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "edited": false, "score": 0, "creation_date": 1496154783, "post_id": 44264848, "comment_id": 75538275, "body": "I don&#39;t know what should <code>subset</code> do, so I just guess it. I guessed wrong."}, {"owner": {"reputation": 7141, "user_id": 1360803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/078e321f88c6fc29e2fa02e377b1c443?s=128&d=identicon&r=PG", "display_name": "Polygnome", "link": "https://stackoverflow.com/users/1360803/polygnome"}, "reply_to_user": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "edited": false, "score": 1, "creation_date": 1496155474, "post_id": 44264848, "comment_id": 75538818, "body": "@Meurth A  set can, mathematically speaking, not contain duplicates. In that case, <code>sublist</code> would probably the better name for your function, since lists/sequences can contain duplicates. from a mathematical point of view, {1, 1, 1} equals {1, 1} equals {1}."}, {"owner": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "reply_to_user": {"reputation": 7141, "user_id": 1360803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/078e321f88c6fc29e2fa02e377b1c443?s=128&d=identicon&r=PG", "display_name": "Polygnome", "link": "https://stackoverflow.com/users/1360803/polygnome"}, "edited": false, "score": 0, "creation_date": 1496156063, "post_id": 44264848, "comment_id": 75539260, "body": "@Polygnome Thanks for the reply, I suppose my teacher could learn something from that! :D"}], "tags": [], "owner": {"reputation": 532, "user_id": 4461978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65cbeec2e15d270f994a402c72f9ee0f?s=128&d=identicon&r=PG&f=1", "display_name": "crvv", "link": "https://stackoverflow.com/users/4461978/crvv"}, "is_accepted": true, "score": 4, "last_activity_date": 1496155836, "last_edit_date": 1496155836, "creation_date": 1496154027, "answer_id": 44264848, "question_id": 44264567, "link": "https://stackoverflow.com/questions/44264567/very-simple-haskell-code-doesnt-work-variable-not-in-scope/44264848#44264848", "title": "Very simple Haskell code doesn&#39;t work, &quot;Variable not in scope&quot;", "body": "<p><code>delete</code> needs to be imported. According to <a href=\"https://www.haskell.org/hoogle/?hoogle=delete\" rel=\"nofollow noreferrer\">https://www.haskell.org/hoogle/?hoogle=delete</a>, you should add <code>import Data.List</code> to the beginning.</p>\n\n<p>Besides, I guess your function <code>subset</code> is wrong. The result of <code>subset [1, 2, 1] [1, 2, 3]</code> is <code>False</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 7825753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lGCsBSGZgPg/AAAAAAAAAAI/AAAAAAAAACQ/j20IpPFISNM/photo.jpg?sz=128", "display_name": "Meurth", "link": "https://stackoverflow.com/users/7825753/meurth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1589, "favorite_count": 0, "accepted_answer_id": 44264848, "answer_count": 1, "score": 0, "last_activity_date": 1496158207, "creation_date": 1496153281, "last_edit_date": 1496158207, "question_id": 44264567, "link": "https://stackoverflow.com/questions/44264567/very-simple-haskell-code-doesnt-work-variable-not-in-scope", "title": "Very simple Haskell code doesn&#39;t work, &quot;Variable not in scope&quot;", "body": "<p>I'm new to Haskell and doing some simple exercises. For this exercise I'm writing a function that checks whether one list is a subset of another list using recursion.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>subset [] xs = True\n\nsubset (x:xs) ys = if elem x ys == False then False\n                   else subset (tail xs) (delete x ys)\n</code></pre>\n\n<p>I'm getting the following error message:</p>\n\n<pre><code>C:\\Functioneel programmeren\\week4.hs:9:43: error:\n    Variable not in scope: delete :: t1 -&gt; t t1 -&gt; t t1\n</code></pre>\n\n<p>What does this even mean?</p>\n\n<p>This program only works when I change \"(delete x ys)\" to \"ys\", but then it doesn't do what it's supposed to do.</p>\n\n<p>Any help would be great, thanks in advance.</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1496150777, "post_id": 44263370, "comment_id": 75535179, "body": "What are <code>satisfy</code> and <code>many</code>?"}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1496150841, "post_id": 44263370, "comment_id": 75535219, "body": "oh yeah, of course, sorry. I write it now."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1496152117, "post_id": 44263370, "comment_id": 75536214, "body": "Assuming your parser has a functor instance you should be able to do <code>parsePerson = Person &lt;$&gt; name</code>"}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "edited": false, "score": 0, "creation_date": 1496152799, "post_id": 44263370, "comment_id": 75536722, "body": "Oh man!! So easy was it :D yeah, I have a Functor instance  Thank you!!"}], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1496153584, "post_id": 44264412, "comment_id": 75537231, "body": "The key here is realizing that <code>Person</code> is both a type and a data constructor, the latter being just a function which takes a string argument and returns a value of type <code>Person</code>. It may be insightful to define the data type like this instead: <code>data Person = MkPerson String</code>, in which case <code>MkPerson</code> is a function that takes a string argument and returns a value of type <code>Person</code>."}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1496153810, "post_id": 44264412, "comment_id": 75537414, "body": "Thanks dude! And for example, if Person were <code>Person String Int</code> how should I do for taking the string and the int? I mean, I can have another parser for Numbers, but how it works? so? : <code>Person &lt;$&gt; name &lt;*&gt; numberParser</code> ? I just wanted to go a little bit &quot;deeper&quot; in haskell and I got some issues :D"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1496154111, "post_id": 44264412, "comment_id": 75537698, "body": "Yes that&#39;s the right approach. It relies on the applicative instance."}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1496154392, "post_id": 44264412, "comment_id": 75537952, "body": "For Example, from <code>parse parserPerson &quot;Person Chuck 25&quot;</code> I would like to get <code>Just (Person &quot;Chuck&quot; 25) </code>. If I do <code>Person &lt;$&gt; name1 &lt;*&gt; natural</code> I get  <code>Nothing</code>, but just because 1: Person and 2: the spaces. So, I gotta try to skip the spaces and &quot;eat&quot; person. But I think it&#39;s too much bitter now :D"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1496154548, "post_id": 44264412, "comment_id": 75538089, "body": "You could work through the parser tasks in the course <a href=\"https://github.com/data61/fp-course\" rel=\"nofollow noreferrer\">github.com/data61/fp-course</a>, that should cover enough to do the task you mentioned."}], "tags": [], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "is_accepted": true, "score": 1, "last_activity_date": 1496152888, "creation_date": 1496152888, "answer_id": 44264412, "question_id": 44263370, "link": "https://stackoverflow.com/questions/44263370/writing-a-parser-for-persons-in-haskell/44264412#44264412", "title": "Writing a parser for Persons in haskell", "body": "<p>As tsorn said, the answer was really easy...</p>\n\n<pre><code>parserPerson :: Parser Person\nparserPerson = Person &lt;$&gt; name1\n</code></pre>\n\n<p>and it works because the Functor Instacnce was defined. </p>\n\n<pre><code>instance Functor Parser where\n  fmap f (Parser p) = Parser $ \\s -&gt; map (\\(a,b) -&gt; (f a, b)) $ p s\n</code></pre>\n"}], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 44264412, "answer_count": 1, "score": 2, "last_activity_date": 1496152888, "creation_date": 1496150168, "last_edit_date": 1496151053, "question_id": 44263370, "link": "https://stackoverflow.com/questions/44263370/writing-a-parser-for-persons-in-haskell", "title": "Writing a parser for Persons in haskell", "body": "<p>I'm trying to write a parser for a data Person (<code>data Person</code>). But I have to write it in just one line using <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> and I was trying a lot, but I'm getting really \"overtaxed\".</p>\n\n<p>The parser type is as usual:</p>\n\n<p><code>newtype Parser a = Parser (String -&gt; [(a,String)])</code></p>\n\n<p>And I have this function: </p>\n\n<p><code>parse :: Parser a -&gt; String -&gt; Maybe a</code></p>\n\n<p>that returns the first complete parse. </p>\n\n<p><strong>e.g.</strong> </p>\n\n<p>if I have this easy function: </p>\n\n<pre><code>upper :: Parser Char\nupper = satisfy isUpper\n</code></pre>\n\n<p>If I run <code>parse upper \"A\"</code> I get <code>Just 'A'</code></p>\n\n<p>I also have a funnier function like this:</p>\n\n<pre><code>name :: Parser String\nname = (:) &lt;$&gt; (satisfy isUpper) &lt;*&gt; (many $ satisfy isAlpha)\n</code></pre>\n\n<p>which, as you can see, accepts all strings that are literal characters and begin with an upper Letter. </p>\n\n<p>so:</p>\n\n<pre><code>*Main&gt; parse name1 \"hello\"\nNothing\n*Main&gt; parse name1 \"Hello\"\nJust \"Hello\"\n</code></pre>\n\n<p>Until now is everything fine, the only problem is that I have to do something like that for the class (data, type ?!) Person (<code>data Person</code>)</p>\n\n<p>so, I have this: </p>\n\n<p><code>data Person = Person String deriving (Eq, Show)</code></p>\n\n<p>And then, in just one line, I have to write the parser for <code>Person</code>, but the name should satisfy the function <code>name</code>, it means, the name should be just a chain of literal characters, where the first one is upper case. </p>\n\n<p>And it should work so:</p>\n\n<pre><code>&gt; parse parserPerson \"Chuck\"\n Just (Person \"Chuck\")\n&gt; parse parserPerson \"chuck\"\n Nothing\n</code></pre>\n\n<p>where:</p>\n\n<pre><code>parserPerson :: Parser Person\nparserPerson = ???\n</code></pre>\n\n<p>As you can see, bevor \"Chuck\" there is <code>Person</code>, so I've to use somehow <code>*&gt;</code> to get it. </p>\n\n<p>And that's it, just a line with <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code> and <code>*&gt;</code> that works that way.</p>\n\n<p>I don't have a clue, and I'm getting crazy with this. Maybe anyone could help me. </p>\n\n<p><strong>EDIT</strong></p>\n\n<pre><code>satisfy :: (Char -&gt; Bool) -&gt; Parser Char -- parse a desired character\nsatisfy p = Parser check\n  where\n    check (c:s) | p c = [(c,s)] -- successful\n    check   _   = [     ] -- no parse\n</code></pre>\n\n<p>and <code>many</code> (as <code>some</code>) are functions from the <code>Control.Applicative</code> <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\">Control.Applicative</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1496151058, "post_id": 44263096, "comment_id": 75535382, "body": "<i>and</i>, <code>const (++) 1 &quot;hello&quot; &quot;you&quot;</code> is the same as <code>(((const (++)) 1) &quot;hello&quot;) &quot;you&quot;</code> is the same as <code>((const (++) 1) &quot;hello&quot;) &quot;you&quot;</code> is the same as <code>( (++) &quot;hello&quot;) &quot;you&quot;</code> is the same is <code>(++) &quot;hello&quot; &quot;you&quot;</code> which is <code>&quot;hello&quot; ++ &quot;you&quot;</code>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1496149489, "creation_date": 1496149489, "answer_id": 44263096, "question_id": 44262986, "link": "https://stackoverflow.com/questions/44262986/type-of-const-in-haskell/44263096#44263096", "title": "Type of const (++) in Haskell", "body": "<blockquote>\n  <p>How come the thing that is returned from the const operation is not the first argument</p>\n</blockquote>\n\n<p>It is. The first argument to <code>const</code> is <code>(++)</code>. So the result of the operation <code>const (++) 1</code> is in fact <code>(++)</code>, which is the first argument. So <code>const (++) 1</code> is <code>(++)</code>, meaning <code>const (++) 1 \"hello\" \"you\"</code> is <code>(++) \"hello\" \"you\"</code> and that is <code>\"helloyou\"</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1496149587, "creation_date": 1496149587, "answer_id": 44263134, "question_id": 44262986, "link": "https://stackoverflow.com/questions/44262986/type-of-const-in-haskell/44263134#44263134", "title": "Type of const (++) in Haskell", "body": "<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n      \u2261 ([a] -&gt; [a] -&gt; [a])\n\nconst :: c -&gt; b -&gt; c\n</code></pre>\n\n<p>Now, in <code>const (++)</code>, you want to give <code>(++)</code> as an argument to <code>const</code>. The argument to <code>const</code> should have type <code>c</code>, so you unify that with the type of <code>(++)</code></p>\n\n<pre><code>     c  ~  ([a] -&gt; [a] -&gt; [a])\n</code></pre>\n\n<p>and get the specialised version</p>\n\n<pre><code>const :: ([a] -&gt; [a] -&gt; [a]) -&gt; b -&gt; ([a] -&gt; [a] -&gt; [a])\n</code></pre>\n\n<p>If that looks confusing, consider the simpler case of <code>const 1</code>. If the <code>1</code> has type <code>Int</code>, then we must have <code>c ~ Int</code> and in that case</p>\n\n<pre><code>const :: Int -&gt; b -&gt; Int\n</code></pre>\n\n<p>Because function arrows are right-associative, the <code>(++)</code>-specialisation can also be written</p>\n\n<pre><code>const :: ([a] -&gt; [a] -&gt; [a]) -&gt; b -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Now if you actually apply that to <code>(++)</code>, you saturate the function argument and end up with</p>\n\n<pre><code>const (++) :: b -&gt; [a] -&gt; [a] -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8086500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d95f9d69cd4be6200257afe5b6d3da2?s=128&d=identicon&r=PG&f=1", "display_name": "Nicrophorus", "link": "https://stackoverflow.com/users/8086500/nicrophorus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 44263096, "answer_count": 2, "score": 3, "last_activity_date": 1496151582, "creation_date": 1496149190, "last_edit_date": 1496151582, "question_id": 44262986, "link": "https://stackoverflow.com/questions/44262986/type-of-const-in-haskell", "title": "Type of const (++) in Haskell", "body": "<p>I'm trying to understand the type of the expression const <code>(++)</code> in Haskell. I know the individual types of <code>const</code> and <code>(++)</code> and I know that you can leave out parameters in order to return partially applied functions.</p>\n\n<p>If I type <code>:t const (++)</code> I get <code>const (++) :: b -&gt; [a] -&gt; [a] -&gt; [a]</code>. The way I think is that <code>(++)</code> wants two lists (I know however that all functions in Haskell are curried functions that actually just take one argument) and returns a list. This list is then the first argument to the <code>const</code> function, which waits for one more argument. So, I thought the type would be <code>const (++) :: [a] -&gt; [a] -&gt; b -&gt; [a].</code></p>\n\n<p>But for example: <code>const (++) 1 \"hello\" \"you\"</code> returns <code>\"helloyou\"</code>. How come the thing that is returned from the <code>const</code> operation is not the first argument, according to the definition of <code>const</code> which is <code>const x _ = x</code>? Where in my thought process am I incorrect?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1213, "user_id": 544707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LVoaL.jpg?s=128&g=1", "display_name": "Anler", "link": "https://stackoverflow.com/users/544707/anler"}, "edited": false, "score": 0, "creation_date": 1496151808, "post_id": 44261959, "comment_id": 75535984, "body": "the function looks fine but it seems you are using it wrong, next time try to put the usage of the function too"}, {"owner": {"reputation": 15, "user_id": 5627857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fefe49c001efdd2d2407a169e44a57f1?s=128&d=identicon&r=PG&f=1", "display_name": "Aeglen", "link": "https://stackoverflow.com/users/5627857/aeglen"}, "reply_to_user": {"reputation": 1213, "user_id": 544707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LVoaL.jpg?s=128&g=1", "display_name": "Anler", "link": "https://stackoverflow.com/users/544707/anler"}, "edited": false, "score": 0, "creation_date": 1496151969, "post_id": 44261959, "comment_id": 75536109, "body": "Oops, that would be Main&gt; Bin 1001"}, {"owner": {"reputation": 1213, "user_id": 544707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LVoaL.jpg?s=128&g=1", "display_name": "Anler", "link": "https://stackoverflow.com/users/544707/anler"}, "edited": false, "score": 0, "creation_date": 1496164283, "post_id": 44261959, "comment_id": 75544332, "body": "no worries, just wanted to give you that hint so you can find help quicker ;)"}], "answers": [{"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496167307, "post_id": 44262105, "comment_id": 75545891, "body": "Or <code>bin &quot;1001&quot;</code>."}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 1, "last_activity_date": 1496146794, "creation_date": 1496146794, "answer_id": 44262105, "question_id": 44261959, "link": "https://stackoverflow.com/questions/44261959/haskell-unresolved-overloading/44262105#44262105", "title": "Haskell &quot;Unresolved Overloading&quot;", "body": "<p>You are using the function with incorrect type, that is <code>Int</code> (<code>1001</code>) when it really epects <code>[Char]</code>, e.g. <code>bin ['1','0','0','1']</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 5627857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fefe49c001efdd2d2407a169e44a57f1?s=128&d=identicon&r=PG&f=1", "display_name": "Aeglen", "link": "https://stackoverflow.com/users/5627857/aeglen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 44262105, "answer_count": 1, "score": 0, "last_activity_date": 1502386513, "creation_date": 1496146422, "last_edit_date": 1502386513, "question_id": 44261959, "link": "https://stackoverflow.com/questions/44261959/haskell-unresolved-overloading", "title": "Haskell &quot;Unresolved Overloading&quot;", "body": "<p>The following code to enumerate \"backwards binary\"</p>\n\n<pre><code>bin :: [Char] -&gt; Int\nbin a = temp (a, 1)\n    where\n        temp :: ([Char], Int) -&gt; Int\n        temp ([], n) = 0\n        temp (('1':x), n) = temp(x, (n*2)) + 1*n\n        temp (('0':x), n) = temp(x, (n*2))\n</code></pre>\n\n<p>produces the following error:</p>\n\n<pre><code> TYPE - Unresolved Overloading\n *** Type       : Num [Char] =&gt; Int\n *** Expression : Bin 1001\n</code></pre>\n\n<p>Similar code worked fine when it was [Int] -> Int, I have no idea why it doesn't work this way. </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1496149521, "post_id": 44262947, "comment_id": 75534175, "body": "It worked! Silly me, I never noticed that package names were case sensitive. Thank you."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1496149699, "post_id": 44262947, "comment_id": 75534295, "body": "But, thinking about it, would an error message saying that Stack cannot find the misspelled package name be more useful for troubleshooting?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1496253221, "post_id": 44262947, "comment_id": 75589712, "body": "I thought something like that existed, but it clearly didn&#39;t work here. Maybe you&#39;d be interested in trying out a PR for the feature?"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1496149094, "creation_date": 1496149094, "answer_id": 44262947, "question_id": 44261192, "link": "https://stackoverflow.com/questions/44261192/issue-with-win32-package-in-haskell-stack/44262947#44262947", "title": "Issue with Win32 package in Haskell Stack", "body": "<p>It looks like a case sensitivity issue to me, can you try adding it as Win32.</p>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 44262947, "answer_count": 1, "score": 0, "last_activity_date": 1496149094, "creation_date": 1496144177, "last_edit_date": 1496146075, "question_id": 44261192, "link": "https://stackoverflow.com/questions/44261192/issue-with-win32-package-in-haskell-stack", "title": "Issue with Win32 package in Haskell Stack", "body": "<p>I am on <a href=\"https://www.stackage.org/lts-8.15\" rel=\"nofollow noreferrer\">LTS 8.15</a>. I am starting a basic, default, library for which I will need to use the <a href=\"https://www.stackage.org/nightly-2017-05-28/package/Win32-2.3.1.1\" rel=\"nofollow noreferrer\">win32 package</a>.</p>\n\n<p>Using these dependencies in the cabal file :</p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                       , win32\n</code></pre>\n\n<p>I get the following error message :</p>\n\n<pre><code>While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for w32test-0.1.0.0:\n    win32 must match -any, but the stack configuration has no specified version\n\nPlan construction failed.\n</code></pre>\n\n<p>I tried to force a package version : </p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                       , win32 == 2.3.1.1\n</code></pre>\n\n<p>but I got the same error message again :</p>\n\n<pre><code>While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for w32test-0.1.0.0:\n    win32 must match ==2.3.1.1, but the stack configuration has no specified version\n\nPlan construction failed.\n</code></pre>\n\n<p>In case it matters for the answer, here is my minimalistic stack.yaml file :</p>\n\n<pre><code>resolver: lts-8.15\npackages:\n- '.'\nextra-deps: []\nflags: {}\nextra-package-dbs: []\n</code></pre>\n\n<p><strong>My question</strong> : I do not understand what's going wrong, can anyone suggest a way to fix the issue?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1496143903, "post_id": 44261005, "comment_id": 75529928, "body": "Thank you very much. It works excellent with Just. If I would like to construct a Node which takes something or may be empty without using the Just word, is there any way to do it?"}, {"owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1496145415, "post_id": 44261005, "comment_id": 75530980, "body": "Thanks a lot. With this example along with the explanation from Chris I think I got it. Cheers."}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": false, "score": 4, "last_activity_date": 1496144227, "last_edit_date": 1496144227, "creation_date": 1496143603, "answer_id": 44261005, "question_id": 44260864, "link": "https://stackoverflow.com/questions/44260864/constructing-a-parametric-data-type/44261005#44261005", "title": "Constructing a parametric data type", "body": "<p>You have defined your datatype using <code>Maybe</code>, so you have to wrap the value in <code>Just</code>:</p>\n\n<pre><code>Node (Just 6). \n</code></pre>\n\n<p>If you just want to have a type which can be either empty or have defined value, define it in the following way:</p>\n\n<pre><code>data Node b = Empty | Node b deriving (Show)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1496144217, "post_id": 44261105, "comment_id": 75530173, "body": "Thanks a lot. This explanation makes it a lot more clearer to me. Cheers."}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 5, "last_activity_date": 1496156770, "last_edit_date": 1496156770, "creation_date": 1496143893, "answer_id": 44261105, "question_id": 44260864, "link": "https://stackoverflow.com/questions/44260864/constructing-a-parametric-data-type/44261105#44261105", "title": "Constructing a parametric data type", "body": "<p>The statement <code>data Node a = Node (Maybe a) deriving (Show)</code> creates a data constructor (which is a function) of type <code>Node :: Maybe a -&gt; Node a</code> in other words, you need to pass a value of type <code>Maybe a</code> to this function.</p>\n\n<p>You have passed <code>6</code> which is not of type <code>Maybe a</code>.</p>\n\n<p>Instead you can pass a <code>Just 6</code> value like so:\n<code>Node (Just 6)</code>. </p>\n"}], "owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1496156770, "creation_date": 1496143210, "last_edit_date": 1496143673, "question_id": 44260864, "link": "https://stackoverflow.com/questions/44260864/constructing-a-parametric-data-type", "title": "Constructing a parametric data type", "body": "<p>I am trying to define a data type in Haskell. This datatype will be called \nNode. It will be able to contain a parametric type a  or Nothing. I defined it so: </p>\n\n<pre><code>data Node a = Node (Maybe a) deriving (Show)\n</code></pre>\n\n<p>When I load it in GHC the following works \nNode Nothing</p>\n\n<p>However when I type this for example \nNode (6) </p>\n\n<p>I get the following error:</p>\n\n<pre><code>Non type-variable argument in the constraint: Num (Maybe a)\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall a. Num (Maybe a) =&gt; Node a\n</code></pre>\n\n<p>Why is that?  what am I doing wrong? </p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1496137291, "post_id": 44257862, "comment_id": 75525479, "body": "How did you produce the output <code>Monoid m =&gt; Applicative (Const * m)</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1496142783, "post_id": 44257862, "comment_id": 75529114, "body": "merely copied it from <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#v:Const\" rel=\"nofollow noreferrer\">Hackage</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496143942, "post_id": 44258587, "comment_id": 75529957, "body": "Ah OK, this <code>Const * m</code> confused me. <code>Const m</code> is still polymorphic and since the second type variable is never touched, it can be everything, including a function. This makes perfect sense for a constant on the type level. magnificent!"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1496145156, "post_id": 44258587, "comment_id": 75530802, "body": "Hackage has some weirdness (I think with <code>PolyKinds</code> turned on?) where it sometimes displays the kind parameters explicitly like this. <code>Const * m</code> I think might be because the second type parameter is polykinded (since it&#39;s phantom), but to instantiate <code>Applicative</code> <code>Const m</code> needs to be <code>* -&gt; *</code>, hence the kind parameter to <code>Const</code> (the kind of the type parameter that hasn&#39;t been filled yet) needs to be given as <code>*</code>. So the <code>m</code> is the <i>first</i> type parameter, and the <code>*</code> is a kind parameter that usually is left implicit, so you&#39;re not used to setting it. Something like that, anyway."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 4, "last_activity_date": 1496138108, "last_edit_date": 1496138108, "creation_date": 1496136844, "answer_id": 44258587, "question_id": 44257862, "link": "https://stackoverflow.com/questions/44257862/why-does-of-the-const-instance-accept-two-non-functional-values/44258587#44258587", "title": "Why does &lt;*&gt; of the Const instance accept two non-functional values?", "body": "<p>First if <code>m</code> has a <code>Monoid</code> instance, then <code>Const m</code> has a <code>Applicative</code> instance. But <code>Const m</code> is still a type constructor, so the type of <code>&lt;*&gt;</code>\nfor <code>Applicative (Const m)</code> reads</p>\n\n<pre><code>     (&lt;*&gt;) :: Const m (a -&gt; b) -&gt; Const m a -&gt; Const m b  \n</code></pre>\n\n<p>Now let apply this to <code>Const \"a\"</code> and <code>Const \"b\"</code>:</p>\n\n<p><code>Const \"a\"</code> is of type <code>Const String b</code>. So here the type variable <code>m</code> from above assumes the type <code>String</code>. The value is still polymorphic with respect to <code>b</code> and as it doesn't contain a concrete value of that type, the type can still be anything.</p>\n\n<p>In the expression <code>Const \"a\" &lt;*&gt; Const \"b\"</code> the polymorphic value <code>Const \"a\"</code> will be forced to be of type <code>Const String (a-&gt;b)</code> and the polymorphic value <code>Const \"b\"</code> will be forced to be of type <code>Const String a</code>.</p>\n\n<p>So there really is a type with a function type inside on the left side, just the concrete value doesn't contain a function, like with value <code>Nothing</code> of type <code>Maybe (Int -&gt; Int)</code>.</p>\n\n<p>PS.: I don't know where the <code>*</code> comes from in <code>Monoid m =&gt; Applicative (Const * m)</code>. If I type</p>\n\n<pre><code>    :info Const\n</code></pre>\n\n<p>in ghci, I get the line</p>\n\n<pre><code>    instance Monoid m =&gt; Applicative (Const m)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 44258587, "answer_count": 1, "score": 3, "last_activity_date": 1496138108, "creation_date": 1496134986, "question_id": 44257862, "link": "https://stackoverflow.com/questions/44257862/why-does-of-the-const-instance-accept-two-non-functional-values", "title": "Why does &lt;*&gt; of the Const instance accept two non-functional values?", "body": "<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\nConst :: a -&gt; Const a b\nMonoid m =&gt; Applicative (Const * m)\n\nConst \"a\" &lt;*&gt; Const \"b\" -- yields Const \"ab\"\nConst a &lt;*&gt; Const a = Const a &lt;&gt; Const a\n</code></pre>\n\n<p>I guess this behavior must have something to do with the fact that <code>Const</code> is a binary type constructor, where <code>b</code> is never touched (phantom type). But then again I don't understand <code>Const * m</code>, because <code>a</code> (and <code>*</code> respectively) seems to be discarded in this case.</p>\n"}, {"tags": ["haskell", "applicative", "quickcheck"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1496134676, "post_id": 44257225, "comment_id": 75523567, "body": "Try enabling <code>{-# LANGUAGE ScopedTypeVariables #-}</code> and then <code>forall</code>-quantifying any type variables in the signature that you mention in the body."}], "answers": [{"tags": [], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "is_accepted": true, "score": 1, "last_activity_date": 1496172260, "creation_date": 1496172260, "answer_id": 44270351, "question_id": 44257225, "link": "https://stackoverflow.com/questions/44257225/how-to-quickcheck-applicative-homomorphism-property/44270351#44270351", "title": "How to quickcheck applicative homomorphism property?", "body": "<p>luqui's suggestion solved this for me.</p>\n\n<p>The problem was I needed to use <code>ScopedTypeVariables</code> and  <code>forall</code> in order to refer to type parameters outside their type signature in the function body's type annotations.</p>\n\n<p>Some relevant resources on <code>ScopedTypeVariables</code> I came across:</p>\n\n<ul>\n<li><a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-20-scoped-type-variables.html\" rel=\"nofollow noreferrer\">24 Days of GHC Extensions: Scoped Type Variables</a></li>\n<li><a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">Haskell wiki: Scoped type variables</a></li>\n<li><a href=\"https://en.wikibooks.org/wiki/Haskell/Existentially_quantified_types#The_forall_keyword\" rel=\"nofollow noreferrer\">Wikibooks: Haskell/Existentially\nquantified types</a></li>\n</ul>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 44270351, "answer_count": 1, "score": 1, "last_activity_date": 1496172260, "creation_date": 1496132973, "question_id": 44257225, "link": "https://stackoverflow.com/questions/44257225/how-to-quickcheck-applicative-homomorphism-property", "title": "How to quickcheck applicative homomorphism property?", "body": "<p>As an exercise, I am trying to quickCheck the applicative's homomorphism property:</p>\n\n<blockquote>\n  <p>pure f &lt;*> pure x = pure (f x)</p>\n</blockquote>\n\n<p>When I try to write the property in a general way using phantom types, I seem to run into endless 'Could not deduce' errors. At this point I have added many type annotations to my code, and still am getting these errors.</p>\n\n<p>My code is:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n\nimport Test.QuickCheck (quickCheck)\nimport Test.QuickCheck.Function (Fun, apply)\n\n-- | phantom type\ndata T a = T\n\n-- | pure f &lt;*&gt; pure x = pure (f x)\nprop_homomorphism :: (Applicative f, Eq b, Eq (f b)) =&gt; (T a) -&gt; (T (f b)) -&gt; Fun a b -&gt; a -&gt; Bool\nprop_homomorphism T T (apply -&gt; g) x = (pure (g :: a -&gt; b) &lt;*&gt; pure x :: (Applicative f, Eq (f b)) =&gt; f b) == (pure (g x) :: (A\npplicative f, Eq (f b)) =&gt; f b)\n\n\nprop_maybeint :: IO ()\nprop_maybeint = do\n  quickCheck (prop_homomorphism (T :: T Int) (T :: T (Maybe Int)))\n\n\nmain = do\n  prop_maybeint\n</code></pre>\n\n<p>And the errors this gives are:</p>\n\n<pre><code>applicativehomomorphism.hs:11:40: error:\n    \u2022 Could not deduce (Eq (f0 b0)) arising from a use of \u2018==\u2019\n      from the context: (Applicative f, Eq b, Eq (f b))\n        bound by the type signature for:\n                   prop_homomorphism :: (Applicative f, Eq b, Eq (f b)) =&gt;\n                                        T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n        at applicativehomomorphism.hs:10:1-98\n      The type variables \u2018f0\u2019, \u2018b0\u2019 are ambiguous\n      These potential instances exist:\n        instance Eq a =&gt; Eq (Maybe a) -- Defined in \u2018GHC.Base\u2019\n        instance (Eq a, Eq b) =&gt; Eq (a, b) -- Defined in \u2018GHC.Classes\u2019\n        instance (Eq a, Eq b, Eq c) =&gt; Eq (a, b, c)\n          -- Defined in \u2018GHC.Classes\u2019\n        ...plus 13 others\n        ...plus one instance involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression:\n        (pure (g :: a -&gt; b) &lt;*&gt; pure x :: (Applicative f, Eq (f b)) =&gt; f b)\n        == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n      In an equation for \u2018prop_homomorphism\u2019:\n          prop_homomorphism T T (apply -&gt; g) x\n            = (pure (g :: a -&gt; b) &lt;*&gt; pure x ::\n                 (Applicative f, Eq (f b)) =&gt; f b)\n              == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n\napplicativehomomorphism.hs:11:41: error:\n    \u2022 Could not deduce (Applicative f0)\n        arising from an expression type signature\n      from the context: (Applicative f, Eq b, Eq (f b))\n        bound by the type signature for:\n                   prop_homomorphism :: (Applicative f, Eq b, Eq (f b)) =&gt;\n                                        T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n        at applicativehomomorphism.hs:10:1-98\n      The type variable \u2018f0\u2019 is ambiguous\n      These potential instances exist:\n        instance Applicative IO -- Defined in \u2018GHC.Base\u2019\n        instance Applicative Maybe -- Defined in \u2018GHC.Base\u2019\n        instance Applicative ((-&gt;) a) -- Defined in \u2018GHC.Base\u2019\n        ...plus two others\n        ...plus two instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018(==)\u2019, namely\n        \u2018(pure (g :: a -&gt; b) &lt;*&gt; pure x ::\n            (Applicative f, Eq (f b)) =&gt; f b)\u2019\n      In the expression:\n        (pure (g :: a -&gt; b) &lt;*&gt; pure x :: (Applicative f, Eq (f b)) =&gt; f b)\n        == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n      In an equation for \u2018prop_homomorphism\u2019:\n          prop_homomorphism T T (apply -&gt; g) x\n            = (pure (g :: a -&gt; b) &lt;*&gt; pure x ::\n                 (Applicative f, Eq (f b)) =&gt; f b)\n              == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n\napplicativehomomorphism.hs:11:47: error:\n    \u2022 Couldn't match type \u2018b\u2019 with \u2018b2\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          prop_homomorphism :: forall (f :: * -&gt; *) b a.\n                               (Applicative f, Eq b, Eq (f b)) =&gt;\n                               T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n        at applicativehomomorphism.hs:10:22\n      \u2018b2\u2019 is a rigid type variable bound by\n        an expression type signature:\n          forall a1 b2. a1 -&gt; b2\n        at applicativehomomorphism.hs:11:52\n      Expected type: a1 -&gt; b2\n        Actual type: a -&gt; b\n    \u2022 In the first argument of \u2018pure\u2019, namely \u2018(g :: a -&gt; b)\u2019\n      In the first argument of \u2018(&lt;*&gt;)\u2019, namely \u2018pure (g :: a -&gt; b)\u2019\n      In the first argument of \u2018(==)\u2019, namely\n        \u2018(pure (g :: a -&gt; b) &lt;*&gt; pure x ::\n            (Applicative f, Eq (f b)) =&gt; f b)\u2019\n    \u2022 Relevant bindings include\n        g :: a -&gt; b (bound at applicativehomomorphism.hs:11:33)\n        prop_homomorphism :: T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n          (bound at applicativehomomorphism.hs:11:1)\n\napplicativehomomorphism.hs:11:112: error:\n    \u2022 Couldn't match type \u2018b\u2019 with \u2018b1\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          prop_homomorphism :: forall (f :: * -&gt; *) b a.\n                               (Applicative f, Eq b, Eq (f b)) =&gt;\n                               T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n        at applicativehomomorphism.hs:10:22\n      \u2018b1\u2019 is a rigid type variable bound by\n        an expression type signature:\n          forall (f1 :: * -&gt; *) b1. (Applicative f1, Eq (f1 b1)) =&gt; f1 b1\n        at applicativehomomorphism.hs:11:126\n      Expected type: f1 b1\n        Actual type: f1 b\n    \u2022 In the second argument of \u2018(==)\u2019, namely\n        \u2018(pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\u2019\n      In the expression:\n        (pure (g :: a -&gt; b) &lt;*&gt; pure x :: (Applicative f, Eq (f b)) =&gt; f b)\n        == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n      In an equation for \u2018prop_homomorphism\u2019:\n          prop_homomorphism T T (apply -&gt; g) x\n            = (pure (g :: a -&gt; b) &lt;*&gt; pure x ::\n                 (Applicative f, Eq (f b)) =&gt; f b)\n              == (pure (g x) :: (Applicative f, Eq (f b)) =&gt; f b)\n    \u2022 Relevant bindings include\n        g :: a -&gt; b (bound at applicativehomomorphism.hs:11:33)\n        prop_homomorphism :: T a -&gt; T (f b) -&gt; Fun a b -&gt; a -&gt; Bool\n          (bound at applicativehomomorphism.hs:11:1)\n</code></pre>\n\n<p>I've been fighting with this for a while and am pretty stuck. What is my problem?</p>\n"}, {"tags": ["haskell", "iteration", "towers-of-hanoi"], "comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1496133419, "post_id": 44257214, "comment_id": 75522763, "body": "You want us to explain Haskell syntax of this function, Towers of Hanoi solution or both?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8085149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/113d72e439d659bf0d199847bd4384c9?s=128&d=identicon&r=PG&f=1", "display_name": "Henning", "link": "https://stackoverflow.com/users/8085149/henning"}, "edited": false, "score": 0, "creation_date": 1496134573, "post_id": 44257568, "comment_id": 75523495, "body": "Thanks a lot for your comments ! Yes I am understanding the algorithm, but I need to understand Haskell."}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "reply_to_user": {"reputation": 1, "user_id": 8085149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/113d72e439d659bf0d199847bd4384c9?s=128&d=identicon&r=PG&f=1", "display_name": "Henning", "link": "https://stackoverflow.com/users/8085149/henning"}, "edited": false, "score": 0, "creation_date": 1496134614, "post_id": 44257568, "comment_id": 75523529, "body": "That&#39;s what I explained in my answer, hope it&#39;s clear."}, {"owner": {"reputation": 1, "user_id": 8085149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/113d72e439d659bf0d199847bd4384c9?s=128&d=identicon&r=PG&f=1", "display_name": "Henning", "link": "https://stackoverflow.com/users/8085149/henning"}, "edited": false, "score": 0, "creation_date": 1496390576, "post_id": 44257568, "comment_id": 75652334, "body": "Can you try to give me a more easier answer ?, I don&#180;t understand the binary calculation."}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 2, "last_activity_date": 1496134040, "creation_date": 1496134040, "answer_id": 44257568, "question_id": 44257214, "link": "https://stackoverflow.com/questions/44257214/tower-of-hanoi-haskell/44257568#44257568", "title": "Tower of Hanoi Haskell", "body": "<p>I will assume if you understand the general algorithm of solving Towers of Hanoi problem.</p>\n\n<p>What goes on in your code, line by line: </p>\n\n<ol>\n<li><p><code>import Data.Bits</code> we are importing bit-manipulation functions, the ones we will use in our case are <code>.&amp;.</code>, <code>.|.</code> and <code>shift</code>.</p></li>\n<li><p><code>hanoi :: Int -&gt; [(Int, Int)]</code> the function takes one argument (number of discs) and returns a list of pairs representing moves (format: <code>(from, to)</code>).</p></li>\n<li><code>hanoi n = map ...</code> . We are mapping this a function over this list <code>[1..shift 1 n]</code>, which stores subsequent left bit shifts (<code>1 &lt;&lt; n</code>) from <code>1</code> to <code>n</code>.\n3a. The mapping function (<code>(\\x -&gt; ((x .&amp;. (x-1))</code>mod<code>3, ((x .|. (x-1)) + 1)</code>mod<code>3))</code>) returns, for a given argument, a pair of <code>(x .&amp;. (x-1))</code>mod<code>3</code> and <code>((x .|. (x-1)) + 1)</code>mod<code>3)</code>, (in <code>(from, to)</code> format). <a href=\"https://stackoverflow.com/questions/2209860/how-does-this-work-weird-towers-of-hanoi-solution\">Here</a> is an explanation of why the function works that way.</li>\n<li><code>main = print $ hanoi 5</code> print the result in a <code>main</code> function.</li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 8085149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/113d72e439d659bf0d199847bd4384c9?s=128&d=identicon&r=PG&f=1", "display_name": "Henning", "link": "https://stackoverflow.com/users/8085149/henning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 44257568, "answer_count": 1, "score": 0, "last_activity_date": 1496134040, "creation_date": 1496132954, "last_edit_date": 1496133326, "question_id": 44257214, "link": "https://stackoverflow.com/questions/44257214/tower-of-hanoi-haskell", "title": "Tower of Hanoi Haskell", "body": "<p>I have found the following code for solving the Towers of Hanoi. The code is working fine! \nBut I cannot understand what's going on exactly.</p>\n\n<pre><code>import Data.Bits    \nhanoi :: Int -&gt; [(Int, Int)]\nhanoi n = map (\\x -&gt; ((x .&amp;. (x-1)) `mod` 3, ((x .|. (x-1)) + 1) `mod` 3)) [1..shift 1 n]\nmain = print $ hanoi 5\n</code></pre>\n\n<p>Can anybody explain this code? Thanks</p>\n"}, {"tags": ["haskell", "printf"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1496133046, "post_id": 44257077, "comment_id": 75522544, "body": "You do all right, but compiler can&#39;t infer type of an <code>input</code>, that&#39;s why you have many errors like <code>No instance for ...</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496134069, "post_id": 44257077, "comment_id": 75523143, "body": "&quot;a bunch of errors appear&quot; -- please avoid to post that without reporting the actual errors. Further, <code>printf</code> is not very often used in Haskell -- use it only if you need special formatting. Otherwise, just use something simpler like <code>putStrLn (&quot;x = &quot; ++ show x ++ &quot;, y = &quot; ++ show y)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 0, "creation_date": 1496133513, "post_id": 44257277, "comment_id": 75522809, "body": "That worked, than you. But now it is an int, the max size of it is limited. If I do this: print (factorial 22) instead, it does not seem to be an int because it shows the correct value instead of the int max size. Any idea?"}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "reply_to_user": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 0, "creation_date": 1496134190, "post_id": 44257277, "comment_id": 75523226, "body": "my fault. It should be <code>::Integer</code>"}], "tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": 2, "last_activity_date": 1496134150, "last_edit_date": 1496134150, "creation_date": 1496133144, "answer_id": 44257277, "question_id": 44257077, "link": "https://stackoverflow.com/questions/44257077/printf-text-and-return-value-of-a-method-call/44257277#44257277", "title": "Printf text and return value of a method call", "body": "<p>the only <code>input</code> is of ambiguous type in your code.</p>\n\n<pre><code>import           Text.Printf\nfactorial n = if n &lt; 2 then 1 else n * factorial (n-1)\n\nmain = do\n    let input = 22::Integer\n    printf \"Some text... %d! = %d\" input (factorial input)\n    return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 1, "last_activity_date": 1496134200, "creation_date": 1496134200, "answer_id": 44257620, "question_id": 44257077, "link": "https://stackoverflow.com/questions/44257077/printf-text-and-return-value-of-a-method-call/44257620#44257620", "title": "Printf text and return value of a method call", "body": "<p>The problem is that the compiler cannot infer the type of <code>input</code>. To do, you would need to provide it explicitly:</p>\n\n<pre><code>import Text.Printf\nfactorial n = if n &lt; 2 then 1 else n * factorial (n-1)\n\nmain = do\n    let input = 22 :: Integer\n    printf \"Some text... %d! = %d\" input (factorial input)\n</code></pre>\n\n<p>Note that <code>Integer</code> willl work for very large results, whereas <code>Int</code> won't, quoting <a href=\"https://en.wikibooks.org/wiki/Haskell/A_Miscellany_of_Types\" rel=\"nofollow noreferrer\">Haskell Wikibook</a>:</p>\n\n<blockquote>\n  <p>\"Integer\" is an arbitrary precision type: it will hold any number no\n  matter how big, up to the limit of your machine's memory\u2026. This means\n  you never have arithmetic overflows. On the other hand it also means\n  your arithmetic is relatively slow. Lisp users may recognise the\n  \"bignum\" type here.</p>\n  \n  <p>\"Int\" is the more common 32 or 64 bit integer. Implementations vary,\n  although it is guaranteed to be at least 30 bits.</p>\n</blockquote>\n"}], "owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 44257620, "answer_count": 2, "score": 0, "last_activity_date": 1496134200, "creation_date": 1496132446, "question_id": 44257077, "link": "https://stackoverflow.com/questions/44257077/printf-text-and-return-value-of-a-method-call", "title": "Printf text and return value of a method call", "body": "<p><em>Disclaimer: I am a total newb to haskell, but I can't find the answer. Maybe I am searching in the wrong way or it is so basic that nobody even asks that.</em></p>\n\n<p>Here is what I try to do:</p>\n\n<pre><code>import Text.Printf\nfactorial n = if n &lt; 2 then 1 else n * factorial (n-1)\n\nmain = do\n    let input = 22\n    printf \"Some text... %d! = %d\" input (factorial input)\n</code></pre>\n\n<p>But that doesn't work, a bunch of errors appear. Can you give me a quick hint, what I am doing wrong?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496127518, "post_id": 44253869, "comment_id": 75519091, "body": "Parsec allows you to access the current source location, so you could measure it before and after <code>p1</code> and see if it&#39;s the same"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496127659, "post_id": 44253869, "comment_id": 75519184, "body": "Otherwise it seems like a refactor of your grammar might be in order.  So split <code>p1</code> into <code>p1Empty</code> and <code>p1&#39;</code>, and use <code>p1&#39; &lt;|&gt; (p1Empty &lt;&lt; p2)</code>, if possible."}], "answers": [{"comments": [{"owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "edited": false, "score": 1, "creation_date": 1496122584, "post_id": 44254036, "comment_id": 75516541, "body": "I thought Parsec parsers , being Monads, allow such way of &quot;communication&quot;"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "edited": false, "score": 0, "creation_date": 1496122642, "post_id": 44254036, "comment_id": 75516566, "body": "Yes, the parsers may communicate with each other if they like. But your combinator can&#39;t reach inside an arbitrary other parser and force it to communicate, and it can&#39;t observe from the outside whether the parser has consumed anything."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1496121777, "creation_date": 1496121777, "answer_id": 44254036, "question_id": 44253869, "link": "https://stackoverflow.com/questions/44253869/in-parsec-how-do-i-run-second-parser-only-if-the-first-parser-consumed-some-in/44254036#44254036", "title": "In Parsec, how do I run second parser, only if the first parser consumed some input?", "body": "<p>I don't think you can do that for arbitrary parsers <code>p1</code> and <code>p2</code>: you need them to communicate somehow. If you could do this, it seems to me that you would break referential transparency. </p>\n\n<p>For example, consider parsing the input string <code>repeat 'x'</code>: whether <code>p1</code> consumes a character or not, <code>p2</code> will see the string as an endless sea of <code>x</code> characters. If it hasn't communicated with <code>p1</code> somehow (eg by modifying something in the parser's state), then you can't know whether a character was consumed; if your combinator were somehow able to treat these two cases differently, it would be breaking the rules.</p>\n"}, {"tags": [], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "is_accepted": false, "score": 1, "last_activity_date": 1496153184, "creation_date": 1496153184, "answer_id": 44264522, "question_id": 44253869, "link": "https://stackoverflow.com/questions/44253869/in-parsec-how-do-i-run-second-parser-only-if-the-first-parser-consumed-some-in/44264522#44264522", "title": "In Parsec, how do I run second parser, only if the first parser consumed some input?", "body": "<p>With a naive parser implementation, you should be able to do this:</p>\n\n<pre><code>(&lt;&lt;) p1 p2 = P $ \\inp -&gt; case parse p1 inp of\n  ErrorResult e -&gt; ErrorResult e\n  SuccessResult (rem, res) -&gt; if rem == inp\n    then SuccessResult (rem, res)\n    else parse p2 rem\n</code></pre>\n\n<p>Though Parsec is more advanced, you could probably roll your own there as well. </p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1496171356, "creation_date": 1496171356, "answer_id": 44270118, "question_id": 44253869, "link": "https://stackoverflow.com/questions/44253869/in-parsec-how-do-i-run-second-parser-only-if-the-first-parser-consumed-some-in/44270118#44270118", "title": "In Parsec, how do I run second parser, only if the first parser consumed some input?", "body": "<p>Parsec primitives make an internal distinction between a parser that succeeds after consuming some input and a parser that succeeds after consuming no input which you should be able to leverage.  In particular, the following ought to work to parse <code>p</code> and then -- conditioned on <code>p</code> successfully consuming input -- parse <code>q</code> and discard its results:</p>\n\n<pre><code>ifConsumed :: Monad m =&gt; ParsecT s u m a -&gt; ParsecT s u m b -&gt; ParsecT s u m a\nifConsumed p q = mkPT k\n  where -- k :: State s u -&gt; m (Consumed (m (Reply s u a)))\n        k s = do cons &lt;- runParsecT p s\n                 case cons of\n                   Consumed mrep -&gt; do\n                     rep &lt;- mrep\n                     case rep of\n                       Ok x s' err -&gt; runParsecT (fmap (const x) q) s'\n                       Error err -&gt; return . Consumed . return $ Error err\n                   Empty mrep -&gt; do\n                     rep &lt;- mrep\n                     case rep of\n                       Ok x s' err -&gt; return . Empty . return $ Ok x s' err\n                       Error err -&gt; return . Empty . return $ Error err\n</code></pre>\n\n<p>It's ugly because Parsec doesn't directly expose the <code>ParsecT</code> constructor, so you have to use the <code>mkPt</code> and <code>runParsecT</code> intermediaries which add a lot of boilerplate.</p>\n\n<p>In a nutshell, it runs the <code>p</code> parser.  If this succeeds with input consumed (the <code>Consumed -&gt; Ok</code> branch), it runs the <code>q</code> parser modified via <code>fmap</code> to return the value parsed by <code>p</code>.  On the other hand, if <code>p</code> succeeds with no input consumed (the <code>Empty -&gt; Ok</code> branch), it simply returns success without running the <code>q</code> parser.</p>\n\n<p>The only caveat is that I'm not 100% sure how, within the Parsec library itself, the invariant is preserved whereby the <code>Consumed -&gt; Ok</code> branch only gets called when input has been consumed, so I don't know if this is truly reliable.  You'll want to test it carefully in your particular use case.</p>\n\n<p>For the following parser --- which parses a list of one or more elements separated commas where each element consists of zero or more digits, then two exclamation marks only if the previous parser consumed some input, then a semicolon --- it seems to work:</p>\n\n<pre><code>p :: Parser [String]\np = ifConsumed (sepBy1 (many digit) (char ',')) (char '!' &gt;&gt; char '!') &lt;* char ';'\n\nrunp :: String -&gt; Either ParseError [String]\nrunp = parse p \"\"\n</code></pre>\n\n<p>Some tests:</p>\n\n<pre><code>runp \"\"         -- fails, expecting semicolon\nrunp \";\"        -- returns [\"\"]\nrunp \"!!;\"      -- fails, \"!!\" w/ no preceding content\nrunp \",;\"       -- fails, missing \"!!\"\nrunp \",!!;\"     -- returns [\"\",\"\"]\nrunp \",!;\"      -- fails, expecting second \"!\"\nrunp \",1,23;\"   -- fails, missing \"!!\"\nrunp \",1,23!!;\"  -- returns [\"\",\"1\",\"23\"]\n</code></pre>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1496171356, "creation_date": 1496120972, "question_id": 44253869, "link": "https://stackoverflow.com/questions/44253869/in-parsec-how-do-i-run-second-parser-only-if-the-first-parser-consumed-some-in", "title": "In Parsec, how do I run second parser, only if the first parser consumed some input?", "body": "<p>I need a combinator like <code>p1 &lt;&lt; p2</code>, but <code>p2</code> should run <strong>only</strong> if <code>p1</code> has succeeded and <strong>consumed some input</strong>.</p>\n\n<p>If <code>p1</code> succeeded without consuming input, <code>p2</code> should not run.</p>\n\n<p>If <code>p1</code> failed, then <code>p2</code> is also ignored?</p>\n\n<p>Overall result is <code>r1</code>'s result</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1496096256, "post_id": 44250854, "comment_id": 75510381, "body": "I would say &quot;no&quot;. It would break separate compiling, and/or introduce backtracking in the instance search algorithm. The latter would make compile time grow exponentially, in the worst case. Overlapping instances are already a bad enough idea (IMO)."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496096759, "post_id": 44250854, "comment_id": 75510495, "body": "Make the default definition <code>as_fast_as_possible_func = fast_func</code> and, if that fails (because the class is not an instance of <code>Eq</code>)  the implementer can define it as <code>slow_func</code> instead? Leave a comment saying that <code>slow_func</code> is available as the second option?"}, {"owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496096967, "post_id": 44250854, "comment_id": 75510551, "body": "@Davislor wouldn&#39;t I still need two instance declarations, leading to the same problem? As far as I can tell the only thing that changes is that I can leave one instance declaration empty."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1496097178, "post_id": 44250854, "comment_id": 75510594, "body": "related: <a href=\"https://stackoverflow.com/questions/19745038/ghc-rewrite-rule-specialising-a-function-for-a-type-class\" title=\"ghc rewrite rule specialising a function for a type class\">stackoverflow.com/questions/19745038/&hellip;</a>"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496098161, "post_id": 44250854, "comment_id": 75510840, "body": "These are untested kludges, but one idea: override <code>as_fast_as_possible_func</code> for individual types <code>a</code>, which is extra work but should at least meet the requirements of <code>OverlappingInstances</code>? Alternatively, <code>isOrd = True</code>, then use lazy evaluation (and possibly some type coercion) to run either <code>slow_func</code> or <code>fast_func</code> based on that? Seems like there ought to be a better way, so I might be misunderstanding how this works."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 6, "creation_date": 1496102512, "post_id": 44250854, "comment_id": 75511736, "body": "The way the class system was originally designed to be used is that you don&#39;t declare your two polymorphic instances, you make a separate concrete instance for each type. The whole type class machinery is designed so that decisions about which instance to choose <b>can&#39;t</b> be based on which other instances are in scope, in order to promote coherence (we don&#39;t want two modules importing your <code>Func</code> to choose different instances for the same type based on which other modules they&#39;ve imported). I would probably just use <code>slow_func</code> and <code>fast_func</code> directly without trying to unify them."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496471979, "post_id": 44267691, "comment_id": 75685335, "body": "The rewrite rule approach is nice, but it is worth mentioning you still need to add one rule per specialized signature; there is no way to add a rewrite rule which optimizes <code>slowFunc = fastFunc</code> whenever the <code>Ord</code> constraint is satisfied. You still need to manually indicate types where this fact can be immediately witnessed by GHC."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496524285, "post_id": 44267691, "comment_id": 75699624, "body": "I greatly dislike the rewrite rule approach. It&#39;s too easy to get awful performance because someone didn&#39;t know that they needed both an <code>Ord</code> instance <i>and</i> a rewrite rule to make their type fast. It also doesn&#39;t scale at all to higher-kinded types."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1496478279, "last_edit_date": 1496478279, "creation_date": 1496162522, "answer_id": 44267691, "question_id": 44250854, "link": "https://stackoverflow.com/questions/44250854/use-specialized-implementation-if-a-class-instance-is-available/44267691#44267691", "title": "Use specialized implementation if a class instance is available", "body": "<p>I would consider two options:</p>\n\n<h2>Rewrite rules</h2>\n\n<p>You can nominally use <code>slow_func</code> everywhere, but let rewrite rules optimise it when possible. For example,</p>\n\n<pre><code>import Data.List\n\nslowFunc :: Eq a =&gt; [a] -&gt; [a]\nslowFunc = nub\n\nfastFunc :: Ord a =&gt; [a] -&gt; [a]\nfastFunc = map head . group . sort\n\nmain = print . sum . slowFunc $ round &lt;$&gt; [sin x * n | x&lt;-[0..n]]\n where n = 100000\n</code></pre>\n\n<p>is slow (duh):</p>\n\n<pre><code>$ ghc -O2 Nub.hs &amp;&amp; time ./Nub\n[1 of 1] Compiling Main             ( Nub.hs, Nub.o )\nLinking Nub ...\n-3670322\n\nreal    0m51.875s\nuser    0m51.867s\nsys 0m0.004s\n</code></pre>\n\n<p>but if we add (without changing anything)</p>\n\n<pre><code>{-# NOINLINE slowFunc #-}\n{-# RULES \"slowFunc/Integer\" slowFunc = fastFunc :: [Integer] -&gt; [Integer] #-}\n</code></pre>\n\n<p>then</p>\n\n<pre><code>$ ghc -O2 Nub.hs &amp;&amp; time ./Nub\n[1 of 1] Compiling Main             ( Nub.hs, Nub.o )\nLinking Nub ...\n-3670322\n\nreal    0m0.250s\nuser    0m0.245s\nsys 0m0.004s\n</code></pre>\n\n<p>Rewrite rules are a bit hard to rely on (inlining is just one thing that can get in the way), but at least you can be sure that something that runs with <code>slowFunc</code> will keep <em>working</em> (just perhaps not fast enough) but definitely won't get lost in some missing-instance issue. On the flip side, you should also make very sure that <code>slowFunc</code> and <code>fastFunc</code> actually behave the same \u2013 in my example, this is not actually given! (But it can easily be modified accordingly).</p>\n\n<p>As Alec emphasizes in the comments, you will need to add a rewrite rule <em>for every single type</em> that you want to make fast. The good thing is that this can be done after the code is finished and exactly where profiling indicates that it matters, performance-wise.</p>\n\n<h2>Individual instances</h2>\n\n<p>This is the reliable solution: abstain from any catch-all instances and instead decide for each type what's appropriate.</p>\n\n<pre><code>instance Func Int where\n    as_fast_as_possible_func = fast_func\ninstance Func Double where\n    as_fast_as_possible_func = fast_func\n...\n\ninstance Func (Complex Double) where\n    as_fast_as_possible_func = slow_func\n</code></pre>\n\n<p>You can save some duplicate lines by making the more common version the default:</p>\n\n<pre><code>{-# LANGUAGE DefaultInstances #-}\n\nclass Func a where\n  as_fast_as_possible_func :: [a] -&gt; [a]\n  default as_fast_as_possible_func :: Ord a =&gt; [a] -&gt; [a]\n  as_fast_as_possible_func = fast_func\n\ninstance Func Int\ninstance Func Double\n...\n\ninstance Func (Complex Double) where\n    as_fast_as_possible_func = slow_func\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 2, "creation_date": 1498769306, "post_id": 44832444, "comment_id": 76650030, "body": "Since you have to manually wrap values, you might as well manually call the correct function."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 4, "creation_date": 1498770235, "post_id": 44832444, "comment_id": 76650447, "body": "He only wrapped the values, to get rid of <code>Ord</code> for demonstration purposes."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 1, "creation_date": 1498770237, "post_id": 44832444, "comment_id": 76650448, "body": "@LukaHorvat I used wrapped values only for demonstration purposes. You can use this approach w/o wrapper. It&#39;s just incredibly hard to find some standard data type which implements <code>Eq</code> but doesn&#39;t implement <code>Ord</code> to show that solution actually works."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 1, "creation_date": 1498818863, "post_id": 44832444, "comment_id": 76668880, "body": "Oh, you&#39;re right, I thought it was a general newtype like <code>FastWrapper a</code>. But my comment still stands. You&#39;ll need to write an instance for every possible type you want to use with your function at which point you might as well have a special class for them."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1498820007, "post_id": 44832444, "comment_id": 76669559, "body": "@LukaHorvat Yes, unfortunately, it&#39;s a downside of this <code>constraint-unions</code> approach \u2014 it requires some boilerplate code. Hopefully, instances are very easy to write. And you need to write them once per program for each type instead of manually wrapping values at call-site. Also, you can accidentally write <code>slowFunc</code> instead of <code>fastFunc</code> at call-site while with this approach you get correct behavior automatically."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 10, "last_activity_date": 1498767358, "last_edit_date": 1498767358, "creation_date": 1498760719, "answer_id": 44832444, "question_id": 44250854, "link": "https://stackoverflow.com/questions/44250854/use-specialized-implementation-if-a-class-instance-is-available/44832444#44832444", "title": "Use specialized implementation if a class instance is available", "body": "<p>Turned out actually you can. Seriously, I'm starting to think that everything is possible in Haskell... You can use results of recently announced <a href=\"https://github.com/rampion/constraint-unions#readme\" rel=\"noreferrer\"><code>constraint-unions</code></a> approach. I'm using code similar to one that was written by <a href=\"https://stackoverflow.com/users/745903/leftaroundabout\">@leftaroundabout</a>. Not sure I did it in best way, just tried to apply concepts of proposed approach:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall -Wno-name-shadowing #-}\n\n{-# LANGUAGE AllowAmbiguousTypes        #-}\n{-# LANGUAGE ConstraintKinds            #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE FlexibleInstances          #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE RankNTypes                 #-}\n{-# LANGUAGE ScopedTypeVariables        #-}\n{-# LANGUAGE TypeApplications           #-}\n{-# LANGUAGE TypeOperators              #-}\n\nmodule Main where\n\nimport           Data.List (group, nub, sort)\n\ninfixr 2 ||\nclass  c || d where\n    resolve :: (c =&gt; r) -&gt; (d =&gt; r) -&gt; r\n\nslowFunc :: Eq a =&gt; [a] -&gt; [a]\nslowFunc = nub\n\nfastFunc :: Ord a =&gt; [a] -&gt; [a]\nfastFunc = map head . group . sort\n\nas_fast_as_possible_func :: forall a. (Ord a || Eq a) =&gt; [a] -&gt; [a]\nas_fast_as_possible_func = resolve @(Ord a) @(Eq a) fastFunc slowFunc\n\nnewtype SlowWrapper = Slow Int deriving (Show, Num, Eq)\nnewtype FastWrapper = Fast Int deriving (Show, Num, Eq, Ord)\n\ninstance      (Ord FastWrapper || d) where resolve = \\r _ -&gt; r\ninstance d =&gt; (Ord SlowWrapper || d) where resolve = \\_ r -&gt; r\n\nmain :: IO ()\nmain = print . sum . as_fast_as_possible_func $ (Fast . round) \n                                             &lt;$&gt; [sin x * n | x&lt;-[0..n]]\n  where n = 20000\n</code></pre>\n\n<p>The key part here is <code>as_fast_as_possible_func</code>:</p>\n\n<pre><code>as_fast_as_possible_func :: forall a. (Ord a || Eq a) =&gt; [a] -&gt; [a]\nas_fast_as_possible_func = resolve @(Ord a) @(Eq a) fastFunc slowFunc\n</code></pre>\n\n<p>It uses appropriate function depending on whether <code>a</code> is <code>Ord</code> or <code>Eq</code>. I put <code>Ord</code> on the first place because everything that is <code>Ord</code> is automatically <code>Eq</code> and type checker rules might not trigger (though I didn't tested this function with constraints swapped). If you use <code>Slow</code> here <code>(Fast . round)</code> instead of <code>Fast</code> you can observe significantly slower results:</p>\n\n<pre><code>$ time ./Nub  # With `Slow` \nSlow 166822\n\nreal    0m0.971s\nuser    0m0.960s\nsys     0m0.008s\n\n\n$ time ./Nub  # With `Fast` \nFast 166822\n\nreal    0m0.038s\nuser    0m0.036s\nsys     0m0.000s\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I've updated required instances. Instead of</p>\n\n<pre><code>instance (c || Eq SlowWrapper)  where resolve = \\_ r -&gt; r\n</code></pre>\n\n<p>Now it is</p>\n\n<pre><code>instance d =&gt; (Ord SlowWrapper || d) where resolve = \\_ r -&gt; r\n</code></pre>\n\n<p><a href=\"https://www.reddit.com/r/haskell/comments/6k86je/constraint_unions_bringing_or_to_the_language_of/djklw8v/\" rel=\"noreferrer\">Thanks @rampion for explanation!</a></p>\n"}], "owner": {"reputation": 4076, "user_id": 1370541, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/LIKzX.png?s=128&g=1", "display_name": "JSQuareD", "link": "https://stackoverflow.com/users/1370541/jsquared"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 2, "answer_count": 2, "score": 17, "last_activity_date": 1534839954, "creation_date": 1496095894, "last_edit_date": 1534839954, "question_id": 44250854, "link": "https://stackoverflow.com/questions/44250854/use-specialized-implementation-if-a-class-instance-is-available", "title": "Use specialized implementation if a class instance is available", "body": "<p>Consider the following situation:</p>\n\n<pre><code>slow_func :: Eq a  =&gt; [a] -&gt; [a]\nfast_func :: Ord a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>I have two functions, <code>slow_func</code> and <code>fast_func</code>. These functions are different implementations of the same abstract function (they do the same thing), but one is faster than the other. The faster implementation is only available if the type <code>a</code> can be ordered. Is there a way to construct a function which acts as <code>fast_func</code> when possible, and reverts to <code>slow_func</code> otherwise?</p>\n\n<pre><code>as_fast_as_possible_func :: Eq a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>I have already tried the following:</p>\n\n<pre><code>{-# LANGUAGE OverlappingInstances  #-}\n\nclass Func a where\n    as_fast_as_possible_func :: [a] -&gt; [a]\n\ninstance Ord a =&gt; Func a where\n    as_fast_as_possible_func = fast_func\n\ninstance Eq a =&gt; Func a where\n    as_fast_as_possible_func = slow_func\n</code></pre>\n\n<p>Unfortunately, this doesn't compile, generating the following error:</p>\n\n<pre><code>Duplicate instance declarations:\n  instance Ord a =&gt; Func a\n    -- Defined at [...]\n  instance Eq a =&gt; Func a\n    -- Defined at [...]\n</code></pre>\n\n<p>The reason is that <code>OverlappingInstances</code> wants one of the instances to be most specialized <em>with respect to the instance specification, ignoring its context</em> (rather than using the most restrictive context, which is what we need here).</p>\n\n<p>Any way to do this?</p>\n"}, {"tags": ["haskell", "gtk", "cabal", "cabal-install", "haskell-platform"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496096097, "post_id": 44250489, "comment_id": 75510337, "body": "That library is part of gettext (<a href=\"https://www.gnu.org/software/gettext/gettext.html\" rel=\"nofollow noreferrer\">gnu.org/software/gettext/gettext.html</a>) and you could try installing gettext to make sure it works and all its own dependencies are satisfied."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496096211, "post_id": 44250489, "comment_id": 75510369, "body": "See also: <a href=\"https://stackoverflow.com/questions/32662215/how-do-you-install-gtk-3-0-on-windows\" title=\"how do you install gtk 3 0 on windows\">stackoverflow.com/questions/32662215/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 10263, "user_id": 518853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IjKPw.png?s=128&g=1", "display_name": "liberforce", "link": "https://stackoverflow.com/users/518853/liberforce"}, "edited": false, "score": 0, "creation_date": 1496140365, "post_id": 44251479, "comment_id": 75527530, "body": "I think you could re-use an existing MSYS2 installation and just installing the missing packages."}], "tags": [], "owner": {"reputation": 61, "user_id": 4616982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/337b2ebb63352a0c2b43b1c5375e6374?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Duran", "link": "https://stackoverflow.com/users/4616982/jose-duran"}, "is_accepted": false, "score": 1, "last_activity_date": 1496101228, "creation_date": 1496101228, "answer_id": 44251479, "question_id": 44250489, "link": "https://stackoverflow.com/questions/44250489/cant-install-glib-on-windows-when-trying-to-install-gtk3-using-cabal/44251479#44251479", "title": "Cant install glib on Windows when trying to install gtk3 using cabal", "body": "<p>I manage to install gtk by following the instruction in <a href=\"https://www.gtk.org/download/windows.php\" rel=\"nofollow noreferrer\">https://www.gtk.org/download/windows.php</a>, installing MSYS2 and using pacman to install gtk library, ignoring only step 4. After installing the libraries I added to my path C:\\msys64\\mingw64\\bin, and cabal finally compiled gtk3.\nI did not like this solution cause it is one more mingw installation on my pc.</p>\n"}], "owner": {"reputation": 61, "user_id": 4616982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/337b2ebb63352a0c2b43b1c5375e6374?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Duran", "link": "https://stackoverflow.com/users/4616982/jose-duran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496101228, "creation_date": 1496093232, "question_id": 44250489, "link": "https://stackoverflow.com/questions/44250489/cant-install-glib-on-windows-when-trying-to-install-gtk3-using-cabal", "title": "Cant install glib on Windows when trying to install gtk3 using cabal", "body": "<p>I have been trying to install gtk3 with cabal, following instructions on <a href=\"https://wiki.haskell.org/Gtk2Hs/Installation\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Gtk2Hs/Installation</a> , with the exception I have replace gtk with gtk3, I downloaded the all in one bundle of gtk 3.6.4 (from: <a href=\"http://www.tarnyko.net/dl/gtk.htm\" rel=\"nofollow noreferrer\">http://www.tarnyko.net/dl/gtk.htm</a>) unzip it and added the location_of_files/bin to my path, running pkg-config --cflags gtk+-3.0 works ok, cabal install gtk2hs-buildtools correctly installs, but cabal install gtk3 stops with:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring glib-0.13.4.1...\nFailed to install glib-0.13.4.1\nBuild log ( C:\\Users\\User\\AppData\\Roaming\\cabal\\logs\\glib-0.13.4.1.log ):\ncabal: Entering directory 'C:\\Users\\User\\AppData\\Local\\Temp\\cabal-tmp-6472\\glib-0.13.4.1'\n[1 of 1] Compiling Main             ( C:\\Users\\User\\AppData\\Local\\Temp\\cabal-tmp-6472\\glib-0.13.4.1\\dist\\setup\\setup.hs, C:\\Users\\User\\AppData\\Local\\Temp\\cabal-tmp-6472\\glib-0.13.4.1\\dist\\setup\\Main.o )\nLinking C:\\Users\\User\\AppData\\Local\\Temp\\cabal-tmp-6472\\glib-0.13.4.1\\dist\\setup\\setup.exe ...\nConfiguring glib-0.13.4.1...\nsetup.exe: Missing dependency on a foreign library:\n* Missing C library: intl\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.\ncabal: Leaving directory 'C:\\Users\\User\\AppData\\Local\\Temp\\cabal-tmp-6472\\glib-0.13.4.1'\n</code></pre>\n\n<p>And the gtk bundle I download have a libintl.h file in the include folder and a dll in the bin folder, I tried placing the files in almost every location I could think of but to no avail, i can\u2019t think of anything else.</p>\n\n<p>More details: I am running windows 7 x64 with haskell-platform 8.0.2 x64, and I really need this to work under windows for a project I am working.</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1496093559, "post_id": 44249710, "comment_id": 75509548, "body": "That should work, can you post the entire code ?"}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1496181435, "post_id": 44251068, "comment_id": 75553048, "body": "Could you possibly suggest a resource to read up on to understand this answer?  Thank you!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1496183019, "post_id": 44251068, "comment_id": 75553525, "body": "I modified my answer to be more descriptive. I don&#39;t have any particular resource in mind explaining the process at a higher level."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1496182978, "last_edit_date": 1496182978, "creation_date": 1496097712, "answer_id": 44251068, "question_id": 44249710, "link": "https://stackoverflow.com/questions/44249710/persistent-selectlist-causing-error-of-couldnt-match-type-basebackend-backend/44251068#44251068", "title": "Persistent selectList causing error of &quot;Couldn&#39;t match type \u2018BaseBackend backend0\u2019 with \u2018SqlBackend\u2019&quot;", "body": "<p>You can specialize it at <code>SqlBackend</code>.</p>\n\n<pre><code>asSqlBackendReader :: ReaderT SqlBackend m a -&gt; ReaderT SqlBackend m a\nasSqlBackendReader = id\n\nselectAll :: IO ()\nselectAll = runSqlite \":memory:\" . asSqlBackendReader $ do\n  records &lt;- selectList [UserUsername ==. \"abc\"] [LimitTo 10]\n  liftIO $ print (records :: [Entity User])\n</code></pre>\n\n<hr>\n\n<p>Looking at the type of <code>runSqlite</code>, there is a <code>IsSqlBackend backend</code> constraint to satisfy.</p>\n\n<p>The definition of <a href=\"https://hackage.haskell.org/package/persistent-2.7.0/docs/Database-Persist-Sql.html#t:IsSqlBackend\" rel=\"noreferrer\"><code>IsSqlBackend</code></a> is:</p>\n\n<pre><code>type IsSqlBackend backend =\n  (IsPersistBackend backend, BaseBackend backend ~ SqlBackend)\n</code></pre>\n\n<p>Then look up <a href=\"https://hackage.haskell.org/package/persistent-2.7.0/docs/Database-Persist-Class.html#t:IsPersistBackend\" rel=\"noreferrer\"><code>IsPersistBackend</code></a>.</p>\n\n<p>Just below the definition of the class, we see that it has three instances:</p>\n\n<pre><code>instance IsPersistBackend SqlWriteBackend\ninstance IsPersistBackend SqlReadBackend\ninstance IsPersistBackend SqlBackend\n</code></pre>\n\n<p>The three types specify backends with various capabilities, with <code>SqlBackend</code> being the most general one (unknown capabilities). Feel free to use a more restricted one if that's all you need.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 865, "favorite_count": 0, "accepted_answer_id": 44251068, "answer_count": 1, "score": 4, "last_activity_date": 1496182978, "creation_date": 1496088407, "question_id": 44249710, "link": "https://stackoverflow.com/questions/44249710/persistent-selectlist-causing-error-of-couldnt-match-type-basebackend-backend", "title": "Persistent selectList causing error of &quot;Couldn&#39;t match type \u2018BaseBackend backend0\u2019 with \u2018SqlBackend\u2019&quot;", "body": "<p>I'm running into the below compile error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018BaseBackend backend0\u2019 with \u2018SqlBackend\u2019\n    arising from a use of \u2018runSqlite\u2019\n  The type variable \u2018backend0\u2019 is ambiguous\n\u2022 In the expression: runSqlite \":memory:\"\n  In the expression:\n    runSqlite \":memory:\"\n    $ do { records &lt;- selectList [UserUsername ==. \"abc\"] [LimitTo 10];\n           liftIO $ print (records :: [Entity User]) }\n  In an equation for \u2018selectAll\u2019:\n      selectAll\n        = runSqlite \":memory:\"\n          $ do { records &lt;- selectList [UserUsername ==. \"abc\"] [LimitTo 10];\n                 liftIO $ print (records :: [Entity User]) }\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>selectAll :: IO ()\nselectAll = runSqlite \":memory:\" $ do\n  records &lt;- selectList [UserUsername ==. \"abc\"] [LimitTo 10]\n  liftIO $ print (records :: [Entity User])\n</code></pre>\n\n<p>Having a look at the type signature of runSqlite:</p>\n\n<pre><code>runSqlite    \n:: (MonadBaseControl IO m, MonadIO m, IsSqlBackend backend)  \n=&gt; Text \n-&gt; ReaderT backend (NoLoggingT (ResourceT m)) a \n-&gt; m a\n</code></pre>\n\n<p>I would assume I need to specify an explicit type for runSqlite, though I'm not too sure what I set for <code>backend</code> in <code>ReaderT backend (NoLoggingT (ResourceT m)) a</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 5, "creation_date": 1496082607, "post_id": 44248544, "comment_id": 75505460, "body": "I think your <code>applyZip</code> is good enough, but <code>(id &amp;&amp;&amp;)</code> would also work (with <code>(&amp;&amp;&amp;)</code> from <code>Control.Arrow</code>."}, {"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 2, "creation_date": 1496082802, "post_id": 44248544, "comment_id": 75505544, "body": "I\u2019d say that code is already as good as it gets. Implementing the same thing with a library function would be just obfuscating, IMHO. Unless there is some higher meaning to the construct that would be made more obvious using the library function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496089222, "post_id": 44248544, "comment_id": 75508061, "body": "Related: <a href=\"https://stackoverflow.com/questions/26266825/how-to-get-two-values-from-one-point-free-in-haskell\" title=\"how to get two values from one point free in haskell\">stackoverflow.com/questions/26266825/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1293, "user_id": 928752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6d5c7f8aa0457cf0c231eab69cb539d?s=128&d=identicon&r=PG", "display_name": "peri4n", "link": "https://stackoverflow.com/users/928752/peri4n"}, "edited": false, "score": 0, "creation_date": 1496085132, "post_id": 44248589, "comment_id": 75506472, "body": "Could you elaborate a bit more why this works? I tried for quite some time but failed. :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1293, "user_id": 928752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6d5c7f8aa0457cf0c231eab69cb539d?s=128&d=identicon&r=PG", "display_name": "peri4n", "link": "https://stackoverflow.com/users/928752/peri4n"}, "edited": false, "score": 0, "creation_date": 1496086472, "post_id": 44248589, "comment_id": 75507010, "body": "@peri4n: sure, but give me some time (currently quite busy)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1293, "user_id": 928752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6d5c7f8aa0457cf0c231eab69cb539d?s=128&d=identicon&r=PG", "display_name": "peri4n", "link": "https://stackoverflow.com/users/928752/peri4n"}, "edited": false, "score": 2, "creation_date": 1496086638, "post_id": 44248589, "comment_id": 75507079, "body": "@peri4n <code>ap</code> in the reader monad is the S combinator, if that helps. <a href=\"https://hackage.haskell.org/package/data-aviary-0.4.0/docs/src/Data-Aviary-Functional.html#line-147\" rel=\"nofollow noreferrer\">This type signature for it might also help:</a> <code>ap :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)</code> (you should be able to implement this type yourself without too much thought just by &quot;matching up types&quot;)."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 2, "creation_date": 1496087588, "post_id": 44248589, "comment_id": 75507441, "body": "Equivalent without imports (in GHC 8): <code>applyZip = ((,) &lt;*&gt;)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1496089404, "post_id": 44248589, "comment_id": 75508138, "body": "In real code, I&#39;d consider this to be deliberate obfuscation. :-P (+1)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1496082622, "creation_date": 1496082622, "answer_id": 44248589, "question_id": 44248544, "link": "https://stackoverflow.com/questions/44248544/apply-function-and-wrap-in-tuple-in-haskell/44248589#44248589", "title": "Apply function and wrap in tuple in Haskell", "body": "<p>You can use:</p>\n\n<pre><code>import Control.Monad(ap)\n\napplyZip :: (a -&gt; b) -&gt; a -&gt; (a,b)\napplyZip = <b>ap (,)</b></code></pre>\n\n<p>Here we work with the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html#v:ap\" rel=\"noreferrer\"><code>ap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</code></a> function.</p>\n"}], "owner": {"reputation": 1293, "user_id": 928752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6d5c7f8aa0457cf0c231eab69cb539d?s=128&d=identicon&r=PG", "display_name": "peri4n", "link": "https://stackoverflow.com/users/928752/peri4n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 44248589, "answer_count": 1, "score": 3, "last_activity_date": 1496083045, "creation_date": 1496082386, "last_edit_date": 1496083045, "question_id": 44248544, "link": "https://stackoverflow.com/questions/44248544/apply-function-and-wrap-in-tuple-in-haskell", "title": "Apply function and wrap in tuple in Haskell", "body": "<p>I am looking for a way to write a function that applies a provided function and wraps argument and function result inside a tuple. Such as:</p>\n\n<pre><code>applyZip :: (a -&gt; b) -&gt; a -&gt; (a,b)\napplyZip f x = (x, f x)\n</code></pre>\n\n<p>Is there a more idiomatic way to write this in Haskell, preferably with library code? </p>\n\n<p><strong>Edit</strong>:\nI was just genuinely interested in other approaches to solve this. If you find your self in the same problem, implementing the function yourself with a descriptive name might be preferable.</p>\n"}, {"tags": ["haskell", "state", "monad-transformers", "megaparsec"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1496072589, "post_id": 44246182, "comment_id": 75501058, "body": "This looks wrong. <code>runState</code> should get you <code>((b, s), a)</code>, not <code>[a]</code>, so that you could <code>put</code> that state."}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496072948, "post_id": 44246182, "comment_id": 75501238, "body": "@BartekBanachewicz the state is <code>(b,s)</code> so <code>runState</code> would return <code>(a,(b,s))</code>, I run the function <code>f</code> on the result to get <code>[((b,s),a)]</code>"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1496073212, "post_id": 44246182, "comment_id": 75501352, "body": "So there&#39;s your problem. You&#39;re left with multiple states. Which one should you pick now?"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496073410, "post_id": 44246182, "comment_id": 75501460, "body": "@BartekBanachewicz exactly, that&#39;s my problem, I have to parse statements which include variable declaration statements, when <code>int x=3;</code> occurs <code>x</code> should be added to the symboltable but those statements are seperated by a semi colon, that&#39;s why I&#39;m asking"}], "answers": [{"comments": [{"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1496135236, "post_id": 44252976, "comment_id": 75523920, "body": "all my parsers are <code>StateT (Scope,SymbolTable) String (ParsecT ...) a</code> here, I&#39;ve got a lot of them I can&#39;t change them easily , anyway I found the solution and I&#39;m going to post it"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1496115187, "last_edit_date": 1592644375, "creation_date": 1496115187, "answer_id": 44252976, "question_id": 44246182, "link": "https://stackoverflow.com/questions/44246182/how-to-use-megaparsecs-combinators-on-statet/44252976#44252976", "title": "how to use megaparsec&#39;s combinators on StateT", "body": "<p>Megaparsec has a monad transformer interface <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec.html#t:ParsecT\" rel=\"nofollow noreferrer\"><code>ParsecT</code></a>:</p>\n<blockquote>\n<pre><code>data ParsecT e s m a\n</code></pre>\n<p><code>ParsecT e s m a</code> is a parser with custom data component of error <code>e</code>, stream type <code>s</code>, underlying monad <code>m</code> and return type <code>a</code>.</p>\n</blockquote>\n<p>You should be able to use this with something like <code>type Parser = ParsecT Dec Text (State (Scope, SymbolTable))</code>, which will add parsing functionality to the underlying <code>State (Scope, SymbolTable)</code> monad.</p>\n"}, {"tags": [], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "is_accepted": true, "score": 0, "last_activity_date": 1496135484, "creation_date": 1496135484, "answer_id": 44258059, "question_id": 44246182, "link": "https://stackoverflow.com/questions/44246182/how-to-use-megaparsecs-combinators-on-statet/44258059#44258059", "title": "how to use megaparsec&#39;s combinators on StateT", "body": "<p>I don't know why I thought that I needed a special function to do this, <code>sepBy</code> and others are defined on <code>Alternative</code> and because every <code>StateT</code> has an <code>Alternative</code> instance functions like <code>sepBy</code>,<code>many</code>, etc can be called directly.  </p>\n\n<p>My problem probably was because I had to use <code>symbol</code>,<code>char</code>,etc which I thought are <code>ParsecT ...</code> but then I realized those functions are defined in terms of <code>MonadParsec</code> typeclass which <code>StateT</code> again has instance for so I didn't even need <code>lift</code> or <code>mapStateT</code>.  </p>\n\n<p>So all I did is to change functions signatures to work with <code>MonadParsec</code> and my problem was solved.</p>\n"}], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 44258059, "answer_count": 2, "score": 0, "last_activity_date": 1496135484, "creation_date": 1496072335, "last_edit_date": 1496115204, "question_id": 44246182, "link": "https://stackoverflow.com/questions/44246182/how-to-use-megaparsecs-combinators-on-statet", "title": "how to use megaparsec&#39;s combinators on StateT", "body": "<p>I'm building a compiler for java for university project, in my project my parsers are mostly <code>StateT (Scope,SymbolTable) String m a</code> where <code>Scope</code> is the scope we're at now(method,class,etc) and <code>SymbolTable</code> holds the symbols defined till now.  </p>\n\n<p>I wanted to use megaparsec's combinators on those parsers, for <code>parens</code>,<code>braces</code> it's not problem, I just use <code>mapStateT</code> but for <code>sepBy</code> and others I developed this function :  </p>\n\n<pre><code>mapsequence :: (Monoid s,Monad m) =&gt; (m (a,(b,s)) -&gt; m [(a,(b,s))]) -&gt; StateT (b,s) m a -&gt; StateT (b,s) m [a]\nmapsequence f stm = do\n                      s &lt;- get\n                      ases &lt;- lift $ f $ runStateT stm s\n                      case ases of\n                        (_:_) -&gt; do\n                               put ((fst . snd . last) ases,(mconcat . map (snd . snd)) ases)\n                               return $ map fst ases\n                        [] -&gt; return []\n</code></pre>\n\n<p>Now <code>f</code> would be for example : </p>\n\n<pre><code>\\p -&gt; p `sepBy` semi\n</code></pre>\n\n<p>Anyway I realized lately that the function above is wrong, the function will run the parser(encapsulated in <code>StateT</code>) feeding it the state we have right now which is <code>s</code> then it will run it again but instead of feeding it the new state resulting from the first run it will feed it <code>s</code> again and again and ... .   </p>\n\n<p>How do I use megaparsec's combinators like <code>sepBy</code>,<code>sepEndBy</code> and etc so that I run the parser many times but chaining the resulting state from the first to the second to the third etc ?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1496072558, "post_id": 44246062, "comment_id": 75501043, "body": "You probably want to replace <code>Handler (Answer a)</code> with <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Except.html#t:ExceptT\" rel=\"nofollow noreferrer\"><code>ExceptT Text Handler a</code></a>."}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1496072768, "post_id": 44246062, "comment_id": 75501155, "body": "@leftaroundabout and then unwrap <code>ExceptT</code> in handlers like <code>getPageR = runExceptT ...</code> ?"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496072223, "creation_date": 1496071919, "last_edit_date": 1496072223, "question_id": 44246062, "link": "https://stackoverflow.com/questions/44246062/how-to-compose-functions-in-yesod-in-either-like-style", "title": "How to compose functions in Yesod in Either like style?", "body": "<p>I have a wrapper over <code>Either</code></p>\n\n<pre><code>newtype Answer a = Answer (Either Text a)\n</code></pre>\n\n<p>which can be converted to JSON:</p>\n\n<pre><code>instance ToJSON a =&gt; ToJSON (Answer a) where\ntoJSON (Answer (Left msg)) = object\n  [ \"error\"   .= True\n  , \"message\" .= msg\n  , \"data\"    .= Null\n  ]\ntoJSON (Answer (Right val)) = object\n  [ \"error\"   .= False\n  , \"message\" .= pack \"OK\"\n  , \"data\"    .= val\n  ]\n</code></pre>\n\n<p>There are two kinds of answers:</p>\n\n<pre><code>errorAnswer :: Text -&gt; Answer a\nerrorAnswer = Answer . Left\n\nvalueAnswer :: a -&gt; Answer a\nvalueAnswer = Answer . Right\n</code></pre>\n\n<p>I have a set of functions running in <code>Handler</code> monad and returning <code>Answer</code>.</p>\n\n<p>Some functions test something:</p>\n\n<pre><code>checkSomething :: Handler (Answer a) -&gt; Handler (Answer a)\ncheckSomething action = do\n  if sometingIsWrong\n    then pure (errorAnswer \"Something was wrong\")\n    else action\n</code></pre>\n\n<p>Other functions manipulate <code>TVar</code> variables in <code>App</code>:</p>\n\n<pre><code>readSomething\n  :: (App -&gt; TVar a) -&gt; (a -&gt; Either Text b) -&gt; Handler (Answer a)\nreadSomething var f =\n  readVar var &gt;&gt;= pure . Answer . f\n  where\n    readVar var = getYesod &gt;&gt;= liftIO . readTVarIO . var\n</code></pre>\n\n<p>It is quite easy to compose these two functions above:</p>\n\n<pre><code>handleRequest :: ToJSON a =&gt; Handler (Answer a)\nhandleRequest =\n  checkSomething $ readSomething someVar someProjection\n</code></pre>\n\n<p>But it gets hard when I have more checks like <code>checkSomething</code>. Plus, I want to put <code>returnJson</code> somewhere to return <code>Value</code> at the end.</p>\n\n<p>Is there a way to write a handler in <code>Either</code> like style (also, <code>Maybe</code> like)? For example: </p>\n\n<pre><code>handleRequest :: Handler (Answer Int)\nhandleRequest = do\n  checkSomething0 -- Do not continue if (Answer (Left _))\n  checkSomething1 -- Do not continue if (Answer (Left _))\n  doSomething     -- Everything above was fine\n</code></pre>\n\n<p>One idea would be to add <code>Alternative</code> instance to <code>Handler (Answer a)</code>, but here is a problem:</p>\n\n<pre><code>empty = Answer (Left ???)\n</code></pre>\n\n<p>I'm losing a message here which server supposed to return in case of error.</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "edited": false, "score": 0, "creation_date": 1496091142, "post_id": 44247786, "comment_id": 75508739, "body": "Thanks! It&#39;s half-exercise indeed, but mainly I would like to have less dependencies and keep it simple."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 6, "last_activity_date": 1496078972, "creation_date": 1496078972, "answer_id": 44247786, "question_id": 44244696, "link": "https://stackoverflow.com/questions/44244696/create-a-list-of-values-from-type-level-list/44247786#44247786", "title": "Create a list of values from type-level list", "body": "<p>You define</p>\n\n<pre><code>class TListGen ixs (g :: * -&gt; *) where\n  genTList :: Proxy ixs -&gt; g ix -&gt; TList ixs g\n</code></pre>\n\n<p>but this means that the caller of the function can choose what to instantiate all of the type variables with, so in particular also how to instantiate <code>ix</code>.</p>\n\n<p>So for example,</p>\n\n<pre><code>genTList (Proxy :: Proxy '[Int, String]) (Just False)\n</code></pre>\n\n<p>would be a type-correct call of this function, choosing <code>g</code> to be <code>Maybe</code> and <code>ix</code> to be <code>Bool</code>. But that can't be correct. We need to pass in something that is sufficiently polymorphic that it works at least for all the elements occuring in the type-level list, or even better, for any possible choice of <code>ix</code>. This is what a rank-2 polymorphic type achieves:</p>\n\n<pre><code>class TListGen ixs (g :: * -&gt; *) where\n  genTList :: Proxy ixs -&gt; (forall ix . g ix) -&gt; TList ixs g\n</code></pre>\n\n<p>This requires the <code>RankNTypes</code> language extension.</p>\n\n<p>Now the caller can only pass a function that is polymorphic in the argument type of <code>g</code>. So passing <code>Just False</code> would no longer work, but passing <code>Nothing</code> would be ok.</p>\n\n<p>The definition of the cases is in principle ok, but you can actually remove the <code>OVERLAPS</code> pragma and even the proxy argument, because nothing is overlapping, and the <code>ixs</code> can be inferred from the result type, as it occurs as an argument to the <code>TList</code> datatype:</p>\n\n<pre><code>class TListGen ixs (g :: * -&gt; *) where\n  genTList :: (forall ix . g ix) -&gt; TList ixs g\n\ninstance TListGen '[] g where\n  genTList _ = TNil\n\ninstance TListGen ixs g =&gt; TListGen (ix ': ixs) g where\n  genTList g = g :-: genTList g\n</code></pre>\n\n<p>Now we can try to use it:</p>\n\n<pre><code>GHCi&gt; genTList Nothing :: TList '[ Int, String ] Maybe\n</code></pre>\n\n<p>Unfortunately, this leads to an error, because there's no <code>Show</code> instance:</p>\n\n<pre><code>\u2022 No instance for (Show (TList '[Int, String] Maybe))\n    arising from a use of \u2018print\u2019\n\u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Defining a <code>Show</code> instance for <code>TList</code> is possible, but a bit tricky.</p>\n\n<p>I'm not sure whether this is primarily an exercise, but if you're ok with just reusing code, then all this is available in the <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"noreferrer\">generics-sop</a> package.</p>\n\n<p>Your <code>TList</code> is called <code>NP</code> (with the arguments being in flipped order), and your <code>genTList</code> is called <code>pure_NP</code>, so you can write</p>\n\n<pre><code>GHCi&gt; import Generics.SOP.NP\nGHCi&gt; pure_NP Nothing :: NP Maybe '[ Int, String ]\nNothing :* (Nothing :* Nil)\n</code></pre>\n"}], "owner": {"reputation": 219, "user_id": 4625247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/cbHw8.gif?s=128&g=1", "display_name": "Mikhail Puzanov", "link": "https://stackoverflow.com/users/4625247/mikhail-puzanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 782, "favorite_count": 1, "accepted_answer_id": 44247786, "answer_count": 1, "score": 4, "last_activity_date": 1496078972, "creation_date": 1496067428, "last_edit_date": 1496068908, "question_id": 44244696, "link": "https://stackoverflow.com/questions/44244696/create-a-list-of-values-from-type-level-list", "title": "Create a list of values from type-level list", "body": "<p>I have a type-level list like this</p>\n\n<pre><code>data TList (ixs :: [*]) (f :: * -&gt; *) where\n  TNil  :: TList '[] f\n  (:-:) :: f ix -&gt; TList ixs f -&gt; TList (ix ': ixs) f\n</code></pre>\n\n<p>And I'm trying to generate a new TList using an existing one.\nThe idea is to have a function</p>\n\n<pre><code>genTList :: TList ixs f -&gt; t -&gt; TList ixs g\n</code></pre>\n\n<p>where 't' is some function able to construct a value of type 'g x' where 'x' is one of types form the list 'ixs'.</p>\n\n<p>So that given</p>\n\n<pre><code>data Foo x\n</code></pre>\n\n<p>and (some kind of)</p>\n\n<pre><code>generate :: forall x . Bar x\n</code></pre>\n\n<p>I could get something like this</p>\n\n<pre><code>genTList (Foo Int :-: Foo String) generate = Bar :-: Bar\n</code></pre>\n\n<p>So essentially for every item 'x' in the type list I want to have a type 'Bar x' \nand also construct its value with parameterless constructor, because I know \nthat 'Bar x' doesn't have constructor parameters.</p>\n\n<p>I tried to implement something (<a href=\"https://gist.github.com/lolepezy/30820595afd9217083c5ca629e350b55\" rel=\"nofollow noreferrer\">https://gist.github.com/lolepezy/30820595afd9217083c5ca629e350b55</a>) but it wouldn't typecheck (reasonably).</p>\n\n<p>So how should I approach the problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496064496, "post_id": 44243367, "comment_id": 75496280, "body": "What was your goal with that code?"}, {"owner": {"reputation": 183, "user_id": 3144646, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a37bd314f12553f4f6b933d8058fbe24?s=128&d=identicon&r=PG&f=1", "display_name": "Saczew", "link": "https://stackoverflow.com/users/3144646/saczew"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496065065, "post_id": 44243367, "comment_id": 75496675, "body": "@BartekBanachewicz mostly experimenting with Haskell type system and dynamic dispatch (I&#39;m not sure it this is the case here)"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496065557, "post_id": 44243367, "comment_id": 75496973, "body": "It&#39;s not clear from the question that you want dynamic dispatch, no."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496084546, "post_id": 44243367, "comment_id": 75506249, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4629883/rigid-type-variable-error\">rigid type variable error</a>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1496064199, "creation_date": 1496064199, "answer_id": 44243599, "question_id": 44243367, "link": "https://stackoverflow.com/questions/44243367/rigid-type-variable-in-haskell/44243599#44243599", "title": "Rigid type variable in Haskell", "body": "<p>The function type <code>MyClass a =&gt; String -&gt; a</code> indicates a function that can return a value of any type (with an instance of <code>MyClass</code>) of the <em>caller's</em> choosing. There is no apparent way, for example, to return a value of type <code>Int</code> (again, assuming <code>MyClass Int</code> is defined) given the value <code>TypeA</code></p>\n"}, {"comments": [{"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 1, "creation_date": 1496064500, "post_id": 44243648, "comment_id": 75496285, "body": "So how would one implement the signature OP defined in his question?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1496064708, "post_id": 44243648, "comment_id": 75496423, "body": "@Glubus I don&#39;t think that&#39;s even possible. <code>MyClass</code> provides a way to reduce a value to a <code>String</code>, but not a way to construct a new value of type <code>a</code>. The problem definition is wrong here."}, {"owner": {"reputation": 183, "user_id": 3144646, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a37bd314f12553f4f6b933d8058fbe24?s=128&d=identicon&r=PG&f=1", "display_name": "Saczew", "link": "https://stackoverflow.com/users/3144646/saczew"}, "edited": false, "score": 0, "creation_date": 1496065297, "post_id": 44243648, "comment_id": 75496810, "body": "Is there a way to implement something like &quot;dynamic&quot; dispatch in Haskell? I mean that I want to choose the function in run time. I think that it would be easiest if I define like TypeA = ValueA | ValueB. I&#39;m just curious."}, {"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1496065318, "post_id": 44243648, "comment_id": 75496826, "body": "Yes that is what I thought as well at first, but the compiler will accept the signature as valid, meaning the function makes sense. We can just leave the function <code>bar = undefined</code> and the code will compile."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 183, "user_id": 3144646, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a37bd314f12553f4f6b933d8058fbe24?s=128&d=identicon&r=PG&f=1", "display_name": "Saczew", "link": "https://stackoverflow.com/users/3144646/saczew"}, "edited": false, "score": 0, "creation_date": 1496065373, "post_id": 44243648, "comment_id": 75496859, "body": "@Saczew, yes, if you return a (possibly wrapped) function. You have an X/Y problem, clearly."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1496070677, "post_id": 44243648, "comment_id": 75500037, "body": "The signature of that function is what <code>read</code> is. They just need to make <code>bar</code> a member of the <code>MyClass</code> typeclass."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496127860, "post_id": 44243648, "comment_id": 75519299, "body": "Usually in OO-esque Haskell we find the polymorphism on the <i>argument</i> side.  So just be specific about what <code>bar</code> really does return: <code>bar :: String -&gt; TypeA</code>.  Use the class for arguments: <code>baz :: (MyClass a) =&gt; a -&gt; String</code>.  Try to make every signature as informative as possible."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 7, "last_activity_date": 1496064349, "creation_date": 1496064349, "answer_id": 44243648, "question_id": 44243367, "link": "https://stackoverflow.com/questions/44243367/rigid-type-variable-in-haskell/44243648#44243648", "title": "Rigid type variable in Haskell", "body": "<pre><code>(MyClass a) =&gt; String -&gt; a\n</code></pre>\n\n<p>Means that the function can return <em>any</em> <code>a</code> type that's asked from it. Your implementation returns <em>one particular type</em> that satisfies that constraint. This is more obvious with the explicit signature:</p>\n\n<pre><code>bar :: forall a. (MyClass a) =&gt; String -&gt; a\n</code></pre>\n\n<p>Read plainly, that's <em>for every type <code>a</code> that satisfies <code>MyClass</code>, this function will take a string and return a value of that type</em>.\nYour version would assume <code>exists a</code> instead.</p>\n"}], "owner": {"reputation": 183, "user_id": 3144646, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a37bd314f12553f4f6b933d8058fbe24?s=128&d=identicon&r=PG&f=1", "display_name": "Saczew", "link": "https://stackoverflow.com/users/3144646/saczew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2586, "favorite_count": 1, "accepted_answer_id": 44243648, "answer_count": 2, "score": 6, "last_activity_date": 1496064349, "creation_date": 1496063449, "question_id": 44243367, "link": "https://stackoverflow.com/questions/44243367/rigid-type-variable-in-haskell", "title": "Rigid type variable in Haskell", "body": "<p>I don't really get what is wrong with the following code.</p>\n\n<pre><code>data TypeA = TypeA\n\nclass MyClass a where\n  myClassFunction :: a -&gt; String\n\ninstance MyClass TypeA where\n  myClassFunction TypeA = \"TypeA\"\n\nbar :: (MyClass a) =&gt; String -&gt; a\nbar \"TypeA\" = TypeA \n</code></pre>\n\n<p>I get following error: </p>\n\n<pre><code>   Couldn't match expected type \u2018a\u2019 with actual type \u2018TypeA\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for bar :: MyClass a =&gt; String -&gt; a\n          at test.hs:9:8\n    Relevant bindings include\n      bar :: String -&gt; a (bound at test.hs:10:1)\n    In the expression: TypeA\n    In an equation for \u2018bar\u2019: bar \"TypeA\" = TypeA\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I'm afraid that I'm missing something crucial about Haskell type system.</p>\n"}, {"tags": ["haskell", "grammar", "lenses", "scrap-your-boilerplate"], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496105236, "post_id": 44248323, "comment_id": 75512244, "body": "Awesome! &lt;3 Thank you so much @haoformayor . I&#39;ll definitely read that paper soon (I think I had an attempt a couple of times when I was originally looking into generic programming in haskell out of interest, but it was more a cursory interested gloss than anything)."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496182463, "post_id": 44248323, "comment_id": 75553354, "body": "According to my GHC, the extension is called <code>DeriveDataTypeable</code>, actually. I&#39;ll correct what you wrote."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496182778, "post_id": 44248323, "comment_id": 75553453, "body": "Also, I can&#39;t get the code you wrote to work. Did you try to compile it before you answered? I guess I accepted your answer a bit prematurely, because I should have tried it myself first. Only getting to that now. I wonder if you maybe meant <code>universeOf</code>? I need to study this more."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496184226, "post_id": 44248323, "comment_id": 75553857, "body": "Yeah, you meant <code>universeOf</code>. I&#39;ll adjust the code again."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 3, "last_activity_date": 1496189045, "last_edit_date": 1496189045, "creation_date": 1496081409, "answer_id": 44248323, "question_id": 44243131, "link": "https://stackoverflow.com/questions/44243131/recursive-type-lensing/44248323#44248323", "title": "Recursive Type Lensing", "body": "<p>You are seeking the <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Plated.html\" rel=\"nofollow noreferrer\">Control.Lens.Plated</a> module.</p>\n\n<p>First add a <code>Data</code> derivation:</p>\n\n<pre><code>{-# language DeriveDataTypeable #-}\nimport Data.Data\nimport Data.Data.Lens\nimport Control.Lens -- for universeOf function\n\ndata EExp a\n  = ELit a\n  | EAdd (EExp a) (EExp a)\n  deriving (Show, Data) \n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>&gt; buildOptions eg1\n[EAdd (ELit 1) (EAdd (ELit 2) (ELit 0)),ELit 1,EAdd (ELit 2) (ELit 0),ELit 2,ELit 0]\n\n&gt; universeOf uniplate eg1\n[EAdd (ELit 1) (EAdd (ELit 2) (ELit 0)),ELit 1,EAdd (ELit 2) (ELit 0),ELit 2,ELit 0]\n</code></pre>\n\n<p>The <code>uniplate</code> lens is doing the bulk of the magic here; using the information provided by the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Data.html#t:Data\" rel=\"nofollow noreferrer\"><code>Data</code> typeclass</a>, it is able to walk one step into any <code>Data</code>-friendly data structure to find self-similar children. It is also doing <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/src/Data.Data.Lens.html#Oracle\" rel=\"nofollow noreferrer\">some high-altitude caching gymnastics</a> to make the traversals efficient, but we can safely ignore that.</p>\n\n<p><code>universeOf uniplate</code> repeatedly calls <code>uniplate</code> to find all transitive descendants.</p>\n\n<p>For more information on <code>Data.Data</code>, check out the <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.92.958&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">Scrap Your Boilerplate paper</a> by L\u00e4mmel and SPJ.</p>\n"}], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 44248323, "answer_count": 1, "score": 4, "last_activity_date": 1496189045, "creation_date": 1496062762, "last_edit_date": 1496119994, "question_id": 44243131, "link": "https://stackoverflow.com/questions/44243131/recursive-type-lensing", "title": "Recursive Type Lensing", "body": "<p>I'm trying to create some code that can take <strong>any</strong> recursive grammar data type and any expression of that data type and produce a list of all sub-expressions of the same type, built up, kind of like a <code>scan</code> on the recursion of the type.</p>\n\n<p>I've written two manual examples below for an accompanying toy calculator grammar type <code>EExp</code>. The first example uses prisms and lenses from the Lens library and will only work on the one <code>eg1</code> example expression, whereas the second function just uses handrolled code but will work on any <code>EExp</code> expression.</p>\n\n<p>Ideally I could use template haskell or something else to automatically build a recursive function that could focus on each of the sub expressions of an expression of any kind in that type (like a prism/lens), and therefore also easily print out a list of all the pieces of any expression given to it.</p>\n\n<p>I'm a little bit stuck, though, with what to try or research next. Any help is really appreciated!</p>\n\n<pre><code>import qualified Control.Lens as Lens\nimport qualified Control.Lens.TH as LTH\n\n\n-- Syntax for toy language\n\ndata EExp a\n  = ELit a\n  | EAdd (EExp a) (EExp a)\n  | EMul (EExp a) (EExp a)\n  | ESub (EExp a) (EExp a)\n  deriving Show\n\n-- build out a set of focus functions using lens / TH\n\nLTH.makePrisms ''EExp\n\n\n-- An example \"text\" in the Syntax\n\neg1 :: EExp Int\neg1 = EAdd\n        (ELit 1)\n        (EAdd (ELit 2) (ELit 0))\n\n-- using lenses, we build out all the\n-- EExp possibilities from the example \"text\":\n\nlensedOptions :: Show a =&gt; EExp a -&gt; [EExp a]\nlensedOptions exp =\n  let\n    maybeGet l = Lens.preview l exp\n    listMaybes =\n      [ Just exp\n      , maybeGet (_EAdd.(Lens._1))\n      , maybeGet (_EAdd.(Lens._2))\n      , maybeGet (_EAdd.(Lens._2)._EAdd.(Lens._1))\n      , maybeGet (_EAdd.(Lens._2)._EAdd.(Lens._2))\n      ]\n  in\n    maybe [] id $ sequenceA listMaybes\n\nprintEm :: IO ()\nprintEm = sequence_ $ map print $ lensedOptions eg1\n\n-- using handwritten code, we build out all the\n-- EExp possibilities from the example \"text\":\n\n\nbuildOptions :: Show a =&gt; EExp a -&gt; [EExp a]\nbuildOptions exp =\n  let\n    buildBinOpts e1 e2 = [exp] ++ buildOptions e1 ++ buildOptions e2\n  in\n    case exp of\n      ELit i -&gt; [exp]\n      EAdd e1 e2 -&gt;\n        buildBinOpts e1 e2\n      EMul e1 e2 -&gt;\n        buildBinOpts e1 e2\n      ESub e1 e2 -&gt;\n        buildBinOpts e1 e2\n\nprintEm2 :: IO ()\nprintEm2 = sequence_ $ map print $ buildOptions eg1\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "parse-error"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1496060093, "post_id": 44241937, "comment_id": 75493527, "body": "The pattern-matching issue aside, note that your algorithm is <i>extremely</i> inefficient: <code>length</code> already needs to traverse the entire list. If you then recurse on that, you end up with a complexity of <i>O</i> (<i>n</i> &#178;) for a simple lookup!"}], "answers": [{"tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": false, "score": 1, "last_activity_date": 1496059961, "creation_date": 1496059961, "answer_id": 44242214, "question_id": 44241937, "link": "https://stackoverflow.com/questions/44241937/haskell-parse-error-in-pattern-x-xs/44242214#44242214", "title": "Haskell: Parse error in pattern x ++ xs", "body": "<p>Presumably, you're trying to match the head and tail part of a list. Let's step through it:</p>\n\n<pre><code>myElementAt (x:_) 0 = x\n</code></pre>\n\n<p>This means that if the head is <code>x</code>, the tail is something, and the index is 0, return the head. Note that your <code>x ++ x</code> is a concatenation of two lists, not the head and tail parts.</p>\n\n<p>Then you can have</p>\n\n<pre><code>myElementAt(_:tl) i = myElementAt tl (i - 1)\n</code></pre>\n\n<p>which means that if the previous pattern was not matched, ignore the head, and take the <em>i - 1</em> element of the tail.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1496059980, "creation_date": 1496059980, "answer_id": 44242217, "question_id": 44241937, "link": "https://stackoverflow.com/questions/44241937/haskell-parse-error-in-pattern-x-xs/44242217#44242217", "title": "Haskell: Parse error in pattern x ++ xs", "body": "<p>Haskell has two different kinds of value-level entities: <em>variables</em> (this also includes functions, infix operators like <code>++</code> etc.) and <em>constructors</em>. Both can be used in expressions, but only constructors can also be used in patterns.</p>\n\n<p>In either case, it's easy to tell whether you're dealing with a variable or constructor: a constructor always starts with an uppercase letter (e.g. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Maybe.html#v:Nothing\" rel=\"noreferrer\"><code>Nothing</code></a>, <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Types.html#v:True\" rel=\"noreferrer\"><code>True</code></a> or <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Lazy.html#t:StateT\" rel=\"noreferrer\"><code>StateT</code></a>) or, if it's an infix, with a colon (<code>:</code>, <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Complex.html\" rel=\"noreferrer\"><code>:+</code></a>). Everything else is a variable. Fundamentally, the difference is that a constructor is always a unique, immediately matcheable value from a predefined collection (namely, the alternatives of a <code>data</code> definition), whereas a variable can just have <em>any value</em>, and often it's <em>in principle not possible</em> to uniquely distinguish different variables, in particular if they have a function type.</p>\n\n<p>Yours is actually a good example for this: for the pattern match <code>x ++ xs</code> to make sense, there would have to be <em>one unique way</em> in which the input list could be written in the form <code>x ++ xs</code>. Well, but for, say <code>[0,1,2,3]</code>, there are multiple different ways in which this can be done:</p>\n\n<pre><code>[] ++[0,1,2,3]\n[0] ++ [1,2,3]\n[0,1] ++ [2,3]\n[0,1,2] ++ [3]\n[0,1,2,3]++ []\n</code></pre>\n\n<p>Which one should the runtime choose?</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1496059983, "creation_date": 1496059983, "answer_id": 44242220, "question_id": 44241937, "link": "https://stackoverflow.com/questions/44241937/haskell-parse-error-in-pattern-x-xs/44242220#44242220", "title": "Haskell: Parse error in pattern x ++ xs", "body": "<p>In patterns, you can only use constructors like <code>:</code> and <code>[]</code>. The append operator <code>(++)</code> is a non-constructor function.</p>\n\n<p>So, try something like:</p>\n\n<pre><code>myElementAt :: [a] -&gt; Int -&gt; a\nmyElementAt (x:xs) i = ...\n</code></pre>\n\n<p>There are more issues in your code, but at least this fixes your first problem.</p>\n"}, {"tags": [], "owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "is_accepted": false, "score": 0, "last_activity_date": 1496060071, "creation_date": 1496060071, "answer_id": 44242251, "question_id": 44241937, "link": "https://stackoverflow.com/questions/44241937/haskell-parse-error-in-pattern-x-xs/44242251#44242251", "title": "Haskell: Parse error in pattern x ++ xs", "body": "<p>in standard Haskell pattern matches like this :  </p>\n\n<pre><code>f :: Int -&gt; Int\nf (g n 1) = n\n\ng :: Int -&gt; Int -&gt; Int\ng a b = a+b\n</code></pre>\n\n<p>Are illegal because function calls aren't allowed in patterns, your case is just a special case as the operator <code>++</code> is just a function.  </p>\n\n<p>To pattern match on lists you can do it like this:  </p>\n\n<pre><code>myElementAt :: [a] -&gt; Int -&gt; a\nmyElementAt (x:xs) i = // result\n</code></pre>\n\n<p>But in this case <code>x</code> is of type <code>a</code> not <code>[a]</code> , it is the head of the list and <code>xs</code> is its tail, you'll need to change your function implementation to accommodate this fact, also this function will fail with the empty list <code>[]</code>. However that's the idiomatic haskell way to pattern match aginst lists.  </p>\n\n<p>I should mention that when I said \"illegal\" I meant in standard Haskell, there are GHC extensions that give something similar to that , it's called <code>ViewPatterns</code> But I don't think you need it especially that you're still learning.</p>\n"}], "owner": {"reputation": 226, "user_id": 7525350, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8684620dc1923d467f336e062c5e90c1?s=128&d=identicon&r=PG&f=1", "display_name": "tillyboy", "link": "https://stackoverflow.com/users/7525350/tillyboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 1, "accepted_answer_id": 44242217, "answer_count": 4, "score": 1, "last_activity_date": 1504684011, "creation_date": 1496059019, "last_edit_date": 1504684011, "question_id": 44241937, "link": "https://stackoverflow.com/questions/44241937/haskell-parse-error-in-pattern-x-xs", "title": "Haskell: Parse error in pattern x ++ xs", "body": "<p>Doing the <a href=\"https://wiki.haskell.org/99_questions/1_to_10\" rel=\"nofollow noreferrer\">third of the 99-Haskell problems</a> (I am currently trying to learn the language) I tried to incorporate pattern matching as well as recursion into my function which now looks like this:</p>\n\n<pre><code>myElementAt :: [a] -&gt; Int -&gt; a\nmyElementAt (x ++ xs) i =\n  if length (x ++ xs) == i &amp;&amp; length xs == 1 then xs!!0\n  else myElementAt x i\n</code></pre>\n\n<p>Which gives me <code>Parse error in pattern: x ++ xs</code>. The questions:</p>\n\n<ol>\n<li>Why does this give me a parse error? Is it because Haskell is no idea where to cut my list (Which is my best guess)?</li>\n<li>How could I reframe my function so that it works? The algorithmic idea is to check wether the list has the length as the specified inde; if yes return the last elemen; if not cut away one element at the end of the list and then do the recursion.</li>\n</ol>\n\n<p>Note: I know that this is a really bad algorithm, but it I've set myself the challenge to write that function including recursion and pattern matching. I also tried not to use the <code>!!</code> operator, but that is fine for me since the only thing it really does (or should do if it compiled) is to convert a one-element list into that element.</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496062318, "post_id": 44241843, "comment_id": 75494864, "body": "Minor note: the output-after-input is usually caused by buffering. Try to either end with a newline (<code>putStrLn</code>) or expicitly <code>hFlush stdin</code> after the print."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 2, "creation_date": 1496062646, "post_id": 44241843, "comment_id": 75495065, "body": "If I understand correctly what you want, you can add state to stream with a <code>StateT</code> transformer like this: <code>Stream (Of Elem) (StateT State IO) Result</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496064087, "post_id": 44241843, "comment_id": 75496023, "body": "@chi: oh, right! Thanks!"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1496064442, "post_id": 44241843, "comment_id": 75496251, "body": "I&#39;m trying with WriterT: <code>type W = WriterT [String] IO</code> and now <code>gen::S.Stream (S.Of Int) W ()</code>. It calls <code>lift $ tell [&quot;err1&quot;]</code>, but <code>proc1</code> calls <code>tell</code> in loop so I get multiple same messages in Writer&#39;s monoid. I don&#39;t know how to do it only once... But your suggestions is right, yes."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1496066537, "post_id": 44241843, "comment_id": 75497609, "body": "@freestyle: thanks! It works. Is such solution good/convenient from performance point of view?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1496071493, "post_id": 44241843, "comment_id": 75500469, "body": "@Paul-AG: Well, I don&#39;t know a better solution except to write the library of streams with state. So, this solution will be with some overhead, but this price for reusing the code."}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1496058717, "creation_date": 1496058717, "question_id": 44241843, "link": "https://stackoverflow.com/questions/44241843/streaming-based-pipe-with-common-state", "title": "Streaming-based pipe with common state", "body": "<p>I'm Haskell beginner and newbie in <strong>Streaming</strong> library (<a href=\"https://hackage.haskell.org/package/streaming\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/streaming</a>) as fastest and (I'm hope) simplest stream library. I'm trying to make next common and popular \"pattern\": processing of stream items with common state, see Fig, please:</p>\n\n<pre><code>   .--state-------+--state'--------+--state''--&gt;\n   |              |                |\n[e0..eN] ==&gt; [e0'...eN'] ==&gt; [e0''..eN''] =====&gt;\n</code></pre>\n\n<p>This \"state\" will be used for statistics, errors, whatever - through the whole workflow. Some of \"pipe\" nodes will iterate over <code>eN</code> items (which will be lists/streams too), concatenates results... How this can be achieved with Streaming library? I mean each \"node\" should have access to stream items but to \"global\" state too. Also nodes will do IO actions! I tried to use return of \"node\" as state (second component in Stream's pair): stream is monad, so <code>do e &lt;- stream</code> binds one of returning values to <code>e</code>, but this does not look very rightly...</p>\n\n<p>One of my attempts is:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Main where\n\nimport Control.Monad\nimport Control.Monad.Writer\nimport Data.Functor.Identity\nimport Streaming\nimport qualified Streaming.Prelude as S\n\n\ntype R = Writer [String] ()\n\ngen :: S.Stream (S.Of Int) IO R\ngen = do\n  S.yield 1000\n  S.yield 2000\n  -- lift $ putStr \"enter x: \" -- ERROR: shown after input!!!\n  x &lt;- lift getLine\n  let n = read x::Int\n  S.yield n\n  return $ do\n    tell [\"genErr1\"]\n    tell [\"genErr2\"]\n\nproc1 :: S.Stream (S.Of Int) IO R -&gt; S.Stream (S.Of Int) IO R\nproc1 str = loop str\n  where\n    loop str = do\n      e &lt;- lift $ S.next str\n      e' &lt;- case e of\n        Left err -&gt; return err\n        Right (e', str') -&gt; (S.yield $ e' + 123) &gt;&gt; loop str'\n      return $ do\n        tell [\"proc1Err1\"]\n        tell [\"proc1Err2\"]\n\nmain :: IO ()\nmain = do\n  p &lt;- S.mapM_ print $ proc1 gen\n  putStr \"p: \" &gt;&gt; print p\n</code></pre>\n\n<p>where I use \"Write\"-monad as return value (to save there my logs/statistics)...</p>\n\n<p>So, I want to process with <code>proc1</code> stream items getting from <code>gen</code> and to have at the end some state global for all pipe where will be \"genErr1\", \"genErr2\", \"proc1Err1\", \"proc1Err2\" (they simulate errors occuring while process stream's items). How to achieve this? Could somebody help me, please?</p>\n\n<p>PS. Interesting error: print happens after input (marked as ERROR in code).</p>\n"}, {"tags": ["haskell", "matrix", "instance", "show"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1496056932, "post_id": 44241139, "comment_id": 75491541, "body": "IMO it&#39;s fine for a <code>Show</code> instance to pretty-print the result. Just, it should still be valid Haskell syntax. That&#39;s something <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">hmatrix</a> really does quite nicely."}, {"owner": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "edited": false, "score": 0, "creation_date": 1496057934, "post_id": 44241139, "comment_id": 75492159, "body": "As I&#39;m a Haskell beginner, I don&#39;t think using an external library would be useful at this point. I&#39;m mostly trying to understand how things work. Your suggestion above means that I have to replace unlines and unwords with another expression and then define a line separator?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "edited": false, "score": 0, "creation_date": 1496070139, "post_id": 44241139, "comment_id": 75499756, "body": "@JohnStef, I&#39;m using only stuff in the prelude. As for my comment about &quot;unlines&quot; and &quot;unwords&quot;, please ignore it. I had &quot;lines&quot; and &quot;unlines&quot; swapped in my head."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 4, "last_activity_date": 1496070049, "last_edit_date": 1496070049, "creation_date": 1496056373, "answer_id": 44241139, "question_id": 44240834, "link": "https://stackoverflow.com/questions/44240834/inserting-outline-in-a-given-matrix-using-a-show-instance-in-haskell/44241139#44241139", "title": "Inserting outline in a given matrix using a show instance, in Haskell", "body": "<p>The first thought is that <code>show</code> is probably the wrong place for this. There is a general principle that <code>read</code> should be the inverse of <code>show</code>. While you haven't got a <code>Read</code> instance, its still usual to put pretty-printing in a separate function. However that is just a style thing.</p>\n\n<p>[Incorrect statement deleted]</p>\n\n<p>You want to be able to handle rows of varying length by padding them out with blanks (as I understand it). You therefore need to find the maximum row length. You probably want something like</p>\n\n<pre><code>where\n   cols = maximum $ map length rows\n</code></pre>\n\n<p>Then you can generate your separator line using something like</p>\n\n<pre><code>   sepLine = '+' : concat (replicate cols \"----+\")\n</code></pre>\n"}], "owner": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "closed_date": 1496058937, "accepted_answer_id": 44241139, "answer_count": 1, "score": 0, "last_activity_date": 1496323305, "creation_date": 1496055491, "last_edit_date": 1496323305, "question_id": 44240834, "link": "https://stackoverflow.com/questions/44240834/inserting-outline-in-a-given-matrix-using-a-show-instance-in-haskell", "closed_reason": "Duplicate", "title": "Inserting outline in a given matrix using a show instance, in Haskell", "body": "<p>I know this question is similar to the one specified as duplicate, but I changed my approach so any help for this particular case would be appreciated.</p>\n\n<p>I would like to create a show instance for every given matrix that will not only visualize its contents, but also create an outline with columns.</p>\n\n<p>My code so far is the following:</p>\n\n<pre><code>instance Show a =&gt; Show (Mat a) where\n  show  =  unlines . map (unwords . map ((++\" |\") . show)) . mrows\n</code></pre>\n\n<p>The output I get is:</p>\n\n<pre><code>1 | 2 | 3 |\n4 | 5 | 6 |\n</code></pre>\n\n<p>What I could not perform is to insert lines above, below and in-between the matrix, to be looking like the following example:</p>\n\n<pre><code>+---+---+---+\n| 1 | 2 | 3 |\n+---+---+---+\n| 4 | 5 | 6 | \n+---+---+---+\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 1, "creation_date": 1496047362, "post_id": 44238059, "comment_id": 75485730, "body": "the pasting is just copying the values from one list to another, what should be, if the region you are checking is in the image1 region take that values, otherwise thake image1 values"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1496048211, "post_id": 44238059, "comment_id": 75486209, "body": "I don&#39;t get what that <code>paste</code> do. Why does it accept <code>Image Bool</code> instead of <code>Bool</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1496048176, "post_id": 44238359, "comment_id": 75486186, "body": "How do you match <code>Image Bool</code> with <code>True</code> or <code>False</code>?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496049144, "post_id": 44238359, "comment_id": 75486751, "body": "Noticed that myself.  Fixed now."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496051185, "post_id": 44238359, "comment_id": 75488024, "body": "Okay, that seems to work.  Hope the explanation is clear."}, {"owner": {"reputation": 67, "user_id": 8030342, "user_type": "registered", "profile_image": "https://graph.facebook.com/810317785783715/picture?type=large", "display_name": "Kim Bogdan Fransson", "link": "https://stackoverflow.com/users/8030342/kim-bogdan-fransson"}, "edited": false, "score": 0, "creation_date": 1496052220, "post_id": 44238359, "comment_id": 75488644, "body": "I don&#39;t get what coords is in your function. Apart from that I appreciate your test example."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496052916, "post_id": 44238359, "comment_id": 75489081, "body": "In that example <code>coords</code> is the fourth parameter of a function whose parameters are <code>Region</code>, <code>Image a</code>, <code>Image a</code> and <code>Position</code>.  So it\u2019s a <code>Position</code>, which is defined as <code>(Float, Float)</code>.  So, try it with <code>redCircleOnWhite (0.5, 0.5)</code> and <code>redCircleOnWhite (1.0, 1,0)</code>.  (I changed the definition of <code>unitCircle</code> so it is now an actual circle, not a quarter-circle.)"}, {"owner": {"reputation": 67, "user_id": 8030342, "user_type": "registered", "profile_image": "https://graph.facebook.com/810317785783715/picture?type=large", "display_name": "Kim Bogdan Fransson", "link": "https://stackoverflow.com/users/8030342/kim-bogdan-fransson"}, "edited": false, "score": 0, "creation_date": 1496053883, "post_id": 44238359, "comment_id": 75489682, "body": "Ah! Now I get it. Thanks"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1496054433, "post_id": 44238359, "comment_id": 75489976, "body": "Although <code>unitCircle</code> is now no longer a <i>unit</i> circle."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496058113, "post_id": 44238359, "comment_id": 75492287, "body": "You can avoid <code>== True</code> by simply omitting it."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496079248, "post_id": 44238359, "comment_id": 75504039, "body": "@chi True! (I could have avoided saying that as well.) In this case, I guessed it made the example slightly clearer. By all means omit it if you prefer!"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 1, "last_activity_date": 1496052862, "last_edit_date": 1496052862, "creation_date": 1496048096, "answer_id": 44238359, "question_id": 44238059, "link": "https://stackoverflow.com/questions/44238059/understanding-a-haskell-type-from-an-old-exam/44238359#44238359", "title": "Understanding a Haskell type from an old exam", "body": "<p>All right.  You\u2019ve got your screen coordinates represented by a [0,1]\u00d7[0,1] rectangle.  A region is a boolean function over that rectangle, which returns true if and only if a coordinate is in that region.  Then you have two images, <code>img1</code> and <code>img2</code>, which are mappings from coordinates to pixels (or in theory to something else).</p>\n\n<p>You want to return a new image, which is equal to <code>img1</code> for coordinates within <code>reg</code> or <code>img2</code> for coordinates outside <code>reg</code>.  Images are mappings from coordinates to pixels, so you are really returning a function.</p>\n\n<p>The type is <code>Region -&gt; Image a -&gt; Image a -&gt; Image a</code>, but remember that <code>Image a</code> is <code>Position -&gt; a</code>, and <code>Region</code> is <code>Image Bool</code>, so this is really <code>(Position -&gt; Bool) -&gt; (Position -&gt; a) -&gt; (Position -&gt; a ) -&gt; Position -&gt; a</code>.  We\u2019re going to need that final <code>Position</code> parameter before the <code>-&gt; a</code> and give it as an argument to the three function parameters.</p>\n\n<p>Therefore,</p>\n\n<pre><code>paste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\n-- Is really: (Position-&gt;Bool) -&gt; (Position-&gt;a) -&gt; (Position-&gt;a) -&gt; Position -&gt; a\npaste reg overlay bg coords | reg coords == True = overlay coords\n                            | otherwise          = bg coords\n</code></pre>\n\n<p>A longer version with a test case:</p>\n\n<pre><code>module Image where\n\ntype Image a = Position -&gt; a\ntype Position = (Float, Float) -- [0,1]\u00d7[0,1]\n\ndata Color = RGB Int Int Int -- Pixels have values in [0,255]\u00d7[0,255]\u00d7[0,255].\n  deriving Show\n-- Not efficient for real-world use, but will do for now.\n\ntype Region = Image Bool\ntype ColorImage = Image Color\n\npaste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\n-- Is really: (Position-&gt;Bool) -&gt; (Position-&gt;a) -&gt; (Position-&gt;a) -&gt; Position -&gt; a\npaste reg overlay bg coords | reg coords == True = overlay coords\n                            | otherwise          = bg coords\n\nallRed :: ColorImage\nallRed _ = RGB 255 0 0\n\nallWhite :: ColorImage\nallWhite _ = RGB 255 255 255\n\nunitCircle :: Region\nunitCircle (x,y) = sqrt (x'*x' + y'*y') &lt;= 0.5\n  where x' = x - 0.5\n        y' = y - 0.5\n\nredCircleOnWhite :: ColorImage\nredCircleOnWhite = paste unitCircle allRed allWhite\n</code></pre>\n\n<p>You can test <code>redCircleOnWhite</code> in the REPL.</p>\n"}, {"comments": [{"owner": {"reputation": 67, "user_id": 8030342, "user_type": "registered", "profile_image": "https://graph.facebook.com/810317785783715/picture?type=large", "display_name": "Kim Bogdan Fransson", "link": "https://stackoverflow.com/users/8030342/kim-bogdan-fransson"}, "edited": false, "score": 0, "creation_date": 1496051651, "post_id": 44238966, "comment_id": 75488298, "body": "Nice explanation! I think I got it. Thank you for showing the procedure too. It was the pattern matching I didn&#39;t get at first but now I got it, thank you."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1496055579, "last_edit_date": 1496055579, "creation_date": 1496049918, "answer_id": 44238966, "question_id": 44238059, "link": "https://stackoverflow.com/questions/44238059/understanding-a-haskell-type-from-an-old-exam/44238966#44238966", "title": "Understanding a Haskell type from an old exam", "body": "<p>While this is little use when you're actually sitting in an exam, here's the \u201cteach a man to trawl-fish\u201d answer: <em>start out without defining any result at all, and let the compiler</em> (must be GHC\u22657.8) <em>comment on it</em>. Note that the stub is wrong: if <code>Image</code> is just a <code>type</code>-def, you don't need the value constructor <code>Image</code> to pattern match on it.</p>\n\n<pre><code>newtype Image a = Image (Position -&gt; a)\n    -- it should be `newtype` instead of `type`, else there\n    -- won't be an explicit `Image` value constructor\ntype Position = (Float, Float)\ntype Region = Image Bool\n\npaste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\npaste (Image bol) img1 img2 = _\n</code></pre>\n\n<p>GHC will come back with</p>\n\n<pre><code>/tmp/wtmpf-file6644.hs:8:31:\n    Found hole \u2018_\u2019 with type: Image a\n    Where: \u2018a\u2019 is a rigid type variable bound by\n               the type signature for\n                 paste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\n    ...\n</code></pre>\n\n<p>Ok, that's hardly surprising: we already know that the result should be an image. Now, there's only one contructor for <code>Image</code>, namely <code>Image</code>, so we know for sure we need that to construct such an image. Still don't know anything about the <em>inner implementation</em>:</p>\n\n<pre><code>paste (Image bol) img1 img2 = Image _\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>/tmp/wtmpf-file6644.hs:8:37:\n    Found hole \u2018_\u2019 with type: Position -&gt; a\n    Where: \u2018a\u2019 is a rigid type variable bound by\n               the type signature for\n                 paste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\n               at /tmp/wtmpf-file6644.hs:7:10\n</code></pre>\n\n<p>Aha, so there's an extra function argument lurking hidden in the <code>Image</code>! Let's pattern match on that, too:</p>\n\n<pre><code>paste (Image bol) img1 img2 = Image $ \\pos -&gt; _\n\n/tmp/wtmpf-file6644.hs:8:47:\n    Found hole \u2018_\u2019 with type: a\n    ...\n</code></pre>\n\n<p>Ok, <code>a</code> is completely opaque, so now we know for sure there's <em>nothing we can do without further information</em>. Fortunately, we do have further information, in form of the arguments. As GHC will inform you:</p>\n\n<pre><code>    ...\n    Relevant bindings include\n      pos :: Position (bound at /tmp/wtmpf-file6644.hs:8:40)\n      img2 :: Image a (bound at /tmp/wtmpf-file6644.hs:8:24)\n      img1 :: Image a (bound at /tmp/wtmpf-file6644.hs:8:19)\n      bol :: Position -&gt; Bool (bound at /tmp/wtmpf-file6644.hs:8:14)\n</code></pre>\n\n<p>There's not <em>much</em> we can do with that... which is good, because this makes it obvious what <em>should</em> be done: we can feed <code>pos</code> as an argument to <code>bol</code>. The result has then type <code>Bool</code> (unlike <code>bol</code> itself), so that is now a good candidate for an <code>if</code> switch.</p>\n\n<pre><code>paste (Image bol) img1 img2 = Image $ \\pos -&gt; if bol pos\n         then _\n         else _\n</code></pre>\n\n<p>...</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: a\n      ...\n</code></pre>\n\n<p>seen that before, so again we need more information. Let's look back at those arguments: <code>Image a</code> can still be pattern matched</p>\n\n<pre><code>paste (Image bol) (Image img1) (Image img2)\n  = Image $ \\pos -&gt; if bol pos\n         then _\n         else _\n</code></pre>\n\n<p>Now it says:</p>\n\n<pre><code>    Relevant bindings include\n      pos :: Position (bound at /tmp/wtmpf-file6644.hs:9:14)\n      img2 :: Position -&gt; a (bound at /tmp/wtmpf-file6644.hs:8:39)\n      img1 :: Position -&gt; a (bound at /tmp/wtmpf-file6644.hs:8:26)\n      bol :: Position -&gt; Bool (bound at /tmp/wtmpf-file6644.hs:8:14)\n</code></pre>\n\n<p>Aha, so <code>img1</code> and <code>img2</code> can yield an <code>a</code> value as we need, we just need them to feed a <code>Position</code> first. Well, we still have <code>pos</code>, so it's obvious what to do:</p>\n\n<pre><code>paste (Image bol) (Image img1) (Image img2)\n  = Image $ \\pos -&gt; if bol pos\n         then img1 pos\n         else img2 pos\n</code></pre>\n\n<p>...or with the two images swapped (think about that yourself). But there aren't really any other definitions you can write using only the given information (and <em>all</em> of it!), so this typed-hole procedure is a pretty foolproof way of implementing a function.</p>\n"}], "owner": {"reputation": 67, "user_id": 8030342, "user_type": "registered", "profile_image": "https://graph.facebook.com/810317785783715/picture?type=large", "display_name": "Kim Bogdan Fransson", "link": "https://stackoverflow.com/users/8030342/kim-bogdan-fransson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 44238966, "answer_count": 2, "score": 1, "last_activity_date": 1496055579, "creation_date": 1496047090, "question_id": 44238059, "link": "https://stackoverflow.com/questions/44238059/understanding-a-haskell-type-from-an-old-exam", "title": "Understanding a Haskell type from an old exam", "body": "<p>I am studying for a Haskell exam and I'm a bit stuck on this question:\n<a href=\"https://i.stack.imgur.com/ejynd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ejynd.png\" alt=\"enter image description here\"></a></p>\n\n<p>My first thought was to write something like this</p>\n\n<pre><code>paste :: Region -&gt; Image a -&gt; Image a -&gt; Image a\npaste (Image bol) img1 img2 = if bol\n                              then -- do the pasting\n                              else -- well do nothing\n</code></pre>\n\n<p>But I don't know how to do the pasting. Can someone point me in the right direction?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 2, "creation_date": 1496026370, "post_id": 44233992, "comment_id": 75477777, "body": "You&#39;re implying that <code>n</code> is being <i>replaced</i> or <i>overwritten</i> with a new value. If that was the case, no function could ever safely be called twice. Obviously that&#39;s not true. With each invocation of <code>drop</code>, <code>n</code> is a new <code>n</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 5, "creation_date": 1496027326, "post_id": 44233992, "comment_id": 75477948, "body": "It&#39;s not the <i>same</i> variable. Every call introduces new variables for the parameters, albeit with the same name."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1496031028, "post_id": 44233992, "comment_id": 75478689, "body": "In C, I can write <code>int f(const int n) {if(n == 0) return 1; else return f(n-1)*n;}</code> which is recursive. But <code>const</code> means <code>n</code> can&#39;t change, right? So why is this allowed?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496032644, "post_id": 44233992, "comment_id": 75479026, "body": "It all works the same as in math <a href=\"https://www.khanacademy.org/math/algebra/sequences/constructing-arithmetic-sequences/a/writing-recursive-formulas-for-arithmetic-sequences\" rel=\"nofollow noreferrer\">khanacademy.org/math/algebra/sequences/&hellip;</a> , that&#39;s why haskell is a (pure) functional language."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1496037022, "post_id": 44233992, "comment_id": 75480335, "body": "In short, just about the same way as in any other mainstream language (liike C or Python). Mutability (ability to rebind/reassign/modify) has little to do with it."}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 3, "last_activity_date": 1496036675, "last_edit_date": 1496036675, "creation_date": 1496036191, "answer_id": 44235233, "question_id": 44233992, "link": "https://stackoverflow.com/questions/44233992/how-does-variable-binding-work-with-recursion-in-haskell/44235233#44235233", "title": "How does variable binding work with recursion in Haskell?", "body": "<p>Haskell has <em>lexical scoping</em>.  When you declare a variable inside a scope, it hides any variable with the same name from an outer scope.  For example, in the following program,</p>\n\n<pre><code>x :: Int\nx = 5\n\nmain :: IO ()\nmain = do\n         x &lt;- readLn :: IO Int\n         print x\n</code></pre>\n\n<p>If you compile with <code>ghc -Wall</code>, it will compile correctly, but give you the following warnings:</p>\n\n<pre><code>sx-scope.hs:2:1: warning: [-Wunused-top-binds]\n    Defined but not used: \u2018x\u2019\n\nsx-scope.hs:6:10: warning: [-Wname-shadowing]\n    This binding for \u2018x\u2019 shadows the existing binding\n      defined at sx-scope.hs:2:1\n</code></pre>\n\n<p>So the <code>x</code> outside <code>main</code> and the <code>x</code> in <code>main</code> are different variables, and the one in the inner scope temporarily hides the one in the outer scope.  (Okay, \u201ctemporarily\u201d in this example means until <code>main</code> returns, which is as long as the program is running, but you get the concept.)</p>\n\n<p>Similarly, when you declare <code>drop n xs</code> or <code>\\n xs -&gt;</code>, <code>n</code> and <code>xs</code> are local variables that only exist during that invocation of the function.  It can be called more than once with different values of <code>n</code> and <code>xs</code>.</p>\n\n<p>When a function is tail-recursive, that is, returns a call to itself, the compiler knows it is about to replace the old parameters, which were from a scope that no longer exists, with updated parameters of the same type.  So it can re-use the stack frame and store the new parameters in the same locations as the previous ones.  The resulting code can be as fast as iteration in a procedural language.</p>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 1, "last_activity_date": 1496041408, "creation_date": 1496041408, "answer_id": 44236396, "question_id": 44233992, "link": "https://stackoverflow.com/questions/44233992/how-does-variable-binding-work-with-recursion-in-haskell/44236396#44236396", "title": "How does variable binding work with recursion in Haskell?", "body": "<p>From <a href=\"https://en.wikibooks.org/wiki/Haskell/Variables_and_functions\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Haskell/Variables_and_functions</a>, </p>\n\n<blockquote>\n  <p>Within a given scope, a variable in Haskell gets defined only once and cannot change.</p>\n</blockquote>\n\n<p>but <em>scope</em> isn't just the code of the function. Roughly, it's the code of function + its context, i.e. the arguments it's been called with, and anything from its outer scope. This is often referred to as a <em>closure</em>. Every time you call a function, the code runs under a new closure, and so the variables can evaluate to different things.</p>\n\n<p>The recursive case isn't anything special with regards to this: a function being called twice by other code would run with a different closure, and its internal variables can evaluate to different things.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 1, "last_activity_date": 1496121562, "creation_date": 1496121562, "answer_id": 44253990, "question_id": 44233992, "link": "https://stackoverflow.com/questions/44233992/how-does-variable-binding-work-with-recursion-in-haskell/44253990#44253990", "title": "How does variable binding work with recursion in Haskell?", "body": "<p>In almost any language, identifiers are only meaningful because they exist in a <em>scope</em>; conceptually a sort of implicit map from names to the things they denote.</p>\n\n<p>In modern languages you usually have (at least) a global scope, and each local scopes associated with each function/procedure. Pseudocode example:</p>\n\n<pre><code>x = 1\nprint x\nx = 2\nprint x\n\nfunction plus_one(a):\n  b = 1\n  return a + b\n\nprint plus_one(x)\n</code></pre>\n\n<p><code>x</code> is a name in the global scope, <code>a</code> and <code>b</code> are names in the local scope of the function <code>plus_one</code>.</p>\n\n<p>Imperative languages (and non-pure declarative languages) are generally understood by thinking of those names as mapped to a sort of slot or pigeon hole, into which things can be stored by assignment, and the current connects referred to by using the name. This works only because an imperative step-by-step way of thinking about these programs gives us a way of understanding what \"current\" means.<sup>1</sup> The above example shows this; <code>x</code> is first assigned <code>1</code>, then printed, then assigned <code>2</code>, then printed again; we'd expect this to print \"1\" and then print \"2\" (and then print \"3\" from the last line).</p>\n\n<p>Given that understanding of variables as slots that can store things, it's easy to fall into the trap of thinking of the local variables that represent a function's arguments as just slots that get filled when you call the function. I say trap because this is <em>not</em> a helpful way of thinking about function arguments and calls, even in imperative languages. It more or less works as long as each function only ever has one call \"in flight\" at once, but introducing one of any number of common programming features breaks this model (recursion, concurrency, laziness, closures, etc). That's the misunderstanding at the heart of a number of questions I've seen here on SO, where the poster was having trouble understanding recursive calls, or wanted to know how to access the local variables of a function from outside, or etc.</p>\n\n<p>You should actually think of a function as having a separate scope associated with each <strong>call</strong> of that function<sup>2</sup>. The function itself is kind of like a template for a scope, rather than a scope itself (although common language does usually talk about \"the scope of a function\" as shorthand). If you provided bindings for the function's parameters then you can <em>produce</em> a scope, but a typical function is called many times with different parameters, so there isn't just one scope for that function.</p>\n\n<p>Consider my pseudocode <code>plus_one</code>, with argument <code>a</code>. You <em>could</em> imagine that <code>a</code> is a local name for a variable, and the call <code>plus_one(x)</code> just assigns the contents of <code>x</code> into the slot for <code>a</code> and then starts executing the code of <code>plus_one</code>. But I contend that it's better to think that when you <strong>call</strong> <code>plus_one</code> on <code>x</code> you're creating a <em>new</em> scope, in which there is <em>a</em> variable called <code>a</code> (containing with the contents of the global scope <code>x</code> at this point), but it is not \"the\" <code>a</code> variable.</p>\n\n<p>This is vitally important for understanding recursion, even in imperative languages:</p>\n\n<pre><code>function drop(n, xs):\n  if n &lt;= 0 || null(xs):\n    return xs\n  else:\n    return drop(n - 1, tail(xs))\n</code></pre>\n\n<p>Here we could <em>try</em> to imagine that there's only one <code>xs</code> variable, and when we make the recursive call to <code>drop</code> we're assigning the tail of the original <code>xs</code> to the <code>xs</code> variable and starting the function's code again. But that falls down as soon as we change it to something like:</p>\n\n<pre><code>function drop(n, xs):\n  if n &lt;= 0 || null(xs):\n    return xs\n  else:\n    result = drop(n - 1, tail(xs))\n    print xs\n    return result\n</code></pre>\n\n<p>Now we're using <code>xs</code> after the recursive call. What this does is hard to explain if we're imagining that there's only one <code>xs</code>, but trivial if we think of there being a separate <code>xs</code> in a separate scope every time we call <code>drop</code>. When we make the recursive call to <code>drop</code> (passing it <code>n - 1</code> and <code>tail(xs)</code>) it creates its own separate <code>xs</code>, so it's entirely unmysterious that <code>print xs</code> in <em>this</em> scope still can access <code>xs</code>.</p>\n\n<p>So, is this story different with Haskell? It's true that the nature of variables is quite different in Haskell than from typical recursive languages. Instead of scopes mapping names to slots in which we can place different contents at different times, scopes map names directly to values, and there's no notion of time in which we could say an identifier \"was\" bound to one value (or was not bound to anything) and \"now\" is bound to a different value. <code>x = 1</code> at global scope in Haskell isn't a step that \"happens\" and changes something, it's just a fact. <code>x</code> just <strong><em>is</em></strong> <code>1</code>. Haskell isn't throwing an error at your <code>x = 10</code> and <code>x = 11</code> lines because the designers wanted to restrict you to only assigning a variable once, rather Haskell <em>does not have a concept of assignment at all</em>. <code>x = 10</code> is giving a <strong>definition</strong> for <code>x</code> in that scope, and you can't have two separate definitions for the same name in the same scope.</p>\n\n<p>The local scopes that come from functions in Haskell are the same; each name <strong><em>just is</em></strong> associated with a particular value<sup>3</sup>. But the actual values are <em>parameterised</em> on the values on which you call the function (they are quite literally a function of those values); each call has its own separate scope, with a different mapping from names to values. It's not that at each call <code>n</code> \"changes\" to become bound to the new argument, just that each call has a different <code>n</code>.</p>\n\n<p>So recursion affects variable binding in Haskell in pretty much the same way it does in all major imperative languages. What's more, the extremely flippant way to describe how recursion affects name binding in all of these languages is to say \"it doesn't\". Recursion actually isn't special at all in this way; parameter passing, local scopes, etc, works exactly the same way when you call a recursive function as when you call an \"ordinary\" non-recursive functions, <strong>provided</strong> you understand the local scopes as being associated with each <em>call</em> of the function, not as a single thing associated with the function.</p>\n\n<hr>\n\n<p><sup>1</sup> Sometimes even the scope mapping itself is mutable, and entries mapping names to slots can be added and removed as steps of the program. Python, for example, has a mutable global scope (in each module); you can add and remove module global variables dynamically, even with names determined from runtime data. But it uses immutable local scopes: a function's local variables exist even before they've been assigned a value (or after that value has been removed with <code>del</code>).</p>\n\n<p><sup>2</sup> At least, this is how functions/procedures very common work in modern languages. It's not totally universal, but it's generally acknowledged to be a good way for functions/procedures to work.</p>\n\n<p><sup>3</sup> Of course, thanks to laziness the particular value might be the bottom value, which is the \"value\" we pretend is the value of infinite loops and other forms of nontermination, so that we can interpret expressions as always having a value.</p>\n"}], "owner": {"reputation": 2000, "user_id": 5229124, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/367d67b55f083e09a5262cdf1a66bb90?s=128&d=identicon&r=PG", "display_name": "Luke Xu", "link": "https://stackoverflow.com/users/5229124/luke-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "accepted_answer_id": 44253990, "answer_count": 3, "score": 3, "last_activity_date": 1496121562, "creation_date": 1496026003, "question_id": 44233992, "link": "https://stackoverflow.com/questions/44233992/how-does-variable-binding-work-with-recursion-in-haskell", "title": "How does variable binding work with recursion in Haskell?", "body": "<p>I was reading about Haskell and it stated that once a variable is bound to an expression it cannot be rebound for example</p>\n\n<pre><code>x = 10\nx = 11\n\nAssign.hs:2:1: error:\n    Multiple declarations of \u2018x\u2019\n    Declared at: Assign.hs:1:1\n                 Assign.hs:2:1\n</code></pre>\n\n<p>So if this is the case... how is recursion working where the same variable keeps getting bound to other things? For example</p>\n\n<pre><code>drop n xs = if n &lt;= 0 || null xs\n              then xs\n              else drop (n-1) (tail xs)\n</code></pre>\n\n<p>the variable <code>n</code>... is being bound again and again every time the function recurses. Why is this allowed?</p>\n\n<p>Also if you guys could tell me some key words to search for so I can learn more about this myself I'd highly appreciate it.</p>\n"}, {"tags": ["haskell", "monads", "maybe"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1496005834, "post_id": 44231945, "comment_id": 75474034, "body": "not a very interesting answer, but i would say yes to both questions you raised"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496006074, "post_id": 44231945, "comment_id": 75474099, "body": "You can use something like <code>Just l | all (&gt;=0) l -&gt; ...</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1496006324, "post_id": 44231945, "comment_id": 75474166, "body": "Your case statement is equivalent to just <code>readMaybe line</code> in the same way that <code>if b then true else false</code> is equivalent to just <code>b</code>."}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 1, "creation_date": 1496006462, "post_id": 44231945, "comment_id": 75474210, "body": "I am aware of that, just pasted this code as I think it should be modified that way (using <code>case</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1496011406, "post_id": 44232399, "comment_id": 75475390, "body": "Also, <code>sequence . map f</code> = <code>traverse f</code>"}], "tags": [], "owner": {"reputation": 1213, "user_id": 544707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LVoaL.jpg?s=128&g=1", "display_name": "Anler", "link": "https://stackoverflow.com/users/544707/anler"}, "is_accepted": false, "score": 1, "last_activity_date": 1496008605, "creation_date": 1496008605, "answer_id": 44232399, "question_id": 44231945, "link": "https://stackoverflow.com/questions/44231945/using-readmaybe-to-read-list-of-natural-numbers/44232399#44232399", "title": "Using readMaybe to read list of natural numbers", "body": "<p>You could use <code>do</code>-notation and <code>guard</code> from <code>Control.Monad</code> to avoid the excessive pattern matching:</p>\n\n<pre><code>import Text.Read\nimport Control.Monad\n\n\nreadMaybeNatural :: String -&gt; Maybe Int\nreadMaybeNatural str = do\n  n &lt;- readMaybe str\n  guard $ n &gt;= 0\n  return n\n\n\nreadMaybeNaturals :: String -&gt; Maybe [Int]\nreadMaybeNaturals =\n  sequence . map readMaybeNatural . words\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1496010433, "creation_date": 1496010433, "answer_id": 44232600, "question_id": 44231945, "link": "https://stackoverflow.com/questions/44231945/using-readmaybe-to-read-list-of-natural-numbers/44232600#44232600", "title": "Using readMaybe to read list of natural numbers", "body": "<p>Well, if you're going to use <code>return</code> anyway to invoke the monad instance for <code>Maybe</code>, then I think I'd probably write:</p>\n\n<pre><code>import Text.Read\nimport Control.Monad\n\nreadMaybeNatList :: String -&gt; Maybe [Int]\nreadMaybeNatList line = do\n  ns &lt;- readMaybe line\n  guard $ all (&gt;=0) ns\n  return ns\n</code></pre>\n\n<p>which is a more idiomatic application of the <code>Maybe</code> monad.  Whether it's clearer than the explicit pattern-matching (and monad-free) alternative:</p>\n\n<pre><code>readMaybeNatList' :: String -&gt; Maybe [Int]\nreadMaybeNatList' line =\n  case readMaybe line of\n    Just ns | all (&gt;=0) ns -&gt; Just ns\n    _ -&gt; Nothing\n</code></pre>\n\n<p>is probably a matter of opinion and intended audience.</p>\n"}], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 44232600, "answer_count": 2, "score": 1, "last_activity_date": 1496010433, "creation_date": 1496004933, "question_id": 44231945, "link": "https://stackoverflow.com/questions/44231945/using-readmaybe-to-read-list-of-natural-numbers", "title": "Using readMaybe to read list of natural numbers", "body": "<p>I am using this function to read list of natural numbers from string in the following format: <code>[1, 2, 3]</code>:</p>\n\n<pre><code>readMaybeIntList :: String -&gt; Maybe [Int]\nreadMaybeIntList line = case readMaybe line of\n                          Just l -&gt; return l\n                          Nothing -&gt; Nothing\n</code></pre>\n\n<p>Right now it only works for integers - what would be the correct way to check whether the numbers are natural? Should I modify the <code>Just l</code> clause to check whether all numbers are <code>&gt;=0</code>? Is it a good idea to return <code>Nothing</code> from such nested <code>Just</code> clause?</p>\n"}, {"tags": ["haskell", "pattern-matching", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8078566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fa68a977777e3e3394476b896a3f0e?s=128&d=identicon&r=PG&f=1", "display_name": "user8078566", "link": "https://stackoverflow.com/users/8078566/user8078566"}, "edited": false, "score": 0, "creation_date": 1496004869, "post_id": 44231514, "comment_id": 75473704, "body": "Thanks a lot for response! I need a function  <code>f :: MonadIO m =&gt; Action m () -&gt; m ()</code>  that has different behavior for <code>Action IO ()</code> and <code>Action m ()</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13, "user_id": 8078566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fa68a977777e3e3394476b896a3f0e?s=128&d=identicon&r=PG&f=1", "display_name": "user8078566", "link": "https://stackoverflow.com/users/8078566/user8078566"}, "edited": false, "score": 0, "creation_date": 1496006434, "post_id": 44231514, "comment_id": 75474203, "body": "@user8078566 You could use a typeclass and overlapping instances, but I&#39;d rather avoid those. Why do you need a function with such a weird behavior? This looks as a consequence of a wrong decision elsewhere."}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "edited": false, "score": 0, "creation_date": 1496187875, "post_id": 44231514, "comment_id": 75554732, "body": "The entire purpose of <code>MonadIO</code> is that it is a class of Monads that lets you embed <i>the same</i> IO action into each of them. Furthermore, <code>Action m () -&gt; m ()</code> is in effect &#39;running&#39; the <code>Action</code>, not the monad, it really REALLY shouldn&#39;t behave differently depending on <code>m</code>. It sounds like what you probably want is your own type class. Where are you using this function?"}, {"owner": {"reputation": 13, "user_id": 8078566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fa68a977777e3e3394476b896a3f0e?s=128&d=identicon&r=PG&f=1", "display_name": "user8078566", "link": "https://stackoverflow.com/users/8078566/user8078566"}, "edited": false, "score": 0, "creation_date": 1496354967, "post_id": 44231514, "comment_id": 75641422, "body": "Thanks for the tips, Steven! My function basically runs a database query (which has type <code>MonadIO m =&gt; Action m ()</code>) and returns <code>m()</code>. I want this function to be applicable for IO and my own monad which implements <code>MonadIO</code> <code>MonadTrans</code> (StateT transformer) typeclass."}, {"owner": {"reputation": 13, "user_id": 8078566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fa68a977777e3e3394476b896a3f0e?s=128&d=identicon&r=PG&f=1", "display_name": "user8078566", "link": "https://stackoverflow.com/users/8078566/user8078566"}, "edited": false, "score": 0, "creation_date": 1496355320, "post_id": 44231514, "comment_id": 75641532, "body": "So i want to check: should i make a new connection (for <code>IO</code>) or get any existing connection from a state monad. I&#39;ve decided to make two function. A typeclass like MongoRunner is probably a good idea also."}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "edited": false, "score": 0, "creation_date": 1497061545, "post_id": 44231514, "comment_id": 75934244, "body": "Your function will be applicable for both monad types if you use generic methods that don&#39;t fix the monad involved, it will simply work in both as each operation you perform will know how to specialise to any <code>MonadIO m</code> that it is called in. And you will probably be best served by retrieving any existing connection, and allowing the monad you are operating in to provide it however it chooses. Then your generic code doesn&#39;t have to think about how the connection is obtained, it simply has one."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": true, "score": 4, "last_activity_date": 1496002641, "last_edit_date": 1496002641, "creation_date": 1496001935, "answer_id": 44231514, "question_id": 44231337, "link": "https://stackoverflow.com/questions/44231337/haskell-pattern-matching-with-named-fields/44231514#44231514", "title": "Haskell: Pattern matching with named fields", "body": "<p>IO is a type, you <strong>absolutely cannot</strong> case match against it, it only exists at compile time.</p>\n\n<p>In general, if you have a type variable constrained by a type class, you can only call things supported by that type class. You cannot know which particular type it is unless the typeclass implements methods for inspecting it, like <code>Typeable</code>. Neither <code>Monad</code> nor <code>MonadIO</code> implement this kind of run-time type discrimination, so what you want is, by design, not possible.</p>\n\n<p>Also note that, you don't need to know \"which m\" <code>delete</code> is, since it's specialized to whatever <code>m</code> that YOU want it to be, so long as it is an instance of <code>MonadIO</code>. You can simply declare <code>deleteIO sel = delete sel :: Action IO ()</code></p>\n\n<p>What are you actually trying to get done here?</p>\n"}, {"tags": [], "owner": {"reputation": 1213, "user_id": 544707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LVoaL.jpg?s=128&g=1", "display_name": "Anler", "link": "https://stackoverflow.com/users/544707/anler"}, "is_accepted": false, "score": 0, "last_activity_date": 1496006829, "last_edit_date": 1496006829, "creation_date": 1496006287, "answer_id": 44232125, "question_id": 44231337, "link": "https://stackoverflow.com/questions/44231337/haskell-pattern-matching-with-named-fields/44232125#44232125", "title": "Haskell: Pattern matching with named fields", "body": "<p>As <a href=\"https://stackoverflow.com/users/1946543/steven-armstrong\">Steven Armstrong</a> said, what you're trying to do is very weird, you cannot pattern match on IO because is <em>an abstract data type</em> (constructors aren't visible) and if I were you I would rethink what I'm trying to achieve. Having said that, Haskell still gives you a way of inspecting types at runtime using <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Typeable.html\" rel=\"nofollow noreferrer\">Typeable</a> eg (inside a ghci session):</p>\n\n<pre><code>import Data.Typeable\nimport Control.Monad.Trans.Reader\n\ntype MyType = ReaderT String IO\n\nf :: MyType ()\nf = ReaderT $ \\env -&gt; putStrLn env\n\ncheckF :: Typeable a =&gt; MyType a -&gt; Bool\ncheckF x = case show (typeOf x) of\n  \"ReaderT * [Char] IO ()\" -&gt; True\n  _                        -&gt; False\n\n-- checkF f =&gt; True\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8078566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fa68a977777e3e3394476b896a3f0e?s=128&d=identicon&r=PG&f=1", "display_name": "user8078566", "link": "https://stackoverflow.com/users/8078566/user8078566"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 44231514, "answer_count": 2, "score": 1, "last_activity_date": 1496006829, "creation_date": 1496000637, "last_edit_date": 1496001921, "question_id": 44231337, "link": "https://stackoverflow.com/questions/44231337/haskell-pattern-matching-with-named-fields", "title": "Haskell: Pattern matching with named fields", "body": "<p>I got <code>ReaderT</code> from <code>Control.Monad.Reader</code>:</p>\n\n<pre><code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a }\n</code></pre>\n\n<p>and <code>Action</code> from <code>Database.MongoDB.Query</code>:</p>\n\n<pre><code>type Action = ReaderT MongoContext\n</code></pre>\n\n<p>Query functions of MongoDB are something like this:</p>\n\n<pre><code>delete :: MonadIO m =&gt; Selection -&gt; Action m ()\n</code></pre>\n\n<p>I'm trying to use pattern mathing with <code>Action m ()</code> to check if it is <code>Action IO ()</code> or <code>Action _ ()</code></p>\n\n<p>A simple case like this</p>\n\n<pre><code>case x of\n  Action IO () -&gt; True\n  Action _ () -&gt; False\n</code></pre>\n\n<p>doesn't work, because <code>Action</code> is not a data constructor. Probably I should use something like this:</p>\n\n<pre><code>case x of\n  ReaderT MongoContext IO () -&gt; True\n  ReaderT MongoContext _ () -&gt; False\n</code></pre>\n\n<p>But then I get an error:</p>\n\n<pre><code>The constructor \u2018ReaderT\u2019 should have 1 argument, but has been given 3\n   In the pattern: ReaderT MongoContext IO ()\n   In a case alternative:\n      ReaderT MongoContext IO ()\n</code></pre>\n\n<p>Should I pass <code>MongoContext -&gt; IO ()</code> instead? I'm out of ideas, please help me with that expression. Thanks &lt;3</p>\n"}, {"tags": ["haskell", "persistent", "servant", "esqueleto"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1496002643, "post_id": 44231255, "comment_id": 75473078, "body": "Unrelated, but <code>SELECT * ...</code> is a bad style :). And why not just use SQLite or any other SQL DBs? They are all well typed ;)"}, {"owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "edited": false, "score": 0, "creation_date": 1496003130, "post_id": 44231255, "comment_id": 75473231, "body": "@Igor By bad style you mean not selecting only what is required? As per your second question, I have edited the question to specify I am using <code>persistent</code> with <code>postgresql</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1496003647, "post_id": 44231255, "comment_id": 75473368, "body": "Yeah. Why not just use SQL when you need SQL?"}, {"owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "edited": false, "score": 0, "creation_date": 1496003760, "post_id": 44231255, "comment_id": 75473404, "body": "Sorry @Igor, I keep not understanding what you mean by that. Are you suggesting to use just raw SQL for this instead of using Esqueleto?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1496003847, "post_id": 44231255, "comment_id": 75473431, "body": "Yep, nice and simple :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1496004032, "post_id": 44231255, "comment_id": 75473477, "body": "Just compare you SQL example and your haskell code. This is weird :) And btw, shouldn&#39;t the compiler tell you about syntax?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496005545, "post_id": 44231255, "comment_id": 75473926, "body": "@Igor Esqueleto aims to maintain type safety between Haskell and SQL. If you use plain SQL the compiler can not and will not check types are being marshalled correctly between the two worlds."}, {"owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "edited": false, "score": 1, "creation_date": 1496006363, "post_id": 44231255, "comment_id": 75474177, "body": "@Igor, what @chi said is the reason why I want to switch to <code>esqueleto</code>."}, {"owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496007236, "post_id": 44231255, "comment_id": 75474444, "body": "@chi I added some clarifications to my initial question."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496009722, "post_id": 44231255, "comment_id": 75475001, "body": "I can&#39;t answer since I have only a very basic experience with Esqueleto, but what&#39;s wrong with your code? Does it compile? Does it generate the wrong result?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496009991, "post_id": 44231255, "comment_id": 75475060, "body": "Anyway, from a quick look at the docs: <code>sub_select</code> only returns <i>one</i> value, so it looks as the wrong tool. I&#39;d try <code>in_</code> and <code>subList_select</code> to match the SQL closely."}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1563560941, "post_id": 48203558, "comment_id": 100754306, "body": "Needs to have a <code>$</code> in <code>subList_select from</code>, e.g. <code>subList_select $ from</code>, will fail otherwise. Please fix"}], "tags": [], "owner": {"reputation": 12964, "user_id": 704015, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/rpCnn.png?s=128&g=1", "display_name": "Jezen Thomas", "link": "https://stackoverflow.com/users/704015/jezen-thomas"}, "is_accepted": false, "score": 0, "last_activity_date": 1563784068, "last_edit_date": 1563784068, "creation_date": 1515662767, "answer_id": 48203558, "question_id": 44231255, "link": "https://stackoverflow.com/questions/44231255/how-to-do-a-select-in-select-using-esqueleto/48203558#48203558", "title": "How to do a &quot;SELECT ... IN (SELECT ...)&quot; using Esqueleto?", "body": "<p>You'll want something like this</p>\n\n<pre><code>getCommentsForArticle slug = do\n  c &lt;- select $ from $ \\cmts -&gt; do\n         let a = subList_select $ from $ \\arts -&gt; do\n                 where_ $ arts ^. ArticleSlug ==. val slug\n                 return $ arts ^. ArticleId\n         where_ $ cmts ^. CommentArticleId `in_` a\n         return cmts\n  return $ Cmts c\n</code></pre>\n"}], "owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1563784068, "creation_date": 1496000127, "last_edit_date": 1496007100, "question_id": 44231255, "link": "https://stackoverflow.com/questions/44231255/how-to-do-a-select-in-select-using-esqueleto", "title": "How to do a &quot;SELECT ... IN (SELECT ...)&quot; using Esqueleto?", "body": "<p>Considering the following two models and a <code>GET /articles/:slug/comments</code> request, I want to retrieve the comments that belong to an article, based on its <code>slug</code>.</p>\n\n<pre><code>Article json sql=articles\n    slug        Slug\n    title       Text\n    description Text\n    body        Text\n    createdAt   UTCTime default=now()\n    updatedAt   UTCTime Maybe default=NULL\n    userId      UserId\n    UniqueSlug  slug\n\nComment json sql=comments\n    body      Text\n    createdAt UTCTime default=now()\n    updatedAt UTCTime Maybe default=NULL\n    articleId ArticleId\n    userId    UserId\n</code></pre>\n\n<p>Using persistence's <code>rawSql</code>, we can accomplish this as follows</p>\n\n<pre><code>getCommentsForArticle :: Slug -&gt; App (Cmts [Entity Comment])\ngetCommentsForArticle slug = do\n    comments &lt;- runDb $ rawSql stm [toPersistValue slug]\n    return (Cmts comments)\n        where stm = \"SELECT ?? FROM comments \\\n                    \\WHERE article_id IN (\\\n                        \\SELECT id FROM articles WHERE slug = ?)\"\n</code></pre>\n\n<p>However, given that I want to maintain type safety between Haskell and SQL, I want to rewrite this using <code>esqueleto</code>. This is the part I am struggling with. By reading the docs, <a href=\"https://hackage.haskell.org/package/esqueleto-2.5.2/docs/Database-Esqueleto.html#v:sub_select\" rel=\"nofollow noreferrer\">sub_select</a> seems to be the tool for the job. Here's what I have:</p>\n\n<pre><code>getCommentsForArticle :: Slug -&gt; App (Cmts [Comment])\ngetCommentsForArticle slug = do\n    comments &lt;- E.select $\n        E.from $ \\cmts -&gt; do\n            let subQuery =\n                    E.from $ \\arts -&gt; do\n                        E.where_ $ arts ^. ArticleSlug ==. E.val slug\n                        return (arts ^. ArticleId)\n            E.where_ $ cmts ^. CommentArticleId ==. E.sub_select subQuery\n            return cmts\n    return $ Cmts comments\n</code></pre>\n\n<p>I also noticed the <a href=\"https://hackage.haskell.org/package/esqueleto-2.5.2/docs/Database-Esqueleto.html#v:in_\" rel=\"nofollow noreferrer\">in_ operator</a>, but I can't figure out how to use it nor if it is more appropriate than <a href=\"https://hackage.haskell.org/package/esqueleto-2.5.2/docs/Database-Esqueleto.html#v:sub_select\" rel=\"nofollow noreferrer\">sub_select</a>.</p>\n\n<p>What am I missing? Is the syntax correct? Thanks.</p>\n"}, {"tags": ["windows", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495994815, "post_id": 44230317, "comment_id": 75470768, "body": "Why does it say <code>calc.exe</code>?"}, {"owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495995050, "post_id": 44230317, "comment_id": 75470840, "body": "ignore it, it is an image from google, it just demonstrates the error."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1495996232, "post_id": 44230317, "comment_id": 75471151, "body": "Sounds like it couldn\u2019t start a DLL it needs. You can try uninstalling and running the full installer from haskell.org. Also do step 3 here: <a href=\"https://www.haskell.org/platform/windows.html#windows\" rel=\"nofollow noreferrer\">haskell.org/platform/windows.html#windows</a>"}, {"owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "edited": false, "score": 0, "creation_date": 1495997066, "post_id": 44230317, "comment_id": 75471426, "body": "I did that step, still i get the same error"}], "answers": [{"comments": [{"owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "edited": false, "score": 0, "creation_date": 1496923909, "post_id": 44434038, "comment_id": 75867929, "body": "good, but it is not a solution to the problem, i can use notepad++ with that way anyway, there is no need to use Context"}], "tags": [], "owner": {"reputation": 13, "user_id": 8131027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/418eb2f622e0cc0c28ed221a3e1b20bd?s=128&d=identicon&r=PG&f=1", "display_name": "Fernanda Alves", "link": "https://stackoverflow.com/users/8131027/fernanda-alves"}, "is_accepted": false, "score": 1, "last_activity_date": 1496920085, "creation_date": 1496920085, "answer_id": 44434038, "question_id": 44230317, "link": "https://stackoverflow.com/questions/44230317/haskel-ghci-exe-error-0xc0000142/44434038#44434038", "title": "Haskel ghci.exe error (0xc0000142)", "body": "<p>Run the program named \"WinGHCi\", not \"GHCi\".</p>\n"}], "owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496920085, "creation_date": 1495993983, "last_edit_date": 1495995983, "question_id": 44230317, "link": "https://stackoverflow.com/questions/44230317/haskel-ghci-exe-error-0xc0000142", "title": "Haskel ghci.exe error (0xc0000142)", "body": "<p>I tried all versions of haskell from their website and installed them on my windows 10 computer but when i run ghc.exe i get the following error shown in the image:</p>\n\n<p>I have tried several troubleshooting techniques but i cannot find the problem. Note that i have installed the files inside c:/ path</p>\n\n<p><a href=\"https://i.stack.imgur.com/2bahl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2bahl.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "io", "bellman-ford"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1495992325, "post_id": 44229739, "comment_id": 75470057, "body": "I take it \u201cBellmanford\u201d is the Bellman-Ford algorithm? Not a complete answer, because this sounds like homework, but: does the assignment specify the input format?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1495996713, "post_id": 44229739, "comment_id": 75471316, "body": "You would want to create an input file containing the data, let\u2019s call it <code>input.txt</code> in the same directory as the program, start a console, and run your program (if the executable is named <code>bellmanford</code>) as  <code>bellmanford &lt; input.txt</code>.  (On Linux, you have to start a program in the current directory as <code>.&#47;bellmanford</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "is_accepted": false, "score": 0, "last_activity_date": 1495998014, "creation_date": 1495998014, "answer_id": 44230954, "question_id": 44229739, "link": "https://stackoverflow.com/questions/44229739/cannot-figure-how-to-give-input-and-output-in-bellmanford-code-written-in-haskel/44230954#44230954", "title": "Cannot figure how to give input and output in Bellmanford code written in Haskell", "body": "<p>By the looks of it, you need a file with the representation of a graph. Although I haven't been able to test it myself, I would say that the input needs a header with the number of vertices of the graph and then a triple in each line that describes each edge: the origin vertex, the end vertex and the weight of that edge.</p>\n\n<p>For example, a data set that describes an 3 vertices graph would be something like:</p>\n\n<pre><code>3      // The graph has 3 vertices\n1 2 0  // The edge from vertex 1 to vertex 2 has a weight of 0\n2 1 5  // The edges are directed, so 2 to 1 has a weight of 5\n1 3 1\n2 3 0\n...\n</code></pre>\n\n<p>(Notice that the comments I just wrote cannot be parsed by the program, they are just to be more clear in the explanation)</p>\n\n<p>Also, take into account that (probably) you can't use <code>ghci</code> for this, since in the REPL the contents are consumed using <code>hGetContents</code> and that's probably going to mess with the input. The best way to do it is, as Davislor, by writing your graph input in a text file (let's say, graph.txt), compiling the program using <code>ghc -o bellman-ford &lt;your-file&gt;.hs</code> and then input the text file to the executable using <code>./bellman-ford &lt; graph.txt</code></p>\n\n<p>And again, as Davislor says, this looks like some kind of homework, so try to double-check if there is some kind of input file already required in the assignment or something like that.</p>\n"}], "owner": {"reputation": 53, "user_id": 6506317, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/06313e5061208f9204946353cecfe7f4?s=128&d=identicon&r=PG&f=1", "display_name": "walt3rwhite", "link": "https://stackoverflow.com/users/6506317/walt3rwhite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1495998014, "creation_date": 1495989896, "question_id": 44229739, "link": "https://stackoverflow.com/questions/44229739/cannot-figure-how-to-give-input-and-output-in-bellmanford-code-written-in-haskel", "title": "Cannot figure how to give input and output in Bellmanford code written in Haskell", "body": "<p>I am new to Haskell. I compiled the code and the main shell opens. I don't know how to input the edges of the graph and get the output. Any help would be appreciated.</p>\n\n<p>Given a graph and a source vertex src in graph, find shortest paths from src to all vertices in the given graph. The graph may contain negative weight edges.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nmodule Main where\n\nimport Control.DeepSeq\nimport Data.Functor\nimport Data.Int\nimport Data.Vector.Unboxed ((//))\nimport qualified Data.Vector.Unboxed as V\n\n--import Debug.Trace\n\ntype Vertex = Int\ntype Dist = Int32\ntype Edge = (Vertex, Vertex, Dist)\ntype EdgeVec = V.Vector Edge\ntype CostVec = V.Vector Dist\n\nreadEdge :: String -&gt; Edge\nreadEdge s = let [v1, v2, w] = words s\n              in (read v1, read v2, read w)\n\nbfStep :: EdgeVec -&gt; CostVec -&gt; CostVec\nbfStep edges !prev = V.unsafeAccumulate min prev $ V.map mincost edges\n    where\n    mincost :: Edge -&gt; (Int, Int32)\n    mincost (s, h, c) = (h, cost s c)\n    cost w c = let precost = prev `V.unsafeIndex` w\n                in if precost == maxBound then maxBound else precost + c\n\nmkEdgeVec :: Int -&gt; [String] -&gt; EdgeVec\nmkEdgeVec nvert inp = V.unfoldr step (nvert, inp)\n    where\n    step (n, s:xs) = Just (readEdge s, (n, xs))\n    step (0, []) = Nothing\n    step (!n, []) = Just ((0, n, 0), (n - 1, []))\n\nmain :: IO()\nmain = do\n    header:body &lt;- lines &lt;$&gt; getContents\n    let nvert = read $ head $ words header\n    let edgelist = mkEdgeVec nvert body\n\n    let bfbase = V.replicate (nvert + 1) maxBound // [(0, 0)]\n    print $ edgelist `deepseq` \"running\"\n    let bfout = iterate (bfStep edgelist) bfbase !! nvert\n\n    let bfcheck = bfStep edgelist bfout\n    let hasCycle = V.any id $ V.zipWith (/=) bfout bfcheck\n\n    putStrLn $ if hasCycle then \"Cycle\" else show $ V.minimum bfout\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 1, "creation_date": 1495978789, "post_id": 44227911, "comment_id": 75465845, "body": "Thanks! Do you have an online reference somewhere that says this? (So I have a better chance of finding answers to similar questions in future without asking here...)"}, {"owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 1, "creation_date": 1495978903, "post_id": 44227911, "comment_id": 75465881, "body": "@MichalCharemza You can check out <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">LYAH</a>, where it states that this is so for lists, and then discusses the differences between lists an tuples. That&#39;s my best reference for this (admittedly, not the greatest)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 5, "creation_date": 1495981729, "post_id": 44227911, "comment_id": 75466784, "body": "@MichalCharemza If you want a language-lawyer level reference, check the Haskell Report. It mandates that tuples work as if they where defined by <code>data (a,b) = (a,b) deriving (...,Ord)</code> and the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html#x18-18300011.1\" rel=\"nofollow noreferrer\">&quot;deriving&quot; mechanism</a> mandates lexicographic ordering."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 1, "creation_date": 1598725672, "post_id": 44227911, "comment_id": 112555215, "body": "add order can be changed with the <code>Down</code> from the <code>Data.Ord</code>"}], "tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": true, "score": 4, "last_activity_date": 1495978637, "creation_date": 1495978637, "answer_id": 44227911, "question_id": 44227822, "link": "https://stackoverflow.com/questions/44227822/definition-of-ord-for-tuples/44227911#44227911", "title": "Definition of Ord for tuples", "body": "<p>The order is <a href=\"https://en.wikipedia.org/wiki/Lexicographical_order\" rel=\"nofollow noreferrer\"><em>lexicographic</em></a>. It compares the elements from left to right, and the order is defined by the first elements which aren't equal:</p>\n\n<pre><code>Prelude&gt; (1, 2) &lt; (1, 3)\nTrue\nPrelude&gt; (1, 2) &lt; (1, 1)\nFalse\nPrelude&gt; (2, 2) &lt; (1, 1)\nFalse\n</code></pre>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 970, "favorite_count": 0, "accepted_answer_id": 44227911, "answer_count": 1, "score": 1, "last_activity_date": 1495978637, "creation_date": 1495978038, "question_id": 44227822, "link": "https://stackoverflow.com/questions/44227822/definition-of-ord-for-tuples", "title": "Definition of Ord for tuples", "body": "<p>I'm trying to find / work out what definitions of <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code> and <code>&gt;=</code> are for tuples. Looking at...</p>\n\n<pre><code>(-1, 3) &lt;= (1, 2)  -- True\n( 2, 3) &lt;= (1, 2)  -- False\n</code></pre>\n\n<p>... looks like <code>&lt;=</code> <em>could</em> just be defined using <code>&lt;=</code> on the first element of each tuple. However, in this example when first elements are equal...</p>\n\n<pre><code>( 1, 3) &lt;= (1, 2)  -- False\n</code></pre>\n\n<p>... means it can't just be <code>&lt;=</code> on the first element of each tuple, as it would have been <code>True</code>.</p>\n\n<p>What's going on? What is the definition of <code>&lt;=</code> and co on tuples?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1495960007, "post_id": 44225234, "comment_id": 75460527, "body": "<code>isValid (x,y) = x `elem` [&#39;a&#39;..&#39;h&#39;] &amp;&amp; y `elem` [&#39;1&#39;..&#39;8&#39;]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "edited": false, "score": 0, "creation_date": 1495963111, "post_id": 44225261, "comment_id": 75461303, "body": "I get an error <code>Couldn&#39;t match expected type </code>Int&#39; with actual type <code>Char&#39;</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "edited": false, "score": 0, "creation_date": 1496075490, "post_id": 44225261, "comment_id": 75502435, "body": "@Dave Well in your question you showed the <code>y</code> coordinates as letters <code>&#39;1&#39;</code> through <code>&#39;8&#39;</code>.  And the error you post (you could also have posted the line the error is from too) suggests you are trying to use numbers for <code>y</code> coordinates (<code>1</code>, <code>2</code> etc).  Try <code>&#39;1&#39;</code> if you&#39;re using this solution."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 0, "last_activity_date": 1495960074, "creation_date": 1495960074, "answer_id": 44225261, "question_id": 44225234, "link": "https://stackoverflow.com/questions/44225234/how-to-check-if-coordsx-y-are-valid-on-a-board-in-haskell/44225261#44225261", "title": "How to check if coords(x,y) are valid on a board in Haskell", "body": "<pre><code>isValid (x,y) = x `elem` ['a'..'h'] &amp;&amp; y `elem` ['1'..'8']\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1495963809, "last_edit_date": 1495963809, "creation_date": 1495960080, "answer_id": 44225262, "question_id": 44225234, "link": "https://stackoverflow.com/questions/44225234/how-to-check-if-coordsx-y-are-valid-on-a-board-in-haskell/44225262#44225262", "title": "How to check if coords(x,y) are valid on a board in Haskell", "body": "<p>The basic approach is to use direct comparisons:</p>\n\n<pre><code>isValid :: CoOrd -&gt; Bool\nisValid (x,y) = x &gt;= 'a' &amp;&amp; x &lt;= 'h' &amp;&amp; y &gt;= '1' &amp;&amp; y &lt;= '8'\n</code></pre>\n\n<p>A more advanced alternative is to exploit <code>Data.Ix.inRange</code>:</p>\n\n<pre><code>import Data.Ix\nisValid :: CoOrd -&gt; Bool\nisValid = inRange (('a','1'),('h','8'))\n</code></pre>\n\n<p>You can also use <code>elem</code>, as others pointed out, but <code>elem</code> will scan the whole list and perform pointwise comparisons (8+8 comparisons, in the worst case), while the methods above will only do four comparisons.</p>\n\n<p>Finally, a few comments on your original code:</p>\n\n<ul>\n<li>Don't use <code>return</code> in Haskell unless you are writing monadic code</li>\n<li>Don't use <code>if condition then True else False</code> -- that's noise, and it is equivalent to <code>conditions</code>. Consider using boolean operators instead, which is often simpler.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1495983041, "creation_date": 1495983041, "answer_id": 44228599, "question_id": 44225234, "link": "https://stackoverflow.com/questions/44225234/how-to-check-if-coordsx-y-are-valid-on-a-board-in-haskell/44228599#44228599", "title": "How to check if coords(x,y) are valid on a board in Haskell", "body": "<p>In addition to the other answers instead of using tuples you may define a new type, for example <code>ChessBoard</code>.</p>\n\n<p>Since you are in need of checking the validity of the entered position it might be wise to make it <code>Maybe ChessBoard</code> type as well.</p>\n\n<p>Accordingly you may come up with something like</p>\n\n<pre><code>module ChessBoard (ChessBoard, chessBoard) where\n\ndata ChessBoard = CB Char Int deriving (Eq, Ord, Show)\n\nchessBoard :: Char -&gt; Int -&gt; Maybe ChessBoard\nchessBoard c n | elem c ['a'..'h'] &amp;&amp; elem n [1..8] = Just (CB c n)\n               | otherwise                          = Nothing\n</code></pre>\n\n<p>Here as you may notice we are not exporting the data constructor <code>CB Char Int</code> so the only way to create your chess board position data is through the <code>chessBoard</code> function and there will be no illegal board positions.</p>\n\n<p>I mean;</p>\n\n<pre><code>*Main&gt; chessBoard 'a' 3\nJust (CB 'a' 3)\n*Main&gt; chessBoard 'h' 9\nNothing\n*Main&gt; let pos = Just (CB 'a' 11) -- trying to assign an illegal position directly\n\n&lt;interactive&gt;:259:17: error:\n    Data constructor not in scope: CB :: Char -&gt; Integer -&gt; a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1496042158, "post_id": 44228674, "comment_id": 75482949, "body": "While this would give a guarantee that the code in the program can&#39;t use an invalid coord, you would still need some validation for input? Also, I wonder if not allowing invalid points might make some things harder. For example, if it were chess, then handling positions a knight can move to would be more tricky?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1496074529, "post_id": 44228674, "comment_id": 75501950, "body": "I don&#39;t see how knight moves would become tricky - you can leverage the types to provide safe primitives (such as <code>safe{To,From}Enum</code>) and therefore force checking of for boundary conditions.  And yes, you certainly can&#39;t guarantee a user doesn&#39;t type something invalid so you still need input validation - the type obviates need for validation which was needed anyway."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1495994566, "last_edit_date": 1495994566, "creation_date": 1495983445, "answer_id": 44228674, "question_id": 44225234, "link": "https://stackoverflow.com/questions/44225234/how-to-check-if-coordsx-y-are-valid-on-a-board-in-haskell/44228674#44228674", "title": "How to check if coords(x,y) are valid on a board in Haskell", "body": "<p>Why not make some new types for your X and Y coordinates so the type checker gives you a static guarantee that any <code>CoOrd</code> value is correct?</p>\n\n<p>For example, I think you have <code>type CoOrd = (Char,Int)</code>.  Instead try:</p>\n\n<pre><code>data XCo = A | B | C | D | E | F | G | H deriving (Eq,Ord,Show,Enum)\ndata YCo = Y1 | Y2 | Y3 | Y4 | Y5 | Y6 | Y7 | Y8 deriving (Eq,Ord,Enum)\n\ninstance Show YCo where\n    show y = show (fromEnum y + 1)\n\ntype CoOrd = (XCo,YCo)\n</code></pre>\n\n<p>And now anywhere you were using character literals like <code>'a'</code>, <code>'b'</code> etc you use <code>A</code>, <code>B</code> etc.  Same with the numbers and the Y axis - <code>1</code> becomes <code>Y1</code> etc.</p>\n"}], "owner": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 44225262, "answer_count": 4, "score": 1, "last_activity_date": 1495994566, "creation_date": 1495959846, "question_id": 44225234, "link": "https://stackoverflow.com/questions/44225234/how-to-check-if-coordsx-y-are-valid-on-a-board-in-haskell", "title": "How to check if coords(x,y) are valid on a board in Haskell", "body": "<p>I have a function</p>\n\n<pre><code>isValid :: CoOrd -&gt; Bool\n</code></pre>\n\n<p>Where <code>CoOrd</code> is a tuple pair <code>(x,y)</code></p>\n\n<p>The boards size is <code>['a'..'h']</code> <code>['1'..'8']</code> so I want to check if the given <code>CoOrds</code> are valid for this board <code>(CoOrds x &lt; ['a'..'h'], CoOrds y ['1'..'8'])</code></p>\n\n<p>I'm fine with the logic of this question, its just the syntax as I'm new to haskell, so I'm looking for something like this</p>\n\n<pre><code>if (CoOrd(x _) == ['a'..'h'])\n    if (CoOrd(_ y) == ['1'..'8'])\n        return True\nelse return False\n</code></pre>\n"}, {"tags": ["debugging", "unix", "haskell", "pipe", "stdout"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1495992098, "post_id": 44223528, "comment_id": 75469995, "body": "i think it might be difficult to debug this without a minimal working repro of the bug with pasted code"}, {"owner": {"reputation": 1817, "user_id": 429898, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/IbMYQ.jpg?s=128&g=1", "display_name": "jefdaj", "link": "https://stackoverflow.com/users/429898/jefdaj"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1495992557, "post_id": 44223528, "comment_id": 75470107, "body": "Yeah you&#39;re right. I was hoping it&#39;s a known terminal issue, but guess not. I&#39;ll work on one."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1495993417, "post_id": 44223528, "comment_id": 75470343, "body": "Instead of intercepting stdout from your process, have you considered just writing to a different handle (e.g. a file?)  Glancing at the source code, <code>silently</code> will just redirect output to a temporary file if it cannot find a <code>null</code> handle to which to pipe the output; just do this yourself, and skip the whole &#39;redirecting stdout&#39; think."}, {"owner": {"reputation": 1817, "user_id": 429898, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/IbMYQ.jpg?s=128&g=1", "display_name": "jefdaj", "link": "https://stackoverflow.com/users/429898/jefdaj"}, "edited": false, "score": 0, "creation_date": 1496011178, "post_id": 44223528, "comment_id": 75475352, "body": "I was considering switching to the Writer monad instead, but putting it off because I still find monad transformers pretty difficult. Maybe redirecting to a file would be a good middle ground."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1496070654, "post_id": 44223528, "comment_id": 75500023, "body": "You don&#39;t need a writer monad; you can just pass then handle around as an argument. Sometimes plain and straight-forward functional programming is easier\u2026"}], "owner": {"reputation": 1817, "user_id": 429898, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/IbMYQ.jpg?s=128&g=1", "display_name": "jefdaj", "link": "https://stackoverflow.com/users/429898/jefdaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496023218, "creation_date": 1495942047, "last_edit_date": 1496023218, "question_id": 44223528, "link": "https://stackoverflow.com/questions/44223528/subtle-bug-in-haskell-tests-involving-tasty-stdout-capture-and-the-unix-termin", "title": "Subtle bug in Haskell tests involving Tasty, stdout capture, and the unix terminal", "body": "<p>I'm writing a language interpreter in Haskell, and for the most part it works (hooray!). But some of the tests fail in an odd way that depends on whether stdout is sent to the terminal or a pipe...</p>\n\n<p>I'm using <a href=\"https://hackage.haskell.org/package/tasty-golden\" rel=\"nofollow noreferrer\">tasty-golden</a> to test the REPL. There are text files with pasted REPL sessions like this:</p>\n\n<pre><code>Welcome to the ShortCut interpreter!\nType :help for a list of the available commands.\nshortcut &gt;&gt; v1 = \"one\"\nshortcut &gt;&gt; v2 = \"two\"\nshortcut &gt;&gt; v3 = [v1, v2]\nshortcut &gt;&gt; :show\nv1 = \"one\"\nv2 = \"two\"\nv3 = [v1, v2]\nshortcut &gt;&gt; :rdepends v1\nv3 = [v1, v2]\nshortcut &gt;&gt; :quit\nBye for now!\n</code></pre>\n\n<p>I have a function that reads those files and splits them into user input (anything after <code>shortcut &gt;&gt;</code>) and what the program should print to stdout. It passes the input lines to the REPL, captures stdout using the <a href=\"https://hackage.haskell.org/package/silently\" rel=\"nofollow noreferrer\">silently</a> package, intercalates them, and checks that the combined output is the same as that file.</p>\n\n<p>Everything works, but only if I pipe the overall program output through <code>less</code>! When printing directly to the terminal, certain lines slip through and are actually printed, then the tests fail because they aren't part of the captured output.</p>\n\n<p>I think it might be a bug in the interaction between Tasty and Silently, which both do fancy things with terminal output, but have no idea how to debug it or write a reproducible example.</p>\n\n<p>Here's the complete output run in three different ways:</p>\n\n<ul>\n<li><a href=\"http://lpaste.net/355894\" rel=\"nofollow noreferrer\">Copied directly from the terminal</a></li>\n<li><a href=\"http://lpaste.net/355892\" rel=\"nofollow noreferrer\">Piped through <code>less</code> and copied from the terminal</a></li>\n<li><a href=\"http://lpaste.net/355893\" rel=\"nofollow noreferrer\">Piped through <code>tee</code> and copied from the resulting file</a></li>\n</ul>\n\n<p>As you can see:</p>\n\n<ul>\n<li>Each <code>FAIL</code> is preceded by printing part of the REPL output to the terminal instead of capturing it</li>\n<li><code>less</code> somehow gets around that and the tests pass</li>\n<li><code>tee</code> misses the printed bits (they end up in terminal but not the file)</li>\n</ul>\n\n<p>Any ideas about what could be going on? I can post any parts of the code you think might be relevant, but didn't want to muddy the question with hundreds and hundreds of mostly-unrelated lines.</p>\n\n<p>Update: tried replacing Silently's <code>hCapture_</code> with this function from <a href=\"https://stackoverflow.com/a/9664017/429898\">another question</a>:</p>\n\n<pre><code>catchOutput :: IO () -&gt; IO String\ncatchOutput action = do\n  tmpd &lt;- getTemporaryDirectory\n  (tmpf, tmph) &lt;- openTempFile tmpd \"haskell_stdout\"\n  stdout_dup &lt;- hDuplicate stdout\n  hDuplicateTo tmph stdout\n  hClose tmph\n  action\n  hDuplicateTo stdout_dup stdout\n  str &lt;- readFile tmpf\n  removeFile tmpf\n  return str\n</code></pre>\n\n<p>Unfortunately it does the same thing.</p>\n\n<p>Update 2:</p>\n\n<p>Well, figured it out. Sorry for everyone who tried to puzzle through it, as I don't think I gave enough information! The bug was in my REPL monad, which was defined like this:</p>\n\n<pre><code>type ReplM a = StateT CutState (MaybeT (InputT IO)) a\n\nrunReplM :: ReplM a -&gt; CutState -&gt; IO (Maybe CutState)\nrunReplM r s = runInputT defaultSettings $ runMaybeT $ execStateT r s\n\nprompt :: String -&gt; ReplM (Maybe String)\nprompt = lift . lift . getInputLine\n\nprint :: String -&gt; ReplM ()\nprint = lift . lift . outputStrLn\n</code></pre>\n\n<p>I noticed that all the erroneous prints came from functions that use <code>print</code>, whereas a couple cases where I used <code>liftIO . putStrLn</code> instead worked as expected. So I just redefined <code>print</code> as that:</p>\n\n<pre><code>print :: String -&gt; ReplM ()\nprint = liftIO . putStrLn\n</code></pre>\n\n<p>I still don't really get <em>why</em> the other version didn't work though, so I'll give the answer to whoever can explain it. <code>outputStrLn</code> is defined in <a href=\"https://hackage.haskell.org/package/haskeline-0.6.3/src/System/Console/Haskeline.hs\" rel=\"nofollow noreferrer\">Haskeline.hs</a>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495919900, "post_id": 44221670, "comment_id": 75453778, "body": "I can&#39;t make sense of the question as asked. Can you please give us the question exactly as it appears in the worksheet? I can say that <code>g (g x)</code> applies <code>g</code> to the result of applying <code>g</code> to <code>x</code>. If you&#39;re more familiar with languages that use parenthesis for application, it would be <code>g(g(x))</code> in those languages."}, {"owner": {"reputation": 421, "user_id": 2938375, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5271f0057ed876c78f7d725a4aab1e59?s=128&d=identicon&r=PG&f=1", "display_name": "CowNorris", "link": "https://stackoverflow.com/users/2938375/cownorris"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495919989, "post_id": 44221670, "comment_id": 75453808, "body": "@ReinHenrichs The question is as follows: &quot;Explain why the function f defined below has no type:   f g x = g (g x) x&quot;  I&#39;m a little curious as to how were you able to work that out? Once we evaluate g (g x), applying g to result of g x, what are we going to do with the x that remains on the right in g (g x) x?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495920043, "post_id": 44221670, "comment_id": 75453824, "body": "Ah, I missed the final <code>x</code> and was confused because <code>f g x = g (g x)</code> clearly has a type."}, {"owner": {"reputation": 421, "user_id": 2938375, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5271f0057ed876c78f7d725a4aab1e59?s=128&d=identicon&r=PG&f=1", "display_name": "CowNorris", "link": "https://stackoverflow.com/users/2938375/cownorris"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495920307, "post_id": 44221670, "comment_id": 75453898, "body": "@ReinHenrichs Ah, I see. Just out of curiosity, is this definition for f in f g x = g (g x) correct? f :: (a -&gt; a) -&gt; a -&gt; a"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1495920467, "post_id": 44221670, "comment_id": 75453941, "body": "Yes! [character limit]"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1496010784, "post_id": 44221670, "comment_id": 75475263, "body": "Using the <code>RankNTypes</code> extension, you <i>can</i> give <code>f g x = g (g x) x</code> the useless rank-2 type of <code>(forall a. a -&gt; a) -&gt; (forall b. b -&gt; b) -&gt; c -&gt; c</code> and call it as <code>f id id 42</code>. It evaluates to <code>(id (id id) id) 42</code> = <code>(id id id) 42</code> = <code>id id 42</code> = <code>id 42</code> = <code>42</code>. :P"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 6, "last_activity_date": 1495920922, "last_edit_date": 1495920922, "creation_date": 1495920614, "answer_id": 44221783, "question_id": 44221670, "link": "https://stackoverflow.com/questions/44221670/clarification-on-a-haskell-function-type-argument/44221783#44221783", "title": "Clarification on a Haskell function type argument", "body": "<p>The relevant rules are:</p>\n\n<ol>\n<li><p>Application is written as juxtaposition, i.e., <code>f x</code> applies <code>f</code> to <code>x</code>.</p></li>\n<li><p>Parentheses are used to delimit expressions, not for function application, i.e., <code>f (g x)</code> applies <code>f</code> to <code>g x</code>. (Where <code>g x</code> is itself the application of <code>g</code> to <code>x</code>.)</p></li>\n<li><p>Application associates to the left, i.e., <code>f x y = (f x) y</code>.</p></li>\n</ol>\n\n<p>Putting these together, we can see that <code>g (g x) x = (g (g x)) x</code>, i.e., the application of <code>g (g x)</code> to <code>x</code>, where <code>g (g x)</code> is itself the application of <code>g</code> to <code>g x</code>.</p>\n\n<p>I should also mention that all functions in Haskell take exactly one argument. Where it appears that a function takes multiple arguments, there is really currying:</p>\n\n<pre><code>f x y z = ((f x) y) z\n</code></pre>\n\n<p>In other words, <code>f</code> is a function that takes an argument and returns a function that takes an argument and returns a function that takes an argument and returns a value. You can probably see why we sometimes prefer to lie a bit and say that a function takes multiple arguments, but it is not technically true. A function that \"takes multiple arguments\" is really a function that returns a function, which may return a function, and so on.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495921064, "post_id": 44221831, "comment_id": 75454077, "body": "It would be better not to give the answer to a homework question. The student is supposed to answer it, not us."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1495939259, "post_id": 44221831, "comment_id": 75457117, "body": "I think the question and answer are both reasonable within the guidelines of the homework policy at <a href=\"https://meta.stackoverflow.com/q/334822/625403\">meta.stackoverflow.com/q/334822/625403</a>. This is certainly not &quot;an answer which doesn&#39;t help the student learn&quot;. Sure, it&#39;s more thorough than might be ideal for OP, but Stack Overflow is about creating answers of lasting value for people who get here from Google, not just the person asking the question."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 7, "last_activity_date": 1495920999, "creation_date": 1495920999, "answer_id": 44221831, "question_id": 44221670, "link": "https://stackoverflow.com/questions/44221670/clarification-on-a-haskell-function-type-argument/44221831#44221831", "title": "Clarification on a Haskell function type argument", "body": "<p>To be able to answer questions like this, you need to think like the Haskell compiler. We have a function.</p>\n\n<pre><code>f g x = g (g x) x\n</code></pre>\n\n<p>In order for this to be well-typed, we need to find the types for <code>f</code>, <code>g</code>, and <code>x</code>. Now, <code>f</code> takes two arguments, so</p>\n\n<pre><code>f :: a -&gt; b -&gt; c\ng :: a\nx :: b\n</code></pre>\n\n<p>We also know that <code>g x</code> must make sense as an expression (we would say that <code>g x</code> is \"well formed\"), so <code>g</code> must be a function to which <code>x</code> can be applied. So it is also the case that</p>\n\n<pre><code>g :: b -&gt; t0\n</code></pre>\n\n<p>Where <code>t0</code> is a type variable, for now. We don't know the result of <code>g x</code>; we just know that it \"makes sense\". Now, the outer <code>g (g x) x</code> must also make sense. So <code>g</code> has to be a type which we can apply <code>g x</code> (which has type <code>t0</code>, as we said before) and <code>x</code> (which has type <code>b</code>) to be able to get a result of type <code>c</code> (the return type of the function). So</p>\n\n<pre><code>g :: t0 -&gt; b -&gt; c\n</code></pre>\n\n<p>Now, here's where the problem happens. We see that <code>g</code> has three declarations: <code>a</code>, <code>b -&gt; t0</code>, and <code>t0 -&gt; b -&gt; c</code>. In order for <code>g</code> to have all three of these types, they must <em>unify</em>. That is, they have to be able to become the same, by plugging in values for certain variables. The <code>a</code> poses no problems, seeing as it's a free variable and doesn't depend on anything else, so we can \"set\" it to whatever we want. So <code>b -&gt; t0</code> and <code>t0 -&gt; b -&gt; c</code> have to be the same. In Haskell, we write that as</p>\n\n<pre><code>(b -&gt; t0) ~ (t0 -&gt; b -&gt; c)\n</code></pre>\n\n<p>Parentheses (in types) are right-associative, so this is equivalent to</p>\n\n<pre><code>(b -&gt; t0) ~ (t0 -&gt; (b -&gt; c))\n</code></pre>\n\n<p>In order for two function types to be the same, their arguments must be the same, so</p>\n\n<pre><code>b ~ t0\nt0 ~ (b -&gt; c)\n</code></pre>\n\n<p>By the transitive property, this implies that</p>\n\n<pre><code>b ~ (b -&gt; c)\n</code></pre>\n\n<p>So <code>b</code> is a type which takes itself as an argument. This is what Haskell calls an infinite type and is inadmissible by the current standard. So in order for that function you've written to be acceptable, <code>b</code> must be a type which does not exist in Haskell. Therefore, <code>f</code> is not a valid Haskell function.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1495921365, "creation_date": 1495921365, "answer_id": 44221860, "question_id": 44221670, "link": "https://stackoverflow.com/questions/44221670/clarification-on-a-haskell-function-type-argument/44221860#44221860", "title": "Clarification on a Haskell function type argument", "body": "<ol>\n<li>Function application is left associative: <code>a b c</code> parses as <code>(a b) c</code></li>\n<li>Function definitions are syntactic sugar for lambda expressions: <code>f x y = ...</code> means <code>f = \\x y -&gt; ...</code></li>\n<li>Lambdas with multiple arguments are curried automatically: <code>\\x y -&gt; ...</code> means <code>\\x -&gt; (\\y -&gt; ...)</code></li>\n</ol>\n\n<p>Thus</p>\n\n<pre><code>f g x = g (g x) x\n</code></pre>\n\n<p>means</p>\n\n<pre><code>f = \\g -&gt; (\\x -&gt; (g (g x)) x)\n</code></pre>\n\n<p>Now let's try to derive the type of <code>f</code>. Let's give it a name:</p>\n\n<pre><code>f :: ta\n</code></pre>\n\n<p>But what exactly is <code>ta</code>? <code>f</code> is defined as a lambda, so its type involves <code>-&gt;</code> (it's a function):</p>\n\n<pre><code>\\g -&gt; (\\x -&gt; (g (g x)) x) :: tb -&gt; tc\ng :: tb\n\\x -&gt; (g (g x)) x :: tc\n</code></pre>\n\n<p>I.e. the type of <code>\\g -&gt; ...</code> is <code>tb -&gt; tc</code> for some types <code>tb</code> and <code>tc</code>, and the type of <code>g</code> (the argument) is <code>tb</code>, and the type of the result (the function body) is <code>tc</code>.</p>\n\n<p>And since the whole thing is bound to <code>f</code>, we have</p>\n\n<pre><code>ta = tb -&gt; tc\n</code></pre>\n\n<p>We're not done with <code>tc</code>, though:</p>\n\n<pre><code>\\x -&gt; (g (g x)) x :: td -&gt; te\nx :: td\n(g (g x)) x :: te\n</code></pre>\n\n<p>with</p>\n\n<pre><code>tc = td -&gt; te\n</code></pre>\n\n<p>The function body (whose type we've called <code>te</code>) consists of an application of (what must be) a function to the variable <code>x</code>. From this it follows that:</p>\n\n<pre><code>g (g x) :: td -&gt; te\n</code></pre>\n\n<p>because</p>\n\n<pre><code>x :: td\n(g (g x)) x :: te\n</code></pre>\n\n<p>Drilling down again, we have</p>\n\n<pre><code>g :: tf -&gt; (td -&gt; te)\ng x :: tf\n</code></pre>\n\n<p>because applying <code>g</code> to <code>g x</code> must have type <code>td -&gt; te</code>. Finally,</p>\n\n<pre><code>g :: td -&gt; tf\n</code></pre>\n\n<p>because</p>\n\n<pre><code>x :: td\ng x :: tf\n</code></pre>\n\n<p>Now we have two equations for <code>g</code>:</p>\n\n<pre><code>g :: tf -&gt; (td -&gt; te)\ng :: td -&gt; tf\n</code></pre>\n\n<p>Therefore</p>\n\n<pre><code>tf       = td\ntd -&gt; te = tf\n\ntf -&gt; te = tf\n</code></pre>\n\n<p>Here we run into a problem: <code>tf</code> is defined in terms of itself, giving something like</p>\n\n<pre><code>tf = (((((... -&gt; te) -&gt; te) -&gt; te) -&gt; te) -&gt; te) -&gt; te\n</code></pre>\n\n<p>i.e. an infinitely large type. This is not allowed, and that's why <code>f</code> has no valid type.</p>\n"}], "owner": {"reputation": 421, "user_id": 2938375, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5271f0057ed876c78f7d725a4aab1e59?s=128&d=identicon&r=PG&f=1", "display_name": "CowNorris", "link": "https://stackoverflow.com/users/2938375/cownorris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 44221783, "answer_count": 3, "score": 2, "last_activity_date": 1495921365, "creation_date": 1495919729, "last_edit_date": 1495920243, "question_id": 44221670, "link": "https://stackoverflow.com/questions/44221670/clarification-on-a-haskell-function-type-argument", "title": "Clarification on a Haskell function type argument", "body": "<p>On a recent worksheet I was asked to explain why the function <code>f</code>, in: <code>f g x = g (g x) x</code> has no type. </p>\n\n<p>I'm quite new to Haskell and I'm quite confused by how could one work out the association orders of the left and right expressions without knowing any details about the functions. It seems like that <code>g</code> should be defined as:</p>\n\n<p><code>g :: a -&gt; b</code>, supposing that the type of <code>x</code> was <code>a</code> - however that seems to lead to trouble immediately as on the RHS, <code>g (g x) x</code> seems to imply <code>g</code> takes 2 arguments, one of type <code>b</code> and one of type <code>a</code>. Moreover I'm also stuck as to how to read the LHS also, i.e. does <code>f</code> take in 2 arguments: a function <code>g</code> and a variable <code>x</code> or does it take in simply 1 argument, <code>(g x)</code>?</p>\n\n<p>I'm wondering if anyone could enlighten me as to how these expressions should be read?</p>\n"}, {"tags": ["haskell", "search", "pattern-matching"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1495917404, "post_id": 44221312, "comment_id": 75453183, "body": "What if <code>destination</code> is not one of the four cardinal directions?  E.g. if it is a composition of <code>move</code>s?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1495917455, "post_id": 44221312, "comment_id": 75453194, "body": "Why  represent the action by the result of the move, rather than the chosen direction, which would allow you to pattern match?"}, {"owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1496013816, "post_id": 44221312, "comment_id": 75475799, "body": "@Li-yaoXia that&#39;s exactly what I want to do, but what I currently pass to the function is the already partially-applied function, like <code>move East</code>. That is what I am trying to pattern match, but I don&#39;t know the syntax to &quot;unpack&quot; those values"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1496032382, "post_id": 44221312, "comment_id": 75478985, "body": "Change it to <code>type Action = Coord -&gt; Maybe (Coord, Double)</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1496058292, "post_id": 44221312, "comment_id": 75492391, "body": "You can&#39;t &quot;unpack&quot; a partially applied function. My point is that maybe you should take a step back and redesign your types to fit your application better."}], "answers": [{"comments": [{"owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "edited": false, "score": 0, "creation_date": 1495974727, "post_id": 44221491, "comment_id": 75464613, "body": "You are completely right about the code, it was not type checking because I made a mistake trying to create the minimal example; I edited the question to correct it. The thing is that an action would be <code>move South</code>, for example, and that is what is being passed to <code>mazeCost</code>; is there a way to &quot;unpack&quot; that argument so I can pattern-match or evaluate the <code>Direction</code> somehow?"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 0, "last_activity_date": 1495918937, "last_edit_date": 1495918937, "creation_date": 1495918256, "answer_id": 44221491, "question_id": 44221312, "link": "https://stackoverflow.com/questions/44221312/best-way-to-program-a-cost-function-associate-function-value/44221491#44221491", "title": "Best way to program a cost function (associate function - value)", "body": "<p><code>Cost</code> takes a <code>Coord</code> and an <code>Action</code>. However, since actions need a coord and a direction and there's no direction in scope, you can't actually use the action. You need to apply the action to a coordinate <em>and</em> a direction in order to get a value. So the only implementations of <code>mazeCost</code> are ones that ignore the action entirely, which is not what you want.</p>\n\n<p>However, if you had a direction in scope somehow then you could apply it (and the coord) to the action. One way to do this is through currying. A function <code>Direction -&gt; Cost</code>is a function that takes a direction and gives a cost function <em>for that direction</em>.</p>\n\n<pre><code>mazeCost :: Direction -&gt; Cost\nmazeCost dir coord act = case act coord dir of\n  Just (x', y') -&gt; 0 -- or whatever the cost is\n  Nothing -&gt; 0 -- or whatever the cost is\n</code></pre>\n\n<p>I think this is a nice illustration of the idea that partial application is similar to introducing a closure: <code>mazeCost East</code> is a function that closes over the <code>Direction</code> <code>East</code> and gives a <code>Cost</code> for that direction.</p>\n\n<p>I should also note that I don't see how your proposed solution can typecheck. If <code>type Action = Coord -&gt; Direction -&gt; Maybe Coord</code>, which you did not specify, then the expression <code>action coord</code> is a function of type <code>Direction -&gt; Maybe Coord</code>, and not a 'destination'. If I have misunderstood and it does typecheck then it is still a partial function that will cause a runtime error if the action is not equivalent to a simple <code>move</code> in one of the <code>Direction</code>s, as luqui implied.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495940570, "post_id": 44223100, "comment_id": 75457282, "body": "I don&#39;t see how that would work. <code>move</code> does not give a <code>Maybe Direction</code>."}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495996382, "post_id": 44223100, "comment_id": 75471199, "body": "We can tuple the coordinate returned with the initial direction, it was just a simple example, but I&#39;ll add it in."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": false, "score": 1, "last_activity_date": 1495996436, "last_edit_date": 1495996436, "creation_date": 1495936178, "answer_id": 44223100, "question_id": 44221312, "link": "https://stackoverflow.com/questions/44221312/best-way-to-program-a-cost-function-associate-function-value/44223100#44223100", "title": "Best way to program a cost function (associate function - value)", "body": "<p>You're almost there, you just need <code>ViewPatterns</code></p>\n\n<pre><code>{-# LANGUAGE ViewPatterns ... #-}\n...\nmove ((x,y), d) = ... Just (d,...) ...\n\nmoveCost = curry moveCost' where\n    moveCost' (move -&gt; Just (East, (x,y))) = ...\n    moveCost' (move -&gt; Just (West, (x,y))) = ...\n</code></pre>\n\n<p>Note that we changed the type of <code>move</code> here. View patterns only work with single argument functions that return a pattern we can actually match on, so it has to be passed <code>((x,y),d)</code> as a tuple, which means <code>moveCost'</code> must accept a tuple, but we can just curry it with a wrapper function.</p>\n"}], "owner": {"reputation": 265, "user_id": 7430178, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/phrjq.jpg?s=128&g=1", "display_name": "Diego Vicente", "link": "https://stackoverflow.com/users/7430178/diego-vicente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1495996436, "creation_date": 1495916786, "last_edit_date": 1495974501, "question_id": 44221312, "link": "https://stackoverflow.com/questions/44221312/best-way-to-program-a-cost-function-associate-function-value", "title": "Best way to program a cost function (associate function - value)", "body": "<p>I am trying to program a cost function in Haskell, but it seems I overestimated the capabilities of patter matching. This is the code I have already defined:</p>\n\n<pre><code>-- Directions for the movement\ndata Direction = North | East | West | South deriving (Show, Eq)\n\n-- An `Action` gets a Coord and returns another Coord if possible\ntype Action = Coord -&gt; Maybe Coord\n\n-- Move function; `move North` is an Action\nmove :: Direction -&gt; Action\nmove d (x, y) = ...\n</code></pre>\n\n<p>My main problem is that now I have to define a <code>Cost</code> function such that:</p>\n\n<pre><code>type Cost = Coord -&gt; Action -&gt; Double\n</code></pre>\n\n<p>In case I wanted to have a simple cost function that only checks the direction to return a cost, the first idea that came to my mind was taking advantage of pattern matching, but this is invalid syntax (and to be honest, it seems quite fair):</p>\n\n<pre><code>mazeCost :: Cost\nmazeCost (x, y) (move East) = 3\nmazeCost (x, y) (move West) = 5\n-- ... And on and on\n</code></pre>\n\n<p>My current solution involves computing the destination state and comparing that to the result of each action to check if that is the function that is being passed as an argument, but that seems hacky, not super brief and I think that maybe there is a much better way to do it in Haskell:</p>\n\n<pre><code>mazeCost :: Cost\nmazeCost coord action\n  | destination == east   = 1\n  | destination == west   = 2\n  | destination == north  = 3\n  | destination == south  = 0\n  where destination = action coord\n        east  = move East  coord\n        west  = move West  coord\n        south = move South coord\n        north = move North coord\n</code></pre>\n\n<p>Is there a better way to associate a function (<code>Coord -&gt; Direction -&gt; Maybe Coord</code>) with a cost value (<code>Double</code>)? This is a minimal example I tried to write, if there are any inconsistencies in the example code or something is not clear, please ask.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1495979755, "post_id": 44219541, "comment_id": 75466133, "body": "Thanks, @Erik. If <code>conduit-libraries</code> was not on stackage, then what would I need to do to my <code>stack.yaml</code>?"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1495981864, "post_id": 44219541, "comment_id": 75466824, "body": "Editing stack.yaml is required if you wanted to, for instance, depend on a local package, a package available on hackage but not stackage, a package that is located in a git repo, etc. For specific details on how to do this, refer to <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies</a>"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1495981997, "post_id": 44219541, "comment_id": 75466868, "body": "But you had it right in your original question. To get it off hackage, just list the package name in the extra-deps field and stack should download it for you."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 4, "last_activity_date": 1495905209, "last_edit_date": 1495905209, "creation_date": 1495904677, "answer_id": 44219541, "question_id": 44219358, "link": "https://stackoverflow.com/questions/44219358/adding-dependency-to-stack-project/44219541#44219541", "title": "Adding Dependency to stack Project?", "body": "<p>If you look at the <a href=\"https://www.stackage.org/lts-8.15/package/conduit-1.2.10\" rel=\"nofollow noreferrer\">haddocks for conduit</a>, notice the module you want to import is not Conduit, it is <strong>Data.Conduit</strong>.</p>\n\n<p>The <code>Conduit</code> module comes from the <code>conduit-combinators</code> package. If that is the package you would like to use instead, adjust your cabal file as follows and <code>import Conduit</code> as before:</p>\n\n<pre><code>executable my-project-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , my-project\n                     , conduit-combinators\n  default-language:    Haskell2010\n</code></pre>\n\n<p>The differences between the packages are summarized below (this is taken from <a href=\"https://github.com/snoyberg/conduit#libraries\" rel=\"nofollow noreferrer\">the project's readme</a>).</p>\n\n<ul>\n<li><code>conduit-combinators</code>: provides a large number of common functions built-in</li>\n<li><code>conduit</code>: defines the core datatypes and primitive functions</li>\n<li><code>conduit-extra</code>: adds support for many common low-level operations</li>\n</ul>\n\n<p>Side note: You don't need to make any changes to your <code>stack.yaml</code> file as both of these packages are available on stackage.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4004, "favorite_count": 1, "accepted_answer_id": 44219541, "answer_count": 1, "score": 5, "last_activity_date": 1495905209, "creation_date": 1495903687, "question_id": 44219358, "link": "https://stackoverflow.com/questions/44219358/adding-dependency-to-stack-project", "title": "Adding Dependency to stack Project?", "body": "<p>After running:</p>\n\n<pre><code>stack new my-project\ncd my-project\nstack setup\nstack build\n</code></pre>\n\n<p>I would like to add the <a href=\"https://www.stackage.org/haddock/lts-8.13/conduit-combinators-1.1.1/Conduit.html#v:decodeUtf8LenientC\" rel=\"noreferrer\">Conduit</a> library as a dependency.</p>\n\n<p>I edited the generated, via <code>stack new</code>, <code>stack.yaml</code> to have:</p>\n\n<pre><code>extra-deps: \n- conduit-1.2.10\n</code></pre>\n\n<p>Then, I modified the <code>my-project.cabal</code> from:</p>\n\n<pre><code>executable my-project-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , my-project\n  default-language:    Haskell2010\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>executable my-project-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , my-project\n                     , conduit\n  default-language:    Haskell2010\n</code></pre>\n\n<p>When I try to <code>stack build</code> the following:</p>\n\n<pre><code>$cat app/Main.hs\n\nmodule Main where\n\nimport Conduit\nimport Lib\n\nmain :: IO ()\nmain = someFunc\n</code></pre>\n\n<p>It fails:</p>\n\n<pre><code>$stack build\nmtl-2.2.1: using precompiled package\nprimitive-0.6.1.0: using precompiled package\nstm-2.4.4.1: using precompiled package\ntransformers-compat-0.5.1.4: using precompiled package\nexceptions-0.8.3: using precompiled package\nmmorph-1.0.9: using precompiled package\ntransformers-base-0.4.4: using precompiled package\nmonad-control-1.0.1.0: using precompiled package\nlifted-base-0.2.3.10: using precompiled package\nresourcet-1.1.9: using precompiled package\nconduit-1.2.10: configure\nconduit-1.2.10: build\nconduit-1.2.10: copy/register\nmy-project-0.1.0.0: configure (lib + exe)\nConfiguring my-project-0.1.0.0...\nmy-project-0.1.0.0: build (lib + exe)\nPreprocessing library my-project-0.1.0.0...\n[1 of 1] Compiling Lib              ( src/Lib.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/Lib.o )\nPreprocessing executable 'my-project-exe' for my-project-0.1.0.0...\n[1 of 1] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/my-project-exe/my-project-exe-tmp/Main.o )\n\n/Users/kevinmeredith/Workspace/conduit_sandbox/my-project/app/Main.hs:3:1: error:\n    Failed to load interface for \u2018Conduit\u2019\n    Use -v to see a list of the files searched for.\nCompleted 12 action(s).\n\n--  While building package my-project-0.1.0.0 using:\n      /Users/kevinmeredith/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 build lib:my-project exe:my-project-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>How can I properly add <code>conduit</code>?</p>\n\n<p>When adding a library to a <code>stack</code> project, do I need to edit both the <code>stack.yaml</code> and/or <code>my-project.cabal</code>?</p>\n"}, {"tags": ["multithreading", "haskell", "wxwidgets", "wxhaskell"], "answers": [{"tags": [], "owner": {"reputation": 18238, "user_id": 15275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WNTZ3.jpg?s=128&g=1", "display_name": "VZ.", "link": "https://stackoverflow.com/users/15275/vz"}, "is_accepted": false, "score": 0, "last_activity_date": 1495979657, "creation_date": 1495979657, "answer_id": 44228051, "question_id": 44218932, "link": "https://stackoverflow.com/questions/44218932/window-less-event-injection-into-wxwigets-event-loop-using-wxhaskell/44228051#44228051", "title": "Window-less event injection into wxWigets event loop using wxHaskell", "body": "<p>At C++ level you could just use <a href=\"http://docs.wxwidgets.org/3.1.0/classwx_event_loop_base.html\" rel=\"nofollow noreferrer\">wxEventLoop class</a> directly, but I don't know if it's properly wrapped by wxHaskell.</p>\n"}], "owner": {"reputation": 238, "user_id": 4095104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b0868543591a528f3c39136447fc94d?s=128&d=identicon&r=PG", "display_name": "L29Ah", "link": "https://stackoverflow.com/users/4095104/l29ah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496178874, "creation_date": 1495900923, "last_edit_date": 1496178874, "question_id": 44218932, "link": "https://stackoverflow.com/questions/44218932/window-less-event-injection-into-wxwigets-event-loop-using-wxhaskell", "title": "Window-less event injection into wxWigets event loop using wxHaskell", "body": "<p>Another take on Haskell-way multithreading and wxWidgets.</p>\n\n<p>I see <a href=\"https://stackoverflow.com/a/12596595/4095104\">https://stackoverflow.com/a/12596595/4095104</a> as a nice hack to run code in the wx event loop, but it requires me to create a window in <code>start</code>/<code>run</code> first and return from it so the event loop may run its course, while my application is essentially window-less and may create windows on demand from the internal (multithreaded) logic. Is there a good way to create a new event in the loop that is not bound to any pre-existing wxWidgets objects?</p>\n\n<p>Edit: the code example:</p>\n\n<pre><code>import Graphics.UI.WX as WX\nimport Graphics.UI.WXCore as WXCore\nimport Control.Concurrent\n\n-- | cf. http://snipplr.com/view/17538/\nmyEventId :: Int\nmyEventId = WXCore.wxID_HIGHEST+100\n    -- the custom event ID, avoid clash with Graphics.UI.WXCore.Types.varTopId\n\n-- | the custom event is registered as a menu event\ncreateMyEvent :: IO (WXCore.CommandEvent ())\ncreateMyEvent =\n   WXCore.commandEventCreate WXCore.wxEVT_COMMAND_MENU_SELECTED myEventId\n\nregisterMyEvent :: WXCore.EvtHandler a -&gt; IO () -&gt; IO ()\nregisterMyEvent win io =\n   WXCore.evtHandlerOnMenuCommand win myEventId io\n\n\ndoesntwork = do\n    handler &lt;- newEmptyMVar\n    start $ do\n        app &lt;- wxcAppGetApp\n        event &lt;- createMyEvent\n        mvar &lt;- newEmptyMVar\n        registerMyEvent app $ do\n            str &lt;- takeMVar mvar\n            putStrLn str\n        putMVar handler (app, event, mvar)\n    (app, event, mvar) &lt;- takeMVar handler\n    putMVar mvar \"hack\"\n    WXCore.evtHandlerAddPendingEvent app event\n    threadDelay 10000000000\n\nworks = do\n    handler &lt;- newEmptyMVar\n    start $ do\n        app &lt;- wxcAppGetApp\n        event &lt;- createMyEvent\n        mvar &lt;- newEmptyMVar\n        registerMyEvent app $ do\n            str &lt;- takeMVar mvar\n            putStrLn str\n        putMVar handler (app, event, mvar)\n        putMVar mvar \"hack\"\n        WXCore.evtHandlerAddPendingEvent app event\n    (app, event, mvar) &lt;- takeMVar handler\n    threadDelay 10000000000\n\nmain = doesntwork\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 3689034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af07f19d83f0798fac11915b049b2a40?s=128&d=identicon&r=PG&f=1", "display_name": "user3689034", "link": "https://stackoverflow.com/users/3689034/user3689034"}, "edited": false, "score": 0, "creation_date": 1495902850, "post_id": 44218954, "comment_id": 75449017, "body": "Nice way to define an instance with an existing instance."}], "tags": [], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "is_accepted": true, "score": 3, "last_activity_date": 1539261136, "last_edit_date": 1539261136, "creation_date": 1495901107, "answer_id": 44218954, "question_id": 44218776, "link": "https://stackoverflow.com/questions/44218776/haskell-class-and-function-overloading/44218954#44218954", "title": "Haskell: class and function overloading:", "body": "<p><code>Addition</code> has kind <code>* -&gt; *</code>, so the argument to <code>Addition</code> must be of kind <code>*</code>. <code>Maybe</code> has kind <code>* -&gt; *</code>. You need to pass an additional type argument to <code>Maybe</code> so that it has kind <code>*</code>. </p>\n\n<pre><code>instance Addition (Maybe a)\n</code></pre>\n\n<p>The problem with this is that <code>Maybe a</code> is not an instance of <code>Addition</code> for arbitrary <code>a</code>, only for <code>a</code> which are already instances of <code>Addition</code>. You can specify the requirement that <code>a</code> is an instance of <code>Addition</code>  like this:</p>\n\n<pre><code>instance Addition a =&gt; Addition (Maybe a)\n</code></pre>\n\n<p>Also your implementation should use <code>myadd</code> instead of <code>+</code>:</p>\n\n<pre><code>instance Addition a =&gt; Addition (Maybe a) where\n   myadd (Just a) (Just b) = Just (myadd a b)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 3689034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af07f19d83f0798fac11915b049b2a40?s=128&d=identicon&r=PG&f=1", "display_name": "user3689034", "link": "https://stackoverflow.com/users/3689034/user3689034"}, "edited": false, "score": 1, "creation_date": 1495902955, "post_id": 44219056, "comment_id": 75449051, "body": "Thanks. It works. I tried <code>instance (Int a) =&gt; Addition (Maybe a) where</code> before. But i guess <code>Int</code> won&#39;t work since it is not a data constructor or class. I personally think that <code>Num a</code> is redundant since operator <code>+</code> implies it is of Num class. But i digress."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 79, "user_id": 3689034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af07f19d83f0798fac11915b049b2a40?s=128&d=identicon&r=PG&f=1", "display_name": "user3689034", "link": "https://stackoverflow.com/users/3689034/user3689034"}, "edited": false, "score": 1, "creation_date": 1495952671, "post_id": 44219056, "comment_id": 75459018, "body": "@user3689034 If Haskell was made so that <code>Num a</code> was redundant because of that, you could no longer tell from the type signature what instances the type variables must have and that would fundamentally change the Haskell type system. You would lose out on really nice things like parametricity: For example, as it is, given a function of type <code>f :: [a] -&gt; [a]</code>, you know that it cannot &quot;inspect&quot; or make a modified version of any list item, it must only repeat, rearrange, drop, some combination of those three or be the constant function that always gives back the empty list. That is guaranteed."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 79, "user_id": 3689034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af07f19d83f0798fac11915b049b2a40?s=128&d=identicon&r=PG&f=1", "display_name": "user3689034", "link": "https://stackoverflow.com/users/3689034/user3689034"}, "edited": false, "score": 1, "creation_date": 1495956882, "post_id": 44219056, "comment_id": 75459849, "body": "@user3689034 @DavidYoung, or rather, <i>yes</i> <code>Num a</code> is redundant.  Redundancy is one of the main things types provide."}], "tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": false, "score": 2, "last_activity_date": 1495901690, "creation_date": 1495901690, "answer_id": 44219056, "question_id": 44218776, "link": "https://stackoverflow.com/questions/44218776/haskell-class-and-function-overloading/44219056#44219056", "title": "Haskell: class and function overloading:", "body": "<p>One way of doing so would be through</p>\n\n<pre><code>instance (Num a) =&gt; Addition (Maybe a) where\n    myadd (Just x) (Just y) = Just (x + y)       \n</code></pre>\n\n<p>Note the following:</p>\n\n<ul>\n<li><code>Maybe a</code> is an instance of <code>Addition</code>, not <code>Maybe</code>.</li>\n<li>The instance is constrained to types <code>a</code> where <code>Num a</code>.</li>\n</ul>\n"}], "owner": {"reputation": 79, "user_id": 3689034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af07f19d83f0798fac11915b049b2a40?s=128&d=identicon&r=PG&f=1", "display_name": "user3689034", "link": "https://stackoverflow.com/users/3689034/user3689034"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 1, "accepted_answer_id": 44218954, "answer_count": 2, "score": 3, "last_activity_date": 1539261136, "creation_date": 1495899899, "question_id": 44218776, "link": "https://stackoverflow.com/questions/44218776/haskell-class-and-function-overloading", "title": "Haskell: class and function overloading:", "body": "<p>I am quite new to Haskell. I am trying to overload a custom function 'myadd' for different containers. My understanding is that you have to do it through classes. This is what i tried:</p>\n\n<pre><code>class Addition a where\n  myadd :: a -&gt; a -&gt; a\n\ninstance Addition Int where\n  myadd a b = a + b\n\ninstance Addition Maybe where\n  myadd (Just a) (Just b) = Just (a + b)\n\nmain = do\n  let a = 3 :: Int\n  let b = 4\n  let c = myadd a b\n  print c\n\n  let d = (Just a)\n  let e = (Just b)\n  let f = myadd d e\n  print f\n</code></pre>\n\n<p>But i get the following errors:</p>\n\n<pre><code>test.hs:7:19: error:\n    ? Expecting one more argument to \u2018Maybe\u2019\n      Expected a type, but \u2018Maybe\u2019 has kind \u2018* -&gt; *\u2019\n    ? In the first argument of \u2018Addition\u2019, namely \u2018Maybe\u2019\n      In the instance declaration for \u2018Addition Maybe\u2019\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495891213, "post_id": 44217310, "comment_id": 75445378, "body": "I don&#39;t understand the problem. Also, what should be returned for an empty list?"}, {"owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495891260, "post_id": 44217310, "comment_id": 75445395, "body": "Well I need to define a function that will compute the decimal value given a binary string. An empty list should return 0 I guess, so it would be the base case."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1495891328, "post_id": 44217310, "comment_id": 75445417, "body": "A list can have two possible constructors, <code>[]</code> and <code>:</code>. You already said <code>foo [] = 0</code>. So what should happen with <code>foo (x : xs)</code>?"}, {"owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495891518, "post_id": 44217310, "comment_id": 75445468, "body": "Well I need to evaluate the decimal value for the binary digit <code>x</code>. But I need to keep track of the index of x because of the way we usually convert a binary number into a decimal number (powers of 2)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1495891741, "post_id": 44217310, "comment_id": 75445521, "body": "Assume you had to find the value of <code>&quot;1011&quot;</code>. You&#39;ve split it into a head and a tail, <code>&#39;1&#39;</code> and <code>&quot;011&quot;</code>. Also assume you can somehow compute the result for <code>&quot;011&quot;</code> as <code>6</code>. How does <code>6</code> relate to the final result of <code>13</code>?"}, {"owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495892816, "post_id": 44217310, "comment_id": 75445852, "body": "@martin yes. @melpomene well, <code>13 = 6 + convert &quot;011&quot;</code>"}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "edited": false, "score": 0, "creation_date": 1495892895, "post_id": 44217310, "comment_id": 75445882, "body": "@PierreP. I think what melpomene was getting at there is <code>13 = 6 * 2 + 1</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1495892963, "post_id": 44217310, "comment_id": 75445897, "body": "@PierreP. That&#39;s wrong. <code>convert &quot;011&quot;</code> is <code>6</code>, and <code>6 + 6</code> is not <code>13</code>."}, {"owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495893226, "post_id": 44217310, "comment_id": 75445978, "body": "@melpomene The head is the least significant digit. The head <code>1</code> evals to <code>1</code> and the tail <code>011</code> evals to <code>12</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495893285, "post_id": 44217310, "comment_id": 75446003, "body": "@PierreP. How do you get <code>12</code> from <code>6</code>?"}, {"owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1495894553, "post_id": 44217310, "comment_id": 75446371, "body": "@melpomene Times 2"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1495927729, "post_id": 44217484, "comment_id": 75455376, "body": "Unfortunately, <code>foldr</code> fails the &quot;first-order functions only&quot; requirement."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1495952720, "post_id": 44217484, "comment_id": 75459033, "body": "@DanielWagner good point. I forgot that was part of the question."}], "tags": [], "owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "is_accepted": false, "score": 0, "last_activity_date": 1495892042, "creation_date": 1495892042, "answer_id": 44217484, "question_id": 44217310, "link": "https://stackoverflow.com/questions/44217310/convert-binary-string-to-integer-value-using-first-order-functions/44217484#44217484", "title": "Convert binary string to integer value using first order functions", "body": "<p>Here's my initial thoughts about how to handle this situation. </p>\n\n<pre><code>import Data.Char (digitToInt)\n\nmyFunction :: String -&gt; Int\nmyFunction = foldr step 0\n    where step x y = (+) (digitToInt x) ( (*) y 2 )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "is_accepted": false, "score": 0, "last_activity_date": 1495892636, "creation_date": 1495892636, "answer_id": 44217583, "question_id": 44217310, "link": "https://stackoverflow.com/questions/44217310/convert-binary-string-to-integer-value-using-first-order-functions/44217583#44217583", "title": "Convert binary string to integer value using first order functions", "body": "<p>Assuming the input is a list of <code>1</code>s and <code>0</code>s.</p>\n\n<pre><code>bin2num :: [Int] -&gt; Int\nbin2num list = go list 0\n  where go []     _ = 0\n        go (x:xs) n = (x*(2^n)) + (go xs (n+1))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1495899529, "creation_date": 1495899529, "answer_id": 44218722, "question_id": 44217310, "link": "https://stackoverflow.com/questions/44217310/convert-binary-string-to-integer-value-using-first-order-functions/44218722#44218722", "title": "Convert binary string to integer value using first order functions", "body": "<p>Wrapping up my comments:</p>\n\n<pre><code>convert :: [Int] -&gt; Int\nconvert [] = 0\nconvert (x : xs) = x + 2 * convert xs\n</code></pre>\n\n<p>The base case is the empty list, returning <code>0</code>.</p>\n\n<p>The recursive case follows from the fact that <code>x</code> is the least significant digit. <code>convert xs</code> (the recursive call) gives us the result for the tail of the list; to get the result of the whole list we need to multiply by 2 (to \"shift over\" the digits) and add <code>x</code> (0 or 1).</p>\n"}], "owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1454, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1495899529, "creation_date": 1495890872, "last_edit_date": 1495891276, "question_id": 44217310, "link": "https://stackoverflow.com/questions/44217310/convert-binary-string-to-integer-value-using-first-order-functions", "title": "Convert binary string to integer value using first order functions", "body": "<p>Given a finite list of <code>0</code> and <code>1</code>, how can I convert them to their integer value using first order function?</p>\n\n<p>The head of the list is the <strong>least significant digit</strong>. For instance, <code>1011</code> evaluates to <code>13</code>. </p>\n\n<p>In this problem, I struggle to find both the recursive step and the base step because all depends wether it's a 0 and 1. </p>\n\n<p>EDIT : </p>\n\n<p>The goal is to define a function that will compute the decimal value given a binary string. An empty list should return 0 I guess, so it would be the base case. </p>\n"}, {"tags": ["c++", "c", "haskell", "linker", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 3246034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f84257ca534e0b127ffeda9042e607?s=128&d=identicon&r=PG", "display_name": "frony0", "link": "https://stackoverflow.com/users/3246034/frony0"}, "is_accepted": false, "score": 2, "last_activity_date": 1495899647, "creation_date": 1495899647, "answer_id": 44218737, "question_id": 44216495, "link": "https://stackoverflow.com/questions/44216495/ghc-not-linking-dependencies/44218737#44218737", "title": "GHC not linking dependencies", "body": "<p>I solved this by adding <code>-package text</code> to the link command. You can also solve it by putting the raw .hs files in the link command rather than building separately.</p>\n"}], "owner": {"reputation": 41, "user_id": 3246034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05f84257ca534e0b127ffeda9042e607?s=128&d=identicon&r=PG", "display_name": "frony0", "link": "https://stackoverflow.com/users/3246034/frony0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1495899647, "creation_date": 1495885827, "question_id": 44216495, "link": "https://stackoverflow.com/questions/44216495/ghc-not-linking-dependencies", "title": "GHC not linking dependencies", "body": "<p>I'm trying to make use of the Haskell Foreign Function Interface, and I'm having some troubles; namely that as soon as I try and use an external dependency (in this case Data.Text from the <code>text</code> package) GHC fails to link my binary with undefined references to the package. Am I doing something wrong or is there some flag I need to add to make GHC link dependencies?</p>\n\n<p>When I try and manually add <code>~/.cabal/lib/x86_64-linux-ghc-8.0.1/text-1.2.2.1-9Yh8rJoh8fO2JMLWffT3Qs/libHStext-1.2.2.1-9Yh8rJoh8fO2JMLWffT3Qs.a</code> to the <code>OBJECTS</code> list, the build fails still with missing references to <code>bytestring</code>, a dependency of <code>text</code>.</p>\n\n<p><strong>Makefile:</strong></p>\n\n<pre><code>CXX=clang++\nCXXFLAGS=-pthread -std=c++1y -g -Wall -Wextra -Wpedantic -Werror #-O2\nINCLUDES=-I /usr/lib/ghc/include/\nGDB=gdb\nLDFLAGS=-lstdc++ -lpthread\nLIBRARIES=-lstdc++\nGHC=ghc\nGHCOPTS=-XForeignFunctionInterface -optl-pthread\nOBJECTS= \\\n main.o \\\n logger.o \\\n socket.o \\\n queue.o \\\n thread.o \\\n irc/connection.o \\\n irc/message.o \\\n hydra/message.o \\\n hydra/session.o \\\n hydra/server.o \\\n hydra/client.o \\\n hydra/node.o \\\n plugin/manager.o \\\n plugin/plugin.o \\\n plugin/haskell.o \\\n plugin/haskell/Plugin.o \\\n plugin/haskell/Message.o\nEXECUTABLE=hebi\n\nall: $(EXECUTABLE)\n\n$(EXECUTABLE): $(OBJECTS)\n        $(GHC) -o $@ -no-hs-main -optc-O $(OBJECTS) $(LDFLAGS) $(LIBRARIES)\n\nmain.o: main.cpp logger.hpp irc/connection.hpp hydra/session.hpp thread.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nlogger.hpp: logger.ipp\nlogger.o: logger.cpp logger.hpp config.hpp thread.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nsocket.hpp: socket.ipp\nsocket.o: socket.cpp socket.hpp config.hpp logger.hpp queue.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nqueue.hpp: queue.ipp\nqueue.o: queue.cpp queue.hpp logger.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nthread.hpp: thread.ipp\nthread.o: thread.cpp thread.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nirc/connection.o: irc/connection.cpp irc/connection.hpp config.hpp logger.hpp socket.hpp queue.hpp thread.hpp irc/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nirc/message.o: irc/message.cpp irc/message.hpp config.hpp logger.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nhydra/message.o: hydra/message.cpp hydra/message.hpp config.hpp logger.hpp queue.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nhydra/session.o: hydra/session.cpp hydra/session.hpp config.hpp logger.hpp socket.hpp thread.hpp hydra/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nhydra/server.o: hydra/server.cpp hydra/server.hpp config.hpp logger.hpp socket.hpp thread.hpp hydra/node.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nhydra/client.o: hydra/client.cpp hydra/client.hpp config.hpp logger.hpp socket.hpp thread.hpp hydra/node.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nhydra/node.o: hydra/node.cpp hydra/node.hpp socket.hpp queue.hpp hydra/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nplugin/manager.o: plugin/manager.cpp plugin/manager.hpp plugin/plugin.cpp irc/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nplugin/plugin.o: plugin/plugin.cpp plugin/plugin.hpp irc/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nplugin/haskell.o: plugin/haskell.cpp plugin/haskell.hpp plugin/plugin.cpp plugin/haskell/Plugin_stub.h irc/message.hpp\n        $(CXX) $(INCLUDES) -c $&lt; -o $@ $(CXXFLAGS)\n\nplugin/haskell/Plugin_stub.h: plugin/haskell/Plugin.o\nplugin/haskell/Plugin.o: plugin/haskell/Plugin.hs plugin/haskell/Message.o\n        cd plugin/haskell/; $(GHC) -c $(GHCOPTS) -O $(shell basename $&lt;)\n\nplugin/haskell/Message.o: plugin/haskell/Message.hs\n        cd plugin/haskell/; $(GHC) -optl-static -O $(shell basename $&lt;)\n\nclean:\n        $(RM) $(EXECUTABLE) *.o */*.o */*/*.o\n</code></pre>\n\n<p><strong>Make output:</strong></p>\n\n<pre><code>cd plugin/haskell/; ghc -optl-static -O Message.hs\n[1 of 1] Compiling Message          ( Message.hs, Message.o )\ncd plugin/haskell/; ghc -c -XForeignFunctionInterface -optl-pthread -O Plugin.hs\ncompilation IS NOT required\nghc -o hebi -no-hs-main -optc-O main.o logger.o socket.o queue.o thread.o irc/connection.o irc/message.o hydra/message.o hydra/session.o hydra/server.o hydra/client.o hydra/node.o plugin/manager.o plugin/plugin.o plugin/haskell.o plugin/haskell/Plugin.o plugin/haskell/Message.o -lstdc++ -lpthread -lstdc++\nplugin/haskell/Message.o: In function `r8Ds_info':\n(.text+0x2c43): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `c9TW_info':\n(.text+0x2d6b): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `c9Ud_info':\n(.text+0x2da0): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `c9Sy_info':\n(.text+0x2f5c): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `c9Tv_info':\n(.text+0x3020): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `c9Tv_info':\n(.text+0x3040): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `c9UI_info':\n(.text+0x31b3): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `ca18_info':\n(.text+0x32db): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `ca1p_info':\n(.text+0x3310): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `c9ZK_info':\n(.text+0x34cc): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `ca0H_info':\n(.text+0x3590): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `ca0H_info':\n(.text+0x35b0): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `ca1U_info':\n(.text+0x3723): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `ca8i_info':\n(.text+0x384b): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `ca8z_info':\n(.text+0x3880): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `ca6U_info':\n(.text+0x3a3c): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `ca7R_info':\n(.text+0x3b00): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `ca7R_info':\n(.text+0x3b20): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `ca94_info':\n(.text+0x3c93): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `cafs_info':\n(.text+0x3dbb): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `cafJ_info':\n(.text+0x3df0): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `cae4_info':\n(.text+0x3fac): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `caf1_info':\n(.text+0x4070): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `caf1_info':\n(.text+0x4090): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `s8Qy_info':\n(.text+0x41e5): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `s8Rk_info':\n(.text+0x43ed): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cakr_info':\n(.text+0x44e8): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cakK_info':\n(.text+0x45d0): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cavd_info':\n(.text+0x547b): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `cazH_info':\n(.text+0x55a3): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `cazY_info':\n(.text+0x55d8): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `cayj_info':\n(.text+0x5794): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cazg_info':\n(.text+0x5858): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `cazg_info':\n(.text+0x5878): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `caEh_info':\n(.text+0x5d43): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `caJD_info':\n(.text+0x5e6b): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `caJU_info':\n(.text+0x5ea0): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `caIf_info':\n(.text+0x605c): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `caJc_info':\n(.text+0x6120): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `caJc_info':\n(.text+0x6140): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `caOP_info':\n(.text+0x6530): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `s8VY_info':\n(.text+0x65d5): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cbyh_info':\n(.text+0xa241): undefined reference to `_hs_text_memcmp'\nplugin/haskell/Message.o: In function `cbAx_info':\n(.text+0xa31a): undefined reference to `_hs_text_memcmp'\nplugin/haskell/Message.o: In function `cbEJ_info':\n(.text+0xa7d1): undefined reference to `_hs_text_memcmp'\nplugin/haskell/Message.o: In function `cc8u_info':\n(.text+0xc12b): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `ccd2_info':\n(.text+0xc253): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `ccdj_info':\n(.text+0xc288): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_Text_con_info'\nplugin/haskell/Message.o: In function `ccbE_info':\n(.text+0xc444): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cccB_info':\n(.text+0xc508): undefined reference to `_hs_text_memcpy'\nplugin/haskell/Message.o: In function `cccB_info':\n(.text+0xc528): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `ccg9_info':\n(.text+0xc6c4): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_MArray_con_info'\nplugin/haskell/Message.o: In function `cbyh_info':\n(.text+0xa25c): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziText_zdfEqTextzuzdczeze_info'\nplugin/haskell/Message.o: In function `cbA2_info':\n(.text+0xa451): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziText_zdfEqTextzuzdczeze_info'\nplugin/haskell/Message.o: In function `cbCB_info':\n(.text+0xa539): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziText_pack_info'\nplugin/haskell/Message.o: In function `cbFN_info':\n(.text+0xa6b5): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziText_zdfEqTextzuzdczeze_info'\nplugin/haskell/Message.o: In function `ccgf_info':\n(.text+0xc792): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziShow_singletonzu_info'\nplugin/haskell/Message.o: In function `ccgf_info':\n(.text+0xc7f2): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziShow_singletonzu_info'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x218): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x220): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x518): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziText_pack_closure'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x588): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziInternal_empty_closure'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x590): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziArray_arrayzusizzezuerror_closure'\nplugin/haskell/Message.o: In function `S9qx_srt':\n(.data.rel.ro+0x5a8): undefined reference to `textzm1zi2zi2zi1zm9Yh8rJoh8fO2JMLWffT3Qs_DataziTextziShow_singletonzu_closure'\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\nMakefile:32: recipe for target 'hebi' failed\nmake: *** [hebi] Error 1\n</code></pre>\n\n<p><a href=\"http://github.com/bqv/hebi/\" rel=\"nofollow noreferrer\">Link to Github</a></p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495934387, "post_id": 44216339, "comment_id": 75456393, "body": "Note that <code>Show</code> is intended to be used as the counterpart to <code>Read</code>, that is, to render a Haskell expression as a String that can then be read back into a Haskell expression. Some people think that it&#39;s a bad idea to use <code>show</code> for arbitrary conversions to String."}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 0, "last_activity_date": 1495994086, "last_edit_date": 1495994086, "creation_date": 1495993693, "answer_id": 44230279, "question_id": 44216339, "link": "https://stackoverflow.com/questions/44216339/show-instance-for-matrix-in-haskell/44230279#44230279", "title": "Show instance for matrix in Haskell", "body": "<p>If you make the assumptions that all rows of a matrix have the same number of columns (or at least that the first row of any matrix has at least as many columns as any other), and that three dashes suffice as the border for any cell, you can calculate the number of dashes to use between rows by taking the <code>length</code> of the leading row.</p>\n\n<p>If these assumptions do not hold, you need to make one pass over the array to calculate the maximum width of any row, then a second pass to draw the matrix.  If matrices can contain numbers outside the range <code>[0..9]</code>, you would also need to calculate the width of each column.</p>\n\n<p>The algorithm might be:</p>\n\n<ol>\n<li>Map each number in the matrix to a <code>String</code>, generating a <code>[[String]]</code>.</li>\n<li>Generate a list of column widths, whose elements are the maximum width of any row\u2019s element in that column.</li>\n<li>Left-pad every string in the <code>[[String]]</code> with spaces to its column width.</li>\n<li>Concatenate the columns of each row, adding the appropriate separator between elements and the appropriate left and right borders.  The result is a <code>[String]</code> whose elements are the graphical representation of each row.</li>\n<li>If you wish to add horizontal rules above, below, or between the rows, take the length of any element of the <code>[String]</code> (As all columns are now padded to their maximum width, all rows should now have the same length.) and generate that number of box-drawing characters, such as ASCII <code>\"---\"</code> or Unicode <code>\"\u250c\u2500\u252c\u2500\u2510\"</code>.</li>\n<li>Concatenate the rows and the separator lines into a <code>String</code> separated by newlines.</li>\n</ol>\n\n<p>As Rein Henrichs mentioned in a comment, you might consider naming this function something other than <code>show</code>.</p>\n"}], "owner": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 44230279, "answer_count": 1, "score": 0, "last_activity_date": 1495994086, "creation_date": 1495884746, "last_edit_date": 1495891306, "question_id": 44216339, "link": "https://stackoverflow.com/questions/44216339/show-instance-for-matrix-in-haskell", "title": "Show instance for matrix in Haskell", "body": "<p>I've been trying to create a show instance in order to visualize a given matrix and also, to create an outline with columns around and in between the matrix. What I managed to accomplish so far is the following:</p>\n\n<pre><code>data Mat a = Mat [[a]]\ninstance (Show a) =&gt; Show (Mat a) where\nshow (Mat x) = \"\\n\" ++ \" ---\\n\"++unlines ( map (\\r -&gt; showRow r ++ \"\\n ---\") x ) ++ \"\\n\"\n    where\n      showRow list = \"\u00a6 \"++unwords ( map (\\v -&gt; show v ++\" \u00a6\") list)\n</code></pre>\n\n<p>Assuming we have a matrix <code>Mat [[1,2,3],[4,5,6]]</code> that we would like to test.</p>\n\n<p>The output from the command line is the following:</p>\n\n<pre><code> ---\n\u00a6 1 \u00a6 2 \u00a6 3 \u00a6\n ---\n\u00a6 4 \u00a6 5 \u00a6 6 \u00a6\n ---\n</code></pre>\n\n<p>What I would like to achieve is to format the given matrix with horizontal lines above the rest of each column, like that:</p>\n\n<pre><code> --- --- ---\n\u00a6 1 \u00a6 2 \u00a6 3 \u00a6\n --- --- ---\n\u00a6 4 \u00a6 5 \u00a6 6 \u00a6\n --- --- ---\n</code></pre>\n"}, {"tags": ["haskell", "find"], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1495959764, "post_id": 44215175, "comment_id": 75460472, "body": "Thank you for your clear explanation, but I still have my original question: In &quot;normal&quot; recursive function, I iterarate as long as a condition is not satisfied (result = Nothing), or if the condition is satisfied, (result = Just x) we stop. Here I need three conditions: Nothing, Just x, continue iterating."}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1495960212, "post_id": 44215175, "comment_id": 75460566, "body": "Thank you for your clear explanation, but I still have my original question: It is the Maybe statement that confuses me.  In &quot;normal&quot; recursive function, I iterate as long as a condition is not satisfied (result = Nothing), or if the condition is satisfied, (result = Just x) we stop.  Here I need three conditions: Nothing, Just x and  continue iterating.  How can I overcome this difficulty?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1496057243, "post_id": 44215175, "comment_id": 75491730, "body": "@Atir If the list is empty, you know there&#39;s no value satisfying <code>p</code>, so you can return <code>Nothing</code>. Otherwise, you can check <code>p x</code>: it that holds, you can return <code>Just x</code>, otherwise, you recurse with the rest of the list."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1495877111, "creation_date": 1495877111, "answer_id": 44215175, "question_id": 44214805, "link": "https://stackoverflow.com/questions/44214805/haskell-recursive-find-function-and-data-foldable-find-explanation/44215175#44215175", "title": "Haskell recursive find function and Data.Foldable find explanation", "body": "<p>If you are learning Haskell, I'd recommend you forget about <code>Foldable</code> and <code>First</code> for now, since these involve more advanced topics than needed to implement your <code>first'</code>.</p>\n\n<p>As a hint, try to work out a simple recursive definition like the following:</p>\n\n<pre><code>-- Finds the first element of a list that satisfies a given condition.\nfirst' :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\nfirst' p [] = ...\nfirst' p (x:xs) = ...\n   where\n   -- the first in the tail xs\n   rec = first' p xs\n</code></pre>\n\n<p>Think about it:</p>\n\n<ul>\n<li>what should be the first satisfying <code>p</code> in the empty list?</li>\n<li>assuming <code>rec</code> is the first satisfying <code>p</code> in the tail list <code>xs</code>, how would you express the first satisfying <code>p</code> in the full list <code>x:xs</code>? You can use an if-then-else for that.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": false, "score": 2, "last_activity_date": 1495889887, "last_edit_date": 1495889887, "creation_date": 1495889313, "answer_id": 44217042, "question_id": 44214805, "link": "https://stackoverflow.com/questions/44214805/haskell-recursive-find-function-and-data-foldable-find-explanation/44217042#44217042", "title": "Haskell recursive find function and Data.Foldable find explanation", "body": "<blockquote>\n  <p>But I do not understand this section: getFirst . foldMap (\\ x -> First (</p>\n</blockquote>\n\n<p>First, let's look a bit at <code>First</code>, e.g., in <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">LYAH</a>. It is a <em>monoid</em>, defined like this:</p>\n\n<pre><code>newtype First a = First { getFirst :: Maybe a }  \n    deriving (Eq, Ord, Read, Show)  \n</code></pre>\n\n<p>and</p>\n\n<pre><code>instance Monoid (First a) where  \n    mempty = First Nothing  \n    First (Just x) `mappend` _ = First (Just x)  \n    First Nothing `mappend` x = x  \n</code></pre>\n\n<p>Intuitively, this means the following:</p>\n\n<ul>\n<li><p>The \"empty\" element is a <code>First</code> of <code>Nothing</code></p></li>\n<li><p>\"appending\" two elements is a <code>First</code> of the first <code>Just</code> of them if there is one, else <code>First Nothing</code>.</p></li>\n</ul>\n\n<p>So, as its name implies, it is a monoid which \"records\" the first <code>Just</code> it encountered.</p>\n\n<hr>\n\n<p>If you look at <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\"><code>foldMap</code></a>, it, unsurprisingly, performs a combination of folding a mapped version of everything in the foldable. Intuitively, then, if the foldable contained some <code>Just</code>, then the result of <code>foldMap</code> is the <code>First</code> such <code>Just</code>; otherwise, it is <code>First Nothing</code>.</p>\n\n<hr>\n\n<p>Now, you want to extract the value from this <code>First</code> into a <code>Maybe</code>. This is what <code>getFirst</code> does. </p>\n\n<p>The overall line composes <code>getFirst</code> with <code>foldMap</code>.</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1495889887, "creation_date": 1495874775, "last_edit_date": 1495876776, "question_id": 44214805, "link": "https://stackoverflow.com/questions/44214805/haskell-recursive-find-function-and-data-foldable-find-explanation", "title": "Haskell recursive find function and Data.Foldable find explanation", "body": "<p>given (No homework):</p>\n\n<pre><code>first' :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\n-- Finds the first element of a list that satisfies a given condition.\n</code></pre>\n\n<ol>\n<li><p>I got lost after this statement: \n<code>if p x then Just x else Nothing)</code>\nHow do I continue to make it recursive?</p></li>\n<li><p>I found this:</p>\n\n<pre><code>-- | The 'find' function takes a predicate and a structure and returns\n-- the leftmost element of the structure matching the predicate, or\n-- 'Nothing' if there is no such element.\nfind :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a\nfind p = getFirst . foldMap (\\ x -&gt; First (if p x then Just x else Nothing))\n</code></pre></li>\n</ol>\n\n<p>But I do not understand this section: <code>getFirst . foldMap (\\ x -&gt; First (</code></p>\n\n<p>Can someone explain this statement?</p>\n"}, {"tags": ["html", "parsing", "haskell", "xpath", "xml-parsing"], "answers": [{"comments": [{"owner": {"reputation": 1572, "user_id": 1354445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2ddd831999b590a537efc3d42f981e02?s=128&d=identicon&r=PG", "display_name": "tna0y", "link": "https://stackoverflow.com/users/1354445/tna0y"}, "edited": false, "score": 0, "creation_date": 1496242982, "post_id": 44286388, "comment_id": 75583312, "body": "Thank you! Didn&#39;t think you can work with axis like with lists!"}], "tags": [], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "is_accepted": true, "score": 2, "last_activity_date": 1496238756, "last_edit_date": 1496238756, "creation_date": 1496238003, "answer_id": 44286388, "question_id": 44212378, "link": "https://stackoverflow.com/questions/44212378/using-text-xml-cursor-to-get-specific-html-table-column/44286388#44286388", "title": "Using Text.XML.Cursor to get specific HTML table column", "body": "<p>I've figured it out!</p>\n\n<p>Consider the following input file:</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Haskell XML Parsing Example&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;table class=\"forumTable\"&gt;\n      &lt;tbody&gt;\n        &lt;tr&gt;\n          &lt;td&gt; &lt;a href=\"#1\"&gt;1&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#2\"&gt;2&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#3\"&gt;3&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#4\"&gt;4&lt;/a&gt; &lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n          &lt;td&gt; &lt;a href=\"#5\"&gt;5&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#6\"&gt;6&lt;/a&gt; &lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n          &lt;td&gt; &lt;a href=\"#7\"&gt;7&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#8\"&gt;8&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#9\"&gt;9&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#10\"&gt;10&lt;/a&gt; &lt;/td&gt;\n          &lt;td&gt; &lt;a href=\"#11\"&gt;11&lt;/a&gt; &lt;/td&gt;\n        &lt;/tr&gt;\n      &lt;/tbody&gt;\n    &lt;/table&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And the Haskell code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.Text.IO as T\nimport Text.XML.Cursor\nimport Text.XML\n\nselect3rd :: Name -&gt; Axis\nselect3rd name =\n    helper . (child &gt;=&gt; element name)\n  where\n      helper (_:_:x:_) = [x]\n      helper _         = []\n\nfindNodes :: Cursor -&gt; [Cursor]\nfindNodes =\n    element \"table\" &gt;=&gt; attributeIs \"class\" \"forumTable\"\n        &amp;// element \"tr\" &gt;=&gt; select3rd \"td\"\n        &amp;/ element \"a\"\n\nmain :: IO ()\nmain = do\n    doc &lt;- Text.XML.readFile def \"res/test.html\"\n    let cursor = fromDocument doc\n    mapM_ T.putStrLn (cursor $.// findNodes &amp;/ content)\n</code></pre>\n\n<p>It takes some time until you understand how all these operators (<code>$.//</code>, <code>&amp;/</code>, etc) work, but after reading the <a href=\"https://hackage.haskell.org/package/xml-conduit-1.5.1/docs/Text-XML-Cursor.html\" rel=\"nofollow noreferrer\">documentation</a> a couple of times and playing around with them, things get better. Also, I suggest a careful reading at the part that explains what a <code>Cursor</code> and an <code>Axis</code> are.</p>\n\n<p>The code above works as follows (didactically). Firstly, we get in <code>main</code> a <code>cursor</code> to the root of the document using the provided library functions. Then we compose <code>cursor</code>, <code>findNodes</code> and <code>content</code> together. The operator <code>$.//</code> means that <code>findNodes</code> must run in the context of the current cursor (<code>cursor</code>) and all its descendants. In other words, it simply means that <code>findNodes</code> will get access to the whole HTML tree. Give it a try and use <code>$/</code> instead of <code>$.//</code>. You'll notice that <code>findNodes</code> won't find the <code>&lt;table&gt;</code> element using <code>element \"table\"</code> because <code>&lt;table&gt;</code> is not directly below <code>&lt;html&gt;</code> (which is the place that <code>cursor</code> currently points to). Then, in <code>findNodes</code>, we compose <code>element \"table\"</code> and <code>attributeIs \"class\" \"forumTable\"</code> using the <code>&gt;=&gt;</code> operator because the function in the right hand side (rhs) must execute on the <code>Axis</code> returned by the left hand side (lhs).</p>\n\n<p>After that, we use the <code>&amp;//</code> operator to filter the descendant <code>&lt;tr&gt;</code>s inside the <code>&lt;table&gt;</code>. As before, If we had used only <code>&amp;/</code>, the <code>&lt;tr&gt;</code>s wouldn't be found because there is an enclosing <code>&lt;tbody&gt;</code> tag and <code>&amp;/</code> only look the immediate descendants (or children). Notice that when we have a <code>Cursor</code> in the lhs, the operators begin with <code>$</code>, while when we have an <code>Axis</code>, they begin with <code>&amp;</code>. Finally, we have the <code>select3rd</code> axis, which allows the named selection of the third child of a node when it exists. We use it to select the third <code>&lt;td&gt;</code> in each <code>&lt;tr&gt;</code>. Hopepully, by now, it should be easy to understand how it works.</p>\n\n<p>The code in your question has a call to <code>child</code> in the end of <code>findNodes</code> that uses the <code>&gt;=&gt;</code> operator. As long as you also change the <code>&amp;/</code> before <code>content</code> to <code>&gt;=&gt;</code>, you can keep that call (both implementations are equivalent).</p>\n"}], "owner": {"reputation": 1572, "user_id": 1354445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2ddd831999b590a537efc3d42f981e02?s=128&d=identicon&r=PG", "display_name": "tna0y", "link": "https://stackoverflow.com/users/1354445/tna0y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 44286388, "answer_count": 1, "score": 1, "last_activity_date": 1496238756, "creation_date": 1495852517, "question_id": 44212378, "link": "https://stackoverflow.com/questions/44212378/using-text-xml-cursor-to-get-specific-html-table-column", "title": "Using Text.XML.Cursor to get specific HTML table column", "body": "<p>I am trying to parse an HTML page using Haskell and <code>Text.XML.Cursor</code> package. My goal is to return the third column values in a list. I've spent last 4 hours trying to make it work. However, it seems that I'm unable to understand how XPath and <code>Text.XML.Cursor</code> works conceptually. </p>\n\n<p>So the task is:</p>\n\n<ol>\n<li>Find <code>&lt;table class=\"forumTable\"&gt;</code> tag somewhere in the document</li>\n<li>For every <code>&lt;tr&gt;</code> tag in it take <strong>third</strong> <code>&lt;td&gt;</code> tag</li>\n<li>Inside the cell there is a single <code>&lt;a&gt;</code> tag, <code>content</code> of which I want to add to the list. Not the <code>href</code> attribute but the value between <code>&lt;a&gt;</code> and <code>&lt;/a&gt;</code></li>\n</ol>\n\n<p>To be specific, I am parsing <a href=\"http://www.sql.ru/forum/sqlru-3-days/2\" rel=\"nofollow noreferrer\">this link</a> and I am trying to obtain the value of the column with forum names(next one after the topic).</p>\n\n<p>This is as far as I could get. Seems to be returning all contents of <code>&lt;a&gt;</code> tags inside the table</p>\n\n<pre><code>findNodes :: Cursor -&gt; [Cursor]\nfindNodes = element \"table\" &gt;=&gt; attributeIs \"class\" \"forumTable\" &amp;// element \"tr\" &amp;/ element \"td\" &amp;/ element \"a\" &gt;=&gt; child\nextractData = T.concat . content\n...\nlet cursor = fromDocument $ parseLBS $ simpleHTTP \"http://www.sql.ru/forum/sqlru-3-days/2\"\nlet lines = cursor $// findNodes &amp;| extractData\n</code></pre>\n\n<p>I am seeking for a solution to my problem as well as for an explanation of how this all works. Thank you.</p>\n"}, {"tags": ["haskell", "persistent", "servant"], "comments": [{"owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1495839362, "post_id": 44210820, "comment_id": 75434602, "body": "@AlexisKing I edited my post addressing you comment. Did I miss the point? Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 1, "last_activity_date": 1495842851, "creation_date": 1495842851, "answer_id": 44211566, "question_id": 44210820, "link": "https://stackoverflow.com/questions/44210820/multiple-json-instances-for-one-persistent-entity/44211566#44211566", "title": "Multiple JSON instances for one Persistent entity", "body": "<p>Why do you want multiple instances for the same datatype? Why don't you create separate datatypes for the data you'd like each handler to return, and <code>ToJSON</code> instances for each?</p>\n\n<pre><code>type UserAPI = \"user\"\n            :&gt; Capture \"username\" Username\n            :&gt; Get '[JSON] UserEmailAndToken\n\ntype ProfileAPI = \"profiles\"\n                :&gt; Capture \"username\" Username\n                :&gt; Get '[JSON] UserNameBioAndImage\n\ntype AppAPI = UserAPI :&lt;|&gt; ProfileAPI\n</code></pre>\n\n<p>Then you'd define <code>UserEmailAndToken</code> and <code>UserNameBioAndImage</code> (which should be very easy), write <code>ToJSON</code> instances for each, along with trivial functions mapping between <code>User</code> and these types.</p>\n"}], "owner": {"reputation": 499, "user_id": 1319249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/4htoC.jpg?s=128&g=1", "display_name": "Rui Afonso Pereira", "link": "https://stackoverflow.com/users/1319249/rui-afonso-pereira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "closed_date": 1495869397, "answer_count": 1, "score": 1, "last_activity_date": 1495842851, "creation_date": 1495837048, "last_edit_date": 1495839316, "question_id": 44210820, "link": "https://stackoverflow.com/questions/44210820/multiple-json-instances-for-one-persistent-entity", "closed_reason": "Duplicate", "title": "Multiple JSON instances for one Persistent entity", "body": "<p>I am using Servant and Persistent together. I have a <code>User</code> entity and I would like to know if it is possible to respond with just a subset of its fields, depending on the context.</p>\n\n<p>Let's consider the following two endpoints:</p>\n\n<pre><code>type UserAPI = \"user\"\n            :&gt; Capture \"username\" Username\n            :&gt; Get '[JSON] (Entity User)\n\ntype ProfileAPI = \"profiles\"\n                :&gt; Capture \"username\" Username\n                :&gt; Get '[JSON] (Entity User)\n\ntype AppAPI = UserAPI :&lt;|&gt; ProfileAPI\n</code></pre>\n\n<p>Here's our <code>User</code> model:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUser json sql=users\n    username  Text\n    email     Text\n    password  Text\n    token     Text\n    bio       Text Maybe default=NULL\n    image     Text Maybe default=NULL\n    createdAt UTCTime default=now()\n    updatedAt UTCTime Maybe default=NULL\n\n    UniqueUser username email\n    deriving Show\n|]\n</code></pre>\n\n<p>When a <code>GET /user</code> request arrives, let's say we just want to respond with <code>email</code> and <code>token</code> for authentication purposes. On the other hand, when a <code>GET /profile/:username</code> request arrives, we want to respond with just <code>username</code>, <code>bio</code> and <code>image</code>.</p>\n\n<p>How can we accomplish this? Thanks.</p>\n\n<hr>\n\n<p><strong>Update:</strong> I believe it is possible to \"convert\" between Persistent types and Servant request types by using different records for a specific table. For instance, one is used by Persistent, and the other is used as an interface with the client. However, this may require a function to convert between the two. As the logic grows, I presume things will become cumbersome.</p>\n\n<p>Moreover, I was thinking that defining ToJSON and FromJSON instances could do the trick, but I can't wrap my head around it.</p>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 8049883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beb23553ac729973dc87db2d6c343c8d?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian V.", "link": "https://stackoverflow.com/users/8049883/adrian-v"}, "edited": false, "score": 0, "creation_date": 1496135513, "post_id": 44230276, "comment_id": 75524111, "body": "I copied the type of lookupPostParam somewhere on the web: next time I will use the hackage site for that, but I don&#39;t know how to find the version of yesod-form I&#39;ve installed. The command &#39;stack exec -- yesod version&#39; returns yesod-bin 1.5.2.3. Installation is conform the quick start guide, on a Ubuntu 16.04 LTS system. I&#39;ve tried your suggestions but still got &#39;Couldn&#39;t match expected type&#39; errors. However your answer gave me several hints to look further, so I clicked the checkmark. Thanks!"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 45, "user_id": 8049883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beb23553ac729973dc87db2d6c343c8d?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian V.", "link": "https://stackoverflow.com/users/8049883/adrian-v"}, "edited": false, "score": 0, "creation_date": 1496177652, "post_id": 44230276, "comment_id": 75551476, "body": "I got that off of <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.33/docs/Yesod-Core-Handler.html#v:lookupPostParam\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/yesod-core-1.4.33/docs/&hellip;</a> but I think you figured it out already; to find out what version package you&#39;re using with stack try <code>stack list-dependencies</code>"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1496005598, "last_edit_date": 1496005598, "creation_date": 1495993679, "answer_id": 44230276, "question_id": 44208087, "link": "https://stackoverflow.com/questions/44208087/how-to-parse-yesod-form-parameters-into-haskell-values/44230276#44230276", "title": "How to parse yesod-form parameters into Haskell values", "body": "\n\n<p>This is unfortunately a fault in documentation and communication. </p>\n\n<p>Given</p>\n\n<pre><code>lookupPostParam :: (MonadResource m, MonadHandler m) =&gt; Text -&gt; m (Maybe Text)\n</code></pre>\n\n<p>the reader is meant to infer that <code>m</code> is not only a <code>MonadResouce</code> and a <code>MonadHandler</code> but also <code>Monad</code>. This tiny little line of code packs up a lot of intent into a very small sentence; it's a wart that so much of Haskell library usage is left implicit and subtextual. For example, to call <code>toUpper</code> on the <code>Text</code> inside this type you are meant to do this:</p>\n\n<pre><code>{-# language OverloadedStrings #-}\nfoo :: (MonadResource m, MonadHandler m) =&gt; m (Maybe Text)\nfoo = do\n  valueMaybe &lt;- lookupPostParam \"key\"\n  case valueMaybe of\n    Just value -&gt;\n      pure (toUpper value)\n    Nothing -&gt;\n      Nothing\n</code></pre>\n\n<p>Note that the monad stack (<code>MonadHandler</code>, <code>MonadResource</code>) has \"infected\" your code. This is meant to be intentional, so as to constrain you via the type checker to only run this function in the intended Yesod environment/state machine/context/whatever.</p>\n\n<h2>However</h2>\n\n<p>You are using yesod-forms and it would be nice to do the same thing within that framework. As with <code>lookupPostParam</code>, we can take advantage of the monad-applicative-functor typeclasses.</p>\n\n<p>We can adapt this to the <code>Form FileForm</code> value that you have.</p>\n\n<pre><code>sampleForm :: AForm Handler FileForm\nsampleForm =\n  FileForm &lt;$&gt; fileAFormReq \"Choose a file\"\n           &lt;*&gt; (toUpper &lt;$&gt; areq textField textSettings Nothing)\n</code></pre>\n\n<p>I think the types of <code>yesod-forms</code> changed between releases. I'm copying my types off the latest version as of writing, 1.4.11. </p>\n\n<p>Here we take advantage of the <a href=\"https://hackage.haskell.org/package/yesod-form-1.4.11/docs/Yesod-Form-Types.html#t:AForm\" rel=\"nofollow noreferrer\"><code>Monad m =&gt; Functor (AForm m)</code></a> instance. Knowing that we are indeed in a monad (the <code>Handler</code> monad) means we can use <code>fmap</code> and its infixed sibling <code>&lt;$&gt;</code> on the value returned by <code>areq textField textSettings Nothing</code>. This allows us to lift arbitrary functions acting on <code>Text</code> into the <code>AForm m</code> stack. For example, here we went from <code>Text -&gt; Text</code> to <code>AForm Handler Text -&gt; AForm Handler Text</code>.</p>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 45, "user_id": 8049883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beb23553ac729973dc87db2d6c343c8d?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian V.", "link": "https://stackoverflow.com/users/8049883/adrian-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 44230276, "answer_count": 1, "score": 1, "last_activity_date": 1496135814, "creation_date": 1495823450, "last_edit_date": 1496135814, "question_id": 44208087, "link": "https://stackoverflow.com/questions/44208087/how-to-parse-yesod-form-parameters-into-haskell-values", "title": "How to parse yesod-form parameters into Haskell values", "body": "<p>The code below is from the Home.hs file created by the yesod-simple scaffold.\nI like to do simple string manipulation on text input but don't know how to parse it into a Text value.\nHow, for example, can I use toUpper on fileDescription?\nI've tried using lookupPostParam\nbut I'm struggling with it's type signature:</p>\n\n<pre><code>lookupPostParam :: MonadHandler m =&gt; Text -&gt; m (Maybe Text)\n</code></pre>\n\n<p><em>Home.hs</em></p>\n\n<pre><code>module Handler.Home where\n\nimport Import\nimport Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3)\nimport Text.Julius (RawJS (..))\n\ndata FileForm = FileForm\n    { fileInfo :: FileInfo\n    , fileDescription :: Text\n    }\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = \"getHomeR\" :: Text\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle \"Welcome To Yesod!\"\n        $(widgetFile \"homepage\")\n\npostHomeR :: Handler Html\npostHomeR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost sampleForm\n    let handlerName = \"postHomeR\" :: Text\n        submission = case result of\n            FormSuccess res -&gt; Just res\n            _ -&gt; Nothing\n\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle \"Welcome To Yesod!\"\n        $(widgetFile \"homepage\")\n\nsampleForm :: Form FileForm\nsampleForm = renderBootstrap3 BootstrapBasicForm $ FileForm\n    &lt;$&gt; fileAFormReq \"Choose a file\"\n    &lt;*&gt; areq textField textSettings Nothing\n    where textSettings = FieldSettings\n            { fsLabel = \"What's on the file?\"\n            , fsTooltip = Nothing\n            , fsId = Nothing\n            , fsName = Nothing\n                 , fsAttrs =\n                    [ (\"class\", \"form-control\")\n                    , (\"placeholder\", \"File description\")\n                    ]\n            }\n\ncommentIds :: (Text, Text, Text)\ncommentIds = (\"js-commentForm\", \"js-createCommentTextarea\", \"js-\ncommentList\")\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1495821936, "post_id": 44207697, "comment_id": 75427927, "body": "What&#39;s not working? What problems with the type system? What errors? What are the other functions you are defining? You could probably supply fewer details in your question, but it would be difficult."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1495823978, "post_id": 44207697, "comment_id": 75428904, "body": "Please <i>edit your question</i> to include the full error message. Please also provide the type signatures and brief descriptions (or full code) of numLines, allNumWords, sortLs, makeList, amalgamate, and shorten. Without this information, it is impossible to answer your question. Please also explain, in the body of the question, exactly what you intend your function to do. Making an index of a file is not nearly precise enough."}, {"owner": {"reputation": 7, "user_id": 8061440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc74d7907da751af5a276a621ad42c52?s=128&d=identicon&r=PG&f=1", "display_name": "Erich Melvin", "link": "https://stackoverflow.com/users/8061440/erich-melvin"}, "edited": false, "score": 0, "creation_date": 1495930613, "post_id": 44207697, "comment_id": 75455841, "body": "I changed the post, i&#39;m sorry about that."}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 8061440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc74d7907da751af5a276a621ad42c52?s=128&d=identicon&r=PG&f=1", "display_name": "Erich Melvin", "link": "https://stackoverflow.com/users/8061440/erich-melvin"}, "edited": false, "score": 0, "creation_date": 1496063915, "post_id": 44234432, "comment_id": 75495905, "body": "Thanks for the help, my objective in this code is make a index of words, according their occurrence in a file text. But, my problem is the work with some functions together.   I understood how make this work, thanks again for your patience."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 0, "last_activity_date": 1496030671, "creation_date": 1496030671, "answer_id": 44234432, "question_id": 44207697, "link": "https://stackoverflow.com/questions/44207697/how-to-join-multiple-functions-to-apply-to-a-file-haskell/44234432#44234432", "title": "How to join multiple functions to apply to a file? Haskell", "body": "<p>The problem seems to be that you've mixed up the order of the arguments to <code>(.)</code>. It's defined (essentially) as</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(f . g) x = f (g x)\n</code></pre>\n\n<p>So it applies <code>g</code> first, and then applies <code>f</code> to the result.</p>\n\n<p>Your program will typecheck if you string up the functions in the opposite order:</p>\n\n<pre><code>makeIndex = shorten . almalgamate . converte . sortLs\n              . allNumWords . numLines . lines\n</code></pre>\n\n<p>Alternatively, you can use <code>(&gt;&gt;&gt;)</code>, which is a flipped version of <code>(.)</code>:</p>\n\n<pre><code>import Control.Category ((&gt;&gt;&gt;))\n\nmakeIndex = lines &gt;&gt;&gt; numLines &gt;&gt;&gt; allNumWords &gt;&gt;&gt; sortLs\n              &gt;&gt;&gt; converte &gt;&gt;&gt; almalgamate &gt;&gt;&gt; shorten\n</code></pre>\n\n<p>Since you still haven't said what you expect the program to <em>do</em>, I can't speak to whether the modified version is actually <em>correct</em>, but it does compile.</p>\n"}], "owner": {"reputation": 7, "user_id": 8061440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc74d7907da751af5a276a621ad42c52?s=128&d=identicon&r=PG&f=1", "display_name": "Erich Melvin", "link": "https://stackoverflow.com/users/8061440/erich-melvin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 44234432, "answer_count": 1, "score": -5, "last_activity_date": 1497020950, "creation_date": 1495821870, "last_edit_date": 1497020950, "question_id": 44207697, "link": "https://stackoverflow.com/questions/44207697/how-to-join-multiple-functions-to-apply-to-a-file-haskell", "title": "How to join multiple functions to apply to a file? Haskell", "body": "<p>Continuing my studies in haskell, I need to apply several functions to a file. I researched and found some tips, but it's not working, I'm having problems with the type system, can help me? I make this:</p>\n\n<pre><code>import Prelude hiding (Word, lines)\nimport Data.Char\nimport System.IO\nimport Data.List hiding (lines)\n\ntype Doc = String\ntype Line = String\ntype Word = String\n\nmakeIndex :: Doc -&gt; [([Int], Word)]\nmakeIndex = lines . numLines . allNumWords . sortLs . makelists . almalgamate . shorten\n\nlines :: Doc -&gt; [Line]\nlines [] = []\nlines texto = takeWhile(/='\\n') texto:(lines.dropWhile(=='\\n').dropWhile(/='\\n')) texto\n\nnumLines :: [Line] -&gt; [(Int, Line)]\nnumLines texto = zip [1.. length texto] texto\n\nnumWord :: (Int, Line) -&gt; [(Int, Word)]\nnumWord (number, line) = [(number, word) | word &lt;- divide line]\n\ndivide :: String -&gt; [Word]\ndivide st = split (dropSpace st)\n\nsplit :: String -&gt; [Word]\nsplit [] = []\nsplit st = (getWord st) : split (dropSpace (dropWord st))\n\ngetWord :: String -&gt; String\ngetWord [] = []\ngetWord (x:xs) | elem x whitespace = (x:xs)\n               | otherwise = dropWord xs\n\nwhitespace :: String\nwhitespace = ['\\n', '\\t', ' ']\n\ndropSpace :: String -&gt; String\ndropSpace [] = []\ndropSpace (x:xs) | elem x whitespace = dropSpace xs\n                 | otherwise = (x:xs)\n\ndropWord :: String -&gt; String\ndropWord [] = []\ndropWord (x:xs) | elem x whitespace = (x:xs)\n                | otherwise = dropWord xs          \n\nallNumWords :: [(Int, Line)] -&gt; [(Int, Word)]\nallNumWords = concat.map numPalavra\n\nsortLs :: [(Int, Word)] -&gt; [(Int, Word)]\nsortLs [] = []\nsortLs (a:x) = sortLs [b | b &lt;- x, compare b a] ++ [a] ++ sortLs [b | b &lt;- x, compare a b]\n                where compare (n1, w1) (n2, w2) = (w1 &lt; w2) || (w1 == w2 &amp;&amp; n1 &lt; n2)\n\nmakelist :: [(Int, Word)] -&gt; [([Int], Word)]\nmakelist = map mklis \n             where mklis (num, word) = ([num], word)\n\nalmalgamate :: [([Int], Word)] -&gt; [([Int], Word)]\nalmalgamate [] = []\nalmalgamate [a] = [a]\nalmalgamate ((n1, w1) : (n2, w2) : rest) | w1 /= w2 = (n1, w1) : almalgamate ((n2, w2) : rest)\n                                         | otherwise = almalgamate ((n1++n2, w1) : rest)\n\nshorten :: [([Int], Word)] -&gt; [([Int], Word)]\nshorten = filter long\n           where long (num, palavra) = length palavra &gt; 4\n</code></pre>\n\n<p>In the compiler the error is:</p>\n\n<pre><code>in line 18\nColdn't match type `[Char]' -&gt; ([Int], Word)'  \nExpected type: Doc -&gt; [([Int], Word)]  \nActual type: [([Int], Word] -&gt; [Line]  \nint the expression (repeat all the functions)  \nin an equation for 'makeIndex' (repeat all the functions)  \n</code></pre>\n\n<p>That's same error shown at all the functions call in the makeindex. </p>\n\n<pre><code>GHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( C:\\Users\\xxx\\Desktop\\makeindex.hs, interpreted )\n\nC:\\Users\\xxx\\Desktop\\makeindex.hs:17:6: error:  \n    * Couldn't match type `[Char]' with `([Int], Word)'  \n      Expected type: Doc -&gt; [([Int], Word)]  \n        Actual type: [([Int], Word)] -&gt; [String]  \n    * In the expression:  \n        lines  \n        . numLines  \n          . allNumWords . sortLs . converte . almalgamate . shorten\n      In an equation for `makeIndex':  \n          makeIndex  \n            = lines  \n              . numLines  \n                . allNumWords . sortLs . makelist . almalgamate . shorten  \n\nC:\\Users\\xxx\\Desktop\\makeindex.hs:18:6: error:  \n    * Couldn't match type `(Int, Line)' with `Char'  \n      Expected type: [([Int], Word)] -&gt; String  \n        Actual type: [([Int], Word)] -&gt; [(Int, Line)]  \n    * In the second argument of `(.)', namely  \n        `numLines  \n         . allNumWords . sortLs . makelist . almalgamate . shorten'\n      In the expression:  \n        lines  \n        . numLines  \n          . allNumWords . sortLs . converte . almalgamate . shorten\n      In an equation for `makeIndex':  \n          makeIndex  \n            = lines  \n              . numLines  \n                . allNumWords . sortLs . makelist . almalgamate . shorten  \n\nC:\\Users\\xxx\\Desktop\\makeindex.hs:19:6: error:  \n    * Couldn't match type `(Int, Word)' with `[Char]'  \n      Expected type: [([Int], Word)] -&gt; [Line]  \n        Actual type: [([Int], Word)] -&gt; [(Int, Word)]  \n    * In the second argument of `(.)', namely  \n        `allNumWords . sortLs . makelist . almalgamate . shorten'  \n      In the second argument of `(.)', namely  \n        `numLines  \n         . allNumWords . sortLs . makelist . almalgamate . shorten'  \n      In the expression:  \n        lines  \n        . numLines  \n          . allNumWords . sortLs . makelist . almalgamate . shorten  \n\nC:\\Users\\xxx\\Desktop\\makeindex.hs:21:6: error:  \n    * Couldn't match type `[Int]' with `Int'  \n      Expected type: [([Int], Word)] -&gt; [(Int, Word)]  \n        Actual type: [([Int], Word)] -&gt; [([Int], Word)]  \n    * In the second argument of `(.)', namely  \n        `converte . almalgamate . shorten'  \n      In the second argument of `(.)', namely  \n        `sortLs . converte . almalgamate . shorten'  \n      In the second argument of `(.)', namely  \n        `allNumWords . sortLs . makelist . almalgamate . shorten'  \n\nC:\\Users\\xxx\\Desktop\\makeindex.hs:22:6: error:  \n    * Couldn't match type `[Int]' with `Int'  \n      Expected type: [([Int], Word)] -&gt; [(Int, Word)]  \n        Actual type: [([Int], Word)] -&gt; [([Int], Word)]  \n    * In the second argument of `(.)', namely `almalgamate . shorten'  \n      In the second argument of `(.)', namely  \n        `converte . almalgamate . shorten'  \n      In the second argument of `(.)', namely  \n        `sortLs . converte . almalgamate . shorten'  \nFailed, modules loaded: none.  \n</code></pre>\n\n<p>This are the problems, an match types problem?  I'm so sorry for my bad description of the problem, in the first posting. </p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1495816164, "creation_date": 1495816164, "answer_id": 44206216, "question_id": 44205683, "link": "https://stackoverflow.com/questions/44205683/haskell-parsec-eof/44206216#44206216", "title": "Haskell Parsec EOF", "body": "<p>The first instance you attempt <code>many anyChar</code>, the parser will happily parse <em>all the rest of the file</em> into the string <code>name</code>, since everything that follows clearly fulfills the criterion <em>any character</em> (including the newline characters). That's clearly not what you want.</p>\n\n<p>Use <a href=\"http://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Combinator.html#v:manyTill\" rel=\"noreferrer\"><code>manyTill</code></a>, or restrict the choice of permitted characters so the <code>name</code> will end at the appropriate place.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 44206216, "answer_count": 1, "score": 1, "last_activity_date": 1495816164, "creation_date": 1495814138, "question_id": 44205683, "link": "https://stackoverflow.com/questions/44205683/haskell-parsec-eof", "title": "Haskell Parsec EOF", "body": "<p>I have a file containing many of the following data format:</p>\n\n<pre><code>Dan Clark\u2019s Profile Photo\nMember Name\nDan Clark  2nd degree connection 2nd\nMember Occupation\nFounder and Headmaster at Some Company, LLC\nNina blalba\u2019s Profile Photo\nMember Name\nNina blabla  2nd degree connection 2nd\nMember Occupation\nConsultant - GAmes executive search\n</code></pre>\n\n<p>My parser to parse the above file:</p>\n\n<pre><code>module Main where\n\nimport           Control.Applicative\nimport           Control.Monad\nimport           Text.ParserCombinators.Parsec hiding (many, (&lt;|&gt;))\n\ndata Contact = Contact {\n  name :: String,\n  occupation :: String,\n  company :: String\n\n                       } deriving Show\n\nmatchContact :: Parser Contact\nmatchContact = do\n  name &lt;- many anyChar\n  char '\\''\n  string \"s Profile Photo\"\n  char '\\n'\n  string \"Member Name\"\n  char '\\n'\n  string name\n  many anyChar\n  char '\\n'\n  string \"Member Occupation\"\n  char '\\n'\n  job &lt;- many anyChar\n  try $ string \" at \"\n  company &lt;- many anyChar\n  try (char '\\n')\n  return $ Contact name job company\n\nmain = do\n  c &lt;- parseFromFile (many matchContact &lt;* eof) \"contacts.txt\"\n  print c\n</code></pre>\n\n<p>There are many issues such as the data are not regular. But the most urgent one is that I always run into the error at the last line of the input file:</p>\n\n<pre><code>Left \"contacts.txt\" (line 8670, column 12):\nunexpected end of input\nexpecting \"'\"\n</code></pre>\n\n<p>How to fix this?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 1375, "user_id": 1795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456afa63d062cb01041348a6eaf49aa4?s=128&d=identicon&r=PG", "display_name": "Brian Magnuson", "link": "https://stackoverflow.com/users/1795592/brian-magnuson"}, "edited": false, "score": 0, "creation_date": 1495806628, "post_id": 44203210, "comment_id": 75419180, "body": "Yup, that did the trick. There&#39;s the one-liner I suspected existed.  Thanks."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1495806309, "creation_date": 1495806309, "answer_id": 44203210, "question_id": 44202878, "link": "https://stackoverflow.com/questions/44202878/more-idiomatic-way-of-exiting-mapm-early/44203210#44203210", "title": "More idiomatic way of exiting mapM early", "body": "<p>The behavior you want is that of <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Maybe.html\" rel=\"noreferrer\">the monad transformer <code>MaybeT</code></a>.</p>\n\n<pre><code>myMapM :: Monad m =&gt; (t1 -&gt; m (Maybe t)) -&gt; [t1] -&gt; m (Maybe [t])\nmyMapM f = runMaybeT . mapM (MaybeT . f) \n</code></pre>\n"}], "owner": {"reputation": 1375, "user_id": 1795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456afa63d062cb01041348a6eaf49aa4?s=128&d=identicon&r=PG", "display_name": "Brian Magnuson", "link": "https://stackoverflow.com/users/1795592/brian-magnuson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 44203210, "answer_count": 1, "score": 4, "last_activity_date": 1495816598, "creation_date": 1495805328, "last_edit_date": 1495816598, "question_id": 44202878, "link": "https://stackoverflow.com/questions/44202878/more-idiomatic-way-of-exiting-mapm-early", "title": "More idiomatic way of exiting mapM early", "body": "<p>Given a list of actions that returns <code>m (Maybe a)</code> I'm trying to return <code>m (Maybe [a])</code> where if any of the individual results are <code>Nothing</code> the whole result is <code>Nothing</code>. <code>m</code> contains <code>StateT</code> and I want to avoid running any actions after the first <code>Nothing</code> is returned.</p>\n\n<p>Trying to use <code>mapM</code> and then moving the <code>Maybe</code> outside the list results in all the actions being run.</p>\n\n<p>I have this solution but nested case statements with just a lot of wrapping and unwrapping gives me the feeling that there's probably a more elegant way of doing this.  Usually when I have this feeling there a one-liner with a more general type that does exactly the same thing.</p>\n\n<p>Any suggestions?</p>\n\n<pre><code>myMapM' :: Monad m =&gt; (t1 -&gt; m (Maybe t)) -&gt; [t1] -&gt; m (Maybe [t])\nmyMapM' f [] = return (Just [])\nmyMapM' f (a:as) = do\n  r &lt;- f a \n  case r of\n    Nothing -&gt; return Nothing\n    Just g -&gt; do\n      rs &lt;- myMapM' f as\n      case rs of\n        Nothing -&gt; return Nothing\n        Just gs -&gt; return (Just (g:gs))\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 440, "user_id": 1606510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa28476ad9d46bbb1f2ac2fd7283f69?s=128&d=identicon&r=PG", "display_name": "Mekeor Melire", "link": "https://stackoverflow.com/users/1606510/mekeor-melire"}, "edited": false, "score": 0, "creation_date": 1495809429, "post_id": 44202793, "comment_id": 75421055, "body": "Can you fetch the file/path using <code>curl</code>? (I&#39;m not sure though, if there is <code>curl</code> for Windows.)"}, {"owner": {"reputation": 440, "user_id": 1606510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa28476ad9d46bbb1f2ac2fd7283f69?s=128&d=identicon&r=PG", "display_name": "Mekeor Melire", "link": "https://stackoverflow.com/users/1606510/mekeor-melire"}, "edited": false, "score": 0, "creation_date": 1495809443, "post_id": 44202793, "comment_id": 75421075, "body": "You might want to check out <a href=\"https://github.com/commercialhaskell/stack/issues/2536\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/2536</a>"}, {"owner": {"reputation": 11, "user_id": 8070544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebeeba1e9d2a5dc79c3c8ca2735ccbc5?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Denby", "link": "https://stackoverflow.com/users/8070544/paul-denby"}, "reply_to_user": {"reputation": 440, "user_id": 1606510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa28476ad9d46bbb1f2ac2fd7283f69?s=128&d=identicon&r=PG", "display_name": "Mekeor Melire", "link": "https://stackoverflow.com/users/1606510/mekeor-melire"}, "edited": false, "score": 0, "creation_date": 1496062921, "post_id": 44202793, "comment_id": 75495243, "body": "Added curl response to OP"}], "owner": {"reputation": 11, "user_id": 8070544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebeeba1e9d2a5dc79c3c8ca2735ccbc5?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Denby", "link": "https://stackoverflow.com/users/8070544/paul-denby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 657, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496062836, "creation_date": 1495805098, "last_edit_date": 1496062836, "question_id": 44202793, "link": "https://stackoverflow.com/questions/44202793/httpexceptionrequest-certificateunknown-running-stack-setup", "title": "HttpExceptionRequest (CertificateUnknown) running stack setup", "body": "<pre><code>$ stack setup -v\nVersion 1.4.0, Git revision e714f1dd3fade19496d91bd6a017e435a96a6bcd i386 hpack-0.17.0\n2017-05-26 07:40:44.945473: [debug] Checking for project config at: C:\\development\\repos\\eta\\stack.yaml\n@(Stack\\Config.hs:935:9)\n2017-05-26 07:40:44.948475: [debug] Loading project config file stack.yaml\n@(Stack\\Config.hs:960:13)\n2017-05-26 07:40:44.954477: [debug] Trying to decode C:\\sr\\build-plan-cache\\i386-windows\\lts-6.27.cache\n@(Data\\Store\\VersionTagged.hs:68:5)\n2017-05-26 07:40:44.964480: [debug] Success decoding C:\\sr\\build-plan-cache\\i386-windows\\lts-6.27.cache\n@(Data\\Store\\VersionTagged.hs:72:13)\n2017-05-26 07:40:44.975485: [debug] Using standard GHC build\n@(Stack\\Setup.hs:600:9)\nHttpExceptionRequest Request {\n  host                 = \"raw.githubusercontent.com\"\n  port                 = 443\n  secure               = True\n  requestHeaders       = []\n  path                 = \"/fpco/stackage-content/master/stack/stack-setup-2.yaml\"\n  queryString          = \"\"\n  method               = \"GET\"\n  proxy                = Nothing\n  rawBody              = False\n  redirectCount        = 10\n  responseTimeout      = ResponseTimeoutDefault\n  requestVersion       = HTTP/1.1\n}\n (InternalException (HandshakeFailed (Error_Protocol (\"certificate rejected: [InvalidSignature SignatureInvalid]\",True,CertificateUnknown))))\n</code></pre>\n\n<p>I'm running Windows 10 and get the same error in GitBash, Cygwin and DOS Command Line, both as User and as Administrator.</p>\n\n<p>I have tried fetching the file into IE (<a href=\"https://raw.githubusercontent.com/fpco/stackage-content/master/stack/stack-setup-2.yaml\" rel=\"nofollow noreferrer\">https://raw.githubusercontent.com/fpco/stackage-content/master/stack/stack-setup-2.yaml</a>) as suggested for similar issues regarding the retrieval of files from GitHub. I can get the file but stack still fails afterwards.</p>\n\n<p>Following comments I also tried curl from GitBash and get</p>\n\n<pre><code>* About to connect() to raw.githubusercontent.com port 443 (#0)\n*   Trying 151.101.48.133...\n* Connected to raw.githubusercontent.com (151.101.48.133) port 443 (#0)\n* successfully set certificate verify locations:\n*   CAfile: C:\\Users\\pauldenby\\AppData\\Local\\Atlassian\\SourceTree\\git_local\\bin\\curl-ca-bundle.crt\n  CApath: none\n* SSLv3, TLS handshake, Client hello (1):\n* SSLv3, TLS handshake, Server hello (2):\n* SSLv3, TLS handshake, CERT (11):\n* SSLv3, TLS alert, Server hello (2):\n* SSL certificate problem: unable to get local issuer certificate\n* Closing connection 0\ncurl: (60) SSL certificate problem: unable to get local issuer certificate\n</code></pre>\n\n<p>I am currently trying to import the missing certs into curl-ca-bundle.crt but I'm not sure that'll help with the fundamental problem. Is it documented anywhere where stack will look for trusted CAs?</p>\n\n<p>I can also run curl --insecure. As a very temporary workaround, is there anything similar for stack?</p>\n"}, {"tags": ["oop", "haskell", "subtyping"], "answers": [{"comments": [{"owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "edited": false, "score": 1, "creation_date": 1495804217, "post_id": 44202313, "comment_id": 75417513, "body": "What about expression problem? If later I want to add a new shape?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "edited": false, "score": 2, "creation_date": 1495804393, "post_id": 44202313, "comment_id": 75417640, "body": "@mahdix It&#39;s the dual issue w.r.t. OOP. In OOP you can easily add new shapes, but not new operations (you need to modify all the shapes). In (closed) ADTs you can easily add new operations, but not new shapes (you need to modify off the operations). If you already have read about the expression problem, you should probably have read about this sort of duality."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "edited": false, "score": 2, "creation_date": 1495804460, "post_id": 44202313, "comment_id": 75417685, "body": "@mahdix Sometimes, an existential type with a type class can get you closer to OOP, but this can easily lead to a known antipattern <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "edited": false, "score": 2, "creation_date": 1495805084, "post_id": 44202313, "comment_id": 75418149, "body": "@mahdix as I said, if you want to keep this open for yet-unknown shapes, you should probably just store the final results of the common operation (in this case, <code>draw</code>). Because if it&#39;s not known what exact shapes you&#39;ll be dealing with, there&#39;s nothing shape-specific that you can safely do with all of them in a polymorphic manner, anyway. \u2014 That said: I think this is an application where an existential type <i>could</i> make sense, but only if you have a nontrivial class that gives you safe, polymorphic operations over the shapes. Else, an existential gains you nothing and just adds indirection."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1495803688, "creation_date": 1495803688, "answer_id": 44202313, "question_id": 44202092, "link": "https://stackoverflow.com/questions/44202092/haskell-how-to-implement-a-processing-on-a-list-of-different-but-related-types/44202313#44202313", "title": "Haskell: How to implement a processing on a list of different but related types?", "body": "<p>You probably want</p>\n\n<pre><code>data Circle = Circle { {- e.g. center- and radius fields -} }\ndata Rectangle = Rectangle { ... }\n               | SquareRectangle Square\ndata Square = Square { ... }\n</code></pre>\n\n<p>then</p>\n\n<pre><code>data Shape = CircleShape Circle\n           | RectangleShape Rectangle\n</code></pre>\n\n<p>Now you can have a list of <code>Shapes</code> which may contain any circles, rectangles and squares.</p>\n\n<p>The main difference to your OOP code is that the <code>Shape</code> \u201cclass\u201d (it's not a Haskell class but an ADT) is <em>closed</em>: if sombody wants to add new alternative shapes, they need to define a new type for this, or change the actual source code of the old definition.</p>\n\n<p>For many real-world applications, that's actually a good thing because it means the compiler will at every time have all possible options in view and can tell you if you're writing code that doesn't cover some possible option.</p>\n\n<p>Alternatively, if your <em>intention</em> is to leave shapes abstract and defined <em>by how they are drawn</em>, just use</p>\n\n<pre><code>type Shape = WhateverTypeYourDrawingCanvasHas\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1495804724, "post_id": 44202608, "comment_id": 75417893, "body": "There&#39;s no point in having an existential constrained over a class that has only methods of type <code>s -&gt; XYZ</code> \u2013 that&#39;s equivalent to just storing the <code>XYZ</code> results in a plain old <code>data</code> (in non-strict fields). IOW, your existential solution would better be written as <code>data Sh = Sh { draw :: IO () }</code>. (Since <code>IO ()</code> is not strict data anyway, that could actually be a newtype as well.)"}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1495804998, "post_id": 44202608, "comment_id": 75418101, "body": "@leftaroundabout Yeah I&#39;m reading the article posted by chi on your post. I edited my post."}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 4, "last_activity_date": 1495805091, "last_edit_date": 1495805091, "creation_date": 1495804534, "answer_id": 44202608, "question_id": 44202092, "link": "https://stackoverflow.com/questions/44202092/haskell-how-to-implement-a-processing-on-a-list-of-different-but-related-types/44202608#44202608", "title": "Haskell: How to implement a processing on a list of different but related types?", "body": "<p>You can either use a datatype to encapsulate all of your shapes, or use existential quantification. Both options have advantages and drawbacks. You are facing the <a href=\"https://en.wikipedia.org/wiki/Expression_problem\" rel=\"nofollow noreferrer\">\"expression problem\"</a>. Choosing the right option depends on your architecture, so I'll just detail both.</p>\n\n<p>We'll assume you have a similar definition for your shapes:</p>\n\n<pre><code>data Circle = Circle { circleCenter :: Point, circleRadius :: Float }\ndata Rectangle = Rectangle { rectTopLeft :: Point, rectSize :: Size }\ndata Square = Square { squareTopLeft :: Point, squareSize :: Float }\n</code></pre>\n\n<p>... along with some functions <code>drawCircle</code>, <code>drawRectangle</code> and <code>drawSquare</code>.</p>\n\n<h2>Using a datatype</h2>\n\n<pre><code>data Shape\n    = Circle Cirle\n    | Rectangle Rectangle\n    | Square Square\n\ndraw :: Shape -&gt; IO ()\ndraw (Circle c) = drawCircle c\ndraw (Rectangle r) = drawRectangle r\ndraw (Square s) = drawSquare s\n</code></pre>\n\n<p>This pattern allows you to easily add new functions (like <code>shapeArea</code>, <code>shiftShape</code>, etc...) but it's difficult to add new shapes, especially for the user of your library.</p>\n\n<h2>Using existential quantification</h2>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\n-- Instead of using a datatype, we use a typeclass\nclass Shape s where\n    draw :: s -&gt; IO ()\n\ninstance Shape Circle where\n    draw = drawCircle\n\ninstance Shape Rectangle where\n    draw = drawRectangle\n\ninstance Shape Square where\n    draw = drawSquare\n\n-- Can't use newtype with ExistentialQuantification\ndata Sh = forall s. Shape s =&gt; Sh s\n\ninstance Shape Sh where\n    draw (Sh s) = draw s\n</code></pre>\n\n<p>With this solution, you, or the user, will be able to easily add new shapes, but adding new functions could be a little more complicated.</p>\n\n<p>You could also \"downgrade\" typeclasses to datatypes, and typeclass members to record field, as stated in <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">this article</a>, as chi mentionned in leftaroundabout's answer.</p>\n\n<p>I can't help you further, since I don't know your code in detail. If you still need help to choose, let me know in the comments :)</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 4, "last_activity_date": 1495805018, "creation_date": 1495805018, "answer_id": 44202760, "question_id": 44202092, "link": "https://stackoverflow.com/questions/44202092/haskell-how-to-implement-a-processing-on-a-list-of-different-but-related-types/44202760#44202760", "title": "Haskell: How to implement a processing on a list of different but related types?", "body": "<p>You can use <a href=\"http://okmij.org/ftp/tagless-final/\" rel=\"nofollow noreferrer\">typed final style</a>. For example:</p>\n\n<pre><code>class Circle s where\n    circle :: Point -&gt; Radius -&gt; s\n\nclass Rectangle s where\n    rectangle :: Point -&gt; Point -&gt; s\n\nclass Square s where\n    square :: Point -&gt; Side -&gt; s\n\nnewtype Draw a = Draw { runDraw :: IO a }\n    deriving (Functor, Applicative, Monad)\n\ndraw :: Draw () -&gt; Draw ()\ndraw = id\n\ninstance Circle (Draw ()) where\n    circle = ... -- draw circle here\n\ninstance Rectangle (Draw ()) where\n    rectangle = ... -- draw rectangle here\n\ninstance Square (Draw ()) where\n    square = ... -- draw square here\n\nmain = runDraw $ forM_ shapes draw\n  where\n    shapes = [circle ..., rectangle ..., square ...]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1495829459, "last_edit_date": 1495829459, "creation_date": 1495822507, "answer_id": 44207853, "question_id": 44202092, "link": "https://stackoverflow.com/questions/44202092/haskell-how-to-implement-a-processing-on-a-list-of-different-but-related-types/44207853#44207853", "title": "Haskell: How to implement a processing on a list of different but related types?", "body": "<p>I think it would be nice to group constructors <code>Circle</code>, <code>Rectangle</code> and <code>Square</code> under the same type called <code>Shape</code> and even we can invent a <code>Shapes</code> class to have some common methods as follows.</p>\n\n<pre><code>class Shapes a where\n  area          :: a -&gt; Float\n  circumference :: a -&gt; Float\n  draw          :: a -&gt; IO ()\n\ndata Shape = Circle {pos :: (Float, Float), radius :: Float} |\n             Rect   {pos :: (Float, Float), width :: Float, height :: Float} |\n             Square {pos :: (Float, Float), width :: Float}\n\ninstance Shapes Shape where\n  area (Circle _ radius)              = pi * radius ^ 2\n  area (Rect _ width height)          = width * height\n  area (Square _ width)               = width ^ 2\n  circumference (Circle _ radius)     = 2 * pi * radius\n  circumference (Rect _ width height) = 2 * (width + height)\n  circumference (Square _ width)      = 4 * width\n  draw (Circle pos radius)            = putStrLn (\" Circle drawn @ \" ++ show pos ++ \" with radius \" ++ show radius)\n  draw (Rect pos width height)        = putStrLn (\" Rectangle drawn @ \" ++ show pos ++ \" with (w,h) \" ++ show (width,height))\n  draw (Square pos width)             = putStrLn (\" Square drawn @ \" ++ show pos ++ \" with width \" ++ show width)\n\ninstance Show Shape where\n  show (Circle pos radius)     = \"Circle with radius \" ++ show radius ++ \" @ \" ++ show pos\n  show (Rect pos width height) = \"Rect (w,h)\" ++ show (width, height) ++ \" @ \" ++ show pos\n  show (Square pos width)      = \"Square with edge \" ++ show width ++ \" @ \" ++ show pos\n\n*Main&gt; let c1 = Circle (20,20) 5\n*Main&gt; draw c1\n Circle drawn @ (20.0,20.0) with radius 5.0\n*Main&gt; let c2 = c1 {pos = (10,10)}\n*Main&gt; draw c2\n Circle drawn @ (10.0,10.0) with radius 5.0\n*Main&gt; draw c1 -- c1 is immutable\n Circle drawn @ (20.0,20.0) with radius 5.0\n*Main&gt; area c1\n78.53982\n</code></pre>\n\n<p>However if you would like to create an extendable datatype then it would be best to define a <code>Shape</code> class and define your shapes as individual data types which inherit the methods from <code>Shape</code> class. A good read could be this <a href=\"https://stackoverflow.com/a/6890589/4543207\">SO answer</a>.</p>\n"}], "owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 44202608, "answer_count": 4, "score": 1, "last_activity_date": 1495829459, "creation_date": 1495802995, "question_id": 44202092, "link": "https://stackoverflow.com/questions/44202092/haskell-how-to-implement-a-processing-on-a-list-of-different-but-related-types", "title": "Haskell: How to implement a processing on a list of different but related types?", "body": "<p>I am from an OOP background so I cannot understand how this is done in Haskell.</p>\n\n<p>In OOP, suppose that we have <code>Shape -&gt; Circle, Rectangle, Square</code> hierarchy. I can easily write this pseudo code:</p>\n\n<pre><code>Shape[] shapes = [create_circle(), create_rect(), create_square()]\nforeach(Shape s: Shapes) draw(s)\n</code></pre>\n\n<p>And it will call <code>draw</code> method for Circle, Rectangle, Square (or Shape if it's not implemented for a subtype).</p>\n\n<p>How can this be achieved in Haskell?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1495798077, "post_id": 44200230, "comment_id": 75413415, "body": "<code>[a]</code> has type <code>[a]</code> while <code>showt</code> need to return a <code>[Char]</code>. You need to add a <code>Show</code> constraint on <code>a</code> and use <code>show</code> to convert values into strings: <code>showt :: Show a =&gt; Tree a -&gt; [Char]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1495817836, "post_id": 44200230, "comment_id": 75425795, "body": "Yes, Haskell infers a type. And then it looks at the type you demanded (by writing <code>showt :: Tree a -&gt; [Char]</code>) and checks whether the two types are compatible. They&#39;re not. You can fix your demand, or remove it and use the inferred type, or fix your implementation."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1495798782, "last_edit_date": 1495798782, "creation_date": 1495798133, "answer_id": 44200461, "question_id": 44200230, "link": "https://stackoverflow.com/questions/44200230/traversing-a-polymorphic-finite-binary-tree/44200461#44200461", "title": "Traversing a polymorphic finite binary tree", "body": "<p>Well it is <strong>not</strong> because a <code>data Tree a = ... deriving Show</code>, that it means that <code>a</code> is a <code>Char</code>.</p>\n\n<p>It only means that Haskell has <em>automatically</em> added an type instance:</p>\n\n<pre><code>instance <b>Show a =&gt;</b> Show (Tree a) where\n    -- ...</code></pre>\n\n<p>So as you can see, it adds a type constraint: <code>a</code> must be an instance of <code>Show</code> in order for <code>Tree a</code> to be an instance of <code>Show</code>. So our first conclusion is <strong><code>a</code> can still be of any type</strong>.</p>\n\n<p>Furthermore, even if <code>a</code> is an instance of <code>Show</code>, it does <strong>not</strong> mean that it is a <code>String</code> (or <code>Char</code>). It only means that there are some functions available like <code>show :: (Show a) =&gt; a -&gt; String</code>.</p>\n\n<p>So there some options here:</p>\n\n<ul>\n<li><p>you add a type constraint, and use <code>show</code>:</p>\n\n<pre><code>showt :: <b>Show a =&gt;</b> Tree a -&gt; [Char]\nshowt ( Leaf a ) = <b>show</b> a\n--- ...</code></pre></li>\n<li><p>you restrict yourself to trees of type <code>String</code> (or type <code>Char</code>):</p>\n\n<pre><code>showt :: Tree <b>Char</b> -&gt; [Char]\nshowt ( Leaf a ) = [a]\n--- ...</code></pre></li>\n</ul>\n\n<p>Finally Haskell <em>can</em> infer the type of a function, but here you provide an <em>explicit</em> type signature. If you however omit the signature, you let Haskell derive it automatically:</p>\n\n<pre><code>Prelude&gt; let showt ( Leaf a ) = [a]\nPrelude&gt; :t showt\nshowt :: Tree t -&gt; [t]\n</code></pre>\n"}], "owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 44200461, "answer_count": 1, "score": 1, "last_activity_date": 1495798782, "creation_date": 1495797489, "question_id": 44200230, "link": "https://stackoverflow.com/questions/44200230/traversing-a-polymorphic-finite-binary-tree", "title": "Traversing a polymorphic finite binary tree", "body": "<p>I have the following data type for my tree.</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) a (Tree a) deriving ( Show )\n</code></pre>\n\n<p>I'd like to print a representation of a given tree using a left to right depth first traversal.</p>\n\n<p>For the moment, I've decided to go with pattern matching. </p>\n\n<pre><code>showt :: Tree a -&gt; [Char]\nshowt ( Leaf a ) = [a]\n...\n</code></pre>\n\n<p>When I try to run it using GHCi, here's the error I get</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          showt :: forall a. Tree a -&gt; [Char]\n        at 2016.hs:31:10\n    \u2022 In the expression: a\n      In the expression: [a]\n      In an equation for \u2018showt\u2019: showt (Leaf a) = [a]\n    \u2022 Relevant bindings include\n        a :: a (bound at 2016.hs:32:14)\n        showt :: Tree a -&gt; [Char] (bound at 2016.hs:32:1)\n</code></pre>\n\n<p>I don't see where the problem comes from. Haskell should infer the type, no?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1495796235, "post_id": 44199761, "comment_id": 75412340, "body": "That <code>a</code> is in fact an accumulator and helps to make the recursion a tail call optimized one. Which means unlike in the first example, it doesn&#39;t grow the call stack."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1495845101, "post_id": 44199761, "comment_id": 75435710, "body": "@Redu Haskell doesn&#39;t have a call stack, it has a thunk stack. Blindly getting things into tail recursive form can actually hurt performance of Haskell programs, since using an accumulator inherently interferes with laziness by preventing the function from returning until it&#39;s inspected the entire input."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1495811385, "post_id": 44200002, "comment_id": 75422262, "body": "It&#39;s worth note that using O(n) memory over O(n) allocations will result in O(n^2) work being done in garbage collection if the process goes long enough and dominates memory use for the program."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1495812071, "last_edit_date": 1495812071, "creation_date": 1495796845, "answer_id": 44200002, "question_id": 44199761, "link": "https://stackoverflow.com/questions/44199761/why-are-parameter-based-definitions-more-efficient-than-recursion/44200002#44200002", "title": "Why are parameter based definitions more efficient than recursion?", "body": "<p>The first recursion sums values <code>[0..n]</code> starting from its end (<code>n</code>), like this:</p>\n\n<pre><code>1+(2+(3+(... + ((n-1) + n)) ...)))\n</code></pre>\n\n<p>With this approach, the program first has to enumerate all the numbers, generating the full sequence, and only after that additions can actually be performed.</p>\n\n<p>This requires O(n) memory and O(n) time.</p>\n\n<p>In the second recursion, we count from <code>0</code> to <code>n</code> as we did earlier, but now we sum numbers as we go, like in</p>\n\n<pre><code>(((1+2)+3)+4)+ ...\n</code></pre>\n\n<p>We can sum <code>1+2</code> before we count up to <code>3</code>. After that, we can keep only the result of the previous sum <code>1+2</code>, and discard the numbers <code>1</code> and <code>2</code> from memory. Hence, in the whole process we only keep in memory 1) the result of the sum of the numbers met so far, and 2) the next number in the sequence.</p>\n\n<p>Hence, we now require only O(1) memory and O(n) time.</p>\n\n<p>Note: since Haskell is lazy, the above argument holds only if the partial sum is actually forced at every recursion. This forcing might be silently added by the compiler optimizer, but it's a good idea to be explicit about it, e.g. in</p>\n\n<pre><code>sumdown n = sumd n 0\nsumd 0 !a = a\nsumd n !a = sumd (n-1) (n+a)\n-- here I am using the BangPatterns extension,\n-- otherwise, seq can be used instead\n</code></pre>\n\n<p>The second recursion is usually called \"accumulator-style\", which is a specific case of \"tail recursion\".</p>\n\n<p>(Note 2: tail recursion is not always a good idea in a lazy language like Haskell, but if the data passed around is simple, e.g. like numbers and not like lists, tail recursion is usually beneficial.)</p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1495841700, "post_id": 44204097, "comment_id": 75435099, "body": "I think your comment about \u201creusing the same stack\u201d is true but misleading\u2014it\u2019s not like in a strict language where the call is optimised into a jump, but rather, each recursive call only generates one frame on the <i>thunk</i> evaluation stack before returning, assuming the accumulator is strict. In pseudo-STG: <code>0 3 sumd force</code> \u2192 <code>3 2 sumd force</code> \u2192 <code>5 1 sumd force</code> \u2192 <code>6 0 sumd force</code> \u2192 <code>6</code>."}, {"owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1495879172, "post_id": 44204097, "comment_id": 75442073, "body": "@JonPurdy yes you are right. I didn&#39;t want to go in that detail. I fixed my wording :)"}], "tags": [], "owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "is_accepted": false, "score": 5, "last_activity_date": 1495879122, "last_edit_date": 1495879122, "creation_date": 1495808901, "answer_id": 44204097, "question_id": 44199761, "link": "https://stackoverflow.com/questions/44199761/why-are-parameter-based-definitions-more-efficient-than-recursion/44204097#44204097", "title": "Why are parameter based definitions more efficient than recursion?", "body": "<p>The second function is tail-recursive, the reason it performs better is clearly visible if you follow the reduction steps. (Although due to the lazy nature of Haskell, the following is not purely correct, but it gives an idea of how tail recursive functions can be more efficient.)</p>\n\n<pre><code>sumdown 3\n// 3 + sumdown 2\n// 3 + (2 + sumdown 1)\n// 3 + (2 + (1 + sumdown 0)\n// 3 + (2 + (1 + 0))\n// 3 + (2 + 1)\n// 3 + 3\n// 6\n\n\nsumdown 3 0\n// sumdown 2 3\n// sumdown 1 5\n// sumdown 0 6\n// 6\n</code></pre>\n\n<p>Additionally in most languages, the tail-recursive code is optimized to reuse the same stack (as it is the last operation of the recursive function).</p>\n"}], "owner": {"reputation": 37, "user_id": 7104069, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a02754f873e92142273b1dfee4fd6c5?s=128&d=identicon&r=PG&f=1", "display_name": "loxi95", "link": "https://stackoverflow.com/users/7104069/loxi95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 44200002, "answer_count": 2, "score": 2, "last_activity_date": 1495879122, "creation_date": 1495796044, "question_id": 44199761, "link": "https://stackoverflow.com/questions/44199761/why-are-parameter-based-definitions-more-efficient-than-recursion", "title": "Why are parameter based definitions more efficient than recursion?", "body": "<p>I have a recursive function sumdown :: Int -> Int that returns the sum of\nall natural numbers from its argument down to zero e.g. sumdown 3 should return the sum 3+2+1+0 = 6.</p>\n\n<pre><code>sumdown :: Int -&gt; Int\nsumdown 0 = 0\nsumdown x = x + sumdown(x-1)\n</code></pre>\n\n<p>I also have this definition which I dont fully understand, could someone please evaluate this for me and tell me why its potentially more efficient than the definition above? </p>\n\n<pre><code>sumdown n = sumd n 0\nsumd 0 a = a\nsumd n a = sumd (n-1) (n+a)\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1495795223, "post_id": 44199351, "comment_id": 75411728, "body": "I thing the problem is that <code>spaces</code> accepts not only space character but and tab, newline etc. That&#39;s why <code>atom</code> accept all string."}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1495795286, "post_id": 44199351, "comment_id": 75411770, "body": "Yes, it looks like that"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1495795549, "post_id": 44199351, "comment_id": 75411948, "body": "<code>spaces</code> designed by the <code>isSapace</code> function and it does that."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 0, "last_activity_date": 1495867783, "creation_date": 1495867783, "answer_id": 44213888, "question_id": 44199351, "link": "https://stackoverflow.com/questions/44199351/parsec-parse-string-sepby-endline/44213888#44213888", "title": "Parsec parse string `sepBy` endline", "body": "<p>As @freestyle said, <code>spaces</code> uses <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Char.html#v:isSpace\" rel=\"nofollow noreferrer\"><code>Data.Char.isSpace</code></a> to determine if a character should be consumed, and that includes both <code>\\n</code> and <code>\\r</code>.</p>\n\n<p>Use <code>oneOf \" \\t\"</code> instead of <code>spaces</code> and <code>endOfLine</code> instead of <code>newline</code>. Oh, and <code>optional</code> is extraneous in <code>optional spaces</code>, because <code>spaces</code> consume <em>zero or more</em> characters.</p>\n"}], "owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 44213888, "answer_count": 1, "score": 0, "last_activity_date": 1495867783, "creation_date": 1495794826, "question_id": 44199351, "link": "https://stackoverflow.com/questions/44199351/parsec-parse-string-sepby-endline", "title": "Parsec parse string `sepBy` endline", "body": "<p>I have faced with strange behavior of <code>parsec</code> in case of parsing simple strings</p>\n\n<p>The strings example is:</p>\n\n<pre><code>  1 C1           1.1650     2.7470    -0.1840 ca         1 MOL       0.408200\n  2 N1          -0.0550     2.1750    -0.0380 nb         1 MOL      -0.665000\n  3 C2          -0.2180     0.8450     0.1920 ca         1 MOL       0.450600\n  4 C3          -1.6310     0.3330     0.3310 c3         1 MOL      -0.140700\n</code></pre>\n\n<p>My parser is</p>\n\n<pre><code>atom = do\n    str &lt;- optional spaces *&gt; (many1 $ (letter &lt;|&gt; digit &lt;|&gt; oneOf \"-+.\")) `sepBy` spaces\n\n    let id = read $ head str :: Int\n    let charge = (read.head.reverse) str :: Double    \n    return (id,(str !! 1),charge)\n\nrecords = atom `sepEndBy1` newline  \n</code></pre>\n\n<p>I need to parse each string with <code>atom</code> parser. If I use only atom parser to a line it works. </p>\n\n<p>But if try to use <code>records</code> parser, it looks like the first atom parser eats the whole string. So I have <code>(1,C1,-0.140700)</code> instead of array <code>[(1,C1,-0.408200),(2,N1,0.665000)]</code> etc.</p>\n\n<p>P.S. I can't understand at all how <code>parsec</code>  can traverse a line with <code>\\n</code> symbols at all, in this case. For example if we have</p>\n\n<pre><code>onlyForTest = (many1 $ (letter &lt;|&gt; digit &lt;|&gt; oneOf \"-+.\")) `sepBy` spaces\n</code></pre>\n\n<p>and test such example:</p>\n\n<pre><code>*Main&gt; parseTest onlyForTest  \"bla bl\\na bla\"\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\"bla\",\"bl\",\"a\",\"bla\"]\n</code></pre>\n\n<p>But <code>\\n</code> symbol is not a separator in <code>sepBy</code>!</p>\n"}, {"tags": ["haskell", "widget", "newline", "yesod", "hamlet"], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1496026033, "post_id": 44233990, "comment_id": 75477721, "body": "Fun fact: the word &quot;Hamlet&quot; has lost all meaning to me while writing the above answer due to <a href=\"https://en.wikipedia.org/wiki/Semantic_satiation\" rel=\"nofollow noreferrer\">semantic satiation</a>..."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1496025993, "creation_date": 1496025993, "answer_id": 44233990, "question_id": 44197154, "link": "https://stackoverflow.com/questions/44197154/always-newline-never-in-yesod/44233990#44233990", "title": "Always `$newline never` in Yesod", "body": "<p>You could define your own Hamlet quasi-quoter that defaults to <code>NoNewlines</code> in its <code>HamletSettings</code>, like the following (untested) code snippet:</p>\n\n<pre><code>import Text.Hamlet\n\nmyHamlet :: QuasiQuoter\nmyHamlet = hamletWithSettings hamletRules defaultHamletSettings{ hamletNewlines = NoNewlines}\n</code></pre>\n\n<p>and then simply use it as <code>[myHamlet| ... |]</code>.</p>\n"}], "owner": {"reputation": 383, "user_id": 5181829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LQG85.jpg?s=128&g=1", "display_name": "Marronnier", "link": "https://stackoverflow.com/users/5181829/marronnier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1519576806, "creation_date": 1495787867, "last_edit_date": 1519576806, "question_id": 44197154, "link": "https://stackoverflow.com/questions/44197154/always-newline-never-in-yesod", "title": "Always `$newline never` in Yesod", "body": "<p><code>$newline never</code> in Hamlet allows us to minify the HTML code. If we set it in a parent widget, it takes effect on it but not on the child widgets. So we have to set <code>$newline never</code> to all of the widgets when we want to minify the whole code. This isn't good.</p>\n\n<p>Don't you know any better solutions? Thanks.</p>\n"}, {"tags": ["haskell", "reflex"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1495786741, "post_id": 44196562, "comment_id": 75406667, "body": "You&#39;ve got to get that <code>IO</code> to the outer layer of <code>Dynamic t (Maybe (IO Text))</code> so you can bind it.  <code>sequenceA</code> is the general way to commute an applicative outward, e.g. <code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)</code>, i.e. <code>sequenceA :: Maybe (IO a) -&gt; IO (Maybe a)</code>.  But that would require <code>Dynamic t</code> to be traversable, and I don&#39;t know if it is."}, {"owner": {"reputation": 13132, "user_id": 2168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5e7e68e1cdaea224d93da209afb28e9d?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/2168/john"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495839061, "post_id": 44196562, "comment_id": 75434533, "body": "sequenceA does get the IO to the outside (ie I end up with a <code>Dynamic t (IO (Maybe Text))</code>) but I&#39;m still unsure how turn that into a <code>Dynamic t (Maybe Text)</code> without <code>unsafePerformIO</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495843113, "post_id": 44196562, "comment_id": 75435364, "body": "Yeah, what is <code>Dynamic t</code>, what library are you working with?"}, {"owner": {"reputation": 13132, "user_id": 2168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5e7e68e1cdaea224d93da209afb28e9d?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/2168/john"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495858395, "post_id": 44196562, "comment_id": 75437757, "body": "Reflex/Reflex.Dom (as mentioned in the title)."}], "answers": [{"comments": [{"owner": {"reputation": 13132, "user_id": 2168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5e7e68e1cdaea224d93da209afb28e9d?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/2168/john"}, "edited": false, "score": 0, "creation_date": 1495839614, "post_id": 44197142, "comment_id": 75434662, "body": "Thanks, I&#39;m looking into <code>performEvent</code> now."}], "tags": [], "owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "is_accepted": true, "score": 4, "last_activity_date": 1495787838, "creation_date": 1495787838, "answer_id": 44197142, "question_id": 44196562, "link": "https://stackoverflow.com/questions/44196562/what-can-i-do-to-eliminate-the-unsafeperformio-in-this-reflex-dom-code/44197142#44197142", "title": "What can I do to eliminate the unsafePerformIO in this Reflex.Dom code?", "body": "<p>For things like this, you usually need <code>performEvent</code>. I don't have compiler/REPL at hand to provide more detail, and the function is sort-of hidden behind some typeclass hackery (<a href=\"https://github.com/reflex-frp/reflex/blob/9575a5660334fb8a617da1cd9aa1b522e8e4ddb7/src/Reflex/PerformEvent/Class.hs\" rel=\"nofollow noreferrer\">https://github.com/reflex-frp/reflex/blob/9575a5660334fb8a617da1cd9aa1b522e8e4ddb7/src/Reflex/PerformEvent/Class.hs</a>), but the gist of it is that if you have an event carrying <code>IO</code>, then you can run it wherever this event occurs.</p>\n\n<p>Now, you've got the <code>Dynamic</code>, but you can</p>\n\n<ul>\n<li>extract the event from it</li>\n<li>maybe it doesn't need to be Dynamic (it doesn't make sense, as you don't want to peek at the <code>IO</code> value)</li>\n</ul>\n"}], "owner": {"reputation": 13132, "user_id": 2168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5e7e68e1cdaea224d93da209afb28e9d?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/2168/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 44197142, "answer_count": 1, "score": 3, "last_activity_date": 1495787838, "creation_date": 1495785744, "question_id": 44196562, "link": "https://stackoverflow.com/questions/44196562/what-can-i-do-to-eliminate-the-unsafeperformio-in-this-reflex-dom-code", "title": "What can I do to eliminate the unsafePerformIO in this Reflex.Dom code?", "body": "<pre><code>main = mainWidget $\n  el \"div\" $ do\n    let fileInputConfig = FileInputConfig (constDyn Map.empty)\n    fi &lt;- fileInput fileInputConfig\n\n    let uploads   :: Dynamic t [File]            = value fi\n    upload        :: Dynamic t (Maybe File)      &lt;- (return . fmap headMay) uploads\n    getNameAction :: Dynamic t (Maybe (IO Text)) &lt;- (return . fmap (getNameText &lt;$&gt;)) upload\n    filename      :: Dynamic t (Maybe Text)      &lt;- (return . fmap (unsafePerformIO &lt;$&gt;)) getNameAction\n\n    el \"div\" $ dynText (show &lt;$&gt; filename)\n  return ()\n  where getNameText :: MonadIO m =&gt; File -&gt; m Text\n        getNameText = getName\n</code></pre>\n\n<p>I did my best to play connect-the-dots with the types but I couldn't find a path out without using <code>unsafePerformIO</code>.  I think it's safe in this case, but obviously there are other similar things you might want to do that would not be safe.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1495780309, "post_id": 44194943, "comment_id": 75403494, "body": "That\u2019s just <code>\\x -&gt; lookup x . map swap</code>, where <code>swap</code> is from <code>Data.Tuple</code>."}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 1606510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa28476ad9d46bbb1f2ac2fd7283f69?s=128&d=identicon&r=PG", "display_name": "Mekeor Melire", "link": "https://stackoverflow.com/users/1606510/mekeor-melire"}, "is_accepted": false, "score": 1, "last_activity_date": 1495810176, "creation_date": 1495810176, "answer_id": 44204498, "question_id": 44194943, "link": "https://stackoverflow.com/questions/44194943/is-there-a-standard-reverselookup-function/44204498#44204498", "title": "Is there a standard reverseLookup function?", "body": "<p>You could use the function <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html#v:find\" rel=\"nofollow noreferrer\"><code>find :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a</code></a> from the module Data.List from the base package. Unfortunately, I can't test the code right now but it could go like this:</p>\n\n<pre><code>sndLookup :: Eq b =&gt; b -&gt; [(a, b)] -&gt; Maybe a\nsndLookup query = fst &lt;$&gt; find (\\(_,b) -&gt; b == query)\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495810176, "creation_date": 1495779788, "question_id": 44194943, "link": "https://stackoverflow.com/questions/44194943/is-there-a-standard-reverselookup-function", "title": "Is there a standard reverseLookup function?", "body": "<p>I'm looking for something with the following function signature</p>\n\n<pre><code>Eq b =&gt; b -&gt; [(a, b)] -&gt; Maybe a\n</code></pre>\n"}, {"tags": ["haskell", "generics", "typeclass"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1495775565, "post_id": 44193630, "comment_id": 75401512, "body": "Why does it have to be an instance of <code>Show</code>? How about deriving the standard <code>Show</code>, and then composing <code>camelTo2 &#39;_&#39; . show</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495775771, "post_id": 44193630, "comment_id": 75401588, "body": "Clever! Let me try..."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495776517, "post_id": 44193630, "comment_id": 75401898, "body": "I redefined <code>ToJSON</code> via the standard <code>Show</code> instance and it works perfectly fine. <code>instance ToJSON TxnSource where toJSON = toJSON.(camelTo2 &#39;_&#39;).show</code> So, this technique can be used at other places as well. Any idea how to do this for <code>FromJSON</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495777342, "post_id": 44193630, "comment_id": 75402213, "body": "Taking the inverses I would look for something like <code>read . toCamel . fromJSON</code>, except the last bit is actually <code>parseJSON</code> and it is monadic: <code>instance FromJSON TxnSource where parseJSON = fmap (read . toCamel) . parseJSON</code>. You need to define <code>toCamel</code> doing the inverse of <code>camelTo2 &#39;_&#39;</code>. You probably want to use <code>readMaybe</code> too."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495777560, "post_id": 44193630, "comment_id": 75402313, "body": "That&#39;s exactly what I&#39;m wondering. How does <code>FromJSON</code> use the same <code>camelTo</code> function during parsing? Here&#39;s the <code>FromJSON</code> instance that does the camel&lt;&gt;Haskell conversion absolutely fine -- `  parseJSON = genericParseJSON $ (aesonPrefix snakeCase){constructorTagModifier=(camelTo2 &#39;_&#39;)}`"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495777727, "post_id": 44193630, "comment_id": 75402393, "body": "This is what I&#39;m trying to understand next -- <a href=\"https://github.com/bos/aeson/issues/549\" rel=\"nofollow noreferrer\">github.com/bos/aeson/issues/549</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1495777955, "post_id": 44194148, "comment_id": 75402500, "body": "I&#39;m trying to understand this code. Would it be possible to please add some comments to explain what is conceptually happening here?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496559761, "post_id": 44194148, "comment_id": 75705272, "body": "May I trouble you for the reverse, i.e. given a text/string, how to get a constructor name and value from it?"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1495799598, "last_edit_date": 1495799598, "creation_date": 1495776054, "answer_id": 44194148, "question_id": 44193630, "link": "https://stackoverflow.com/questions/44193630/how-to-customise-show-read-instances-on-the-lines-of-fromjson-tojson/44194148#44194148", "title": "How to customise Show/Read instances on the lines of FromJSON/ToJSON", "body": "<p>I assumed there was a reason it had to be an instance of <code>Show</code>, otherwise <code>camelTo2 '_' . show</code> seems to do the job.</p>\n\n<p>In any case, here's how you can get the constructor name with <code>GHC.Generics</code>. Then you can write <code>camelTo2 '_' . constructorName</code> with no additional setup required; in particular, you are free to use this as an implementation of <code>show</code>.</p>\n\n<pre><code>import GHC.Generics\n\n-- Constructor name of the value of an ADT.\n-- Using 'Generic.from', we map it to a generic representation.\nconstructorName :: (Generic a, CName (Rep a)) =&gt; a -&gt; String\nconstructorName = cname . from\n\n-- Class of generic representations of ADTs, built using\n-- types in GHC.Generics.\n-- 'cname' extracts the constructor name from it.\nclass CName f where\n  cname :: f p -&gt; String\n\n-- M1 is a newtype to attach metadata about the type\n-- being represented at the type level.\n-- The first parameter marks the kind of the data\n-- in the second one. 'D' indicates general information\n-- like the type name and whether it is a newtype.\n-- Here we ignore it and look in the rest of the representation.\ninstance CName f =&gt; CName (M1 D c f) where\n  cname (M1 f) = cname f\n\n-- '(:+:)' represents sums.\ninstance (CName f, CName g) =&gt; CName (f :+: g) where\n  cname (L1 f) = cname f\n  cname (R1 g) = cname g\n\n-- 'M1' again, but 'C' indicates information about a specific\n-- constructor, we extract it using the 'GHC.Generics.Constructor'\n-- type class.\ninstance Constructor c =&gt; CName (M1 C c f) where\n  cname = conName\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496323768, "post_id": 44195842, "comment_id": 75623057, "body": "This is a gem of an answer. I&#39;m going through <a href=\"https://www.youtube.com/watch?v=sQxH349HOik\" rel=\"nofollow noreferrer\">youtube.com/watch?v=sQxH349HOik</a> to be able to understand and completely internalise Generics SOP. Is it alright if I ask follow-up questions via these comments?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496323795, "post_id": 44195842, "comment_id": 75623076, "body": "First question -- what&#39;s with <code>@Foo</code> syntax. It&#39;s the first time I&#39;m seeing this."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496323882, "post_id": 44195842, "comment_id": 75623145, "body": "In the video, most examples deal with the <code>I</code> constructor. What is the <code>K</code> constructor for? What others are there and is there a document describing the differences?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 1, "creation_date": 1496339275, "post_id": 44195842, "comment_id": 75633617, "body": "The <code>@Foo</code> syntax is a type application, available since GHC 8. If you have any polymorphic function, you can use <code>@&lt;sometype&gt;</code> to instantiate it. So, for example <code>id @Char :: Char -&gt; Char</code>. In practice, this can often be used in situation where you would otherwise need extra type annotations or even proxies in order to help the GHC type checker."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496339416, "post_id": 44195842, "comment_id": 75633704, "body": "The <code>I</code> constructor is identity, defined <code>newtype I a = I a</code>. The <code>K</code> constructor is for &quot;constant, define <code>newtype K c a = K c</code>. In practice, if you parameterize one of the <code>NP</code>-like structures by <code>I</code>, you get a heterogeneous structure, containing in every position what the index list indicates. If you instantiate it to <code>K Something</code>, you get a homogeneous structure containing a <code>Something</code> in every position."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496339549, "post_id": 44195842, "comment_id": 75633778, "body": "If you want more material on generics-sop, there&#39;s another (slightly more application-oriented) talk here: <a href=\"https://skillsmatter.com/skillscasts/10181-fun-with-sum-and-product-types\" rel=\"nofollow noreferrer\">skillsmatter.com/skillscasts/&hellip;</a> There&#39;s also a longer document explaining a lot of type-level background here: <a href=\"https://github.com/kosmikus/SSGEP\" rel=\"nofollow noreferrer\">github.com/kosmikus/SSGEP</a>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496410861, "post_id": 44195842, "comment_id": 75664779, "body": "Quick question -- will all of this infra work with types/constructors will 32 fields or less? I just did a <code>:i Code</code> and saw that the instances go only up to 32-tuples. We have records (representing DB tables) that have more than 40 fields."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496412501, "post_id": 44195842, "comment_id": 75665805, "body": "I&#39;m royally confused about why the result type of <code>conNames</code> would be an NP (<i>product</i>) and not NS (<i>sum</i>). It&#39;s deal with the various constructors of a sum-type -- shouldn&#39;t the resultant <i>thing</i> be a sum, and not a product? Also, if in <code>conNames</code> I change <code>K</code> to <code>I</code>, why doesn&#39;t it work?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496438089, "post_id": 44195842, "comment_id": 75678988, "body": "There&#39;s an (arbitrary) limit for actual tuples, so if you&#39;re using tuples with more than 32 components, extra instances would have to be added. But if an enumeration type has more than 32 components, or a constructor has more than 32 arguments, then deriving an SOP <code>Generic</code> instance should still work."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496438188, "post_id": 44195842, "comment_id": 75679021, "body": "An <code>NP</code> is a generalization of a tuple, and contains a combination of several things. An <code>NS</code> is a generalization of <code>Either</code>, and embodies a choice of one of several things. A function returning <i>all</i> constructor names of a datatype returns a combination of several things, hence a product and not a sum."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496438272, "post_id": 44195842, "comment_id": 75679055, "body": "The choice between <code>K</code> or <code>I</code> isn&#39;t arbitrary. The <code>conNames</code> function returns all the constructor names, which are all <code>String</code>s, regardless of the composition and types occurring in the datatype definition. Hence <code>K</code>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496487446, "post_id": 44195842, "comment_id": 75689225, "body": "I tried understanding what&#39;s going on with <code>hzipWith</code> by passing this as the first argument <code>\\a b -&gt; trace (show a) a</code> and was surprised to find that the function is being called only once, irrespective of the number of elements in the SOP structure. Eg, it&#39;s called only once even if the structure is <code>SOP S (S (S (Z Nil)))</code>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496487624, "post_id": 44195842, "comment_id": 75689274, "body": "Shouldn&#39;t a heterogenous list be a superset of a homogenous list? i.e. if <code>K</code> is acceptable in <code>conNames</code>, why is <code>I</code> not compiling?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496511899, "post_id": 44195842, "comment_id": 75696403, "body": "If you zip an <code>NP</code> with an <code>NS</code>, then the function is only called once, because the <code>NS</code> contains only a single element which is combined with the corresponding element from the product. If you zip two <code>NP</code>s, the combining function will be called once per pair of elements, more like you might be used to from <code>zipWith</code>."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496512092, "post_id": 44195842, "comment_id": 75696463, "body": "No, a heterogeneous list is not a superset of a homogeneous list. Let&#39;s look at an example: An <code>NP I [Int, Char, Bool]</code> contains three elements, an <code>I Int</code>, an <code>I Char</code> and an <code>I Bool</code>. This is isomorphic to a list containing just an <code>Int</code>, a <code>Char</code>, and a <code>Bool</code>. On the other hand, an <code>NP (K String) [Int, Char, Bool]</code> contains three elements, a <code>K String Int</code>, a <code>K String Char</code>, and a <code>K String Bool</code>. This is isomorphic to a list containing three <code>String</code>s."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 2, "last_activity_date": 1495820728, "last_edit_date": 1495820728, "creation_date": 1495783176, "answer_id": 44195842, "question_id": 44193630, "link": "https://stackoverflow.com/questions/44193630/how-to-customise-show-read-instances-on-the-lines-of-fromjson-tojson/44195842#44195842", "title": "How to customise Show/Read instances on the lines of FromJSON/ToJSON", "body": "<p>(I've edited my answer to have significantly more explanations. If you just want a module containing the code, it's <a href=\"https://gist.github.com/kosmikus/f00cecac50a8e240c7fd8ef764b8c69e\" rel=\"nofollow noreferrer\">still available</a>.</p>\n\n<p>The question aims at changing the default <code>Show</code> and <code>Read</code> instances for\nenumeration types such as <code>OrderType</code> and providing custom ones. I'll show\nbelow how that can be done, although in principle I advise against doing so,\nbecause <code>Show</code> and <code>Read</code> are typically supposed to produce Haskell\nrepresentations of the values. I'll also suggest a different solution,\nhowever, by going via new type classes.</p>\n\n<p>My solution is similar to the one proposed by Li-yao Xia, but based on <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a> rather than built-in GHC generics.</p>\n\n<p>We are using the following module header.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule CustomShowEnum where\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport Data.Maybe\nimport Generics.SOP\nimport Generics.SOP.NS\nimport Generics.SOP.TH\nimport Text.Read\n</code></pre>\n\n<p>Let's start with a function that computes a product (a list\nwith a statically known number of elementS) of all the\nconstructor names.</p>\n\n<pre><code>conNames ::\n  forall a proxy .\n  (Generic a, HasDatatypeInfo a)\n  =&gt; proxy a -&gt; NP (K String) (Code a)\nconNames _ =\n  hmap\n    (K . constructorName)\n    (constructorInfo (datatypeInfo (Proxy @a)))\n</code></pre>\n\n<p>The <code>datatypeInfo</code> function provides all meta-information\nabout a given datatype, the <code>constructorInfo</code> function extracts\nfrom that a product with meta-information about each\nconstructor. We are only interested in the names, nothing else,\nso we use <code>hmap</code> over the product to extract the constructor\nnames in each position.</p>\n\n<p>Let's see how we can use it:</p>\n\n<pre><code>GHCi&gt; conNames (Proxy @Bool)\nK \"False\" :* (K \"True\" :* Nil)\n</code></pre>\n\n<p>Read <code>Nil</code> as the empty product, and <code>:*</code> as \"cons\". Each element\nis wrapped in a <code>K</code> constructor, because it is a product containing\na (constant) String for every constructor of the datatype.</p>\n\n<p>The same works on other datatypes:</p>\n\n<pre><code>GHCi&gt; conNames (Proxy @Ordering)\nK \"LT\" :* (K \"EQ\" :* (K \"GT\" :* Nil))\nGHCi&gt; conNames (Proxy @(Maybe ()))\nK \"Nothing\" :* (K \"Just\" :* Nil)\n</code></pre>\n\n<p>We can also make it work on the <code>OrderType</code> mentioned in the question:</p>\n\n<pre><code>data OrderType = Confirmed | AwaitingShipping | Shipped\n</code></pre>\n\n<p>But if we try this blindly, then we get an error that we have no\ninstances for the <code>Generic</code> and <code>HasDatatypeInfo</code> classes. For\ngenerics-sop functions to work, types must be an instance of these\nclasses. One way to achieve this is to use Template Haskell:</p>\n\n<pre><code>deriveGeneric ''OrderType\n</code></pre>\n\n<p>(Another way for people who dislike Template Haskell is mentioned in\nthe library documentation.)</p>\n\n<p>Now, we can use <code>conNames</code>:</p>\n\n<pre><code>GHCi&gt; conNames (Proxy @OrderType)\nK \"Confirmed\" :* (K \"AwaitingShipping\" :* (K \"Shipped\" :* Nil))\n</code></pre>\n\n<p>A variant of this is a function that takes a specific value, and computes\nthe outermost constructor that built that value.</p>\n\n<pre><code>conName ::\n  forall a .\n  (Generic a, HasDatatypeInfo a)\n  =&gt; a -&gt; String\nconName x =\n  hcollapse\n    (hzipWith\n      const\n      (conNames (Proxy @a))\n      (unSOP (from x))\n    )\n</code></pre>\n\n<p>Here, we use <code>from</code> to compute the generic representation of the given\nvalue, which is a sum of products. The sum encodes a choice between one\nof the constructors of the datatype. We can use <code>hzipWith</code> to combine a\ncompatible product (a product of n values) and sum (a choice of option\ni out of n possible options), and it will select the i'th position of\nthe product and combine the two. By using <code>const</code> to combine the two,\nthe effect is that we'll just return the constructor name corresponding\nto the given constructor from our <code>conNames</code> product. The <code>hcollapse</code>\napplication in the end extracts the single <code>String</code> value.</p>\n\n<p>Let's look at a number of examples again:</p>\n\n<pre><code>GHCi&gt; conName Confirmed\n\"Confirmed\"\nGHCi&gt; conName (Just 3)\n\"Just\"\nGHCi&gt; conName [1,2,3]\n\":\"\n</code></pre>\n\n<p>Note that in the last example, the list is, on the top-level, just an\napplication of cons.</p>\n\n<p>Next, we define a function <code>enum</code> that computes a product of all\nthe values of an enumeration type. This is similar to <code>conNames</code>,\nbut rather than returning the constructor names (as strings), we\nreturn the actual constructors.</p>\n\n<pre><code>enum ::\n  forall a .\n  (Generic a, HasDatatypeInfo a, All ((~) '[]) (Code a))\n  =&gt; NP (K a) (Code a)\nenum =\n  hmap\n    (mapKK to)\n    (apInjs'_POP (POP (hcpure (Proxy @((~) '[])) Nil)))\n</code></pre>\n\n<p>The <code>apInks'_POP</code> function produces a product of all the constructor\nfunctions in their generic representation. These still have to be\napplied to a representation of their arguments, and we need to provide\nthese arguments as a product of products (a two-dimensional table\nwith one row per constructor, each row containing the arguments\nto be applied to that particular constructors).</p>\n\n<p>Fortunately, we restrict ourselves to enumeration types here. These\nare types without any constructor arguments. This is expressed\nby the constraint <code>All ((~) '[]) (Code a)</code>. The code of a type is\na list of list of types. The outer list contains an entry per\nconstructor, the inner lists give the types of the constructor\narguments. The constraint states that each of the inner lists must\nbe empty, which is equivalent to each of the constructors having\nno arguments.</p>\n\n<p>We can therefore produce a product of empty argument lists,\nwhich is what we do via <code>POP (hcpure (Proxy (@((~) '[])) Nil))</code>.</p>\n\n<p>Finally, we use <code>hmap</code> with <code>to</code> to turn each of the constructed\nvalues back from their generic representation into their original\nshape.</p>\n\n<p>Let's look at examples:</p>\n\n<pre><code>GHCi&gt; enum @Bool\nK False :* (K True :* Nil)\n</code></pre>\n\n<p>Compare this again with</p>\n\n<pre><code>GHCi&gt; conNames (Proxy @Bool)\nK \"False\" :* (K \"True\" :* Nil)\n</code></pre>\n\n<p>and note that in one case, we return strings, in the other, we\nreturn actual values.</p>\n\n<pre><code>GHCi&gt; enum @Ordering\nK LT :* (K EQ :* (K GT :* Nil))\n</code></pre>\n\n<p>If we try to apply <code>enum</code> to a type that is not an enumeration\ntype, we get a type error.</p>\n\n<p>If we try to apply <code>enum</code> to <code>OrderType</code>, we get an error that a\n<code>Show</code> instance for <code>OrderType</code> is lacking.</p>\n\n<p>If we derive one via</p>\n\n<pre><code>deriving instance Show OrderType\n</code></pre>\n\n<p>we obtain:</p>\n\n<pre><code>GHCi&gt; enum @OrderType\nK Confirmed :* (K AwaitingShipping :* (K Shipped :* Nil))\n</code></pre>\n\n<p>If we use the custom <code>Show</code> instance that was desired in the\nquestion and that I show how to define below, we instead get</p>\n\n<pre><code>GHCi&gt; enum @OrderType\nK confirmed :* K awaiting_shipping :* K shipped :* Nil\n</code></pre>\n\n<p>This also demonstrates why it might not be such a good idea\nto change the instance, because we now see that the output of\n<code>show</code> used by GHCi to print back the result mixes standard\nHaskell notation with special notation intended to be used\nin a particular domain.</p>\n\n<p>Before we go there, however, let's first implement one final\nutility function that we'll need for the parsing direction:</p>\n\n<pre><code>conTable ::\n  forall a .\n  (Generic a, HasDatatypeInfo a, All ((~) '[]) (Code a))\n  =&gt; [(String, a)]\nconTable =\n  hcollapse\n    (hzipWith\n      (mapKKK (,))\n      (conNames (Proxy @a))\n      enum\n    )\n</code></pre>\n\n<p>The <code>conTable</code> function computes a lookup table associating\nthe string constructor names with the actual values. We have\nthe functions to compute the two products, <code>conNames</code> and\n<code>enum</code>. We use <code>hzipWith</code> with <code>(,)</code> to pair them. The result\nis another product, but because the product contains the same\ntype in every position, we can use <code>hcollapse</code> to turn it into\na normal Haskell list.</p>\n\n<pre><code>GHCi&gt; conTable @Bool\n[(\"False\", False), (\"True\", True)]\nGHCi&gt; conTable @Ordering\n[(\"LT\", LT), (\"EQ\", EQ), (\"GT\", GT)]\nGHCi&gt; conTable @OrderType\n[(\"Confirmed\", Confirmed), (\"AwaitingShipping\", AwaitingShipping), (\"Shipped\", Shipped)]\n</code></pre>\n\n<p>The final example is using the default / derived <code>Show</code> instance.</p>\n\n<p>With these ingredients in place, we are now able to implement\ncustom <code>show</code> and <code>read</code> replacements for enumeration types.\nThe <code>show</code> direction quite easy:</p>\n\n<pre><code>customShowEnum ::\n  forall a .\n  (Generic a, HasDatatypeInfo a, All ((~) '[]) (Code a))\n  =&gt; (String -&gt; String)\n  -&gt; a -&gt; String\ncustomShowEnum f = f . conName\n</code></pre>\n\n<p>Given a value, we use <code>conName</code> to determine its constructor and\nthen apply the given conversion function to the result.</p>\n\n<p>This function would work for all types in <code>Generic</code> and\n<code>HasDatatypeInfo</code>, so the <code>All ((~) '[]) (Code a)</code> constraint\nthat restricts it to enumeration types is optional.</p>\n\n<p>Here are a few examples:</p>\n\n<pre><code>GHCi&gt; customShowEnum id AwaitingShipping\n\"AwaitingShipping\"\nGHCi&gt; customShowEnum reverse Confirmed\n\"demrifnoC\"\nGHCi&gt; customShowEnum (camelTo2 '_') AwaitingShipping\n\"awaiting_shipping\"\n</code></pre>\n\n<p>For the <code>read</code> replacement, we implement a function that can\nbe used to defined the <code>readPrec</code> method of the <code>Read</code> class.\nThis produces a parser of type <code>ReadPrec a</code>:</p>\n\n<pre><code>readPrec :: Read a =&gt; ReadPrec a\n</code></pre>\n\n<p>The basic strategy is as follows: We start from the lookup table\ngiven by <code>conTable</code>. We adjust the strings in this lookup table\nusing the same conversion function that we also used in\n<code>customShowEnum</code>. Given an input string, we then try to find\nit in the adjusted lookup table, and if we find it, we return\nthe associated value. The code looks as follows:</p>\n\n<pre><code>customReadEnum ::\n  forall a .\n  (Generic a, HasDatatypeInfo a, All ((~) '[]) (Code a))\n  =&gt; (String -&gt; String)\n  -&gt; ReadPrec a\ncustomReadEnum f =\n  let\n    adjustedTable :: [(Lexeme, a)]\n    adjustedTable = map (\\ (n, x) -&gt; (Ident (f n), x)) conTable\n  in\n    parens $ do\n      n &lt;- lexP\n      maybe pfail return (lookup n adjustedTable)\n</code></pre>\n\n<p>This essentially follows the description above: <code>parens</code>\nadditionally allows the constructor name to be wrapped in\nparentheses, as is generally allowed by <code>read</code>, and the use\nof <code>lexP</code> additionally handles whitespace. If the <code>lookup</code>\nin the table fails, we let the parser fail using <code>pfail</code>.</p>\n\n<p>If we want to try this, we have to run the <code>ReadPrec</code> parser\nby applying <code>readPrec_to_S</code>, which then expects a precedence\nlevel (irrelevant in this case) and an input string and returns\na list of pairs containing pairs of possible parses and remaining\nstrings:</p>\n\n<pre><code>GHCi&gt; readPrec_to_S (customReadEnum @OrderType id) 0 \"AwaitingShipping\"\n[(AwaitingShipping, \"\")]\nGHCi&gt; readPrec_to_S (customReadEnum @OrderType (camelTo2 '_')) 0 \"AwaitingShipping\"\n[]\nGHCi&gt; readPrec_to_S (customReadEnum @OrderType (camelTo2 '_')) 0 \"awaiting_shipping\"\n[(AwaitingShipping, \"\")]\n&gt;&gt;&gt; readPrec_to_S (customReadEnum @OrderType (camelTo2 '_')) 0 \"   ( awaiting_shipping)  \"\n[(AwaitingShipping, \"  \")]\n</code></pre>\n\n<p>If we now wanted to use <code>customReadShow</code> and <code>customReadEnum</code> to\ndefine the <code>Show</code> and <code>Read</code> instance for <code>OrderType</code>, we could do\nthis simply as follows:</p>\n\n<pre><code>instance Show OrderType where\n  show = customShowEnum (camelTo2 '_')\n\ninstance Read OrderType where\n  readPrec = customReadEnum (camelTo2 '_')\n</code></pre>\n\n<p>However, as I said above, I'd advise to just use the derived instances\nhere to avoid confusion, and for the domain-specific textual representation,\nI would just introduce new classes, for example:</p>\n\n<pre><code>class ToString a where\n  toString :: a -&gt; String\n\nclass FromString a where\n  fromString :: String -&gt; Maybe a\n\ninstance ToString OrderType where\n  toString = customShowEnum (camelTo2 '_')\n\ncustomFromString ::\n  forall a .\n  (Generic a, HasDatatypeInfo a, All ((~) '[]) (Code a))\n  =&gt; (String -&gt; String)\n  -&gt; String -&gt; Maybe a\ncustomFromString f x =\n  case readPrec_to_S (customReadEnum f) 0 x of\n    [(r, \"\")] -&gt; Just r\n    _         -&gt; Nothing\n\ninstance FromString OrderType where\n  fromString = customFromString (camelTo2 '_')\n</code></pre>\n\n<p>We could also go a few steps further:</p>\n\n<ul>\n<li><p>We could use default signatures that map <code>toString</code> and <code>fromString</code> either\nto the default <code>Show</code> / <code>Read</code> behaviour, or to our custom behaviour, so that\nwe can provide empty instances or using deriving in the more common of the\ntwo cases.</p></li>\n<li><p>We could use a third class to associate a particular conversion function with\na given type and use this class in our generic definitions, to make it more\nobvious that the same function is used for both directions and thereby remove\na source of potential errors.</p></li>\n</ul>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1495820728, "creation_date": 1495772889, "question_id": 44193630, "link": "https://stackoverflow.com/questions/44193630/how-to-customise-show-read-instances-on-the-lines-of-fromjson-tojson", "title": "How to customise Show/Read instances on the lines of FromJSON/ToJSON", "body": "<p>I have the following sum type</p>\n\n<pre><code>import Data.Aeson\nimport Data.Aeson.Casing\nimport GHC.Generics\n\ndata OrderType = Confirmed | AwaitingShipping | Shipped\n  deriving (Eq, Generic)\n\ninstance ToJSON OrderType where\n  toJSON = genericToJSON $ (aesonPrefix snakeCase){constructorTagModifier=(camelTo2 '_')}\n</code></pre>\n\n<p>This results in the following conversion during JSON encoding:</p>\n\n<pre><code>Confirmed =&gt; confirmed\nAwaitingShipping =&gt; awaiting_shipping\nShipped =&gt; shipped\n</code></pre>\n\n<p>How do I quickly generate a <code>Show</code> instance that has the exact same <code>OrderType</code> => <code>String</code> conversion?</p>\n\n<p>Please note, I know I can do the following, but I'm looking for a way to avoid this boilerplate.</p>\n\n<pre><code>instance Show OrderType where\n  show Confirmed = \"confirmed\"\n  show AwaitingShipping = \"awaiting_shipping\"\n  show Shipped = \"shipped\"\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "state-monad"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1495775049, "post_id": 44193347, "comment_id": 75401377, "body": "What is the start state? What should happen when the list is empty? Is your <code>Creature</code> a <code>Monoid</code>?"}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1495776482, "post_id": 44193347, "comment_id": 75401882, "body": "I&#39;ve edited my question and added an example of a beginning and end state along with some more types for clarification.  This is a simplified version of my creature and the real thing is not a monoid.  If the list is empty I guess I would expect back the original creature."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1495777432, "post_id": 44193347, "comment_id": 75402250, "body": "The problem I saw is that your proposed <code>applyChanges</code> function does not accept a creature in its original state"}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1495777602, "post_id": 44193347, "comment_id": 75402339, "body": "Edited.  I&#39;m open to any changes to the above.  My overall goal is to get a creature through each of the state actions in that list."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 6, "creation_date": 1495780802, "post_id": 44193347, "comment_id": 75403715, "body": "Why are these in State at all, if the state is required to always be &quot;the original input&quot;? It seems each change should just be <code>Creature -&gt; Creature</code>, and then your function <code>applyChanges :: [Creature -&gt; Creature] -&gt; Creature -&gt; Creature</code> is very easy to implement: <code>applyChanges = foldr (.) id</code>"}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1495809644, "post_id": 44193347, "comment_id": 75421204, "body": "Ahh, I believe you&#39;re right.  I jumped the gun with unneeded complexity here, and probably misused the state monad as well.  If you want, add an answer and I&#39;ll mark it as such."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1495823631, "post_id": 44193347, "comment_id": 75428746, "body": "Using <code>State</code> may be premature in some sense, but I&#39;d do it anyway, because I can immediately think of reasons you&#39;d want to. 1. If you want to get not only the final state but a list of intermediate states as well. You could do this with <code>scanl</code>, but if you start with <code>State</code> it&#39;s really natural. 2. You want to add some other effects. If you start with <code>State</code>, you need only switch to <code>StateT</code> on the relevant underlying action type."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1495823857, "post_id": 44193347, "comment_id": 75428853, "body": "@dfeuer In that case you&#39;d want <code>State Creature a</code>, where the state value is what you actually want as a result (via execState), and not the monadic value you&#39;d get from evalState, right? That certainly makes some sense to me, but <code>State Creature Creature</code> seems too specific, requiring each transformation to end with <code>get</code> to move the <code>Creature</code> state into the monadic value. <code>State Creature ()</code> looks more reasonable, as a target for composing a list of stateful transformations."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1495824071, "post_id": 44193347, "comment_id": 75428949, "body": "@amalloy, yes, <code>State Creature ()</code> is probably the right place to start."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1495825731, "post_id": 44193347, "comment_id": 75429726, "body": "@defeuer I&#39;ve thought about that too and I&#39;m keeping it in the back of my mind.  It&#39;s something I want to do eventually, but this works for now.  When that time comes I think converting from a function to State will be an easy change, except for the fold part, which im still a bit hazy on."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1495830756, "post_id": 44193347, "comment_id": 75431952, "body": "@NickAcosta, the folds to look at here (in <code>Data.Foldable</code>) are <code>traverse_</code> and (less generally) <code>sequenceA_</code>. You well soon find yourself interested in the traversals <code>traverse</code> and <code>sequenceA</code>."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1495832899, "post_id": 44193347, "comment_id": 75432767, "body": "Thanks I will check those out."}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 3991367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/733f070f5b5477eb23023272167640c3?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Ambrogio", "link": "https://stackoverflow.com/users/3991367/dan-ambrogio"}, "edited": false, "score": 1, "creation_date": 1495821095, "post_id": 44205278, "comment_id": 75427474, "body": "I&#39;m new to haskell and having difficulty visualizing how this would work in practice. If we had a StatModifer that added 2 to a stat, and a function that applied this modifier to all stats, what would the implementation look like?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 346, "user_id": 3991367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/733f070f5b5477eb23023272167640c3?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Ambrogio", "link": "https://stackoverflow.com/users/3991367/dan-ambrogio"}, "edited": false, "score": 2, "creation_date": 1495855473, "post_id": 44205278, "comment_id": 75437278, "body": "@DanAmbrogio: If I understand your question, you would have <code>addMod :: StatModifier -&gt; Stat a -&gt; Stat a; addMod m (Stat ms a) = Stat (m : ms) a</code> to add a modifier to a stat, and helpers like <code>modAll :: StatModifier -&gt; Creature -&gt; Creature; modAll m c = c { strength = addMod m (strength c), \u2026 }</code>, for example, to modify all stats. You would then make <code>Creature -&gt; Creature</code> functions like <code>enhanceAll = modAll (StatModifier Enhancement 2)</code> and compose them or use them as <code>State</code> actions. <code>foldr (.) id [f, g, h] x</code> is the same as <code>f (g (h (id x)))</code>: it applies each function from right to left."}, {"owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "edited": false, "score": 0, "creation_date": 1495912555, "post_id": 44205278, "comment_id": 75451965, "body": "Might be worth it&#39;s own SO question.  It would certainly be more readable in an answer."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 4, "last_activity_date": 1495812749, "creation_date": 1495812749, "answer_id": 44205278, "question_id": 44193347, "link": "https://stackoverflow.com/questions/44193347/haskell-how-would-i-run-a-list-of-state-monads/44205278#44205278", "title": "Haskell - How would I run a list of state monads?", "body": "<p><code>State Creature Creature</code> is the wrong type for this kind of computation. As you saw, you can get away with it, but it complicates things unnecessarily, because you don't actually care about the state variable at all! You simply use it to store the function's original input...but then throw it away in <code>applyChanges</code>.</p>\n\n<p>A type that would be much easier to work with is <code>Creature -&gt; Creature</code>, and then if you have a list of such functions to apply you simply want to compose them all, which you can do with a fold:</p>\n\n<pre><code>applyChanges :: [Creature -&gt; Creature] -&gt; Creature -&gt; Creature\napplyChanges = foldr (.) id\n</code></pre>\n"}], "owner": {"reputation": 1825, "user_id": 5156709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08c6c567409fda82303b32a475c255cf?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Acosta", "link": "https://stackoverflow.com/users/5156709/nick-acosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 0, "accepted_answer_id": 44205278, "answer_count": 1, "score": 4, "last_activity_date": 1495812749, "creation_date": 1495771114, "last_edit_date": 1495777511, "question_id": 44193347, "link": "https://stackoverflow.com/questions/44193347/haskell-how-would-i-run-a-list-of-state-monads", "title": "Haskell - How would I run a list of state monads?", "body": "<p>I'm somewhat new to Haskell and I'm having some trouble with the State monad.</p>\n\n<p>I have created the following types.\n<code>Stat a</code> has a monoid, functor, applicative and monad instance created for it.</p>\n\n<p>The \"main\" type in my program is creature and it has many arguments:</p>\n\n<pre><code>data Creature = Creature {\n    strength  :: Stat Integer,\n    dexterity :: Stat Integer,\n    ...\n}\n\ndata Stat a = Stat {\n    modifiers :: [StatModifier],\n    stat      :: a\n}\n\ndata StatModifier = StatModifier {\n    modifierType :: ModifierType,\n    value        :: Integer\n}\n\ndata ModifierType = \n  Enhancement\n  | Morale\n  | ...\n</code></pre>\n\n<p>There are many things that can happen to a creature.  I chose to represent those things with the state monad:</p>\n\n<pre><code>anyPossibleChange :: State Creature Creature\n</code></pre>\n\n<p>This could be damage being done to the creature, an increase to the creature's strength, basically anything.  The possibility of anything made me think the State monad was a good choice here.  I will accept a creature in it's original state, perform some modification, and return the original state and the new state in a tuple.</p>\n\n<p>An original state might be:</p>\n\n<pre><code>Creature {\n    strength = Stat [] 10,\n    dexterity = Stat [] 10\n}\n</code></pre>\n\n<p>An end state might be:</p>\n\n<pre><code>Creature {\n    strength = Stat [StatModifier Enhancement 2] 10,\n    dexterity = Stat [StatModifier Enhancement 4, StatModifier Morale 2] 10\n}\n</code></pre>\n\n<p>I would like to build a list of all the changes a creature needs to go through and then run the creature through all of those changes.</p>\n\n<p>This is the signature I had in mind, but I am having trouble coming up with an implementation.  I am open to it being different.</p>\n\n<pre><code>applyChanges :: Creature -&gt; [State Creature Creature] -&gt;  Creature\n</code></pre>\n\n<p>I feel like I should be able to do this with a fold, possibly <code>FoldM</code> but my brain is getting hung up around the types.  </p>\n\n<p>What would a good implementation be?</p>\n"}, {"tags": ["haskell", "applicative", "higher-order-types"], "answers": [{"comments": [{"owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "edited": false, "score": 0, "creation_date": 1495763294, "post_id": 44191334, "comment_id": 75398610, "body": "For an example of a language which does this, Agda has type-level (and kind-level, etc.) functions."}, {"owner": {"reputation": 14867, "user_id": 517371, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0owFn.jpg?s=128&g=1", "display_name": "Tobia", "link": "https://stackoverflow.com/users/517371/tobia"}, "edited": false, "score": 0, "creation_date": 1495796356, "post_id": 44191334, "comment_id": 75412404, "body": "Thank you. It&#39;s all very clear now. Using Compose I was able to combine binary functions using Functor and Applicative: <code>getCompose ((,) &lt;$&gt; Compose (+) &lt;*&gt; Compose (-)) 7 2</code> = <code>(9,5)</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1495755280, "creation_date": 1495755280, "answer_id": 44191334, "question_id": 44191123, "link": "https://stackoverflow.com/questions/44191123/can-i-write-a-higher-order-type-for-a-b/44191334#44191334", "title": "Can I write a higher order type for a -&gt; b -&gt; *?", "body": "<p>No, you can't. You could imagine many language features to support this; e.g. type-level lambdas would be a natural one:</p>\n\n<pre><code>instance Functor (\\c. a -&gt; b -&gt; c) where ...\n</code></pre>\n\n<p>Unfortunately, type-level lambdas would mean we have to move from first-order unification to higher-order unification during type inference, which is notably difficult. (I want to say undecidable off the top of my head, but I'm not certain of this.)</p>\n\n<p>You can get halfway there if you insert an explicit type-checking hint by way of a <code>newtype</code> wrapper. The standard one is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Compose.html#t:Compose\" rel=\"noreferrer\"><code>Compose</code></a>:</p>\n\n<pre><code>a -&gt; b -&gt; c ~= Compose (a -&gt;) (b -&gt;) c\n\\c. a -&gt; b -&gt; c ~= Compose (a -&gt;) (b -&gt;)\n</code></pre>\n\n<p>And, indeed, the <code>Functor</code> and <code>Applicative</code> instances for <code>Compose (a -&gt;) (b -&gt;)</code> are exactly the ones you would expect for <code>\\c. a -&gt; b -&gt; c</code>, at the cost of a bit of syntactic noise when creating and consuming values of this type.</p>\n"}], "owner": {"reputation": 14867, "user_id": 517371, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0owFn.jpg?s=128&g=1", "display_name": "Tobia", "link": "https://stackoverflow.com/users/517371/tobia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 44191334, "answer_count": 1, "score": 11, "last_activity_date": 1495755280, "creation_date": 1495753664, "last_edit_date": 1495754984, "question_id": 44191123, "link": "https://stackoverflow.com/questions/44191123/can-i-write-a-higher-order-type-for-a-b", "title": "Can I write a higher order type for a -&gt; b -&gt; *?", "body": "<p>I understand that <code>(-&gt;) a</code> is a higher order type of kind <code>* -&gt; *</code>, that when applied to a type argument <code>b</code> gives the type <code>a -&gt; b</code></p>\n\n<p>Can I write a type of kind <code>* -&gt; *</code> that when applied to <code>c</code> would give <code>a -&gt; b -&gt; c</code>?</p>\n\n<p>If not, why not? Maybe using some language extensions and <code>forall</code>?</p>\n\n<p>This would let me write instances of Functor and Applicative (and other classes) where the functorial structure is \"<code>a -&gt; b -&gt;</code>\" as in:</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative t =&gt; t (c -&gt; d) -&gt; t c -&gt; t d\n\n(&lt;*&gt;) :: (a -&gt; b -&gt; c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d\n</code></pre>\n\n<p>This would be useful as a combinator for binary (curried) functions.</p>\n\n<p>NB. Maybe this is related <a href=\"https://stackoverflow.com/questions/18052158/functors-and-applicatives-for-types-of-kind\">Functors and Applicatives for types of kind (* -&gt; *) -&gt; *</a> but I'm not sure, because it went over my head :-)</p>\n"}, {"tags": ["function", "haskell", "monads"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1495753133, "post_id": 44190922, "comment_id": 75396044, "body": "<code>makeItMaybe = fmap</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 0, "creation_date": 1495752834, "post_id": 44190974, "comment_id": 75395937, "body": "What happens if the second argument is <code>Nothing</code> ? You could indeed define <code>makeItMaybe f Nothing = Nothing</code>, but then it&#39;s juste a definition of <code>fmap</code>."}], "tags": [], "owner": {"reputation": 403, "user_id": 6872977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Da7XT.jpg?s=128&g=1", "display_name": "Rom&#225;n Garc&#237;a", "link": "https://stackoverflow.com/users/6872977/rom%c3%a1n-garc%c3%ada"}, "is_accepted": false, "score": 1, "last_activity_date": 1495753345, "last_edit_date": 1495753345, "creation_date": 1495752675, "answer_id": 44190974, "question_id": 44190922, "link": "https://stackoverflow.com/questions/44190922/changing-function-to-maybe-function-in-haskell/44190974#44190974", "title": "Changing function to Maybe function in Haskell", "body": "<p>This functions satisfies the signature, but I don't know if it is what you want:</p>\n\n<pre><code>makeItMaybe :: (a -&gt; a) -&gt; (Maybe a -&gt; Maybe a)\nmakeItMaybe f (Just x) = Just (f x)\nmakeItMaybe f Nothing  = Nothing\n</code></pre>\n\n<p>As  @baxbaxwalanuksiwe and @Lee pointed out, it is <code>fmap</code> instance of <code>Maybe</code> from the <code>Functor</code> typeclass. </p>\n"}, {"tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 6, "last_activity_date": 1495769124, "last_edit_date": 1495769124, "creation_date": 1495752764, "answer_id": 44190993, "question_id": 44190922, "link": "https://stackoverflow.com/questions/44190922/changing-function-to-maybe-function-in-haskell/44190993#44190993", "title": "Changing function to Maybe function in Haskell", "body": "<p>I think you are looking for <code>fmap</code>, which has type <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>. If you replace <code>f</code> by <code>Maybe</code> (since <code>Maybe</code> is a functor) and put the parenthesis un the right place you get <code>(a -&gt; b) -&gt; (Maybe a -&gt; Maybe b)</code>. You were in the right direction with <code>(&lt;$&gt;)</code>, which is just an alias for <code>fmap</code>.</p>\n\n<p>So we have <code>makeItMaybe f x = fmap f x</code> or, more simply, <code>makeItMaybe = fmap</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1495755319, "post_id": 44190999, "comment_id": 75396642, "body": "You&#39;re using <code>f</code> as a free variable in your answer, but in the question <code>f</code> is one of the parameters to <code>makeItMaybe</code>, so a more accurate answer is <code>makeItMaybe = fmap</code>, as in the accepted answer."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1495787916, "post_id": 44190999, "comment_id": 75407341, "body": "@amalloy - Thanks, fixed."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 3, "last_activity_date": 1495787885, "last_edit_date": 1495787885, "creation_date": 1495752821, "answer_id": 44190999, "question_id": 44190922, "link": "https://stackoverflow.com/questions/44190922/changing-function-to-maybe-function-in-haskell/44190999#44190999", "title": "Changing function to Maybe function in Haskell", "body": "<p>The function you want is <code>fmap</code>:</p>\n\n<pre><code>makeItMaybe = fmap\n</code></pre>\n\n<p><code>fmap</code> is defined by the <code>Functor</code> typeclass:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p><code>Maybe</code> has a functor instance so <code>fmap</code> specialised to <code>Maybe</code> has type</p>\n\n<pre><code>(a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n</code></pre>\n"}], "owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 44190993, "answer_count": 3, "score": 1, "last_activity_date": 1495787885, "creation_date": 1495752336, "question_id": 44190922, "link": "https://stackoverflow.com/questions/44190922/changing-function-to-maybe-function-in-haskell", "title": "Changing function to Maybe function in Haskell", "body": "<p>Is it possible to write a function which takes a function like <code>(Something -&gt; Something)</code>, and returns it, but with a type <code>(Maybe Something -&gt; Maybe Something)</code>?</p>\n\n<p>e.g.:</p>\n\n<pre><code>f :: Point -&gt; Point\nf x = [some code goes here]\n\nmakeItMaybe :: (Point -&gt; Point) -&gt; (Maybe Point -&gt; Maybe Point)\nmakeItMaybe x = ???\n</code></pre>\n\n<p>I know it has something to do with Monads and Applicatives, but can't really figure out how. I played around a bit with <code>&lt;*&gt;</code> and <code>&lt;$&gt;</code>, but didn't get anywhere.</p>\n\n<p>Any help or pointers in the right direction would be appreciated. Thanks!</p>\n"}, {"tags": ["haskell", "dll", "haskell-stack", "hmatrix"], "comments": [{"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1495761751, "post_id": 44190079, "comment_id": 75398227, "body": "Is that directory on your <code>PATH</code>?"}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1495776087, "post_id": 44190079, "comment_id": 75401719, "body": "No, but even when I add it to path the result is the same."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1495791960, "post_id": 44190079, "comment_id": 75409768, "body": "I know I shouldn&#39;t say this, but... are you sure you want to use <i><code>hmatrix</code> on Windows</i>? I dislike both individually, for somewhat unrelated reasons (<code>hmatrix</code> for its ugly Matlab-like interface, Windows for its closedness), and <code>hmatrix</code>&#39; GSL basis makes it an obvious fit for GNU/Linux based systems. Though it certainly <i>should</i> work on Windows too (like Octave does), it&#39;ll definitely be a lot easier to use it on Linux or else use a native Haskell alternative which Stack actually has control over, on Windows. (<i>Or</i> on Linux...) What kind of linear algebra is it you need to do?"}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1495795949, "post_id": 44190079, "comment_id": 75412182, "body": "Well I am trying to use hnn which requires hmatrix, I might switch to another package but now I just want to know what happened more than I want it to work. About Windows, I have only one machine and I don&#39;t trust myself to do dual boot correctly."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1496689373, "post_id": 44190079, "comment_id": 75752734, "body": "A possible other solution. It seems that we can remove the dependency on <code>libgfortran</code>, if we clone the package: <a href=\"https://gist.github.com/RyanGlScott/6a707536d6279e339909e43274ad66fc\" rel=\"nofollow noreferrer\">gist.github.com/RyanGlScott/6a707536d6279e339909e43274ad66fc</a>"}], "answers": [{"comments": [{"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1496651545, "post_id": 44355882, "comment_id": 75730870, "body": "That worked, thanks. Is there by any chance an easier way to access the msys2 shell by default?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1496660035, "post_id": 44355882, "comment_id": 75735715, "body": "@YotamOhad No idea. I discovered that yesterday."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1496672468, "post_id": 44355882, "comment_id": 75743287, "body": "@YotamOhad Do you manage to install <code>hmatrix-gsl</code>? I can&#39;t find the C library <code>gsl-0</code>."}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1496680788, "post_id": 44355882, "comment_id": 75748235, "body": "I did not encounter a problem with this library. I might have installed it implicitly but I am really unsure about it. You can look at my .cabal and stack.yaml configuration in my code (reference in the original question). What I have there currently works with <code>stack build</code>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1496681665, "post_id": 44355882, "comment_id": 75748681, "body": "@YotamOhad In fact you don&#39;t load this library."}], "tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1496591344, "creation_date": 1496591344, "answer_id": 44355882, "question_id": 44190079, "link": "https://stackoverflow.com/questions/44190079/stack-cant-find-libgfortran-3-dll-when-trying-to-build-with-hmatrix/44355882#44355882", "title": "Stack can&#39;t find libgfortran-3.dll when trying to build with hmatrix", "body": "<p>I've managed to install it as follows. </p>\n\n<p>In <code>yourpath\\to\\stack\\x86_64-windows\\msys2-20150512</code>, open a <code>msys2</code> shell by double-clicking on <code>msys2_shell.bat</code>.</p>\n\n<p>In the shell, type:</p>\n\n<pre><code>pacman -S mingw-w64-x86_64-toolchain\n</code></pre>\n\n<p>Then add these \"extra\" in <code>stack.yaml</code>:</p>\n\n<pre><code>extra-include-dirs:\n- yourpath\\to\\OpenBLAS\\include\nextra-lib-dirs:\n- yourpath\\to\\OpenBLAS\\lib\n- yourpath\\to\\stack\\x86_64-windows\\msys2-20150512\\usr\\lib\\gcc\\x86_64-pc-msys\\6.3.0\n- yourpath\\to\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 739, "favorite_count": 0, "accepted_answer_id": 44355882, "answer_count": 1, "score": 2, "last_activity_date": 1496591344, "creation_date": 1495747453, "question_id": 44190079, "link": "https://stackoverflow.com/questions/44190079/stack-cant-find-libgfortran-3-dll-when-trying-to-build-with-hmatrix", "title": "Stack can&#39;t find libgfortran-3.dll when trying to build with hmatrix", "body": "<p>I am trying to setup hmatrix on my Windows 10 machine with GHC 8.0.2.\nI was following the answer <a href=\"https://stackoverflow.com/questions/32423225/how-to-build-hmatrix-with-blas-and-lapack-under-windows\">here</a> but when I try to build it says that it cannot find <code>libgfortran-3.dll</code> although I am sure I added it to the bin folder in the BLAS directory.\nMy code is in <a href=\"https://github.com/yohad/networks\" rel=\"nofollow noreferrer\">here</a>\nI run <code>stack build</code> and this is what I get:</p>\n\n<pre><code>hmatrix-0.18.0.0: configure\nProgress: 1/2\n--  While building package hmatrix-0.18.0.0 using:\n      C:\\sr\\setup-exe-cache\\x86_64-windows\\Cabal-simple_Z6RU0evB_1.24.2.0_ghc-8.0.2.exe --builddir=.stack-work\\dist\\ca59d0ab configure \"--with-ghc=C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2\\\\bin\\\\ghc.EXE\" \"--with-ghc-pkg=C:\\\\Program Files\\\\Haskell Platform\\\\8.0.2\\\\bin\\\\ghc-pkg.EXE\" --user --package-db=clear --package-db=global --package-db=C:\\sr\\snapshots\\b201cfe6\\pkgdb --package-db=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\pkgdb --libdir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\lib --bindir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\bin --datadir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\share --libexecdir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\libexec --sysconfdir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\etc --docdir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\doc\\hmatrix-0.18.0.0 --htmldir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\doc\\hmatrix-0.18.0.0 --haddockdir=D:\\Haskell\\networks\\.stack-work\\install\\65995373\\doc\\hmatrix-0.18.0.0 --dependency=array=array-0.5.1.1 --dependency=base=base-4.9.1.0 --dependency=binary=binary-0.8.3.0 --dependency=bytestring=bytestring-0.10.8.1 --dependency=deepseq=deepseq-1.4.2.0 --dependency=random=random-1.1-9tceXaeYIMZ4JrKq20Egog --dependency=split=split-0.2.3.1-FWyXC6nhV0H3AfM8IzrEFk --dependency=storable-complex=storable-complex-0.2.2-G9QzpmZTKvgKKVagrcRWdL --dependency=vector=vector-0.11.0.0-HhutbadagxHIONIkSRJEug -fopenblas --extra-include-dirs=C:\\OpenBLAS-v0.2.19-Win64-int32\\include --extra-include-dirs=C:\\Users\\Yotam\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include --extra-lib-dirs=C:\\OpenBLAS-v0.2.19-Win64-int32\\bin --extra-lib-dirs=C:\\Users\\Yotam\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib\n    Process exited with code: ExitFailure 1\n    Logs have been written to: D:\\Haskell\\networks\\.stack-work\\logs\\hmatrix-0.18.0.0.log\n\n    Configuring hmatrix-0.18.0.0...\n    Cabal-simple_Z6RU0evB_1.24.2.0_ghc-8.0.2.exe: Missing dependency on a foreign\n    library:\n    * Missing C library: libgfortran-3\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n\n<p>D:\\OpenBLAS-v0.2.19-Win64-int32\\bin includes both <code>libopenblas.dll</code> and <code>libgfortran-3.dll</code> and the blas directory was taken from this <a href=\"https://sourceforge.net/projects/openblas/files/v0.2.19/\" rel=\"nofollow noreferrer\">url</a></p>\n\n<p>Thanks for any help</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1495739519, "post_id": 44188122, "comment_id": 75390032, "body": "You need to put <code>::</code> after the name of the function in the function signature."}, {"owner": {"reputation": 89, "user_id": 7783162, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6e62c4e6b65938a046b006528860b30b?s=128&d=identicon&r=PG&f=1", "display_name": "Vic", "link": "https://stackoverflow.com/users/7783162/vic"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495739582, "post_id": 44188122, "comment_id": 75390073, "body": "Realized I forgot the :: after numberInMonth"}, {"owner": {"reputation": 89, "user_id": 7783162, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6e62c4e6b65938a046b006528860b30b?s=128&d=identicon&r=PG&f=1", "display_name": "Vic", "link": "https://stackoverflow.com/users/7783162/vic"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495739604, "post_id": 44188122, "comment_id": 75390085, "body": "Willem, thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1495739553, "creation_date": 1495739553, "answer_id": 44188153, "question_id": 44188122, "link": "https://stackoverflow.com/questions/44188122/parse-error-on-input-in-haskell/44188153#44188153", "title": "&quot;Parse error on input -&gt;&quot; in Haskell", "body": "<p>You're just missing the <code>::</code> in your type signature.</p>\n\n<pre><code>--------------|\n--            V\nnumberInMonth :: [(Int, Int, Int)] -&gt; Int -&gt; Int\nnumberInMonth ((y,m,d) : rst) month = \n   if y == month then 1 +(numberInMonth rst) \n   else numberInMonth rst\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 7783162, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6e62c4e6b65938a046b006528860b30b?s=128&d=identicon&r=PG&f=1", "display_name": "Vic", "link": "https://stackoverflow.com/users/7783162/vic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "closed_date": 1495746035, "answer_count": 1, "score": 0, "last_activity_date": 1495739594, "creation_date": 1495739421, "last_edit_date": 1495739594, "question_id": 44188122, "link": "https://stackoverflow.com/questions/44188122/parse-error-on-input-in-haskell", "closed_reason": "Not suitable for this site", "title": "&quot;Parse error on input -&gt;&quot; in Haskell", "body": "<p>I am writing a function that takes a list of dates (currently in form (Year,Month,Day) where each is an Int: (Int,Int,Int)) and a month (as an Int) and returns the number of times that month appears in the list of dates.  </p>\n\n<p>I am getting an error: \"parse error on input ->\" regarding my first '->' in the function signature:</p>\n\n<pre><code>numberInMonth [(Int, Int, Int)] -&gt; Int -&gt; Int\nnumberInMonth ((y,m,d) : rst) month = \n   if y == month then 1 +(numberInMonth rst) \n   else numberInMonth rst\n</code></pre>\n\n<p>Any thoughts as to why that's not parsing?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "category-theory", "traversable"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495739493, "post_id": 44187945, "comment_id": 75390015, "body": "If <code>~&gt;</code> is the natural transformation arrow, then <code>sequenceA :: (Applicative f) =&gt; t . f ~&gt; f . t</code>, which can be reinterpreted in a higher context, so that&#39;s what I&#39;d focus on.  But yeah looks like you need higher applicatives for that."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495739679, "post_id": 44187945, "comment_id": 75390122, "body": "@luqui I was under the impression that higher applicatives don&#39;t actually exist, it&#39;s indexed monads or bust. <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Kleisli.pdf\" rel=\"nofollow noreferrer\">&quot;In general, demonic activity makes this structure hard to attain. Applicative functors sequence computations with no value dependency: in <code>(&lt;*&gt;) :: Applicative a =&gt; a (s -&gt; t) -&gt; a s -&gt; a t</code> there is no way for the value of the function computation to influence our choice of argument computation, only the way in which its value is used in turn.&quot;</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1495739758, "post_id": 44187945, "comment_id": 75390178, "body": "Interesting!  My normal approach is useless here."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1495744424, "post_id": 44189266, "comment_id": 75392573, "body": "I take it you meant <code>htraverse eta = hsequence . hmap (Compose . eta)</code> and <code>hsequence :: Applicative a =&gt; t (Compose a g) -&gt; a (t g)</code>? This appears to work! Thanks!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1495744489, "post_id": 44189266, "comment_id": 75392605, "body": "Oops, that&#39;s what I meant indeed."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1495744723, "post_id": 44189266, "comment_id": 75392733, "body": "In that case I think the most elegant version of these types is <code>htraverse :: Applicative a =&gt; (f ~&gt; Compose a g) -&gt; t f -&gt; a (t g)</code>, <code>hsequence :: Applicative a =&gt; t (Compose a g) -&gt; a (t g)</code>. Then the code of <code>htraverse</code> and <code>hsequence</code> is exactly the same as for regular <code>Traversable</code>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1495744508, "last_edit_date": 1495744508, "creation_date": 1495743990, "answer_id": 44189266, "question_id": 44187945, "link": "https://stackoverflow.com/questions/44187945/what-should-a-higher-order-traversable-class-look-like/44189266#44189266", "title": "What should a &quot;higher order Traversable&quot; class look like?", "body": "<p>In first order, we have <code>sequence = traverse id</code>.</p>\n\n<p>Here the first argument of <code>htraverse</code> has type <code>forall x. f x -&gt; a (g x)</code>, we can't have <code>id</code>, but we can try with an isomorphism instead. For <code>f x</code> to be isomorphic to <code>a (g x)</code>, we can pick <code>f ~ Compose a g</code>.</p>\n\n<pre><code>htraverse = hsequence . hmap (Compose . eta)\n\nhsequence :: Applicative a =&gt; t (Compose a g) -&gt; a (t g)\nhsequence = htraverse getCompose\n</code></pre>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 44189266, "answer_count": 1, "score": 5, "last_activity_date": 1500627802, "creation_date": 1495738779, "last_edit_date": 1500627802, "question_id": 44187945, "link": "https://stackoverflow.com/questions/44187945/what-should-a-higher-order-traversable-class-look-like", "title": "What should a &quot;higher order Traversable&quot; class look like?", "body": "<p>In <a href=\"https://stackoverflow.com/a/44186072/7951906\">this answer</a> I made up on the spot something which looks a bit like a \"higher order <code>Traversable</code>\": like <code>Traversable</code> but for functors from the category of endofunctors on Hask to Hask.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Data.Functor.Compose\nimport Data.Functor.Identity\n\nclass HFunctor t where\n    hmap :: (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\n\nclass HFunctor t =&gt; HTraversable t where\n    htraverse :: Applicative g =&gt; (forall x. f x -&gt; g x) -&gt; t f -&gt; g (t Identity)\n    htraverse eta = hsequence . hmap eta\n    hsequence :: Applicative f =&gt; t f -&gt; f (t Identity)\n    hsequence = htraverse id\n</code></pre>\n\n<p>I made <code>HFunctor</code> a superclass of <code>HTraversable</code> because it seemed right, but when I sat down to write <code>hmapDefault</code> I got stuck.</p>\n\n<pre><code>hmapDefault :: HTraversable t =&gt; (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\nhmapDefault eta = runIdentity . htraverse (Identity . eta)\n\n-- \u2022 Couldn't match type \u2018x\u2019 with \u2018g x\u2019\n--   Expected type: f x -&gt; Identity x\n--     Actual type: f x -&gt; Identity (g x)\n</code></pre>\n\n<p><code>Identity . eta</code> has a type <code>forall y. f y -&gt; Identity (g y)</code>, so when I pass it into <code>htraverse</code> <code>g</code> unifies with <code>Identity</code> and <code>x</code> has to unify with both <code>y</code> and <code>g y</code>, so it fails because the traversal function is not a natural transformation.</p>\n\n<p>I attempted to patch it up using <code>Compose</code>:</p>\n\n<pre><code>hmapDefault :: HTraversable t =&gt; (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\nhmapDefault eta = runIdentity . getCompose . htraverse (Compose . Identity . eta)\n</code></pre>\n\n<p>Now <code>Compose . Identity . eta</code> is a natural transformation, but you can't <code>htraverse</code> with it because you don't know <code>Applicative g</code>. And even if you could do that, the <code>runIdentity</code> call returns <code>g (t Identity)</code> and you're left with no way to put the <code>g</code> back inside the <code>t</code>.</p>\n\n<hr>\n\n<p>I then realised that my <code>htraverse</code> isn't really analogous to plain old <code>traverse</code>. The traversal function of <code>traverse</code> puts the new value <em>inside</em> an <code>Applicative</code> effect, making the type expression bigger. So <code>htraverse</code> should probably look like this:</p>\n\n<pre><code>class HFunctor t =&gt; HTraversable t where\n    htraverse :: Applicative a =&gt; (forall x. f x -&gt; a (g x)) -&gt; t f -&gt; a (t g)\n</code></pre>\n\n<p>It's promising that this definition looks more like <code>Traversable</code>, and <code>hmapDefault</code> goes off without a hitch,</p>\n\n<pre><code>hmapDefault :: HTraversable t =&gt; (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\nhmapDefault eta = runIdentity . htraverse (Identity . eta)\n</code></pre>\n\n<p>but I'm struggling to come up with a good analogue for <code>sequenceA</code>. I tried</p>\n\n<pre><code>hsequence :: (HTraversable t, Applicative f) =&gt; t f -&gt; f (t Identity)\nhsequence = htraverse (fmap Identity)\n</code></pre>\n\n<p>but I can't come up with a way of implementing <code>htraverse</code> in terms of <code>hsequence</code>. As before, <code>f</code> is not a natural transformation.</p>\n\n<pre><code>htraverse f = hsequence . hmap f\n\n-- \u2022 Couldn't match type \u2018x\u2019 with \u2018g x\u2019\n--   Expected type: f x -&gt; a x\n--     Actual type: f x -&gt; a (g x)\n</code></pre>\n\n<p>I suspect I have my <code>hsequence</code> type signature wrong. Is <code>Applicative</code> the problem - do I need to go all the way up to <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Kleisli.pdf\" rel=\"nofollow noreferrer\">indexed monads</a>? What should a class for \"traversable functors from the <code>Functor</code> category to Hask\" look like? Does such a thing even exist?</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1495736425, "post_id": 44187259, "comment_id": 75388367, "body": "Looks random to me. :) I usually use the uniformally distributed random variate from the <code>mwc-random</code> package: <a href=\"https://www.stackage.org/haddock/lts-8.15/mwc-random-0.13.6.0/System-Random-MWC.html#v:uniform\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-8.15/mwc-random-0.13.6.0/&hellip;</a>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495736766, "post_id": 44187259, "comment_id": 75388580, "body": "I think it&#39;s more likely that <a href=\"https://cocosci.berkeley.edu/tom/papers/hard.pdf\" rel=\"nofollow noreferrer\">it is hard for humans to detect randomness</a> than that there is a real problem with the random library. I would want to see statistically relevant evidence that the samples are not random before agreeing with you."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495736866, "post_id": 44187259, "comment_id": 75388635, "body": "<code>evens</code> and <code>odds</code> can error, since a list is not always guaranteed to have an even length."}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495737627, "post_id": 44187259, "comment_id": 75389073, "body": "@WillemVanOnsem the list is infinite"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495738327, "post_id": 44187259, "comment_id": 75389423, "body": "The sample you gave looks fishy but I can&#39;t reproduce it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1495738804, "post_id": 44187259, "comment_id": 75389678, "body": "@Programman I can&#39;t reproduce your histogram results, for me it gives <code>[62398,62151,62517,62490,62331,62213,62646,62719,62571,62189&zwnj;&#8203;,62777,62734,62355,6&zwnj;&#8203;2782,62312,62815]</code>, which looks highly plausible. What OS are you trying this on?"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "edited": false, "score": 0, "creation_date": 1495738883, "post_id": 44187259, "comment_id": 75389713, "body": "Gentoo Linux 64 bit on kernel 4.9.16"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1495738898, "post_id": 44187259, "comment_id": 75389724, "body": "Have you looked at the raw numbers that come out of urandom?"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "edited": false, "score": 0, "creation_date": 1495739083, "post_id": 44187259, "comment_id": 75389814, "body": "Yeah they look pretty good. In particular if I change histogram to take a <code>Word8</code> instead of a <code>Word64</code> all the buckets are about evenly distributed."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1495739207, "post_id": 44187259, "comment_id": 75389871, "body": "Well according to your hypotheses it seems like there would be a bug in <a href=\"https://hackage.haskell.org/package/random-1.1/docs/src/System-Random.html#randomIvalInteger\" rel=\"nofollow noreferrer\"><code>randomIvalInteger</code></a>.  Might be worth playing with that function to see if it does indeed have a bug."}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "edited": false, "score": 0, "creation_date": 1495739823, "post_id": 44187259, "comment_id": 75390213, "body": "I just tried in on Debian 8 and got the same result as on Gentoo. Could it be a hardware-related issue?"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1495739863, "post_id": 44187259, "comment_id": 75390238, "body": "@leftaroundabout my histogram function is pretty badly written, did you change <code>Word64</code> to <code>Word8</code> in both places?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1495740578, "post_id": 44187259, "comment_id": 75390606, "body": "@Programman yeah at first, therefore I changed it (see edit)..."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495741976, "post_id": 44187259, "comment_id": 75391363, "body": "Since it seems we can&#39;t reproduce it, a hardware issue seems likely, but in that case you should be able to observe it from urandom directly. Get a histogram of individual bytes, as buckets may hide irregularities. What is your version of <code>random</code>? The latest version (though old) changed things quite a bit, though that may not be it either."}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495742320, "post_id": 44187259, "comment_id": 75391532, "body": "@Li-yaoXia I&#39;m using version 1.0.1.1 of random"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "edited": false, "score": 0, "creation_date": 1495742562, "post_id": 44187259, "comment_id": 75391637, "body": "It does show up directly from urandom! See edit"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495742681, "post_id": 44187259, "comment_id": 75391693, "body": "512 is twice the number of <code>Word8</code> values."}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "edited": false, "score": 0, "creation_date": 1495742749, "post_id": 44187259, "comment_id": 75391727, "body": "lol: good point"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1495742996, "post_id": 44187259, "comment_id": 75391843, "body": "You appear to have accidentally reverted that last edit again. \u2014 Could you show a direct dump of some of your <code>&#47;dev&#47;urandom</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495743086, "post_id": 44187259, "comment_id": 75391880, "body": "I can reproduce it with <code>random-1.0.1.1</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1495743223, "post_id": 44187259, "comment_id": 75391945, "body": "Upgrade to 1.1 which implements a better algorithm."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1495744129, "post_id": 44187259, "comment_id": 75392397, "body": "(@leftaroundabout that wasn&#39;t accidental. He was looking at a histogram of generated <code>Word8</code> with 512 buckets.)"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495744758, "post_id": 44187259, "comment_id": 75392755, "body": "@Li-yaoXia that&#39;s it! Upgrading to 1.1 fixes the issue."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1495745964, "post_id": 44187259, "comment_id": 75393371, "body": "@Li-yaoXia -- it would be great if you could post this as an answer, maybe with a reference to or a quote from the ChangeLog regarding the use of a better algorithm.  It is likely to be of help to others and is going to get lost in a sea of comments otherwise."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1495747420, "post_id": 44187259, "comment_id": 75394045, "body": "Ok sure. I added an answer."}, {"owner": {"reputation": 13910, "user_id": 98057, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3ba85799ed78f87eaf29dea4667f6d4?s=128&d=identicon&r=PG", "display_name": "Andr&#233; Laszlo", "link": "https://stackoverflow.com/users/98057/andr%c3%a9-laszlo"}, "edited": false, "score": 0, "creation_date": 1495806629, "post_id": 44187259, "comment_id": 75419183, "body": "Not related to your question, but have you read <a href=\"http://publications.lib.chalmers.se/records/fulltext/183348/local_183348.pdf\" rel=\"nofollow noreferrer\">this paper</a> about splittable PRNG&#39;s? Might be useful for you."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1495747383, "creation_date": 1495747383, "answer_id": 44190056, "question_id": 44187259, "link": "https://stackoverflow.com/questions/44187259/haskell-randoms-function-not-behaving-well-with-my-library/44190056#44190056", "title": "Haskell `randoms` function not behaving well with my library", "body": "<p>The issue is a bug in <code>random-1.0.1.1</code> that was fixed in <code>random-1.1</code>. <a href=\"http://hackage.haskell.org/package/random-1.1/changelog\" rel=\"noreferrer\">The changelog</a> points to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8898\" rel=\"noreferrer\">this ticket</a>. In particular, referring to the older version:</p>\n\n<blockquote>\n  <p>It also assumes that all RandomGen implementations produce the same range of random values as StdGen.</p>\n</blockquote>\n\n<p>Here randomness is produced 8 bits at a time, and that caused the observed behavior.</p>\n\n<p><code>random-1.1</code> fixed this:</p>\n\n<blockquote>\n  <p>This implementation also works with any RandomGen, even ones that produce as little as a single bit of entropy per next call or have a minimum bound other than zero.</p>\n</blockquote>\n"}], "owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 44190056, "answer_count": 1, "score": 10, "last_activity_date": 1495747383, "creation_date": 1495736168, "last_edit_date": 1495742730, "question_id": 44187259, "link": "https://stackoverflow.com/questions/44187259/haskell-randoms-function-not-behaving-well-with-my-library", "title": "Haskell `randoms` function not behaving well with my library", "body": "<p>I'm trying to write a Haskell library for cryptographically secure random numbers. The code follows:</p>\n\n<pre><code>module URandom (URandom, initialize) where\n\nimport qualified Data.ByteString.Lazy as B\nimport System.Random\nimport Data.Word\n\nnewtype URandom = URandom [Word8]\n\ninstance RandomGen URandom where\n  next (URandom (x : xs)) = (fromIntegral x, URandom xs)\n  split (URandom l) = (URandom (evens l), URandom (odds l))\n    where evens (x : _ : xs) = x : evens xs\n          odds (_ : x : xs) = x : odds xs\n  genRange _ = (fromIntegral (minBound :: Word8), fromIntegral (maxBound :: Word8))\n\ninitialize :: IO URandom\ninitialize = URandom . B.unpack &lt;$&gt; B.readFile \"/dev/urandom\"\n</code></pre>\n\n<p>Unfortunately, it's not behaving like I want. In particular, performing</p>\n\n<pre><code>take 10 . randoms &lt;$&gt; initialize\n</code></pre>\n\n<p>yields (something similar to)</p>\n\n<pre><code>[-4611651379516519433,-4611644973572935887,-31514321567846,9223361179177989878,-4611732094835278236,9223327886739677537,4611709625714976418,37194416358963,4611669560113361421,-4611645373004878170,-9223329383535098640,4611675323959360258,-27021785867556,9223330964083681227,4611705212636167666]\n</code></pre>\n\n<p>which to my, albiet untrained, eye, does not appear very random. A lot of 46... and 92... in there.</p>\n\n<p>What could be going wrong? Why doesn't this produce well-distributed numbers? It's worth noting that even if I concatenate together <code>Word8</code>s to form <code>Int</code>s the distribution does not improve, I didn't think it was worth including that code here.</p>\n\n<p>Edit: here's some evidence that's not distributed correctly. I've written a function called histogram:</p>\n\n<pre><code>histogram :: \u2200 t . (Integral t, Bounded t)\n          =&gt; [t] -&gt; Int -&gt; S.Seq Int\nhistogram [] buckets = S.replicate buckets 0\nhistogram (x : xs) buckets = S.adjust (+ 1) (whichBucket x) (histogram xs buckets)\n  where whichBucket x = fromIntegral $ ((fromIntegral x * fromIntegral buckets) :: Integer) `div` fromIntegral (maxBound :: t)\n</code></pre>\n\n<p>and when I run</p>\n\n<pre><code>g &lt;- initialize\nhistogram (take 1000000 $ randoms g :: [Word64]) 16\n</code></pre>\n\n<p>I get back</p>\n\n<pre><code>fromList [128510,0,0,121294,129020,0,0,122090,127873,0,0,120919,128637,0,0,121657]\n</code></pre>\n\n<p>Some of the buckets are completely empty!</p>\n"}, {"tags": ["list", "haskell", "ocaml", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 1221, "user_id": 7214292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pG5M6.png?s=128&g=1", "display_name": "ghilesZ", "link": "https://stackoverflow.com/users/7214292/ghilesz"}, "edited": false, "score": 0, "creation_date": 1495785247, "post_id": 44186820, "comment_id": 75405967, "body": "Minor detail: going negatively from b to a would avoid the additional traversal of the list by List.rev :)"}, {"owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "reply_to_user": {"reputation": 1221, "user_id": 7214292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pG5M6.png?s=128&g=1", "display_name": "ghilesZ", "link": "https://stackoverflow.com/users/7214292/ghilesz"}, "edited": false, "score": 0, "creation_date": 1495810598, "post_id": 44186820, "comment_id": 75421792, "body": "Yes, I thought of this later. Thanks!"}], "tags": [], "owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "is_accepted": false, "score": 1, "last_activity_date": 1495734672, "creation_date": 1495734672, "answer_id": 44186820, "question_id": 44186590, "link": "https://stackoverflow.com/questions/44186590/how-to-use-list-comprenhension-in-ocaml/44186820#44186820", "title": "How to use list comprenhension in Ocaml", "body": "<p>You're using many (really nice) features of Haskell that don't exist in OCaml.</p>\n\n<p>For list comprehensions, you can use <code>List.filter</code>.</p>\n\n<p>For the notation <code>[x .. y]</code> you can use this range function:</p>\n\n<pre><code>let range a b =\n    let rec go accum i =\n        if i &gt; b then List.rev accum else go (i :: accum) (i + 1)\n    in\n    go [] a\n</code></pre>\n\n<p>For <code>sum</code> you can use this:</p>\n\n<pre><code>let sum = List.fold_left (+) 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3539, "user_id": 4220738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4p0i.png?s=128&g=1", "display_name": "Drup", "link": "https://stackoverflow.com/users/4220738/drup"}, "is_accepted": true, "score": 2, "last_activity_date": 1495736361, "creation_date": 1495736361, "answer_id": 44187312, "question_id": 44186590, "link": "https://stackoverflow.com/questions/44186590/how-to-use-list-comprenhension-in-ocaml/44187312#44187312", "title": "How to use list comprenhension in Ocaml", "body": "<p>While Jeffrey's answer is correct, using appropriate libraries (in this case, sequence), you can get something that is similar in terseness and semantics to the Haskell style:</p>\n\n<pre><code>module S = Sequence\nlet sum = S.fold (+) 0\nlet f x = S.filter (fun i -&gt; x mod i = 0) S.(1 -- (x-1))\nlet perfect n = S.filter (fun x -&gt; sum (f x) = x) S.(1 -- n)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7729631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ss0yB6yfhbM/AAAAAAAAAAI/AAAAAAAAAMM/U4qTH_5mqCY/photo.jpg?sz=128", "display_name": "Slavko", "link": "https://stackoverflow.com/users/7729631/slavko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 44187312, "answer_count": 2, "score": 1, "last_activity_date": 1495736361, "creation_date": 1495733867, "question_id": 44186590, "link": "https://stackoverflow.com/questions/44186590/how-to-use-list-comprenhension-in-ocaml", "title": "How to use list comprenhension in Ocaml", "body": "<p>This code is in Haskell. How can i do the same thing in OCAML?</p>\n\n<pre><code>perfect n = [x | x&lt;-[1..n], sum(f x) == x]\nf x = [i | i&lt;-[1..x-1], x `mod` i ==0]\n</code></pre>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495732936, "post_id": 44186214, "comment_id": 75386487, "body": "What if the list is not dividable by three?"}, {"owner": {"reputation": 23, "user_id": 6456466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d137457da2a92780ed125d6b0ffcc609?s=128&d=identicon&r=PG&f=1", "display_name": "Zarolan", "link": "https://stackoverflow.com/users/6456466/zarolan"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495732987, "post_id": 44186214, "comment_id": 75386512, "body": "The input is always going to be of size nine. It&#39;s just the way it&#39;s utilised. If it&#39;s not 9, I guess it will give you an error message saying it&#39;s not the correct size."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1495734291, "post_id": 44186214, "comment_id": 75387143, "body": "Data.List.Split.chunksOf"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6456466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d137457da2a92780ed125d6b0ffcc609?s=128&d=identicon&r=PG&f=1", "display_name": "Zarolan", "link": "https://stackoverflow.com/users/6456466/zarolan"}, "edited": false, "score": 0, "creation_date": 1495733519, "post_id": 44186399, "comment_id": 75386764, "body": "My GHCI returns *Main&gt; [&quot;..3.2.6..&quot;,&quot;9..3.5..1&quot;,&quot;..18.64..&quot;,&quot;..81.29..&quot;,&quot;7.......8&quot;&zwnj;&#8203;,&quot;..67.82..&quot;,&quot;..26.9&zwnj;&#8203;5..&quot;,&quot;8..2.3..9&quot;,&quot;..&zwnj;&#8203;5.1.3..&quot;]. Do you know why it&#39;s using &#39; &quot; &#39; instead of &#39; [ &#39; ?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495736963, "post_id": 44186399, "comment_id": 75388693, "body": "Because a String is a list of Char and the Show instance is defined to show a list of characters as a string."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": true, "score": 3, "last_activity_date": 1495733244, "creation_date": 1495733244, "answer_id": 44186399, "question_id": 44186214, "link": "https://stackoverflow.com/questions/44186214/how-do-you-split-a-string-into-a-list-of-strings-all-of-length-3/44186399#44186399", "title": "How do you split a string into a list of strings all of length 3?", "body": "<p>If segment length is fixed as 3 and then you may do as follows by pattern matching</p>\n\n<pre><code>segment :: [a] -&gt; [[a]]\nsegment []           = []\nsegment [x]          = [[x]]\nsegment [x,y]        = [[x,y]]\nsegment (x:y:z:rest) = [x,y,z] : segment rest\n\n*Main&gt; segment [1,2,3,4,5,6,7,8,9]\n[[1,2,3],[4,5,6],[7,8,9]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 403, "user_id": 6872977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Da7XT.jpg?s=128&g=1", "display_name": "Rom&#225;n Garc&#237;a", "link": "https://stackoverflow.com/users/6872977/rom%c3%a1n-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1495734178, "post_id": 44186570, "comment_id": 75387080, "body": "@Zarolan, Strings are list of chars. ghci usually displays the list <code>&#39;h&#39;:&#39;o&#39;:&#39;l&#39;:&#39;a&#39;:[]</code> as <code>&quot;hola&quot;</code>"}], "tags": [], "owner": {"reputation": 403, "user_id": 6872977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Da7XT.jpg?s=128&g=1", "display_name": "Rom&#225;n Garc&#237;a", "link": "https://stackoverflow.com/users/6872977/rom%c3%a1n-garc%c3%ada"}, "is_accepted": false, "score": 2, "last_activity_date": 1495733773, "creation_date": 1495733773, "answer_id": 44186570, "question_id": 44186214, "link": "https://stackoverflow.com/questions/44186214/how-do-you-split-a-string-into-a-list-of-strings-all-of-length-3/44186570#44186570", "title": "How do you split a string into a list of strings all of length 3?", "body": "<p>Or you can also try this, having the checking of the length for free:</p>\n\n<pre><code>segment :: [a] -&gt; [[a]]\nsegment [a,b,c,d,e,f,g,h,i] = [[a,b,c],[d,e,f],[g,h,i]]\nsegment           _         = error \"the list hasn't 9 items\"\n</code></pre>\n\n<p>then you try:</p>\n\n<pre><code>&gt; segment [1,2,3,4,5,6,7,8,9]\n[[1,2,3],[4,5,6],[7,8,9]]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>&gt; segment [1,2,3,4,5,6,7,8]\n*** Exception: the list hasn't 9 items\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 519, "user_id": 7483211, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cKWRGsZijfQ/AAAAAAAAAAI/AAAAAAAAEKw/CCxhG0ejwDM/photo.jpg?sz=128", "display_name": "Cornelius Roemer", "link": "https://stackoverflow.com/users/7483211/cornelius-roemer"}, "edited": false, "score": 0, "creation_date": 1584551865, "post_id": 44186718, "comment_id": 107473883, "body": "I love this solution, so concise using regression and generalising well, too!"}], "tags": [], "owner": {"reputation": 936, "user_id": 3806719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fJl05.png?s=128&g=1", "display_name": "Sheng", "link": "https://stackoverflow.com/users/3806719/sheng"}, "is_accepted": false, "score": 3, "last_activity_date": 1495734347, "creation_date": 1495734347, "answer_id": 44186718, "question_id": 44186214, "link": "https://stackoverflow.com/questions/44186214/how-do-you-split-a-string-into-a-list-of-strings-all-of-length-3/44186718#44186718", "title": "How do you split a string into a list of strings all of length 3?", "body": "<pre><code>p3::[a] -&gt; [[a]]\np3 [] = []\np3 l = take 3 l : (p3 $ drop 3 l)\n</code></pre>\n\n<p>as you might notice, you can easily turn it to a more general version of <code>pN</code></p>\n"}, {"tags": [], "owner": {"reputation": 519, "user_id": 7483211, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cKWRGsZijfQ/AAAAAAAAAAI/AAAAAAAAEKw/CCxhG0ejwDM/photo.jpg?sz=128", "display_name": "Cornelius Roemer", "link": "https://stackoverflow.com/users/7483211/cornelius-roemer"}, "is_accepted": false, "score": 0, "last_activity_date": 1584551825, "last_edit_date": 1592644375, "creation_date": 1584551825, "answer_id": 60744452, "question_id": 44186214, "link": "https://stackoverflow.com/questions/44186214/how-do-you-split-a-string-into-a-list-of-strings-all-of-length-3/60744452#60744452", "title": "How do you split a string into a list of strings all of length 3?", "body": "<h2>Using chunksOf from Data.List.Split</h2>\n<p>A prepackaged answer is referenced in a comment by <a href=\"https://stackoverflow.com/users/775806/n-pronouns-m\">n. 'pronouns' m.</a>, though the <a href=\"https://hackage.haskell.org/package/split-0.2.3.4/docs/Data-List-Split.html\" rel=\"nofollow noreferrer\">package</a> needs to be installed.</p>\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List.Split (chunksOf)\nchunksOf :: Int -&gt; [e] -&gt; [[e]]\n--Sample Usage\nchunksOf 3 &quot;HelloWorld&quot; == [&quot;Hel&quot;,&quot;loW&quot;,&quot;orl&quot;,&quot;d&quot;]\n</code></pre>\n<h2>Defining custom function, Prelude only</h2>\n<p>This function I wrote does exactly the same as chunksOf but not requiring any package to be installed:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>splitInto :: Int -&gt; String -&gt; [String]\nsplitInto n = foldl (f n) [&quot;&quot;]\n    where\n        f :: Int -&gt; [String] -&gt; Char -&gt; [String]\n        f n s x\n            | (n &gt;) $ length $ last s   = init s ++ [last s ++ [x]]\n            | otherwise                 = s ++ [[x]]\n</code></pre>\n<p>It could probably be optimised to use <code>:</code> instead of <code>++</code> but if performance is no concern this works. Also, it could generalise for anything beyond strings.</p>\n"}], "owner": {"reputation": 23, "user_id": 6456466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d137457da2a92780ed125d6b0ffcc609?s=128&d=identicon&r=PG&f=1", "display_name": "Zarolan", "link": "https://stackoverflow.com/users/6456466/zarolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 0, "accepted_answer_id": 44186399, "answer_count": 4, "score": 2, "last_activity_date": 1584551825, "creation_date": 1495732591, "last_edit_date": 1495732766, "question_id": 44186214, "link": "https://stackoverflow.com/questions/44186214/how-do-you-split-a-string-into-a-list-of-strings-all-of-length-3", "title": "How do you split a string into a list of strings all of length 3?", "body": "<p>Stuck on a problem, if I wanted to split a list of characters such as \"qwertyzxc\" (9 elements) (<code>['q','w','e','r','t','y','z','x','c']</code>) into a list of strings with the length 3. How would I do it?\nExample:</p>\n\n<p>Input : <code>['q','w','e','r','t','y','z','x','c']</code>\nOutput : <code>[['q','w','e'],['r','t','y'],['z','x','c']]</code></p>\n\n<p>Thanks, I have been stuck on this for quite a while</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1495731055, "post_id": 44184898, "comment_id": 75385404, "body": "I&#39;m having trouble understanding what you&#39;re trying to do. Please include the definition of <code>Nouns</code> and <code>HStoreList</code>, expected input/output, and any error messages."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1495728362, "post_id": 44184958, "comment_id": 75383920, "body": "Need the default instance for other things, eg. displaying the default values to the user in the UI."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1495728599, "post_id": 44184958, "comment_id": 75384044, "body": "Right, you can still use the <code>Default</code> instance if you need it. I think the function you are after in order to use the default value is simply <code>fromMaybe</code>: <code>fromMaybe def</code> should have type <code>Maybe Nouns -&gt; Nouns</code> in this context. :-)"}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": false, "score": 0, "last_activity_date": 1495728755, "last_edit_date": 1495728755, "creation_date": 1495728191, "answer_id": 44184958, "question_id": 44184898, "link": "https://stackoverflow.com/questions/44184898/how-to-override-a-default-value-via-lenses-only-if-incoming-value-is-not-nothi/44184958#44184958", "title": "How to override a default value, via lenses, only if incoming value is not Nothing", "body": "<p>How about just using <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow noreferrer\"><code>fromMaybe</code></a> instead of creating an instance of <code>Default</code>?</p>\n\n<p><strong>EDIT</strong>: Since you seem to want to use the <code>Default</code> for other purposes as well:</p>\n\n<pre><code>\u03bb &gt; import Data.Default\n\u03bb &gt; import Data.Maybe\n\u03bb &gt; :t fromMaybe def\nfromMaybe def :: Default a =&gt; Maybe a -&gt; a\n</code></pre>\n\n<p>This seems to be what you are after.</p>\n"}, {"comments": [{"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1495729460, "post_id": 44185256, "comment_id": 75384519, "body": "You do realise <code>overrideIfJust == flip fromMaybe</code>?"}], "tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 1, "last_activity_date": 1495729120, "creation_date": 1495729120, "answer_id": 44185256, "question_id": 44184898, "link": "https://stackoverflow.com/questions/44184898/how-to-override-a-default-value-via-lenses-only-if-incoming-value-is-not-nothi/44185256#44185256", "title": "How to override a default value, via lenses, only if incoming value is not Nothing", "body": "<p>Okay, I found a possible solution, but I'm still looking for a better one!</p>\n\n<pre><code>mkNounsFromHStoreList :: HStoreList -&gt; Nouns\nmkNounsFromHStoreList h = (DD.def Nouns)\n  &amp; depSingular %~ (overrideIfJust (lookupHStore h \"dep_label_singular\"))\n  -- and more fields come here...\n  where\n    overrideIfJust val x = maybe x id val\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1495742101, "last_edit_date": 1495742101, "creation_date": 1495731985, "answer_id": 44186072, "question_id": 44184898, "link": "https://stackoverflow.com/questions/44184898/how-to-override-a-default-value-via-lenses-only-if-incoming-value-is-not-nothi/44186072#44186072", "title": "How to override a default value, via lenses, only if incoming value is not Nothing", "body": "<p>This seems like a job for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\"><code>Alternative</code></a>. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-707\" rel=\"nofollow noreferrer\"><code>Maybe</code>'s <code>Alternative</code> instance</a> implements <em>left-biased choice</em> - its <code>&lt;|&gt;</code> chooses the first non-<code>Nothing</code> value.</p>\n\n<pre><code>import Control.Applicative\nimport Data.Semigroup\n\ndata Foo = Foo {\n    bar :: Maybe Int,\n    baz :: Maybe String\n}\n</code></pre>\n\n<p>I'm going to implement a <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Semigroup.html#t:Semigroup\" rel=\"nofollow noreferrer\"><code>Semigroup</code></a> instance for <code>Foo</code> which lifts <code>&lt;|&gt;</code> point-wise over the record fields. So the operation <code>x &lt;&gt; y</code> overrides the fields of <code>y</code> with the matching non-<code>Nothing</code> fields of <code>x</code>. (You can also use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow noreferrer\">the <code>First</code> monoid</a>, it does the same thing.)</p>\n\n<pre><code>instance Semigroup Foo where\n    f1 &lt;&gt; f2 = Foo {\n        bar = bar f1 &lt;|&gt; bar f2,\n        baz = baz f1 &lt;|&gt; baz f2\n    }\n\nghci&gt; let defaultFoo = Foo { bar = Just 2, baz = Just \"default\" }\nghci&gt; let overrides = Foo { bar = Just 8, baz = Nothing }\nghci&gt; overrides &lt;&gt; defaultFoo\nFoo {bar = Just 8, baz = Just \"default\"}\n</code></pre>\n\n<p>Note that you don't need lenses for this, although they might be able to help you make the implementation of <code>(&lt;&gt;)</code> a little terser.</p>\n\n<p>When the user gives you a partially-filled-in <code>Foo</code>, you can fill in the rest of the fields by appending your default <code>Foo</code>.</p>\n\n<pre><code>fillInDefaults :: Foo -&gt; Foo\nfillInDefaults = (&lt;&gt; defaultFoo)\n</code></pre>\n\n<hr>\n\n<p>One fun thing you can do with this is factor the <code>Maybe</code> out of <code>Foo</code>'s definition.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Control.Applicative\nimport Data.Semigroup\nimport Data.Functor.Identity\n\ndata Foo f = Foo {\n    bar :: f Int,\n    baz :: f String\n}\n</code></pre>\n\n<p>The <code>Foo</code> I originally wrote above is now equivalent to <code>Foo Maybe</code>. But now you can express invariants like \"this <code>Foo</code> has all of its fields filled in\" without duplicating <code>Foo</code> itself.</p>\n\n<pre><code>type PartialFoo = Foo Maybe  -- the old Foo\ntype TotalFoo = Foo Identity  -- a Foo with no missing values\n</code></pre>\n\n<p>The <code>Semigroup</code> instance, which only relied on <code>Maybe</code>'s instance of <code>Alternative</code>, remains unchanged,</p>\n\n<pre><code>instance Alternative f =&gt; Semigroup (Foo f) where\n    f1 &lt;&gt; f2 = Foo {\n        bar = bar f1 &lt;|&gt; bar f2,\n        baz = baz f1 &lt;|&gt; baz f2\n    }\n</code></pre>\n\n<p>but you can now generalise <code>defaultFoo</code> to an arbitrary <code>Applicative</code>.</p>\n\n<pre><code>defaultFoo :: Applicative f =&gt; Foo f\ndefaultFoo = Foo { bar = pure 2, baz = pure \"default\" }\n</code></pre>\n\n<p>Now, with a little bit of <code>Traversable</code>-inspired categorical nonsense,</p>\n\n<pre><code>-- \"higher order functors\": functors from the category of endofunctors to the category of types\nclass HFunctor t where\n    hmap :: (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\n\n-- \"higher order traversables\",\n-- about which I have written a follow up question: https://stackoverflow.com/q/44187945/7951906\nclass HFunctor t =&gt; HTraversable t where\n    htraverse :: Applicative g =&gt; (forall x. f x -&gt; g x) -&gt; t f -&gt; g (t Identity)\n    htraverse eta = hsequence . hmap eta\n    hsequence :: Applicative f =&gt; t f -&gt; f (t Identity)\n    hsequence = htraverse id\n\ninstance HFunctor Foo where\n    hmap eta (Foo bar baz) = Foo (eta bar) (eta baz)\ninstance HTraversable Foo where\n    htraverse eta (Foo bar baz) = liftA2 Foo (Identity &lt;$&gt; eta bar) (Identity &lt;$&gt; eta baz)\n</code></pre>\n\n<p><code>fillInDefaults</code> can be adjusted to express the invariant that the resulting <code>Foo</code> is not missing any values.</p>\n\n<pre><code>fillInDefaults :: Alternative f =&gt; Foo f -&gt; f TotalFoo\nfillInDefaults = hsequence . (&lt;&gt; defaultFoo)\n\n-- fromJust (unsafely) asserts that there aren't\n-- any `Nothing`s in the output of `fillInDefaults`\nfillInDefaults' :: PartialFoo -&gt; TotalFoo\nfillInDefaults' = fromJust . fillInDefaults\n</code></pre>\n\n<p>Probably overkill for what you need, but it's still pretty neat.</p>\n"}, {"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1495814792, "post_id": 44186591, "comment_id": 75424277, "body": "Thanks. Exactly what I needed. And probably should be contributed upstream."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 2, "last_activity_date": 1495733873, "creation_date": 1495733873, "answer_id": 44186591, "question_id": 44184898, "link": "https://stackoverflow.com/questions/44184898/how-to-override-a-default-value-via-lenses-only-if-incoming-value-is-not-nothi/44186591#44186591", "title": "How to override a default value, via lenses, only if incoming value is not Nothing", "body": "<p>You could make your own combinator:</p>\n\n<pre><code>(~?) :: ASetter' s a -&gt; Maybe a -&gt; s -&gt; s\ns ~? Just a  = s .~ a\ns ~? Nothing = id\n</code></pre>\n\n<p>Which you can use just like <code>.~</code>:</p>\n\n<pre><code>mkNounsFromHStoreList :: HStoreList -&gt; Nouns\nmkNounsFromHStoreList h =\n  DD.def\n    &amp; myNoun1 ~? lookupHStore h \"potato\"\n    &amp; myNoun2 ~? lookupHStore h \"cheese\"\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 44186591, "answer_count": 4, "score": 1, "last_activity_date": 1495742101, "creation_date": 1495728015, "question_id": 44184898, "link": "https://stackoverflow.com/questions/44184898/how-to-override-a-default-value-via-lenses-only-if-incoming-value-is-not-nothi", "title": "How to override a default value, via lenses, only if incoming value is not Nothing", "body": "<p>I'm basically trying to override a bunch of default values in a record only if the user-specific values are NOT <code>Nothing</code>. Is it possible to do it via lenses?</p>\n\n<pre><code>import qualified Data.Default as DD\n\ninstance DD.Def Nouns where\n  def  = Nouns\n    {\n      -- default values for each field come here\n    }\n\nlookupHStore :: HStoreList -&gt; Text -&gt; Maybe Text\n\nmkNounsFromHStoreList :: HStoreList -&gt; Nouns\nmkNounsFromHStoreList h = (DD.def Nouns)\n  &amp; depSingular .~ (lookupHStore h \"dep_label_singular\")\n  -- ERROR: Won't compile because Text and (Maybe Text) don't match\n</code></pre>\n"}, {"tags": ["haskell", "vector"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1495728176, "post_id": 44182808, "comment_id": 75383820, "body": "I would probably wrap <code>U.Vector Float</code> in a <code>newtype</code> and create an instance for <code>Data.Serialize.Serialize</code>. I believe this will efficiently build a buffer that can then be written in one operation."}], "answers": [{"comments": [{"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1495739153, "post_id": 44185278, "comment_id": 75389843, "body": "This seems to be faster than my original implementation. However, it seems to consume more memory. I need to run this on directories of files. I couldn&#39;t run this on a directory of 19 files since it swamps the memory. It does work using my previous implementation. Anyway, thanks for the input!"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1496151781, "post_id": 44185278, "comment_id": 75535959, "body": "@ThomasVanhelden I would be interested to see your implementations, perhaps as a new question regarding the difference between the two? I&#39;m not sure how the serialization method would affect memory consumption. Can each of your 19 files be processed individually or must some state be maintained across them? If the former, I would certainly make sure no references are held after a file has finished processing."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 1, "last_activity_date": 1495729217, "creation_date": 1495729217, "answer_id": 44185278, "question_id": 44182808, "link": "https://stackoverflow.com/questions/44182808/efficiently-converting-and-writing-a-vector-to-a-handle/44185278#44185278", "title": "Efficiently converting and writing a vector to a handle", "body": "<p>Example shell creating a <code>Serialize</code> instance:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as U\nimport qualified Data.Serialize as S\n\nnewtype MyVec = MyVec (U.Vector Float)\n\ninstance S.Serialize MyVec where\n  put (MyVec vec) =\n    U.forM_ vec $ \\_ -&gt;\n      let word1 = 0; word2 = 0; word3 = 0\n      in do\n        S.putWord8 word1\n        S.putWord8 word2\n        S.putWord8 word3\n  get = error \"MyVec::S.Serialize: not implemented\"\n\ntest = S.encode $ MyVec $ U.singleton 0\n</code></pre>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 44185278, "answer_count": 1, "score": 2, "last_activity_date": 1495729217, "creation_date": 1495721808, "question_id": 44182808, "link": "https://stackoverflow.com/questions/44182808/efficiently-converting-and-writing-a-vector-to-a-handle", "title": "Efficiently converting and writing a vector to a handle", "body": "<p>I'm writing a program that performs a transformation on sample data in a file. I do this by reading the file, turning the content into a vector, performing the transformation on the vector and then writing the vector back to the file. I already (think) I have an efficient way of reading the file and turning its content into a vector but I'm still looking for an efficient way to write the resulting vector back to memory. </p>\n\n<p>The samples in the file are 24 bit integers (3 bytes) and I transform them to floats by normalizing them. </p>\n\n<p>I turn the file's content into a vector by reading all samples via <code>ByteString.hGet</code>. I can then simply use <code>Vector.generate</code> to convert every 3 bytes of the <code>ByteString</code> into a sample. </p>\n\n<p>My problem is with writing the result back to a file. At least I think there is a problem. I'm currently converting the vector and writing it to a file as follows:</p>\n\n<pre><code>import Data.Vector.Unboxed as U\nimport Data.ByteString as BS\n\nputSamples :: Handle -&gt; U.Vector Float -&gt; IO ()\nputSamples h vec = U.forM_ vec (BS.hPut h . BS.pack . unconvert 3 . Int)\n</code></pre>\n\n<p>As you can see, I first convert the <code>Float</code> back to an <code>Int</code> by de-normalizing it,turn the <code>Int</code> into 3 bytes via <code>unconvert 3</code>, <code>pack</code> the result into a <code>ByteString</code> of 3 bytes via <code>ByteString.pack</code> and then write the result to a handle via <code>ByteString.hPut</code>. </p>\n\n<p>This seems terribly inefficient because I'm calling <code>hPut</code> for every single sample. Is there a way to do this more efficiently?</p>\n"}, {"tags": ["haskell", "polymorphism", "lenses"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1495721220, "post_id": 44181679, "comment_id": 75379128, "body": "In general, you can&#39;t have two functions with the same name. You need to enable one of the GHC extensions for record overloading, or roll your own."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1495721494, "post_id": 44181679, "comment_id": 75379324, "body": "Looks like <code>fclabels</code> is not up for the task. <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a> has no problem with your code, and is generally better-suited for polymorphic updates. (Also, its Van Laarhoven style is increasingly becoming the standard, so if only for compatibility it might make sense to go that route.) \u2014 However, I wonder whether your ADT structure is really optimal... why not <code>data R a = R { _cb :: a, _cd :: Maybe a }</code>?"}, {"owner": {"reputation": 31, "user_id": 7998049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a963a750a68208a4c51245240c76e57?s=128&d=identicon&r=PG", "display_name": "Pavel Yakovlev", "link": "https://stackoverflow.com/users/7998049/pavel-yakovlev"}, "edited": false, "score": 0, "creation_date": 1495724435, "post_id": 44181679, "comment_id": 75381371, "body": "Thanks, I moved to <code>lens</code> and it works. Really I have 20 constructors with different fields and I really need the names of these constructors."}], "owner": {"reputation": 31, "user_id": 7998049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a963a750a68208a4c51245240c76e57?s=128&d=identicon&r=PG", "display_name": "Pavel Yakovlev", "link": "https://stackoverflow.com/users/7998049/pavel-yakovlev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1495718452, "creation_date": 1495718452, "question_id": 44181679, "link": "https://stackoverflow.com/questions/44181679/how-to-use-polymorphic-datatypes-with-fclabels", "title": "How to use polymorphic datatypes with fclabels?", "body": "<p><strong>TL;DR:</strong> I want to use <code>fclabels</code> with my polymorphic datatype, but obtaining wired errors with it.</p>\n\n<pre><code>data R a = A { cb :: a }\n         | B { cb :: a, cd :: a}\n  deriving (Show, Read, Eq)\n</code></pre>\n\n<p>So, my type is a sum off multiple variants with different number of fields. Some of the fields have the same names and it is important for me.\nWhen I am converting it to underscored version and run <code>mkLabel</code> template:</p>\n\n<pre><code>data R a = A { _cb :: a }\n         | B { _cb :: a, _cd :: a }\n  deriving (Show, Read, Eq)\n\nmkLabel ''R\n</code></pre>\n\n<p>I have some errors that I do not understand:</p>\n\n<pre><code>\u03bb :load AminoAcidLens.hs\n[1 of 1] Compiling AminoAcidLens    ( AminoAcidLens.hs, interpreted )\n\nAminoAcidLens.hs:13:1: error:\n    Multiple declarations of \u2018cb\u2019\n    Declared at: AminoAcidLens.hs:13:1\n                 AminoAcidLens.hs:13:1\n\nAminoAcidLens.hs:13:1: error:\n    Duplicate type signatures for \u2018cb\u2019\n    at AminoAcidLens.hs:13:1-11\n       AminoAcidLens.hs:13:1-11\n\nAminoAcidLens.hs:13:1: error:\n    Duplicate INLINE pragmas for \u2018cb\u2019\n    at AminoAcidLens.hs:13:1-11\n       AminoAcidLens.hs:13:1-11\nFailed, modules loaded: none.\n</code></pre>\n\n<p>If I change <code>_cd</code>s type to any other, the errors disappear:</p>\n\n<pre><code>data R a = A { _cb :: a }\n         | B { _cb :: a, _cd :: Int }\n  deriving (Show, Read, Eq)\n\nmkLabel ''R\n</code></pre>\n\n<p>So, why do I have these errors and how to fix them?</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "reply_to_user": {"reputation": 1032, "user_id": 3198508, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/0bef3ebf78397965521fd92ee63b95f5?s=128&d=identicon&r=PG&f=1", "display_name": "SouvikMaji", "link": "https://stackoverflow.com/users/3198508/souvikmaji"}, "edited": false, "score": 0, "creation_date": 1519792235, "post_id": 49021648, "comment_id": 85049074, "body": "After tried several times to solve the stupid indent error(yeah, I am using 2 spaces) in code formatting."}, {"owner": {"reputation": 653, "user_id": 8064601, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sT4-QUbS_ds/AAAAAAAAAAI/AAAAAAAAAL0/JqG5RWAXUxA/photo.jpg?sz=128", "display_name": "rilla", "link": "https://stackoverflow.com/users/8064601/rilla"}, "edited": false, "score": 0, "creation_date": 1519899414, "post_id": 49021648, "comment_id": 85099129, "body": "I already tried that, but if xmonad completely ingores that window, that terminal never gets focus so I cannot input text on it... Ideally I&#39;d like it to get focus when there&#39;s no other open window in that given workspace."}, {"owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "edited": false, "score": 0, "creation_date": 1520167134, "post_id": 49021648, "comment_id": 85195907, "body": "It might use some kinds of <code>hook</code>(not sure). I thought you serve the terminal as dynamic wallpaper"}], "tags": [], "owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "is_accepted": false, "score": 0, "last_activity_date": 1519789544, "creation_date": 1519789544, "answer_id": 49021648, "question_id": 44179026, "link": "https://stackoverflow.com/questions/44179026/terminal-as-transparent-wallpaper-in-xmonad/49021648#49021648", "title": "Terminal as transparent wallpaper in xmonad", "body": "<p>Basically, you can let <code>xmonad</code> ignore it, like what you did to <code>conky</code> or <code>plank</code>.</p>\n\n<p>my example (<a href=\"https://github.com/suzumiyasmith/MyXmonad/blob/d71796f9a72f98d4b97dcaebe9d4905841431b8b/src/xmonad.hs#L145\" rel=\"nofollow noreferrer\">https://github.com/suzumiyasmith/MyXmonad/blob/d71796f9a72f98d4b97dcaebe9d4905841431b8b/src/xmonad.hs#L145</a>)</p>\n\n<ol>\n<li>set a specific class name for that window.</li>\n<li>get the window via name or class query.</li>\n<li>ignore it.</li>\n</ol>\n"}], "owner": {"reputation": 653, "user_id": 8064601, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sT4-QUbS_ds/AAAAAAAAAAI/AAAAAAAAAL0/JqG5RWAXUxA/photo.jpg?sz=128", "display_name": "rilla", "link": "https://stackoverflow.com/users/8064601/rilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 530, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1519789544, "creation_date": 1495710399, "question_id": 44179026, "link": "https://stackoverflow.com/questions/44179026/terminal-as-transparent-wallpaper-in-xmonad", "title": "Terminal as transparent wallpaper in xmonad", "body": "<p>I recently switched to xmonad and I'm trying to pimp it up a bit. I'd like to set up a terminal as a transparent background (<a href=\"https://wiki.archlinux.org/index.php/Terminal_as_a_transparent_wallpaper\" rel=\"noreferrer\">https://wiki.archlinux.org/index.php/Terminal_as_a_transparent_wallpaper</a>).\nBasically, I'd need a window that sits on the bottom of each workspace, that cannot be moved, tiled or closed and gets focus only when it's the only window open in that workspace. So far, I've managed to make the window boring to get the focus behavior I want, but I cannot make it float and stay below everything else. Is there any way to accomplish it? Or maybe a way to doIgnore the window but allow focus on it to type commands?</p>\n"}, {"tags": ["postgresql", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1495705176, "post_id": 44176737, "comment_id": 75368832, "body": "Did you install the relevant package using <code>cabal install ...</code> ?"}, {"owner": {"reputation": 33, "user_id": 6350588, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fd8220a1e2fd0781a4c6e47855a55aeb?s=128&d=identicon&r=PG&f=1", "display_name": "marakatrin", "link": "https://stackoverflow.com/users/6350588/marakatrin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495706570, "post_id": 44176737, "comment_id": 75369662, "body": "Thank you, that was it. However, now I have a problem with installing it. When I use &quot;cabal install [URL]&quot; it complains about the data not being in tar format. Also, I&#39;m not sure, whether to use <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.0.0\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/postgresql-simple-0.5.0.0</a> or <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.0.0/src/\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/postgresql-simple-0.5.0.0/src</a>. I thought the latter one would be in tar format."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1495707369, "post_id": 44176737, "comment_id": 75370129, "body": "@marakatrin I would suggest you to use cabal sandbox. If you are just starting out and want a more intuitive experience, I would recommend using Stack."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 1, "creation_date": 1495709245, "post_id": 44176737, "comment_id": 75371249, "body": "I recommend stack as well. You should be able to use <code>cabal install PACKAGE_NAME</code> rather than specifying the url I believe. But probably the correct url would be <code>https:&#47;&#47;hackage.haskell.org&#47;package&#47;postgresql-simple-0.5.0.&zwnj;&#8203;0&#47;postgresql-simple-&zwnj;&#8203;0.5.0.0.tar.gz</code> in this case."}, {"owner": {"reputation": 33, "user_id": 6350588, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fd8220a1e2fd0781a4c6e47855a55aeb?s=128&d=identicon&r=PG&f=1", "display_name": "marakatrin", "link": "https://stackoverflow.com/users/6350588/marakatrin"}, "edited": false, "score": 0, "creation_date": 1495790972, "post_id": 44176737, "comment_id": 75409210, "body": "I&#39;m starting to get really desperate now. However I try to install  the package, I always get some error. When I try cabal install postgressql-simple, I get &quot;cabal: Error: some packages failed to install: postgresql-libpq-0.9.3.1 failed during the configure step. The exception was: ExitFailure 1 postgresql-simple-0.5.3.0 depends on postgresql-libpq-0.9.3.1 which failed to install.&quot; . When I try using Stack, it tells me I have no space left."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1495817705, "post_id": 44176737, "comment_id": 75425733, "body": "@marakatrin I suggest you seek more interactive help, such as on irc.freenode.net #haskell.  If you are out of space then that&#39;s obviously a problem you&#39;ll have to take care of.  Notice postgresql-libpq requires postgres system packages to be installed, such as <code>postgresql-server-dev-9.5</code> on Ubuntu."}], "owner": {"reputation": 33, "user_id": 6350588, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fd8220a1e2fd0781a4c6e47855a55aeb?s=128&d=identicon&r=PG&f=1", "display_name": "marakatrin", "link": "https://stackoverflow.com/users/6350588/marakatrin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495717570, "creation_date": 1495703777, "last_edit_date": 1495717570, "question_id": 44176737, "link": "https://stackoverflow.com/questions/44176737/connecting-haskell-to-postgres-module-not-found", "title": "Connecting Haskell to Postgres: Module not found", "body": "<p>I want to access a Postgres database via a Haskell function. I found this <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.0.0/candidate/docs/Database-PostgreSQL-Simple.html#g:8\" rel=\"nofollow noreferrer\">tutorial</a>, however, whenever I try to apply this code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Database.PostgreSQL.Simple\n\nhello :: IO Int\nhello = do\n  conn &lt;- connectPostgreSQL \"\"\n  [Only i] &lt;- query_ conn \"select 2 + 2\"\n  return i\n</code></pre>\n\n<p>it tells me \"Could not find module 'Database.PostreSQL.Simple'. \nWhy does this happen and how do I fix it?</p>\n\n<p>Thanks for your answers beforehand.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1495700634, "post_id": 44174573, "comment_id": 75366204, "body": "Does this work: <code>stack build pkgname --flag pkgname:buildAll</code> ?"}, {"owner": {"reputation": 403, "user_id": 6872977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Da7XT.jpg?s=128&g=1", "display_name": "Rom&#225;n Garc&#237;a", "link": "https://stackoverflow.com/users/6872977/rom%c3%a1n-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1495726515, "post_id": 44174573, "comment_id": 75382772, "body": "Have you tried: <code>--force-dirty</code>? to force rebuild of packages even when it doesn&#39;t seem necessary based on file dirtiness."}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495696742, "creation_date": 1495696742, "question_id": 44174573, "link": "https://stackoverflow.com/questions/44174573/changing-global-cabal-flags-from-the-command-line-with-stack", "title": "Changing Global Cabal Flags from the Command Line with Stack", "body": "<p>From a project's cabal file:</p>\n\n<pre><code>flag buildAll\n  Description: Build all programs\n  Default:     False\n</code></pre>\n\n<p>I wanted to set this to true from the <code>stack build &lt;executable&gt;</code> perspective. I tried using <code>--flag buildAll</code> and it didn't work. Must you change this from <code>False</code> to <code>True</code> within the cabal file, or is there a way to change the flag from the command line?</p>\n"}, {"tags": ["haskell", "sudoku"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 1, "last_activity_date": 1495697380, "creation_date": 1495697380, "answer_id": 44174797, "question_id": 44172919, "link": "https://stackoverflow.com/questions/44172919/optimising-a-sudoku-solving-method/44174797#44174797", "title": "Optimising a sudoku solving method", "body": "<p>First let me wrap your code in some boilerplate, so we can run\nsomething easily:</p>\n\n<pre><code>module RandomNoise where\n\nimport Data.Maybe\nimport Data.List\n\ntype Pos = (Int, Int)\ntype Sudoku = String\n\ntoString :: Sudoku -&gt; String\ntoString = id\n\nfromString :: String -&gt; Sudoku\nfromString = id\n\nblank :: Sudoku -&gt; Pos\nblank sudoku\n  | elem '.' $ toString sudoku = (positInRow `div` 9, positInRow `mod` 9)\n  | otherwise = error \"no blanks\"\n  where\n    positInRow = fromJust $ elemIndex '.' $ toString sudoku\n\nnextBlank :: Sudoku -&gt; Pos -&gt; Pos\nnextBlank sudoku (x, y)\n  | elem '.' $ drop (x*9+y) $ toString sudoku = blank (fromString $ drop (x*9+y) $ toString sudoku)\n  | otherwise = error \"no blanks\"\n\ntestSudoku = \"uiae.uiae.uiae.uiae\"\n\nfirstBlank = blank testSudoku\nsecondBlankOrNot = nextBlank testSudoku firstBlank\n</code></pre>\n\n<p>If you fire up your ghci and load a file with that content,\nyou can see, that</p>\n\n<pre><code>firstBlank = (0,4)\nsecondBlank = (0,0)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>drop (0*9+4) testSudoku\n</code></pre>\n\n<p>yields</p>\n\n<pre><code>\".uiae.uiae.uiae\"\n</code></pre>\n\n<p>So there are several issues here.</p>\n\n<ol>\n<li>You don't drop enough letters from the string. You need to drop the blank specified by the position too.</li>\n<li>In nextBlank you will need to add the length of the dropped string to the indexes determined in blank before turning them into a position, otherwise you will get some garbage position which is somehow relative to the position of the last blank. I advise to work with indexes into the string representation and calculate the position as a last step in a separate function.</li>\n</ol>\n"}], "owner": {"reputation": 315, "user_id": 7940372, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e5744471a061ee3bf3a29ce9bb5a4a7?s=128&d=identicon&r=PG&f=1", "display_name": "420fedoras", "link": "https://stackoverflow.com/users/7940372/420fedoras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1495697380, "creation_date": 1495690098, "question_id": 44172919, "link": "https://stackoverflow.com/questions/44172919/optimising-a-sudoku-solving-method", "title": "Optimising a sudoku solving method", "body": "<p>Making a sudoku solver for an assignment, I have run into a problem in solving blank cells of the sudoku. I can solve cells with unique solutions easily, but when I encounter cells with multiple solutions (in the sudoku's current state), I want to move on to the next blank to try fill in as much of the sudoku as possible before having to \"try\" values and branch out my solutions accordingly.</p>\n\n<p>My problem is that I do not know how to keep track of which blank value I am up to.</p>\n\n<pre><code>blank :: Sudoku -&gt; Pos\nblank sudoku\n  | elem '.' $ toString sudoku = ( (positInRow `div` 9), (positInRow `mod` 9) )\n  | otherwise = error \"no blanks\"\n    where\n      positInRow = fromJust $ elemIndex '.' $ toString sudoku\n\nnextBlank :: Sudoku -&gt; Pos -&gt; Pos\nnextBlank sudoku (x, y)\n  | elem '.' $ drop (x*9+y) $ toString sudoku = blank (fromString $ drop (x*9+y) $ toString sudoku)\n  | otherwise = error \"no blanks\"\n</code></pre>\n\n<p>Here is my attempted solution, but if I try to recursively solve a sudoku, it would get stuck in an infinite loop finding the same \"nextBlank\" if the original next blank doesn't update a value on the sudoku.</p>\n\n<p>Is there a way to implement this function properly?</p>\n"}, {"tags": ["haskell", "data-structures", "tree", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1495687725, "post_id": 44170832, "comment_id": 75360341, "body": "Instead of storing the depth in each node, try storing the size (or number of left children)."}, {"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1495690042, "post_id": 44170832, "comment_id": 75361062, "body": "Just figured it out. Turns out you don&#39;t need to store the size (can be calculated based on depth information)"}, {"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1495690196, "post_id": 44170832, "comment_id": 75361122, "body": "@Bergi This is only applicable for red black trees. For other trees you have to store the node count."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495737162, "post_id": 44170832, "comment_id": 75388818, "body": "Why is this tagged with &#39;haskell&#39;?"}, {"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "edited": false, "score": 0, "creation_date": 1495739342, "post_id": 44170832, "comment_id": 75389936, "body": "Because Haskell programmers love this."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1495744819, "post_id": 44170832, "comment_id": 75392779, "body": "That doesn&#39;t seem like a good enough reason to add a tag."}], "answers": [{"tags": [], "owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "is_accepted": true, "score": 1, "last_activity_date": 1495690085, "creation_date": 1495690085, "answer_id": 44172914, "question_id": 44170832, "link": "https://stackoverflow.com/questions/44170832/access-tree-with-ordinal-index/44172914#44172914", "title": "Access tree with ordinal index", "body": "<p>I wrote everything down on a napkin and figured it out. For red black tree you do not need to track the number of nodes on the left because if it's right biased (should be) then the number of left nodes will always form a mersenne series ( 1, 3, 7, 15, 31 ...) or <code>2^depth -1</code>.</p>\n\n<p>With that in mind we can write down the logic to recursively get the node. This is the correct implementation in elixir. For <a href=\"https://github.com/rickyhan/rbtree/blob/master/lib/rbtree.ex\" rel=\"nofollow noreferrer\">package</a></p>\n\n<pre><code>def nth(%Rbtree{node: r}, n), do: do_nth(r, n)\ndefp do_nth({_,h,k,v,l,r}, n) do\n  l_count = left_count(h)\n  cond do\n    l_count &gt; n -&gt;\n      case l do\n        nil -&gt; {k,v}\n        _ -&gt; do_nth(l, n)\n      end\n    l_count == n -&gt; {k,v}\n    true -&gt;\n      case r do\n        nil -&gt; {k,v}\n        _ -&gt; do_nth(r, n - l_count - 1)\n      end\n  end\nend\ndefp left_count(1), do: 0\ndefp left_count(0), do: 0\ndefp left_count(h), do: :math.pow(2,h-1)-1 |&gt; round\n</code></pre>\n"}], "owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 44172914, "answer_count": 1, "score": 0, "last_activity_date": 1495690085, "creation_date": 1495675125, "last_edit_date": 1495675483, "question_id": 44170832, "link": "https://stackoverflow.com/questions/44170832/access-tree-with-ordinal-index", "title": "Access tree with ordinal index", "body": "<p>I have a right-biased red-black tree structure that will always be some shape given the total number of elements.</p>\n\n<p>Given the size of elements <code>k</code> and an ordinal element <code>n</code>, how to write a function to get the n-th element in the tree of size <code>k</code>?</p>\n\n<pre><code>(size:1)\nblack { 1, 1 }(d:1)\n+ \n+ \n\n\n(size:2)\nblack { 1, 1 }(d:1)\n+ \n+ red { 2, 2 }(d:1)\n  + \n  + \n\n\n(size:3)\nblack { 2, 2 }(d:2)\n+ black { 1, 1 }(d:1)\n  + \n  + \n+ black { 3, 3 }(d:1)\n  + \n  + \n\n\n(size:4)\nblack { 2, 2 }(d:2)\n+ black { 1, 1 }(d:1)\n  + \n  + \n+ black { 3, 3 }(d:1)\n  + \n  + red { 4, 4 }(d:1)\n    + \n    + \n\n\n(size:5)\nblack { 2, 2 }(d:2)\n+ black { 1, 1 }(d:1)\n  + \n  + \n+ red { 4, 4 }(d:2)\n  + black { 3, 3 }(d:1)\n    + \n    + \n  + black { 5, 5 }(d:1)\n    + \n    + \n\n\n(size:6)\nblack { 2, 2 }(d:2)\n+ black { 1, 1 }(d:1)\n  + \n  + \n+ red { 4, 4 }(d:2)\n  + black { 3, 3 }(d:1)\n    + \n    + \n  + black { 5, 5 }(d:1)\n    + \n    + red { 6, 6 }(d:1)\n      + \n      + \n\n\n(size:7)\nblack { 4, 4 }(d:3)\n+ black { 2, 2 }(d:2)\n  + black { 1, 1 }(d:1)\n    + \n    + \n  + black { 3, 3 }(d:1)\n    + \n    + \n+ black { 6, 6 }(d:2)\n  + black { 5, 5 }(d:1)\n    + \n    + \n  + black { 7, 7 }(d:1)\n    + \n    + \n\n\n(size:8)\nblack { 4, 4 }(d:3)\n+ black { 2, 2 }(d:2)\n  + black { 1, 1 }(d:1)\n    + \n    + \n  + black { 3, 3 }(d:1)\n    + \n    + \n+ black { 6, 6 }(d:2)\n  + black { 5, 5 }(d:1)\n    + \n    + \n  + black { 7, 7 }(d:1)\n    + \n    + red { 8, 8 }(d:1)\n      + \n      + \n\n\n(size:9)\nblack { 4, 4 }(d:3)\n+ black { 2, 2 }(d:2)\n  + black { 1, 1 }(d:1)\n    + \n    + \n  + black { 3, 3 }(d:1)\n    + \n    + \n+ black { 6, 6 }(d:2)\n  + black { 5, 5 }(d:1)\n    + \n    + \n  + red { 8, 8 }(d:2)\n    + black { 7, 7 }(d:1)\n      + \n      + \n    + black { 9, 9 }(d:1)\n      + \n      + \n\n\n(size:10)\nblack { 4, 4 }(d:3)\n+ black { 2, 2 }(d:2)\n  + black { 1, 1 }(d:1)\n    + \n    + \n  + black { 3, 3 }(d:1)\n    + \n    + \n+ black { 6, 6 }(d:2)\n  + black { 5, 5 }(d:1)\n    + \n    + \n  + red { 8, 8 }(d:2)\n    + black { 7, 7 }(d:1)\n      + \n      + \n    + black { 9, 9 }(d:1)\n      + \n      + red { 10, 10 }(d:1)\n        + \n        + \n</code></pre>\n"}, {"tags": ["bash", "haskell", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495671899, "post_id": 44170394, "comment_id": 75356638, "body": "With types you mean <code>data X = ...</code> or also <i>type aliasses</i> (<code>type Foo = [Bar]</code>, etc.)?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1495672306, "post_id": 44170394, "comment_id": 75356765, "body": "All of them: <code>data</code> declarations, <code>newtype</code> declarations, <code>type</code> synonym declarations, and I&#39;m sure I&#39;m forgetting other ways to create types as well."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1495676676, "post_id": 44170394, "comment_id": 75357813, "body": "Would <code>egrep &#39;^(data|newtype|type)\\b&#39; **&#47;*.hs</code> work?  Kind of a blunt instrument, but should basically do the right thing\u2026"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1495681505, "post_id": 44170394, "comment_id": 75358710, "body": "As a first approximation that is good, but it doesn&#39;t capture generated types from C FFI generators, or Template Haskell, etc. It also doesn&#39;t capture types definitions that might be split across more than 1 line (although yes that is rare)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495705513, "post_id": 44170394, "comment_id": 75369016, "body": "One could <code>:browse</code> each module from GHCi, but if there are many modules this could be cumbersome. Another option is to use haddock to generate the docs, and then read those. Both these methods will report about all the declared entities: types, bindings, classes, etc."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1495706699, "post_id": 44170394, "comment_id": 75369731, "body": "@chi: Does haddock generate docs for types that you haven&#39;t annotated and/or require lots of preparation before doc generation? Or is it automated to the point of only requiring a few commands?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495709631, "post_id": 44170394, "comment_id": 75371490, "body": "@George It&#39;s been a while since I used it, but I think it collects everything exported (or with some hint, maybe more). If you don&#39;t annotate stuff you should still get the unannotated docs, I think."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 1, "creation_date": 1495709948, "post_id": 44170394, "comment_id": 75371697, "body": "Haddock generates documentation for all exported members of a module."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 1, "creation_date": 1495710233, "post_id": 44170394, "comment_id": 75371861, "body": "Just discovered a promising option to <code>haddock</code>, namely <code>--hoogle</code>. It will output haddock documentation in plain-text. Perhaps with a bit of hacking you could achieve what you want with this."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1495741424, "post_id": 44170394, "comment_id": 75391041, "body": "@chi: <code>:browse</code> will also output re-exported things, though \u2013 it gets you most of the way there, but not quite (or rather, but a little more)"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1496027600, "creation_date": 1496027600, "answer_id": 44234131, "question_id": 44170394, "link": "https://stackoverflow.com/questions/44170394/finding-all-types-created-in-a-haskell-repo/44234131#44234131", "title": "Finding All Types Created in a Haskell Repo", "body": "<p>If you run <code>haddock --hoogle</code>, it will create a file with exactly one line per module, type, constructor, typeclass, instance, or function (including Template Haskell-generated definitions). So grepping for <code>^(data|type|newtype|class)</code> in its output should provide you with exactly what you are looking for.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496027600, "creation_date": 1495671561, "question_id": 44170394, "link": "https://stackoverflow.com/questions/44170394/finding-all-types-created-in-a-haskell-repo", "title": "Finding All Types Created in a Haskell Repo", "body": "<p>Is there a way, using GHCi or even just Bash, to find a list of all types created (i.e., not imported from other libraries) in a Haskell repository?</p>\n\n<p><strong>BONUS:</strong> Could one also do something similar to get a list of all Haskell typeclasses created in a repo?</p>\n"}, {"tags": ["haskell", "graphics", "opengl-es", "window-managers"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1495771137, "post_id": 44170311, "comment_id": 75400288, "body": "Presumably a TextureBlitter is something that blits textures, and you could easily look up that a <code>Program</code> is an OpenGL shader program, and an <code>AttribLocation</code> is a reference to a vertex attribute in the program, and a <code>UniformLocation</code> is a reference to a uniform in the program."}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1495776984, "post_id": 44184225, "comment_id": 75402081, "body": "Doesn&#39;t &quot;to blit&quot; mean &quot;to copy a framebuffer though&quot;? Or does it also mean &quot;to copy a picture onto a screen, via a shader (fed vertex coordinates + a texture) transformed by a matrix&quot;?"}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1495843859, "post_id": 44184225, "comment_id": 75435493, "body": "The origin of the word &quot;blit&quot; can be read <a href=\"https://en.wikipedia.org/wiki/Bit_blit\" rel=\"nofollow noreferrer\">here</a>. I suppose a broad meaning is &quot;copy an image onto the screen, no matter how&quot;"}], "tags": [], "owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "is_accepted": false, "score": 0, "last_activity_date": 1495726028, "creation_date": 1495726028, "answer_id": 44184225, "question_id": 44170311, "link": "https://stackoverflow.com/questions/44170311/understanding-what-a-textureblitter-is-in-this-haskell-graphics-program/44184225#44184225", "title": "Understanding What a TextureBlitter is in this Haskell Graphics Program", "body": "<p>I don't use haskell nor its OpenGL package. But the names and shaders you expose are pretty descriptive. I'll try to explain what a <em>texture</em> is in OpenGL parlance.\n<p>Let's say you have a picture of size width x height. Let's suppose it's saved in a two-dimension, <code>[w,h]</code> sized, matrix.\n<br>Instead of accesing a pixel in that matrix by its a,b coordinates let's use <em>normalized</em> coordinates (i.e. in [0-1] range): <code>u= a/w</code> and <code>v= b/h</code>. These formulas need <code>u</code> and <code>v</code> of type <code>float</code> so no rounding to integer is done.\n<p>Using <code>u,v</code> coordinates allows us to access any pixel in a \"generic\" matrix.\n<p>Now you want to show that picture on the screen. It's rectangle can be scaled, rotated or even deformed by a perspective projection. Somehow you know the final four coordinates of that rectangle.\n<p>If you use also <em>normalized</em> coordinates (again in [0-1] range) then a <em>mapping</em> between picture coordinates and rectangle coordinates makes the picture to adjust to the [likely deformed] rectangle.\n<p>This is how OpenGL works. You pass the <strong>vertices</strong> of the rectangle and compute their normalized final coordinates by the use of some <strong>matrix</strong>. You also pass the picture matrix (called <strong><em>texture</em></strong>) and map it to those final coordinates.\n<p>The programm where all of this computing and mapping is done is a <em>shader</em>, which usually is composed by two sub-shaders: a Vertex Shader that works vertex by vertex (the VS runs exactly once per vertex); and a Fragment Shader that works with <em>fragments</em> (interpolated points between vertices).</p>\n\n<p><p><strong>TextureBlitter</strong> or \"an object that blits a picture onto the screen\"<br></p>\n\n<ul>\n<li>You set the program (shader) to use. You can have several shaders\nwith different effects (e.g. modifying the colors of the picture). Just    select one.</li>\n<li>Set the vertices. The <code>AttribLocation</code> represents the point of\nconnection between your vertices and the shader that uses it\n(<em>attribute</em> in shaders parlance).</li>\n<li>Same for \"picture\" coordinates.</li>\n<li>Set the matrix that transform the vertices. Because it's the same for\nall vertices, another type of connection is used: <code>UniformLocation</code> (an\n<em>uniform</em> in shaders parlance).</li>\n</ul>\n\n<p>I suppose you can find a good tutorial with examples for how to set and use this \"texture blitter\".</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1495726899, "creation_date": 1495670938, "last_edit_date": 1495726899, "question_id": 44170311, "link": "https://stackoverflow.com/questions/44170311/understanding-what-a-textureblitter-is-in-this-haskell-graphics-program", "title": "Understanding What a TextureBlitter is in this Haskell Graphics Program", "body": "<p>In a private window manager/compositor Haskell repository I have come across the following datatype which I am trying to understand:</p>\n\n<pre><code>data TextureBlitter = TextureBlitter {\n  _textureBlitterProgram :: Program,                  -- OpenGL Type\n  _textureBlitterVertexCoordEntry :: AttribLocation,  -- OpenGL Type\n  _textureBlitterTextureCoordEntry :: AttribLocation, -- OpenGL Type\n  _textureBlitterMatrixLocation :: UniformLocation    -- OpenGL Type\n  } deriving Eq\n</code></pre>\n\n<p>The types <code>Program</code>, <code>AttribLocation</code>, and <code>UniformLocation</code> are from this <a href=\"http://hackage.haskell.org/package/OpenGL-3.0.2.0/docs/doc-index-All.html\" rel=\"nofollow noreferrer\">OpenGL library</a>.</p>\n\n<p><strong>The Problem:</strong> I cannot find good information online about what the concept of a \"texture blitter\" is. So I'm hoping that people with more expertise might immediately  have a good guess as to what this type is (probably) used for.</p>\n\n<p>I'm assuming that the field <code>_textureBlitterProgram :: Program</code> is an OpenGL shader program. But what about the other entries? And what is a <code>TextureBlitter</code> as a whole supposed to represent?</p>\n\n<p><strong>EDIT:</strong> I have discovered in my repo shaders with the same name:</p>\n\n<pre><code>//textureblitter.vert\n#version 300 es\nprecision highp float;\n\nuniform highp mat4 matrix;\nin highp vec3 vertexCoordEntry;\nin highp vec2 textureCoordEntry;\nout highp vec2 textureCoord;\nvoid main() {\n   textureCoord = textureCoordEntry;\n   gl_Position = matrix * vec4(vertexCoordEntry, 1.);\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>//textureblitter.frag\n#version 300 es\nprecision highp float;\n\nuniform sampler2D uTexSampler;\nin highp vec2 textureCoord;\nout highp vec4 fragmentColor;\n\nvoid main() {\n   fragmentColor = texture2D(uTexSampler, textureCoord);\n}\n</code></pre>\n"}]