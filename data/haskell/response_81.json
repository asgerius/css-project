[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1469653370, "post_id": 38623071, "comment_id": 64631816, "body": "Haskell performs instance resolution before looking at constraints, so you have actually defined an instance <code>forall f b. Num (f b)</code>, which is extremely general, and probably isn\u2019t what you want. Constraints are only checked <i>after</i> an instance is chosen."}, {"owner": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469710131, "post_id": 38623071, "comment_id": 64656678, "body": "Yes this is surely not what I want. Any idea how to solve this ?"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1491078335, "post_id": 38623071, "comment_id": 73398141, "body": "It may be what you are asking for, but delivering what you ask for here, comes at a high high cost. No other Num instances on anything of kind * -&gt; *. A better mechanism is to make a <code>newtype ANum f a = ANum (f a)</code> and then bake your instance into the newtype. Then you don&#39;t conflict with every other possible num instance on something of kind * -&gt; * anybody will ever write, and users can wrap up their data into a form compatible with your usecases. Consider <code>newtype Poly a = Poly [a]</code> it will overlap with your instance, but certainly shouldn&#39;t be done using the applicative for []`!"}], "answers": [{"comments": [{"owner": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "edited": false, "score": 0, "creation_date": 1469712029, "post_id": 38624410, "comment_id": 64658253, "body": "My declaration of <code>Num</code> for <code>Applicative</code> is canonical. I lift the numerical operation on a pointwise way. <code>M.Map k n</code> is just a function from <code>k</code> to <code>n</code> so it also makes perfect sense to define the operation point-wise on it. Looking closer at the code in <code>Additive</code> the declaration for <code>M.Map</code> is pretty similar to mine. However I don&#39;t like because it gives <code>M.Map Int Char</code> an addition which makes no sense to me. Also I do not refer to the Ring structure, I see <code>Num</code> as a low-level category that allows the computer to perform basic computations on those object which is exactly what I want."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "edited": false, "score": 0, "creation_date": 1469716428, "post_id": 38624410, "comment_id": 64661905, "body": "How is <code>Num</code> a <a href=\"https://en.wikipedia.org/wiki/Category_(mathematics)\" rel=\"nofollow noreferrer\">category</a>? That really doesn&#39;t make sense to me. \u2014 <code>Additive</code> doesn&#39;t give <code>Map Int Char</code> an addition, what gave you that impression? It only lifts <code>Num</code> instances to pointwise-Num operations within some functor, i.e. exactly what you need."}, {"owner": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "edited": false, "score": 0, "creation_date": 1469718627, "post_id": 38624410, "comment_id": 64663653, "body": "Well <code>Num</code> is collections of sets so I&#39;ve got the habit of calling it a category even in this case the morphisms are trivial. I got this feeling because of the declaration <code>instance Ord k =&gt; Additive (Map k) where</code> which made me think that <code>Map Int b</code> should be additive for any <code>b</code>. But I understood why I was wrong. Haskell syntax is still a bit unfamiliar for me so it took me a while to understand what this was actually doing and this is pretty elegant. Thank you for pointing out!"}, {"owner": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "edited": false, "score": 0, "creation_date": 1469728966, "post_id": 38624410, "comment_id": 64670431, "body": "In fact the answer is only partially satisfactory. I can indeed add up to <code>Map k Int</code> by using <code>^+^</code> but I cannot add up functions <code>a -&gt; Map k Int</code> while a proper lift would authorize me to do it. Do you have any workaround ?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1469738499, "last_edit_date": 1469738499, "creation_date": 1469659542, "answer_id": 38624410, "question_id": 38623071, "link": "https://stackoverflow.com/questions/38623071/making-data-lazy-map-an-instance-of-num/38624410#38624410", "title": "Making Data.Lazy.Map an instance of Num", "body": "<p>Why do people always think that it's a good idea to define this kind of instances?</p>\n\n<p>Type classes are all about allowing to <em>safely write generic functions</em>. This works by specifying certain methods <em>and clear laws about how they should play together</em>. Like, the monad laws etc..<br><code>Num</code> basically represents the mathematical concept of a <a href=\"https://en.wikipedia.org/wiki/Ring_(mathematics)\" rel=\"nofollow\">ring</a>, plus a somewhat halfheartedly-done approach to define a <a href=\"https://en.wikipedia.org/wiki/Metric_space\" rel=\"nofollow\">metric</a>. This only works well if you actually limit it to <em>number types</em>. General <em>collections of numbers</em>, like with your <code>Applicative</code> instance, may not obey these laws at all.</p>\n\n<p>So, just stay away from such instances. I suspect the way you're trying to use them has nothing to do with generic algorithms anyway... if you just want to have a consise operator name for <code>M.unionWith (+)</code> then you're abusing type classes. You can just define a plain monomorphic operator <code>(+&lt;)</code> (or, at least, not ad-hoc-polymorphic \u2013 it's probably ok if it works on <code>(Num n, Ord k) =&gt; M.Map k n</code>) or something like that.</p>\n\n<p>If you think you do need class polymorphism, then look for the right classes! <a href=\"http://hackage.haskell.org/package/linear-1.20.5/docs/Linear-Vector.html#t:Additive\" rel=\"nofollow\"><code>Additive</code></a> might make sense. And behold, <a href=\"http://hackage.haskell.org/package/linear-1.20.5/docs/src/Linear-Vector.html#line-269\" rel=\"nofollow\">it actually has an instance for <code>Map</code></a> already...</p>\n\n<hr>\n\n<p>I should mention a third possibility, which is actually what I normally recommend <em>and</em> is in a sense closer to your <code>Num</code> instance ideas: the <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow\"><code>VectorSpace</code> class</a>. Like <code>Num</code>, this is actually a class of value-types, not of functors, but unlike <code>Num</code> it doesn't have that <code>abs</code> etc. fuzz.</p>\n\n<p>Unlike <code>Additive</code>, this package doesn't ship with a <code>Map</code> instance, but there's <a href=\"http://hackage.haskell.org/package/vector-space-map-0.2.0/docs/Data-Map-Vector.html\" rel=\"nofollow\">a dedicated type</a> for just tha And a function instance is standard, so, with vector-space's <code>^+^</code> you can in fact add up <code>a -&gt; Map k Int</code> values.</p>\n"}], "owner": {"reputation": 217, "user_id": 5849249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25df1c8663346da249c1c838143d59ca?s=128&d=identicon&r=PG&f=1", "display_name": "Ronan", "link": "https://stackoverflow.com/users/5849249/ronan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 38624410, "answer_count": 1, "score": 0, "last_activity_date": 1469738499, "creation_date": 1469653153, "question_id": 38623071, "link": "https://stackoverflow.com/questions/38623071/making-data-lazy-map-an-instance-of-num", "title": "Making Data.Lazy.Map an instance of Num", "body": "<p>In a project I need quite often to sum up lists and hash. I ended up with the two following declarations of <code>Num</code> instances</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nmodule Tweak where\nimport Data.List\nimport qualified Data.Map.Lazy as M\nimport Control.Applicative\n\ninstance (Applicative f, Num b) =&gt; Num (f b) where\n  negate      = fmap negate\n  (+)         = liftA2 (+)\n  (*)         = liftA2 (*)\n  fromInteger = pure . fromInteger\n  abs         = fmap abs\n  signum      = fmap signum\n\ninstance (Ord k, Num b) =&gt; Num(M.Map k b) where\n  negate      = fmap negate\n  (+)         = M.unionWith (+)\n  (*)         = M.unionWith (*)\n  fromInteger = undefined\n  abs         = fmap abs\n  signum      = fmap signum\n</code></pre>\n\n<p>Running this <code>(M.fromList [(2 :: Int, 3 :: Int)]) + (M.fromList [(1, 2)])\n</code> in ghci produces the following error</p>\n\n<pre><code>&lt;interactive&gt;:2:37:\n    Overlapping instances for Num (M.Map Int Int)\n      arising from a use of \u2018+\u2019\n    Matching instances:\n      instance (Ord k, Num b) =&gt; Num (M.Map k b)\n        -- Defined at Tweak.hs:15:10\n      instance (Applicative f, Num b) =&gt; Num (f b)\n        -- Defined at Tweak.hs:7:10\n    In the expression:\n      (M.fromList [(2 :: Int, 3 :: Int)]) + (M.fromList [(1, 2)])\n    In an equation for \u2018it\u2019:\n        it = (M.fromList [(2 :: Int, 3 :: Int)]) + (M.fromList [(1, 2)])\n</code></pre>\n\n<p>If I understand the error Haskell believes that <code>M.Map Int</code> is an instance of <code>Applicative</code>. Which seems not to be the case. <code>:i M.Map Int</code> yields</p>\n\n<pre><code>type role M.Map nominal representational\ndata M.Map k a\n  = containers-0.5.6.2:Data.Map.Base.Bin {-# UNPACK #-}containers-0.5.6.2:Data.Map.Base.Size\n                                         !k\n                                         a\n                                         !(M.Map k a)\n                                         !(M.Map k a)\n  | containers-0.5.6.2:Data.Map.Base.Tip\n    -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance (Ord k, Num b) =&gt; Num (M.Map k b)\n  -- Defined at Tweak.hs:15:10\ninstance (Eq k, Eq a) =&gt; Eq (M.Map k a)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance Functor (M.Map k)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance (Ord k, Ord v) =&gt; Ord (M.Map k v)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance (Ord k, Read k, Read e) =&gt; Read (M.Map k e)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance (Show k, Show a) =&gt; Show (M.Map k a)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance Foldable (M.Map k)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance Traversable (M.Map k)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ninstance Ord k =&gt; Monoid (M.Map k v)\n  -- Defined in \u2018containers-0.5.6.2:Data.Map.Base\u2019\ndata Ability = ... | Int | ...  -- Defined at Character.hs:60:41\n\ndata Int = GHC.Types.I# GHC.Prim.Int#   -- Defined in \u2018GHC.Types\u2019\ninstance Bounded Int -- Defined in \u2018GHC.Enum\u2019\ninstance Enum Int -- Defined in \u2018GHC.Enum\u2019\ninstance Eq Int -- Defined in \u2018GHC.Classes\u2019\ninstance Integral Int -- Defined in \u2018GHC.Real\u2019\ninstance Num Int -- Defined in \u2018GHC.Num\u2019\ninstance Ord Int -- Defined in \u2018GHC.Classes\u2019\ninstance Read Int -- Defined in \u2018GHC.Read\u2019\ninstance Real Int -- Defined in \u2018GHC.Real\u2019\ninstance Show Int -- Defined in \u2018GHC.Show\u2019\n</code></pre>\n\n<p>I really don't understand this error. Any help will be very welcome.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469644696, "post_id": 38620651, "comment_id": 64627256, "body": "The monoid structure comes from <code>Max</code>"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1469644940, "post_id": 38620651, "comment_id": 64627413, "body": "see <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html#%23\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a>."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469645184, "post_id": 38620651, "comment_id": 64627565, "body": "And <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html#Max\" rel=\"nofollow noreferrer\">Max</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1469645203, "post_id": 38620651, "comment_id": 64627576, "body": "<code>(#.)</code> is just an optimized version of the composition operator <code>(.)</code> which only works in some cases, such as in <code>Max . Just</code>. Pretend it&#39;s plain composition, and note that <code>Max a</code> is a monoid with binary &quot;max&quot; for its operation (roughly, there&#39;s a <code>Maybe</code> wrapper so that we can define the unity to be <code>Nothing</code>)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1469646075, "post_id": 38620651, "comment_id": 64628069, "body": "you&#39;ll need the <code>MagicHash</code> extension for (<code>#.</code>) to be syntactically valid, and then you&#39;ll need to import it from wherever it&#39;s exposed"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1469649119, "post_id": 38620651, "comment_id": 64629664, "body": "@jberryman, no you don&#39;t. But you need <code>:t (#.)</code>, not <code>:t #.</code>. And it&#39;s normally imported from <code>Data.Profunctor.Unsafe</code>, but <code>Data.Foldable</code> has its own specialized copy."}, {"owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469652038, "post_id": 38620651, "comment_id": 64631156, "body": "@dfeuer that doesn&#39;t work either on my machine..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469652678, "post_id": 38620651, "comment_id": 64631475, "body": "@user3726947, you&#39;re going to have to be a lot more specific about what error you get."}, {"owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "edited": false, "score": 0, "creation_date": 1469655796, "post_id": 38620651, "comment_id": 64633000, "body": "it tells me: not in scope &#39;#.&#39; perhaps you meant &#39;.&#39;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469656611, "post_id": 38620651, "comment_id": 64633379, "body": "If you have the <code>profunctors</code> package installed, you need to import <code>Data.Profunctor.Unsafe</code> (like I mentioned). If not, you should consider installing it."}, {"owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "edited": false, "score": 0, "creation_date": 1469691048, "post_id": 38620651, "comment_id": 64643665, "body": "ah ok now it works, I thought it suffices to import Data.Foldable"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1469651431, "last_edit_date": 1469651431, "creation_date": 1469650195, "answer_id": 38622312, "question_id": 38620651, "link": "https://stackoverflow.com/questions/38620651/implementation-of-maximum-in-haskell/38622312#38622312", "title": "Implementation of maximum in haskell", "body": "<p><code>#.</code> is an operator that can make coercions easier to use.</p>\n\n<pre><code>f #. g\n</code></pre>\n\n<p>means</p>\n\n<blockquote>\n  <p><code>g</code>, coerced to the type of <code>f . g</code></p>\n</blockquote>\n\n<p>Similarly,</p>\n\n<pre><code>f .# g\n</code></pre>\n\n<p>means</p>\n\n<blockquote>\n  <p><code>f</code>, coerced to the type of <code>f . g</code></p>\n</blockquote>\n\n<p>In most cases, <code>f #. g</code> only makes sense if <code>f</code> is some combination of newtype constructors, newtype accessors, and <code>fmap</code>.</p>\n\n<p>The reason for using <code>#.</code> in <code>maximum</code> us probably over-zealousness on my part. It can almost certainly be replaced with <code>.</code> without any problem.</p>\n"}], "owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 793, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469651431, "creation_date": 1469644271, "last_edit_date": 1469649473, "question_id": 38620651, "link": "https://stackoverflow.com/questions/38620651/implementation-of-maximum-in-haskell", "title": "Implementation of maximum in haskell", "body": "<p>I was just looking up the implementation of the maximum function in haskell:</p>\n\n<pre><code>maximum :: forall a . Ord a =&gt; t a -&gt; a\nmaximum = fromMaybe (errorWithoutStackTrace \"maximum: empty structure\") .\n   getMax . foldMap (Max #. (Just :: a -&gt; Maybe a))\n</code></pre>\n\n<p>Could somebody explain this piece of code to me?</p>\n\n<p>In particular it is not clear to me how this part </p>\n\n<pre><code>Max #. (Just :: a -&gt; Maybe a)\n</code></pre>\n\n<p>works. What does #. mean? To me it looks like something similar to function composition but typing </p>\n\n<pre><code>:t #. \n</code></pre>\n\n<p>in the REPL gives an error.\nAlso I think the argument for foldMap should be of the form </p>\n\n<pre><code>Monoid m =&gt; a -&gt; m\n</code></pre>\n\n<p>But I can't see where the monoid structure comes from here. </p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "composition", "function-composition"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469630512, "post_id": 38616139, "comment_id": 64618441, "body": "What book are you reading?"}, {"owner": {"reputation": 1167, "user_id": 3173123, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2d9a147609cfe147e20ffdd26aef749?s=128&d=identicon&r=PG&f=1", "display_name": "Jyoti Prasad Pal", "link": "https://stackoverflow.com/users/3173123/jyoti-prasad-pal"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469630635, "post_id": 38616139, "comment_id": 64618534, "body": "@Erik, functional programming in javascript by Luis Atencio"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1469637057, "post_id": 38616139, "comment_id": 64622928, "body": "Tupling of arguments, as you have done in your last version, is commonly referred to as the &quot;uncurried version&quot; of a function.  Wikipedia has an acceptable article (<a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Currying</a>).  Fun fact: &#39;curry&#39; is taken from the name of the same Mathematician as &#39;Haskell&#39;, Haskell Curry (<a href=\"https://en.wikipedia.org/wiki/Haskell_Curry\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Haskell_Curry</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1469632584, "creation_date": 1469632584, "answer_id": 38617075, "question_id": 38616139, "link": "https://stackoverflow.com/questions/38616139/compose-function-signature/38617075#38617075", "title": "Compose function signature", "body": "<p>First, an open circle is more commonly used: <code>f \u2218 g</code>.</p>\n\n<p>Second, it would more properly be pronounced \"f composed <em>with</em> g\". (\"f composed of g\" sounds like <code>f</code> is made up of <code>g</code>, rather than a new function made up of both.)</p>\n\n<p>Finally, the two types are essentially the same, differing only in how you expect to pass functions to the <code>compose</code> function. The first defines the type of a fully curried function, such that <code>compose</code> takes one function as an argument, and returns a new function that takes the second function as an argument and returns the composed. This means with <code>f :: B -&gt; C</code> and <code>g :: A -&gt; B</code>, you can define either (using Haskell syntax)</p>\n\n<pre><code>compose :: (B -&gt; C) -&gt; (A -&gt; B) -&gt; (A -&gt; C)\ncompose f g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>or the uncurried version</p>\n\n<pre><code>compose' :: ((B -&gt; C), (A -&gt; B)) -&gt; (A -&gt; C)\ncompose' (f, g) = \\x -&gt; f (g x)\n</code></pre>\n\n<p>Either way, the return value is the same; the only difference is in how the arguments are passed. You could write <code>h = compose f g</code> or you could write <code>h = compose' (f, g)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1469651542, "post_id": 38617093, "comment_id": 64630909, "body": "The &quot;curried signature <code>((B -&gt; C) -&gt; (A -&gt; B)) -&gt; (A -&gt; C)</code>&quot; should actually be <code>(B -&gt; C) -&gt; ((A -&gt; B) -&gt; (A -&gt; C))</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1469651936, "post_id": 38617093, "comment_id": 64631108, "body": "Never use copy &amp; paste without letting a compiler typecheck after you..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1469651871, "last_edit_date": 1469651871, "creation_date": 1469632644, "answer_id": 38617093, "question_id": 38616139, "link": "https://stackoverflow.com/questions/38616139/compose-function-signature/38617093#38617093", "title": "Compose function signature", "body": "<p>First we need to get some things right:</p>\n\n<ul>\n<li><p><code>f \u25cb g</code> means something quite different from <code>f(g)</code>.</p>\n\n<ul>\n<li>The former is a function that, given an argument <code>x</code>, will first feed it to <code>g</code>, <em>then pass on the result to <code>f</code></em>, and output that final result, i.e. <code>f(g(x))</code>.</li>\n<li>OTOH, <code>f(g)</code> means you apply the function <code>f</code> to the <em>value</em> <code>g</code> right away, without waiting for any argument. (<code>g</code> just happens to have a function type, but in functional languages, functions can be passed around just like any other values / arguments).</li>\n</ul>\n\n<p>Unless you're dealing with some pretty wacky polymorphic functions, one of these will be ill-typed. For example, a well-typed composition might be</p>\n\n<pre><code>sqrt \u25cb abs :: Double -&gt; Double\n</code></pre>\n\n<p>whereas a well-typed <em>application</em> could be (at least in Haskell)</p>\n\n<pre><code>map(sqrt) :: [Double] -&gt; [Double]\n</code></pre>\n\n<p>I'll assume in the following you're talking about <code>f \u25cb g</code>.</p></li>\n<li><p>Type signatures must be given for <em>a function itself</em>, not for <em>a function applied to some arguments</em>. This is something that loads of people get utterly wrong: in <code>f(x)</code>, you have a function <code>f</code> and an argument <code>x</code>. But <code>f(x)</code> is <em>not</em> a function, only the value that's the result of applying a function to a value! So, you shouldn't write something like <code>f \u25cb g :: ...</code> (unless you're actually talking only about the type that <em>results</em> from the composition). Better write just <code>\u25cb :: ...</code> (or, in Haskell, <code>(\u25cb) :: ...</code>).</p></li>\n<li><p>Function arrows aren't associative. Most mathematicians likely won't even know what <code>X -&gt; Y -&gt; Z</code> is supposed to mean. What it means in languages like Haskell may actually be somewhat surprising:</p>\n\n<pre><code>X -&gt; Y -&gt; Z  \u2261  X -&gt; (Y -&gt; Z)\n</code></pre></li>\n</ul>\n\n<p>i.e. this is the type of a function that first takes only an argument of type <code>X</code>. The result will be again a function, but one that takes only an argument of type <code>Y</code>. This function will have, if you like, the <code>X</code> value already built-in (in a so-called <a href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\" rel=\"nofollow noreferrer\">closure</a>, unless the compiler optimises that away). Giving it also the <code>Y</code> value will allow the function to actually do its job and finally yield the <code>Z</code> result.</p>\n\n<p>At this point you already have your answer, pretty much: indeed the signatures <code>X -&gt; Y -&gt; Z</code> and <code>(X, Y) -&gt; Z</code> are essentially equivalent. The process of rewriting this is called <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">currying</a>.</p>\n\n<p>To answer your question in particular: most languages don't normally do any currying, so the signature <code>((B -&gt; C), (A -&gt; B)) -&gt; (A -&gt; C)</code> is actually more correct. It corresponds to a function you can call as</p>\n\n<pre><code>   compose(f,g)\n</code></pre>\n\n<p>OTOH, the curried signature <code>(B -&gt; C) -&gt; (A -&gt; B) -&gt; (A -&gt; C)</code> means that you need to feed in the arguments one by one:</p>\n\n<pre><code>   compose(f)(g)\n</code></pre>\n\n<p>Only in languages like Haskell is this the standard style, but you don't need the parens there: all the following are parsed the same in Haskell</p>\n\n<pre><code>   compose(f)(g)\n   compose f g\n   (compose) f g\n   (.) f g\n   f . g\n</code></pre>\n\n<p>where <code>.</code> is in fact the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Function.html#v:.\" rel=\"nofollow noreferrer\">composition operator</a>, which as you can see from the documentation has type</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1469637342, "post_id": 38617372, "comment_id": 64623082, "body": "nice write-up @LUH3417"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "is_accepted": false, "score": 4, "last_activity_date": 1469636669, "last_edit_date": 1469636669, "creation_date": 1469633461, "answer_id": 38617372, "question_id": 38616139, "link": "https://stackoverflow.com/questions/38616139/compose-function-signature/38617372#38617372", "title": "Compose function signature", "body": "<p>Since you marked your question with <strong>Javascript</strong> here is an answer from a Javascript point of view.</p>\n\n<p>Assuming I understand your signature properly, you want to adapt the composition function as follows: <code>(f, g) =&gt; x =&gt; f(g(x));</code>. Sure, that works, but you lose flexibility and gain uhm, nothing.</p>\n\n<p>The original curry function is defined in curried form that means, it expects always a single argument. If every function in your whole code expects exactly one argument, then there is no more arity (well, in most cases). It is abstracted away. Currying facilitates function composition, because functions always return a single value. Curried functions are like building blocks. You can put them together in almost any way:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>    const comp = f =&gt; g =&gt; x =&gt; f(g(x)),\r\n     comp2 = comp(comp)(comp),\r\n     add = y =&gt; x =&gt; x + y,\r\n     inc = x =&gt; x + 1,\r\n     sqr = x =&gt; x * x;\r\n    \r\n    console.log(comp(sqr)(inc)(2)); // 9\r\n    console.log(comp(add)(sqr)(2)(3)); // 7\r\n    console.log(comp2(sqr)(add)(2)(3)); // 25</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>As you can see only in the latter case we must consider the arity.</p>\n\n<p>Currying can only develop its benefits if it is consistently applied for each function of your codebase, because it has a systemic effect.</p>\n"}], "owner": {"reputation": 1167, "user_id": 3173123, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2d9a147609cfe147e20ffdd26aef749?s=128&d=identicon&r=PG&f=1", "display_name": "Jyoti Prasad Pal", "link": "https://stackoverflow.com/users/3173123/jyoti-prasad-pal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 0, "accepted_answer_id": 38617093, "answer_count": 3, "score": 1, "last_activity_date": 1469651871, "creation_date": 1469630355, "last_edit_date": 1469643386, "question_id": 38616139, "link": "https://stackoverflow.com/questions/38616139/compose-function-signature", "title": "Compose function signature", "body": "<p>I've read that the composition of g :: A -> B and f :: B -> C, pronounced (\u201cf composed of g\u201d), results in another function (arrow) from A -> C. This can be expressed more formally as</p>\n\n<blockquote>\n  <p>f \u2022 g = f(g) = compose :: (B -> C) -> (A -> B) -> (A -> C)</p>\n</blockquote>\n\n<p>Can the above composition be also defined as below? Please clarify.\nIn this case the compose function takes the same two functions f and g and return a new function from A -> C.</p>\n\n<blockquote>\n  <p>f \u2022 g = f(g) = compose :: ((B -> C), (A -> B)) -> (A -> C)</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 1, "creation_date": 1469637246, "post_id": 38615997, "comment_id": 64623030, "body": "I&#39;m not clear what is being being asked for in this question. How do you want an answer to differ from the code sample you gave?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1469648883, "post_id": 38615997, "comment_id": 64629546, "body": "Tried to rephrase the question at the end of the text: is it better now? When going forward from &quot;similarity&quot; to have similar changes to Ord-class, and possibly going forward from there, I&#39;m suspecting that usage would become somehow difficult. Third possibility would be to just use separate functions and no classes at all, but that is also a bit boring solution?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1469649921, "post_id": 38615997, "comment_id": 64630091, "body": "One more comment: if the way in the sample is more or less ok (= somebody else would end up in some-what similar solution), then the whole question is a bit useless."}], "answers": [{"comments": [{"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1469677675, "post_id": 38622515, "comment_id": 64638190, "body": "Could you please elaborate a bit that &quot;cannot use two different metric-types for a single type&quot;?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1469678843, "post_id": 38622515, "comment_id": 64638479, "body": "Could you please elaborate a bit that &quot;can&#39;t use two different metric-types for a single type&quot;? Does it mean that e.g. only one of synonym-similarity or editDistance-similarity can be defined for Peq T.Text and the other should be defined in a derived class? Your answer also brought Proxy-types to my mind: if the words are classified to several classes beforehand, say verbs, nouns etc, and similarity implementation depends on that, too. Does this mean that verbs etc should be classes in code, too, so that each could have their own Peq-instance? (Accepted y&#39; answer, and was hit by time limit.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1469692766, "post_id": 38622515, "comment_id": 64644795, "body": "It simply means you cannot have both your <code>instance Peq Double Double</code> and also <code>instance Peq Char Double</code>, nor a perhaps more meaningful alternative third-argument type. Instead, the moment you write one instance with <code>b ~ Double</code>, you set up a fixed functional-dependency relation for what <code>a</code> must be."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1469650953, "creation_date": 1469650953, "answer_id": 38622515, "question_id": 38615997, "link": "https://stackoverflow.com/questions/38615997/how-to-define-a-parameterized-similarity-class-an-like-operator-with-3rd-par/38622515#38622515", "title": "How to define a parameterized similarity class (an ==-like operator with 3rd param) in Haskell?", "body": "<blockquote>\n  <p>could this be achieved more elegantly with a similarity class that has only one parameter a and not two (a and b)</p>\n</blockquote>\n\n<p>Yes. Many MultiParamTypeClasses can be rewritten quite easily to single-param ones... by simply degrading the second parameter to an associated type family:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass Peq b where\n  type SimilarityThreshold b :: *\n  peq :: SimilarityThreshold b -&gt; b -&gt; b -&gt; Bool\n\ninstance Peq Double where\n  type SimilarityThreshold Double = Double\n  peq = almostEqRelPrec\n\ninstance Peq T.Text where\n  type SimilarityThreshold T.Text = Int\n  peq = editDistance \n</code></pre>\n\n<p>This is quite a bit more verbose, but indeed I tend to favour this style. The main difference is that the associated type family always assigng each type of values to be compared unambiguously a threshold-type. This can save you some <em>could not deduce...</em> type inference trouble, however it also means that you can't use two different metric-types for a single type (but why would you, anyway).</p>\n\n<p>Note that you can achieve exactly the same semantics by simply adding a <em>fundep</em> to your original class:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass Peq a b | b -&gt; a where\n  peq :: a -&gt; b -&gt; b -&gt; Bool\n</code></pre>\n\n<p>This is just a bit different in usage \u2013 again I tend to favour the type families approach: it is more explicit in what the parameters are for, while at the same time avoiding the second parameter to turn up in the constraints to any <code>Peq</code>-polymorphic function.</p>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 38622515, "answer_count": 1, "score": 0, "last_activity_date": 1469650953, "creation_date": 1469630023, "last_edit_date": 1469649689, "question_id": 38615997, "link": "https://stackoverflow.com/questions/38615997/how-to-define-a-parameterized-similarity-class-an-like-operator-with-3rd-par", "title": "How to define a parameterized similarity class (an ==-like operator with 3rd param) in Haskell?", "body": "<p>How to derive a parameterized similarity in a way that it would be convenient to use in Haskell?</p>\n\n<p>The class should be such that the domain can be numeric or text (and possibly something else), and the parameter controlling the internals of comparison function can also be of several types. </p>\n\n<p>Below, you may find the one approach that uses two class parameters. What implications this design entails if the goal is to define several \"similarity or equality groups\"? (What kind of use cases would be hard to implement compared to some alternative implementation?) In this example, the similarity groups of words could be defined to be edit distances of one, two etc. and in double to be different precisions. </p>\n\n<p>Some of the methods take both numeric and textual inputs like the \"quiteSimilar\"-method. Why not use just some distance? Some of the similarities should be able to be defined by the user of the parameterized equality, e.g. on text (words) they could be based on synonyms. </p>\n\n<p>And on doubles, well, I don't know yet, what kind of comparisons will be needed. (Suggestions are welcome.) After equalities comes the question, how to compare the order of items so that similar items will be deemed to be equal and not the larger and smaller, see the last line of the output.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n\nimport Data.Array\nimport qualified Data.Text as T\n\n-- parameterized eq\nclass Peq a b where peq :: a -&gt; b -&gt; b -&gt; Bool\n\ninstance Peq Double Double where peq = almostEqRelPrec\ninstance Peq Int    T.Text where peq = editDistance \n\nclass Comment a where\n  quiteSimilar :: a -&gt; a -&gt; T.Text\n\ninstance Comment Double where\n  quiteSimilar a b = if peq (epsilon * 100::Double) a b then T.pack \"alike\" else T.pack \"unalike\"\n\ninstance Comment T.Text where\n  quiteSimilar a b = if peq (1::Int) a b then T.pack \"alike\" else T.pack \"unalike\"\n\nx1' x = quiteSimilar 0.25 (0.25 - x * epsilon :: Double)\nx1 = quiteSimilar 0.25 (0.25 - 25 * epsilon :: Double)\nx2 = quiteSimilar 0.25 (0.25 - 26 * epsilon :: Double)\nx3' x = quiteSimilar 1e12 (1e12 - x * ulp 1e12 :: Double)\nx3 = quiteSimilar 1e12 (1e12 - 181 * ulp 1e12 :: Double)\nx4 = quiteSimilar 1e12 (1e12 - 182 * ulp 1e12 :: Double)\nu181 = 181 * ulp 1e12 :: Double\n\nmain = do\n  let a = 0.2 + 0.65 :: Double\n      b = 0.85 :: Double\n      s = T.pack \"trial\" \n      t = T.pack \"tr1al\"\n\n  putStrLn $\u00a0\"0.2 + 0.65 = \" ++ show a ++ \" and compared to \" ++ show b ++ \", it is \" ++ T.unpack (quiteSimilar a b) \n  putStrLn $ \"Texts \" ++ T.unpack s ++ \" and \" ++ T.unpack t ++ \" are \" ++ T.unpack (quiteSimilar s t)\n  putStrLn $ \"Note that \" ++ show a ++ \" &gt; \" ++ show b ++ \" is \" ++ show (a &gt; b)\n\n-- packege Numeric.Limits contains this one\nepsilon :: RealFloat a =&gt; a\nepsilon = r\n  where r = 1 - encodeFloat (m-1) e\n        (m, e) = decodeFloat (1 `asTypeOf` r)\n\nulp :: RealFloat a =&gt; a -&gt; a\nulp a = r\n  where r = a - encodeFloat (m-1) e\n        (m, e) = decodeFloat (a `asTypeOf` r)\n\nalmostEqRelPrec :: (RealFloat a) =&gt; a -&gt; a -&gt; a -&gt; Bool\nalmostEqRelPrec maxRelPrec a b = d &lt;= (largest * maxRelPrec)\n  where\n    d = abs $ a - b\n    largest = max (abs a) (abs b)\n\neditDistance :: Int -&gt; T.Text -&gt; T.Text -&gt; Bool\neditDistance i a b = i == editDistance' (show a) (show b)\n\n\n-- from https://wiki.haskell.org/Edit_distance\n-- see also https://hackage.haskell.org/package/edit-distance-0.2.2.1\neditDistance' :: Eq a =&gt; [a] -&gt; [a] -&gt; Int\neditDistance' xs ys = table ! (m,n)\n    where\n    (m,n) = (length xs, length ys)\n    x     = array (1,m) (zip [1..] xs)\n    y     = array (1,n) (zip [1..] ys)\n    table :: Array (Int,Int) Int\n    table = array bnds [(ij, dist ij) | ij &lt;- range bnds]\n    bnds  = ((0,0),(m,n))\n\n    dist (0,j) = j\n    dist (i,0) = i\n    dist (i,j) = minimum [table ! (i-1,j) + 1, table ! (i,j-1) + 1,\n        if x ! i == y ! j then table ! (i-1,j-1) else 1 + table ! (i-1,j-1)]\n</code></pre>\n\n<p>On my machine, the output is:</p>\n\n<pre><code>  0.2 + 0.65 = 0.8500000000000001 and compared to 0.85, it is alike\n  Texts trial and tr1al are alike\n  Note that 0.8500000000000001 &gt; 0.85 is True\n</code></pre>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>Trying to rephrase the question: could this be achieved more elegantly with a similarity class that has only one parameter a and not two (a and b)? I have a feeling that multiparameter classes may turn out to be difficult later on. Is this a needless fear? First solution along this line that came to my mind was to define similarity class with one parameter a and a class for functions having two parameters. And on instances constraint other type to be similarity class parameter and the other would be for actual method returning Bool.</p>\n\n<p>Are there some benefits of using the latter approach to the one presented? Or actually what are the possible trade-offs between these approaches? And if there are still more ways to make achieve this kind of things, how do they compare?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1469591708, "post_id": 38603014, "comment_id": 64594144, "body": "as  @ErikR showed you in his (now deleted) answer the left-hand side is doable but the type on the rhs depends on the type of <code>f</code> so I guess you would need to use type-families as well - if this is all-right for you than it should be possible - of course this is only a guess - for all I know there is a way to express this ;)"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469591765, "post_id": 38603014, "comment_id": 64594158, "body": "Happy to use GHC extensions"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1469593826, "post_id": 38603014, "comment_id": 64594671, "body": "@user3237465: on a quick glance (at least your simple version) I think you would run into trouble with <code>f2</code> as this is not <i>forall a</i> but just for <code>Int</code> any longer"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469594421, "post_id": 38603014, "comment_id": 64594890, "body": "@Carsten, type families will not help you; neither a &quot;pattern&quot; nor a result of a type family can be quantified. Class instances can&#39;t be either, so I&#39;m pretty sure this whole thing is impossible."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469594669, "post_id": 38603014, "comment_id": 64594960, "body": "@dfeuer yes you are right sorry - it&#39;s an interesting problem - indeed I thought I could easily shoot Idris at it by I&#39;m ending with a &quot;SCOPE ERROR&quot; and am trying to figure out if this is an bug or if I am stupid: <a href=\"https://gist.github.com/CarstenKoenig/c6ed79f8c57eae2d1af55525ee089c88\" rel=\"nofollow noreferrer\">gist.github.com/CarstenKoenig/c6ed79f8c57eae2d1af55525ee089c&zwnj;&#8203;88</a> - anyone able to enlighten me?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1469594817, "post_id": 38603014, "comment_id": 64595003, "body": "If this is possible at all it would require <a href=\"https://wiki.haskell.org/Impredicative_types\" rel=\"nofollow noreferrer\">impredicative types</a> and that way lies madness. Even with <code>ImpredicativeTypes</code> I don&#39;t think you can put a <code>forall</code> in the head of a class instance."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469595113, "post_id": 38603014, "comment_id": 64595097, "body": "never mind my question ... I&#39;m obviously stupid"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 15, "last_activity_date": 1469597473, "last_edit_date": 1469597473, "creation_date": 1469595427, "answer_id": 38604031, "question_id": 38603014, "link": "https://stackoverflow.com/questions/38603014/type-signature-for-function-with-possibly-polymorphic-arguments/38604031#38604031", "title": "Type signature for function with possibly polymorphic arguments", "body": "<p>No, you can't. The basic problem is that Haskell's syntax has fooled you into thinking that <code>f1</code>'s and <code>f2</code>'s types are more similar than they really are. Once translated into GHC Core, they look rather more different:</p>\n\n<pre><code>f1 :: forall a . a -&gt; [a]\nf2 :: Int -&gt; Int\n</code></pre>\n\n<p>Not only this, but the corresponding <em>terms</em> look rather different:</p>\n\n<pre><code>f1 = \u039ba -&gt; \u03bb(x :: a) -&gt; [x]\nf2 = \u03bb(x :: Int) -&gt; 3 * x\n</code></pre>\n\n<p>As you can see, <code>f1</code> and <code>f2</code> actually have <em>different numbers of arguments</em>, where <code>f1</code> takes a <em>type</em> and a <em>value</em>, and <code>f2</code> takes just a value.</p>\n\n<p>In more usual circumstances, when you plop <code>f2</code> into a context expecting a function of type, say, <code>Int -&gt; [Int]</code>, GHC will apply <code>f2</code> to the necessary type for you (i.e., instantiate <code>f2</code> to a specific type), and all will be well. For example, if you have</p>\n\n<pre><code>g :: (Int -&gt; [Int]) -&gt; Bool\n</code></pre>\n\n<p>and you apply <code>g</code> to <code>f</code>, GHC will actually compile that to</p>\n\n<pre><code>g (f @Int)\n</code></pre>\n\n<p>But here you want polymorphism over whether that instantiation happens or not, which GHC doesn't support (I think it would be a rather radical and destructive change to the core language).</p>\n\n<p>Since class instances, type family patterns, and type family results cannot be quantified, I'm pretty confident there is no way whatsoever to get what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 7, "last_activity_date": 1487982803, "last_edit_date": 1495540810, "creation_date": 1469605713, "answer_id": 38606908, "question_id": 38603014, "link": "https://stackoverflow.com/questions/38603014/type-signature-for-function-with-possibly-polymorphic-arguments/38606908#38606908", "title": "Type signature for function with possibly polymorphic arguments", "body": "<p>This is actually possible, if you don't mind adding a <code>Proxy</code> argument, using a variation on <a href=\"https://stackoverflow.com/a/31223058/2476735\">my answer to a similar question here</a>.</p>\n\n<p>Most of my explanation from that answer holds here, but we need to expand on it slightly by adding a couple more helper type classes (what I'm calling <code>List</code> and <code>Both</code> here):</p>\n\n<pre><code>{-# LANGUAGE RankNTypes            #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies          #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE ConstraintKinds       #-}\n\nimport           Data.Proxy\n\nf1 :: a -&gt; [a]\nf1 x = [x]\n\nx1 :: Int\nx1 = 42\n\nc1 :: Char\nc1 = 'c'\n\nf2 :: Int -&gt; Int\nf2 x = 3 * x\n\nx2 :: Int\nx2 = 5\n\nclass b ~ [a] =&gt; List a b\ninstance List a [a]\n\nclass (a ~ b, b ~ c) =&gt; Both a b c\ninstance Both a a a\n\ng :: (c a r1, c b r2) =&gt;\n      Proxy c -&gt; (forall x r. c x r =&gt; x -&gt; r) -&gt; a -&gt; b -&gt; (r1, r2)\ng _ f x y = (f x, f y)\n</code></pre>\n\n<p>This allows us to do</p>\n\n<pre><code>ghci&gt; g (Proxy :: Proxy List) f1 x1 c1\n([42],\"c\")\nghci&gt; g (Proxy :: Proxy (Both Int)) f2 x1 x2\n(126,15)\n</code></pre>\n\n<p><code>List</code> and <code>Both</code> are not the best names (especially <code>List</code>), so you might want to come up with better ones if you do use this (although I'm not sure I would suggest doing this sort of type trickery in production code anyway, unless you have a <em>really</em> good reason).</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 2, "answer_count": 2, "score": 18, "last_activity_date": 1487982803, "creation_date": 1469588673, "question_id": 38603014, "link": "https://stackoverflow.com/questions/38603014/type-signature-for-function-with-possibly-polymorphic-arguments", "title": "Type signature for function with possibly polymorphic arguments", "body": "<p>Can I, and if so, how do I, write the type signature for a function:</p>\n\n<pre><code>g f x y = (f x, f y)\n</code></pre>\n\n<p>Such that given:</p>\n\n<pre><code>f1 :: a -&gt; [a]\nf1 x = [x]\n\nx1 :: Int\nx1 = 42\n\nc1 :: Char\nc1 = 'c'\n\nf2 :: Int -&gt; Int\nf2 x = 3 * x\n\nx2 :: Int\nx2 = 5\n</code></pre>\n\n<p>Such that:</p>\n\n<pre><code>g f1 x1 c1 == ([42], ['c']) :: ([Int], [Char])\ng f2 x1 x2 == (126, 15) :: (Int, Int)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1469573558, "post_id": 38601105, "comment_id": 64589959, "body": "Are you trying to provide a string? Then you need to use <code>lastButOne &quot;abcdef&quot;</code>. At the moment you are providing a list of variables <code>[a, b, c, d, e ,f]</code> but none of those have been defined anywhere."}, {"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 2, "creation_date": 1469573644, "post_id": 38601105, "comment_id": 64589991, "body": "What do you think &quot;<code>Variable not in scope: a</code>&quot; means?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1469573797, "post_id": 38601105, "comment_id": 64590051, "body": "Expressed another way: Remember <code>&quot;abcdef&quot;</code> is sugar for <code>[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;]</code>--  you need single quotes to name the <code>Char</code>s. <code>a</code> is being rejected an an undefined expression or &quot;variable&quot;, but <code>&#39;a&#39;</code> is predefined as a name of a letter."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469605187, "post_id": 38601105, "comment_id": 64600196, "body": "If you are new, I&#39;d recommend that you forget about <code>head,tail</code>. These functions will crash your program when the list is empty, so are best to be avoided. Also, <code>length xs == 2</code> will scan the whole list, which is quite inefficient when you only need to scan the first 3 elements, at most, to perform the same check. Learn how to use pattern matching instead. E.g. <code>lastButOne [x1,x2] = x1 ; lastButOne (x:xs) = lastButOne xs</code>. Further, note that this function will crash on lists of length 1 or 0, and as such it is as dangerous as <code>head,tail</code>. I wouldn&#39;t use it in more &quot;serious&quot; code."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6501070"}, "edited": false, "score": 0, "creation_date": 1469573787, "post_id": 38601143, "comment_id": 64590047, "body": "I see now. I didn&#39;t know that the program would interpret a,b,c... as variables, not just characters."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 4, "creation_date": 1469573914, "post_id": 38601143, "comment_id": 64590085, "body": "@Zermelo&#39;s_Choice If you want characters, surround them with <code>&#39;</code>s. Or just use string literal syntax (<code>&quot;abcdef&quot;</code>, which is a shortcut for <code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;]</code>)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1469573577, "creation_date": 1469573577, "answer_id": 38601143, "question_id": 38601105, "link": "https://stackoverflow.com/questions/38601105/error-in-running-haskell-code/38601143#38601143", "title": "Error in running Haskell code", "body": "<p>The problem isn't the type, it's that none of the variables <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, <code>e</code> and <code>f</code> exist. You can't use variables that don't exist.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6501070"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1096, "favorite_count": 0, "accepted_answer_id": 38601143, "answer_count": 1, "score": 0, "last_activity_date": 1469573577, "creation_date": 1469573395, "question_id": 38601105, "link": "https://stackoverflow.com/questions/38601105/error-in-running-haskell-code", "title": "Error in running Haskell code", "body": "<p>I'm new to programming and Haskell, so appologies if this is elementary. </p>\n\n<p>I'm having trouble running the program below, but I'm not sure if it's a program error or if I don't know how to use <code>ghci</code>.</p>\n\n<p>I have written a program that behaves likes <code>last</code>, but returns the second to last item in a list instead. </p>\n\n<p>My code is </p>\n\n<pre><code>main :: IO ()\nmain = return ()    \nlastButOne::[a]-&gt;a\nlastButOne xs = if length xs == 2\n                then head xs\n                else lastButOne (tail xs)\n</code></pre>\n\n<p>The program compiles just fine, but I can't seem to find a way to run it without giving me an error. </p>\n\n<p>The textbook gives an example of running a program which emulates <code>drop</code> by doing the following in <code>ghci</code></p>\n\n<pre><code>ghci&gt; :load myDrop.hs\nOk, modules loaded: Main.\nghci&gt; myDrop 3 \"asdfg\"\n\"fg\"\n</code></pre>\n\n<p>However, when I load my <code>lastButOne.hs</code> and attempt to give the program input I get the following</p>\n\n<pre><code>Prelude&gt; :load lastButOne.hs\n[1 of 1] Compiling Main             ( lastButOne.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; lastButOne [a,b,c,d,e,f]\n\n&lt;interactive&gt;:2:13: error: Variable not in scope: a\n\n&lt;interactive&gt;:2:15: error: Variable not in scope: b\n\n&lt;interactive&gt;:2:17: error: Variable not in scope: c\n\n&lt;interactive&gt;:2:19: error: Variable not in scope: d\n\n&lt;interactive&gt;:2:21: error: Variable not in scope: e\n\n&lt;interactive&gt;:2:23: error: Variable not in scope: f\n</code></pre>\n\n<p>But when I check the type of lastButOne it looks like I'm giving it the correct input type, namely a list:</p>\n\n<pre><code>lastButOne :: [a] -&gt; a\n</code></pre>\n\n<p>Is there an error in my code or am I trying to use the program incorrectly? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1469561711, "post_id": 38598390, "comment_id": 64584840, "body": "why would that matter? What is the indent count that the parser looks for?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1469562853, "post_id": 38598390, "comment_id": 64585483, "body": "Answer updated - are you sure about <code>wherePlusGuards</code> parsing ok? it doesn&#39;t parse for me."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1469563543, "post_id": 38598390, "comment_id": 64585862, "body": "Reference from the Haskell Report added."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1469567990, "post_id": 38598390, "comment_id": 64588026, "body": "interesting... it compiles when i use tabs. thanks for clearing that up."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1469563525, "last_edit_date": 1469563525, "creation_date": 1469561430, "answer_id": 38598390, "question_id": 38598271, "link": "https://stackoverflow.com/questions/38598271/implementing-routing-in-haskell-http-server/38598390#38598390", "title": "Implementing routing in haskell HTTP server", "body": "<p>Make sure that the <code>|</code> is indented further than the <code>g</code> in <code>getMessage</code> - e.g.:</p>\n\n<pre><code>import System.IO\n\nhandleAccept :: Handle -&gt; String -&gt; IO ()\nhandleAccept handle hostname = do\n    putStrLn $ \"Handling request from \" ++ (getMessage hostname)\n    return ()\n    where getMessage x\n           | x == \"hello\" = \"hello route\"\n           | x == \"LOL\" = \"what's so funny?\"\n           | otherwise = x\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>This does not parse correctly:</p>\n\n<pre><code>wherePlusGuards :: String -&gt; Bool\nwherePlusGuards x = getX x\n    where getX x\n        | x == \"hello\" = True\n        | otherwise = False\n</code></pre>\n\n<p>It yields the error: <code>parse error (possibly incorrect indentation or mismatched brackets)</code></p>\n\n<p>Note: I'm not using any tabs.</p>\n\n<p>From the Haskell2010 Report:</p>\n\n<blockquote>\n  <p>Note 1. A nested context must be further indented than the enclosing context (n > m). If not, L fails, and the compiler should indicate a layout error. </p>\n</blockquote>\n\n<p>Reference: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html\" rel=\"nofollow\">https://www.haskell.org/onlinereport/haskell2010/haskellch10.html</a></p>\n\n<p>Section 10.3 (Layout), Note 1.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 38598390, "answer_count": 1, "score": 0, "last_activity_date": 1469563525, "creation_date": 1469560989, "question_id": 38598271, "link": "https://stackoverflow.com/questions/38598271/implementing-routing-in-haskell-http-server", "title": "Implementing routing in haskell HTTP server", "body": "<p>I'm trying to build a simple way to route requests based on the hostname. Here is the function:</p>\n\n<pre><code>handleAccept :: Handle -&gt; String -&gt; IO ()\nhandleAccept handle hostname = do\n    putStrLn $ \"Handling request from \" ++ (getMessage hostname)\n    request &lt;- fmap (parseRequest . lines) (hGetContents handle)\n    respond request handle\n    return ()\n    where getMessage x\n        | x == \"hello\" = \"hello route\"\n        | x == \"LOL\" = \"what's so funny?\"\n        | otherwise = x\n</code></pre>\n\n<p>Called here:</p>\n\n<pre><code>main = withSocketsDo $ do\n    sock &lt;- listenOn (PortNumber 9000)\n    putStrLn \"Listening on port 9000\"\n    forever $ do\n        (handle, hostname, port) &lt;- accept sock\n        handleAccept handle hostname\n        hClose handle\n</code></pre>\n\n<p>When I try to compile I get this error:</p>\n\n<pre><code>parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>at this line in <code>handleAccept</code>:</p>\n\n<pre><code>where getMessage x\n        | x == \"hello\" = \"hello route\"\n</code></pre>\n\n<p>There seems to be an issue using guards with a where statement. So I tried this dummy function:</p>\n\n<pre><code>wherePlusGuards :: String -&gt; Bool\nwherePlusGuards x = getX x\n    where getX x\n        | x == \"hello\" = True\n        | otherwise = False\n</code></pre>\n\n<p>This compiles fine. I'm left to believe that the issue is coming from using a where statement and guards <em>inside</em> a <code>do</code> expression. Why is this the case? Please help me.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469551276, "post_id": 38595303, "comment_id": 64578925, "body": "Can you give some concrete examples of how you want <code>foo</code> to work in practice?"}, {"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469551847, "post_id": 38595303, "comment_id": 64579241, "body": "Imagine you have a type <code>T</code>, which can be thought of a container of type <code>V</code> with keys of type <code>K</code>.  Now imagine that each <code>V</code> also follows this pattern. I would like to have <code>foo :: StateT V (t (Either e)) a -&gt; StateT T (ReaderT K (t (Either e))) a</code>. This would take stateful operations over <code>V</code> and lift them into stateful operations over <code>T</code> that have an environment with <code>K</code>. Basically a tree structure which I can extend upwards and downwards infinitely without changing existing code."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469552888, "post_id": 38595303, "comment_id": 64579868, "body": "Concrete examples would be more helpful here. And feel free to put it in your question where it will be easier to read."}, {"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469553242, "post_id": 38595303, "comment_id": 64580053, "body": "Unfortunately, this is about as concrete as I can get it, this isn&#39;t for a particular application or project, this is more so experimental musings. I&#39;ll see if I can find some situation in which it&#39;s actually useful."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1469556790, "post_id": 38595303, "comment_id": 64582038, "body": "A monad transformer stack is a <i>stack</i>. You can&#39;t specify what&#39;s at the bottom of the stack."}], "answers": [{"comments": [{"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1469556671, "post_id": 38596962, "comment_id": 64581972, "body": "I realize this, and even point it out in the question. The point was that <code>foo</code> should be able to accept an arbitrary stack of transformers, hence creating a newtype for every possibility seems unlikely. also, <code>foo</code>&#39;s return type is a placeholder, the snippet was only to demonstrate the problem. In reality, <code>foo</code> would return a value related to <code>t (Either e)</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1469556302, "creation_date": 1469556302, "answer_id": 38596962, "question_id": 38595303, "link": "https://stackoverflow.com/questions/38595303/arbitrary-monad-transformer-stack-in-type-variable/38596962#38596962", "title": "Arbitrary monad transformer stack in type variable", "body": "<p>The reason why <code>foo baz</code> doesn't type check is because the <code>t</code> is not a transformer over the <code>Either e</code> monad - it is a transformer over the <code>StateT Int (Either e)</code> monad.</p>\n\n<p>Here is how it is parsed:</p>\n\n<pre><code> baz :: MyTransT (StateT Int (StateT Int (Either e))) a\n                  \\________/ \\_____________________/\n                       t            m                 a\n</code></pre>\n\n<p>Note that <code>m</code> is <em>not</em> of the form <code>Either e</code>.</p>\n\n<p>You could create a new transformer, e.g. <code>StateTIntStateTInt</code>, and write\nbaz like this:</p>\n\n<pre><code> baz :: MyTransT (StateTIntStateInt (Either e)) a\n</code></pre>\n\n<p>and then it would type check. For instance:</p>\n\n<pre><code>type StateTIntStateTInt = StateT (Int,Int)\n\nbaz' :: MyTransT (StateTIntStateTInt (Either e)) a\nbaz' = undefined\n\ntest = foo baz'\n</code></pre>\n\n<p>However, even if you work around the type issues I doubt you are going\nto be able to write the function <code>foo</code>. Consider what should be returned\nfor this specific value of <code>bar</code>:</p>\n\n<pre><code>bar0 :: MyTransT (StateT Int (Either String)) Int\nbar0 = MyTransT $ lift $ Left \"blather\"\n</code></pre>\n\n<p>What Int value should <code>foo bar0</code> return?</p>\n"}], "owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469556302, "creation_date": 1469550660, "question_id": 38595303, "link": "https://stackoverflow.com/questions/38595303/arbitrary-monad-transformer-stack-in-type-variable", "title": "Arbitrary monad transformer stack in type variable", "body": "<p>Consider the following snippet</p>\n\n<pre><code>import Control.Monad.Trans\nimport Control.Monad.Trans.Except\nimport Control.Monad.Trans.State\n\nnewtype MyTransT m a = MyTransT (m a)\n\nfoo :: (MonadTrans t, Monad (t (Either e))) =&gt; MyTransT (t (Either e)) a -&gt; a\nfoo = undefined\n\nbar :: MyTransT (StateT Int (Either e)) a\nbar = undefined\n\nbaz :: MyTransT (StateT Int (StateT Int (Either e))) a\nbaz = undefined\n\nx = foo bar -- works\n\ny = foo baz -- doesn't work\n</code></pre>\n\n<p>In essence, I am trying to create a function which accepts a monad transformer stack, with the top and bottom of the stack specified, while the middle can be anything.</p>\n\n<p>After scratching my head for a while as to why <code>foo baz</code> was being rejected with <code>Couldn't match type \u2018StateT Int (Either e1)\u2019 with \u2018Either e0\u2019</code>, it finally occurred to me that in that case, I was assuming that <code>t</code>  was <code>StateT Int (StateT Int)</code> which is not only not a <code>MonadTrans</code>, its not properly typed/kinded.</p>\n\n<p>Is there any way to accomplish what I'm trying to do, or is it time to try a different approach?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1469554208, "post_id": 38594576, "comment_id": 64580679, "body": "The indentation is wrong, and I really doubt your method is named <code>do</code>. Can you provide your actual code?"}, {"owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469555043, "post_id": 38594576, "comment_id": 64581125, "body": "@ Red Barton Tnx! - you&#39;re  right, my indentation was wrong (the names also, I edited my question to reflect that but that&#39;s not the important part). after fixing it, it compiled and run as expected (arrr the errors code wasn&#39;t  useful at all)"}, {"owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469555322, "post_id": 38594576, "comment_id": 64581260, "body": "@ Red Barton this will teach me to indent after a &#39;where&#39; clause"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1469559625, "post_id": 38594576, "comment_id": 64583624, "body": "OK, great. I must admit it never occurred to me that it&#39;s syntactically valid to put an instance declaration between a function&#39;s type signature and its definition."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1469678423, "post_id": 38594576, "comment_id": 64638371, "body": "Don&#39;t update the question with the fix... now it looks like you asked &quot;I have [perfectly working code here], why doesn&#39;t it work?&quot;"}, {"owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1469689205, "post_id": 38594576, "comment_id": 64642542, "body": "@immibis apparently you didn&#39;t read the comment explaining that the problem i had was with indentation - a problem that still exists in the code example in the question (the current code in the example wouldn&#39;t compile!!!). you shouldn&#39;t be so quick to criticise before even understanding the issue..."}], "answers": [{"comments": [{"owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "edited": false, "score": 0, "creation_date": 1469555156, "post_id": 38594854, "comment_id": 64581174, "body": "the problem was with the indentation (my code was identical to yours except for the indentation...), tnx for the help!!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1469549220, "creation_date": 1469549220, "answer_id": 38594854, "question_id": 38594576, "link": "https://stackoverflow.com/questions/38594576/creating-an-instance-for-a-typeclass-throws-couldnt-match-expected-type-f-w/38594854#38594854", "title": "Creating an instance for a typeclass throws :&quot;Couldn&#39;t match expected type \u2018f\u2019 with actual type&quot;", "body": "<p>The use of <code>D1</code> after <code>D2</code> is not valid here:</p>\n\n<pre><code>data SomeData = D1 Integer \n                | D2 D1 D1\n                     ^^^^^\n</code></pre>\n\n<p>Where <code>D1</code> occurs after <code>D2</code> you need a type, but <code>D1</code> is a function.</p>\n\n<p>You probably meant to write:</p>\n\n<pre><code>data SomeData = D1 Integer \n                | D2 SomeData SomeData\n</code></pre>\n\n<p>With this change your code compiles. (I also change the name <code>do</code> to another name which is not a Haskell keyword):</p>\n\n<pre><code>data SomeData = D1 Integer | D2 SomeData SomeData\n\nclass SomeClass f where\n  foo :: Integer -&gt; f\n\ninstance SomeClass SomeData where\n  foo x = D1 x\n</code></pre>\n"}], "owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 38594854, "answer_count": 1, "score": 0, "last_activity_date": 1469555184, "creation_date": 1469548358, "last_edit_date": 1469555184, "question_id": 38594576, "link": "https://stackoverflow.com/questions/38594576/creating-an-instance-for-a-typeclass-throws-couldnt-match-expected-type-f-w", "title": "Creating an instance for a typeclass throws :&quot;Couldn&#39;t match expected type \u2018f\u2019 with actual type&quot;", "body": "<p>I am new to Haskell and i'm trying to learn how to use classe, </p>\n\n<p>I have the class:</p>\n\n<pre><code>class SomeClass f where\ndoSome :: Integer -&gt; f\n</code></pre>\n\n<p>the data type:   </p>\n\n<pre><code> data SomeData = D1 Integer \n                | D2 SomeData SomeData \n</code></pre>\n\n<p>and I'm trying to create the instance:</p>\n\n<pre><code>instance SomeClass SomeData where\ndoSome x = D1 x\n</code></pre>\n\n<p>but the ghci gives me the error: </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018f\u2019 with actual type \u2018SomeClass\u2019</p>\n</blockquote>\n\n<p>I've seen some question regarding this issue, but i couldn't make them work for me.</p>\n\n<p>how can i fix this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1469548133, "post_id": 38594469, "comment_id": 64577025, "body": "You can&#39;t use <code>&#47;</code> with Integers. Try <code>demo x = x*(x+1) `div` 2</code>"}, {"owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469548629, "post_id": 38594469, "comment_id": 64577365, "body": "Thanks, that&#39;s all I needed! If you make it an answer I&#39;ll accept it."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1469562456, "post_id": 38594469, "comment_id": 64585299, "body": "Also remember that there is a difference between <i>mathematical numbers</i> and their implementation in programming languages. Just because you can mathematically proof that a certain expression is always an integer doesn&#39;t mean that when you try to compute it using a programming language you <i>actually</i> get an integer. That depends on the implementation."}], "answers": [{"tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": true, "score": 5, "last_activity_date": 1469549101, "creation_date": 1469549101, "answer_id": 38594824, "question_id": 38594469, "link": "https://stackoverflow.com/questions/38594469/what-if-i-know-the-result-is-an-integer-but-ghc-is-not-so-sure/38594824#38594824", "title": "What if I know the result is an integer, but ghc is not so sure?", "body": "<p>You cannot use the <code>/</code> function with <code>Integer</code>s. Use <code>div</code> instead if you want classic integer division.</p>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 38594824, "answer_count": 1, "score": 0, "last_activity_date": 1469549101, "creation_date": 1469548024, "question_id": 38594469, "link": "https://stackoverflow.com/questions/38594469/what-if-i-know-the-result-is-an-integer-but-ghc-is-not-so-sure", "title": "What if I know the result is an integer, but ghc is not so sure?", "body": "<p>Let's say I have this piece of code:</p>\n\n<pre><code>demo::Integer -&gt; Integer\ndemo x = x*(x+1)/2\n\nmain = do print $ demo 8\n</code></pre>\n\n<p>clearly, the result is an integer as either x or its successor is even.<br>\nUnderstandably the compiler only looks at <code>/</code> and says</p>\n\n<pre><code>[1 of 1] Compiling Main             ( debug.hs, debug.o )\n\ndebug.hs:2:17:\n    No instance for (Fractional Integer) arising from a use of `/'\n    Possible fix: add an instance declaration for (Fractional Integer)\n    In the expression: x * (x + 1) / 2\n    In an equation for `demo': demo x = x * (x + 1) / 2\n</code></pre>\n\n<p>But to my knowledge <code>Integer</code> is not part of <code>Fractional</code>.\nHow can I keep the signature <code>Integer -&gt; Integer</code>?</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1469533136, "post_id": 38588507, "comment_id": 64565676, "body": "It&#39;s certainly not a very dramatic issue, but I suppose what&#39;s inefficient about your version is that it does quite a lot of multiplications of the small number <code>x</code> with an already-large result of <code>f</code>. The standard version generates a more balanced multiplication tree, by sending the remainder-factors all the way down the recursion call."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1469534974, "post_id": 38588507, "comment_id": 64567000, "body": "<code>g</code> is tail recursive, while the last <code>f</code> is not. I guess this matters here."}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1469576506, "post_id": 38590802, "comment_id": 64590846, "body": "There is nothing ghc specific about the code, it&#39;s just good for any compiler."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1469538503, "creation_date": 1469538503, "answer_id": 38590802, "question_id": 38588507, "link": "https://stackoverflow.com/questions/38588507/implementation-of/38590802#38590802", "title": "Implementation of (^)", "body": "<p>Whenever you see a bread-and-butter function in the standard library and it's implemented weirdly, the reason is almost always \"because doing it like that triggers some special performance-critical optimization [possibly in a different version of the compiler]\".</p>\n\n<p>These odd workarounds are usually to \"force\" the compiler to notice that some specific, important optimization is possible (e.g., to force a particular argument to be considered strict, to allow worker/wrapper transformation, whatever). Typically some person has compiled their program, noticed it's epicly slow, complained to the GHC devs, and they looked at the compiled code and thought \"oh, GHC isn't seeing that it can inline that 3rd worker function... how do I fix that?\" The result is that if you rephrase the code just slightly, the desired optimization then fires.</p>\n\n<p>You say you tested it and there's not much speed difference. You didn't say <em>for what type</em>. (Is the exponent <code>Int</code> or <code>Integer</code>? What about the base? It's quite possible it makes a significant difference in some obscure case.)</p>\n\n<p>Occasionally functions are also implemented weirdly to maintain strictness / laziness guarantees. (E.g., the library spec says it has to work a certain way, and implementing it the most obvious way would make the function more strict / less strict than the spec claims.)</p>\n\n<p>I don't know what's up with this <em>specific</em> function, but I would suggest @chi is probably onto something.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1469540207, "creation_date": 1469540207, "answer_id": 38591434, "question_id": 38588507, "link": "https://stackoverflow.com/questions/38588507/implementation-of/38591434#38591434", "title": "Implementation of (^)", "body": "<p>A function is tail-recursive if the return value of a recursive call is returned as-is, without further processing. In <code>expo</code>, <code>f</code> is not tail-recursive, because of <code>otherwise = x * f  x (y-1)</code>: the return value of <code>f</code> is multiplied by <code>x</code> before it is returned. Both <code>f</code> and <code>g</code> in <code>(^)</code> <em>are</em> tail-recursive, because their return values are returned unmodified.</p>\n\n<p>Why does this matter? Tail-recursive functions can implemented much more efficiently than general recursive functions. Because the compiler doesn't need to create a new context (stack frame, what have you) for a recursive call, it can reuse the caller's context as the context of the recursive call. This saves a lot of the overhead of calling a function, much like in-lining a function is more efficient than calling the function proper.</p>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1475028393, "post_id": 38592926, "comment_id": 66771801, "body": "I see <code>even y</code> followed by <code>y `quot` 2</code> in this code. Would it have any improvement on performance if the division was done with a single <code>quotRem</code> call?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1475073474, "post_id": 38592926, "comment_id": 66797377, "body": "I doubt it. One is bit test instruction and the other is a shift."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1475075306, "post_id": 38592926, "comment_id": 66798778, "body": "How about a single shift, and then a carry flag check or similar? Or am i thinking in 6502 terms here?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1475081196, "post_id": 38592926, "comment_id": 66802699, "body": "That works with some ISAs, and is a little more efficient.  But given that these are all register operations I wouldn&#39;t expect and noticable difference with any decent code generator."}], "tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": false, "score": 13, "last_activity_date": 1469543986, "creation_date": 1469543986, "answer_id": 38592926, "question_id": 38588507, "link": "https://stackoverflow.com/questions/38588507/implementation-of/38592926#38592926", "title": "Implementation of (^)", "body": "<p>As the person who wrote the code, I can tell you why it's complex.  :)\nThe idea is to be tail recursive to get loops, and also to perform the minimum number of multiplications.  I don't like the complexity, so if you find a more elegant way please file a bug report. </p>\n"}], "owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 38591434, "answer_count": 3, "score": 8, "last_activity_date": 1475028421, "creation_date": 1469532056, "last_edit_date": 1475028421, "question_id": 38588507, "link": "https://stackoverflow.com/questions/38588507/implementation-of", "title": "Implementation of (^)", "body": "<p>I was reading the code of the implementation of (^) of the standard haskell library : </p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\nx0 ^ y0 | y0 &lt; 0    = errorWithoutStackTrace \"Negative exponent\"\n        | y0 == 0   = 1\n        | otherwise = f x0 y0\n    where -- f : x0 ^ y0 = x ^ y\n          f x y | even y    = f (x * x) (y `quot` 2)\n                | y == 1    = x\n                | otherwise = g (x * x) ((y - 1) `quot` 2) x\n          -- g : x0 ^ y0 = (x ^ y) * z\n          g x y z | even y = g (x * x) (y `quot` 2) z\n                  | y == 1 = x * z\n                  | otherwise = g (x * x) ((y - 1) `quot` 2) (x * z)\n</code></pre>\n\n<p>Now this part where g is defined seems odd to me why not just implement it like this:</p>\n\n<pre><code>expo :: (Num a ,Integral b) =&gt; a -&gt; b -&gt;a\nexpo x0 y0 \n    | y0 == 0 = 1\n    | y0 &lt;  0 = errorWithoutStackTrace \"Negative exponent\"\n    | otherwise = f x0 y0\n    where\n      f x y | even y = f (x*x) (y `quot` 2)\n              | y==1 = x\n              | otherwise = x * f  x (y-1)\n</code></pre>\n\n<p>But indeed plugging in say 3^1000000 shows that (^) is about 0,04 seconds faster than expo. </p>\n\n<blockquote>\n  <p>Why is <code>(^)</code> faster than <code>expo</code>?</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 7, "creation_date": 1469530731, "post_id": 38587437, "comment_id": 64564106, "body": "It&#39;s not clear what you&#39;re asking. It certainly doesn&#39;t seem to have much to do with \u201cchecking a list\u201d Please describe anew what you&#39;re trying to do, best with a type signature for the function you want to define. Also: please use markdown properly: inline code snippets like <code>[(1,1)]</code> should go in backticks, like so: <code>I add 1 (`[(1,1)]`)</code>. <i>And</i>: try to keep examples minimal. That graph of yours is certainly not as simple as it could be, for the purpose of this question."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469740045, "creation_date": 1469740045, "answer_id": 38646765, "question_id": 38587437, "link": "https://stackoverflow.com/questions/38587437/how-to-check-a-list-in-haskell/38646765#38646765", "title": "How to check a list in Haskell?", "body": "<p>With lazy evaluation you can use the \"tie-the-knot\" method to compute the depths very declaratively:</p>\n\n<pre><code>minOr0 [] = 0\nminOr0 ds = minimum ds\n\ndepths :: Graph gr =&gt; gr a b  -&gt; [(Node, Int)]\ndepths gr =\n  let pairs = [ (x, depth x) | x &lt;- nodes gr ]\n      depth x = 1 + minOr0 [ d | y &lt;- pre gr x, let Just d = lookup y pairs ]\n  in pairs\n\ntest2 = depths graph2\n</code></pre>\n\n<p>The definition between <code>pairs</code> and <code>depth</code> is circular: evaluating a tuple in <code>pairs</code> calls <code>depth</code>. Calling <code>depth</code> will look up other tuples in <code>pairs</code>. If the graph does not have any cycles the process will eventually\nterminate.</p>\n\n<p>Due to the way lazy evaluation works in Haskell, the calls to <code>depth</code>\nare effectively memoized.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469740045, "creation_date": 1469529155, "last_edit_date": 1469738252, "question_id": 38587437, "link": "https://stackoverflow.com/questions/38587437/how-to-check-a-list-in-haskell", "title": "How to check a list in Haskell?", "body": "<p>This is my code: </p>\n\n<pre><code>module Main where\n\nimport Data.Graph.Inductive\nimport Data.Graph.Inductive.Example\n\nfunc :: Graph gr=&gt; gr a b -&gt;[Node]-&gt;Int-&gt; [(Node,Int)]\nfunc graph (x:xs) y\n        |indeg graph x == 0 = (x,y+1):func (delNode x graph ) xs (y+1)\n\ngraph2:: Gr Int Int\ngraph2 = mkGraph (genLNodes 1 14)[(1,2,1),\n                (1,3,1),    \n                (3,14,1),\n                (14,6,1),\n                (14,7,1),\n                (2,4,1),\n                (2,5,1),\n                (4,6,1),\n                (5,7,1),\n                (6,8,1),\n                (7,9,1),\n                (8,10,1),\n                (9,11,1),\n                (10,12,1),\n                (11,12,1),\n                (12,13,1),\n                (14,13,1)]\n</code></pre>\n\n<p>Graph2 have 14 nodes and e.g (1,2,1) means, edge from node 1 to node 2 with a weight of 1.</p>\n\n<p>Func takes my Graph2, topological sorting vertices and some number e.g 0.\nFunc checks if  inward-bound degree of the Node is equal to 0 and creates list of tuples where x is IdNode and y is increasing when indeg graph x == 0 is true. The vertex is removed </p>\n\n<p>And here is my problem, I want to see if more vertices has a degree of 0 and add 1.</p>\n\n<p>EDIT:</p>\n\n<p>The function should act as follow:</p>\n\n<p>topsort: [1,3,14,2,5,7,9,11,4,6,8,10,12,13]</p>\n\n<ol>\n<li>check in-bound degree for each node in the list.</li>\n<li>if degree is equal 0, add 1 to path lenght ( node 1 in-bound is equal 0 so path length= 1)</li>\n<li>remove node from graph and  check in-bound degree of nodes after removing node and return to step 2.</li>\n</ol>\n\n<p>continuing example:</p>\n\n<p>after removing node 1, nodes 2 and 3 have in-bound = 0 so I add 1 to path length (path lenght = 2 for node 2 and 3 ) and I remove node 2 and 3.</p>\n\n<p>Now in-bound degree =0 have 14,4,5 so I add 1 to path length (path lenght =3) and I remove these nodes and so on </p>\n\n<p>I hope that the image of the graph will help.\n<a href=\"https://i.stack.imgur.com/e1xir.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/e1xir.jpg\" alt=\"Graph\"></a></p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 6, "creation_date": 1469517186, "post_id": 38583178, "comment_id": 64555079, "body": "Are you sure this isn&#39;t just a buffering issue?  Try <code>hPutStrLn stderr</code> instead."}, {"owner": {"reputation": 304, "user_id": 369080, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1f47821c36c8ed0d700fbfd20a4b80f1?s=128&d=identicon&r=PG", "display_name": "Daniel Hill", "link": "https://stackoverflow.com/users/369080/daniel-hill"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469521932, "post_id": 38583178, "comment_id": 64557959, "body": "@ThomasM.DuBuisson Yes it is just a buffering issue! now I feel kind of stupid..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469549787, "post_id": 38583178, "comment_id": 64578064, "body": "Bah, no feeling stupid.  It&#39;s a fair question.  Glad things are working."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469566163, "post_id": 38583178, "comment_id": 64587156, "body": "@ThomasM.DuBuisson That should probably be an answer. If you don&#39;t want to write it up, I&#39;m happy to!"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1469566288, "post_id": 38583178, "comment_id": 64587212, "body": "@jkeuhlen Knock yourself out!"}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 1, "last_activity_date": 1469567093, "last_edit_date": 1495540849, "creation_date": 1469567093, "answer_id": 38599859, "question_id": 38583178, "link": "https://stackoverflow.com/questions/38583178/my-haskell-program-is-too-lazy/38599859#38599859", "title": "My Haskell program is too lazy", "body": "<p>As <a href=\"https://stackoverflow.com/users/216164/thomas-m-dubuisson\">Thomas</a> pointed out in the comments, this looks like a buffering problem. The <code>System.IO</code> package describes standard <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO.html#g:12\" rel=\"nofollow noreferrer\">buffering behavior</a>. </p>\n\n<p>You have a couple of options on how to resolve this kind of issue. You can manually set the buffering mode in your program with:</p>\n\n<pre><code>hSetBuffering stdout NoBuffering\n</code></pre>\n\n<p>at the beginning of your function. This will turn off all buffering (you could also choose <code>LineBuffering</code>) and will print immediately to stdout. </p>\n\n<p>You could also flush the buffer after every print:</p>\n\n<pre><code>SDL.MouseMotionEvent dat -&gt; do\n  liftIO $ putStrLn \"HELLO\"\n  hFlush stdout\n</code></pre>\n\n<p>Or you can try to print directly to the <code>stderr</code> handle which has different default buffering rules:</p>\n\n<pre><code>SDL.MouseMotionEvent dat -&gt; do\n  liftIO $ hPutStrLn stderr \"HELLO\"\n</code></pre>\n"}], "owner": {"reputation": 304, "user_id": 369080, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1f47821c36c8ed0d700fbfd20a4b80f1?s=128&d=identicon&r=PG", "display_name": "Daniel Hill", "link": "https://stackoverflow.com/users/369080/daniel-hill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 38599859, "answer_count": 1, "score": 7, "last_activity_date": 1469567093, "creation_date": 1469516749, "question_id": 38583178, "link": "https://stackoverflow.com/questions/38583178/my-haskell-program-is-too-lazy", "title": "My Haskell program is too lazy", "body": "<p>I have a function like: </p>\n\n<pre><code>type App a = ExceptT AppError (ResourceT IO)\n\nonEvent :: SDL.EventPayload -&gt; App ()\nonEvent event = do\n  liftIO $ putStrLn \"EVE!\"\n  case event of\n    SDL.MouseMotionEvent dat -&gt; do\n      liftIO $ putStrLn \"HELLO\"\n    SDL.KeyboardEvent kbe  -&gt; liftIO $ putStrLn \"WORLD\"\n    _ -&gt; return ()\n</code></pre>\n\n<p>That is a callback being used in my app.</p>\n\n<p>This function seemingly doesn't fire, Because none of the putStrLn's print to console.</p>\n\n<p>But this function - with the slight modification does print everything to console:</p>\n\n<pre><code>onEvent :: SDL.EventPayload -&gt; App ()\nonEvent event = do\n  liftIO $ putStrLn \"EVE!\"\n  case event of\n    SDL.MouseMotionEvent dat -&gt; do\n      liftIO $ print dat\n    SDL.KeyboardEvent kbe  -&gt; liftIO $ print kbe\n    _ -&gt; return ()\n</code></pre>\n\n<p>Why does the full evaluation of <code>SDL.EventPayload</code> cause the surrounding <code>putStrLn</code>'s to work?</p>\n\n<p>How can I make my function callback a bit more reliable?</p>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 7, "last_activity_date": 1469509761, "creation_date": 1469509761, "answer_id": 38581417, "question_id": 38581083, "link": "https://stackoverflow.com/questions/38581083/role-of-functional-dependency-in-unfoldable-typeclass-of-haskell-collection-ap/38581417#38581417", "title": "Role of functional dependency in `Unfoldable` typeclass of Haskell Collection API", "body": "<p>The constraint expressed by that functional dependency is that given a collection type <code>c</code>, the type of its items <code>i</code> is already determined. For example, if <code>c ~ [a]</code>, i.e. the collection is a list of <code>a</code>s, then we should be able to determine that <code>i ~ a</code>. </p>\n\n<p>Without that functional dependency, we could have two instances e.g. <code>Unfoldable [a] a</code> (the obvious/intended instance) and <code>Unfoldable [a] [a]</code> (with something like <code>insert = concat</code>, <code>singleton = id</code>). If the typechecker then sees something like <code>empty :: [a]</code>, it would have no way of choosing which instance to use:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances #-}\n\nclass Unfoldable c i where\n    empty :: c\n\ninstance Unfoldable [a] a where\n    empty = []\n\ninstance Unfoldable [a] [a] where\n    empty = []\n\nxs :: [a]\nxs = empty\n</code></pre>\n\n<p>This results in:</p>\n\n<pre><code>No instance for (Unfoldable [a] i0) arising from a use of `empty'\nThe type variable `i0' is ambiguous\nRelevant bindings include\n  xs :: [a]\nNote: there are several potential instances:\n  instance Unfoldable [a] a\n  instance Unfoldable [a] [a]\nIn the expression: empty\nIn an equation for `xs': xs = empty\n</code></pre>\n"}], "owner": {"reputation": 2206, "user_id": 214185, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/60ad8425dc87dc0d42e7f0f482ac9bdb?s=128&d=identicon&r=PG", "display_name": "Ben Hutchison", "link": "https://stackoverflow.com/users/214185/ben-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1469509761, "creation_date": 1469507732, "last_edit_date": 1469509475, "question_id": 38581083, "link": "https://stackoverflow.com/questions/38581083/role-of-functional-dependency-in-unfoldable-typeclass-of-haskell-collection-ap", "title": "Role of functional dependency in `Unfoldable` typeclass of Haskell Collection API", "body": "<p>Im trying to understand the design of Haskell's <a href=\"https://hackage.haskell.org/package/collections-api-1.0.0.0/docs/Data-Collections.html\" rel=\"nofollow\"><code>Data.Collection</code></a> library, coming from a Scala-literate background.</p>\n\n<p>It uses <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow\">Functional Dependencies</a> (which have a <a href=\"https://milessabin.com/blog/2011/07/16/fundeps-in-scala/\" rel=\"nofollow\">Scala analog</a>) but the way they're used doesn't make sense to me. In the <code>Unfoldable</code> class, reproduced below, the element type <code>i</code> is shown as <em>determined by</em> the collection type <code>c</code>.</p>\n\n<blockquote>\n<pre><code>class Unfoldable c i | c -&gt; i\n</code></pre>\n  \n  <p>Class of collection with unobservable elements. It is the dual of the <code>Foldable</code> class.</p>\n</blockquote>\n\n<p>Please explain the role that the dependency <code>c -&gt; i</code> is playing here and the design intent, ideally with an example of usage?</p>\n"}, {"tags": ["haskell", "acid-state"], "answers": [{"tags": [], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "is_accepted": false, "score": 5, "last_activity_date": 1469500221, "creation_date": 1469500221, "answer_id": 38580171, "question_id": 38579990, "link": "https://stackoverflow.com/questions/38579990/haskell-acid-state-over-multiple-files/38580171#38580171", "title": "Haskell: acid-state over multiple files?", "body": "<p>OK, so I figure it out. Just separate the definition with the Template Haskell:</p>\n\n<pre><code>--- Database/Types.hs ---\ndata Database = ...\n...\n\n--- Database.hs ---\nimport Database.Types\nimport User\nimport Post\nmakeAcidic ''Database [addUser, addPost]\n\n--- User.hs ---\nimport Database.Types\naddUser :: Update Database ()\n...\n\n--- Post.hs ---\nimport Database.Types\naddPost :: Update Database ()\n...\n</code></pre>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1469500221, "creation_date": 1469498602, "question_id": 38579990, "link": "https://stackoverflow.com/questions/38579990/haskell-acid-state-over-multiple-files", "title": "Haskell: acid-state over multiple files?", "body": "<p>I have a file structure like this:</p>\n\n<pre><code>--- Database.hs ---\ndata Database = ...\n...\n\n--- User.hs ---\nimport Database\naddUser :: Update Database ()\n...\n\n--- Post.hs\nimport Database\naddPost :: Update Database ()\n...\n</code></pre>\n\n<p>The problem is that I need to called <code>makeAcidic ''Database [...]</code> in both <code>User.hs</code> and <code>Post.hs</code> to make their functions acidic, but <code>makeAcidic</code> at the same time generate <code>IsAcidic</code> instances for <code>Database</code> so GHC complains about duplicate instance declarations.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "is_accepted": true, "score": 1, "last_activity_date": 1469488381, "creation_date": 1469488381, "answer_id": 38578768, "question_id": 38578541, "link": "https://stackoverflow.com/questions/38578541/using-yesod-auth-hardcoded-siteadmin-in-a-hamlet-template/38578768#38578768", "title": "Using Yesod.Auth.Hardcoded SiteAdmin in a hamlet template", "body": "<p>As often posting the question made me think of an answer, though I'd still be grateful for any better ones. Using a combination of <code>$maybe</code> and <code>$case</code> like so:</p>\n\n<pre><code>    $maybe user &lt;- uid\n        $case user\n            $of Left _\n                &lt;p&gt;There's no name\n            $of Right username\n                &lt;p&gt;There might be a name of #{username}\n    $nothing\n       &lt;p&gt;No name\n</code></pre>\n\n<p>got me the correct username. Please post another answer if there is a better way.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469492354, "creation_date": 1469492354, "answer_id": 38579279, "question_id": 38578541, "link": "https://stackoverflow.com/questions/38578541/using-yesod-auth-hardcoded-siteadmin-in-a-hamlet-template/38579279#38579279", "title": "Using Yesod.Auth.Hardcoded SiteAdmin in a hamlet template", "body": "<p>The AuthId type here is <code>Either UserId String</code>.</p>\n\n<p>A Right value represents a \"hardcoded\" user which does not appear in the User table. A Left value represents a User row in the Users table.</p>\n\n<p>If you want to show a name for an AuthId, you can call <code>getAuthEntity</code> which returns an <code>Either User SiteManager</code> and then process it like this:</p>\n\n<pre><code>getUserName :: Either User SiteManager -&gt; String\ngetUserName (Left user) = ...get the name field from user...\ngetUserName (Right sitemgr) = manUserName sitemgr\n</code></pre>\n"}], "owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 38578768, "answer_count": 2, "score": 0, "last_activity_date": 1469492354, "creation_date": 1469486874, "last_edit_date": 1469487366, "question_id": 38578541, "link": "https://stackoverflow.com/questions/38578541/using-yesod-auth-hardcoded-siteadmin-in-a-hamlet-template", "title": "Using Yesod.Auth.Hardcoded SiteAdmin in a hamlet template", "body": "<h2>Problem description</h2>\n\n<p>I've been unable to get a compiling example of using <a href=\"https://www.stackage.org/haddock/lts-6.8/yesod-auth-1.4.13.3/Yesod-Auth-Hardcoded.html\" rel=\"nofollow\">Yesod.Auth.Hardcoded</a>. My problem is in trying to interrogate the user in a hamlet template. My <code>Foundation.hs</code> is set up as per the documentation in the link for hardcoded. My handler looks like this:</p>\n\n<pre><code>getHomeR :: Handler Html\ngetHomeR = do\n    uid &lt;- maybeAuthId\n    (widget, enctype) &lt;- generateFormPost . renderBootstrap3 BootstrapBasicForm $ blurbForm Nothing\n    currentPost &lt;- runDB $ selectFirst [] [Desc BlogId]\n    currentBlurb &lt;- runDB $ selectFirst [] [Desc BlurbId]\n    defaultLayout $ do\n        setTitle \"My site\"\n        addScriptRemote \"https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js\"\n        addScriptRemote \"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/collapse.js\"\n        $(widgetFile \"homepage\")\n</code></pre>\n\n<p>My site compiles and renders happily until I try to do anything useful with the <code>uid</code> being assigned in the <code>do</code> block above.</p>\n\n<h2>What I've tried</h2>\n\n<p>I've tried both the <code>$maybe</code> and <code>$case</code> constructs in the <a href=\"http://www.yesodweb.com/book/shakespearean-templates\" rel=\"nofollow\">hamlet documentation</a>. <code>$maybe</code> looked like this:</p>\n\n<pre><code>    $maybe user &lt;- uid\n       &lt;p&gt;There's a name\n    $nothing\n       &lt;p&gt;No name\n</code></pre>\n\n<p>This succeeded regardless of whether I logged in as the hardcoded user.</p>\n\n<p>The <code>$case</code> version looked like this:</p>\n\n<pre><code>    $case uid\n        $of Left _\n            &lt;p&gt;There's no name\n        $of Right username\n            &lt;p&gt;It worked\n</code></pre>\n\n<p>and failed with:</p>\n\n<pre><code>Exception when trying to run compile-time code:\n  Inside a $case there may only be $of.  Use '$of _' for a wildcard.\nCode: widgetFile \"homepage\"\nIn the splice: $(widgetFile \"homepage\")\n</code></pre>\n\n<h2>Question(s)</h2>\n\n<p>Am I setting the <code>uid</code> correctly in my handler code and, if so, how should I access the hardcoded <code>SiteManager</code> in my templates?</p>\n"}, {"tags": ["amazon-web-services", "haskell", "amazon-ec2", "cloud-haskell"], "comments": [{"owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1469540112, "post_id": 38574492, "comment_id": 64571032, "body": "What is your question, and what output are you currently getting?"}, {"owner": {"reputation": 55, "user_id": 3142764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ab15c53717f6cea57783cc8d73a55da?s=128&d=identicon&r=PG&f=1", "display_name": "user3142764", "link": "https://stackoverflow.com/users/3142764/user3142764"}, "reply_to_user": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1469555284, "post_id": 38574492, "comment_id": 64581237, "body": "Edited the output, there should be slaves connected but there isn&#39;t. What might be the problem?"}, {"owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "edited": false, "score": 0, "creation_date": 1469605216, "post_id": 38574492, "comment_id": 64600208, "body": "Did you look at the suggestion in the manual? <code>If you try the above example and the master process cannot find any slaves, then it might be that your firewall settings do not allow for UDP multicast (in particular, the default iptables on some Linux distributions might not allow it).</code>"}, {"owner": {"reputation": 55, "user_id": 3142764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ab15c53717f6cea57783cc8d73a55da?s=128&d=identicon&r=PG&f=1", "display_name": "user3142764", "link": "https://stackoverflow.com/users/3142764/user3142764"}, "edited": false, "score": 0, "creation_date": 1469618541, "post_id": 38574492, "comment_id": 64609271, "body": "Yes, I enabled UDP multicast."}], "owner": {"reputation": 55, "user_id": 3142764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ab15c53717f6cea57783cc8d73a55da?s=128&d=identicon&r=PG&f=1", "display_name": "user3142764", "link": "https://stackoverflow.com/users/3142764/user3142764"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1469555253, "creation_date": 1469469469, "last_edit_date": 1469555253, "question_id": 38574492, "link": "https://stackoverflow.com/questions/38574492/cloudhaskell-running-on-aws", "title": "CloudHaskell running on AWS", "body": "<p>I have created 3 EC2 Ubuntu instances on AWS and trying to run this code:</p>\n\n<pre><code>module Main where\n\nremotableDecl [ [d|\n  distribute :: ([NodeId], Int) -&gt; Process ()\n  distribute (slaves, x) = do\n    let x' = myMath x\n        nextNode = slaves !! (x' `mod` (length slaves))\n    say $ show x ++ \" - 1 = \" ++ show x'\n    unless (x' == 0) $\n      void $ spawn nextNode $ $(mkClosure 'distribute) (slaves, myMath x)\n  |]]\n\nremoteTable = __remoteTableDecl initRemoteTable\n\nmaster :: Backend -&gt; [NodeId] -&gt; Process ()\nmaster backend slaves = do\n  liftIO . putStrLn $ \"Slaves: \" ++ show slaves\n  distribute (slaves, 15)\n  terminateAllSlaves backend\n\nmain :: IO ()\nmain = do\n  prog &lt;- getProgName\n  args &lt;- getArgs\n\n  case args of\n    [\"master\", host, port] -&gt; do\n      backend &lt;- initializeBackend host port remoteTable\n      startMaster backend (master backend)\n    [\"slave\", host, port] -&gt; do\n      backend &lt;- initializeBackend host port remoteTable\n      startSlave backend\n</code></pre>\n\n<p>by these commands as stated here <a href=\"https://hackage.haskell.org/package/distributed-process-simplelocalnet-0.2.3.2/docs/Control-Distributed-Process-Backend-SimpleLocalnet.html\" rel=\"nofollow\">https://hackage.haskell.org/package/distributed-process-simplelocalnet-0.2.3.2/docs/Control-Distributed-Process-Backend-SimpleLocalnet.html</a></p>\n\n<p>$ stack exec -- test slave 172.31.3.226 8080 &amp;</p>\n\n<p>$ stack exec -- test slave 172.31.3.227 8080 &amp;</p>\n\n<p>$ stack exec -- test master 172.31.3.228 8080</p>\n\n<p>IPs are private IPs of AWS instances. But when I run as master, there is no slaves connected. This is the output:</p>\n\n<p>Slaves: []</p>\n\n<p>Tue Jul 26 17:45:04 UTC 2016 pid://172.31.3.228:8000:0:10: 15 - 1 = 14</p>\n\n<p>test: divide by zero</p>\n\n<p>There should be slaves connected in the output, but there is not.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1469465456, "post_id": 38573331, "comment_id": 64535755, "body": "<code>(&gt;&gt;)</code> discarded the <i>values</i> <code>1</code> and <code>2</code>, but that doesn&#39;t mean that <code>x &gt;&gt; y === y</code>..."}, {"owner": {"reputation": 151, "user_id": 5547064, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17f729819f81820b6ee86ac4b99824cf?s=128&d=identicon&r=PG&f=1", "display_name": "Scipio", "link": "https://stackoverflow.com/users/5547064/scipio"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469465684, "post_id": 38573331, "comment_id": 64535882, "body": "With simpler example I get what I had expected: [1] &gt;&gt; [2] results [2]"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1469466310, "post_id": 38573331, "comment_id": 64536216, "body": "Try it with different types to understand. E.g. <code>[1,2] &gt;&gt; [&#39;a&#39;]</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469466831, "post_id": 38573331, "comment_id": 64536526, "body": "@Scipio I didn&#39;t say it was impossible to find <code>x</code> and <code>y</code> such that <code>x &gt;&gt; y === y</code>, only that such a statement is not true for all <code>x</code> and <code>y</code>."}, {"owner": {"reputation": 4070, "user_id": 104672, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/R72O5.png?s=128&g=1", "display_name": "Andre", "link": "https://stackoverflow.com/users/104672/andre"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469603715, "post_id": 38573331, "comment_id": 64599149, "body": "Like @pdexter says doing this with different values helps to understand the explanations below. E.g. this in ghci     ([1,2] :: [Int]) &gt;&gt; [&quot;a&quot;,&quot;b&quot;] gives you    [&quot;a&quot;,&quot;b&quot;,&quot;a&quot;,&quot;b&quot;]"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 12, "last_activity_date": 1469467800, "last_edit_date": 1469467800, "creation_date": 1469466283, "answer_id": 38573653, "question_id": 38573331, "link": "https://stackoverflow.com/questions/38573331/cant-understand-result-of-monad-application/38573653#38573653", "title": "Can&#39;t understand result of Monad &gt;&gt; application", "body": "<p><code>(&gt;&gt;)</code> is by default defined as</p>\n\n<pre><code>a &gt;&gt; b = a &gt;&gt;= (\\_ -&gt; b)\n</code></pre>\n\n<p>so the value being ignored is an <code>a</code> in a given monadic value <code>m a</code>. The type of <code>&gt;&gt;=</code> specialised to list is:</p>\n\n<pre><code>(&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]\n</code></pre>\n\n<p><code>l &gt;&gt;= f</code> invokes <code>f</code> for each element of the list <code>l</code> to product a list of lists which is then concatenated.</p>\n\n<p>e.g.</p>\n\n<pre><code>[1,2] &gt;&gt;= (\\i -&gt; [i, -i])\n&gt; [1,-1,2,-2]\n</code></pre>\n\n<p>Ignoring each input element and returning the value <code>[2,3]</code> will result in n copies of the list <code>[2,3]</code> for an input list of length <code>n</code></p>\n\n<p>e.g.</p>\n\n<pre><code>[1] &gt;&gt;= (\\_ -&gt; [2,3])\n&gt; [2,3]\n\n[1,2] &gt;&gt;= (\\_ -&gt; [2,3])\n&gt; [2,3,2,3]\n</code></pre>\n\n<p>this second example is equivalent to <code>([1] ++ [2]) &gt;&gt; ([2] ++ [3])</code> in your question.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1469470959, "creation_date": 1469470959, "answer_id": 38574911, "question_id": 38573331, "link": "https://stackoverflow.com/questions/38573331/cant-understand-result-of-monad-application/38574911#38574911", "title": "Can&#39;t understand result of Monad &gt;&gt; application", "body": "<p>A small complement to the answer by Lee:</p>\n\n<pre><code>([1] ++ [2]) &gt;&gt; ([2] ++ [3])\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>([1] ++ [2]) &gt;&gt; ([2] ++ [3]) &gt;&gt;= \\x -&gt; return x\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>([1] ++ [2]) &gt;&gt;= \\y -&gt; ([2] ++ [3]) &gt;&gt;= \\x -&gt; return x\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>[ x | y &lt;- [1]++[2] , x &lt;- [2]++[3] ]\n</code></pre>\n\n<p>which is close to the imperative pseudocode</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>for y in [1]++[2]:\n   for x in [2]++[3]:\n      print x\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5547064, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17f729819f81820b6ee86ac4b99824cf?s=128&d=identicon&r=PG&f=1", "display_name": "Scipio", "link": "https://stackoverflow.com/users/5547064/scipio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 38573653, "answer_count": 2, "score": 6, "last_activity_date": 1469470959, "creation_date": 1469465124, "question_id": 38573331, "link": "https://stackoverflow.com/questions/38573331/cant-understand-result-of-monad-application", "title": "Can&#39;t understand result of Monad &gt;&gt; application", "body": "<p>Operation >> description is the following: </p>\n\n<blockquote>\n  <p>Sequentially compose two actions, discarding any value produced by the\n  first, like sequencing operators (such as the semicolon) in imperative\n  languages.</p>\n</blockquote>\n\n<p>Here is the example which confuses me:</p>\n\n<pre><code>&gt; ([1] ++ [2]) &gt;&gt; ([2] ++ [3])\n[2,3,2,3]\n</code></pre>\n\n<p>I'm expecting the list [2,3] which would be result of right part of expression. How can result of [2,3,2,3] be explained?</p>\n"}, {"tags": ["haskell", "dependent-type", "refinement-type"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469465120, "post_id": 38572799, "comment_id": 64535569, "body": "And how would you define <code>return</code>/<code>pure</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1469468290, "creation_date": 1469468290, "answer_id": 38574157, "question_id": 38572799, "link": "https://stackoverflow.com/questions/38572799/using-a-monad-to-implicitly-check-refinement-type-well-formedness/38574157#38574157", "title": "Using a monad to implicitly check refinement type well-formedness", "body": "<p>In your case, I don't think you actually want a monad, just the sugar that accompanies <code>do</code> notation. For example, have you thought about what your definition of <code>Applicative</code> will look like? Things get messy fast when you try to cheat your way through this.</p>\n\n<p>Instead, if you want to use the <code>do</code>-notation, I suggest you use </p>\n\n<pre><code>{-# LANGUAGE RebindableSyntax #-}\n</code></pre>\n\n<p>which allows you to redefine, amongst other thing, the <code>(&gt;&gt;=)</code> and <code>return</code> used in desugaring a <code>do</code> block. You could then write something like:</p>\n\n<pre><code>myBind :: RefTy t1 =&gt; WellFormed t1 -&gt; (t1 -&gt; WellFormed t2) -&gt; WellFormed t2\nmyBind Invalid _ = Invalid\nmyBind (Valid t) f | tyOK t = f t\n                   | otherwise Invalid \n\nmyReturn :: WellFormed t\nmyReturn t = Valid t\n</code></pre>\n\n<p>I'm not sure I agree with those definitions, but regardless you would then be able to write something like</p>\n\n<pre><code>do\n  ...\n  where (&gt;&gt;=) = myBind\n        return = myReturn\n</code></pre>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 38574157, "answer_count": 1, "score": 1, "last_activity_date": 1469468290, "creation_date": 1469463415, "last_edit_date": 1495539862, "question_id": 38572799, "link": "https://stackoverflow.com/questions/38572799/using-a-monad-to-implicitly-check-refinement-type-well-formedness", "title": "Using a monad to implicitly check refinement type well-formedness", "body": "<p>While implementing a refinement type system, I need to put in checks to make sure the types are well-formed. For example, a type like <code>Num[100,0]</code> shouldn't happen, where <code>Num[lb,ub]</code> is the type of numbers larger than <code>lb</code> and smaller than <code>ub</code>. I then wrote: </p>\n\n<pre><code>-- FORMATION RULES\n\nclass RefTy t \n  where tyOK :: t -&gt; Bool\n\ninstance RefTy Ty\n  where tyOK (NumTy (n1, n2)) = n1 &lt;= n2\n        tyOK (CatTy cs) = isSet cs\n\n{-\ndata WellFormed t = Valid t\n                  | Invalid\n\ninstance Monad WellFormed\n  where \n    (&gt;&gt;=) :: RefTy a =&gt; WellFormed a -&gt; (a -&gt; WellFormed b) -&gt; WellFormed b\n    Valid t &gt;&gt;= f \n            | tyOK t = f t\n            | otherwise = Invalid\n    Invalid &gt;&gt;= _ = Invalid\n-}\n</code></pre>\n\n<p>Which got me into the known problem of \"<a href=\"https://stackoverflow.com/questions/379546/restricting-a-monad-to-a-type-class\">restricted Monad</a>\". The suggested answer is to have the <code>Wellformed</code> monad to be general but restrict the functions. However that would go back to adding the well-formed check everywhere. Is there a better way to get around? </p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1469469417, "post_id": 38573681, "comment_id": 64538025, "body": "If you enable <code>RecordWildCards</code>, you can use just <code>P.TokenParser{..} = lexer</code> at the top level to define all of the record fields."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1469469953, "last_edit_date": 1469469953, "creation_date": 1469466388, "answer_id": 38573681, "question_id": 38572507, "link": "https://stackoverflow.com/questions/38572507/avoid-repetition-in-lexing-when-using-parsec/38573681#38573681", "title": "Avoid repetition in lexing when using parsec", "body": "<p>There is a general <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching#Introduction_to_records\" rel=\"nofollow\">syntax for pattern matching on records</a> in Haskell (I started by noticing that all of <code>P.parens</code>, <code>P.braces</code>, etc. are record projection functions - you can see that by looking at the <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Token.html\" rel=\"nofollow\">docs</a>.) . You can use that here</p>\n\n<pre><code>P.TokenParser { P.parens      = parens\n              , P.braces      = braces\n              , P.identifier  = identifier\n              , P.reserved    = reserved\n              } = P.makeTokenParser haskellDef \n</code></pre>\n\n<h1>EDIT</h1>\n\n<p>As ErikR has pointed out, it you don't just want <em>some</em> of the parsers, but you want all 29 of the <code>GenTokenParser</code> fields brought into global scope, you can enable the <code>RecordWildCards</code> extension and just write</p>\n\n<pre><code> P.TokenParser {..} = P.makeTokenParser haskellDef\n</code></pre>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 38573681, "answer_count": 1, "score": 0, "last_activity_date": 1469469953, "creation_date": 1469462466, "question_id": 38572507, "link": "https://stackoverflow.com/questions/38572507/avoid-repetition-in-lexing-when-using-parsec", "title": "Avoid repetition in lexing when using parsec", "body": "<p>The Parsec documentation has an example of using <code>makeTokenParser</code> to build a lexer: </p>\n\n<pre><code>module Main where\n\n import Text.Parsec\n import qualified Text.Parsec.Token as P\n import Text.Parsec.Language (haskellDef)\n\n -- The parser\n ...\n\n expr  =   parens expr\n       &lt;|&gt; identifier\n       &lt;|&gt; ...\n\n\n -- The lexer\n lexer       = P.makeTokenParser haskellDef    \n\n parens      = P.parens lexer\n braces      = P.braces lexer\n identifier  = P.identifier lexer\n reserved    = P.reserved lexer\n ...\n</code></pre>\n\n<p>In \"The lexer\" block, every <code>P.*</code> is applied to lexer so that one can avoid repeating that in \"The parser\" block. However repeating that for every token is still tedious. Is there some way to avoid the repetition even more? I was thinking to implicitly apply lexer everywhere in \"The parser\", but am at lost how to. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1469459478, "post_id": 38571364, "comment_id": 64532083, "body": "Try explicitly giving it a type, e.g. <code>fmap (+1) $ read &quot;[1]&quot; :: [Int]</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1469461113, "post_id": 38571364, "comment_id": 64533096, "body": "Unrelatedly, you should pretty much never use <code>read</code>, because it makes your program crash if there&#39;s a parse error. Use something like <code>readMaybe</code> instead."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469469080, "post_id": 38571364, "comment_id": 64537859, "body": "or just use <code>map</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 7, "last_activity_date": 1469459538, "creation_date": 1469459538, "answer_id": 38571443, "question_id": 38571364, "link": "https://stackoverflow.com/questions/38571364/fmap-1-read-1-gives-error/38571443#38571443", "title": "fmap (+1) $ read &quot;[1]&quot; gives error", "body": "<p>It just doesn't know what type read your value into. Help it by specifying the type explicitly:</p>\n\n<pre><code>fmap (+1) $ (read \"[1]\" :: [Int])\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 38571443, "answer_count": 1, "score": 0, "last_activity_date": 1469459538, "creation_date": 1469459316, "question_id": 38571364, "link": "https://stackoverflow.com/questions/38571364/fmap-1-read-1-gives-error", "title": "fmap (+1) $ read &quot;[1]&quot; gives error", "body": "<p>When I type into the repl \n    fmap (+1) $ read \"[1]\" \nI would expect to get [2] but instead I get the error :</p>\n\n<blockquote>\n  <p>No instance for (Functor f0) arising from a use of \u2018it\u2019</p>\n</blockquote>\n\n<p>Unfortunately this doesn't help me. Could somebody explain to me what is wrong with this snipped of code.</p>\n"}, {"tags": ["haskell", "networking"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469458738, "post_id": 38570323, "comment_id": 64531615, "body": "stack installs components into ~/.stack/snapshots/... which is not where cabal looks for stuff. Perhaps you would be better off creating a .cabal file for your work and using stack to build it. Tutorial available <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/GUIDE.md#hello-world-example\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 0, "last_activity_date": 1469474326, "creation_date": 1469474326, "answer_id": 38575804, "question_id": 38570323, "link": "https://stackoverflow.com/questions/38570323/failing-cabal-install-missingh-and-network-on-windows/38575804#38575804", "title": "failing cabal install MissingH and network on Windows", "body": "<p>Stack makes some assumptions about your setup, noteably:</p>\n\n<ul>\n<li>... that it's the only one managing packages on the system</li>\n<li>... that it's the only one managing ghc on the system</li>\n<li>... that it's the only one managing cabal on the system</li>\n<li>... that every project is sandboxed</li>\n<li>... that you would rather have stability and predictability than the newest versions of everything</li>\n</ul>\n\n<p>You can get away with using stack together with \"plain\" tools - but only in different projects and if you're really careful. Things like differing versions of cabal-install can still trip it up. At the same time it keeps its own data separated so installing anything via stack is invisible to cabal. Thus you have two choices: Either have your project buy into stack completely or ditch it completely. </p>\n\n<p>If you want to use it, just add MissingH to your .cabal file and rebuild and everything should be fine. If errors do pop up, the easiest solution is to purge the local cabal repository and try again. If that doesn't work, purge the whole platform and have stack reinstall everything itself and try again. Stack is a picky diva, but once she's on stage she runs it. Tip: if you like the cabal interface but choose to use stack you can always run stuff like <code>stack exec -- cabal install MissingH</code>.</p>\n\n<p>The other option is to ditch stack completely. Uninstall it and use cabal alone, possibly with sandboxes. That still leaves you with the original problem - which looks like a native library is missing that you have to install separately. I have no idea which one it is in this specific case, but I can give you a few hints where to look. If you find no documentation about it, you can just look into the stack files. (they succeeded, after all) But the simplest option is to just look which networking libraries cygwin installed and have it also install the -dev versions of them. They are almost always the right ones.</p>\n"}, {"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1470468585, "creation_date": 1470468585, "answer_id": 38801715, "question_id": 38570323, "link": "https://stackoverflow.com/questions/38570323/failing-cabal-install-missingh-and-network-on-windows/38801715#38801715", "title": "failing cabal install MissingH and network on Windows", "body": "<p>The problem seems to be this</p>\n\n<blockquote>\n  <p>configure: error: in `/tmp/cabal-tmp-6136/network-2.6.2.1':</p>\n  \n  <p>configure: error: C compiler cannot create executables</p>\n</blockquote>\n\n<p>Either you don't have a C compiler installed or it's too old.\nWe don't actually support Cygwin anymore, try installing msys2 (actually doesn't platform come with this now?) and compiling via that.</p>\n\n<p>You'll have to install a C compiler as well <code>pacman -S mingw-w64-$(uname -m)-gcc</code> should do. The ./configure scripts won't be able to detect GHC's inplace GCC I think. Not sure as I haven't used platform in a while.</p>\n"}], "owner": {"reputation": 51, "user_id": 3737651, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c249acf38009110ae5222ae3a1700242?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre van de Laar", "link": "https://stackoverflow.com/users/3737651/pierre-van-de-laar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 571, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1470468585, "creation_date": 1469456525, "last_edit_date": 1495541285, "question_id": 38570323, "link": "https://stackoverflow.com/questions/38570323/failing-cabal-install-missingh-and-network-on-windows", "title": "failing cabal install MissingH and network on Windows", "body": "<p>I just installed a new Haskell version: HaskellPlatform-8.0.1-minimal-x86_64-setup-a, \nI need the package MissingH, which needs the package network.\nHowever cabal install network yields:</p>\n\n<pre><code>$ cabal install network\nResolving dependencies...\ncabal: Entering directory 'C:\\cygwin64\\tmp\\cabal-tmp-6136\\network-2.6.2.1'\nConfiguring network-2.6.2.1...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking build system type... x86_64-unknown-cygwin\nchecking host system type... x86_64-unknown-cygwin\nchecking for gcc... C:\\PROGRA~1\\HASKEL~1\\802E01~1.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/cabal-tmp-6136/network-2.6.2.1':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\cygwin64\\tmp\\cabal-tmp-6136\\network-2.6.2.1'\nFailed to install network-2.6.2.1\ncabal.exe: Error: some packages failed to install:\nnetwork-2.6.2.1 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>First, I tried to start Cygwin command window as administrator, but that didn't solve the problem.\nThen, I followed <a href=\"https://stackoverflow.com/questions/37354416/stack-cannot-build-network-wheres-config-log\">stack cannot build network - where&#39;s config.log?</a></p>\n\n<p>While installing using stack yields success,\nalthough I have to run stack setup</p>\n\n<pre><code>$ stack build\nCompiler version mismatched, found ghc-8.0.1 (x86_64), but expected minor version match with ghc-7.10.3 (x86_64) (based on resolver setting in C:\\tmp\\network-2.6.2.1\\stack.yaml).\nTry running \"stack setup\" to install the correct GHC into C:\\Users\\&lt;username&gt;\\AppData\\Local\\Programs\\stack\\x86_64-windows\\\n</code></pre>\n\n<p>after stack setup, stack build, I get:</p>\n\n<pre><code>$ stack test\nnetwork-2.6.2.1: test (suite: regression)\n\ntestGetAddrInfo: [OK]\n\n         Test Cases  Total\n Passed  1           1\n Failed  0           0\n Total   1           1\n\nnetwork-2.6.2.1: test (suite: simple)\n\nBasic socket operations:\n  testSend: [OK]\n  testSendAll: [OK]\n  testSendTo: [OK]\n  testSendAllTo: [OK]\n  testSendMany: [OK]\n  testSendManyTo: [OK]\n  testRecv: [OK]\n  testOverFlowRecv: [OK]\n  testRecvFrom: [OK]\n  testOverFlowRecvFrom: [OK]\n  testUserTimeout: [OK]\n\n         Test Cases  Total\n Passed  11          11\n Failed  0           0\n Total   11          11\n</code></pre>\n\n<p>Yet still I can't continue with MissingH. In fact, it still tries to install network!</p>\n\n<pre><code>$ cabal install MissingH\nResolving dependencies...\ncabal: Entering directory 'C:\\cygwin64\\tmp\\cabal-tmp-5596\\network-2.6.2.1'\nConfiguring network-2.6.2.1...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking build system type... x86_64-unknown-cygwin\nchecking host system type... x86_64-unknown-cygwin\nchecking for gcc... C:\\PROGRA~1\\HASKEL~1\\802E01~1.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/cabal-tmp-5596/network-2.6.2.1':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\cygwin64\\tmp\\cabal-tmp-5596\\network-2.6.2.1'\nFailed to install network-2.6.2.1\n</code></pre>\n\n<p>I also tried: <a href=\"http://neilmitchell.blogspot.nl/2010/12/installing-haskell-network-library-on.html\" rel=\"nofollow noreferrer\">http://neilmitchell.blogspot.nl/2010/12/installing-haskell-network-library-on.html</a> which was tested on GHC 6.12.3 and 7.0.1 (and not on the new 8.0.1 version).\nUnfortunately, I get the error:</p>\n\n<pre><code>getEnv: invalid argument (The operation completed successfully.)\n</code></pre>\n\n<p>Just for completeness, my cabal version:</p>\n\n<pre><code>$ cabal -V\ncabal-install version 1.24.0.0\ncompiled using version 1.24.0.0 of the Cabal library\n</code></pre>\n\n<p>What am I missing to install network and MissingH?</p>\n"}, {"tags": ["haskell", "graph", "time-complexity", "cyclic-dependency", "tying-the-knot"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1469439588, "post_id": 38564001, "comment_id": 64518890, "body": "I think the most sensible thing would be to switch to a general graph data type right away, e.g. from the <a href=\"http://hackage.haskell.org/package/fgl\" rel=\"nofollow noreferrer\">fgl</a> library."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469448791, "post_id": 38564001, "comment_id": 64524543, "body": "I&#39;m not sure if this is exactly what you&#39;re asking, but maybe this answer might help: you cannot dynamically tie the knot in Haskell."}, {"owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1469449034, "post_id": 38564001, "comment_id": 64524733, "body": "@leftaroundabout Yes, it is what I will do probably, but I would prefer better control. Anyway, I want to understand infinite lists in Haskell better. I have a feeling, that things like cyclic lists could be essential for tasks like term rewriting (theorem proving). Those tends to make combinatorial explosion, must be desirable to introduce most economical data structures as soon as possible."}, {"owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469449571, "post_id": 38564001, "comment_id": 64525090, "body": "@pdexter Even using Template Haskell? How fundamental is this restriction?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469449651, "post_id": 38564001, "comment_id": 64525149, "body": "@AlexeyBirukov I&#39;m not sure how Template Haskell would help, since it&#39;s a static system. But maybe you have an idea about something I haven&#39;t thought of?"}, {"owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469450126, "post_id": 38564001, "comment_id": 64525505, "body": "@pdexter No, I have no real idea, actually, not used TH myself, only read what other people do."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469457959, "post_id": 38564001, "comment_id": 64531093, "body": "I&#39;m not sure what &quot;dynamically tie the knot&quot; means exactly, but I imagine the examples at <a href=\"https://wiki.haskell.org/Tying_the_Knot#Migrated_from_the_old_wiki\" rel=\"nofollow noreferrer\">wiki.haskell.org/Tying_the_Knot#Migrated_from_the_old_wiki</a> are instances of it. Anyways it&#39;s not the issue here, which has more to do with detecting cyclic structures."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 2, "creation_date": 1469475749, "post_id": 38564001, "comment_id": 64541432, "body": "Generally &quot;observing sharing&quot; is a side-effect so to do this consistently will require stepping into <code>IO</code>. At this point you can just work with <code>IORef</code>s as pointers."}, {"owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "edited": false, "score": 0, "creation_date": 1469477931, "post_id": 38564001, "comment_id": 64542586, "body": "Reid Barton@ Native cycles cant be detected: <a href=\"http://stackoverflow.com/questions/30272662/would-the-ability-to-detect-cyclic-lists-in-haskell-break-any-properties-of-the\" title=\"would the ability to detect cyclic lists in haskell break any properties of the\">stackoverflow.com/questions/30272662/&hellip;</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1469492070, "post_id": 38564001, "comment_id": 64547515, "body": "Although observable sharing is a side-effect, that doesn&#39;t mean it is impossible.  It just means you have to get ugly and be careful...  <a href=\"http://www.ittc.ku.edu/~andygill/papers/reifyGraph.pdf\" rel=\"nofollow noreferrer\">ittc.ku.edu/~andygill/papers/reifyGraph.pdf</a>"}, {"owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1469528240, "post_id": 38564001, "comment_id": 64562504, "body": "@luqui, J. Abrahamson Observable sharing looks relevant, went studying."}], "owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1469438549, "creation_date": 1469438549, "question_id": 38564001, "link": "https://stackoverflow.com/questions/38564001/how-to-preserve-native-cyclic-list-structure-during-transformations-in-haskell", "title": "How to preserve native cyclic list structure during transformations in Haskell?", "body": "<p>I'm studying graph-like things handling in Haskell using 'tying the knot' technique. I suppose, cyclic lists is just kind of infinite list internal implementation, so in ideal world one should not care about subj. But it can have dramatic effect on computational complexity, consider the example, 1D cellular automata with looped world:</p>\n\n<pre><code>ribbon = let x = 0 : y\n             y = 1 : x\n         in  x\n\nupdate_cycle :: Num a =&gt; [a] -&gt; [a]\nupdate_cycle lst@(_:xs) = ( f lst : update_cycle xs)\nupdate_cycle []         = error \"infinite cycle assumed\"\n\nf :: Num a =&gt; [a] -&gt; a           --  some arbitrary list reduction\nf (x:(y:_)) = traceShow \"f called\" $ x - y\n</code></pre>\n\n<p>This is a loop with just two cells. Let's make a step:</p>\n\n<pre><code>*Main&gt; take 2 $ update_cycle ribbon\n[-1,1]\n\"f called\"\n\"f called\"\n</code></pre>\n\n<p>Thats good, now two steps:</p>\n\n<pre><code>*Main&gt; take 2 $ (update_cycle . update_cycle) ribbon\n[-2,2]\n\"f called\"\n\"f called\"\n\"f called\"\n\"f called\"\n\"f called\"\n</code></pre>\n\n<p>That's five calls instead of four, and it actually means increase count of calls on each step, so we have quadratic complexity on total step count instead of linear. I've could make cyclics explicit, like this:</p>\n\n<pre><code>newtype UserDefCyclic a = UserDefCyclic { fromTC :: [a] }\n\nudcToList :: UserDefCyclic a -&gt; [a]\nudcToList (UserDefCyclic x) = cycle x\n\nupdate_udc :: Num a =&gt; UserDefCyclic a -&gt; UserDefCyclic a\nupdate_udc (UserDefCyclic core) = UserDefCyclic $ take (length core) (update_cycle ( cycle core )) \n</code></pre>\n\n<p>But it's ugly, while I really interested in more complex structures like graphs. \nThe question: is there a way to have here code both nice and fast? Or is there a hope that compiler will handle code above better in some bright future?</p>\n"}, {"tags": ["haskell", "yi-editor"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469421528, "post_id": 38558331, "comment_id": 64510421, "body": "Answer updated with recipe for stack."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1469423785, "last_edit_date": 1469423785, "creation_date": 1469418710, "answer_id": 38559454, "question_id": 38558331, "link": "https://stackoverflow.com/questions/38558331/could-not-find-module-yi-when-launching-yi-editor/38559454#38559454", "title": "\u201cCould not find module \u2018Yi\u2019\u201d when launching Yi Editor", "body": "<p><strong>Using Stack</strong></p>\n\n<p>This worked for me with stack:</p>\n\n<pre><code>$ git clone https://github.com/yi-editor/yi.git\n$ cd yi\n$ cabal get Hclip\n...create a stack.yaml file...\n$ stack build\n$ stack exec yi\n</code></pre>\n\n<p>The stack.yaml file consists of:</p>\n\n<pre><code>resolver: lts-6.0\npackages:\n- '.'\n- 'Hclip-3.0.0.4'\n</code></pre>\n\n<p>Note: After the <code>stack build</code> I tried <code>stack install</code> and <code>stack exec yi</code> stopped working - so don't run <code>stack install</code>.</p>\n\n<p><strong>Using a Cabal Sandbox</strong></p>\n\n<p>I was able to install it using a cabal sandbox:</p>\n\n<pre><code>$ git clone https://github.com/yi-editor/yi.git\n$ cd yi\n$ cabal sandbox init\n$ cabal install --only-dependencies\n$ cabal install\n$ cabal exec yi\n</code></pre>\n\n<p>Modifying <code>yi.hs</code> also works:</p>\n\n<pre><code>$ cp example-configs/yi-simple.hs ~/.config/yi/yi.hs\n$ cabal exec yi\n</code></pre>\n\n<p>To set up a script so you can run yi from any directory, use:</p>\n\n<pre><code>#!/bin/sh\n\nYI_DIR=...\nenv CABAL_SANDBOX_CONFIG=$YI_DIR/cabal.sandbox.config cabal exec yi -- \"$@\"\n</code></pre>\n\n<p>Here <code>YI_DIR</code> is the directory containing the cabal.sandbox.config file.</p>\n\n<p>Note that these instructions are almost the same as the ones found at:</p>\n\n<p><a href=\"http://yi-editor.github.io/pages/installing/#InstallinginsideaCabalsandbox\" rel=\"nofollow\">http://yi-editor.github.io/pages/installing/#InstallinginsideaCabalsandbox</a></p>\n\n<p>except for the way yi is invoked using <code>cabal exec</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 432, "user_id": 1567363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ee4RG.jpg?s=128&g=1", "display_name": "Kazuki Okamoto", "link": "https://stackoverflow.com/users/1567363/kazuki-okamoto"}, "is_accepted": true, "score": 2, "last_activity_date": 1469435329, "creation_date": 1469435329, "answer_id": 38562916, "question_id": 38558331, "link": "https://stackoverflow.com/questions/38558331/could-not-find-module-yi-when-launching-yi-editor/38562916#38562916", "title": "\u201cCould not find module \u2018Yi\u2019\u201d when launching Yi Editor", "body": "<p>Use <code>stack exec yi</code>. If you want to add options to Yi, use <code>stack exec -- yi --foo</code>.</p>\n\n<pre><code>$ stack exec yi\nRun from outside a project, using implicit global project config\nUsing resolver: lts-6.7 from implicit global project's config file: /Users/kakkun61/.stack/global-project/stack.yaml\nConfiguration '/Users/kakkun61/.config/yi/yi.hs' changed. Recompiling.\nProgram reconfiguration successful.\nLaunching custom binary /Users/kakkun61/.cache/yi/yi-darwin-x86_64\n\nIt works.\n</code></pre>\n"}], "owner": {"reputation": 432, "user_id": 1567363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ee4RG.jpg?s=128&g=1", "display_name": "Kazuki Okamoto", "link": "https://stackoverflow.com/users/1567363/kazuki-okamoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 38562916, "answer_count": 2, "score": 0, "last_activity_date": 1469435329, "creation_date": 1469407995, "question_id": 38558331, "link": "https://stackoverflow.com/questions/38558331/could-not-find-module-yi-when-launching-yi-editor", "title": "\u201cCould not find module \u2018Yi\u2019\u201d when launching Yi Editor", "body": "<p>I successfully installed Yi Editor using Stack (with global setting).</p>\n\n<blockquote>\n  <ul>\n  <li>OS X El Capitan 10.11.5</li>\n  <li>Stack 1.1.0 (LTS 6.7)</li>\n  </ul>\n</blockquote>\n\n<p>I put the following config file at <em>~/.config/yi/yi.hs</em>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Yi\nmain = putStrLn \"It works.\"\n</code></pre>\n\n<p>Then I ran <code>yi</code> and got following error in the \u201c&lowast;&lowast;error&lowast;&lowast;\u201d pane.</p>\n\n<pre><code>/Users/kakkun61/.config/yi/yi.hs:1:8:\n    Could not find module \u2018Yi\u2019\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>How can I solve this? And where does Yi Editor find libraries?</p>\n\n<p>P.S. <code>yi</code> does not have <code>-v</code> option.</p>\n\n<pre><code>$ yi -v\nyi: unrecognized option `-v'\n</code></pre>\n"}, {"tags": ["list", "haskell", "type-mismatch"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469402926, "post_id": 38557834, "comment_id": 64506750, "body": "I would recommend rewriting this without using <code>$</code> anywhere, only using parentheses, then adding <code>$</code> back in after you get it working if you really want to."}, {"owner": {"reputation": 76, "user_id": 6632733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b182cd45fb866a097c1a2122762de150?s=128&d=identicon&r=PG&f=1", "display_name": "DShade", "link": "https://stackoverflow.com/users/6632733/dshade"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469403077, "post_id": 38557834, "comment_id": 64506782, "body": "@AlexisKing Yeah i tried that already but i got the same error so i left them in."}], "answers": [{"comments": [{"owner": {"reputation": 76, "user_id": 6632733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b182cd45fb866a097c1a2122762de150?s=128&d=identicon&r=PG&f=1", "display_name": "DShade", "link": "https://stackoverflow.com/users/6632733/dshade"}, "edited": false, "score": 0, "creation_date": 1469406110, "post_id": 38558042, "comment_id": 64507278, "body": "That makes sense. Thanks a lot!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1469404867, "creation_date": 1469404867, "answer_id": 38558042, "question_id": 38557834, "link": "https://stackoverflow.com/questions/38557834/haskell-type-matching-error-when-passing-two-lists/38558042#38558042", "title": "Haskell Type matching error when passing two Lists", "body": "<p>The signatures of <code>bench</code> and <code>whnf</code> are:</p>\n\n<pre><code>bench :: String        -&gt; Benchmarkable -&gt; Benchmark\nwhnf  :: (a -&gt; b) -&gt; a -&gt; Benchmarkable\n</code></pre>\n\n<p>Since <code>app</code> takes two arguments, we need to curry the first one in the call to <code>whnf</code>:</p>\n\n<pre><code>whnf (app [0..49]) [50..100]  :: Benchmarkable\n</code></pre>\n\n<p>Note that <code>whnf</code> has two arguments: <code>(app [0..49])</code> and <code>[50..100]</code>.</p>\n\n<p>Now we can form the call to <code>bench</code>:</p>\n\n<pre><code>bench \"app\" ( whnf (app [0..49]) [50..100] )  :: Benchmark\n</code></pre>\n\n<p>If we want to use $, there is only one place where we can use it:</p>\n\n<pre><code>bench \"app\" $ whnf (app [0..49]) [50..100]\n</code></pre>\n\n<p>We can't place a $ after <code>whnf</code> because in general:</p>\n\n<pre><code>a b c   ==  (a b) c\n</code></pre>\n\n<p>and</p>\n\n<pre><code>a $ b c == a (b c)\n</code></pre>\n"}], "owner": {"reputation": 76, "user_id": 6632733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b182cd45fb866a097c1a2122762de150?s=128&d=identicon&r=PG&f=1", "display_name": "DShade", "link": "https://stackoverflow.com/users/6632733/dshade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 38558042, "answer_count": 1, "score": 1, "last_activity_date": 1469404867, "creation_date": 1469402560, "last_edit_date": 1469402736, "question_id": 38557834, "link": "https://stackoverflow.com/questions/38557834/haskell-type-matching-error-when-passing-two-lists", "title": "Haskell Type matching error when passing two Lists", "body": "<p>I'm getting started learning Haskell and have to create a really simple function that takes two Lists and concats them.  </p>\n\n<pre><code>app :: [a] -&gt; [a] -&gt; [a]  \napp xs ys = xs ++ ys  \n</code></pre>\n\n<p>This is part of a task where we have to benchmark smaller functions like these.<br>\nI do this with Criterion. The complete code is as following: </p>\n\n<pre><code>import Criterion.Main\nmain = defaultMain [\n  bgroup \"normal 100\" [ bench \"app\"     $ whnf app $ [0..49] [50..100]\n                      ]\n                  ]\napp :: [a] -&gt; [a] -&gt; [a]  \napp xs ys = xs ++ ys  \n</code></pre>\n\n<p>The compiling fails and leaves me with this:  </p>\n\n<pre><code>Couldn't match expected type `[Integer] -&gt; [a0]'\n           with actual type `[Integer]'\nThe function `[0 .. 49]' is applied to one argument,\nbut its type `[Integer]' has none\nIn the second argument of `($)', namely `[0 .. 49] [50 .. 100]'\nIn the second argument of `($)', namely\n  `whnf app $ [0 .. 49] [50 .. 100]'\n</code></pre>\n\n<p>I have a real problem in decrypting ghc error messages and am basically stuck here.  <br>\nI know there are a lot of questions regarding type-mismatches here but i couldn't find a solution.  <br>\nThanks in advance!</p>\n"}, {"tags": ["haskell", "types", "type-inference", "function-composition", "pointfree"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469458098, "post_id": 38557100, "comment_id": 64531187, "body": "Your question inspired me to check the definition of <code>&lt;$</code> for <code>Data.Map</code>. It will be considerably faster in the next release. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469397833, "post_id": 38557224, "comment_id": 64505574, "body": "Yes, I know this. But what I want to know is how the composition is equivalent to the lambda expression."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469398461, "post_id": 38557224, "comment_id": 64505734, "body": "So in effect, <code>const x</code> is a partially applied function which gets <code>fmap</code>ed to any functor that is passed to it in this case."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469398950, "post_id": 38557224, "comment_id": 64505851, "body": "You can always <code>fmap (const x)</code> onto a functor computation of any type because <code>const x</code> ignores its argument. A good example is <code>void</code>: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:void\" rel=\"nofollow noreferrer\">(link)</a>"}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469399091, "post_id": 38557224, "comment_id": 64505896, "body": "Would you agree that <code>fmap</code> is taking a partially applied function <code>const x</code>? I just want to confirm my thinking"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1469399379, "post_id": 38557224, "comment_id": 64505960, "body": "<code>const x</code> is a partially applied function, but that is not a requirement for use with fmap."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469478130, "post_id": 38557224, "comment_id": 64542702, "body": "@Mika&#39;il <code>const x</code> &lt;s&gt;is&lt;/s&gt; defines a function, resulting from <code>const</code> being applied to <code>x</code>. But there&#39;s no requirement for actual function to be created. I suspect you think in terms of concrete implementation (where actual function objects get partially applied to stuff creating other actual function objects in memory). Don&#39;t. <code>const x</code> can be compiled out completely <i>before</i> a program runs."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1469398364, "last_edit_date": 1469398364, "creation_date": 1469397404, "answer_id": 38557224, "question_id": 38557100, "link": "https://stackoverflow.com/questions/38557100/how-does-function-work-in-the-functor-class/38557224#38557224", "title": "How does `&lt;$` function work in the Functor class?", "body": "<p>Note that:</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>(see the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#.\">definition of <code>(.)</code></a>) so,</p>\n\n<pre><code>(fmap . const) x = fmap (const x)\n</code></pre>\n\n<p><strong>Original Answer</strong></p>\n\n<p>For concreteness, let's use the IO functor.</p>\n\n<p><code>fmap f</code> work on an IO-computation by applying <code>f</code> to the result of the computation.</p>\n\n<p>E.g. - <code>getContents</code> is an <code>IO String</code>, and <code>length</code> is a function on Strings, so we can fmap length on getContents:</p>\n\n<pre><code>getContents              :: IO String\nlength                   ::    String -&gt; Int\nfmap length getContents  ::              IO Int\n</code></pre>\n\n<p>When run this would read all of standard input, take the length of the input, and return it (as an IO-action).</p>\n\n<p>Now, <code>const z</code> is a function which ignores its argument and always returns <code>z</code>. So if I were to <code>fmap (const 'w')</code> on <code>getContents</code> I would have:</p>\n\n<pre><code>getContents                   :: IO String\nconst 'w'                     ::    String -&gt; Char\nfmap (const 'w') getContents  ::              IO Char\n</code></pre>\n\n<p>When executed, this would first read in all of standard input, then discard that input and return the character 'w'.</p>\n"}, {"comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1469442082, "post_id": 38559869, "comment_id": 64520365, "body": "This is the answer I was looking for. So my comment above that a partially applied function was being fmap&#39;ed to the functor is not correct. It was actually a function of (d -&gt; c) that was being applied."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1469455601, "last_edit_date": 1469455601, "creation_date": 1469421734, "answer_id": 38559869, "question_id": 38557100, "link": "https://stackoverflow.com/questions/38557100/how-does-function-work-in-the-functor-class/38559869#38559869", "title": "How does `&lt;$` function work in the Functor class?", "body": "<p>The other answer does a good job of addressing the question, \"How does <code>fmap . const</code> equate to the lambda expression above?\", so I want to address a different part:</p>\n\n<blockquote>\n  <p>My understanding of function composition is that output type of <code>const</code> should match the input type of <code>fmap</code>, but the input type of <code>fmap</code> is the function <code>(a -&gt; b)</code> not <code>a</code> which is what the <code>const</code> function outputs.</p>\n</blockquote>\n\n<p>In this answer, I will argue that the output type of <code>const</code> is indeed a function as needed by <code>fmap</code>.</p>\n\n<p>Let's rewrite the types of <code>fmap</code> and <code>const</code>, using separate type variables in each to avoid confusion:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; (f a -&gt; f b)\nconst :: c -&gt; (d -&gt; c)\n</code></pre>\n\n<p>Now, one must ask: what is the output type of <code>const</code>? In your question, you posit that the output type is <code>c</code> (after correcting for type variable renaming as above). But in fact this is a slight misunderstanding; the true output type is <code>d -&gt; c</code>!</p>\n\n<p>The output of <code>const</code> is actually a function. Now, as you say, its output must match the input of <code>fmap</code>. With our naming above, this means we must choose to satisfy the equation <code>d ~ a</code> (read: type <code>d</code> and type <code>a</code> are the same type) and satisfy <code>c ~ b</code>. Then we will have:</p>\n\n<pre><code>const        :: b -&gt; (a -&gt; b)\nfmap         ::      (a -&gt; b) -&gt; (f a -&gt; f b)\nfmap . const :: b             -&gt; (f a -&gt; f b)\n</code></pre>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 38559869, "answer_count": 2, "score": 1, "last_activity_date": 1469473273, "creation_date": 1469396474, "last_edit_date": 1469473273, "question_id": 38557100, "link": "https://stackoverflow.com/questions/38557100/how-does-function-work-in-the-functor-class", "title": "How does `&lt;$` function work in the Functor class?", "body": "<p>In the Functor class definition we have the <code>&lt;$</code> function defined as:</p>\n\n<pre><code>class  Functor f  where\n    fmap        :: (a -&gt; b) -&gt; f a -&gt; f b\n\n    (&lt;$)        :: a -&gt; f b -&gt; f a\n    (&lt;$)        =  fmap . const\n</code></pre>\n\n<p>The <code>const</code> function has the definition:</p>\n\n<pre><code>const                   :: a -&gt; b -&gt; a\nconst x _               =  x\n</code></pre>\n\n<p>I know that the <code>&lt;$</code> function is equivalent to:</p>\n\n<pre><code>\\x -&gt; fmap (const x)\n</code></pre>\n\n<p>How does <code>fmap . const</code> equate to the lambda expression above? My understanding of function composition is that output type of <code>const</code> should match the input type of <code>fmap</code>, but the input type of <code>fmap</code> is the function <code>(a -&gt; b)</code> not <code>a</code> which is what the <code>const</code> function outputs.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1469393874, "post_id": 38556531, "comment_id": 64504420, "body": "Barring bottom, the absurd function will never be called.  It is rarely needed, but there are uses for it."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1469419999, "post_id": 38556900, "comment_id": 64510034, "body": "We actually <i>do</i> that now; see my answer."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1469461220, "post_id": 38556900, "comment_id": 64533184, "body": "<code>data Void : Set where MkVoid : Void \u2192 Void</code> is a perfectly valid definition in Agda. So is <code>Inductive Void : Type := MkVoid : Void -&gt; Void.</code> in Coq. And you can define the corresponding <code>absurd</code> functions just fine."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1610742790, "post_id": 38556900, "comment_id": 116238087, "body": "<code>EmptyDataDecls</code> is part of Haskell 2010. <code>EmptyCase</code>, sadly, is not."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 22, "last_activity_date": 1469462446, "last_edit_date": 1469462446, "creation_date": 1469395105, "answer_id": 38556900, "question_id": 38556531, "link": "https://stackoverflow.com/questions/38556531/how-is-data-void-absurd-different-from-%e2%8a%a5/38556900#38556900", "title": "How is Data.Void.absurd different from \u22a5?", "body": "<p>For historical reasons, any Haskell data type (including <code>newtype</code>) must have at least one constructor.</p>\n\n<p>Hence, to define the <code>Void</code> in \"Haskell98\" one needs to rely on type-level recursion <code>newtype Void = Void Void</code>. There is no (non-bottom) value of this type.</p>\n\n<p>The <code>absurd</code> function has to rely on (value level) recursion to cope with the \"weird\" form of the <code>Void</code> type.</p>\n\n<p>In more modern Haskell, with some GHC extensions, we can define a zero constructor data type, which would lead to a saner definition.</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls, EmptyCase #-}\ndata Void\nabsurd :: Void -&gt; a\nabsurd x = case x of { }    -- empty case\n</code></pre>\n\n<p>The case is exhaustive -- it does handle all the constructors of <code>Void</code>, all zero of them. Hence it is total.</p>\n\n<p>In some other functional languages, like Agda or Coq, a variant of the case above is idiomatic when dealing with empty types like <code>Void</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 19, "last_activity_date": 1610742640, "last_edit_date": 1610742640, "creation_date": 1469415215, "answer_id": 38559050, "question_id": 38556531, "link": "https://stackoverflow.com/questions/38556531/how-is-data-void-absurd-different-from-%e2%8a%a5/38559050#38559050", "title": "How is Data.Void.absurd different from \u22a5?", "body": "<p><code>Data.Void</code> moved from the <code>void</code> package to <code>base</code> in base version <code>4.8</code> (GHC 7.10). If you look at the Cabal file for <code>void</code> you'll see that it only includes <code>Data.Void</code> for old <code>base</code> versions. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Void.html#Void\" rel=\"nofollow noreferrer\">Now, <code>Void</code> is defined as chi suggests</a>:</p>\n<pre><code>data Void\n\nabsurd :: Void -&gt; a\nabsurd a = case a of {}\n</code></pre>\n<p>which is perfectly valid.</p>\n<hr />\n<p>I think the idea behind the old definition is something like this:</p>\n<p>Consider the type</p>\n<pre><code>data BadVoid = BadVoid BadVoid\n</code></pre>\n<p>This type doesn't get the job done, because it's actually possible to define a non-bottom (coinductive) value with that type:</p>\n<pre><code>badVoid = BadVoid badVoid\n</code></pre>\n<p>We can fix that problem by using a strictness annotation, which forces the type to be inductive:</p>\n<pre><code>data Void = Void !Void\n</code></pre>\n<p>Under assumptions that may or may not actually hold, but at least morally hold, we can legitimately perform induction on any inductive type. So</p>\n<pre><code>spin (Void x) = spin x\n</code></pre>\n<p>will always terminate if, hypothetically, we have something of type <code>Void</code>.</p>\n<p>The final step is replacing the single-strict-constructor datatype with a newtype:</p>\n<pre><code>newtype Void = Void Void\n</code></pre>\n<p>This is legitimate too; it's impossible to construct a non-bottom value of this <code>Void</code> type. The advantage of doing it this way is that it sometimes lets GHC recognize a little code as dead. But it's not a big advantage, and it introduces some unfortunate complications. The definition of <code>spin</code>, has changed meaning because of the different pattern matching semantics between <code>data</code> and <code>newtype</code>. To preserve the meaning precisely, <code>spin</code> should probably have been written</p>\n<pre><code>spin !x = case x of Void x' -&gt; spin x'\n</code></pre>\n<p>(avoiding <code>spin !(Void x)</code> to skirt a now-fixed bug in the interaction between newtype constructors and bang patterns; but for GHC 7.10 (ha!) this form doesn't actually produce the desired error message because it's &quot;optimized&quot; into an infinite loop) at which point <code>absurd = spin</code>.</p>\n<p>Thankfully, it doesn't actually matter in the end, because the whole old definition is a bit of a silly exercise.</p>\n"}], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1604, "favorite_count": 3, "accepted_answer_id": 38559050, "answer_count": 2, "score": 22, "last_activity_date": 1610742640, "creation_date": 1469392510, "last_edit_date": 1495542855, "question_id": 38556531, "link": "https://stackoverflow.com/questions/38556531/how-is-data-void-absurd-different-from-%e2%8a%a5", "title": "How is Data.Void.absurd different from \u22a5?", "body": "<p>I saw <a href=\"https://stackoverflow.com/q/38553622/625403\">Inverse of the absurd function</a> earlier today, and while it's clear to me that any possible implementation of <code>drusba :: a -&gt; Void</code> will never terminate (after all, it's impossible to construct <code>Void</code>), I don't understand why the same isn't true of <code>absurd :: Void -&gt; a</code>. Consider the GHC implementation:</p>\n\n<pre><code>newtype Void = Void Void\n\nabsurd :: Void -&gt; a\nabsurd a = a `seq` spin a where\n   spin (Void b) = spin b\n</code></pre>\n\n<p><code>spin</code>, it seems to me, is endlessly unraveling the infinite series of <code>Void</code> newtype wrappers, and would never return even if you could find a <code>Void</code> to pass it. An implementation that would be indistinguishable would be something like:</p>\n\n<pre><code>absurd :: Void -&gt; a\nabsurd a = a `seq` undefined\n</code></pre>\n\n<p>Given that, why do we say that <code>absurd</code> is a proper function that deserves to live in Data.Void, but </p>\n\n<pre><code>drusba :: a -&gt; Void\ndrusba = undefined\n</code></pre>\n\n<p>is a function that cannot possibly be defined? Is it something like the following?</p>\n\n<blockquote>\n  <p><code>absurd</code> is a total function, giving a non-bottom result for any input in its (empty) domain, whereas <code>drusba</code> is partial, giving bottom results for some (indeed all) inputs in its domain.</p>\n</blockquote>\n"}, {"tags": ["haskell", "parallel-processing", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "edited": false, "score": 0, "creation_date": 1469447566, "post_id": 38557155, "comment_id": 64523722, "body": "Cheers, I&#39;ve got another follow up question. Consider we have 2 reasonably long durations of spark. Imagine the first spark accesses and computes <code>x</code> but doesn\u2019t not return. Meanwhile in a parallel but subsequent to that calculation, the second spark access <code>x</code>. Does that spark obtains the value of <code>x</code> from the calculation of first spark or does it calculate <code>x</code> itself?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "edited": false, "score": 0, "creation_date": 1469449696, "post_id": 38557155, "comment_id": 64525182, "body": "If a computation needs the value of <code>x</code> and <code>x</code> is currently a thunk, it will perform the work to compute <code>x</code>, update <code>x</code> with the computed value (so <code>x</code> is no longer a thunk) and continue on."}, {"owner": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "edited": false, "score": 0, "creation_date": 1469456534, "post_id": 38557155, "comment_id": 64530141, "body": "Yes, thanks for that, but my question is about the interaction of lazy evaluation and sparks. I am trying to understand if an evaluated thunk from one spark becomes available to another spark that was started before the thunk was evaluated. Say I have two sparks S1 and S2 presently running in parallel, and both of which were passed a thunk to x initially at time t0. At time t1, some time after S1 and S2 have started, S1 accesses x, thus evaluating the thunk. Let us presume the thunk evaluation completes at time t2. At time t3, (where t3 &gt; t2), spark S2 accesses x."}, {"owner": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "edited": false, "score": 0, "creation_date": 1469456545, "post_id": 38557155, "comment_id": 64530152, "body": "For clarity, let us presume that S1 terminates at t4 where t4 &gt; t3. My question is whether S2 obtains the value of x, or executes the thunk to obtain the value of x?  If it gains access to the value and does not evaluate the thunk, this suggests to me a classic threading model whereby values of shared variables are visible concurrently to all threads. If not, this suggests more of a fork style model, whereby each spark is given an initialised state that is isolated for the duration of its execution. Thanks."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "edited": false, "score": 0, "creation_date": 1469457075, "post_id": 38557155, "comment_id": 64530510, "body": "Once a thread (including sparks) converts a thunk to a value it is visible to all  other threads/sparks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1469396830, "creation_date": 1469396830, "answer_id": 38557155, "question_id": 38556431, "link": "https://stackoverflow.com/questions/38556431/haskell-lazy-evaluation-in-parallelism/38557155#38557155", "title": "Haskell lazy evaluation in parallelism", "body": "<p>Whenever you create a <em>spark</em> for a computation\n(which is what <code>parList</code> does) there is always a possibility\nthat the work for that computation will be performed twice.\nIn practice this happens rarely. Basically there is a race condition\nbetween the threads processing the sparks and the main thread.</p>\n\n<p>Haskell implements laziness by initially setting the value of a variable\nto a <em>thunk</em> - essentially a pointer to code to compute the value.\nWhen the value of the variable is demanded, Haskell runs the code pointed\nto by the thunk and replaces the thunk with the returned value.\nIf the variable is used later, Haskell just uses the stored value.</p>\n\n<p>When you evaluate a variable in parallel a <em>spark</em> is created pointing to\nthe variable. When the spark is processed by a background thread it\njust demands the value that the spark points to. If the spark points\nto a thunk, the thunk is run and updated with the returned value.\nIf the spark points to an already evaluated value, nothing happens\nand we say that the spark <em>fizzles</em>.</p>\n\n<p>Thus, if you evaluate a list like <code>[x,x,x,x,x,x]</code> in parallel, one spark\nwill be created for each element of the list, and it is possible that\ntwo or more of those sparks will execute at the same time. It is also\npossible that the main thread will be evaluating <code>x</code> at the same time.\nIn that case the work to compute <code>x</code> will be duplicated.\nHowever, once the thunk for <code>x</code> has been updated, no spark or main thread\nevaluations of <code>x</code> starting after that will recompute <code>x</code>.</p>\n"}], "owner": {"reputation": 253, "user_id": 5048846, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZkekGsp9Vs/AAAAAAAAAAI/AAAAAAAACBk/Aw6mTRYjYKI/photo.jpg?sz=128", "display_name": "Stephen O&#39;Kennedy", "link": "https://stackoverflow.com/users/5048846/stephen-okennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 0, "accepted_answer_id": 38557155, "answer_count": 1, "score": 3, "last_activity_date": 1469396830, "creation_date": 1469391873, "question_id": 38556431, "link": "https://stackoverflow.com/questions/38556431/haskell-lazy-evaluation-in-parallelism", "title": "Haskell lazy evaluation in parallelism", "body": "<p>If value <code>x</code> is in a list where <code>x</code> is some function\nand <code>parList</code> is called on that list (e.g <code>[l,x,l,x]</code>)\ndoes <code>x</code> get calculated once or twice?</p>\n\n<p>From my understanding of Haskell's lazy evaluation, once <code>x</code> has been evaluated it doesn't need to be evaluated again as it would return the same value. But would this apply in a multi-threaded environment?</p>\n"}, {"tags": ["haskell", "bytestring"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1469375775, "creation_date": 1469375775, "answer_id": 38553938, "question_id": 38553667, "link": "https://stackoverflow.com/questions/38553667/folding-over-word8-and-bytestring-with-same-function/38553938#38553938", "title": "Folding over [Word8] and ByteString with same function?", "body": "<p>Have a look at the <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.0.1/docs/Data-MonoTraversable.html#t:MonoFoldable\">MonoFoldable class</a> defined in <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.0.1\">mono-traversable</a> package.</p>\n\n<p>It has instances for both <code>ByteString</code> and <code>[a]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1469380084, "post_id": 38554517, "comment_id": 64500089, "body": "Ach, you beat me to it :)"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 7, "last_activity_date": 1469380591, "last_edit_date": 1469380591, "creation_date": 1469379626, "answer_id": 38554517, "question_id": 38553667, "link": "https://stackoverflow.com/questions/38553667/folding-over-word8-and-bytestring-with-same-function/38554517#38554517", "title": "Folding over [Word8] and ByteString with same function?", "body": "<p>ErikR's answer is great. I just want to insert a sidenote. If you have <code>lens</code> you have the <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Data-ByteString-Lens.html\">bytes</a> traversal:</p>\n\n<pre><code>\u03bb&gt; import Data.ByteString.Lens\n\u03bb&gt; import Control.Lens\n\u03bb&gt; :t foldrOf bytes\nfoldrOf bytes\n  :: IsByteString s =&gt; (GHC.Word.Word8 -&gt; r -&gt; r) -&gt; r -&gt; s -&gt; r\n</code></pre>\n\n<p>In a sense the question you are asking is the <a href=\"https://github.com/ekmett/lens/wiki/Derivation\">motivation</a> for the <code>lens</code> package: can we extend the functions in <code>Data.Foldable</code> and <code>Data.Traversable</code> to consume not only regular instances of <code>Foldable</code> and <code>Traversable</code> but also objects that <em>behave</em> and <em>compose</em> like foldables and traversables?</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 38553938, "answer_count": 2, "score": 4, "last_activity_date": 1469408029, "creation_date": 1469374025, "question_id": 38553667, "link": "https://stackoverflow.com/questions/38553667/folding-over-word8-and-bytestring-with-same-function", "title": "Folding over [Word8] and ByteString with same function?", "body": "<p>It turns out that there is no instance of <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> available for <a href=\"https://hackage.haskell.org/package/bytestring\" rel=\"nofollow\"><code>ByteString</code></a>. I'd like to write a function that uses <code>foldl'</code> on either <code>[Word8]</code> or <code>ByteString</code> but I can't. Since a <code>ByteString</code> is, data-wise, the same as <code>[Word8]</code>, it seems that I should be able to.</p>\n\n<p>Is there a package available that integrates the two or must I roll my own with a type class?</p>\n"}, {"tags": ["haskell", "category-theory"], "answers": [{"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1508591509, "post_id": 38553623, "comment_id": 80674574, "body": "Here&#39;s a good post <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">on the &#39;algebra&#39; in &#39;algebraic data type&#39;</a>"}, {"owner": {"reputation": 4004, "user_id": 1498178, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2a7f53f1d991f2ab18a4957a1f192960?s=128&d=identicon&r=PG", "display_name": "toraritte", "link": "https://stackoverflow.com/users/1498178/toraritte"}, "edited": false, "score": 1, "creation_date": 1568226393, "post_id": 38553623, "comment_id": 102211006, "body": "The link in Zoey Hewll&#39;s comment is dead but found a mirror: <a href=\"https://gist.github.com/gregberns/5e9da0c95a9a8d2b6338afe69310b945\" rel=\"nofollow noreferrer\">gist.github.com/gregberns/5e9da0c95a9a8d2b6338afe69310b945</a>"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 13, "last_activity_date": 1469415168, "last_edit_date": 1469415168, "creation_date": 1469373770, "answer_id": 38553623, "question_id": 38553622, "link": "https://stackoverflow.com/questions/38553622/inverse-of-the-absurd-function/38553623#38553623", "title": "Inverse of the absurd function", "body": "<p><strong>This function does not exist.</strong> (assuming strict semantics)</p>\n\n<p>Looking at the algebra of types, the function type is equivalent to exponentiation. </p>\n\n<p>Now the function <code>absurd</code>, which has the type <code>Void -&gt; a</code> corresponds to the operation <code>a ^ 0</code> which equals <code>1</code>. This means that there is exactly one implementation of <code>absurd</code>, which can be found in <code>Data.Void</code>.</p>\n\n<p>Reversing the arrow, you get the type <code>a -&gt; Void</code>, which corresponds to <code>0 ^ a</code> or <code>0</code>, which means the desired function does not exist.</p>\n\n<hr>\n\n<p>You could also prove this using the Curry-Howard isomorphism. Since the function type corresponds to the boolean function 'implies', you get the following term:</p>\n\n<pre><code>True -&gt; False\n</code></pre>\n\n<p>which is false, and therefore no function <code>a -&gt; Void</code> can exist.</p>\n\n<p><em>Corrections due to imprecise language are encouraged since I just started learning category theory.</em></p>\n"}, {"tags": [], "owner": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "is_accepted": false, "score": 7, "last_activity_date": 1469380238, "last_edit_date": 1469380238, "creation_date": 1469377069, "answer_id": 38554134, "question_id": 38553622, "link": "https://stackoverflow.com/questions/38553622/inverse-of-the-absurd-function/38554134#38554134", "title": "Inverse of the absurd function", "body": "<p>It depends what you mean. <code>absurd</code> witnesses one side of the isomorphism <code>Void = forall a.a</code> and from that view, has an inverse</p>\n\n<pre><code>void :: (forall a.a) -&gt; Void\nvoid x = x\n</code></pre>\n\n<p>that is really an isomorphism.</p>\n\n<p>There is no total function of the type</p>\n\n<pre><code> forall a.a -&gt; Void\n</code></pre>\n\n<p>nor any inverse to <code>absurd</code> with that type among partial functions.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469386882, "post_id": 38554657, "comment_id": 64502370, "body": "@dfeuer: <i>exiting</i> or <i>exciting</i>, when you&#39;re dying it&#39;s all the same isn&#39;t it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469386982, "post_id": 38554657, "comment_id": 64502402, "body": "Heh. I suppose so."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1469386704, "last_edit_date": 1495535450, "creation_date": 1469380513, "answer_id": 38554657, "question_id": 38553622, "link": "https://stackoverflow.com/questions/38553622/inverse-of-the-absurd-function/38554657#38554657", "title": "Inverse of the absurd function", "body": "<p>Quite intuitively, that function cannot possibly exist<sup>\u2020</sup>. Say we had such a function:</p>\n\n<pre><code>drusba :: a -&gt; Void\n</code></pre>\n\n<p>then you could do</p>\n\n<pre><code>GHCi&gt; drusba (5 :: Int)\n</code></pre>\n\n<p>...thereby creating a value of type <code>Void</code>. <a href=\"https://stackoverflow.com/a/33115522/745903\">Well, that's exciting... also, congratulations, you're dead!</a></p>\n\n<p><strong>Hask</strong> (the category of Haskell types, with Haskell functions as morphisms) is a <a href=\"https://en.wikipedia.org/wiki/Cartesian_closed_category\" rel=\"nofollow noreferrer\">bicartesian closed category</a> with <a href=\"https://en.wikipedia.org/wiki/Initial_and_terminal_objects\" rel=\"nofollow noreferrer\">initial object</a> <code>Void</code>. The definition of an initial object is that, for any type <code>A</code>, there exists exactly one function <code>Void -&gt; A</code> \u2013 these functions are the instantiations of <code>absurd :: Void -&gt; a</code>. Dually, there exists exactly one function <code>B -&gt; ()</code>, since <code>()</code> is the terminal object \u2013 any such function is equivalent to <code>const ()</code>.</p>\n\n<p>Now, assuming <code>drusba :: () -&gt; Void</code>, we would have</p>\n\n<pre><code>drusba . absurd :: Void -&gt; Void\ndrusba . absurd \u2261 id\n</code></pre>\n\n<p>because there can only be one function <code>Void -&gt; Void</code>, and we know <code>id</code> is one; and</p>\n\n<pre><code>absurd . drusba :: () -&gt; ()\nabsurd . drusba \u2261 id\n</code></pre>\n\n<p>for the same reason. IOW, <code>drusba</code> and <code>absurd</code> are indeed proper inverses to each other, which means <code>()</code> and <code>Void</code> are isomorphic.</p>\n\n<p>But from this it would follow that <em>any</em> type <code>A</code> is actually isomorphic to both <code>()</code> and <code>Void</code>, because there would exist precisely one function <code>() -&gt; A</code> and <code>A -&gt; ()</code>.</p>\n\n<p>So basically, if there existed a function <code>drusba :: a -&gt; Void</code>, it would mean that Haskell had only one type, which would contain no values. That wouldn't be a particularly useful programming language, would it?</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Of course, all of this only holds if you disregard &perp;.</sub></p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 1, "accepted_answer_id": 38553623, "answer_count": 3, "score": 6, "last_activity_date": 1469415168, "creation_date": 1469373763, "question_id": 38553622, "link": "https://stackoverflow.com/questions/38553622/inverse-of-the-absurd-function", "title": "Inverse of the absurd function", "body": "<p>Is there an inverse to the <code>absurd</code> function from <code>Data.Void</code>?</p>\n\n<p>If it exists, how is it implemented and what is it used for?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469374195, "post_id": 38553552, "comment_id": 64498162, "body": "In the stack.yaml file, try add/setting <code>system-ghc: false</code> and re-runnin stack setup. You want stack to download and install its own ghc (which it will place in ~/.stack) and not use the system supplied version at /usr/bin/ghc."}, {"owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469375288, "post_id": 38553552, "comment_id": 64498531, "body": "Thanks. Please post this as answer so I can mark the question as resolved."}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 4278306, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wRZQS.jpg?s=128&g=1", "display_name": "Be Wake Pandey", "link": "https://stackoverflow.com/users/4278306/be-wake-pandey"}, "edited": false, "score": 0, "creation_date": 1500829952, "post_id": 38553882, "comment_id": 77498349, "body": "thanks man!! finally after 2 days I got the solution.. cheers!!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1469375416, "creation_date": 1469375416, "answer_id": 38553882, "question_id": 38553552, "link": "https://stackoverflow.com/questions/38553552/stack-setup-on-opensuse-tumbleweed/38553882#38553882", "title": "stack setup on openSUSE Tumbleweed", "body": "<p>To force stack to download and use its own version of ghc (and other build tools), add:</p>\n\n<pre><code>system-ghc: false\n</code></pre>\n\n<p>to your stack.yaml file.</p>\n"}], "owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 38553882, "answer_count": 1, "score": 2, "last_activity_date": 1483520125, "creation_date": 1469373276, "last_edit_date": 1483520125, "question_id": 38553552, "link": "https://stackoverflow.com/questions/38553552/stack-setup-on-opensuse-tumbleweed", "title": "stack setup on openSUSE Tumbleweed", "body": "<p>OS: openSUSE Tumbleweed up-to-date</p>\n\n<p>As the stack documentation says, I can install stack using zypper from the default repository on Tumbleweed. The path to the bin is <code>/usr/bin/stack</code>.</p>\n\n<p>I followed the stack tutorial on the official homepage and executed <code>stack new helloworld new-template</code> (which works). After <code>cd</code> into the folder, I tried to run <code>stack setup</code>, but this one fails with:</p>\n\n<pre><code>The GHC located at /usr/bin/ghc failed to compile a sanity check. Please see:\n\n    http://docs.haskellstack.org/en/stable/install_and_upgrade/\n\nfor more information. Exception was:\nRunning /usr/bin/ghc /tmp/stack-sanity-check9034/Main.hs \n-no-user-package-db in directory /tmp/stack-sanity-check9034/\nexited with ExitFailure 1\n\n\n\n/tmp/stack-sanity-check9034/Main.hs:1:8:\n    Could not find module \u2018Distribution.Simple\u2019\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>After some googling I still don't know what to do to resolve the error. It's like I'm missing a very basic thing.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1469366726, "creation_date": 1469366726, "answer_id": 38552514, "question_id": 38552446, "link": "https://stackoverflow.com/questions/38552446/how-to-use-integral-fractional-functions-with-num/38552514#38552514", "title": "How to use Integral/Fractional functions with Num", "body": "<p><code>Floating</code> would be the most general type which supports both <code>sqrt</code> and division.</p>\n\n<p>You can have ghci tell you this by defining a function which uses both and having ghci tell you what its type is:</p>\n\n<pre><code>ghci&gt; let f x y = sqrt x / y\nghci&gt; :t f\nf :: Floating a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Also, note that <code>div</code> is not exactly the same as <code>/</code> since the former rounds the result to always return an integer.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2913495"}, "edited": false, "score": 0, "creation_date": 1469399299, "post_id": 38555862, "comment_id": 64505939, "body": "Generally speaking, I completely agree, but is that still true, in a smallish sized project, that nothing else will be using? and in that case, to have the choice done by choosing to use either An Integral type, or a Fractional type? (what the type denotes in the program, is the type if values of the vector space. so using only Integral numbers makes sense, but eventually I might add non-orthotope shapes, and then might want Fractional, and without changing the basic code) thanks"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1469410278, "post_id": 38555862, "comment_id": 64508120, "body": "@ypw I don&#39;t see why any part of what I said should be specific to large programs."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1469459336, "post_id": 38555862, "comment_id": 64531989, "body": "@ypw Every time I think I have written a small enough program that there can be no bugs, I pay for my hubris."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1469388155, "creation_date": 1469388155, "answer_id": 38555862, "question_id": 38552446, "link": "https://stackoverflow.com/questions/38552446/how-to-use-integral-fractional-functions-with-num/38555862#38555862", "title": "How to use Integral/Fractional functions with Num", "body": "<p>Having a single operation which does \"nearly exact\" division on types that support it and rounding-down-division on types that can only represent whole numbers is a common source of bugs in other languages. I would propose that you keep the distinction that Haskell has, by offering <em>different</em> operations on those two classes of types, and force the user to consciously choose between rounding division and more standard division.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2913495"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 38555862, "answer_count": 2, "score": 0, "last_activity_date": 1469388155, "creation_date": 1469366186, "last_edit_date": 1469368209, "question_id": 38552446, "link": "https://stackoverflow.com/questions/38552446/how-to-use-integral-fractional-functions-with-num", "title": "How to use Integral/Fractional functions with Num", "body": "<p>(I am rather new to Haskell, and to functional programming in general so may be doing things completely wrong)</p>\n\n<p>I am building a puzzle in Haskell, and have been told that forcing the least as possible is the best (type-wise). So instead of making things of an <em>Integral</em> type, or a <em>Fractional</em> type, I am using a parametrized type:</p>\n\n<pre><code>data Orthotope a = Orthotope ...\n</code></pre>\n\n<p>and in almost all functions I use the class constraint </p>\n\n<pre><code>(Num a)=&gt; ...\n(Num a,Ord a)=&gt; ...\n</code></pre>\n\n<p>however, In some specific functions I need division (and once sqrt).\nI am aware I can use <strong>(/)</strong> for Fractional, and <strong>div</strong> for Integral, (fromIntegral where needed) and even that I can use <em>Data.Typeable</em> to check which it is, but have been told that that is almost always the completely wrong approach. </p>\n\n<p>Is there a better way to division and sqrt, on a type which isn't completely known? Or is this a case where I should use tests on the type itself?</p>\n\n<p>(I am trying to find a way to be able to do something to Also Fractional's and also Integral', and if it works on more types, even better. (as opposed to using a less general type))</p>\n\n<p>thanks.</p>\n"}, {"tags": ["postgresql", "haskell", "postgresql-simple"], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1469368642, "post_id": 38552586, "comment_id": 64496337, "body": "Same error. I&#39;ve gone with converting to a query for now. Thank you."}], "tags": [], "owner": {"reputation": 85043, "user_id": 1995738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fXrVi.png?s=128&g=1", "display_name": "klin", "link": "https://stackoverflow.com/users/1995738/klin"}, "is_accepted": false, "score": 1, "last_activity_date": 1469367222, "creation_date": 1469367222, "answer_id": 38552586, "question_id": 38552441, "link": "https://stackoverflow.com/questions/38552441/postgresql-simple-execute-on-a-function-fails-with-execute-resulted-in-col-1/38552586#38552586", "title": "PostgreSQL-simple `execute` on a function fails with &quot;execute resulted in Col 1-column result&quot;", "body": "<p>This tricky query returns no rows, still the function is executed:</p>\n\n<pre><code>select 1 where record('', '') isnull;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1469368756, "last_edit_date": 1469368756, "creation_date": 1469367564, "answer_id": 38552639, "question_id": 38552441, "link": "https://stackoverflow.com/questions/38552441/postgresql-simple-execute-on-a-function-fails-with-execute-resulted-in-col-1/38552639#38552639", "title": "PostgreSQL-simple `execute` on a function fails with &quot;execute resulted in Col 1-column result&quot;", "body": "<p>I would try using <code>query</code> instead of <code>execute</code>:</p>\n\n<pre><code>query conn \"select 1 from record(?,?)\" [id1, id2]\n</code></pre>\n\n<p><code>execute</code> is for statements like <code>INSERT</code>, <code>UPDATE</code>, etc. Even though your statement does not return any rows, it is still a <code>SELECT</code> so I think you need to use <code>query</code> to run it.</p>\n"}, {"tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 1, "last_activity_date": 1526628760, "last_edit_date": 1526628760, "creation_date": 1526575573, "answer_id": 50396648, "question_id": 38552441, "link": "https://stackoverflow.com/questions/38552441/postgresql-simple-execute-on-a-function-fails-with-execute-resulted-in-col-1/50396648#50396648", "title": "PostgreSQL-simple `execute` on a function fails with &quot;execute resulted in Col 1-column result&quot;", "body": "<p>I got this error and found this question but wasn't able to switch to <code>query</code> because I'm using a library that uses <code>execute</code> for database migrations. (I needed an empty/no-op migration.)</p>\n\n<p>Here's what I ended up using which worked: </p>\n\n<pre><code>UPDATE arbitrary_but_real_table_name\n  SET arbitrary_text_column = 'this will not happen' \n  WHERE 'this is not null' IS NULL;\n</code></pre>\n\n<p>Hope this helps someone!</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 38552639, "answer_count": 3, "score": 0, "last_activity_date": 1526628760, "creation_date": 1469366162, "last_edit_date": 1505899859, "question_id": 38552441, "link": "https://stackoverflow.com/questions/38552441/postgresql-simple-execute-on-a-function-fails-with-execute-resulted-in-col-1", "title": "PostgreSQL-simple `execute` on a function fails with &quot;execute resulted in Col 1-column result&quot;", "body": "<p>I want to execute a Postgres function from Haskell which updates 3 rows but is declared with <code>RETURNS VOID</code>. I run the function as follows:</p>\n\n<pre><code>catch (do execute conn \"select record(?,?)\" [id1, id2])\n      (\\(e :: SomeException) -&gt; do putStrLn (\"Exception:\" ++ (show e)); return False)\n</code></pre>\n\n<p>but this results in:</p>\n\n<pre><code>QueryError {qeMessage = \"execute resulted in Col 1-column result\", qeQuery = \"select record(?,?)\"}\n</code></pre>\n\n<p>The query doesn't return results:</p>\n\n<pre><code>ebdb=&gt; select record('','');\n record\n--------------------\n\n(1 row)\n</code></pre>\n\n<p>How can I execute this Postgresql function from Haskell?</p>\n"}, {"tags": ["haskell", "functional-programming", "continuations"], "answers": [{"comments": [{"owner": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469370036, "post_id": 38552468, "comment_id": 64496787, "body": "thanks! in that example : <a href=\"https://en.wikibooks.org/wiki/Haskell/Continuation_passing_style#Deciding_when_to_use_k\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/&hellip;</a> does it mean that calling k will return to the previous contiunation (the current one) and that &quot;return (show $ y - 4)&quot; will display y-4 and end the program?"}, {"owner": {"reputation": 14780, "user_id": 210905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9e2d3ebb7e06cd11a5ca3fdaf12cce9?s=128&d=identicon&r=PG", "display_name": "Odomontois", "link": "https://stackoverflow.com/users/210905/odomontois"}, "reply_to_user": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469374802, "post_id": 38552468, "comment_id": 64498369, "body": "@lezebulon Calling <code>k</code> in <code>callC</code>ed <code>do</code> block will completely ignore all actions after this call. So <code>return (show $ y - 4)</code> will be done only if <code>y &gt; 20</code>  condition is <code>False</code>"}, {"owner": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469376725, "post_id": 38552468, "comment_id": 64498995, "body": "yes but what would return do when called? is it the same as k ?"}], "tags": [], "owner": {"reputation": 14780, "user_id": 210905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9e2d3ebb7e06cd11a5ca3fdaf12cce9?s=128&d=identicon&r=PG", "display_name": "Odomontois", "link": "https://stackoverflow.com/users/210905/odomontois"}, "is_accepted": false, "score": 1, "last_activity_date": 1469366330, "creation_date": 1469366330, "answer_id": 38552468, "question_id": 38552023, "link": "https://stackoverflow.com/questions/38552023/does-call-with-current-continuation-ignore-its-own-continuation/38552468#38552468", "title": "does call with current continuation ignore its own continuation?", "body": "<p><a href=\"https://wiki.haskell.org/All_About_Monads#The_Continuation_monad\" rel=\"nofollow\">Here</a> you can find more readable definition of <code>callCC</code> with very specific explanation:</p>\n\n<pre><code>class (Monad m) =&gt; MonadCont m where \n    callCC :: ((a -&gt; m b) -&gt; m a) -&gt; m a \n</code></pre>\n\n<blockquote>\n  <p>The MonadCont class provides the callCC function, which provides an\n  escape continuation mechanism for use with Continuation monads. Escape\n  continuations allow you to abort the current computation and return a\n  value immediately. They achieve a similar effect to throwError and\n  catchError within an Error monad.</p>\n</blockquote>\n\n<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Continuation_passing_style#callCC\" rel=\"nofollow\">Here</a> you can see some pretty examples how to use it.</p>\n\n<p>But in general: <code>callCC</code> does not ignore input, but it enhances your procedure with way to do it.</p>\n\n<p>You are defining some function like</p>\n\n<pre><code>doSomething panicExit = do\n  ...\n  when failCondition $ panicExit inputToStartOver\n  ...\n</code></pre>\n\n<p>And then converting to normal continuation via <code>callCC doSomething</code></p>\n\n<p>And exactly this <code>panicExit</code> input-ignoring throw-like has caught your eye. You procedure is not obliged to fail to default value, but you can do it when you like.</p>\n"}, {"comments": [{"owner": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469479076, "post_id": 38569712, "comment_id": 64543223, "body": "wouldn&#39;t that be (if some_complex_condition then (k 3) else <i>return</i> 4) ?"}, {"owner": {"reputation": 801, "user_id": 6428094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c7d4a1af484f21012d000d133cf659?s=128&d=identicon&r=PG&f=1", "display_name": "FPstudent", "link": "https://stackoverflow.com/users/6428094/fpstudent"}, "reply_to_user": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469483874, "post_id": 38569712, "comment_id": 64545183, "body": "That&#39;s where I used &quot;more concise syntax rather than real Haskell&quot;.  The &quot;real Haskell&quot; code for <code>1 + callcc (\\k -&gt; 2 + (if some_complex_condition then (k 3) else 4))</code> would be <code>do a &lt;- callCC $ \\k -&gt; (do b &lt;- if some_complex_condition then k 3 else return 4; return $ 2 + b); return $ 1 + a</code>.  The continuation monad in Haskell requires different syntax (and typing) for expressions that may invoke a continuation..."}, {"owner": {"reputation": 801, "user_id": 6428094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c7d4a1af484f21012d000d133cf659?s=128&d=identicon&r=PG&f=1", "display_name": "FPstudent", "link": "https://stackoverflow.com/users/6428094/fpstudent"}, "reply_to_user": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "edited": false, "score": 0, "creation_date": 1469509273, "post_id": 38569712, "comment_id": 64551536, "body": "I added a postscript using continuation monad in Haskell."}], "tags": [], "owner": {"reputation": 801, "user_id": 6428094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c7d4a1af484f21012d000d133cf659?s=128&d=identicon&r=PG&f=1", "display_name": "FPstudent", "link": "https://stackoverflow.com/users/6428094/fpstudent"}, "is_accepted": false, "score": 1, "last_activity_date": 1469509451, "last_edit_date": 1469509451, "creation_date": 1469455000, "answer_id": 38569712, "question_id": 38552023, "link": "https://stackoverflow.com/questions/38552023/does-call-with-current-continuation-ignore-its-own-continuation/38569712#38569712", "title": "does call with current continuation ignore its own continuation?", "body": "<p>(For the sake of exposition, let me use more concise syntax rather than real Haskell.)</p>\n\n<p><code>callcc f</code> applies the given function <code>f</code> to the current continuation <code>k</code>.  <em>If this continuation <code>k</code> is ever invoked under another continuation <code>x</code>, the latter continuation <code>x</code> is indeed discarded</em>.</p>\n\n<p>For instance, in <code>1 + callcc (\\k -&gt; 2 + (k 3))</code>, the variable <code>k</code> is bound to the outer continuation <code>1 + []</code> where <code>[]</code> is a <em>hole</em> into which a return value shall be filled.  When this <code>k</code> is applied as in <code>(k 3)</code>, <em>the inner continuation <code>1 + (2 + [])</code> is discarded</em>.  As a result, the entire expression becomes <code>1 + 3</code> and evaluates to <code>4</code>.</p>\n\n<p>On the other hand, in <code>1 + callcc (\\k -&gt; 2 + 4)</code>, the continuation <code>k</code> is never invoked and the whole expression yields <code>1 + (2 + 4)</code>, that is, <code>7</code>.</p>\n\n<p>By combining the two examples above, you can do more complicated things like <code>1 + callcc (\\k -&gt; 2 + (if some_complex_condition then (k 3) else 4))</code>, which gives <code>1 + 3</code> if <code>some_complex_condition</code> is <code>true</code>, or <code>1 + (2 + 4)</code> otherwise.</p>\n\n<p>To sum up and answer your question:</p>\n\n<blockquote>\n  <p>However, we can see that the x parameter is here never used.</p>\n</blockquote>\n\n<p><code>x</code> is discarded <em>if the continuation <code>k</code> is invoked</em>; however, when <code>k</code> is <em>not</em> invoked, <code>x</code> is applied to the \"normal\" return value, as in the examples above.  (The latter case corresponds to the <code>return</code> operation in the continuation monad.)</p>\n\n<p>P.S.</p>\n\n<p>Above I adopted a direct, non-monadic syntax for brevity.  Using the continuation monad in Haskell, the following example</p>\n\n<pre><code>callCC (\\k -&gt; do r &lt;- (k 3); return (2 + r))\n</code></pre>\n\n<p>invokes the outer continuation <code>k</code> <em>discarding the inner <code>2 + []</code></em> and returns <code>3</code>, while</p>\n\n<pre><code>callCC (\\k -&gt; do r &lt;- (return 4); return (2 + r))\n</code></pre>\n\n<p>gives <code>2 + 4</code>.</p>\n"}], "owner": {"reputation": 6675, "user_id": 875295, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/1rKE0.jpg?s=128&g=1", "display_name": "lezebulon", "link": "https://stackoverflow.com/users/875295/lezebulon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1469509451, "creation_date": 1469363300, "last_edit_date": 1469365064, "question_id": 38552023, "link": "https://stackoverflow.com/questions/38552023/does-call-with-current-continuation-ignore-its-own-continuation", "title": "does call with current continuation ignore its own continuation?", "body": "<p>I'm trying to understand continuation passing and Call-with-current-continuation.\nAs per this page:\n<a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#Continuation_monad\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Monad_(functional_programming)#Continuation_monad</a>\nthe call with CC method is implemented as follows:</p>\n\n<pre><code>call_cc :: ((a -&gt; (b -&gt; r) -&gt; r) -&gt; (a -&gt; r) -&gt; r) -&gt; (a -&gt; r) -&gt; r\ncall_cc f k = f (\\t x -&gt; k t) k\n</code></pre>\n\n<p>As described by this <a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/1f91b06cd2e724f17fe38269afbbb786a24e6d12\" rel=\"nofollow\">signature</a> and <a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/51e12a6846142aa27cb1277b8a7e4412f2590322\" rel=\"nofollow\">implementation</a>.</p>\n\n<p>However, we can see that the <code>x</code> parameter is here never used.\nDoes it mean that any continuation passed to <code>f</code> is always ignored that the initial continuation <code>k</code> is always replacing it?\nIn that case, does it mean that <code>call-with-cc</code> can only ever call a function with that is one-level deep and not more? (because the next function that would be called in a normal control flow with a continuation <code>x</code> is ignored)</p>\n\n<p>In that case it seems very limiting, what is its practical use?</p>\n"}, {"tags": ["haskell", "lambda", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469362965, "post_id": 38551902, "comment_id": 64494563, "body": "So, the zs from the filterfold function&#39;s argument is in scope but instead of using the &#39;z&#39; from filterfold it tries to perform pattern matching locally inside the lambda?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 1, "creation_date": 1469363178, "post_id": 38551902, "comment_id": 64494625, "body": "yes the <code>z</code> and <code>zs</code> inside the lambda will be different ones (<code>foldr</code> will <i>provide</i> them)  - that&#39;s why you should not reuse parameter/argument names for lambda-arguments - you <i>introduce</i> those names with your lambda and will hide the once from the outer-scope - so if you want to (re)use the <code>z</code> and <code>zs</code> from the outer-scope in <code>filterfold</code> you should just rename it into <code>foldr (\\y ys -&gt; ...)</code> (or whatever name you like different from <code>p</code>, <code>z</code>, <code>zs</code> and <code>y</code> ;) )"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469363340, "post_id": 38551902, "comment_id": 64494683, "body": "but please note: if you don&#39;t actually need the second argument of function (the lambda) you are giving to <code>foldr</code> then you probably don&#39;t need the <code>foldr</code> in the first place as you are only acting on the <code>head</code> of the list if it&#39;s not-empty or defaulting to the second argument of <code>foldr</code>"}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469364790, "post_id": 38551902, "comment_id": 64495124, "body": "Understand that filterfold&#39; is a cleaner version than filterfold. This is just for a conceptual understanding. So, in filterfold&#39; I could define for foldr the lambda function as (\\y qs -&gt; if (p y) then y:qs else qs) with different argument names. I understand that the y argument in the lambda will be the current element in the list &#39;zs&#39;. But what is qs? Why is it same as the zs list?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469369134, "post_id": 38551902, "comment_id": 64496494, "body": "you can think of the <code>qs</code> as the accumulator or state you pass around - so you start at the right end of your input list and replace the <code>[]</code> there with the second parameter to <code>foldr</code> (here &#39;[]` too)  - then you take the last element <code>y</code> and <code>qs=[]</code> and compine those with your lambda into a new <code>qs</code> ... repeat that to your first element in the list"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469369162, "post_id": 38551902, "comment_id": 64496509, "body": "just look for tuturials/articles on list-fold - you fill find plenty"}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1469414604, "post_id": 38551902, "comment_id": 64508977, "body": "Thanks, Carsten! I also figured out how the lambda function  for foldr works (and what the arguments refer to) and posted it: <a href=\"http://stackoverflow.com/questions/5726445/how-would-you-define-map-and-filter-using-foldr-in-haskell/38554918#38554918\" title=\"how would you define map and filter using foldr in haskell\">stackoverflow.com/questions/5726445/&hellip;</a>"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 8, "last_activity_date": 1532792755, "last_edit_date": 1532792755, "creation_date": 1469362494, "answer_id": 38551902, "question_id": 38551844, "link": "https://stackoverflow.com/questions/38551844/pattern-matching-inside-lambda/38551902#38551902", "title": "Pattern matching inside lambda", "body": "<p>you can use it but as the compiler tells you you are missing a case (when the input is <code>[]</code>)</p>\n\n<p>See if you say <code>z:zs</code> it will try to match this pattern with the input-list - if you</p>\n\n<ul>\n<li>input <code>[1,2,3] = 1:[2,3]</code> you get <code>z=1</code> and <code>zs=[2,3]</code></li>\n<li>but when input <code>[]</code> you cannot get a <code>z</code> and <code>zs</code> so that <code>z:zs = []</code> (technically they are based on different constructors of the list-datatype)</li>\n</ul>\n\n<p>So at runtime it will not know how to handle this case/pattern when it sees <code>[]</code> and throw the exception.</p>\n\n<p>if you look closely at your example you should see that you never actually use the parts anyway (meaning <code>z</code> or <code>zs</code> - you only use them as <code>z:zs</code> again) so I cannot tell you how to do it better</p>\n\n<p>anyway you can use the <code>case</code> - expression inside of an lambda:</p>\n\n<pre><code>... = foldr (\\ x zs -&gt; case zs of\n                         [] -&gt; ...\n                         z:zs -&gt; ...\n</code></pre>\n\n<p>or you can use the <a href=\"https://prime.haskell.org/wiki/LambdaCase\" rel=\"nofollow noreferrer\">LambdaCase</a> extension to make it a bit shorter.</p>\n"}], "owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7932, "favorite_count": 1, "accepted_answer_id": 38551902, "answer_count": 1, "score": 6, "last_activity_date": 1532792755, "creation_date": 1469362151, "question_id": 38551844, "link": "https://stackoverflow.com/questions/38551844/pattern-matching-inside-lambda", "title": "Pattern matching inside lambda", "body": "<p>I'm learning Haskell. This is a trivial example but I'd like to understand the concept why I can't use the pattern matching inside the lambda function in the following example (i.e., why does the filterfold' function run but filterfold' gives a runtime error):</p>\n\n<pre><code>-- Runs\nfilterfold' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterfold' p zs = foldr (\\y zs -&gt; if (p y) then y:zs else zs) [] zs\n\n-- Runtime error: Non-exhaustive patterns in lambda\nfilterfold :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterfold p (z:zs) = foldr (\\y (z:zs) -&gt; if (p y) then y:(z:zs) else (z:zs)) [] (z:zs)\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469360417, "post_id": 38549370, "comment_id": 64493844, "body": "Note that the <code>Show t</code> instance will overlap with all the standard ones."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469367396, "post_id": 38549370, "comment_id": 64495941, "body": "@chi, I fixed that."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1469387181, "last_edit_date": 1469387181, "creation_date": 1469341628, "answer_id": 38549370, "question_id": 38549174, "link": "https://stackoverflow.com/questions/38549174/error-while-trying-to-use-type-families-to-dissambiguate-overlapping-instances-w/38549370#38549370", "title": "Error while trying to use type families to dissambiguate overlapping instances with flexible contexts", "body": "<p>You need to work with an auxiliary class. Enable <code>ScopedTypeVariables</code>, <code>MultiParamTypeClasses</code>, <code>UndecidableInstances</code>, and so on. Code not tested yet.</p>\n\n<pre><code>class Showy status t where\n  showy :: proxy status -&gt; t -&gt; String\n\ninstance Showy Yes t where\n  showy _ _ = \"yup\"\n\ninstance Showy No t where\n  showy _ _ = \"nope\"\n\nnewtype S t = S t\n--Avoid overlapping unrelated `Show` instances.\n--This newtype would be unnecessary for a custom\n--class or when you're making instances for a\n--parameterized type already.\n\ninstance (IsInt t ~ status, Showy status t) =&gt; Show (S t)\n  show (S t) = showy (Proxy :: Proxy status) t\n</code></pre>\n\n<p>Note that you can also make use of the <code>Int</code> if you like, by replacing the <code>Yes</code> instance with something like</p>\n\n<pre><code>instance t ~ Int =&gt; Showy Yes t where\n  showy _ x = show (x + 22)\n</code></pre>\n\n<p>You can also constrain the <code>No</code> instance if you wish:</p>\n\n<pre><code>instance Enum t =&gt; Showy No t where\n  showy _ = show . fromEnum\n</code></pre>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469387181, "creation_date": 1469339627, "question_id": 38549174, "link": "https://stackoverflow.com/questions/38549174/error-while-trying-to-use-type-families-to-dissambiguate-overlapping-instances-w", "title": "Error while trying to use type families to dissambiguate overlapping instances with flexible contexts", "body": "<p>I'm trying to define instances for typeclasses using some fairly complex conditions on the type arguments of the type I'm working with, and thought that a useful approach would be to declare a closed type family that chooses between the instances I'm defining.  Unfortunately, I can't get that idea to work at all, as GHC complains that the instances are duplicates.  Here's a  simplified example that gives the same error I'm seeing:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, TypeFamilies #-}\ndata MyContainer a = NoValue | OneValue a | TwoValues a a\n\ndata Yes\ndata No\n\ntype family IsInt t where\n    IsInt Int = Yes\n    IsInt a   = No\n\ninstance IsInt t ~ Yes =&gt; Show (MyContainer t) where\n    show _ = \"Type is int\"\ninstance IsInt t ~ No =&gt; Show (MyContainer t) where\n    show _ = \"Type is not int\"\n</code></pre>\n\n<p>The error I'm seeing is:</p>\n\n<pre><code>src/Test.hs:11:10:\n    Duplicate instance declarations:\n      instance (IsInt t ~ Yes) =&gt; Show (MyContainer t)\n        -- Defined at src/Test.hs:11:10\n      instance (IsInt t ~ No) =&gt; Show (MyContainer t)\n        -- Defined at src/Test.hs:13:10\n</code></pre>\n\n<p>How can I disambiguate these instances (without resorting to overlapping instances, which work for this test code but don't seem to be working correctly for my more complex original code)?</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1469315043, "post_id": 38546982, "comment_id": 64486174, "body": "This looks as a bug to me. If others agree on this, you should <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ReportABug\" rel=\"nofollow noreferrer\">report it</a>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1469325581, "post_id": 38546982, "comment_id": 64487712, "body": "Changing <code>StripNatList</code> to a type family or inlining the definition inside <code>Family</code> causes the error to be correctly triggered. Even more strangely, e.g. <code>type family X (x :: NatList) = (r :: List) | r -&gt; x where X x = StripNatList x</code> (i.e. same thing but removing <code>NewType</code>) correctly gives an error <i>regardless</i> of how you define <code>StripNatList</code>. The behaviour in this edge case is so wild it is almost certainly a bug..."}, {"owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469377285, "post_id": 38546982, "comment_id": 64499167, "body": "@chi Thanks. I made a ticket <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12430#ticket\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12430#ticket</a>"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 470, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1469313238, "creation_date": 1469313238, "question_id": 38546982, "link": "https://stackoverflow.com/questions/38546982/typefamilydependencies-why-is-this-injectivity-annotation-accepted", "title": "TypeFamilyDependencies: why is this injectivity annotation accepted?", "body": "<p>Consider this code (requires singletons-2.2):</p>\n\n<pre><code>    {-# LANGUAGE TypeFamilies, DataKinds, PolyKinds, TypeOperators, KindSignatures, TypeInType, TypeFamilyDependencies, UndecidableInstances #-}\n\nmodule Bug where\n\nimport Data.Kind (Type)\nimport Data.Singletons.Prelude (Map, SndSym0)\nimport GHC.TypeLits (Nat)\n\ndata Payload = A | B\n\nnewtype NewType a = NewType Int\n\ntype List = [Payload]\ntype NatList = [(Nat, Payload)]\n\ntype StripNatList (natList :: NatList) = Map SndSym0 natList\n\ntype family Family (natList :: NatList) = (r :: Type) | r -&gt; natList where\n    Family '[] = ()\n    Family xs  = NewType (StripNatList xs)    \n</code></pre>\n\n<p>I don't understand why GHC is okay with injectivity annotation for <code>Family</code>: <code>r -&gt; natList</code>.</p>\n\n<p>These two types:</p>\n\n<pre><code>type Foo = Family '[ '(0, 'A), '(1, 'B)]\ntype Bar = Family '[ '(0, 'A), '(0, 'B)]\n</code></pre>\n\n<p>are obviously map to the same type:</p>\n\n<pre><code>*Bug Data.Singletons.Prelude&gt; :kind! Foo\nFoo :: *\n= NewType ('A :$$$ '['B])\n*Bug Data.Singletons.Prelude&gt; :kind! Bar\nBar :: *\n= NewType ('A :$$$ '['B])\n</code></pre>\n\n<p>Why this is not rejected?</p>\n"}, {"tags": ["haskell", "libusb"], "comments": [{"owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1469371797, "post_id": 38546527, "comment_id": 64497361, "body": "On Windows I&#39;d expect to see things like COM3 or COM4 while on Linux /dev/ttyusb0 or similar. This will ultimately feed into the openSerialPort function from System.Hardware.Serial."}], "answers": [{"comments": [{"owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "edited": false, "score": 1, "creation_date": 1469448863, "post_id": 38561696, "comment_id": 64524602, "body": "Thanks, for some applications and uses this manual approach works fine. But some devices create serial interfaces on new ports dynamically (e.g. the Arduino Leonardo bootloader comes in on a different port after a reset) and if you frequently switch multiple devices things get tedious fairly quickly."}, {"owner": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "reply_to_user": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "edited": false, "score": 0, "creation_date": 1469466525, "post_id": 38561696, "comment_id": 64536324, "body": "@marangisto, I added a section on static naming."}], "tags": [], "owner": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "is_accepted": false, "score": 0, "last_activity_date": 1469466510, "last_edit_date": 1469466510, "creation_date": 1469430815, "answer_id": 38561696, "question_id": 38546527, "link": "https://stackoverflow.com/questions/38546527/system-usb-serial-port-from-device/38561696#38561696", "title": "System.USB: serial port from Device", "body": "<p>If you really cannot solve it in another way, please disregard this answer.</p>\n\n<hr>\n\n<p>You should consider other options. Instead of scanning for a device that matches specific vendor or product IDs, you could instead simply accept the serial interface's name as an argument to your program or as a configurable option. On Windows, this would be in the form \"COMx\", while on Unix it would simply be a path.</p>\n\n<p>Additionally, serial interfaces may not always be USB devices, preventing you from enumerating PCI or integrated serial ports by scanning USB devices. Plus, hard-coding values into source code makes for a painful update when the device is later replaced with something else.</p>\n\n<h3>Static port naming</h3>\n\n<p>If you are on Windows, assigning a custom interface number (e.g. COM7) should make it stick if you unplug the interface or reboot the computer. On Linux, it is a bit more contrived: you can add a Udev rule that matches the product and vendor ID so that it will create a node with a custom name, for instance <code>/dev/arduinoN</code>. I strongly suggest you follow this approach, as giving a manual path or modifying a Udev file is (arguably) easier than recompiling your application. I know a DMX product that does this: since it uses an off-the-shelf FTDI interface, it ships with a rule that matches this vendor and product ID and renames the node <code>/dev/dmxN</code>. While the rule clashes with other FTDI interfaces, in your case it will not since Arduino have their own product and vendor ID assignment.</p>\n"}, {"comments": [{"owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "edited": false, "score": 0, "creation_date": 1469448969, "post_id": 38567055, "comment_id": 64524680, "body": "Thanks. Yes, I&#39;m converging on using udev on Linux and some registry search as you suggest on Windows. I&#39;ll try to abstract these into a common API that works cross-platform."}], "tags": [], "owner": {"reputation": 640, "user_id": 5546740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30a58700586445bfde9d07b64c6dd7f?s=128&d=identicon&r=PG&f=1", "display_name": "dryman", "link": "https://stackoverflow.com/users/5546740/dryman"}, "is_accepted": true, "score": 2, "last_activity_date": 1469447606, "creation_date": 1469447606, "answer_id": 38567055, "question_id": 38546527, "link": "https://stackoverflow.com/questions/38546527/system-usb-serial-port-from-device/38567055#38567055", "title": "System.USB: serial port from Device", "body": "<p>You need to search for your device in the registry. Under the key <code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum</code> there are multiple keys (in most cases its USB but sometimes the drivers install it in a different subkey) which themselves contain keys in the format <code>VID_xxxx&amp;PID_xxxx</code>. You have to find this key first. It will be most likely something like <code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USB\\VID_xxxx&amp;PID_xxxx</code>.</p>\n\n<p>This key contains itself new subkeys. And these subkeys contain a key called <code>Device Parameters</code> which contains the needed key value pair <code>PortName</code> with the port something like COM3.</p>\n\n<p>Sadly I have no idea how this is done in Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "is_accepted": false, "score": 1, "last_activity_date": 1469629590, "creation_date": 1469629590, "answer_id": 38615810, "question_id": 38546527, "link": "https://stackoverflow.com/questions/38546527/system-usb-serial-port-from-device/38615810#38615810", "title": "System.USB: serial port from Device", "body": "<p>Following dryman's suggestion and some digging around I abandoned usblib altogether and implemented directly via the registry on Windows (I'll leave Linux for another day):</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\nmodule USBSerial (USBSerial(..), usbSerials) where\n\nimport System.Win32.Registry (hKEY_LOCAL_MACHINE, regOpenKey, regCloseKey, regQueryValue, regQueryValueEx)\nimport System.Win32.Types (DWORD, HKEY)\nimport Control.Exception (handle, bracket, SomeException(..))\nimport Foreign (toBool, Storable(peek, sizeOf), castPtr, alloca)\nimport Data.List.Split (splitOn)\nimport Data.List (stripPrefix)\nimport Numeric (readHex, showHex)\nimport Data.Maybe (catMaybes)\nimport Control.Monad (forM)\n\ndata USBSerial = USBSerial\n    { key           :: String\n    , vendorId      :: Int\n    , productId     :: Int\n    , portName      :: String\n    , friendlyName  :: String\n    }\n\ninstance Show USBSerial where\n    show USBSerial{..} = unwords [ portName, toHex vendorId, toHex productId, friendlyName ]\n        where toHex x = let s = showHex x \"\" in replicate (4 - length s) '0' ++ s\n\nusbSerials :: Maybe Int -&gt; Maybe Int -&gt; IO [USBSerial]\nusbSerials mVendorId mProductId = withHKey hKEY_LOCAL_MACHINE path $ \\hkey -&gt; do\n    n &lt;- regQueryValueDWORD hkey \"Count\"\n    fmap catMaybes $ forM [0..n-1] $ \\i -&gt; do\n        key &lt;- regQueryValue hkey . Just . show $ i\n        case keyToVidPid key of\n            Just (vendorId, productId)\n                | maybe True (==vendorId) mVendorId &amp;&amp; maybe True (==productId) mProductId -&gt; do\n                    portName &lt;- getPortName key\n                    friendlyName &lt;- getFriendlyName key\n                    return $ Just USBSerial{..}\n            _ -&gt; return Nothing\n    where path = \"SYSTEM\\\\CurrentControlSet\\\\Services\\\\usbser\\\\Enum\"\n\ngetPortName :: String -&gt; IO String\ngetPortName serial = withHKey hKEY_LOCAL_MACHINE path $ flip regQueryValue (Just \"PortName\")\n    where path = \"SYSTEM\\\\CurrentControlSet\\\\Enum\\\\\" ++ serial ++ \"\\\\Device Parameters\"\n\ngetFriendlyName :: String -&gt; IO String\ngetFriendlyName serial = withHKey hKEY_LOCAL_MACHINE path $ flip regQueryValue (Just \"FriendlyName\")\n    where path = \"SYSTEM\\\\CurrentControlSet\\\\Enum\\\\\" ++ serial\n\nkeyToVidPid :: String -&gt; Maybe (Int, Int)\nkeyToVidPid name\n    | (_:s:_) &lt;- splitOn \"\\\\\" name\n    , (v:p:_) &lt;- splitOn \"&amp;\" s\n    , Just v &lt;- fromHex =&lt;&lt; stripPrefix \"VID_\" v\n    , Just p &lt;- fromHex =&lt;&lt; stripPrefix \"PID_\" p = Just (v, p)\n    | otherwise = Nothing\n    where fromHex s = case readHex s of\n            [(x, \"\")] -&gt; Just x\n            _         -&gt; Nothing\n\nwithHKey :: HKEY -&gt; String -&gt; (HKEY -&gt; IO a) -&gt; IO a\nwithHKey hive path = handle (\\(SomeException e) -&gt; error $ show e) . bracket (regOpenKey hive path) regCloseKey\n\n-- | Read DWORD value from registry.\n-- From http://compgroups.net/comp.lang.haskell/working-with-the-registry-windows-xp/2579164\nregQueryValueDWORD :: HKEY -&gt; String -&gt; IO DWORD\nregQueryValueDWORD hkey name = alloca $ \\ptr -&gt; do\n    regQueryValueEx hkey name (castPtr ptr) (sizeOf (undefined :: DWORD))\n    peek ptr\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>main :: IO ()\nmain = usbSerials (Just 0x2341) Nothing &gt;&gt;= mapM_ print\n</code></pre>\n\n<p>produces output like:</p>\n\n<pre><code>COM7 2341 8036 Arduino Leonardo (COM7)\nCOM3 2341 0043 Arduino Uno (COM3)\n</code></pre>\n"}], "owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "accepted_answer_id": 38567055, "answer_count": 3, "score": 0, "last_activity_date": 1469629590, "creation_date": 1469308859, "last_edit_date": 1469360739, "question_id": 38546527, "link": "https://stackoverflow.com/questions/38546527/system-usb-serial-port-from-device", "title": "System.USB: serial port from Device", "body": "<p>I'm using usb-1.3.0.4 / System.USB. Having scanned and selected a relevant serial USB device, how do I find the corresponding serial port (e.g. COM3 on Windows)?</p>\n\n<p>Here is an example of what I'm after:</p>\n\n<pre><code>module Main (main) where\n\nimport System.USB\nimport System.Hardware.Serialport\nimport qualified Data.Vector as V\nimport Data.Maybe\n\nmain :: IO ()\nmain = do\n    devicePort 0x2341 0x0043 &gt;&gt;= either putStrLn usePort\n    where usePort p = do\n              s &lt;- openSerial p defaultSerialSettings\n              putStrLn $ \"opened serial port \" ++ p\n              closeSerial s\n\n-- | Find port for attached USB serial device\ndevicePort :: VendorId -&gt; ProductId -&gt; IO (Either String FilePath)\ndevicePort vid pid = do\n    ctx &lt;- newCtx\n    findDevice ctx vid pid &gt;&gt;= \\md -&gt; case md of\n        Just dev -&gt; fmap (maybe (Left \"not a serial device\") Right) $ serialPort dev\n        Nothing -&gt; return $ Left \"device not found\"\n\n-- | Scan for first device with given vendor and product identifiers\nfindDevice :: Ctx -&gt; VendorId -&gt; ProductId -&gt; IO (Maybe Device)\nfindDevice ctx vid pid = fmap (listToMaybe . V.toList) $ V.filterM p =&lt;&lt; getDevices ctx\n    where p x = do\n              d &lt;- getDeviceDesc x\n              return $ deviceVendorId d == vid &amp;&amp; deviceProductId d == pid\n\nserialPort :: Device -&gt; IO (Maybe FilePath)\nserialPort dev = undefined\n</code></pre>\n\n<p>What is a possible implementation of the last function?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1469294563, "post_id": 38544495, "comment_id": 64480713, "body": "I was trying to use foldr to write toList, but I&#39;ll take it! Thanks. :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469304249, "post_id": 38544495, "comment_id": 64483668, "body": "<code>foldr</code> looks ill-typed to me, since <code>toList</code> returns a list of pairs, and <code>f</code> does not work on pairs."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469294239, "creation_date": 1469294239, "answer_id": 38544495, "question_id": 38544290, "link": "https://stackoverflow.com/questions/38544290/whats-wrong-with-the-derived-foldable-instance-of-my-kdtree/38544495#38544495", "title": "What&#39;s wrong with the derived Foldable instance of my KdTree?", "body": "<blockquote>\n  <p>So, ultimately, I would appreciate a clue as to how to either write a Foldable for my <code>KdTree BBox a</code></p>\n</blockquote>\n\n<p>The <code>toList</code> function looks like it should be:</p>\n\n<pre><code>toList :: KdTree BBox3 a -&gt; [(BBox3,a)]\ntoList (KdLeaf Nothing) = []\ntoList (KdLeaf (Just leaf)) = kdleaf leaf\ntoList (KdNode node) = toList (kdLeft node) ++ toList (kdRight node) ++ overlapped node\n</code></pre>\n\n<p>and from that <code>foldr</code> is:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; KdTree BBox3 a -&gt; b\nfoldr f z kdtree = foldr f z (toList kdtree)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1469301276, "post_id": 38544833, "comment_id": 64482888, "body": "I&#39;m trying to generalize a KdTree adapted to regions."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1469301463, "post_id": 38544833, "comment_id": 64482936, "body": "If what you say is true, why does my spike type check?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1469303914, "post_id": 38544833, "comment_id": 64483573, "body": "@MichaelLitchard It doesn&#39;t type check, at least not on my setup. I get the same error in the <code>toList</code> function."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1469296266, "creation_date": 1469296266, "answer_id": 38544833, "question_id": 38544290, "link": "https://stackoverflow.com/questions/38544290/whats-wrong-with-the-derived-foldable-instance-of-my-kdtree/38544833#38544833", "title": "What&#39;s wrong with the derived Foldable instance of my KdTree?", "body": "<p><code>foldr</code> aggregates the right-most type parameter of the foldable structure.</p>\n\n<pre><code>class Foldable t where\n    foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n    -- ...\n</code></pre>\n\n<p>In this instance, <code>t ~ KdTree BBox3</code>. Your implementation of <code>toList</code> will produce a list of <code>a</code>s.</p>\n\n<pre><code>toList :: KdTree BBox3 a -&gt; [a]\ntoList t = F.foldr (:) [] t\n</code></pre>\n\n<p>(This exact function already exists, by the way, in the <code>Data.Foldable</code> module.)</p>\n\n<p>Given the way you've set up your system, with <code>KdTree</code> as an associated type, there's no way to use the <code>Foldable</code> (or even <code>Bifoldable</code>) machinery to extract <code>BBox3</code>s from a <code>KdTree BBox3</code>. Your code looks more complicated than it ought to be - what exactly are you trying to achieve?</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 38544833, "answer_count": 2, "score": 0, "last_activity_date": 1469304390, "creation_date": 1469293070, "last_edit_date": 1469304390, "question_id": 38544290, "link": "https://stackoverflow.com/questions/38544290/whats-wrong-with-the-derived-foldable-instance-of-my-kdtree", "title": "What&#39;s wrong with the derived Foldable instance of my KdTree?", "body": "<p>I'm trying to derive a Foldable instance for my <code>KdTree</code> data structure. The problem happened when I tried to make a <code>toList</code> function.</p>\n\n<pre><code>toList :: KdTree BBox3 a -&gt; [(BBox3,a)]\ntoList t = F.foldr (:) [] t\n</code></pre>\n\n<p>when trying to compile, I got this error</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018(BBox3, a)\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for toList :: KdTree BBox3 a -&gt; [(BBox3, a)]\n      at Data/Trees/KdTree/Regions/KThree/KThreeTree.hs:127:13\nExpected type: KdTree BBox3 (BBox3, a)\n  Actual type: KdTree BBox3 a\nRelevant bindings include\n  t :: KdTree BBox3 a\n    (bound at Data/Trees/KdTree/Regions/KThree/KThreeTree.hs:128:10)\n  toList :: KdTree BBox3 a -&gt; [(BBox3, a)]\n    (bound at Data/Trees/KdTree/Regions/KThree/KThreeTree.hs:128:3)\nIn the third argument of \u2018foldr\u2019, namely \u2018t\u2019\nIn the expression: foldr (:) [] t\n</code></pre>\n\n<p>I figured this was because the Foldable instance wasn't being derived correctly, so I made a spike to see what code was being generated.\nBut here's the thing, my spike worked. I added a <code>toList</code> function, with no complaint, and I can't figure out what made the difference. So, ultimately,\nI would appreciate a clue as to how to either write a Foldable for my <code>KdTree BBox a</code>, or some insight in what is going wrong in my code compared to the correct (but seemingly the same) code in my spike.</p>\n\n<p>Below is the spike, plus a link to my project code.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, InstanceSigs, DeriveFoldable, DeriveFunctor #-}\n\nimport Data.List\nimport qualified Data.Foldable as F\n\ndata BBox3 = BBox3 {\n   v3x :: Double\n , v3y :: Double\n , v3z :: Double \n}\n\ndata AxisX = AxisX\ndata AxisY = AxisY\ndata AxisZ = AxisZ\n\nclass ( Bounded bbox) =&gt; KdTreeRegional bbox where\n\n  data Axes bbox :: *\n  data KdTree bbox :: * -&gt; *\n  data Leaf bbox :: * -&gt; *\n\n  toList :: KdTree bbox a -&gt; [(bbox,a)]\n\ninstance KdTreeRegional BBox3 where\n  data Axes BBox3 = X AxisX | Y AxisY | Z AxisZ\n\n  data KdTree BBox3 a\n    = KdNode {\n        kdLeft     :: KdTree BBox3 a\n      , nodeBBox   :: BBox3\n      , kdSplit    :: (Axes BBox3,Double)\n      , overlapped :: [(BBox3, a)]\n      , kdRight    :: KdTree BBox3 a\n      }\n    | KdLeaf (Maybe (Leaf BBox3 a))\n    deriving (F.Foldable)\n\n  data Leaf BBox3 a = Leaf {\n         leafBBox :: BBox3\n       , kdleaf   :: [(BBox3,a)]\n       } deriving (F.Foldable)\n\n  toList :: KdTree BBox3 a -&gt; [(BBox3,a)]\n  toList t = F.foldr (:) [] t\n</code></pre>\n\n<p><a href=\"https://github.com/mlitchard/kdtree/blob/stack/Data/Trees/KdTree/Regions/Internal.hs\" rel=\"nofollow\">https://github.com/mlitchard/kdtree/blob/stack/Data/Trees/KdTree/Regions/Internal.hs</a></p>\n\n<p><a href=\"https://github.com/mlitchard/kdtree/blob/stack/Data/Trees/KdTree/Regions/KThree/KThreeTree.hs\" rel=\"nofollow\">https://github.com/mlitchard/kdtree/blob/stack/Data/Trees/KdTree/Regions/KThree/KThreeTree.hs</a></p>\n\n<p>Update: This doesn't compile. I was getting this error</p>\n\n<pre><code> The IO action \u2018main\u2019 is not defined in module \u2018Main\u2019\n</code></pre>\n\n<p>which I interpreted as a <code>Warning</code>, and ignored. I added <code>main = undefined</code> and received the same error I have been getting all along.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 1, "creation_date": 1469292771, "post_id": 38544205, "comment_id": 64480134, "body": "It must be a mistake, the part to the left must match the head of the list."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1469292823, "post_id": 38544205, "comment_id": 64480153, "body": "That was a typo. It&#39;s fixed now."}, {"owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "reply_to_user": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1469293165, "post_id": 38544205, "comment_id": 64480269, "body": "@EarlGray Well, i feel better now i think haha. But i still don&#39;t get it: why the tail is bounded to the <i>? Haskell automagically read &quot;(x:</i>)&quot; and says &quot;well, i will bound the head to the x and the rest to <i>&quot;? Or &quot;:&quot; when used on pattern matching between parentheses has a different meaning? Because (x:</i>) for my understanding is &quot;put x at the start of _&quot;...   This may be a silly question, sorry :)"}, {"owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1469293215, "post_id": 38544205, "comment_id": 64480290, "body": "@sepp2k Thanks to you too man :)"}, {"owner": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1469293375, "post_id": 38544205, "comment_id": 64480351, "body": "<code>:</code> in the function definition is not an application, it&#39;s syntactic sugar called <i>pattern matching</i>, that takes a concrete value of type <code>[String]</code>, checks if it can be described by pattern <code>(x:_)</code> and if it is the case, takes the head of the list and names it <code>x</code>, throwing away the rest (<code>_</code>). If there are no matching function definitions, a runtime exception is thrown."}, {"owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "reply_to_user": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1469296630, "post_id": 38544205, "comment_id": 64481457, "body": "@EarlGray Thanks for your time! It really helped me :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 2, "creation_date": 1469339136, "post_id": 38544205, "comment_id": 64489533, "body": "@EarlGray, in Haskell, pattern matching is most definitely <i>not</i> syntactic sugar. It is instead the most fundamental way to inspect data. In fact, pattern matches in Haskell are compiled into pattern matches in GHC&#39;s intermediate language and survive right up until code generation! <code>if&#47;then&#47;else</code> forms and guards <i>are</i> syntactic sugar, and compile to pattern matches."}, {"owner": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1469378542, "post_id": 38544205, "comment_id": 64499585, "body": "Yes, I was wrong about its role, it&#39;s a mechanism that percolate the compilation pipeline deeply, not just desugaring. My point is that it is translated into sophisticated run-time code that does many useful things efficiently."}], "answers": [{"comments": [{"owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "edited": false, "score": 0, "creation_date": 1469295119, "post_id": 38544297, "comment_id": 64480911, "body": "Type signature had a typo, i have the original code in my pc, so i didn&#39;t copy-pasted it. It&#39;s fixed now, sorry :)"}, {"owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "edited": false, "score": 0, "creation_date": 1469296583, "post_id": 38544297, "comment_id": 64481439, "body": "After some coding and re-reading your question and EarlGray&#39;s, i think i understand it :) thank you very much man. I really appreciate your help :)"}, {"owner": {"reputation": 396, "user_id": 5450594, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tBhWSTD9s8k/AAAAAAAAAAI/AAAAAAAAGWc/p5DCxwvhfvg/photo.jpg?sz=128", "display_name": "Lance Clark", "link": "https://stackoverflow.com/users/5450594/lance-clark"}, "edited": false, "score": 0, "creation_date": 1519316403, "post_id": 38544297, "comment_id": 84871313, "body": "How is <code>data [a] = [] | a : [a]</code> valid? I&#39;m unable to do something like that in ghci: <code>data TestType = Integer | Integer : [Integer]</code>"}, {"owner": {"reputation": 3100, "user_id": 933616, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ac358baf891ce02fb4a686c1ad6b9ac4?s=128&d=identicon&r=PG", "display_name": "Benjamin Kovach", "link": "https://stackoverflow.com/users/933616/benjamin-kovach"}, "reply_to_user": {"reputation": 396, "user_id": 5450594, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tBhWSTD9s8k/AAAAAAAAAAI/AAAAAAAAGWc/p5DCxwvhfvg/photo.jpg?sz=128", "display_name": "Lance Clark", "link": "https://stackoverflow.com/users/5450594/lance-clark"}, "edited": false, "score": 1, "creation_date": 1519334580, "post_id": 38544297, "comment_id": 84881708, "body": "@LanceClark Lists are special, the language (well, GHC) handles this particular definition for you. You can redefine an isomorphic type, though, like this: <code>data List a = Nil | Cons a (List a)</code>"}], "tags": [], "owner": {"reputation": 3100, "user_id": 933616, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ac358baf891ce02fb4a686c1ad6b9ac4?s=128&d=identicon&r=PG", "display_name": "Benjamin Kovach", "link": "https://stackoverflow.com/users/933616/benjamin-kovach"}, "is_accepted": true, "score": 8, "last_activity_date": 1469293130, "creation_date": 1469293130, "answer_id": 38544297, "question_id": 38544205, "link": "https://stackoverflow.com/questions/38544205/pattern-matching-x-why-is-the-list-head-bounded-to-x/38544297#38544297", "title": "Pattern matching (x:_): why is the list head bounded to x?", "body": "<p>The list data type is defined like this:</p>\n\n<p><code>data [a] = [] | a : [a]\n</code></p>\n\n<p>That means that a list of <code>a</code>s is either empty, or a head element attached to a tail element using the <code>:</code> (<code>cons</code>) constructor.</p>\n\n<p>When you pattern match on a list, you define your function for each of these two cases. In the case of <code>head'</code>, it just fails when given an empty list, so we only match one case: the <code>a : [a]</code> case.</p>\n\n<p>If you called <code>head' \"hello\"</code> (as it exists right now, with the type signature included) it should fail, because <code>\"hello\"</code> is actually a <code>String</code> -- an alias for <code>[Char]</code> in Haskell. \"hello\" is merely syntactic sugar for the following construction:</p>\n\n<p><code>\"hello\" = 'h':'e':'l':'l':'o':[]\n</code></p>\n\n<p>So, when you pattern match on the list using <code>head'</code>, you get <code>'h'</code> on the left side of the first <code>:</code>, and the rest of the list (which we don't care about) bound to <code>_</code>.</p>\n"}], "owner": {"reputation": 1092, "user_id": 4961745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b85dab42bc6ecb8216ab2fd61d6af75c?s=128&d=identicon&r=PG&f=1", "display_name": "Emilio Grisol&#237;a", "link": "https://stackoverflow.com/users/4961745/emilio-grisol%c3%ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 0, "accepted_answer_id": 38544297, "answer_count": 1, "score": 0, "last_activity_date": 1615815259, "creation_date": 1469292612, "last_edit_date": 1615815259, "question_id": 38544205, "link": "https://stackoverflow.com/questions/38544205/pattern-matching-x-why-is-the-list-head-bounded-to-x", "title": "Pattern matching (x:_): why is the list head bounded to x?", "body": "<p>Just struggling here with Haskell... i have a pretty bad terminology, and given my native language is not english, it's a little complicated to make the right searches :P i was following some haskell tutorials/books (Learn you a Haskell, Real World Haskell, Happy Learn Haskell, also a mailing list, and some random pages), and now i'm stopped here:</p>\n<pre><code>head' :: [Char] -&gt; Char\nhead' (x:_) = x\n</code></pre>\n<p>This function receives a list of elements of String type, and if i apply it like this:</p>\n<pre><code>head' &quot;hello&quot;\n</code></pre>\n<p>It returns &quot;h&quot;, which is bounded to x, and &quot;ello&quot; is bounded to _, but it does not matter because i don't use it. I understand that the (:) function (or used as an infix operator) receives an element which will be put and the start of a new list, whose tail will be the other received element:\n<code>'a' : ['b', 'c']</code> will return &quot;abc&quot; But, why when i use &quot;:&quot; inside parentheses, the first element is bounded to x and the rest to _? What happens here?</p>\n<p>I read a few SO questions like this <a href=\"https://stackoverflow.com/questions/35278382/xxs-pattern-haskell-logic\">(x:xs) pattern Haskell logic</a> and this (which is more closer to answer my question i think) <a href=\"https://stackoverflow.com/questions/4482697/a-newbie-to-haskell-help\">What does (x:_) and [x:_] mean?</a> but the accepted question of this last one says:\n&quot;: is a constructor for lists, which takes the head of the new list as its left argument and the tail as its right argument. <strong>If you use it as a pattern like here that means that the head of the list you match is given to the right pattern and the tail to the left.</strong>&quot;</p>\n<p>&quot;The head of the list is given to the right, and the tail to the left&quot;... it really confuses me: if the head is given to &quot;_&quot; and the tail to &quot;x&quot; when used &quot;:&quot; on pattern matching, why x has the value of the list head?</p>\n<p>I think maybe its my bad english level which makes me difficult to grasp this. I will also appreciate some hint (like a specific search) instead of a direct answer.</p>\n<hr />\n<p>EDIT: For another noob like me.... as said by the accepted answer, &quot;abcd&quot; is just 'a':'b':'c':'d', the pattern (x:_) matches 'a':'b' and so on, the underscore means &quot;i don't care about the rest&quot;, and receives the rest of the characters. Just that :)</p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1469289793, "post_id": 38543617, "comment_id": 64479223, "body": "That&#39;s just <code>liftA2 f g h</code>."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1469290421, "post_id": 38543617, "comment_id": 64479402, "body": "Thanks for the suggestion. But I am having a headache understanding what <code>APPlicative</code> is. Maybe some other way without being <code>Applicative</code>? Thanks still. :)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1469290591, "post_id": 38543617, "comment_id": 64479458, "body": "Sure: <code>liftM2 f g h</code> :-)"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1469292193, "post_id": 38543617, "comment_id": 64479953, "body": "Thanks for this nice suggestion! Indeed monads come in quite handy in such higher-order tasks. I would like to see some <code>built from scratch</code> example, if any, though. Again thanks for pointing out this use of monads. :D"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1469294916, "post_id": 38543617, "comment_id": 64480841, "body": "Note that <code>Applicative</code> is more fundamental than the monad; technically it&#39;s actually simpler (but for some strange reason, monads seem indeed easier to understand, I also struggled with applicatives for a while). Anyway, <code>liftA2</code>/<code>liftM2</code> rely on a particular, somewhat controversial applicative <i>instance</i> of functions, so this isn&#39;t really \u201ca monad solution\u201d but a solution exploiting that instance. The really fundamental approach is to use the <a href=\"https://en.wikipedia.org/wiki/Cartesian_monoidal_category\" rel=\"nofollow noreferrer\">cartesian monoidal category</a> property of Haskell functions; this is what <code>Arrow</code> does."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1469295674, "post_id": 38543617, "comment_id": 64481104, "body": "@leftaroundabout Thanks for pointing out the interesting fact that <code>Arrow</code> uses the cartesian monoidal category property. I think I will have a long-time headache then. :-P"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 3, "creation_date": 1469297234, "post_id": 38543617, "comment_id": 64481630, "body": "The process of converting a lambda term into an equivalent that instead of lambda abstraction uses a suitable set of combinators is called <a href=\"https://en.wikipedia.org/w/index.php?title=Combinatory_logic&amp;oldid=724463160#Completeness_of_the_S-K_basis\" rel=\"nofollow noreferrer\">abstraction elimination</a>. The link shows that combinators <b>S</b> and <b>K</b> are such a set, and <code>liftA2</code> or <code>liftM2</code> for the reader monad is just the <b>S</b> combinator. I wrote an article about this relationship a few years ago in <a href=\"https://themonadreader.files.wordpress.com/2011/01/issue17.pdf\" rel=\"nofollow noreferrer\">The Monad Reader #17</a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1469305013, "post_id": 38543617, "comment_id": 64483874, "body": "@PetrPudl&#225;k <code>liftA2</code> is not <b>S</b>. <code>ap</code> is <b>S</b>."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1469349699, "post_id": 38543617, "comment_id": 64491506, "body": "@melpomene You&#39;re right, that was a mistake."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1469356319, "post_id": 38543617, "comment_id": 64492914, "body": "@melpomene I don&#39;t see why <code>ap</code> is <b>S</b>: I am told <code>S x y z = x z (y z)</code>, but IMHO, <code>ap</code> just lifts function application? Also I like this abstraction elimination: quite interesting!"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1469356821, "post_id": 38543617, "comment_id": 64493029, "body": "According to the abstraction-elimination process in the link we can also write  -----------------------------------------      <code>S (S (K f) (S (K g) I)) (S (K h) I),</code>  per chance?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1469357553, "post_id": 38543617, "comment_id": 64493190, "body": "@awllower <a href=\"https://gist.github.com/anonymous/7050431229399e6002dd3a56abf256a7\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/7050431229399e6002dd3a56abf256a7</a>"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1469358143, "post_id": 38543617, "comment_id": 64493336, "body": "I see! Thanks for pointing out this detailed expansion of <code>ap</code> in the case of <code>(-&gt;) e</code> monad. So what I wrote above may be written as <code>ap (ap (const f) g) h</code> after eta reduction?"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472833821, "post_id": 38543617, "comment_id": 65927770, "body": "@leftaroundabout Sorry about the mention after a long time; I found that we can view arrows as strong monads in the bicategory of pro-functors, and in fact the notion of arrows is not limited to cartesian categories, but we can define it over a monodical category. BTW, I am referring to <a href=\"http://www-kb.is.s.u-tokyo.ac.jp/~asada/papers/arrStrMnd.pdf\" rel=\"nofollow noreferrer\">this oar</a>. And this left me wondering if there is a more mathematical fit for applicative. :P"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1472862249, "post_id": 38543617, "comment_id": 65938298, "body": "@awllower: well, that \u201cmonad in <b>Prof</b>\u201d stuff is another aspect of <code>Arrow</code>, the one you get from <code>arr</code>. However, I feel <code>arr</code> is foremostly a bit of a hack to get access to the simple isomorphisms you need for a cartesian monoidal category, without needing a whole bunch of methods (<code>(a,b)-&gt;(b,a)</code> and <code>((a,b),c)-&gt;(a,(b,c))</code>, etc.). An arrow is not \u201cdefined over a cartesian category\u201d, it <b>is</b> a CMC. \u2014 That&#39;s not to say the 2-category view as in the article you linked isn&#39;t valid \u2013 just, I don&#39;t see how this is useful, and fear it&#39;s somewhat responsible for the bad rep <code>Arrow</code> is getting."}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1469293736, "post_id": 38544394, "comment_id": 64480456, "body": "Thanks for the answer and this interesting website. :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1469294060, "post_id": 38544394, "comment_id": 64480561, "body": "Better use <code>liftA2</code> instead of <code>liftM2</code>, the latter is kinda deprecated since the AMP."}, {"owner": {"reputation": 3100, "user_id": 933616, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ac358baf891ce02fb4a686c1ad6b9ac4?s=128&d=identicon&r=PG", "display_name": "Benjamin Kovach", "link": "https://stackoverflow.com/users/933616/benjamin-kovach"}, "edited": false, "score": 0, "creation_date": 1469316145, "post_id": 38544394, "comment_id": 64486392, "body": "You can also use the <code>pointfree</code> command line utility (and optionally write bindings to integrate it into ghci sessions): <a href=\"https://hackage.haskell.org/package/pointfree\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pointfree</a>"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 3100, "user_id": 933616, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ac358baf891ce02fb4a686c1ad6b9ac4?s=128&d=identicon&r=PG", "display_name": "Benjamin Kovach", "link": "https://stackoverflow.com/users/933616/benjamin-kovach"}, "edited": false, "score": 0, "creation_date": 1469353045, "post_id": 38544394, "comment_id": 64492214, "body": "@BenjaminKovach I tried to <code>cabal install pointfree</code> butter some reason the package cannot be installed. It told me such modules as Plugin.Pl.Common cannot be found while those modules are in the correct position. So I guess I will make do with pointfree.io. Thanks for the suggestion. :)"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 3, "last_activity_date": 1469293649, "last_edit_date": 1495540863, "creation_date": 1469293649, "answer_id": 38544394, "question_id": 38543617, "link": "https://stackoverflow.com/questions/38543617/how-to-implement-f-g-x-h-x-point-freely-in-haskell/38544394#38544394", "title": "How to implement f (g x) (h x) point-freely in Haskell?", "body": "<p>As <a href=\"https://stackoverflow.com/users/1848654/melpomene\">melpomene</a> suggested, <code>\\x -&gt; f (g x) (h x)</code> is equivalent to <code>liftM2 f g h</code>.</p>\n\n<p>When you have question concerning how to convert Haskell code into pointfree Haskell code, you can just try <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">Pointfree.io</a>.</p>\n\n<p>It is a great tool which often can tell you when NOT to use pointfree code because it goes completely unreadable sometimes :-)</p>\n\n<p><a href=\"https://i.stack.imgur.com/2pJkq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2pJkq.png\" alt=\"enter image description here\"></a></p>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1469295479, "post_id": 38544433, "comment_id": 64481036, "body": "Thanks for the code. Now I shall try to learn some arrows as well. :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1469294143, "last_edit_date": 1469294143, "creation_date": 1469293820, "answer_id": 38544433, "question_id": 38543617, "link": "https://stackoverflow.com/questions/38543617/how-to-implement-f-g-x-h-x-point-freely-in-haskell/38544433#38544433", "title": "How to implement f (g x) (h x) point-freely in Haskell?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html\" rel=\"noreferrer\">arrow</a> version would be</p>\n\n<pre><code>uncurry f . (g &amp;&amp;&amp; h)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(g &amp;&amp;&amp; h) &gt;&gt;&gt; uncurry f\n</code></pre>\n\n<p>As a diagram:</p>\n\n<pre><code>        g \u2500\u2500\u2500\u2500\n       \u2571          \u2572\n\u2500\u2500\u2500\u2500 &amp;&amp;&amp;      &gt;&gt;&gt;  uncurry f \u2500\u2500\u2500\n       \u2572          \u2571\n        h \u2500\u2500\u2500\u2500 \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1472023711, "post_id": 38546047, "comment_id": 65580274, "body": "After a long time I finally got what this code says: <code>f &lt;$&gt; g &lt;*&gt; h</code>. I think it is no other than <code>ap (f . g) h</code>. In any case, thanks for such useful information."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 1, "creation_date": 1472053530, "post_id": 38546047, "comment_id": 65600991, "body": "@awllower check out the &quot;intuitions&quot; I posted here <a href=\"http://stackoverflow.com/a/34536499/260584\">stackoverflow.com/a/34536499/260584</a> which offer a straight-forward way to think about Applicative on functions. Note also that <code>&lt;$&gt;</code> is <code>.</code>, <code>&lt;*&gt;</code> is the Lambda Calculus combinator S, and <code>pure</code> is the combinator K (which is <code>const</code>)."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 2, "last_activity_date": 1469305262, "last_edit_date": 1469305262, "creation_date": 1469304850, "answer_id": 38546047, "question_id": 38543617, "link": "https://stackoverflow.com/questions/38543617/how-to-implement-f-g-x-h-x-point-freely-in-haskell/38546047#38546047", "title": "How to implement f (g x) (h x) point-freely in Haskell?", "body": "<p>Applicative-style</p>\n\n<pre><code>f &lt;$&gt; g &lt;*&gt; h\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/TypeCompose-0.9.11/docs/Control-Compose.html\" rel=\"nofollow\">Control.Compose</a></p>\n\n<pre><code>join ((g ~&gt; h ~&gt; id) f)\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/data-function-meld-0.1.1.0/docs/Data-Function-Meld.html\" rel=\"nofollow\">Data.Function.Meld</a></p>\n\n<pre><code>join (f $* g $$ h *$ id)\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/data-function-tacit-0.1.0.0/docs/Data-Function-Tacit.html\" rel=\"nofollow\">Data.Function.Tacit</a></p>\n\n<pre><code>lurryA @N1 (f &lt;$&gt; (g &lt;$&gt; _1) &lt;*&gt; (h &lt;$&gt; _1))\nlurryA @N4 (_1 &lt;*&gt; (_2 &lt;*&gt; _4) &lt;*&gt; (_3 &lt;*&gt; _4)) f g h\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "is_accepted": false, "score": 0, "last_activity_date": 1472024048, "last_edit_date": 1472024048, "creation_date": 1469359121, "answer_id": 38551459, "question_id": 38543617, "link": "https://stackoverflow.com/questions/38543617/how-to-implement-f-g-x-h-x-point-freely-in-haskell/38551459#38551459", "title": "How to implement f (g x) (h x) point-freely in Haskell?", "body": "<p>This only serves to collect and put into order the answers in the comments.\nAccording to the abstraction-elimination process in the link in the comment by @ PetrPudl\u00e1k, we can also write  </p>\n\n<pre><code>S (S (K f) (S (K g) I)) (S (K h) I),\n</code></pre>\n\n<p>or, after eta reduction,</p>\n\n<pre><code>S (S (K f) g) h,\n</code></pre>\n\n<p>where  </p>\n\n<pre><code>S x y z = x z (y z)\nK x y = x\n</code></pre>\n\n<p>Specifically in Haskell, thanks to @melpomene for pointing this out, the role of <code>S</code> is played by <code>ap</code>, and that of <code>K</code> by <code>const</code>. Therefore we can write </p>\n\n<pre><code>ap (ap (const f) g) h\n</code></pre>\n\n<p>In fact we can further reduce: </p>\n\n<pre><code>ap (const f) g = f . g\n</code></pre>\n\n<p>So our function can be written as:</p>\n\n<pre><code>ap (f . g) h\n</code></pre>\n\n<p>If translated to Applicative style, we obtain:</p>\n\n<pre><code>f &lt;$&gt; g &lt;*&gt; h\n</code></pre>\n\n<p>Then this systematic approach can be applied to all lambda terms, and gives the point-free style. :)</p>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 1, "accepted_answer_id": 38544394, "answer_count": 4, "score": 1, "last_activity_date": 1472024048, "creation_date": 1469289075, "last_edit_date": 1495542168, "question_id": 38543617, "link": "https://stackoverflow.com/questions/38543617/how-to-implement-f-g-x-h-x-point-freely-in-haskell", "title": "How to implement f (g x) (h x) point-freely in Haskell?", "body": "<p>From <a href=\"https://stackoverflow.com/questions/20279306/what-does-f-g-mean-in-haskell/20279307#20279307\">this answer</a> one learns how to implement the function <code>\\x y z -&gt; f x (g y z)</code> in a pointless way in Haskell, where <code>f</code> and <code>g</code> are functions. And my question is  </p>\n\n<blockquote>\n  <p>How to write the function <code>\\x -&gt; f (g x) (h x)</code> in a pointfree manner in Haskell? Here <code>f</code> <code>g</code> <code>h</code> are functions for which <code>f (g x) (h x)</code> is defined.</p>\n</blockquote>\n\n<p>The idea I currently have in mind is something like the following.</p>\n\n<pre><code>uncurry f (mapTuple ($ x) (g, h))\n</code></pre>\n\n<p>But several tries shows that this is fallacious; even the part <code>map ($ x) [g, h]</code> is suspicious: what if <code>g</code> and <code>h</code> have different ranges?</p>\n\n<p>In addition, readability is not too much an issue here.  </p>\n\n<p>Any help is sincerely appreciated.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "edited": false, "score": 1, "creation_date": 1469290232, "post_id": 38543596, "comment_id": 64479348, "body": "Try <code>pure 3</code> and <code>(pure :: Maybe Int -&gt; Maybe (Maybe Int)) $Just 3</code>. I think it&#39;s using the general case, and as <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/interactive-evaluation.html\" rel=\"nofollow noreferrer\">ghci tries to default to IO</a>, <code>pure (Just 5)</code> is evaluated as <code>IO (Maybe Int)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "edited": false, "score": 3, "creation_date": 1469294179, "post_id": 38543596, "comment_id": 64480599, "body": "The type of pure is <i>not</i> <code>m a -&gt; m (m a)</code> - so there is nothing to say that if the value <code>x</code> in <code>pure x</code> is already inside an <code>m</code>, that the <code>m</code> which pure creates would be the same <code>m</code>. As @Yosh stated, typing <code>pure ..</code> into the GHCi prompt will default the type of pure to <code>a -&gt; IO a</code> - if it weren&#39;t for defaulting this would produce an ambiguous type error when you tried to print it (as e.g. <code>pure ()</code> has type <code>Applicative f =&gt; f ()</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 46896, "user_id": 385273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eTnXA.png?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/385273/ben"}, "edited": false, "score": 0, "creation_date": 1469297065, "post_id": 38544738, "comment_id": 64481580, "body": "Correct presumption re: GHCI prompt, I should have mentioned that. Interesting that it takes the IO context, that was the part I was missing.  Thank you!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1469357372, "last_edit_date": 1469357372, "creation_date": 1469295620, "answer_id": 38544738, "question_id": 38543596, "link": "https://stackoverflow.com/questions/38543596/applicative-functors-pure-matching-not-wrapped/38544738#38544738", "title": "Applicative functors pure matching not wrapped", "body": "<p><code>pure</code> is an overloaded function. It takes a value of any type <code>a</code>, and wraps it up into an applicative functor <code>f</code>.</p>\n\n<pre><code>ghci&gt; :t pure\npure :: Applicative f =&gt; a -&gt; f a\n</code></pre>\n\n<p><code>f</code> is determined by the context. If you're passing <code>pure x</code> into a function which expects a <code>Maybe</code>, the type-checker will infer <code>f ~ Maybe</code> and select <code>Maybe</code>'s instance of <code>Applicative</code> and <code>pure x</code> will evaluate to <code>Just x</code>. Likewise, if you pass <code>pure x</code> into a function of lists, the type-checker will use <code>[]</code>'s instance of <code>Applicative</code> and <code>pure x</code> will return a singleton list.</p>\n\n<pre><code>ghci&gt; :t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]  -- map is a list function\nghci&gt; map (+1) (pure 4)        -- so when we pass in (pure 4)\n[5]                            -- it means a singleton list\n</code></pre>\n\n<p>In your case, I'm guessing that you're typing <code>pure x</code> at a GHCI prompt. If you don't provide any context (such as applying a list function to <code>pure x</code>), GHCI will default to assuming you meant to use <code>IO</code>'s instance of <code>Applicative</code>, for which <code>pure x</code> is a do-nothing <code>IO</code> action returning <code>x</code>. GHCI then dutifully executes that <code>IO</code> action.</p>\n\n<pre><code>ghci&gt; pure 'a'\n'a'\nghci&gt; pure (Just 3)\nJust 3\n</code></pre>\n\n<p>If the type-checker can't <em>see</em> the context based on your code, you can declare the context manually using a type annotation.</p>\n\n<pre><code>ghci&gt; pure \"hello\" :: Maybe String\nJust \"hello\"\nghci&gt; pure (Just 3) :: Maybe (Maybe Int)\nJust (Just 3)\nghci&gt; pure [1,2,3] :: [[Int]]\n[[1,2,3]]\n</code></pre>\n"}], "owner": {"reputation": 46896, "user_id": 385273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eTnXA.png?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/385273/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 38544738, "answer_count": 1, "score": 0, "last_activity_date": 1469357372, "creation_date": 1469288989, "last_edit_date": 1469290093, "question_id": 38543596, "link": "https://stackoverflow.com/questions/38543596/applicative-functors-pure-matching-not-wrapped", "title": "Applicative functors pure matching not wrapped", "body": "<p>I'm learning about applicative functors.  In the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-656\" rel=\"nofollow\">source</a> for an applicative <code>Maybe</code>, the <code>pure</code> function looks like this: </p>\n\n<pre><code>instance Applicative Maybe where\n    pure = Just\n    ...etc\n</code></pre>\n\n<p>With the arguments expanded, I think it looks like:</p>\n\n<pre><code>pure x = Just x\n</code></pre>\n\n<p>When I call <code>pure (Just 5)</code>, it returns <code>Just 5</code>.</p>\n\n<p>Shouldn't it return <code>Just (Just 5)</code>?</p>\n\n<p>Similarly, for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-739\" rel=\"nofollow\">List</a>:</p>\n\n<pre><code>instance Applicative [] where  \n    pure x = [x]\n</code></pre>\n\n<p>When I call <code>pure [4,5,6]</code> it returns <code>[4,5,6]</code>.</p>\n\n<p>From the signature, it looks like <code>pure [4,5,6]</code> should return <code>[[4,5,6]]</code>.</p>\n\n<p>Can someone explain in simple terms what's happening here?</p>\n\n<hr>\n\n<p>Wait, I think I got it - since there's no context provided, <code>pure [4,5,6]</code> is not using the <code>Applicative</code> for <code>List</code>, it's just using the general case and returning the same value.  Is this correct?</p>\n"}, {"tags": ["haskell", "tree", "abstract-syntax-tree", "catamorphism", "recursion-schemes"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1469286704, "post_id": 38542551, "comment_id": 64478334, "body": "From where are you getting your Fix?"}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1469287079, "post_id": 38542551, "comment_id": 64478444, "body": "<a href=\"https://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/recursion-schemes</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1469290538, "post_id": 38542551, "comment_id": 64479441, "body": "You probably want a zygohistomorphic prepromorphism. I have no idea what it does, but with a name like that, I can&#39;t imagine there is much it <i>can&#39;t</i> do. :)"}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 0, "creation_date": 1530363337, "post_id": 38542551, "comment_id": 89216437, "body": "In recursion-schemes Fix has instance for Eq1"}], "answers": [{"comments": [{"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1469295215, "post_id": 38543852, "comment_id": 64480946, "body": "Is it possible to write a polymorphic version of <code>eqExpr</code> like <code>cataZipWith :: Fix f -&gt; Fix f -&gt; (f a -&gt; f c -&gt; a) -&gt; a</code> ?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1469361203, "post_id": 38543852, "comment_id": 64494040, "body": "@Andr&#225;s Kov&#225;cs In the implementation of <code>eqExpr</code>, why are the catas/paras behind the pattern-matches necessary? Couldn&#39;t we pattern match directly on the second tree?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1469364065, "post_id": 38543852, "comment_id": 64494900, "body": "@danidiaz I took it that we can use only recursion schemes."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1469390731, "post_id": 38543852, "comment_id": 64503508, "body": "@danidiaz that&#39;s also against the spirit of <a href=\"http://maartenfokkinga.github.io/utwente/mmf91m.pdf\" rel=\"nofollow noreferrer\">bananas and lenses</a>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 6, "last_activity_date": 1469291800, "last_edit_date": 1469291800, "creation_date": 1469290559, "answer_id": 38543852, "question_id": 38542551, "link": "https://stackoverflow.com/questions/38542551/is-it-possible-to-compare-two-trees-with-recursion-schemes/38543852#38543852", "title": "Is it possible to compare two trees with recursion schemes?", "body": "<p>Recursion schemes that act on a single argument are enough, because we can return a function from a scheme application. In this case, we can return an <code>Expr -&gt; Bool</code> function from a scheme application on <code>Expr</code>. For efficient equality checking we only need paramorphisms:</p>\n\n<pre><code>{-# language DeriveFunctor, LambdaCase #-}\n\nnewtype Fix f = Fix (f (Fix f))\ndata ExprF r = Const Int | Add r r deriving (Functor, Show)\ntype Expr = Fix ExprF\n\ncata :: Functor f =&gt; (f a -&gt; a) -&gt; Fix f -&gt; a\ncata f = go where go (Fix ff) = f (go &lt;$&gt; ff)\n\npara :: Functor f =&gt; (f (Fix f, a) -&gt; a) -&gt; Fix f -&gt; a\npara f (Fix ff) = f ((\\x -&gt; (x, para f x)) &lt;$&gt; ff)\n\neqExpr :: Expr -&gt; Expr -&gt; Bool\neqExpr = cata $ \\case\n  Const i -&gt; cata $ \\case\n    Const i' -&gt; i == i'\n    _        -&gt; False\n  Add a b -&gt; para $ \\case\n    Add a' b' -&gt; a (fst a') &amp;&amp; b (fst b')\n    _         -&gt; False\n</code></pre>\n\n<p>Of course, <code>cata</code> is trivially implementable in terms of <code>para</code>:</p>\n\n<pre><code>cata' :: Functor f =&gt; (f a -&gt; a) -&gt; Fix f -&gt; a\ncata' f = para (\\ffa -&gt; f (snd &lt;$&gt; ffa)\n</code></pre>\n\n<p>Technically, almost all useful functions are implementable using <code>cata</code>, but they aren't necessarily efficient. We can implement <code>para</code> using <code>cata</code>:</p>\n\n<pre><code>para' :: Functor f =&gt; (f (Fix f, a) -&gt; a) -&gt; Fix f -&gt; a\npara' f = snd . cata (\\ffa -&gt; (Fix (fst &lt;$&gt; ffa) , f ffa))\n</code></pre>\n\n<p>However, if we use <code>para'</code> in <code>eqExpr</code> we get quadratic complexity, since <code>para'</code> is always linear in the size of the input, while we can use <code>para</code> to peek at the topmost <code>Expr</code> values in constant time. </p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1469362288, "last_edit_date": 1469362288, "creation_date": 1469356541, "answer_id": 38551092, "question_id": 38542551, "link": "https://stackoverflow.com/questions/38542551/is-it-possible-to-compare-two-trees-with-recursion-schemes/38551092#38551092", "title": "Is it possible to compare two trees with recursion schemes?", "body": "<p>(This response uses the <strong>data-fix</strong> library because I couldn't get <strong>recursion-schemes</strong> to compile.)</p>\n\n<p>We can model the diff of two trees as an anamorphism or unfolding of a \"diff functor\" that is based on the original functor.</p>\n\n<p>Consider the following types</p>\n\n<pre><code>data DiffF func r = Diff (Fix func) (Fix func) \n                  | Nodiff (func r)\n                  deriving (Functor)\n\ntype ExprDiff = Fix (DiffF ExprF) \n</code></pre>\n\n<p>The idea is that <code>ExprDiff</code> will follow the \"common structure\" of the original <code>Expr</code> trees as long as it remains equal, but at the moment a difference is encountered, we switch to the <code>Diff</code> leaf, that stores the two subtrees that we found to be different.</p>\n\n<p>The actual comparison function would be:</p>\n\n<pre><code>diffExpr ::  Expr -&gt; Expr -&gt; ExprDiff  \ndiffExpr e1 e2 = ana comparison (e1,e2)\n    where\n    comparison :: (Expr,Expr) -&gt; DiffF ExprF (Expr,Expr)\n    comparison (Fix (Const i),Fix (Const i')) | i == i' = \n        Nodiff (Const i')\n    comparison (Fix (Add a1 a2),Fix (Add a1' a2')) = \n        Nodiff (Add (a1,a1') (a2,a2'))\n    comparison (something, otherthing) = \n        Diff something otherthing\n</code></pre>\n\n<p>The \"seed\" of the anamorphism is the pair of expressions we want to compare.</p>\n\n<p>If we simply want a predicate <code>Expr -&gt; Expr -&gt; Bool</code> we can later use a catamorphism that detects the presence of <code>Diff</code> branches.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 4, "answer_count": 2, "score": 11, "last_activity_date": 1473953641, "creation_date": 1469282116, "last_edit_date": 1473953641, "question_id": 38542551, "link": "https://stackoverflow.com/questions/38542551/is-it-possible-to-compare-two-trees-with-recursion-schemes", "title": "Is it possible to compare two trees with recursion schemes?", "body": "<p>I have this AST</p>\n\n<pre><code>data ExprF r = Const Int | Add   r r\ntype Expr = Fix ExprF\n</code></pre>\n\n<p>and I want to compare </p>\n\n<pre><code>x = Fix $ Add (Fix (Const 1)) (Fix (Const 1))\ny = Fix $ Add (Fix (Const 1)) (Fix (Const 2))\n</code></pre>\n\n<p>But all recursion schemes functions seems to work only with single structure</p>\n\n<p>Obviously I can use recursion</p>\n\n<pre><code>eq (Fix (Const x)) (Fix (Const y)) = x == y\neq (Fix (Add x1 y1)) (Fix (Add x2 y2)) = (eq x1 x2) &amp;&amp; (eq y1 y2)\neq _ _ = False\n</code></pre>\n\n<p>But I hope it is possible to use some sort of zipfold function.</p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 41648, "user_id": 108359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8a34d29224f05cd8bd1f480c89cf112?s=128&d=identicon&r=PG", "display_name": "Brian McKenna", "link": "https://stackoverflow.com/users/108359/brian-mckenna"}, "edited": false, "score": 4, "creation_date": 1469269093, "post_id": 38540138, "comment_id": 64473805, "body": "It&#39;s possible to do &quot;id @String&quot; in GHC 8.0: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/TypeApplication</a>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1469276306, "post_id": 38540138, "comment_id": 64475704, "body": "<code>mapM (asTypeOf &quot;&quot;.fromSql.(!!1)) res</code> -- unless you have <code>XOverloadedStrings</code> on."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1469282149, "post_id": 38540138, "comment_id": 64477194, "body": "Are you sure <code>mapM (fromSql.(!!1)) res</code> isn&#39;t sufficient, or <code>mapM ((fromSql.(!!1)) :: a -&gt; String) res</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 1, "creation_date": 1469267457, "post_id": 38540201, "comment_id": 64473429, "body": "!!1 does not mean head, since it gets the second element not the first. I don&#39;t mean identity, I just want a type hint to stop getting ambiguous type error."}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 0, "creation_date": 1469267714, "post_id": 38540201, "comment_id": 64473484, "body": "Yes I got the point: if we have a identity function with concrete type, we can use it like a type hint. But is there any other way except defining it again?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1469280481, "post_id": 38540201, "comment_id": 64476760, "body": "This seems like much too much work to simply give a type annotation.. the type of the expression <code>mapM ... res</code> can itself be specified and from this type inference is likely to find the correct type for <code>fromSql</code>. Alternatively one can write <code>fromSQL :: _ -&gt; String</code> (with -XPartialTypeSignatures)"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1469351594, "post_id": 38540201, "comment_id": 64491899, "body": "Removed my off-by-one mistake about <code>!!1</code>."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 1, "last_activity_date": 1469351583, "last_edit_date": 1469351583, "creation_date": 1469266027, "answer_id": 38540201, "question_id": 38540138, "link": "https://stackoverflow.com/questions/38540138/what-is-the-equivalent-function-in-haskell/38540201#38540201", "title": "What is the &quot;::&quot; equivalent function in Haskell?", "body": "<p><code>::String</code> is not an operator in the sense of python\u2019s <code>string(\u2026)</code>, but a type annotation, and as such, special syntactic rules apply.</p>\n\n<p>You can, however, define function</p>\n\n<pre><code>asString :: String -&gt; String\nasString x = x\n</code></pre>\n\n<p>and then write</p>\n\n<pre><code>mapM (asString.fromSql.(!!1)) res\n</code></pre>\n\n<p>@augustss once <a href=\"http://augustss.blogspot.de/2014/04/a-small-haskell-extension.html\" rel=\"nofollow\">proposed a language extension</a> that would allow <code>(::String)</code> to be used, but I cannot find it right now.)</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1469353750, "creation_date": 1469353750, "answer_id": 38550727, "question_id": 38540138, "link": "https://stackoverflow.com/questions/38540138/what-is-the-equivalent-function-in-haskell/38550727#38550727", "title": "What is the &quot;::&quot; equivalent function in Haskell?", "body": "<p>As chepner commented, it really shouldn't be necessary to give any type hint at all: all you need is</p>\n\n<pre><code>   mapM (fromSql . (!!1)) res\n</code></pre>\n\n<p>...that is, provided you actually <em>use</em> the result in some way. (If you don't use the result, then why do you do this in the first place?)</p>\n\n<p>The reason being: unlike Python, Haskell has a proper Hindley-Milner type system, and this can infer types in any direction<sup>\u2020</sup> and any context. So if you write just, for instance,</p>\n\n<pre><code> do\n   sqlStrs &lt;- mapM (fromSql . (!!1)) res\n   ...\n   mapM_ putStrLn sqlStr\n</code></pre>\n\n<p>then this is enough for the compiler to infer that <code>sqlStrs :: [String]</code> and hence <code>fromSql</code> must be restricted to yield <code>String</code>.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>There are some exceptions, but these arise only with the monomorphism restriction (which only applies to global definitions, not to something bound in a monad, and can also be turned off) or when using extensions like GADTs, ExistentialQuantification or RankNTypes.</sub></p>\n"}], "owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1469353750, "creation_date": 1469265445, "question_id": 38540138, "link": "https://stackoverflow.com/questions/38540138/what-is-the-equivalent-function-in-haskell", "title": "What is the &quot;::&quot; equivalent function in Haskell?", "body": "<p>In Python, we have a built-in package, named \"operator\", with which we can use function version of any operator. It is highly used when using \"functional Programming\" functions like map and reduce, and is much better recommended than using \"lambda\".</p>\n\n<p>I have the same problem in Haskell: I want t user mapM somewhere with a composition of many functions but I have to use not-so-pretty lambda:</p>\n\n<pre><code>mapM ((\\x-&gt;x::String).fromSql.(!!1)) res\n</code></pre>\n\n<p>Is there any equivalent to that liek this:</p>\n\n<pre><code>mapM (someFunc(String).fromSql.(!!1)) res\n</code></pre>\n"}, {"tags": ["haskell", "syntax", "dollar-sign"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1469249023, "post_id": 38538207, "comment_id": 64469590, "body": "The <code>($)</code> function is indeed an ordinary Haskell function, but it\u2019s also an infix operator, as are all functions whose names are entirely symbolic. Infix operators have special partial application syntax called <i>operator sections</i>, and you can read more about them here: <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">wiki.haskell.org/Section_of_an_infix_operator</a>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469268090, "post_id": 38538207, "comment_id": 64473566, "body": "@Alexis King, <a href=\"http://www.mail-archive.com/glasgow-haskell-users@haskell.org/msg18923.html\" rel=\"nofollow noreferrer\">not so ordinary</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1469301254, "post_id": 38538207, "comment_id": 64482882, "body": "@user3237465 I\u2019m actually quite aware of that, yes, but bringing that up to a learner is only going to cause entirely unnecessary confusion."}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 4387633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/660d81d3b8db8c747abf9e5863f141c3?s=128&d=identicon&r=PG&f=1", "display_name": "MD05", "link": "https://stackoverflow.com/users/4387633/md05"}, "edited": false, "score": 0, "creation_date": 1478910490, "post_id": 38538290, "comment_id": 68354295, "body": "If (3 $) then what would be the case ? I think it would not produce any result.  Use with map (3$) [\\x-&gt;x+10] , right ?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 315, "user_id": 4387633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/660d81d3b8db8c747abf9e5863f141c3?s=128&d=identicon&r=PG&f=1", "display_name": "MD05", "link": "https://stackoverflow.com/users/4387633/md05"}, "edited": false, "score": 1, "creation_date": 1478910841, "post_id": 38538290, "comment_id": 68354381, "body": "<code>(3 $)</code> won&#39;t typecheck. <code>$</code> expects its first argument to be a function."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1469249406, "creation_date": 1469249406, "answer_id": 38538290, "question_id": 38538207, "link": "https://stackoverflow.com/questions/38538207/is-a-function-in-haskell/38538290#38538290", "title": "Is &#39;$&#39; a function in haskell?", "body": "<p>Well <code>($)</code> is an operator, which is an infix function. It's definition is pretty straightforward (in fact the only thing that makes it interesting is its <em>fixity</em>, and I'm sure google has tons of resources on that):</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\nf $ x = f x\n</code></pre>\n\n<p>Like all operators, you can take <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\"><em>sections</em></a> of it by applying only the first or only the second argument. This might be more obvious with the addition <code>(+)</code> operator:</p>\n\n<pre><code>(+ 2) -- equivalent to \\x -&gt; x + 2\n(2 +) -- equivalent to \\x -&gt; 2 + x\n</code></pre>\n\n<p>The same holds for <code>($ 3)</code> - it is equivalent to <code>\\f -&gt; f $ 3</code>. The type of this function should be pretty clear then: its argument <code>f</code> has to be itself a function that takes a number and returns something else (<code>f :: Num a =&gt; a -&gt; b</code>), and the whole function returns the same type as whatever <code>f</code> returns. That gives</p>\n\n<pre><code>(\\f -&gt; f $ 3) :: Num a =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>And consequently <code>($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b</code>.</p>\n"}], "owner": {"reputation": 89, "user_id": 5142098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MLI6j.png?s=128&g=1", "display_name": "septicmk", "link": "https://stackoverflow.com/users/5142098/septicmk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "closed_date": 1469276413, "accepted_answer_id": 38538290, "answer_count": 1, "score": 0, "last_activity_date": 1469249406, "creation_date": 1469248581, "question_id": 38538207, "link": "https://stackoverflow.com/questions/38538207/is-a-function-in-haskell", "closed_reason": "Duplicate", "title": "Is &#39;$&#39; a function in haskell?", "body": "<p>I am quite confused about ($) in haskell.  </p>\n\n<p>when I type</p>\n\n<pre><code>:t ($)\n</code></pre>\n\n<p>in ghci. I will get</p>\n\n<pre><code>:($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>but, when I type </p>\n\n<pre><code>:t ($ 3)\n</code></pre>\n\n<p>I will get</p>\n\n<pre><code>($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>so, why ($) accept the second argument without any error\uff1f</p>\n"}, {"tags": ["haskell", "functional-programming", "ghc", "ghci", "ambiguous-type-variable"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1469206973, "post_id": 38531803, "comment_id": 64457504, "body": "Try &quot;:t map(\\x -&gt; (x, div 18 x)) [y | y &lt;- [1..(ceiling $ sqrt 18)], 18 <code>rem</code> y == 0]&quot; on GHCi to find out the inferred type."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1469208093, "post_id": 38531803, "comment_id": 64458026, "body": "You should reconsider your type signature. Can you name a type that is both <code>Floating</code> and <code>Integral</code>?   I suggest you make the function monomorphic, ex use <code>Double</code>, and generalize only when needed."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469208987, "post_id": 38531803, "comment_id": 64458462, "body": "@ThomasM.DuBuisson I was actually thinking about that for fun: is there ever any <i>reasonable</i> type that is both <code>Floating</code> and <code>Integral</code>? Also, is there a way of searching for types based on instances the way we can use hoogle or hayoo to search for functions based on types?"}, {"owner": {"reputation": 4934, "user_id": 2612547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/CWjSG.png?s=128&g=1", "display_name": "CSharper", "link": "https://stackoverflow.com/users/2612547/csharper"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469209516, "post_id": 38531803, "comment_id": 64458727, "body": "@ThomasM.DuBuisson I arrived at that type signature by not declaring one, and  then calling :t factorPairs. Can you elaborate what you mean by making it monomorphic. Changing the constraint to simply Double doesn&#39;t compile"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469230019, "post_id": 38531803, "comment_id": 64466679, "body": "Indeed, it doesn&#39;t compile.  That leaves you with another step before it functions and a type error that helps direct where to look."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1469217597, "last_edit_date": 1469217597, "creation_date": 1469212791, "answer_id": 38533300, "question_id": 38531803, "link": "https://stackoverflow.com/questions/38531803/ambiguous-type-variable-a0-arising-from-a-use-of-it/38533300#38533300", "title": "Ambiguous type variable `a0&#39; arising from a use of `it&#39;", "body": "<p>This has to do with the fact numeric literals are overloaded in Haskell. When you type <code>map(\\x -&gt; (x, div 18 x)) [y | y &lt;- [1..(ceiling $ sqrt 18)], 18 `rem` y == 0]</code> into <code>ghci</code>, the <code>18</code> that is an argument to <code>sqrt</code> defaults to a <code>Double</code> and the others to <code>Integer</code>s.</p>\n\n<p>However, when you write</p>\n\n<pre><code>factorPairs:: (RealFrac a, Floating a, Integral a) =&gt; a -&gt; [(a, a)]\nfactorPairs n = map(\\x -&gt; (x, div n x)) [y | y &lt;- [1..(ceiling $ sqrt n)], n `rem` y == 0]\n</code></pre>\n\n<p>you force all instances of <code>n</code> to have only one type. Then, the problem becomes that there simply are no default number types (in fact number types in general I think) that satisfy all of these constraints, hence GHC telling you about \"possible instances\" it tries. The solution is to add <code>fromIntegral</code> and loosen the constraints:</p>\n\n<pre><code>factorPairs:: Integral a =&gt; a -&gt; [(a, a)]\nfactorPairs n = map(\\x -&gt; (x, div n x)) [y | y &lt;- [1..(ceiling $ sqrt $ fromIntegral n)], n `rem` y == 0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1469221597, "last_edit_date": 1469221597, "creation_date": 1469221207, "answer_id": 38535151, "question_id": 38531803, "link": "https://stackoverflow.com/questions/38531803/ambiguous-type-variable-a0-arising-from-a-use-of-it/38535151#38535151", "title": "Ambiguous type variable `a0&#39; arising from a use of `it&#39;", "body": "<p>Another way to get rid of the type error is to eliminate the use of <code>sqrt</code>. Since Haskell is lazy, you can simply iterate over <code>[1..n]</code>, stopping when your divisor is greater than your quotient.</p>\n\n<pre><code>factorPairs :: Integral a =&gt; a -&gt; [(a, a)]\nfactorPairs n = takeWhile (uncurry (&gt;=)) [ (n `div` d, d) | d &lt;- [1..n], n `mod` d == 0]\n</code></pre>\n\n<p><code>uncurry (&gt;=)</code> is just a fancy way of writing <code>\\(q, d) -&gt; q &gt;= d</code>.</p>\n\n<p>If you write this in monadic form, you can use <code>divMod</code> to get the quotient and the remainder with a single function all.</p>\n\n<pre><code>factorPairs n = takeWhile (uncurry (&gt;=)) $ do\n                d &lt;- [1..n]\n                let (q, r) = n `divMod` d\n                guard $ r == 0\n                return (q, d)\n</code></pre>\n"}], "owner": {"reputation": 4934, "user_id": 2612547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/CWjSG.png?s=128&g=1", "display_name": "CSharper", "link": "https://stackoverflow.com/users/2612547/csharper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9226, "favorite_count": 0, "accepted_answer_id": 38533300, "answer_count": 2, "score": 7, "last_activity_date": 1602239718, "creation_date": 1469206741, "last_edit_date": 1602239718, "question_id": 38531803, "link": "https://stackoverflow.com/questions/38531803/ambiguous-type-variable-a0-arising-from-a-use-of-it", "title": "Ambiguous type variable `a0&#39; arising from a use of `it&#39;", "body": "<p>I have the following function to return the Factor Pairs for a given number</p>\n\n<pre><code>factorPairs:: (RealFrac a, Floating a, Integral a) =&gt; a -&gt; [(a, a)]\nfactorPairs n = map(\\x -&gt; (x, div n x)) [y | y &lt;- [1..(ceiling $ sqrt n)], n `rem` y == 0]\n</code></pre>\n\n<p>When I call the function in ghci <code>factorPairs 18</code> I'm getting a run time error of </p>\n\n<pre><code>   * Ambiguous type variable `a0' arising from a use of `it'\n      prevents the constraint `(Floating a0)' from being solved.\n      Probable fix: use a type annotation to specify what `a0' should be.\n      These potential instances exist:\n        instance Floating Double -- Defined in `GHC.Float'\n        instance Floating Float -- Defined in `GHC.Float'\n    * In the first argument of `print', namely `it'\n      In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I can hard code the function in ghci </p>\n\n<p><code>map(\\x -&gt; (x, div 18 x)) [y | y &lt;- [1..(ceiling $ sqrt 18)], 18 `rem` y == 0]</code>\n and don't have any issues but I can't seem to figure out why my function is failing. I believe ghci is trying to tell me it can't figure out what type to call <code>print</code> with but am struggling to find the solution.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1469222605, "post_id": 38529887, "comment_id": 64464596, "body": "Give your expression a name; e.g. <code>import Data.List; result = group &quot;aaaabbbbbbbccddd&quot;</code>. Then you will be able to load your file in <code>ghci</code>. If you want to compile, the easiest will be to also provide a <code>main</code>, such as <code>main = print result</code>."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469208167, "post_id": 38529996, "comment_id": 64458061, "body": "Noice <code>testGroup = group</code> so it&#39;s rather redundant."}, {"owner": {"reputation": 886, "user_id": 1960460, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/95a40f8966f56994e4bee9a2e39b8e75?s=128&d=identicon&r=PG", "display_name": "joaquinlpereyra", "link": "https://stackoverflow.com/users/1960460/joaquinlpereyra"}, "edited": false, "score": 0, "creation_date": 1469208962, "post_id": 38529996, "comment_id": 64458446, "body": "It totally is, I just wanted to show what a &#39;naked expression&#39; was meant, although this maybe wasn&#39;t the best way. Most probably, if you just want to test group, you&#39;ll do it just in GHCI"}], "tags": [], "owner": {"reputation": 886, "user_id": 1960460, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/95a40f8966f56994e4bee9a2e39b8e75?s=128&d=identicon&r=PG", "display_name": "joaquinlpereyra", "link": "https://stackoverflow.com/users/1960460/joaquinlpereyra"}, "is_accepted": false, "score": 6, "last_activity_date": 1469200560, "creation_date": 1469200560, "answer_id": 38529996, "question_id": 38529887, "link": "https://stackoverflow.com/questions/38529887/having-trouble-using-haskell-group/38529996#38529996", "title": "Having trouble using Haskell group", "body": "<p>You can use it in GHCI just fine, exactly as you're importing it in the text file. </p>\n\n<pre><code>Prelude&gt; import Data.List\nPrelude Data.List&gt; group \"aaaaabbbbbbcccccddd\"\n[\"aaaaa\",\"bbbbbb\",\"ccccc\",\"ddd\"]\n</code></pre>\n\n<p>Naked expression at top level means exactly that: you can't have a naked expression at top level. Try this in a text file.</p>\n\n<pre><code>import Data.List\n\ntestGroup :: (Eq a) =&gt; [a] -&gt; [[a]]\ntestGroup lst = group lst\n</code></pre>\n\n<p>That will work wonders.</p>\n\n<pre><code>~/temp \u276f\u276f\u276f ghci h.hs\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( h.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; testGroup [2]\n[[2]]\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1572823954, "creation_date": 1469200257, "question_id": 38529887, "link": "https://stackoverflow.com/questions/38529887/having-trouble-using-haskell-group", "title": "Having trouble using Haskell group", "body": "<p>I am studying Haskell in advance for next semester and I am stuck testing <strong>group</strong>. I tried directly in <strong>WinGHCi</strong> and writing a function in a text file. Reading documentation (haskell.org, zvon.org) I see that the module <strong>Data.List</strong> is required so I did the following in <strong>WinGHCi</strong>:</p>\n\n<pre><code>:l Data.List\n</code></pre>\n\n<p>But I get an error: <em>: module \u2018Data.List\u2019 is a package module</em></p>\n\n<p>Then, I wrote a function using a text editor as follows:</p>\n\n<pre><code>import Data.List\ngroup \"aaaabbbbbbbccddd\"\n</code></pre>\n\n<p>I get an error again when loading (compiling): </p>\n\n<pre><code>_Haskell.hs:2:1:\nParse error: naked expression at top level\nPerhaps you intended to use TemplateHaskell_\n</code></pre>\n\n<p>I am a complete beginner in functional programming. I will very much appreciate your help to fix my issue.</p>\n\n<p>Best regards.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1469218352, "post_id": 38529586, "comment_id": 64462868, "body": "You should include the error message in the future. It makes it a lot easier and faster to figure out what&#39;s going on."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 0, "last_activity_date": 1469200454, "creation_date": 1469200454, "answer_id": 38529955, "question_id": 38529586, "link": "https://stackoverflow.com/questions/38529586/make-network-instance-of-vectorspace/38529955#38529955", "title": "make network instance of vectorSpace", "body": "<p>The error comes from the fact that being able to declare <code>type</code> in a class and instance is not standard Haskell, it is part of the <a href=\"https://wiki.haskell.org/GHC/Type_families#Associated_type_instances_2\" rel=\"nofollow\">type families extension</a>. Getting rid of that error isn't tough, you just have to add the following language pragma at the top of your file:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n</code></pre>\n\n<p>However, then you might have a problem with the fact that you haven't defined <code>zeroV</code> or <code>negateV</code> in your <code>AdditiveGroup</code> instance. I'm not sure how you will define those... You may even get away without defining them (you'll get warnings though, and something may crash at runtime).</p>\n"}], "owner": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 38529955, "answer_count": 1, "score": 0, "last_activity_date": 1469200454, "creation_date": 1469199428, "last_edit_date": 1495541690, "question_id": 38529586, "link": "https://stackoverflow.com/questions/38529586/make-network-instance-of-vectorspace", "title": "make network instance of vectorSpace", "body": "<p>This is a follow up question to this <a href=\"https://stackoverflow.com/questions/38510132/make-matrix-double-vector-double-an-instance-of-num\">question</a>. Somebody suggested there that it would make more sense to make the type network an instance of vectorSpace. </p>\n\n<pre><code>newtype Network = Network [( Matrix Double, Vector Double)]\n\ninstance AdditiveGroup Network where\n  (Network n1) ^+^ (Network n2) = Network $ zipWith (\\(m,v) (n,w) -&gt; (m+n,v+w)) n1 n2\n  (Network n1) ^-^ (Network n2) = Network $ zipWith (\\(m,v) (n,w) -&gt; (m-n,v-w)) n1 n2\n\ninstance VectorSpace Network where\n  type Scalar Network = Double\n  lambda *^ (Network n) = Network $ map (\\ (m,v) -&gt; (lambda*m,lambda*v)) n\n</code></pre>\n\n<p>But when I try to compile I get an error saying that i wrote an illegal instance for 'Scalar'.\nCould somebody explain me what I did wrong?</p>\n"}, {"tags": ["haskell", "generics", "serialization"], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469200216, "post_id": 38529436, "comment_id": 64453606, "body": "Thanks for your quick answer. I&#39;ve tried to derive Generic, but I&#39;m getting the following error:      Expected kind \u2018(* -&gt; <i>) -&gt; GHC.Prim.Constraint\u2019,       but \u2018Generic\u2019 has kind \u2018(</i> -&gt; *) -&gt; *\u2019     In the data declaration for \u2018Trans\u2019`"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469200656, "post_id": 38529436, "comment_id": 64453907, "body": "What does the data definition for <code>Trans</code> look like by the way?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469201234, "post_id": 38529436, "comment_id": 64454316, "body": "@SalvadorTamarit Actually, even a link to library documentation would be helpful..."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469201260, "post_id": 38529436, "comment_id": 64454336, "body": "TrasState: <a href=\"https://gist.github.com/tamarit/4673818ba86d35b9a73875fe2e222c75\" rel=\"nofollow noreferrer\">gist.github.com/tamarit/4673818ba86d35b9a73875fe2e222c75</a> Library: <a href=\"https://hackage.haskell.org/package/language-c\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/language-c</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469202055, "post_id": 38529436, "comment_id": 64454840, "body": "What was the original language c data type you were trying to derive? I can&#39;t seem to find where <code>TransState</code> is defined as it isn&#39;t publicly exposed."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469441623, "post_id": 38529436, "comment_id": 64520082, "body": "I&#39;ve added more code to the gist that I think are needed to understand the type. <code>TranState</code>is a type defined in &#39;Language.C`."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469456302, "post_id": 38529436, "comment_id": 64529937, "body": "@SalvadorTamarit I&#39;ve done part of the work for you. Next time, please try to add more information in your post, or a minimal example to debug - otherwise it won&#39;t be too useful to the next person who stumbles onto this question from Google. :)"}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469475574, "post_id": 38529436, "comment_id": 64541337, "body": "Thanks a lot for your help @Alec. I&#39;m still having and error when compiling which is similar to the one above: <code>The first argument of \u2018Generic\u2019 should have kind \u2018*\u2019,       but \u2018Binary a\u2019 has kind \u2018GHC.Prim.Constraint\u2019     In the stand-alone deriving instance for       \u2018Binary a =&gt; Generic (Binary a)\u2019</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469476200, "post_id": 38529436, "comment_id": 64541669, "body": "Oops! There was a typo in the very last line. :) My copy-pasting go the better of me."}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469486163, "post_id": 38529436, "comment_id": 64545897, "body": "Perfect @Alec. Thanks! I&#39;ve added similar instances for almost all the types in the world ;)  But there are one that I don&#39;t know if it&#39;s possible to be derived. It is Position.      <code>Can&#39;t make a derived instance of \u2018GHCG.Generic Position\u2019:       The data constructors of \u2018Position\u2019 are not all in scope         so you cannot derive an instance for it     In the stand-alone deriving instance for \u2018GHCG.Generic Position\u2019</code>  I want/need to work with the library as it is, so change it and recompile is not an alternative. I wonder if this solution has found a unbridgeable pitfall :P"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 0, "creation_date": 1469488678, "post_id": 38529436, "comment_id": 64546718, "body": "@SalvadorTamarit Let me know if this works, and please accept the answer. :)"}, {"owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "edited": false, "score": 1, "creation_date": 1469539993, "post_id": 38529436, "comment_id": 64570936, "body": "Yes!! It works. :) Thank you very much @Alec. I wouldn&#39;t do it without your help."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1469488595, "last_edit_date": 1469488595, "creation_date": 1469199036, "answer_id": 38529436, "question_id": 38529144, "link": "https://stackoverflow.com/questions/38529144/how-to-serialize-a-data-structure-which-is-instance-of-data/38529436#38529436", "title": "How to serialize a data structure which is instance of Data?", "body": "<p>You could use <a href=\"https://hackage.haskell.org/package/binary-0.8.4.0/docs/Data-Binary.html\" rel=\"nofollow\"><code>Data.Binary</code></a>. </p>\n\n<p>Derive <code>Generic</code> for all data types involved. This will require the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XDeriveGeneric\" rel=\"nofollow\"><code>-XDeriveGeneric</code></a> pragma. If the data types from the external libraries you are using don't do this, you might have to have a module of <a href=\"https://wiki.haskell.org/Orphan_instance\" rel=\"nofollow\">orphan instances</a> and use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#stand-alone-deriving-declarations\" rel=\"nofollow\"><code>-XStandaloneDeriving</code></a>.</p>\n\n<p>Once that is done, you can use the fact that the <code>Binary</code> class already has support for deriving from <code>Generic</code>. You'll need to enable <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XDeriveAnyClass\" rel=\"nofollow\"><code>-XDeriveAnyclass</code></a> and then you can add <code>Binary</code> instances for all data types involved (you might again have to have standalone instances for types from the external library).</p>\n\n<h1>EDIT</h1>\n\n<p>The <a href=\"https://gist.github.com/tamarit/4673818ba86d35b9a73875fe2e222c75\" rel=\"nofollow\">OP added a gist</a>. Then, to get this to compile, we need to add the following language pragmas:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable,\n             DeriveAnyClass,\n             DeriveGeneric,\n             StandaloneDeriving #-}\n</code></pre>\n\n<p>And the following imports:</p>\n\n<pre><code>import Language.C.Syntax.AST\nimport Language.C.Data.Position\nimport Language.C.Data.Node\nimport Language.C.Data.Name\nimport Language.C.Data.Ident\nimport Language.C.Syntax.Constants\n\nimport Data.Data\nimport GHC.Generics\nimport Data.Binary\n</code></pre>\n\n<p>From the OPs gist:</p>\n\n<pre><code>type CTypeSpecAnn = CTypeSpecifier NodeAnn \ntype CDeclAnn = CDeclaration NodeAnn\ntype CDeclSpecAnn = CDeclarationSpecifier NodeAnn\ntype CDeclrAnn = CDeclarator NodeAnn\ntype CStatAnn = CStatement NodeAnn\ntype CExtDeclAnn = CExternalDeclaration NodeAnn\ntype CExprAnn = CExpression NodeAnn\ntype CBlockItemAnn = CCompoundBlockItem NodeAnn\ntype CTranslUnitAnn = CTranslationUnit NodeAnn\n\ndata TransState = \n    TransState \n    {\n        free_node_id :: Int,\n        freeVar :: Int,\n        includes :: [String],\n        fun_defs :: [(String, (CTypeSpecAnn, [CDeclAnn], ([CDeclSpecAnn], CDeclrAnn, [CDeclAnn], NodeAnn)), CStatAnn)],\n        no_fun_defs :: [CExtDeclAnn],\n        last_changed :: String,\n        previous_changes :: ([(String, ((String,CStatAnn,CStatAnn), TransState, [(String, CStatAnn)]))], [(String, ((String,CExprAnn,CExprAnn), TransState, [(String, CStatAnn)]))]),\n        applied_rules :: [String],\n        applicable_rules :: Set String,\n        trans_with_anns :: Bool\n    }\n    deriving (Show, Data, Typeable)\n\ntype NodeAnn = Annotation NodeInfo NodeProperties\ndata Annotation nI nP = Ann nI nP\n    deriving (Show, Data, Typeable, Eq)\n\ndata NodeProperties = \n    NodeProperties\n    { \n        _hasSideEffects :: PropertyInfo Bool,\n        _readIn ::  PropertyInfo [String],\n        _writeIn ::  PropertyInfo [String],\n        _localSymbols :: PropertyInfo [String],\n        _rangeInfo :: PropertyInfo [String],\n        _isCanonical :: PropertyInfo Bool,\n        _isPerfectNest :: PropertyInfo Bool,\n        _hasLoops :: PropertyInfo Bool,\n        _hasFunctionCalls :: PropertyInfo Bool,\n        _hasControlFlowModifiers :: PropertyInfo Bool,\n        _scalarDependences :: PropertyInfo [String],\n        _polcaPragmas :: PropertyInfo [[String]],\n        _allPragmas :: PropertyInfo [String]\n    } \n    deriving (Show, Data, Typeable, Eq)\n\ndata PropertyInfo a = \n    PropertyInfo\n    { \n        _pragmaType :: PragmaType,\n        _definedBy  :: DefinerType,\n        _value :: Maybe a\n    } \n    deriving (Show, Data, Typeable, Eq)\n\nmakeLenses ''NodeProperties\nmakeLenses ''PropertyInfo\n</code></pre>\n\n<p>Since OP never defines <code>PragmaType</code> and <code>DefinerType</code>, I'm assuming they are <code>()</code>.</p>\n\n<pre><code>type PragmaType = ()\ntype DefinerType = ()\n</code></pre>\n\n<p>Then we have a ton of <code>deriving instance</code> (we have to recursively find all type dependencies and add <code>Generic</code> and <code>Binary</code> to them).</p>\n\n<pre><code>deriving instance Generic (CDeclaration a)\nderiving instance Binary a =&gt; Binary (CDeclaration a)\nderiving instance Generic (CTypeSpecifier a)\nderiving instance Binary a =&gt; Binary (CTypeSpecifier a)\nderiving instance Generic (CDeclarationSpecifier a)\nderiving instance Binary a =&gt; Binary (CDeclarationSpecifier a)\nderiving instance Generic (CDeclarator a)\nderiving instance Binary a =&gt; Binary (CDeclarator a)\nderiving instance Generic (CStatement a)\nderiving instance Binary a =&gt; Binary (CStatement a)\nderiving instance Generic (CExternalDeclaration a)\nderiving instance Binary a =&gt; Binary (CExternalDeclaration a)\nderiving instance Generic (CExpression a)\nderiving instance Binary a =&gt; Binary (CExpression a)\nderiving instance Generic (CCompoundBlockItem a)\nderiving instance Binary a =&gt; Binary (CCompoundBlockItem a)\nderiving instance Generic (CTranslationUnit a)\nderiving instance Binary a =&gt; Binary (CTranslationUnit a)\nderiving instance Generic (CInitializer a)\nderiving instance Binary a =&gt; Binary (CInitializer a)\nderiving instance Generic (CStructureUnion a)\nderiving instance Binary a =&gt; Binary (CStructureUnion a)\nderiving instance Generic (CTypeQualifier a)\nderiving instance Binary a =&gt; Binary (CTypeQualifier a)\nderiving instance Generic (CStringLiteral a)\nderiving instance Binary a =&gt; Binary (CStringLiteral a)\nderiving instance Generic (CAttribute a)\nderiving instance Binary a =&gt; Binary (CAttribute a)\nderiving instance Generic (CPartDesignator a)\nderiving instance Binary a =&gt; Binary (CPartDesignator a)\nderiving instance Generic (CFunctionDef a)\nderiving instance Binary a =&gt; Binary (CFunctionDef a)\nderiving instance Generic (CAssemblyStatement a)\nderiving instance Binary a =&gt; Binary (CAssemblyStatement a)\nderiving instance Generic (CAssemblyOperand a)\nderiving instance Binary a =&gt; Binary (CAssemblyOperand a)\nderiving instance Generic (CConstant a)\nderiving instance Binary a =&gt; Binary (CConstant a)\nderiving instance Generic (CEnumeration a)\nderiving instance Binary a =&gt; Binary (CEnumeration a)\nderiving instance Generic (CStorageSpecifier a)\nderiving instance Binary a =&gt; Binary (CStorageSpecifier a)\nderiving instance Generic (CDerivedDeclarator a)\nderiving instance Binary a =&gt; Binary (CDerivedDeclarator a)\nderiving instance Generic (CBuiltinThing a)\nderiving instance Binary a =&gt; Binary (CBuiltinThing a)\nderiving instance Generic (CArraySize a)\nderiving instance Binary a =&gt; Binary (CArraySize a)\nderiving instance Generic (Flags a)\nderiving instance Binary a =&gt; Binary (Flags a)\nderiving instance Generic NodeInfo\nderiving instance Binary NodeInfo\nderiving instance Generic Name\nderiving instance Binary Name\nderiving instance Generic Ident\nderiving instance Binary Ident\nderiving instance Generic CString\nderiving instance Binary CString\nderiving instance Generic CStructTag\nderiving instance Binary CStructTag\nderiving instance Generic CFloat\nderiving instance Binary CFloat\nderiving instance Generic CChar\nderiving instance Binary CChar\nderiving instance Generic CUnaryOp\nderiving instance Binary CUnaryOp\nderiving instance Generic CBinaryOp\nderiving instance Binary CBinaryOp\nderiving instance Generic CInteger\nderiving instance Binary CInteger\nderiving instance Generic CAssignOp\nderiving instance Binary CAssignOp\nderiving instance Generic CIntFlag\nderiving instance Binary CIntFlag\nderiving instance Generic CIntRepr\nderiving instance Binary CIntRepr\n\nderiving instance Binary TransState\nderiving instance Generic TransState\nderiving instance Generic (Annotation a b)\nderiving instance (Binary a, Binary b) =&gt; Binary (Annotation a b)\nderiving instance Generic NodeProperties\nderiving instance Binary NodeProperties\nderiving instance Generic (PropertyInfo a)\nderiving instance Binary a =&gt; Binary (PropertyInfo a)\n</code></pre>\n\n<p>As a side note, the second half of those instances could be declared in the data declaration of the types themselves (since those are declared in the current file). The one sticking point is that we still don't have a <code>Binary</code> instance for <code>Position</code>. We can't derive it automatically since its data constructors haven't been exported. However, nothing is stopping us from writing a manual <code>Binary</code> instance.</p>\n\n<pre><code>instance Binary Position where\n    put p | isNoPos p = putWord8 0 \n          | isBuiltinPos p = putWord8 1\n          | isInternalPos p = putWord8 2\n          | isSourcePos p = putWord8 3 &gt;&gt; put (posOffset p) &gt;&gt; put (posFile p) &gt;&gt; put (posRow p) &gt;&gt; put (posColumn p)\n\n    get = do\n        marker &lt;- getWord8\n        case marker of\n            0 -&gt; return nopos\n            1 -&gt; return builtinPos\n            2 -&gt; return internalPos\n            3 -&gt; position &lt;$&gt; get &lt;*&gt; get &lt;*&gt; get &lt;*&gt; get\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 4162959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-e0huN4x2igA/AAAAAAAAAAI/AAAAAAAAAJU/YGUl-V6Gjy0/photo.jpg?sz=128", "display_name": "Salvador Tamarit", "link": "https://stackoverflow.com/users/4162959/salvador-tamarit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "accepted_answer_id": 38529436, "answer_count": 1, "score": 3, "last_activity_date": 1469488595, "creation_date": 1469198153, "question_id": 38529144, "link": "https://stackoverflow.com/questions/38529144/how-to-serialize-a-data-structure-which-is-instance-of-data", "title": "How to serialize a data structure which is instance of Data?", "body": "<p>I want to serialize a data structure which is partially defined by my own, and partially is using data structures that come from an external library (which is an instance of Data). I wanted to do the serialization without having to define how the serialization process should work, or in other words, in a rather automatic way.</p>\n\n<p>I've been trying several alternatives I've found by googling/asking. None of them was successful. Library (<a href=\"https://hackage.haskell.org/package/genericserialize\" rel=\"nofollow\">genericserialize</a>) seemed what I was looking for. Unfortunately, it does not work even for simple cases (like (True, False)). It is probably outdated or/and incomplete. Binary serialization requires that the external data structure derives Binary (which it does not). With <a href=\"https://hackage.haskell.org/package/cereal\" rel=\"nofollow\">Cereal</a> similar problems arise. Of course, it is Read/Show, but again, the external data structure does not derive Read, so it neither can be used.</p>\n\n<p>Maybe I'm misunderstanding something. I thought when I first faced this problem it would be easier. In other languages, like Erlang for instance, this is done in a very simple way. </p>\n\n<p>Do you know libraries/techniques or whatever to make this process as simple as possible? </p>\n"}, {"tags": ["postgresql", "haskell", "persistent", "jsonb"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469197828, "post_id": 38526721, "comment_id": 64451966, "body": "Possibly a related issue: <a href=\"https://github.com/yesodweb/persistent/issues/585\" rel=\"nofollow noreferrer\">github.com/yesodweb/persistent/issues/585</a>"}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469211712, "post_id": 38526721, "comment_id": 64459762, "body": "@Sibi: I&#39;m not sure about that. I can change the <code>sqltype</code> to <code>json</code> (or omit it) and it makes no difference. According to a comment in following link, lists should be converted to JSON: <a href=\"https://github.com/yesodweb/persistent/issues/358#issuecomment-73907728\" rel=\"nofollow noreferrer\">github.com/yesodweb/persistent/issues/358#issuecomment-73907&zwnj;&#8203;728</a> . I&#39;m probably missing something..."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469214096, "post_id": 38526721, "comment_id": 64460923, "body": "Can you share your <code>persistent</code> model file which has the schema definition ?"}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469273009, "post_id": 38526721, "comment_id": 64474821, "body": "@Sibi: What exactly do you want to see? I edited the question and added the <code>mkPersist</code> declaration. This is the entire schema I have in my test. I then just try to get all rows with <code>select $ from return</code> (using <code>Esqueleto</code>)."}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1469272751, "creation_date": 1469191275, "last_edit_date": 1469272751, "question_id": 38526721, "link": "https://stackoverflow.com/questions/38526721/persistent-list-field-not-working-with-postgresqls-jsonb", "title": "Persistent: List field not working with PostgreSQL&#39;s JSONB", "body": "<p>I'm using <code>persistent</code>/<code>persistent-postgresql</code> together with Liquibase for database migrations (= with an already existing database). I have following table:</p>\n\n<pre><code>mkPersist sqlSettings { mpsGeneric=False } [persistLowerCase|\nEntry sql=entries\n    keywords [T.Text] sqltype=jsonb\n|]\n</code></pre>\n\n<p>I thought persistent would automatically handle the list by (de)serialising it from/to JSON. Unfortunately a select throws following exception:</p>\n\n<pre><code>Exception: PersistMarshalError \"field keywords: Expected PersistList, received: PersistByteString \\\"[\\\\\\\"english\\\\\\\"]\\\"\"\n</code></pre>\n\n<p>Why doesn't it parse the column as a JSON list?</p>\n"}, {"tags": ["function", "parsing", "haskell", "types"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1469187276, "post_id": 38524999, "comment_id": 64445099, "body": "Well, you ignore it when shoiwng, so what do you want to fill the function value with when reading?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469187305, "post_id": 38524999, "comment_id": 64445117, "body": "Usually I would use a <code>String -&gt; String -&gt; Activation -&gt; Layer</code> function to do that. But what have you tried, what errors are you receiving? Can you build a simple function that &quot;reads&quot; a <code>String</code> and creates a <code>[Double]</code>, then you might find <code>Vector.fromList</code> useful."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469187403, "post_id": 38524999, "comment_id": 64445183, "body": "note that this <code>readLayer</code> is different from the usual <code>Read</code> instance!"}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469188065, "post_id": 38524999, "comment_id": 64445598, "body": "I think this question really just boils down to &#39;how can I define a <code>Read</code> instance by hand?&#39;. Once you know that I&#39;m sure you can figure it out."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469189588, "post_id": 38524999, "comment_id": 64446537, "body": "@PaulVisschers I don&#39;t think so <code>read :: String -&gt; Layer</code> which is not that simple (you would need something non trivial to parse the activation function)"}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469190072, "post_id": 38524999, "comment_id": 64446818, "body": "@epsilonhalbe: Well he wouldn&#39;t actually make an instance of <code>Read</code>, but knowing how to do it would allow him to then make <code>readLayer</code> pretty easily."}, {"owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "reply_to_user": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469251289, "post_id": 38524999, "comment_id": 64469940, "body": "@PaulVisschers @epsilonhalbe: I actually wanted to know if this is at all possible with a <code>Read</code> instance, but it seems not."}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469272132, "post_id": 38524999, "comment_id": 64474576, "body": "@MahdiDibaiee Not if you want to provide a function when reading, because the type of such a function is necessarily different from the <code>read</code>  function."}, {"owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "reply_to_user": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1469274865, "post_id": 38524999, "comment_id": 64475340, "body": "@PaulVisschers Yes, I understand. Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469189372, "post_id": 38526014, "comment_id": 64446389, "body": "or if you are using the LANGUAGE pragma <code>{-# LANGUAGE RecordWildCards #-}</code>, you can write    <code>readLayer str activation = let (biases, nodes) = read str in Layer{..}</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469201447, "post_id": 38526014, "comment_id": 64454449, "body": "I think it&#39;s better to be stricter here. While defining such a partial function for parsing input is always problematic, it&#39;s generally best to at least make it fail early."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469229184, "post_id": 38526014, "comment_id": 64466508, "body": "@dfeuer is this a comment towards my remark or a general one, I don&#39;t see in which way my solution is less strict than the original one. Wouldn&#39;t the strictness annotation in the type evaluate biases/nodes automatically?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469289937, "post_id": 38526014, "comment_id": 64479262, "body": "@epsilonhalbe, you&#39;re absolutely right. I missed those annotations."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1469189145, "creation_date": 1469189145, "answer_id": 38526014, "question_id": 38524999, "link": "https://stackoverflow.com/questions/38524999/show-and-read-instance-for-a-datatype-with-functions/38526014#38526014", "title": "Show and Read instance for a datatype with functions", "body": "<p>Because of the way you chosen to show a Layer you can just do this:</p>\n\n<pre><code>readLayer str f =\n  let (biases, nodes) = read str\n  in Layer { biases = biases, nodes = nodes, activation = f }\n</code></pre>\n\n<p>That is, your show instance for a Layer is the same as the show instance for (Vector Double, Matrix Double).</p>\n\n<p>Things would get more complicated if that weren't the case.</p>\n"}], "owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 38526014, "answer_count": 1, "score": 0, "last_activity_date": 1469189145, "creation_date": 1469185890, "question_id": 38524999, "link": "https://stackoverflow.com/questions/38524999/show-and-read-instance-for-a-datatype-with-functions", "title": "Show and Read instance for a datatype with functions", "body": "<p>I have a datatype which includes a function value and I want to be able to <code>show</code> and <code>read</code> it. I know that I can't read the function back, so I want a way to specify the function on reading.</p>\n\n<p>Here is my datatype:</p>\n\n<pre><code>  type Activation = (Vector Double -&gt; Vector Double, Vector Double -&gt; Vector Double)\n\n  data Layer = L { biases     :: !(Vector Double)\n                 , nodes      :: !(Matrix Double)\n                 , activation :: Activation\n                 }\n\n  instance Show Layer where\n    show (L biases nodes _) = \"(\" ++ show biases ++ \",\" ++ show nodes ++ \")\"\n</code></pre>\n\n<p>And I want a function like this:</p>\n\n<pre><code>readLayer :: String -&gt; Activation -&gt; Layer\n</code></pre>\n\n<p>How would that work?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "dynamic", "casting"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1469232580, "post_id": 38521481, "comment_id": 64467182, "body": "I&#39;m curious as to your use-case here. Why are you working with <code>Dynamic</code> in the first place?"}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1469236504, "post_id": 38521481, "comment_id": 64467785, "body": "@BenjaminHodgson I&#39;m working on an interpreter for an object-oriented language, and want to allow embedding of arbitrary Haskell values into its own value type to allow object methods implemented as Haskell code to store whatever values they need in the objects of the target language."}], "answers": [{"comments": [{"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1469191844, "post_id": 38525386, "comment_id": 64447967, "body": "Looking over the cases I&#39;m going to need to use this, I think your easier approach of using a wrapper is probably the best way, but thanks for all the ideas. :)"}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1470260965, "post_id": 38525386, "comment_id": 64882274, "body": "I actually decided in the end to go a rather different route.  The result is now <a href=\"http://hackage.haskell.org/package/constrained-dynamic\" rel=\"nofollow noreferrer\">up on hackage</a>."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 3, "last_activity_date": 1469187110, "creation_date": 1469187110, "answer_id": 38525386, "question_id": 38521481, "link": "https://stackoverflow.com/questions/38521481/haskell-dynamic-typerep-extract-instance-of-a-typeclass-without-knowing-the-ful/38525386#38525386", "title": "Haskell Dynamic/TypeRep: extract instance of a typeclass without knowing the full type?", "body": "<p>It's not possible to check if a type is an instance of something at runtime. One of the reasons is that importing a module could bring in new instances and that would change the result of the function (this would be very bad for Haskell).</p>\n\n<p>You can go though a list of known types. The idea is you store the type along with the instances for that type in a <code>GADT</code> and match on it to get the instances you want. I'm not exactly sure what you want but I think it's something like this:</p>\n\n<pre><code>data EqShow where\n  JustEq :: (Typeable a, Eq a)         =&gt; Proxy a -&gt; EqShow\n  EqShow :: (Typeable a, Eq a, Show a) =&gt; Proxy a -&gt; EqShow\n</code></pre>\n\n<p>There's a version for types that only have <code>Eq</code> and one that have both <code>Eq</code> and <code>Show</code>. The idea is we can match on these if the types match and use the <code>Eq</code> instance to check if they're equal. If a <code>Show</code> instance is available we can show the results too. To store multiple EqShows I've used a hash map so we can lookup the types. Here's the full code:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nimport           Data.Dynamic\nimport           Data.Typeable\nimport           Data.HashMap.Lazy (HashMap)\nimport qualified Data.HashMap.Lazy as HM\n\ndata EqShow where\n  JustEq :: (Typeable a, Eq a)         =&gt; Proxy a -&gt; EqShow\n  EqShow :: (Typeable a, Eq a, Show a) =&gt; Proxy a -&gt; EqShow\n\njustEq :: (Typeable a, Eq a) =&gt; Proxy a -&gt; (TypeRep, EqShow)\njustEq p = (typeRep p, JustEq p)\n\neqShow :: (Typeable a, Eq a, Show a) =&gt; Proxy a -&gt; (TypeRep, EqShow)\neqShow p = (typeRep p, EqShow p)\n\n-- | Different outcomes of testing equality.\ndata Result\n  = DifferentType TypeRep TypeRep\n  | NotEq TypeRep (Maybe (String, String))\n  | IsEq TypeRep (Maybe String)\n  | UnknownType TypeRep\n  deriving Show\n\n-- | Check if two Dynamics are equal. Show them if possible\ndynEq :: HashMap TypeRep EqShow -&gt; Dynamic -&gt; Dynamic -&gt; Result\ndynEq hm da db\n  | ta /= tb  = DifferentType ta tb\n  | otherwise =\n      case HM.lookup ta hm of\n        Just (EqShow p) -&gt; checkEqShow p (fromDynamic da) (fromDynamic db)\n        Just (JustEq p) -&gt; checkJustEq p (fromDynamic da) (fromDynamic db)\n        Nothing         -&gt; UnknownType ta\n  where\n    ta = dynTypeRep da\n    tb = dynTypeRep db\n\n    -- Check if two results are equal and display them.\n    checkEqShow :: (Typeable a, Eq a, Show a) =&gt; Proxy a -&gt; Maybe a -&gt; Maybe a -&gt; Result\n    checkEqShow _ (Just a) (Just b)\n      | a == b    = IsEq ta (Just (show a))\n      | otherwise = NotEq ta (Just (show a, show b))\n    checkEqShow _ _ _ = UnknownType ta\n\n    -- Check if two results are equal without displaying them.\n    checkJustEq :: (Typeable a, Eq a) =&gt; Proxy a -&gt; Maybe a -&gt; Maybe a -&gt; Result\n    checkJustEq p (Just a) (Just b)\n      | a == b    = IsEq ta Nothing\n      | otherwise = NotEq ta Nothing\n    checkJustEq p _ _ = UnknownType ta\n</code></pre>\n\n<p>You can them make a list of known types:</p>\n\n<pre><code>knownEqShows :: HashMap TypeRep EqShow\nknownEqShows = HM.fromList\n  [ eqShow (Proxy :: Proxy Int)\n  , eqShow (Proxy :: Proxy Char)\n  ]\n</code></pre>\n\n<p>and check them:</p>\n\n<pre><code>&gt; let a = toDyn 'a'\n&gt; let b = toDyn 'b'\n&gt; let c = toDyn (1 :: Int)\n&gt; dynEq knownEqShows a a\nIsEq Char (Just \"'a'\")\n&gt; dynEq knownEqShows a b\nNotEq Char (Just (\"'a'\",\"'b'\"))\n&gt; dynEq knownEqShows a c\nDifferentType Char Int\n</code></pre>\n\n<p>Generating known <code>EqShow</code>s using template haskell would be difficult. You might be able to make a version for types without variables (<code>Double</code>, <code>Char</code> etc.) But if you have a variable (<code>Maybe a</code> for instance) you wouldn't be able to store this in EqShow, you'd have to write all versions of it (<code>Maybe Int</code>, <code>Maybe (Maybe Double)</code> etc.) but there's an infinite number of these.</p>\n\n<hr>\n\n<p>Of course it would be much easier instead of using <code>Dynamic</code> to use another wrapper (is possible):</p>\n\n<pre><code>data EqShowDynamic where\n  JustEqD :: (Typeable a, Eq a)         =&gt; a -&gt; EqShowDynamic\n  EqShowD :: (Typeable a, Eq a, Show a) =&gt; a -&gt; EqShowDynamic\n</code></pre>\n\n<p>So the <code>Eq</code> and <code>Show</code> instances are already there.</p>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 38525386, "answer_count": 1, "score": 1, "last_activity_date": 1469187110, "creation_date": 1469175381, "last_edit_date": 1469183878, "question_id": 38521481, "link": "https://stackoverflow.com/questions/38521481/haskell-dynamic-typerep-extract-instance-of-a-typeclass-without-knowing-the-ful", "title": "Haskell Dynamic/TypeRep: extract instance of a typeclass without knowing the full type?", "body": "<p>If I have a <code>TypeRep</code> for a type or a <code>Dynamic</code> containing an instance of that type, is there any way I can find the appropriate instance of a known typeclass to enable me to call a function on that typeclass without needing to know the full type in question?  If there isn't such a feature, is there a reason it would be impossible, or has it just not been implemented?</p>\n\n<p>Alternatively, is there a way (perhaps using template haskell) to run through a generated list of all types with instances of a typeclass so that I can perform a dynamic cast on each and check the results?  </p>\n\n<p>What I'm trying to do is implement <code>Eq</code> and a version of <code>Show</code> that actually displays the data for <code>Dynamic</code> (whenever possible) for the purposes of writing simpler and more generally useful unit tests; I don't really need high performance for this so using generated code that runs through all the possibilities would be acceptable.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1469147896, "creation_date": 1469147896, "answer_id": 38516448, "question_id": 38516417, "link": "https://stackoverflow.com/questions/38516417/function-elem-is-throwing-errors/38516448#38516448", "title": "Function elem is throwing errors", "body": "<p>The four arguments you are passing are <code>0</code>, <code>map</code>, <code>mod x</code> and <code>[3.. (x-1)]</code>. You intended to pass <code>mod x</code> and <code>[3.. (x-1)]</code> as arguments to <code>map</code> and then pass the result as the second argument to <code>elem</code>, but there's no way for Haskell to know that without parentheses or <code>$</code>. So to make your code work add them:</p>\n\n<pre><code>isNotPrime x = elem 0 (map (mod x) [3.. (x-1)])\n-- or\nisNotPrime x = elem 0 $ map (mod x) [3.. (x-1)]\n</code></pre>\n\n<p>Or you can use infix notation, in which case precedence rules (prefix function application binds tighter than any infix operator) removes the need for parentheses:</p>\n\n<pre><code>isNotPrime x = 0 `elem` map (mod x) [3.. (x-1)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 8, "last_activity_date": 1469147932, "last_edit_date": 1495540733, "creation_date": 1469147932, "answer_id": 38516449, "question_id": 38516417, "link": "https://stackoverflow.com/questions/38516417/function-elem-is-throwing-errors/38516449#38516449", "title": "Function elem is throwing errors", "body": "<p>You <em>are</em> passing four arguments to the <code>elem</code> function. Function application always associates left, so the expression</p>\n\n<pre><code>f a b c d\n</code></pre>\n\n<p>is parsed like this:</p>\n\n<pre><code>((((f a) b) c) d)\n</code></pre>\n\n<p>Therefore, your example is getting parsed like this:</p>\n\n<pre><code>((((elem 0) map) (mod x)) [3.. (x-1)])\n</code></pre>\n\n<p>That is, <code>elem</code> is being \u201capplied to four arguments\u201d, but of course all Haskell functions are actually just functions of one argument, just curried. What you <em>actually</em> want is a different grouping, so you just need to add some parentheses:</p>\n\n<pre><code>elem 0 (map (mod x) [3.. (x-1)])\n</code></pre>\n\n<p>Alternatively, you could <a href=\"https://stackoverflow.com/questions/19521246/what-does-mean-do-in-haskell\">use <code>$</code> to avoid writing the parentheses</a>:</p>\n\n<pre><code>elem 0 $ map (mod x) [3.. (x-1)]\n</code></pre>\n\n<p>Or you could write <code>elem</code> infix, which is a common idiom in Haskell. Like <code>$</code>, this will also change the precedence to be what you want:</p>\n\n<pre><code>0 `elem` map (mod x) [3.. (x-1)]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4485349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb80a60f2df68818d180357fbff4123e?s=128&d=identicon&r=PG&f=1", "display_name": "rt88", "link": "https://stackoverflow.com/users/4485349/rt88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 38516449, "answer_count": 2, "score": 1, "last_activity_date": 1469147932, "creation_date": 1469147633, "question_id": 38516417, "link": "https://stackoverflow.com/questions/38516417/function-elem-is-throwing-errors", "title": "Function elem is throwing errors", "body": "<p>My Haskell code is as follows</p>\n\n<pre><code>isNotPrime x = elem 0 map (mod x)[3.. (x-1)]    \n</code></pre>\n\n<p>When compiled it shows these errors</p>\n\n<pre><code>  Couldn't match expected type \u2018(t1 -&gt; t1) -&gt; [t1] -&gt; t\u2019\n              with actual type \u2018Bool\u2019\n  The function \u2018elem\u2019 is applied to four arguments,\n  but its type \u2018([a0] -&gt; [b0])\n                -&gt; ((a0 -&gt; b0) -&gt; [a0] -&gt; [b0]) -&gt; Bool\u2019\n  has only two\n  In the expression: elem 0 map (mod x) [3 .. (x - 1)]\n  In an equation for \u2018prime\u2019:\n      prime x = elem 0 map (mod x) [3 .. (x - 1)]\n</code></pre>\n\n<p>My understanding is that elem accepts two arguments, I do not understand how am I passing 4 arguments in the above code as the map function should just return a list.</p>\n"}, {"tags": ["mysql", "haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469197931, "post_id": 38515593, "comment_id": 64452039, "body": "IMO, <a href=\"https://www.stackage.org/package/persistent-mysql\" rel=\"nofollow noreferrer\">persistent-mysql</a>, is a better library."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469198861, "post_id": 38515593, "comment_id": 64452703, "body": "@sibi thanks, but this is the same problem. It requires <code>mysql_config</code>. I don&#39;t know how to get this working on a windows machine"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1469222352, "post_id": 38515593, "comment_id": 64464513, "body": "This may help you: <a href=\"https://github.com/bos/mysql/issues/3\" rel=\"nofollow noreferrer\">github.com/bos/mysql/issues/3</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1469153373, "post_id": 38516970, "comment_id": 64430657, "body": "do you mean any mysql client?"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1469153533, "post_id": 38516970, "comment_id": 64430686, "body": "Hm... I mean, mysql client of mysql(oracle)"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1469153644, "post_id": 38516970, "comment_id": 64430705, "body": "I am sorry I don&#39;t know what you mean. Do you mean MySQL Workbench? I am on mysql.com trying to find <code>mysql client</code> ?"}, {"owner": {"reputation": 1758, "user_id": 8724882, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d88f8198fb4ae68267aced911e3533f9?s=128&d=identicon&r=PG&f=1", "display_name": "sandwood", "link": "https://stackoverflow.com/users/8724882/sandwood"}, "edited": false, "score": 0, "creation_date": 1511877804, "post_id": 38516970, "comment_id": 82023422, "body": "It seems that on windows the mysql_config is a perl script called &quot;mysql_config.pl&quot; located under MySQL\\MySQL Server X.Y\\bin   But the link posted in the comments of the question shows that there is no straight forward solution to have the build accepting the perl script instead of an executable."}], "tags": [], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "is_accepted": false, "score": 1, "last_activity_date": 1469152206, "creation_date": 1469152206, "answer_id": 38516970, "question_id": 38515593, "link": "https://stackoverflow.com/questions/38515593/mysql-with-haskell-on-windows/38516970#38516970", "title": "MySQL with Haskell on Windows", "body": "<p>Did you install mysql client?</p>\n\n<p>If you didn't, install mysql client first.</p>\n\n<p>If you did, then check whether <code>mysql_config --version</code> prints version or not in cmd.</p>\n\n<p>When above command didn't work, find the <strong>mysql_config</strong> program and add it to your path environment variable.</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1469152206, "creation_date": 1469141390, "question_id": 38515593, "link": "https://stackoverflow.com/questions/38515593/mysql-with-haskell-on-windows", "title": "MySQL with Haskell on Windows", "body": "<p>I am trying to connect to a MySQL database with haskell. I have tried to install <code>hdbc-mysql</code> and <code>mysql-simple</code> but I get a </p>\n\n<p><code>setup.exe: The program 'mysql_config' is required but it could not be found</code></p>\n\n<p>Can anyone please help with getting either of those installed or point me to an alternative that works.</p>\n\n<p>I am on windows 10.</p>\n"}, {"tags": ["haskell", "pipe", "haskell-pipes"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1469147816, "post_id": 38515213, "comment_id": 64429424, "body": "Matter of preference, but I&#39;d probably have <code>process :: (MonadState CState m, MonadIO m) =&gt; Pipe Item Item m ()</code>. Not much code change (probably), more readable, and abstracts away the implementation details of your monad stack."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1469148694, "creation_date": 1469148694, "answer_id": 38516554, "question_id": 38515213, "link": "https://stackoverflow.com/questions/38515213/haskell-pipes-having-a-pipe-consume-what-it-yields-itself/38516554#38516554", "title": "Haskell Pipes -- Having a pipe consume what it yields (itself)", "body": "<p>I would do it like this:</p>\n\n<pre><code>import Pipes\n\ntype Url = String\n\ngetLinks :: Url -&gt; IO [Url]\ngetLinks = undefined\n\ncrawl :: MonadIO m =&gt; Pipe Url Url m a\ncrawl = loop []\n  where\n    loop [] = do url &lt;- await; loop [url]\n    loop (url:urls) = do\n      yield url\n      urls' &lt;- liftIO $ getLinks url\n      loop (urls ++ urls')\n</code></pre>\n\n<p>You can achieve DFS or BFS depending on how you combine <code>url'</code> with <code>urls</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1469217815, "last_edit_date": 1469217815, "creation_date": 1469149191, "answer_id": 38516623, "question_id": 38515213, "link": "https://stackoverflow.com/questions/38515213/haskell-pipes-having-a-pipe-consume-what-it-yields-itself/38516623#38516623", "title": "Haskell Pipes -- Having a pipe consume what it yields (itself)", "body": "<p>You can connect a <code>Pipe a b m r</code> to a side-effect through the <code>m</code> parameter, which swaps out which <code>Monad</code> the pipe is operating over. You can use this to requeue links by connecting the downstream end of your pipe to another pipe that sticks the links in a queue and connecting the upstream end of your pipe to a pipe that reads links from the queue.</p>\n\n<p>Our goal is to write</p>\n\n<pre><code>import Pipes\n\nloopLeft :: Monad m =&gt; Pipe (Either l a) (Either l b) m r -&gt; Pipe a b m r\n</code></pre>\n\n<p>We'll take a pipe whose downstream output, <code>Either l b</code>, is either an <code>Left l</code> to send back upstream or a <code>Right b</code> to send downstream, and send the <code>l</code>s back in the upstream input <code>Either l a</code>, which is either a queued up <code>Left l</code> or a <code>Right a</code> coming from upstream. We'll connect the <code>Left l</code>s together to make a pipe that only sees <code>a</code>s coming from upstream and only yields <code>b</code>s headed downstream.</p>\n\n<p>At the downstream end we'll push the <code>l</code>s from <code>Left l</code> onto a stack. We <code>yield</code> the <code>r</code>s from <code>Right r</code> downstream.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.State\n\npushLeft :: Monad m =&gt; Pipe (Either l a) a (StateT [l] m) r\npushLeft = forever $ do\n    o &lt;- await\n    case o of\n        Right a -&gt; yield a\n        Left l -&gt; do\n            stack &lt;- lift get\n            lift $ put (l : stack)\n</code></pre>\n\n<p>At the upstream end we'll look for something on top of the stack to <code>yield</code>. If there isn't one, we'll <code>await</code> for a value from upstream and <code>yield</code> it.</p>\n\n<pre><code>popLeft :: Monad m =&gt; Pipe a (Either l a) (StateT [l] m) r\npopLeft = forever $ do\n    stack &lt;- lift get\n    case stack of\n        [] -&gt; await &gt;&gt;= yield . Right\n        (x : xs) -&gt; do\n            lift $ put xs\n            yield (Left x)\n</code></pre>\n\n<p>Now we can write <code>loopLeft</code>. We compose the upstream and downstream pipes together with pipe composition <code>popLeft &gt;-&gt; hoist lift p &gt;-&gt; pushLeft</code>. The <code>hoist lift</code> turns a <code>Pipe a b m r</code> into a <code>Pipe a b (t m) r</code>. The <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Lift.html#v:distribute\" rel=\"nofollow\"><code>distribute</code></a> turns a <code>Pipe a b (t m) r</code> into a <code>t (Pipe a b m) r</code>. To get back to a <code>Pipe a b m r</code> we run the whole <code>StateT</code> computation starting with an empty stack <code>[]</code>. In <code>Pipes.Lift</code> there's a nice name <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Lift.html#v:evalStateP\" rel=\"nofollow\"><code>evalStateP</code></a> for the combination of <code>evalStateT</code> and <code>distribute</code>.</p>\n\n<pre><code>import Pipes.Lift\n\nloopLeft :: Monad m =&gt; Pipe (Either l a) (Either l b) m r -&gt; Pipe a b m r\nloopLeft p = flip evalStateT [] . distribute $ popLeft &gt;-&gt; hoist lift p &gt;-&gt; pushLeft\n</code></pre>\n"}], "owner": {"reputation": 765, "user_id": 1055947, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/84cfa26c8f86bc5d9eecca08ff9c8c45?s=128&d=identicon&r=PG", "display_name": "user1055947", "link": "https://stackoverflow.com/users/1055947/user1055947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 2, "accepted_answer_id": 38516623, "answer_count": 2, "score": 3, "last_activity_date": 1469217815, "creation_date": 1469139223, "question_id": 38515213, "link": "https://stackoverflow.com/questions/38515213/haskell-pipes-having-a-pipe-consume-what-it-yields-itself", "title": "Haskell Pipes -- Having a pipe consume what it yields (itself)", "body": "<p>I'm trying to write a webscraper using Pipes and I've come to the part of following scraped links. I have a <code>process</code> function that downloads a url, finds links, and yields them.</p>\n\n<pre><code>process :: Pipe Item Item (StateT CState IO) ()\n ....\n    for (each links) yield\n ....\n</code></pre>\n\n<p>Now I want to some how recursively follow these links, threading the StateT through. I realize there is probably doing something more idiomatic then using a single pipe for the bulk of the scraper (especially as I start adding more features), I'm open for suggestions. I'm probably going to have to rethink the design when I consider multithreading w/ shared state anyways.</p>\n"}, {"tags": ["unit-testing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1469135308, "post_id": 38513276, "comment_id": 64425801, "body": "To compare an <code>Either e a</code> value both <code>e</code> and <code>a</code> should be instances of <code>Eq</code> as per definition of <code>Eq</code> for <code>Either</code>: <code>instance (Eq e, Eq a) =&gt; Eq (Either e a) where ...</code>, because there is no way for compler to know that you will have only <code>Right</code>s if type is <code>Either</code>. Parsec is not designed to check its error messages at all, as you can see. If you want to work with error messages, use <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a> (disclaimer: I&#39;m its author). There is also <a href=\"https://hackage.haskell.org/package/hspec-megaparsec\" rel=\"nofollow noreferrer\"><code>hspec-megaparsec</code></a> for what it&#39;s worth."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1469136530, "post_id": 38513276, "comment_id": 64426340, "body": "Instead of comparing <code>parse ... @?= Right ...</code>, you should first check the result of the parse is not <code>Left</code>, then compare the values directly (without first wrapping in <code>Right</code>). A simple way to do this in this case is <code>either (const $ assertFailure &quot;...&quot;) (@?= (LabelInLabelType ...)) (parse ...)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "is_accepted": false, "score": 2, "last_activity_date": 1469212360, "creation_date": 1469212360, "answer_id": 38533197, "question_id": 38513276, "link": "https://stackoverflow.com/questions/38513276/tasty-hunit-testing-of-a-parsec-parser/38533197#38533197", "title": "Tasty Hunit testing of a parsec parser?", "body": "<p>Thank you for all helpful comments.</p>\n\n<p>Indeed, like it was pointed out by @user2407038, better handling of the error message was required.</p>\n\n<pre><code>simpleLabels :: TestTree\nsimpleLabels = testGroup \"Simple label searches\"\n    [\n    testCase \"Equality matching simple label\" $ let \n        res = case (parse umeQuery \"Source\" \"Phonetic = a \") of\n            Right a -&gt; a\n            Left a -&gt; error \"Something\"\n    in res @?=  LabelInLabelType \"Phonetic\" [\"a\"] \"=\"\n    ]\n</code></pre>\n\n<p>works. The error message in the example above is obviously not optimal, but it is suitable for the sake of the current example.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1469212360, "creation_date": 1469131019, "question_id": 38513276, "link": "https://stackoverflow.com/questions/38513276/tasty-hunit-testing-of-a-parsec-parser", "title": "Tasty Hunit testing of a parsec parser?", "body": "<p>I need to set up a test suit that lets me determine whether changes I make in a parsec parser does not break anything else down the line.</p>\n\n<p>I am using <code>tasty</code> unit tests for this, and this is what I have:</p>\n\n<pre><code>simpleLabels :: TestTree\nsimpleLabels = testGroup \"Simple label searches\"\n    [ testCase \"List comparison (same length)\" $ -- just a test to make sure that the @?= works like it should\n      [1, 2, 3] `compare` [1,2,2] @?= LT\n      , \n      testCase \"Phonetic = a \" $ \n        parse umeQuery \"Source\" \"Phonetic = a \" @?= Right ( LabelInLabelType \"Phonetic\" [\"a\"] \"=\")  \n    ]\n</code></pre>\n\n<p>Now, this stream is parsed correctly by the parser when I run it in the REPL:</p>\n\n<pre><code>&gt; parse umeQuery \"something\"  (pack  \"Phonetic = a \")\nRight (LabelInLabelType \"Phonetic\" [\"a\"] \"=\")\n</code></pre>\n\n<p>This is like it should be, and therefore what I set up in the test above.</p>\n\n<p>Now, the test suite does not build at all, giving the error:</p>\n\n<pre><code>TestQueryParser.hs:29:55:\n    No instance for (Eq ParseError) arising from a use of \u2018@?=\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018parse umeQuery \"Ume Query : \" \"Phonetic = a \"\n       @?= Right (LabelInLabelType \"Phonetic\" [\"a\"] \"=\")\u2019\n    In the expression:\n      testCase \"Phonetic = a \"\n      $ parse umeQuery \"Ume Query : \" \"Phonetic = a \"\n        @?= Right (LabelInLabelType \"Phonetic\" [\"a\"] \"=\")\n    In the second argument of \u2018testGroup\u2019, namely\n      \u2018[testCase \"List comparison (same length)\"\n        $ [1, 2, ....] `compare` [1, 2, ....] @?= LT,\n        testCase \"Phonetic = a \"\n        $ parse umeQuery \"Ume Query : \" \"Phonetic = a \"\n          @?= Right (LabelInLabelType \"Phonetic\" [\"a\"] \"=\")]\u2019\n</code></pre>\n\n<p>How come I need this, considering the fact that a success/correct parsing should result in a <code>Right a</code> value?</p>\n\n<p>What would be the best way to set up unit test for a parsec parser?</p>\n"}, {"tags": ["haskell", "typeclass", "impredicativetypes"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469133020, "post_id": 38513259, "comment_id": 64424639, "body": "I don&#39;t know all the details of what&#39;s going on here, but in GHC 8 the behavior changed so that even your original <code>Right mempty</code> gives the type you&#39;re looking for. See the related <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11319\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/11319</a>. At any rate, ImpredicativeTypes is unsupported and you shouldn&#39;t use it for anything real."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1469133203, "post_id": 38513259, "comment_id": 64424734, "body": "Some of what&#39;s going on here is pretty clear, though: GHC needed to make <code>mempty :: forall b. Monoid b =&gt; b</code>, but <code>mempty :: Monoid m =&gt; m</code>, so it picked <code>m = (forall b. Monoid b =&gt; b)</code> and then tried to solve the constraint <code>Monoid (forall b. Monoid b =&gt; b)</code>, which of course it couldn&#39;t (there aren&#39;t instances for polytypes)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1469133215, "post_id": 38513259, "comment_id": 64424741, "body": "I&#39;m voting to close this question as off-topic because according to the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#impredicative-polymorphism\" rel=\"nofollow noreferrer\">GHC documentation</a>, <code>ImpredicativeTypes</code> is &quot;extremely flaky&quot;, &quot;highly experimental&quot; and &quot;certainly un-supported&quot;. It also makes reference to what this feature would do &quot;if it worked&quot;. There&#39;s simply no point in trying to use this extension unless and until it is fixed. IMHO, the current proposed fix is too invasive."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469133400, "post_id": 38513259, "comment_id": 64424840, "body": "@dfeuer I mean I don&#39;t think that makes the question off topic, it might make the question not very important, but even if <code>ImpredicativeTypes</code> is best avoided I still think it is reasonable for me to be curious what is going on here."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469133511, "post_id": 38513259, "comment_id": 64424890, "body": "@ReidBarton So is the issue sort of what I was guessing at? That even though for any arbitrary <code>t</code> an instance exists, it cannot actually pick one to use in any reasonable way for all possible <code>t</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469133639, "post_id": 38513259, "comment_id": 64424966, "body": "@semicolon, the problem is that basically the only way to answer the question is to trace the execution of the type checker. That doesn&#39;t really seem like a reasonable request for a Q &amp; A site."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469133747, "post_id": 38513259, "comment_id": 64425022, "body": "@dfeuer Are you positive that is the only meaningful way to answer the question? It seemed like Reid Barton had another (partial?) explanation talking about there not being instances for polytypes."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1469134144, "post_id": 38513259, "comment_id": 64425220, "body": "Reid was making an informed guess. At present, I don&#39;t think <i>anyone</i> actually understands the effects of the extension. Most notably, type system hacker extraordinaire Richard Eisenberg has made multiple deep changes to the type system over the past couple years without making any effort to keep the extension up to date with those changes. This is basically because nobody has yet figured out exactly how it should behave, and it&#39;s never behaved well enough to make it tractable to even maintain its behavior."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1469135072, "post_id": 38513259, "comment_id": 64425700, "body": "Well there definitely aren&#39;t any instances for polytypes. The question is about how GHC decides whether to pick <code>m = b</code> and then generalize, to get <code>mempty :: forall b. Monoid b =&gt; b</code>, or to just pick <code>m = (forall b. Monoid b =&gt; b)</code>."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469135457, "post_id": 38513259, "comment_id": 64425876, "body": "@ReidBarton What reasons are there to pick one of the two options over the other?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1469136065, "post_id": 38513259, "comment_id": 64426166, "body": "This is not special to <code>Monoid</code>, <code>mempty</code>, <code>Right</code>, or lack of class instance for polytypes - e.g. <code>(,) 0 :: (forall b. Show b =&gt; b) -&gt; (Int, forall b. Show b =&gt; b)</code> just by itself is not well typed. Impredictive types don&#39;t work well at all .. the only way I&#39;ve gotten this to type check is with <code>(Right `asTypeOf` (undefined :: (forall b. Monoid b =&gt; b) -&gt; Either () (forall b. Monoid b =&gt; b))) mempty</code>, but I sure can&#39;t tell you <i>why</i> it works."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1469137347, "post_id": 38513259, "comment_id": 64426652, "body": "@user2407038 Well that is enough to convince me the best way to solve this issue is with <code>:set -XNoImpredicativeTypes</code>. That honestly makes absolutely zero sense."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "is_accepted": true, "score": 1, "last_activity_date": 1469721974, "creation_date": 1469721974, "answer_id": 38641527, "question_id": 38513259, "link": "https://stackoverflow.com/questions/38513259/how-to-make-impredicative-types-work-with-type-classes/38641527#38641527", "title": "How to make impredicative types work with type classes", "body": "<p>So this question isn't marked as unanswered I guess I will just reiterate what was said in the comments.</p>\n\n<p>Basically <code>ImpredicativeTypes</code> is totally unsupported, and no one really knows how it even should work. So trying to do anything meaningful with it in its current state is a bad idea. So the answer is just: \"don't try to do that\".</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 38641527, "answer_count": 1, "score": 2, "last_activity_date": 1469721974, "creation_date": 1469130970, "question_id": 38513259, "link": "https://stackoverflow.com/questions/38513259/how-to-make-impredicative-types-work-with-type-classes", "title": "How to make impredicative types work with type classes", "body": "<p>I was seeing what I could do with ImpredicativeTypes and wanted to see what exactly I could do with them. When I ran to what I feel is some strange behavior when it comes to their interaction with TypeClasses.</p>\n\n<pre><code>:t mempty\nmempty :: forall a. Monoid a =&gt; a\n\n:t Right\nRight :: forall a b. b -&gt; Either a b\n</code></pre>\n\n<p>So I figured I could combine them to make an impredicatively typed expression:</p>\n\n<pre><code>:t Right mempty\nRight mempty :: forall a b. Monoid b =&gt; Either a b\n</code></pre>\n\n<p>Looks like the extension does not infer impredicative types, which doesn't seem all that unreasonable, as I know that type inference is not always possible in the general case when you start adding features like this.</p>\n\n<p>So I decided that I would just make the fact that I wanted an impredicative type explicit:</p>\n\n<pre><code>:t Right mempty :: forall a. Either a (forall b. Monoid b =&gt; b)\n</code></pre>\n\n<p>Which to me seemed very reasonable, as I am literally just pasting over the <code>b</code> in the <code>Right</code> type signature with the type of <code>mempty</code>, and then not lifting the <code>forall</code>.</p>\n\n<p>But it give me the following error:</p>\n\n<pre><code>No instance for (Monoid (forall b. Monoid b =&gt; b))\n</code></pre>\n\n<p>Which seems rather absurd. Since every <code>Monoid</code> is an instance of <code>Monoid</code> by definition.</p>\n\n<p>Can someone explain to me what exactly is going on here? Is the issue that it would be too difficult or impossible to actually decide on one instance when actually using the type, and thus GHC really means \"No unambiguous / decidable instance for...\" rather than \"No instance...\"?</p>\n\n<p>As a side note when you take typeclasses out of the situation everything appears to work ok:</p>\n\n<pre><code>:t Right undefined :: forall a. Either a (forall b. b)\n</code></pre>\n\n<p>Type checks and gives me back the impredicative type I specified.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1469120382, "post_id": 38510132, "comment_id": 64418028, "body": "You need to turn on the <code>FlexibleInstances</code> language extension to create instances over type synonyms like the one you\u2019ve written. The GHC error message might even suggest this (along with <code>TypeSynonymInstaces</code>, though <code>FlexibleInstnaces</code> implies the former)."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1469121871, "post_id": 38510132, "comment_id": 64418816, "body": "@AlexisKing: Could you put that as an answer? It actually answers the question and it&#39;ll have better visibility."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1469146720, "post_id": 38510132, "comment_id": 64429231, "body": "Please, just don&#39;t do this. It&#39;s not a good idea. A vector is not a number; element-wise multiplication doesn&#39;t have semantics that make sense for general vectors. And almost certainly not for networks, either. It may well make sense to give it a <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\"><code>VectorSpace</code></a> instance, though, but you should definitely wrap it in a <code>newtype</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1469179705, "post_id": 38510132, "comment_id": 64440745, "body": "Note that when you define an instance you should define <b>all</b> the operations of the class. This includes, for example, <code>signum</code> and <code>abs</code>. Failing to do so may cause your programs to crash because some piece of code actually uses these and they end up <code>undefined</code>."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "edited": false, "score": 0, "creation_date": 1469140404, "post_id": 38511815, "comment_id": 64427702, "body": "thanks for the answer. What does the function NetWork do?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "edited": false, "score": 0, "creation_date": 1469142451, "post_id": 38511815, "comment_id": 64428249, "body": "<code>newtype</code> is functionally <a href=\"http://stackoverflow.com/questions/5889696/difference-between-data-and-newtype-in-haskell\">almost</a> identical to <code>data</code>, but with only a single constructor that has one field. You can sort of think of <code>Network</code> as the constructor for this type."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "edited": false, "score": 0, "creation_date": 1469143330, "post_id": 38511815, "comment_id": 64428449, "body": "@AndyM Why yes it should. What a typo! Corrected."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1469143339, "last_edit_date": 1469143339, "creation_date": 1469125773, "answer_id": 38511815, "question_id": 38510132, "link": "https://stackoverflow.com/questions/38510132/make-matrix-double-vector-double-an-instance-of-num/38511815#38511815", "title": "make [(Matrix Double,Vector Double)] an instance of Num", "body": "<p>Alexis King's comment is correct to get your current code to compile. However, it might be better practice to make a <code>newtype</code> for <code>Network</code> - that way you don't need to use any language extensions at all.</p>\n\n<pre><code>newtype Network = Network [(Matrix Double,Vector Double)]\n\ninstance Num Network where\n  (Network n1) + (Network n2) = Network $ zipWith (\\(m,v) (n,w) -&gt; (m+n,v+w)) n1 n2\n  (Network n1) - (Network n2) = Network $ zipWith (\\(m,v) (n,w) -&gt; (m-n,v-w)) n1 n2\n  (Network n1) * (Network n2) = Network $ zipWith (\\(m,v) (n,w) -&gt; (m*n,v*w)) n1 n2\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 6597731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/efd54c7a33671dea9d0798128a841d73?s=128&d=identicon&r=PG&f=1", "display_name": "AndyM", "link": "https://stackoverflow.com/users/6597731/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 38511815, "answer_count": 1, "score": 1, "last_activity_date": 1469143339, "creation_date": 1469120099, "question_id": 38510132, "link": "https://stackoverflow.com/questions/38510132/make-matrix-double-vector-double-an-instance-of-num", "title": "make [(Matrix Double,Vector Double)] an instance of Num", "body": "<p>I defined : </p>\n\n<pre><code>type Network = [(Matrix Double,Vector Double)]\n</code></pre>\n\n<p>where Matrix and Vector are from the hmatrix library. From the documentation of hmatrix it seems to me that Matrix Double and Vector Double are already instances of Num. Since I need to add and subtract Networks quiet a lot I also want Network to be an instance of Num. I tried </p>\n\n<pre><code>instance Num Network where\n  (+) = zipWith (\\(m,v) (n,w) -&gt; (m+n,v+w))\n  (-) = zipWith (\\(m,v) (n,w) -&gt; (m-n,v-w))\n  (*) = zipWith (\\(m,v) (n,w) -&gt; (m*n,v*w))\n</code></pre>\n\n<p>but I am getting the error : Illegal Instance declaration.</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1469126469, "post_id": 38509954, "comment_id": 64421348, "body": "As for the <code>&#183;</code> operator (which really belongs in a separate question) \u2013 you need a <i>fixity declaration</i>, e.g. <code>infixl 7 &#183;</code> (that&#39;s what the equivalent <code>^&amp;</code> operator in <a href=\"http://hackage.haskell.org/package/diagrams-lib-1.3.1.3/docs/Diagrams-Coordinates.html#v:-94--38-\" rel=\"nofollow noreferrer\">the <code>diagrams</code> library</a> uses)."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1469140008, "post_id": 38510507, "comment_id": 64427575, "body": "Thanks Tikhon.  Data types are surely cleaner looking (plus other advantages), but it is my understanding that they slow performance a bit because of the wrapping and unwrapping, unlike newtypes. Coordinates are something basic that comes in big numbers when defining things like smooth curves, so worrying in advance I chose newtypes."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 1, "creation_date": 1469142272, "post_id": 38510507, "comment_id": 64428210, "body": "@As&#237;Maull&#243;Josetustra A <code>newtype</code> is <i>represented in the same way</i> as the type it wraps. So <code>newtype Xy n = Xy (n, n)</code> appears the same at runtime as <code>(n,n)</code> Here&#39;s the important part: <b><code>(n,n)</code> is itself a datatype</b>. In fact the in-memory representation of <code>(n,n)</code> happens to be the same as the representation of <code>data Xy n = Xy n n</code> (a pointer to a thunk containing a pair of pointers). So your <code>newtype</code> version is just the same as @TikhonJelvis&#39;s <code>data</code> suggestion. The only time the <code>newtype</code> costs less is when you&#39;re converting to or from a tuple."}, {"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1469148682, "post_id": 38510507, "comment_id": 64429599, "body": "Oh, this does change things! I&#39;ll be using data then, since it also has some other advantages. Thanks for clarifying that!"}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 5, "last_activity_date": 1469121422, "creation_date": 1469121422, "answer_id": 38510507, "question_id": 38509954, "link": "https://stackoverflow.com/questions/38509954/fractional-coordinates-newtype/38510507#38510507", "title": "Fractional coordinates newtype", "body": "<p>You can have a type parameter in your newtype:</p>\n\n<pre><code>newtype Xy n = Xy (n, n)\n</code></pre>\n\n<p>Then you can write functions that work on pairs of anything in the <code>Fractional</code> class:</p>\n\n<pre><code>foo :: Fractional n =&gt; Xy n -&gt; Xy n -&gt; ...\n</code></pre>\n\n<p>You can also use specific types like <code>Xy Double</code> if you have operations that only make sense for doubles.</p>\n\n<p>Unfortunately, you can't just reuse the tuple syntax (<code>(a, b)</code>), but it's manageable if you write a type that has two fields instead of wrapping a pair:</p>\n\n<pre><code>data Xy n = Xy n n\n</code></pre>\n\n<p>Now you can just write <code>Xy a b</code> as a value or a pattern. You can even make it a record to get convenient field syntax:</p>\n\n<pre><code>data Xy n = Xy { x, y :: n }\n</code></pre>\n\n<p>This works just like the previous version but <em>also</em> allows you to use <code>x</code> and <code>y</code> as functions (ie <code>x :: Xy n -&gt; n</code>) and in patterns.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1469126071, "last_edit_date": 1495541299, "creation_date": 1469126071, "answer_id": 38511904, "question_id": 38509954, "link": "https://stackoverflow.com/questions/38509954/fractional-coordinates-newtype/38511904#38511904", "title": "Fractional coordinates newtype", "body": "<p>IMO you should probably just use <code>Double</code>, always and hard-baked. On an x86-64 processor, there's no real advantage that <code>Float</code> would give you \u2013 it takes the same memory (as each value needs a 64-bit pointer to refer to it anyway), is no faster (could even require extra alignment overhead) \u2013 there's just no point. <code>Double</code> is fine, it's fast and the best precision you can usually strive for<sup>\u2020</sup>.</p>\n\n<p>It's certainly <em>much</em> better than if you stored, OO-like, a generic instance of the fractional class \u2013 this kind of polymorphism causes quite a heavy overload. Fortunately, Haskell also really eschews <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">storing polymorphic values</a>.</p>\n\n<p>I also don't consider it conceptually sensible to define <code>Xy</code> as a functor, i.e. a type that <em>parametrically</em> polymorphic over the coordinate type, as suggested by <a href=\"https://stackoverflow.com/a/38510507/745903\">Tikhon Jelvis</a>. While this is absolutely a valid approach and can give really good performance (it's how the <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear library</a> works), this misses what vectors are about. A mathematical vector is foremostly <em>not</em> a tuple of numbers, but <a href=\"https://en.wikipedia.org/wiki/Vector_(mathematics_and_physics)\" rel=\"nofollow noreferrer\">a quantity that has both a direction and a magnitude</a>. The actual <em>coordinates</em> of such a vector should be considered only an implementation detail.</p>\n\n<p>You also don't want to make those 2D-things instances of the <code>Num</code> etc. classes. Those classes are for <a href=\"https://en.wikipedia.org/wiki/Field_(mathematics)\" rel=\"nofollow noreferrer\">numbers</a> \u2013 quantities that can canonically be added, subtracted <em>and multiplied</em>. You can't multiply vectors though, at least not in a way that should give you again a vector. The correct class for vectors is <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html#t:VectorSpace\" rel=\"nofollow noreferrer\"><code>VectorSpace</code></a>, not <code>Num</code>.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>It should be noted that <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed-Mutable.html#t:Unbox\" rel=\"nofollow noreferrer\">packed</a> <code>Float</code> arrays do save lots of memory, and if you use modern <a href=\"https://en.wikipedia.org/wiki/SSE4\" rel=\"nofollow noreferrer\">vectorised processor instructions</a> they can also be effectively much faster. But these are optimisations that aren't really accessible at the level where you're talking about single tuples.</sub></p>\n"}], "owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 38510507, "answer_count": 2, "score": 1, "last_activity_date": 1469126128, "creation_date": 1469119525, "last_edit_date": 1469126128, "question_id": 38509954, "link": "https://stackoverflow.com/questions/38509954/fractional-coordinates-newtype", "title": "Fractional coordinates newtype", "body": "<p>I'm making some basic modules about 2D geometry and I've decided to wrap coordinates in newtypes. This is so I can tell easily apart cartesian coordinates (<code>newtype Xy = Xy(Float,Float)</code>) from polar coordinates (<code>newtype Ra=Ra(Float,Float)</code>), perhaps also complex numbers; also to make them instances of <code>Num</code> and <code>Fractional</code> so I can overload operators.</p>\n\n<p>But do they have to be defined either as a pair of <code>Float</code>s or as pair of <code>Double</code>s? In some trigonometric functions, <code>Double</code>s might work noticeably better in terms of precision; many of the functions I'm writing for the <code>Xy</code> newtype I'd like them to be as generic as possible. \nSo is there a way to make a newtype with a pair of numbers of the <code>Fractional</code> class?</p>\n\n<p>Also, since I find it a bit cumbersome to write <code>Xy (0,0)</code> instead of simply <code>(0,0)</code>, I made the <code>\u00b7</code> operator:</p>\n\n<pre><code>(\u00b7) a b = Xy (a,b)\n</code></pre>\n\n<p>But it seems to have precedence over the rest, so <code>3+4\u00b72+1</code> is evaluated as <code>3+(Xy (4,2))+1</code>.\nAnd neither does it help with function declarations, lambda expressions, etc... I still have to write <code>\\Xy (a,b)-&gt;</code>.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["scala", "haskell", "monads", "scalaz", "monad-transformers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1469119282, "post_id": 38509236, "comment_id": 64417451, "body": "Minor point: In Haskell, I would not call this &quot;stacking monad transformers&quot; since I&#39;d use that to refer to e.g. <code>StateT s (ReaderT r IO) a</code>. It is true, though, that in such stack we would have multiple type constraints, so it IS related."}, {"owner": {"reputation": 1594, "user_id": 74631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8defd8778cfe282f13cbc5ef1d158d58?s=128&d=identicon&r=PG", "display_name": "devkat", "link": "https://stackoverflow.com/users/74631/devkat"}, "edited": false, "score": 0, "creation_date": 1469175412, "post_id": 38509236, "comment_id": 64438147, "body": "I don&#39;t think the two implicit parameters are the problem, otherwise you would get the error &quot;ambiguous implicit values&quot; (see <a href=\"https://github.com/scalaz/scalaz/issues/1110\" rel=\"nofollow noreferrer\">github.com/scalaz/scalaz/issues/1110</a>)."}, {"owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "reply_to_user": {"reputation": 1594, "user_id": 74631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8defd8778cfe282f13cbc5ef1d158d58?s=128&d=identicon&r=PG", "display_name": "devkat", "link": "https://stackoverflow.com/users/74631/devkat"}, "edited": false, "score": 0, "creation_date": 1469176599, "post_id": 38509236, "comment_id": 64438788, "body": "@devkat if I pass only 1 implicit, the thing works :)"}, {"owner": {"reputation": 1594, "user_id": 74631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8defd8778cfe282f13cbc5ef1d158d58?s=128&d=identicon&r=PG", "display_name": "devkat", "link": "https://stackoverflow.com/users/74631/devkat"}, "edited": false, "score": 0, "creation_date": 1469178694, "post_id": 38509236, "comment_id": 64440053, "body": "Sorry, my comment was unfounded :) Interestingly it works when one parameter is explicit and the other one implicit; it doesn&#39;t work if both are either explicit or implicit."}, {"owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "edited": false, "score": 0, "creation_date": 1469187598, "post_id": 38509236, "comment_id": 64445295, "body": "Actually it works with 1 implicit and doesn&#39;t work with 1 explicit(e.g. <code>justReader[F[_]](r: MonadReader[F, Int])</code> vs <code>justReader[F[_]](implicit r: MonadReader[F, Int])</code>), so I&#39;m completely lost now."}], "answers": [{"tags": [], "owner": {"reputation": 1594, "user_id": 74631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8defd8778cfe282f13cbc5ef1d158d58?s=128&d=identicon&r=PG", "display_name": "devkat", "link": "https://stackoverflow.com/users/74631/devkat"}, "is_accepted": false, "score": 1, "last_activity_date": 1469195072, "creation_date": 1469195072, "answer_id": 38528067, "question_id": 38509236, "link": "https://stackoverflow.com/questions/38509236/stacking-monad-transformers-in-scala/38528067#38528067", "title": "Stacking Monad Transformers in scala", "body": "<p>This is not really an answer, but maybe helps a bit.</p>\n\n<p>I think you're right; it seems like the compiler can't unify the <code>F[_]</code> types of both parameters (I guess since it is a higher-kinded type with multiple possible instances and not a concrete type instance) to a monad type. Compilation works with separate parameter lists since type unification only happens within a parameter list. It can be further illustrated like this:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>def statyReader[F[_]](implicit r: MonadReader[F, Int], s: MonadState[F, Int]): F[Int] =\n  statyReader2(r, s)\n\ndef statyReader2[F[_]:Monad](r: MonadReader[F, Int], s: MonadState[F, Int]): F[Int] =\n  for {\n    counter &lt;- s.get\n    secret &lt;- r.ask\n    _ &lt;- s.put(counter + secret)\n  } yield counter\n\nError: ambiguous implicit values: both\nvalue s of type scalaz.MonadState[F,Int] and\nvalue r of type scalaz.MonadReader[F,Int]\nmatch expected type scalaz.Monad[F]\n</code></pre>\n\n<p>Obviously, as a workaround you could use two parameter lists to choose which monad you want to use:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>def statyReader[F[_]](implicit r: MonadReader[F, Int], s: MonadState[F, Int]): F[Int] =\n  statyReader2(r)(s)\n\ndef statyReader2[F[_]](r: MonadReader[F, Int])(implicit s: MonadState[F, Int]): F[Int] =\n  for {\n    counter &lt;- s.get\n    secret &lt;- r.ask\n    _ &lt;- s.put(counter + secret)\n  } yield counter\n</code></pre>\n"}], "owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1469195072, "creation_date": 1469117452, "question_id": 38509236, "link": "https://stackoverflow.com/questions/38509236/stacking-monad-transformers-in-scala", "title": "Stacking Monad Transformers in scala", "body": "<p>I'm trying to stack monad transfromers of <code>scalaz</code> in a haskell way:</p>\n\n<pre><code>statyReader :: (MonadReader Int m, MonadState Int m) =&gt; m Int\n</code></pre>\n\n<p>scala:</p>\n\n<pre><code>  def statyReader[F[_]](implicit r: MonadReader[F, Int], s: MonadState[F, Int]): F[Int] = for {\n    counter &lt;- s.get\n    secret  &lt;- r.ask\n    _       &lt;- s.put(counter + secret)\n  } yield counter\n</code></pre>\n\n<p>It compiles with 1 implicit passed, but not with 2:</p>\n\n<pre><code>Error:(13, 18) value flatMap is not a member of type parameter F[Int]\n    counter &lt;- s.get\n                 ^\nError:(14, 18) value flatMap is not a member of type parameter F[Int]\n    secret  &lt;- r.ask\n                 ^\nError:(15, 21) value map is not a member of type parameter F[Unit]\n    _       &lt;- s.put(counter + secret)\n                    ^\n</code></pre>\n\n<p>Why is this happening? My guess is that compiler is now confused which \"monadic instance of <code>F[_]</code>\" it should pick(both MonadReader and MonadState extend <code>Monad[F[_]</code>). Is this a right guess?</p>\n\n<p>How to overcome this?</p>\n"}, {"tags": ["haskell", "cabal-sandbox"], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1469116717, "post_id": 38507262, "comment_id": 64415838, "body": "Zeta you are my savior :) You could accept your own answer... Oh I see, in fact you wrote it today. Really cool."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1469112006, "creation_date": 1469112006, "answer_id": 38507262, "question_id": 38507261, "link": "https://stackoverflow.com/questions/38507261/how-can-i-use-ghc-with-a-cabal-sandbox-thats-not-in-the-current-working-directo/38507262#38507262", "title": "How can I use GHC with a cabal sandbox that&#39;s not in the current working directory?", "body": "<p>The problem is that <code>cabal</code> will only respect sandboxes in the current working directory. However, there are several options where you can specify a sandbox location for cabal or the package databse for GHC.</p>\n\n<h1>Using cabal features</h1>\n\n<p>You can use <code>cabal</code>'s <code>--sandbox-config-file</code> option to specify a sandbox configuration, e.g.</p>\n\n<pre><code>$ cabal --sandbox-config-file=/tmp/example/cabal.sandbox.config exec ghci\nPrelude&gt; :m Test.QuickCheck\nPrelude Test.QuickCheck&gt;   \n</code></pre>\n\n<p>This also enables you to change the sandbox from other places, which comes in handy if you just want to install random stuff into a temporary place:</p>\n\n<pre><code>$ cabal --sandbox-config-file=/tmp/example/cabal.sandbox.config install lens\n$ cabal --sandbox-config-file=/tmp/example/cabal.sandbox.config repl\nPrelude&gt; :m Control.Lens\nPrelude Control.Lens&gt; :m Test.QuickCheck\nPrelude Control.Lens Test.QuickCheck&gt;\n</code></pre>\n\n<p>Since this gets cumbersome after a while, you should probably add an alias</p>\n\n<pre><code>$ alias sandboxed-cabal=\"cabal --sandbox-config-file=/tmp/example/cabal.sandbox.config\"\n$ sandboxed-cabal repl\nPrelude&gt;\n</code></pre>\n\n<h1>Using <code>ghc -package-db</code></h1>\n\n<p>Alternatively, you can directly specify the package database when you use GHC with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#package-databases\" rel=\"nofollow\"><code>-package-db</code></a>:</p>\n\n<pre><code>$ ghci -package-db /tmp/example/.cabal-sandbox/&lt;ARCH&gt;-packages.conf.d\nPrelude&gt; :m Test.QuickCheck\nPrelude Test.QuickCheck&gt;\n</code></pre>\n\n<p>The <code>&lt;ARCH&gt;</code> depends on your system and the used GHC, e.g. on a 64bit Linux and GHC 7.10.3 it's <code>x86_64-linux-ghc-7.10.3-packages.conf.d</code>. You can then use all packages in that database:</p>\n\n<pre><code>$ ghci -package-db /tmp/example/.cabal-sandbox/&lt;ARCH&gt;-packages.conf.d\nPrelude&gt; :m Control.Lens\nPrelude Control.Lens&gt; \n</code></pre>\n\n<p>Again, an alias should come in handy.</p>\n\n<h1>Using <code>GHC_PACKAGE_PATH</code></h1>\n\n<p>Last, but not least, you can adjust an environment variable. However, if the environment variable <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#the-ghc-package-path-environment-variable\" rel=\"nofollow\"><code>GHC_PACKAGE_PATH</code></a> exists, it will overwrite GHC's usual package databases, so you either need to check <code>ghc-pkg list</code> and add them too</p>\n\n<pre><code>$ GHC_PACKAGE_PATH=/opt/ghc/7.10.3/lib/ghc-7.10.3/package.conf.d/:/tmp/example/.cabal-sandbox/x86_64-linux-ghc-7.10.3-packages.conf.d ghci\n</code></pre>\n\n<p>or use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#ghc-flag--global-package-db\" rel=\"nofollow\"><code>-global-package-db</code></a> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#ghc-flag--user-package-db\" rel=\"nofollow\"><code>-user-package-db</code></a> to reenable them:</p>\n\n<pre><code>$ GHC_PACKAGE_PATH=/tmp/example/.cabal-sandbox/x86_64-linux-ghc-7.10.3-packages.conf.d ghci -global-package-db -user-package-db\n</code></pre>\n"}], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 38507262, "answer_count": 1, "score": 2, "last_activity_date": 1469112006, "creation_date": 1469112006, "question_id": 38507261, "link": "https://stackoverflow.com/questions/38507261/how-can-i-use-ghc-with-a-cabal-sandbox-thats-not-in-the-current-working-directo", "title": "How can I use GHC with a cabal sandbox that&#39;s not in the current working directory?", "body": "<p>If I create a cabal sandbox with <code>cabal sandbox init</code>, I can use <code>cabal repl</code> or <code>cabal exec ghc(i)</code> to work with those packages without creating a project:</p>\n\n<pre><code>$ mkdir /tmp/example &amp;&amp; cd /tmp/example\n$ cabal sandbox init\n$ cabal install QuickCheck\n$ cabal exec ghci\nPrelude&gt; :m Test.QuickCheck\nPrelude Test.QuickCheck&gt;\n</code></pre>\n\n<p>However, if I change the path to something else, even to a subdirectory, I cannot access the packages anymore:</p>\n\n<pre><code>$ mkdir -p /tmp/example/sub &amp;&amp; cd /tmp/example/sub\n$ cabal exec ghci\nPrelude&gt; :m Test.QuickCheck\n&lt;no location info&gt;:\n    Could not find module \u2018Test.QuickCheck\u2019\n    It is not a module in the current program, or in any known package.\n</code></pre>\n\n<p>Is there any way to use the contents from the sandbox, without copying its content?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 1454504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bb016958c00fc855280e1f7b5339553?s=128&d=identicon&r=PG&f=1", "display_name": "Josselin Poiret", "link": "https://stackoverflow.com/users/1454504/josselin-poiret"}, "is_accepted": true, "score": 2, "last_activity_date": 1469112413, "last_edit_date": 1469112413, "creation_date": 1469111890, "answer_id": 38507213, "question_id": 38506748, "link": "https://stackoverflow.com/questions/38506748/wrong-order-of-output-with-bind-operations-in-logger-monad/38507213#38507213", "title": "Wrong order of output with bind operations in logger Monad", "body": "<p>The log messages are actually printed in order, you can see that </p>\n\n<pre><code>evalTrace (Add x y) = do\n  rx &lt;- evalTrace x\n  ry &lt;- evalTrace y\n  Result () \"Add\\n\" &gt;&gt; return (rx + ry)\n</code></pre>\n\n<p>desugars into <code>evalTrace x &gt;&gt;= (\\rx -&gt; evalTrace y &gt;&gt;= (\\ry -&gt; Result () \"Add\\n\" &gt;&gt; return (rx + ry)))</code>.\nYou can obviously see here that the log of <code>evalTrace x</code> should come first, then the log of <code>evalTrace y</code>, then the actual \"Add\" log.\nYou're doing a post-order Tree traversal of your expressions, as is the case with standard arithmetic interpreters.\nYou're looking for :</p>\n\n<pre><code>do\n  log \"Add\\n\"\n  rx &lt;- evalTrace x\n  ry &lt;- evalTrace y\n  return (rx + ry)\n</code></pre>\n\n<p>with <code>log = Result ()</code></p>\n\n<p>Note that <code>do {a;b}</code> desugars into <code>a &gt;&gt; b</code>, so you could've written your original code this way :</p>\n\n<pre><code>evalTrace (Add x y) = do\n  rx &lt;- evalTrace x\n  ry &lt;- evalTrace y\n  Result () \"Add\\n\"\n  return (rx + ry)\n</code></pre>\n"}], "owner": {"reputation": 1512, "user_id": 1153801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JzItT.jpg?s=128&g=1", "display_name": "SND", "link": "https://stackoverflow.com/users/1153801/snd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 38507213, "answer_count": 1, "score": 0, "last_activity_date": 1469112413, "creation_date": 1469110691, "question_id": 38506748, "link": "https://stackoverflow.com/questions/38506748/wrong-order-of-output-with-bind-operations-in-logger-monad", "title": "Wrong order of output with bind operations in logger Monad", "body": "<p>I was doing some exercises to try and get a better understanding of Monads and their bind operation(s) in Haskell. To do so, I decided to write a logger which keeps track of executed operations on the way. Therefore, I created following data type:</p>\n\n<pre><code>data Log e a = Error e | Result a String deriving (Show)\n</code></pre>\n\n<p>with as Monad instance:</p>\n\n<pre><code>instance Monad (Log e) where\n    (&gt;&gt;=) (Error e) _      = Error e\n    (&gt;&gt;=) (Result x log) f = case f x of\n                                  Error e       -&gt; Error e\n                                  Result r log' -&gt; Result r (log ++ log')\n    return x               = Result x \"\"\n</code></pre>\n\n<p>In order to test the logger in a scenario, I wrote a data type which represents simple arithmetic operations. The data type looks like:</p>\n\n<pre><code>data Exp = Lit Int | Add Exp Exp | Mul Exp Exp | Div Exp Exp deriving Show\n</code></pre>\n\n<p>Having division present, I want to use the Error constructor of the Log data type to handle division by zero.</p>\n\n<p>The eval function evaluating the expressions and tracing on the way will look like:</p>\n\n<pre><code>evalTrace :: Exp -&gt; Log String Int\n</code></pre>\n\n<p>A query of what the end result should look like:</p>\n\n<pre><code>Main&gt; evalTrace (Add (Lit 1) (Mul (Lit 2) (Lit 3)))\n(7, \"Add\\nLit\\nMul\\nLit\\nLit\\n\")\n</code></pre>\n\n<p>Here is what I wrote so far:</p>\n\n<pre><code>evalTrace :: Exp -&gt; Log String Int\nevalTrace (Lit x)   = Result () \"Lit\\n\" &gt;&gt; return x\nevalTrace (Add x y) = do\n                        rx &lt;- evalTrace x\n                        ry &lt;- evalTrace y\n                        Result () \"Add\\n\" &gt;&gt; return (rx + ry)\nevalTrace (Mul x y) = do\n                        rx &lt;- evalTrace x\n                        ry &lt;- evalTrace y\n                        Result () \"Mul\\n\" &gt;&gt; return (rx * ry)\nevalTrace (Div x y) = do\n                        rx &lt;- evalTrace x\n                        ry &lt;- evalTrace y\n                        if ry == 0\n                            then (Error \"division by zero\")\n                            else Result () \"Div\\n\" &gt;&gt; return (div rx ry)\n</code></pre>\n\n<p>The arithmetic is handled correctly, but it seems that the log messages are printed out of order. I'm sure I'm missing something obvious here, but I can't seem to get the problem fixed.</p>\n\n<p>Query:</p>\n\n<pre><code>Main&gt; evalTrace (Add (Lit 1) (Mul (Lit 2) (Lit 3)))\nResult 7 \"Lit\\nLit\\nLit\\nMul\\nAdd\\n\"\n</code></pre>\n"}, {"tags": ["linux", "haskell", "ghc", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469107882, "post_id": 38505453, "comment_id": 64409664, "body": "If you&#39;re within the sandbox then the installed packages should be in something like <code>.&#47;.cabal-sandox</code>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469109196, "post_id": 38505453, "comment_id": 64410622, "body": "<a href=\"https://stackoverflow.com/questions/28631925/haskell-package-installed-but-not-found?noredirect=1&amp;lq=1\">This answer</a> is <b>not</b> windows specific. You have to use <code>cabal exec ghc</code> to use things in the sandbox."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469109524, "post_id": 38505453, "comment_id": 64410851, "body": "@Zeta You&#39;re right, it works with <code>cabal exec ghci</code> ! Thank you !"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469109677, "post_id": 38505453, "comment_id": 64410968, "body": "@Zeta but it doesn&#39;t work if I run <code>cabal exec ghci</code> from a folder different than <code>~&#47;</code> ...."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469109718, "post_id": 38505453, "comment_id": 64411002, "body": "@St&#233;phaneLaurent: You can only use the packages in the sandbox where you&#39;ve installed them, e.g. <code>cd path&#47;to&#47;wd; cabal install package1 package2; cabal exec ghci</code>. You need to either symlink the cabal-sandbox, or use a command line option for that. If that&#39;s too much of a hassle, use <a href=\"http://haskellstack.org\" rel=\"nofollow noreferrer\"><code>stack</code></a>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469109917, "post_id": 38505453, "comment_id": 64411152, "body": "@Zeta That&#39;s annoying... And how to run <code>ghc</code> with options ? <code>cabal exec ghc -O ...</code> : &quot;unrecognized &#39;exec&#39; option `-O&#39;&quot;."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469110123, "post_id": 38505453, "comment_id": 64411302, "body": "@St&#233;phaneLaurent: That&#39;s another question (&quot;How can I use GHC with a cabal sandbox not installed in the current directory?&quot;), and the answer would be <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#package-databases\" rel=\"nofollow noreferrer\"><code>-package-db</code></a>. You&#39;re aware that there is documentation out there, right? :D"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1469110910, "post_id": 38505453, "comment_id": 64411883, "body": "@Zeta That&#39;s the second day I spend my time with this problem and I&#39;ve lost my patience with all these documentations which look like Chinese for me... ;-) I&#39;ll continue another day. Thanks for your help."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1469112052, "post_id": 38505453, "comment_id": 64412663, "body": "@St&#233;phaneLaurent, you&#39;re welcome, and <a href=\"http://stackoverflow.com/q/38507261/1139697\">here is your explanation</a>."}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1469109692, "answer_count": 0, "score": 0, "last_activity_date": 1469107291, "creation_date": 1469107291, "last_edit_date": 1495540292, "question_id": 38505453, "link": "https://stackoverflow.com/questions/38505453/haskell-package-installed-but-not-found-ubuntu", "closed_reason": "Duplicate", "title": "Haskell package installed but not found (Ubuntu)", "body": "<p>I installed <code>ghc</code> and <code>cabal-install</code> on Ubuntu using <a href=\"https://www.haskell.org/downloads/linux\" rel=\"nofollow noreferrer\">this way</a>.\nWhen I install a package using <code>cabal sandbox init</code> and <code>cabal install thepackage</code>, the installation runs fine, but the package is not found in GHC (message: \"It is not a module in the current program, or in any known package.\"). \nI have spent a couple of hours in trying to solve this problem, unsuccessfully. I took a look at <a href=\"https://stackoverflow.com/questions/28631925/haskell-package-installed-but-not-found\">this post</a>, but it is for Windows, <a href=\"https://stackoverflow.com/questions/6212833/haskell-cabal-i-just-installed-packages-but-now-the-packages-are-not-found\">this post</a>, but it doesn't help me, <a href=\"https://wiki.haskell.org/Cabal-Install#I_just_installed_packages.2C_but_now_the_packages_are_not_found\" rel=\"nofollow noreferrer\">this FAQ</a>, but I tried with and without the <code>--global</code> option, and the result is the same. \nSome info about my installation:</p>\n\n<pre><code>$ which cabal\n/opt/cabal/1.22/bin/cabal\n$ which ghc\n/opt/ghc/7.10.3/bin/ghc\n</code></pre>\n\n<p>I have a <code>~/.ghc</code> folder, but it is empty. It looks like the installed packages are in the folder <code>~/.cabal/packages/hackage.haskell.org</code> and <code>~/.cabal-sandbox/lib/x86_64-linux-ghc-7.10.3</code>.</p>\n"}, {"tags": ["haskell", "type-families", "associated-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469118908, "post_id": 38505314, "comment_id": 64417242, "body": "What are the parameters for <code>class C</code> ? I think that might be important."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469134765, "post_id": 38505314, "comment_id": 64425549, "body": "My understanding is that at present, associated type families are pretty much syntactic sugar. I&#39;m not really convinced they should have been added as such."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1469119076, "last_edit_date": 1469119076, "creation_date": 1469108435, "answer_id": 38505916, "question_id": 38505314, "link": "https://stackoverflow.com/questions/38505314/associated-type-family-fails-works-when-made-standalone/38505916#38505916", "title": "Associated type family fails, works when made standalone", "body": "<p>This</p>\n\n<pre><code>type family T t1 t2\ntype instance T (X t) (t a b) = a\n</code></pre>\n\n<p>roughly works like this</p>\n\n<pre><code>class K t1 t1 where\n   type T t1 t2\ninstance K (X t) (t a b) where\n   type T (X t) (t a b) = a\n</code></pre>\n\n<p>Note how all the variables <code>t1,t2</code> are parameters of class <code>K</code>.\nIndeed, this is required when variables occur more than once (i.e. non-linearly), as the posted error states:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u2022 Polymorphic type indexes of associated type \u2018T\u2019\n    (i.e. ones independent of the class type variables)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    must be distinct type variables\n</code></pre>\n\n<p>So, either you add all these type variables to your class, or - to the same effect - you move the type family outside the class.</p>\n\n<hr>\n\n<p>This compiles in GHC 8.0.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, PolyKinds #-}\n\ndata X (t :: k) = X\n\nclass C t1 where\n  type T t1 t2\n\ninstance C (X (t :: * -&gt; * -&gt; *)) where\n  type T (X t) (t a b) = a\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 38505916, "answer_count": 1, "score": 2, "last_activity_date": 1469119076, "creation_date": 1469106898, "last_edit_date": 1469114812, "question_id": 38505314, "link": "https://stackoverflow.com/questions/38505314/associated-type-family-fails-works-when-made-standalone", "title": "Associated type family fails, works when made standalone", "body": "<p>When I have code like the following:</p>\n\n<pre><code>class C where\n  type T t1 t2\n  ...\n\ninstance C (X t) where\n  type T (X t) (t a b) = a\n  ...\n</code></pre>\n\n<p>I get the error (with GHC head):</p>\n\n<pre><code>\u2022 Polymorphic type indexes of associated type \u2018T\u2019\n    (i.e. ones independent of the class type variables)\n    must be distinct type variables\n</code></pre>\n\n<p>Presumably this is because <code>(t a b)</code> is not a simple variable like the error implies it should be.</p>\n\n<p>But I can simply reorganise the code like the following:</p>\n\n<pre><code>type family T t1 t2\n\nclass C where\n  ...\n\ntype instance T (X t) (t a b) = a\n\ninstance C (X t) where\n  ....\n</code></pre>\n\n<p>And then everything seems to work fine now.</p>\n\n<p>Because a slightly messier syntax, do I lose anything by taking type family definitions out of classes, or are in-class definitions just syntactic sugar so taking them out is a relatively cost free workaround?</p>\n"}, {"tags": ["function", "haskell", "pointfree"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469106431, "post_id": 38504842, "comment_id": 64408630, "body": "It&#39;s a matter of taste and style which can be refined by reading and writing code. Also, this has been asked many times before."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1469108135, "post_id": 38504842, "comment_id": 64409854, "body": "No clear rule here. For what it&#39;s worth, I use simple common patterns like chains <code>f . g . h</code> but avoid &quot;smart&quot; stuff like <code>(.) . (. f) . g</code>. I sometimes abuse <code>f &amp;&amp;&amp; g</code> and <code>f *** g</code>, and maybe some <code>curry&#47;uncurry</code>, but I try to prevent myself to go too far in that realm. When in doubt, stick to pointful."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1469110635, "post_id": 38504842, "comment_id": 64411670, "body": "There are similar questions already asked and answered here (like <a href=\"http://stackoverflow.com/questions/8681512/what-is-a-general-scheme-for-writing-a-function-in-pointfree-style?rq=1\" title=\"what is a general scheme for writing a function in pointfree style\">stackoverflow.com/questions/8681512/&hellip;</a>), but as written I think this one cannot be answered. It is too broad and opinion based."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469154453, "post_id": 38508082, "comment_id": 64430838, "body": "I think it&#39;s actually pretty hard to know what GHC will do, whether you write a manual lambda or not. In this case, I bet you&#39;ll get sharing either way, but the optimizer can add or remove sharing in somewhat hard-to-predict ways."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469172857, "post_id": 38508082, "comment_id": 64436770, "body": "@dfeuer: are you sure? I&#39;d be surprised if GHC ever <i>removed</i> sharing, at least unless the shared expression inlines to a few opcodes that are clearly neglectable for performance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469181381, "post_id": 38508082, "comment_id": 64441753, "body": "Yes, I&#39;m pretty sure. Roman Cheplyaka had some trouble with it doing so in a situation similar to this one in <code>regex-applicative</code> and had to disable some optimization to recover it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469182853, "post_id": 38508082, "comment_id": 64442527, "body": "That&#39;s troubling! In fact I&#39;d lean to calling it a GHC bug."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1469114182, "creation_date": 1469114182, "answer_id": 38508082, "question_id": 38504842, "link": "https://stackoverflow.com/questions/38504842/when-to-use-and-when-not-to-use-pointfree-style-in-haskell/38508082#38508082", "title": "when to use and when not to use pointfree style in haskell?", "body": "<p>As already commented, it's a matter of taste and there will always be edge cases where both styles are equally suited (or, indeed, a partially-pointed version is best). However, there are some cases where it's clear enough:</p>\n\n<ul>\n<li><p>If a pointed expression can be \u03b7-reduced just like that, it's usually a good idea to do it.</p>\n\n<pre><code>f x = g (h x)\n</code></pre>\n\n<p>should better be written</p>\n\n<pre><code>f = g . h\n</code></pre></li>\n<li><p>If you want to memoise some computation before accepting some function parameters, you must keep these parameters out of the scope. For instance,</p>\n\n<pre><code>linRegression :: [(Double, Double)] -&gt; Double -&gt; Double\nlinRegression ps x = a * x + b\n where a, b = -- expensive calculation of regression coefficients,\n              -- depending on the `ps`\n</code></pre>\n\n<p>isn't optimal performance-wise, because the coefficients will need to be recomputed for every <code>x</code> value received. If you make it point-free:</p>\n\n<pre><code>linRegression :: [(Double, Double)] -&gt; Double -&gt; Double\nlinRegression ps = (+b) . (a*)\n where a, b = ...\n</code></pre>\n\n<p>this problem doesn't arise. (Perhaps GHC will in some cases figure this out by itself, but I wouldn't rely on it.)</p>\n\n<p>Often though, it is better to make it pointed nevertheless, just not with an <code>x</code> in the same scope as <code>a</code> and <code>b</code> but bound by a dedicated lambda:</p>\n\n<pre><code>linRegression :: [(Double, Double)] -&gt; Double -&gt; Double\nlinRegression ps = \\x -&gt; a * x + b\n where a, b = ...\n</code></pre></li>\n<li><p>If the point-free version is actually <em>longer</em> than the pointed version, I wouldn't use it. If you need to introduce tricks to get it point-free like <code>flip</code> and the <code>Monad (a-&gt;)</code> instance and this doesn't even make it shorter, then it will almost certainly be less readable than the pointed version.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 3, "last_activity_date": 1469136941, "creation_date": 1469136941, "answer_id": 38514772, "question_id": 38504842, "link": "https://stackoverflow.com/questions/38504842/when-to-use-and-when-not-to-use-pointfree-style-in-haskell/38514772#38514772", "title": "when to use and when not to use pointfree style in haskell?", "body": "<p>My favorite answer comes from Richard Bird's <em>Thinking Functionally with Haskell</em>: pointfree style helps you reason about function <em>composition</em> while a pointed style helps you reason about function <em>application</em>.</p>\n\n<p>If you find that a pointfree style is awkward for writing a particular function then you generally have two options:</p>\n\n<ol>\n<li>Use a pointed style instead. Sometimes you <em>do</em> want to reason about application.</li>\n<li>Redesign your function to be compositional in nature.</li>\n</ol>\n\n<p>In my own programs, I've found that (2) often leads to a better design and that this design can then be more clearly expressed using a pointfree style. Pointfree style is not an end goal: it is a means to achieving a more compositional design.</p>\n"}], "owner": {"reputation": 514, "user_id": 1375259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yuWQ9.jpg?s=128&g=1", "display_name": "Chakravarthy Raghunandan", "link": "https://stackoverflow.com/users/1375259/chakravarthy-raghunandan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 38508082, "answer_count": 2, "score": 0, "last_activity_date": 1469136941, "creation_date": 1469105661, "question_id": 38504842, "link": "https://stackoverflow.com/questions/38504842/when-to-use-and-when-not-to-use-pointfree-style-in-haskell", "title": "when to use and when not to use pointfree style in haskell?", "body": "<p>I just learned about pointfree style in Haskell and how it can help tidy up the code and make it easier to read. But sometimes they can make the code a bit too terse.</p>\n\n<p>So, when I should I always use pointfree style and at what scenarios should I absolutely avoid pointfree style in Haskell?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "edited": false, "score": 0, "creation_date": 1469105981, "post_id": 38502494, "comment_id": 64408313, "body": "If you&#39;re using the recent GHC and using Data.Tree, then you can count all nodes in the tree using the length function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "edited": false, "score": 0, "creation_date": 1469214554, "post_id": 38502494, "comment_id": 64461158, "body": "@GarethR, <code>Data.Tree</code> defines rose trees. The tree here is a binary leaf tree. A variant of that technique could be used here by deriving <code>Foldable</code> and then calculating the number of nodes from the number of leaves. Can you see how?"}], "answers": [{"comments": [{"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "edited": false, "score": 0, "creation_date": 1469100878, "post_id": 38503028, "comment_id": 64404913, "body": "Thanks for hint with the data type definition and the code summary!"}, {"owner": {"reputation": 1342, "user_id": 1574374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6f66f66b0b5781a51040183831d6403?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Harris", "link": "https://stackoverflow.com/users/1574374/mike-harris"}, "edited": false, "score": 0, "creation_date": 1469105639, "post_id": 38503028, "comment_id": 64408074, "body": "Shouldn&#39;t that be <code>countNodes (Leaf a) = 1</code> (since you probably want to count the leaf nodes as well)?"}, {"owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "edited": false, "score": 0, "creation_date": 1469105840, "post_id": 38503028, "comment_id": 64408215, "body": "I think if you set <code>countNodes (Leaf a) = 1</code>, you will count all Node+all leafs, but i just want to count all nodes :)"}], "tags": [], "owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "is_accepted": true, "score": 7, "last_activity_date": 1469104881, "last_edit_date": 1469104881, "creation_date": 1469100402, "answer_id": 38503028, "question_id": 38502494, "link": "https://stackoverflow.com/questions/38502494/haskell-how-to-count-all-nodes-of-a-tree-pattern-matching/38503028#38503028", "title": "Haskell, how to count all nodes of a tree (pattern matching)", "body": "<p>First notice that data type definitions should start uppercase:</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) (Tree a)\n</code></pre>\n\n<p>To count all nodes, it is pretty much already what you did, a simple pattern match over the tree data constructors:</p>\n\n<pre><code>countNodes :: Tree a -&gt; Int\ncountNodes (Leaf a) = 0\ncountNodes (Node left right) = 1 + countNodes left + countNodes right\n</code></pre>\n\n<p>With your example:</p>\n\n<pre><code>let tree = Node((Node (Leaf 1) (Node (Leaf 10) (Leaf 11))))(Node (Leaf 12) (Leaf 13))\ncountNodes tree -- 4\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469215256, "post_id": 38505597, "comment_id": 64461510, "body": "Why not start with catamorphisms? <code>cata :: (a -&gt; r) -&gt; (r -&gt; b -&gt; r -&gt; r) -&gt; Tree a b -&gt; r</code> is the universal fold over the type you&#39;ve defined; it&#39;s easy to define <code>bifoldMap f g = cata f (\\ l v r -&gt; l &lt;&gt; g v &lt;&gt; r)</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1469640617, "last_edit_date": 1469640617, "creation_date": 1469107673, "answer_id": 38505597, "question_id": 38502494, "link": "https://stackoverflow.com/questions/38502494/haskell-how-to-count-all-nodes-of-a-tree-pattern-matching/38505597#38505597", "title": "Haskell, how to count all nodes of a tree (pattern matching)", "body": "<p><em>Let the machine do the work</em>. Both of your counting functions are an instance of a much more general concept, <em>folding</em>. I'm going to write a small amount of code to fold up a tree, and use it to define both of your desired counting functions for free.</p>\n\n<p>I'm going start by generalising your <code>Tree</code> type slightly, to be internally labelled with <code>b</code>s at <code>Node</code>s and externally labelled with <code>a</code>s at <code>Leaf</code>s.</p>\n\n<pre><code>data Tree a b = Leaf a | Node (Tree a b) b (Tree a b)\n</code></pre>\n\n<p>Your original <code>Tree</code> type is equivalent to <code>Tree a ()</code>.</p>\n\n<p>This version of <code>Tree</code> is an instance of a useful class called <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifoldable.html\" rel=\"nofollow\"><code>Bifoldable</code></a>. <code>Bifoldable</code> generalises <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> to work over datatypes with two type parameters.</p>\n\n<pre><code>instance Bifoldable Tree where\n    bifoldMap f g (Leaf a) = f a\n    bifoldMap f g (Node l x r) = bifoldMap f g l `mappend` g x `mappend` bifoldMap f g r\n</code></pre>\n\n<p><code>bifoldMap :: Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Tree a b -&gt; m</code> collapses a <code>Tree</code> down into a single value using a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"nofollow\"><code>Monoid</code></a>. It identifies all the <code>a</code>s and <code>b</code>s in the tree, applies <code>f</code> or <code>g</code> to them to get an <code>m</code>, then uses <code>mappend</code> to squish the resulting structure into a single value.</p>\n\n<p>This is the only nontrivial bit of code I'm going to write. Everything else is just manipulating types; <code>countLeaves</code> and <code>countNodes</code> will both get squeezed through the toothpaste tube of <code>bifoldMap</code>. (There are some <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-TH.html\" rel=\"nofollow\">Template Haskell helpers</a> to generate instances of <code>Bifoldable</code> for you, so you don't even need to write the code that does the hard work!)</p>\n\n<p>Every <code>Bifoldable</code> is automatically a <code>Foldable</code> in two ways. <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-Wrapped.html\" rel=\"nofollow\">The <code>WrappedBifunctor</code> newtype</a> makes a <code>Bifoldable</code> into a <code>Foldable</code> which aggregates its second argument.</p>\n\n<pre><code>newtype WrappedBifunctor p a b = WrapBifunctor { unwrapBifunctor :: p a b }\n\ninstance Bifoldable p =&gt; Foldable (WrappedBifunctor p a) where\n    foldMap f = bifoldMap (const mempty) f . unwrapBifunctor\n</code></pre>\n\n<p>This is already enough to give us a way to count nodes. Counting nodes is the same as counting occurrences of the <code>b</code> type parameter, which is exactly what <code>length</code> does for any <code>Foldable</code>. All we have to do is wrap the tree to get something <code>Foldable</code>.</p>\n\n<pre><code>-- i lied, this is nontrivial too - but it's already in the standard library\nlength :: Foldable t =&gt; t a -&gt; Int\nlength = foldl' (\\c _ -&gt; c+1) 0\n\ncountNodes :: Tree a b -&gt; Int\ncountNodes = length . WrapBifunctor\n\nghci&gt; let myTree = Node (Node (Leaf 'a') () (Leaf 'b')) () (Node (Leaf 'c') () (Leaf 'd'))\nghci&gt; countNodes myTree\n3\n</code></pre>\n\n<p>How about counting leaves? This time we need to count occurrences of the <code>a</code> type parameter. <code>WrappedBifunctor</code> can help here too: we can rearrange <code>Tree</code>'s parameters such that <code>a</code> is the second parameter, then wrap it up - the resulting <code>Foldable</code> instance will count <code>a</code>s instead of <code>b</code>s. For this we'll need <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-Flip.html\" rel=\"nofollow\">the <code>Flip</code> newtype</a>, which switches the parameters of its argument just like <code>flip</code> does at the value level:</p>\n\n<pre><code>newtype Flip p a b = Flip { runFlip :: p b a }\n\ninstance Bifoldable p =&gt; Bifoldable (Flip p) where\n    bifoldMap f g = bifoldMap g f . runFlip\n</code></pre>\n\n<p>Now we can count leaves for free:</p>\n\n<pre><code>countLeaves :: Tree a b -&gt; Int\ncountLeaves = length . WrapBifunctor . Flip\n\nghci&gt; countLeaves myTree\n4\n</code></pre>\n\n<p>Finally, you can count leaves <em>and</em> nodes using the <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifoldable.html#v:bilength\" rel=\"nofollow\"><code>bilength</code></a> function from the <code>Bifoldable</code> class.</p>\n\n<pre><code>bilength :: Bifoldable t =&gt; t a b -&gt; Int\nbilength = bifoldl' (\\c _ -&gt; c+1) (\\c _ -&gt; c+1) 0\n\ncountLeavesAndNodes :: Tree a b -&gt; Int\ncountLeavesAndNodes = bilength\n-- equivalent to, but more efficient than...\n-- countLeavesAndNodes t = countLeaves t + countNodes t\n</code></pre>\n\n<hr>\n\n<p>Haskell's philosophy is to solve problems like this once and for all, and apply these general solutions to specific cases. Newtypes like <code>Flip</code> and <code>WrappedBifunctor</code> let us express general properties (like \"every <code>Bifunctor</code> is still a <code>Bifunctor</code> after you flip its arguments\") with no runtime cost. We used these properties to manipulate the type class system into writing the code to count <code>a</code>s and <code>b</code>s for us.</p>\n\n<p>As you continue to learn Haskell, you'll get the hang of spotting when a program is an instance of a general pattern. Setting up general structures like the <code>Bifoldable</code> instance above quickly pays dividends in code reuse.</p>\n"}], "owner": {"reputation": 237, "user_id": 5539565, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3caea1216cdc02bbed42516c88cde26?s=128&d=identicon&r=PG&f=1", "display_name": "FastBatteryCharger", "link": "https://stackoverflow.com/users/5539565/fastbatterycharger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3270, "favorite_count": 2, "accepted_answer_id": 38503028, "answer_count": 2, "score": 1, "last_activity_date": 1469640617, "creation_date": 1469098915, "question_id": 38502494, "link": "https://stackoverflow.com/questions/38502494/haskell-how-to-count-all-nodes-of-a-tree-pattern-matching", "title": "Haskell, how to count all nodes of a tree (pattern matching)", "body": "<p>the question is in the title :)</p>\n\n<p>My Code:</p>\n\n<pre><code>data tree a = Leaf a | Node (tree a) (tree a)\n\ntreeo = Node((Node(Leaf 1)(Node (Leaf 10)(Leaf 11))))\n                (Node(Leaf 12)(Leaf 13))\n\n-- count all leafs: \nlcounter(Leaf a) = 1\nlcounter(Node a b)= lcounter a + lcounter b\n-- count all nodes?:\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469099949, "post_id": 38502056, "comment_id": 64404264, "body": "Take <code>f :: [Int] -&gt; [Char] -&gt; [Int] ; f x y = [length x + length y]</code>. What would you expect from <code>inverseA2 f :: [Maybe Int] -&gt; [Maybe Char] -&gt; [Maybe Int]</code> ? What about <code>f x y = [length x + length y, head x]</code>? I&#39;m not sure what the general definition would be..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1469105253, "post_id": 38502056, "comment_id": 64407821, "body": "In order for <code>f</code> to apply the given function, it must produce a <code>[a]</code> from a <code>[Maybe a]</code> (naturally there is no way to get <code>[a]</code> from <code>[Maybe b]</code> since there is no way to get <code>a</code> from <code>b</code>) and so you necessarily <i>need</i> a function <code>[Maybe a] -&gt; [a]</code> - and as you&#39;ve noted this function necessarily loses information. The same is true of the general case - there are few functors <code>f1, f2</code> which have an invertible function <code>forall a . f1 a -&gt; f2 a</code>."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1469106138, "post_id": 38502056, "comment_id": 64408428, "body": "@user2407038 so there was a reason I did not find a straightforward answer, since I was looking at the wrong problem. Thanks for pointing out the invertible functions! I will look more into this."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469108756, "post_id": 38502056, "comment_id": 64410291, "body": "@chi to clarify the situation with your example, let&#39;s say that I get the function <code>f</code> already defined as <code>f :: [Int] -&gt; [Char] -&gt; [Int]</code> and I would like to apply it to the respective structures <code>a = [Nothing, Just 1, Just 3]</code> and <code>b = [Just &#39;a&#39;, Just &#39;b&#39;]</code>. In this case the first function should return <code>inverseA2 f a b == [Just 5]</code>, while the second should be <code>inverseA2 f a b == [Just 5, Nothing]</code>. But using the pack/unpack method grants <code>[Nothing]</code> for the first function and <code>[Nothing]</code> for the second one respectively."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 0, "creation_date": 1469130446, "post_id": 38512582, "comment_id": 64423354, "body": "Very elegant! <code>sequence</code> describes perfectly what <code>pack</code> and <code>unpack</code> are doing, thanks for pointing it out (now I realized I am speaking gibberish when I talk about transposing, I will correct that)! Unfortunately, as you said, it is implementing the case I am trying to avoid. As in the example above, evaluating <code>inverseM2 (\\x y = [length x + length y]) [Nothing, Just 1, Just 3] [Just &#39;a&#39;, Just &#39;b&#39;]</code> will return <code>[Nothing]</code> instead of <code>[Just 5]</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1469134489, "post_id": 38512582, "comment_id": 64425408, "body": "<code>Monad</code> is clearly overkill (just replace <code>sequence</code> with <code>sequenceA</code>). Also, I would speculate that you could use several combinations of <code>Traversable</code> and <code>Distributive</code> for context."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 0, "creation_date": 1469187680, "post_id": 38512582, "comment_id": 64445358, "body": "Although the resources you provide are invaluable, I still hit the problem of &quot;sequencing&quot; the input arguments (i.e. <code>[Maybe a] -&gt; Maybe [a]</code>). For these two particular functors I cannot find such a non-destructive transformation, since there is no way of describing <code>Nothing</code> as a value in the set <code>a</code>. So I guess I should accept the situation as it is."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1469135164, "last_edit_date": 1469135164, "creation_date": 1469128431, "answer_id": 38512582, "question_id": 38502056, "link": "https://stackoverflow.com/questions/38502056/inverse-lifting-on-applicative-functors/38512582#38512582", "title": "Inverse lifting on applicative functors", "body": "<p>I'm sure you've probably figured this out, but I don't think you can do this with the constraints you have. If you are a bit more liberal with your constraints, you'll get something though....</p>\n\n<pre><code>inverseA2 :: (Applicative f, Traversable f, Applicative f1, Traversable f1)\n               =&gt; (f a -&gt; f b -&gt; f c) -&gt; f (f1 a) -&gt; f (f1 b) -&gt; f (f1 c)\ninverseA2 f x y = sequenceA (liftA2 f (sequenceA x) (sequenceA y))\n</code></pre>\n\n<p>The only reason I'm putting this up is that for your particular example with <code>Maybe</code> and <code>[]</code>, these constraints <em>are</em> all satisfied, so doing this is possible for that case. Still not settling at all though.</p>\n\n<p>You could also try experimenting with writing your own instances for <a href=\"https://hackage.haskell.org/package/distributive-0.5.0.2/docs/Data-Distributive.html\" rel=\"nofollow\"><code>Data.Distributive</code></a> giving you <code>distribute</code>, which is similar to <code>sequenceA</code>...</p>\n\n<p>Edited to include @dfeuer's suggestions.</p>\n"}], "owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 1, "accepted_answer_id": 38512582, "answer_count": 1, "score": 1, "last_activity_date": 1469190558, "creation_date": 1469097718, "last_edit_date": 1469190558, "question_id": 38502056, "link": "https://stackoverflow.com/questions/38502056/inverse-lifting-on-applicative-functors", "title": "Inverse lifting on applicative functors", "body": "<p>I'm pretty sure this has a simple solution but it eludes me and I cannot seem to find a straight answer.</p>\n\n<p>Normally, when applying <code>liftA2</code> assuming the binary function has already been lifted once, the signature looks like this:</p>\n\n<pre><code>liftA2'   :: (Applicative f1, Applicative f) \n             =&gt; (f a -&gt; f b -&gt; f c) -&gt; f1 (f a) -&gt; f1 (f b) -&gt; f1 (f c)\n</code></pre>\n\n<p>Is it possible to apply the \"inverse\" of, for example <code>liftA2</code> such as:</p>\n\n<pre><code>inverseA2 :: (Applicative f, Applicative f1) \n             =&gt; (f a -&gt; f b -&gt; f c) -&gt; f (f1 a) -&gt; f (f1 b) -&gt; f (f1 c)\n</code></pre>\n\n<hr>\n\n<p>As a concrete example, I would like to obtain the function:</p>\n\n<pre><code>f :: ([a] -&gt; [b] -&gt; [c]) -&gt; [Maybe a] -&gt; [Maybe b] -&gt; [Maybe c]\n</code></pre>\n\n<p>One way would be to resort to \"pack\" each argument <code>[Maybe a] -&gt; Maybe [a]</code> and \"unpack\" <code>Maybe [a] -&gt; [Maybe a]</code> the result of applying a normal <code>liftA2</code>. I would like to avoid that since, as you can imagine, packing is destructive (e.g. <code>pack [Just 1, Nothing, Just 2] == Nothing</code> ). </p>\n\n<hr>\n\n<p><strong>Update:</strong> as @user2407038 pointed out, in order for <code>f</code> to apply the given function you necessarily need a function along the lines of <code>[Maybe a] -&gt; [a]</code> which <em>does</em> lose information. So for these two particular functors there is no apparent way to satisfy the additional requirement posed. But for any other two functors <code>f</code>, <code>f1</code> which have an invertible function <code>forall a . f a -&gt; f1 a</code> the answer accepted fits perfectly as a solution to this question.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1469096924, "post_id": 38501108, "comment_id": 64402453, "body": "It is because of GHCi&#39;s <a href=\"http://ghc.readthedocs.io/en/8.0.1/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">extended defaulting rules</a>."}], "tags": [], "owner": {"reputation": 431, "user_id": 3360918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79cc9097de8b89e2e470ce4c85f46756?s=128&d=identicon&r=PG&f=1", "display_name": "Shumush", "link": "https://stackoverflow.com/users/3360918/shumush"}, "is_accepted": false, "score": 4, "last_activity_date": 1469095380, "creation_date": 1469095380, "answer_id": 38501108, "question_id": 38500611, "link": "https://stackoverflow.com/questions/38500611/haskell-basic-show-instance-for-simple-recursive-datatype-not-working/38501108#38501108", "title": "Haskell basic Show instance for simple recursive datatype not working", "body": "<p>In your function main, when you write <code>let a = L</code>, the type of <code>a</code> is just <code>List a0</code>. When the compiler tries to know which version of the <code>Show</code> instance it has to use, all types fits, because <code>a</code>'s type is not fully defined. If you delete the line <code>print a</code> however, you will see that <code>print b</code> will work, because <code>b</code>'s type can only be <code>List String</code>, and the compiler knows exactly which version of <code>show</code> it has to use.</p>\n\n<pre><code>main = do\n  print \"10-2\"\n  let a = L\n  let b = E \"abc\" a\n  -- print a\n  print b\n</code></pre>\n\n<p>Try writing <code>print []</code> and you will see that the compiler gives you the same kind of error.</p>\n\n<p>In ghci however, if you just type <code>print L</code> or <code>print []</code>, it will not prompt an error. I don't know why this is happening.</p>\n"}, {"comments": [{"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1469102861, "post_id": 38501317, "comment_id": 64406212, "body": "Thanks for the Answer. But for my List-Type the empty print is defined. It should make no difference. The L can only be from my data-type. Cant it ? the odd thing i found was:   :t L is List"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1469103061, "post_id": 38501317, "comment_id": 64406349, "body": "@PaulOskarMayer There&#39;s no just List, there can be only List of <i>something</i>. You need to tell what i this <i>something</i> before you can print. Have you read the link I provided?"}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1469103949, "post_id": 38501317, "comment_id": 64406940, "body": "Yes i think i know what you mean. You are refering to immediate evaluation ? Is the list only filled if there is more than a constructor?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1469104072, "post_id": 38501317, "comment_id": 64407021, "body": "Your type is <b>exactly</b> like the built-in list, no difference whatsoever."}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1469104095, "post_id": 38501317, "comment_id": 64407030, "body": "<a href=\"http://ghc.readthedocs.io/en/8.0.1/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">this</a> explains it also pretty good. thanks  @ReinHenrichs"}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1469095834, "creation_date": 1469095834, "answer_id": 38501317, "question_id": 38500611, "link": "https://stackoverflow.com/questions/38500611/haskell-basic-show-instance-for-simple-recursive-datatype-not-working/38501317#38501317", "title": "Haskell basic Show instance for simple recursive datatype not working", "body": "<p>It's the same error you will get if you try to compile this simple program:</p>\n\n<pre><code>main = print []\n</code></pre>\n\n<p>What? Haskell cannot print an empty list? That's correct, it cannot. That is, unless the type of the list element is known. It is not known at this case, so compilation fails. In order to see why, run these two programs:</p>\n\n<pre><code>main = print ([] :: [Int])\nmain = print ([] :: [Char])\n</code></pre>\n\n<p>The output is different, though the only difference between these programs is the type of an empty list.</p>\n\n<p><strong>However</strong>, if you try this same ambiguous program in <code>ghci</code> it will print <code>[]</code> just fine!</p>\n\n<pre><code>Prelude&gt; let main = print []\nPrelude&gt; main\n[]\nPrelude&gt;\n</code></pre>\n\n<p>This is because <code>ghci</code> has a slightly more liberal set of <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/interactive-evaluation.html\" rel=\"nofollow\"><em>defaulting rules</em></a> than <code>ghc</code>. So if you load your data type definition to <code>ghci</code> and say <code>print L</code> at the prompt, <code>ghci</code> will happily obey:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( h.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; print L\nEmpty\n*Main&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4864049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e700e8efc4db59f72f71a1e7e759d8dc?s=128&d=identicon&r=PG", "display_name": "McWiz", "link": "https://stackoverflow.com/users/4864049/mcwiz"}, "is_accepted": false, "score": 1, "last_activity_date": 1469106820, "last_edit_date": 1469106820, "creation_date": 1469104413, "answer_id": 38504435, "question_id": 38500611, "link": "https://stackoverflow.com/questions/38500611/haskell-basic-show-instance-for-simple-recursive-datatype-not-working/38504435#38504435", "title": "Haskell basic Show instance for simple recursive datatype not working", "body": "<p>As the others already said, you need to give your List a type, even if the data Constructor doesn't need it to create itself. </p>\n\n<p>So Try out:</p>\n\n<pre><code>print (L :: List Int) \n</code></pre>\n\n<p>or whatever you like to just print a your String of the Show Instance of (List a)</p>\n"}], "owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 1, "accepted_answer_id": 38501317, "answer_count": 3, "score": 0, "last_activity_date": 1469106820, "creation_date": 1469094168, "question_id": 38500611, "link": "https://stackoverflow.com/questions/38500611/haskell-basic-show-instance-for-simple-recursive-datatype-not-working", "title": "Haskell basic Show instance for simple recursive datatype not working", "body": "<p>i have a simple Problem. This Code looks perfectly fine to me.</p>\n\n<pre><code>main = do\n      print(\"10-2\")\n      let a = L\n      let b = E \"abc\" a\n      print(a)\n      print(b)\n\n\n  data List a = L | E a (List a)\n\n  instance (Show a) =&gt; Show (List a) where\n      show L = \"Empty\"\n      show (E a list) = (show a)++ (show list)\n</code></pre>\n\n<p>But it produces following error:</p>\n\n<pre><code>10-2.hs:5:5:\n    No instance for (Show a0) arising from a use of `print'\n    The type variable `a0' is ambiguous...\n</code></pre>\n\n<p>I cant find the Problem. Thanks for the Help!</p>\n"}, {"tags": ["haskell", "build", "sublimetext3"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469090822, "post_id": 38497980, "comment_id": 64398353, "body": "don&#39;t know how or if you can fix this inside sublime but you should be fine if you add it to your <code>$PATH</code> environment (see for example <a href=\"http://architectryan.com/2012/10/02/add-to-the-path-on-mac-os-x-mountain-lion/#.V5CMFriLS8E\" rel=\"nofollow noreferrer\">architectryan.com/2012/10/02/&hellip;</a>)"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469096691, "post_id": 38497980, "comment_id": 64402323, "body": "Now my <code>&#47;etc&#47;paths</code> file is <code>&#47;usr&#47;local&#47;bin</code> <code>&#47;usr&#47;bin</code> <code>&#47;bin</code> <code>&#47;usr&#47;sbin</code> <code>&#47;sbin</code> <code>&#47;Users&#47;durand&#47;Library&#47;Haskell&#47;bin&#47;</code> but the error message I get is exactly the same. I am quite confused then."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469098329, "post_id": 38497980, "comment_id": 64403294, "body": "you probably have to restart sublime or even the computer"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1469105882, "post_id": 38497980, "comment_id": 64408249, "body": "I restarted the computer, and it worked; then I turned off the computer and went for dinner. After returning, I turned on the computer and it failed again, with the same error message... Now I have completely no idea of what is going on... Thanks for the advice, which at least achieved one success!"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1475335648, "post_id": 38497980, "comment_id": 66907984, "body": "As a side-issue, I ended up starting to use vim for text editing. :P"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1469097607, "creation_date": 1469086877, "last_edit_date": 1469097607, "question_id": 38497980, "link": "https://stackoverflow.com/questions/38497980/sublimehaskell-cannot-build", "title": "SublimeHaskell cannot build", "body": "<p>I am using Sublime Text 3 on mac el capitan, and when I try to build a haskell file, I receive the following error message:</p>\n\n<pre><code>[Errno 2] No such file or directory: 'runhaskell'\n[cmd: ['runhaskell', 'path_to_my_file']]\n[path: /usr/bin:/bin:/usr/sbin:/sbin]\n[Finished]\n</code></pre>\n\n<p>The SublimeHaskell User settings is as follows:</p>\n\n<pre><code>{\n    \"add_to_PATH\":\n    [\n        \"/Users/durand/Library/Haskell/bin/\",\n        \"/usr/local/bin/\"\n    ],\n    \"enable_ghc_mod\": false,\n    \"enable_hdevtools\": false,\n    \"enable_hsdev\": false,\n}\n</code></pre>\n\n<p>I don't know why the path in error message does not include the path I specified in the User setting, and am not sure if this causes the problem. But using SublimeHaskellREPL: ghci currentfile works fine.<br>\nAlso, the <code>runhaskell</code> is located in <code>/usr/local/bin/</code> but for some reason I cannot make this directory seen by SublimeHaskell. In addition, both the <code>echo \"$PATH\"</code> and <code>/etc/paths</code> tell me that the <code>/usr/local/bin/</code> is in the path variable, which confuses me even further.  </p>\n\n<p>Any help is appreciated. Thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1469070096, "post_id": 38493921, "comment_id": 64389048, "body": "A valid, intuitively correct <code>Eq (IO a)</code> instance would be <i>tremendously</i> useful, if it were possible to write one. But Alan Turing will sit up in his grave and give you a tongue-lashing if you try."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469084869, "post_id": 38493921, "comment_id": 64394423, "body": "@dfeuer I don&#39;t see the problem. After all, we have an <code>Eq [a]</code> instance."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1469089267, "post_id": 38493921, "comment_id": 64397317, "body": "@dfeuer @ReinHenrichs Surely it&#39;s about decidability rather than termination? <code>IO a</code> is (sorta) represented as <code>RealWorld -&gt; (RealWorld, a)</code>. That arrow means an <code>Eq</code> instance would have to decide function equality, <a href=\"http://stackoverflow.com/questions/1132051/is-finding-the-equivalence-of-two-functions-undecidable\">which is equivalent to solving the Halting Problem</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1469091749, "post_id": 38493921, "comment_id": 64399020, "body": "@BenjaminHodgson, his point was that infinite lists are fully general (computable) functions on natural numbers. I doubt equality for such functions is decidable either."}], "tags": [], "owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "is_accepted": true, "score": 11, "last_activity_date": 1469070170, "last_edit_date": 1469070170, "creation_date": 1469068336, "answer_id": 38493921, "question_id": 38493804, "link": "https://stackoverflow.com/questions/38493804/third-monoid-law-and-io/38493921#38493921", "title": "Third Monoid Law and IO?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\">The third monoid law</a> states that <code>e &lt;&gt; (e &lt;&gt; e) = (e &lt;&gt; e) &lt;&gt; e</code> (to use the easier-to-type infix operator for <code>mappend</code>), <em>not</em> that <code>e &lt;&gt; (e &lt;&gt; e) == (e &lt;&gt; e) &lt;&gt; e</code> (note the <code>=</code> vs. <code>==</code>).</p>\n\n<p>It's expressing an equivalence -- really, expressing that <code>mappend</code> should be associative -- not demanding all <code>Monoid</code>s must also be instances of the <code>Eq</code> typeclass, where the <code>==</code> comes from.</p>\n\n<p>Another way of saying this: it's expressing a high-level idea about the behavior of the <code>mappend</code> function, not presenting valid Haskell code that should evaluate to anything in particular.</p>\n\n<p>Some types that are <code>Monoid</code>s -- like <code>[()]</code>, for instance -- also happen to have an <code>Eq</code> instance. But some (like the <code>IO ()</code> instance here) don't, and that's okay.</p>\n\n<blockquote>\n  <p>Sidenote: It doesn't really make sense to give <code>IO</code> an <code>Eq</code> instance, because it's nigh on impossible to determine if a certain <code>IO ()</code> is equivalent to another <code>IO ()</code>. Is <code>putStrLn \"3\"</code> \"equal\" to <code>print 3</code>? They both have the same observable effects, but how on earth could the runtime determine that in the general case? And you can't say \"they're equivalent if they produce the same values,\" because then the return type of <code>==</code> would have to be an <code>IO Bool</code>, and that's not the right signature for <code>Eq</code>. So we just don't give <code>IO</code> an <code>Eq</code> instance, and that's fine -- I can't come up with a reasonable example of when such an instance would be useful.</p>\n</blockquote>\n\n<p>Also note that \"<code>IO</code>\" doesn't have a <code>Monoid</code> instance (it's the wrong kind, anyway). The <code>mappend</code> that you're using comes from the instance for <code>Monoid a =&gt; Monoid (IO a)</code> &mdash; that is, IO recipes to produce types which are themselves <code>Monoid</code>s. <code>IO</code>'s <code>Monoid</code> instance just \"piggy-backs\" on the underlying <code>Monoid</code> instance.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 1, "accepted_answer_id": 38493921, "answer_count": 1, "score": 6, "last_activity_date": 1469071025, "creation_date": 1469067514, "last_edit_date": 1469071025, "question_id": 38493804, "link": "https://stackoverflow.com/questions/38493804/third-monoid-law-and-io", "title": "Third Monoid Law and IO?", "body": "<p>Looking at this <code>IO</code> code:</p>\n\n<pre><code>Prelude&gt; let e = return () :: IO ()\nPrelude&gt; e `mappend` e\nPrelude&gt; let y = e `mappend` e\nPrelude&gt; :t y\ny :: IO ()\n</code></pre>\n\n<p><strong>EDIT</strong> Apparently, as I understand, <code>IO</code> has a <code>Monoid</code> instance.</p>\n\n<p>However, shouldn't the following evaluate to <code>true</code>, in order to obey the Monoid third law?</p>\n\n<pre><code>Prelude&gt; e `mappend` (e `mappend` e) == (e `mappend` e) `mappend` e\n\n&lt;interactive&gt;:14:1: error:\n    * No instance for (Eq (IO ())) arising from a use of `=='\n    * In the expression:\n        e `mappend` (e `mappend` e) == (e `mappend` e) `mappend` e\n      In an equation for `it':\n          it = e `mappend` (e `mappend` e) == (e `mappend` e) `mappend` e\n</code></pre>\n"}]