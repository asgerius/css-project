[{"tags": ["haskell", "template-haskell", "quickcheck"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1467840872, "post_id": 38233443, "comment_id": 63889922, "body": "<code>propAllOfThem x = all ($x) [prop1, prop2, prop3]</code>?"}, {"owner": {"reputation": 557, "user_id": 4378583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b3120073dd8be523400d0f2c6188090?s=128&d=identicon&r=PG&f=1", "display_name": "stefan", "link": "https://stackoverflow.com/users/4378583/stefan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1467913046, "post_id": 38233443, "comment_id": 63924863, "body": "@DanielWagner: If you actually meant <code>($x)</code>, then I don&#39;t understand it (Recall: Template Haskell!).  If you meant <code>($ x)</code> instead, then no, this has several drawbacks: The properties are not collected automatically, and if one fails I do not see which one, QuickCheck only reports <code>prop_AllOfThem</code>."}], "answers": [{"comments": [{"owner": {"reputation": 557, "user_id": 4378583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b3120073dd8be523400d0f2c6188090?s=128&d=identicon&r=PG&f=1", "display_name": "stefan", "link": "https://stackoverflow.com/users/4378583/stefan"}, "edited": false, "score": 0, "creation_date": 1467913139, "post_id": 38234701, "comment_id": 63924905, "body": "Does not solve my problem, see comment to @DanielWagner above."}], "tags": [], "owner": {"reputation": 354, "user_id": 4856526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c98e9b00d02d7d17a78b6c6a69f1ac05?s=128&d=identicon&r=PG&f=1", "display_name": "eduardogr", "link": "https://stackoverflow.com/users/4856526/eduardogr"}, "is_accepted": false, "score": 0, "last_activity_date": 1467843390, "last_edit_date": 1495542782, "creation_date": 1467843390, "answer_id": 38234701, "question_id": 38233443, "link": "https://stackoverflow.com/questions/38233443/how-can-quickcheck-test-all-properties-for-each-sample/38234701#38234701", "title": "How can QuickCheck test all properties for each sample", "body": "<p>In this post you can see how to group tests</p>\n\n<p><a href=\"https://stackoverflow.com/questions/22127558/haskell-io-monads-quickcheck/\">Stackoverflow post</a></p>\n\n<p>That user provides a very simple example of use <strong>Test.Tasty.QuickCheck</strong></p>\n\n<p>Using <em>testProperty</em> and <em>testGroup</em> you can pass each random sample to each property</p>\n\n<p>In the next link you can check the <em>hackage</em> of this package</p>\n\n<p><a href=\"https://hackage.haskell.org/package/tasty-quickcheck-0.8.4/docs/Test-Tasty-QuickCheck.html\" rel=\"nofollow noreferrer\">Test.Tasty.QuickCheck</a></p>\n"}], "owner": {"reputation": 557, "user_id": 4378583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b3120073dd8be523400d0f2c6188090?s=128&d=identicon&r=PG&f=1", "display_name": "stefan", "link": "https://stackoverflow.com/users/4378583/stefan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 545, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1467843390, "creation_date": 1467837773, "last_edit_date": 1495541776, "question_id": 38233443, "link": "https://stackoverflow.com/questions/38233443/how-can-quickcheck-test-all-properties-for-each-sample", "title": "How can QuickCheck test all properties for each sample", "body": "<p>...instead of generating 100 new random samples for each property?</p>\n\n<p>My testsuite contains the TemplateHaskell hack explained here [1] to\ntest all functions named prop_*.  Running the test program prints</p>\n\n<pre><code>=== prop_foo from tests/lala.lhs:20 ===\n+++ OK, passed 100 tests.\n\n=== prop_bar from tests/lala.lhs:28 ===\n+++ OK, passed 100 tests.\n</code></pre>\n\n<p>and it looks like going through 100 random samples for each of the\nproperties.</p>\n\n<p>Problemis: Generating the samples is quite expensive, checking the\nproperties is not.  So I'd like to have a means to pass each random\nsample to each of the prop_* functions instead of creating new\n(#properties * 100) many samples.</p>\n\n<p>Is there anything like that built in?  Actually, I think I'd need a\nreplacement for the splice</p>\n\n<pre><code>$(forAllProperties)\n</code></pre>\n\n<p>in</p>\n\n<pre><code>main :: IO ()\nmain\n  = do args &lt;- parseArgs &lt;$&gt; getArgs\n       s &lt;- $(forAllProperties) $ quickCheckWithResult args\n       s ? return () $ exitFailure\n  where\n    parseArgs as\n      = null as ? stdArgs $ stdArgs{ maxSuccess = read $ head as }\n</code></pre>\n\n<hr>\n\n<p>[1] <a href=\"https://stackoverflow.com/questions/5683911/\">Simple haskell unit testing</a>, and\n    <a href=\"https://stackoverflow.com/questions/8976488/\">QuickCheck exit status on failures, and cabal integration</a></p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "edited": false, "score": 0, "creation_date": 1467914802, "post_id": 38236967, "comment_id": 63925800, "body": "The <code>requireAuthId</code> solution works in my particular case, thanks! It the general case, like in the Forms sections of the book, you mean having <code>form :: Maybe UserId -&gt; Form Blog</code> and using something like <code>maybe hiddenField pure mbUid</code> for the <code>UserId</code> field right? So you&#39;d be constructing a form with a pre filled field on the HTML page and a hidden field it the POST handler."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1467860663, "creation_date": 1467860663, "answer_id": 38236967, "question_id": 38233439, "link": "https://stackoverflow.com/questions/38233439/how-do-i-process-a-parameterized-yesod-form-from-a-handler-where-the-parameter-i/38236967#38236967", "title": "How do I process a parameterized Yesod form from a handler where the parameter is unavailable?", "body": "<p>You could use a <a href=\"https://www.stackage.org/haddock/lts-6.6/yesod-form-1.4.7.1/Yesod-Form-Fields.html#v:hiddenField\" rel=\"nofollow\">hiddenField</a>, but that's almost certainly <em>not</em> what you really want (any user would be able to spoof the <code>UserId</code> by just submitting a different value). Assuming what you're trying to do is actually say \"who is the current user\", you'd need some way of securely determining that in your AJAX handler (such as <code>requireAuthId</code>).</p>\n"}], "owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 38236967, "answer_count": 1, "score": 0, "last_activity_date": 1467860663, "creation_date": 1467837763, "question_id": 38233439, "link": "https://stackoverflow.com/questions/38233439/how-do-i-process-a-parameterized-yesod-form-from-a-handler-where-the-parameter-i", "title": "How do I process a parameterized Yesod form from a handler where the parameter is unavailable?", "body": "<p>I have the following form:</p>\n\n<pre><code>userForm :: UserId -&gt; Form UserDemographics\nuserForm uid = renderDivs $ UserDemographics &lt;$&gt;\n  pure uid &lt;*&gt;\n  areq yearField \"Year of birth\" Nothing &lt;*&gt;\n  areq textField \"Gender\" Nothing &lt;*&gt;\n  areq countryField \"Country of residence\" Nothing &lt;*&gt;\n  areq boolField \"Are you a computer programmer?\" Nothing\n</code></pre>\n\n<p>On my homepage, I use <code>generateFormPost $ userForm (entityKey userEnt)</code> to make a form with the <code>UserId</code> filled in. But I want to handle the input with AJAX, so a separate <code>Handler</code> gets the results of the form. The other handler doesn't have access to the <code>UserId</code>. How do I process the form? I tried this, which throws an error:</p>\n\n<pre><code>postDemoFormR :: Handler RepJson\npostDemoFormR = do\n  ((formData, _), _) &lt;- runFormPost $ userForm undefined\n  $(logDebug) $ pack $ show formData\n  return $ repJson ()\n</code></pre>\n\n<p>I could change <code>userForm</code>'s type to accept <code>Maybe UserId</code> instead of just <code>UserId</code> or make up a bogus <code>UserId</code> for the call to <code>runFormPost</code> but both of those are hacks. Is there an easy, clean way to do this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1467831594, "creation_date": 1467831594, "answer_id": 38231806, "question_id": 38231757, "link": "https://stackoverflow.com/questions/38231757/let-in-statement-doesnt-work-in-io/38231806#38231806", "title": "Let .. in statement doesn&#39;t work in IO?", "body": "<p>Your code is wrong. The <code>where</code> clause must occur at the end of the definition, while <code>let</code> is an expression that could occur anywhere an expression is valid.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1467840125, "post_id": 38232762, "comment_id": 63889632, "body": "What is a statement? Anyway, &quot;nothing should go after <code>where</code>&quot; is imprecise. For example, <code>do { case () of { () -&gt; return () where { () = () } }; return () }</code> is perfectly valid Haskell (fully braced and semicolon&#39;d for clarity)."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 4, "last_activity_date": 1467835281, "creation_date": 1467835281, "answer_id": 38232762, "question_id": 38231757, "link": "https://stackoverflow.com/questions/38231757/let-in-statement-doesnt-work-in-io/38232762#38232762", "title": "Let .. in statement doesn&#39;t work in IO?", "body": "<p><code>where</code> always ends a statement; nothing should go after <code>where</code>.\nSo, you could write it like this:</p>\n\n<pre><code>main = do\n    let x = 5 in print x\n    print x\n        where x = 5\n</code></pre>\n\n<p>This is valid because the <code>where</code> clause ends the statement, where it should belong. Your code was invalid because the parser expected to find nothing after the <code>where x = 5</code>, but discovered your <code>let</code> clause.</p>\n"}], "owner": {"reputation": 525, "user_id": 5869301, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86a49e0145a284ba5a05873250323f4d?s=128&d=identicon&r=PG&f=1", "display_name": "bisthebis", "link": "https://stackoverflow.com/users/5869301/bisthebis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 38232762, "answer_count": 2, "score": 3, "last_activity_date": 1467835281, "creation_date": 1467831431, "question_id": 38231757, "link": "https://stackoverflow.com/questions/38231757/let-in-statement-doesnt-work-in-io", "title": "Let .. in statement doesn&#39;t work in IO?", "body": "<p>I can hardly make the difference between \"where\" and \"let .. int\" statements.\nHere's my code. I want 2 ways to print 5.</p>\n\n<pre><code>main =  do\n    print x\n      where x = 5\n    let x = 5 in print x\n</code></pre>\n\n<p>First one works, but I get a \"parse error on input 'let'\"\nIs this a matter of indentation, or is my code plain wrong ?</p>\n"}, {"tags": ["haskell", "double"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 8, "creation_date": 1467829895, "post_id": 38231056, "comment_id": 63884117, "body": "Keep in mind that <code>Double</code> is a <i>binary</i> floating point number, and can never exactly represent <code>1.235</code> (the proper fraction doesn&#39;t have a power of two as its denominator). That said, this smells like an X/Y problem. If you&#39;re doing this rounding for presentation, strings really are the better option. If you need accurate decimal calculations (on a related note: <i>never ever use floats for currencies</i>), it&#39;s perhaps a better idea to use fixed-point calculations (using <code>Integer</code>s under the hood instead of <code>Double</code>). What the &quot;better solution&quot; is, depends on <i>why</i> you want to do this."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1467829916, "post_id": 38231056, "comment_id": 63884135, "body": "Hint: 10^3 == 1000"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1467830044, "creation_date": 1467830044, "answer_id": 38231323, "question_id": 38231056, "link": "https://stackoverflow.com/questions/38231056/how-to-get-n-digits-of-a-haskell-double/38231323#38231323", "title": "How to get n digits of a Haskell Double?", "body": "<p>One relatively simple way is to multiply by an appropriate power of ten and round, then divide away the power of ten. For example:</p>\n\n<pre><code>digits d n = fromInteger (round (d * 10^n)) / 10^n\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; digits 1.2346 3\n1.235\n&gt; digits 1.2344 3\n1.234\n&gt; digits 1.2345 3\n1.234\n</code></pre>\n\n<p>The last example shows that Haskell uses banker's rounding by default, so it doesn't <em>quite</em> meet your spec -- but perhaps it is close enough to be useful anyway. It is easy to implement other rounding variants (or find them on Hackage) if you really need them.</p>\n"}], "owner": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1467830044, "creation_date": 1467829206, "question_id": 38231056, "link": "https://stackoverflow.com/questions/38231056/how-to-get-n-digits-of-a-haskell-double", "title": "How to get n digits of a Haskell Double?", "body": "<p>I want to have a function <code>digits :: Double -&gt; Int -&gt; Double</code>, that gives n digits of a double (must round!) and returns a new double only with the digits wanted.</p>\n\n<p>Example: <code>digits 1.2345 3 -&gt; 1.235</code></p>\n\n<p>I could implement this using strings, but I think there is a better solution.\nAny idea how to implement this function?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1467829085, "post_id": 38230875, "comment_id": 63883665, "body": "Because once <code>pa</code> fails, the whole string <code>&quot;aabb&quot;</code> is passed to <code>pb</code>, not just the <code>&quot;bb&quot;</code> part"}, {"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467830275, "post_id": 38230875, "comment_id": 63884355, "body": "Thanks Alec, that makes sense. I&#39;ve added a related question in case you would be able to explain. Feel free to answer below so I could accept."}], "answers": [{"comments": [{"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467832342, "post_id": 38231733, "comment_id": 63885591, "body": "Thanks Daniel. What I still don&#39;t understand is why the sequence of either the parsers in the <code>permute</code> setup or the input matter. I thought the point was that both &quot;pa then pb&quot; and &quot;pb then pa&quot; would be tried, but it appears from my second example above that sequence does matter. Manually reordering pa and pb in permute will switch the success and failure modes. Furthermore, adding tries to the optional xs doesn&#39;t impact the result; it doesn&#39;t seem to matter if they are consumed or not as they are optional."}, {"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467832893, "post_id": 38231733, "comment_id": 63885873, "body": "I don&#39;t understand why the input isn&#39;t passed on to <code>pa</code> once <code>pb</code> fails, regardless of whether or not the &quot;x&quot; has been consumed. Instead it just reports the failure of <code>pb</code> to parse and that&#39;s it."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1467836820, "post_id": 38231733, "comment_id": 63887961, "body": "The order matters because both parsers start with a common prefix, and in parsec, <code>p1 &lt;|&gt; p2</code> is not in general the same as <code>p2 &lt;|&gt; p1</code>. In your case, once the <code>x</code> has been recognized, parsec commits to one order. You have to use <code>try</code> or left-factor the <code>x</code> out if you want to avoid that."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 1, "creation_date": 1467839347, "post_id": 38231733, "comment_id": 63889263, "body": "@rcampbell Lots to discuss here. First: it is not true that both &quot;<code>pa</code> then <code>pb</code>&quot; and &quot;<code>pb</code> then <code>pa</code>&quot; will be tried; if the first of the two that is tried consumes any input at all, the other will not be tried at all. Second: the <code>try</code> will need to wrap the <i>entire</i> thing that needs to be backed out -- so not <code>try (optional ...)</code> but <code>try pa</code>. Note how this meshes with the first point: <code>try p</code> only consumes input if <code>p</code> succeeds. Third: hopefully the above discussion addresses your second comment; input isn&#39;t passed on to <code>pa</code> once <code>pb</code> fails because <code>pb</code> consumed some input before it failed."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1467831352, "creation_date": 1467831352, "answer_id": 38231733, "question_id": 38230875, "link": "https://stackoverflow.com/questions/38230875/please-explain-the-behavior-of-this-parsec-permutation-parser/38231733#38231733", "title": "Please explain the behavior of this Parsec permutation parser", "body": "<blockquote>\n  <p>Why does this Parsec permutation parser not parse b?</p>\n</blockquote>\n\n<p>Because <code>'a'</code> is not a valid first character for either parser <code>pa</code> or parser <code>pb</code>.</p>\n\n<blockquote>\n  <p>How can both input orderings be supported when we have identical shared prefix \"x\"?</p>\n</blockquote>\n\n<p>Shared prefixes must be factored out of your grammar; or backtracking points inserted (using <code>try</code>) at the cost of performance.</p>\n"}, {"comments": [{"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467878006, "post_id": 38233389, "comment_id": 63901349, "body": "Thanks Alec! This makes perfect sense now. One minor note: putting <code>try</code> in front of both <code>optional (char &#39;x&#39;))</code> doesn&#39;t actually get it working because the &quot;x&quot; is always successfully consumed; the <code>try</code> won&#39;t change a successful consumption to empty. What I needed was all of <code>pa</code> and <code>pb</code> to fail as a single unit so I wrapped both the <code>optional</code> and <code>many1</code> in a single <code>try</code> so when the <code>many1</code> fails it returns empty for the whole thing, not having consumed even the &quot;x&quot; successfully, and is now able to try the alternate parser."}, {"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467878350, "post_id": 38233389, "comment_id": 63901539, "body": "I just saw Daniel&#39;s comment where he explains that the try needs to wrap the entire thing. Great to see I was on the right track! I understand why now. Thank you both!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1467837568, "last_edit_date": 1592644375, "creation_date": 1467837568, "answer_id": 38233389, "question_id": 38230875, "link": "https://stackoverflow.com/questions/38230875/please-explain-the-behavior-of-this-parsec-permutation-parser/38233389#38233389", "title": "Please explain the behavior of this Parsec permutation parser", "body": "<h3>Why <code>parseTest p &quot;aabb&quot;</code> gives <code>(&quot;&quot;,&quot;&quot;)</code></h3>\n<p>The permutation parser tries to strip off the front of the given string prefixes that can be parsed by its constituent parsers (<code>pa</code> and <code>pb</code> in this case). Here, it will have tried to apply both <code>pa</code> and <code>pb</code> to <code>&quot;aabb&quot;</code> and failed in both cases - it never even gets around to trying to parse <code>&quot;bb&quot;</code>.</p>\n<h3>Why can't both <code>pa</code> and <code>pb</code> start with <code>optional (char 'x')</code></h3>\n<p>Looking at <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/src/Text.Parsec.Perm.html#permute\" rel=\"noreferrer\"><code>permute</code></a>, you'll see it uses <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/src/Text.Parsec.Combinator.html#choice\" rel=\"noreferrer\"><code>choice</code></a>, which in turn relies on <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec.html#v:-60--124--62-\" rel=\"noreferrer\"><code>(&lt;|&gt;)</code></a>. As the documentation of <code>(&lt;|&gt;)</code> says,</p>\n<blockquote>\n<p>This combinator implements choice. The parser <code>p &lt;|&gt; q</code> first applies <code>p</code>. If it succeeds, the value of <code>p</code> is returned. If <code>p</code> fails without consuming any input, parser <code>q</code> is tried. This combinator is defined equal to the <code>mplus</code> member of the <code>MonadPlus</code> class and the <code>(&lt;|&gt;)</code> member of <code>Alternative</code>.</p>\n<p>The parser is called predictive since <code>q</code> is only tried when parser <code>p</code> didn't consume any input (i.e.. the look ahead is 1). This non-backtracking behaviour allows for both an efficient implementation of the parser combinators and the generation of good error messages.</p>\n</blockquote>\n<p>So when you do something like <code>parseTest p &quot;xbb&quot;</code>, <code>pa</code> doesn't fail immediately (it consumes and <code>'x'</code>) and then the whole thing fails because it cannot backtrack.</p>\n<h2>How to make shared prefixes work?</h2>\n<p>As Daniel has suggested, it is best to factor out your grammar. Alternately, you can use <code>try</code>:</p>\n<blockquote>\n<p>The parser <code>try p</code> behaves like parser <code>p</code>, except that it pretends that it hasn't consumed any input when an error occurs</p>\n</blockquote>\n<p>Based on what we talked about before for <code>(&lt;|&gt;)</code>, you ought then to put <code>try</code> in front of both of <code>optional (char 'x')</code>.</p>\n"}], "owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 38233389, "answer_count": 2, "score": 1, "last_activity_date": 1467837568, "creation_date": 1467828514, "last_edit_date": 1467831471, "question_id": 38230875, "link": "https://stackoverflow.com/questions/38230875/please-explain-the-behavior-of-this-parsec-permutation-parser", "title": "Please explain the behavior of this Parsec permutation parser", "body": "<p>Why does this <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Perm.html\" rel=\"nofollow\">Parsec permutation parser</a> not parse <strong>b</strong>?</p>\n\n<pre><code>p :: Parser (String, String)\np = permute (pair\n              &lt;$?&gt; (\"\", pa)\n              &lt;|?&gt; (\"\", pb))\n  where pair a b = (a, b)\n\npa :: Parser String\npa = do\n  char 'x'\n  many1 (char 'a')\n\npb :: Parser String\npb = do\n  many1 (char 'b')\n\n\u03bb&gt; parseTest p \"xaabb\"\n(\"aa\",\"bb\")               -- expected result, good\n\u03bb&gt; parseTest p \"aabb\"\n(\"\",\"\")                   -- why \"\" for b?\n</code></pre>\n\n<p>Parser <code>pa</code> is configured as optional via <code>&lt;$?&gt;</code> so I don't understand why its failing has impacted the parsing of <strong>b</strong>. I can change it to <code>optional (char 'x')</code> to get the expected behavior, but I don't understand why.</p>\n\n<pre><code>pa :: Parser String\npa = do\n  optional (char 'x')\n  many1 (char 'a')\n\npb :: Parser String\npb = do\n  optional (char 'x')\n  many1 (char 'b')\n\n\u03bb&gt; parseTest p \"xaaxbb\"\nparse error at (line 1, column 2):\nunexpected \"a\"\nexpecting \"b\"\n\u03bb&gt; parseTest p \"xbbxaa\"\n(\"aa\",\"bb\")\n</code></pre>\n\n<p>How can both input orderings be supported when we have identical shared prefix \"x\"?</p>\n\n<p>I also don't understand the impact that consumption of the optional \"x\" is having on the parse behavior:</p>\n\n<pre><code>pb :: Parser String\npb = do\n  try px -- with this try x remains unconsumed and \"aa\" gets parsed\n         -- without this try x is consumed, but \"aa\" isn't parsed even though \"x\" is optional anyway\n  many1 (char 'b')\n\npx :: Parser Char\npx = do\n  optional (char 'x')\n  char 'x' &lt;?&gt; \"second x\"\n\n\u03bb&gt; parseTest p \"xaaxbb\"            -- without try on px\nparse error at (line 1, column 2):\nunexpected \"a\"\nexpecting second x\n\u03bb&gt; parseTest p \"xaaxbb\"            -- with try on px\n(\"aa\",\"\")\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "types", "f#", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1467825952, "post_id": 38230023, "comment_id": 63881913, "body": "Possibly relevant: <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\"><code>Data.Sequence</code></a>"}, {"owner": {"reputation": 3324, "user_id": 1231925, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/87536e65cd08274bada37158cbcb0629?s=128&d=identicon&r=PG", "display_name": "Jwosty", "link": "https://stackoverflow.com/users/1231925/jwosty"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467826554, "post_id": 38230023, "comment_id": 63882255, "body": "@chi How does it work? I guess I poorly phrased that last part, in that I&#39;d like to use this thing in F#, but I don&#39;t have much of an idea of how Data.Sequence is actually defined. It looks like the operations are pretty close to what I want though."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1467826772, "post_id": 38230023, "comment_id": 63882363, "body": "@Jwosty If you want to look at the implementation, you can click on the &quot;source&quot; button on the side and it will take you to it: <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/src/Data.Sequence.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.7.1/docs/src/&hellip;</a>"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467826874, "post_id": 38230023, "comment_id": 63882421, "body": "I think a list is really what you want to use. Take a look at <a href=\"http://programmers.stackexchange.com/questions/222316/is-there-any-particular-reason-for-the-use-of-lists-over-queues-in-functional-pr\">this Programmers.SE post</a> discussing this topic more."}, {"owner": {"reputation": 3324, "user_id": 1231925, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/87536e65cd08274bada37158cbcb0629?s=128&d=identicon&r=PG", "display_name": "Jwosty", "link": "https://stackoverflow.com/users/1231925/jwosty"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467827038, "post_id": 38230023, "comment_id": 63882535, "body": "@jkeuhlen Thanks. I was hoping that there&#39;d be a nice type of queue, but I&#39;ve been using just a plain list so far. Looks like lists it is!"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1467828901, "post_id": 38230023, "comment_id": 63883550, "body": "see <a href=\"http://stackoverflow.com/questions/37505725\">stackoverflow.com/questions/37505725</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467830565, "post_id": 38230023, "comment_id": 63884529, "body": "@Jwosty The associated algorithm is described in the paper linked at the beginning in the documentation. It is a non-trivial result to achieve a good performance without mutability, in a functional way."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1467836627, "post_id": 38230477, "comment_id": 63887852, "body": "I wouldn&#39;t say this is inefficient. All the operations are amortized O(1), as demonstrated in the book you recommend. There is an occasional expensive <code>reverse</code> operation, but those are proven to be rare enough that your average time is low."}, {"owner": {"reputation": 3324, "user_id": 1231925, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/87536e65cd08274bada37158cbcb0629?s=128&d=identicon&r=PG", "display_name": "Jwosty", "link": "https://stackoverflow.com/users/1231925/jwosty"}, "edited": false, "score": 0, "creation_date": 1467843993, "post_id": 38230477, "comment_id": 63891222, "body": "I like this. Thanks!"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1467892094, "post_id": 38230477, "comment_id": 63910321, "body": "Okasaki queue maintains the <i>invariance</i> that the front list can be empty only if the back list is also empty and uses this invariance in his amortized performance analysis. (see <code>fill</code> function in <a href=\"http://stackoverflow.com/a/37505858/625914\">here</a>). You are violating this invariance."}], "tags": [], "owner": {"reputation": 11019, "user_id": 418488, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/625af9d6f5c5062f65a43582b57c041d?s=128&d=identicon&r=PG", "display_name": "Just another metaprogrammer", "link": "https://stackoverflow.com/users/418488/just-another-metaprogrammer"}, "is_accepted": false, "score": 11, "last_activity_date": 1533386704, "last_edit_date": 1533386704, "creation_date": 1467827234, "answer_id": 38230477, "question_id": 38230023, "link": "https://stackoverflow.com/questions/38230023/functional-queue-type/38230477#38230477", "title": "Functional queue type", "body": "<p>By functional I assume you mean an immutable queue?</p>\n\n<p>If you use F# and .NET there are for example:</p>\n\n<ul>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/dn467186(v=vs.111).aspx\" rel=\"nofollow noreferrer\">ImmutableQueue&lt;></a></li>\n<li><a href=\"https://github.com/fsprojects/FSharpx.Collections/blob/master/src/FSharpx.Collections/Queue.fsi\" rel=\"nofollow noreferrer\">FSharpX.Collections.Queue&lt;></a></li>\n</ul>\n\n<p>If you like to read on how to implement a functional queue I recommend <a href=\"https://rads.stackoverflow.com/amzn/click/com/0521663504\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Purely Functional Data Structures</a> by Chris Okasaki.</p>\n\n<p>One of the first ways Okasaki implements a functional queue is using two <code>List&lt;&gt;</code>, one you pop from and one you push to. When the pop list is empty the push queue is reversed and becomes the pop list. </p>\n\n<p>Bear in mind this is in many ways a rather inefficient queue but it's also rather simple:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Queue&lt;'T&gt; = 'T list*'T list\n\nlet empty&lt;'T&gt; : Queue&lt;'T&gt; = [], []\n\nlet isEmpty ((f, r) : Queue&lt;'T&gt;) : bool =\n  match f, r with\n  | []    , []  -&gt; true\n  | _     , _   -&gt; false\n\nlet headAndTail ((f, r) : Queue&lt;'T&gt;) : 'T*Queue&lt;'T&gt; =\n  match f, r with\n  | []    , []  -&gt; failwith \"Queue is empty\"\n  | v::vs , r   -&gt; v, (vs, r)\n  | _     , r   -&gt; let v::vs = List.rev r in v, (vs, [])\n\nlet snoc ((f, r) : Queue&lt;'T&gt;) (v : 'T) : Queue&lt;'T&gt; = (f, v::r)\n\nlet fold (f : 'S -&gt; 'T -&gt; 'S) (s : 'S) (q : Queue&lt;'T&gt;) : 'S =\n  let rec loop ss qq =\n    if isEmpty qq then ss\n    else\n      let hh, tt = headAndTail qq\n      loop (f ss hh) tt\n  loop s q\n\nlet ofArray (vs : 'T []) : Queue&lt;'T&gt; = vs |&gt; Array.fold snoc empty\n\n[&lt;EntryPoint&gt;]\nlet main argv = \n  let q = [| 1..20 |] |&gt; ofArray\n  fold (fun _ v -&gt; printfn \"%A\" v) () q\n  0\n</code></pre>\n"}], "owner": {"reputation": 3324, "user_id": 1231925, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/87536e65cd08274bada37158cbcb0629?s=128&d=identicon&r=PG", "display_name": "Jwosty", "link": "https://stackoverflow.com/users/1231925/jwosty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "closed_date": 1467844182, "answer_count": 1, "score": 5, "last_activity_date": 1533386704, "creation_date": 1467825775, "last_edit_date": 1467827085, "question_id": 38230023, "link": "https://stackoverflow.com/questions/38230023/functional-queue-type", "closed_reason": "Duplicate", "title": "Functional queue type", "body": "<p>I would like to represent a kind of queue data structure functionally, but I haven't really gotten anywhere. I've looked into Zippers but they don't seem to be the right structure.</p>\n\n<p>Specifically, I'm trying to represent a series of delay lines (for audio effects like echo or reverb), so the functionality needed is as follows:</p>\n\n<ol>\n<li>Append data to the front</li>\n<li>Remove the last item (can just be thrown away)</li>\n</ol>\n\n<p>For my particular use, these two operations would be used in conjunction as to keep the queue a constant size, but this constraint is not fundamental. I could just use a list, but I'm thinking there's got to be something cleaner than that. What is the best way to represent this type?</p>\n\n<p>I'm using F#, but any language is welcome.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1467823829, "last_edit_date": 1467823829, "creation_date": 1467823322, "answer_id": 38229287, "question_id": 38229211, "link": "https://stackoverflow.com/questions/38229211/how-can-i-represent-data-with-optional-fields-at-the-type-level/38229287#38229287", "title": "How can I represent data with optional fields at the type-level?", "body": "<p>Would something like this satisfy your requirements?</p>\n\n<pre><code>import Control.Applicative (Const)\nimport Data.Functor.Identity\n\ndata MyData kv kr a = MyData\n  {value :: a\n  ,validator :: kv (a -&gt; Bool)\n  ,refresher :: kr (MyData a -&gt; MyData a)}\n\n-- examples\ntype FullData a      = Data Identity   Identity   a\ntype EmptyData a     = Data (Const ()) (Const ()) a\ntype ValidableData a = Data Identity   (Const ()) a\n</code></pre>\n\n<p>Some wrapping/unwrapping required (for <code>Identity</code>).</p>\n\n<p>It is possible to define mnemonic aliases <code>type Present = Identity</code> and <code>type Missing = Const ()</code>, with a few extensions on.</p>\n\n<hr>\n\n<p>Alternatively,</p>\n\n<pre><code>data MyData (v :: Opt) (r :: Opt) a = MyData\n  {value :: a\n  ,validator :: Validator v a\n  ,refresher :: Refresher r a}\n\ndata Opt = Yes | No\n\ntype family Validator (o :: Opt) a where\n    Validator Yes = (a -&gt; Bool)\n    Validator No  = ()\n-- etc.\n\n-- examples\ntype FullData a      = Data Yes Yes a\ntype EmptyData a     = Data No  No  a\ntype ValidableData a = Data Yes No  a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 2, "last_activity_date": 1467829118, "creation_date": 1467829118, "answer_id": 38231030, "question_id": 38229211, "link": "https://stackoverflow.com/questions/38229211/how-can-i-represent-data-with-optional-fields-at-the-type-level/38231030#38231030", "title": "How can I represent data with optional fields at the type-level?", "body": "<p>I ended up with a variation from chi's answer:</p>\n\n<pre><code>data Opt = Yes | No\n\ntype family TOpt (o :: Opt) a where\n  TOpt Yes a = a\n  TOpt No a = ()\n</code></pre>\n\n<p>And then something like this:</p>\n\n<pre><code>data MyData (v :: Opt) a = MyData\n  {val :: a\n  ,validator :: TOpt v (MyData 'Yes a -&gt; Bool)\n  ...\n  }\n</code></pre>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 2, "accepted_answer_id": 38229287, "answer_count": 2, "score": 4, "last_activity_date": 1467829118, "creation_date": 1467823045, "question_id": 38229211, "link": "https://stackoverflow.com/questions/38229211/how-can-i-represent-data-with-optional-fields-at-the-type-level", "title": "How can I represent data with optional fields at the type-level?", "body": "<p>I'm working on a data for control flow that has a value (polymorphic, can be whatever), and it also <em>could</em> have a validator function that checks if the value is still good, and <em>could</em> have a function that \"refreshes the value\" (returns a new data with a new value).</p>\n\n<p>In vanilla Haskell it can look like this:</p>\n\n<pre><code>data MyData a = MyData\n  {value :: a\n  ,validator :: Maybe (a -&gt; Bool)\n  ,refresher :: Maybe (MyData a -&gt; MyData a)}\n</code></pre>\n\n<p>What I actually want are these types:</p>\n\n<pre><code>data Refreshable = Refreshable | NotRefreshable\ndata Validatable = Validatable | NotValidatable\nMyData (r :: Refreshable) (v :: Validatable)\n</code></pre>\n\n<p>I've done just that but only with <code>Refreshable</code>. I want to do it with <code>Validatable</code> too but I'm having a problem with constructors. Just for <code>Refreshable</code> I need to have two constructors, one for refreshable data and another for non-refreshable data. With validatable, I'll need to have 4 constructors! (for refreshable and validatable, for non-refreshable and validatable, for validatable and non-refreshable, and for non-refreshable and non-validatable). And imagine if I'll need another optional field later. Even worse: almost all the fields are the same except for the ones that are changing so there's so much duplication.</p>\n\n<hr />\n\n<p>I've also tried to amend the situation with typeclasses / type-families.<br>\nFor example, <code>MyData 'Refreshable 'NotValidatable</code> just becomes <code>Refreshable data =&gt; data</code> and I could instance <code>MyData</code> or just remove it for more specific-data that can be an instance.</p>\n\n<p>This is also problematic, because they're not really fields anymore; i.e. I can't take a data without a validator and change it to the same data <em>with</em> a validator (not at the type-level).</p>\n\n<hr />\n\n<p>This is probably an XY problem; I think a cleaner approach would be to make data types like <code>Refreshable a</code> and <code>Validatable a</code> and compose them in <code>MyData</code> but I don't know how to do that. I can't wrap them because order would change everything.</p>\n\n<p>Is there a clean way to do this? or should I just stick with the 4 constructors? or maybe Haskell isn't ready for this type of things yet? (no pun intended :P).</p>\n"}, {"tags": ["haskell", "docker", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": true, "score": 7, "last_activity_date": 1480288762, "last_edit_date": 1480288762, "creation_date": 1467822032, "answer_id": 38228905, "question_id": 38228309, "link": "https://stackoverflow.com/questions/38228309/how-to-use-stack-image-container/38228905#38228905", "title": "How to use stack image container?", "body": "<p>The executable I was building locally (OSX) was not runnable on the docker container. The solution was to build with docker. I changed stack.yaml to the following: </p>\n\n<pre><code># we have to switch to an LTS resolver, because the stack-build\n# docker image doesn't support nightly. \nresolver: lts-6.6\n\ndocker:\n  enable: true\n\nimage:\n  container:\n    name: haskell-docker-example\n    base: fpco/stack-run\n</code></pre>\n\n<p>Then I rebuilt, now using the docker image</p>\n\n<pre><code>stack build\nstack image container\n</code></pre>\n\n<p>And it runs great! Looks like you need to manually specify that you want to run the executable though:</p>\n\n<pre><code>docker run -it -p 8010:8010 haskell-docker-example /usr/local/bin/haskell-docker-example-exe\n</code></pre>\n\n<p>Alternatively, run stack with <code>--docker</code>, which will override the docker setting in stack.yml (also you don't need to run <code>stack build separately</code>):</p>\n\n<pre><code>stack --docker image container\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1605, "favorite_count": 2, "accepted_answer_id": 38228905, "answer_count": 1, "score": 5, "last_activity_date": 1480288762, "creation_date": 1467820276, "last_edit_date": 1467820790, "question_id": 38228309, "link": "https://stackoverflow.com/questions/38228309/how-to-use-stack-image-container", "title": "How to use stack image container?", "body": "<p>Stack can build a docker container to run your app on a server with the <code>stack image container</code> command (See references below). </p>\n\n<p><em>How do I connect to the web server in the docker container created this way?</em></p>\n\n<p>I've build a simple app to demonstrate the issue. See the complete code here: <a href=\"https://github.com/seanhess/haskell-docker-example\" rel=\"nofollow\">https://github.com/seanhess/haskell-docker-example</a></p>\n\n<p>This app was built from <code>stack new</code> with minimal changes. Here's Main.hs</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Network.Wai\nimport Network.HTTP.Types (status200)\nimport qualified Network.Wai.Handler.Warp as Warp\n\nmain :: IO ()\nmain = Warp.run 8010 app\n\napp :: Application\napp req respond = do\n    (putStrLn $ \"Request: \" ++ (show req))\n    (respond $ responseLBS status200 [] \"Hello World\")\n</code></pre>\n\n<p>And stack.yaml</p>\n\n<pre><code>resolver: nightly-2016-06-12\n\nimage:\n  container:\n    name: haskell-docker-example\n    base: fpco/stack-run\n</code></pre>\n\n<p>This app responds with \"Hello world\" if you run it locally. </p>\n\n<pre><code>stack build\nstack exec haskell-docker-example\n</code></pre>\n\n<p>But if you build the docker image and start it:</p>\n\n<pre><code>stack image container\ndocker run -it -p 8010:8010 haskell-docker-example\n</code></pre>\n\n<p>Requests reach the docker container, but we get an empty response error because there's nothing behind it.</p>\n\n<pre><code>$ curl -i http://localhost:8010\ncurl: (52) Empty reply from server\n</code></pre>\n\n<p>References: </p>\n\n<ul>\n<li><a href=\"http://www.yesodweb.com/blog/2015/12/yesod-hosting-docker-kubernetes\" rel=\"nofollow\">http://www.yesodweb.com/blog/2015/12/yesod-hosting-docker-kubernetes</a></li>\n<li><a href=\"https://github.com/commercialhaskell/stack/issues/2337\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/2337</a></li>\n<li><a href=\"http://docs.haskellstack.org/en/stable/GUIDE/#docker\" rel=\"nofollow\">http://docs.haskellstack.org/en/stable/GUIDE/#docker</a></li>\n</ul>\n\n<p><strong>Update</strong>: I'm poking around more. When I attach to the running container, my app is definitely not running. If I attempt to execute it by hand I get the following error:</p>\n\n<pre><code>/usr/local/bin/haskell-docker-example-exe\nbash: /usr/local/bin/haskell-docker-example-exe: cannot execute binary file: Exec format error\n</code></pre>\n\n<p>Some googling suggests this can come when trying to execute 64 bit code on a 32 bit system. Is that possible? If it matters I'm on mac osx. </p>\n"}, {"tags": ["haskell", "redis"], "answers": [{"tags": [], "owner": {"reputation": 4171, "user_id": 4483094, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100002407111718/picture?type=large", "display_name": "Karthikeyan Gopall", "link": "https://stackoverflow.com/users/4483094/karthikeyan-gopall"}, "is_accepted": false, "score": 0, "last_activity_date": 1467820763, "creation_date": 1467820763, "answer_id": 38228470, "question_id": 38228263, "link": "https://stackoverflow.com/questions/38228263/how-to-subscribe-to-multiple-redis-channels-in-the-same-function/38228470#38228470", "title": "How to subscribe to multiple Redis channels in the same function?", "body": "<p>Use pattern subscription <a href=\"http://redis.io/commands/psubscribe\" rel=\"nofollow\">http://redis.io/commands/psubscribe</a></p>\n\n<pre><code>psubscribe chan*\n</code></pre>\n\n<p>Hope this helps </p>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 3085914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdaMd.jpg?s=128&g=1", "display_name": "Zyxoas", "link": "https://stackoverflow.com/users/3085914/zyxoas"}, "edited": false, "score": 0, "creation_date": 1467823450, "post_id": 38228765, "comment_id": 63880406, "body": "Hmm... So this is an undocumented feature of the <code>hedis</code> implementation? Or is it something it inherits from <code>redis</code>?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 145, "user_id": 3085914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdaMd.jpg?s=128&g=1", "display_name": "Zyxoas", "link": "https://stackoverflow.com/users/3085914/zyxoas"}, "edited": false, "score": 1, "creation_date": 1467825592, "post_id": 38228765, "comment_id": 63881685, "body": "A little of column A, a little of column B. It actually is documented (just not in the <code>pubSub</code> function itself), and is intentional behavior given Redis&#39; PubSub semantics. Check out the <b>Enforced Pub/Sub semantics</b> section in the description of the <a href=\"http://hackage.haskell.org/package/hedis\" rel=\"nofollow noreferrer\"><code>hedis</code> package on Hackage</a>."}, {"owner": {"reputation": 145, "user_id": 3085914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdaMd.jpg?s=128&g=1", "display_name": "Zyxoas", "link": "https://stackoverflow.com/users/3085914/zyxoas"}, "edited": false, "score": 0, "creation_date": 1468004826, "post_id": 38228765, "comment_id": 63966861, "body": "Although @ErikR&#39;s answer is correct -- in that it explains using the source code why this behaviour is so -- this answer actually explains the behaviour at a higher level, and gives a code snippet to get the desired result. So I shall accept this one.  Thanks."}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 2, "last_activity_date": 1467821671, "creation_date": 1467821671, "answer_id": 38228765, "question_id": 38228263, "link": "https://stackoverflow.com/questions/38228263/how-to-subscribe-to-multiple-redis-channels-in-the-same-function/38228765#38228765", "title": "How to subscribe to multiple Redis channels in the same function?", "body": "<p>You need to subscribe to both channels in a single action.</p>\n\n<pre><code>pubSub (subscribe [\"chan1\", \"chan2\"]) $ \\msg -&gt; do\n</code></pre>\n\n<p>Hedis isn't reaching your second call to <code>pubSub</code>. You can see from <a href=\"http://hackage.haskell.org/package/hedis-0.9.1/docs/src/Database-Redis-PubSub.html#pubSub\" rel=\"nofollow\"><code>pubSub</code>'s definition</a> that unless the subscription count and pending messages are both drained the function will not return. Notice also that there is no forking or other method of enabling concurrency.</p>\n"}, {"comments": [{"owner": {"reputation": 2996, "user_id": 914284, "user_type": "registered", "accept_rate": 9, "profile_image": "https://graph.facebook.com/1080045267/picture?type=large", "display_name": "Hamit YILDIRIM", "link": "https://stackoverflow.com/users/914284/hamit-yildirim"}, "edited": false, "score": 0, "creation_date": 1553173357, "post_id": 38229423, "comment_id": 97291838, "body": "hey i added an example for anyone who needs <a href=\"https://stackoverflow.com/questions/53146582/stackexchange-redis-how-to-subscribe-to-multiple-channels/55281008#\" title=\"stackexchange redis how to subscribe to multiple channels\">stackoverflow.com/questions/53146582/&hellip;</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1467823806, "creation_date": 1467823806, "answer_id": 38229423, "question_id": 38228263, "link": "https://stackoverflow.com/questions/38228263/how-to-subscribe-to-multiple-redis-channels-in-the-same-function/38229423#38229423", "title": "How to subscribe to multiple Redis channels in the same function?", "body": "<p>The <code>pubSub</code> action blocks until its action removes all subscriptions.</p>\n\n<p>You can see how this works by looking at the pubSub test in the hedis test suite:</p>\n\n<p><a href=\"https://github.com/informatikr/hedis/blob/e86143db2d4e76fe85340c78c01da7bc3722ae5a/test/Test.hs#L385\" rel=\"nofollow\">https://github.com/informatikr/hedis/blob/e86143db2d4e76fe85340c78c01da7bc3722ae5a/test/Test.hs#L385</a></p>\n\n<p>A trace of what goes on in the test:</p>\n\n<ul>\n<li>A thread is forked to send two events one second apart - first a <code>chan1</code> event and then a <code>chan2</code> event</li>\n<li>The first <code>pubSub</code> establishes a listener for <code>chan1</code> events.</li>\n<li>When it receives the <code>chan1</code> event it changes its subscription to a pattern subscription.</li>\n<li>When the <code>chan2</code> event arrives it cancels all subscriptions. Then \"control\" goes to the next pubSub action.</li>\n<li>The second pubSub action has no subscriptions so it exits immediately.</li>\n</ul>\n"}], "owner": {"reputation": 145, "user_id": 3085914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdaMd.jpg?s=128&g=1", "display_name": "Zyxoas", "link": "https://stackoverflow.com/users/3085914/zyxoas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1564, "favorite_count": 0, "accepted_answer_id": 38228765, "answer_count": 3, "score": 1, "last_activity_date": 1467823806, "creation_date": 1467820164, "question_id": 38228263, "link": "https://stackoverflow.com/questions/38228263/how-to-subscribe-to-multiple-redis-channels-in-the-same-function", "title": "How to subscribe to multiple Redis channels in the same function?", "body": "<p>Running Redis 3.2.1 and the latest Hedis library, I have the following publisher program:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Database.Redis\nimport Control.Monad\nimport Control.Concurrent\nimport Control.Monad.Trans\nimport Data.ByteString as BS\nimport System.Posix.Process\nimport Data.String.Conv\n\nmain :: IO ()\nmain = do\n  conn &lt;- connect defaultConnectInfo\n  runRedis conn run\n\nrun = do\n    liftIO $ threadDelay $ 1000 * 1000\n    pid &lt;- liftIO getProcessID\n    publish \"chan1\" (toS $ show pid)\n    publish \"chan2\" (toS $ show pid)\n    liftIO $ Prelude.putStrLn \"\\n\\n%%%%%%%\\n\\nnext\\n\\n%%%%%%%%\\n\\n\"\n    run\n</code></pre>\n\n<p>The subscriber looks like this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Database.Redis\n\nmain :: IO ()\nmain = do\n  conn &lt;- connect defaultConnectInfo\n  runRedis conn $ do\n    pubSub (subscribe [\"chan1\"]) $ \\msg -&gt; do\n      putStrLn $ \"chan1 \" ++ show (msgChannel msg) ++ \": \" ++ show (msgMessage msg)\n      return mempty\n    pubSub (subscribe [\"chan2\"]) $ \\msg -&gt; do\n      putStrLn $ \"chan2\" ++ show (msgChannel msg) ++ \": \" ++ show (msgMessage msg)\n      return mempty\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>%%%%%%%\n\nnext\n\n%%%%%%%%\n\nchan1 \"chan1\": \"21542\"\n\n%%%%%%%\n\nnext\n\n%%%%%%%%\n\nchan1 \"chan1\": \"21542\"\n\n%%%%%%%\n\nnext\n\n%%%%%%%%\n\nchan1 \"chan1\": \"21542\"\n\n%%%%%%%\n\nnext\n\n%%%%%%%%\n</code></pre>\n\n<p>Now, it would appear that as soon as the subscriber reads the first channel, messages sent to the second channel are not read. Put another way, it would appear that the command to subscribe to <code>chan2</code> is simply ignored.</p>\n\n<p>For completeness, here's my <code>Cabal</code> file: </p>\n\n<pre><code>name:                pub-sub-exp\nversion:             0.1.0.0\nsynopsis:            Simple project template from stack\ndescription:         Please see README.md\nhomepage:            https://github.com/githubuser/pub-sub-exp#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2016 Author name here\ncategory:            Web\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable pub\n  hs-source-dirs:      src\n  main-is:             Pub.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       hedis,\n                       mtl,\n                       bytestring,\n                       unix,\n                       string-conv\n\nexecutable sub\n  hs-source-dirs:      src\n  main-is:             Sub.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       hedis,\n                       mtl,\n                       bytestring\n</code></pre>\n\n<p>I am using <code>stack-lts-6.6</code>.</p>\n\n<hr>\n\n<p>For clarification, I would like the subscriber to indicate that messages were sent to both channel 1 and 2.</p>\n\n<p>Is this a well-known property of Redis? Am I missing some Haskell gotcha?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467820027, "post_id": 38224436, "comment_id": 63878285, "body": "Isn&#39;t this case for <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec.html#v:many\" rel=\"nofollow noreferrer\"><code>many</code></a>?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467825093, "post_id": 38224436, "comment_id": 63881374, "body": "I&#39;m not really sure what your question is. Could you edit your post to make it more clear?"}, {"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467828087, "post_id": 38224436, "comment_id": 63883136, "body": "@Eric - could you be more specific? The permutation parser accepts empty strings, so a straight <code>many p</code> wouldn&#39;t work here. I have thought of trying to call the permutation parser on the inputs multiple times, accumulating the results as I go along, but I&#39;m not entirely sure how that would work."}], "answers": [{"comments": [{"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467885577, "post_id": 38234058, "comment_id": 63906082, "body": "Thanks Eric, this is a very helpful answer"}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 1, "last_activity_date": 1467840437, "creation_date": 1467840437, "answer_id": 38234058, "question_id": 38224436, "link": "https://stackoverflow.com/questions/38224436/how-can-i-parse-non-contiguous-elements-of-a-permutation-phrase-using-parsecs-p/38234058#38234058", "title": "How can I parse non-contiguous elements of a permutation phrase using Parsec&#39;s Perm?", "body": "<p>Depending on what you actually want, you may be able to use <code>many $ oneOf ['a','b','c']</code>.</p>\n\n<p>If you really need to use the permutation parser, keep in mind that allowing parses of multiple adjacent characters introduces ambiguity. For example, in the string <code>\"bacacbbca\"</code>, it could be parsed as the perms <code>bac</code>, <code>acb</code> <code>bca</code>, or, if you allow repeated characters, <code>bac</code>, <code>acbb</code>, with a leftover non-permutation of <code>ca</code>.</p>\n\n<p>If you allow repeated letters,</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Text.Parsec\nimport Text.Parsec.Char\nimport Text.Parsec.Perm\nimport Data.Text\nimport Control.Monad.Identity\n\nperm :: (Stream s Identity Char) =&gt; Parsec s u (String,String,String)\nperm = permute $ triple &lt;$$&gt;\n  (many1 $ char 'a') &lt;||&gt;\n  (many1 $ char 'b') &lt;||&gt;\n  (many1 $ char 'c')\n  where triple a b c = (a,b,c)\n\nmultiPerm :: (Stream s Identity Char) =&gt; Parsec s u [(String,String,String)]\nmultiPerm = many $ try $ perm\n\nmain :: IO ()\nmain = parseTest multiPerm $ \"bacacbbca\" \n</code></pre>\n\n<p><code>main</code> produces <code>[(\"a\",\"b\",\"c\"),(\"a\",\"bb\",\"c\")]</code>.</p>\n\n<p>If not:</p>\n\n<pre><code>perm :: (Stream s Identity Char) =&gt; Parsec s u (Char,Char,Char)\nperm = permute $ triple &lt;$$&gt;\n  (char 'a') &lt;||&gt;\n  (char 'b') &lt;||&gt;\n  (char 'c')\n  where triple a b c = (a,b,c)\n</code></pre>\n\n<p>you get the arguably better: <code>[('a','b','c'),('a','b','c'),('a','b','c')]</code>.</p>\n"}], "owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 38234058, "answer_count": 1, "score": 1, "last_activity_date": 1467840437, "creation_date": 1467809353, "last_edit_date": 1467827901, "question_id": 38224436, "link": "https://stackoverflow.com/questions/38224436/how-can-i-parse-non-contiguous-elements-of-a-permutation-phrase-using-parsecs-p", "title": "How can I parse non-contiguous elements of a permutation phrase using Parsec&#39;s Perm?", "body": "<p>Haskell's Parsec supports <a href=\"http://www.cs.uu.nl/groups/ST/Software/UU_Parsing/Perms2.pdf\" rel=\"nofollow\">parsing of permutation phrases</a> via the <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Perm.html\" rel=\"nofollow\">Perm</a> module. In the documentation for <code>permute</code> you can see how the various permutations \"abc\", \"aab\", \"bc\", \"cbaaaaa\", etc. can be parsed. While the example shows support for parting many contiguous instances of the same element like \"aaaa\", it won't parse non-contiguous instances like \"aabc<strong>a</strong>\", presumably because each parser is included only once in each permutation (the paper seems to imply this in the tree...)</p>\n\n<p>Besides sorting the input so like instances are contiguous, what options do I have for parsing non-contiguous instance?</p>\n"}, {"tags": ["haskell", "nixos"], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1467809355, "post_id": 38224362, "comment_id": 63870740, "body": "Seems you&#39;re right. Having removed <code>haskellPlatform</code> I still got <code>xmonadContrib</code> and <code>xmonadExtras</code> errors. Do they exist still in a different form? Removing those lets me install <code>xmonad</code> at least -- should I just install stack instead of <code>haskellPlatform</code>?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 1, "creation_date": 1467837956, "post_id": 38224362, "comment_id": 63888556, "body": "@atc <code>xmonad-contrib</code>, <code>xmonad-extras</code>."}], "tags": [], "owner": {"reputation": 2464, "user_id": 1076715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf07aa4cdf24f3a770c21cb26e61bc7f?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1076715/eric"}, "is_accepted": true, "score": 1, "last_activity_date": 1467809099, "creation_date": 1467809099, "answer_id": 38224362, "question_id": 38223706, "link": "https://stackoverflow.com/questions/38223706/nixos-configuration-environment-systempackages-cannot-find-haskellpackages/38224362#38224362", "title": "Nixos configuration: `environment.systemPackages` cannot find haskellPackages", "body": "<p><code>haskellPlatform</code> has been removed with the update to GHC 7.8.2, see the mailing list <a href=\"http://thread.gmane.org/gmane.linux.distributions.nixos/12972\" rel=\"nofollow\">thread</a> for more details.</p>\n\n<p>You should be able to install any package found via <code>nix-enf -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages</code> to <code>environment.systemPackages</code>.</p>\n\n<p>Searching for <code>haskellPackages.haskellPlatform</code> with <code>nix-env</code> should result in the same kind of error that you get during the rebuild:</p>\n\n<pre><code>nix-env -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages.haskellPlatform\nerror: attribute \u2018haskellPlatform\u2019 in selection path \u2018haskellPackages.haskellPlatform\u2019 not found\n</code></pre>\n\n<p>Any valid haskell package can be installed in the environment, for example <code>xmobar</code>:</p>\n\n<pre><code>environment.systemPackages = with pkgs; [\n  haskellPackages.xmobar\n];\n</code></pre>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 0, "accepted_answer_id": 38224362, "answer_count": 1, "score": 0, "last_activity_date": 1467809099, "creation_date": 1467807103, "question_id": 38223706, "link": "https://stackoverflow.com/questions/38223706/nixos-configuration-environment-systempackages-cannot-find-haskellpackages", "title": "Nixos configuration: `environment.systemPackages` cannot find haskellPackages", "body": "<p>I can find haskell packages via <code>nix-env</code>:</p>\n\n<pre><code>nix-enf -f \"&lt;nixpkgs&gt;\" -qaP -A haskellPackages\n...\n</code></pre>\n\n<p>yet when I try and install them using <code>environment.systemPackages</code> in <code>/etc/nixos/configuration.nix</code>:</p>\n\n<pre><code>environment.systemPackages = with pkgs; [\n  haskellPackages.haskellPlatform\n];\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>error: attribute 'haskellPlatform' missing, at /etc/nixos/configuration.nix:54:5\n</code></pre>\n\n<p>Any ideas? I am intending on using xmonad and want to do haskell dev'.</p>\n"}, {"tags": ["haskell", "lambda", "function-composition", "pointfree"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 3, "creation_date": 1467788877, "post_id": 38217999, "comment_id": 63859012, "body": "Your <code>withinBounds</code> is not composable, it is better to write the check for a single element and then call <code>all</code> on that. In fact, I would probably just inline <code>all withinBounds</code> where withinBounds is for a single element."}, {"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1467789571, "post_id": 38217999, "comment_id": 63859389, "body": "Thanks. Is there a tell-tale sign of the function not being composable? (for example the input being required in multiple places in the body?)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1467791273, "post_id": 38217999, "comment_id": 63860324, "body": "@MIJOTHY: usually, if the type is more general, it&#39;s likely more reusable, e.g. <code>withinBounds :: Ord e =&gt; (e, e) -&gt; e -&gt; Bool; withinBounds (a,b) x = a &lt;= x &amp;&amp; x &lt;= b</code>. Now your original function is simply <code>all (withinBounds (0,8))</code>. Furthermore, I can use this as predicate for a filter: <code>filter (withinBounds (4,100)) [1..103]</code>."}, {"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 0, "creation_date": 1467791518, "post_id": 38217999, "comment_id": 63860460, "body": "Yeah I can understand how general = more reusable, but I was wondering if there is a certain way to tell whether a function can be written in point-free (using the composition operator) or not. Perhaps my usage of &#39;composable&#39; is wrong. So to rephrase the question with the more general version you wrote, could I write <code>withinBounds (a,b) x = a &lt;= x &amp;&amp; x &lt;= b</code> in point-free?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1467791628, "post_id": 38217999, "comment_id": 63860530, "body": "@MIJOTHY: Yes, but you don&#39;t want to. <code>uncurry ((. flip (&lt;=)) . ap . ((&amp;&amp;) .) . (&lt;=))</code>. At the end, code is not only read by a computer, but by a human. The point-free version is not only longer, but also harder to grasp than the original one."}, {"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1467791702, "post_id": 38217999, "comment_id": 63860579, "body": "@Zeta I did mention that I realise it&#39;s not the best way to do it, but I&#39;d like to know the process as I&#39;m trying to learn about composition. Apologies if I was unclear."}, {"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1467848190, "post_id": 38217999, "comment_id": 63892477, "body": "@Zeta How did you arrive at your point-free solution? Is there a method for doing so, or it comes down to &quot;feel&quot;?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1467874431, "post_id": 38217999, "comment_id": 63899216, "body": "@MIJOTHY: Oh, sorry, I forgot to tell you. There is the <code>pointfree</code> package on Hackage, lambdabot on <code>#haskell</code>, and <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a>. That being said, I usually move parameters around till I end up with a eta-reducible function, e.g. <a href=\"http://stackoverflow.com/a/36542287/1139697\">stackoverflow.com/a/36542287/1139697</a>."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 0, "creation_date": 1467876767, "post_id": 38218330, "comment_id": 63900615, "body": "Why was my comment deleted/why has it disappeared?"}, {"owner": {"reputation": 522, "user_id": 1798418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd757728b040ad618b62c1a10735ed8c?s=128&d=identicon&r=PG", "display_name": "Safareli", "link": "https://stackoverflow.com/users/1798418/safareli"}, "reply_to_user": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 1, "creation_date": 1467887172, "post_id": 38218330, "comment_id": 63907141, "body": "have no idea :/ yesterday it had two upvotes, one from me"}], "tags": [], "owner": {"reputation": 522, "user_id": 1798418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd757728b040ad618b62c1a10735ed8c?s=128&d=identicon&r=PG", "display_name": "Safareli", "link": "https://stackoverflow.com/users/1798418/safareli"}, "is_accepted": false, "score": 9, "last_activity_date": 1467790906, "last_edit_date": 1495542772, "creation_date": 1467789763, "answer_id": 38218330, "question_id": 38217999, "link": "https://stackoverflow.com/questions/38217999/haskell-function-composition-a-b-a-c-b-c-d-a-d/38218330#38218330", "title": "Haskell Function Composition - (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)", "body": "<p>You could use the fact that function is Applicative.\nand write <code>withinBounds</code> this way:</p>\n\n<pre><code>withinBounds = pure (&amp;&amp;) &lt;*&gt; all (&gt;= 0) &lt;*&gt; all (&lt;= 8)\n</code></pre>\n\n<p>Or this  way:</p>\n\n<pre><code>withinBounds = (&amp;&amp;) &lt;$&gt; all (&gt;= 0) &lt;*&gt; all (&lt;= 8)\n</code></pre>\n\n<p>You could read about Applicatives <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://stackoverflow.com/questions/11810889/functions-as-applicative-functors-haskell-lyah\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 0, "creation_date": 1467848082, "post_id": 38220065, "comment_id": 63892442, "body": "Thanks, the diagram really helps too. I&#39;ll do some reading about arrow."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 9, "last_activity_date": 1467796655, "last_edit_date": 1467796655, "creation_date": 1467795759, "answer_id": 38220065, "question_id": 38217999, "link": "https://stackoverflow.com/questions/38217999/haskell-function-composition-a-b-a-c-b-c-d-a-d/38220065#38220065", "title": "Haskell Function Composition - (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)", "body": "<p>There's a class that's basically dedicated for point-free compositions<sup>\u2020</sup> with multiple \u201cchannels\u201d: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#t:Arrow\"><code>Arrow</code></a>. If you're determined to make everything point-free then this is IMO the way to go. The ugly bit about this is that you constantly need to uncurry functions:</p>\n\n<pre><code>import Control.Arrow\n\nwithinBounds = all (&gt;=0) &amp;&amp;&amp; all (&lt;=8) &gt;&gt;&gt; uncurry (&amp;&amp;)\n</code></pre>\n\n<p>How this works is best understood with a diagram:</p>\n\n<pre><code>      all (&gt;=0) \u2500\u2500\u2500\u2500\n       \u2571                \u2572\n\u2500\u2500\u2500\u2500 &amp;&amp;&amp;            &gt;&gt;&gt;  uncurry (&amp;&amp;) \u2500\u2500\u2500\n       \u2572                \u2571\n      all (&lt;=8) \u2500\u2500\u2500\u2500 \n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub><code>Arrow</code> works in a generalised setting; not just for <strong>Hask</strong>-functions but for any suitable category. But it's useful enough to apply it just to functions.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1467810204, "post_id": 38220080, "comment_id": 63871301, "body": "Does the down-voter care to explain the reason for the down vote, so that I can improve upon it? In fact this trick is quite useful in other similar tasks as well, and does not require such  advanced knowledge as other answers do."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467814061, "post_id": 38220080, "comment_id": 63873977, "body": "Well, OP said in the question body that the readability is not the concern here: he just wants to know how to write this in a point-less way.  Also, I added an explanation to go through the process of this function. Maybe I shall explain more? In any case, thanks for the reply."}], "tags": [], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "is_accepted": false, "score": -2, "last_activity_date": 1467797021, "last_edit_date": 1467797021, "creation_date": 1467795805, "answer_id": 38220080, "question_id": 38217999, "link": "https://stackoverflow.com/questions/38217999/haskell-function-composition-a-b-a-c-b-c-d-a-d/38220080#38220080", "title": "Haskell Function Composition - (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)", "body": "<p>Notice that x&lt;=8 if and only if 8-x>=0, so, using only prelude, we can write</p>\n\n<pre><code>withinBounds :: [Int] -&gt; Bool\nwithinBounds = all $ (all (&gt;=0)) . (zipWith (+) [0,8]) . (zipWith (*) [1,-1]) . (replicate 2)\n</code></pre>\n\n<p>Basically I just map <code>x</code> to <code>[x,x]</code> then to <code>[x,8-x]</code> and then I require these two to be >=0 simultaneously.</p>\n\n<p>Of course, as pointed out in the comments, you can also make <code>a,b</code> parameters so as to reuse them later.</p>\n\n<p>Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 0, "creation_date": 1467853175, "post_id": 38234948, "comment_id": 63893715, "body": "Oh I see! So since <code>liftA2 f a b = fmap f a &lt;*&gt; b</code> and <code>f &lt;$&gt; x = fmap f x</code>, <code>liftA2 f a b = f &lt;$&gt; a &lt;*&gt; b</code> this connects to @Safareli&#39;s answer nicely."}, {"owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "edited": false, "score": 0, "creation_date": 1467853952, "post_id": 38234948, "comment_id": 63893897, "body": "And because for ((-&gt;) r) <code>fmap = (.)</code>, it can also be written <code>withinBounds = (&amp;&amp;) . (all (&gt;= 0)) &lt;*&gt; (all (&lt;= 8))</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1467844826, "creation_date": 1467844826, "answer_id": 38234948, "question_id": 38217999, "link": "https://stackoverflow.com/questions/38217999/haskell-function-composition-a-b-a-c-b-c-d-a-d/38234948#38234948", "title": "Haskell Function Composition - (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)", "body": "<p>Doing an end-run around the whole question, I think I would probably write it this way:</p>\n\n<pre><code>import Data.Ix\nwithinBounds = all (inRange (0, 8))\n</code></pre>\n\n<p>Of course, that's punting a bit, since then one would naturally ask how to implement <code>inRange</code> in a pointfree way. If you absolutely couldn't use <code>inRange</code>, then I would implement it inline this way:</p>\n\n<pre><code>withinBounds = all (liftA2 (&amp;&amp;) (&gt;=0) (&lt;=8))\n</code></pre>\n\n<p>This uses the reader applicative to supply a single argument to two functions. <code>liftA2</code> is your requested combining function, though with arguments flipped:</p>\n\n<pre><code>requested :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)\nliftA2    :: (b -&gt; c -&gt; d) -&gt; (a -&gt; b) -&gt; (a -&gt; c) -&gt; (a -&gt; d)\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 4694604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t2ewf.jpg?s=128&g=1", "display_name": "MIJOTHY", "link": "https://stackoverflow.com/users/4694604/mijothy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 2, "accepted_answer_id": 38234948, "answer_count": 4, "score": 7, "last_activity_date": 1467852679, "creation_date": 1467788541, "last_edit_date": 1495540739, "question_id": 38217999, "link": "https://stackoverflow.com/questions/38217999/haskell-function-composition-a-b-a-c-b-c-d-a-d", "title": "Haskell Function Composition - (a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)", "body": "<p>I would like to learn how the following would be done in point-free:  </p>\n\n<pre><code>withinBounds :: [Int] -&gt; Bool\nwithinBounds xs = (all (&gt;= 0) xs) &amp;&amp; (all (&lt;= 8) xs)\n</code></pre>\n\n<p>I understand that it is superior to write it this way for readability/sanity's sake, but I'd like to learn more about how I can compose functions. I've been scratching my head as to how I can do this. \nThe whole (expanded?) type signature is  </p>\n\n<pre><code>[Int] -&gt; ([Int] -&gt; Bool) -&gt; ([Int] -&gt; Bool) -&gt; (Bool -&gt; Bool -&gt; Bool) -&gt; Bool\n</code></pre>\n\n<p>The type signature of the composition I'm trying to get to is</p>\n\n<pre><code>(a -&gt; b) -&gt; (a -&gt; c) -&gt; (b -&gt; c -&gt; d) -&gt; (a -&gt; d)\n</code></pre>\n\n<p>I wrote the following as notes in a bastard-lambda form. If there is a way to somewhat simplify the problem with the lambda calculus, it'd be great if that could be explained too:</p>\n\n<pre><code>\\L@[] -&gt;  \\f1@([] -&gt; Bool) -&gt; \\f2@([] -&gt; Bool) -&gt; \\f3@(Bool -&gt; Bool -&gt; Bool) -&gt; f3.(f1.L).(f2.L) \n</code></pre>\n\n<p>In the above, <code>.</code> is application, <code>@</code> is capturing (so f3 is another name for (Bool -> Bool -> Bool)). \nMany thanks.</p>\n\n<p>Edit: I know this is not the most optimal or reusable code, and I know turning this into point-free makes it worse in terms of readability etc. To clarify, I am asking how I can turn it into point-free <strong>because I want to learn more about haskell and composition</strong>.</p>\n\n<p>Edit2: <a href=\"https://stackoverflow.com/questions/20279306/what-does-f-g-mean-in-haskell?rq=1\">A really good SO answer on point-free</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 5, "creation_date": 1467760062, "post_id": 38214120, "comment_id": 63851951, "body": "do notation is not harmful. in fact, do-notation has been expanded to applicatives, so we&#39;re encouraging its use even more."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 1, "creation_date": 1467760269, "post_id": 38214120, "comment_id": 63852012, "body": "Every single answer on the question you linked says that <code>do</code> notation is useful and should not be avoided."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1467760102, "creation_date": 1467760102, "answer_id": 38214205, "question_id": 38214120, "link": "https://stackoverflow.com/questions/38214120/re-write-this-example-without-do/38214205#38214205", "title": "re-write this example without do", "body": "<p><code>do</code>-notation is pure syntactic sugar. It translates into calls to <code>&gt;&gt;=</code> in a pretty simple way. Quoting <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow\">the Haskell Report</a>:</p>\n\n<blockquote>\n  <p><strong>Translation</strong>: Do expressions satisfy these identities, which may be\n  used as a translation into the kernel, after eliminating empty <code>stmts</code>:</p>\n\n<pre><code>do {e}    =   e\ndo {e;stmts}  =   e &gt;&gt; do {stmts}\ndo {p &lt;- e; stmts}    =   let ok p = do {stmts}\n    ok _ = fail \"...\"\n  in e &gt;&gt;= ok\ndo {let decls; stmts} =   let decls in do {stmts}\n</code></pre>\n</blockquote>\n\n<p>This means your example would look like this:</p>\n\n<pre><code>main = mainWidget $ el \"div\" $\n  textInput def &gt;&gt;= $ \\t -&gt;\n  dynText $ _textInput_value t\n</code></pre>\n\n<p>There's nothing harmful about <code>do</code>-notation. I don't know where you got that idea from! It's literally a different way of writing the same code. </p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1467760166, "answer_count": 1, "score": 0, "last_activity_date": 1467760158, "creation_date": 1467759470, "last_edit_date": 1495542148, "question_id": 38214120, "link": "https://stackoverflow.com/questions/38214120/re-write-this-example-without-do", "closed_reason": "Duplicate", "title": "re-write this example without do", "body": "<p>I am reading that Haskell's <a href=\"https://stackoverflow.com/questions/16726659/should-do-notation-be-avoided-in-haskell\">do notation is quite harmful</a>.  Since I am still learning Haskell, I would like to not make bad habits.  I am learning a library called Reflex and is an example:</p>\n\n<pre><code>import Reflex.Dom\n\nmain = mainWidget $ el \"div\" $ do\n  t &lt;- textInput def\n  dynText $ _textInput_value t\n</code></pre>\n\n<p>I am <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow noreferrer\">reading</a> that <strong>do</strong> notation has to do with the presence of monads such as <code>IO</code> and has to do with <a href=\"https://stackoverflow.com/questions/9932913/bindings-in-do-notation\"><code>&lt;-</code></a> and <code>$</code> operators.</p>\n\n<p>How could I write these few lines without <code>do</code> ?</p>\n\n<hr>\n\n<p>If you support <code>do</code>... could you explain it's use in Haskell and this example?</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 56, "user_id": 1968694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f708e13377c3fc2a163cb502dce8f94e?s=128&d=identicon&r=PG", "display_name": "dysinger", "link": "https://stackoverflow.com/users/1968694/dysinger"}, "edited": false, "score": 0, "creation_date": 1467754145, "post_id": 38213058, "comment_id": 63850072, "body": "An Object is already a HashMap (in Aeson). Just lookup the Value you need.  If that&#39;s not enough you could parse the JSON into an Either String Int"}], "tags": [], "owner": {"reputation": 56, "user_id": 1968694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f708e13377c3fc2a163cb502dce8f94e?s=128&d=identicon&r=PG", "display_name": "dysinger", "link": "https://stackoverflow.com/users/1968694/dysinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1467754080, "creation_date": 1467754080, "answer_id": 38213058, "question_id": 38212931, "link": "https://stackoverflow.com/questions/38212931/aeson-decode-json-object-that-can-be-either-a-string-or-an-int/38213058#38213058", "title": "Aeson decode JSON object that can be either a string or an int", "body": "<p>You'll just have to use the Aeson Value type to work with an Object with fields that can be any JSON value.</p>\n"}, {"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467754429, "post_id": 38213066, "comment_id": 63850198, "body": "If I understand your alternative parse method correctly, it would just coerce the integer values to a string type right? So &quot;Value&quot;:3 would translate to something like KVPair {value = &quot;3&quot;} right?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1467757804, "post_id": 38213066, "comment_id": 63851336, "body": "@jkeuhlen Exactly right, though &quot;coerce&quot; has a specific meaning in Haskell that doesn&#39;t apply here -- &quot;convert&quot; or &quot;pretty-print&quot; would be closer to correct."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1467754108, "creation_date": 1467754108, "answer_id": 38213066, "question_id": 38212931, "link": "https://stackoverflow.com/questions/38212931/aeson-decode-json-object-that-can-be-either-a-string-or-an-int/38213066#38213066", "title": "Aeson decode JSON object that can be either a string or an int", "body": "<p>There are two simple fixes. One is to simply write</p>\n\n<pre><code>data KVPair = KVPair { key :: Int, value :: Value }\n</code></pre>\n\n<p>and leave all other code the same. Consumers will need to check the <code>Value</code> to see whether it is a string-y thing or a number-y thing.</p>\n\n<p>Probably the better way is to simply provide two alternative parsers that both convert to your desired format. For example, keeping your <code>KVPair</code> definition as is, one might write</p>\n\n<pre><code>showInt :: Int -&gt; String\nshowInt = show\n\ninstance FromJSON KVPair where\n    parseJSON (Object v)\n        =   KVPair\n        &lt;$&gt; v .: \"Key\"\n        &lt;*&gt; (v .: \"Value\" &lt;|&gt; (showInt &lt;$&gt; v .: \"Value\"))\n</code></pre>\n\n<p>The best of both worlds would be to keep the information about whether it's a <code>String</code> or <code>Int</code> around <em>and</em> to reject other kinds of values; e.g.</p>\n\n<pre><code>data KVPair = KVPair { key :: Int, value :: Either String Int }\n\ninstance FromJSON KVPair where\n    parseJSON (Object v)\n        =   KVPair\n        &lt;$&gt; v .: \"Key\"\n        &lt;*&gt; (   (Left  &lt;$&gt; v .: \"Value\")\n            &lt;|&gt; (Right &lt;$&gt; v .: \"Value\")\n            )\n</code></pre>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1124, "favorite_count": 0, "accepted_answer_id": 38213066, "answer_count": 2, "score": 3, "last_activity_date": 1467754108, "creation_date": 1467753614, "question_id": 38212931, "link": "https://stackoverflow.com/questions/38212931/aeson-decode-json-object-that-can-be-either-a-string-or-an-int", "title": "Aeson decode JSON object that can be either a string or an int", "body": "<p>I'm working with some complexly formatted JSON responses from a REST server. To decode them, I have a couple of data types to handle the different nested objects. For example:</p>\n\n<pre><code>... Other types ...\n\ndata Profile =\n  Profile { fields :: [KVPair]\n  } deriving (Show)\n\ninstance FromJSON Profile where\n  parseJSON (Object v) =\n    Profile &lt;$&gt; v .: \"Fields\" \n  parseJSON _ = mzero\n\ndata KVPair =\n  KVPair { key :: Int\n         , value :: String\n  } deriving (Show)\n\ninstance FromJSON KVPair where\n  parseJSON (Object v) =\n    KVPair &lt;$&gt; v .: \"Key\"\n           &lt;*&gt; v .: \"Value\" \n  parseJSON _ = mzero\n</code></pre>\n\n<p>Everything works except for the final KVPair type. My JSON objects all have integer keys; however, the values can be either an integer or a string: </p>\n\n<pre><code>      {\n        \"Key\": 0,\n        \"Value\": \"String Value!\"\n      },\n      {\n        \"Key\": 1,\n        \"Value\": 42\n      }\n</code></pre>\n\n<p>Now I suppose I could add another sum type to my value decode that is composed of <code>String</code> and <code>Int</code>, but I would prefer to avoid adding a whole new type just for that. <strong>Does Aeson have a simple way to handle this scenario?</strong></p>\n"}, {"tags": ["haskell", "types", "io", "monad-transformers"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467752502, "post_id": 38212294, "comment_id": 63849391, "body": "AFAIK <code>transformers</code> is Haskell 98 which does <b>not</b> include multiparameter type classes, so your example &quot;isn&#39;t allowed&quot; according to this restriction.  The <code>mtl</code> library provides some typeclasses like <code>MonadState</code> and a few instances that allow you to avoid lifting many times."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1467753075, "creation_date": 1467753075, "answer_id": 38212805, "question_id": 38212294, "link": "https://stackoverflow.com/questions/38212294/why-is-monadio-specific-to-io-rather-than-a-more-generic-monadtrans/38212805#38212805", "title": "Why is MonadIO specific to IO, rather than a more generic MonadTrans?", "body": "<blockquote>\n  <p>But, this specificity for <code>IO</code> seems very weird</p>\n</blockquote>\n\n<p>I challenge the assumption that this is specific to <code>IO</code>. I also see many other classes in <code>mtl</code>. For example:</p>\n\n<pre><code>class Monad m =&gt; MonadError e m | m -&gt; e where\n    throwError :: e -&gt; m a\n    catchError :: m a -&gt; (e -&gt; m a) -&gt; m a\n\nclass Monad m =&gt; MonadState s m | m -&gt; s where\n    get :: m s\n    put :: s -&gt; m ()\n    state :: (s -&gt; (a, s)) -&gt; m a\n</code></pre>\n\n<p>...and many others. Generally, the \"<code>mtl</code> way\" to build monadic actions is to use these typeclass-polymorphic operations, so that one need never <code>lift</code> -- rather, just monomorph the operation to the appropriate lifted type. For example, <code>MonadError</code> completely replaces a hypothetical <code>liftMaybe :: MonadMaybe m =&gt; Maybe a -&gt; m a</code>: rather than lifting a <code>Maybe a</code> value, one would have the producer of the <code>Maybe a</code> value call <code>throwError</code> and <code>return</code> instead of <code>Nothing</code> and <code>Just</code>.</p>\n\n<blockquote>\n  <p>It seems like there should be a newtype declaration for some combinator like <code>(ExceptT :~: MaybeT) IO x</code> so that a single lift is all you ever need</p>\n</blockquote>\n\n<p>With this proposal, you would need (at least) two different <em>kinds</em> of lifts: one lift to go from <code>m a</code> to <code>trans m a</code>, and one lift to go from <code>trans m a</code> to <code>(trans' :~: trans) m a</code>. Having a single operation that handles both kinds of lifting is more uniform.</p>\n\n<blockquote>\n  <p>It seems like there should be some multi-param type class,</p>\n\n<pre><code>class Monad m =&gt; MonadEmbed e m\n    -- | Lift a computation from the `e` monad.\n    embed :: e a -&gt; m a\n\ninstance Monad m =&gt; MonadEmbed m m where\n    embed = id\n</code></pre>\n</blockquote>\n\n<p>This approach looks deceptively nice at first. However, if you try to write and use this class, you will quickly discover why all the <code>mtl</code> classes include functional dependencies: the instance <code>MonadEmbed m m</code> is surprisingly hard to choose! Even a very simple example like</p>\n\n<pre><code>embed (Right ()) :: Either String ()\n</code></pre>\n\n<p>is an ambiguity error. (After all, we only know that <code>Right 3 :: Either a ()</code> for some <code>a</code> -- we don't yet know that <code>a ~ String</code> and so we can't choose the <code>MonadEmbed m m</code> instance!) I suspect most of your other instances will run into similar problems. If you add the obvious functional dependencies, your type inference problems go away but the fundep checks greatly restrict you: one may only lift from the base monad and not from arbitrary intermediate monads as you might hope. This is such a painful problem in practice (and the \"<code>mtl</code> way\" pain is so small) that it isn't done in <code>mtl</code>.</p>\n\n<p>That said, you may enjoy using the <a href=\"http://hackage.haskell.org/package/transformers-base-0.4.4/docs/Control-Monad-Base.html\" rel=\"noreferrer\"><code>transformers-base</code></a> package.</p>\n\n<blockquote>\n  <p>Is it just the fact that the transformers handle all \"other\" effects so that the only things at the very bottom are either <code>Identity</code> (already handled with <code>return :: a -&gt; m a</code>) or <code>IO</code>?</p>\n</blockquote>\n\n<p>As you say, the most common bases are <code>IO</code> (for which we already have <code>MonadIO</code>) or <code>Identity</code> (for which one generally just uses <code>return</code> and a pure computation rather than a lifted monadic computation). Sometimes <code>ST</code> is a handy base monad, but it is a bit more rare to use transformers over <code>ST</code> than it is to use them over <code>IO</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1467782978, "last_edit_date": 1467782978, "creation_date": 1467753226, "answer_id": 38212837, "question_id": 38212294, "link": "https://stackoverflow.com/questions/38212294/why-is-monadio-specific-to-io-rather-than-a-more-generic-monadtrans/38212837#38212837", "title": "Why is MonadIO specific to IO, rather than a more generic MonadTrans?", "body": "<p>The <code>Monad...</code> classes seem designed mostly to <em>directly generalise</em> the characteristic operations of a monad to also work if that monad is buried under a stack of transformers. These operations are normally not such a big set, e.g. <code>State</code> simply needs <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#v:get\" rel=\"nofollow\"><code>get</code></a>, <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#v:put\" rel=\"nofollow\"><code>put</code></a>, <code>state</code> and  <code>modify</code> if you want, but that's it.</p>\n\n<p>Not so with <code>IO</code>; it would be rather impractical to make the plethora of fundamental IO operations methods of the <code>MonadIO</code> class. You can of course get <em>all</em> of them though, if you just introduce <code>liftIO</code> as a \u201cconversion function\u201d, but I'd wager this was always considered a bit of a hack.</p>\n\n<p>Besides: <code>IO</code> is the most important non-trivial base monad; I wouldn't consider it inappropriate to give it a dedicated lift function only for that reason.</p>\n\n<p>Regarding your \u201csingle lift is all you ever need\u201d idea: the problem with <code>:~:</code> is that the transformers now form a binary tree rather than a simple stack with clear hierarchy. This makes the entire idea of the mtl classes much more problematic.</p>\n"}], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 922, "favorite_count": 2, "accepted_answer_id": 38212805, "answer_count": 2, "score": 8, "last_activity_date": 1467782978, "creation_date": 1467750996, "question_id": 38212294, "link": "https://stackoverflow.com/questions/38212294/why-is-monadio-specific-to-io-rather-than-a-more-generic-monadtrans", "title": "Why is MonadIO specific to IO, rather than a more generic MonadTrans?", "body": "<p>So in <code>transformers</code> I see,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Monad m) =&gt; MonadIO m where\n    -- | Lift a computation from the 'IO' monad.\n    liftIO :: IO a -&gt; m a\n\ninstance MonadIO IO where\n    liftIO = id\n</code></pre>\n\n<p>and I understand that the reason that this differs from MonadTrans is that if you have some <code>M1T (M2T (M3T (M4T IO))) x</code> made of 4 composed monad transformers, then you don't want to <code>lift . lift . lift . lift $ putStrLn \"abc\"</code> but you'd rather just <code>liftIO $ putStrLn \"abc\"</code>. </p>\n\n<p>But, this specificity for <code>IO</code> seems very weird when the fundamental definition above seems to be this weird set of recursions with <code>liftIO</code>. It seems like there should either be a newtype declaration for some combinator like <code>(ExceptT :~: MaybeT) IO x</code> so that a single <code>lift</code> is all you ever need (I suppose this is a monad transformer transformer?), or else some multi-param type class, </p>\n\n<pre><code>class (Monad m) =&gt; MonadEmbed e m\n    -- | Lift a computation from the `e` monad.\n    embed :: e a -&gt; m a\n\ninstance (Monad m) =&gt; MonadEmbed m m where\n     embed = id\n</code></pre>\n\n<p>Why doesn't <code>transformers</code> use one of these approaches so that the MonadTrans sequences do not have to be rooted in <code>IO</code>? Is it just the fact that the transformers handle all \"other\" effects so that the only things at the very bottom are either <code>Identity</code> (already handled with <code>return :: a -&gt; m a</code>) or <code>IO</code>? Or does the above require something like UndecidableInstances which the <code>transformers</code> library is loathe to include? Or what?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467754098, "post_id": 38209817, "comment_id": 63850056, "body": "I don&#39;t have time to flush out and test a full answer but how about using <a href=\"https://hackage.haskell.org/package/type-list-0.5.0.0/docs/Data-Type-List.html\" rel=\"nofollow noreferrer\">Data.Type.List</a> and seeing if the union of the first list with the second is the same as the first or second list (one contains the other)."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1467789574, "post_id": 38209817, "comment_id": 63859391, "body": "I had a similar issue albeit a bit simpler (checking whether <code>h</code> is <code>g ++ g&#39;</code> for some <code>g&#39;</code>) and it took me a very long while before <a href=\"https://github.com/gallais/potpourri/blob/master/haskell/stlc/Bidirectional.hs#L212-L213\" rel=\"nofollow noreferrer\">getting something to work</a> even with open types. Using the same sort of tricks (and language extensions!) may get you in the right direction."}, {"owner": {"reputation": 233, "user_id": 3408155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7910903feef10f5a63773ac5d371890?s=128&d=identicon&r=PG", "display_name": "Hoff", "link": "https://stackoverflow.com/users/3408155/hoff"}, "edited": false, "score": 1, "creation_date": 1467797376, "post_id": 38209817, "comment_id": 63863689, "body": "Hm, I dont think the haskell type checker can do this sort of stuff, even though it would be totally awesome..."}], "answers": [{"comments": [{"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "edited": false, "score": 2, "creation_date": 1467806632, "post_id": 38221146, "comment_id": 63869010, "body": "Cool rant, but I doubt this helps the OP at all."}, {"owner": {"reputation": 6152, "user_id": 53974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a676c96a88feb813010e67af012ca0?s=128&d=identicon&r=PG", "display_name": "Blaisorblade", "link": "https://stackoverflow.com/users/53974/blaisorblade"}, "edited": false, "score": 1, "creation_date": 1467809785, "post_id": 38221146, "comment_id": 63871012, "body": "Having seen this pattern in Agda, I agree with the suggestion. This does <i>not</i> solve the problem on its own. One needs next a lemma stating that any list is a sublist of itself, <code>reflSubset :: (xs :: [*]) -&gt; IsSubset xs xs</code>, and you need to prove that by induction; I suspect this is easier to write using this encoding (where you can return <code>IsSubset</code>) than using the OP&#39;s version \u2014 what would <code>reflSubset</code> return there? Maybe a proof of equality, but that&#39;s cumbersome. The signature I wrote <code>reflSubset</code> requires dependent types, but I suspect singletons allow faking it."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1467816777, "post_id": 38221146, "comment_id": 63876096, "body": "thank you for the informed, albeit opinionated, advice"}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1533328269, "post_id": 38221146, "comment_id": 90322705, "body": "How would you go about proving <code>NotElem</code>? My best approach would be <code>data Bottom</code>, <code>type NotElem xs x = Elem xs x -&gt; Bottom</code> paired with <code>notInEmpty :: NotElem &#39;[] x</code> and <code>notHere :: (x :~: y -&gt; Bottom) -&gt; NotElem xs x -&gt; NotElem (y : xs) x</code> which should be implementable fairly easily. Do you have any better ideas?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1533543136, "post_id": 38221146, "comment_id": 90367209, "body": "@WorldSEnder Yep, that\u2019d work. Structurally, <code>NotElem xs x</code> is a proof that there doesn\u2019t exist a location in <code>xs</code> where you can find <code>x</code>. An alternative would be to give a list of proofs that each element in <code>xs</code> is not <code>x</code>, ie <code>All (Not . (:~: x)) xs</code>. As an exercise you can try witnessing an isomorphism between these forms (your <code>notInEmpty</code> and <code>notHere</code> functions demonstrate one direction)"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1467803621, "last_edit_date": 1467803621, "creation_date": 1467798857, "answer_id": 38221146, "question_id": 38209817, "link": "https://stackoverflow.com/questions/38209817/checking-if-one-type-level-list-contains-another/38221146#38221146", "title": "Checking if one type-level list contains another", "body": "<p>There seems to be an obsession with Boolean type families that's endemic to the Haskell community. Don't use them! You're making more work for yourself than necessary when it comes to using the result of such a test.</p>\n\n<p>Subset-ness is a <em>proposition</em> that may be <em>proved</em> with information-rich <em>evidence</em>. Here's one simple way of designing such evidence. First, the type of proofs that an element can be found in a list:</p>\n\n<pre><code>data Elem xs x where\n    Here :: Elem (x ': xs) x\n    There :: Elem xs x -&gt; Elem (y ': xs) x\n</code></pre>\n\n<p><code>Elem</code> is structured like a natural number (compare <code>There (There Here)</code> with <code>S (S Z)</code>) but with more types. To prove that an element is in a list you give its index.</p>\n\n<pre><code>data All f xs where\n    Nil :: All f '[]\n    Cons :: f x -&gt; All f xs -&gt; All f (x ': xs)\n</code></pre>\n\n<p><code>All</code> is a proof that a given predicate applies to every element of a list. It's structured as a list of proofs of <code>f</code>.</p>\n\n<p>Now the type of proofs that a list is a subset of another list is easy to write down using these bits of machinery.</p>\n\n<pre><code>type IsSubset xs ys = All (Elem ys) xs\n</code></pre>\n\n<p><code>IsSubset</code> is represented as a list of proofs that each element of <code>xs</code> can be found in <code>ys</code>.</p>\n\n<p>You can automate proof search for <code>IsSubset</code> values by hacking the type class system, but that's another post.</p>\n"}, {"comments": [{"owner": {"reputation": 6152, "user_id": 53974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a676c96a88feb813010e67af012ca0?s=128&d=identicon&r=PG", "display_name": "Blaisorblade", "link": "https://stackoverflow.com/users/53974/blaisorblade"}, "edited": false, "score": 0, "creation_date": 1468260548, "post_id": 38249666, "comment_id": 64043388, "body": "What are <code>p1</code>, <code>p2</code> and <code>p3</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 6152, "user_id": 53974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a676c96a88feb813010e67af012ca0?s=128&d=identicon&r=PG", "display_name": "Blaisorblade", "link": "https://stackoverflow.com/users/53974/blaisorblade"}, "edited": false, "score": 1, "creation_date": 1468264045, "post_id": 38249666, "comment_id": 64045190, "body": "@Blaisorblade, they&#39;re (polymorphic) proxies."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1468326735, "post_id": 38249666, "comment_id": 64072312, "body": "Thank you very much for your answer (also Benjamin&#39;s answer was very helpful too)! I&#39;m new to dependently typed programming, and it definitely seems that I have to spend some time reading singletons-related papers to have a deeper understanding about how to approach this kind of problems."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 2, "creation_date": 1468327685, "post_id": 38249666, "comment_id": 64073073, "body": "@SergeyMitskevich If you&#39;re new to dependent types, I would advise against using Haskell to learn. Haskell is not a dependently-typed language; tricks like singletons are merely hacks to <i>simulate</i> dependent types. I&#39;d advise picking up an actual dependently-typed system first, then learning about the Haskell encodings once you understand the concept. <a href=\"https://cs.ru.nl/~wouters/Publications/ThePowerOfPi.pdf\" rel=\"nofollow noreferrer\"><i>The Power of Pi</i></a> is my personal favourite introduction"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 1, "creation_date": 1468346638, "post_id": 38249666, "comment_id": 64086105, "body": "@SergeyMitskevich, I second Benjamin Hodgson&#39;s advice that you should learn at least a bit of a dependantly typed language to get a better sense of these things. Learning them in Haskell is a bit like learning about data structures for the first time in C."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1468005593, "last_edit_date": 1468005593, "creation_date": 1467905771, "answer_id": 38249666, "question_id": 38209817, "link": "https://stackoverflow.com/questions/38209817/checking-if-one-type-level-list-contains-another/38249666#38249666", "title": "Checking if one type-level list contains another", "body": "<p>The trouble is that you've defined your subset type family by induction on the structure of the contained list, but you're passing in a totally polymorphic (unknown) list whose structure is a mystery to GHC. You might think that GHC would be able to use induction anyway, but you'd be wrong. In particular, just as every <em>type</em> has undefined <em>values</em>, so every <em>kind</em> has \"stuck\" <em>types</em>. A notable example, which GHC uses internally and exports through (IIRC) <code>GHC.Exts</code>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, PolyKinds #-}\n\ntype family Any :: k\n</code></pre>\n\n<p>The <code>Any</code> type family is in <em>every</em> kind. So you could have a type-level list <code>Int ': Char ': Any</code>, where <code>Any</code> is used at kind <code>[*]</code>. But there's no way to deconstruct the <code>Any</code> into <code>':</code> or <code>[]</code>; it doesn't have any such sensible form. Since type families like <code>Any</code> exist, GHC cannot safely use induction on types the way you wish.</p>\n\n<p>If you want induction to work properly over type lists, you really <em>need</em> to use singletons or similar as Benjamin Hodgson suggests. Rather than passing just the type-level list, you need to pass also a GADT giving evidence that the type-level list is constructed properly. Recursively destructing the GADT performs induction over the type-level list.</p>\n\n<p>The same sorts of limitations hold for type-level natural numbers.</p>\n\n<pre><code>data Nat = Z | S Nat\ntype family (x :: Nat) :+ (y :: Nat) :: Nat where\n   'Z :+ y = y\n   ('S x) :+ y = 'S (x :+ y)\n\ndata Natty (n :: Nat) where\n  Zy :: Natty 'Z\n  Sy :: Natty n -&gt; Natty ('S n)\n</code></pre>\n\n<p>You might wish to prove</p>\n\n<pre><code>associative :: p1 x -&gt; p2 y -&gt; p3 z -&gt; ((x :+ y) :+ z) :~: (x :+ (y :+ z))\n</code></pre>\n\n<p>but you can't, because this requires induction on <code>x</code> and <code>y</code>. You can, however, prove</p>\n\n<pre><code>associative :: Natty x -&gt; Natty y -&gt; p3 z -&gt; ((x :+ y) :+ z) :~: (x :+ (y :+ z))\n</code></pre>\n\n<p>with no trouble.</p>\n"}], "owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 2, "accepted_answer_id": 38249666, "answer_count": 2, "score": 7, "last_activity_date": 1468005593, "creation_date": 1467741762, "question_id": 38209817, "link": "https://stackoverflow.com/questions/38209817/checking-if-one-type-level-list-contains-another", "title": "Checking if one type-level list contains another", "body": "<p>Is it possible to write a type-level function that returns <code>True</code> if one type-level list contains another type-level list?</p>\n\n<p>Here is my attempt:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule TypePlayground where\n\nimport Data.Type.Bool\n\ntype family InList (x :: *) (xs :: [*]) where\n    InList x '[] = 'False\n    InList x (x ': xs) = 'True\n    InList x (a ': xs) = InList x xs\ntype family ListContainsList (xs :: [*]) (ys :: [*]) where\n    ListContainsList xs (y ': ys) = InList y xs &amp;&amp; ListContainsList xs ys\n    ListContainsList xs '[] = 'True\n</code></pre>\n\n<p>It works for simple cases:</p>\n\n<pre><code>data A\ndata B\ndata C\n\ntest1 :: (ListContainsList '[A, B, C] '[C, A] ~ 'True) =&gt; ()\ntest1 = ()\n-- compiles.\ntest2 :: (ListContainsList '[A, B, C] '[B, C, A] ~ 'True) =&gt; ()\ntest2 = ()\n-- compiles.\ntest3 :: (ListContainsList (A ': B ': '[C]) (B ': A ': '[C]) ~ 'True) =&gt; ()\ntest3 = ()\n-- compiles.\ntest4 :: (ListContainsList '[A, C] '[B, C, A] ~ 'True) =&gt; ()\ntest4 = ()\n-- Couldn't match type \u2018'False\u2019 with \u2018'True\u2019\n</code></pre>\n\n<p>But what about cases like this?</p>\n\n<pre><code>test5 :: (ListContainsList (A ': B ': a) a ~ 'True) =&gt; ()\ntest5 = ()\n-- Should compile, but fails:\n-- Could not deduce (ListContainsList (A : B : a0) a0 ~ 'True)\n-- from the context (ListContainsList (A : B : a) a ~ 'True)\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "vector"], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1467735763, "post_id": 38207581, "comment_id": 63840575, "body": "Thanks. Unfortunately I&#39;m actually implementing a dynamic programming algorithm such that when I complete calculating vector I also get my answer and am done with it. So in my actual case this won&#39;t be very useful. But in general I&#39;d say it&#39;s a good approach."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1467747882, "post_id": 38207581, "comment_id": 63846849, "body": "@ritzymon In that case, are you sure you want an unboxed vector at all? Standard dynamic programming techniques using lists are often quite performant -- in particular they generally will not even store the whole list in memory at any point."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1467733413, "creation_date": 1467733413, "answer_id": 38207581, "question_id": 38206377, "link": "https://stackoverflow.com/questions/38206377/possible-to-do-recursive-definitions-with-unboxed-vectors/38207581#38207581", "title": "Possible to do recursive definitions with unboxed vectors?", "body": "<p>The only way I can think of to do this is to generate a lazy recursive list, and then convert that to an unboxed vector.</p>\n\n<p>The standard baffling incantation</p>\n\n<pre><code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>will give you an infinite list of Fibonacci numbers. You can then build an unboxed list from that, which will have fast indexing thereafter.</p>\n\n<p>Sure, it's not actually using the vector for <em>computing</em> the Fibonacci numbers. But it's not doing O(n) indexing over the linked list either, so it should be reasonably fast.</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 5, "last_activity_date": 1467735262, "last_edit_date": 1467735262, "creation_date": 1467734240, "answer_id": 38207838, "question_id": 38206377, "link": "https://stackoverflow.com/questions/38206377/possible-to-do-recursive-definitions-with-unboxed-vectors/38207838#38207838", "title": "Possible to do recursive definitions with unboxed vectors?", "body": "<p>One possibility is to use an <em>unboxed mutable</em> vector and <em>freeze</em> it once done with construction:</p>\n\n<pre><code>import Control.Monad.ST (runST)\nimport Control.Monad (forM_, ap)\nimport qualified Data.Vector.Unboxed as U\nimport qualified Data.Vector.Unboxed.Mutable as M\n\nfib :: Int -&gt; U.Vector Int\nfib s = runST $ M.new s &gt;&gt;= ap ((&gt;&gt;) . forM_ [0..s - 1] . f) U.unsafeFreeze\n    where\n    f v 0 = M.write v 0 0\n    f v 1 = M.write v 1 1\n    f v i = do\n        a &lt;- M.read v (i - 1)\n        b &lt;- M.read v (i - 2)\n        M.write v i (a + b)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1467740781, "post_id": 38209161, "comment_id": 63843137, "body": "what if f(n) is not a function of <i>only</i> previous indices 0..n-1? say, you are traversing a graph and at each node the indices of interest are adjacent nodes&#39; indices"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1467743834, "post_id": 38209161, "comment_id": 63844662, "body": "@behzad.nouri Sure, in the general case <code>constructN</code> is not enough, but I guess it covers many cases, in practice. In the most general case, I&#39;d use boxed vectors. If I knew how many steps are required to reach fixed point (which might be far less than the length of the vector, in general), I might also consider mutable vectors as in your answer."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1467739306, "creation_date": 1467739306, "answer_id": 38209161, "question_id": 38206377, "link": "https://stackoverflow.com/questions/38206377/possible-to-do-recursive-definitions-with-unboxed-vectors/38209161#38209161", "title": "Possible to do recursive definitions with unboxed vectors?", "body": "<p><code>constructN</code> does what you want, even in the unboxed case. Below, <code>v</code> is the vector prefix built so far, and <code>f v</code> returns the next element.</p>\n\n<p>Optimal O(N) complexity.</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as V\n\nfib :: V.Vector Int\nfib = V.constructN 10 f\n  where\n    f v = case V.length v of\n            0 -&gt; 0\n            1 -&gt; 1\n            n -&gt; (v V.! (n - 1)) + (v V.! (n - 2))\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 38207838, "answer_count": 3, "score": 4, "last_activity_date": 1467739306, "creation_date": 1467729808, "last_edit_date": 1467731184, "question_id": 38206377, "link": "https://stackoverflow.com/questions/38206377/possible-to-do-recursive-definitions-with-unboxed-vectors", "title": "Possible to do recursive definitions with unboxed vectors?", "body": "<p>I would like to generate an unboxed vector recursively. As a simple example:</p>\n\n<pre><code>import qualified Data.Vector as V\n\nfib :: V.Vector Int\nfib = V.generate 10 f\n  where\n    f 0 = 0\n    f 1 = 1\n    f x = (fib V.! (x - 1)) + (fib V.! (x - 2))\n</code></pre>\n\n<p>the function correctly generates the fibonacci sequence. However, if I use <code>Data.Vector.Unboxed</code> instead, the code will hang. I understand the reason why this is, but I'd still like to be able to do a recursive definition and get the speed of an unboxed vector. Are there any possibilities in doing this?</p>\n"}, {"tags": ["haskell", "attoparsec"], "answers": [{"tags": [], "owner": {"reputation": 9436, "user_id": 444705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e754cabb8c4f443410c1fd107ecdfd8?s=128&d=identicon&r=PG", "display_name": "Pi Delport", "link": "https://stackoverflow.com/users/444705/pi-delport"}, "is_accepted": true, "score": 5, "last_activity_date": 1467728157, "creation_date": 1467728157, "answer_id": 38205780, "question_id": 38202349, "link": "https://stackoverflow.com/questions/38202349/conditional-lookahead-in-attoparsec/38205780#38205780", "title": "Conditional lookahead in attoparsec", "body": "<p>You're right, the problematic code is the first line of of <code>tP</code>, which parses text greedily without stopping at comments:</p>\n\n<pre><code>tP = do\n  t &lt;- many1 anyChar\n</code></pre>\n\n<p>Before addressing that, I first want to refactor your code a little to introduce helpers and use applicative style, with the problematic code isolated into the <code>text</code> helper:</p>\n\n<pre><code>-- Like manyTill, but pack the result to Text.\ntextTill :: Alternative f =&gt; f Char -&gt; f b -&gt; f Text\ntextTill p end = pack &lt;$&gt; manyTill p end\n\n-- Parse one comment string\ncomment :: Parser Text\ncomment = string \"{-\" *&gt; textTill anyChar (string \"-}\")\n\n-- Parse one non-comment text string (problematic implementation)\ntext :: Parser Text\ntext = pack &lt;$&gt; many1 anyChar\n\n-- TWC parsers:\n\ntwcP :: Parser TWC\ntwcP = eP &lt;|&gt; cP &lt;|&gt; tP\n\ncP :: Parser TWC\ncP = C &lt;$&gt; comment &lt;*&gt; twcP\n\neP :: Parser TWC\neP = E &lt;$ endOfInput\n\ntP :: Parser TWC\ntP = T &lt;$&gt; text &lt;*&gt; twcP\n</code></pre>\n\n<p>To implement lookahead, we can use the <a href=\"http://hackage.haskell.org/package/attoparsec-0.13.0.2/docs/Data-Attoparsec-Combinator.html#v:lookAhead\" rel=\"nofollow\"><code>lookAhead</code></a> combinator, which applies a parser without consuming the input. That allows us to make <code>text</code> parse until it reaches either a <code>comment</code> (without consuming it), or <code>endOfInput</code>:</p>\n\n<pre><code>-- Parse one non-comment text string (working implementation)\ntext :: Parser Text\ntext = textTill anyChar (void (lookAhead comment) &lt;|&gt; endOfInput)\n</code></pre>\n\n<p>With that implementation, <code>twcP</code> behaves as expected:</p>\n\n<pre><code>ghci&gt; parseOnly twcP \"text{-comment-} post\"\nRight (T \"text\" (C \"comment\" (T \" post\" E)))\n</code></pre>\n"}], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 38205780, "answer_count": 1, "score": 3, "last_activity_date": 1467728157, "creation_date": 1467718243, "last_edit_date": 1467724735, "question_id": 38202349, "link": "https://stackoverflow.com/questions/38202349/conditional-lookahead-in-attoparsec", "title": "Conditional lookahead in attoparsec", "body": "<p>Assume there is a data structure representing a text with comments inside.</p>\n\n<pre><code>data TWC\n  = T Text TWC -- text\n  | C Text TWC -- comment\n  | E -- end\n  deriving Show\n</code></pre>\n\n<p>Thus string like </p>\n\n<pre><code>\"Text, {-comment-}, and something else\"\n</code></pre>\n\n<p>could be encoded as</p>\n\n<pre><code>T \"Text, \" (C \"comment\" (T \", and something else\" E))\n</code></pre>\n\n<p>Parsers for comment chunk and for <code>E</code> are pretty trivial:</p>\n\n<pre><code>twcP :: Parser TWC\ntwcP = eP &lt;|&gt; cP &lt;|&gt; tP\n\ncP :: Parser TWC\ncP = do\n  _ &lt;- string \"{-\"\n  c &lt;- manyTill anyChar (string \"-}\")\n  rest &lt;- cP &lt;|&gt; tP &lt;|&gt; eP\n  return (C (pack c) rest)\n\neP :: Parser TWC\neP = do\n  endOfInput\n  return E\n</code></pre>\n\n<p>Implementing parser for text chunk in such a trivial way</p>\n\n<pre><code>tP :: Parser TWC\ntP = do\n  t &lt;- many1 anyChar\n  rest &lt;- cP &lt;|&gt; eP\n  return (T (pack t) rest)\n</code></pre>\n\n<p>make it consume comments section as a text because of its greedy nature</p>\n\n<pre><code>&gt; parseOnly twcP \"text{-comment-}\"\nRight (T \"text{-comment-}\" E)\nit \u2237 Either String TWC\n</code></pre>\n\n<p>So, the question is how to express the logic of parsing until end of input or until comment section? In other words, how to implement conditional lookahead parser?</p>\n"}, {"tags": ["haskell", "types", "type-inference", "algebraic-data-types", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467721032, "post_id": 38198711, "comment_id": 63830235, "body": "In the first <code>add</code>, I think <code>\u2200 ix&#39; . ix&#39; -&gt; ix&#39; -&gt; Bool</code> should be <code>\u2200 ix&#39; . Ord ix&#39; =&gt; ix&#39; -&gt; ix&#39; -&gt; Bool</code>. Further, the second <code>add</code> should require <code>ScopedTypeVariables</code> and <code>add :: forall ix.  ...</code> otherwise the <code>ix</code> in <code>addAlong :: (ix -&gt; ...</code> is not the same."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1467721408, "last_edit_date": 1467721408, "creation_date": 1467707579, "answer_id": 38198711, "question_id": 38198500, "link": "https://stackoverflow.com/questions/38198500/automatically-deriving-type-class-constraints-using-gadts/38198711#38198711", "title": "Automatically deriving type class constraints using GADTs", "body": "<p>Terms bound to a function argument are by default monomorphic (aka rank-0 polymorphic), because Haskell98 only supports rank-1 polymorphism, and a polymorphic argument makes a function rank-2 polymorphic.</p>\n\n<p>Hence, in <code>Seq (addAlong (&lt;) tms1 tms2)</code>, the compiler can only consider <code>&lt;</code> as a monomorphic comparison on the rigid type <code>ix</code>. To consider <code>&lt;</code> as a monomorphic function the compiler needs to resolve the <code>Ord</code> instance. However, at that point the <code>Ord ix</code> instance is not available, since it can only be matched out of a <code>Term</code>!</p>\n\n<p>The solution that's closest to your original code is to explicitly make <code>addAlong</code> rank-2 polymorphic:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, UnicodeSyntax #-}\n\nadd :: Sequence ix cff -&gt; Sequence ix cff -&gt; Sequence ix cff\nadd (Seq tms1) (Seq tms2) = Seq (addAlong (&lt;) tms1 tms2)\n    where addAlong :: (\u2200 ix' . Ord ix' -&gt; ix' -&gt; Bool) -&gt;\n                      [Term ix cff] -&gt; [Term ix cff] -&gt; [Term ix cff]\n          addAlong ord (Term i x : tms1) (Term j y : tms2) = []\n</code></pre>\n\n<p>This way, <code>&lt;</code> is simply passed as it is (as a polymorphic <code>Ord =&gt; ...</code> method), hence the compiler doesn't need to have the instance available at <code>Seq (addAlong (&lt;) tms1 tms2)</code> but can resolve it later when you have <code>Term</code>s available.</p>\n\n<p>You should of course consider whether you really need that. Keeping an <code>Ord</code> dictionary in each <code>Term</code> seems rather wasteful to me \u2013 the problem wouldn't turn up if you kept the constraint in <code>Seq</code> instead:</p>\n\n<pre><code>data Term ix cff where Term :: ix -&gt; cff -&gt; Term ix cff\n\ndata Sequence ix cff where\n  Seq :: Ord ix =&gt; [Term ix cff] -&gt; Sequence ix cff\n\nadd :: Sequence ix cff -&gt; Sequence ix cff -&gt; Sequence ix cff\nadd (Seq tms1) (Seq tms2) = Seq (addAlong (&lt;) tms1 tms2)\n    where addAlong :: (ix -&gt; ix -&gt; Bool) -&gt;\n                      [Term ix cff] -&gt; [Term ix cff] -&gt; [Term ix cff]\n          addAlong ord (Term i x : tms1) (Term j y : tms2) = []\n</code></pre>\n"}], "owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 38198711, "answer_count": 1, "score": 2, "last_activity_date": 1467721408, "creation_date": 1467706858, "question_id": 38198500, "link": "https://stackoverflow.com/questions/38198500/automatically-deriving-type-class-constraints-using-gadts", "title": "Automatically deriving type class constraints using GADTs", "body": "<p>I'm writing a library to deal with infinite sequences using lazy evaluation. For brevity I'm using Generalized Algebraic Data Types (GADTs) to assert an <code>Ord</code> constraint on the index of each term in the sequence. Hence the following typechecks:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Term ix cff where\n  Term :: (Ord ix) =&gt; ix -&gt; cff -&gt; Term ix cff\n\ndata Sequence ix cff where\n  Seq :: [Term ix cff] -&gt; Sequence ix cff\n\nf (Seq (Term i x:_)) (Seq (Term j y:_)) = i &lt; j\n\n{-\nadd :: Sequence ix cff -&gt; Sequence ix cff -&gt; Sequence ix cff\nadd (Seq tms1) (Seq tms2) = Seq (addAlong (&lt;) tms1 tms2)\n    where addAlong :: (ix -&gt; ix -&gt; Bool) -&gt;\n                      [Term ix cff] -&gt; [Term ix cff] -&gt; [Term ix cff]\n          addAlong ord (Term i x : tms1) (Term j y : tms2) = []\n-}\n</code></pre>\n\n<p>As expected, GHCi tells me that <code>f :: Sequence t t1 -&gt; Sequence t t2 -&gt; Bool</code>. Doing the comparison <code>i &lt; j</code> requires an <code>Ord</code> instance, but that is taken care of by the constraint <code>(Ord ix)</code> in the definition of <code>Term</code>.</p>\n\n<p>However, when the lower block is uncommented, the <code>add</code> function fails to typecheck with the error <code>No instance for (Ord ix) arising from the use of ``&lt;''</code>. Shouldn't it be able to figure out <code>(Ord ix)</code> from the <code>Term ix cff</code> that appears in the definition of <code>Sequence</code>?</p>\n"}, {"tags": ["haskell", "monads", "free-monad"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1467708949, "creation_date": 1467708949, "answer_id": 38199156, "question_id": 38198048, "link": "https://stackoverflow.com/questions/38198048/in-haskell-how-could-i-embed-one-free-monad-in-another-one/38199156#38199156", "title": "In Haskell, how could I embed one Free monad in another one?", "body": "<p>In your <code>Act</code> constructor, you can embed an <code>Action a</code> and then continue with the <code>next</code> step depending on the <code>a</code>. You can do this by using an existential to tie the two together:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\ndata MajorFunctor next = Log LogText next\n                       | forall a. Act (Action a) (a -&gt; next)\n                       | Send Message\n\ninstance Functor MajorFunctor where\n  fmap f (Log text next)    = Log text (f next)\n  fmap f (Act action next)  = Act action (fmap f next)\n  fmap f (Send message)     = Send message\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1467719558, "post_id": 38202381, "comment_id": 63829256, "body": "Nice solution! What a clever application of Coyoneda. ^-^"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 7, "last_activity_date": 1467737702, "last_edit_date": 1467737702, "creation_date": 1467718330, "answer_id": 38202381, "question_id": 38198048, "link": "https://stackoverflow.com/questions/38198048/in-haskell-how-could-i-embed-one-free-monad-in-another-one/38202381#38202381", "title": "In Haskell, how could I embed one Free monad in another one?", "body": "<p>A simpler solution, which doesn't need an existential, is to embed the <code>next</code> parameter inside the <code>Action</code>.</p>\n\n<pre><code>data MajorFunctor next = Log LogText next\n                       | Act (Action next)\n                       | Send Message\n\ninstance Functor MajorFunctor where\n  fmap f (Log text next) = Log text (f next)\n  fmap f (Act action) = Act (fmap f action)\n  fmap f (Send message) = Send message\n</code></pre>\n\n<p>This says \"When you execute the <code>Action</code> it'll return a <code>next</code>\", whereas @Cactus's solution says \"When you execute the <code>Action</code> it'll return something (of unknown (existential) type) which can (only) be <em>turned into</em> a <code>next</code>\".</p>\n\n<p><a href=\"https://hackage.haskell.org/package/kan-extensions-5.0.1/docs/Data-Functor-Coyoneda.html\" rel=\"nofollow\">The co-Yoneda lemma</a> says that these two solutions are isomorphic. My version is simpler but Cactus's may be faster for some operations such as repeated <code>fmap</code>s over large <code>Action</code>s.</p>\n"}], "owner": {"reputation": 1541, "user_id": 393453, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a45359e3fe86aeca5b166ed821964b0b?s=128&d=identicon&r=PG", "display_name": "snowmantw", "link": "https://stackoverflow.com/users/393453/snowmantw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 2, "accepted_answer_id": 38199156, "answer_count": 2, "score": 4, "last_activity_date": 1467737702, "creation_date": 1467705218, "last_edit_date": 1467708636, "question_id": 38198048, "link": "https://stackoverflow.com/questions/38198048/in-haskell-how-could-i-embed-one-free-monad-in-another-one", "title": "In Haskell, how could I embed one Free monad in another one?", "body": "<p>I have two Free monads for different operations in different contexts. However, one (<code>major</code>) DSL needs to contain another one (<code>action</code>) if the specific operation is in the context:</p>\n\n<pre><code>import Control.Monad.Free\n\ndata ActionFunctor next = Wait Timeout next\n                        | Read URI next\n\ninstance Functor ActionFunctor where\n  fmap f (Wait timeout next)  = Wait timeout (f next)\n  fmap f (Read uri next)      = Read uri (f next)\n\ntype Action = Free ActionFunctor\n\n\ndata MajorFunctor next = Log LogText next\n                       | Act Action next\n                       | Send Message\n\ninstance Functor MajorFunctor where\n  fmap f (Log text next)    = Log text (f next)\n  fmap f (Act action next)  = Act action (f next)\n  fmap f (Send message)     = Send message\n\ntype Major = Free MajorFunctor\n</code></pre>\n\n<p>The issue is, GHC will complain <code>MajorFunctor</code> that the <code>Action</code> in <code>Act Action next</code> is a kind of <code>(* -&gt; *)</code>, not just a type. This is because in the <code>data ActionFunctor</code> definition it should accept a <code>next</code> as the type parameter, and in the <code>Act Action</code> line it contains no such parameter. But even the message is clear to me, I'm not sure if I should declare such extra type parameter in the <code>Major</code> functor as well:</p>\n\n<pre><code>data MajorFunctor actionNext next = ...\n</code></pre>\n\n<p>It looks weird because only one data constructor will use the parameter, while such exposing will turn every <code>MajorFunctor</code> into <code>MajorFunctor actionNext</code> and it looks totally exposes too much details. So I took a look at <code>FreeT</code> transformer to see if it is what I want. However, in my case I only need to call <code>Action</code> interpreter when the DSL program has such operation, not every <code>bind</code> in the monadic program, so I'm also not sure if a transformer is a good solution.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1467752801, "post_id": 38194378, "comment_id": 63849522, "body": "Note that writing it as <code>add 4 &gt;=&gt; add 2 $ Carton 2</code> or <code>add 2 &lt;=&lt; add 4 $ Carton 2</code> or, using the less common &amp;, <code>Carton 2 &amp; add 4 &gt;=&gt; add 2</code> allows you to leave out the pure."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 6, "last_activity_date": 1467686519, "creation_date": 1467686519, "answer_id": 38194479, "question_id": 38194378, "link": "https://stackoverflow.com/questions/38194378/using-maybe-and-writer-together/38194479#38194479", "title": "Using Maybe and Writer together", "body": "<p>Just compose <code>add</code> with <code>MaybeT</code>:</p>\n\n<pre><code>import Control.Trans.Monad.Maybe\n\ntest = pure (Carton 2) &gt;&gt;= MaybeT . add 3\n                       &gt;&gt;= MaybeT . add 4\n                       &gt;&gt;= MaybeT . add 5\n\nrunTest = do\n  print $ fst $ runWriter (runMaybeT test)\n</code></pre>\n\n<p>Full example at: <a href=\"http://lpaste.net/169070\">http://lpaste.net/169070</a></p>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 5, "last_activity_date": 1467688826, "creation_date": 1467688826, "answer_id": 38194730, "question_id": 38194378, "link": "https://stackoverflow.com/questions/38194378/using-maybe-and-writer-together/38194730#38194730", "title": "Using Maybe and Writer together", "body": "<p>I'd change <code>add</code> &amp;c to use <code>MaybeT (Writer [String])</code>:</p>\n\n<pre><code>import Control.Monad.Writer\nimport Control.Monad.Trans.Maybe\n\ntype Eggs = Int\ndata Carton = Carton Eggs deriving Show\n\nmain = do\n    let c = add 4 $ Carton 2\n        (result, log) = runWriter $ runMaybeT c\n    print result\n    mapM_ putStrLn log\n\nadd :: Eggs -&gt; Carton -&gt; MaybeT (Writer [String]) Carton\nadd e (Carton c)\n    | c + e &lt;= 12 = do\n          tell [\"adding \" ++ show e]\n          return $ Carton $ c + e\n    | otherwise = do\n          tell [\"cannot add \" ++ show e]\n          mzero\n</code></pre>\n\n<p>this will allow your original code of </p>\n\n<pre><code>pure (Carton 2) &gt;&gt;= add 4 &gt;&gt;= add 2\n</code></pre>\n\n<p>to work as expected.</p>\n"}, {"comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1467749981, "post_id": 38206924, "comment_id": 63848005, "body": "This is the exact answer I was expecting. Would you be able to give an example using monad transformers?"}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1467773665, "post_id": 38206924, "comment_id": 63854857, "body": "Excellent example. Thank you very much for that. I do seem to be able to run your <code>MaybeT (Writer [String]) Carton</code> example without <code>lift</code>."}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "reply_to_user": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1467792458, "post_id": 38206924, "comment_id": 63860974, "body": "<code>tell</code> works on a more generic version of <code>Writer</code> called <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Class.html\" rel=\"nofollow noreferrer\"><code>MonadWriter</code></a>. <code>MaybeT</code> has an instance of <code>MonadWriter</code> which means that you can use <code>tell</code> directly for <code>MaybeT</code> instead of <code>lift</code>ing the <code>Writer</code> version. Within the instance itself, <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/src/Control-Monad-Writer-Class.html#line-151\" rel=\"nofollow noreferrer\"><code>tell</code> is defined as <code>lift . tell</code></a>, which is what I was using here. I think the explicit composition helps to understand the example."}], "tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 2, "last_activity_date": 1467759499, "last_edit_date": 1467759499, "creation_date": 1467731312, "answer_id": 38206924, "question_id": 38194378, "link": "https://stackoverflow.com/questions/38194378/using-maybe-and-writer-together/38206924#38206924", "title": "Using Maybe and Writer together", "body": "<p>In the first example, the second <code>&gt;&gt;=</code> in the expression is for the <code>Monad</code> instance of <code>Maybe</code> while in the second example it is from the <code>Monad</code> instance of <code>Writer</code>. Specifically, in the first example the <code>&gt;&gt;=</code> expects a function with type <code>Carton -&gt; Maybe Carton</code>, like <code>add 2</code>, while in the second example <code>&gt;&gt;=</code> expects a function of type <code>Maybe Carton -&gt; Writer [String] (Maybe Carton)</code>. In both examples <code>pure (Carton 2)</code>>>=<code>add 4</code> works because <code>pure (Carton 2)</code> has type <code>Maybe Carton</code> and <code>add 4</code> has type <code>Carton -&gt; &lt;something&gt;</code>, so you have no problems. Adding another <code>&gt;&gt;=</code> to the expression triggers the error because in the first example this <code>&gt;&gt;=</code> has the same type of the first one while in the second example it isn't the same <code>&gt;&gt;=</code>. A solution can be to change <code>add</code> such that it has type <code>Eggs -&gt; Maybe Carton -&gt; Writer [String] (Maybe Carton)</code>:</p>\n\n<pre><code>add :: Eggs -&gt; Maybe Carton -&gt; Writer [String] (Maybe Carton)\nadd e Nothing = return Nothing\nadd e (Just (Carton c))\n    | c + e &lt;= 12 = do\n        tell [\"adding \" ++ show e]\n        return (Just (Carton $ c + e))\n    | otherwise = do\n        tell [\"cannot add \" ++ show e]\n        return Nothing\n</code></pre>\n\n<p>note that this means that you cannot use anymore <code>pure (Carton 2)</code> but you need <code>pure (Just $ Carton 2)</code>:</p>\n\n<pre><code> &gt; pure (Just $ Carton 2) &gt;&gt;= add 2 &gt;&gt;= add 5\n WriterT (Identity (Just (Carton 9),[\"adding 2\",\"adding 5\"]))\n</code></pre>\n\n<p>Said that, I would suggest you to use <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow\">monad transformers</a> to compose <code>Maybe</code> and <code>Writer</code> because this in a common use case for them. Your example could be rewritten as</p>\n\n<pre><code>import Control.Monad.Trans.Maybe\nimport Control.Monad.Writer\n\ntype Eggs = Int\ndata Carton = Carton Eggs deriving Show\n\nadd :: Eggs -&gt; Carton -&gt; MaybeT (Writer [String]) Carton\nadd e (Carton c)\n    | c + e &lt;= 12 = do\n        lift $ tell [\"adding \" ++ show e]\n        return (Carton $ c + e)\n    | otherwise = do\n        lift $ tell [\"cannot add \" ++ show e]\n        mzero\n\nmain = do\n    let c = return (Carton 2) &gt;&gt;= add 4 &gt;&gt;= add 2\n    let result = runWriter $ runMaybeT c\n    print $ fst $ result\n    mapM_ putStrLn $ snd $ result\n</code></pre>\n\n<p>A few things have changed from your example:</p>\n\n<ol>\n<li><code>MaybeT m a</code> is the monad transformer. In this example, <code>m</code> is <code>Writer [String]</code> and <code>a</code> is <code>Carton</code>. To run everything we first <code>runMaybeT</code>, which gives you a <code>Writer [String] (Maybe Carton)</code>, and then we call <code>runWriter</code> on it like you have done in your example.</li>\n<li>To use <code>Writer</code> functions in <code>MaybeT (Writer [String])</code> we need to <code>lift</code> them. For instance <code>lift $ tell [\"something\"]</code></li>\n<li><code>return carton</code> is used to return a <code>Just Carton</code> while <code>mzero</code> is used to return <code>Nothing</code></li>\n</ol>\n\n<p>One last thing: in this example we cannot compose <code>Maybe</code> and <code>Writer</code> the other way around, with <code>WriterT [String] Maybe Carton</code>, because when there are more than 12 eggs <code>runWriterT</code> would return <code>Nothing</code> and suppress the history:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Control.Applicative\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.Trans.Writer\n\ntype Eggs = Int\ndata Carton = Carton Eggs deriving Show\n\nadd :: Eggs -&gt; Carton -&gt; WriterT [String] Maybe Carton\nadd e (Carton c)\n    | c + e &lt;= 12 = do\n        tell [\"adding \" ++ show e]\n        lift $ Just $ Carton $ c + e\n    | otherwise = do\n        tell [\"cannot add \" ++ show e]\n        lift Nothing\n\nmain = do\n    let c = return (Carton 2) &gt;&gt;= add 4 &gt;&gt;= add 20\n    case runWriterT c of\n      Nothing -&gt;\n        print \"nothing to print\"\n      Just (carton, history) -&gt; do\n        print carton\n        mapM_ putStrLn $ history\n</code></pre>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "accepted_answer_id": 38206924, "answer_count": 3, "score": 5, "last_activity_date": 1467759499, "creation_date": 1467685664, "last_edit_date": 1467708310, "question_id": 38194378, "link": "https://stackoverflow.com/questions/38194378/using-maybe-and-writer-together", "title": "Using Maybe and Writer together", "body": "<p>Here is my egg packing factory:</p>\n\n<pre><code>type Eggs = Int\ndata Carton = Carton Eggs deriving Show\n\nadd :: Eggs -&gt; Carton -&gt; Maybe Carton\nadd e (Carton c)\n    | c + e &lt;= 12 = Just (Carton $ c + e)\n    | otherwise = Nothing\n\nmain = do\n    print $ pure(Carton 2) &gt;&gt;= add 4 &gt;&gt;= add 4 &gt;&gt;= add 3\n</code></pre>\n\n<p>Seems to work well, I can nicely chain <code>add</code> functions.</p>\n\n<p>But I want to record a log of how many eggs were added at every step. So I do this:</p>\n\n<pre><code>import Control.Monad.Writer\n\ntype Eggs = Int\ndata Carton = Carton Eggs deriving Show\n\nadd :: Eggs -&gt; Carton -&gt; Writer [String] (Maybe Carton)\nadd e (Carton c)\n    | c + e &lt;= 12 = do\n        tell [\"adding \" ++ show e]\n        return (Just (Carton $ c + e))\n    | otherwise = do\n        tell [\"cannot add \" ++ show e]\n        return Nothing\n\nmain = do\n    let c = add 4 $ Carton 2\n    print $ fst $ runWriter c\n    mapM_ putStrLn $ snd $ runWriter c\n</code></pre>\n\n<p>This gives me what I want: I can see the resulting carton and the record for 4 eggs being added.</p>\n\n<p>But I seem to have lost the ability to chain <code>add</code> functions like I did before:</p>\n\n<pre><code>let c = pure(Carton 2) &gt;&gt;= add 4 -- works\nlet c = pure(Carton 2) &gt;&gt;= add 4 &gt;&gt;= add 2 -- does not work\n</code></pre>\n\n<p>How can I chain my new writer-enabled <code>add</code> functions? Is there a better way of doing this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 2228513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f6dbd36d9422236fc364ecdc1d995d7?s=128&d=identicon&r=PG", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/2228513/brian-moreno"}, "edited": false, "score": 0, "creation_date": 1467684652, "post_id": 38193951, "comment_id": 63813678, "body": "Thanks it works, however it doesn&#39;t work the way I want it to work. I want the outer numbers of the list after the two middle numbers and start to work their way in. Like this <a href=\"http://rextester.com/EBSFBF27492\" rel=\"nofollow noreferrer\">Demo</a>"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 103, "user_id": 2228513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f6dbd36d9422236fc364ecdc1d995d7?s=128&d=identicon&r=PG", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/2228513/brian-moreno"}, "edited": false, "score": 0, "creation_date": 1467686500, "post_id": 38193951, "comment_id": 63814065, "body": "I&#39;ve updated the code. Was off with my indexing a bit in the <code>secondhalf</code> function. You might want to try again"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 1, "last_activity_date": 1467686472, "last_edit_date": 1467686472, "creation_date": 1467681458, "answer_id": 38193951, "question_id": 38193820, "link": "https://stackoverflow.com/questions/38193820/haskell-get-middle-numbers-of-a-list/38193951#38193951", "title": "Haskell - Get middle numbers of a list", "body": "<p>Try this:</p>\n\n<pre><code>f :: (Num a) =&gt; [a] -&gt; [a]\nf [] = []\nf [x] = [x]\nf xs = if len `mod` 2 == 1 then flatten [xs !! half] else flatten [xs !! (half-1), xs !! half]\n    where len = length xs\n          half = len `div` 2\n          firsthalf = take (half-1) xs\n          secondhalf = (reverse . take half . drop (half+1)) xs\n          outtoin = zipWith (\\x y -&gt; x:y:[]) firsthalf secondhalf\n          flatten = concat . flip (:) outtoin\n</code></pre>\n\n<p>Breaking it down:</p>\n\n<ul>\n<li>First get the midpoint(s)</li>\n<li>Next get the two halves of the list excluding middle elements</li>\n<li>Build the list from outside inwards using zip</li>\n<li>Concatenate the zip result to flatten and add to the middle elements list</li>\n</ul>\n\n<p><a href=\"http://rextester.com/LRSCR60022\" rel=\"nofollow\">Demo</a></p>\n"}], "owner": {"reputation": 103, "user_id": 2228513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f6dbd36d9422236fc364ecdc1d995d7?s=128&d=identicon&r=PG", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/2228513/brian-moreno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "accepted_answer_id": 38193951, "answer_count": 1, "score": 0, "last_activity_date": 1467686472, "creation_date": 1467680005, "last_edit_date": 1467684709, "question_id": 38193820, "link": "https://stackoverflow.com/questions/38193820/haskell-get-middle-numbers-of-a-list", "title": "Haskell - Get middle numbers of a list", "body": "<p>i'm very new to Haskell. I want to reorder a list in the following way:</p>\n\n<pre><code>[5,6,7,8,9] -&gt; [7,5,9,6,8]\n[6,7,8,5,4,3] -&gt; [8,5,6,3,7,4]\n</code></pre>\n\n<p>It's suppose to get the middle number or numbers of the list and put them in the starting position. After that it should start to get the two outer numbers of the list and add them in and work its way in. I have the following code to get the middle numbers and put them into the beginning of the list but can't figure out how to start adding the outer numbers into the new list.</p>\n\n<p>Code:</p>\n\n<pre><code>-- import Data.List\n-- import System.IO\n\nlongitude xs = length xs\n\nmiddle xs = length xs `div` 2\n\naddOne xs = middle xs - 1\n\noneMore xs = length xs - 1\n\notherCase xs = oneMore xs `div` 2\n\nvaluea xs =  xs !! middle xs\n\nvalueb xs = xs !! addOne xs\n\nvaluec xs = xs !! otherCase xs\n\nmodulus xs = longitude xs `mod` 2\n\norder xs = midNums xs\n\ntakes xs = take (otherCase xs) xs\n\noddOne xs = otherCase xs + 1\n\ntakeX xs = drop (oddOne xs) xs\n\nvalue xs = takes xs ++ takeX xs\n\nreorder xs = drop (otherCase xs )(take (middle xs + 1) xs)\n\nvalueOdd xs = reorder xs ++ takes xs ++ takeX xs  \n\nparuno xs = drop (middle xs + 1) xs\n\npairTwo xs = take (addOne xs) xs\n\nmidPair xs = take (addOne xs)(drop (middle xs -1) xs)\n\n--Get the numbers\nmidNums xs = if modulus xs == 0 then midPair xs ++ paruno xs ++ pairTwo xs\nelse valueOdd xs\n</code></pre>\n\n<p>Thanks in advanced, any help is greatly appreciated.</p>\n\n<p>Edit:</p>\n\n<p>I want it to work like this: <a href=\"http://rextester.com/EBSFBF27492\" rel=\"nofollow\">Demo</a></p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1467678133, "post_id": 38193391, "comment_id": 63812579, "body": "What have you tried?  I&#39;m a little surprised the imperative algorithms don&#39;t translate well enough in this case.  Also, consider using something besides lists, such as arrays or an actual matrix from hmatrix or some such."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1467680289, "post_id": 38193391, "comment_id": 63812947, "body": "One nice thing about haskell is that it&#39;s actually not that hard to implement imperative algorithms by opting into mutation with the State monad (or ST if you prefer), if it&#39;s too hard to figure out how to come up with a more functional algorithm."}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467716236, "post_id": 38193917, "comment_id": 63827149, "body": "Thank you! The links to the tutorial along with your answer will prove helpful!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1467682012, "last_edit_date": 1467682012, "creation_date": 1467681103, "answer_id": 38193917, "question_id": 38193391, "link": "https://stackoverflow.com/questions/38193391/maximum-size-square-of-all-1s-in-haskell/38193917#38193917", "title": "Maximum Size Square of All 1&#39;s in Haskell", "body": "<p>For examples of how to implement dynamic programming algorithms in Haskell, see this wiki page:</p>\n\n<ul>\n<li><a href=\"https://wiki.haskell.org/Dynamic_programming_example\" rel=\"nofollow\">Dynamic Programming in Haskell</a></li>\n</ul>\n\n<p>Here is a simple example which solves the \"Minimum Steps to One\" problem described <a href=\"https://www.codechef.com/wiki/tutorial-dynamic-programming\" rel=\"nofollow\">here</a>. At an integer <em>n</em> you can move to <em>n-1</em> or <em>n/2</em> (if <em>n</em> is even) or <em>n/3</em> if <em>n</em> is divisible by 3. Here is a solution using Haskell arrays:</p>\n\n<pre><code>import Data.Array\n\nstepsToOne n = arr\n  where arr = array (1,n) [\n                 (i,e)\n                   | i &lt;- [1..n]\n                   , let e  | i &lt;= 1    = 0\n                            | otherwise = 1 + minimum (sub1 ++ div2 ++ div3)\n                              where sub1 = [ arr ! (i-1) ]\n                                    div2 = if mod i 2 == 0 then [ arr ! (div i 2) ] else []\n                                    div3 = if mod i 3 == 0 then [ arr ! (div i 3) ] else []\n              ]\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Here is the same algorithm implemented using lists:</p>\n\n<pre><code>stepsToOne' n = arr\n  where arr = [ e | i &lt;- [0..n]\n                  , let e | i &lt;= 1 = 0\n                            | otherwise = 1 + minimum (sub1 ++ div2 ++ div3)\n                              where sub1 = [ arr !! (i-1) ]\n                                    div2 = if mod i 2 == 0 then [ arr !! (div i 2) ] else []\n                                    div3 = if mod i 3 == 0 then [ arr !! (div i 3) ] else []\n              ]\n\ntest = stepsToOne' 10\n</code></pre>\n\n<p>Note how <code>arr !! i</code> references <code>arr !! (i-1)</code> and possibly <code>arr !! (div i 2)</code> and <code>arr !! (div i 3)</code>. Haskell will figure out the order in which to evaluate the list items based on how they are related.</p>\n\n<p>This is the same as writing:</p>\n\n<pre><code>stepsToOne' n = [ s0, s1, s2, s3, s4, s5, s6, ... ]\n  where s0 = 0\n        s1 = 0\n        s2 = 1 + minimum [s1, s1]\n        s3 = 1 + minimum [s2, s1]\n        s4 = 1 + minimum [s3, s2]\n        s5 = 1 + minimum [s4]\n        ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467713967, "post_id": 38194601, "comment_id": 63825753, "body": "&quot;The idea is that, first for each cell find the longest continuous run of ones above that cell and starting at that cell&quot; I am confused by this; in which direction are you counting in either case?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 1, "creation_date": 1467722650, "post_id": 38194601, "comment_id": 63831450, "body": "@matthias count ones upwards until you hit a zero; the shown example should help. For example look at the 2nd column"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467723607, "post_id": 38194601, "comment_id": 63832186, "body": "thanks. It clicked just before I saw your reply.  Thanks for your help. Now to spend the next hour trying to figure out your point free , partially applied folds :)"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467727635, "post_id": 38194601, "comment_id": 63835085, "body": "btw In trying to implement my own <code>aggr</code>, I did <code>foldl go (repeat 0) matrix</code> where <code>go xs ys =  zipWith inc xs ys</code> where <code>inc _ 0 = 0; inc x _ = succ x</code>. That was the way I was able to wrap my head around it. Can you please explain what the problem is with that, because you seem to have made efforts to use <code>foldr</code> and <code>ap</code>."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 1, "creation_date": 1467728630, "post_id": 38194601, "comment_id": 63835852, "body": "@matthias foldr <i>tends</i> to perform better; but i think foldl would be fine here as well. <code>ap</code> is only to write a shorter code; it is equivelant to <code>go x f y = out: f out where out = zipWith inc x y</code>"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467737742, "post_id": 38194601, "comment_id": 63841631, "body": "Sorry, last question. how do the types match up between <code>go</code> and the <code>foldr</code>? I am confused as to what is actually part of the <code>go</code> evaluation in the <code>aggr xs =...</code> line."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467739763, "post_id": 38194601, "comment_id": 63842618, "body": "@matthias see <a href=\"http://stackoverflow.com/q/27906660/625914\">stackoverflow.com/q/27906660/625914</a> it is the same technique"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 5, "last_activity_date": 1467724714, "last_edit_date": 1467724714, "creation_date": 1467687535, "answer_id": 38194601, "question_id": 38193391, "link": "https://stackoverflow.com/questions/38193391/maximum-size-square-of-all-1s-in-haskell/38194601#38194601", "title": "Maximum Size Square of All 1&#39;s in Haskell", "body": "<p>An <em>optimal</em> O(n^2) solution can be done using only lists and right folds<sup> (1)</sup>. I also generalize to maximum area sub-<em>rectangle</em>, not just squares. Limiting to only squares is an easy modification<sup> (2)</sup>.</p>\n\n<pre><code>import Control.Monad (ap)\nimport Data.Ord (comparing)\n\ndata Rect = Rect {\n    row    :: Int, -- lower left row index\n    col    :: Int, -- lower left column index\n    width  :: Int,\n    height :: Int\n    } deriving (Show, Eq)\n\ninstance Ord Rect where  -- compare on area\n    compare = comparing $ \\a -&gt; width a * height a\n</code></pre>\n\n<p>The idea is that first, at each cell, count <em>ones</em> upwards until you hit a zero. For the example in the question this would be:</p>\n\n<pre><code>[0,0,1,1,0]       [0,0,1,1,0]\n[1,1,1,0,0]       [1,1,2,0,0]\n[1,0,1,1,1]  &gt;&gt;&gt;  [2,0,3,1,1]\n[1,1,1,1,1]       [3,1,4,2,2]\n[0,1,1,1,1]       [0,2,5,3,3]\n</code></pre>\n\n<p>and can be done by a right fold:</p>\n\n<pre><code>count :: Foldable t =&gt; t [Int] -&gt; [[Int]]\ncount = ($ repeat 0) . foldr go (const [])\n    where\n    go x f = ap (:) f . zipWith inc x\n    inc 0 = const 0\n    inc _ = succ\n</code></pre>\n\n<p>Then, interpreting each number as height of a building, each row reduces to a <em>skyline</em> problem:</p>\n\n<blockquote>\n  <p>Given height of buildings, find the largest rectangular banner which fits entirely under the skyline (i.e. outline of buildings).</p>\n</blockquote>\n\n<p>For example, the skyline and the optimal rectangular banner in the last two rows would be as bellow (the banner is marked with #):</p>\n\n<pre><code>                            +\n         +                  +\n     +   +                  # # #\n     +   # # #            + # # #\n     + + # # #            + # # #\n4th: 3 1 4 2 2     5th: 0 2 5 3 3\n</code></pre>\n\n<p>This problem can be solved in linear time for each row, by maintaining a stack (list) of buildings with increasing height. Whenever an item is popped out of the stack we update the current optimal solution:</p>\n\n<pre><code>solve :: Foldable t =&gt; t [Int] -&gt; Rect\nsolve = maximum . zipWith run [0..] . count\n    where\n    run ri xs = maximum $ foldr go end xs 1 [(0, 0)]\n        where\n        end = go 0 $ \\_ _ -&gt; []\n        go x f i ((_, y): r@((k, _):_))\n            | x &lt;= y = Rect ri k (i - k - 1) y: go x f i r\n        go x f i y = f (i + 1) $ (i, x): y\n</code></pre>\n\n<p>then,</p>\n\n<pre><code>\\&gt; solve [[0,0,1,1,0],[1,1,1,0,0],[1,0,1,1,1]]\nRect {row = 2, col = 2, width = 3, height = 1}\n\n\\&gt; solve [[0,0,1,1,0],[1,1,1,0,0],[1,0,1,1,1],[1,1,1,1,1]]\nRect {row = 3, col = 2, width = 3, height = 2}\n\n\\&gt; solve [[0,0,1,1,0],[1,1,1,0,0],[1,0,1,1,1],[1,1,1,1,1],[0,1,1,1,1]]\nRect {row = 4, col = 2, width = 3, height = 3}\n</code></pre>\n\n<hr>\n\n<p><sub>1. this is optimal because it is linear in the number of elements of the matrix and you cannot do better than linear here.<br>\n2. in order to limit to just squares, you only need to change the lambda used in <code>compare</code> function to: <code>\\a -&gt; min (width a) (height a)</code></sub></p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 1, "accepted_answer_id": 38194601, "answer_count": 2, "score": 4, "last_activity_date": 1467726565, "creation_date": 1467675505, "last_edit_date": 1467726565, "question_id": 38193391, "link": "https://stackoverflow.com/questions/38193391/maximum-size-square-of-all-1s-in-haskell", "title": "Maximum Size Square of All 1&#39;s in Haskell", "body": "<p>if I have a matrix </p>\n\n<pre><code>m = 0 0 1 1 0\n    0 1 1 1 0\n    1 0 1 1 1\n    1 1 1 1 1\n    0 1 1 1 1\n</code></pre>\n\n<p>How do I find the the largest nXn sub matrix of m that is just 1's? \nThis seems an OK problem in an imperative language, and indeed there are answers to this on Stack overflow using other languages, but I don't know where to start with Haskell.</p>\n\n<p>we can assume that m is represented by</p>\n\n<pre><code>m = [ [0, 0, 1, 1, 0]\n    , [1, 1, 1, 0, 0]\n    , [1, 0, 1, 1, 1]\n    , [1, 1, 1, 1, 1]\n    , [0, 1, 1, 1, 1]\n    ]\n</code></pre>\n\n<p>if that helps. In this case the answer would the bottom right 3x3 sub matrix.</p>\n"}, {"tags": ["unit-testing", "haskell", "testing", "quickcheck", "build-dependencies"], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1467753583, "post_id": 38192271, "comment_id": 63849841, "body": "Almost all of the arguments for avoiding orphans don&#39;t apply to test suite executables. This option is much more attractive to me than using CPP to make my module contain different code when included in the tests than for production builds."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1468018559, "post_id": 38192271, "comment_id": 63972206, "body": "@Ben, in some cases that&#39;s already necessary. Test code may need access to otherwise non-exported constructors and functions. One option is to export all of those unconditionally, but in a large and mature module that doesn&#39;t do so, that requires careful testing for potential performance changes. The inliner treats exported and non-exported bindings differently."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1467670188, "last_edit_date": 1467670188, "creation_date": 1467666730, "answer_id": 38192271, "question_id": 38192156, "link": "https://stackoverflow.com/questions/38192156/avoiding-build-dependency-on-quickcheck-when-declaring-an-arbitrary-instance/38192271#38192271", "title": "Avoiding build dependency on QuickCheck when declaring an Arbitrary instance", "body": "<p>Try <code>ghc -Wall -Werror -Wno-orphans</code> for the test module.</p>\n\n<p>Not exactly perfect since it will disable the warning for other orphan instances, but I believe it's the closest we can get at the moment.</p>\n\n<p>Having a \"suppress this warning in the next line\" pragma would also be nice.</p>\n"}, {"comments": [{"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 0, "creation_date": 1467695068, "post_id": 38192464, "comment_id": 63815899, "body": "Argh, will the boilerplate never end?! ;)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 0, "creation_date": 1467743368, "post_id": 38192464, "comment_id": 63844420, "body": "@Arek&#39;Fu The boilerplate might be reduced by exploiting safe coercions as needed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467750566, "post_id": 38192464, "comment_id": 63848320, "body": "@chi, it&#39;s still an awful lot of noise, and you&#39;d need to fall back on unsafe coercions for GHC 7.6 if you support that. I don&#39;t see how it&#39;s worth the trouble for a test suite."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 5, "last_activity_date": 1467667905, "creation_date": 1467667905, "answer_id": 38192464, "question_id": 38192156, "link": "https://stackoverflow.com/questions/38192156/avoiding-build-dependency-on-quickcheck-when-declaring-an-arbitrary-instance/38192464#38192464", "title": "Avoiding build dependency on QuickCheck when declaring an Arbitrary instance", "body": "<p>Within the test suite, create a newtype which wraps <code>Bar</code> and define the <code>Arbitrary</code> instance for the newtype.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1467741537, "creation_date": 1467741537, "answer_id": 38209760, "question_id": 38192156, "link": "https://stackoverflow.com/questions/38192156/avoiding-build-dependency-on-quickcheck-when-declaring-an-arbitrary-instance/38209760#38209760", "title": "Avoiding build dependency on QuickCheck when declaring an Arbitrary instance", "body": "<p>You can conditionally define a <code>TESTING</code> CPP macro when you're compiling the test suite. This lets you avoid orphans but only incur the dependency when you use it. You can see a similar use of such a macro in the <code>containers</code> package, but that package currently uses orphan instances for the specific purpose of adding <code>Arbitrary</code> instances to the test suite. I may change that soon.</p>\n"}], "owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 38192464, "answer_count": 3, "score": 4, "last_activity_date": 1467741537, "creation_date": 1467665982, "question_id": 38192156, "link": "https://stackoverflow.com/questions/38192156/avoiding-build-dependency-on-quickcheck-when-declaring-an-arbitrary-instance", "title": "Avoiding build dependency on QuickCheck when declaring an Arbitrary instance", "body": "<p>Assume I have a Haskell module named <code>Foo</code>, defined in <code>src/Foo.hs</code>. Assume also that <code>Foo</code> exports a type <code>Bar</code>.</p>\n\n<p>Now I want to write unit tests for <code>Bar</code> (for the whole <code>Foo</code> module, actually), so I throw a couple of QuickCheck properties into <code>test/FooTest.hs</code>; but hey, now I need to define an <code>Arbitrary</code> instance for <code>Bar</code>.</p>\n\n<p>And there's the rub: in <code>-Wall -Werror</code> mode, <code>ghc</code> requires instance declarations to appear in one of two places: in the same file where the type is defined, or where the class is defined. But I don't want to clutter my <code>Foo</code> module with a build dependency on QuickCheck, and I obviously cannot add an instance of <code>Bar</code> to QuickCheck.</p>\n\n<p>So how do I make my datatype an instance of <code>Arbitrary</code>, for the purpose of unit testing only, without introducing a dependency on QuickCheck for users of my module and without tossing<code>-Wall -Werror</code> out of the window?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467667240, "post_id": 38191682, "comment_id": 63810181, "body": "In your expansion of <code>parMap</code>, you forgot the last <code>[a]</code> argument."}], "answers": [{"tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 4, "last_activity_date": 1467667666, "creation_date": 1467667666, "answer_id": 38192429, "question_id": 38191682, "link": "https://stackoverflow.com/questions/38191682/reasoning-about-parmap/38192429#38192429", "title": "Reasoning about `parMap`", "body": "<p>There is a mistake in your interpretation, <code>Strategy</code> is not a type class but a type alias. If you check the signature of <code>parMap</code>, <code>Strategy b</code> is followed by <code>-&gt;</code> and not by <code>=&gt;</code> which means that <code>parMap</code> expects a <code>Strategy b</code> as first argument. <code>Strategy b</code> is alias for <code>b -&gt; Eval b</code> which means that the signature of <code>parMap</code> can be expanded to:</p>\n\n<pre><code>parMap :: (b -&gt; Eval b) -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>The book <code>parMap</code> is not the same as the one above because its signature is</p>\n\n<pre><code>parMap :: (a -&gt; b) -&gt; [a] -&gt; Eval [b]\n</code></pre>\n\n<p>The main difference is that the first version uses the given <code>Strategy b</code> to compute a <code>[b]</code> from the arguments <code>(a -&gt; b) -&gt; [a]</code> while the second version doesn't compute a <code>[b]</code> but a <code>Eval [b]</code>. <code>Eval [b]</code> specifies how to produce a <code>[b]</code> and you must call <code>runEval</code> to use it.</p>\n\n<p>The first version is easier to use in a program because you don't need to call <code>runEval</code> and it's also better because the strategy to evaluate each element of the list is not predefined, like in the book where the strategy is <code>rpar</code>, but it's an argument. This means that the first version is more generic. Have a look at the <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html#v:r0\" rel=\"nofollow\">basic strategies</a> to better understand what you can pass to the standard <code>parMap</code>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 38192429, "answer_count": 1, "score": 1, "last_activity_date": 1467667666, "creation_date": 1467663384, "question_id": 38191682, "link": "https://stackoverflow.com/questions/38191682/reasoning-about-parmap", "title": "Reasoning about `parMap`", "body": "<p>Given:</p>\n\n<pre><code>Prelude Control.Parallel.Strategies&gt; :t parMap\nparMap :: Strategy b -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\n\nPrelude Control.Parallel.Strategies&gt; :i Strategy\ntype Strategy a = a -&gt; Eval a\n        -- Defined in `Control.Parallel.Strategies'\n</code></pre>\n\n<p>My understanding then is that <code>parMap</code> can be expanded, replacing <code>b</code> with <code>b -&gt; Eval b</code> to:</p>\n\n<p><code>parMap :: (a -&gt; b -&gt; Eval b) -&gt; (a -&gt; b -&gt; Eval b) -&gt; [b -&gt; Eval b]</code></p>\n\n<p>This seems more complicated than the example version in <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch02.html#sec_par-eval-sudoku2\" rel=\"nofollow\">Parallel and Concurrent Haskell</a>:</p>\n\n<pre><code>parMap :: (a -&gt; b) -&gt; [a] -&gt; Eval [b]\nparMap f [] = return []\nparMap f (a:as) = do\n   b &lt;- rpar (f a)\n   bs &lt;- parMap f as\n   return (b:bs)\n</code></pre>\n\n<p>In the standard library implementation of <code>parMap</code>, what's the meaning of <code>Strategy b</code>, namely in <code>a -&gt; b -&gt; Eval b</code>?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1468179569, "post_id": 38191542, "comment_id": 64008407, "body": "I see a reference to my use case in <a href=\"https://hackage.haskell.org/package/yesod-auth-1.2.4/docs/src/Yesod-Auth.html#maybeAuthId\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/yesod-auth-1.2.4/docs/src/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "is_accepted": true, "score": 1, "last_activity_date": 1468184549, "last_edit_date": 1468184549, "creation_date": 1468181552, "answer_id": 38296080, "question_id": 38191542, "link": "https://stackoverflow.com/questions/38191542/authenticate-user-by-access-token-base-auth-on-any-handler/38296080#38296080", "title": "Authenticate user by access token/ base auth on any handler", "body": "<p>The answer is in implementing <code>maybeAuthId</code></p>\n\n<pre><code>import Database.Persist.Sql (toSqlKey)\n\ninstance YesodAuth App where\n\nmaybeAuthId = do\n    mToken &lt;- lookupGetParam \"access_token\"\n    case mToken of\n        Nothing -&gt; return Nothing\n        Just token -&gt; do\n            mUser &lt;- runDB $ selectFirst [AccessTokenToken ==. token] []\n            case mUser of\n                Nothing -&gt; return Nothing\n                Just user -&gt; return $ Just . accessTokenUserId $ entityVal user\n</code></pre>\n\n<p>The above example will authenticate user ID by the access token passed in the query string. It assumes you have the following in your <code>models</code>:</p>\n\n<pre><code>AccessToken\n    created UTCTime default=CURRENT_TIME\n    userId UserId\n    token Text\n    UniqueUserId userId\n    UniqueToken token\n    deriving Eq\n    deriving Show\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "accepted_answer_id": 38296080, "answer_count": 1, "score": 0, "last_activity_date": 1468184549, "creation_date": 1467662588, "last_edit_date": 1468178627, "question_id": 38191542, "link": "https://stackoverflow.com/questions/38191542/authenticate-user-by-access-token-base-auth-on-any-handler", "title": "Authenticate user by access token/ base auth on any handler", "body": "<p>I'd like users to be able to access a RESTful server and be authenticated with an access token in the query string. For example <code>https://api.example.com/v1.0/articles?access_token=1234</code></p>\n\n<p>I have defined in the <code>models</code> file:</p>\n\n<pre><code>AccessToken\n    created UTCTime default=CURRENT_TIME\n    userId UserId\n    token Text\n    UniqueUserId userId\n    UniqueToken token\n    deriving Eq\n    deriving Show\n</code></pre>\n\n<p>Every time a user is created, we'll assign them a unique token.</p>\n\n<p>The question is how to do the authentication on the fly for every handler. So for example I would have an <code>ArticlesR</code> handler that should be allowed access only after the user has been authenticated (and thus also authorized).</p>\n\n<p>There should not be a cookie involved. Every request will re-auth the user. Like this we could have a completely decoupled server that can serve any arbitrary domain.</p>\n\n<p>Same question can also be asked about base auth. The gist is: How to authenticate from inside a <em>regular</em> handler</p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 5, "last_activity_date": 1467661226, "creation_date": 1467661226, "answer_id": 38191305, "question_id": 38187271, "link": "https://stackoverflow.com/questions/38187271/how-to-response-with-http-status-in-custom-servant-handler/38191305#38191305", "title": "How to response with HTTP status in custom servant handler?", "body": "<p>You will need to add <code>ExceptT</code> to your stack of monad transforms. Right now, with just <code>ReaderT</code>, there is no way to encode the notion of an error being thrown.</p>\n\n<pre><code>{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Lib where\n\nimport Control.Monad.Except\nimport Control.Monad.Reader\nimport Data.Maybe\nimport Data.Map\nimport GHC.Conc\nimport Prelude hiding (lookup)\nimport Servant.API\nimport Servant.Server\nimport System.Random\n\ntype API =\n  Capture \"name\" String :&gt; Get '[JSON] Int\n\ntype World =\n  TVar (Map String [Int])\n\ntype Effects =\n  ExceptT ServantErr (ReaderT World IO)\n\nserver :: World -&gt; Server API\nserver world =\n  enter (Nat transform) get\n  where\n    transform :: Effects a -&gt; ExceptT ServantErr IO a\n    transform (ExceptT foo) =\n      ExceptT $ runReaderT foo world\n\nget :: String -&gt; Effects Int\nget sn = do\n  tvar &lt;- ask\n  ms &lt;- liftIO $ do\n    sl &lt;- atomically $ do\n      sm &lt;- readTVar tvar\n      return (fromMaybe [] (lookup sn sm))\n    let n = length sl\n    i &lt;- randomRIO (0, n - 1)\n    return $ if n == 0\n      then Nothing\n      else Just . head . drop i $ sl\n  case ms of\n    Nothing -&gt;\n      throwError err404\n    Just ms' -&gt;\n      return ms'\n</code></pre>\n\n\n\n<p>With <code>ExceptT ServantErr . ReaderT (TVar ...)</code> you can then <code>throwError err404</code>, which Servant will catch and use to return an HTTP 404. The natural transformation <code>ExceptT ServantErr . ReaderT (TVar ...) :~&gt; ExceptT ServantErr</code> will then have to unwrap and rewrap in order to discharge the reader effect. All in all, not terribly more code.</p>\n"}], "owner": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 992, "favorite_count": 0, "accepted_answer_id": 38191305, "answer_count": 1, "score": 2, "last_activity_date": 1467661226, "creation_date": 1467643060, "question_id": 38187271, "link": "https://stackoverflow.com/questions/38187271/how-to-response-with-http-status-in-custom-servant-handler", "title": "How to response with HTTP status in custom servant handler?", "body": "<p>I created a custom servant handler</p>\n\n<pre><code>type ServiceSet = TVar (M.Map String [MicroService])\ntype LocalHandler = ReaderT ServiceSet IO\n</code></pre>\n\n<p>But i failed to find a way to response a 404-not-found status code to client in following function:</p>\n\n<pre><code>getService :: String -&gt; LocalHandler MicroService\ngetService sn = do\n  tvar &lt;- ask\n  ms &lt;- liftIO $ do\n    sl &lt;- atomically $ do\n      sm &lt;- readTVar tvar\n      return $ case M.lookup sn sm of\n        Nothing -&gt; []\n        Just sl -&gt; sl\n    let n = length sl\n    i &lt;- randomRIO (0, n - 1)\n    return $ if n == 0\n      then Nothing\n      else Just . head . drop i $ sl\n  case ms of\n    Nothing -&gt; ??? -- throwError err404\n    Just ms' -&gt; return ms'\n</code></pre>\n\n<p>how to send 404 status code in <code>???</code>?</p>\n"}, {"tags": ["haskell", "ghc", "typeclass", "haskell-lens"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467648478, "post_id": 38186795, "comment_id": 63803042, "body": "The example is a bit too contrived, I suspect. Can you come up with a minimal useful example?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467648208, "post_id": 38187121, "comment_id": 63802897, "body": "Working only with <code>APrism</code> will miss a lot, won&#39;t it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467648409, "post_id": 38187121, "comment_id": 63803007, "body": "Could you explain this RankN hierarchy issue?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1467656387, "post_id": 38187121, "comment_id": 63806200, "body": "<code>APrism</code> is fully equivalent to (law-obeying) <code>Prism</code>, so, no, this won&#39;t miss anything. As for the RankN hierarchy, well... the essential problem is that, if you make a rank-N-1 argument of a function less polymorphic, the whole function type gets more polymorphic. It&#39;s not <i>that</i> much of a problem, but you can&#39;t do type inference everywhere anymore. Haskell&#39;s rank-N types are already quite an amazing extension over the standard Damas-Milner inference, but I reckon some parts of the compiler, like rewrite rules can&#39;t fully make use of this. Not sure if this would theoretically work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467663350, "post_id": 38187121, "comment_id": 63808860, "body": "I don&#39;t see how that feature of higher-rank types would cause a problem for rules. I don&#39;t have my computer on me, but I wonder if simply changing the rule to <code>foo0 x = foo&#39; x</code> would make the rule work when inlining reveals the application."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467663776, "post_id": 38187121, "comment_id": 63808996, "body": "AFAIK, <code>foo x = foo&#39; x</code> is generally not legal in rewrite rules."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467670223, "post_id": 38187121, "comment_id": 63811021, "body": "Sure it is. Most of them look like that."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467671979, "post_id": 38187121, "comment_id": 63811428, "body": "Interesting! But no, it doesn&#39;t seem to do the trick, with <code>\u2200 x . foo x = foo&#39; x</code> the error is about not being able to match <code>p1 Bool (f1 Bool) -&gt; p1 Char (f1 Char)</code> with <code>t</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467922883, "post_id": 38187121, "comment_id": 63930254, "body": "I tracked the problem far enough to come up with a solution, although I don&#39;t know <i>exactly</i> where the original code goes wrong. See my answer."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1467642618, "creation_date": 1467642618, "answer_id": 38187121, "question_id": 38186795, "link": "https://stackoverflow.com/questions/38186795/rewrite-rule-specialisation-type-error-with-universally-quantified-constraints/38187121#38187121", "title": "Rewrite rule / specialisation type error with universally quantified constraints", "body": "<p>This is in essence the old problem that rank-N types don't make a proper hierarchy of which type is more and which is less general. It seems like this specific case <em>could</em> be resolvable, but it's certainly not possible to write rewrite rules for general rank-N functions.</p>\n\n<p>Fortunately, this is not much of an issue for lenses and friends, because these have always a monomorphic version available!</p>\n\n<pre><code>foo\u2080 :: APrism' s a -&gt; APrism' s a\nfoo\u2080 = id\n\n{-# RULES \"foo/foo'\" foo\u2080 = foo' #-}\nfoo' :: APrism' Char Bool -&gt; APrism' Char Bool\nfoo' = id\n\nfoo :: Prism' s a -&gt; Prism' s a\nfoo p = clonePrism $ foo\u2080 (clonePrism p)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1467924512, "last_edit_date": 1467924512, "creation_date": 1467922838, "answer_id": 38254568, "question_id": 38186795, "link": "https://stackoverflow.com/questions/38186795/rewrite-rule-specialisation-type-error-with-universally-quantified-constraints/38254568#38254568", "title": "Rewrite rule / specialisation type error with universally quantified constraints", "body": "<p>It appears that GHC gets confused somehow. GHC is generally <em>supposed</em> to float all <code>forall</code>s and class contexts as far left as possible, but it seems that doesn't happen at the right time here. Speculation: this could have something to do with attempts to support the currently-broken <code>ImpredicativeTypes</code> extension. We can, however, do it manually, at which point GHC stops complaining about the rule.</p>\n\n<p>Dan Doel tells me that accepting <code>id</code> as an implementation of these functions was itself a compiler bug in GHC 7.10, so I'll write them out properly.</p>\n\n<pre><code>foo :: (Choice p, Applicative f) =&gt; Prism' s a -&gt; p a (f a) -&gt; p s (f s)\nfoo x = x\n\n-- Avoid a warning about the rule not firing.\n{-# INLINE [0] foo #-}\n\nfoo' :: (Choice p, Applicative f) =&gt; Prism' Char Bool -&gt; p Bool (f Bool) -&gt; p Char (f Char)\nfoo' x = x\n\n{-# RULES \"foo/foo'\" foo = foo' #-}\n</code></pre>\n"}], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 38187121, "answer_count": 2, "score": 2, "last_activity_date": 1467924512, "creation_date": 1467641548, "question_id": 38186795, "link": "https://stackoverflow.com/questions/38186795/rewrite-rule-specialisation-type-error-with-universally-quantified-constraints", "title": "Rewrite rule / specialisation type error with universally quantified constraints", "body": "<p>I am trying to implement some type-specific specialisations\nof some functions that work with Prisms, and I am having difficulty with\nGHC 8.  (I encounter a different problem with GHC &lt; 8, but that's\nfor another question).</p>\n\n<p>A (contrived) minimal example of the problem:</p>\n\n<pre><code>foo :: Prism' s a -&gt; Prism' s a\nfoo = id\n\n{-# RULES \"foo/foo'\" foo = foo' #-}\nfoo' :: Prism' Char Bool -&gt; Prism' Char Bool\nfoo' = id\n</code></pre>\n\n<p>This causes the compiler error:</p>\n\n<pre><code>error:\n\u2022 Couldn't match type \u2018p0 Bool (f0 Bool) -&gt; p0 Char (f0 Char)\u2019\n                 with \u2018forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).\n                       (Choice p, Applicative f) =&gt;\n                       p Bool (f Bool) -&gt; p Char (f Char)\u2019\n  Expected type: Prism' Char Bool\n    Actual type: p0 Bool (f0 Bool) -&gt; p0 Char (f0 Char)\n\u2022 In the expression: foo'\n  When checking the transformation rule \"foo/foo'\"\n</code></pre>\n\n<p>It looks to me like one side of the rewrite rule type checking\n\"forgets\" its context.  What is really going on here, and how\ncan I make GHC happy?</p>\n"}, {"tags": ["haskell", "clojure", "adt"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1467624301, "post_id": 38180978, "comment_id": 63788641, "body": "isn&#39;t a ADT without a checked types more or less useless? I guess you could represent the ADT as it&#39;s catamorphism ... (btw: the pattern-matching / catamorphism to use values is what I would consider missing - of course I don&#39;t understand Clojure at all so maybe it&#39;s <i>emited</i> somehow too)"}], "answers": [{"tags": [], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "is_accepted": true, "score": 0, "last_activity_date": 1467652892, "last_edit_date": 1467652892, "creation_date": 1467652199, "answer_id": 38189531, "question_id": 38180978, "link": "https://stackoverflow.com/questions/38180978/what-is-required-to-implement-an-adt-in-clojure/38189531#38189531", "title": "What is required to implement an ADT in Clojure?", "body": "<p>To implement ADT in clojure you're required to be brave and insistent.</p>\n\n<p>For the missing parts - I don't know what are you missing, but I know what I am missing usually.</p>\n\n<p>1) I want to authomatically get some <code>foldX</code>-function to perform conversion to Boehm encoding - a natural fold for this datatype.</p>\n\n<p>This, however, will require you to have user to specify which fields must refer to object of same type (<code>left</code> and <code>right</code> in your case).</p>\n\n<p>For instance, that function, written for your example type in haskell (God save the laziness!) will look like:</p>\n\n<pre><code>foldTree :: a -&gt; (v -&gt; a) -&gt; (a -&gt; a -&gt; a) -&gt; Tree v -&gt; a\nfoldTree empty value node = go \n  where\n    go tree =\n      case tree of\n        Empty    -&gt; empty\n        Value v  -&gt; value v\n        Node l r -&gt; node (go l) (go r)\n</code></pre>\n\n<p>This is done in Coq, as I know, and called \"induction\".</p>\n\n<p>2) I want to see predicates like <code>isEmpty</code> for all the branches. Seriously. The only language providing them is Pyret.</p>\n\n<p>3) For bonus points, I also want to have some ability to <code>derive</code> structural <code>Eq</code>uality, <code>Ord</code>ering, to- and from-string conversion.</p>\n\n<p>\u221e-1) To own my soul, you can also automatically generate lenses and prisms into all fields and branches accordingly.</p>\n\n<p>\u221e) To prove your own strength, you can also generate ana-, para- and apomorphisms, since <code>foldX</code> is a already a catamorphism.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 0, "accepted_answer_id": 38189531, "answer_count": 1, "score": 1, "last_activity_date": 1467652892, "creation_date": 1467623809, "last_edit_date": 1467624139, "question_id": 38180978, "link": "https://stackoverflow.com/questions/38180978/what-is-required-to-implement-an-adt-in-clojure", "title": "What is required to implement an ADT in Clojure?", "body": "<p>Assumption: I'm aware of the <a href=\"https://github.com/phansen/com.phansen.clojure.adt\" rel=\"nofollow\">ADT</a> libraries <a href=\"https://gist.github.com/aboekhoff/656004\" rel=\"nofollow\">here</a>. They're cool. Maybe they could be better. </p>\n\n<p>There is a really interesting example of ADT's in Clojure <a href=\"http://gizmo385.github.io/clojure/programming/2015/08/11/adts-in-clojure.html\" rel=\"nofollow\">here</a>:</p>\n\n<p>We define an ADT generator like this:</p>\n\n<pre class=\"lang-clj prettyprint-override\"><code>(defmacro data\n  [adt-name equals-sign &amp; constructors]\n  `(do\n     (defn ~(symbol (str adt-name \"?\")) [~'obj]\n       (= ~(str adt-name) (adt-name ~'obj)))\n     ~@(for [[type-name &amp; fields]\n             (filter (partial not= '(|))\n                     (partition-by (partial = '|) constructors))]\n         (apply (partial emit-constructor adt-name type-name)\n                 fields))))\n</code></pre>\n\n<p>Given the Haskell example:</p>\n\n<pre><code>data Tree a = Empty\n        | Leaf a\n        | Node Tree Tree\n</code></pre>\n\n<p>Then we write the Clojure </p>\n\n<pre><code>(data Tree = Empty | Leaf value | Node left right)\n</code></pre>\n\n<p>Which is pretty cool. </p>\n\n<p>Now I feel like there is something missing from matching up to the Haskell equivalent, but I can't quite put my finger on what it is. </p>\n\n<p>My question is: <strong>What is required to implement an ADT in Clojure?</strong></p>\n"}, {"tags": ["haskell", "lazy-evaluation", "ghci", "operator-precedence"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 10, "last_activity_date": 1467607882, "last_edit_date": 1467607882, "creation_date": 1467601867, "answer_id": 38176453, "question_id": 38176338, "link": "https://stackoverflow.com/questions/38176338/understanding-evaluate-functiion/38176453#38176453", "title": "Understanding `evaluate` Functiion", "body": "<p>Your <code>ys</code> value has a type of <code>IO [Int]</code>. Now, IO is a abstract type and can be thought of as <code>RealWorld -&gt; ([Int], RealWorld)</code> in your case. Now this <code>IO</code> value is already in weak head normal form. That's why you see it as <code>_</code> when you do <code>sprint</code> on it.</p>\n\n<blockquote>\n  <p>Why is <code>ys</code> not in Weak Head Normal Form, i.e. <code>:sprint ys</code> does not equal <code>_ : _</code>?</p>\n</blockquote>\n\n<p><code>ys</code> outer term cannot be <code>_ : _</code> because it's not a list but it is value of type <code>IO [Int]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 9, "last_activity_date": 1467609773, "creation_date": 1467609773, "answer_id": 38177428, "question_id": 38176338, "link": "https://stackoverflow.com/questions/38176338/understanding-evaluate-functiion/38177428#38177428", "title": "Understanding `evaluate` Functiion", "body": "<p>In addition to what has been said by Sibi, here is a way to see that <code>evaluate</code> actually does what the docs say:</p>\n\n<pre><code>GHCi&gt; let xs = [1..100] :: [Int]\nGHCi&gt; :sprint xs\nxs = _\nGHCi&gt; let a = evaluate xs &gt;&gt; return ()\nGHCi&gt; a\nGHCi&gt; :sprint xs\nxs = 1 : _\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "accepted_answer_id": 38176453, "answer_count": 2, "score": 2, "last_activity_date": 1467639113, "creation_date": 1467600875, "last_edit_date": 1467616718, "question_id": 38176338, "link": "https://stackoverflow.com/questions/38176338/understanding-evaluate-functiion", "title": "Understanding `evaluate` Functiion", "body": "<p>The Haskell <a href=\"https://www.haskell.org/hoogle/?hoogle=evaluate\" rel=\"nofollow\">docs</a> explain the <code>evaluate</code> function:</p>\n\n<blockquote>\n  <p>Forces its argument to be evaluated to weak head normal form when the resultant IO action is executed. </p>\n</blockquote>\n\n<pre><code>Prelude Control.Exception&gt; let xs = [1..100] :: [Int]                                                                   Prelude Control.Exception&gt; :sprint xs\nxs = _\nPrelude Control.Exception&gt; let ys = evaluate xs\nPrelude Control.Exception&gt; :t ys\nys :: IO [Int]\nPrelude Control.Exception&gt; ys\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,6Prelu2,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100]\nPrelude Control.Exception&gt; :sprint xs\nxs = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,\n      24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,\n      46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,\n      68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,\n      90,91,92,93,94,95,96,97,98,99,100]\nPrelude Control.Exception&gt; :sprint ys\nys = _\n</code></pre>\n\n<p>Why is <code>ys</code> not in Weak Head Normal Form, i.e. <code>:sprint ys</code> does not equal <code>_ : _</code>?</p>\n"}, {"tags": ["macos", "haskell", "cabal", "agda"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1467601467, "post_id": 38176164, "comment_id": 63779949, "body": "You may already have <code>happy</code> and <code>alex</code> on your system. How did you install Haskell in the first place?"}, {"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467602434, "post_id": 38176164, "comment_id": 63780122, "body": "@ErikR  It seems you are right, I can find <code>happy</code> and <code>alex</code> in my <code>bin</code> file fold, but I still can&#39;t proceed the <code>cabal install agra</code> step. P.S. I installed something called <code>unsigned</code>(<a href=\"http://stackoverflow.com/questions/32920452/how-to-run-haskell-on-osx-el-capitan\" title=\"how to run haskell on osx el capitan\">stackoverflow.com/questions/32920452/&hellip;</a>) when upgraded to OSX El Captain."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1467604315, "post_id": 38176164, "comment_id": 63780549, "body": "You might like <a href=\"https://github.com/markokoleznik/agda-writer\" rel=\"nofollow noreferrer\">Agda Writer</a>. Though, it wasn&#39;t updated for months."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467604558, "post_id": 38176164, "comment_id": 63780612, "body": "Which version of the Haskell Platform do you have installed?"}, {"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467604680, "post_id": 38176164, "comment_id": 63780644, "body": "@ErikR version 7.10.2"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467605260, "post_id": 38176164, "comment_id": 63780752, "body": "I know this is probably not what you are looking for but I would recommend you try and remove the HP, install stack and then try it - btw: if you cannot find the <code>.bash_profile</code> it&#39;s either because it&#39;s <i>hidden</i> (well not really but you know terminals and stuff won&#39;t show files beginning with <code>.</code> by default) so you just don&#39;t see it or it&#39;s really not there in this case you can simply create it (see <a href=\"http://alvinalexander.com/blog/post/mac-os-x/sample-mac-osx-bashrc-terminal-startup-file\" rel=\"nofollow noreferrer\">alvinalexander.com/blog/post/mac-os-x/&hellip;</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 0, "creation_date": 1467627980, "post_id": 38176948, "comment_id": 63790934, "body": "I am trying <code>Manual download</code>, but have no idea what does <code>$PATH</code> mean, how to set it and how do I know where is <code>the same directory where stack itself will install executables</code>?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1467640951, "last_edit_date": 1490005101, "creation_date": 1467606327, "answer_id": 38176948, "question_id": 38176164, "link": "https://stackoverflow.com/questions/38176164/install-agda-on-osx-el-capitan/38176948#38176948", "title": "Install Agda on OSX El Capitan?", "body": "<p>I would try building Agda with stack.</p>\n\n<ol>\n<li>Download <code>stack</code> for OSX using <a href=\"http://docs.haskellstack.org/en/stable/install_and_upgrade/#mac-os-x\" rel=\"nofollow noreferrer\">these instructions</a></li>\n<li><p>Run:</p>\n\n<pre><code>stack setup\nstack install Agda\n</code></pre></li>\n</ol>\n\n<p>Both steps might take a while. Watch the output to see where stack places the Agda programs - it probably will be something like <code>~/.local/bin</code></p>\n\n<p><strong>Update</strong></p>\n\n<p>Some explanation of the $PATH environment variable and how to set it:</p>\n\n<ul>\n<li><a href=\"https://coolestguidesontheplanet.com/add-shell-path-osx/\" rel=\"nofollow noreferrer\">https://coolestguidesontheplanet.com/add-shell-path-osx/</a></li>\n<li><a href=\"https://superuser.com/questions/284342/what-are-path-and-other-environment-variables-and-how-can-i-set-or-use-them\">https://superuser.com/questions/284342/what-are-path-and-other-environment-variables-and-how-can-i-set-or-use-them</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "is_accepted": true, "score": 0, "last_activity_date": 1467635440, "creation_date": 1467635440, "answer_id": 38184823, "question_id": 38176164, "link": "https://stackoverflow.com/questions/38176164/install-agda-on-osx-el-capitan/38184823#38184823", "title": "Install Agda on OSX El Capitan?", "body": "<p>After failing numerous times, I just uninstall the old version Haskell and reinstall it, and then the <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.MacOSX\" rel=\"nofollow\">http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.MacOSX</a> method works pretty well...</p>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 38184823, "answer_count": 2, "score": 0, "last_activity_date": 1505013748, "creation_date": 1467599213, "last_edit_date": 1505013748, "question_id": 38176164, "link": "https://stackoverflow.com/questions/38176164/install-agda-on-osx-el-capitan", "title": "Install Agda on OSX El Capitan?", "body": "<p>I was trying to instal Agda on my mac, following the instructions <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.MacOSX\" rel=\"nofollow\">http://wiki.portal.chalmers.se/agda/pmwiki.php?n=Main.MacOSX</a></p>\n\n<p>But I get some problems:</p>\n\n<ol>\n<li><p>When I typed <code>cabal update</code> in a Terminal window, it says <code>Skipping download: Local and remote files match.</code> I am not sure it means it worked or not.</p></li>\n<li><p>I can't find my <code>.bash_profile</code> file, so I don't know how to update my <code>PATH variable</code>.</p></li>\n<li><p>If I tried just skipping the first two steps above, typing <code>cabal install happy alex</code> directly, and it says the following:  </p>\n\n<pre><code>Resolving dependencies...\nConfiguring alex-3.1.7...\nConfiguring happy-1.19.5...\nBuilding happy-1.19.5...\nBuilding alex-3.1.7...\nFailed to install happy-1.19.5\nBuild log ( /Users/ChiuYenChao/.cabal/logs/happy-1.19.5.log ):\n[1 of 1] Compiling Main             ( /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28407/happy-1.19.5/dist/setup/setup.hs, /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28407/happy-1.19.5/dist/setup/Main.o )\nLinking /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28407/happy-1.19.5/dist/setup/setup ...\nConfiguring happy-1.19.5...\nBuilding happy-1.19.5...\nPreprocessing executable 'happy' for happy-1.19.5...\n&lt;command line&gt;: cannot satisfy -package-id mtl-2.2.1-7fee06b00eebbe3fa92f6d82f0fb6c19\n    (use -v for more information)\nFailed to install alex-3.1.7\nBuild log ( /Users/ChiuYenChao/.cabal/logs/alex-3.1.7.log ):\n[1 of 1] Compiling Main             ( /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28406/alex-3.1.7/dist/setup/setup.hs, /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28406/alex-3.1.7/dist/setup/Main.o )\nLinking /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-28406/alex-3.1.7/dist/setup/setup ...\nConfiguring alex-3.1.7...\nBuilding alex-3.1.7...\nPreprocessing executable 'alex' for alex-3.1.7...\n&lt;command line&gt;: cannot satisfy -package-id QuickCheck-2.8.1-720f6faecb50e002ef05e66ef82b9675\n    (use -v for more information)\ncabal: Error: some packages failed to install:\nalex-3.1.7 failed during the building phase. The exception was:\nExitFailure 1\nhappy-1.19.5 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I think this means something failed, but I don't know what to do. Help please.</p></li>\n</ol>\n\n<p><strong>EDIT</strong>:</p>\n\n<ol start=\"4\">\n<li><p>If I type <code>cabal install agda</code> directly, it gives me the following error:</p>\n\n<pre><code>Resolving dependencies...\nDownloading EdisonAPI-1.3...\nDownloading QuickCheck-2.8.2...\nConfiguring QuickCheck-2.8.2...\nDownloading STMonadTrans-0.3.3...\nConfiguring EdisonAPI-1.3...\nDownloading boxes-0.1.4...\nConfiguring boxes-0.1.4...\nDownloading data-hash-0.2.0.1...\nDownloading edit-distance-0.2.2.1...\nConfiguring STMonadTrans-0.3.3...\nDownloading geniplate-mirror-0.7.4...\nDownloading hashtables-1.2.1.0...\nDownloading monadplus-1.4.2...\nDownloading polyparse-1.12...\nDownloading strict-0.3.2...\nDownloading unix-compat-0.4.2.0...\nBuilding boxes-0.1.4...\nBuilding QuickCheck-2.8.2...\nBuilding STMonadTrans-0.3.3...\nFailed to install QuickCheck-2.8.2\nBuild log ( /Users/ChiuYenChao/.cabal/logs/QuickCheck-2.8.2.log ):\n[1 of 1] Compiling Main             ( /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-29102/QuickCheck-2.8.2/dist/setup/setup.hs, /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-29102/QuickCheck-2.8.2/dist/setup/Main.o )\nLinking /var/folders/bh/q7b8bhkj3bq8s6ml5zxvwfd40000gn/T/cabal-tmp-29102/QuickCheck-2.8.2/dist/setup/setup ...\nConfiguring QuickCheck-2.8.2...\nBuilding QuickCheck-2.8.2...\nPreprocessing library QuickCheck-2.8.2...\n&lt;command line&gt;: cannot satisfy -package-id random-1.1-1229fa9ea3f9951a38fad637630a5acf\n    (use -v for more information)\nBuilding EdisonAPI-1.3...\nFailed to install STMonadTrans-0.3.3\nBuild log ( /Users/ChiuYenChao/.cabal/logs/STMonadTrans-0.3.3.log ):\nConfiguring STMonadTrans-0.3.3...\nBuilding STMonadTrans-0.3.3...\nPreprocessing library STMonadTrans-0.3.3...\n&lt;command line&gt;: cannot satisfy -package-id mtl-2.2.1-7fee06b00eebbe3fa92f6d82f0fb6c19\n    (use -v for more information)\nFailed to install boxes-0.1.4\nBuild log ( /Users/ChiuYenChao/.cabal/logs/boxes-0.1.4.log ):\nConfiguring boxes-0.1.4...\nBuilding boxes-0.1.4...\nPreprocessing library boxes-0.1.4...\n&lt;command line&gt;: cannot satisfy -package-id split-0.2.2-bdc181dc0cb027cda71092df3fe3fb02\n    (use -v for more information)\nConfiguring data-hash-0.2.0.1...\nConfiguring edit-distance-0.2.2.1...\nConfiguring geniplate-mirror-0.7.4...\nConfiguring monadplus-1.4.2...\nFailed to install EdisonAPI-1.3\nBuild log ( /Users/ChiuYenChao/.cabal/logs/EdisonAPI-1.3.log ):\nConfiguring EdisonAPI-1.3...\nBuilding EdisonAPI-1.3...\nPreprocessing library EdisonAPI-1.3...\n&lt;command line&gt;: cannot satisfy -package-id mtl-2.2.1-7fee06b00eebbe3fa92f6d82f0fb6c19\n    (use -v for more information)\nBuilding data-hash-0.2.0.1...\nBuilding edit-distance-0.2.2.1...\nBuilding geniplate-mirror-0.7.4...\nBuilding monadplus-1.4.2...\nConfiguring hashtables-1.2.1.0...\nFailed to install edit-distance-0.2.2.1\nBuild log ( /Users/ChiuYenChao/.cabal/logs/edit-distance-0.2.2.1.log ):\nConfiguring edit-distance-0.2.2.1...\nBuilding edit-distance-0.2.2.1...\nPreprocessing library edit-distance-0.2.2.1...\n&lt;command line&gt;: cannot satisfy -package-id random-1.1-1229fa9ea3f9951a38fad637630a5acf\n    (use -v for more information)\nConfiguring unix-compat-0.4.2.0...\nFailed to install geniplate-mirror-0.7.4\nBuild log ( /Users/ChiuYenChao/.cabal/logs/geniplate-mirror-0.7.4.log ):\nConfiguring geniplate-mirror-0.7.4...\nBuilding geniplate-mirror-0.7.4...\nPreprocessing library geniplate-mirror-0.7.4...\n&lt;command line&gt;: cannot satisfy -package-id mtl-2.2.1-7fee06b00eebbe3fa92f6d82f0fb6c19\n    (use -v for more information)\nBuilding unix-compat-0.4.2.0...\nBuilding hashtables-1.2.1.0...\nConfiguring polyparse-1.12...\nFailed to install hashtables-1.2.1.0\nBuild log ( /Users/ChiuYenChao/.cabal/logs/hashtables-1.2.1.0.log ):\nConfiguring hashtables-1.2.1.0...\nBuilding hashtables-1.2.1.0...\nPreprocessing library hashtables-1.2.1.0...\n&lt;command line&gt;: cannot satisfy -package-id hashable-1.2.3.3-09c4177c49dd46a63f7036317bb17114\n    (use -v for more information)\nBuilding polyparse-1.12...\nConfiguring strict-0.3.2...\nFailed to install polyparse-1.12\nBuild log ( /Users/ChiuYenChao/.cabal/logs/polyparse-1.12.log ):\nConfiguring polyparse-1.12...\nBuilding polyparse-1.12...\nPreprocessing library polyparse-1.12...\n&lt;command line&gt;: cannot satisfy -package-id text-1.2.1.3-3718968f98d5614ccdc45c27d4e8b0a1\n    (use -v for more information)\nBuilding strict-0.3.2...\nInstalled monadplus-1.4.2\nInstalled unix-compat-0.4.2.0\nDownloading filemanip-0.3.6.3...\nConfiguring filemanip-0.3.6.3...\nBuilding filemanip-0.3.6.3...\nFailed to install filemanip-0.3.6.3\nBuild log ( /Users/ChiuYenChao/.cabal/logs/filemanip-0.3.6.3.log ):\nConfiguring filemanip-0.3.6.3...\nBuilding filemanip-0.3.6.3...\nPreprocessing library filemanip-0.3.6.3...\n&lt;command line&gt;: cannot satisfy -package-id mtl-2.2.1-7fee06b00eebbe3fa92f6d82f0fb6c19\n    (use -v for more information)\nInstalled data-hash-0.2.0.1\nInstalled strict-0.3.2\nUpdating documentation index\n/Users/ChiuYenChao/Library/Haskell/share/doc/x86_64-osx-ghc-7.10.2/index.html\ncabal: Error: some packages failed to install:\nAgda-2.5.1.1 depends on filemanip-0.3.6.3 which failed to install.\nEdisonAPI-1.3 failed during the building phase. The exception was:\nExitFailure 1\nEdisonCore-1.3.1.1 depends on EdisonAPI-1.3 which failed to install.\nQuickCheck-2.8.2 failed during the building phase. The exception was:\nExitFailure 1\nSTMonadTrans-0.3.3 failed during the building phase. The exception was:\nExitFailure 1\nboxes-0.1.4 failed during the building phase. The exception was:\nExitFailure 1\ncpphs-1.20.1 depends on polyparse-1.12 which failed to install.\nedit-distance-0.2.2.1 failed during the building phase. The exception was:\nExitFailure 1\nequivalence-0.3.1 depends on STMonadTrans-0.3.3 which failed to install.\nfilemanip-0.3.6.3 failed during the building phase. The exception was:\nExitFailure 1\ngeniplate-mirror-0.7.4 failed during the building phase. The exception was:\nExitFailure 1\nhashtables-1.2.1.0 failed during the building phase. The exception was:\nExitFailure 1\nhaskell-src-exts-1.17.1 depends on polyparse-1.12 which failed to install.\npolyparse-1.12 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467597541, "post_id": 38175725, "comment_id": 63779236, "body": "What do you mean exactly by &quot;doing a lot of mutually non-overlapping things&quot;? Some code and/or pseudo-code would help."}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467604449, "post_id": 38175725, "comment_id": 63780586, "body": "@ErikR Added some code to (hopefully) show what I&#39;m after."}], "answers": [{"comments": [{"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "edited": false, "score": 0, "creation_date": 1467622500, "post_id": 38177063, "comment_id": 63787585, "body": "This is basically what I ended up doing - I was wondering if that kind of thing is necessary, instead of just combining <code>Strategies</code>, I guess."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1467642026, "last_edit_date": 1467642026, "creation_date": 1467607187, "answer_id": 38177063, "question_id": 38175725, "link": "https://stackoverflow.com/questions/38175725/how-do-i-combine-the-benefits-of-parbuffer-and-parlistchunk/38177063#38177063", "title": "How do I combine the benefits of ``parBuffer`` and ``parListChunk``?", "body": "<p>So it seems you wan to compute:</p>\n\n<pre><code>map theNeedful allTables\n</code></pre>\n\n<p>but you want to do the mapping in batches of 512 tables.</p>\n\n<p>Does this look like it will work for you?</p>\n\n<pre><code>-- assuming:\ntheNeedful :: Table -&gt; Result\n\nnthreads = 4   -- number of threads to keep busy\nallTables = ...\nallBatches = chunksOf 512 allTables  -- from Data.List.Split\n\ndoBatch :: [Table] -&gt; [Result]\ndoBatch tables = map theNeedful tables\n\nresults :: [Result]\nresults = concat $ withStrategy (parBuffer nthreads rdeepseq) (map doBatch allBatches)\n...\n</code></pre>\n\n<p>In words:</p>\n\n<ol>\n<li>Break up the tables into chunks of 512 tables each</li>\n<li>map <code>doBatch</code> over all of the batches</li>\n<li>perform <code>parBuffer</code> on that list of computations</li>\n<li><code>concat</code> the resulting list</li>\n</ol>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 38177063, "answer_count": 1, "score": 2, "last_activity_date": 1467642026, "creation_date": 1467594600, "last_edit_date": 1467604432, "question_id": 38175725, "link": "https://stackoverflow.com/questions/38175725/how-do-i-combine-the-benefits-of-parbuffer-and-parlistchunk", "title": "How do I combine the benefits of ``parBuffer`` and ``parListChunk``?", "body": "<p>I have some Haskell code which involves doing a lot of mutually-non-overlapping things to a big (65.5k elements) list of items. This seemed like a good fit for parallelization, which I undertook using <code>Control.Parallel.Strategies.parBuffer</code>. This helped, but I'm convinced that the work is too fine-grained, and I would also like to process the list in chunks (as would be done by <code>Control.Parallel.Strategies.parListChunk</code>). However, because my list is large, experiments using <em>only</em> <code>parListChunk</code> did not gain as much speedup, as the entire 65-odd-thousand-item list had to be evaluated to make this work (as the memory use of the program showed).</p>\n\n<p>Is there a way to write a <code>Strategy</code> that gives me the benefits of <em>both</em> <code>parBuffer</code> (i.e. the list is treated as a lazy buffer with a controllable amount of evaluation) and also <code>parListChunk</code> (i.e. the work is broken down into pieces consisting of several elements of the list instead of individuals). I'm not really sure how to do this.</p>\n\n<p>Edit: As per request, here is what I am working with, complete with explanatory comments:</p>\n\n<pre><code>parBufferMap :: Int -&gt; Strategy b -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\nparBufferMap i strat f = withStrategy (parBuffer i strat) . fmap f\n\nmain :: IO ()\nmain = do\n  let allTables = genAllTables 4 -- a list of 65.5k Tables               \n  let results = parBufferMap 512 rdeepseq theNeedful allTables -- theNeedful is what I need to do to each Table, independently of each other\n  let indexed = zip [1..] results\n  let stringified = stringify &lt;$&gt; indexed -- make them pretty for output\n  void . traverse putStrLn $ stringified -- actually print them\n</code></pre>\n\n<p>My goal is to replace the <code>results</code> computation as it is (using <em>only</em> <code>parBufferMap</code>) with something that combines the benefits of <code>parBufferMap</code> and <code>parListChunk</code>.</p>\n"}, {"tags": ["haskell", "bit-manipulation"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1467575026, "post_id": 38173219, "comment_id": 63774610, "body": "You can emulate arithmetic with logic operations, but doubt it&#39;s faster."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467579240, "post_id": 38173219, "comment_id": 63775776, "body": "I can&#39;t avoid wondering why you can&#39;t use the <code>Num</code> subtraction, and the formula you posted."}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467584978, "post_id": 38173219, "comment_id": 63777027, "body": "@chi because I might have a type like data Mask = Mask Word Word ..., for which it would be quite natural to make a Bits instance, but Num is much more involved."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1467591708, "post_id": 38175113, "comment_id": 63778283, "body": "<code>FiniteBits</code> was terribly named, IMO. It should have been named <code>FixedBits</code> or something. <code>FiniteBits</code> should have admitted types each of whose values has finitely many bits."}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1467598020, "post_id": 38175113, "comment_id": 63779314, "body": "The typeclass solution looks best for the purpose. But doesn&#39;t it kind of violate the philosophy behind haskell typeclasses? It adds no new abstraction, no interesting algebraic laws.. Though it would have been a nice addition to the Bits package (I mean the function, not the typeclass)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 1, "creation_date": 1467716277, "post_id": 38175113, "comment_id": 63827180, "body": "@lanskey typeclasses are the mechanism that haskell uses to provide <i>ad hoc polymorphism</i>. Usually this involves having an abstraction but there are instances where you just want the ad hoc polymorphism, i.e. being able to implement some method for various types and write generic code that does the right thing. This seems one of those cases."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1467587225, "creation_date": 1467587225, "answer_id": 38175113, "question_id": 38173219, "link": "https://stackoverflow.com/questions/38173219/clear-the-least-significant-set-bit/38175113#38175113", "title": "Clear the least significant set bit", "body": "<p>You may overload the function to <em>pick</em> the more efficient implementation <em>at the type level</em>, when it is available. This requires adding a type class, but even with <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Bits.html#v:countTrailingZeros\" rel=\"nofollow\"><code>countTrailingZeros</code></a> implementation you already have to impose <em>some</em> type-class constraint to your function (namely <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Bits.html#t:FiniteBits\" rel=\"nofollow\"><code>FiniteBits</code></a>)<sup> (1)</sup>.</p>\n\n<p>In particular, with some language extensions, all <code>Num</code> types can set to use <code>a .&amp;. (a - 1)</code> equation<sup>(2)</sup>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nimport Data.Bits (Bits, (.&amp;.))\n\nclass LSB a where\n    clear :: a -&gt; a\n\ninstance (Bits a, Num a) =&gt; LSB a where\n    clear a = a .&amp;. (a - 1)  -- more efficient implementation\n\nnewtype Foo = ...  -- some type not instance of Num\n\ninstance LSB Foo where\n    clear a = ... -- some other approach\n</code></pre>\n\n<hr>\n\n<p><sub>1. do also note that with <code>countTrailingZeros</code> you are ruling out <code>Integer</code> type, that is <code>countTrailingZeros (16 :: Integer)</code> will <em>not</em> type check, since it is not an instance of <code>FiniteBits</code>.<br>\n2. Though would be better to write explicit instances than use those language extensions\n</sub></p>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1467623777, "creation_date": 1467571491, "last_edit_date": 1467623777, "question_id": 38173219, "link": "https://stackoverflow.com/questions/38173219/clear-the-least-significant-set-bit", "title": "Clear the least significant set bit", "body": "<p>I'd like to clear the least significant set bit of an arbitrary Bits type. The problem is, that I do not necessarily have the <code>Num</code> instance, so <code>x.&amp;.(x-1)</code> is not an option. The only function I could think of is this:</p>\n\n<pre><code>clearLsb x = x `clearBit` countTrailingZeros x\n</code></pre>\n\n<p>I benchmarked it against the <code>x&amp;(x-1)</code> version, and it is 1.5 slower on <code>Word32</code> and <code>Word64</code> regardless of the level of optimization. I would appreciate if anyone knows some clever hack to do it.</p>\n"}, {"tags": ["json", "xml", "haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467568503, "post_id": 38172672, "comment_id": 63772722, "body": "The README.md has detailed instructions on how to install and use the tool. Which step are you having trouble with?"}, {"owner": {"reputation": 5, "user_id": 6515321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f26284858d50333416fbcee4e5acbb6f?s=128&d=identicon&r=PG&f=1", "display_name": "Shanchuan Wu", "link": "https://stackoverflow.com/users/6515321/shanchuan-wu"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467571774, "post_id": 38172672, "comment_id": 63773696, "body": "Yes, I followed the instructions to install all packages needed, but when I use command: xml-to-json, the terminal says: unknown command. Because I never use Haskell before, I do not know whether the way I use the command is right. I upload the screenshot and hope that can help understand my question. Thanks"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467573774, "post_id": 38172672, "comment_id": 63774266, "body": "It&#39;s just a command line program like <code>ls</code>. Try <code>xml-to-json some-input-file.xml</code>"}], "answers": [{"tags": [], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "is_accepted": true, "score": 0, "last_activity_date": 1467574559, "creation_date": 1467574559, "answer_id": 38173668, "question_id": 38172672, "link": "https://stackoverflow.com/questions/38172672/how-to-use-haskell-tool-xml-to-json-in-terminal/38173668#38173668", "title": "How to use Haskell tool xml-to-json in terminal?", "body": "<p>Most probably, your executable is built but isn't in your PATH.</p>\n\n<p>On many systems cabal installs things to <code>$HOME/.local/bin</code>. So you can try adding that to your PATH environment variable.</p>\n\n<p>It looks like you're using a Mac, in which case the path to use is <code>$HOME/Library/Haskell/bin/</code>. <a href=\"https://wiki.haskell.org/Mac_OS_X#GHC\" rel=\"nofollow\">This page</a> seems to have relevant instructions on how to configure Mac OS X.</p>\n"}], "owner": {"reputation": 5, "user_id": 6515321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f26284858d50333416fbcee4e5acbb6f?s=128&d=identicon&r=PG&f=1", "display_name": "Shanchuan Wu", "link": "https://stackoverflow.com/users/6515321/shanchuan-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 38173668, "answer_count": 1, "score": 0, "last_activity_date": 1467574559, "creation_date": 1467567847, "last_edit_date": 1467571819, "question_id": 38172672, "link": "https://stackoverflow.com/questions/38172672/how-to-use-haskell-tool-xml-to-json-in-terminal", "title": "How to use Haskell tool xml-to-json in terminal?", "body": "<p>I am going to use xml-to-json to process a large xml file. I searched several methods, but they did not work due to out of memory. Then I found a tool implemented in Haskell, but when I tried this tool according to the guide, it says command not found. Could anyone please tell me how to use this tool? Thanks in advance. here is the link of the tool: <a href=\"https://github.com/sinelaw/xml-to-json#readme\" rel=\"nofollow\">https://github.com/sinelaw/xml-to-json#readme</a></p>\n\n<p><strong>Update</strong></p>\n\n<p><a href=\"http://i.stack.imgur.com/WaCkY.png\" rel=\"nofollow\">Screenshot of error</a></p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1467563490, "post_id": 38171870, "comment_id": 63771133, "body": "Section 4 <a href=\"https://wiki.haskell.org/Heterogenous_collections\" rel=\"nofollow noreferrer\">here</a> has a nice example of storing multiple items which have showable instances"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1467564176, "post_id": 38171870, "comment_id": 63771320, "body": "Be careful not to fall into this known antipattern: <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>"}, {"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467566087, "post_id": 38171870, "comment_id": 63771983, "body": "@pdexter As far as I understand what you recommended me, my definition of <code>Container</code> is effectively equivalent to that of <code>Showable</code>, except for the record syntax. Is it the record syntax then what makes it different for me? I find it weird that just a different syntax changes the semantics too..."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467566767, "post_id": 38171870, "comment_id": 63772174, "body": "You&#39;re using GADTs while the example is not. That&#39;s just one difference I spot at first glance. So it&#39;s not just different syntax but a different theory."}, {"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467568813, "post_id": 38171870, "comment_id": 63772827, "body": "@pdexter The example shows at its very end that it can be equivalently expressed using GADTs. But behzad.nouri&#39;s answer more or less explains the difference. Thank you anyway."}], "answers": [{"comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 1, "creation_date": 1467565866, "post_id": 38172057, "comment_id": 63771906, "body": "Your code didn&#39;t work for me, I got error <code>No instance for (Foo a) arising from a use of \u2018foo\u2019  Possible fix: add (Foo a) to the context of the data constructor \u2018Container\u2019</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 0, "creation_date": 1467568993, "post_id": 38172057, "comment_id": 63772881, "body": "I didn&#39;t notice that you also defined <code>Container</code> wrong. behzad.nouri&#39;s answer has what you meant."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1467563836, "creation_date": 1467563836, "answer_id": 38172057, "question_id": 38171870, "link": "https://stackoverflow.com/questions/38171870/store-and-retrieve-an-object-of-some-typeclass-is-it-possible-if-yes-how/38172057#38172057", "title": "Store and retrieve an object of some typeclass - is it possible? If yes, how?", "body": "<p>For example</p>\n\n<pre><code>main :: IO ()\nmain = do\n  case cont of\n    Container fi -&gt; putStrLn $ foo fi\n</code></pre>\n\n<p>You need to encapsulate your use of the existentially-typed field <code>fi</code> in an expression whose type does not depend on the type of <code>fi</code>; here <code>putStrLn $ foo fi</code> which has type <code>IO ()</code>.</p>\n\n<p>This example is quite useless since the only thing you can do to the <code>content</code> field of a <code>Container</code> is call <code>foo</code> on it, so you might as well just call <code>foo</code> before constructing the container and give the field type <code>String</code>. But it's more interesting if <code>Foo</code> has operations with types like <code>a -&gt; a -&gt; a</code>, or <code>Container</code> has multiple fields with types that involve the same existentially quantified variable, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 6, "last_activity_date": 1467579584, "last_edit_date": 1467579584, "creation_date": 1467566203, "answer_id": 38172417, "question_id": 38171870, "link": "https://stackoverflow.com/questions/38171870/store-and-retrieve-an-object-of-some-typeclass-is-it-possible-if-yes-how/38172417#38172417", "title": "Store and retrieve an object of some typeclass - is it possible? If yes, how?", "body": "<p>With:</p>\n\n<pre><code>data Container where\n    Container :: {content :: Foo a =&gt; a} -&gt; Container\n</code></pre>\n\n<p>the type class constraint <em>is not even enforced</em>. That is </p>\n\n<pre><code>void :: Container\nvoid = Container {content = 42 :: Int}\n</code></pre>\n\n<p>type checks even though <code>42 :: Int</code> is <em>not</em> an instance of <code>Foo</code>.</p>\n\n<p>But if you change to:</p>\n\n<pre><code>data Container where\n    Container :: Foo a =&gt; {content :: a} -&gt; Container\n</code></pre>\n\n<ol>\n<li>you no longer need <code>Rank2Types</code> language extension.</li>\n<li>the type class constraint is enforced; therefore above <code>void</code> example will no longer type check. </li>\n<li><p>further, you may invoke <code>foo</code> (or any other function with signature <code>Foo a =&gt; a -&gt; ...</code>) on the content with pattern matching:</p>\n\n<pre><code>case cont of Container {content = a} -&gt; foo a\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1467579584, "creation_date": 1467562672, "question_id": 38171870, "link": "https://stackoverflow.com/questions/38171870/store-and-retrieve-an-object-of-some-typeclass-is-it-possible-if-yes-how", "title": "Store and retrieve an object of some typeclass - is it possible? If yes, how?", "body": "<p>Suppose I have some typeclass <code>Foo</code> and some data type <code>FooInst</code> that is instance of <code>Foo</code>:</p>\n\n<pre><code>class Foo a where\n  foo :: a -&gt; String\n\ndata FooInst = FooInst String\n\ninstance Foo FooInst where\n    foo (FooInst s) = s\n</code></pre>\n\n<p>Now, I would like to define a data type that stores an object whose type is in the <code>Foo</code> typeclass and be able to extract that object from inside that data type and use it.</p>\n\n<p>The only way I found is to use GADTs and Rank2Types language extensions and define the data type like this:</p>\n\n<pre><code>data Container where\n  Container :: { content :: Foo a =&gt; a } -&gt; Container\n</code></pre>\n\n<p>However, the problem is, that I cannot use the <code>content</code> selector to get the content out of the Container:</p>\n\n<pre><code>cont :: Container\ncont = Container{content = FooInst \"foo\"}\n\nmain :: IO ()\nmain = do\n  let fi = content cont\n  putStrLn $ foo fi\n</code></pre>\n\n<p>results to a compile error</p>\n\n<pre><code>Cannot use record selector \u2018content\u2019 as a function due to escaped type variables\nProbable fix: use pattern-matching syntax instead\n</code></pre>\n\n<p>but when I modify the <code>let ...</code> line to</p>\n\n<pre><code>let Conainer fi = cont\n</code></pre>\n\n<p>I get a rather funny error</p>\n\n<pre><code>My brain just exploded\nI can't handle pattern bindings for existential or GADT data constructors.\nInstead, use a case-expression, or do-notation, to unpack the constructor.\n</code></pre>\n\n<p>And if I try to, again, modify the <code>let ...</code> line to use case-expression</p>\n\n<pre><code>let fi = case cont of\n           Container x -&gt; x\n</code></pre>\n\n<p>I get a a different error</p>\n\n<pre><code>Couldn't match expected type \u2018t\u2019 with actual type \u2018a\u2019\n  because type variable \u2018a\u2019 would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a pattern with constructor\n    Container :: forall a. (Foo a =&gt; a) -&gt; Container,\n  in a case alternative\n  at test.hs:23:14-24\n</code></pre>\n\n<p>So, <strong>how can I store a typeclassed thing and retrieve it back?</strong></p>\n"}, {"tags": ["c#", "haskell", "instance", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467546807, "post_id": 38169628, "comment_id": 63766282, "body": "I am unfamiliar with the library but it should be something like <code>instance Data.MessagePack.Object.MessagePack Rectangle where .....</code>."}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467547618, "post_id": 38169628, "comment_id": 63766461, "body": "i tried this, now i get: <code>test.hs:13:10:     Not in scope:       type constructor or class \u2018Data.MessagePack.Object.MessagePack\u2019</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467563367, "post_id": 38169628, "comment_id": 63771094, "body": "You probably need to <code>import Data.MessagePack.Object</code> and use <code>instance MessagePack Rectangle where</code>"}], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467556551, "post_id": 38170883, "comment_id": 63769023, "body": "Unfortunately i am very new to Haskell. What would be the implementation of toObject and fromObject in this case?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467563963, "post_id": 38170883, "comment_id": 63771270, "body": "Take a look at the source code for the instances in Data.MessagePack.Object for some ideas. Its linked from the documentation page."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1467555840, "creation_date": 1467555840, "answer_id": 38170883, "question_id": 38169628, "link": "https://stackoverflow.com/questions/38169628/haskell-no-instance-for-own-type/38170883#38170883", "title": "Haskell: No instance for own type", "body": "<p>First of all you will need to import <code>Data.MessagePack.Object</code>. That will bring the class <code>MessagePack</code> into scope.</p>\n\n<p>Then you need to say:</p>\n\n<pre><code>instance MessagePack Rectangle where\n   toObject rect = \n      -- Insert your implementation here, returning an Object\n   fromObject obj = \n      -- Insert your implementation here, returning a Maybe Rectangle\n</code></pre>\n\n<p>Compare this with the documentation for the <a href=\"http://hackage.haskell.org/package/msgpack-1.0.0/docs/Data-MessagePack-Object.html\" rel=\"nofollow\">MessagePack class</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "is_accepted": true, "score": 1, "last_activity_date": 1467564069, "last_edit_date": 1495541694, "creation_date": 1467564069, "answer_id": 38172090, "question_id": 38169628, "link": "https://stackoverflow.com/questions/38169628/haskell-no-instance-for-own-type/38172090#38172090", "title": "Haskell: No instance for own type", "body": "<p>Finally i solved this with the help of ErikR (<a href=\"https://stackoverflow.com/questions/31892857/how-to-derive-instances-of-data-messagepack-1-0-0/31894075?noredirect=1#comment63770818_31894075\">How to derive instances of Data.Messagepack 1.0.0</a>).\nHere is the final code:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule RectangleMover where\n\nimport Foreign.C\nimport FFI.Anything.TypeUncurry.Msgpack\nimport qualified Data.MessagePack as MP\nimport Data.MessagePack.Object\nimport Data.MessagePack.Aeson\nimport Data.Aeson\nimport GHC.Generics\n\ninstance ToJSON Point\ninstance FromJSON Point\ndata Point = Point Int Int deriving (Generic, Show)\nmovePoint :: Point -&gt; Int -&gt; Int -&gt; Point\nmovePoint (Point x y) dx dy = Point (x + dx) (y + dy)\n\ninstance ToJSON Rectangle\ninstance FromJSON Rectangle\ndata Rectangle = Rectangle { corner :: Point, width :: Int, height :: Int } deriving (Generic, Show)\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {corner=c}) dx dy = r { corner = movePoint c dx dy }\n\ntoMsgPack :: Rectangle  -&gt; Maybe MP.Object\ntoMsgPack =   decode . encode\n\np = Point 1 2\nrect = Rectangle p 10 20\ntest = toMsgPack (rect)\n</code></pre>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 38172090, "answer_count": 2, "score": 0, "last_activity_date": 1467564069, "creation_date": 1467546396, "question_id": 38169628, "link": "https://stackoverflow.com/questions/38169628/haskell-no-instance-for-own-type", "title": "Haskell: No instance for own type", "body": "<p>I'm trying to export own types to C# with using the \"call-haskell-to-anything\" package with this code:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nmodule RectangleMover where\n\nimport Foreign.C\nimport FFI.Anything.TypeUncurry.Msgpack\n\ndata Point = Point Int Int\nmovePoint :: Point -&gt; Int -&gt; Int -&gt; Point\nmovePoint (Point x y) dx dy = Point (x + dx) (y + dy)\n\ndata Rectangle = Rectangle { corner :: Point, width :: Int, height :: Int }\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {corner=c}) dx dy = r { corner = movePoint c dx dy }\n\nforeign export ccall move_export :: CString -&gt; IO CString\nmove_export :: CString -&gt; IO CString\nmove_export = export move\n</code></pre>\n\n<p>When i try to compile this file i get the error message:</p>\n\n<pre><code>[1 of 1] Compiling RectangleMover   ( test.hs, test.o )\n\ntest.hs:19:15:\n    No instance for (Data.MessagePack.Object.MessagePack Rectangle)\n      arising from a use of \u2018export\u2019\n    In the expression: export move\n    In an equation for \u2018move_export\u2019: move_export = export move\n</code></pre>\n\n<p>So i think i have to write an \"instance\" for the \"rectangle\" type. But what is the correct syntax for this? I already tried to add :</p>\n\n<pre><code>instance Rectangle where\n</code></pre>\n\n<p>but got this error message:</p>\n\n<pre><code>test.hs:13:10:\n    Expected a constraint, but \u2018Rectangle\u2019 has kind \u2018*\u2019\n    In the instance declaration for \u2018Rectangle\u2019\n</code></pre>\n"}, {"tags": ["haskell", "functor", "category-theory", "arrows", "profunctor"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 5, "creation_date": 1467545550, "post_id": 38169453, "comment_id": 63765970, "body": "<a href=\"https://github.com/purescript-deprecated/purescript-arrows/issues/9\" rel=\"nofollow noreferrer\">Kmett says</a> Arrow is precisely Strong Category."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1467545680, "post_id": 38169453, "comment_id": 63766011, "body": "<a href=\"https://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor-Composition.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/profunctors-5.2/docs/&hellip;</a> ?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1467565986, "post_id": 38169453, "comment_id": 63771948, "body": "Linked in the <a href=\"http://blog.sigfpe.com/2011/07/profunctors-in-haskell.html\" rel=\"nofollow noreferrer\">Profunctors in Haskell</a>: <a href=\"http://www-mmm.is.s.u-tokyo.ac.jp/~ichiro/papers/fromComptoComp.pdf\" rel=\"nofollow noreferrer\">Categorifying Computations into Components via Arrows as Profunctors</a>."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 37, "last_activity_date": 1467568276, "last_edit_date": 1467568276, "creation_date": 1467566004, "answer_id": 38172390, "question_id": 38169453, "link": "https://stackoverflow.com/questions/38169453/whats-the-relationship-between-profunctors-and-arrows/38172390#38172390", "title": "What&#39;s the relationship between profunctors and arrows?", "body": "<blockquote>\n  <p>What profunctors lack compared to arrows is the ability to compose them. If we add composition, will we get an arrow?</p>\n</blockquote>\n\n<h2>MONOIDS</h2>\n\n<p>This is exactly the question tackled in section 6 of \"<a href=\"http://arxiv.org/pdf/1406.4823.pdf\" rel=\"noreferrer\">Notions of Computation as Monoids</a>,\" which unpacks a result from the (rather dense) \"<a href=\"http://homepages.inf.ed.ac.uk/cheunen/publications/2008/arrows/arrows.pdf\" rel=\"noreferrer\">Categorical semantics for arrows</a>\". \"Notions\" is a great paper because while it dives deep into category theory it (1) doesn't assume the reader has more than a cursory knowledge of abstract algebra and (2) illustrates most of the migraine-inducing mathematics with Haskell code. We can briefly summarize section 6 of the paper here:</p>\n\n<p>Say we have</p>\n\n<pre><code>class Profunctor p where\n  dimap :: (contra' -&gt; contra) -&gt; (co -&gt; co') -&gt; p contra co -&gt; p contra' co'\n</code></pre>\n\n<p>Your bog-standard, negative-and-positive dividin' encoding of profunctors in Haskell. Now this data type,</p>\n\n<pre><code>data (\u2297) f g contra co = forall x. (f contra x) \u2297 (g x co)\n</code></pre>\n\n<p>as implemented in <a href=\"https://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor-Composition.html\" rel=\"noreferrer\">Data.Profunctor.Composition</a>, acts like composition for profunctor. We can, for example, demonstrate a lawful instance <code>Profunctor</code>:</p>\n\n<pre><code>instance (Profunctor f, Profunctor g) =&gt; Profunctor (f \u2297 g) where\n  dimap contra co (f \u2297 g) = (dimap contra id f) \u2297 (dimap id co g)\n</code></pre>\n\n<p>We will hand-wave the proof that it is lawful for reasons of time and space.</p>\n\n<p>OK. Now the fun part. Say we this typeclass:</p>\n\n<pre><code>class Profunctor p =&gt; ProfunctorMonoid p where\n  e :: (a -&gt; b) -&gt; p a b\n  m :: (p \u2297 p) a b -&gt; p a b\n</code></pre>\n\n<p>This is, with a lot more hand-waving, a way of encoding the notion of profunctor monoids in Haskell. Specifically this is a monoid in the monoidal category <code>Pro</code>, which is a monoidal structure for the functor category <code>[C^op x C, Set]</code> with <code>\u2297</code> as the tensor and <code>Hom</code> as its unit. So there's a lot of ultraspecific mathematical diction to unpack here but for that you should just read the paper.</p>\n\n<p>We then see that <code>ProfunctorMonoid</code> is isomorphic to <code>Arrow</code> ... almost.</p>\n\n<pre><code>instance ProfunctorMonoid p =&gt; Category p where\n  id = dimap id id\n  (.) pbc pab = m (pab \u2297 pbc)\n\ninstance ProfunctorMonoid p =&gt; Arrow p where\n  arr = e\n  first = undefined\n\ninstance Arrow p =&gt; Profunctor p where\n  lmap = (^&gt;&gt;)\n  rmap = (&gt;&gt;^)\n\ninstance Arrow p =&gt; ProfunctorMonoid p where\n  e = arr\n  m (pax \u2297 pxb) = pax &gt;&gt; pxb\n</code></pre>\n\n<p>Of course we are ignoring the typeclass laws here but, as the paper shows, they do work out fantastically.</p>\n\n<p>Now I said almost because crucially we were unable to implement <code>first</code>. What we have really done is demonstrated an isomorphism between <code>ProfunctorMonoid</code> and <em>pre-arrows</em> .The paper calls <code>Arrow</code> without <code>first</code> a <em>pre-arrow</em>. It then goes on to show that</p>\n\n<pre><code>class Profunctor p =&gt; StrongProfunctor p where\n  first :: p x y -&gt; p (x, z) (y, z)\n\nclass StrongProfunctor p =&gt; StrongProfunctorMonoid p where\n  e :: (a -&gt; b) -&gt; p a b\n  m :: (p \u2297 p) a b -&gt; p a b\n</code></pre>\n\n<p>is necessary and sufficient for the desired isomorphism to <code>Arrow</code>. The word \"strong\" comes from a specific notion in category theory and is described by the paper in better writing and richer detail than I could ever muster.</p>\n\n<p>So to summarize:</p>\n\n<ul>\n<li><p>A monoid in the category of profunctors is a pre-arrow, and vice versa. (A previous version of the paper used the term \"weak arrows\" instead of pre-arrows, and that's OK too I guess.)</p></li>\n<li><p>A monoid in the category of strong profunctors is an arrow, and vice versa.</p></li>\n<li><p>Since monad is a monoid in the category of endofunctors we can think of the SAT analogy <code>Functor : Profunctor :: Monad : Arrow</code>. This is the real thrust of the notions-of-computation-as-monoids paper.</p></li>\n<li><p>Monoids and monoidal categories are gentle sea creatures that appear everywhere, and it's a shame that some students will go through computer science or software engineering education without being taught monoids.</p></li>\n<li><p>Category theory is fun.</p></li>\n<li><p>Haskell is fun.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 1, "creation_date": 1540908004, "post_id": 41679602, "comment_id": 93030337, "body": "With that <code>dimap f id id</code> piece you&#39;ve opened my eyes. Finally I realize how <code>Strong</code> and <code>Category</code> are sufficient for <code>Arrow</code>! :) Thanks"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1542588563, "post_id": 41679602, "comment_id": 93610674, "body": "<code>dimap id f id</code>, yes."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 6, "last_activity_date": 1484611916, "last_edit_date": 1484611916, "creation_date": 1484580088, "answer_id": 41679602, "question_id": 38169453, "link": "https://stackoverflow.com/questions/38169453/whats-the-relationship-between-profunctors-and-arrows/41679602#41679602", "title": "What&#39;s the relationship between profunctors and arrows?", "body": "<p>@haoformayor's answer (and the referenced paper) is a great insight into the underlying category theory - monoidal categories are rather beautiful! - but I thought some code showing you how to turn an <code>Arrow</code> into a <code>Strong Category</code> and vice versa as they appear in their respective libraries might make a helpful addendum.</p>\n\n<pre><code>import Control.Arrow\nimport Control.Category\nimport Data.Profunctor\nimport Data.Profunctor.Strong\nimport Prelude hiding (id, (.))\n</code></pre>\n\n<p>One way...</p>\n\n<pre><code>newtype WrapP p a b = WrapP { unwrapP :: p a b }\n\ninstance Category p =&gt; Category (WrapP p) where\n    id = WrapP id\n    WrapP p . WrapP q = WrapP (p . q)\n\ninstance (Category p, Strong p) =&gt; Arrow (WrapP p) where\n    first = WrapP . first' . unwrapP\n    second = WrapP . second' . unwrapP\n\n    -- NB. the first usage of id comes from (-&gt;)'s Category instance (id :: a -&gt; a)\n    -- but the second uses p's instance (id :: p a a)\n    arr f = WrapP $ dimap f id id\n</code></pre>\n\n<p>... and t'other...</p>\n\n<pre><code>newtype WrapA p a b = WrapA { unwrapA :: p a b }\n\ninstance Arrow p =&gt; Profunctor (WrapA p) where\n    dimap f g p = WrapA $ arr f &gt;&gt;&gt; unwrapA p &gt;&gt;&gt; arr g\n\ninstance Arrow p =&gt; Strong (WrapA p) where\n    first' = WrapA . first . unwrapA\n    second' = WrapA . second . unwrapA\n</code></pre>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2810, "favorite_count": 9, "accepted_answer_id": 38172390, "answer_count": 2, "score": 27, "last_activity_date": 1559519077, "creation_date": 1467545055, "last_edit_date": 1559519077, "question_id": 38169453, "link": "https://stackoverflow.com/questions/38169453/whats-the-relationship-between-profunctors-and-arrows", "title": "What&#39;s the relationship between profunctors and arrows?", "body": "<p>Apparently, every <code>Arrow</code> is a <a href=\"https://hackage.haskell.org/package/profunctors-4.3.2/docs/Data-Profunctor.html#t:Strong\" rel=\"noreferrer\"><code>Strong</code></a> profunctor. Indeed <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#v:-94--62--62-\" rel=\"noreferrer\"><code>^&gt;&gt;</code></a> and <code>&gt;&gt;^</code> correspond to <code>lmap</code> and <code>rmap</code>. And <code>first'</code> and <code>second'</code> are just the same as <code>first</code> and <code>second</code>. Similarly every <code>ArrowChoice</code> is also <a href=\"https://hackage.haskell.org/package/profunctors-4.3.2/docs/Data-Profunctor.html#t:Choice\" rel=\"noreferrer\"><code>Choice</code></a>.</p>\n\n<p>What profunctors lack compared to arrows is the ability to compose them. If we add composition, will we get an arrow? In other words, if a (strong) profunctor is also a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Category.html#t:Category\" rel=\"noreferrer\">category</a>, is it already an arrow? If not, what's missing?</p>\n"}, {"tags": ["haskell", "ide", "atom-editor"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467544835, "post_id": 38169392, "comment_id": 63765810, "body": "are you looking for a <i>REPL</i>? AFAIK it&#39;s in <a href=\"https://atom.io/packages/ide-haskell-repl\" rel=\"nofollow noreferrer\">atom.io/packages/ide-haskell-repl</a> - but it probably lacks stack support - so I guess just open a terminal/command-prompt and do <code>stack repl</code> in your projects folder"}, {"owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467609434, "post_id": 38169392, "comment_id": 63781779, "body": "Yep there it is right in front of me - that&#39;s correct thanks @Carsten - and it works with stack . Feel free to make this an answer if not I&#39;ll copy it into an answer next week sometime."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1467611691, "creation_date": 1467611691, "answer_id": 38177746, "question_id": 38169392, "link": "https://stackoverflow.com/questions/38169392/using-atom-with-stack-haskell-how-to-interactively-evaluate-from-within-ide/38177746#38177746", "title": "Using Atom with Stack (Haskell) - How to interactively evaluate from within IDE", "body": "<p>as you checked for yourself the <a href=\"https://atom.io/packages/ide-haskell-repl\" rel=\"nofollow\">ide-haskell-repl</a> <em>atom-package</em> should work here</p>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 0, "accepted_answer_id": 38177746, "answer_count": 1, "score": 1, "last_activity_date": 1471149139, "creation_date": 1467544521, "last_edit_date": 1471149139, "question_id": 38169392, "link": "https://stackoverflow.com/questions/38169392/using-atom-with-stack-haskell-how-to-interactively-evaluate-from-within-ide", "title": "Using Atom with Stack (Haskell) - How to interactively evaluate from within IDE", "body": "<p>I am new to Atom / Stack / Haskell and after a fair bit of hand wringing managed to get set up on my windows 10 box. </p>\n\n<p>One thing I am still stumped on is finding a way to set up interactive evaluation from within Atom (like \"debugging\" in Leksah)? </p>\n\n<p>I have installed the \"Script\" which looks promising but all I get is: </p>\n\n<pre><code>'ghc' is not recognized as an internal or external command,operable program or batch file.\n</code></pre>\n\n<p>I presume I need some kind of configuration but I can't work out what's required. I think need a way to pipe through to an open ghci console. </p>\n\n<p>Is there a way of setting this up with \"Script\"or any similar package?</p>\n\n<p>Thanks</p>\n\n<p>John</p>\n"}, {"tags": ["haskell", "dictionary", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467543457, "post_id": 38169236, "comment_id": 63765501, "body": "that&#39;s a couple of questions - for the first observe that the <code>xs</code> there already <i>was</i> mapped by <code>f</code> (look at the definition of <code>foldr</code> to see why) (also <code>f xs</code> would not be well-typed as you had <code>f :: a -&gt; b</code> and at the same time <code>f :: [a] -&gt; b&#39;</code> so you would need to identify <code>a ~ [a]</code>)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467543538, "post_id": 38169236, "comment_id": 63765523, "body": "Note that <code>foldr f z [x1, x2, x3] = f x1 (f x2 (f x3 z))</code> so the <code>xs</code> was already mapped by <code>f</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467543601, "post_id": 38169236, "comment_id": 63765536, "body": "for the second: just note that <code>foldl</code> will <i>loop</i> through <code>xs</code> from the left (again look at the definition)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467543685, "post_id": 38169236, "comment_id": 63765550, "body": "for the very last: it&#39;s just the difference between folding from left vs folding from right - just try your different implementation and have a look for yourself!"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6543469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2826b44fc82a68cbdaa81c300c96fd8b?s=128&d=identicon&r=PG&f=1", "display_name": "user22709", "link": "https://stackoverflow.com/users/6543469/user22709"}, "edited": false, "score": 0, "creation_date": 1467569446, "post_id": 38169306, "comment_id": 63773002, "body": "Thanks! I think I understand foldr. map with foldl would be like this? <code>map f l   = foldl (\\x xs -&gt; x : f xs) [] l</code> So <code>x</code> is the mapped part and <code>xs</code> is mapped on?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11, "user_id": 6543469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2826b44fc82a68cbdaa81c300c96fd8b?s=128&d=identicon&r=PG&f=1", "display_name": "user22709", "link": "https://stackoverflow.com/users/6543469/user22709"}, "edited": false, "score": 0, "creation_date": 1467571282, "post_id": 38169306, "comment_id": 63773545, "body": "@user22709 Morally yes, but note that in that case <code>x</code> is a (mapped) list, and <code>xs</code> is an element so it should be <code>foldl (\\x xs -&gt; x ++ [f xs]) [] list</code>"}, {"owner": {"reputation": 11, "user_id": 6543469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2826b44fc82a68cbdaa81c300c96fd8b?s=128&d=identicon&r=PG&f=1", "display_name": "user22709", "link": "https://stackoverflow.com/users/6543469/user22709"}, "edited": false, "score": 0, "creation_date": 1467572022, "post_id": 38169306, "comment_id": 63773775, "body": "Thank you! Do you have a suggestion for a more elegant way to write that, because xs is normally the rest of the list, which isn&#39;t the case here..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11, "user_id": 6543469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2826b44fc82a68cbdaa81c300c96fd8b?s=128&d=identicon&r=PG&f=1", "display_name": "user22709", "link": "https://stackoverflow.com/users/6543469/user22709"}, "edited": false, "score": 0, "creation_date": 1467579102, "post_id": 38169306, "comment_id": 63775732, "body": "@user22709 Actually, I would avoid foldl since appending at the end as in <code>.. ++ [..]</code> is known to be inefficient. If you still want, simply choose some reasonable names for <code>x,xs</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1467543929, "creation_date": 1467543929, "answer_id": 38169306, "question_id": 38169236, "link": "https://stackoverflow.com/questions/38169236/define-functions-with-foldl-foldr/38169306#38169306", "title": "Define functions with foldl foldr", "body": "<p>The code</p>\n\n<pre><code>foldr (\\x xs -&gt; ...) end list\n</code></pre>\n\n<p>could be read, roughly, as follows</p>\n\n<ul>\n<li>scan the whole <code>list</code></li>\n<li>if it's empty, just return end <code>end</code></li>\n<li>otherwise:\n\n<ul>\n<li>let <code>x</code> be the element at hand</li>\n<li>let <code>xs</code> be the rest of the list, <em>after having been processed</em></li>\n<li>apply the <code>...</code> operation</li>\n</ul></li>\n</ul>\n\n<p>The emphasized part is crucial. <code>xs</code> is <em>not</em> the rest of the list, but the result of the \"recursive call\" on it.</p>\n\n<p>Indeed, <code>xs</code> is a bad name for that. In thee general case, it's not even a list! E.g. one would never write (silly example)</p>\n\n<pre><code>foldr (\\x xs -&gt; x + xs) 0 [1..100]  -- sum 1..100\n</code></pre>\n\n<p>but rather prefer something like</p>\n\n<pre><code>foldr (\\x partialSum -&gt; x + partialSum) 0 [1..100]  -- sum 1..100\n</code></pre>\n\n<p>(Actually, one would not sum using <code>foldr</code>, but let's leave that aside.)</p>\n\n<p>So, just read it like this:</p>\n\n<pre><code>map f l   = foldr (\\x mappedTail -&gt; f x : mappedTail) [] l\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6543469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2826b44fc82a68cbdaa81c300c96fd8b?s=128&d=identicon&r=PG&f=1", "display_name": "user22709", "link": "https://stackoverflow.com/users/6543469/user22709"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1180, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1467543929, "creation_date": 1467543349, "question_id": 38169236, "link": "https://stackoverflow.com/questions/38169236/define-functions-with-foldl-foldr", "title": "Define functions with foldl foldr", "body": "<p>I understand the definitions of foldl, foldr, but I have problems with functions defined by them. </p>\n\n<p>For example map with foldr:</p>\n\n<pre><code>map f []       = []\nmap f l   = foldr (\\x xs -&gt; f x : xs) [] l\n</code></pre>\n\n<p>I don't understand the <code>(\\x xs -&gt; f x : xs)</code>. It is the map function, which foldr takes? But shouldn't it be <code>(\\x xs -&gt; f x : f xs)</code>, because <code>map f (x:xs) = f x : map f xs</code>?</p>\n\n<p>Example with foldl:</p>\n\n<pre><code>concat (x:xs) = x ++ concat xs\n\nconcat' xs = foldl (++) [] xs\nconcat'' xs = foldl (\\ys y -&gt; ys ++ y) [] xs\n</code></pre>\n\n<p>Of course I understand <code>(++)</code>, but what's the logic behind <code>(\\ys y -&gt; ys ++ y)</code>? Is it <code>ys = []</code> and <code>y = xs</code>?\nSo the function takes <code>[]</code> as <code>ys</code> and <code>y</code> is the first element of <code>xs</code> and concates the <code>[]</code> with the <code>y</code>?\nConcrete example:</p>\n\n<pre><code>concat'' [1,2,3] = foldl (\\ys y -&gt; ys ++ y) [] [1,2,3]\n=&gt; foldl (\\ys y -&gt; ys ++ y) ((\\ys y -&gt; ys ++ y) [] [1]) [2,3]\n=&gt; foldl (\\ys y -&gt; ys ++ y) [1] [2,3]\n=&gt; foldl (\\ys y -&gt; ys ++ y) ((\\ys y -&gt; ys ++ y) [1] [2]) [3]\n=&gt; foldl (\\ys y -&gt; ys ++ y) [1,2] [3]\n=&gt; foldl (\\ys y -&gt; ys ++ y) ((\\ys y -&gt; ys ++ y) [1,2] [3]) []\n=&gt; foldl (\\ys y -&gt; ys ++ y) [1,2,3] []\n=&gt; [1,2,3]\n</code></pre>\n\n<p>Another thing: <code>concat</code> only takes 1 list <code>xs</code>, so if I want to concat 2 lists?</p>\n\n<pre><code>concat (x:xs) ys = x ++ concat xs ys\nconcat [1,2,3] [4,5,6] with foldl?\n</code></pre>\n\n<p>Reverse:</p>\n\n<pre><code>reverse (x:xs) = reverse xs ++ [x]\n\nreverse'  l = foldl (\\xs x -&gt; [x] : xs) [] l\nreverse'' l = foldr (\\x xs -&gt; xs ++ [x]) [] l\n</code></pre>\n\n<p>The foldr is intuitive clear (with the questions from above), but what's behind the reverse order in foldl <code>(\\xs x -&gt; [x] : xs)</code>? This <code>foldl (\\x xs -&gt; xs ++ [x]) [] l</code> would be wrong, wouldn't it?</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["performance", "haskell", "optimization", "allocation"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467608561, "post_id": 38169235, "comment_id": 63781569, "body": "Since you don&#39;t give much context, I can&#39;t really come up with any out-of-box ideas. But you might consider whether it would be better to represent a <code>Clause</code> as two <code>IntSet</code>s, one for the <code>Neg</code> values and one for the <code>Pos</code> values. You should also note that a <code>Set</code> of sets is generally likely to be slow, but that&#39;s more a result of comparison costs than allocation."}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467622429, "post_id": 38169235, "comment_id": 63787548, "body": "@dfeuer My main motivation for using sets for both <code>Clause</code>s and <code>Form</code>s is that I want them to have unique membership. Is there an alternative structure I can use which won&#39;t have the problem you&#39;re describing regarding sets of sets being slow?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467638633, "post_id": 38169235, "comment_id": 63797263, "body": "Unique membership? I&#39;m not sure what you mean. If an element should appear as <code>Neg</code> or <code>Pos</code> but not both, you don&#39;t accomplish that. To get that, you should use <code>data Sign = Neg | Pos</code>, and then <code>IntMap Sign</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1467545560, "creation_date": 1467545560, "answer_id": 38169517, "question_id": 38169235, "link": "https://stackoverflow.com/questions/38169235/suggestions-for-reducing-allocations-and-work-in-this-haskell-function/38169517#38169517", "title": "Suggestions for reducing allocations (and work) in this Haskell function", "body": "<p>I would experiment with <code>S.foldr</code>.</p>\n\n<p>From your code, it looks as if these are AND-clauses, so I will assume an empty clause is false.</p>\n\n<pre><code>evalClause (Clause x) = S.foldr f (Just False) $ S.map evalAtom x\n     where f b@(Just False) _              = b\n           f (Just True)    y              = y\n           f Nothing        y@(Just False) = y\n           f Nothing        y              = Nothing\n</code></pre>\n\n<p>and the analogous for <code>evalForm</code>.</p>\n\n<p>It might also be beneficial to use lists rather than sets. Sets, as implemented, are strict, and (I think) will not trigger some optimizations like fusion/deforestation/etc. Lists are lazily produced, and should behave better in this sort of code.</p>\n\n<pre><code>evalClause (Clause x) = foldr f (Just False) . map evalAtom $ S.toList x\n     ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1467546018, "creation_date": 1467546018, "answer_id": 38169576, "question_id": 38169235, "link": "https://stackoverflow.com/questions/38169235/suggestions-for-reducing-allocations-and-work-in-this-haskell-function/38169576#38169576", "title": "Suggestions for reducing allocations (and work) in this Haskell function", "body": "<p>An observation:</p>\n\n<p>A <code>Maybe Bool</code> can only have three possible values - <code>Nothing</code>, <code>Just False</code> and <code>Just True</code>.</p>\n\n<p><code>evaluated</code> in both <code>evalClause</code> and <code>evalForm</code> has type <code>Set (Maybe Bool)</code> which can be represented with three bits which fits in a Int.</p>\n\n<p>I would define:</p>\n\n<pre><code>data MaybeBool = Nuthin | JustFalse | JustTrue\n  deriving (Eq, Ord, Enum, Bounded, Show, Read)\n</code></pre>\n\n<p>and change the signature of <code>intepret</code> return a <code>MaybeBool</code></p>\n\n<p>Then define <code>evaluated</code> as a bitset like this:</p>\n\n<pre><code>import Data.Bits\n\nevaluated = foldl' combine 0 (map evalAtom (S.toList x))\n  where combine s a = s .|. (1 `shiftLeft` fromEnum a)\n</code></pre>\n\n<p><code>evaluated</code> will be a Int between 0 and 7 with bit 0 set if <code>Nutin</code> is in the set, bit 1 set if <code>JustFalse</code> is in the set and bit 2 set if <code>JustTrue</code> is in the set. This will eliminate allocation of Sets from your computation.</p>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 38169517, "answer_count": 2, "score": 1, "last_activity_date": 1467546018, "creation_date": 1467543340, "question_id": 38169235, "link": "https://stackoverflow.com/questions/38169235/suggestions-for-reducing-allocations-and-work-in-this-haskell-function", "title": "Suggestions for reducing allocations (and work) in this Haskell function", "body": "<p>I have the following function in my (much larger) Haskell code (with some supporting code to make it clear what's what):</p>\n\n<pre><code>import qualified Data.Set as S\nimport qualified Data.IntMap.Strict as M\nimport Data.Ord\nimport Data.Monoid\n\ndata Atom = Neg { index :: Int }\n          | Pos { index :: Int }\n          deriving (Eq, Ord, Show, Read) \n\nnewtype Clause = Clause { atoms :: S.Set Atom }\n  deriving (Eq, Show, Read)\n\ninstance Ord Clause where\n  compare = comparing (Down . S.size . atoms) &lt;&gt; comparing atoms\n\nnewtype Form = Form { clauses :: S.Set Clause }\n  deriving (Eq, Ord, Show, Read)\n\ntype Interpretation = M.IntMap Bool\n\n-- the function of interest\ninterpret :: Interpretation -&gt; Form -&gt; Maybe Bool\ninterpret interp = evalForm\n  where evalAtom x@(Pos _) = M.lookup (index x) interp\n        evalAtom x@(Neg _) = not &lt;$&gt; M.lookup (index x) interp\n        evalClause (Clause x)\n          | S.member (Just False) evaluated = Just False\n          | evaluated == S.singleton (Just True) = Just True\n          | otherwise = Nothing\n          where evaluated = S.map evalAtom x\n        evalForm (Form x)\n          | S.member (Just True) evaluated = Just True\n          | evaluated == S.singleton (Just False) = Just False\n          | otherwise = Nothing\n          where evaluated = S.map evalClause x\n</code></pre>\n\n<p>Having profiled my Haskell program, I've found that this <code>interpret</code> function's allocations comprise nearly 40% of all allocations in my program (as well as about 40% of the CPU work). </p>\n\n<p>Is there any way I can reduce either the amount of work <code>interpret</code> does, or the amount it allocates? This could potentially win me big performance gains (which I could really need, as I need to run this code many times, for experiments).</p>\n"}, {"tags": ["list", "haskell", "monads", "monadfix"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1467540316, "post_id": 38168764, "comment_id": 63764822, "body": "&quot;<i><code>f</code> must not be strict in its argument</i>&quot; doesn&#39;t mean that if can&#39;t examine the argument lazily."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1467542333, "post_id": 38168764, "comment_id": 63765262, "body": "@Bergi Good point. Can you elaborate to an example?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 0, "last_activity_date": 1467547327, "last_edit_date": 1467547327, "creation_date": 1467545946, "answer_id": 38169563, "question_id": 38168764, "link": "https://stackoverflow.com/questions/38168764/monadfix-instance-for/38169563#38169563", "title": "MonadFix instance for []", "body": "<p>All the <code>fix</code> variants have a problem if you actually use them with a strict function, but that's <del>generally not an issue in the real use case</del><sup>&dagger;</sup>: <code>a</code> is basically always a function type, and any lambda is already in NF.</p>\n\n<p><del>So, as for a concrete use... well, here's at least <em>something that converges</em>:</del></p>\n\n<p><del><code>f :: (Int -&gt; Int) -&gt; [Int -&gt; Int]</code></del></p>\n\n<p><del><code>f f' = [\\x -&gt; if x&gt;0 then f' (x-1) * i else 1 | i&lt;-[0..]]</code></del></p>\n\n<p><del><code>f</code> basically generates a list of power functions.</p>\n\n<p><del><code>GHCi&gt; take 20 $ mfix f &lt;*&gt; [1,2]</code></del>\n<del><code>[0,0,1,1,2,4,3,9,4,16,5,25,6,36,7,49,8,64,9,81]</code></del></p>\n\n<p>What this is actually useful for I'm not sure, but it does have quite interesting behaviour.</del></p>\n\n<p>I've just noticed this is a bad example, as it's actually equivalent to a single <code>fix (f . head)</code>. Hm...</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>You seem to be quite right: it <em>is</em> an issue in the case of <code>a -&gt; [a]</code>, because there's no obvious way to make the list structure dependent on the argument without getting strict.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467574769, "post_id": 38170681, "comment_id": 63774527, "body": "So you&#39;re saying that examples like the one I first gave are <i>the only</i> uses of this <code>mfix</code> that don&#39;t diverge?"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1467554392, "creation_date": 1467554392, "answer_id": 38170681, "question_id": 38168764, "link": "https://stackoverflow.com/questions/38168764/monadfix-instance-for/38170681#38170681", "title": "MonadFix instance for []", "body": "<p>It's probably easiest to say it like this. The functions <code>f</code> for which <code>mfix f</code> is totally defined are those for which the spine of <code>f x</code> does not depend on <code>x</code>, so they can be written in the form</p>\n\n<pre><code>f x = [f1 x, ..., fn x]\n</code></pre>\n\n<p>for some <code>n</code> (possibly infinity) and some <code>f1</code>, ..., <code>fn</code>. Then</p>\n\n<pre><code>mfix f = [fix f1, ..., fix fn]\n</code></pre>\n\n<p>(of course for this to really be totally defined, each <code>fix fi</code> must also be defined).</p>\n\n<hr>\n\n<p><code>mfix</code> can be thought of as nondeterministically giving you the fixed point of a nondeterministic function. The rather heavy restriction is that the shape of the nondeterministic computation cannot depend in any way on the input. We seem to need some kind of restriction on the computation in order to get started, but you might hope to at least be able to kill off a branch of the computation conditionally (say if some intermediate calculation is negative). I've always thought that it should be possible to use <code>mfix</code> in this way by using a different nondeterminism monad whose choice operation is not associative, but never worked out the details.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 38170681, "answer_count": 2, "score": 6, "last_activity_date": 1467554392, "creation_date": 1467539727, "question_id": 38168764, "link": "https://stackoverflow.com/questions/38168764/monadfix-instance-for", "title": "MonadFix instance for []", "body": "<p>The instance is defined as</p>\n\n<pre><code>instance MonadFix [] where\n  mfix f = case fix (f . head) of\n             []    -&gt; []\n             (x:_) -&gt; x : mfix (tail . f)\n</code></pre>\n\n<p>But I'm failing to grasp the intuitive meaning behind it with respect to the <code>[]</code> monad seen as non-deterministic computations. In <code>mfix f</code> function <code>f</code> must not be strict in its argument, so it can't examine the argument. And according to the definition it also can't use the argument anywhere in its output, otherwise at some point it'll hit <code>fix (f . head)</code> and diverge. So is there any use (or good example) for <code>mfix</code> for lists, other than <code>mfix (const someList)</code>?</p>\n"}, {"tags": ["haskell", "raspberry-pi", "llvm", "raspbian"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1467586131, "post_id": 38167924, "comment_id": 63777258, "body": "I don&#39;t understand your PS. What version of ghc are you using?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1467610815, "post_id": 38167924, "comment_id": 63782149, "body": "GHC 7.10.3 It seems to behave weirdly with LLVM 3.5 and the Trac issue mentions some important patches that are available from LLV 3.5.2 onwards."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1467636002, "post_id": 38167924, "comment_id": 63795627, "body": "For GHC 7.10 you need LLVM 3.5.2 exactly, not a later major version. The LLVM assembly changes in a non-backwards compatible way with just about every major version of LLVM. You can use LLVM 3.7 with GHC 8."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1467641705, "post_id": 38167924, "comment_id": 63799190, "body": "In that case, do you know how to install LLVM 3.5.2 on R-Pi and make that the default?"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1467532983, "creation_date": 1467532983, "question_id": 38167924, "link": "https://stackoverflow.com/questions/38167924/how-to-make-llvm-3-7-default-on-raspberry-pi", "title": "How to make LLVM-3.7 default on Raspberry Pi?", "body": "<p>I'm on the default Raspbian OS and <code>sudo apt-get install llvm</code> seems to install <code>llvm-3.5</code> with a bunch of soft links (like <code>llvm-link</code> pointing to <code>llvm-link-3.5</code>) However, I'd like to install <code>llvm-3.7</code> and have it treated as the \"default\" LLVM by the system. I've tried fiddling around with <code>update-alternatives</code> but couldn't get it to work. Help will be appreciated.</p>\n\n<p>PS: I need 3.7 over 3.5 because of <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11190\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/11190</a></p>\n"}, {"tags": ["haskell", "containers", "naming-conventions"], "answers": [{"comments": [{"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1467530885, "post_id": 38167606, "comment_id": 63762703, "body": "I apologise for not making it clear. The library is NOT about specialized containers for standard types. It is for writing useful code in domain X, that in turn has datatypes T,U,V... specialized to domain X and useless in the context of the standard library."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1467530694, "last_edit_date": 1467530694, "creation_date": 1467530187, "answer_id": 38167606, "question_id": 38167365, "link": "https://stackoverflow.com/questions/38167365/haskell-multiple-monomorphic-containers-in-one-library/38167606#38167606", "title": "Haskell multiple monomorphic containers in one library", "body": "<p>I'd recommend you use a module for each monomorphic specialization.\nConsider modules names <code>Data.Set.Specialized.Int</code>, <code>Data.Set.Specialized.Char</code> etc.\nReuse, as much as possible, the same names used in <code>Data.Set</code>, without any suffix.\nMake your modules be used with <code>import qualified</code>, as <code>Data.Set</code>.</p>\n\n<p>Advantages:</p>\n\n<ul>\n<li>users are already familiar with the names</li>\n<li><p>if one wants to change their <code>Data.Set</code> code to the specialized variant, this be dome simply by changing the types, from e.g.</p>\n\n<pre><code>import qualified Data.Set as S\nfoo :: S.Set Int -&gt; String\n</code></pre>\n\n<p>to</p>\n\n<pre><code>import qualified Data.Set.Specialized.Int as SI\nfoo :: SI.Set -&gt; String\n</code></pre>\n\n<p>without touching the code.</p></li>\n</ul>\n\n<p>A typeclass is also a possibility, but one needs to be careful to choose the common operations among all variants. Also, if I understand correctly, you still want to allow some sets to have special operations which are not available for other sets. These much be outside the hypothetical type class, of course.</p>\n\n<p>For question 2: if the wrapping is a <code>newtype</code> around <code>Data.Set</code>, you should consider <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow\">safe coercions</a>.</p>\n\n<pre><code>module Data.Set.Specialized.Int where\n\nimport qualified Data.Set as S\nimport Data.Coerce\n\nnewtype Set = Set { unSet :: S.Set Int }\n\nunion :: Set -&gt; Set -&gt; Set\nunion = coerce S.union\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1467530694, "creation_date": 1467527642, "last_edit_date": 1467528254, "question_id": 38167365, "link": "https://stackoverflow.com/questions/38167365/haskell-multiple-monomorphic-containers-in-one-library", "title": "Haskell multiple monomorphic containers in one library", "body": "<p>I have a library project, with quite few specialized monomorphic containers (mostly sets and also some map-like). They all share the basic Set functioanality (empty, singleton, insert, union etc), but also have additional value-specific functions. Some of them are just wrappers around Data.Set, but others need more efficient implementations (like finite bitset). I have 2 questions:</p>\n\n<ol>\n<li><p>What are the pros and cons of suffixing every such function (emptyT, singletonU)? Would it make a good general practice to suffix all monomorphic container functions to easier differentiate between them, and the polymorphic ones?</p></li>\n<li><p>Here is some sample code. </p>\n\n<pre><code>import qualified Data.Set as S\n\ndata T = ...\n\nnewtype TSet = TSet { unpack :: S.Set T }\n\nemptyT = TSet S.empty\n\nsingletonT = TSet . S.singleton\n</code></pre></li>\n</ol>\n\n<p>Is this the right way to wrap around polymorphic containers? Is there any more clever way to \"inherit\" functionality? I thought about creating a custom Set typeclass, but after reading some posts here I see it would only overcomplicate things..</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467527077, "post_id": 38167078, "comment_id": 63762038, "body": "you can add a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Debug-Trace.html#v:trace\" rel=\"nofollow noreferrer\">trace</a> to <code>length</code> (<code>length = trace &quot;building...&quot; $ V.fromList ...</code>) and see for yourself"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467532582, "post_id": 38167078, "comment_id": 63763043, "body": "@Carsten Alternatively you could pass the <code>-ddump-simpl</code> option and look at the Core generated by the compiler, and check there."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467532853, "post_id": 38167078, "comment_id": 63763104, "body": "@Bakuriu that&#39;s probably the <i>better</i> option yes - but then you have to understand the core ;)"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467729234, "post_id": 38167078, "comment_id": 63836299, "body": "@Carsten Thanks. That&#39;s what I needed. If you can post as answer I&#39;ll accept."}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1467541128, "post_id": 38168624, "comment_id": 63764990, "body": "I believe he means &quot;memoised in regards to the <code>lc</code> function&quot;"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1467693467, "post_id": 38168624, "comment_id": 63815518, "body": "@Bergi Yes I did. Thanks for clarifying for me. I&#39;m going to take this answer as meaning that the lc function would be memorized."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 1, "last_activity_date": 1467538540, "creation_date": 1467538540, "answer_id": 38168624, "question_id": 38167078, "link": "https://stackoverflow.com/questions/38167078/does-this-haskell-function-memoize/38168624#38168624", "title": "Does this Haskell function memoize?", "body": "<p>In this case <code>lengths</code> clearly cannot be memoized, because it depends on the outer function's argument, which is why it is regenerated each time you call that function.</p>\n\n<p>It could have been memoized if there was no such dependency. To check whether that happened you could use one of the methods suggested in the comments. To ensure that the memoization did happen, you could have used the standard approach of extracting the desired piece to the top level with the <code>NOINLINE</code> pragma. E.g.,</p>\n\n<pre><code>{-# NOINLINE lengths #-}\nlengths :: Vector Int\nlengths =\n  error \"define me\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1467732401, "creation_date": 1467732401, "answer_id": 38207262, "question_id": 38167078, "link": "https://stackoverflow.com/questions/38167078/does-this-haskell-function-memoize/38207262#38207262", "title": "Does this Haskell function memoize?", "body": "<p>if you add a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Debug-Trace.html#v:trace\" rel=\"nofollow\"><code>trace</code></a> to your <code>lengths</code> like this:</p>\n\n<pre><code>lengths = trace \"building list...\" $ V.fromList ...\n</code></pre>\n\n<p>you will see the output every time the <code>lengths</code> value is calculated</p>\n\n<p>As it is it should only be evaluated/build once per <code>lc = lcgen s</code></p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "accepted_answer_id": 38207262, "answer_count": 2, "score": 2, "last_activity_date": 1467732401, "creation_date": 1467524482, "last_edit_date": 1467524648, "question_id": 38167078, "link": "https://stackoverflow.com/questions/38167078/does-this-haskell-function-memoize", "title": "Does this Haskell function memoize?", "body": "<p>I'd like to pre-calculate some values that are then used when I need to do further lookups. I came up with the following:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as V\n\nlcgen s =\n  lc\n  where\n    lc 0 b  = lengths V.! b\n    lc a b  = lengths V.! b - lengths V.! (a - 1) - 1\n    lengths = V.fromList $ scanl1 ((+) . (1 +)) $ map length $ words s\n</code></pre>\n\n<p>The function essentially returns the number of characters used in-between two words. I use it as follows:</p>\n\n<pre><code>let lc = lcgen \"some sentence with a lot of words\"\nlc 0 0 -- == 4\nlc 0 1 -- == 13\n</code></pre>\n\n<p>In this implementation, would the <code>lengths</code> vector be memoized? Furthermore, how can I know and/or confirm this?</p>\n"}, {"tags": ["haskell", "concurrency", "locking", "output"], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 2, "last_activity_date": 1467506801, "creation_date": 1467506801, "answer_id": 38165748, "question_id": 38165566, "link": "https://stackoverflow.com/questions/38165566/behaviour-of-withmvar-and-bracket-different/38165748#38165748", "title": "Behaviour of withMVar and bracket_ different", "body": "<p>You have the order wrong; You are acquiring the lock and <em>immediately</em> releasing it; whereas <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception-Base.html#v:bracket\" rel=\"nofollow\">the signature says</a>:</p>\n\n<pre><code>bracket_ \n    :: IO a  -- computation to run first (\"acquire resource\")\n    -&gt; IO b  -- computation to run last (\"release resource\")\n    -&gt; IO c  -- computation to run in-between\n    -&gt; IO c  -- returns the value from the in-between computation\n</code></pre>\n\n<p>so it should be:</p>\n\n<pre><code>bracket_ (takeMVar lock) (putMVar lock ()) $ print x\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 38165748, "answer_count": 1, "score": 2, "last_activity_date": 1467506801, "creation_date": 1467504556, "question_id": 38165566, "link": "https://stackoverflow.com/questions/38165566/behaviour-of-withmvar-and-bracket-different", "title": "Behaviour of withMVar and bracket_ different", "body": "<p>This ensures mutual exclusion of actions:</p>\n\n<pre><code>do\n  lock &lt;- newMVar ()\n  let atomicPrint = withMVar lock . const . print\n  mapM_ (forkIO . atomicPrint) [['1'..'8'],['a'..'h']]\n</code></pre>\n\n<p>This doesn't:</p>\n\n<pre><code>do\n  lock &lt;- newMVar ()\n  let atomicPrint x = bracket_ (takeMVar lock) (print x) (putMVar lock ())\n  mapM_ (forkIO . atomicPrint) [['1'..'8'],['a'..'h']]\n</code></pre>\n\n<p>Can you explain why? By the definitions of withMVar and bracket_ on Hackage and equational reasoning I came to the conclusion that the two pieces of code should do the same. But running in GHCi proves me wrong.</p>\n"}, {"tags": ["windows", "haskell", "cmd"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467504340, "post_id": 38165432, "comment_id": 63758853, "body": "This seems to be mainly a question about Windows and its... well, if you want to call that a terminal... ...anyway, it would be a good idea to add what particular version and so on."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1467509805, "last_edit_date": 1495542776, "creation_date": 1467509805, "answer_id": 38165975, "question_id": 38165432, "link": "https://stackoverflow.com/questions/38165432/keeping-console-window-open-after-error-in-haskell-executable/38165975#38165975", "title": "Keeping console window open after error in haskell executable", "body": "<p>If you are asking how to keep the console window opened when invoked from a short cut, try invoking the program with <code>cmd.exe /k ...</code></p>\n\n<p>See, for instance: <a href=\"https://stackoverflow.com/a/1864120/866915\">How do you keep the console from closing after the program is done in C?</a></p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1467509805, "creation_date": 1467503128, "last_edit_date": 1467504139, "question_id": 38165432, "link": "https://stackoverflow.com/questions/38165432/keeping-console-window-open-after-error-in-haskell-executable", "title": "Keeping console window open after error in haskell executable", "body": "<p>How do stop the console window from closing after there has been a error when running a .exe? </p>\n\n<p>I am keeping the window open with <code>_ &lt;- getLine</code> but this of course only works if the program runs up to that point.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "edited": false, "score": 3, "creation_date": 1467506922, "post_id": 38164997, "comment_id": 63759246, "body": "In case you&#39;re not aware of it, there&#39;s a handy site called <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> where you can type in the type-signature of the function you&#39;d like to see and it will give you suggestions of functions with matching/similar signatures. Sadly, <code>[Either l r] -&gt; Either l [r]</code> doesn&#39;t seem to be yielding any results :("}], "answers": [{"comments": [{"owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "edited": false, "score": 0, "creation_date": 1467500146, "post_id": 38165029, "comment_id": 63758136, "body": "Thanks, that works!  I&#39;m just a beginner so I&#39;m not sure whether to accept this answer or the one that recommends <code>sequenceA</code> from Data.Traversable.  What are the advantages of <code>sequence</code>?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "edited": false, "score": 4, "creation_date": 1467500618, "post_id": 38165029, "comment_id": 63758212, "body": "@DavidGrayson <i>default</i> implementation is the same; <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Traversable.html#Traversable\" rel=\"nofollow noreferrer\">see <code>sequence = sequenceA</code> in source code</a>. You would use <code>sequenceA</code> if you have an applicative which is not a monad."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "edited": false, "score": 1, "creation_date": 1467565526, "post_id": 38165029, "comment_id": 63771786, "body": "@David Grayson they do the same thing; they are different functions for historical reasons <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal#Redundant_functions\" rel=\"nofollow noreferrer\">wiki.haskell.org/&hellip;</a>"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 21, "last_activity_date": 1467499367, "last_edit_date": 1467499367, "creation_date": 1467499040, "answer_id": 38165029, "question_id": 38164997, "link": "https://stackoverflow.com/questions/38164997/convert-list-of-eithers-to-an-either-with-a-list-in-it/38165029#38165029", "title": "Convert list of Eithers to an Either with a list in it", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:sequence\"><code>sequence</code></a> from <code>Control.Monad</code>:</p>\n\n<pre><code>sequence :: (Traversable t, Monad m) =&gt; t (m a) -&gt; m (t a)\n</code></pre>\n\n<p>as in:</p>\n\n<pre><code>\\&gt; import Control.Monad (sequence)\n\n\\&gt; sequence [Right 1, Right 2, Right 3]\nRight [1,2,3]\n\n\\&gt; sequence [Right 1, Left \"division by zero\", Right 3]\nLeft \"division by zero\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "edited": false, "score": 0, "creation_date": 1467500119, "post_id": 38165047, "comment_id": 63758131, "body": "Thanks, that works!  I&#39;m just a beginner so I&#39;m not sure whether to accept this answer or the one that recommends <code>sequence</code> from Control.Monad.  What are the advantages of <code>sequenceA</code>?"}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "reply_to_user": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "edited": false, "score": 4, "creation_date": 1467501338, "post_id": 38165047, "comment_id": 63758343, "body": "<code>sequence</code> and <code>sequenceA</code> are the same for <code>Either</code>. The reason why they both exist is historical: before the Functor-Applicative-Monad Proposal <code>Applicative</code> was not a superclass of <code>Monad</code> and many functionalities were implemented twice like <code>traverse</code> and <code>mapM</code>."}], "tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": false, "score": 9, "last_activity_date": 1467499278, "creation_date": 1467499278, "answer_id": 38165047, "question_id": 38164997, "link": "https://stackoverflow.com/questions/38164997/convert-list-of-eithers-to-an-either-with-a-list-in-it/38165047#38165047", "title": "Convert list of Eithers to an Either with a list in it", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:sequenceA\">sequenceA</a> of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html\">Data.Traversable</a></p>\n"}], "owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2039, "favorite_count": 1, "accepted_answer_id": 38165029, "answer_count": 2, "score": 7, "last_activity_date": 1467845088, "creation_date": 1467498775, "last_edit_date": 1467845088, "question_id": 38164997, "link": "https://stackoverflow.com/questions/38164997/convert-list-of-eithers-to-an-either-with-a-list-in-it", "title": "Convert list of Eithers to an Either with a list in it", "body": "<p>I am a beginner in Haskell and I am working on some Haskell code that uses <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Either.html\" rel=\"nofollow\">Either</a> for error handling.  The left element of the Either represents an error, while the right element represents a successful result.  The code often uses the Applicative instance of Either, which seems to be designed for this use case.</p>\n\n<p>Given an object of type <code>[Either e r]</code>, what is the most elegant way to turn it into an object of type <code>Either e [r]</code>?  The point of this is that we might have an array of return values from some functions we called, and if any of those return values is an error, we want to get that error and throw away everything else.  If multiple elements of the array have an error, I would prefer to get the left-most error if possible.</p>\n\n<p>I was able to solve this problem myself in the code below by writing two functions, one of which is recursive, but is there a better way?</p>\n\n<pre><code>type Error = [Char]\n\nmyFunc :: [Either Error a] -&gt; Either Error [a]\nmyFunc = myFunc2 []\n\nmyFunc2 :: [a] -&gt; [Either Error a] -&gt; Either Error [a]\nmyFunc2 r ((Left error):rest) = Left error\nmyFunc2 r ((Right item):rest) = myFunc2 (r ++ [item]) rest\nmyFunc2 r [] = Right r\n\nmain :: IO()\nmain = do\n  -- This prints: Right [1, 2, 3]\n  putStrLn (show (myFunc [Right 1, Right 2, Right 3]))\n\n  -- This prints: Left \"division by zero\"\n  putStrLn (show (myFunc [Right 1, Left \"division by zero\", Right 3]))\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1467498377, "post_id": 38164769, "comment_id": 63757816, "body": "Have you tried <code>project:m1</code> or <code>project:exe:m1</code>?"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1467499167, "post_id": 38164769, "comment_id": 63757955, "body": "@epsilonhalbe Yes. All variations of the target end up building all executables. I wonder if its a bug. The version of Stack I&#39;m using is Version 1.1.0 x86_64 hpack-0.13.0."}], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 1692268, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/54836036152193dbb1f54c65ad7d1623?s=128&d=identicon&r=PG", "display_name": "Shou", "link": "https://stackoverflow.com/users/1692268/shou"}, "edited": false, "score": 0, "creation_date": 1534852938, "post_id": 38179241, "comment_id": 90845979, "body": "This seems to be possible again now, per the issue as of August 25th 2017."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 4, "last_activity_date": 1467617963, "creation_date": 1467617963, "answer_id": 38179241, "question_id": 38164769, "link": "https://stackoverflow.com/questions/38164769/how-to-make-stack-only-build-one-executable-stack-build-exe1-doesnt-work/38179241#38179241", "title": "How to make Stack only build one executable? stack build :exe1 doesn&#39;t work?", "body": "<p>It's not possible at the moment. See <a href=\"https://github.com/commercialhaskell/stack/issues/1406\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/1406</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 1, "accepted_answer_id": 38179241, "answer_count": 1, "score": 6, "last_activity_date": 1467617963, "creation_date": 1467496237, "last_edit_date": 1495542796, "question_id": 38164769, "link": "https://stackoverflow.com/questions/38164769/how-to-make-stack-only-build-one-executable-stack-build-exe1-doesnt-work", "title": "How to make Stack only build one executable? stack build :exe1 doesn&#39;t work?", "body": "<p>I have multiple executables in one of my Stack projects:</p>\n\n<pre><code>executable m1\n  hs-source-dirs:      src\n  main-is:             Main1.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n\nexecutable m2\n  hs-source-dirs:      src\n  main-is:             Main2.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n</code></pre>\n\n<p>I would like to build only one of them at a time. From the <a href=\"http://docs.haskellstack.org/en/stable/build_command/\" rel=\"nofollow noreferrer\">documentation</a> and this <a href=\"https://stackoverflow.com/questions/36137310/haskell-stack-build-specific-executable\">other question</a>, it would seem that the following command should work:</p>\n\n<pre><code>stack build :m2\n</code></pre>\n\n<p><em>but</em> what actually happens is that both executables, m1 and m2, are always built regardless of whether I include the package name, the package type, etc. </p>\n\n<p>What could be causing this?</p>\n"}, {"tags": ["haskell", "haste"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467468817, "post_id": 38161006, "comment_id": 63750310, "body": "The error message suggests you have the text <code>return (1 0 :: Integer)</code> somewhere in your program. Are you sure the code fragment you posted is where the error is coming from?"}, {"owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467469667, "post_id": 38161006, "comment_id": 63750571, "body": "The error message was wrong. I updated it."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1467469963, "creation_date": 1467469963, "answer_id": 38161250, "question_id": 38161006, "link": "https://stackoverflow.com/questions/38161006/working-with-local-storage-in-haste/38161250#38161250", "title": "Working with local storage in Haste", "body": "<p>Even though you are not using <code>mr</code> you need to specify what type it is.</p>\n\n<p>One way to specify the type of <code>mr</code> is to add a <code>let _ = mr :: ...</code> statement:</p>\n\n<pre><code>loadFromStorage = do\n    mr &lt;- getItem \"budget\"\n    let _ = mr :: MyType\n    case mr of\n        Left _ -&gt; return (0 :: Integer)\n        Right _ -&gt; return (1 :: Integer)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "is_accepted": false, "score": 0, "last_activity_date": 1467471429, "creation_date": 1467471429, "answer_id": 38161432, "question_id": 38161006, "link": "https://stackoverflow.com/questions/38161006/working-with-local-storage-in-haste/38161432#38161432", "title": "Working with local storage in Haste", "body": "<p>That works for me now:</p>\n\n<pre><code>toStorage :: Int -&gt; IO ()\ntoStorage n = do\n    setItem \"page\" n\n    return ()\n\nfromStorage :: IO Int\nfromStorage = do\n                 value &lt;- getItem \"page\"\n                 either (\\_ -&gt; return 0)\n                        (\\n -&gt; return n)\n                        value\n</code></pre>\n"}], "owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1467487984, "creation_date": 1467468197, "last_edit_date": 1467487984, "question_id": 38161006, "link": "https://stackoverflow.com/questions/38161006/working-with-local-storage-in-haste", "title": "Working with local storage in Haste", "body": "<p>I would like to read and write an integer from and to local storage. </p>\n\n<p>My code looks like this (just trying to make this compile so far):</p>\n\n<pre><code>loadFromStorage = do\n    mr &lt;- getItem \"budget\"\n    case mr of\n        Left _ -&gt; return (0 :: Integer)\n        Right _ -&gt; return (1 :: Integer)\n</code></pre>\n\n<p>But I get:</p>\n\n<pre><code>No instance for (Serialize a0) arising from a use of \u2018getItem\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Serialize JSON -- Defined in \u2018Haste.Serialize\u2019\n      instance Serialize JSString -- Defined in \u2018Haste.Serialize\u2019\n      instance (Serialize a, Serialize b) =&gt; Serialize (Either a b)\n        -- Defined in \u2018Haste.Serialize\u2019\n      ...plus 13 others\n    In a stmt of a 'do' block: mr &lt;- getItem \"budget\"\n    In the expression:\n      do { mr &lt;- getItem \"budget\";\n           case mr of {\n             Left _ -&gt; return (0 :: Integer)\n             Right _ -&gt; return (1 :: Integer) } }\n    In an equation for \u2018loadFromStorage\u2019:\n        loadFromStorage\n          = do { mr &lt;- getItem \"budget\";\n                 case mr of {\n                   Left _ -&gt; return (0 :: Integer)\n                   Right _ -&gt; return (1 :: Integer) } }\n</code></pre>\n\n<p>The questions\nare:</p>\n\n<p>What must I do to make this code compile ?</p>\n\n<p>What must I do to read and write an integer ?</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1467462372, "post_id": 38160099, "comment_id": 63748507, "body": "<code>sortPosTrans</code> can be simplified to <code>sortPosTrans (_,b1) (_,b2) = compare b2 b1</code>, which should be the same as <code>flip (comparing snd)</code>."}, {"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1467462661, "post_id": 38160099, "comment_id": 63748579, "body": "@melpomene: Thats correct, thanks for this advice, I will update the question, but doesn&#39;t solve the problem :/"}], "answers": [{"comments": [{"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1467462859, "post_id": 38160173, "comment_id": 63748634, "body": "Does it also mean, if I want to &#39;sort&#39; a map, I need to sort the key (or in my case change the key) to get the expected sorting?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1467463067, "post_id": 38160173, "comment_id": 63748685, "body": "@sandkasten Yeah, you can either change your keys so that the default <code>compare</code> order matches what you want, or you can keep a secondary list of keys in the order you want, then use that list to access the values."}, {"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1467463215, "post_id": 38160173, "comment_id": 63748727, "body": "Thanks for your help and quick response."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1467462669, "creation_date": 1467462669, "answer_id": 38160173, "question_id": 38160099, "link": "https://stackoverflow.com/questions/38160099/haskell-sorting-map-via-list-wont-work/38160173#38160173", "title": "Haskell sorting Map (via List) won&#39;t work", "body": "<p>Indeed, you can't sort a <code>Map</code>. That's why <code>sortBy</code> takes and returns a list. A <code>Map</code> is always internally sorted by keys, which is what allows efficient lookup and insertion:</p>\n\n<pre><code>*&gt; Map.fromList [(\"3\",25),(\"1\",5),(\"4\",1)]\nfromList [(\"1\",5),(\"3\",25),(\"4\",1)]\n</code></pre>\n\n<p>If you want your results to be sorted according to a custom criterion, return a list instead.</p>\n"}], "owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "accepted_answer_id": 38160173, "answer_count": 1, "score": 0, "last_activity_date": 1467463274, "creation_date": 1467462109, "last_edit_date": 1467463274, "question_id": 38160099, "link": "https://stackoverflow.com/questions/38160099/haskell-sorting-map-via-list-wont-work", "title": "Haskell sorting Map (via List) won&#39;t work", "body": "<p>I already read a lot of question and answers to the topic, but I can't find my mistake. Hope someone of you can help me out.</p>\n\n<p>My scenario: Get a list of people and amounts, sort out negative amounts and sort the rest from the highest amount to the smallest. My solution so far</p>\n\n<pre><code>getPayers :: Map String Integer -&gt; Map String Integer\ngetPayers m = getPayersInternal Map.empty (Map.toList m)\n  where getPayersInternal :: Map String Integer -&gt; [(String, Integer)] -&gt; Map String Integer\n    getPayersInternal result [] = Map.fromList(Data.List.sortBy sortPosTrans (Map.toList result))\n    getPayersInternal result ((s,i):xs) = \n      if i &gt; 0\n      then getPayersInternal (Map.insert s i result) xs\n      else getPayersInternal result xs\n\nsortPosTrans :: (Ord a, Ord b) =&gt; (a,b) -&gt; (a,b) -&gt; Ordering          \nsortPosTrans (_,b1) (_,b2) = compare b2 b1\n</code></pre>\n\n<p>If I use <code>sortPosTrans</code> alone, it works as expected:</p>\n\n<pre><code>Data.List.sortBy sortPosTrans [(\"1\", 5),(\"3\",25),(\"4\",1)]\n[(\"3\",25),(\"1\",5),(\"4\",1)]\n</code></pre>\n\n<p>But if I use the function inside <code>getPayers</code>, it doesn't work, resulting in:</p>\n\n<pre><code>getPayers (Map.fromList [(\"1\", 5),(\"2\",-12),(\"3\",25),(\"4\",10)])\nfromList [(\"1\",5),(\"3\",25),(\"4\",10)]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1467447287, "post_id": 38157966, "comment_id": 63744609, "body": "What exactly is your question?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6483251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdd3365af01b0688b2f15c80923c0abc?s=128&d=identicon&r=PG&f=1", "display_name": "Marco ", "link": "https://stackoverflow.com/users/6483251/marco"}, "edited": false, "score": 0, "creation_date": 1467468548, "post_id": 38158512, "comment_id": 63750243, "body": "Thanks, I like this solution"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1467451062, "creation_date": 1467451062, "answer_id": 38158512, "question_id": 38157966, "link": "https://stackoverflow.com/questions/38157966/exception-prelude-read-no-parse/38158512#38158512", "title": "*** Exception: Prelude.read: no parse", "body": "<p>Using <code>read</code> is horrible for that task, simply use the constructor <code>Contact</code>.</p>\n\n<pre><code>fromDt :: [String] -&gt; ContactInfo\nfromDt [n,s,m] = Contact n s m\n</code></pre>\n\n<p>Note that you will still get an error if the list you pass to <code>fromDt</code> is not 3 cells long. I would simply avoid defining this fragile function and use the constructor <code>Contact</code> directly wherever you would call <code>fromDt</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1467451490, "creation_date": 1467451490, "answer_id": 38158568, "question_id": 38157966, "link": "https://stackoverflow.com/questions/38157966/exception-prelude-read-no-parse/38158568#38158568", "title": "*** Exception: Prelude.read: no parse", "body": "<p>When you define a data type using record syntax, the derived read instance requires the full record syntax - i.e. you must pass a string like</p>\n\n<pre><code>ContactInfo { name = \"...\", surname = \"...\", mobile = \"...\" }\n</code></pre>\n\n<p>to <code>read</code> to obtain a <code>ContactInfo</code> value. A string like:</p>\n\n<pre><code>ContactInfo \"...\" \"...\" \"...\"\n</code></pre>\n\n<p>will result in a no parse exception. Here is a quick demo:</p>\n\n<pre><code>data ABC = ABC { a :: Int, b :: Int, c :: Int }\n  deriving (Show, Read)\n\ntest1 :: ABC                  -- throws no parse exception\ntest1 = read \"ABC 1 2 3\"\n\ntest2 :: ABC                  -- works\ntest2 = read \"ABC { a = 1, b = 2, c = 3 }\"\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6483251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdd3365af01b0688b2f15c80923c0abc?s=128&d=identicon&r=PG&f=1", "display_name": "Marco ", "link": "https://stackoverflow.com/users/6483251/marco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1467451490, "creation_date": 1467446809, "question_id": 38157966, "link": "https://stackoverflow.com/questions/38157966/exception-prelude-read-no-parse", "title": "*** Exception: Prelude.read: no parse", "body": "<p>I am new to Haskell, I wrote this small script but I am having this read: no parse Exception, anyone could help me?\nthanks</p>\n\n<pre><code>import System.Environment\nimport Data.List\n\ndata ContactInfo = Contact { name :: String\n                        , surname :: String\n                        , mobile :: String\n                        } deriving (Read, Show)\n\nfromDt :: [String] -&gt; ContactInfo\nfromDt ds = read $ \"Contact \" ++ (Data.List.concat $ Data.List.intersperse \" \" $ Data.List.map show ds)\n\nmain = do\n  let val =  fromDt [\"John\",\"Smith\",\"223 455 2703\"]\n  putStrLn (\"Name: \" ++ name val ++ \", \" ++ surname val)\n</code></pre>\n"}, {"tags": ["haskell", "types", "comparison"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467474413, "post_id": 38157429, "comment_id": 63751914, "body": "Ask yourself: which type would <code>check</code> have? The first argument is either a value of type <code>D</code>, or a function <code>Int -&gt; D</code> or a function <code>String -&gt; D</code>. Unify those three and... you cannot unify them. So you can&#39;t.  However you could do something like <code>check &quot;A&quot; A = True</code> pattern matching over the names of the constructors..."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1467531818, "post_id": 38157631, "comment_id": 63762878, "body": "This is especially nice with record syntax: <code>check A = True; Check B{} = True; ...</code>. You don&#39;t need to fill in all the blanks for the fields."}], "tags": [], "owner": {"reputation": 83, "user_id": 1117548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10eef87e64a4b00ba73ed74997c459b6?s=128&d=identicon&r=PG", "display_name": "Jussi Raunio", "link": "https://stackoverflow.com/users/1117548/jussi-raunio"}, "is_accepted": false, "score": 4, "last_activity_date": 1467444187, "creation_date": 1467444187, "answer_id": 38157631, "question_id": 38157429, "link": "https://stackoverflow.com/questions/38157429/compare-data-type-values-on-choice-of-constructor-only/38157631#38157631", "title": "Compare data type values on choice of constructor only", "body": "<p>You probably want to pattern match a constructor with a wildcard. Like so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>check :: D -&gt; D -&gt; Bool\ncheck A A = True\ncheck (B _) (B _) = True\ncheck (C _) (C _) = True\ncheck _ _ = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 2, "last_activity_date": 1467496817, "last_edit_date": 1467496817, "creation_date": 1467492512, "answer_id": 38164356, "question_id": 38157429, "link": "https://stackoverflow.com/questions/38157429/compare-data-type-values-on-choice-of-constructor-only/38164356#38164356", "title": "Compare data type values on choice of constructor only", "body": "<p>There's a few ways to do this, none are perfect. </p>\n\n<p>You can do something similar by comparing the data kind type reps:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeApplications #-}\nimport Data.Typeable\n\ndata D = A | B Int | C Char\n\nkCheck :: Typeable a =&gt; Proxy (a::k) -&gt; D -&gt; Bool\nkCheck p d = typeRep p == kTypeRep where\n  kTypeRep = case d of\n    A    -&gt; typeRep (Proxy @ 'A)\n    B {} -&gt; typeRep (Proxy @ 'B)\n    C {} -&gt; typeRep (Proxy @ 'C)\n</code></pre>\n\n<p>(if you don't have ghc 8.0.1 remove <code>TypeApplications</code> and replace <code>@ 'A</code> with <code>:: Proxy 'A</code>) I think this needs ghc 7.10 (or maybe 7.8 with <code>AutoDeriveTypeable</code>).</p>\n\n<pre><code>kCheck (Proxy @ 'B) (B 3)\nTrue\nkCheck (Proxy @ 'C) A\nFalse\n</code></pre>\n\n<hr>\n\n<p>Or you can use <code>TemplateHaskell</code> and compare the <code>Name</code>s:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Language.Haskell.TH\n\ndata D = A | B Int | C Char\n\nthCheck :: Name -&gt; D -&gt; Bool\nthCheck n d = n == conName\n  where\n    conName = case d of\n      A    -&gt; 'A\n      B {} -&gt; 'B\n      C {} -&gt; 'C\n\n&gt; thCheck 'B (B 3)\nTrue\n&gt; thCheck 'A (C 'a')\nFalse\n</code></pre>\n\n<hr>\n\n<p>If you're happy comparing strings you can automatically derive them using <code>toConstr</code> from <code>Data</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Data.Data\n\ndata D = A | B Int | C Int\n  deriving Data\n\ndCheck :: String -&gt; D -&gt; Bool\ndCheck s d = s == show (toConstr d)\n</code></pre>\n\n<hr>\n\n<p>There is a way closest to what you want but this will only work if each type constructor has a distinct type. <strong>So this wouldn't work with with <code>data D = A Int | B Int</code> because the type reps of <code>A</code> and <code>B</code> would both be <code>Int -&gt; D</code></strong>.</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Data.Typeable\n\ndata D = A | B Int | C String\n  deriving Typeable\n\ncheck :: Typeable a =&gt; a -&gt; D -&gt; Bool\ncheck p d = typeOf p == conTypeRep\n  where\n    conTypeRep = case d of\n      A    -&gt; typeOf A\n      B {} -&gt; typeOf B\n      C {} -&gt; typeOf C\n</code></pre>\n\n<p>Which works as expected:</p>\n\n<pre><code>&gt; check B (B 3)\nTrue\n&gt; check C A\nFalse\n</code></pre>\n"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1467523107, "creation_date": 1467442680, "last_edit_date": 1467523107, "question_id": 38157429, "link": "https://stackoverflow.com/questions/38157429/compare-data-type-values-on-choice-of-constructor-only", "title": "Compare data type values on choice of constructor only", "body": "<p>I want to compare just the constructor \"tag\" of a data type.</p>\n\n<p>Is there an easy way to do this?</p>\n\n<pre><code>data D = A | B Int | C String\ncheck k d = ?\n\ncheck A (A) -- True\ncheck B (B 55) -- True\ncheck C (C \"xxx\") -- True\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1467446531, "post_id": 38157284, "comment_id": 63744399, "body": "either move it into different modules or rename them (<code>dm_text</code>, ...) - if you are on GHC 8 you can have a look at <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/DuplicateRecordFields\" rel=\"nofollow noreferrer\">DuplicateRecordFields</a> but personally I don&#39;t like this too much"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6540722"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467446781, "post_id": 38157284, "comment_id": 63744450, "body": "The problem is that it has to match the api name , so it returns the information that i need , so dm_text is not gonna work . Im going to look at creating a module"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467450103, "post_id": 38157284, "comment_id": 63745284, "body": "well yes - but you always have the option to implement the JSON instances yourself - so the names won&#39;t matter (but modules are probably easier ;))"}], "answers": [{"tags": [], "owner": {"reputation": 3032, "user_id": 2178852, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yshPF.jpg?s=128&g=1", "display_name": "Chetan Bhasin", "link": "https://stackoverflow.com/users/2178852/chetan-bhasin"}, "is_accepted": false, "score": 0, "last_activity_date": 1506949443, "creation_date": 1506949443, "answer_id": 46526052, "question_id": 38157284, "link": "https://stackoverflow.com/questions/38157284/multiple-declaration-error-in-data-type-declaration/46526052#46526052", "title": "Multiple declaration error in data type declaration", "body": "<p>As defined <a href=\"https://wiki.haskell.org/Name_clashes_in_record_fields\" rel=\"nofollow noreferrer\">here</a>, the named members are just functions that are used to call the values in your data structure.</p>\n\n<p>So, if you really want to use them, you can do so by using the language extension. You can do that by declaring this in your file:</p>\n\n<p><code>{-# LANGUAGE DuplicateRecordFields #-}</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6540722"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506949443, "creation_date": 1467441548, "last_edit_date": 1467441705, "question_id": 38157284, "link": "https://stackoverflow.com/questions/38157284/multiple-declaration-error-in-data-type-declaration", "title": "Multiple declaration error in data type declaration", "body": "<p>I'm currently building a a Twitter CLI client in Haskell, and I have a data type that represents a DM and one that represents a tweet. However, I get a multiple declaration error because I have to use the same name for both:</p>\n\n<pre><code>data Users =  Users { screen_name :: String } deriving(Show, Generic)\n\n\ndata Tweet = Tweet { text :: !Text,\n                     retweeted :: Bool,\n                     user :: Users\n                   } deriving (Show, Generic)\n\ndata DM = DM { text :: !Text,\n               sender_screen_name :: String\n             } deriving (Show, Generic)\n</code></pre>\n\n<p>Does someone know a solution for this particular problem?</p>\n"}, {"tags": ["haskell", "pointfree"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1467435171, "creation_date": 1467435171, "answer_id": 38156611, "question_id": 38156557, "link": "https://stackoverflow.com/questions/38156557/pointfree-case-of/38156611#38156611", "title": "Pointfree case of", "body": "<p>There are several ways. In this particular case:</p>\n\n<pre><code>putStrLn . fromMaybe \"Error\"\n</code></pre>\n\n<p>But this is a pretty special case. Slightly less special would be to use the <code>Maybe</code> catamorphism:</p>\n\n<pre><code>maybe (putStrLn \"Error\") putStrLn\n</code></pre>\n\n<p>Many types in Haskell come with a similar catamorphism that can be used to avoid <code>case</code>. But the most general case is to use the special language extension known as <code>LambdaCase</code>, which lets you write</p>\n\n<pre><code>\\case\n    Just x  -&gt; putStrLn x\n    Nothing -&gt; putStrLn \"Error\"\n</code></pre>\n\n<p>Unlike <code>fromMaybe</code> (which is special to <code>Maybe</code> and the regularity of the cases used here) or the catamorphism (which is special to types that provide one), this can be used to anonymize any pattern-matching lambda.</p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "accepted_answer_id": 38156611, "answer_count": 1, "score": 4, "last_activity_date": 1467435171, "creation_date": 1467434627, "question_id": 38156557, "link": "https://stackoverflow.com/questions/38156557/pointfree-case-of", "title": "Pointfree case of", "body": "<p>I have this code:</p>\n\n<pre><code>import Control.Lens\nimport Control.Monad\nimport Control.Arrow\nimport Text.Read\n\n... IO (Maybe String) ...\n    &gt;&gt;= \\m -&gt; case m of\n        Just x -&gt; putStrLn x\n        Nothing -&gt; putStrLn \"Error\"\n</code></pre>\n\n<p>Is it possible to make it pointfree (get rid of the <code>\\m -&gt;</code>)?</p>\n"}, {"tags": ["javascript", "haskell", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1467485561, "post_id": 38156275, "comment_id": 63754900, "body": "This example gives me a compile error: <code>No instance for (Data.String.IsString T.JSString)</code>  .  The error goes away if you replace <code>import qualified GHCJS.Types    as T</code> with <code>import qualified Data.JSString as T</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1467488493, "last_edit_date": 1495542379, "creation_date": 1467431090, "answer_id": 38156275, "question_id": 38155884, "link": "https://stackoverflow.com/questions/38155884/using-javascript-libraries-from-haskell/38156275#38156275", "title": "Using javascript libraries from Haskell", "body": "<p>Yes you can call Javascript libraries from ghcjs compiled Haskell.</p>\n\n<p>Here is a simple example:</p>\n\n<pre><code>{-# LANGUAGE JavaScriptFFI      #-}\n{-# LANGUAGE OverloadedStrings  #-}\n\nimport qualified Data.JSString    as T\nimport qualified GHCJS.Foreign\n\nforeign import javascript unsafe \"alert($1)\" alert :: T.JSString -&gt; IO ()\n\nmain = alert \"hello world\"\n</code></pre>\n\n<p>As you can see from this example, you use the <code>foreign import javascript</code> feature to make JS functions available in your Haskell programs.</p>\n\n<p>I'm not sure if there is an official WebGL interface library, but a quick search around the web shows that others have created partial interface libraries -- e.g. see <a href=\"https://github.com/jmillikan/webgl-lessons-ghcjs/tree/master/src\" rel=\"nofollow noreferrer\">this example</a>. Basically you have to create the <code>foreign</code> declarations for the functions your application uses.</p>\n\n<p>For three.js, I found this github repo:</p>\n\n<p><a href=\"https://github.com/manyoo/ghcjs-three\" rel=\"nofollow noreferrer\">https://github.com/manyoo/ghcjs-three</a></p>\n\n<p>It is also possible to call Haskell code from JS, i.e. see this SO thread:</p>\n\n<p><a href=\"https://stackoverflow.com/q/29967135/866915\">How to call Haskell from Javascript with GHCJS</a></p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "accepted_answer_id": 38156275, "answer_count": 1, "score": 5, "last_activity_date": 1467488493, "creation_date": 1467425692, "question_id": 38155884, "link": "https://stackoverflow.com/questions/38155884/using-javascript-libraries-from-haskell", "title": "Using javascript libraries from Haskell", "body": "<p>I am fairly new to Haskell. Recently, I heard about this compiler called GHCJs where you can write code in Haskell which can then be compiled to Javascript. </p>\n\n<p>I am interested in using libraries such as three.js and webgl for making cool interactive 3d animations. Is it possible to call these javascript libraries from Haskell when using GHCJs? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1467417861, "post_id": 38155175, "comment_id": 63739708, "body": "So you are looking for something like an <code>allM</code> function, a monadic equivalent of <code>all</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1467419825, "post_id": 38155175, "comment_id": 63740054, "body": "My recommendation: don&#39;t bother. Just do the thing you want to do with the files and catch the exception if they don&#39;t exist. After all, they may cease to exist between performing this check and doing the next step, so you&#39;ll have to handle the exception anyway if you want a robust program!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1467426262, "post_id": 38155175, "comment_id": 63740915, "body": "We don&#39;t know the OP&#39;s application, but sometimes it can desirable to perform a &quot;pre-flight check&quot; before embarking on an expensive or time-consuming operation to ensure it isn&#39; going to fail for an &quot;obvious&quot; reason."}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467421751, "post_id": 38155343, "comment_id": 63740335, "body": "my <code>check</code> function returns a <code>IO Bool</code>, that is the problem that I have.. I actually want the <code>check</code> to print something to console for each file and then at the end I want to do a final output that is dependant on all files passing."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1467422530, "post_id": 38155343, "comment_id": 63740426, "body": "That actually works perfectly for what I need. Plus you prevented me struggling with <code>allM</code>. Great answer and thank you for your time! #note to self to reach for folds and scans more readily!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1467421991, "last_edit_date": 1467421991, "creation_date": 1467419186, "answer_id": 38155343, "question_id": 38155175, "link": "https://stackoverflow.com/questions/38155175/haskell-performing-an-action-after-a-single-failure/38155343#38155343", "title": "Haskell: Performing an action after a single failure", "body": "<p>I would use <code>foldM</code> like this:</p>\n\n<pre><code>import Control.Monad\n\ncheck :: FilePath -&gt; IO Bool\ncheck = undefined\n\nprocess files = do\n  allok &lt;- foldM (\\b f -&gt; fmap (b &amp;&amp;) (check f)) True files\n  if allok then putStrLn \"All OK\" else putStrLn \"Oops\"\n</code></pre>\n\n<p>Note this will always perform all of the tests.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html#v:allM\" rel=\"nofollow\">docs for <code>allM</code></a> says it is short-circuiting, so</p>\n\n<pre><code>do allok &lt;- allM check files\n   if allok then ... else ...\n</code></pre>\n\n<p>will stop performing the check after the first failure.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is some demonstration code:</p>\n\n<pre><code>import Control.Monad\n\ncheck :: Int -&gt; IO Bool\ncheck x =  do putStrLn (\"x = \" ++ show x)\n              return $ even x\n\nprocess files = do\n  allok &lt;- foldM (\\b f -&gt; fmap (b &amp;&amp;) (check f)) True files\n  if allok then putStrLn \"All OK\" else putStrLn \"Oops\"\n\nmain = do process [1..5]   -- will print \"Oops\"\n          process [2,4,6]  -- will print \"All OK\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 83, "user_id": 1117548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10eef87e64a4b00ba73ed74997c459b6?s=128&d=identicon&r=PG", "display_name": "Jussi Raunio", "link": "https://stackoverflow.com/users/1117548/jussi-raunio"}, "is_accepted": false, "score": 1, "last_activity_date": 1467435735, "creation_date": 1467435735, "answer_id": 38156651, "question_id": 38155175, "link": "https://stackoverflow.com/questions/38155175/haskell-performing-an-action-after-a-single-failure/38156651#38156651", "title": "Haskell: Performing an action after a single failure", "body": "<p>I recommend using <code>allM</code> from <code>Control.Monad.Loops</code> package. It quits early if it sees that any of the value is false which is useful if your checking involves some expensive computations. </p>\n\n<p>Here is a simple example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Loops\n\ndoesFileExist :: FilePath -&gt; IO Bool\ndoesFileExist path\n    | path == \"holiday.jpg\" = return True\n    | path == \"me.jpg\" = return True\n    | path == \"pop song.mp3\" = return True\n    | otherwise = return False\n\ncheck :: FilePath -&gt; IO Bool\ncheck s = do\n    r &lt;- doesFileExist s\n\n    putStrLn $ s ++ if r\n                        then \" exists\"\n                        else \" does not exist\"\n\n    return r\n\nmain :: IO ()\nmain = do\n    allPassed &lt;- allM check [\"holiday.jpg\", \"cat.mp4\", \"me.jpg\"]\n\n    if allPassed\n        then putStrLn \"Yes\"\n        else putStrLn \"No\"\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 38155343, "answer_count": 2, "score": 0, "last_activity_date": 1467435735, "creation_date": 1467417452, "question_id": 38155175, "link": "https://stackoverflow.com/questions/38155175/haskell-performing-an-action-after-a-single-failure", "title": "Haskell: Performing an action after a single failure", "body": "<p>What is the best way to perform a list of  <code>IO Bool</code> tests and then perform an action at the end if any one of the <code>Bool</code> is a <code>False</code></p>\n\n<p>If I have function that checks to see if a given file exists in a directory</p>\n\n<pre><code>check :: FilePath -&gt; IO ()\ncheck s = do \n          r &lt;- doesFileExist s\n          putStrLn s ++ if r then \" exists\" else \" does not exist\"\n</code></pre>\n\n<p>I would like to be able to check a list of files and then perform another function at the end depending on if all tests passed?</p>\n\n<p>At the moment I can only think of doing the checks again separately with something like</p>\n\n<pre><code>allPassed = do \n            l &lt;- mapM doesFileExist [`list of files`]\n            if all (==True) l then \"all ok\" else \"meh\"\n</code></pre>\n"}, {"tags": ["haskell", "accelerate"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "edited": false, "score": 0, "creation_date": 1467513144, "post_id": 38154588, "comment_id": 63760141, "body": "thanks, i seem to have gotten it working via stack. But i guess now ghc and stack ghc are different versions... is this terrible?"}, {"owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "edited": false, "score": 0, "creation_date": 1467678322, "post_id": 38154588, "comment_id": 63812602, "body": "--allow-newer did not work. Trying to manually set base. What is the best way to install after i do this? i am doing &quot;runhaskell Setup configure&quot; but there are missing dependencies...maybe i am not in the right place"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1467412115, "creation_date": 1467412115, "answer_id": 38154588, "question_id": 38154295, "link": "https://stackoverflow.com/questions/38154295/trouble-installing-accelerate-cuda/38154588#38154588", "title": "trouble installing accelerate-cuda", "body": "<p>Ghc 8.0.1 came with an updated version of base (4.9) which might be incompatible with the accelerate-cuda package.</p>\n\n<p>You can try and pass the flag <code>--allow-newer</code> to cabal, or dowload the package with <code>cabal get</code> and edit the cabal fie manually setting <code>base &gt;= 4.8 &amp;&amp; &lt;5.0</code> in the build dapends section.</p>\n"}], "owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1467430718, "creation_date": 1467409848, "last_edit_date": 1467430718, "question_id": 38154295, "link": "https://stackoverflow.com/questions/38154295/trouble-installing-accelerate-cuda", "title": "trouble installing accelerate-cuda", "body": "<p>I have been trying to run cabal install accelerate-cuda -fdebug to no avail. at first i had some issues i think with my version of cuda, so i upgraded ghc to version 8.0.1 and cabal to version 1.22.5.0.</p>\n\n<p>I was able to run cabal install accelerate which worked but cabal install accelerate-cuda has resulted in : </p>\n\n<blockquote>\n  <p>Resolving dependencies... cabal: Could not resolve dependencies:\n  trying: accelerate-cuda-0.15.1.1 (user goal) next goal: base\n  (dependency of accelerate-cuda-0.15.1.1) rejecting:\n  base-4.9.0.0/installed-4.9... (conflict: accelerate-cuda => base>=4.7\n  &amp;&amp; &lt;4.9) rejecting: base-4.9.0.0, 4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2,\n  4.7.0.1, 4.7.0.0, 4.6.0.1, 4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint requires installed instance) Dependency tree exhaustively searched.</p>\n</blockquote>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 5, "last_activity_date": 1467404763, "creation_date": 1467404763, "answer_id": 38153434, "question_id": 38153404, "link": "https://stackoverflow.com/questions/38153404/what-does-it-mean-when-a-haskell-module-doesnt-declare-any-exports/38153434#38153434", "title": "What does it mean when a Haskell module doesn&#39;t declare any exports?", "body": "<p>From <a href=\"https://www.haskell.org/tutorial/modules.html\">A Gentle Introduction to Haskell, Version 98</a>:</p>\n\n<blockquote>\n  <p>If the export list following the module keyword is omitted, all of the names bound at the top level of the module would be exported.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": true, "score": 6, "last_activity_date": 1467405076, "creation_date": 1467405076, "answer_id": 38153501, "question_id": 38153404, "link": "https://stackoverflow.com/questions/38153404/what-does-it-mean-when-a-haskell-module-doesnt-declare-any-exports/38153501#38153501", "title": "What does it mean when a Haskell module doesn&#39;t declare any exports?", "body": "<p>You have to distinguish</p>\n\n<ol>\n<li>an empty export list (<code>module Foo () where</code>) and</li>\n<li>no export list at all (<code>module Foo where</code>).</li>\n</ol>\n\n<p>The empty export list means: Export no value or type definitions. However, the module still exports all instance declarations from the module itself, and from all imported modules, so modules with empty export lists can be useful.</p>\n\n<p>No export list at all means: Export all value and type definitions made in the module itself. (And all instance declarations, too, of course).</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 38153501, "answer_count": 2, "score": 1, "last_activity_date": 1467405076, "creation_date": 1467404616, "question_id": 38153404, "link": "https://stackoverflow.com/questions/38153404/what-does-it-mean-when-a-haskell-module-doesnt-declare-any-exports", "title": "What does it mean when a Haskell module doesn&#39;t declare any exports?", "body": "<p>I just ran into a Haskell module that appears not to export anything. <a href=\"https://github.com/kadena-io/juno/blob/78edc9db127e05e766e0af40ccb0a804b6aef9cf/src/Schwifty/Swift/M105/Types.hs\" rel=\"nofollow\"><code>Schwifty/Swift/M105/Types.hs</code></a>:</p>\n\n<pre><code>module Schwifty.Swift.M105.Types where\n</code></pre>\n\n<p>There are other modules in the project that import it.</p>\n\n<pre><code>import Schwifty.Swift.M105.Types\n</code></pre>\n\n<p>I thought Haskell modules always had to declare their exports. What does it mean when you don't?</p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467392406, "post_id": 38149886, "comment_id": 63730654, "body": "What is the &quot;Minimal Installer&quot;? Is this a windows thing?"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467392804, "post_id": 38149886, "comment_id": 63730837, "body": "The minimal and full installers both have the same problem. They want administrator privileges. See the Haskell platform for windows (<a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">haskell.org/platform/windows.html</a>) for both."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467394410, "post_id": 38149886, "comment_id": 63731621, "body": "The Minimal Installer is a minimal release (no extra libraries) of the Haskell Platform. It is available for all platforms."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467394504, "post_id": 38149886, "comment_id": 63731664, "body": "Please open an issue in the HP issue tracker: <a href=\"https://github.com/haskell/haskell-platform/issues\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-platform/issues</a>"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1467409241, "post_id": 38149886, "comment_id": 63737707, "body": "I got administrator privileges and was able to install and run GHCi."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1467409363, "post_id": 38149886, "comment_id": 63737731, "body": "I would open an issue in the HP issue tracker if you would tell me where it is and how to get started. Thanks. (Don&#39;t forget, this problem arose in the first place because I&#39;m a new user and don&#39;t know my way around the Haskell ecology.)"}], "answers": [{"tags": [], "owner": {"reputation": 7136, "user_id": 1467115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81bee3c36aa1c59317d525baabecec11?s=128&d=identicon&r=PG", "display_name": "Jan Gerlinger", "link": "https://stackoverflow.com/users/1467115/jan-gerlinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1467479199, "creation_date": 1467479199, "answer_id": 38162562, "question_id": 38149886, "link": "https://stackoverflow.com/questions/38149886/how-does-one-run-the-haskell-portable-install-option-for-ghci-8-0-1/38162562#38162562", "title": "How does one run the Haskell portable install option for GHCi 8.0.1?", "body": "<p>May I suggest directly using <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow\">Stack</a> instead?</p>\n\n<p>It's part of what is bundled in the Haskell Platform. But if you just use Stack, there's (for almost all basic use cases) no need anymore for the other things (System-wide installation of GHC and Cabal and a global package database) included there.</p>\n\n<p>The stack executable can <a href=\"http://docs.haskellstack.org/en/stable/README/#how-to-install\" rel=\"nofollow\">easily be downloaded</a> and used without admin privileges for most platforms.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1467479199, "creation_date": 1467389664, "question_id": 38149886, "link": "https://stackoverflow.com/questions/38149886/how-does-one-run-the-haskell-portable-install-option-for-ghci-8-0-1", "title": "How does one run the Haskell portable install option for GHCi 8.0.1?", "body": "<p>A few years ago a question was asked about installing Haskell without administrator privileges. The answer was to use the portable install option.  But I don't see that option when I download and run the Minimal Installer for GHCi 8.0.1. Is there still a way to do it, and if so how?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5331, "user_id": 3777428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sJ6pq.png?s=128&g=1", "display_name": "eigenchris", "link": "https://stackoverflow.com/users/3777428/eigenchris"}, "edited": false, "score": 0, "creation_date": 1467389451, "post_id": 38149718, "comment_id": 63729141, "body": "You should read up on the syntax for guards (see the section on &quot;Defining Basic Functions&quot; <a href=\"http://www.seas.upenn.edu/~cis194/fall14/spring13/lectures/01-intro.html\" rel=\"nofollow noreferrer\">here</a>). The expression between the <code>|</code> and <code>=</code> should evaluate to a boolean, and the expression to the right of the <code>=</code> should be the result of the function if the expression on the the left evaluates to true. The guard expressions will be tested starting from the top and moving downward until a <code>True</code> condition is found. Are you still confused?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1467394213, "post_id": 38149802, "comment_id": 63731505, "body": "Further, <code>if x then y else False</code> can be written <code>x &amp;&amp; y</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1467389370, "creation_date": 1467389370, "answer_id": 38149802, "question_id": 38149718, "link": "https://stackoverflow.com/questions/38149718/how-can-i-create-a-lowercase-checker/38149802#38149802", "title": "How can I create a lowercase checker?", "body": "<p>How about:</p>\n\n<pre><code>lowercase (x:xs) = if isLower x\n                     then lowercase xs\n                     else False\n</code></pre>\n\n<p>But you still need to cover the empty string case:</p>\n\n<pre><code>lowercase [] = ???\n</code></pre>\n\n<p>Also note that there is no need to test if a boolean equals True or False explicitly. I.e. instead of <code>if boolexpr == True ...</code> just use <code>if boolexpr ...</code></p>\n"}, {"tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 2, "last_activity_date": 1467389406, "creation_date": 1467389406, "answer_id": 38149814, "question_id": 38149718, "link": "https://stackoverflow.com/questions/38149718/how-can-i-create-a-lowercase-checker/38149814#38149814", "title": "How can I create a lowercase checker?", "body": "<p>You have a good idea, but bad syntax.</p>\n\n<pre><code>lowercase :: String -&gt; Bool\nlowercase [] = True -- this case is needed to ensure that recursion stops\nlowercase (x:xs) | isLower x = lowercase xs\nlowercase _ = False\n</code></pre>\n\n<p>Or, using standard library,</p>\n\n<pre><code>lowercase = all isLower\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6100041"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 38149814, "answer_count": 2, "score": 0, "last_activity_date": 1467389406, "creation_date": 1467389026, "last_edit_date": 1467389147, "question_id": 38149718, "link": "https://stackoverflow.com/questions/38149718/how-can-i-create-a-lowercase-checker", "title": "How can I create a lowercase checker?", "body": "<p>I'm having trouble understanding how this recursion works, for example, if I want to make a <code>String -&gt; Boolean</code> exercise to know if the string has a lower case in it how can i do it?This is my big amateur code, thats not even running the list properly, although I don't know any better:</p>\n\n<pre><code>lowercase (x:xs) | isLower x lowercase xs = True\n                 | otherwise = False\n</code></pre>\n"}, {"tags": ["haskell", "type-systems"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1467379784, "post_id": 38146693, "comment_id": 63722961, "body": "I think they&#39;re called &quot;sorts&quot;."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1467379974, "post_id": 38146693, "comment_id": 63723126, "body": "if I get you right then it&#39;s what&#39;s called <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php?n=ReferenceManual.UniversePolymorphism\" rel=\"nofollow noreferrer\">Universes</a> in agda (well it&#39;s <code>Set_2</code> but why stop there?)"}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1467381936, "post_id": 38147045, "comment_id": 63724502, "body": "Doesn&#39;t sound right, phase distinction and quantification are orthogonal. In GHC 8 we can quantify over kinds, but that doesn&#39;t change phase distinction."}, {"owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "edited": false, "score": 0, "creation_date": 1467382029, "post_id": 38147045, "comment_id": 63724582, "body": "@leftaroundabout Thank you for the great answer. Can you elaborate about the &quot;closed pot&quot; analogy? I couldn&#39;t get the point. Thank you."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1467380641, "creation_date": 1467380641, "answer_id": 38147045, "question_id": 38146693, "link": "https://stackoverflow.com/questions/38146693/what-is-the-type-of-a-kind/38147045#38147045", "title": "What is the &quot;type&quot; of a kind?", "body": "<blockquote>\n  <p>In Haskell the \"types\" of types are called Kinds, denoted as <code>*</code>. Such as in:</p>\n</blockquote>\n\n<p>This is not correct. <code>*</code> is <em>the kind of types</em>, i.e. of such type-level entities which represent a set<sup>&dagger;</sup> of possible runtime values. </p>\n\n<p>The term <em>kind</em> is a bit of a cludge. It's only needed because Haskell (for good reasons, no less!) has a clear distinction between compile time and run time. <em>Values</em> only exist at runtime, everything else only exists at compile time. In particular, the type of such values only exists at compile time.</p>\n\n<p>Now, it's desirable to classify types as well, just as it is desirable to classify values in types. In principle, there is no reason not to consider types just like any other value and thus have <em>types of types</em>. This is pretty much the foundational idea of dependently-typed languages like Idris or Agda<sup>&para;</sup>.</p>\n\n<p>In Haskell this doesn't quite work: because of the aforementioned runtime/compiletime distinction you can't throw types and values in one closed<sup>&ddagger;</sup> pot. Thus the concept of kinds: these are also types, but types of things that, unlike values, also exist at compile time like the kinds themselves do, not at runtime like values.</p>\n\n<p>This means that there's no need to go yet another level up from kinds, because there's no earlier level than compile-time. (Unless you bring Template Haskell in the game; no idea if anybody has considered such issues yet.)</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>They aren't really sets, but <em>kind of</em> (pun not intended).</sub></p>\n\n<p><sup>&ddagger;</sup><sub><em>Closed</em> in the sense: you can talk about types of types of types of... and never really need to invent anything new.</sub></p>\n\n<p><sup>&para;</sup><sub>I understand that Agda still makes a distinction between types, type-types etc. (<code>Set_2</code> and so on). But I believe this has more to do with the fact that Agda is a <em>total language</em>. I could be wrong here, though.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1467404003, "post_id": 38148977, "comment_id": 63735888, "body": "You say that <code>* :: *</code> and that <code>*</code> is the kind of types that have actual values at the term level. Are both of these actually true? Does <code>*</code> have a term-level inhabitant?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1467405461, "post_id": 38148977, "comment_id": 63736402, "body": "@Daniel Wagner I confess I&#39;m out of my depth here. That said, while playing in ghci with <code>-XTypeInType</code> activated , entering <code>:t undefined :: Type</code> doesn&#39;t give a type error, while entering something like  <code>:t undefined :: &#39;True</code> does."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1467405910, "post_id": 38148977, "comment_id": 63736572, "body": "Another experiment: <code>:t undefined :: (sometype :: Type)</code> typechecks, as expected, while <code>:t undefined :: (sometype :: Bool)</code> does not."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1467549814, "post_id": 38148977, "comment_id": 63767011, "body": "The type <code>Type</code> does not currently have inhabitants in the term language. Rather, a singleton encoding is used to fake them up. In the future, though, the adoption of pi-types, abstracting over the things which may safely live both in types and at run time, would make it possible, sensible and useful to add run time types. Moreover, the parametricity of forall-types would persist."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 8, "last_activity_date": 1467393850, "last_edit_date": 1467393850, "creation_date": 1467386623, "answer_id": 38148977, "question_id": 38146693, "link": "https://stackoverflow.com/questions/38146693/what-is-the-type-of-a-kind/38148977#38148977", "title": "What is the &quot;type&quot; of a kind?", "body": "<p>From GHC 8 onwards, as part of the march towards dependent types in Haskell, there's a new extension <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#kind-polymorphism-and-type-in-type\" rel=\"nofollow\"><code>-XTypeInType</code></a> that makes the \"types\" of kinds to be... types.</p>\n\n<p>When <code>TypeInType</code> is on, there are just two levels in the language: terms and types. And the type level folds back on itself, so that the \"type\" (in Haskell terms, \"kind\") of a type is again a type.</p>\n\n<pre><code>Prelude&gt; :set -XTypeInType\nPrelude&gt; import Data.Kind\nPrelude Data.Kind&gt; :k Int\nInt :: *\nPrelude Data.Kind&gt; :k (*)\n(*) :: *\n</code></pre>\n\n<p>Also <code>Type</code> becomes a synonym for <code>*</code>, the kind of types that have actual values at the term level:</p>\n\n<pre><code>Prelude Data.Kind&gt; :k (Int :: *)\n(Int :: *) :: *\nPrelude Data.Kind&gt; :k (Int :: Type)\n(Int :: Type) :: *\nPrelude Data.Kind&gt; :k (Monad :: (Type -&gt; Type) -&gt; Constraint)\n(Monad :: (Type -&gt; Type) -&gt; Constraint) :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>This lets you employ with kinds all the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#equality-constraints\" rel=\"nofollow\">machinery</a> that already exists for types, enriching Haskell's support for type-level shenanigans at the cost of being <a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell/Phase1#Kindsandtypesarethesame\" rel=\"nofollow\">inconsistent from a logical perspective</a> (which doesn't matter because Haskell is already \"inconsistent\" when considered as a proof system, for a host of other reasons).</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1467391107, "creation_date": 1467391107, "answer_id": 38150276, "question_id": 38146693, "link": "https://stackoverflow.com/questions/38146693/what-is-the-type-of-a-kind/38150276#38150276", "title": "What is the &quot;type&quot; of a kind?", "body": "<p>Just as kinds classify types, so do <em>sorts</em> classify kinds.</p>\n\n<p><a href=\"http://jozefg.bitbucket.org/posts/2014-02-10-types-kinds-and-sorts.html\" rel=\"nofollow\">http://jozefg.bitbucket.org/posts/2014-02-10-types-kinds-and-sorts.html</a></p>\n"}], "owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 1, "accepted_answer_id": 38148977, "answer_count": 3, "score": 1, "last_activity_date": 1467393850, "creation_date": 1467379628, "question_id": 38146693, "link": "https://stackoverflow.com/questions/38146693/what-is-the-type-of-a-kind", "title": "What is the &quot;type&quot; of a kind?", "body": "<p>In Haskell the \"types\" of types are called Kinds, denoted as <code>*</code>. Such as in:</p>\n\n<pre><code> Maybe :: * -&gt; *\n Either :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>I was wondering if there is any equivalent for the \"types\" of kinds in Haskell or other strongly typed languages? </p>\n\n<p>Are they of any practical importance? Are there any cases where they turn out to be very useful?</p>\n\n<p>Any reference to some material would be appreciated. </p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 3, "last_activity_date": 1467393784, "creation_date": 1467393784, "answer_id": 38150915, "question_id": 38145566, "link": "https://stackoverflow.com/questions/38145566/servant-always-give-me-a-initial-value-in-readert-monad/38150915#38150915", "title": "Servant always give me a initial value in ReaderT Monad", "body": "<blockquote>\n  <p>It seems like servant providing a new <code>defaultServices</code> for every request.</p>\n</blockquote>\n\n<p>It is, because your code as written is an <code>STM</code> action to do so. Following the logic&mdash;</p>\n\n<pre><code>defaultServices :: ServiceSet\ndefaultServices = newTVar ...\n</code></pre>\n\n<p>This (fragmentary) definition crucially does not <em>run</em> the <code>STM</code> action to produce a new <code>TVar</code>. Instead it defines a value (<code>defaultServices</code>) which is an <code>STM</code> action which can produce <code>TVar</code>s. Following where <code>defaultServices</code> gets passed to, you use it in your handlers like&mdash;</p>\n\n<pre><code>getService = do\n  stm &lt;- ask\n  liftIO . atomically $ do\n    tvar &lt;- stm\n    ...\n</code></pre>\n\n<p>The action stored in your <code>Reader</code> is unchanged from the <code>defaultServices</code> value itself, so this code is equivalent to&mdash;</p>\n\n<pre><code>getService = do\n  liftIO . atomically $ do\n    tvar &lt;- defaultServices\n    ...\n</code></pre>\n\n<p>And by substituting in the definition of <code>defaultServices</code>&mdash;</p>\n\n<pre><code>getService = do\n  liftIO . atomically $ do\n    tvar &lt;- newTVar ...\n    ...\n</code></pre>\n\n<p>This now looks obviously wrong. Instead of <code>defaultServices</code> being an action to produce a new <code>TVar</code>, it should be that <code>TVar</code> itself, right? So on the type level without aliases&mdash;</p>\n\n<pre><code>type ServiceSet = STM (TVar (M.Map String MicroService)) -- From this\ntype Services   =      TVar (M.Map String MicroService)  -- To this\n\ndefaultServices :: Services\n</code></pre>\n\n<p>Now <code>defaultServices</code> represents an actual <code>TVar</code>, instead of a method of creating <code>TVar</code>s. Writing this may seem tricky if it's your first time because you somehow have to run an <code>STM</code> action, but <code>atomically</code> just turns that into an <code>IO</code> action, and you probably &ldquo;know&rdquo; that there is no way to escape <code>IO</code>. This actually is <em>incredibly</em> common though, and a quick look at the actual <a href=\"http://hackage.haskell.org/package/stm\" rel=\"nofollow\">stm documentation</a> for the functions in play will point you right to the answer.</p>\n\n<p>It turns out that this is one of those exciting times in your life as a Haskell developer that you get to use <code>unsafePerformIO</code>. The definition of <a href=\"http://hackage.haskell.org/package/stm-2.4.4.1/docs/Control-Monad-STM.html#v:atomically\" rel=\"nofollow\"><code>atomically</code></a> spells out pretty much exactly what you have to do.</p>\n\n<blockquote>\n  <p>Perform a series of STM actions atomically.</p>\n  \n  <p>You cannot use <code>atomically</code> inside an <code>unsafePerformIO</code> or\n  <code>unsafeInterleaveIO</code>. Any attempt to do so will result in a runtime\n  error. (Reason: allowing this would effectively allow a transaction\n  inside a transaction, depending on exactly when the thunk is\n  evaluated.)</p>\n  \n  <p>However, see <code>newTVarIO</code>, which can be called inside <code>unsafePerformIO</code>,\n  and which allows top-level <code>TVar</code>s to be allocated.</p>\n</blockquote>\n\n<p>Now there's one final piece of this puzzle that isn't in the documentation, which is that unless you tell GHC not to inline your top-level value produced using <code>unsafePerformIO</code>, you might still end up with sites where you use <code>defaultServices</code> having their own unique set of services. E.g., without forbidding inlining this would happen&mdash;</p>\n\n<pre><code>getService = do\n  liftIO . atomically $ do\n    mss &lt;- readTVar defaultServices\n\ngetService = do\n  liftIO . atomically $ do\n    mss &lt;- readTVar (unsafePerformIO $ newTVarIO ...)\n    ...\n</code></pre>\n\n<p>This is a simple fix though, just add a <code>NOINLINE</code> pragma to your definition of <code>defaultServices</code>.</p>\n\n<pre><code>defaultServices :: Services\ndefaultServices = unsafePerformIO $ newTVar M.empty\n{-# NOINLINE defaultServices #-}\n</code></pre>\n\n<hr>\n\n<p>Now this is a fine solution, and I've happily used it in production code, but there are <a href=\"https://wiki.haskell.org/Top_level_mutable_state\" rel=\"nofollow\">some objections</a> to it. Since you're already fine with using a <code>ReaderT</code> in your handler monad stack (and the above solution is mostly for people who for some reason are avoiding threading a reference around), you could just create a new <code>TVar</code> at program initialization and then pass that in. The briefest sketch of how that would work is below.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  services &lt;- atomically (newTVar M.empty)\n  run 8080 $ serve Proxy (server services)\n\nserver :: TVar Services -&gt; Server Api\nserver services = enter (readerToHandler services) serverT\n\ngetService :: LocalHandler (Maybe MicroService)\ngetService = do\n  services &lt;- ask\n  liftIO . atomically $ do\n    mss &lt;- readTVar services\n    ...\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 38150915, "answer_count": 1, "score": 2, "last_activity_date": 1467393784, "creation_date": 1467376414, "question_id": 38145566, "link": "https://stackoverflow.com/questions/38145566/servant-always-give-me-a-initial-value-in-readert-monad", "title": "Servant always give me a initial value in ReaderT Monad", "body": "<p>I'm learning Servant and write a simple service. Here's source code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE RankNTypes #-}\n\nmodule BigMama where\n\nimport           Control.Concurrent\nimport           Control.Concurrent.STM\nimport           Control.Monad\nimport           Control.Monad.Reader\nimport           Data.Aeson\nimport           Data.Aeson.Types\nimport qualified Data.ByteString.Lazy.Char8 as C\nimport           Data.Char\nimport qualified Data.Map as M\nimport           Debug.Trace\nimport           GHC.Generics\nimport           Prelude hiding (id)\nimport           Servant\n\ndata MicroService = MicroService\n  { name :: String\n  , port :: Int\n  , id :: Maybe String\n  } deriving (Generic)\n\ninstance ToJSON MicroService\ninstance FromJSON MicroService\n\ninstance Show MicroService where\n  show = C.unpack . encode\n\ntype ServiceSet = STM (TVar (M.Map String MicroService))\n\ntype LocalHandler = ReaderT ServiceSet IO\n\ndefaultServices :: ServiceSet\ndefaultServices = newTVar $ M.fromList []\n\ntype Api =\n  \"bigmama\" :&gt; Get '[JSON] (Maybe MicroService)\n  :&lt;|&gt; \"bigmama\" :&gt; ReqBody '[JSON] MicroService :&gt; Post '[JSON] MicroService\n\napi :: Proxy Api\napi = Proxy\n\nserverT :: ServerT Api LocalHandler\nserverT = getService\n  :&lt;|&gt; registerService\n\ngetService :: LocalHandler (Maybe MicroService)\ngetService = do\n  stm &lt;- ask\n  liftIO . atomically $ do\n    tvar &lt;- stm\n    mss &lt;- readTVar tvar\n    return $ M.lookup \"file\" mss\n\nregisterService :: MicroService -&gt; LocalHandler MicroService\nregisterService ms = do\n  stm &lt;- ask\n  liftIO . atomically $ do\n    tvar &lt;- stm\n    mss &lt;- readTVar tvar\n    let mss' = M.insert (name ms) ms mss\n    writeTVar tvar mss'\n  return ms\n\nreaderToHandler' :: forall a. ServiceSet -&gt; LocalHandler a -&gt; Handler a\nreaderToHandler' ss r = liftIO $ runReaderT r ss\n\nreaderToHandler :: ServiceSet -&gt; (:~&gt;) LocalHandler Handler\nreaderToHandler ss = Nat (readerToHandler' ss)\n\nserver :: Server Api\nserver = enter (readerToHandler defaultServices) serverT\n</code></pre>\n\n<p>It seems like servant providing a new <code>defaultServices</code> for every request. I send POST to create service (name = \"file\") and can't get the service back on GET request. How to share data among requests on servant?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467375317, "post_id": 38145166, "comment_id": 63719864, "body": "Isn&#39;t that just <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"nofollow noreferrer\"><code>&lt;$&gt;</code></a>?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467375383, "post_id": 38145166, "comment_id": 63719905, "body": "@Bakuriu <code>&lt;$&gt;</code> has the arguments in the wrong order"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1467375405, "post_id": 38145166, "comment_id": 63719922, "body": "Actually <code>flip fmap</code> / <code>flip &lt;$&gt;</code>. <code>lens</code> <a href=\"https://www.haskell.org/hoogle/?hoogle=Functor+f+%3D%3E+f+a+-%3E+%28a-%3Eb%29+-%3E+f+b+%2Blens\" rel=\"nofollow noreferrer\">has this by the name <code>&lt;&amp;&gt;</code></a>. Not with fixity 0 though, which doesn&#39;t seem advisable either, IMO."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467375476, "post_id": 38145166, "comment_id": 63719959, "body": "@leftaroundabout That was what I was looking for. If you make it an answer I will accept it."}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1467375669, "answer_count": 0, "score": 0, "last_activity_date": 1467375215, "creation_date": 1467375215, "question_id": 38145166, "link": "https://stackoverflow.com/questions/38145166/pipe-forward-monad-operator", "closed_reason": "Duplicate", "title": "Pipe forward monad operator", "body": "<p>Is there a built in version of this operator or is there a package that has this operator? Hoogle did not come up with anything.</p>\n\n<pre><code>infixl 0 &amp;*\nx &amp;* f = fmap f x\n\ngetLine &amp;* map toUpper &gt;&gt;= putStrLn\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467378280, "post_id": 38144930, "comment_id": 63721839, "body": "It looks to me like it&#39;s part of GHC (specifically, the RTS or &quot;runtime system&quot;). What version of GHC are you using?"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467378530, "post_id": 38144930, "comment_id": 63722030, "body": "I&#39;m using the 8.0.1 32bit version on Windows 10"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467380039, "post_id": 38144930, "comment_id": 63723168, "body": "OK. So you shouldn&#39;t need to <i>install</i> anything, you just need to figure out where the DLL is, and convince Cabal to find it. I&#39;m not exactly sure of the answer to either of those parts..."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1467380122, "post_id": 38144930, "comment_id": 63723230, "body": "Background info: <a href=\"https://www.vex.net/~trebla/haskell/so.xhtml\" rel=\"nofollow noreferrer\">vex.net/~trebla/haskell/so.xhtml</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467390967, "post_id": 38144930, "comment_id": 63729902, "body": "This points to a broken setup.  How did you install GHC? How did you install Cabal?"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467415887, "post_id": 38144930, "comment_id": 63739347, "body": "I installed it exactly like it it is described on this website: <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">haskell.org/platform</a> . I downloaded Windows version and 32Bit minimal."}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467542268, "post_id": 38144930, "comment_id": 63765250, "body": "I tried it now with &quot;stack&quot; tool, please see my Edit 1"}], "answers": [{"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": true, "score": 1, "last_activity_date": 1470471716, "creation_date": 1470471716, "answer_id": 38802141, "question_id": 38144930, "link": "https://stackoverflow.com/questions/38144930/haskell-cabal-missing-c-library/38802141#38802141", "title": "Haskell cabal: Missing C library", "body": "<p>This won't work on Windows (yet).</p>\n\n<p><code>call-haskell-from-anything</code> seems rely on using a version of GHC that requires <code>-dynamic</code> support. From their cabal file:</p>\n\n<pre><code>ghc-options: \n   -- For building TemplateHaskell with cabal and -dynamic, we have to disable -dynamic sometimes \n   -no-hs-main -fPIC -shared -dynamic \n</code></pre>\n\n<p>Also <code>-fPIC</code> is not a flag that means anything on Windows as windows doesn't use/need Position Independent Code.</p>\n\n<p><code>HSrts-ghc8.0.1</code> is referring to the dynamic version of the GHC runtime which is not currently building on Windows due to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5987\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/5987</a> </p>\n\n<p>I am trying to get this done by <code>8.2.1</code> which should support dynamic compilation again. But for now, sorry, this package won't work.</p>\n\n<p>Dynamic support may not be needed, so you can try unpacking the project and editing the cabal file, removing <code>-fPIC</code> and <code>-dynamic</code>.</p>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 1, "accepted_answer_id": 38802141, "answer_count": 1, "score": 2, "last_activity_date": 1476223303, "creation_date": 1467374529, "last_edit_date": 1467538388, "question_id": 38144930, "link": "https://stackoverflow.com/questions/38144930/haskell-cabal-missing-c-library", "title": "Haskell cabal: Missing C library", "body": "<p>Whe i try to install the Haskell package \"call-haskell-from-anything\" i get the following error messages:</p>\n\n<pre><code>cabal.exe: Missing dependency on a foreign library:\n* Missing C library: HSrts-ghc8.0.1\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.\ncabal: Leaving directory 'C:\\Users\\Manfred\\AppData\\Local\\Temp\\cabal-tmp-2460\\call-haskell-from-anything-1.0.1.0'\ncabal: Error: some packages failed to install:\ncall-haskell-from-anything-1.0.1.0 failed during the configure step. The\nexception was:\nExitFailure 1\n</code></pre>\n\n<p>What is this <strong>HSrts-ghc8.0.1</strong> library and where can i find it on a Windows system?\nOr do i have to manually install this library in Windows?</p>\n\n<p><strong>Edit 1:</strong></p>\n\n<p>In the meantime i tried the \"stack\" tool and got a similar error:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( C:\\Users\\Manfred\\AppData\\Local\\Temp\\stack4480\\call-haskell-from-anything-1.0.1.0\\Setup.hs, C:\\Users\\Manfred\\AppData\\Local\\Temp\\stack4480\\call-haskell-from-anything-1.0.1.0\\.stack-work\\dist\\2672c1f3\\setup\\Main.o )\n    Linking C:\\Users\\Manfred\\AppData\\Local\\Temp\\stack4480\\call-haskell-from-anything-1.0.1.0\\.stack-work\\dist\\2672c1f3\\setup\\setup.exe ...\n    Configuring call-haskell-from-anything-1.0.1.0...\n    Determining GHC version: 7.10.3\n    setup.exe: Missing dependency on a foreign library:\n    * Missing C library: HSrts-ghc7.10.3\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n"}, {"tags": ["haskell", "lexer", "alex"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467371685, "post_id": 38143627, "comment_id": 63717546, "body": "Possibly useful: <a href=\"http://stackoverflow.com/questions/20315739/how-to-use-an-alex-monadic-lexer-with-happy\" title=\"how to use an alex monadic lexer with happy\">stackoverflow.com/questions/20315739/&hellip;</a>   I had troubles too understanding how to use monadic lexer and I found the documentation is really unhelpful."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467375920, "post_id": 38143627, "comment_id": 63720232, "body": "<a href=\"http://stackoverflow.com/questions/37529673/is-there-an-established-way-to-write-parsers-that-can-reconstruct-their-exact-in\">Related question for the equivalent Parsec problem, that I asked recently</a>. (I haven&#39;t found a really satisfying solution yet; in the project that prompted be to this question I chose, for once, not to try and be clever \u2013 I just wrote all the handling for whitespace-preservation by hand. That turned out to work pretty well.)"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 401, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1467370556, "creation_date": 1467370556, "question_id": 38143627, "link": "https://stackoverflow.com/questions/38143627/haskell-alex-lexer-handle-whitespace-and-newlines-as-state", "title": "Haskell - Alex lexer - handle whitespace and newlines as state", "body": "<p>I'm writing a parser for a language in Haskell with Alex + Happy.</p>\n\n<p>What I want to do is: in Alex, skip whitespaces and newlines, but keep them as state, and then emit tokens which contain the newlines and the indent before the token.</p>\n\n<p>I guess I could emit extra tokens for indent and newlines, and then collapse them later, but I'd prefer a cleaner approach.</p>\n\n<p>Is there any way to wrap the token processing in alex in a monad that carries the indent/newline information and is accesible inside the actions that emit tokens?</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1467635302, "post_id": 38182444, "comment_id": 63795219, "body": "I fear that &quot;easy way&quot; won&#39;t work for me, because my data has <code>Text</code> not on top-level, but deep inside."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 2, "creation_date": 1467640063, "post_id": 38182444, "comment_id": 63798161, "body": "@Mark In that case you can use <a href=\"http://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#v:dataToExpQ\" rel=\"nofollow noreferrer\"><code>dataToExQ</code></a>. I&#39;ve updated my answer."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1467706851, "post_id": 38182444, "comment_id": 63821230, "body": "Now that is interesting. I&#39;ll check it once I have time and accept your answer if it works."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 9, "last_activity_date": 1467639879, "last_edit_date": 1467639879, "creation_date": 1467628037, "answer_id": 38182444, "question_id": 38143464, "link": "https://stackoverflow.com/questions/38143464/cant-find-inerface-file-declaration-for-variable/38182444#38182444", "title": "Can&#39;t find inerface-file declaration for variable", "body": "<p>This seems to be because <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/src/Language.Haskell.TH.Syntax.html#dataToQa\" rel=\"noreferrer\"><code>dataToQa</code></a> expects the function that <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Data.html#v:toConstr\" rel=\"noreferrer\"><code>toConstr</code></a> shows (which is <code>\"pack\"</code> for <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#t:Text\" rel=\"noreferrer\"><code>Text</code></a>) to be in the same module the data type is defined. So <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#v:liftData\" rel=\"noreferrer\"><code>liftData</code></a> is looking for <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#v:pack\" rel=\"noreferrer\"><code>pack</code></a> in <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-Internal.html\" rel=\"noreferrer\"><code>Data.Text.Internal</code></a> but <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#v:pack\" rel=\"noreferrer\"><code>pack</code></a> is actually in <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html\" rel=\"noreferrer\"><code>Data.Text</code></a>.</p>\n\n<p>An easy way to fix it is to just write your own lift function for <code>Text</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport qualified Data.Text as T\nimport Language.Haskell.TH.Syntax\n\nliftText :: T.Text -&gt; Q Exp\nliftText txt = AppE (VarE 'T.pack) &lt;$&gt; lift (T.unpack txt)\n\nmyThHelper :: FilePath -&gt; Q Exp\nmyThHelper path =\n  runIO (compileThatFile path) &gt;&gt;= liftText\n</code></pre>\n\n<hr>\n\n<p>If text is deep in the structure you want to use, you can use <a href=\"http://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#v:dataToExpQ\" rel=\"noreferrer\"><code>dataToExpQ</code></a> which lets you override the lift function for type-specific cases:</p>\n\n<pre><code>import Data.Data\n\nliftDataWithText :: Data a =&gt; a -&gt; Q Exp\nliftDataWithText = dataToExpQ (\\a -&gt; liftText &lt;$&gt; cast a)\n</code></pre>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 1, "accepted_answer_id": 38182444, "answer_count": 1, "score": 6, "last_activity_date": 1467639879, "creation_date": 1467370043, "last_edit_date": 1467560342, "question_id": 38143464, "link": "https://stackoverflow.com/questions/38143464/cant-find-inerface-file-declaration-for-variable", "title": "Can&#39;t find inerface-file declaration for variable", "body": "<p>I'm trying to shift execution of some code to compile time with GHC 8 and\n<code>template-haskel-2.11</code>. The code looks like this:</p>\n\n<pre><code>myThHelper :: FilePath -&gt; Q Exp\nmyThHelper path =\n  runIO (compileThatFile path) &gt;&gt;= liftData\n</code></pre>\n\n<p>This is a simplified version of that code but it hopefully conveys what I'm\ntrying to do.</p>\n\n<p>Note the\n<a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#v:liftData\" rel=\"noreferrer\"><code>liftData</code></a>\nfunction, it's new in <code>template-haskell-2.11</code> and it promises to \u201clift\u201d into\nexpression any instance of <code>Data</code>. Very cool and it compiles.</p>\n\n<p>However, when I use it like so:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let compiled = $(myThHelper \"/path/to/my/file/foo.txt\")\n  \u2026\n</code></pre>\n\n<p>I'm getting the following error message from the compiler:</p>\n\n<pre><code>\u2022 Can't find interface-file declaration for variable Data.Text.Internal.pack\n    Probable cause: bug in .hi-boot file, or inconsistent .hi file\n    Use -ddump-if-trace to get an idea of which file caused the error\n\u2022 In the first argument of \u2018PName\u2019, namely\n    \u2018Data.Text.Internal.pack ((:) 'f' ((:) 'o' ((:) 'o' [])))\u2019\n  In the first argument of \u2018Template\u2019, namely\n    \u2018PName (Data.Text.Internal.pack ((:) 'f' ((:) 'o' ((:) 'o' []))))\u2019\n  In the expression:\n</code></pre>\n\n<p>etc. Any idea what's going on and how to fix it?</p>\n\n<hr>\n\n<p>I confirmed via experiments that the problem only manifests itself when data type to lift has <code>Text</code> in it. I'm going to open an issue.</p>\n\n<hr>\n\n<p><a href=\"https://github.com/bos/text/issues/156\" rel=\"noreferrer\">And here it is</a>.</p>\n"}, {"tags": ["haskell", "monads", "side-effects"], "comments": [{"owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "edited": false, "score": 1, "creation_date": 1467361093, "post_id": 38140381, "comment_id": 63710887, "body": "hm, what do you expect of us to do? You&#39;ve already figured out you need to learn to deal with Monads, so go and continue to read whatever intro to Haskell you&#39;re currently using!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1467361099, "post_id": 38140381, "comment_id": 63710891, "body": "<code>Int</code> is not the type of a function. It&#39;s just a number."}, {"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1467361335, "post_id": 38140381, "comment_id": 63711013, "body": "I just want to see examples, which show implementation of such behaviour"}, {"owner": {"reputation": 233, "user_id": 3408155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7910903feef10f5a63773ac5d371890?s=128&d=identicon&r=PG", "display_name": "Hoff", "link": "https://stackoverflow.com/users/3408155/hoff"}, "edited": false, "score": 0, "creation_date": 1467797634, "post_id": 38140381, "comment_id": 63863847, "body": "Ok, so if I understand you right you want to see how a random number generator is implemented in haskell under the hood?"}, {"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1467806495, "post_id": 38140381, "comment_id": 63868934, "body": "Yes, as example some simplified version. As I understood, there IO type for implementing side effects"}], "answers": [{"comments": [{"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1467362720, "post_id": 38140830, "comment_id": 63711785, "body": "I know about System.Random. I just want to see some implementation of such behavior (for educational purposes, it can have another side effect)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1467363060, "post_id": 38140830, "comment_id": 63711970, "body": "@\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440\u041b\u044b\u0441\u0435\u043d\u043a\u043e I added an example... I&#39;m not sure I understand what you really want."}, {"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1467363494, "post_id": 38140830, "comment_id": 63712256, "body": "I want to create own monad, which allows to create functions with side effects."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 2, "creation_date": 1467363877, "post_id": 38140830, "comment_id": 63712476, "body": "Look up <code>State</code> if you simply want to read/write variables. Or <code>ST</code>. If you want input/output, you need <code>IO</code> or <code>StateT IO</code>. <code>State</code> and <code>StateT</code> have their implementation available on hackage. <code>IO</code> can not be implemented except by using low-level &quot;unsafe&quot; primitives."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1467363014, "last_edit_date": 1467363014, "creation_date": 1467362470, "answer_id": 38140830, "question_id": 38140381, "link": "https://stackoverflow.com/questions/38140381/how-to-implement-function-with-side-effects/38140830#38140830", "title": "How to implement function with side effects?", "body": "<p>If <code>foo</code> really behaves like some RNG, it must have some monadic type, or take as an additional input the state of the RNG.</p>\n\n<p>Here's an example, using the system RNG (which lives in the IO monad):</p>\n\n<pre><code>import System.Random\n\nfoo :: IO Int\nfoo = randomRIO (1,5)  -- random number between 1 and 5\n\nmain :: IO ()\nmain = do\n  x &lt;- foo\n  y &lt;- foo\n  print $ x /= y\n</code></pre>\n\n<p>In <code>main</code>, we simply call <code>foo</code> twice, binding its results to <code>x,y</code>, which have type <code>Int</code>. Then, we can compare them as usual.</p>\n\n<p>Note that we can not use <code>foo /= foo</code> since <code>foo :: IO Int</code>, an action returning an Int, and we can't compare actions, only basic data like integers. This is why we first execute the actions, and then compare their results.</p>\n\n<p>The <code>main</code> could be written in one line exploiting some more advanced combinators</p>\n\n<pre><code>  main = print =&lt;&lt; ((/=) &lt;$&gt; foo &lt;*&gt; foo)\n  -- or\n  main = print =&lt;&lt; liftA2 (/=) foo foo\n</code></pre>\n\n<p>but I would not focus on these at the beginning.</p>\n\n<hr>\n\n<p>A more general example of a side-effecful computation:</p>\n\n<pre><code>foo :: IORef String -&gt; IO Int\nfoo s = do\n  x &lt;- readIORef s              -- reading a \"variable\"\n  print x                       -- output\n  w &lt;- getLine                  -- input\n  writeIORef s (\"qwerty\" ++ x)  -- writing a variable\n  length &lt;$&gt; readIORef s\n\nmain :: IO ()\nmain = do\n  s &lt;- newIORef \"dummy\"\n  print =&lt;&lt; foo s\n</code></pre>\n"}], "owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1467363014, "creation_date": 1467360963, "last_edit_date": 1495542760, "question_id": 38140381, "link": "https://stackoverflow.com/questions/38140381/how-to-implement-function-with-side-effects", "title": "How to implement function with side effects?", "body": "<p>I am beginner in programming via Haskell language. I am interested at writing function in Haskell, which has side effects like this (for educational purposes, it can have another side effect):</p>\n\n<pre><code>-- function foo behaves like random numbers generator\nfoo :: Int\n{- foo = some magic -}\n-- It can print True or False\nprint $ show (foo /= foo)\n</code></pre>\n\n<p>As I understood, I have to implement some type instance of Monad with such behaviour (like this: IO <a href=\"https://stackoverflow.com/questions/2488646/why-are-side-effects-modeled-as-monads-in-haskell\">Why are side-effects modeled as monads in Haskell?</a>). But I really don't understand how to write simple example of function for this purpose. </p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 1, "creation_date": 1467347885, "post_id": 38136144, "comment_id": 63704924, "body": "Have you looked at <a href=\"https://hackage.haskell.org/package/record\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/record</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467349310, "post_id": 38137293, "comment_id": 63705274, "body": "Ahhh... How I was hoping something like this was in the works. How lovely! Thank you very much. Will wait a day or so before accepting."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 1, "creation_date": 1507510767, "post_id": 38137293, "comment_id": 80224203, "body": "Any idea of how far along this proposal is?"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 5, "last_activity_date": 1467348705, "creation_date": 1467348705, "answer_id": 38137293, "question_id": 38136144, "link": "https://stackoverflow.com/questions/38136144/replace-record-projection-function-with-lenses/38137293#38137293", "title": "Replace record projection function with lenses", "body": "<p>There is a GHC extensions proposal called <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/MagicClasses\" rel=\"noreferrer\">OverloadedRecordFields/MagicClasses</a>. <a href=\"https://phabricator.haskell.org/D1687\" rel=\"noreferrer\">Adam Gundry is working on an active pull request</a>. It, combined with <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/OverloadedLabels\" rel=\"noreferrer\">OverloadedRecordLabels</a>, are intended to address this very problem!</p>\n\n<pre><code>data Foo = Foo { x :: Int, y :: Int }\n\nclass IsLabel (x :: Symbol) a where\n  fromLabel :: Proxy# x -&gt; a\n</code></pre>\n\n<p>With an example datatype like <code>Foo</code>, the subexpression <code>#x</code> in the expression <code>#x (foo :: Foo)</code>  will be magically expanded by the compiler to <code>fromLabel @\"x\" @Foo proxy#</code>. That @ symbol, the type application symbol, is another GHC 8-ism.\n</p>\n\n<p>Unlike <code>x</code>, the behavior of <code>#x</code> can be modified to suit your needs. You might have it be just a regular projection function. With <code>OverloadedLabels</code> enabled, we already have access to a polymorphic projection function <code>getField</code>:</p>\n\n<pre><code>instance HasField name big small =&gt; IsLabel name (big -&gt; small) where\n  fromLabel proxy big = getField proxy big\n</code></pre>\n\n<p><em>Or</em> we could satisfy the constraint with stab-style lenses:</p>\n\n<pre><code>instance ( Functor f\n         , HasField name big small\n         , UpdateField name big big' small') =&gt;\n         IsLabel name ((small -&gt; f small') -&gt; (big -&gt; big')) where\n  fromLabel proxy f big =\n    setField proxy big &lt;$&gt; f (getField proxy big)\n</code></pre>\n\n<p>With such an instance you could immediately start using <code>#x</code> as a lens:</p>\n\n<pre><code>over #x (* 2) (Foo 1008 0) -- evaluates to Foo 2016 0\n</code></pre>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 1, "accepted_answer_id": 38137293, "answer_count": 1, "score": 4, "last_activity_date": 1467348705, "creation_date": 1467340351, "question_id": 38136144, "link": "https://stackoverflow.com/questions/38136144/replace-record-projection-function-with-lenses", "title": "Replace record projection function with lenses", "body": "<p>Almost every time I make a record, I find myself adding <code>makeLenses ''Record</code> (from <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\">lens</a>) immediately afterwards, and I never end up actually using the projection functions that the record gives me. In fact, looking at what <code>makeLenses</code> produces (with the GHC <code>-ddump-splices</code> flag), it looks like not even it uses those projection functions, except to choose a name for the lenses it produces.</p>\n\n<p>Is there some way, either through <code>TemplateHaskell</code>, or through a preprocessor, or frankly any other magic, that I could get record projection functions to be straight up Van Laarhoven lenses instead? </p>\n\n<p>To be clear, that would mean that</p>\n\n<pre><code>data Record a b = Record { x :: a, y :: b }\n</code></pre>\n\n<p>Would generate (with <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Lens.html\" rel=\"nofollow\"><code>type Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t</code></a>)</p>\n\n<pre><code>x :: forall a b c. Lens (Record a b) (Record c b) a c\nx f (Record _x _y) = fmap (\\x' -&gt; Record x' _y) (f _x)\n\ny :: forall a b c. Lens (Record a b) (Record a c) b c\ny f (Record _x _y) = fmap (\\ y' -&gt; Record _x y') (f _y)\n</code></pre>\n\n<p>Instead of</p>\n\n<pre><code>x :: forall a b. Record a b -&gt; a\nx (Record _x _y) = _x\n\ny :: forall a b. Record a b -&gt; b\ny (Record _x _y) = _y\n</code></pre>\n\n<p>It would not only get rid of the boilerplate <code>makeLenses</code> but also free up the namespace (since the projection functions wouldn't ever be defined). </p>\n\n<p>This is such a minor thing, but since it's attached to all my records, and records aren't such a rare thing, it is really starting to get on my nerves...</p>\n"}, {"tags": ["windows", "haskell", "cabal-install", "haskell-platform"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1478642664, "creation_date": 1478642664, "answer_id": 40497219, "question_id": 38134118, "link": "https://stackoverflow.com/questions/38134118/ld-exe-cant-find-libraries-during-cabal-install-haskell-platform/40497219#40497219", "title": "ld.exe can&#39;t find libraries during cabal-install (Haskell Platform)", "body": "<p>The description seems to correspond to a corrupted package database.</p>\n\n<p><code>ghc-pkg check</code> can help see if this is the case, and <code>ghc-pkg recache</code> can potentially help fix things. If this fails, the local package database directory, which is one of the two listed with <code>ghc-pkg list</code>, can just be deleted.</p>\n"}], "owner": {"reputation": 2139, "user_id": 465100, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/debe4d3217980e495cf1f15e7e4b4c9f?s=128&d=identicon&r=PG", "display_name": "Artem Pelenitsyn", "link": "https://stackoverflow.com/users/465100/artem-pelenitsyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 294, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1478642664, "creation_date": 1467324938, "last_edit_date": 1467348030, "question_id": 38134118, "link": "https://stackoverflow.com/questions/38134118/ld-exe-cant-find-libraries-during-cabal-install-haskell-platform", "title": "ld.exe can&#39;t find libraries during cabal-install (Haskell Platform)", "body": "<p>I have <code>Win 10 @ x64</code> computer. I installed Haskell Platform <code>(HP) 8.0.1</code>, but then realized that the package I need have troubles when building with <code>GHC 8</code>. So I uninstalled <code>HP 8</code> and installed <code>HP 7.10.3</code> instead. The <code>config</code> file in cabal directory remained from 8-installation, so I removed it manually (as cabal from <code>7.10.3</code> couldn't parse it).</p>\n\n<p>Now I have problem cabal-installing any package which implies building executable file. See example of building <code>cheapskate</code> below. I had very similar messages when building <code>yaml</code>, so I guess there is nothing specific to package itself. Just as I say the problem with any package installing executable.</p>\n\n<pre><code>Linking dist\\build\\cheapskate\\cheapskate.exe ...\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSxss-sanitize-0.3.5.7-HScF09TDCPn9q2HNPyr3jY\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSutf8-string-1.0.1.1-L8eKHa7Iv9q7FVKUYW6u4b\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHStagsoup-0.14-LkUWVoqDDljLCcz7bB5oLY\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHScss-text-0.1.2.1-EIrTNZIusX93HMVzZkp9UD\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSuniplate-1.6.12-DgRHum07M0vBMdvTsdo5gV\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdata-default-0.7.1.1-3MPp9dYgnh90NQDAZx5NXx\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdata-default-instances-old-locale-0.0.1-K6L8Um6XgJK7vZZFbrTNny\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdata-default-instances-dlist-0.0.1-H5f5Qu8KYxpJlVdwCzbtAY\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdlist-0.7.1.2-AO7XAasbAeyL0XLKeq1Aui\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdata-default-instances-containers-0.0.1-Lel7wFldMDA1Zs74nVWKYF\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSdata-default-class-0.1.2.0-4JL8mCHvyuoKtdHwhiuMnt\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSblaze-html-0.8.1.1-89cVIlB12sFJRMi1lQAdfn\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSblaze-markup-0.7.0.3-7gHcQviMQE9GGsKcO1ZT0j\nC:/Program Files/Haskell Platform/7.10.3/mingw/bin/ld.exe: cannot find -lHSblaze-builder-0.4.0.2-4HkRnVv5mkB1jlZDT6uaGq\ncollect2.exe: error: ld returned 1 exit status\ncabal: Error: some packages failed to install:\ncheapskate-0.1.0.5 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "period"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467329009, "post_id": 38133956, "comment_id": 63700508, "body": "Either main loopWhileTrue a little more complex, keeping track of the last time a frame was processed, or pass an MVar to getAndProcessFrame then to <code>processFrame</code> that contains the last time.  Check the current time against this last time at each frame and conditionally continue or exit early."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1467335388, "post_id": 38133956, "comment_id": 63702127, "body": "The most obvious code structure improvement would be to make <code>loopWhileTrue</code> a top-level binding instead of burying it in a <code>case</code> expression inside a <code>do</code> block. Also, you can write it <code>loopWhileTrue f = do { result &lt;- f; when result $ loopWhileTrue f }</code>, or even <code>loopWhileTrue f = fix $ \\m -&gt; do { result &lt;- f; when result m }</code>. These will give type signatures <code>loopWhileTrue :: Monad m =&gt; m Bool -&gt; m ()</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467335875, "post_id": 38133956, "comment_id": 63702228, "body": "Is there no way of sleeping the thread for a minute? (in <code>loopWhileTrue</code>)"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1467338349, "post_id": 38133956, "comment_id": 63702697, "body": "@Alec It looks like OP wants to continue receiving frames while waiting (but discarding them unprocessed)."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1467339286, "post_id": 38133956, "comment_id": 63702893, "body": "@AleXoundOS Cleaning up your code is an excellent question for Code Review."}, {"owner": {"reputation": 64429, "user_id": 1188513, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wNdZG.jpg?s=128&g=1", "display_name": "Mathieu Guindon", "link": "https://stackoverflow.com/users/1188513/mathieu-guindon"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1467339660, "post_id": 38133956, "comment_id": 63702981, "body": "@RowanBlush agreed! it&#39;s not very clear from the narrative whether the code currently works as intended though. or does it?"}], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 3, "last_activity_date": 1467339119, "creation_date": 1467339119, "answer_id": 38135953, "question_id": 38133956, "link": "https://stackoverflow.com/questions/38133956/haskell-execute-io-action-only-if-a-certain-time-has-passed-since-its-last-exe/38135953#38135953", "title": "Haskell: Execute IO action only if a certain time has passed since it&#39;s last execution", "body": "<p>Grab a timestamp when the processing step completes with <a href=\"http://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Clock.html#v:getCurrentTime\" rel=\"nofollow\"><code>getCurrentTime</code></a> and thread it back through your loop, then <code>timeCondition</code> is just some math on time values.</p>\n\n<pre><code>import Data.Time.Clock\n\n-- | Returns `True` when 60 seconds have passed from the given value.\n-- Not respectful of leap seconds.\nisAMinuteSince :: UTCTime -&gt; IO Bool\nisAMinuteSince timestamp = do\n    now &lt;- getCurrentTime\n    return $ diffUTCTime now timestamp &gt;= 60\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 1663197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7c055b7bb6a0bbbbd3e71fd90e1a346?s=128&d=identicon&r=PG", "display_name": "AleXoundOS", "link": "https://stackoverflow.com/users/1663197/alexoundos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1467751802, "creation_date": 1467324089, "last_edit_date": 1467751802, "question_id": 38133956, "link": "https://stackoverflow.com/questions/38133956/haskell-execute-io-action-only-if-a-certain-time-has-passed-since-its-last-exe", "title": "Haskell: Execute IO action only if a certain time has passed since it&#39;s last execution", "body": "<p>I have a media stream with associated named pipe to it. The program reads data from pipe and processes frames with <code>processFrame</code>.</p>\n\n<pre><code>module Main where\nimport Codec.FFmpeg\nimport Codec.FFmpeg.Decode\nimport Control.Monad.Except (runExceptT)\n\nmain :: IO ()\nmain = do\n    initFFmpeg\n    -- get IO reader\n    eResult &lt;- runExceptT $ frameReader avPixFmtRgb24 (File \"pipe\")\n    case eResult of\n        Left err -&gt; do print \"couldn't establish frameReader\\n\"\n                       print err\n        Right (getMaybeFrame, cleanup) -&gt; do\n            -- read and process frames until av_read_frame returns no frames\n            loopWhileTrue (getAndProcessFrame getMaybeFrame)\n            cleanup\n          where\n            loopWhileTrue f = do result &lt;- f\n                                 case result of\n                                    True -&gt; loopWhileTrue f\n                                    False -&gt; return ()\n      where\n        getAndProcessFrame gMF = do\n            maybeFrame &lt;- gMF\n            case maybeFrame of\n                Just frame -&gt; do tc &lt;- timeCondition\n                                 if tc\n                                 then do processFrame frame\n                                 else return ()\n                                 return True\n                Nothing -&gt; return False\n        timeCondition = return True\n\nprocessFrame :: AVFrame -&gt; IO ()\nprocessFrame frame = do isKeyFrame &lt;- getKeyFrame frame\n                        if isKeyFrame\n                        then do pts &lt;- getPts frame\n                                print pts\n                        else return ()\n</code></pre>\n\n<p>I need to perform <code>processFrame</code> only once in a minute, bypassing all other frames.</p>\n\n<p>This code does not have a proper time condition, only a <code>timeCondition</code> stub.\nI planned to write a proper <code>timeCondition</code> function which returns <code>True</code> when a certain time has passed since last <code>processFrame</code>, otherwise <code>False</code>. But this looks too imperative and it's not clear how to use Monads/MVars for this. What's the right way of designing such a program in Haskell?</p>\n"}, {"tags": ["haskell", "testing", "optionparser"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1467316244, "post_id": 38131871, "comment_id": 63695239, "body": "There are a gazillion command-line option libraries for Haskell, so you really should tell us what library you are using and include your imports."}, {"owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467319473, "post_id": 38131871, "comment_id": 63697046, "body": "Apologies, I&#39;ve updated my question."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467320095, "post_id": 38131871, "comment_id": 63697348, "body": "@TresiaBurger  So....  are you using <code>http:&#47;&#47;hackage.haskell.org&#47;package&#47;optparse-applicative</code> then?"}, {"owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "edited": false, "score": 0, "creation_date": 1467320309, "post_id": 38131871, "comment_id": 63697461, "body": "Yes that is the one I&#39;m using."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1467329721, "creation_date": 1467329721, "answer_id": 38134872, "question_id": 38131871, "link": "https://stackoverflow.com/questions/38131871/haskell-generate-missing-argument-error-message-from-either-data-type/38134872#38134872", "title": "Haskell - generate missing argument error message from either data type", "body": "<p>If you look at the source code repository for <code>optparse-applicative</code> <a href=\"https://github.com/pcapriotti/optparse-applicative\" rel=\"nofollow\">(link)</a> you'll see that it itself has a test suite in the <code>tests</code> subdirectory.</p>\n\n<p>A routine which looks like it does a lot like what you want is <a href=\"https://github.com/pcapriotti/optparse-applicative/blob/cac69ccf98f3ed2f9d2f30ec97daa226082920a5/tests/Tests.hs#L66\" rel=\"nofollow\"><code>checkHelpTextWith</code></a> in the file <code>tests/Test.hs</code>:</p>\n\n<pre><code>checkHelpTextWith :: Show a =&gt; ExitCode -&gt; ParserPrefs -&gt; String\n                  -&gt; ParserInfo a -&gt; [String] -&gt; Assertion\ncheckHelpTextWith ecode pprefs name p args = do\n  let result = execParserPure pprefs p args\n  assertError result $ \\failure -&gt; do\n    expected &lt;- readFile $ name ++ \".err.txt\"\n    let (msg, code) = renderFailure failure name\n    expected @=? msg ++ \"\\n\"\n    ecode @=? code\n</code></pre>\n\n<p>This function expects an option parser to fail and compares the error message with the contents of a file.</p>\n\n<p>The main functions of interest are:</p>\n\n<pre><code>execParserPure :: ParserPrefs -&gt; ParserInfo a -&gt; [String] -&gt; ParserResult a\n\nrenderFailure :: ParserFailure ParserHelp -&gt; String -&gt; (String, ExitCode)\n</code></pre>\n\n<p>The String returned by <code>renderFailure</code> is the error message.</p>\n"}], "owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 38134872, "answer_count": 1, "score": 1, "last_activity_date": 1467329721, "creation_date": 1467315561, "last_edit_date": 1467319412, "question_id": 38131871, "link": "https://stackoverflow.com/questions/38131871/haskell-generate-missing-argument-error-message-from-either-data-type", "title": "Haskell - generate missing argument error message from either data type", "body": "<p>I have the following piece of code;</p>\n\n<pre><code>module Billing.Options\n  (\n      GlobalOpts(..)\n    , globalOptsParser\n    , parseDb\n    , parseSql\n  ) where\n\nimport Options.Applicative\nimport Options.Applicative.Simple\nimport Options.Applicative.Types\nimport System.FilePath.Posix\nimport Text.Regex.PCRE\n\n-- ------------------------------------------------------------\n\ndata GlobalOpts = GlobalOpts\n  {\n    optDb          :: String,\n    optSql         :: String\n  } deriving Show\n\n-- ------------------------------------------------------------\n\nglobalOptsParser :: Parser GlobalOpts\nglobalOptsParser = GlobalOpts\n  &lt;$&gt; option (parseDb =&lt;&lt; readerAsk)\n    (   long \"db\"\n    &lt;&gt;  short 'd'\n    &lt;&gt;  metavar \"&lt;DB name&gt;\"\n    &lt;&gt;  help \"dmt | report\"\n    )\n  &lt;*&gt; option parseSql\n    (   long \"sql\"\n    &lt;&gt;  metavar \"&lt;SQL SELECT statement&gt;\"\n    &lt;&gt;  help \"sql select statement to use in order to generate JSON config file\"\n    )\n-- ------------------------------------------------------------\n\nmatches :: String -&gt; String -&gt; Bool\nmatches = (=~)\n\n-- ------------------------------------------------------------\n\nparseDb :: String -&gt; ReadM String\nparseDb val = do\n    if not (elem val [\"dmt\", \"report\"])\n        then readerError $ \"Unknown DB, '\" ++ val ++ \"'\"\n        else return val\n\n-- ------------------------------------------------------------\n\nparseSql :: ReadM String\nparseSql = do\n    val &lt;- readerAsk\n    if not (val `matches` \"(?i)select .+ from .+\")\n        then readerError $ \"Please provide a valid SQL SELECT statement\"\n        else return val\n\n-- [EOF]\n</code></pre>\n\n<p>I'm testing my argument parser with the following code;</p>\n\n<pre><code>error' = let mp = runParser AllowOpts globalOptsParser [\"-d\", \"billing\"]\n          opts = ParserPrefs \"suffix\" False False False 80\n      in fst $ runP mp opts\n</code></pre>\n\n<p>The required arguments are,</p>\n\n<pre><code>  -d &lt;DB name&gt;\n  --sql &lt;SQL SELECT statement&gt;\n</code></pre>\n\n<p>I want to test that I get the error message,</p>\n\n<pre><code>Missing: --sql &lt;SQL SELECT statement&gt;\n</code></pre>\n\n<p>when I only specify \"-d billing\".</p>\n\n<p>The above test code gives the following output if I print the result,</p>\n\n<pre><code>Left (MissingError (MultNode [MultNode [MultNode [AltNode [Leaf (Chunk {unChunk = Just --sql &lt;SQL SELECT statement&gt;})]]]]))\n</code></pre>\n\n<p>Is there a way to generate the expected error message (String) from the above result (Either data type)?  Does Haskell provide an obvious function to use for this purpose as I cannot find something in the documentation and googling for examples also didn't produce any answers.</p>\n"}, {"tags": ["haskell", "ghc", "typeclass"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467312362, "post_id": 38130985, "comment_id": 63693159, "body": "You can with the new explicit type application extension, more details <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ExplicitTypeApplication\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467312851, "post_id": 38130985, "comment_id": 63693437, "body": "@pdexter Unless I\u2019m missing something, that seems unrelated to me\u2014it seems mostly syntactic and about working with values at the type level exclusively, while this question is about passing a dynamic runtime value as a typeclass dictionary. However, I could be misinterpreting the link, in which case an answer demonstrating it would be much appreciated!"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1467320380, "post_id": 38131940, "comment_id": 63697491, "body": "Link-only answers are discouraged on StackOverflow. Please include the interesting content here."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1467323355, "post_id": 38131940, "comment_id": 63698708, "body": "This is neat, but ultimately it doesn\u2019t seem like it really cuts boilerplate by all that much... in fact, it seems to complicate it considerably. <a href=\"https://gist.github.com/lexi-lambda/71ee8ea84127d8318a121c6acf49d331\" rel=\"nofollow noreferrer\">Compare these two implementations</a> for the difference. Of course, it looks like this approach can work a lot better for non-monadic typeclasses, and the performance bit mentioned in the post you linked is interesting. Otherwise, it doesn\u2019t seem like you gain much here... is that accurate?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1467323443, "post_id": 38131940, "comment_id": 63698739, "body": "Also, I should probably mention that I found reading <a href=\"http://okmij.org/ftp/Haskell/tr-15-04.pdf\" rel=\"nofollow noreferrer\">Functional Pearl: Implicit Configurations</a>, the paper that inspired the reflection package, to be very approachable and helpful to groking the concepts at a higher level than sifting through the Core output."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1467356626, "post_id": 38131940, "comment_id": 63708362, "body": "@AlexisKing I think the link is the best we can do and it gives us a lot. Two classes altogether for all <code>* -&gt; Constraint</code> classes and two instances for each class is pretty good, and <code>using</code> does exactly what you asked for."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 6, "last_activity_date": 1467315846, "creation_date": 1467315846, "answer_id": 38131940, "question_id": 38130985, "link": "https://stackoverflow.com/questions/38130985/can-i-pass-a-typeclass-dictionary-to-a-function-explicitly/38131940#38131940", "title": "Can I pass a typeclass dictionary to a function explicitly?", "body": "<p>There is an article on this at the School of Haskell:</p>\n\n<p><a href=\"https://www.schoolofhaskell.com/user/thoughtpolice/using-reflection\">Reflecting values to types and back</a></p>\n\n<p>See the section towards the end entitled <a href=\"https://www.schoolofhaskell.com/user/thoughtpolice/using-reflection#dynamically-constructing-type-class-instances\">Dynamically constructing type-class instances</a> and <a href=\"https://www.schoolofhaskell.com/user/thoughtpolice/using-reflection#but-what-about-manual-dictionaries-\">But what about manual dictionaries?</a></p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1467315846, "creation_date": 1467312243, "question_id": 38130985, "link": "https://stackoverflow.com/questions/38130985/can-i-pass-a-typeclass-dictionary-to-a-function-explicitly", "title": "Can I pass a typeclass dictionary to a function explicitly?", "body": "<p>Let\u2019s say I have some typeclass:</p>\n\n<pre><code>data Foo = Foo deriving (Show)\n\nclass Monad m =&gt; MonadFoo m where\n  getFoo :: m Foo\n</code></pre>\n\n<p>Since GHC implements typeclasses via dictionary passing (uses of <code>SPECIALIZE</code> notwithstanding), it effectively transforms <code>getFoo</code> into something like the following under the hood:</p>\n\n<pre><code>data MonadFooDict m = MonadFooDict { getFoo :: m Foo }\n</code></pre>\n\n<p>...and it inserts an additional argument at the beginning of calls to <code>getFoo</code> that threads the dictionary around.</p>\n\n<p>Sometimes, I might want to pick an instance dynamically, so passing a dictionary myself might be desirable. I can simulate this myself by creating an instance that will thread the dictionary around for me.</p>\n\n<pre><code>newtype DynamicMonadFoo a = DynamicMonadFoo\n    { runFoo :: MonadFooDict DynamicMonadFoo -&gt; a }\n  deriving ( Functor, Applicative, Monad\n           , MonadReader (MonadFooDict DynamicMonadFoo) )\n\ninstance MonadFoo DynamicMonadFoo where\n  getFoo = join $ asks _getFoo\n</code></pre>\n\n<p>Now, given some function with a <code>MonadFoo</code> constraint, I can use the <code>runFoo</code> function to pass it an explicit typeclass dictionary:</p>\n\n<pre><code>showCurrentFoo :: MonadFoo m =&gt; m String\nshowCurrentFoo = do\n  foo &lt;- getFoo\n  return (\"current foo: \" ++ show foo)\n\nghci&gt; runFoo showCurrentFoo MonadFooDict { _getFoo = return Foo }\n\"current foo: Foo\"\n</code></pre>\n\n<p>This is really cool, but it seems like such a simple task that GHC might expose some sort of library to do this without all the boilerplate (and ideally in a way that would work more nicely with non-monadic typeclasses). Given that GHC has some \u201creflection-esque\u201d capabilities like <code>Data.Typeable</code>, this doesn\u2019t seem outside the realm of possibility, but I\u2019m not sure if it actually exists in some form.</p>\n\n<p>Do any existing built-ins or other libraries allow doing this more automatically?</p>\n"}, {"tags": ["windows", "haskell", "installation", "msys2", "hmatrix"], "comments": [{"owner": {"reputation": 4219, "user_id": 973603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b60409c45d466d0a8f26bcd9b45e7d?s=128&d=identicon&r=PG", "display_name": "Alex Vorobiev", "link": "https://stackoverflow.com/users/973603/alex-vorobiev"}, "edited": false, "score": 0, "creation_date": 1467317689, "post_id": 38130590, "comment_id": 63696088, "body": "dll is not enough to be able to compile with the library. You need development files as well - c++ headers and .lib files. See here <a href=\"http://icl.cs.utk.edu/lapack-for-windows/lapack/#libraries_mingw\" rel=\"nofollow noreferrer\">icl.cs.utk.edu/lapack-for-windows/lapack/#libraries_mingw</a>"}, {"owner": {"reputation": 1, "user_id": 6534165, "user_type": "registered", "profile_image": "https://graph.facebook.com/1213944045282603/picture?type=large", "display_name": "Christian Gorski", "link": "https://stackoverflow.com/users/6534165/christian-gorski"}, "reply_to_user": {"reputation": 4219, "user_id": 973603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b60409c45d466d0a8f26bcd9b45e7d?s=128&d=identicon&r=PG", "display_name": "Alex Vorobiev", "link": "https://stackoverflow.com/users/973603/alex-vorobiev"}, "edited": false, "score": 0, "creation_date": 1467731915, "post_id": 38130590, "comment_id": 63838220, "body": "I tried downloading files and proceeding as detailed above in my edit, but I get the same error."}], "answers": [{"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1470473063, "creation_date": 1470473063, "answer_id": 38802321, "question_id": 38130590, "link": "https://stackoverflow.com/questions/38130590/trouble-installing-hmatrix-through-msys2-on-windows-10/38802321#38802321", "title": "Trouble installing hmatrix through MSYS2 on Windows 10", "body": "<p>I'm a bit suspicious about the</p>\n\n<pre><code> if os(windows)\n    if flag(openblas)\n        extra-libraries:    libopenblas\n</code></pre>\n\n<p>in the cabal file, could you unpack it and remove the \"lib\" part? If that doesn't work please post a log with -v3 output. I've seen quite a few people with troubles installing this package. So could you also open a ticket on the GHC bug tracker if this doesn't work (and CC me \"Phyx-\")?</p>\n\n<p>Secondly, you never said which version of GHC you're using. 8.0.1 should have far less trouble (and won't need the hack to get it working in GHCi) since the runtime linker has been overhauled and should be much better on Windows. 8.0.2 will likely include the new import libraries support as well.</p>\n"}], "owner": {"reputation": 1, "user_id": 6534165, "user_type": "registered", "profile_image": "https://graph.facebook.com/1213944045282603/picture?type=large", "display_name": "Christian Gorski", "link": "https://stackoverflow.com/users/6534165/christian-gorski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470473063, "creation_date": 1467310749, "last_edit_date": 1467696168, "question_id": 38130590, "link": "https://stackoverflow.com/questions/38130590/trouble-installing-hmatrix-through-msys2-on-windows-10", "title": "Trouble installing hmatrix through MSYS2 on Windows 10", "body": "<p>I've been trying to install hmatrix on my (64-bit) Windows 10 computer; after searching through and trying many possible solutions (including the instructions under \"Windows\" and \"Alternative Windows Build\" given <a href=\"https://github.com/albertoruiz/hmatrix/blob/master/INSTALL.md\" rel=\"nofollow\">here</a>), I decided to pursue the course of action given on this <a href=\"https://www.reddit.com/r/haskell/comments/3y7ysk/installing_hmatrix_in_windows/cybar0k\" rel=\"nofollow\">Reddit thread</a>.</p>\n\n<p>However, when I type in the command</p>\n\n<pre><code>cabal install hmatrix -fopenblas --extra-lib-dir=${c:\\msys64\\mingw64\\bin} --extra-include-dir=${c:\\msys64\\mingw64\\include}\n</code></pre>\n\n<p>into the MSYS2 shell, the following log is given:</p>\n\n<pre><code>Resolving dependencies... \nConfiguring hmatrix-0.17.0.2...\nFailed to install hmatrix-0.17.0.2\nBuild log ( C:\\Users\\Christian\\AppData\\Roaming\\cabal\\logs\\hmatrix-0.17.0.2.log ):\nConfiguring hmatrix-0.17.0.2...\ncabal.exe: Missing dependency on a foreign library:\n* Missing C library: libopenblas\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.\ncabal: Leaving directory 'C:\\msys64\\tmp\\cabal-tmp-4244\\hmatrix-0.17.0.2'\ncabal.exe: Error: some packages failed to install:\nhmatrix-0.17.0.2 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>However, when I check the directory <code>c:\\msys64\\mingw64\\bin</code>, I see that <code>libopenblas.dll</code> is right there; I don't know why cabal can't seem to find it.</p>\n\n<p>Any insight into why this is not working or what to do?</p>\n\n<p><strong>UPDATE:</strong>\nThe files <code>libopenblas.dll.a</code> and <code>libopenblas.a</code> are in the directory <code>c:\\msys64\\mingw64\\lib</code>. Is it possible I need to somehow include this directory as well? (If I do, how would I do that?)</p>\n\n<p>I also downloaded the files in Alex Vorobiev's comment below and put them in <code>c:\\msys64\\mingw64\\bin</code> if they are .dlls or <code>c:\\msys64\\mingw64\\lib</code> if they are .libs. The header files were already contained in <code>c:\\msys64\\include\\openblas</code>.</p>\n\n<p>I tried several variations on the command in the original post after making these changes, including switching <code>\\bin</code> with <code>\\lib</code> and switching <code>\\include</code> with <code>\\include\\openblas</code>, but all of them still give the same error.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1467308064, "creation_date": 1467308064, "answer_id": 38129844, "question_id": 38129485, "link": "https://stackoverflow.com/questions/38129485/scoped-type-variables-in-typeclass-methods-vs-standalone-functions/38129844#38129844", "title": "Scoped type variables in typeclass methods vs. standalone functions", "body": "<p><code>ScopedTypeVariables</code> brings type variables in instance heads into scope in the instance bodies without an explicit <code>forall</code>. That doesn't happen for type signatures; instead you must use <code>forall</code> to bring <code>p</code> and <code>k</code> into scope in the definition of <code>showMe</code>.</p>\n"}], "owner": {"reputation": 9429, "user_id": 1177991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b0990b7faeb18a884412bed7e0b3b422?s=128&d=identicon&r=PG", "display_name": "Eugene Zhulenev", "link": "https://stackoverflow.com/users/1177991/eugene-zhulenev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 38129844, "answer_count": 1, "score": 0, "last_activity_date": 1467451218, "creation_date": 1467306762, "last_edit_date": 1467451218, "question_id": 38129485, "link": "https://stackoverflow.com/questions/38129485/scoped-type-variables-in-typeclass-methods-vs-standalone-functions", "title": "Scoped type variables in typeclass methods vs. standalone functions", "body": "<p>Here is short example. I wonder why in TypeClass example I don't have to explicitly say <code>forall</code> while in function definition without <code>forall</code> it fails to compile with:</p>\n\n<pre><code>Couldn't match kind \u2018Nat\u2019 with \u2018*\u2019\n    When matching types\n      proxy0 :: Nat -&gt; *\n      Proxy :: * -&gt; *\n    Expected type: proxy0 n0\n      Actual type: Proxy p0\n    In the first argument of \u2018natVal\u2019, namely \u2018(Proxy :: Proxy p)\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018natVal (Proxy :: Proxy p)\u2019\n    In the first argument of \u2018(++)\u2019, namely\n      \u2018(show $ natVal (Proxy :: Proxy p))\u2019\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE RankNTypes          #-}\n{-# LANGUAGE RoleAnnotations     #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators       #-}\n{-# LANGUAGE TypeFamilies        #-}\n\ndata Container (p :: Nat) (k :: Nat) = Container { first :: [Int], second :: [Int] }\n\ninstance (KnownNat p, KnownNat k) =&gt; Show (Container p k) where\n  show c  = \"Container \" ++ (show $ natVal (Proxy :: Proxy p)) ++ \n                     \" \" ++ (show $ natVal (Proxy :: Proxy k))\n\nshowMe :: forall p k . (KnownNat p, KnownNat k) =&gt; Container p k -&gt; String\nshowMe c = \"Container \" ++ (show $ natVal (Proxy :: Proxy p)) ++ \n                    \" \" ++ (show $ natVal (Proxy :: Proxy k))\n</code></pre>\n"}, {"tags": ["haskell", "hunit"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1467307908, "creation_date": 1467307908, "answer_id": 38129805, "question_id": 38129362, "link": "https://stackoverflow.com/questions/38129362/run-hunit-without-output/38129805#38129805", "title": "Run HUnit without output", "body": "<p>This <code>PutText</code> doesn't produce any output:</p>\n\n<pre><code>foo = runTestText (PutText go 0) test1\n  where go :: String -&gt; Bool -&gt; Int -&gt; IO Int\n        go s b i = return 0\n</code></pre>\n\n<p>Here <code>foo</code> has type <code>IO (Counts, Int)</code>, so you get the counts with just:</p>\n\n<pre><code>do (counts, _) &lt;- foo\n   ...\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 5677970, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b5a841ee9dc5580c22731c5269424a4?s=128&d=identicon&r=PG&f=1", "display_name": "Arne", "link": "https://stackoverflow.com/users/5677970/arne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 38129805, "answer_count": 1, "score": 0, "last_activity_date": 1467307908, "creation_date": 1467306280, "question_id": 38129362, "link": "https://stackoverflow.com/questions/38129362/run-hunit-without-output", "title": "Run HUnit without output", "body": "<p>I have a Test:</p>\n\n<pre><code>test1 = TestCase (assertEqual \"Bla\" 2 (add1 1))\n</code></pre>\n\n<p>And want to run it in another Haskell programm without automatic I/O output which </p>\n\n<pre><code>runTestTT test1\n</code></pre>\n\n<p>would create. I tried</p>\n\n<pre><code>runTestText (putTextToHandle stderr False) test1 \n</code></pre>\n\n<p>but this will still create output. Is there a way (maybe another Handle instead of stderr/stdout) to stop the test from creating output?</p>\n\n<p>I would like to just get the IO Counts to use them at another place.</p>\n"}, {"tags": ["c#", "json", "haskell", "dll"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467280117, "post_id": 38118710, "comment_id": 63671108, "body": "it probably would be ok but probably just as slow as doing the shiny new <i>microservice</i>  thing (what I&#39;m trying to say: if it&#39;s not about speed and you are ok with microservices then it&#39;s probably easier to provide a REST service from haskell and consume this in .net/C# - for cases like this it&#39;s probably best to just translate it into C#, a bit more complex microservices are fine IMO)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467284404, "post_id": 38118710, "comment_id": 63674083, "body": "The FFI lets you connect Haskell with the C ABI. Why C? Because it&#39;s one of the most basic ABI, with basic types, and which is used by many languages as their own &quot;native&quot; interface / FFI. So, you can&#39;t really move complex types from Haskell to C#, you have to marshal them into C first, writing custom bridges Hs&lt;-&gt;C&lt;-&gt;C#. For Haskell, see tools like c2hs which can help you in writing the marshalling code. Also see <a href=\"https://wiki.haskell.org/GHC/Using_the_FFI\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/Using_the_FFI</a>"}], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467308746, "post_id": 38122873, "comment_id": 63691182, "body": "Did you already try &quot;call-haskell-from-anything&quot; by yourself? Because i can&#39;t install it with cabal on Windows. I commented this in issue #13 (<a href=\"https://github.com/nh2/call-haskell-from-anything/issues/13\" rel=\"nofollow noreferrer\">github.com/nh2/call-haskell-from-anything/issues/13</a>) and issue #15 (<a href=\"https://github.com/nh2/call-haskell-from-anything/issues/15\" rel=\"nofollow noreferrer\">github.com/nh2/call-haskell-from-anything/issues/15</a>)."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 1, "creation_date": 1467313238, "post_id": 38122873, "comment_id": 63693688, "body": "I haven&#39;t tried it on Windows. I highly recommend you use stack on Windows though."}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467313836, "post_id": 38122873, "comment_id": 63693969, "body": "What do you mean with &quot;stack on Windows&quot;?"}], "tags": [], "owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "is_accepted": false, "score": 2, "last_activity_date": 1467289067, "creation_date": 1467289067, "answer_id": 38122873, "question_id": 38118710, "link": "https://stackoverflow.com/questions/38118710/communication-between-c-and-haskell/38122873#38122873", "title": "Communication between C# and Haskell", "body": "<p>The most <em>efficient</em> way is to create a bridge between Haskell and C# using the C FFI. That's going to be a lot of work.</p>\n\n<p>Another way is to use a common serialization protocol like MessagePack. Here's a Haskell library that makes it very easy to communicate with other languages via MessagePack: <a href=\"https://github.com/nh2/call-haskell-from-anything\" rel=\"nofollow\">https://github.com/nh2/call-haskell-from-anything</a></p>\n\n<p>Obviously this technique has a high \"calling\" overhead, but it will be much faster than using a REST API and going through a network stack (which of course is another option). As long as the calling overhead is not your bottleneck, then this is a perfectly reasonable method.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1467296814, "creation_date": 1467296814, "answer_id": 38126101, "question_id": 38118710, "link": "https://stackoverflow.com/questions/38118710/communication-between-c-and-haskell/38126101#38126101", "title": "Communication between C# and Haskell", "body": "<p>Your options here are:</p>\n\n<ul>\n<li><p>Manually convert all your C# / Haskell structures to/from plain C structures. (High performance, complex to write, hard to debug).</p></li>\n<li><p>Manually serialise / deserialise your C# / Haskell structures as JSON / XML / YAML / CSV / whatever. (Lower performance, drastically easier to debug.)</p></li>\n<li><p>For every data structure, manually write and expose functions that know how to fetch trivial data out of it. (E.g., if you have a Haskell <code>Map</code>, export functions for fetching one key at a time, in a way trivial enough for C to understand, and then wrap that from the C# side.)</p></li>\n</ul>\n\n<p>AFAIK, there's no way to \"directly\" or \"automatically\" make C# understand the layout of Haskell objects, or vice versa.</p>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1467296814, "creation_date": 1467278058, "question_id": 38118710, "link": "https://stackoverflow.com/questions/38118710/communication-between-c-and-haskell", "title": "Communication between C# and Haskell", "body": "<p>I have this Haskell Code:</p>\n\n<pre><code>module RectangleMover where\n\ndata Point = Point Int Int deriving (Show)\nmovePoint :: Point -&gt; Int -&gt; Int -&gt; Point\nmovePoint (Point x y) dx dy = Point (x + dx) (y + dy)\n\ndata Rectangle = Rectangle { corner :: Point, width :: Int, height :: Int } deriving (Show)\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {corner=c}) dx dy = r { corner = movePoint c dx dy }\n\np = Point 1 2\nhsRec = Rectangle p 10 20\n</code></pre>\n\n<p>The equivalent C# code for this would be: </p>\n\n<pre><code>class Point\n{\n    private int x;\n\n    private int y;\n\n    public Point(int x, int y)\n    {\n        this.x = x;\n        this.y = y;\n    }\n\n    public void Move(int dx, int dy)\n    {\n        this.x += dx;\n        this.y += dy;\n    }\n}\n\nclass Rectangle\n{\n    private Point point;\n\n    private int width;\n\n    private int height;\n\n    public Rectangle(Point p, int width, int height)\n    {\n        this.point = p;\n        this.width = width;\n        this.height = height;\n    }\n\n    public void Move(int dx, int dy)\n    {\n        this.point.Move(dx, dy);\n    }\n}\n\nPoint p = new Point(1,2);\nRectangle csRec = new Rectangle(p, 10, 20);\n</code></pre>\n\n<p>My question now is how to pass the \"instance\" hsRec Haskell to C# and the csRec from C# to Haskell. The common way in this case would be to create a DLL from Haskell code with the FFI and call this DLL from C#. Also the other way round, creating a DLL from C# and call this DLL from Haskell. </p>\n\n<p>To export from Haskell here is a simple example with integer:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Add () where\n\nimport Foreign.C.Types\n\nadd :: CInt -&gt; CInt -&gt; CInt\nadd x y = x + y\n\nforeign export ccall add :: CInt -&gt; CInt -&gt; CInt\n</code></pre>\n\n<p>But how is it possible to pass more complex types between these languages? In this case passing an object of type rectangle.\nIs it maybe possible to convert an object to a JSON or XML string and pass it over to the other language?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 1, "last_activity_date": 1468014788, "creation_date": 1468014788, "answer_id": 38275883, "question_id": 38114837, "link": "https://stackoverflow.com/questions/38114837/yesod-static-subsite-with-authorization/38275883#38275883", "title": "Yesod: Static subsite with authorization", "body": "<p>So I found an imperfect answer that's good enough for my purposes for now.</p>\n\n<p>I couldn't figure out how to make the static site behave differently. It seems it somehow uses the underlying capabilities of the wai server, so it never even touches the Yesod part of it. And as subsites seem to do the dispatch before the core system does, that was the only place where I could have changed something. Strange choice to have a core system be last in line, but whatever, there's probably a reason for this.</p>\n\n<p>The solution, then, is to duplicate what the static subsite does. But with as little work as possible, please. So here's the most basic handler you can create:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>getStaticCatContentHtmlR :: Text -&gt; Handler Value\ngetStaticCatContentHtmlR path = do\n  let filePath = \"static/cats/html\" &lt;/&gt; unpack path\n  sendFile \"text/html\" filePath\n</code></pre>\n\n<p>Just point your static subsite at <code>static/public</code> instead, create three new subfolders for html, css and js per subsite, add three corresponding handlers with suitable permissions and be done with it. The routing system makes sure that users can't request a path like <code>/static/cats/html/../../../</code>.</p>\n\n<p>There are several drawbacks, though.</p>\n\n<ul>\n<li>Yesod cannot do any optimizations.</li>\n<li>Errors from missing files or wrong routes do not crash the server, but the error response is horrible. Of course you could catch the error yourself.</li>\n<li>You don't get any routing tools inside Yesod, so you must do it manually and unchecked.</li>\n<li>All routes in this subsite should be relative so you get less errors when you move the server from development to deployment. That might not be a drawback, but it limits your choices.</li>\n</ul>\n\n<p>Is it worth the effort to create a subsite to bundle these three handlers? Well, maybe as a training exercise...</p>\n"}], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468014788, "creation_date": 1467265483, "last_edit_date": 1467824094, "question_id": 38114837, "link": "https://stackoverflow.com/questions/38114837/yesod-static-subsite-with-authorization", "title": "Yesod: Static subsite with authorization", "body": "<p><em>completely rewritten to include improved understanding</em></p>\n\n<p>The <code>Yesod</code> typeclass contains the function <code>isAuthorized</code> which you can adapt so that different routes are only accessible for different user groups.\n The scaffolded site shows examples of how to do that, including making the authorization subsite available to everyone:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>isAuthorized (AuthR _) _ = return Authorized\n</code></pre>\n\n<p>The scaffolded site also helpfully includes a subsite for static content. But: that static subsite does not honor what you do in <code>isAuthorized</code>. You can check that by adding a pattern match like</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>isAuthorized (StaticR _) _ = error \"this error is never reached\"\n</code></pre>\n\n<p>You can still access all static content (including newly created one) and you will never encounter this pattern match.</p>\n\n<p>It does make a bit of sense to give everyone access to content like bootstrap or jquery. Still, the same result could be achieved by honouring <code>isAuthorized</code> and always returning <code>Authorized</code>, the same way it's done with the authorization subsite or the favicon handler.</p>\n\n<p>I personally would like to go one step further with dispatch like</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>isAuthorized (StaticR (StaticRoute (\"public\":_) _)) _     = pure Authorized\nisAuthorized (StaticR (StaticRoute (\"admin\" :_) _)) _     = checkIsAdmin\nisAuthorized (StaticR (StaticRoute (\"cats\"  :_) _)) False = checkIsAllowedToViewCats\n:\n</code></pre>\n\n<p>It seems the only missing bit is to make the static subsite honour the check or to add a shim that does.</p>\n\n<p>Sadly the subsite is a huge amount of complicated code with template haskell  and a lot of magic doing complicated things like embedding files in the executable. The way it's included in the scaffolding has yet more magic. I'm also just learning about subsites and my training to see types as documentation fails in contexts like type families or <code>Q Def</code>. For these reasons I couldn't figure out how to add the check. Any pointers would be appreciated.</p>\n"}, {"tags": ["function", "haskell", "syntax", "operator-precedence"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1467270865, "post_id": 38114204, "comment_id": 63665213, "body": "Style note: <code>x:[]</code> is equivalent to <code>[x]</code>. Hence, the line <code>addToList x xs = [x]</code> is redundant: the next line will return <code>[x]</code> anyway. This further implies that <code>addToList</code> and <code>(:)</code> are exactly the same thing. Indeed, one can directly use <code>map f (x:xs) = (:) (f x) (map f xs)</code> or equivalently <code>map f (x:xs) = f x : map f xs</code> using infix notation."}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467277067, "post_id": 38114204, "comment_id": 63668971, "body": "@chi This is why I wrote &quot;I know I don&#39;t need addToList[...]&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1467263546, "post_id": 38114419, "comment_id": 63661939, "body": "So, why is the compile error stating &quot;Probable cause: `map&#39; is applied to too few arguments&quot;?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 1, "creation_date": 1467263800, "post_id": 38114419, "comment_id": 63662026, "body": "GHC is trying really hard to make sense of what you&#39;ve written. It is possible that <code>addToList a b c d</code> could be valid, but not in the &quot;everyday&quot; use of it - and that&#39;s why I say <code>addToList</code> &quot;expects&quot; only two arguments. This idea of just counting &quot;expected&quot; arguments should serve you well in tracking down problems like this."}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1467264039, "post_id": 38114419, "comment_id": 63662112, "body": "But wouldn&#39;t the compiler parse the tree all the way down to arrive at &quot;map f xs&quot;, replace it with a list and traverse back up on the parse tree? Why would it stop at the highest level of &quot;addToList ...&quot; without parsing that expression further?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 5, "creation_date": 1467264176, "post_id": 38114419, "comment_id": 63662163, "body": "Note that <code>addToList a b map d</code> is the same as <code>(((addToList a) b) map) d</code>, so in a sense <code>map</code> is not being applied to any arguments, so perhaps this is what GHC is referring to."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 9, "last_activity_date": 1467265031, "last_edit_date": 1467265031, "creation_date": 1467263456, "answer_id": 38114419, "question_id": 38114204, "link": "https://stackoverflow.com/questions/38114204/haskell-parentheses-for-function-application-binding/38114419#38114419", "title": "Haskell parentheses for function application binding", "body": "<p>The simple way to see that something is wrong is to note that the expression:</p>\n\n<pre><code>addToList (f x) map f xs\n</code></pre>\n\n<p>is applying 4 arguments to <code>addToList</code> whereas:</p>\n\n<pre><code>addToList (f x) (map f xs)\n</code></pre>\n\n<p>is applying two arguments to <code>addToList</code> (which is what <code>addToList</code> \"expects\").</p>\n\n<p><strong>Update</strong></p>\n\n<p>Note that even though <code>map</code> takes two arguments, this expression:</p>\n\n<pre><code>addToList a map c d\n</code></pre>\n\n<p>is parsed as:</p>\n\n<pre><code>(((addToList a) map) c) d\n</code></pre>\n\n<p>So here's a possible explanation of what GHC is thinking...</p>\n\n<ol>\n<li><p><code>addToList (f x)</code> has type <code>[a] -&gt; [a]</code> - i.e. it is a function which takes a list.</p></li>\n<li><p><code>map</code> has type <code>(c -&gt; d) -&gt; [c] -&gt; [d]</code>. It is not a list, but with additional arguments it could produce a list.</p></li>\n<li><p>So when GHC sees <code>addTolist (f x) map</code> and can't type check it, it sees that if <code>map</code> only had a few more arguments, like this:</p>\n\n<pre><code>addToList (f x) (map ...)\n</code></pre></li>\n</ol>\n\n<p>at least the second argument to <code>addToList</code> would be a list - so perhaps that's the problem.</p>\n"}, {"comments": [{"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1467337607, "post_id": 38125021, "comment_id": 63702558, "body": "Thanks for the great response!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 8, "last_activity_date": 1467294402, "creation_date": 1467294402, "answer_id": 38125021, "question_id": 38114204, "link": "https://stackoverflow.com/questions/38114204/haskell-parentheses-for-function-application-binding/38125021#38125021", "title": "Haskell parentheses for function application binding", "body": "<p>Parsing is a distinct step that is completed <em>before</em> type checking occurs. The expression</p>\n\n<pre><code>addToList (f x) map f xs\n</code></pre>\n\n<p>has as much meaning to the parser as <code>s1 (s2 s3) s4 s2 s5</code> has to you. It doesn't know anything about what the names <em>mean</em>. It takes the lexical structure of the string and turns it into a parse tree like</p>\n\n<pre><code>                        *5\n                      /   \\\n                     /    xs\n                    *4\n                  /   \\\n                 /     f\n                *3\n              /   \\\n             /     map\n            *2\n          /   \\\n  addToList    *1\n              / \\\n             f   x\n</code></pre>\n\n<p>Once the parse tree is complete, then each node is tagged with its type, and type checking can occur. Since function application is denoted simply by juxtaposition, the type checker knows that the left child of a node is a function, the right child is the argument, and the root is the result.</p>\n\n<p>The type checker can proceed roughly as follows, doing an pre-order traversal of the tree. (I'll alter the type signatures slightly to distinguish unrelated type variables until they are unified.)</p>\n\n<ol>\n<li><code>addToList :: a -&gt; [a] -&gt; [a]</code>, so it takes an argument of type <code>a</code> and returns a function of type <code>[a] -&gt; [a]</code>. The value of <code>a</code> is not yet known.</li>\n<li><code>f :: b -&gt; c</code>, so it takes an argument of type <code>b</code> and returns a value of type <code>c</code>. The values of <code>b</code> and <code>c</code> are not yet known.</li>\n<li><code>x</code> has type <code>d</code>. The value of <code>d</code> is not yet known.</li>\n<li>Letting <code>b ~ d</code>, <code>f</code> can be applied to <code>x</code>, so <code>*1 :: c</code></li>\n<li>Letting <code>a ~ c</code>, <code>addToList</code> is applied to <code>*1</code>, so <code>*2 :: [a] -&gt; [a]</code></li>\n<li>Uh oh. <code>*2</code> expects an argument of type <code>[a]</code>, but it is being applied to <code>map :: (e -&gt; f) -&gt; [e] -&gt; [f]</code>. The type checker does not know how to unify a list type and a function type, which produces the error you see.</li>\n</ol>\n"}], "owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 38125021, "answer_count": 2, "score": 3, "last_activity_date": 1467294402, "creation_date": 1467262296, "last_edit_date": 1495541308, "question_id": 38114204, "link": "https://stackoverflow.com/questions/38114204/haskell-parentheses-for-function-application-binding", "title": "Haskell parentheses for function application binding", "body": "<p>I'm learning Haskell. I defined the following function (I know I don't need <code>addToList</code> and I can also do Point-free notation I'm just in the process of playing with language concepts):</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f []    = []\nmap f (x:xs)  = addToList (f x) map f xs\n  where\n    addToList :: a -&gt; [a] -&gt; [a]\n    addToList x [] = [x]\n    addToList x xs = x:xs\n</code></pre>\n\n<p>This produces a compile error: </p>\n\n<pre><code>with actual type `(a0 -&gt; b0) -&gt; [a0] -&gt; [b0]'                                                                                                                   \nRelevant bindings include                                                                                                                                                   \n  f :: a -&gt; b (bound at PlayGround.hs:12:5)                                                                                                                                 \n  map :: (a -&gt; b) -&gt; [a] -&gt; [b] (bound at PlayGround.hs:11:1)                                                                                                               \nProbable cause: `map' is applied to too few arguments                                                                                                                       \nIn the second argument of `addToList', namely `map'                                                                                                                         \nIn the expression: addToList (f x) map f xs   \n</code></pre>\n\n<p>If I put parantheses around map it works:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f []    = []\nmap f (x:xs)  = addToList (f x) (map f xs)\n  where\n    addToList :: a -&gt; [a] -&gt; [a]\n    addToList x [] = [x]\n    addToList x xs = x:xs\n</code></pre>\n\n<p>I understand that function application binds more tightly than operators (as discussed in <a href=\"https://stackoverflow.com/questions/27155472/haskell-too-few-arguments\">Haskell - too few arguments</a>), however, I don't understand how the compiler would parse the above differently without the parantheses.</p>\n"}, {"tags": ["swift", "haskell", "lazy-evaluation"], "answers": [{"tags": [], "owner": {"reputation": 13391, "user_id": 3443689, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Ym78L.jpg?s=128&g=1", "display_name": "Kametrixom", "link": "https://stackoverflow.com/users/3443689/kametrixom"}, "is_accepted": false, "score": 4, "last_activity_date": 1467257969, "creation_date": 1467257969, "answer_id": 38113582, "question_id": 38113526, "link": "https://stackoverflow.com/questions/38113526/swift-function-execute-lazy-like-haskell/38113582#38113582", "title": "Swift function execute lazy like Haskell", "body": "<p>You can have a lazy version if you use the <code>lazy</code> property:</p>\n\n<pre><code>let double : (Int) -&gt; Int = { $0 * 2 }\n\n\nlet result = [1, 2, 3].lazy.map(double).map(double).map(double)\n\nfor elem in result {\n    print(elem)\n}\n\nprint(Array(result))\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 3162071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c9534f0c7b788e43532755a35b98697?s=128&d=identicon&r=PG", "display_name": "looseyi", "link": "https://stackoverflow.com/users/3162071/looseyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1467260477, "creation_date": 1467257580, "last_edit_date": 1467260477, "question_id": 38113526, "link": "https://stackoverflow.com/questions/38113526/swift-function-execute-lazy-like-haskell", "title": "Swift function execute lazy like Haskell", "body": "<p>Hope to understand if Swift compile chain calling a function like Haskell,</p>\n\n<pre><code>let x = [1, 2, 3, 4, 5]\n\n    func doubleMe(x: Int) -&gt; Int {\n        return x * 2\n    }\n\n    x.map(doubleMe)\n    .map(doubleMe)\n    .map(doubleMe)\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1467255326, "post_id": 38113153, "comment_id": 63659766, "body": "What is the Core generated in both cases?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1467289443, "post_id": 38113153, "comment_id": 63677446, "body": "You should submit a bug to the GHC issue tracker (<a href=\"https://ghc.haskell.org/trac/ghc/newticket\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/newticket</a>)."}, {"owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "edited": false, "score": 0, "creation_date": 1467347637, "post_id": 38113153, "comment_id": 63704869, "body": "I submitted a bug: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12354#ticket\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12354#ticket</a>"}, {"owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "edited": false, "score": 0, "creation_date": 1467347671, "post_id": 38113153, "comment_id": 63704875, "body": "Here is the Int core <a href=\"http://pastebin.com/ixBhgMqc\" rel=\"nofollow noreferrer\">pastebin.com/ixBhgMqc</a> and the Word core <a href=\"http://pastebin.com/gtVeKjgX\" rel=\"nofollow noreferrer\">pastebin.com/gtVeKjgX</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1467268378, "post_id": 38113639, "comment_id": 63663879, "body": "I haven&#39;t looked into it, but I&#39;m placing my bet on the <code>Enum Word</code> instance being different from the <code>Enum Int</code> one, preventing the enumeration from being able to fuse with the <code>foldr</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467299560, "post_id": 38113639, "comment_id": 63685448, "body": "To start, the instance for <code>Word</code> usually converts the value to an <code>Integer</code> first, then converts the result back to <code>Word</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1467329319, "post_id": 38113639, "comment_id": 63700595, "body": "Yeah, <code>fold&#47;build</code> is hugely important. It&#39;s the optimization that eliminates the creation of the list in memory. It&#39;s quite probable that <code>Word</code>&#39;s <code>Enum</code> implementation doesn&#39;t use <code>build</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 10, "last_activity_date": 1467258692, "last_edit_date": 1467258692, "creation_date": 1467258390, "answer_id": 38113639, "question_id": 38113153, "link": "https://stackoverflow.com/questions/38113153/word-foldl-isnt-optimized-as-well-as-int-foldl/38113639#38113639", "title": "Word foldl&#39; isn&#39;t optimized as well as Int foldl&#39;", "body": "<p>This is probably mostly, though not exclusively, due to rewrite rules that exist for Int and not Word.  I say that because if we use <code>-fno-enable-rewrite-rules</code> on the <code>Int</code> case we get a time that is much closer to, but not quite as bad as, the <code>Word</code> case.</p>\n\n<pre><code>% ghc -O2 so.hs -fforce-recomp -fno-enable-rewrite-rules &amp;&amp; time ./so\n[1 of 1] Compiling Main             ( so.hs, so.o )\nLinking so ...\n5000000050000000\n./so  1.45s user 0.03s system 99% cpu 1.489 total\n</code></pre>\n\n<p>If we dump the rewrite rules with <code>-ddump-rule-rewrites</code> and diff these rules then we see a rule that fires in the <code>Int</code> case and not the <code>Word</code> case:</p>\n\n<pre><code> Rule: fold/build\n Before: GHC.Base.foldr\n ...\n</code></pre>\n\n<p>That particular rule is in Base 4.9 GHC.Base line 823 (N.B. I'm actually using GHC 7.10 myself) and does not mention <code>Int</code> explicitly.  I'm curious why it isn't firing for <code>Word</code>, but don't have the time right now to investigate further.</p>\n"}, {"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1467359855, "post_id": 38139924, "comment_id": 63710189, "body": "The above is with 7.10. It should be slightly better with 8.0, where <code>remInteger</code> has become strict (See <a href=\"http://hackage.haskell.org/trac/ghc/ticket/10691\" rel=\"nofollow noreferrer\">#10691</a>)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467391066, "post_id": 38139924, "comment_id": 63729956, "body": "Have you, or shall I, submitted a bug report to add a more efficient instance for Word?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1467395248, "post_id": 38139924, "comment_id": 63732010, "body": "Has already been done: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12354#ticket\" rel=\"nofollow noreferrer\">#12354</a>"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 2, "last_activity_date": 1467359448, "creation_date": 1467359448, "answer_id": 38139924, "question_id": 38113153, "link": "https://stackoverflow.com/questions/38113153/word-foldl-isnt-optimized-as-well-as-int-foldl/38139924#38139924", "title": "Word foldl&#39; isn&#39;t optimized as well as Int foldl&#39;", "body": "<p>As pointed out by dfeuer in a comment here, the <code>Enum</code> instance for <code>Int</code> is better than the one for <code>Word</code>:</p>\n\n<p><code>Int</code>:</p>\n\n<pre><code>instance  Enum Int  where\n    {-# INLINE enumFromTo #-}\n    enumFromTo (I# x) (I# y) = eftInt x y\n\n{-# RULES\n\"eftInt\"        [~1] forall x y. eftInt x y = build (\\ c n -&gt; eftIntFB c n x y)\n\"eftIntList\"    [1] eftIntFB  (:) [] = eftInt\n #-}\n{- Note [How the Enum rules work]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n* Phase 2: eftInt ---&gt; build . eftIntFB\n* Phase 1: inline build; eftIntFB (:) --&gt; eftInt\n* Phase 0: optionally inline eftInt\n-}\n\n{-# NOINLINE [1] eftInt #-}\neftInt :: Int# -&gt; Int# -&gt; [Int]\n-- [x1..x2]\neftInt x0 y | isTrue# (x0 &gt;# y) = []\n            | otherwise         = go x0\n               where\n                 go x = I# x : if isTrue# (x ==# y)\n                               then []\n                               else go (x +# 1#)\n\n{-# INLINE [0] eftIntFB #-}\neftIntFB :: (Int -&gt; r -&gt; r) -&gt; r -&gt; Int# -&gt; Int# -&gt; r\neftIntFB c n x0 y | isTrue# (x0 &gt;# y) = n\n                  | otherwise         = go x0\n                 where\n                   go x = I# x `c` if isTrue# (x ==# y)\n                                   then n\n                                   else go (x +# 1#)\n                        -- Watch out for y=maxBound; hence ==, not &gt;\n        -- Be very careful not to have more than one \"c\"\n        -- so that when eftInfFB is inlined we can inline\n        -- whatever is bound to \"c\"\n</code></pre>\n\n<p>Now <code>Word</code> actually uses the implementation for <code>Integer</code></p>\n\n<pre><code>enumFromTo n1 n2       = map integerToWordX [wordToIntegerX n1 .. wordToIntegerX n2]\n</code></pre>\n\n<p>which uses</p>\n\n<pre><code>instance  Enum Integer  where\n    enumFromTo x lim       = enumDeltaToInteger x 1     lim\n</code></pre>\n\n<p>Now <code>enumDeltaToInteger</code> has rewrite rules set up, but it turns out that <code>Word</code>\u2019s <code>enumFromTo</code> is never inlined, so this setup has no chance of fusing here. </p>\n\n<p>Copying this function into my test code causes GHC to inline it, the <code>fold/build</code> rule to fire, and cuts down allocation severely, but the conversion from and to <code>Integer</code> (which does allocate) remains.</p>\n"}], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 38113639, "answer_count": 2, "score": 14, "last_activity_date": 1467359448, "creation_date": 1467254839, "last_edit_date": 1467346434, "question_id": 38113153, "link": "https://stackoverflow.com/questions/38113153/word-foldl-isnt-optimized-as-well-as-int-foldl", "title": "Word foldl&#39; isn&#39;t optimized as well as Int foldl&#39;", "body": "<pre><code>import Data.List\n\ntest :: Int -&gt; Int\ntest n = foldl' (+) 0 [1..n]\n\nmain :: IO ()\nmain = do\n  print $ test $ 10^8\n</code></pre>\n\n<p>GHC optimizes the above code to the point that the garbage collector doesn't even have to do anything:</p>\n\n<pre><code>$ ghc -rtsopts -O2 testInt &amp;&amp; ./testInt +RTS -s\n[1 of 1] Compiling Main             ( testInt.hs, testInt.o )\nLinking testInt ...\n5000000050000000\n          51,752 bytes allocated in the heap\n           3,480 bytes copied during GC\n          44,384 bytes maximum residency (1 sample(s))\n          17,056 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.101s  (  0.101s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.103s  (  0.102s elapsed)\n\n  %GC     time       0.1%  (0.1% elapsed)\n\n  Alloc rate    511,162 bytes per MUT second\n\n  Productivity  99.8% of total user, 100.9% of total elapsed\n</code></pre>\n\n<p>However, if I change the type of <code>test</code> to <code>test :: Word -&gt; Word</code>, then a lot of garbage is produced and the code runs 40x slower.</p>\n\n<pre><code>ghc -rtsopts -O2 testWord &amp;&amp; ./testWord +RTS -s\n[1 of 1] Compiling Main             ( testWord.hs, testWord.o )\nLinking testWord ...\n5000000050000000\n  11,200,051,784 bytes allocated in the heap\n       1,055,520 bytes copied during GC\n          44,384 bytes maximum residency (2 sample(s))\n          21,152 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     21700 colls,     0 par    0.077s   0.073s     0.0000s    0.0000s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0001s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    4.551s  (  4.556s elapsed)\n  GC      time    0.077s  (  0.073s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    4.630s  (  4.630s elapsed)\n\n  %GC     time       1.7%  (1.6% elapsed)\n\n  Alloc rate    2,460,957,186 bytes per MUT second\n\n  Productivity  98.3% of total user, 98.3% of total elapsed\n</code></pre>\n\n<p>Why does this happen? I expected the performance to be nearly identical?\n(I'm using GHC version 8.0.1 on x86_64 GNU/Linux)</p>\n\n<p>edit: I submitted a bug: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12354#ticket\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/12354#ticket</a></p>\n"}, {"tags": ["haskell", "subset-sum"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1467254702, "post_id": 38113001, "comment_id": 63659630, "body": "What have you tried and why didn&#39;t it work? If you need help figuring out where to start, what patterns have you noticed? Maybe you can start with something simple, like what is <code>sum1 1</code>? Can you write <code>sum1 2</code> in terms of <code>sum1 1</code> and <code>2</code>?"}, {"owner": {"reputation": 304, "user_id": 2948547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aee18c227524171c35c38c685c5d7b83?s=128&d=identicon&r=PG&f=1", "display_name": "user2948547", "link": "https://stackoverflow.com/users/2948547/user2948547"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1467261724, "post_id": 38113001, "comment_id": 63661384, "body": "i have been trying a lot. This excesice was from an exam i have just edit the question with my code. But it doesn&#39;t work"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1467280607, "last_edit_date": 1467280607, "creation_date": 1467260002, "answer_id": 38113881, "question_id": 38113001, "link": "https://stackoverflow.com/questions/38113001/haskell-get-all-the-numbers-whose-sum-is-x/38113881#38113881", "title": "Haskell get all the numbers whose sum is X", "body": "<p>I'll assume that this is homework (and a harder one IMO) so I will not spoil everything right now.</p>\n\n<p>If you think about it you should see that there are basically two operations of how you can get from a list <code>xs</code> that sums to <code>n</code> to a list that sums to <code>n+1</code>:</p>\n\n<ul>\n<li>you can add another <code>1</code></li>\n<li>you can add <code>1</code> to some <code>x</code> in <code>xs</code></li>\n</ul>\n\n<p>so if you manage to implement both operations your task will be a lot easier.</p>\n\n<p>The first one is not hard (<em>hint</em> <code>(1:)</code> is a function prepending an additional <code>1</code> to some list - now you have to <em>map</em> this...)</p>\n\n<p>The second one is a bit harder although almost the same idea of divide&amp;conquer will help you out.</p>\n\n<p>Here is how I would start with it:</p>\n\n<pre><code>add1Somewhere :: Num a =&gt; [a] -&gt; [[a]]\nadd1Somewhere [i] = [[i+1]]\nadd1Somewhere (i:is) = ???\n</code></pre>\n\n<p>(yes this is a <em>partial</em> function)</p>\n\n<hr>\n\n<h2>remarks:</h2>\n\n<ul>\n<li>as you can see below you don't really have to insert the additional <code>1</code> somewhere or choose any <code>x</code> in <code>xs</code> - using the first <code>x</code> in <code>xs</code> and prepending to the first place <strong>does suffice</strong></li>\n<li>the algorithm I'm hinting at will produce sometimes equal outcomes - for example if you have one <code>[1,1]</code> then you can end up at <code>[2,2]</code> later in two ways: <code>[1,1] -&gt; [2,1] -&gt; [2,2]</code> and <code>[1,1] -&gt; [1,2] -&gt; [2,2]</code> - those can be removed with <code>Data.List.nub</code> or if you change your algorithm to produce ordered/filtered results (don't produce <code>[1,1] -&gt; [1,2]</code>)</li>\n<li>your example is missing things <code>[1,1,1,1]</code> and I honestly could not tell if the exercise hints at one such order</li>\n<li>you probably should have a look at <code>concatMap</code> (or <code>concat</code>)</li>\n<li>this is different from the algorithm @cirdec is hinting at (probably his is faster) - but the same problems with duplication applies if you <em>insert an additional 1 at some place</em></li>\n</ul>\n\n<hr>\n\n<h3>solution</h3>\n\n<p>as it's some time and you said it's an old exam question I think it's ok to spoil it (don't read on if you don't want to)</p>\n\n<p>So this is a possible solution (no care taken on any performance issue):</p>\n\n<pre><code>import Data.List (nub)\n\nsum1 :: (Eq a, Num a) =&gt; a -&gt; [[a]]\nsum1 1 = [[1]]\nsum1 n = nub $ concatMap add1Somewhere ns ++ map (1:) ns\n  where ns = sum1 (n-1)\n\nadd1Somewhere :: Num a =&gt; [a] -&gt; [[a]]\nadd1Somewhere [i] = [[i+1]]\nadd1Somewhere (i:is) = ((i+1):is) : map (i:) (add1Somewhere is)\n</code></pre>\n\n<p>please note that this uses <code>concatMap</code> and <code>nub</code> both of which might or might not be ok for this.</p>\n\n<p>I hope you get the basic idea</p>\n\n<hr>\n\n<h2>obviously better solution</h2>\n\n<p>oops - I just noticed that you can get rid of all the <em>problematic</em> functions like <code>concat</code> and <code>nub</code> anyway as it's sufficient to just prepend a <code>1</code> or increment the very first list element - the recursion will provide all the needed permuations anyway (the different paths I mentioned are exactly the permutations) - <em>there is a difference in the order though</em>:</p>\n\n<pre><code>sum1 :: (Eq a, Num a) =&gt; a -&gt; [[a]]\nsum1 1 = [[1]]\nsum1 n = map add1 ns ++ map prep1 ns\n  where ns          = sum1 (n-1)\n        prep1 is    = 1:is\n        add1 (i:is) = (i+1):is\n</code></pre>\n\n<p>of course you can replace the <code>map</code> with a list-comprehension if you want</p>\n\n<h3>proof that this finds all permutations</h3>\n\n<p>by Induction on <code>n</code> (assuming only positive natural numbers)</p>\n\n<p>for <code>n=1</code> just notice that <code>[1]</code> is the only possible list</p>\n\n<p>now assume that we find all permuations for <code>n&gt;0</code> and look at some list <code>xs</code>\nthat will sum up to <code>n+1</code> (obviously the list needs to be non-empty)</p>\n\n<p>Now the first element <code>x</code> of <code>xs = x:ys</code> will be either <code>1</code> or <code>&gt;1</code></p>\n\n<ul>\n<li><code>x=1</code> - in this case <code>prep1</code> will provide <code>xs</code> because <code>ys</code> was found by our algorithm by induction (note that <code>sum ys = sum xs - 1 = n</code>)</li>\n<li><code>x&gt;1</code> - in this case <code>(x-1):ys</code> was found by our algorithm by induction and <code>add1</code> will create <code>xs</code> (again because <code>sum ((x-1):ys) = sum xs - 1 = n</code>)</li>\n</ul>\n"}], "owner": {"reputation": 304, "user_id": 2948547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aee18c227524171c35c38c685c5d7b83?s=128&d=identicon&r=PG&f=1", "display_name": "user2948547", "link": "https://stackoverflow.com/users/2948547/user2948547"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 737, "favorite_count": 0, "accepted_answer_id": 38113881, "answer_count": 1, "score": 0, "last_activity_date": 1467280607, "creation_date": 1467253761, "last_edit_date": 1467275981, "question_id": 38113001, "link": "https://stackoverflow.com/questions/38113001/haskell-get-all-the-numbers-whose-sum-is-x", "title": "Haskell get all the numbers whose sum is X", "body": "<p>I need to create a function in haskell which receives a number and returns a list of lists, where the list has all combination of the numbers whose sum is the number received.</p>\n\n<p>is dificult to explain so this is the example:</p>\n\n<pre><code>sum1 4 = [ [4], [3,1], [2,2], [1,3], [1,1,2], [1,2,1] , [2,1,1] ]\n\nsum1 3 = [ [3], [2,1], [1,2], [1,1,1]\n</code></pre>\n\n<p>I need to do this with recursion and with comprehension list</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>this is my code:</p>\n\n<pre><code>sum1 n = sum3 (sum2 1 (n-1) n)\nsum2 x y n = if ((x+y)==n &amp;&amp; x&gt;0 &amp;&amp; y&gt;0) then [x,y]:sum2 (x+1) (y-1) n else []\nsum3 [] = []\nsum3 (x:xs) = sum4 x 1 : sum3 xs\nsum4 [] t = []\nsum4 (x:xs) t = if not (x == t) then (sum1 x) else x\n</code></pre>\n\n<p>And yes, this was an excesice of an exam but i don't know how to doit</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1467250352, "post_id": 38112236, "comment_id": 63658659, "body": "Yeah, read <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"nofollow noreferrer\">4.3.4</a>. It look like <code>Num</code> really is magical. That seems like a restriction that ought to be loosened, although how I don&#39;t know."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467282461, "post_id": 38112236, "comment_id": 63672780, "body": "Yep, <code>Num</code> <b>is</b> treated specially and there currently is no way to make custom defaulting work properly. You can only choose &quot;built-in&quot; types and even then it wont work for all classes."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1467294209, "post_id": 38112236, "comment_id": 63680967, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/12271\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12271</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467301954, "post_id": 38112236, "comment_id": 63687242, "body": "I tend to define locally <code>(^) :: Num a =&gt; a -&gt; Int -&gt; a; (^) = Prelude.(^)</code>. For almost all applications, <code>Int</code> exponents are all that&#39;s sensible."}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1467248089, "creation_date": 1467247434, "last_edit_date": 1495539855, "question_id": 38112236, "link": "https://stackoverflow.com/questions/38112236/type-defaulting-with-non-standard-prelude", "title": "Type defaulting with non-standard Prelude", "body": "<p>The following program compiles with GHC:</p>\n\n<pre><code>main :: IO ()\nmain = print $ 2^2\n</code></pre>\n\n<p>despite the signature of </p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a \n</code></pre>\n\n<p>due to GHC's <a href=\"https://stackoverflow.com/questions/21943624/why-is-an-explicit-type-not-required-for-basic-prelude-arithmetic\">type defaulting mechanism</a>. I'm using <a href=\"https://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow noreferrer\">numeric-prelude</a>, which instead exports </p>\n\n<pre><code>(^) :: Ring.C a =&gt; a -&gt; Integer -&gt; a\n</code></pre>\n\n<p>This is extremely annoying to use with <code>Int</code> exponents, so I prefer Prelude's version with a polymorphic exponent. Thus, I define the following:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude, RebindableSyntax, ScopedTypeVariables #-}\n\nimport Algebra.Ring as Ring (C)\nimport Algebra.ToInteger as ToInteger (C)\nimport NumericPrelude hiding ((^))\n\n(^) :: forall a i . (Ring.C a, ToInteger.C i) =&gt; a -&gt; i -&gt; a\nx0 ^ y0 = undefined\n\nmain :: IO ()\nmain = print $ 2^2\n</code></pre>\n\n<p>but I get no type defaulting, so there are errors about ambiguous types for the base and exponent.</p>\n\n<p><a href=\"https://wiki.haskell.org/Keywords#default\" rel=\"nofollow noreferrer\">This</a> is the extent of documentation I could find about defaulting, which doesn't describe what the components of the tuple actually do, nor when the \"default\" default types are available. </p>\n\n<p>Just from playing around, it looks like GHC is magically applying defaulting rules to built-in numeric types like <code>Num</code> and <code>Integral</code>, rather than to literals of arbitrary type.</p>\n\n<p>Is there a way to extend this GHC magic to default any \"integer-looking\" type to (say) <code>Int</code>, even when the constraint is not <code>Integral a</code>? Adding an explicit <code>default (Int)</code> (assuming that's the right way to do it), doesn't help.</p>\n\n<p>More specifically, the problem I'm trying to solve is to find a way to use one function <code>(^)</code> that works for </p>\n\n<ol>\n<li><code>Int</code> exponents</li>\n<li><code>Integer</code> exponents</li>\n<li>literal exponents with no explicit type annotation</li>\n</ol>\n\n<p>so any solution that achieves those three points would suffice. </p>\n"}, {"tags": ["haskell", "mergesort"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467280370, "post_id": 38112015, "comment_id": 63671290, "body": "Did your <i>original</i> code include the empty case? <i>If not</i>, please rollback that edit. and let Alec know so that he can remove references to that case in his answer."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467753613, "post_id": 38112015, "comment_id": 63849855, "body": "shouldve marked the answer correct. Sorry!"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1467245840, "creation_date": 1467245840, "answer_id": 38112067, "question_id": 38112015, "link": "https://stackoverflow.com/questions/38112015/haskell-mergesort-implementation-compiles-but-does-not-return-anything/38112067#38112067", "title": "haskell mergesort implementation compiles but does not return anything", "body": "<p>You are missing base cases - so you get infinite recursion. Trying stepping through your example with lists like <code>[]</code> or <code>[1]</code> and you'll fall straight into the problem.</p>\n\n<pre><code>mergesort :: (Ord a) =&gt; [a] -&gt; [a]\nmergesort [] = []   -- &lt; ADDED\nmergesort [x] = [x] -- &lt; ADDED\nmergesort list = merge (mergesort (left list)) (mergesort (right list))\n  where\n    left xs = take (div (length xs) 2) xs\n    right xs = drop (div (length xs) 2) xs\n    merge [] ys = ys\n    merge xs [] = xs\n    merge (x:xs) (y:ys)\n      | x &lt;= y = x : merge xs (y:ys)\n      | otherwise = y : merge (x:xs) ys\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "accepted_answer_id": 38112067, "answer_count": 1, "score": 1, "last_activity_date": 1467753601, "creation_date": 1467245331, "last_edit_date": 1467753601, "question_id": 38112015, "link": "https://stackoverflow.com/questions/38112015/haskell-mergesort-implementation-compiles-but-does-not-return-anything", "title": "haskell mergesort implementation compiles but does not return anything", "body": "<p>Here is my implementation:</p>\n\n<pre><code>mergesort :: (Ord a) =&gt; [a] -&gt; [a]\nmergesort list = merge (mergesort (left list)) (mergesort (right list))\n  where\n    left xs = take (div (length xs) 2) xs\n    right xs = drop (div (length xs) 2) xs\n    merge [] ys = ys\n    merge xs [] = xs\n    merge (x:xs) (y:ys)\n      | x &lt;= y = x : merge xs (y:ys)\n      | otherwise = y : merge (x:xs) ys\n</code></pre>\n\n<p>The code compiles but when I run it my machine crashes. What am I doing wrong?</p>\n"}]