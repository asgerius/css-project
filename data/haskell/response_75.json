[{"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466027662, "post_id": 37846327, "comment_id": 63153080, "body": "It&#39;s sufficient to use one irrefutable match: <code>let ((_,st&#39;), ~(_,st&#39;&#39;)) = (f st, g st&#39;)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466028007, "post_id": 37846327, "comment_id": 63153207, "body": "@leftaroundabout Isn&#39;t <code>st&#39;&#39;</code> the first thing which is demanded? <code>let ... in ((), st&#39;&#39;)</code>. Further, <code>g</code> could be non-strict in the general case."}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466028954, "post_id": 37846327, "comment_id": 63153525, "body": "Thanks, that was insightful. Now in my code there is no <code>undefined</code> and I still don&#39;t see why it loops. Could you also shed some light on that?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466029612, "post_id": 37846327, "comment_id": 63153740, "body": "@\u03c7: what&#39;s important is that the result of <code>g st&#39;</code> is not forced to WHNF (which requires <code>st&#39;</code> to be WHNF first, if <code>g</code> is strict) before evaluating the variables matched within the tuples (including <code>st&#39;</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466031230, "post_id": 37846327, "comment_id": 63154209, "body": "@leftaroundabout I&#39;m stubborn tonight :-) Take <code>f _ = undefined</code> and <code>g _ = ()</code>. With only one lazy pattern, it should diverge because the laziness of <code>g</code> is nullified by <code>f</code> being called anyway. This is probably not the case with <code>g</code> as used in the OP, still I thought the second lazy pattern could be useful in the general case."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 1, "creation_date": 1466031751, "post_id": 37846327, "comment_id": 63154367, "body": "@JoSo Briefly put, there is a circular dependency between <code>st&#39;,st&#39;&#39;</code> and <code>f st, g st&#39;</code> since <code>st&#39;</code> occurs in both. This makes the definition recursive, essentially. The patterns, as they are, force both <code>f st</code> and <code>g st&#39;</code> before defining (loosely speaking) <code>st&#39;, st&#39;&#39;</code>, triggering a loop. leftaroundabout explained in his answer at the top in more detail."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1466032116, "post_id": 37846327, "comment_id": 63154476, "body": "Well, with <code>f _ = undefined</code> you create a new problem that&#39;s somewhat unrelated to the original question. I wouldn&#39;t make that other pattern lazy without good reason \u2013 lazy patterns tend to be pretty bad for performance. (Indeed your other proposal, <code>let (_,st&#39;) = f st ; (_,st&#39;&#39;) = g st&#39; in ((),st&#39;&#39;)</code>, is IMO a better solution than anything with lazy patterns.)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1467493400, "last_edit_date": 1467493400, "creation_date": 1466027171, "answer_id": 37846327, "question_id": 37846161, "link": "https://stackoverflow.com/questions/37846161/haskell-program-aborts-with-loop-but-i-think-it-shouldnt/37846327#37846327", "title": "Haskell program aborts with &quot;loop&quot; but I think it shouldn&#39;t", "body": "<p>It's not a bug -- you just found a tricky corner of the lazy pattern semantics. Let me present a simpler case:</p>\n\n<pre><code>&gt; data Id a = Id a\n&gt; let Id a = undefined ; Id b = Id 3 in b\n3\n&gt; let (Id a, Id b) = (undefined, Id 3) in b\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>The difference is that the first <code>let</code> is equivalent to</p>\n\n<pre><code>case undefined of\n  ~(Id a) -&gt; case Id 3  of\n               ~(Id b) -&gt; b\n</code></pre>\n\n<p>while the second is</p>\n\n<pre><code>case (undefined, Id 3) of\n  ~(Id a, Id b) -&gt; b\n</code></pre>\n\n<p>The first will not evaluate the <code>undefined</code> unless <code>a</code> is demanded (which does not happen). </p>\n\n<p>The second will pattern match against both patterns <code>Id a</code> and <code>Id b</code> as soon as <strong>either</strong> variable is demanded, forcing both <code>undefined</code> and <code>Id 3</code> in the process.</p>\n\n<p>Note that, because of this issue, the patterns <code>~(K1 (K2 x) (K3 y))</code>, <code>~(K1 ~(K2 x) (K3 y))</code>, <code>~(K1 (K2 x) ~(K3 y))</code> and <code>~(K1 ~(K2 x) ~(K3 y))</code> have different semantics.</p>\n\n<p>To fix your code, try</p>\n\n<pre><code>let (~(_,st'),~(_,st'')) = ((f st),(g st')) in ((),st'')\n</code></pre>\n\n<p>or</p>\n\n<pre><code>let (_,st') = f st ; (_,st'') = g st' in ((),st'')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466031568, "post_id": 37846990, "comment_id": 63154307, "body": "Thanks, this might be a good step towards helping me to understand it :-) However I still don&#39;t understand why it can&#39;t first WHNF the left tuple to get <code>st&#39;</code> and then the right tuple to get <code>st&#39;&#39;</code>? I can see that WHNFing the right tuple requires WHNFing the left tuple but I don&#39;t see the problem with WHNFing the left tuple."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466031865, "post_id": 37846990, "comment_id": 63154398, "body": "You can first WHNF the left tuple, but it doesn&#39;t give you <code>st&#39;</code>. It only gives you <code>(_,~st&#39;)</code>, as it were."}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466032666, "post_id": 37846990, "comment_id": 63154623, "body": "In the specific case, <code>(_,st&#39;) = f st = noOp st = ((),st)</code>, so <code>st&#39; = st = Foo ()</code> which would also satisfy the strictness of <code>g</code> alias <code>someOp</code>. Shouldn&#39;t this be possible to compute?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466032732, "post_id": 37846990, "comment_id": 63154644, "body": "<code>let Pat (Pet x) (Pot y) = bar in baz</code> is evaluated as <code>let Pat \u03be \u03c5 = bar in \u03be `seq` \u03c5 `seq` (let Pet x = \u03be; Pet y = \u03c5 in baz)</code>. So <code>\u03c5</code> is forced before <code>x</code> actually gets into being."}, {"owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466039022, "post_id": 37846990, "comment_id": 63156056, "body": "I think that doesn&#39;t explain why forcing <code>\u03c5</code> wouldn&#39;t force <code>x</code>. What you say makes it sound (to me) like it should be a statically invalid expression."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "edited": false, "score": 0, "creation_date": 1466071523, "post_id": 37846990, "comment_id": 63170009, "body": "<code>x</code> doesn&#39;t <i>exist</i> at the point where the runtimes tries to force <code>\u03c5</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 12, "last_activity_date": 1466031744, "last_edit_date": 1466031744, "creation_date": 1466030350, "answer_id": 37846990, "question_id": 37846161, "link": "https://stackoverflow.com/questions/37846161/haskell-program-aborts-with-loop-but-i-think-it-shouldnt/37846990#37846990", "title": "Haskell program aborts with &quot;loop&quot; but I think it shouldn&#39;t", "body": "<ul>\n<li>Pattern match <code>(_, _)</code> demands WHNF of <code>(f st, g st')</code>. Easy.</li>\n<li>Pattern match <code>(_, (_,_))</code> demands WHNF of <code>g st'</code>. Here's the problem, because <code>g</code> is strict, hence it first needs <code>st'</code> in WHNF too. The runtime finds <code>st'</code> in the pattern <code>((_,st'), (_,_))</code>, so before it can actually traverse down into <code>st'</code> it needs to WHNF both of the tuples. Because <code>g</code> is strict however, this first requires <code>st'</code>... and so on.</li>\n</ul>\n\n<p>If you match the result of <code>g</code> with a lazy irrefutable pattern</p>\n\n<pre><code>(&lt;+&gt;) f g st = let ((_,st'), ~(_,st'')) = (f st, g st') in ((),st'')\n</code></pre>\n\n<p>then the problem goes away, because this is evaluated thus:</p>\n\n<ul>\n<li>Pattern match <code>(_, _)</code> demands WHNF of <code>(f st, g st')</code>. Easy.</li>\n<li>Pattern match <code>(_, ~(_,_))</code> demands nothing more for the time being.</li>\n<li>Pattern match <code>((_,st'), ~(_,_))</code> demands WHNF of <code>f st</code>. Fortunately, we can fulfill this, because <code>st</code> does not depend on the pattern.</li>\n<li>Now we've satisfied the pattern match, the runtime can already proceed with the <code>in ((),st'')</code>. Only at this point is the irrefutable pattern <code>~(_,st'')</code> forced, but this is now not a problem anymore because <code>st'</code> is available here, so it's just a matter of computing <code>g</code> once.</li>\n</ul>\n\n<p>The fixes you've tried all amount to making <code>g</code> non-strict:</p>\n\n<blockquote>\n  <p>remove the deconstruction <code>@(Foo _)</code></p>\n</blockquote>\n\n<p>Without that, <code>g</code> doesn't really need to look at its argument to construct the result skeleton, i.e. the tuple match <code>(_,st'')</code> can then succeed without first requiring WHNF of <code>st'</code>.</p>\n\n<blockquote>\n  <p>change <code>data Foo</code> to <code>newtype Foo</code></p>\n</blockquote>\n\n<p>This has the effect that the <code>Foo</code> constructor doesn't actually exist at runtime, so there's nothing that the pattern <code>st@(Foo _)</code> would force.</p>\n\n<blockquote>\n  <p>change <code>noOp &lt;+&gt; someOp</code> to <code>someOp &lt;+&gt; noOp</code></p>\n</blockquote>\n\n<p>As I said, the loop only comes about because <code>g</code> is strict. If you put <code>f</code> in its position, which is not strict, then there's no problem.</p>\n"}], "owner": {"reputation": 20544, "user_id": 1073695, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dca512cb7914943d46461d0bbbacd5a?s=128&d=identicon&r=PG", "display_name": "Jo So", "link": "https://stackoverflow.com/users/1073695/jo-so"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 849, "favorite_count": 1, "answer_count": 2, "score": 13, "last_activity_date": 1467493400, "creation_date": 1466026412, "question_id": 37846161, "link": "https://stackoverflow.com/questions/37846161/haskell-program-aborts-with-loop-but-i-think-it-shouldnt", "title": "Haskell program aborts with &quot;loop&quot; but I think it shouldn&#39;t", "body": "<p>I have this Haskell code which when compiled with GHC and run, aborts with a loop detected.</p>\n\n<pre><code>data Foo = Foo ()\n deriving (Eq,Show)\n\ntype Foop = Foo -&gt; ((),Foo)\n\nnoOp :: Foop\nnoOp st = ((),st)\n\nsomeOp :: Foop\nsomeOp st@(Foo x) = ((),st)\n\n(&lt;+&gt;) :: Foop -&gt; Foop -&gt; Foop\n(&lt;+&gt;) f g st = let ((_,st'),(_,st'')) = ((f st),(g st')) in ((),st'')\n\nmain = print $ (noOp &lt;+&gt; someOp) $ Foo ()\n</code></pre>\n\n<p>I think it shouldn't, and here are some modifications. Each of them makes the loop go away:</p>\n\n<ul>\n<li>change <code>data Foo</code> to <code>newtype Foo</code></li>\n<li>change <code>(noOp &lt;+&gt; someOp)</code> to <code>(someOp &lt;+&gt; noOp)</code></li>\n<li>remove the deconstruction <code>@(Foo x)</code></li>\n</ul>\n\n<p>Is this a bug in GHC or is it my lack of understanding the evaluation process?</p>\n"}, {"tags": ["haskell", "infinite", "coinduction"], "answers": [{"comments": [{"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 1, "creation_date": 1466039485, "post_id": 37847511, "comment_id": 63156161, "body": "I&#39;m digesting your answer, but re your last question that is a typo; the explicit SBottom should be an STop."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 1, "creation_date": 1466039966, "post_id": 37847511, "comment_id": 63156287, "body": "I think the modified <code>Term</code> is not good: it means that I can have Next (Next (Next ...)) which is effectively bottom (alternately, we put it in the partial monad), but it should be possible for conv to be total."}], "tags": [], "owner": {"reputation": 113, "user_id": 6472021, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MdoCAts98oE/AAAAAAAAAAI/AAAAAAAAAFA/n8x2OSW1iuI/photo.jpg?sz=128", "display_name": "Jennifer Paykin", "link": "https://stackoverflow.com/users/6472021/jennifer-paykin"}, "is_accepted": false, "score": 3, "last_activity_date": 1466033733, "creation_date": 1466033733, "answer_id": 37847511, "question_id": 37846066, "link": "https://stackoverflow.com/questions/37846066/compute-an-infinite-tree-from-fixpoint-operator-using-delay-modality/37847511#37847511", "title": "Compute an (infinite) tree from fixpoint operator using delay modality", "body": "<p>My intuition is that the context should contain only delayed terms. That way, <code>conv ctx (SMu \"x\" t)</code> will be equivalent to <code>fixD (\\d -&gt; conv ((x,r):ctx) t)</code>, as in the original <code>convL</code>.</p>\n\n<p>If this is the case, then you need a general way to include delayed terms in your data structure, instead of just allowing them in arrows:</p>\n\n<pre><code>data Term = Arrow Term Term\n          | Bottom\n          | Top\n          | Next (D Term)\n</code></pre>\n\n<p>A first attempt at <code>conv</code> gives us:</p>\n\n<pre><code>conv :: [(Var, D Term)] -&gt; STerm -&gt; Term\nconv _ STop = Top\nconv _ SBottom = SBottom\nconv ctx (SArrow t1 t2) = Arrow (conv ctx t1) (conv ctx t2)\nconv ctx (SVar v)\n  | Just l &lt;- lookup v ctx = Next l\n  | otherwise = error \"unbound variable\"\nconv ctx (SMu v t) = fixD (\\r -&gt; conv ((x,r):ctx) t)\n</code></pre>\n\n<p>However, this uses unguarded recursive calls to <code>conv</code>. If you want to avoid that, you can wrap all the <code>fixD</code> recursive calls in a <code>Next</code>.</p>\n\n<pre><code>conv :: [(Var, D Term)] -&gt; STerm -&gt; Term\nconv = fixD step where\n        step _ _ STop = Top\n        step _ _ SBottom = Bottom\n        step d ctx (SArrow t1 t2) = Arrow (Next $ d &lt;*&gt; pure ctx &lt;*&gt; pure t1) \n                                          (Next $ d &lt;*&gt; pure ctx &lt;*&gt; pure t2)\n        step d ctx (SVar v)\n          | Just l &lt;- lookup v ctx = Next l\n          | otherwise = error \"unbound variable\"\n        step d ctx (SMu v t) = fixD (\\r -&gt; \n                                    Next $ d &lt;*&gt; pure ((x,r):ctx) &lt;*&gt; pure t)\n</code></pre>\n\n<p>I'm not sure if this is exactly what you are looking for, because <code>conv [] SMu \"x\" (SArrow SBottom (SMu \"y\" (SVar \"x\")))</code> does still have bottoms in the resulting structure. What is the type you want to get out?</p>\n"}, {"comments": [{"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1466039598, "post_id": 37848256, "comment_id": 63156192, "body": "Structural recursion in SArrow and SMu is OK. Basically, if Coq&#39;s well-foundedness checker would accept it, it&#39;s fine. (If I wanted to be really precise, I would have defined a TermF functor such that \u03bca. TermF a = Term and then given you a primitive recursion combinator, but the syntactic condition seems easy enough to see)."}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": true, "score": 6, "last_activity_date": 1466039643, "last_edit_date": 1466039643, "creation_date": 1466039170, "answer_id": 37848256, "question_id": 37846066, "link": "https://stackoverflow.com/questions/37846066/compute-an-infinite-tree-from-fixpoint-operator-using-delay-modality/37848256#37848256", "title": "Compute an (infinite) tree from fixpoint operator using delay modality", "body": "<p>Do you intend to forbid just the unrestricted recursion (<code>fix</code>) in the <code>SMu</code> case of <code>convL</code>, or also the structural recursion in the <code>SArrow</code> case?</p>\n\n<p>I don\u2019t think this has a solution without structural recursion on <code>STerm</code>, because then we would have to be productive even on an infinite <code>STerm</code> such as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr (\\n -&gt; SMu (\"x\" ++ show n)) undefined [0..]  -- \u03bc\u03b1. \u03bc\u03b2. \u03bc\u03b3. \u03bc\u03b4. \u2026\n</code></pre>\n\n<p>To do this with structural recursion on <code>STerm</code>, it seems the trick is to store <code>Either Term (D Term)</code> in the context.  When we pass through an <code>Arrow</code> and produce a <code>D</code>, we can convert all the <code>Right</code>s to <code>Left</code>s.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Ctx = [(Var, Either Term (D Term))]\n\ndCtx :: Ctx -&gt; D Ctx\ndCtx = traverse (traverse (fmap Left . either pure id))\n\nconv :: STerm -&gt; Ctx -&gt; Term\nconv STop _ = Top\nconv SBottom _ = Bottom\nconv (SArrow t1 t2) ctx = Arrow (fmap (conv t1) (dCtx ctx)) (fmap (conv t2) (dCtx ctx))\nconv (SVar v) ctx = case lookup v ctx of\n                      Nothing -&gt; error \"unbound variable\"\n                      Just (Left t) -&gt; t\n                      Just (Right _) -&gt; Bottom\nconv (SMu v t) ctx = fixD (\\dr -&gt; conv t ((v, Right dr) : ctx))\n</code></pre>\n"}], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 3, "accepted_answer_id": 37848256, "answer_count": 2, "score": 4, "last_activity_date": 1466039808, "creation_date": 1466026001, "last_edit_date": 1466039808, "question_id": 37846066, "link": "https://stackoverflow.com/questions/37846066/compute-an-infinite-tree-from-fixpoint-operator-using-delay-modality", "title": "Compute an (infinite) tree from fixpoint operator using delay modality", "body": "<p>Here is a functional programming puzzle involving loop-tying and infinite data structures. There is a bit of background, so hang tight.</p>\n\n<p><strong>The setting.</strong> Let us define a data type representing recursive data types:</p>\n\n<pre><code>type Var = String\ndata STerm = SMu Var STerm\n           | SVar Var\n           | SArrow STerm STerm\n           | SBottom\n           | STop\n   deriving (Show)\n</code></pre>\n\n<p>i.e. <code>t ::= \u03bc\u03b1. t | \u03b1 | t \u2192 t | \u22a5 | \u22a4</code>. Note that \u22a5 denotes the type with no inhabitants, while \u22a4 denotes the type with all inhabitants. Note that <code>(\u03bc\u03b1. \u03b1) = \u22a5</code>, as \u03bc is a <em>least</em> fixpoint operator.</p>\n\n<p>We can interpret a recursive data type as an infinite tree, arising from repeatedly unfolding <code>\u03bc\u03b1. t</code> to <code>t[\u03b1 \u21a6 \u03bc\u03b1. t]</code>. (For a formal description of this process, see <a href=\"http://lucacardelli.name/Papers/SRT.pdf\" rel=\"nofollow\">http://lucacardelli.name/Papers/SRT.pdf</a>) In Haskell, we can define a type of lazy trees, which don't have \u03bc-binders or variables:</p>\n\n<pre><code>data LTerm = LArrow LTerm LTerm\n           | LBottom\n           | LTop\n   deriving (Show)\n</code></pre>\n\n<p>and, in ordinary Haskell, a conversion function from one to the other:</p>\n\n<pre><code>convL :: [(Var, LTerm)] -&gt; STerm -&gt; LTerm\nconvL _ STop    = LTop\nconvL _ SBottom = LBottom\nconvL ctx (SArrow t1 t2) = LArrow (convL ctx t1) (convL ctx t2)\nconvL ctx (SVar v)\n    | Just l &lt;- lookup v ctx = l\n    | otherwise = error \"unbound variable\"\nconvL ctx (SMu v t) = fix (\\r -&gt; convL ((v, r) : ctx) t)\n</code></pre>\n\n<p>However, there is a problem with this function: it's not productive. If you run <code>convL [] (SMu \"x\" (SVar \"x\"))</code> you will infinite loop. We would rather get <code>LBottom</code> in this case. An interesting exercise is to directly fix this function so that it is productive; however, in this question I want to solve the problem differently.</p>\n\n<p><strong>Productivity with the delay modality.</strong> When we build cyclic data structures as above, we need to make sure we do not use the results of our computations before we have constructed them.  The delay modality is a way of ensuring that we write productive (non infinite looping) programs. The basic idea is simple: if the type <code>Int</code> means that I have an integer today, I define a type constructor <code>D</code>, so that <code>D Int</code> means that I have a value of type <code>Int</code> <em>tomorrow</em>.  <code>D</code> is a Functor and an Applicative (but NOT a monad.)</p>\n\n<pre><code>-- D is abstract; you are not allowed to pattern match on it\nnewtype D a = D a\n   deriving (Show)\n\ninstance Functor D where\n    fmap f (D a) = D (f a)\n\ninstance Applicative D where\n    D f &lt;*&gt; D a = D (f a)\n    pure x = D x\n</code></pre>\n\n<p>With <code>D</code>, we define a fixpoint operator: it says that to construct a value of <code>a</code>, you can have access to the <code>a</code> you are constructing, as long as you only use it <em>tomorrow</em>.</p>\n\n<pre><code>fixD :: (D a -&gt; a) -&gt; a\nfixD f = f (D (fixD f))\n</code></pre>\n\n<p>For example, a Stream consists both of a value <code>a</code> I have today, and a stream <code>Stream a</code> which I have to produce tomorrow.</p>\n\n<pre><code>data Stream a = Cons a (D (Stream a))\n</code></pre>\n\n<p>Using <code>fixD</code>, I can define a <code>map</code> function on streams which is <em>guaranteed</em> to be productive, since the recursive call to <code>map</code> is only used to produced values that are needed tomorrow.</p>\n\n<pre><code>instance Functor Stream where\n    fmap f = fixD $ \\go (Cons x xs) -&gt; Cons (f x) (go &lt;*&gt; xs)\n</code></pre>\n\n<p><strong>The problem.</strong> Here is a variant of <code>LTerm</code> with an explicit delay modality.</p>\n\n<pre><code>data Term = Arrow (D Term) (D Term)\n          | Bottom\n          | Top\n    deriving (Show)\n</code></pre>\n\n<p>Using <code>fixD</code> (no non-structurally recursive references allowed), how do I write a function <code>conv :: STerm -&gt; Term</code> (or <code>conv :: STerm -&gt; D Term</code>)? \nA particularly interesting test case is <code>SMu \"x\" (SArrow STop (SMu \"y\" (SVar \"x\")))</code>; there should be no Bottoms in the resulting structure!</p>\n\n<p><strong>Update.</strong> I accidentally ruled out structural recursion on <code>STerm</code>, which was not the intent of the question; I've reworded to remove that restriction.</p>\n"}, {"tags": ["haskell", "networking", "ipv6", "endianness"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466029367, "post_id": 37845817, "comment_id": 63153657, "body": "I found this: <a href=\"https://hackage.haskell.org/package/cpu-0.1.2/docs/System-Endian.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/cpu-0.1.2/docs/System-Endian.htm&zwnj;&#8203;l</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466050633, "post_id": 37845817, "comment_id": 63158664, "body": "Found this old Cafe thread: <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2008-December/052524.html\" rel=\"nofollow noreferrer\">(link)</a> Unfortunately the thread doesn&#39;t say what happened to the functions."}, {"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1466420858, "post_id": 37845817, "comment_id": 63292254, "body": "It is unclear what goal you are trying to achieve. <i>Host</i> byte order is usually what you want. The byte order only starts to matter as soon as you look at individual bytes ... which you typically do when you serialize the address. Then, a serialization library such as <i>cereal</i> would be the way to go.*Only exception:* You use memcpy or pass the value to foreign functions. Then use the native functions (htonl and co)."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1466774565, "post_id": 37845817, "comment_id": 63471163, "body": "@sapanoia You&#39;re right. Misled by the comment, II thought that <code>HostAddress6</code> stores data in its <code>Word32</code> in such a way that programs can observe the difference depending on the architecture. After examining the source code, parsing <code>struct in6_addr</code> is actually not host dependent. So for using <i>network</i> this shouldn&#39;t be needed at all. While my question still applies, in correct scenarios where (de)serialization is done correctly, it shouldn&#39;t be needed."}], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 7707798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6db8056a055e82f9853610180340cc32?s=128&d=identicon&r=PG", "display_name": "Rafael", "link": "https://stackoverflow.com/users/7707798/rafael"}, "reply_to_user": {"reputation": 33963, "user_id": 1915448, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/51afb9344f8a44e60916753d37186513?s=128&d=identicon&r=PG", "display_name": "g00glen00b", "link": "https://stackoverflow.com/users/1915448/g00glen00b"}, "edited": false, "score": 0, "creation_date": 1489741093, "post_id": 42839635, "comment_id": 72812935, "body": "Apologies, I suppose this is more elaborated."}, {"owner": {"reputation": 33963, "user_id": 1915448, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/51afb9344f8a44e60916753d37186513?s=128&d=identicon&r=PG", "display_name": "g00glen00b", "link": "https://stackoverflow.com/users/1915448/g00glen00b"}, "edited": false, "score": 0, "creation_date": 1489741750, "post_id": 42839635, "comment_id": 72813275, "body": "No problem, this looks a lot better!"}], "tags": [], "owner": {"reputation": 493, "user_id": 7707798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6db8056a055e82f9853610180340cc32?s=128&d=identicon&r=PG", "display_name": "Rafael", "link": "https://stackoverflow.com/users/7707798/rafael"}, "is_accepted": true, "score": 3, "last_activity_date": 1489740977, "last_edit_date": 1489740977, "creation_date": 1489681558, "answer_id": 42839635, "question_id": 37845817, "link": "https://stackoverflow.com/questions/37845817/host-byte-order-and-networks-hostaddress6/42839635#42839635", "title": "Host byte order and network&#39;s HostAddress6", "body": "<p>Yes, there are in <code>System.Endian</code> module within <code>cpu</code> package. I also needed it for my purposes.\nIt has many utility functions for that like:</p>\n\n<p><code>getSystemEndianness :: Endianness</code></p>\n\n<p>gets the current CPU endianess</p>\n\n<p><code>fromLE64 :: Word64 -&gt; Word64</code></p>\n\n<p>from LE64 to platform endianess</p>\n\n<p><code>fromBE64 :: Word64 -&gt; Word64</code></p>\n\n<p>same as above but from BE 64</p>\n\n<p><code>toLE64 :: Word64 -&gt; Word64</code></p>\n\n<p>from CPU's Endianess to LE64</p>\n\n<p><code>toBE64 :: Word64 -&gt; Word64</code></p>\n\n<p>from CPU's Endianess to BE64</p>\n\n<p>Please note that the module provides same functions for Word32 and Word16:\n<a href=\"https://hackage.haskell.org/package/cpu-0.1.2/docs/System-Endian.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/cpu-0.1.2/docs/System-Endian.html</a></p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 42839635, "answer_count": 1, "score": 2, "last_activity_date": 1489740977, "creation_date": 1466024969, "last_edit_date": 1466774666, "question_id": 37845817, "link": "https://stackoverflow.com/questions/37845817/host-byte-order-and-networks-hostaddress6", "title": "Host byte order and network&#39;s HostAddress6", "body": "<p>Is there some ready-made function that converts <code>Word32</code> and <code>Word64</code> between <a href=\"https://en.wikipedia.org/wiki/Endianness#Networking\" rel=\"nofollow\">big/little/host-endian</a> representations? As pointed out in the comments, this shouldn't be needed if (de)serialization is performed correctly, but could be handy in some specific situations when dealing with low-level code.</p>\n\n<p>I found the following solutions, neither perfect:</p>\n\n<ol>\n<li><p>Use <a href=\"https://hackage.haskell.org/package/byteorder-1.0.4/docs/System-ByteOrder.html\" rel=\"nofollow\">byteorder</a> to determine the current host order, and if little-endian, use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Word.html#v:byteSwap32\" rel=\"nofollow\"><code>byteSwap32</code></a> on each word (or alternatively the one from <a href=\"https://hackage.haskell.org/package/base-compat-0.9.0/docs/Data-Word-Compat.html\" rel=\"nofollow\">base-compat</a>.</p>\n\n<pre><code>case byteOrder of\n    LittleEndian -&gt; byteSwap32\n    _ -&gt; id\n</code></pre></li>\n<li><p>Serialize the words with cereal's <a href=\"https://hackage.haskell.org/package/cereal-0.5.2.0/docs/Data-Serialize-Put.html#v:putWord32be\" rel=\"nofollow\"><code>putWord32be</code></a> and immediately read them with <a href=\"https://hackage.haskell.org/package/cereal-0.5.2.0/docs/Data-Serialize-Get.html#v:getWord32host\" rel=\"nofollow\"><code>getWord32host</code></a> (or alternativly <code>putWord32host</code> and read with <code>getWord32be</code>). This adds somewhat more heavy-weight dependency, but gives more flexibility for conversions to other formats.</p>\n\n<pre><code>either (error \"Unexpected error when converting ip address\") id\n. runGet getWord32host . runPut . putWord32be\n</code></pre></li>\n<li><p>Import the native functions:</p>\n\n<pre><code>foreign import ccall unsafe \"htonl\" htonl :: Word32 -&gt; Word32\nforeign import ccall unsafe \"ntohl\" ntohl :: Word32 -&gt; Word32\n</code></pre></li>\n</ol>\n\n<p>Is there anything better or more convenient?</p>\n"}, {"tags": ["haskell", "build", "linker", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466024997, "post_id": 37844501, "comment_id": 63151908, "body": "Check to see if this is your problem: <a href=\"http://stackoverflow.com/questions/37576910/parsec3-blocked-by-parsec-what-ever-i-do\" title=\"parsec3 blocked by parsec what ever i do\">stackoverflow.com/questions/37576910/&hellip;</a>"}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466056251, "post_id": 37844501, "comment_id": 63160575, "body": "How do you figure? In the <code>stack</code> setup file, I specify that the <code>parsec3-numbers</code> package should be built using <code>parsec3</code>. I clear the working directory before starting the build and the first module, which also depends on parsec3, builds fine. What could be the problem then?"}, {"owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "edited": false, "score": 1, "creation_date": 1466854515, "post_id": 37844501, "comment_id": 63496247, "body": "Fix these warnings first: <code>Warning: modules not listed in umecore-hs.cabal for library component</code> <code>Warning: modules not listed in umecore-hs.cabal for &#39;umequery&#39; component</code>"}], "answers": [{"tags": [], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "is_accepted": true, "score": 0, "last_activity_date": 1467230631, "creation_date": 1467230631, "answer_id": 38109088, "question_id": 37844501, "link": "https://stackoverflow.com/questions/37844501/stack-linking-of-executable-fails-in-one-instance-completes-another-why/38109088#38109088", "title": "Stack linking of executable fails in one instance, completes another - why?", "body": "<blockquote>\n  <p>Fix these warnings first: Warning: modules not listed in umecore-hs.cabal for library component Warning: modules not listed in umecore-hs.cabal for 'umequery' component \u2013 thomie Jun 25 at 11:35</p>\n</blockquote>\n\n<p>I think @tomie solved it. Not sure why, but by explicitly including a duplicate of the working package specification also for building the second executable, then it started working. Not sure why the linker complained and not the compiler, but there  you go. It works.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 38109088, "answer_count": 1, "score": 2, "last_activity_date": 1467230631, "creation_date": 1466020187, "last_edit_date": 1466024923, "question_id": 37844501, "link": "https://stackoverflow.com/questions/37844501/stack-linking-of-executable-fails-in-one-instance-completes-another-why", "title": "Stack linking of executable fails in one instance, completes another - why?", "body": "<p>Sorry for asking a bit involved question, but linking an executable using stack fails inexplicably in one instance, but not in another. </p>\n\n<p>This is my project:</p>\n\n<pre><code>$ cat stack.yaml \nextra-package-dbs: []\npackages:\n- umecore-hs\n- fontrans-tools\nextra-deps:\n- parsec3-1.0.1.8\n- parsec3-numbers-0.1.0\nresolver: lts-5.15\nflags:\n      parsec3-numbers:\n        parsec3: true\n</code></pre>\n\n<p>There are two executables being built here, one in each package. \nThe executable section of the cabal file of the first package <code>umecore-hs</code> looks like this:</p>\n\n<pre><code>Executable umequery\n  Main-Is:        umequery.hs\n  Hs-Source-Dirs: src\n  default-language:    Haskell2010\n  build-depends:       base,  parsec3, filepath,  time,  bytestring, unix, cryptohash, optparse-applicative, text, base16-bytestring, utf8-string, transformers, regex-pcre, regex-base, direct-sqlite, text , parsec3-numbers\n</code></pre>\n\n<p>and this builds fine on my OS X 10.11.5 machine:</p>\n\n<pre><code>$ rm -Rf .stack-work/\n$ stack build umecore-hs\nparsec3-1.0.1.8: configure\nparsec3-1.0.1.8: build\nparsec3-1.0.1.8: copy/register\nparsec3-numbers-0.1.0: configure\nparsec3-numbers-0.1.0: build\nparsec3-numbers-0.1.0: copy/register\numecore-hs-0.0.1.0: configure\nConfiguring umecore-hs-0.0.1.0...\numecore-hs-0.0.1.0: build\nPreprocessing library umecore-hs-0.0.1.0...\nIn-place registering umecore-hs-0.0.1.0...\nPreprocessing executable 'umequery' for umecore-hs-0.0.1.0...\nLinking .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/umequery/umequery ...\nWarning: modules not listed in umecore-hs.cabal for library component (add to other-modules):\n    Phonetic.Database.DataTypes\n    Phonetic.Database.QueryGenerator\n    Phonetic.Database.UmeQueryParser\nWarning: modules not listed in umecore-hs.cabal for 'umequery' component (add to other-modules):\n    Phonetic.Database.DataTypes\n    Phonetic.Database.QueryGenerator\n    Phonetic.Database.SegmentList\n    Phonetic.Database.UmeQuery\n    Phonetic.Database.UmeQueryParser\numecore-hs-0.0.1.0: copy/register\nInstalling library in\n/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/lib/x86_64-osx-ghc-7.10.3/umecore-hs-0.0.1.0-GFN6s0Dt0ywEgbkcE9P2if\nInstalling executable(s) in\n/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/bin\nRegistering umecore-hs-0.0.1.0...\nCompleted 3 action(s).\n$ ls -al .stack-work/install/x86_64-osx/lts-5.15/7.10.3/bin\ntotal 14352\ndrwxr-xr-x  3 frkkan96  staff      102 15 Jun 20:54 .\ndrwxr-xr-x  7 frkkan96  staff      238 15 Jun 20:54 ..\n-rwxr-xr-x  1 frkkan96  staff  7347308 15 Jun 20:54 umequery\n</code></pre>\n\n<p>The data and time is when I ran the build command.</p>\n\n<p>Ok, the corresponding section in the second package is:</p>\n\n<pre><code>Executable textgrid_import\n  Main-Is:        textgrid_import.hs\n  Hs-Source-Dirs: src\n  default-language:    Haskell2010\n  build-depends:       base, filepath, directory, optparse-applicative, umecore-hs\n</code></pre>\n\n<p>But, this fails when linking the binary. (I include the verbose output, since this is what is suggested when not using the -v flag):</p>\n\n<pre><code>$ stack build fontrans-tools -v\nVersion 1.1.2, Git revision cebe10e845fed4420b6224d97dcabf20477bbd4b (3646 commits) x86_64 hpack-0.14.0\n2016-06-15 21:33:04.098445: [debug] Checking for project config at: /Users/frkkan96/Documents/src/fonetik/stack.yaml @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Config src/Stack/Config.hs:811:9)\n2016-06-15 21:33:04.099189: [debug] Loading project config file stack.yaml @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Config src/Stack/Config.hs:829:13)\n2016-06-15 21:33:04.100748: [debug] Trying to decode /Users/frkkan96/.stack/build-plan-cache/x86_64-osx/lts-5.15.cache @(stack_JAcs0EuAGbK5rtqRdoxQaL:Data.Binary.VersionTagged src/Data/Binary/VersionTagged.hs:55:5)\n2016-06-15 21:33:04.118010: [debug] Success decoding /Users/frkkan96/.stack/build-plan-cache/x86_64-osx/lts-5.15.cache @(stack_JAcs0EuAGbK5rtqRdoxQaL:Data.Binary.VersionTagged src/Data/Binary/VersionTagged.hs:64:13)\n2016-06-15 21:33:04.118159: [debug] Getting system compiler version @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Setup src/Stack/Setup.hs:341:17)\n2016-06-15 21:33:04.118315: [debug] Run process: ghc --info @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.205724: [debug] Asking GHC for its version @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Setup.Installed src/Stack/Setup/Installed.hs:94:13)\n2016-06-15 21:33:04.205922: [debug] Run process: ghc --numeric-version @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.263388: [debug] Getting Cabal package version @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.GhcPkg src/Stack/GhcPkg.hs:165:5)\n2016-06-15 21:33:04.263520: [debug] Run process: ghc-pkg --no-user-package-db field --simple-output Cabal version @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.310570: [debug] Resolving package entries @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Setup src/Stack/Setup.hs:221:5)\n2016-06-15 21:33:04.310939: [debug] Getting global package database location @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.GhcPkg src/Stack/GhcPkg.hs:48:5)\n2016-06-15 21:33:04.311094: [debug] Run process: ghc-pkg --no-user-package-db list --global @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.391529: [debug] Run process: ghc-pkg --global --no-user-package-db dump --expand-pkgroot @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.448712: [debug] Ignoring package Cabal due to wanting version 1.22.8.0 instead of 1.22.5.0 @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Installed src/Stack/Build/Installed.hs:189:5)\n2016-06-15 21:33:04.448902: [debug] Ignoring package haskeline due to wanting version 0.7.2.3 instead of 0.7.2.1 @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Installed src/Stack/Build/Installed.hs:189:5)\n2016-06-15 21:33:04.449016: [debug] Ignoring package terminfo due to wanting version 0.4.0.2 instead of 0.4.0.1 @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Installed src/Stack/Build/Installed.hs:189:5)\n2016-06-15 21:33:04.449166: [debug] Run process: ghc-pkg --user --no-user-package-db --package-db /Users/frkkan96/.stack/snapshots/x86_64-osx/lts-5.15/7.10.3/pkgdb dump --expand-pkgroot @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.514425: [debug] Run process: ghc-pkg --user --no-user-package-db --package-db /Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/pkgdb dump --expand-pkgroot @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.561464: [debug] Trying to decode /Users/frkkan96/.stack/indices/Hackage/00-index.cache @(stack_JAcs0EuAGbK5rtqRdoxQaL:Data.Binary.VersionTagged src/Data/Binary/VersionTagged.hs:55:5)\n2016-06-15 21:33:04.824920: [debug] Success decoding /Users/frkkan96/.stack/indices/Hackage/00-index.cache @(stack_JAcs0EuAGbK5rtqRdoxQaL:Data.Binary.VersionTagged src/Data/Binary/VersionTagged.hs:64:13)\n2016-06-15 21:33:04.839361: [debug] Getting global package database location @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.GhcPkg src/Stack/GhcPkg.hs:48:5)\n2016-06-15 21:33:04.839468: [debug] Run process: ghc-pkg --no-user-package-db list --global @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:04.875790: [info] fontrans-tools-0.0.1.0: configure @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:731:23)\n2016-06-15 21:33:04.876185: [debug] Run process: /Users/frkkan96/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.5.0 configure --with-ghc=/Applications/ghc-7.10.3.app/Contents/bin/ghc --with-ghc-pkg=/Applications/ghc-7.10.3.app/Contents/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/Users/frkkan96/.stack/snapshots/x86_64-osx/lts-5.15/7.10.3/pkgdb --package-db=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/pkgdb --libdir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/lib --bindir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/bin --datadir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/share --libexecdir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/libexec --sysconfdir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/etc --docdir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/doc/fontrans-tools-0.0.1.0 --htmldir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/doc/fontrans-tools-0.0.1.0 --haddockdir=/Users/frkkan96/Documents/src/fonetik/.stack-work/install/x86_64-osx/lts-5.15/7.10.3/doc/fontrans-tools-0.0.1.0 --dependency=base=base-4.8.2.0-cc43d8e06aa74e9c4c0132becc49ee25 --dependency=directory=directory-1.2.2.0-afaac10d677f7107a807fb2fd0eca9f4 --dependency=filepath=filepath-1.4.0.0-f97d1e4aebfd7a03be6980454fe31d6e --dependency=optparse-applicative=optparse-applicative-0.12.1.0-632ff9350432005d4b6860a3720a6388 --dependency=parsec3=parsec3-1.0.1.8-5688cfaeca7a269c6253ee69a4a21ff3 --dependency=parsec3-numbers=parsec3-numbers-0.1.0-1da0360a989926d6fcebdf3a7f1f97f7 --dependency=text=text-1.2.2.1-3d0a931105ed331bf2fb8b46dcae08ba --dependency=umecore-hs=umecore-hs-0.0.1.0-aa9f7170502bcbb7414f68ed6634ef50 --enable-tests --enable-benchmarks @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:05.517871: [info] Configuring fontrans-tools-0.0.1.0... @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:05.751514: [info] fontrans-tools-0.0.1.0: build @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:731:23)\n2016-06-15 21:33:05.751664: [debug] Run process: /Users/frkkan96/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.5.0 build lib:fontrans-tools exe:textgrid_import --ghc-options \" -ddump-hi -ddump-to-file\" @(stack_JAcs0EuAGbK5rtqRdoxQaL:System.Process.Read src/System/Process/Read.hs:283:3)\n2016-06-15 21:33:05.822999: [info] Preprocessing library fontrans-tools-0.0.1.0... @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:05.924541: [info] [1 of 1] Compiling Phonetic.IPA.IPAParser ( src/Phonetic/IPA/IPAParser.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Phonetic/IPA/IPAParser.o ) @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:06.616139: [info] In-place registering fontrans-tools-0.0.1.0... @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:06.616305: [info] Preprocessing executable 'textgrid_import' for fontrans-tools-0.0.1.0... @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:06.702453: [info] [1 of 1] Compiling Main             ( src/textgrid_import.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/textgrid_import/textgrid_import-tmp/Main.o ) @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.173423: [info] Linking .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/textgrid_import/textgrid_import ... @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.531282: [warn] Undefined symbols for architecture x86_64: @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.531443: [warn]   \"_umecozuGFN6s0Dt0ywEgbkcE9P2if_PhoneticziDatabaseziDataTypes_UmeQuery_con_info\", referenced from: @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.531618: [warn]       _ceTP_info in libHSumecore-hs-0.0.1.0-GFN6s0Dt0ywEgbkcE9P2if.a(TextgridParser.o) @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.548450: [warn] ld: symbol(s) not found for architecture x86_64 @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n2016-06-15 21:33:07.552040: [warn] clang: error: linker command failed with exit code 1 (use -v to see invocation) @(stack_JAcs0EuAGbK5rtqRdoxQaL:Stack.Build.Execute src/Stack/Build/Execute.hs:911:67)\n\n--  While building package fontrans-tools-0.0.1.0 using:\n      /Users/frkkan96/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.5.0 build lib:fontrans-tools exe:textgrid_import --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>How come the same linker on the same machine fails to link in the second case?\nThe one thing I can think of is that the second package loads libraries from the first package, but this should be possible, I think?</p>\n"}, {"tags": ["haskell", "generics", "quickcheck"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1466015936, "post_id": 37843132, "comment_id": 63147049, "body": "<a href=\"http://hackage.haskell.org/package/generic-random\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/generic-random</a> ?"}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1466016303, "post_id": 37843132, "comment_id": 63147275, "body": "Hmm, I&#39;m looking at it right now. It seems to be going in the direction I need."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1466016777, "post_id": 37843132, "comment_id": 63147560, "body": "This functionality is also available in <a href=\"https://hackage.haskell.org/package/regular-extras\" rel=\"nofollow noreferrer\">regular-extras</a>. I don&#39;t know how it compares to <code>generic-random</code>."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1466020331, "post_id": 37843132, "comment_id": 63149525, "body": "It might be interesting to look at <code>liftM2</code> operator and its siblings. Your case is the same as: `  case packetID of     0x00 -&gt; liftM3 Packet1 a a a; 0x01 -&gt; liftM  Packet2 a;     0x02 -&gt; liftM5 Packet3 a a a a a; 0x03 -&gt; liftM7 Packet4 a a a a a a a;     where a = arbitrary`"}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 0, "creation_date": 1466020632, "post_id": 37843132, "comment_id": 63149684, "body": "I&#39;ve been playing around with generic-random and it&#39;s accomplishing what I had wanted, but I&#39;m now getting <code>uncaught exception: ErrorCall (no representation.) Exception thrown while printing test case: &#39;No representation.&#39;</code> from Quickcheck and I&#39;m not sure what&#39;s generating it. Right now, all I can tell is that it doesn&#39;t like data constructors that have <code>ByteString</code> as an argument. I have no idea why. I&#39;m currently testing it on pretty simple examples."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1466103977, "post_id": 37843132, "comment_id": 63191801, "body": "there is a PR to add generic derivation to <code>QuickCheck</code>, but it needs some care: <a href=\"https://github.com/nick8325/quickcheck/pull/40\" rel=\"nofollow noreferrer\">github.com/nick8325/quickcheck/pull/40</a>"}], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": true, "score": 8, "last_activity_date": 1474820638, "creation_date": 1474820638, "answer_id": 39689127, "question_id": 37843132, "link": "https://stackoverflow.com/questions/37843132/generically-derive-arbitrary-for-massive-algebraic-data-types/39689127#39689127", "title": "Generically derive Arbitrary for massive algebraic data types?", "body": "<p>Daniel Wagner mentioned in the comments that <a href=\"https://hackage.haskell.org/package/generic-random\" rel=\"noreferrer\">generic-random</a> is capable of doing this. It was the library I was looking for, but the docs didn't make it obvious to me that such was the case. Recent to the time of this writing, Brent Yorgey posted a pretty clear tutorial on his blog that went into detail as to how to use <code>generic-random</code> to do what I was asking about and more. <a href=\"https://byorgey.wordpress.com/2016/09/20/the-generic-random-library-part-1-simple-generic-arbitrary-instances/\" rel=\"noreferrer\">The blog post can be found here.</a></p>\n\n<p>For my case, the solution is simple. Using <code>Generic.Random.Generic</code> from <code>generic-random</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport Generic.Random.Generic\nimport GHC.Generics\n\ndata ProtocolPacket\n  = Packet1 Word8 Text Int8\n  | Packet2 Text\n  | Packet3 Int Text Text Text Text\n  | Packet4 Int Double Double Double Int16 Int16 Int16\n  ...\n  deriving (Show,Eq,Generic)\n\ninstance Arbitrary ProtocolPacket where\n  arbitrary = genericArbitrary\n</code></pre>\n"}], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 705, "favorite_count": 1, "accepted_answer_id": 39689127, "answer_count": 1, "score": 12, "last_activity_date": 1474820638, "creation_date": 1466015353, "question_id": 37843132, "link": "https://stackoverflow.com/questions/37843132/generically-derive-arbitrary-for-massive-algebraic-data-types", "title": "Generically derive Arbitrary for massive algebraic data types?", "body": "<p>I've got a protocol that I've typed like so:</p>\n\n<pre><code>data ProtocolPacket\n  = Packet1 Word8 Text Int8\n  | Packet2 Text\n  | Packet3 Int Text Text Text Text\n  | Packet4 Int Double Double Double Int16 Int16 Int16\n  ...\n  deriving (Show,Eq)\n</code></pre>\n\n<p>In addition, I've implemented serialization/deserialization code for each packet. Naturally, I would like to test this protocol in Quickcheck and make sure that serializing and deserializing any packet for any combination of inputs will give me back exactly what I put in. So I go ahead and implement these packets for the <code>Arbitrary</code> type class like so:</p>\n\n<pre><code>instance Arbitrary ProtocolPacket where\n  arbitrary = do\n  packetID &lt;- choose (0x00,...) :: Gen Word8\n  case packetID of\n    0x00 -&gt; do\n      a &lt;- arbitrary\n      b &lt;- arbitrary\n      c &lt;- arbitrary\n      return $ Packet1 a b c\n    0x01 -&gt; do\n      a &lt;- arbitrary\n      return $ Packet2 a\n    0x02 -&gt; do\n      a &lt;- arbitrary\n      b &lt;- arbitrary\n      c &lt;- arbitrary\n      d &lt;- arbitrary\n      e &lt;- arbitrary\n      return $ Packet3 a b c d e\n    0x03 -&gt; do\n      a &lt;- arbitrary\n      b &lt;- arbitrary\n      c &lt;- arbitrary\n      d &lt;- arbitrary\n      e &lt;- arbitrary\n      f &lt;- arbitrary\n      g &lt;- arbitrary\n      return $ Packet4 a b c d e f g\n    ...\n</code></pre>\n\n<p>Assume that I've gone ahead and defined <code>Arbitrary</code> for all relevant data constructor arguments that don't have <code>Arbitrary</code> defined out of the box, such code needs to be hand-written by me in order for the packet fields to be populated with meaningful data. But that's it.</p>\n\n<p>But as you can see, I'm repeating myself <em>a lot</em> for something that is just grunt work. And this is a small sample of what I'm actually dealing with. Ideally, I would like to be able to just do this:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport GHC.Generics\n\ndata ProtocolPacket\n  = Packet1 Word8 Text Int8\n  | Packet2 Text\n  | Packet3 Int Text Text Text Text\n  | Packet4 Int Double Double Double Int16 Int16 Int16\n  ...\n  deriving (Show,Eq,Generic)\n\ninstance Arbitrary ProtocolPacket\n</code></pre>\n\n<p>like I can do with <code>FromJSON</code> and <code>ToJSON</code>, but this doesn't work. Is there there a method that does?</p>\n"}, {"tags": ["haskell", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1466016574, "post_id": 37842921, "comment_id": 63147434, "body": "Yes, yes, lambda equivalence (or some such...)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1466014682, "creation_date": 1466014682, "answer_id": 37842921, "question_id": 37842844, "link": "https://stackoverflow.com/questions/37842844/state-where-the-resulting-state-is-the-argument-provided-and-the-value-is-unit/37842921#37842921", "title": "State where the resulting state is the argument provided and the value is unit", "body": "<pre><code>put' s = state $ \\s -&gt; ((), s)\n     ^            ^\n</code></pre>\n\n<p>You reused the variable <code>s</code> for two different bindings. Try using a different name, and the solution will be obvious ;-)</p>\n\n<p>By the way, you should enable warnings using the <code>-Wall</code> flag in GHC / GHCi. This would have pointed out that you have defined <code>s</code> twise, and the second binding shadows the first one.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 37842921, "answer_count": 1, "score": -2, "last_activity_date": 1466014682, "creation_date": 1466014429, "question_id": 37842844, "link": "https://stackoverflow.com/questions/37842844/state-where-the-resulting-state-is-the-argument-provided-and-the-value-is-unit", "title": "State where the resulting state is the argument provided and the value is unit", "body": "<p>Exercise <code>23.8.2</code> in the haskell book asks me to construct a state like the following:</p>\n\n<pre><code>put' :: s -&gt; State s ()\nput' s = undefined\n-- should act like:\n-- Prelude&gt; runState (put \"blah\") \"woot\"\n-- ((),\"blah\")\n</code></pre>\n\n<p>The only implementation I have gotten to typecheck is </p>\n\n<pre><code>import Control.Monad.Trans.State -- Not sure this is the right import\nput' :: s -&gt; State s ()\nput' s = state $ \\s -&gt; ((), s)\n</code></pre>\n\n<p>But this returns the state in the argument of <code>runState</code>, not <code>put'</code>:</p>\n\n<pre><code>\u03bb&gt; runState (put' \"blah\") \"woot\"\n((),\"woot\")\n</code></pre>\n\n<p>What haskell acrobatics do I need to fix this? Do not see how I can access the <code>\"blah\"</code>.</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1466004703, "post_id": 37836187, "comment_id": 63140364, "body": "could you provide the error message you get? What have you tried, what have you looked at? please also note that name shadowing is should be avoided - if possible!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1466009408, "post_id": 37836187, "comment_id": 63143462, "body": "You appear new to the use of <code>IO</code>. I encourage you to read through a tutorial on this topic, like <a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">IO for people who simply don&#39;t care</a>, then take another stab at this."}], "answers": [{"tags": [], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "is_accepted": false, "score": 0, "last_activity_date": 1466013370, "creation_date": 1466013370, "answer_id": 37842518, "question_id": 37836187, "link": "https://stackoverflow.com/questions/37836187/how-to-search-within-a-text-file-for-a-substring-using-withasync-in-haskell/37842518#37842518", "title": "How to search within a text file for a substring using withAsync in Haskell?", "body": "<p>I don't know how you'd go about reading every line of the file sequentially. But here is a function to determine if a file contains a line with the given prefix:</p>\n\n<pre><code>containsPrefix :: FilePath -&gt; String -&gt; IO Bool\nfilePath `containsPrefix` prefix\n  = any (isInfixOf prefix) . lines &lt;$&gt; readFile filePath\n</code></pre>\n\n<p>Disclaimer: The file will be read sequentially.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1466021200, "post_id": 37843853, "comment_id": 63149983, "body": "Out of curiosity, is there any speedup (if not in general, maybe for some pathological edge cases)?"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1466021346, "post_id": 37843853, "comment_id": 63150060, "body": "@Alec Haven&#39;t tested that... sorry. Perhaps for large files there might be improvements, but then, the performance might be degraded due to loading hue amounts of data into RAM - or perhaps not, due to laziness. Feel free to write a benchmark and get back to us =)"}], "tags": [], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "is_accepted": false, "score": 1, "last_activity_date": 1466018407, "last_edit_date": 1466018407, "creation_date": 1466017685, "answer_id": 37843853, "question_id": 37836187, "link": "https://stackoverflow.com/questions/37836187/how-to-search-within-a-text-file-for-a-substring-using-withasync-in-haskell/37843853#37843853", "title": "How to search within a text file for a substring using withAsync in Haskell?", "body": "<h2>About monads</h2>\n\n<p>Forget about the <code>IO</code> for a minute, while you might believe that <code>do</code> notation has to do with <code>IO</code>, that is a common misconception. <code>IO</code> is just a monad that allows you to describe actions dealing with the real world. Understanding monads is the important part for now.\nTo put it concisely, monads define sequential composition, or \"do this, then that\", which is evidenced by <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>. In imperative languages, everything lives inside <code>IO</code> and <code>&gt;&gt;=</code> is the same as <code>;</code>. <a href=\"http://dev.stephendiehl.com/hask/#eightfold-path-to-monad-satori\" rel=\"nofollow\">Read up on how monads and bind (<code>&gt;&gt;=</code>) works.</a></p>\n\n<h2>Some remarks</h2>\n\n<p>Specifically, you want to do a <code>fold</code> over a list of <code>async</code> operations with possible early termination.</p>\n\n<p>Make sure you understand <code>asyncContainsPrefix</code>, as <code>fileContainsPrefix</code> is the trivial part. Essentially, <code>joinAsync False (\\r -&gt; if r then pure True else Nothing)</code> is a short-circuiting and concurrent version of <code>any</code>. The other part of the function is about describing the <code>async</code> computations.</p>\n\n<h2>Code</h2>\n\n<p>I got the following to work... It uses <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow\">pointfree</a> style Haskell and is in (almost) <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow\">eta-reduced</a> form:</p>\n\n<pre><code>import Data.List (isInfixOf)\n\nimport Control.Monad (forM, mapM_, liftM2)\n\nimport Control.Concurrent.Async\n\nimport Test.QuickCheck\nimport Test.QuickCheck.Monadic (monadicIO, run)\n\nmain :: IO ()\nmain = do\n    contains &lt;- fileContainsPrefix \"to_be_found\" \"myfile.txt\"\n    putStrLn $ if contains then \"yes\" else \"no\"\n\n--------------------------------------------------------------------------------\n-- API:\n--------------------------------------------------------------------------------\n\nfileContainsPrefix :: FilePath -&gt; String -&gt; IO Bool\nfileContainsPrefix file prefix = lines &lt;$&gt; readFile file &gt;&gt;=\n                                 asyncContainsPrefix prefix\n\nasyncContainsPrefix :: Eq a =&gt; [a] -&gt; [[a]] -&gt; IO Bool\nasyncContainsPrefix prefix ls =\n    forM ls (async . pure . isInfixOf prefix)\n    &gt;&gt;= joinAsync False (\\r -&gt; if r then pure True else Nothing)\n\njoinAsync :: b -&gt; (a -&gt; Maybe b) -&gt; [Async a] -&gt; IO b\njoinAsync z handler []     = pure z\njoinAsync z handler (a:as) =\n    handler &lt;$&gt; wait a &gt;&gt;=\n    maybe (joinAsync z handler as) ((mapM_ cancel as &gt;&gt;) . pure)\n\n--------------------------------------------------------------------------------\n-- Tests:\n--------------------------------------------------------------------------------\n\nprop_async_seq :: Eq a =&gt; [a] -&gt; [[a]] -&gt; Property\nprop_async_seq prefix ls = monadicIO $\n    liftM2 (==) (pure $ containsPrefix prefix ls)\n                (run  $ asyncContainsPrefix   prefix ls)\n\ncontainsPrefix :: Eq a =&gt; [a] -&gt; [[a]] -&gt; Bool\ncontainsPrefix = any . isInfixOf\n</code></pre>\n\n<h2><a href=\"https://hackage.haskell.org/package/QuickCheck\" rel=\"nofollow\">QuickCheck testing</a></h2>\n\n<pre><code>$ ghci Mult.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Mult.hs, interpreted )\nOk, modules loaded: Main.\n\u03bb&gt; quickCheck prop_async_seq\n+++ OK, passed 100 tests.\n</code></pre>\n"}], "owner": {"reputation": 442, "user_id": 2120194, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/WeTpl.jpg?s=128&g=1", "display_name": "superlinux", "link": "https://stackoverflow.com/users/2120194/superlinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1466018407, "creation_date": 1465995570, "question_id": 37836187, "link": "https://stackoverflow.com/questions/37836187/how-to-search-within-a-text-file-for-a-substring-using-withasync-in-haskell", "title": "How to search within a text file for a substring using withAsync in Haskell?", "body": "<p>What I want to actually achieve is to write a program in haskell . The program is a multi-threaded text file search engine by breaking a text file into a list of lines. Each line must use the function <em>isInfixOf</em> from the module <em>Data.List</em> which should be put inside the function  <em>withAsync</em> from the module <em>Control.Concurrent.Async</em> . The result of the  will say True if the word I want to search for is found in the file.</p>\n\n<p>I know the following code is incorrect but I am on the right path. I hope someone fixes it for me:</p>\n\n<pre><code>import System.Directory\nimport Control.Concurrent\nimport System.FilePath\nimport Control.Concurrent.Async\nimport System.Environment\nimport Data.List hiding (find)\nimport Control.Monad\nimport Control.Exception\n\nloop [] = return Nothing\nloop (a:as) = do                     -- &lt;4&gt;\n  r &lt;- wait a\n  case r of\n    Nothing -&gt; loop as\n    Just a  -&gt; return (Just a)\n\n\n\nmain = do\n         let lines =readFile (\"myfile.txt\")\n         let keyword=\"to_be_found\"\n         let asyncs=[]\n\n         forM lines $ \\line -&gt; do \n                                     asyncs &lt;- async (print $ isInfixOf keyword line) ++ asyncs\n\n\n         loop asyncs\n</code></pre>\n"}, {"tags": ["haskell", "queue"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466007375, "post_id": 37835674, "comment_id": 63142279, "body": "Typically, we think of dequeueing as taking from the front, expressed by a type signature like <code>dequeue :: t a -&gt; Maybe (a, t a)</code>. Unrelated: multi-parameter type classes and functional dependencies offer a somewhat nicer expression. <code>class Queue el q | q -&gt; el where { enqueue :: q -&gt; el -&gt; q; dequeue :: q -&gt; Maybe (el, q) }</code>. This allows monomorphic (e.g., unboxed) queues to instantiate the class."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465995096, "post_id": 37835773, "comment_id": 63133094, "body": "I understand it now. But struggle to solve it. What should I useful return next to ss?"}, {"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "reply_to_user": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1466277607, "post_id": 37835773, "comment_id": 63254554, "body": "@Vendetta, I added some more explanation about the types. I see the other answer deals with queue implementation"}], "tags": [], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "is_accepted": false, "score": 4, "last_activity_date": 1466277552, "last_edit_date": 1466277552, "creation_date": 1465994476, "answer_id": 37835773, "question_id": 37835674, "link": "https://stackoverflow.com/questions/37835674/dequeue-function-of-a-list-in-haskell/37835773#37835773", "title": "dequeue function of a list in haskell", "body": "<p>Look at the type signature for dequeue:</p>\n\n<pre><code>dequeue :: t a -&gt; Maybe (t a, a)\n</code></pre>\n\n<p>...and compare it to what you actually return in that line:</p>\n\n<pre><code>dequeue (Enqueue a (ss)) = Just(ss)\n</code></pre>\n\n<p>The types don't match. Can you fix it now?</p>\n\n<hr>\n\n<p><strong>Walkthrough</strong></p>\n\n<p>The type of <code>dequeue</code> is <code>t a -&gt; Maybe (t a, a)</code>, which means it takes one argument of type <code>t a</code> and should return a value of type <code>Maybe (t a, a)</code>.</p>\n\n<p>Breaking that type down, we start at the outermost 'thing': <code>Maybe</code> (the 'thing' is known as a type constructor). So whatever we return must be either <code>Nothing</code> or <code>Just &lt;some value&gt;</code>.\nWhat goes into the <code>Just</code> is what's \"inside the <code>Maybe</code>\", in this case a value of type <code>(t a, a)</code>, which is a tuple (pair) of <code>t a</code> and an <code>a</code>.</p>\n\n<p>Now look at what your code said:</p>\n\n<pre><code>dequeue (Enqueue a (ss)) = Just(ss)\n</code></pre>\n\n<p>The return value <code>Just(ss)</code> can be written as <code>Just ss</code>. Let's determine the type of that <code>ss</code>. Since we define:</p>\n\n<pre><code>data DQueue a = Empty | Enqueue a (DQueue a)\n                                  ^^^^^^^^^^ &lt;-- ss is of this type\n</code></pre>\n\n<p>The type of <code>ss</code> is therefore <code>DQueue a</code>. So the type of <code>Just ss</code> is: <code>Maybe (DQueue a)</code>.</p>\n\n<p>Now, we need to return <code>Maybe (t a, a)</code>. In our instance of the <code>Queue</code> class, the <code>t</code> is <code>DQueue</code> so the type to return is more specifically: <code>Maybe (DQueue a, a)</code>, but we currently have <code>Maybe (DQueue a)</code> (remember <code>ss</code> is a <code>DQueue a</code>, so <code>Just ss</code> is <code>Maybe (DQueue a)</code>).</p>\n\n<p>So to fix that, instead of <code>Just ss</code>, we should return <code>Just (some pair)</code>. The pair depends on how we want <code>dequeue</code> to behave. If it's like a stack which pops off the last enqueued result, it can be <code>Just (ss, a)</code>. Otherwise, see the other answer which discusses how to implement it.</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465995128, "post_id": 37835793, "comment_id": 63133113, "body": "By doing this I get the following error: expected: Just (Enqueue 1 (Enqueue 2 (Enqueue 3 Empty)),4)  but got: Just (Enqueue 2 (Enqueue 3 (Enqueue 4 Empty)),1)"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465995409, "post_id": 37835793, "comment_id": 63133338, "body": "That sounds like a different problem with your unit test setup. Are your expectations correct?"}, {"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465995609, "post_id": 37835793, "comment_id": 63133509, "body": "They seem to be correct. I have the following test cases: <code>dequeue sample1 ~?= (Just (Enqueue 1 $ Enqueue 2 $ Enqueue 3 Empty,4))</code>"}, {"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465995632, "post_id": 37835793, "comment_id": 63133531, "body": "<code>dequeue sample2 ~?= (Just (Enqueue &quot;a&quot; $ Enqueue &quot;b&quot; $ Enqueue &quot;c&quot; Empty,&quot;d&quot;))</code>"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465996653, "post_id": 37835793, "comment_id": 63134277, "body": "I updated my answer since I was originally showing the functionality of a stack (push/pop) rather than a queue."}, {"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465996968, "post_id": 37835793, "comment_id": 63134527, "body": "Ok, but now it return always &quot;Nothing&quot; ."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465997018, "post_id": 37835793, "comment_id": 63134558, "body": "You must have caught it before a quick edit because missed a line. Try again"}, {"owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465997297, "post_id": 37835793, "comment_id": 63134765, "body": "Thank you, it works fine now! Can you shortly explain me, what exactly it is doing now? I would like to understand it. :)"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "edited": false, "score": 0, "creation_date": 1465997854, "post_id": 37835793, "comment_id": 63135183, "body": "I&#39;ve added additional detail and an additional way of writing that last <code>dequeue</code> pattern."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 4, "last_activity_date": 1465997828, "last_edit_date": 1465997828, "creation_date": 1465994522, "answer_id": 37835793, "question_id": 37835674, "link": "https://stackoverflow.com/questions/37835674/dequeue-function-of-a-list-in-haskell/37835793#37835793", "title": "dequeue function of a list in haskell", "body": "<p>Based on your <code>Queue</code> class, your <code>dequeue</code> function has to return the queue after having removed the element. It should probably be defined as</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>dequeue Empty = Nothing\ndequeue (Enqueue a Empty) = Just (Empty, a)\ndequeue (Enqueue a (ss)) = do\n  (next, v) &lt;- dequeue ss\n  return (Enqueue a next, v)\n</code></pre>\n\n<p>This definition assumes you are queuing things up at the beginning of the list and dequeuing them from the end.</p>\n\n<p>The third <code>dequeue</code> match is recursively calling <code>dequeue</code> to walk to the end of the list, where it picks up the list value (see the second <code>dequeue</code> match), then it builds up the Enqueue list again with all but the last element.</p>\n\n<p>This above example takes advantage of the <code>Maybe</code> monad and <code>do</code> syntax. It could be expressed as the following, if that makes more sense:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>dequeue (Enqueue a ss) =\n  case dequeue ss of\n    Just (next, v) -&gt; Just (Enqueue a next, v)\n    Nothing -&gt; Nothing\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1466277552, "creation_date": 1465994241, "last_edit_date": 1465994339, "question_id": 37835674, "link": "https://stackoverflow.com/questions/37835674/dequeue-function-of-a-list-in-haskell", "title": "dequeue function of a list in haskell", "body": "<p>So I have the following code: </p>\n\n<pre><code>module Queue where\n\nclass Queue t \n  where\n    enqueue :: t a -&gt; a -&gt; t a\n    dequeue :: t a -&gt; Maybe (t a, a)    \n</code></pre>\n\n<p>--and: </p>\n\n<pre><code>module DataQueue where\n\nimport Queue\ndata DQueue a = Empty | Enqueue a (DQueue a)\n    deriving (Eq, Show, Read)\n\ninstance Queue DQueue\n  where\n    enqueue (Empty) s = Enqueue s (Empty)\n    enqueue (Enqueue v ss) s = Enqueue s (Enqueue v ss)\n\n    dequeue Empty = Nothing\n    dequeue (Enqueue a (ss)) = Just(ss)\n</code></pre>\n\n<p>I add an element to a list (enqueue), which works fine. Also I remove an element of the list with the dequeue function. Somehow I get an error for the last line of my dequeue function. It says:</p>\n\n<blockquote>\n  <p>\"Couldn't match expected type <code>(DQueue a, a)</code> with actual type <code>DQueue a</code>\" </p>\n</blockquote>\n\n<p>I really don't understand how to solve this problem. </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465987228, "post_id": 37832884, "comment_id": 63127340, "body": "No. <code>takeWhile even</code> is an expression whose value is a function with only <b>one</b> argument.  You have to find the type of <code>takeWhile even :: ?</code>."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 1, "creation_date": 1465987631, "post_id": 37832884, "comment_id": 63127640, "body": "Hint: you need the type signature of <code>even</code> and then overlay it with the type signature of <code>takeWhile</code>."}, {"owner": {"reputation": 5, "user_id": 2775181, "user_type": "registered", "profile_image": "https://graph.facebook.com/1551491381/picture?type=large", "display_name": "Aleksei Sery", "link": "https://stackoverflow.com/users/2775181/aleksei-sery"}, "edited": false, "score": 1, "creation_date": 1465988257, "post_id": 37832884, "comment_id": 63128090, "body": "So something like takeWhile even :: [Int]-&gt;[Int]"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465988326, "post_id": 37832884, "comment_id": 63128138, "body": "<code>[Int]-&gt;[Int]</code> is indeed a possible instantiation of <code>takeWhile even</code>, but it&#39;s not the most general one."}, {"owner": {"reputation": 5, "user_id": 2775181, "user_type": "registered", "profile_image": "https://graph.facebook.com/1551491381/picture?type=large", "display_name": "Aleksei Sery", "link": "https://stackoverflow.com/users/2775181/aleksei-sery"}, "edited": false, "score": 1, "creation_date": 1465988620, "post_id": 37832884, "comment_id": 63128346, "body": "Then would this be considered correct takeWhile even :: (Num a) =&gt; [a]-&gt;[a]"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465989421, "post_id": 37832884, "comment_id": 63128883, "body": "Well, almost. The signature is right, but the <code>Num</code> constraint is not strong enough. \u2014 You&#39;re aware that GHCi <code>:t</code> will easily show you the type (be it declared or inferred) of any expression, right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465992179, "post_id": 37832884, "comment_id": 63130980, "body": "GHCi says <code>even :: Integral a =&gt; a -&gt; Bool</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1465997390, "post_id": 37832884, "comment_id": 63134840, "body": "check out this <a href=\"http://stackoverflow.com/a/23316814/849891\">general scheme</a> for  dealing with types."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466006964, "post_id": 37839346, "comment_id": 63142008, "body": "&quot;Bound to&quot; usually means something else. Maybe use &quot;constrained by&quot;? I&#39;m not really sure how to express that occasionally in English."}, {"owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466040423, "post_id": 37839346, "comment_id": 63156393, "body": "@dfeuer You are right, &quot;constrained by&quot; would probably be more accurate in this case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466041560, "post_id": 37839346, "comment_id": 63156647, "body": "Oh boy, I just saw that my comment about wording had an auto-correct error. I meant <i>accurately</i>, not <i>occasionally</i>."}], "tags": [], "owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "is_accepted": true, "score": 2, "last_activity_date": 1466006869, "last_edit_date": 1466006869, "creation_date": 1466003533, "answer_id": 37839346, "question_id": 37832884, "link": "https://stackoverflow.com/questions/37832884/type-of-the-haskell-expression-takewhile-even/37839346#37839346", "title": "Type of the Haskell expression takeWhile even", "body": "<p>To derive the type signature of <code>takeWhile even</code> you need to first take a look at the type signature for <code>takeWhile</code> and <code>even</code>. According to GHCi, the type signatures for those functions are the following.</p>\n\n<pre><code>takeWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n\neven :: Integral a =&gt; a -&gt; Bool\n</code></pre>\n\n<p>In the case of <code>takeWhile even</code>, <code>takeWhile</code> takes in a function of type <code>(a -&gt; Bool)</code>, thus a function that takes in some value of type <code>a</code> and returns a <code>Bool</code>.</p>\n\n<p>The <code>even</code> function takes in an <code>Integral</code> value and returns a <code>Bool</code> value, so it can be passed in as the first argument to <code>takeWhile</code>. Since the <code>Integral</code> typeclass is implemented by several different types such as <code>Int</code> and <code>Integer</code>, you can pass in a value of any such type that implements the <code>Integer</code> typeclass.</p>\n\n<p>You will want to notice that in <code>takeWhile</code>, the <code>a</code> in <code>(a -&gt; Bool)</code> is not bound to any typeclass, however in <code>even</code> the corresponding <code>a</code> is bound to the <code>Integral</code> typeclass. In this case, this causes the resulting expression to bind the <code>a</code> in the <code>takeWhile</code> type signature to <code>Integral</code>. For example, you could imagine <code>takeWhile</code> to have the following type signature in this case:</p>\n\n<pre><code>takeWhile :: Integral a =&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Also, since the first argument of <code>takeWhile</code> is filled by <code>even</code>, the type signature of the resulting expression does not have the <code>(a -&gt; Bool)</code> term.</p>\n\n<p>Thus, you are left with the following type signature for <code>takeWhile even</code>. Therefore <code>takeWhile even</code> takes in a list of <code>Integral</code> values and returns a list of <code>Integral</code> values of the same type.</p>\n\n<pre><code>takeWhile even :: Integral a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>If you want to confirm this using GHCi, you can run the following command to get the type signature of the expression:</p>\n\n<pre><code>:t takeWhile even\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 2775181, "user_type": "registered", "profile_image": "https://graph.facebook.com/1551491381/picture?type=large", "display_name": "Aleksei Sery", "link": "https://stackoverflow.com/users/2775181/aleksei-sery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 1, "accepted_answer_id": 37839346, "answer_count": 1, "score": 0, "last_activity_date": 1466006869, "creation_date": 1465986667, "last_edit_date": 1465987267, "question_id": 37832884, "link": "https://stackoverflow.com/questions/37832884/type-of-the-haskell-expression-takewhile-even", "title": "Type of the Haskell expression takeWhile even", "body": "<p>If anyone can help me out with clearing this question?</p>\n\n<p>The Standard Prelude function takeWhile has type <code>(a -&gt; Bool) -&gt; [a] -&gt; [a]</code></p>\n\n<p>Write down the type of the Haskell expression <code>takeWhile even</code>\nThe function <code>even</code> is defined as:</p>\n\n<pre><code>even x = x `mod` 2 == 0\n</code></pre>\n\n<p>Would this be considered right?</p>\n\n<pre><code>takeWhile:: Num a =&gt; (a-&gt;Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1465998427, "post_id": 37830211, "comment_id": 63135624, "body": "I&#39;m not sure that replicateM would have to read all sample in memory. I might be wrong."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1466002309, "post_id": 37830211, "comment_id": 63138614, "body": "@mb14 It of course will!! <code>replicateM</code> like <code>sequence</code>, <code>traverse</code> and <code>mapM</code> only make sense where you are treating lists like arrays. You might as well use a real array type from e.g. <code>vector</code> As soon as you see those words, think &quot;Maybe a streaming library?&quot;. On long lists they will <i>always</i> accumulate the list and cause a space leak. This is why we have the streaming libraries. (It is possible e.g. to specialize <code>replicateM</code> &amp; company to IO and then use something like lazy io, see <a href=\"http://twanvl.nl/blog/haskell/unsafe-sequence\" rel=\"nofollow noreferrer\">twanvl.nl/blog/haskell/unsafe-sequence</a> )"}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1465980947, "post_id": 37830607, "comment_id": 63123086, "body": "I didn&#39;t indicate this in the original question, but wouldn&#39;t this mean I have to read <i>all</i> the random samples off of disk first? That would not be feasible for my use case."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1465981055, "post_id": 37830607, "comment_id": 63123156, "body": "<code>mapM (const x) [1..n] = replicateM n x</code>"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1465982450, "last_edit_date": 1465982450, "creation_date": 1465980847, "answer_id": 37830607, "question_id": 37830211, "link": "https://stackoverflow.com/questions/37830211/how-to-implement-this-kind-of-io-based-loop-using-higher-order-functions/37830607#37830607", "title": "How to implement this kind of IO-based loop using higher order functions?", "body": "<p>From</p>\n\n<pre><code>myloop 0 state = return state\nmyloop n state = do\n  sample &lt;- getRandomSampleFromFile\n  myloop (n - 1) (process state sample)\n</code></pre>\n\n<p>split reading data / process data</p>\n\n<pre><code>xs &lt;- mapM (const getRandomSampleFromFile) [1..n]\n</code></pre>\n\n<p>take <code>n</code> samples now, simply fold</p>\n\n<pre><code>foldl process state xs\n</code></pre>\n\n<p>you can use applicative syntax</p>\n\n<pre><code>myloop n state = foldl process state &lt;$&gt; mapM (const getRandomSampleFromFile) [1..n]\n</code></pre>\n\n<p>or (thk2 @andr\u00e1s-kov\u00e1cs)</p>\n\n<pre><code>myloop n state = foldl process state &lt;$&gt; replicateM m getRandomSampleFromFile\n</code></pre>\n\n<p>if you wish break the reading process (or process data while reading) then, you must enter into monad</p>\n\n<pre><code>myloop n state = foldM acc state [1..n]\n    where acc s _ | breakProcess s = return s\n                  | otherwise      = process s &lt;$&gt; getRandomSampleFromFile\n</code></pre>\n\n<p>but folding will not stop then, your initial aproach (after all) looks better.</p>\n\n<pre><code>myloop n state | breakProcess state = return state\n               | otherwise          = do\n                                        x &lt;- getRandomSampleFromFile\n                                        myloop (n - 1) (process state x)\n</code></pre>\n\n<p>Any way, I encourage use <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\"><code>conduit</code></a>, <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\"><code>pipes</code></a>, ... if you are looking for some streaming processing.</p>\n\n<p>(By the way, note that your <code>getRandomSampleFromFile</code> function may have hardcoded configuration, it's not good)</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1465981534, "creation_date": 1465981534, "answer_id": 37830883, "question_id": 37830211, "link": "https://stackoverflow.com/questions/37830211/how-to-implement-this-kind-of-io-based-loop-using-higher-order-functions/37830883#37830883", "title": "How to implement this kind of IO-based loop using higher order functions?", "body": "<p>This should provide a hint:</p>\n\n<pre><code>&gt; import Control.Monad\n&gt; foldM (\\n x -&gt; print (n,x) &gt;&gt; return (n+x)) 0 [10,20,30]\n(0,10)\n(10,20)\n(30,30)\n60\n</code></pre>\n\n<p>In your case, <code>n</code> is an index-state pair (or only the state, if the index is not needed in the computation), and <code>x</code> is the sample at hand.</p>\n"}, {"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1466004176, "post_id": 37839093, "comment_id": 63139986, "body": "This if &quot;<code>foldlM</code> as <code>foldr</code>&quot;, not &quot;` foldlM&#39;` as <code>foldr</code>&quot;, so to speak, and can be observed to leak space. Try <code>main = myloop (+) (readLn::IO Int) 1000000 0 &gt;&gt;= print</code> with enough lines of text."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1466004700, "post_id": 37839093, "comment_id": 63140361, "body": "This can be cured with use of <code>$!</code>"}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 0, "last_activity_date": 1466002927, "creation_date": 1466002927, "answer_id": 37839093, "question_id": 37830211, "link": "https://stackoverflow.com/questions/37830211/how-to-implement-this-kind-of-io-based-loop-using-higher-order-functions/37839093#37839093", "title": "How to implement this kind of IO-based loop using higher order functions?", "body": "<p>Once you understand how it works, <code>foldr</code> is surprisingly versatile when working in a monad:</p>\n\n<pre><code>myloop n = foldr w return [1..n] where\n    w _ k state = do\n        sample &lt;- getRandomSampleFromFile\n        k (process state sample)\n</code></pre>\n\n<p>Note:</p>\n\n<pre><code>w _ k state = getRandomSampleFromFile &gt;&gt;= k . process state\n</code></pre>\n\n<p>so</p>\n\n<pre><code>myloop n = foldr (\\ _ k state -&gt; getRandomSampleFromFile &gt;&gt;= k . process state) return [1..n]\n</code></pre>\n\n<p>The reason this works is that <code>foldr</code>'s definition:</p>\n\n<pre><code>foldr f z [] = z\nfoldr f z (x:xn) = f x (foldr f z xn)\n</code></pre>\n\n<p>in the <code>:</code> case, puts the recursive call into a thunk and <em>tail calls</em> <code>f</code>, passing it that thunk.  You don't necessarily think about that, because in many of the simple folds <code>f</code> is strict in its second argument anyway (so the recursive call is effectively performed before the body of <code>f</code> is entered anyway), but <code>foldr</code> actually hands <code>f</code> control immediately, and lets it decide when (if ever) to perform the recursive call.  So almost any recursive structure can be re-written as a <code>foldr</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "is_accepted": false, "score": 0, "last_activity_date": 1466006835, "creation_date": 1466006835, "answer_id": 37840569, "question_id": 37830211, "link": "https://stackoverflow.com/questions/37830211/how-to-implement-this-kind-of-io-based-loop-using-higher-order-functions/37840569#37840569", "title": "How to implement this kind of IO-based loop using higher order functions?", "body": "<p>I want to offer my solution as this has been bending my brain for some time.</p>\n\n<p>What we need is a function with the following signature:</p>\n\n<pre><code>iteratively :: Monad m =&gt; (a -&gt; m a) -&gt; a -&gt; [m a]\n</code></pre>\n\n<p>and it should hold that <code>iteratively m i</code> repeatedly applies the monadic action <code>m</code> on successive outputs of the previous actions[1]. The reason that the output must be an array of monadic actions is that we're only interested in the <code>n</code>-th monadic actions that represents the one with <code>n</code> successive applications.</p>\n\n<p>The implementation I arrived at is this:</p>\n\n<pre><code>iteratively step init = iterate (&gt;&gt;= step) (return init)\n</code></pre>\n\n<p>Now, the action <code>m</code> that has been repeated <code>n</code> times with initail value <code>init</code> is - and thus analogous to your <code>myloop</code>:</p>\n\n<pre><code>repeatedly :: Monad m =&gt; (a -&gt; m a) -&gt; a -&gt; Int -&gt; m a\nrepeatedly step init n = iteratively step init !! n\n</code></pre>\n\n<p>[1]: <code>m</code> here represents the monadic action that returns the argument to the next action - what you call <code>sample</code>. It can be implemented in terms of <code>getRandomSampleFromFile</code> and <code>process</code> thus:</p>\n\n<pre><code>process &lt;$&gt; getRandomSampleFromFile\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 2, "accepted_answer_id": 37839093, "answer_count": 4, "score": 2, "last_activity_date": 1466006835, "creation_date": 1465979845, "last_edit_date": 1465981107, "question_id": 37830211, "link": "https://stackoverflow.com/questions/37830211/how-to-implement-this-kind-of-io-based-loop-using-higher-order-functions", "title": "How to implement this kind of IO-based loop using higher order functions?", "body": "<p>I have some code like the following which updates <code>state</code> based on random <code>sample</code>s read from disk:</p>\n\n<pre><code>myloop 0 state = return state\nmyloop n state = do\n  sample &lt;- getRandomSampleFromFile\n  myloop (n - 1) (process state sample)\n</code></pre>\n\n<p>How can this be written idiomatically using higher order functions to avoid the explicit function and recursion (and preferably without pulling in a massive library)?</p>\n\n<hr>\n\n<p>Clarification: I cannot just do a <code>replicateM n getRandomSampleFromFile</code> because I have a huge number of samples I need to process and it's infeasible to read all samples into memory first.</p>\n"}, {"tags": ["opencv", "haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465981939, "post_id": 37827812, "comment_id": 63123746, "body": "How is <code>ippicv</code> referenced in the <code>.cabal</code> file? Is there <code>pkgconfig-depends:</code> line in the cabal file?"}, {"owner": {"reputation": 55, "user_id": 5181138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/07feaef2803e21727e32beeaf2df8d5d?s=128&d=identicon&r=PG&f=1", "display_name": "cookiemonster", "link": "https://stackoverflow.com/users/5181138/cookiemonster"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466004339, "post_id": 37827812, "comment_id": 63140113, "body": "@ErikR it&#39;s referenced in a nix package actually."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1466019238, "post_id": 37827812, "comment_id": 63148917, "body": "Do you have the &quot;-dev&quot; version of the library?"}, {"owner": {"reputation": 55, "user_id": 5181138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/07feaef2803e21727e32beeaf2df8d5d?s=128&d=identicon&r=PG&f=1", "display_name": "cookiemonster", "link": "https://stackoverflow.com/users/5181138/cookiemonster"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1466023205, "post_id": 37827812, "comment_id": 63150991, "body": "@Eric figured it out. Well, in my case specifically, I moved -lippicv to private in opencv.pc."}], "owner": {"reputation": 55, "user_id": 5181138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/07feaef2803e21727e32beeaf2df8d5d?s=128&d=identicon&r=PG&f=1", "display_name": "cookiemonster", "link": "https://stackoverflow.com/users/5181138/cookiemonster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1465972724, "creation_date": 1465972724, "question_id": 37827812, "link": "https://stackoverflow.com/questions/37827812/stack-wont-build-because-of-ippicv", "title": "Stack won&#39;t build because of ippicv?", "body": "<p>So I have a project that was initially built using cabal. I'd like to make it compatible with stack. I issue stack init. I run <code>stack build</code> and get</p>\n\n<pre><code>setup-Simple-Cabal-1.22.5.0-ghc-7.10.3: Missing dependency on a foreign\nlibrary:\n* Missing C library: ippicv\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n\n<p>I'm running ubuntu 15.10. Opencv  3.1.0 is fully installed on my machine. I can even run the sample's but for some reason I get this error. Does anyone know why?</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1465956880, "post_id": 37824095, "comment_id": 63113101, "body": "I&#39;m not sure I understand what you are asking. Perhaps this tutorial will help: <a href=\"https://www.schoolofhaskell.com/user/stepcut/the-happstack-crashcourse\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/stepcut/the-happstack-crashcourse</a>"}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466020519, "post_id": 37824095, "comment_id": 63149623, "body": "I mean in each route, there supposed to be a request and a response. Is that correct?"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1466023978, "post_id": 37844972, "comment_id": 63151363, "body": "I see. Thank you so much! I know there is nothing special about having the word &#39;Response&#39; in the name of the handlers. However, I am wondering if we can use the name of the handler to stand for the response that returned by itself."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1466024765, "post_id": 37844972, "comment_id": 63151809, "body": "Just name your handlers however you want - the name of the handler doesn&#39;t matter. How about an up vote?"}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1466221027, "post_id": 37844972, "comment_id": 63240187, "body": "Thanks! I already did, but my reputation is still under 15. So the up vote I gave will remain unseen."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1466021818, "creation_date": 1466021818, "answer_id": 37844972, "question_id": 37824095, "link": "https://stackoverflow.com/questions/37824095/does-each-route-include-its-request-and-the-response-returned-by-the-server/37844972#37844972", "title": "Does each Route include its Request and the Response returned by the Server?", "body": "<p>Each line is a <em>handler</em>. Think of a handler as a function which takes a request and returns a response.</p>\n\n<p><code>graphReponse</code> is a handler which handles the request in a certain way.</p>\n\n<p><code>dir</code> modifies the handler so that it doesn't get called unless the request url begins a certain way.</p>\n\n<p>There is nothing special about having the word <code>Response</code> in the name of the handlers. <code>graphResponse</code> is just the name of a function - you can use any names for your handler functions.</p>\n\n<p>What you have is a list of handlers, e.g.:</p>\n\n<pre><code>[ handler1,\n  handler2,\n  ...,\n  notFoundResponse\n]\n</code></pre>\n\n<p>When a request comes in a check is made to see if the <code>handler1</code> will handle the request. If not, <code>handler2</code> is checked and so on. If no handler accepts the request the <code>notFoundHandler</code> is called which will probably generated a 404 page.</p>\n\n<p>That's why the <code>dir ...</code> part is important - it prevents a handler from responding unless the url begins a certain way.</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 1, "accepted_answer_id": 37844972, "answer_count": 1, "score": 0, "last_activity_date": 1466021818, "creation_date": 1465949066, "last_edit_date": 1466020626, "question_id": 37824095, "link": "https://stackoverflow.com/questions/37824095/does-each-route-include-its-request-and-the-response-returned-by-the-server", "title": "Does each Route include its Request and the Response returned by the Server?", "body": "<p>For each <code>dir..</code> , it is a <code>Route</code> which takes in a <code>Request</code> and returns a <code>Response</code> created by the <code>Server</code>. I am wondering if the <code>Request</code> and the <code>Response</code> included in each line of the code. Thanks in advance!</p>\n\n<pre><code>simpleHTTP serverConf $ do\ndecodeBody (defaultBodyPolicy \"/tmp/\" 4096 4096 4096)\nmsum [ do\n      nullDir\n      seeOther \"graph\" (toResponse \"Redirecting to /graph\"),\n      dir \"grid\" gridResponse,\n      dir \"graph\" graphResponse,\n      dir \"image\" graphImageResponse,\n      dir \"timetable-image\" $ look \"courses\" &gt;&gt;= \\x -&gt; look \"session\" &gt;&gt;= timetableImageResponse x,\n      dir \"graph-fb\" $ seeOther redirectUrlGraphEmail $ toResponse \"\",\n      dir \"post-fb\" $ seeOther redirectUrlGraphPost $ toResponse \"\",\n      dir \"test\" $ look \"code\" &gt;&gt;= getEmail,\n      dir \"test-post\" $ look \"code\" &gt;&gt;= postToFacebook,\n      dir \"post\" postResponse,\n      dir \"draw\" drawResponse,\n      dir \"about\" $ aboutResponse aboutContents,\n      dir \"privacy\" $ privacyResponse privacyContents,\n      dir \"static\" $ serveDirectory DisableBrowsing [] staticDir,\n      dir \"course\" $ look \"name\" &gt;&gt;= retrieveCourse,\n      dir \"all-courses\" $ liftIO allCourses,\n      dir \"graphs\" $ liftIO queryGraphs,\n      dir \"course-info\" $ look \"dept\" &gt;&gt;= courseInfo,\n      dir \"depts\" $ liftIO deptList,\n      dir \"timesearch\" searchResponse,\n      dir \"calendar\" $ lookCookieValue \"selected-lectures\" &gt;&gt;= calendarResponse,\n      dir \"get-json-data\" $ look \"graphName\" &gt;&gt;= \\graphName -&gt; liftIO $ getGraphJSON graphName,\n      dir \"loading\" $ look \"size\" &gt;&gt;= loadingResponse,\n      dir \"save-json\" $ look \"jsonData\" &gt;&gt;= \\jsonStr -&gt; look \"nameData\" &gt;&gt;= \\nameStr -&gt; liftIO $ saveGraphJSON jsonStr nameStr,\n      notFoundResponse\n]\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "caf", "strictness"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1465950225, "post_id": 37824066, "comment_id": 63111656, "body": "Usually, CAFs are <i>desired</i>, so, yes, it makes sense if GHC sometimes optimises them in. Avoiding them only makes sense in some memory-intensive applications. Have you tried this with something more RAM-heavy?"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465961543, "post_id": 37824066, "comment_id": 63114160, "body": "Oh, then is there any idiomatic ways to prevent CAFs? Mr. Don Stewart&#39;s answer (<a href=\"http://stackoverflow.com/questions/6090932/how-to-make-a-caf-not-a-caf-in-haskell\" title=\"how to make a caf not a caf in haskell\">stackoverflow.com/questions/6090932/&hellip;</a>) and Mr. Chris Allen&#39;s book (<a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>) suggests making CAFs to function with dummy argument is THAT way. But the result with current (v7.10) GHC shows that the method does not work with <code>-O2</code>. My context is in &#39;studying&#39; CAFs of Haskell."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1466100298, "post_id": 37824066, "comment_id": 63189758, "body": "Have you tried <a href=\"https://hackage.haskell.org/package/ghc-dup\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/ghc-dup</a>?"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1465948887, "creation_date": 1465948887, "last_edit_date": 1495542698, "question_id": 37824066, "link": "https://stackoverflow.com/questions/37824066/avoiding-caf-in-haskell", "title": "Avoiding CAF in Haskell", "body": "<p>To avoid CAF (resource sharing), I tried converting to function\nwith dummy argument, but no success (<code>noCafB</code>). \nI've read <a href=\"https://stackoverflow.com/questions/6090932/how-to-make-a-caf-not-a-caf-in-haskell\">How to make a CAF not a CAF in Haskell?</a> so tried <code>noCafC</code> and <code>noCafD</code>. When compiled with\n<code>-O0</code>, then functions with dummy argument did evaluated every time.\nHowever, with <code>-O2</code>, it seems that GHC converts those functions to\nCAF. Is this intended behaviour (GHC's optimization)?</p>\n\n<pre><code>module Main where\nimport Debug.Trace\n\ncafA :: [Integer]\ncafA = trace \"hi\" (map (+1) $ [1..])\nnoCafB :: a -&gt; [Integer]\nnoCafB _ = trace \"hi\" (map (+1) $ [1..])\nnoCafC :: a -&gt; [Integer]\nnoCafC _ = trace \"hi\" (map (+1) $ [1..])\n{-# NOINLINE noCafC #-}\nnoCafD :: a -&gt; [Integer]\nnoCafD _ = trace \"hi\" (map (+1) $ myEnumFrom 0 1)\n{-# NOINLINE noCafD #-}\nmyEnumFrom :: a -&gt; Integer -&gt; [Integer]\nmyEnumFrom _ n =  enumFrom n\n{-# NOINLINE myEnumFrom #-}\n\nmain :: IO ()\nmain = do\n  putStrLn \"cafA\"\n  print $ (cafA !! 1 + cafA !! 2)\n  putStrLn \"noCafB\"\n  print $ (noCafB 0 !! 1 + noCafB 0 !! 2)\n  putStrLn \"noCafC\"\n  print $ (noCafC 0 !! 1 + noCafC 0 !! 2)\n  putStrLn \"noCafD\"\n  print $ (noCafD 0 !! 1 + noCafD 0 !! 2)\n</code></pre>\n\n<p>Result with <code>-O2</code></p>\n\n<pre><code>$ stack ghc -- --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n\n$ stack ghc -- -O2 cafTest.hs\n[1 of 1] Compiling Main             ( cafTest.hs, cafTest.o )\nLinking cafTest ...\n$ ./cafTest\ncafA\nhi\n7\nnoCafB\n7\nnoCafC\n7\nnoCafD\nhi\n7\n</code></pre>\n\n<p>Result with <code>-O0</code></p>\n\n<pre><code>$ stack ghc -- -O0 cafTest.hs\n[1 of 1] Compiling Main             ( cafTest.hs, cafTest.o )\nLinking cafTest ...\n$ ./cafTest\ncafA\nhi\n7\nnoCafB\nhi\nhi\n7\nnoCafC\nhi\nhi\n7\nnoCafD\nhi\nhi\n7\n</code></pre>\n\n<p>I've also tried without <code>trace</code> but results was same. under <code>-O2</code>, I found that the result of <code>incInt</code> function is shared by inspecting profiling output. Why this behaviour?</p>\n\n<pre><code>incIntOrg :: [Integer]\nincInt = map (+1) [1..]\n\nincInt :: a -&gt; [Integer]  -- results IS shared. should it be?\nincInt _ = map (+1) $ myEnum 0 1\n{-# NOINLINE incInt #-}\nmyEnum :: a -&gt; Integer -&gt; [Integer]\nmyEnum _ n =  enumFrom n\n{-# NOINLINE myEnum #-}\nmain :: IO ()\nmain = do\n  print (incInt 0 !!  9999999)\n  print (incInt 0 !!  9999999)\n  print (incInt 0 !!  9999999)\n</code></pre>\n\n<p>Any comments will be appreciated deeply. Thanks.</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1465929549, "post_id": 37819091, "comment_id": 63103546, "body": "AFAICS, no way to do that currently. That&#39;s why I&#39;d love to see GHC one day integrate a termination checker, and internally optimize any provably terminating <code>x :: T</code> into <code>x = unsafeCoerce ()</code> when <code>T</code> has exactly one no-args constructor (as <code>:~:</code> does). One would still need to write a proof by induction, but at least no runtime penalty is introduced."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1465962806, "post_id": 37819091, "comment_id": 63114448, "body": "At some point it must be more practical to use a language actually designed for this sort of thing..."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": false, "score": 1, "last_activity_date": 1470416684, "creation_date": 1470416684, "answer_id": 38794469, "question_id": 37819091, "link": "https://stackoverflow.com/questions/37819091/informing-haskell-that-reverse-reverse-xs-xs/38794469#38794469", "title": "Informing Haskell that `(Reverse (Reverse xs)) ~ xs`", "body": "<p>The only way that I know of to influence the behavior of <code>~</code> in GHC is to   actually construct an instance of <code>a :~: b</code> (or similar; the important thing is to construct a term that \"proves\" this to the typechecker) and then pattern match on the <code>Refl</code> constructor, which would require evaluating the proof witness at runtime.  My understanding is that the current design for dependent types in GHC is still going to require running all proofs of type equality.  However, one could use GHC's rewrite rules to, after typechecking, replace the proof witness with a very low-cost function (e.g. <code>unsafeCoerce Refl :: Reverse (Reverse a) :~: a</code>),  which would make the evaluation very low cost, but still safe (since the proof witness has already typechecked, showing that if it terminates, it will produce a correct proof).</p>\n\n<p>Lots more information about the current state of dependent typing in Haskell can be found here: <a href=\"https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/\" rel=\"nofollow\">https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/</a></p>\n"}], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "answer_count": 1, "score": 15, "last_activity_date": 1470416684, "creation_date": 1465927296, "question_id": 37819091, "link": "https://stackoverflow.com/questions/37819091/informing-haskell-that-reverse-reverse-xs-xs", "title": "Informing Haskell that `(Reverse (Reverse xs)) ~ xs`", "body": "<p>If <code>Reverse :: [k] -&gt; [k]</code> is a type family then Haskell cannot tell that <code>(Reverse (Reverse xs)) ~ xs</code>.  Is there a way to let the type system know this without any runtime cost?</p>\n\n<p>I'm tempted to just use <code>unsafeCoerce</code>, but that seems a shame.</p>\n"}, {"tags": ["haskell", "testing", "hspec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465933417, "post_id": 37816806, "comment_id": 63105480, "body": "Updated my answer with another example."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1465933391, "last_edit_date": 1465933391, "creation_date": 1465921882, "answer_id": 37817543, "question_id": 37816806, "link": "https://stackoverflow.com/questions/37816806/how-to-test-with-hspec-whether-the-readererror-function-was-executed/37817543#37817543", "title": "How to test with hspec whether the readerError function was executed", "body": "<p>Here are some relevant type sigs:</p>\n\n<pre><code>parseDb :: String -&gt; ReadM String\n\n-- from Options.Applicative.Internal\n\nrunReadM :: MonadP m =&gt; ReadM a -&gt; String -&gt; m a\nrunP :: P a -&gt; ParserPrefs -&gt; (Either ParseError a, Context)\n</code></pre>\n\n<p>Docs for <code>runReadM</code> and <code>runP</code>: <a href=\"http://hackage.haskell.org/package/optparse-applicative-0.12.1.0/docs/Options-Applicative-Internal.html#v:runReadM\" rel=\"nofollow\">(link)</a></p>\n\n<p><code>ParserPrefs</code> is just a simple data structure.</p>\n\n<p>And this typechecks:</p>\n\n<pre><code> import Options.Applicative.Types\n import Options.Applicative.Internal\n\n parseDb :: String -&gt; ReadM String\n parseDb val = do\n     if not (elem val [\"dmt\", \"report\"])\n         then readerError $ \"Unknown DB, '\" ++ val ++ \"'\"\n         else return val\n\n foo :: (Either ParseError String, Context)     -- might be [Context] now\n foo =   runP (runReadM (parseDb \"foo\") \"asd\") opts\n   where opts = ParserPrefs \"suffix\" False False False 80\n</code></pre>\n\n<p>Evaluating <code>fst foo</code> returns:</p>\n\n<pre><code>*Main&gt; fst foo\nLeft (ErrorMsg \"Unknown DB, 'foo'\")\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Here is how to test a <code>Parser</code> like <strong>globalOptsParser</strong>:</p>\n\n<pre><code>import Options.Applicative.Common (runParser)\nimport Options.Applicative.Internal (runP)\n\nbar = let mp = runParser AllowOpts globalOptsParser [\"asd\"]\n          opts = ParserPrefs \"suffix\" False False False 80\n      in fst $ runP mp opts\n</code></pre>\n\n<p>Here <code>[\"asd\"]</code> are the command line arguments to test against.</p>\n\n<p>Check that the <code>ParserPrefs</code> are what you want - they can affect option processing.</p>\n"}], "owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 37817543, "answer_count": 1, "score": 1, "last_activity_date": 1465933391, "creation_date": 1465919645, "last_edit_date": 1465928757, "question_id": 37816806, "link": "https://stackoverflow.com/questions/37816806/how-to-test-with-hspec-whether-the-readererror-function-was-executed", "title": "How to test with hspec whether the readerError function was executed", "body": "<p>I'm new to Haskell.</p>\n\n<p>I have written the following piece of code which will parse the arguments sent to a script;</p>\n\n<pre><code>module Billing.Options\n  (\n      GlobalOpts(..)\n    , globalOptsParser\n    , parseDb\n  ) where\n\nimport Options.Applicative\nimport Options.Applicative.Simple\nimport Options.Applicative.Types\nimport System.FilePath.Posix\nimport Text.Regex.PCRE\n\n-- ------------------------------------------------------------\n\ndata GlobalOpts = GlobalOpts\n  {\n    optDb          :: String,\n    optSql         :: String\n  } deriving Show\n\n-- ------------------------------------------------------------\n\nglobalOptsParser :: Parser GlobalOpts\nglobalOptsParser = GlobalOpts\n  &lt;$&gt; option (parseDb =&lt;&lt; readerAsk)\n    (   long \"db\"\n    &lt;&gt;  short 'd'\n    &lt;&gt;  metavar \"&lt;DB name&gt;\"\n    &lt;&gt;  help \"dmt | report\"\n    )\n  &lt;*&gt; option parseSql\n    (   long \"sql\"\n    &lt;&gt;  metavar \"&lt;SQL SELECT statement&gt;\"\n    &lt;&gt;  help \"sql select statement to use in order to generate JSON config file\"\n    )\n-- ------------------------------------------------------------\n\nmatches :: String -&gt; String -&gt; Bool\nmatches = (=~)\n\n-- ------------------------------------------------------------\n\nparseDb :: String -&gt; ReadM String\nparseDb val = do\n    if not (elem val [\"dmt\", \"report\"])\n        then readerError $ \"Unknown DB, '\" ++ val ++ \"'\"\n        else return val\n\n-- ------------------------------------------------------------\n\nparseSql :: ReadM String\nparseSql = do\n    val &lt;- readerAsk\n    if not (val `matches` \"(?i)select .+ from .+\")\n        then readerError $ \"Please provide a valid SQL SELECT statement\"\n        else return val\n\n-- [EOF]\n</code></pre>\n\n<p>I want to test the \"parseDb\" function above with hspec.  I want to ensure that a \"readerError\" will be thrown when an unknown database is specified.  Thus I want to test that the function call \n  parseDb \"unknown\"\ngenerates a \"readerError\" call which according to me should throw an exception.</p>\n\n<p>I have tried the hspec shouldThrow function but it doesn't work.  Seems no exception was thrown.  The return type for readerError is \"ReadM a\".  After spending a few days reading up on monads and reader monads I'm still stuck (and confused) and have no idea how to test this and whether it is even possible to test it.  Couldn't find any relevant examples when I googled.</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1465916977, "post_id": 37813120, "comment_id": 63095897, "body": "Why are you using Lazy ByteString at all in this program?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1465917334, "post_id": 37813120, "comment_id": 63096182, "body": "@Michael, perhaps ignorance at my part. Can swap with strict bytestring."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1465919513, "post_id": 37813120, "comment_id": 63097841, "body": "It think I see now, it&#39;s coming from <code>websockets</code>"}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1465917179, "post_id": 37815487, "comment_id": 63096053, "body": "Yep, <code>getObject</code> doesn&#39;t need to accept and close WS connections. It is already taken care of somewhere else. We just pass <code>WS connection</code> handle to the function. However, to write to it, don&#39;t we need to do <code>mapM_</code> to send the data to Websocket handle? That was the original question - how to stream the data to WS handle like we do to the file. It is not really about handle management."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1465916073, "creation_date": 1465916073, "answer_id": 37815487, "question_id": 37813120, "link": "https://stackoverflow.com/questions/37813120/streaming-bytes-to-network-websocket/37815487#37815487", "title": "Streaming bytes to network websocket", "body": "<p>You are correct in thinking that handles will require additional trickery. However, as you are already using the <code>ResourceT</code> monad transformer, this is <a href=\"https://hackage.haskell.org/package/resourcet-1.1.7.3/docs/Control-Monad-Trans-Resource.html#g:5\" rel=\"nofollow\">delightfully simple to do with <code>allocate</code></a>. <code>allocate</code> allows you to create a handle in the resource monad and register a cleanup action (which in your case is just closing the connection).</p>\n\n<pre><code>ok &lt;- runResourceT $ do\n  (releaseKey, handle) &lt;-\n    allocate (WebSockets.acceptRequest request) \n             (`WebSockets.sendClose` closeMessage)\n  WebSockets.sendBinaryData handle data\n  return ok\nwhere\n  request = ...\n  closeMessage = ...\n  data = ...\n  ok = ...\n</code></pre>\n\n\n\n<p>By using <code>allocate</code>, the handle is guaranteed to close by the time <code>runResourceT</code> returns <code>ok</code>.</p>\n\n<p>I am not entirely sure that this is what you want, however. It seems to me that <code>getObject</code> should not know about how to accept and close WS connections; perhaps it should take a WS connection handle as an argument and then write to it. If you upgrade its return type to <code>ResourceT</code> then you could charge the <em>caller</em> to <code>getObject</code> with the responsibility of calling  <code>runResourceT</code> and allocating WS handles and so forth. But hopefully the example above is enough to get you going on your way.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1465916148, "creation_date": 1465916148, "answer_id": 37815527, "question_id": 37813120, "link": "https://stackoverflow.com/questions/37813120/streaming-bytes-to-network-websocket/37815527#37815527", "title": "Streaming bytes to network websocket", "body": "<p>(Caveat - code not tested.)</p>\n\n<p>Your code is re-opening the output file and appending to it every time a packet of data comes in. Clearly a better solution is to use <code>LBS.hPutStr</code> to write to the file using an already open file handle.</p>\n\n<p>That is, instead of:</p>\n\n<pre><code>S.mapM_ (liftIO . (LBS.appendFile \"testaws\") . LBS.fromStrict) obj\n</code></pre>\n\n<p>you want to use:</p>\n\n<pre><code>S.mapM_ (liftIO . (LBS.hPutStr h) . LBS.fromStrict) obj\n</code></pre>\n\n<p>Of course, this references the handle <code>h</code>, and where does that come from?</p>\n\n<p>One solution is to pass it into <code>getObject</code> or otherwise create it before calling the body of <code>getObject</code>, e.g.:</p>\n\n<pre><code>getObject cfg bucket key = withFile \"output\" $ \\h -&gt; do\n    req &lt;- ...\n    ...\n    S.mapM_ (liftIO . (LBS.hPutStr h) . LBS.fromStrict) obj\n    ...\n</code></pre>\n\n<p>Or maybe you have to creating inside the runResourceT... I'm not sure.</p>\n\n<p><strong>Update</strong> - See @haoformayor's answer for how to have ResourceT manage the file handle for you.</p>\n"}, {"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 1, "last_activity_date": 1465927971, "last_edit_date": 1465927971, "creation_date": 1465921138, "answer_id": 37817316, "question_id": 37813120, "link": "https://stackoverflow.com/questions/37813120/streaming-bytes-to-network-websocket/37817316#37817316", "title": "Streaming bytes to network websocket", "body": "<p>Here's a few bits and pieces that may make things more intelligible. First, for the first little demo, revising your <code>getObject</code>, I use <code>Streaming.ByteString.writeFile</code>, which is in <code>ResourceT</code> anyway, to drop the detour by lazy bytestring. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings,ScopedTypeVariables #-}\n\nimport qualified Aws\nimport qualified Aws.S3 as S3\nimport           Data.Conduit \nimport qualified Data.Conduit.List as CL (mapM_)\nimport qualified Data.ByteString.Streaming.HTTP as HTTP\nimport qualified Data.ByteString.Streaming as SB\nimport qualified Data.ByteString.Streaming.Internal as SB\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Lazy as BL\nimport           Streaming as S\nimport           Streaming.Prelude as S hiding (show,print)\nimport           Control.Concurrent.Async (async,waitCatch)\nimport           Data.Text as T (Text) \nimport qualified Network.WebSockets as WebSockets\nimport           Control.Monad.Trans.Resource\n\ndata AwsConfig a = AwsConfig { _aws_cfg :: Aws.Configuration\n                             , _aws_s3cfg :: S3.S3Configuration a\n                             , _aws_httpmgr :: HTTP.Manager }\n\ngetObject :: AwsConfig Aws.NormalQuery -&gt; FilePath -&gt; T.Text -&gt; T.Text -&gt;  IO Int\ngetObject cfg file bucket key = do\n  req &lt;- waitCatch =&lt;&lt; async (runResourceT $ do\n    S3.GetObjectResponse { S3.gorResponse = rsp, S3.gorMetadata = mdata } &lt;- \n      Aws.pureAws (_aws_cfg cfg) (_aws_s3cfg cfg) (_aws_httpmgr cfg) $\n        S3.getObject bucket key\n    let bytestream = do \n         -- lookup \"content-length\" (S3.omUserMetadata mdata))\n         SB.chunk B.empty -- this will be replaced by content-length \n         hoist lift (HTTP.responseBody rsp)  $$+- CL.mapM_ SB.chunk \n    SB.writeFile file bytestream ) -- this is in ResourceT \n  case req of\n    Left _ -&gt; return 2\n    Right _ -&gt; return 0\n</code></pre>\n\n<p>We can abstract from this more or less what you were doing with <code>SB.writeFile</code>:</p>\n\n<pre><code>getObjectAbstracted\n      :: (SB.ByteString (ResourceT IO) () -&gt; ResourceT IO b)\n         -&gt; AwsConfig Aws.NormalQuery -&gt; S3.Bucket -&gt; Text -&gt; ResourceT IO b\ngetObjectAbstracted action cfg bucket key = do\n    S3.GetObjectResponse { S3.gorResponse = rsp, S3.gorMetadata = mdata } &lt;- \n      Aws.pureAws (_aws_cfg cfg) \n                  (_aws_s3cfg cfg) \n                  (_aws_httpmgr cfg) \n                  (S3.getObject bucket key)\n\n    action (hoist lift (HTTP.responseBody rsp)  $$+- CL.mapM_ SB.chunk) \n</code></pre>\n\n<p>Here now, we need a little helper not included in the streaming bytestring library</p>\n\n<pre><code>mapMChunks_ :: Monad m =&gt; (B.ByteString -&gt; m ()) -&gt; SB.ByteString m r -&gt; m r\nmapMChunks_ act bytestream = do\n  (a S.:&gt; r) &lt;- SB.foldlChunksM (\\_ bs -&gt; act bs) (return ()) bytestream\n  return r\n</code></pre>\n\n<p>and can proceed more or less as @haoformayor planned, using streaming bytestring</p>\n\n<pre><code>writeConnection :: MonadIO m =&gt; WebSockets.Connection -&gt; SB.ByteString m r -&gt; m r\nwriteConnection connection  = \n  mapMChunks_ (liftIO . WebSockets.sendBinaryData connection)\n\n-- following `haoformayor`\nconnectWrite\n    :: (MonadResource m, WebSockets.WebSocketsData a) \n    =&gt; WebSockets.PendingConnection \n    -&gt; a                  -- closing  message\n    -&gt; SB.ByteString m r  -- stream from aws\n    -&gt; m r\nconnectWrite request closeMessage bytestream = do\n    (releaseKey, connection) &lt;- allocate (WebSockets.acceptRequest request)\n                                         (`WebSockets.sendClose` closeMessage)\n    writeConnection connection bytestream\n\ngetObjectWS :: WebSockets.WebSocketsData a =&gt;\n       WebSockets.PendingConnection\n       -&gt; a\n       -&gt; AwsConfig Aws.NormalQuery\n       -&gt; S3.Bucket\n       -&gt; Text\n       -&gt; ResourceT IO ()\ngetObjectWS request closeMessage = getObjectAbstracted (connectWrite request closeMessage)\n</code></pre>\n\n<p>Of course none of this so far makes any use of the difference between <code>conduit</code> and <code>streaming</code>/<code>streaming-bytestring</code>.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 1, "accepted_answer_id": 37817316, "answer_count": 3, "score": 1, "last_activity_date": 1465927971, "creation_date": 1465910026, "last_edit_date": 1465920050, "question_id": 37813120, "link": "https://stackoverflow.com/questions/37813120/streaming-bytes-to-network-websocket", "title": "Streaming bytes to network websocket", "body": "<p>I have a code that uses a file handle to simulate sink for the streaming <code>Bytestring</code> from a source (<code>AWS S3</code>). If we want to use <a href=\"https://hackage.haskell.org/package/websockets-0.9.6.2/docs/Network-WebSockets.html\" rel=\"nofollow\"><code>Network.Websocket</code></a> as the sink, would it suffice to swap <code>LBS.writeFile</code> in the code below with <a href=\"https://hackage.haskell.org/package/websockets-0.9.6.2/docs/Network-WebSockets.html#g:4\" rel=\"nofollow\"><code>sendBinaryData</code></a> (with handle to connection)? </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings,ScopedTypeVariables #-}\n\nimport qualified Aws\nimport qualified Aws.S3 as S3\nimport           Data.Conduit (($$+-))\nimport qualified Data.Conduit.List as CL (mapM_)\nimport qualified Data.ByteString.Streaming.HTTP as SP\nimport qualified Data.ByteString.Lazy as LBS\nimport Streaming as S\nimport Streaming.Prelude as S hiding (show,print)\nimport Control.Concurrent.Async (async,waitCatch)\nimport Data.Text as T (Text)\n\ndata AwsConfig a = AwsConfig { _aws_cfg :: Aws.Configuration, _aws_s3cfg :: S3.S3Configuration a, _aws_httpmgr :: SP.Manager }\n\ngetObject :: AwsConfig Aws.NormalQuery -&gt; T.Text -&gt; T.Text -&gt;  IO Int\ngetObject cfg bucket key = do\n  req &lt;- waitCatch =&lt;&lt; async (runResourceT $ do\n    {- Create a request object with S3.getObject and run the request with pureAws. -}\n    S3.GetObjectResponse { S3.gorResponse = rsp, S3.gorMetadata = mdata } &lt;- \n      Aws.pureAws (_aws_cfg cfg) (_aws_s3cfg cfg) (_aws_httpmgr cfg) $\n        S3.getObject bucket key\n    {- Stream the response to a lazy bytestring -}\n    liftIO $ LBS.writeFile \"testaws\" LBS.empty -- this will be replaced by content-length of the bytes \n    let obj = (($$+- CL.mapM_ S.yield) . hoist lift ) (SP.responseBody rsp)\n    S.mapM_ (liftIO . (LBS.appendFile \"testaws\") . LBS.fromStrict) obj\n    return $ lookup \"content-length\" (S3.omUserMetadata mdata))\n  case req of\n    Left _ -&gt; return 2 -- perhaps, we could use this to send an error message over websocket\n    Right _ -&gt; return 0\n</code></pre>\n\n<p>The source of confusion for me is how the termination of the stream is determined? In case of files, this is taken care of by <code>writeFile</code> API. What about <code>sendBinaryData</code>? Does it handle termination in similar way as <code>writeFile</code>? Or is it determined by the data parser on the client side?</p>\n\n<p><strong>Update</strong> </p>\n\n<p>This question is about how to stream the data to a websocket handle (let us assume a handle has been provided) like we do with the file handle in the example above, not really about how to manage the handle within <code>resourceT</code>. <code>conduit</code> does seem to take <a href=\"https://hackage.haskell.org/package/yesod-websockets-0.2.4/docs/src/Yesod-WebSockets.html#sinkWSBinary\" rel=\"nofollow\"><code>mapM_</code></a> approach to sink data. So, it seems that is indeed the way to go.</p>\n\n<p>The <em>termination</em> question is because of this line of thought I have: if we have a function listening for data on the other side of a Websocket handle, then determining end of message seems to matter in streaming context. Given a function like below:</p>\n\n<pre><code>f :: LBS.ByteString -&gt; a\n</code></pre>\n\n<p>if we do <code>S.mapM_</code> to stream the data to websocket handle, does it take care of adding some kind of <code>end of stream</code> marker so that <code>f</code> listening on the other side can stop processing the lazy bytestring. Otherwise <code>f</code> won't know when the message is complete.</p>\n"}, {"tags": ["haskell", "type-declaration", "value-constructor"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 8, "creation_date": 1465902440, "post_id": 37810207, "comment_id": 63084578, "body": "&quot;Types declared in value constructors&quot; makes no sense. They&#39;re not types so they&#39;re definitely not &quot;types declared in value constructors&quot;. They&#39;re data constructors. You also can&#39;t write the function <code>surface :: 13 -&gt; 1.2</code>."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1465907649, "post_id": 37810207, "comment_id": 63088410, "body": "The syntax for <code>data</code> is a historical accident.  Use the GADT syntax for a more consistent way to give types to constructors."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1465909791, "post_id": 37810207, "comment_id": 63090100, "body": "@augustss ... it&#39;s not really an accident - I think GADTs are not even in the standard yet (not that it matters too much)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465909904, "post_id": 37810207, "comment_id": 63090200, "body": "instead of concentrating on the <code>Shape</code> I would look at what you want to do with them - that is the operations like <code>surface</code> - if you want to abstract this you could write functions to collect those into a record (or another data structure) or create a type-class for those - TL;DR: OOP = collect nouns / FP = collect verbs"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1465911285, "post_id": 37810207, "comment_id": 63091271, "body": "@Carsten It&#39;s a historical accident in the sense that it was influenced by other languages at the time of the design, like Miranda, LML, and Orwell.  These in turn where influenced by Hope."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1465903617, "last_edit_date": 1465903617, "creation_date": 1465902897, "answer_id": 37810422, "question_id": 37810207, "link": "https://stackoverflow.com/questions/37810207/why-are-types-declared-in-value-constructors-not-types-in-haskell/37810422#37810422", "title": "Why are types declared in value constructors not types in Haskell?", "body": "<pre><code>data Shape = Circle Float Float Float | Rectangle Float Float Float Float\n</code></pre>\n\n<p><code>Shape</code> is a type (and a type constructor). <code>Float</code> is another type.</p>\n\n<p><code>Circle</code> and <code>Rectangle</code> are the value constructors for type <code>Shape</code>.</p>\n\n<p>I guess that your confusion comes from OOP subtyping -- note that Haskell has no analogous to that. The above does not declare two types <code>Circle</code> and <code>Rectangle</code> to be subtypes of <code>Shape</code>.</p>\n\n<p>Using some advanced extensions like <code>GADTs</code> you can actually write something like <code>foo :: Circle -&gt; Float</code> meaning that the argument is a <code>Shape</code> value which has been constructed as a <code>Circle</code>. This requires some type-level techniques.</p>\n\n<p>Alternatively, a plain Haskell approach could be</p>\n\n<pre><code>data Circle = Circle Float Float Float\ndata Rectangle = Rectangle Float Float Float Float\ndata Shape = Scircle Circle | Srectangle Rectangle\n</code></pre>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 1, "accepted_answer_id": 37810422, "answer_count": 1, "score": 1, "last_activity_date": 1465903617, "creation_date": 1465902261, "question_id": 37810207, "link": "https://stackoverflow.com/questions/37810207/why-are-types-declared-in-value-constructors-not-types-in-haskell", "title": "Why are types declared in value constructors not types in Haskell?", "body": "<p>Suppose I have the following value constructor:</p>\n\n<pre><code>data Shape = Circle Float Float Float | Rectangle Float Float Float Float\n</code></pre>\n\n<p>Now I can run:</p>\n\n<pre><code>ghci&gt; :t Circle\nCircle :: Float -&gt; Float -&gt; Float -&gt; Shape\n</code></pre>\n\n<p>Now I can write a type declaration</p>\n\n<pre><code>surface :: Shape -&gt; Float\n</code></pre>\n\n<p>But I can't type a type declaration</p>\n\n<pre><code>surface :: Circle -&gt; Float\n</code></pre>\n\n<p>This <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow\">is because</a> \"<code>Circle</code> is not a type, <code>Shape</code> is\"</p>\n\n<p>My question is: <strong>Why are types declared in value constructors not types in Haskell?</strong></p>\n"}, {"tags": ["haskell", "io", "hook", "cabal"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465936001, "post_id": 37809030, "comment_id": 63106746, "body": "Why do you want to do this? Perhaps there is another approach which addresses your concerns."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1465914693, "last_edit_date": 1465914693, "creation_date": 1465914366, "answer_id": 37814836, "question_id": 37809030, "link": "https://stackoverflow.com/questions/37809030/cabal-install-suppresses-output/37814836#37814836", "title": "cabal install suppresses output", "body": "<p>As far as I can tell, during installs <code>cabal</code> runs Setup.hs with both stdout and stderr redirected to a file. There are two reasons for this:</p>\n\n<ol>\n<li>To save the install output in the ~/.cabal/logs/... directory</li>\n<li>So it can run parallel installs and the output of concurrent jobs won't get mixed up with each other</li>\n</ol>\n\n<p>You can use the <code>--build-log</code> option to tell cabal where to write logging information to, e.g.:</p>\n\n<pre><code>cabal install --build-log /tmp/foo\n</code></pre>\n\n<p>Also, if you are running a Unix/Linux like system, you can write to a device like <code>/dev/tty</code> and get output back to the user's terminal (if there is one.) For example:</p>\n\n<pre><code>import Distribution.Simple\nimport System.IO\n\nmain = do\n  putStrLn \"=== I am here in Setup.hs\"\n  withFile \"/dev/tty\" AppendMode $ \\h -&gt; do\n    hPutStrLn h \"--- writing to /dev/tty\"\n  defaultMain\n</code></pre>\n\n<p>Of course, this is OS-specific code, and it might cause problems for other users if they aren't using the same OS as you are.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1465936071, "creation_date": 1465936071, "answer_id": 37821502, "question_id": 37809030, "link": "https://stackoverflow.com/questions/37809030/cabal-install-suppresses-output/37821502#37821502", "title": "cabal install suppresses output", "body": "<p>If you explicitly ask for a single-threaded build, cabal will send its output to stdout. Use</p>\n\n<pre><code>cabal install -j1\n</code></pre>\n\n<p>to make this request.</p>\n"}], "owner": {"reputation": 329, "user_id": 628990, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/BrbtN.jpg?s=128&g=1", "display_name": "frabala", "link": "https://stackoverflow.com/users/628990/frabala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1465936071, "creation_date": 1465898952, "last_edit_date": 1465899391, "question_id": 37809030, "link": "https://stackoverflow.com/questions/37809030/cabal-install-suppresses-output", "title": "cabal install suppresses output", "body": "<p>I have created a cabal package which uses custom build-type. In Setup.hs I trigger a <code>postCopy</code> hook with which I intend to do some IO. In the body of the trigger I use <code>putStrLn</code> to output a line.</p>\n\n<p>When I <code>cabal install</code> the package, the output gets logged into a text file instead of showing at the console. A bit more insight: I think the problem relates to all triggers, not only <code>postCopy</code>, and <code>cabal install</code>. Because if for example I have a <code>postConf</code> trigger (performing some IO) and run <code>cabal configure</code>, the IO will work as expected. But when I do <code>cabal install</code> I'll have the same problem for the <code>postConf</code> trigger as well.</p>\n\n<p>Is there a way to show the output from the trigger in stdout?</p>\n\n<pre><code>&gt;cabal --version\ncabal-install version 1.22.6.0\nusing version 1.22.5.0 of the Cabal library\n</code></pre>\n"}, {"tags": ["haskell", "dictionary", "parallel-processing"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1465890141, "post_id": 37805159, "comment_id": 63076285, "body": "And what is <code>Coverage</code>? What is the high-level overview of this algorithm?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1465891284, "creation_date": 1465891284, "answer_id": 37806257, "question_id": 37805159, "link": "https://stackoverflow.com/questions/37805159/working-with-data-map-strictmap-maps-using-control-parallel/37806257#37806257", "title": "Working with Data.Map.StrictMap.Maps using Control.Parallel", "body": "<p>Here's a contrived example. You just use <code>parMap</code> over <code>M.splitRoot m</code>:</p>\n\n<pre><code>import qualified Data.Map.Strict as M\nimport Control.Parallel.Strategies\nimport System.Environment\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-2) + fib (n-1)\n\ntheMap :: Int -&gt; M.Map Int Int\ntheMap n = M.fromList [ (x, 33 + mod x 3) | x &lt;- [1..n] ]\n\nisInteresting n = mod (fib n) 2 == 0\n\ncountInteresting :: M.Map Int Int -&gt; Int\ncountInteresting m = length $ filter isInteresting (M.elems m)\n\ndoit :: Int -&gt; [Int]\ndoit n = parMap rseq countInteresting (M.splitRoot $ theMap n)\n\nmain :: IO ()\nmain = do\n  ( arg1 : _) &lt;- getArgs\n  let n = read arg1\n  print $ doit n\n</code></pre>\n\n<p>Note, however these caveats:</p>\n\n<ul>\n<li>the splits may not be of equal size</li>\n<li>use <code>splitRoot</code> if working with a Map is helpful for your computation; this particular example doesn't benefit from the Map structure of root - it could have just parMapped over the elements.</li>\n</ul>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 37806257, "answer_count": 1, "score": 0, "last_activity_date": 1465891284, "creation_date": 1465887996, "question_id": 37805159, "link": "https://stackoverflow.com/questions/37805159/working-with-data-map-strictmap-maps-using-control-parallel", "title": "Working with Data.Map.StrictMap.Maps using Control.Parallel", "body": "<p>I have the following code. The <code>M</code> prefix designates functions from <code>Data.Map.Strict</code>, and <code>Table</code> is a type alias for <code>Data.Map.Strict.Map Mapping Bool</code>, where <code>Mapping</code> is an arbitrary opaque structure.</p>\n\n<pre><code>computeCoverage :: Table -&gt; Expr -&gt; Maybe Coverage \ncomputeCoverage t e = go t True M.empty\n  where go src flag targ\n          | null src = if flag\n                       then Nothing\n                       else Just (M.size t, targ)\n          | otherwise = let ((m, b), rest) = M.deleteFindMin src \n                            result = interpret e m\n                            flag' = result &amp;&amp; flag in \n              go rest flag' (if b == result then targ else M.insert m b targ)\n</code></pre>\n\n<p>I would like to be able to use <code>Control.Parallel</code> to perform this with as much parallelism as possible. However, I'm not sure how to do this. Based on reading <code>Data.Map.Strict</code>, it seems what you're supposed to do is call <code>splitRoot</code>, then do whatever parallel stuff you want on the resulting list, then recombine (I guess?). Have I basically got the right idea? If not, what should I do instead to parallelize the code above?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1465886541, "post_id": 37804372, "comment_id": 63074023, "body": "This irks me too sometimes. What I really want is some way to have the compiler magically warn me about <i>accidentally</i> shadowed names, but not when I was deliberately reusing a name. The only way that could work without magic is if I&#39;m marking deliberate cases of shadowing; I should probably mark the <i>uses</i> of the shadowed name too, to make sure I&#39;m not being brain-dead and trying to refer to two different things with the same name from the same scope. But it&#39;s hard to think of a way of marking allowed shadowing with less syntactic overhead than just sticking &#39; on things!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1465887396, "post_id": 37804372, "comment_id": 63074534, "body": "I always stick to silence the warning by renaming bindings, but I think it&#39;s a matter of personal preference. I like to see an identifier in the middle of the code and know that if it has a top-level binding then it&#39;s really that. Further, in defining auxiliary functions it&#39;s easy to reuse some argument name like <code>xs</code> and then confuse the two bindings. Sometimes, one can also write an accidentally recursive binding. Still, I can see that sometimes the warning is a bit annoying."}, {"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1465889836, "post_id": 37804372, "comment_id": 63076114, "body": "@ben, I think anything you prefix with <code>_</code> won&#39;t warn, so that might be an option too. That way if you wanted to re-use and nest <code>foo</code> twice you could do <code>_foo</code>, <code>_foo</code>, <code>_foo</code> instead of <code>foo</code>, <code>foo&#39;</code>, <code>foo&#39;&#39;</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1465935209, "post_id": 37804372, "comment_id": 63106341, "body": "Stupid question but how is paragraph different from paragraph&#39; ? I mean if they are different, you should be able to find two different names and if not maybe you only need one."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1465935319, "post_id": 37804372, "comment_id": 63106391, "body": "The type of bug it found is when you for example uses paragraph but make a typo  in it&#39;s definition (paragraph for example) if both have the same type it is really to find the bug."}, {"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1466044664, "post_id": 37804372, "comment_id": 63157321, "body": "They are indeed different @mb14, but to give the different names could be cumbersome: in this case they are really <code>paragraph</code> and <code>paragraphInTheContextOfABlockquote</code>. I guess I could call the latter <code>blockquoteParagraph</code>, but it does seem to be a bit lengthy compared to most names I see in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 1, "last_activity_date": 1466057349, "creation_date": 1466057349, "answer_id": 37851154, "question_id": 37804372, "link": "https://stackoverflow.com/questions/37804372/readability-trade-off-with-fwarn-name-shadowing/37851154#37851154", "title": "Readability trade-off with fwarn-name-shadowing", "body": "<p>Fair enough , I just add a similar problem where finding two different name is difficult. I still think name shadowing us a code smell and trying to find different meaningful names must be considered first.</p>\n"}], "owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1466057349, "creation_date": 1465885409, "question_id": 37804372, "link": "https://stackoverflow.com/questions/37804372/readability-trade-off-with-fwarn-name-shadowing", "title": "Readability trade-off with fwarn-name-shadowing", "body": "<p>I recently turned on GHC's <code>-Wall</code> option, which includes <a href=\"https://downloads.haskell.org/~ghc/7.0-latest/docs/html/users_guide/options-sanity.html\" rel=\"nofollow\"><code>-fwarn-name-shadowing</code></a>. The rationale offered is:</p>\n\n<blockquote>\n  <p>This option causes a warning to be emitted whenever an inner-scope value has the same name as an outer-scope value, i.e. the inner value shadows the outer one. This can catch typographical errors that turn into hard-to-find bugs.</p>\n</blockquote>\n\n<p>But in practice I haven't caught any bugs with it yet, but I <em>have</em> made the variable naming in my functions a lot more awkward to work around it. Abbreviated example:</p>\n\n<pre><code>-- General method for parsing a paragraph.\nparagraph :: Parser Node\nparagraph = undefined -- omitted for brevity\n\nblockquote :: Parser Node\nblockquote =   lookAhead (char '&gt;')\n           &gt;&gt;  Blockquote\n           &lt;$&gt; paragraph' `sepBy1` blankLine\n  where\n    -- Avoid shadowing a `paragraph` method defined above.\n    -- This one is more specialized and relevant only in\n    -- this context.\n    paragraph' = Paragraph &lt;$&gt; body\n</code></pre>\n\n<p>This seems a bit smelly to me, but I have other cases that are much worse \u2014 for example I have one function where I end up avoiding shadowing <code>remainder</code> and <code>sections</code> by using <code>remainder'</code> and <code>sections'</code>, and then in a nested <code>where</code> clause I go straight to <code>r</code> and <code>s</code> to avoid further shadowing \u2014 and I'm wondering whether <code>-fwarn-name-shadowing</code> is on the balance net positive. I think there is some refactoring I can do to avoid some shadowing without incurring the indirection of these awkward names, but it's not always possible.</p>\n\n<p>Am I better off allowing some shadowing, or should I instead be looking to refactor examples like this to make the smell go away? I suspect the latter, but I am not sure.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465875218, "post_id": 37802180, "comment_id": 63070247, "body": "Fizzled sparks are not necessarily bad - it just means that the main thread evaluated the spark before it was evaluated in the background. More details about your program would help. I think the main concern is cpu utilization - i.e. keeping your cores busy."}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465875412, "post_id": 37802180, "comment_id": 63070290, "body": "ErikR: How would I check CPU utilization (other than OS utilities) in my parallel Haskell program? According to OS utilities, I&#39;m using as much CPU as the OS can give me throughout."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1465876285, "post_id": 37802180, "comment_id": 63070466, "body": "You can use <a href=\"https://wiki.haskell.org/ThreadScope\" rel=\"nofollow noreferrer\">threadscope</a>. If you are saturating your cpus I wouldn&#39;t worry about the fizzles."}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465876939, "post_id": 37802180, "comment_id": 63070607, "body": "@ErikR: Thanks - I know about threadscope, but its memory use is making it difficult for me (my profiling code generates a 3G eventlog)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465877087, "post_id": 37802180, "comment_id": 63070647, "body": "Yeah - it&#39;s not suitable for large runs. Someone should write a more performant version which displays on a browser."}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1465872742, "creation_date": 1465872742, "question_id": 37802180, "link": "https://stackoverflow.com/questions/37802180/checking-what-fizzled-sparks-were-supposed-to-do", "title": "Checking what fizzled sparks were supposed to do", "body": "<p>I've been practicing using <code>Control.Parallel.Strategies</code>, along with profiling, to try and speed up my code. However, I'm persistently finding (in one particular codebase) that I have about 10% of my sparks fizzling. Is there any way to check what those fizzling sparks were supposed to be doing? I'd like to identify the source of the fizzles so that I can program it away.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1465872941, "creation_date": 1465872941, "answer_id": 37802213, "question_id": 37801979, "link": "https://stackoverflow.com/questions/37801979/writing-parallel-zip-using-control-parallel-strategies/37802213#37802213", "title": "Writing parallel ``zip`` using ``Control.Parallel.Strategies``", "body": "<p>I may be missing something, but isn't that just:</p>\n\n<pre><code>parZip :: Strategy (a, b) -&gt; [a] -&gt; [b] -&gt; [(a,b)]\nparZip strategy as bs = zip as bs `using` parList strategy\n</code></pre>\n\n<p>And yes, <code>Control.Parallel.Strategies</code> is really something special.</p>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1465872941, "creation_date": 1465870792, "question_id": 37801979, "link": "https://stackoverflow.com/questions/37801979/writing-parallel-zip-using-control-parallel-strategies", "title": "Writing parallel ``zip`` using ``Control.Parallel.Strategies``", "body": "<p>I've recently discovered the (frankly amazing) parallelism that's obtainable from judicious use of <code>Control.Parallel.Strategies</code>. I was curious if it is possible to write something like a parallel version of <code>zip</code> with the tools provided by <code>Control.Parallel.Strategies</code>. What I'm thinking of would have the following signature:</p>\n\n<p><code>parZip :: Strategy (a, b) -&gt; [a] -&gt; [b] -&gt; [(a,b)]</code></p>\n\n<p>Conceptually, it would work similarly to <code>parMap</code>, except applying an operation over two lists in parallel rather than just one. I'm not sure how I would go about writing this though. Would someone be able to tell me how I would go about this (if I can)?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 1783, "user_id": 2509549, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/px0ti.png?s=128&g=1", "display_name": "ThePiercingPrince", "link": "https://stackoverflow.com/users/2509549/thepiercingprince"}, "edited": false, "score": 1, "creation_date": 1465868016, "post_id": 37801596, "comment_id": 63068759, "body": "Where is your code?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1465868734, "post_id": 37801596, "comment_id": 63068896, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1465883792, "post_id": 37801596, "comment_id": 63072713, "body": "It is much more effective to post the code than to attempt to describe it."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1465877031, "creation_date": 1465877031, "answer_id": 37802773, "question_id": 37801596, "link": "https://stackoverflow.com/questions/37801596/get-the-left-element-of-a-either-function/37802773#37802773", "title": "Get the Left element of a Either function", "body": "<p>if I get your question right then what you are looking for is the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:either\" rel=\"nofollow\"><code>either</code></a> function.</p>\n\n<p>You should be able to use it like this:</p>\n\n<pre><code>either (return . Expected) id $ getCorError a b\n</code></pre>\n\n<p>of course in a context where <code>a</code> and <code>b</code> are defined - it's impossible to give you more than this hint because your question is really lacking details here.</p>\n\n<p>The way this works is like this:</p>\n\n<p>if <code>getCorError a b</code></p>\n\n<ul>\n<li>returns <code>Left c</code> then <code>return (Expected c)</code> is used and <code>return</code> here is just <code>\\a -&gt; [a]</code> (it's in the list monad)</li>\n<li>returns <code>Right errs</code> then <code>id errs</code> is used</li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 3537032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2567bc6fdd7b86c722273efe66d95ebb?s=128&d=identicon&r=PG&f=1", "display_name": "AleAnonMallo", "link": "https://stackoverflow.com/users/3537032/aleanonmallo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1465886838, "answer_count": 1, "score": -4, "last_activity_date": 1465877031, "creation_date": 1465867794, "question_id": 37801596, "link": "https://stackoverflow.com/questions/37801596/get-the-left-element-of-a-either-function", "closed_reason": "Not suitable for this site", "title": "Get the Left element of a Either function", "body": "<p>I have a function in Haskell\n<code>getCorError :: a -> b -> Either c [Error]</code>,\nbeing <code>Error = Expected c</code> <br>\nOn another function, which returns <code>-> [Error]</code>, I want to return <code>[Expected (getCorError a b)]</code> if <code>getCorError</code> returns Left or [Error] otherwise.<br>\nI get a type error when doing <code>[Expected (getCorError a b)]</code>. I have tried many things, like writing Left before the parentesis and after, and many others, and I haven't been able of doing this.\nAppreciate any help. </p>\n"}, {"tags": ["haskell", "hakyll", "overloaded-strings", "unordered-containers"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1465866791, "post_id": 37801054, "comment_id": 63068464, "body": "My guess is that you upgraded the package that defines <code>Metadata</code>, and that package changed from defining it to be in terms of <code>Map</code> to <code>HashMap</code>.  You need to update your usages of this type to use e.g. <code>HashMap.!</code> instead of <code>M.!</code>.  Or you could just change your cabal file to depend on an older version of the package."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 2, "creation_date": 1465901637, "post_id": 37801054, "comment_id": 63083992, "body": "In hakyll 4.8 <code>Metadata</code> type changed from <code>Map</code> to <code>Aeson.Object</code> (see <a href=\"https://groups.google.com/forum/#!topic/hakyll/M3SNUkH2zsQ\" rel=\"nofollow noreferrer\">release announcement</a>)"}, {"owner": {"reputation": 65, "user_id": 3930256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6nGb.png?s=128&g=1", "display_name": "Berkson", "link": "https://stackoverflow.com/users/3930256/berkson"}, "reply_to_user": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1465950533, "post_id": 37801054, "comment_id": 63111734, "body": "@JanTojnar gah! Thank you for telling me, but now I&#39;m even more lost!  I thought it&#39;d be just a drop in replacement for itself but instead of the error before I&#39;m getting:  <code>Couldn&#39;t match expected type \u2018[Char]\u2019 with actual type \u2018Value\u2019</code>  Instead! &gt;_&lt; Haskell is so confusing to me still."}], "answers": [{"tags": [], "owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "is_accepted": true, "score": 4, "last_activity_date": 1466608563, "last_edit_date": 1466608563, "creation_date": 1465977776, "answer_id": 37829498, "question_id": 37801054, "link": "https://stackoverflow.com/questions/37801054/m-map-sudden-expected-type-error/37829498#37829498", "title": "M.Map sudden expected type error", "body": "<p>Before hakyll 4.8 the <code>Metadata</code> type synonym was defined as follows:</p>\n\n<pre><code>type Metadata = HashMap.Map String String\n</code></pre>\n\n<p>The metadata were just a flat list of <em>key \u2013 value</em> pairs.</p>\n\n<p>In hakyll 4.8, metadata parsing was changed (<a href=\"https://github.com/jaspervdj/hakyll/issues/225\" rel=\"nofollow\">issue</a>, <a href=\"https://github.com/jaspervdj/hakyll/commit/e81468e0f64fdbe05794d5f8ccaebc00ee474ee2\" rel=\"nofollow\">commit</a>, <a href=\"https://groups.google.com/d/msg/hakyll/M3SNUkH2zsQ/Ft43KrOsAwAJ\" rel=\"nofollow\">release anouncement</a>) to use YAML parser, to allow more complex metadata structure. Now, the type synonym is following:</p>\n\n<pre><code>type Metadata = Aeson.Object\n</code></pre>\n\n<p>This is the <a href=\"https://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson-Types.html#v:Object\" rel=\"nofollow\"><code>Object</code></a> from <a href=\"https://hackage.haskell.org/package/aeson\" rel=\"nofollow\"><code>aeson</code></a> package \u2013 <a href=\"https://hackage.haskell.org/package/yaml\" rel=\"nofollow\"><code>Data.Yaml</code></a> library shares the types.</p>\n\n<p>Unfortunately, handling the <code>Aeson.Object</code> is not as straightforward as the <code>Map</code> was. To learn how to use Aeson properly, you can read a <a href=\"https://artyom.me/aeson\" rel=\"nofollow\">lengthy tutorial</a>.</p>\n\n<p>Luckily, Jasper provided us with a function <a href=\"https://hackage.haskell.org/package/hakyll-4.8.3.1/docs/Hakyll-Core-Metadata.html#v:lookupString\" rel=\"nofollow\"><code>lookupString</code></a> which is almost a drop-in replacement of <code>HashMap.!</code>:</p>\n\n<pre><code>(!) :: Metadata -&gt; String -&gt; String\nlookupString :: String -&gt; Metadata -&gt; Maybe String\n</code></pre>\n\n<p>Unwrapping the Maybe value, you will then get something like the following code:</p>\n\n<pre><code>directorizeDateAndAuthor :: Routes\ndirectorizeDateAndAuthor = metadataRoute $ \\md -&gt;\n  case lookupString \"author\" md of\n      Just author -&gt;\n          gsubRoute \"/[0-9]{4}-[0-9]{2}-[0-9]{2}-\" $ \\s -&gt;\n              replaceAll \"-\" (const \"/\") s ++ author ++ \"/\"\n      Nothing -&gt; error \"The author metadata field is missing.\"\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 3930256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6nGb.png?s=128&g=1", "display_name": "Berkson", "link": "https://stackoverflow.com/users/3930256/berkson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 37829498, "answer_count": 1, "score": 2, "last_activity_date": 1466608563, "creation_date": 1465863178, "question_id": 37801054, "link": "https://stackoverflow.com/questions/37801054/m-map-sudden-expected-type-error", "title": "M.Map sudden expected type error", "body": "<p>Everything was working great up until about a month or so ago...</p>\n\n<p>Suddenly I'm getting</p>\n\n<pre><code> berkson.github.io/source/blog.hs: 333, 42\n \u2022 Couldn't match type \u2018unordered-containers-0.2.7.1:Data.HashMap.Base.HashMap\n                          text-1.2.2.1:Data.Text.Internal.Text\n                          aeson-0.11.2.0:Data.Aeson.Types.Internal.Value\u2019\n                  with \u2018M.Map [Char] [Char]\u2019\n   Expected type: M.Map [Char] [Char]\n     Actual type: Metadata\n \u2022 In the first argument of \u2018(M.!)\u2019, namely \u2018md\u2019\n   In the first argument of \u2018(++)\u2019, namely \u2018(md M.! \"author\")\u2019\n   In the second argument of \u2018(++)\u2019, namely \u2018(md M.! \"author\") ++ \"/\"\u2019\n</code></pre>\n\n<p>From the code:</p>\n\n<pre><code> directorizeDateAndAuthor :: Routes\n directorizeDateAndAuthor = metadataRoute $ \\md -&gt;\n     gsubRoute \"/[0-9]{4}-[0-9]{2}-[0-9]{2}-\" $ \\s -&gt;\n         replaceAll \"-\" (const \"/\") s ++ (md M.! \"author\") ++ \"/\"\n</code></pre>\n\n<p>I was wondering if you'd mind helping me decipher what exactly it's telling me?  I get that there's some type  of syntax error on my end, but I don't understand what changed and why it's not compiling like it used to?</p>\n\n<p>Ref: <a href=\"https://github.com/berkson/berkson.github.io/blob/source/source/blog.hs#L330\" rel=\"nofollow\">https://github.com/berkson/berkson.github.io/blob/source/source/blog.hs#L330</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2544, "user_id": 598726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vu5nI.jpg?s=128&g=1", "display_name": "simpleigh", "link": "https://stackoverflow.com/users/598726/simpleigh"}, "edited": false, "score": 0, "creation_date": 1465854872, "post_id": 37799668, "comment_id": 63065303, "body": "I said &quot;What makes you think you should be using a fold? The question doesn&#39;t imply that: I read it as saying you need to filter the list of <code>Item</code> to return <code>DbDate</code> values and then unpack the <code>UTCTime</code> from each value.&quot; ... but I think I&#39;m seeing the light now. You can implement a filter as a fold by walking across your import list and concatenating valid values onto an output list."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465854902, "post_id": 37799668, "comment_id": 63065312, "body": "<code>::</code> isn&#39;t type casting."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465854935, "post_id": 37799668, "comment_id": 63065320, "body": "Has the book introduced list comprehensions yet?"}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465854980, "post_id": 37799668, "comment_id": 63065344, "body": "@melpomene The book has introduced me to list comprehensions aye. Should I be using them to decimate the database for UTCTime values?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1465855044, "post_id": 37799668, "comment_id": 63065376, "body": "Yeah, a list comprehension is probably the most straightforward solution to this problem. BTW, you don&#39;t need to interact with <code>Data.Time</code> for this task."}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465855289, "post_id": 37799668, "comment_id": 63065464, "body": "@melpomene So, how do I go about using list comprehensions to complete this task? I&#39;d imagine something like <code>[x | x &lt;- database, ...]</code>?"}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "reply_to_user": {"reputation": 2544, "user_id": 598726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vu5nI.jpg?s=128&g=1", "display_name": "simpleigh", "link": "https://stackoverflow.com/users/598726/simpleigh"}, "edited": false, "score": 0, "creation_date": 1465855608, "post_id": 37799668, "comment_id": 63065569, "body": "@simpleigh Yeh, that&#39;s what the task might be asking me to do. There are other ways as @melpomene has described. But I think the task wants me to use folds, since the tasks are in a chapter regarding folds and their uses. It did demonstrate that I could assert types with <code>::</code> so it might have something to do with that."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1465896128, "post_id": 37799668, "comment_id": 63080053, "body": "@Poriferous For the record, the comprehension-based definition would be <code>filterDate items = [time | DbDate time &lt;- items]</code>. This exploits that in list comprehensions, pattern failures (i.e. non-<code>DbDate</code> items) are silently skipped."}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1465905858, "post_id": 37799668, "comment_id": 63087070, "body": "@FrerichRaabe That&#39;s very interesting! I didn&#39;t know that. But then, how can we create a generic filter function that can get values by type? For example, would it be possible to pass a type to the function so that it can get values of that type? I do notice that these getters/filters have similar behaviour/functionality. So, something like <code>filterBy TYPE items = [t | TYPE t &lt;- items]</code> could be valid? Then I could call the function as <code>let m = filterBy DbDate database</code> which would return all the values of type <code>DbDate</code> from the <code>database</code>."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1465913794, "post_id": 37799668, "comment_id": 63093219, "body": "@Poriferous I don&#39;t think that generalization gets you very far, but you could define a function <code>Item -&gt; Maybe UTCTime</code> via <code>f x = case x of DbDate t -&gt; Just t; _ -&gt; Nothing</code>. And then use <code>mapMaybes f</code> to get a function <code>[Item] -&gt; [UTCTime]</code>. <code>mapMaybes</code> is from <code>Data.Maybe</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1465856883, "post_id": 37799942, "comment_id": 63065981, "body": "Not quite because DbDate requires an argument before it can be used for pattern matching. The compiler complains about the lack of arguments to DbDate."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465857328, "post_id": 37799942, "comment_id": 63066124, "body": "Try <code>filterFn (DbDate x) xs = x:xs</code> and <code>filterFn _ xs = xs</code>. Only two arguments must be used here, so parentheses are needed."}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465857918, "post_id": 37799942, "comment_id": 63066297, "body": "@chi I think that&#39;s more along the lines of what the compiler agrees with. I modified the filter function then I used <code>foldr filterDate [] database</code> which returns the time values as a list. It was more an issue as to how I &#39;fetch&#39; the right types. My only concern here is that this function actually doesn&#39;t have the same type signature. From what I have, filterDate&#39;s type signature is <code>Item -&gt; [UTCTime] -&gt; [UTCTime]</code>."}, {"owner": {"reputation": 2544, "user_id": 598726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vu5nI.jpg?s=128&g=1", "display_name": "simpleigh", "link": "https://stackoverflow.com/users/598726/simpleigh"}, "reply_to_user": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1465859172, "post_id": 37799942, "comment_id": 63066682, "body": "@Poriferous are you sure? Using your definition of <code>Item</code> and my definitions of <code>filterFn</code> and <code>filterDate</code> above, <code>ghci</code> gives me the following type signature: <code>filterDate :: [Item] -&gt; [UTCTime]</code> which is what we want."}, {"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1465860978, "post_id": 37799942, "comment_id": 63067122, "body": "Being a C++ programmer, I naturally renamed the <code>filterFn</code> functions to getters which helps me understand things a bit better. Thanks to you two I&#39;ve been able to solve all tasks seamlessly. :-)"}], "tags": [], "owner": {"reputation": 2544, "user_id": 598726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vu5nI.jpg?s=128&g=1", "display_name": "simpleigh", "link": "https://stackoverflow.com/users/598726/simpleigh"}, "is_accepted": true, "score": 5, "last_activity_date": 1465859086, "last_edit_date": 1495539862, "creation_date": 1465855750, "answer_id": 37799942, "question_id": 37799668, "link": "https://stackoverflow.com/questions/37799668/filtering-for-values-in-haskell/37799942#37799942", "title": "Filtering for values in Haskell", "body": "<p>OK, my Haskell-fu is extremely weak but I'm going to have a stab at an answer. You're looking to define a function that walks across a list and filters it. If the value is a <code>DbDate</code> then you return <code>&lt;that value&gt; : &lt;output list&gt;</code>, otherwise you return <code>&lt;output list&gt;</code>. By folding over the input you produce a filtered output. There's a relevant question at <a href=\"https://stackoverflow.com/questions/5726445/how-would-you-define-map-and-filter-using-foldr-in-haskell\">How would you define map and filter using foldr in Haskell?</a> which might explain this better.</p>\n\n<p>This breaks down to something like:</p>\n\n<pre><code>filterFn :: Item -&gt; [UTCTime] -&gt; [UTCTime]\nfilterFn (DbDate x) xs = x:xs\nfilterFn _ xs = xs\n</code></pre>\n\n<p>(this might be a syntax fail). This function takes an item off our <code>[Item]</code> and pattern matches.</p>\n\n<ul>\n<li>If it matches <code>DbDate x</code> then <code>x</code> is a <code>UTCTime</code> and we append it to our input list.</li>\n<li>If it doesn't then we ignore it and return the input list unchanged.</li>\n</ul>\n\n<p>We can then fold:</p>\n\n<pre><code>filterDate = foldr filterFn []\n</code></pre>\n\n<p>Does that get you to an answer?</p>\n"}, {"tags": [], "owner": {"reputation": 5190, "user_id": 353268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/68f14024956c4a67bd92f44a15505e7c?s=128&d=identicon&r=PG", "display_name": "mariosangiorgio", "link": "https://stackoverflow.com/users/353268/mariosangiorgio"}, "is_accepted": false, "score": 0, "last_activity_date": 1465855896, "creation_date": 1465855896, "answer_id": 37799971, "question_id": 37799668, "link": "https://stackoverflow.com/questions/37799668/filtering-for-values-in-haskell/37799971#37799971", "title": "Filtering for values in Haskell", "body": "<p>Item is defined as a union type, which means it can be a <code>DbString</code>, a <code>DbNumber</code> or a <code>DbDate</code>.</p>\n\n<pre><code>data Item = DbString String\n      | DbNumber Integer\n      | DbDate UTCTime\n      deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>You can use <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow\">pattern matching</a> to get only the value you're interested in. You need to match on an item, check whether it is a <code>DbDate</code> and if that's the case extract the <code>UTCTime</code> instance it holds.</p>\n\n<p>You said you want to use a <a href=\"https://wiki.haskell.org/Fold\" rel=\"nofollow\">fold</a> so you need an accumulator where you can put the values you want to keep and a function to populate it.</p>\n\n<pre><code>filterDate items = foldl accumulate [] items\n    where extractTime item = case item of DbDate time -&gt; [time]\n                                          _ -&gt; []\n          accumulate item accumulator = accumulator ++ (extractTime item)\n</code></pre>\n\n<p>In the code above you have <code>extractTime</code> that pattern matches over an item and either returns a list containing the time or it returns an empty list. The <code>accumulate</code> function just puts together the values you got from the previous steps (they're stored in <code>accumulator</code>) and the value you got applying <code>extractTime</code> to the current item.</p>\n"}], "owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 37799942, "answer_count": 2, "score": 0, "last_activity_date": 1465859086, "creation_date": 1465854441, "question_id": 37799668, "link": "https://stackoverflow.com/questions/37799668/filtering-for-values-in-haskell", "title": "Filtering for values in Haskell", "body": "<p>I've been doing some Haskell exercises from a Haskell book, and one of the tasks is for me to filter for values of a certain type and return them as a list.</p>\n\n<pre><code>import Data.Time\n\ndata Item = DbString String\n          | DbNumber Integer\n          | DbDate UTCTime\n          deriving (Eq, Ord, Show)\n\n\ndatabase :: [Item]\ndatabase =\n  [\n    DbDate (UTCTime (fromGregorian 1911 5 1) (secondsToDiffTime 34123)),\n    DbNumber 9001,\n    DbString \"Hello World!\",\n    DbDate (UTCTime (fromGregorian 1921 5 1) (secondsToDiffTime 34123))\n  ]\n</code></pre>\n\n<p>That's the code I am given to work with, and for my first task:</p>\n\n<p><code>Write a function that filters for DbDate values and returns a list of the UTCTime values inside them.</code> The template for the function is:</p>\n\n<pre><code>filterDate :: [Item] -&gt; [UTCTime]\nfilterDate = undefined\n</code></pre>\n\n<p>What I have to use here are folds since that is the matter concerned here. </p>\n\n<p>I looked up the <code>Data.Time</code> module on Hoogle and that didn't really help since I couldn't understand how to interact with the module. Maybe I'm looking at this from a wrong perspective because I don't think it has something to do with the <code>filter</code> function, and I don't think it has something to do with type-casting neither <code>::</code>. </p>\n\n<p>How do I get UTCTime values, and how do I filter for them?</p>\n"}, {"tags": ["haskell", "functional-programming", "ocaml", "functor", "caml"], "comments": [{"owner": {"reputation": 2918, "user_id": 5194348, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/91884122e7f9b08a3132ac2cd91a031a?s=128&d=identicon&r=PG&f=1", "display_name": "Lhooq", "link": "https://stackoverflow.com/users/5194348/lhooq"}, "edited": false, "score": 2, "creation_date": 1465853835, "post_id": 37799280, "comment_id": 63064930, "body": "This must be one of the best written question i&#39;ve ever seen ! Hope someone will find an answer !"}], "answers": [{"comments": [{"owner": {"reputation": 379, "user_id": 1749328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b50ba2c2d5650c076af799b042908629?s=128&d=identicon&r=PG", "display_name": "Samuele Giraudo", "link": "https://stackoverflow.com/users/1749328/samuele-giraudo"}, "edited": false, "score": 0, "creation_date": 1465892189, "post_id": 37799836, "comment_id": 63077517, "body": "Thanks, this is in fact quite easy! In some sense, can we say that the system of type classes of Haskell and those of modules and functor of OCaml are equivalent?"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1465907561, "post_id": 37799836, "comment_id": 63088347, "body": "They&#39;re not equivalent. As described in <a href=\"http://www.cse.unsw.edu.au/~chak/papers/mtc-popl.pdf\" rel=\"nofollow noreferrer\">Modular Type Classes</a>, ML&#39;s module system is more flexible and general than Haskell&#39;s type classes, but don&#39;t allow recursion. Combining them means you don&#39;t have to write functor application manually, but you also avoid Haskell&#39;s problem of only one imported type class instance per type. See Stefan Wehr&#39;s <a href=\"http://www.stefanwehr.de/publications/Wehr_ML_modules_and_Haskell_type_classes.pdf\" rel=\"nofollow noreferrer\">ML Modules and Haskell Type Classes: A constructive Comparison</a> pp. 107-110 for a summary of the differences."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 3, "creation_date": 1465909825, "post_id": 37799836, "comment_id": 63090125, "body": "Correction: Smarter persons than I point out; Oleg Kiselyov proved an equivalence between the two (given some dated definition of Haskell type classes), although I cannot find this article, while modern Haskell type classes are stronger than ML modules as they provide type-level functions. I&#39;ll avoid making any more bold statements and will go back to writing cool code snippets. ;-)"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1465910432, "post_id": 37799836, "comment_id": 63090635, "body": "Here: <a href=\"https://mail.haskell.org/pipermail/haskell/2004-September/014515.html\" rel=\"nofollow noreferrer\">Applicative translucent functors in Haskell (2004)</a> by Oleg Kiselyov and Chung-chieh Shan."}, {"owner": {"reputation": 379, "user_id": 1749328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b50ba2c2d5650c076af799b042908629?s=128&d=identicon&r=PG", "display_name": "Samuele Giraudo", "link": "https://stackoverflow.com/users/1749328/samuele-giraudo"}, "edited": false, "score": 0, "creation_date": 1465915419, "post_id": 37799836, "comment_id": 63094530, "body": "Thanks, very interesting!"}], "tags": [], "owner": {"reputation": 3539, "user_id": 4220738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4p0i.png?s=128&g=1", "display_name": "Drup", "link": "https://stackoverflow.com/users/4220738/drup"}, "is_accepted": true, "score": 13, "last_activity_date": 1465855935, "last_edit_date": 1465855935, "creation_date": 1465855214, "answer_id": 37799836, "question_id": 37799280, "link": "https://stackoverflow.com/questions/37799280/ocaml-functors-haskell-type-classes-and-multiple-derivation/37799836#37799836", "title": "OCaml functors, Haskell type classes, and multiple derivation", "body": "<p>Sure, that's actually quite easy, use module inclusion.</p>\n\n<pre><code>module type S = sig\n  include Showable\n  include Readable with type t := t (* destructive substitution *)\nend\n\nmodule F ( M : S ) = struct\n  let fake_id x = M.from_string @@ M.to_string x\nend\n</code></pre>\n\n<p>Destructive substitution is explained in the manual: <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec234\">http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec234</a><br>\nThe rest is regular module stuff (see the manual for a complete explanation)</p>\n\n<p>Some functor-heavy library rely on this kind of structural subtyping quite a lot. For example, each functor in <a href=\"http://ocamlgraph.lri.fr/index.en.html\">ocamlgraph</a> define its own module type argument. Here is an example with the <a href=\"http://ocamlgraph.lri.fr/doc/Kruskal.html\">Kruskal module</a>. The functor expect a module of type <code>Kruskal.G</code>, which implements a subsignature of <code>Sig.G</code> (which is implemented by most graph modules). </p>\n"}], "owner": {"reputation": 379, "user_id": 1749328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b50ba2c2d5650c076af799b042908629?s=128&d=identicon&r=PG", "display_name": "Samuele Giraudo", "link": "https://stackoverflow.com/users/1749328/samuele-giraudo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 854, "favorite_count": 3, "accepted_answer_id": 37799836, "answer_count": 1, "score": 15, "last_activity_date": 1465855935, "creation_date": 1465852595, "last_edit_date": 1495542261, "question_id": 37799280, "link": "https://stackoverflow.com/questions/37799280/ocaml-functors-haskell-type-classes-and-multiple-derivation", "title": "OCaml functors, Haskell type classes, and multiple derivation", "body": "<p>It is well-known that OCaml has a parametric polymorphism and this leads to some limitations. Haskell, through its type classes, offers an <em>ad hoc</em> polymorphism, which is, obviously, very convenient in several situations. It is also well-known that the system of modules and functors of OCaml allows to create a kind of <em>ad hoc</em> polymorphism. See the great recent answer of Simon Shine <a href=\"https://stackoverflow.com/questions/37694313/make-ocaml-function-polymorphic-for-int-lists-and-float-lists\">here</a> for instance.</p>\n\n<p>My point is that it is possible in Haskell to create types that <strong>derive several types classes</strong>. For instance :</p>\n\n<pre><code>data Person = Person { firstName :: String\n                 , lastName :: String\n                 , age :: Int\n                 } deriving (Eq, Show, Read)\n</code></pre>\n\n<p>This is very convenient to define types having several features (allowing values of type <code>Person</code> to support equality tests, be printable, and be readable in the given example).</p>\n\n<p>My question is the following: Can we do the same, simply, in OCaml? By <em>simply</em> I mean with the ground syntax of the language and without many artifices.</p>\n\n<p>To give a somewhat concrete example, suppose we have two OCaml signatures</p>\n\n<pre><code>module type Showable = sig\n    type t\n    val to_string : t -&gt; string\nend\n\nmodule type Readable = sig\n    type t\n    val from_string : string -&gt; t\nend\n</code></pre>\n\n<p>The aim is to write a functor <code>F</code> parametrized by a module which implements both <code>Showable</code> and <code>Readable</code>.</p>\n"}, {"tags": ["json", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 3072, "user_id": 96725, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/523b735c515f4f89e7f4f1f31d2add74?s=128&d=identicon&r=PG", "display_name": "Oguz Bilgic", "link": "https://stackoverflow.com/users/96725/oguz-bilgic"}, "edited": false, "score": 0, "creation_date": 1465854360, "post_id": 37798846, "comment_id": 63065129, "body": "I&#39;m getting this error: main.hs:40:22:     Couldn&#39;t match expected type \u2018Text\u2019 with actual type \u2018[Char]\u2019     In the second argument of \u2018(.:)\u2019, namely \u2018&quot;type&quot;\u2019     In the second argument of \u2018(&lt;$&gt;)\u2019, namely \u2018v .: &quot;type&quot;\u2019     In the expression: Message &lt;$&gt; v .: &quot;type&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3072, "user_id": 96725, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/523b735c515f4f89e7f4f1f31d2add74?s=128&d=identicon&r=PG", "display_name": "Oguz Bilgic", "link": "https://stackoverflow.com/users/96725/oguz-bilgic"}, "edited": false, "score": 0, "creation_date": 1465857375, "post_id": 37798846, "comment_id": 63066144, "body": "@OguzBilgic Turn on <code>OverloadedStrings</code> or <code>pack</code> the <code>&quot;type&quot;</code> yourself."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1465850811, "creation_date": 1465850811, "answer_id": 37798846, "question_id": 37798556, "link": "https://stackoverflow.com/questions/37798556/attribute-names-for-decoding-json/37798846#37798846", "title": "Attribute names for decoding JSON", "body": "<p>using <code>type</code> as a record type is not allowed, you will have to make some changes.</p>\n\n<p>If you are willing to use Aeson instead of the json package, you can do this by writing the instance by hand, as follows....</p>\n\n<pre><code>data Message = Message {\n  type' :: String\n  } deriving (Eq, Show)\n\ninstance FromJSON Message where\n   parseJSON (Object v) = Message &lt;$&gt; v .: \"type\"\n\nmain = do\n  let m = decode \"{\\\"type\\\":\\\"event\\\"}\" :: Maybe Message\n  putStrLn (show $ fmap type' m)\n</code></pre>\n\n<p>You will have to change the flow of the program a little bit....</p>\n"}], "owner": {"reputation": 3072, "user_id": 96725, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/523b735c515f4f89e7f4f1f31d2add74?s=128&d=identicon&r=PG", "display_name": "Oguz Bilgic", "link": "https://stackoverflow.com/users/96725/oguz-bilgic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 37798846, "answer_count": 1, "score": 1, "last_activity_date": 1465850811, "creation_date": 1465849637, "question_id": 37798556, "link": "https://stackoverflow.com/questions/37798556/attribute-names-for-decoding-json", "title": "Attribute names for decoding JSON", "body": "<pre><code>data Message = Message {\n  type :: String\n} deriving (Eq, Show, Data, Typeable)\n\n\n-- main funciton\nlet m = decodeJSON \"{\\\"type\\\":\\\"event\\\"}\" :: Message\nputStrLn (type m)\n</code></pre>\n\n<p>Haskell newbie here, Im trying to decode messages I receive from a websocket connection. However Haskell doesn't let me use the 'type' word as an attribute for the Message type. What would be the way to decode this JSON message if attributes contain words such as type.</p>\n"}, {"tags": ["haskell", "functional-programming", "arrows"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1465844112, "post_id": 37796783, "comment_id": 63060393, "body": "Simon Peyton-Jones has a great email to one of the mailing lists (which I am now having trouble finding) which discusses the subtleties of typechecking pattern bindings like this. It is so subtle, in fact, that the Haskell98 Report overlooked the issue entirely, and the committee spent some time deliberating on how typechecking should be done for pattern bindings before writing the Haskell 2010 Report. I would write an answer, except I don&#39;t trust myself to get the subtleties right without SPJ&#39;s email in front of me..."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1465847870, "post_id": 37796783, "comment_id": 63062252, "body": "At a guess, the problem here is that the righthand side of the binding gets the inferred type <code>forall a1 a2. (Arrow a1, Arrow a2) =&gt; (a1 ..., a2 ...)</code> as opposed to <code>(forall a1. Arrow a1 =&gt; ..., forall a2. Arrow a2 =&gt; ...)</code>, so the forall is moved <i>out</i> of the tuple, and either of the values in the pair are not fully polymorphic themselves."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1465843973, "post_id": 37797040, "comment_id": 63060316, "body": "He has <code>(a, b) = ...</code>, not <code>foo = ...</code>, which makes a difference. This is not the monomorphism restriction. Turn it off and see for yourself. I can guarantee you didn&#39;t do this, because the code you posted doesn&#39;t even have the right import."}, {"owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465844072, "post_id": 37797040, "comment_id": 63060374, "body": "@DanielWagner: Sorry about the import. That was just a typo and the code that I was actually running had the correct &quot;Control.Arrow&quot; at the top all along :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1465844262, "post_id": 37797040, "comment_id": 63060462, "body": "Nevertheless your answer is incorrect, because of the other objection I raised: <code>(a, b) = ...</code> and <code>foo = ...</code> do not behave the same."}, {"owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465844443, "post_id": 37797040, "comment_id": 63060551, "body": "Its hard to be 100% certain without a more complete example from the OP. The error message from the <code>foo = </code> case is very similar to what is in the question."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1465847715, "post_id": 37797040, "comment_id": 63062148, "body": "This example is wrong, but it actually helped me see why this is a difficult problem. Take your (valid) definition of <code>foo</code> and then run <code>:t fst foo</code>\u2013it won&#39;t work because <code>(Arrow a, Arrow a1) =&gt; (..., ...)</code> is different from <code>(Arrow a =&gt; ..., Arrow a1 =&gt; ...)</code>."}], "tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": false, "score": 1, "last_activity_date": 1465843977, "last_edit_date": 1465843977, "creation_date": 1465843579, "answer_id": 37797040, "question_id": 37796783, "link": "https://stackoverflow.com/questions/37796783/control-arrow-why-let-a-b-first-second-fails/37797040#37797040", "title": "Control.Arrow: Why &quot;let (a,b) = (first,second)&quot; fails?", "body": "<p>It looks like you are running <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">monomorphism restriction</a>. This is just a limitation of Haskell's type inference and you can get around it by adding an explicit type signature.</p>\n\n<pre><code>import Control.Arrow\n\nfoo :: (Arrow a, Arrow a1) =&gt; (a b c -&gt; a (b, d) (c, d), a1 b1 c1 -&gt; a1 (d1, b1) (d1, c1))\nfoo = (first, second)\n</code></pre>\n\n<p>This code typechecks fine with the type signature for <code>foo</code> but gives that \"ambiguous variable\" compilation error if you remove it.</p>\n\n<p>BTW, the type signature I used was the one inferred by <code>:t (first, second)</code> in GHCI. Since you want <code>(first, second)</code> and <code>(second, first)</code> to have the same type, you will probably want to use a more specific type in your annotation, such as the following one:</p>\n\n<pre><code>foo :: (Arrow a) =&gt; (a b b -&gt; a (b, b) (b, b), a b b -&gt; a (b, b) (b, b))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1465895530, "creation_date": 1465895530, "answer_id": 37807671, "question_id": 37796783, "link": "https://stackoverflow.com/questions/37796783/control-arrow-why-let-a-b-first-second-fails/37807671#37807671", "title": "Control.Arrow: Why &quot;let (a,b) = (first,second)&quot; fails?", "body": "<p>Very shortly, you try to construct Impredicative type which GHC cannot infer. You can do:</p>\n\n<pre><code>\u03bb Control.Arrow &gt; let (a,b) = (first, second) :: Arrow a =&gt; (a b b -&gt; a (b, b) (b, b), a b b -&gt; a (b, b) (b, b))\n\u03bb Control.Arrow &gt; :t a\na :: Arrow a =&gt; a b b -&gt; a (b, b) (b, b)\n\u03bb Control.Arrow &gt; :t b\nb :: Arrow a =&gt; a b b -&gt; a (b, b) (b, b)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>:set -XImpredicativeTypes \n\u03bb Control.Arrow &gt; let (a,b) = (first, second) :: (Arrow a =&gt; a b b -&gt; a (b, b) (b, b), Arrow a =&gt; a b b -&gt; a (b, b) (b, b))\n\u03bb Control.Arrow &gt; :t a\na :: Arrow a =&gt; a b b -&gt; a (b, b) (b, b)\n\u03bb Control.Arrow &gt; :t b\nb :: Arrow a =&gt; a b b -&gt; a (b, b) (b, b)\n</code></pre>\n\n<p>but you cannot do:</p>\n\n<pre><code>\u03bb Control.Arrow &gt; let (a,b) = (first, second) :: (Arrow a, Arrow a') =&gt; (a b b -&gt; a (b, b) (b, b), a' b b -&gt; a' (b, b) (b, b))\n</code></pre>\n\n<hr>\n\n<p>To isolate the issue, this works:</p>\n\n<pre><code>\u03bb Control.Arrow &gt; let p = (first, second) :: (Arrow a, Arrow a') =&gt; (a b b -&gt; a (b, b) (b, b), a' b b -&gt; a' (b, b) (b, b));\n\u03bb Control.Arrow &gt; :t p\np :: (Arrow a', Arrow a) =&gt;\n     (a b b -&gt; a (b, b) (b, b), a' b b -&gt; a' (b, b) (b, b))\n</code></pre>\n\n<p>but when you try to bind that to pattern:</p>\n\n<pre><code>\u03bb Control.Arrow &gt; let (a, b) = p\n</code></pre>\n\n<p>it fails. Constraints are outside of the pair type, and are redundant for other halves of the pair, as</p>\n\n<pre><code>\u03bb Control.Arrow &gt; :set -XImpredicativeTypes \n\u03bb Control.Arrow &gt; let p = (first, second) :: (Arrow a =&gt; a b b -&gt; a (b, b) (b, b), Arrow a =&gt; a b b -&gt; a (b, b) (b, b))\n\u03bb Control.Arrow &gt; let (a, b) = p\n</code></pre>\n\n<p>works.</p>\n\n<hr>\n\n<p>Simple example:</p>\n\n<pre><code>\u03bb Prelude Data.Monoid &gt; :t (mappend, ())\n(mappend, ()) :: Monoid a =&gt; (a -&gt; a -&gt; a, ())\n\u03bb Prelude Data.Monoid &gt; let (a, b) = (mappend, ())\n\n&lt;interactive&gt;:12:5:\n    No instance for (Monoid a0)\n      arising from the ambiguity check for \u2018b\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    When checking that \u2018b\u2019 has the inferred type \u2018()\u2019\n    Probable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>One have to carry constraints over, but there is no <code>a</code> in the type of <code>()</code>, i.e. <code>Monoid a =&gt; ()</code> is ambigious type.</p>\n\n<hr>\n\n<p>Note: <code>let (a,b) = ((+), (*))</code> seems to work. I have no idea why and how <code>Num</code> is treated specially:</p>\n\n<pre><code>\u03bb Prelude Data.Monoid &gt; let x = () ::  Num a =&gt; ()\n\u03bb Prelude Data.Monoid &gt; :t x\nx :: ()\n\u03bb Prelude Data.Monoid &gt; let x = () :: Monoid m =&gt; ()\n\n&lt;interactive&gt;:12:9:\n    No instance for (Monoid m0)\n    ...\n</code></pre>\n"}], "owner": {"reputation": 648, "user_id": 3746344, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/535099e26619eeb7031527c47b1ab665?s=128&d=identicon&r=PG&f=1", "display_name": "Savenkov Alexey", "link": "https://stackoverflow.com/users/3746344/savenkov-alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 37807671, "answer_count": 2, "score": 8, "last_activity_date": 1465895530, "creation_date": 1465842564, "question_id": 37796783, "link": "https://stackoverflow.com/questions/37796783/control-arrow-why-let-a-b-first-second-fails", "title": "Control.Arrow: Why &quot;let (a,b) = (first,second)&quot; fails?", "body": "<p>What I want is to write something like this:</p>\n\n<p><code>let (a,b) = if *condition* then (first, second) else (second, first)</code></p>\n\n<p>I found out that I cannot write even this:</p>\n\n<p><code>let (a,b) = (first,second)</code></p>\n\n<p>It fails with an error:</p>\n\n<pre><code> &lt;interactive&gt;:7:5:                                                                                                                          \nCould not deduce (Arrow a0)                                                                                                             \nfrom the context (Arrow a)\n  bound by the inferred type for `a':\n             Arrow a =&gt; a b c -&gt; a (b, d) (c, d)\n  at &lt;interactive&gt;:7:5-26\nThe type variable `a0' is ambiguous\nWhen checking that `a' has the inferred type\n  a :: forall (a :: * -&gt; * -&gt; *) b c d.\n       Arrow a =&gt;\n       a b c -&gt; a (b, d) (c, d)\nProbable cause: the inferred type is ambiguous\n\n&lt;interactive&gt;:7:5:\nCould not deduce (Arrow a0)\nfrom the context (Arrow a)\n  bound by the inferred type for `b':\n             Arrow a =&gt; a b c -&gt; a (d, b) (d, c)\n  at &lt;interactive&gt;:7:5-26\nThe type variable `a0' is ambiguous\nWhen checking that `b' has the inferred type\n  b :: forall (a :: * -&gt; * -&gt; *) b c d.\n       Arrow a =&gt;\n       a b c -&gt; a (d, b) (d, c)\nProbable cause: the inferred type is ambiguous\n</code></pre>\n"}, {"tags": ["haskell", "either"], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1465846708, "post_id": 37797447, "comment_id": 63061618, "body": "Why was the question closed?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1465851499, "post_id": 37797447, "comment_id": 63064015, "body": "It was marked as a dup. This kind of question has come up before, but not exactly in this context, so I decided to re-open it and add an answer."}, {"owner": {"reputation": 5927, "user_id": 488035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85034ef64232dfcb7cf269e8d30b17a5?s=128&d=identicon&r=PG", "display_name": "Lachezar", "link": "https://stackoverflow.com/users/488035/lachezar"}, "edited": false, "score": 0, "creation_date": 1590504576, "post_id": 37797447, "comment_id": 109700742, "body": "It seems EitherT is not on Stackage, does that mean that the preferred approach is to use Except for such control flow? <a href=\"https://hoogle.haskell.org/?hoogle=EitherT\" rel=\"nofollow noreferrer\">hoogle.haskell.org/?hoogle=EitherT</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1465845165, "creation_date": 1465845165, "answer_id": 37797447, "question_id": 37796211, "link": "https://stackoverflow.com/questions/37796211/how-to-avoid-pyramid-of-cases/37797447#37797447", "title": "How to avoid pyramid of cases?", "body": "<p>I'm reopening this question because I think it would be helpful to see \nhow to transform this kind of specific code.</p>\n\n<p>We'll need a few imports:</p>\n\n<pre><code>import Control.Monad.Trans\nimport Control.Monad.Trans.Either\n</code></pre>\n\n<p>Then transform your <code>get</code> function by applying <code>EitherT</code> to each IO-action which signals an error by returning an <code>Either</code>:</p>\n\n<pre><code>-- get' :: EitherT String IO ()\nget' id = do\n  d1 &lt;- EitherT $ getData1 id\n  d2 &lt;- EitherT $ getData2 (d2Id d1)\n  d3 &lt;- EitherT $ getData3 (d3Id d2)\n  liftIO $ process d1 d2 d3\n</code></pre>\n\n<p>Note that we don't use <code>EitherT</code> for <code>process</code>. Instead we use <code>liftIO</code> since <code>process</code> doesn't signal an error.</p>\n\n<p>GHC should be able to infer the type signature so you don't need to provide it.</p>\n\n<p>To run the new version, use <code>runEitherT</code> which will return an <code>Either</code> value in the IO-monad:</p>\n\n<pre><code>doit :: String -&gt; IO ()\ndoit id = do\n  res &lt;- runEitherT (get' id)\n  case res of\n    Left err -&gt; print err\n    Right d  -&gt; return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37, "user_id": 1559094, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9j9m7.jpg?s=128&g=1", "display_name": "Eddtothefullest", "link": "https://stackoverflow.com/users/1559094/eddtothefullest"}, "is_accepted": false, "score": 1, "last_activity_date": 1523057433, "last_edit_date": 1523057433, "creation_date": 1523056987, "answer_id": 49702210, "question_id": 37796211, "link": "https://stackoverflow.com/questions/37796211/how-to-avoid-pyramid-of-cases/49702210#49702210", "title": "How to avoid pyramid of cases?", "body": "<p>Since support for runEitherT has been dropped in <a href=\"https://hackage.haskell.org/package/either-5/changelog\" rel=\"nofollow noreferrer\">Either-5</a>, I would recommend using <code>whenLeft</code> and <code>whenRight</code> from <code>Data.Either.Combinators</code>. Your code could be rewritten as follows:</p>\n\n<pre><code>get :: String -&gt; IO ()\nget id = do\n           r1 &lt;- getData1 id\n           whenLeft r1 print\n           whenRight r1 (\\d1 -&gt; do \n                                  r2 &lt;- getData2 $ d2Id d1\n                                  whenLeft r2 print\n                                  whenRight r2 (d2 -&gt; \n                                                   [rest of code...] )\n                         )\n</code></pre>\n\n<p>Of course, this would lead to messy code, so whenever I do this, I make sure to end the computation whenever a <code>Left</code> is encountered. The <code>Except</code> monad is great for this. Using it, the code would be rewritten as follows:</p>\n\n<pre><code>get :: String -&gt; ExceptT String IO ()\nget id = do\n           r1 &lt;- liftIO $ getData1 id\n           whenLeft r1 throwError \n           r2 &lt;- liftIO $ getData2 $ d2Id (fromRight r1)\n           whenLeft r2 throwError\n           r3 &lt;- liftIO $ getData3 $ d3Id (fromRight r2)\n           whenLeft r3 throwError\n           liftIO $ process (fromRight r1) (fromRight r2) (fromRight r3)\n</code></pre>\n\n<p>This will make the <code>fromRight</code> statements never fail, because whenever r1,r2 or r3 are <code>Left</code>, the computation will throw an error and it will stop there.</p>\n"}], "owner": {"reputation": 29647, "user_id": 4999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae995fa03b218e7c27a608b5f14e68ae?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz", "link": "https://stackoverflow.com/users/4999/%c5%81ukasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 2, "accepted_answer_id": 37797447, "answer_count": 2, "score": 4, "last_activity_date": 1523057433, "creation_date": 1465840440, "question_id": 37796211, "link": "https://stackoverflow.com/questions/37796211/how-to-avoid-pyramid-of-cases", "title": "How to avoid pyramid of cases?", "body": "<p>I have code structured like the example below. I'm pretty sure there should be a way to structure it much more sanely. I would assume Either (or Error) monad could help, but I don't know where to start with that. Any pointers to get me going in the right direction?</p>\n\n<pre><code>data Data1 = Data1 { d2Id :: String }\ndata Data2 = Data2 { d3Id :: String }\ndata Data3 = Data3 { d4Id :: String }\n\ngetData1 :: String -&gt; IO (Either String Data1)\ngetData2 :: String -&gt; IO (Either String Data2)\ngetData3 :: String -&gt; IO (Either String Data3)\n\nprocess :: Data1 -&gt; Data2 -&gt; Data3 -&gt; IO ()\n\nget :: String -&gt; IO ()\nget id = do\n  r1 &lt;- getData1 id\n  case r1 of\n    Left err -&gt; print err\n    Right d1 -&gt; do\n      r2 &lt;- getData2 $ d2Id d1\n      case r2 of\n        Left err -&gt; print err\n        Right d2 -&gt; do\n          r3 &lt;- getData3 $ d3Id d2\n          case r3 of\n            Left err -&gt; print err\n            Right d3 -&gt; do\n              process d1 d2 d3\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "edited": false, "score": 0, "creation_date": 1465829584, "post_id": 37792581, "comment_id": 63051869, "body": "So even if I add <code>Foobar (g :: Foo t)</code>, the information of <code>t</code> will already be lost in <code>Foo t</code>, right? Is there another way of forcing the use of <code>g :: Foo t</code> where I mean <code>t</code> without making <code>Foo</code> injective and without using a <code>Proxy</code>?"}, {"owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "edited": false, "score": 0, "creation_date": 1465829965, "post_id": 37792581, "comment_id": 63052156, "body": "This is a great answer, thanks. I&#39;ll go through GHC 8&#39;s new extensions and see what can be done. One minor comment, I don&#39;t think you mean injectivity in your last line (the point is for GHC to figure out that <code>t ~ t0</code> without injectivity)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1465830059, "last_edit_date": 1465830059, "creation_date": 1465828663, "answer_id": 37792581, "question_id": 37792282, "link": "https://stackoverflow.com/questions/37792282/ambiguous-type-with-type-families/37792581#37792581", "title": "Ambiguous type with type families", "body": "<blockquote>\n  <p>I understand that <code>Foo</code> is not injective, but from my analysis GHC is never asked to come up with <code>t</code> from <code>Foo t</code>.</p>\n</blockquote>\n\n<p>So, you realize the ambiguity. Let's make is explicit:</p>\n\n<pre><code>type instance Foo ()   = Bool\ntype instance Foo Char = Bool\n\ninstance Bar () where\n   -- I omit the declaration for f\n   g = True\ninstance Bar Char where\n   g = False\n\nmain = print (g :: Bool)\n</code></pre>\n\n<p>Your problem in <code>f = Foobar g</code> is related to the ambiguity.</p>\n\n<p>The crux is: the definition <code>f = Foobar g</code> does not imply that <code>g</code> much be picked in the same instance as <code>f</code>. It could refer to a different instance!</p>\n\n<p>Consider</p>\n\n<pre><code>show (x,y) = \"(\" ++ show x ++ \", \" ++ show y ++ \")\"\n</code></pre>\n\n<p>Above, the RHS uses of <code>show</code> are from a different instance from the one where the LHS <code>show</code> is.</p>\n\n<p>In your <code>f = Foobar g</code> line, GHC infers that <code>g :: Foo t</code> where <code>t</code> is the same index of the <code>f</code> instance. However, that is not enough to select an instance for <code>g</code>! Indeed, we might have <code>Foo t ~ Foo t0</code> for some other <code>t0</code>, hence <code>g</code> might refer to the <code>g</code> in the <code>t0</code> instance, causing an ambiguity error.</p>\n\n<p>Note that your code is <em>rejected</em> by GHC 8 even if the last line is commented out, because the type of <code>g</code> is inherently ambiguous:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Foo t\u2019 with actual type \u2018Foo t0\u2019\n  NB: \u2018Foo\u2019 is a type function, and may not be injective\n  The type variable \u2018t0\u2019 is ambiguous\n\u2022 In the ambiguity check for \u2018g\u2019\n  To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n  When checking the class method: g :: forall t. Bar t =&gt; Foo t\n  In the class declaration for \u2018Bar\u2019\n</code></pre>\n\n<p>We can follow the suggestion to make GHC 8 more lenient, like GHC 7. This will make your code type check, until we uncomment the last line.</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Foo t\u2019 with actual type \u2018Foo t0\u2019\n      NB: \u2018Foo\u2019 is a type function, and may not be injective\n      The type variable \u2018t0\u2019 is ambiguous\n</code></pre>\n\n<p>This is the same error you saw in GHC 7. \nIn GHC 8, we have another luxury: we can <em>explicitly</em> choose the <code>t</code> for <code>g</code> as follows:</p>\n\n<pre><code>class Bar t where\n  f :: Foobar t\n  f = Foobar (g @ t)\n  g :: Foo t\n</code></pre>\n\n<p>This requires a few more extensions to be turned on, of course. In GHC 7, you need a proxy to be able to select an instance unambiguously.</p>\n"}], "owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 1, "accepted_answer_id": 37792581, "answer_count": 1, "score": 5, "last_activity_date": 1465830059, "creation_date": 1465827919, "last_edit_date": 1495540722, "question_id": 37792282, "link": "https://stackoverflow.com/questions/37792282/ambiguous-type-with-type-families", "title": "Ambiguous type with type families", "body": "<p>I am running into a problem where GHC is not able to match <code>Foo t</code> and <code>Foo t0</code>, where it definitely looks to me like <code>t ~ t0</code>. Here's a minimal example:</p>\n\n<pre><code>{-# LANGUAGE GADTs          #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies   #-}\n\ndata Foobar :: * -&gt; * where\n  Foobar :: Foo t -&gt; Foobar t\n\ntype family Foo a :: *\n\nclass Bar t where\n  f :: Foobar t\n  g :: Foo t\n--  f = Foobar g\n</code></pre>\n\n<p>When uncommenting the last line, GHC complains:</p>\n\n<pre><code>Couldn't match expected type \u2018Foo t\u2019 with actual type \u2018Foo t0\u2019\nNB: \u2018Foo\u2019 is a type function, and may not be injective\nThe type variable \u2018t0\u2019 is ambiguous\nRelevant bindings include f :: Foobar t (bound at test.hs:13:3)\nIn the first argument of \u2018Foobar\u2019, namely \u2018g\u2019\nIn the expression: Foobar g\n</code></pre>\n\n<p>I understand that <code>Foo</code> is not injective, but from my analysis GHC is never asked to come up with <code>t</code> from <code>Foo t</code>. It seems that the type <code>t</code> is lost in <code>Foobar g</code>, and so it can't match the inital <code>Foo t</code> and the new <code>Foo t0</code>. Is the context here not enough? Am I missing a case where <code>f = Foobar g</code> could not yield the correct result?</p>\n\n<p>Any help appreciated!</p>\n\n<p>N.B.: <code>ScopedTypeVariables</code> and explicit type signatures don't seem to help. Adding the constraint <code>a ~ Foo t</code> and using <code>a</code> instead as the type of <code>g</code> in <code>Foobar g</code> doesn't work either.</p>\n\n<p>Looks a lot like: <a href=\"https://stackoverflow.com/questions/19838679/ambiguous-type-error-when-using-type-families-and-stv-is-not-helping?rq=1\">ambiguous type error when using type families, and STV is not helping</a>. I considered using a <code>Proxy</code>, but I feel like in this case GHC should be able to figure it out.</p>\n"}, {"tags": ["string", "haskell", "dictionary", "replace"], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465831177, "post_id": 37789489, "comment_id": 63053005, "body": "@chi Thanks. Fixed now."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 4, "last_activity_date": 1465831029, "last_edit_date": 1465831029, "creation_date": 1465819722, "answer_id": 37789489, "question_id": 37789364, "link": "https://stackoverflow.com/questions/37789364/string-replace-using-map-compilation-error/37789489#37789489", "title": "String replace using map compilation error", "body": "<p>You defined the type synonym <code>StringMap</code> to take an (unused) type parameter <code>stringMap</code>. Type <em>synonyms</em>, as opposed to <code>newtype</code>, <code>data</code>, and GADT declarations, must always be <em>fully applied</em>. Thus every occurrence of <code>StringMap</code> must be have a parameter supplied, like <code>forall a . StringMap a</code>, <code>StringMap Int</code>, etc. In the signature of <code>stringMapReplace</code>, you do not give <code>StringMap</code> a parameter, hence the error.</p>\n\n<p>Two options:</p>\n\n<ol>\n<li>Change <code>StringMap</code> to <code>type StringMap = [(String, String)]</code>, because it doesn't need a parameter.</li>\n<li><p>Give <code>StringMap</code> a parameter in the signature of <code>stringMapReplace</code>. What parameter, you ask? Any one, because it is ignored. For example, the following should work:</p>\n\n<pre><code>stringMapReplace :: StringMap String -&gt; String -&gt; String\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 308, "user_id": 5004298, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/MgM2A.png?s=128&g=1", "display_name": "Michael Brandon Morris", "link": "https://stackoverflow.com/users/5004298/michael-brandon-morris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 37789489, "answer_count": 1, "score": 0, "last_activity_date": 1465831029, "creation_date": 1465819357, "last_edit_date": 1495541292, "question_id": 37789364, "link": "https://stackoverflow.com/questions/37789364/string-replace-using-map-compilation-error", "title": "String replace using map compilation error", "body": "<p>I am new to Haskell, and trying to implement the code from <a href=\"https://stackoverflow.com/a/7862277/5004298\">here</a> to replace strings using a map. I am getting an error message during compilation that says</p>\n\n<pre><code>* Expecting one more argument to `StringMap'\n  Expected a type, but `StringMap' has kind `* -&gt; *'\n* In the type signature:\n    stringMapReplace :: (Show stringMap) =&gt; StringMap -&gt; String -&gt; String\n</code></pre>\n\n<p>I have tried searching, but the only answer I can find for the error is that I'm not clarifying what type <code>StringMap</code> is. However, I thought that is what <code>Show stringMap</code> was doing.</p>\n\n<pre><code>import Data.Map\nimport Data.Strings\n\ntype StringMap stringMap = [(String, String)]\nmyStringMap =\n    [\n        (\"org1\", \"rep1\"),\n        (\"org2\", \"rep2\")\n    ]\n\nstringMapReplace :: (Show stringMap) =&gt; StringMap -&gt; String -&gt; String\nstringMapReplace [] s = s\nstringMapReplace (m:ms) s = strReplace ms (replace (fst m) (snd m) s)\n\nmain :: IO ()\nmain = do\n    putStrLn \"Enter some text:\"\n    putStrLn =&lt;&lt; stringMapReplace myStringMap &lt;$&gt; toUpper getLine\n</code></pre>\n\n<p>Note: <code>strReplace</code> comes from <code>Data.Strings</code></p>\n\n<p>I don't know if there is anything else wrong with the code, as the compiler is only giving the error above right now. If you notice anything else right off, please feel free to mention (or leave it for me to debug later as practice).</p>\n"}, {"tags": ["haskell", "scope"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465803640, "post_id": 37784094, "comment_id": 63035111, "body": "That&#39;s not the error I get. Can you give the actual program you&#39;re testing and exactly what compiler error you get?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465803857, "post_id": 37784094, "comment_id": 63035230, "body": "Sorry about that. I&#39;ve edited the example so the error triggers. Also it seems when I write it out as <code>ars |&gt; solve l |&gt; print</code> in one line, the example works."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465803995, "post_id": 37784094, "comment_id": 63035302, "body": "You&#39;re still missing imports, for example."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465804135, "post_id": 37784094, "comment_id": 63035357, "body": "Added the full example."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465808181, "post_id": 37784094, "comment_id": 63037469, "body": "I don&#39;t understand why you are doing <code>let (n :: Type) = expr in n</code> where you could simply do (AFAICT) <code>expr :: Type</code>, in fact you could just provide the type signature for the function and be done: <code>solve :: Int -&gt; VB.Vector ByteString -&gt; V.Vector (Int, Int); solve l ars = V.fromList [(x,y) | ...]</code>"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465810751, "post_id": 37784094, "comment_id": 63039026, "body": "@Bakuriu It does not mean much in the example above, but the top level type annotations like the one you&#39;ve written above are really, really horrible. They get in the way massively when refactoring code. Also being able to do local type annotation in functions means that they are possible to do in lambda functions as well. That simple feature might have just tripled my productivity in one swoop because now I do not have to get all the types right at once and can incrementally interact with the compiler. I should have made figuring out how to do this a priority a month ago."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465810962, "post_id": 37784094, "comment_id": 63039159, "body": "@Bakuriu Also for long chains of expressions, reading top to bottom and chaining the functions using <code>|&gt;</code> as with F# is far superior to function composition in the opposite direction using the <code>.</code> operator. <code>.</code> should only be used for one liners. I&#39;ll make it a resolution not to use the <code>.</code> operator again. I blame the linter of pushing me in the wrong direction in terms of style."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1465811094, "post_id": 37784094, "comment_id": 63039246, "body": "@MarkoGrdinic Note that you can add typed holes in type signatures: <code>solve :: _ -&gt; _ -&gt; V.Vector (Int, Int)</code> the compiler will then perform type inference and tell you the type associated with those holes. This means that using type signatures you can still add types incrementally.  Moreover <i>not</i> putting type signatures will sometimes break your code (e.g. the type inferred is actually too generic and you get ambiguity errors, or due to monomorphism restriction is less polymorphic than you thought)."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465813169, "post_id": 37784094, "comment_id": 63040543, "body": "@Bakuriu Actually, I hadn&#39;t known about typed holes. I&#39;d still prefer the locally scoped variables solution as it does not require me to have the name of the function on two places. And you can&#39;t use the top-level form in lambda functions. You&#39;d have to pull them out and use a named function instead."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1465813791, "post_id": 37784094, "comment_id": 63040939, "body": "@MarkoGrdinic Lambas usually do not require a type signature, since they ought to be very simple.  By the way: note that you cannot express all possibly types in the way you are doing. For example if you had a function with type <code>Ord a =&gt; a -&gt; [a] -&gt; Bool</code> you wouldn&#39;t be able to write <code>f (x :: Ord a =&gt; a) (xs :: Ord a =&gt; [a])</code>.  So what you are using only works for monomorphic types. Explicit types are especially useful when dealing with complex <i>polymorphic</i> types, as those are the ones that can give troubles to the type inferencer, rendering your technique quite useless in most cases."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465814245, "post_id": 37784094, "comment_id": 63041195, "body": "@Bakuriu I see, that is good to know. I do not think I have ever needed to deal with complex polymorphic types. Currently, I am just trying to deal with HackerRank problems, rather than write libraries in Haskell. My issue with it are more of the debugging kind. Actually, if it was not for the linter, I would not have guessed what <code>ScopedTypeVariables</code> even do just by looking at the documentation."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465804414, "post_id": 37784309, "comment_id": 63035513, "body": "Er, sorry, but please see the edit. <code>ars |&gt; solve l |&gt; print</code> should be in 3 lines, I accidentally pasted the correct thing. Now I see that that I have a simple indentation problem. Yeah, this is it."}], "tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": true, "score": 1, "last_activity_date": 1465804131, "creation_date": 1465804131, "answer_id": 37784309, "question_id": 37784094, "link": "https://stackoverflow.com/questions/37784094/in-haskell-why-does-the-operator-give-out-of-scope-error-in-this-example/37784309#37784309", "title": "In Haskell why does the |&gt; operator give out of scope error in this example?", "body": "<p>Your indentation is wrong. Either of the following work.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.ByteString as B\nimport qualified Data.Vector.Unboxed as V\nimport qualified Data.Vector as VB\nimport Data.List as L\nimport Data.ByteString.Char8 as C\n\n(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\nx |&gt; f = f x\n\nmain :: IO ()\nmain =\n  let\n    parse (s :: ByteString) = s |&gt; L.unfoldr (C.readInt . C.dropWhile (== ' '))\n    solve (l :: Int) (ars :: VB.Vector ByteString) =\n      let\n        (n :: V.Vector (Int, Int)) = V.fromList [(x,y) | x &lt;- [0..l-1], y &lt;- [x+1..l-1]]\n      in\n        n\n  in do\n    [n,l :: Int] &lt;- parse &lt;$&gt; B.getLine\n    (ars :: VB.Vector ByteString) &lt;- VB.replicateM n B.getLine\n    ars |&gt; solve l |&gt; print\n</code></pre>\n\n<p>-</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.ByteString as B\nimport qualified Data.Vector.Unboxed as V\nimport qualified Data.Vector as VB\nimport Data.List as L\nimport Data.ByteString.Char8 as C\n\n(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\nx |&gt; f = f x\n\nmain :: IO ()\nmain =\n  let\n    parse (s :: ByteString) = s |&gt; L.unfoldr (C.readInt . C.dropWhile (== ' '))\n    solve (l :: Int) (ars :: VB.Vector ByteString) =\n      let\n        (n :: V.Vector (Int, Int)) = V.fromList [(x,y) | x &lt;- [0..l-1], y &lt;- [x+1..l-1]]\n      in\n        n\n  in do\n    [n,l :: Int] &lt;- parse &lt;$&gt; B.getLine\n    (ars :: VB.Vector ByteString) &lt;- VB.replicateM n B.getLine\n    ars |&gt;\n      solve l |&gt;\n      print\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 37784309, "answer_count": 1, "score": 0, "last_activity_date": 1465804168, "creation_date": 1465803325, "last_edit_date": 1465804168, "question_id": 37784094, "link": "https://stackoverflow.com/questions/37784094/in-haskell-why-does-the-operator-give-out-of-scope-error-in-this-example", "title": "In Haskell why does the |&gt; operator give out of scope error in this example?", "body": "<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Main where\n  import Control.Applicative ((&lt;$&gt;))\n  import Data.ByteString (ByteString)\n  import qualified Data.ByteString as B\n  import qualified Data.ByteString.Char8 as C\n  import qualified Data.Vector.Unboxed as V\n  import qualified Data.Vector as VB\n  import qualified Data.List as L\n\n  (|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\n  x |&gt; f = f x\n\n  main :: IO ()\n  main =\n    let\n        parse (s :: ByteString) = s |&gt; L.unfoldr (C.readInt . C.dropWhile (== ' '))\n        solve (l :: Int) (ars :: VB.Vector ByteString) =\n          let\n              (n :: V.Vector (Int, Int)) = V.fromList [(x,y) | x &lt;- [0..l-1], y &lt;- [x+1..l-1]]\n          in\n              n\n    in do\n        [n,l :: Int] &lt;- parse &lt;$&gt; B.getLine\n        (ars :: VB.Vector ByteString) &lt;- VB.replicateM n B.getLine\n        ars \n        |&gt; solve l \n        |&gt; print\n</code></pre>\n\n<p>The compiler complains that <code>l</code> is not in scope for some reason here. Why is that?</p>\n\n<pre><code>Not in scope: `l'\n</code></pre>\n\n<p>Also the reason the code looks like that is because I've just figured out what the <code>ScopedTypeVariables</code> extension does. It should be in the language proper, and in the beginner tutorials. It would have saved me a lot of pain over the past few weeks.</p>\n"}, {"tags": ["haskell", "parallel-processing", "repa"], "comments": [{"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "edited": false, "score": 0, "creation_date": 1465812227, "post_id": 37782489, "comment_id": 63040007, "body": "Looking inside the source code, I see that <code>mmultP</code> calls <code>computeP</code>, which calls <code>unsafePerformIO</code>. I&#39;m not very experienced with this, but might there be an incompatibility between <code>unsafePerformIO</code> and the <code>Identity</code> monad (maybe <code>Identity</code>&#39;s behaviour with laziness) ?"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "edited": false, "score": 0, "creation_date": 1465889258, "post_id": 37782489, "comment_id": 63075719, "body": "@madjar I have no idea. I don&#39;t see how."}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1466230307, "post_id": 37854433, "comment_id": 63241692, "body": "Thank you. My confusion with this rooted in the <code>Identity</code> monad not having sequencing forced. Why? Isn&#39;t it a monad that uses <code>&gt;&gt;=</code> to sequence?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1466236309, "post_id": 37854433, "comment_id": 63243022, "body": "Monads describe computations, but in general not how they&#39;re evaluated. For some monads the order is enforced (<code>IO</code>, <code>ST</code>, <code>Eval</code>, ...), but for some monads not (<code>Reader</code>, <code>Identity</code>, ...). Haskell&#39;s lazy evaluation still applies, so if the order isn&#39;t forced, computations are still evaluated lazily. In particular, <code>Identity</code> is a monad that doesn&#39;t do anything at all, it only give monadic interface for pure computations."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1466067449, "creation_date": 1466067449, "answer_id": 37854433, "question_id": 37782489, "link": "https://stackoverflow.com/questions/37782489/whats-wrong-with-using-identity-monad-with-mmultp-when-using-repa/37854433#37854433", "title": "What&#39;s wrong with using Identity monad with mmultP when using repa?", "body": "<p>The reason for having the <code>Monad</code> constraint in <code>computeP</code> and similar parallel operations is to force sequential computation where required. This is described in [Parallel and Concurrent Programming in Haskell], in subsection <em>Monads and computeP</em>.</p>\n\n<p>In your case, the problem seems to be caused by the internal implementation of <a href=\"https://hackage.haskell.org/package/repa-algorithms-3.4.0.2/docs/src/Data-Array-Repa-Algorithms-Matrix.html#mmultP\" rel=\"nofollow\"><code>mmultP</code></a>:</p>\n\n<pre><code>mmultP  :: Monad m\n        =&gt; Array U DIM2 Double \n        -&gt; Array U DIM2 Double \n        -&gt; m (Array U DIM2 Double)\n\nmmultP arr brr \n = [arr, brr] `deepSeqArrays` \n   do   trr      &lt;- transpose2P brr\n        let (Z :. h1  :. _)  = extent arr\n        let (Z :. _   :. w2) = extent brr\n        computeP \n         $ fromFunction (Z :. h1 :. w2)\n         $ \\ix   -&gt; R.sumAllS \n                  $ R.zipWith (*)\n                        (unsafeSlice arr (Any :. (row ix) :. All))\n                        (unsafeSlice trr (Any :. (col ix) :. All))\n</code></pre>\n\n<p>It calls first <code>transpose2P</code> and then <code>computeP</code>, and <code>transpose2P</code> internally calls <code>computeUnboxedP</code>. If you use the <code>Identity</code> monad, there is no sequencing forced, so both these parallel computations can run in parallel, hence the nested parallelism.</p>\n\n<p>If you want to keep things pure and also don't want to use <code>ST</code>, you can replace <code>Identity</code> with <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html#t:Eval\" rel=\"nofollow\"><code>Eval</code></a>, which is a strict version of <code>Identity</code>:</p>\n\n<pre><code>import Control.Parallel.Strategies\n...\ngo = runEval $ do ...\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1466067449, "creation_date": 1465796432, "last_edit_date": 1465798483, "question_id": 37782489, "link": "https://stackoverflow.com/questions/37782489/whats-wrong-with-using-identity-monad-with-mmultp-when-using-repa", "title": "What&#39;s wrong with using Identity monad with mmultP when using repa?", "body": "<p>I do not understand why this program using <a href=\"https://hackage.haskell.org/package/repa\">repa</a>:</p>\n\n<pre><code>import Data.Array.Repa\nimport Data.Array.Repa.Algorithms.Matrix\nimport Data.Functor.Identity\n\ngo = runIdentity $ do\n  let mat = fromListUnboxed (ix2 2 2) [1..4]\n  let ins = fromListUnboxed (ix2 2 1) [1, 1]\n  mmultP mat ins\n</code></pre>\n\n<p>is giving me the following warning:</p>\n\n<pre><code>Data.Array.Repa: Performing nested parallel computation sequentially.\n  You've probably called the 'compute' or 'copy' function while another\n  instance was already running. This can happen if the second version\n  was suspended due to lazy evaluation. Use 'deepSeqArray' to ensure\n  that each array is fully evaluated before you 'compute' the next one.\n</code></pre>\n\n<p>I have no nested computations, I didn't call <code>compute</code> or <code>copy</code>, and everything that I used to do the computation is inside the same monad. Is it something to do with lazy evaluation? If so, how do I make the parallel computation happen while using the Identity monad (to keep the overall computation pure) ?</p>\n\n<p>For reference, replacing <code>runIdentity</code> with <code>runST</code> makes it work, although in either case the specific monad's functionality isn't being used at all.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465794352, "post_id": 37782046, "comment_id": 63031443, "body": "You could write <code>_ -&gt; error &quot;should never happen&quot;</code>, but that&#39;s the default behaviour anyway. What&#39;s the point?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1465794476, "post_id": 37782046, "comment_id": 63031477, "body": "your last pattern <code>xs -&gt; &quot;...&quot;</code> <b>is</b> already a catch all - so is the question <i>why</i> you are not forced to use <code>_</code> or is it why the warning you get when you don&#39;t match all is not an error?"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 2, "creation_date": 1465794914, "post_id": 37782046, "comment_id": 63031627, "body": "A better question to ask may be: <i>why can pattern matches in Haskell be non-exhaustive?</i> Because if one covers all cases explicitly, a catch-all would be superflous or even harmful."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465801462, "post_id": 37782046, "comment_id": 63034090, "body": "If you want 100% safety use something like Coq. It will give you a compile error for cases like this since everything in Coq must be defined and all computations must halt. This comes at the price of making the language <i>non</i>-Turing complete and adding quite a lot of burden to the writer of a program to provide proofs for termination etc."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1465817624, "post_id": 37782046, "comment_id": 63043274, "body": "@n.m. It&#39;s a matter of taste, I guess. Personally, I would like having non-exhaustiveness being a compile-time error by default, unless explicitly deferred to runtime with a catch-all branch. If I had a <code>-Werror-on-incomplete-patterns</code> I would turn it on (<code>-Werror</code> is overkill for me)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465817921, "post_id": 37782046, "comment_id": 63043500, "body": "@chi <code>-Werror is overkill for me</code> that&#39;s unfortunate :("}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465794439, "post_id": 37782161, "comment_id": 63031467, "body": "yeah - but that&#39;s a comment and does not really answer the question"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1465808154, "post_id": 37782161, "comment_id": 63037451, "body": "I disagree - this answer provides one possible explanation for why the catch-all case is not mandatory, by explaining one way in which the language would be harder to use correctly if it were mandatory. Sounds like an answer to me."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465816864, "post_id": 37782161, "comment_id": 63042759, "body": "This answers what the OP asked, but I wonder whether it answers what the OP intended to ask. I am unsure whether the actual question here is &quot;why are non-exhaustive patterns allowed?&quot;."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465827739, "post_id": 37782161, "comment_id": 63050604, "body": "Yeah @chi, I wrote a comment about that, too. The posed question is quite misleading."}], "tags": [], "owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "is_accepted": false, "score": 4, "last_activity_date": 1465795738, "last_edit_date": 1465795738, "creation_date": 1465794406, "answer_id": 37782161, "question_id": 37782046, "link": "https://stackoverflow.com/questions/37782046/why-is-the-default-catch-all-not-mandatory-in-a-haskell-case-statement/37782161#37782161", "title": "Why is the default catch-all not mandatory in a Haskell case statement?", "body": "<p>A catch-all is not always needed. If one handles all cases explicitly (the pattern matching is <em>exhaustive</em>), a catch-all case would never be reached.</p>\n\n<p>I can think of a serious drawback of a mandatory catch-all case: if one extends an ADT (algebraic data type), dependant code would still compile and the programmer is not reminded of that extra case they are supposed to handle.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465838714, "post_id": 37782453, "comment_id": 63057488, "body": "Another possible answer: GADTs make (sound and complete) exhaustiveness checking undecidable."}, {"owner": {"reputation": 1650, "user_id": 1292223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98458fe74447603906e51a6f74039c4a?s=128&d=identicon&r=PG", "display_name": "kini", "link": "https://stackoverflow.com/users/1292223/kini"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465848709, "post_id": 37782453, "comment_id": 63062700, "body": "Also true! Though I think GADTs didn&#39;t exist when the decision was made not to do exhaustiveness checking on case statements in Haskell."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 2, "creation_date": 1466084972, "post_id": 37782453, "comment_id": 63179556, "body": "Don&#39;t forget that <code>-Werror</code> can effectively turn that warning into an error, just as the OP asked."}], "tags": [], "owner": {"reputation": 1650, "user_id": 1292223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98458fe74447603906e51a6f74039c4a?s=128&d=identicon&r=PG", "display_name": "kini", "link": "https://stackoverflow.com/users/1292223/kini"}, "is_accepted": true, "score": 8, "last_activity_date": 1465796201, "creation_date": 1465796201, "answer_id": 37782453, "question_id": 37782046, "link": "https://stackoverflow.com/questions/37782046/why-is-the-default-catch-all-not-mandatory-in-a-haskell-case-statement/37782453#37782453", "title": "Why is the default catch-all not mandatory in a Haskell case statement?", "body": "<p>Haskell is certainly <em>safer</em> than many other languages, especially mainstream ones, but it is far from 100% safe. Other unsafe features in Haskell include the ability to write infinite loops, like <code>let x = x in x</code>, or <code>unsafePerformIO</code>, or  <code>error</code>, or <code>undefined</code>.  I guess you could say it's just a tradeoff between convenience and safety.</p>\n\n<p>In more complex code than your simple example, sometimes there's some cases that you know can't occur, and so you leave them out of your <code>case</code> expression, but Haskell's type system isn't strong enough for the compiler to be able know that those missing cases are impossible.  (For example you might be computing some mathematical function that can only return the numbers <code>3</code>, <code>4</code>, or <code>5</code>, but that fact is due to some difficult theorem that you happen to know about and which the compiler is not aware of.)</p>\n\n<p>For what it's worth, you can pass <code>-fwarn-incomplete-patterns</code> to the <code>ghc</code> compiler to get a warning whenever at compile time you're missing a branch in a case statement, if you like.  That's included in the <code>-W</code> option which turns on several commonly desirable compiler warnings.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 699, "favorite_count": 1, "accepted_answer_id": 37782453, "answer_count": 2, "score": 3, "last_activity_date": 1465796201, "creation_date": 1465793708, "question_id": 37782046, "link": "https://stackoverflow.com/questions/37782046/why-is-the-default-catch-all-not-mandatory-in-a-haskell-case-statement", "title": "Why is the default catch-all not mandatory in a Haskell case statement?", "body": "<p>Haskell has a reputation for being a <em>safe</em> language. One that generally speaking pushes more of the possible programming errors to compile-time errors, and less and run-time. </p>\n\n<p>One example of this is the <code>if</code> expression. The <code>else</code> in the if is always mandatory. You need to cover off both possibilities. This is great because you have thought and covered off all possibilities of what will happen at runtime. </p>\n\n<p>Now Haskell has a <code>case</code> expression. (This bears some similarity to <code>switch</code> statements in other OO and imperative languages - but Haskell adds a lot of richness in the type system). </p>\n\n<pre><code>describeList :: [a]\ndescribeList xs = \"The list is \" ++ case cs of [] -&gt; \"empty.\"\n                                               [x] -&gt; \"a singleton list.\"\n                                               xs -&gt; \"a longer list.\"\n</code></pre>\n\n<p>But with the <code>case</code> expression, the default 'catch-all' is not mandatory. </p>\n\n<p>To me this sounds like it would lead to runtime errors. </p>\n\n<p>My question is: <strong>Why is the default catch-all not mandatory in a Haskell <code>case</code> statement?</strong></p>\n"}, {"tags": ["haskell", "cartesian-product"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1465791263, "post_id": 37781252, "comment_id": 63030709, "body": "it looks like you have defined <code>cart&#39;</code> in terms of <code>cart</code> - is that right?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1465791415, "post_id": 37781252, "comment_id": 63030744, "body": "btw: <code>cart&#39;</code> is faster because you don&#39;t have to recreate <code>cart&#39; xss</code> for each <code>x</code> n <code>xs</code>"}, {"owner": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465791908, "post_id": 37781252, "comment_id": 63030861, "body": "@ErikR Oh, that&#39;s a typo! I&#39;ve edited the post to reflect the subsequent change in performance."}, {"owner": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465792023, "post_id": 37781252, "comment_id": 63030889, "body": "@Carsten Thanks, that explains some of the memory and speed differences (at least so I think). But it&#39;s still inferior to the fourth method."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465793769, "post_id": 37781252, "comment_id": 63031275, "body": "how did you compile and run/measure it? Because if I use the <code>cart&#39;</code> version (<code>-O2</code>) it will take ~2sec (which is not fast) but it will only spend  0.9% in GC and only for 2 MB total usage (yes allocated is quite a bit more ~13GB! - and this is not good)"}, {"owner": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465794599, "post_id": 37781252, "comment_id": 63031514, "body": "@Carsten All of these were compiled with the flags <code>-prof -rtsopts -O2</code>, and run with <code>+RTS -sstderr</code>. My <code>cart&#39;</code> also allocated about 21GB. Your results appear comparable to mine, no?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465794826, "post_id": 37781252, "comment_id": 63031587, "body": "yes - I misread the <code>1916MB total</code> part - sorry"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465802290, "post_id": 37783500, "comment_id": 63034489, "body": "but this still is orders-of-magnitude slower than the hand-written comprehension and allocates way more memory (if only temporary) - and if I understand OP correctly then the question is how to get a version with comparable performance"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465805191, "post_id": 37783500, "comment_id": 63035902, "body": "@carsten, On my machine comprehension is slower, I even mention that in my answer (not directly though). One cannot compare absolute benchmark results from different machines."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465805481, "post_id": 37783500, "comment_id": 63036052, "body": "well that&#39;s really interesting because on my system (Win10 right now with GHC 7.10.2 and compiled with -O2 - the direct comprehension (the last line with <code>length [[a,b,c,d,e,f,g,h,i] ...</code>) runs around 10 times faster and with little to no memory at all (bytes allocated is really small and total memory is 1MB)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465805633, "post_id": 37783500, "comment_id": 63036114, "body": "the actual numbers are ~48k bytes in the heap, 0.594s (yes it&#39;s not 10times sorry - but still 4times faster)"}, {"owner": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "edited": false, "score": 0, "creation_date": 1465855420, "post_id": 37783500, "comment_id": 63065512, "body": "This seems to clarify things. I did another benchmarking on all of them with each of <code>length</code>, <code>length . reverse</code>, and <code>sillyLength = sum&#39; . map product&#39;</code> (strict sum and product folding). In short, <code>cart</code> is bad because it reconstructs <code>cart xss</code> for each <code>x</code> in <code>xs</code>, as you and Carsten pointed out. I&#39;m not sure what&#39;s going on precisely with the performances of most <code>sequence</code> methods, but they&#39;re subpar. Hand unrolling was only ever faster in <code>length</code> (presumably because of fusion/<code>-O2</code> magic) and considerably slower on <code>reverse</code> and <code>sillyLength</code> than <code>cart&#39;</code>. Is this all correct?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "edited": false, "score": 0, "creation_date": 1465893070, "post_id": 37783500, "comment_id": 63078067, "body": "@Feryll <code>Traversable</code> for <code>[]</code> is defined in <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Traversable.html#line-184\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a>, the applicative syntax there is ~about the same as what you have in <code>cart</code> in list comprehension"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1465809305, "last_edit_date": 1465809305, "creation_date": 1465801028, "answer_id": 37783500, "question_id": 37781252, "link": "https://stackoverflow.com/questions/37781252/cartesian-list-product-in-haskell-memory-and-speed/37783500#37783500", "title": "Cartesian List Product in Haskell (Memory and Speed)", "body": "<p>With definition like:</p>\n\n<pre><code>xs :: [Int]\nxs = [0..7]\n\nprodCart :: [[a]] -&gt; [[a]]\nprodCart [] = [[]]\nprodCart (xs:xss) = concatMap (\\xs' -&gt; map (:xs') xs) (prodCart xss)\n\nmain :: IO ()\nmain = print $ length $\n    prodCart $ replicate 9 xs\n</code></pre>\n\n<p>my results are</p>\n\n<pre><code>134217728\n---\n  13,345,129,576 bytes allocated in the heap\n      13,825,832 bytes copied during GC\n          44,312 bytes maximum residency (4 sample(s))\n          21,224 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n./cart +RTS -s  1.69s user 0.06s system 98% cpu 1.773 total\n</code></pre>\n\n<p>Key insights is that as you only need length, the maximum residency should be small if <code>cart</code> is productive, i.e. it can generate elements of result list one by one. The definition you wrote open yourself (the last one) is such (same 44312 residency, 3.913 total time).</p>\n\n<p>In <code>cart</code> definition the <code>prodCart xss</code> sublist is large, and it's persisted in memory with definition you have. It's better to prevent sharing in this case.</p>\n\n<hr>\n\n<p>If we throw <code>reverse</code> into the place, which will prevent productive calculation of <code>length</code>: then the numbers will change: the order would be <code>prodCart</code>, <code>cart</code>, <em>hand unrolled</em>. Try yourself!</p>\n\n<pre><code>main :: IO ()\nmain = print $ length $ reverse $\n    prodCart $ replicate 8 xs\n</code></pre>\n\n<p>has </p>\n\n<pre><code>16777216\n---\n   2,070,840,336 bytes allocated in the heap\n   3,175,246,728 bytes copied during GC\n     716,199,432 bytes maximum residency (12 sample(s))\n      13,690,376 bytes maximum slop\n            1411 MB total memory in use (0 MB lost due to fragmentation)\n\n./cart +RTS -s  2.88s user 0.53s system 98% cpu 3.472 total\n</code></pre>\n\n<p>on my machine.</p>\n\n<hr>\n\n<p><em>EDIT</em> I put together a criterion script (which you should always do when microbenchmarking something)</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n-- stack --resolver=lts-6.0 install criterion\n-- stack --resolver=lts-6.0 ghc -- -Wall -O2 cart.hs\nimport Criterion.Main\n\n-- import Data.Traversable (sequenceA)\n\ncart :: [[a]] -&gt; [[a]]\ncart [] = [[]]\ncart (xs:xss) = [x:ys | x &lt;- xs, ys &lt;- cart xss]\n\ncart' :: [[a]] -&gt; [[a]]    -- Reverse binding\ncart' [] = [[]]\ncart' (xs:xss) = [x:ys | ys &lt;- cart' xss, x &lt;- xs]\n\nprodCart :: [[a]] -&gt; [[a]]\nprodCart [] = [[]]\nprodCart (xs:xss) = concatMap (\\xs' -&gt; map (:xs') xs) (prodCart xss)\n\nprodCartRepl :: forall a. [a] -&gt; Int -&gt; [[a]]\nprodCartRepl xs  = go\n  where\n    go :: Int -&gt; [[a]]\n    go 0 = [[]]\n    go n = concatMap (\\xs' -&gt; map (:xs') xs) (go (n - 1))\n\nhandrolled :: [a] -&gt; [[a]]\nhandrolled xs = [[a,b,c,d,e] | a &lt;- xs, b &lt;- xs, c &lt;- xs, d &lt;- xs, e &lt;- xs ]\n\ndigits :: [Int]\ndigits = [0..7]\n\nmain :: IO ()\nmain = defaultMain\n    [ bgroup \"length\"\n        [ bench \"cart\"         $ whnf (length . cart) (replicate 5 digits)\n        , bench \"cart'\"        $ whnf (length . cart') (replicate 5 digits)\n        , bench \"sequence\"     $ whnf (length . sequence) (replicate 5 digits)\n        , bench \"sequenceA\"    $ whnf (length . sequenceA) (replicate 5 digits)\n        , bench \"prodCart\"     $ whnf (length . prodCart) (replicate 5 digits)\n        -- Obviously different!\n        , bench \"prodCartRepl\" $ whnf (length . flip prodCartRepl 5) digits \n        , bench \"handrolled\"   $ whnf (length . handrolled) digits\n        ]\n      , bgroup \"all\"\n        [ bench \"cart\"         $ nf cart (replicate 5 digits)\n        , bench \"cart'\"        $ nf cart' (replicate 5 digits)\n        , bench \"sequence\"     $ nf sequence (replicate 5 digits)\n        , bench \"sequenceA\"    $ nf sequenceA (replicate 5 digits)\n        , bench \"prodCart\"     $ nf prodCart (replicate 5 digits)\n        -- Obviously different!\n        , bench \"prodCartRepl\" $ nf (flip prodCartRepl 5) digits\n        , bench \"handrolled\"   $ nf handrolled digits\n        ]\n    ]\n</code></pre>\n\n<p>Interestingely, when I had \"all\" section commented out, then the results for <em>handrolled</em> would be 4 times better than \"prodCart:</p>\n\n<pre><code>benchmarking length/handrolled\ntime                 141.8 \u03bcs   (140.5 \u03bcs .. 143.0 \u03bcs)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 141.1 \u03bcs   (140.1 \u03bcs .. 142.0 \u03bcs)\nstd dev              3.203 \u03bcs   (2.657 \u03bcs .. 4.091 \u03bcs)\nvariance introduced by outliers: 17% (moderately inflated)\n</code></pre>\n\n<p>Yet, if I add <code>module Main (main, handrolled, prodCart) where</code> header, then they go worse (2.8s); and again if I <code>{-# INLINE handrolled #-}</code> it goes better down to <code>140\u03bcs</code> again. Other definitions cannot be inlined as they are recursive, and without knowing the recursion depth the definition cannot be inlined enough times to \"unroll\" the loop. It seems that when <code>handrolled</code> is inlined and composed with <code>length</code> it just counts the items (length fuses with list production), so is blazingly fast. It doesn't happen with other versions.</p>\n\n<p>Checking the Core (<code>-ddump-simpl</code>) should reveal that, but I didn't check.</p>\n\n<p>The whole resutls are:</p>\n\n<pre><code>benchmarking length/cart\ntime                 885.1 \u03bcs   (844.2 \u03bcs .. 934.4 \u03bcs)\n                     0.978 R\u00b2   (0.962 R\u00b2 .. 0.991 R\u00b2)\nmean                 850.2 \u03bcs   (828.3 \u03bcs .. 881.0 \u03bcs)\nstd dev              89.79 \u03bcs   (65.94 \u03bcs .. 128.2 \u03bcs)\nvariance introduced by outliers: 76% (severely inflated)\n\nbenchmarking length/cart'\ntime                 429.1 \u03bcs   (417.7 \u03bcs .. 441.7 \u03bcs)\n                     0.995 R\u00b2   (0.992 R\u00b2 .. 0.998 R\u00b2)\nmean                 437.2 \u03bcs   (430.3 \u03bcs .. 447.3 \u03bcs)\nstd dev              26.67 \u03bcs   (21.33 \u03bcs .. 33.43 \u03bcs)\nvariance introduced by outliers: 55% (severely inflated)\n\nbenchmarking length/sequence\ntime                 1.006 ms   (970.5 \u03bcs .. 1.057 ms)\n                     0.971 R\u00b2   (0.948 R\u00b2 .. 0.988 R\u00b2)\nmean                 1.115 ms   (1.075 ms .. 1.186 ms)\nstd dev              166.2 \u03bcs   (120.7 \u03bcs .. 228.5 \u03bcs)\nvariance introduced by outliers: 86% (severely inflated)\n\nbenchmarking length/sequenceA\ntime                 1.008 ms   (977.5 \u03bcs .. 1.041 ms)\n                     0.990 R\u00b2   (0.982 R\u00b2 .. 0.995 R\u00b2)\nmean                 1.050 ms   (1.027 ms .. 1.080 ms)\nstd dev              90.05 \u03bcs   (70.35 \u03bcs .. 114.8 \u03bcs)\nvariance introduced by outliers: 66% (severely inflated)\n\nbenchmarking length/prodCart\ntime                 435.7 \u03bcs   (426.7 \u03bcs .. 445.2 \u03bcs)\n                     0.996 R\u00b2   (0.993 R\u00b2 .. 0.998 R\u00b2)\nmean                 435.6 \u03bcs   (429.1 \u03bcs .. 443.3 \u03bcs)\nstd dev              23.63 \u03bcs   (19.21 \u03bcs .. 29.16 \u03bcs)\nvariance introduced by outliers: 49% (moderately inflated)\n\nbenchmarking length/prodCartRepl\ntime                 454.7 \u03bcs   (424.3 \u03bcs .. 502.9 \u03bcs)\n                     0.968 R\u00b2   (0.947 R\u00b2 .. 0.994 R\u00b2)\nmean                 448.6 \u03bcs   (435.2 \u03bcs .. 466.2 \u03bcs)\nstd dev              51.97 \u03bcs   (37.25 \u03bcs .. 71.59 \u03bcs)\nvariance introduced by outliers: 82% (severely inflated)\n\nbenchmarking length/handrolled\ntime                 142.8 \u03bcs   (141.0 \u03bcs .. 145.8 \u03bcs)\n                     0.998 R\u00b2   (0.996 R\u00b2 .. 0.999 R\u00b2)\nmean                 143.8 \u03bcs   (142.6 \u03bcs .. 145.8 \u03bcs)\nstd dev              5.080 \u03bcs   (3.776 \u03bcs .. 7.583 \u03bcs)\nvariance introduced by outliers: 33% (moderately inflated)\n\nbenchmarking all/cart\ntime                 2.123 ms   (2.050 ms .. 2.212 ms)\n                     0.977 R\u00b2   (0.955 R\u00b2 .. 0.993 R\u00b2)\nmean                 2.035 ms   (1.981 ms .. 2.129 ms)\nstd dev              227.1 \u03bcs   (156.5 \u03bcs .. 335.3 \u03bcs)\nvariance introduced by outliers: 72% (severely inflated)\n\nbenchmarking all/cart'\ntime                 1.278 ms   (1.245 ms .. 1.318 ms)\n                     0.986 R\u00b2   (0.971 R\u00b2 .. 0.996 R\u00b2)\nmean                 1.339 ms   (1.301 ms .. 1.393 ms)\nstd dev              157.7 \u03bcs   (105.3 \u03bcs .. 218.0 \u03bcs)\nvariance introduced by outliers: 77% (severely inflated)\n\nbenchmarking all/sequence\ntime                 1.772 ms   (1.726 ms .. 1.833 ms)\n                     0.989 R\u00b2   (0.976 R\u00b2 .. 0.998 R\u00b2)\nmean                 1.799 ms   (1.765 ms .. 1.854 ms)\nstd dev              148.9 \u03bcs   (90.60 \u03bcs .. 234.2 \u03bcs)\nvariance introduced by outliers: 61% (severely inflated)\n\nbenchmarking all/sequenceA\ntime                 2.058 ms   (1.979 ms .. 2.143 ms)\n                     0.988 R\u00b2   (0.982 R\u00b2 .. 0.993 R\u00b2)\nmean                 1.903 ms   (1.859 ms .. 1.952 ms)\nstd dev              157.6 \u03bcs   (131.6 \u03bcs .. 189.2 \u03bcs)\nvariance introduced by outliers: 61% (severely inflated)\n\nbenchmarking all/prodCart\ntime                 1.367 ms   (1.303 ms .. 1.438 ms)\n                     0.988 R\u00b2   (0.980 R\u00b2 .. 0.996 R\u00b2)\nmean                 1.349 ms   (1.324 ms .. 1.396 ms)\nstd dev              118.0 \u03bcs   (74.92 \u03bcs .. 198.2 \u03bcs)\nvariance introduced by outliers: 65% (severely inflated)\n\nbenchmarking all/prodCartRepl\ntime                 1.331 ms   (1.294 ms .. 1.381 ms)\n                     0.992 R\u00b2   (0.988 R\u00b2 .. 0.997 R\u00b2)\nmean                 1.350 ms   (1.328 ms .. 1.379 ms)\nstd dev              84.37 \u03bcs   (63.50 \u03bcs .. 116.7 \u03bcs)\nvariance introduced by outliers: 49% (moderately inflated)\n\nbenchmarking all/handrolled\ntime                 3.552 ms   (3.455 ms .. 3.711 ms)\n                     0.986 R\u00b2   (0.972 R\u00b2 .. 0.996 R\u00b2)\nmean                 3.631 ms   (3.547 ms .. 3.724 ms)\nstd dev              281.9 \u03bcs   (226.9 \u03bcs .. 349.7 \u03bcs)\nvariance introduced by outliers: 51% (severely inflated)\n</code></pre>\n\n<p>As you see from <strong>all</strong> benchmarks, handrolled comprehension isn't actually that fast when you actually want the result, not only produce it.</p>\n"}], "owner": {"reputation": 303, "user_id": 2415103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/88VIe.png?s=128&g=1", "display_name": "Feryll", "link": "https://stackoverflow.com/users/2415103/feryll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 37783500, "answer_count": 1, "score": 5, "last_activity_date": 1582871251, "creation_date": 1465786898, "last_edit_date": 1582871251, "question_id": 37781252, "link": "https://stackoverflow.com/questions/37781252/cartesian-list-product-in-haskell-memory-and-speed", "title": "Cartesian List Product in Haskell (Memory and Speed)", "body": "<p>I'm trying to write a generic function <code>cart :: [[a]] -&gt; [[a]]</code> for Cartesian product in order to generate the set of 9-tuples of digits from 0 to 7 (lists of 9 elements instead of actual 9-tuples). I've written several syntactically similar functions, but their performances differ drastically.</p>\n\n<pre><code>cart :: [[a]] -&gt; [[a]]\ncart [] = [[]]\ncart (xs:xss) = [x:ys | x &lt;- xs, ys &lt;- cart xss]\n\ncart' :: [[a]] -&gt; [[a]]    -- Reverse binding\ncart' [] = [[]]\ncart' (xs:xss) = [x:ys | ys &lt;- cart' xss, x &lt;- xs]\n\nxs = [0..7]\n\nlength $ cart $ replicate 9 xs    -- This is slow (4.1s) and memory hungry (1916MB total); ~75% garbage collection time\nlength $ sequence $ replicate 9 xs    -- Treating list as a monad; this is even slower (12s) and worse on memory (4214MB); ~75% garbage collection time\nlength $ cart' $ replicate 9 xs    -- This is slightly faster (3.4s), and uses very little memory (2MB); ~1.5% garbage collection time\nlength [[a,b,c,d,e,f,g,h,i] | a &lt;- xs, b &lt;- xs, c &lt;- xs, d &lt;- xs, e &lt;- xs, f &lt;- xs, g &lt;- xs, h &lt;- xs, i &lt;- xs]    -- This is ultra-fast (0.5s) and uses virtually no memory (1MB); 0% garbage collection time\n</code></pre>\n\n<p>Is there a way to write a universal Cartesian product function that boasts around the same speed and memory efficiency as the fourth implementation? More importantly, why do these implementations differ so greatly?</p>\n\n<p><a href=\"https://stackoverflow.com/questions/10122880/lazy-cartesian-product-in-haskell\">Similar thread</a></p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465781201, "post_id": 37779705, "comment_id": 63028883, "body": "Did <code>stack build</code> ever work for you or is this a new problem?"}, {"owner": {"reputation": 67, "user_id": 3739187, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8695fc5fad44f5d075dea1762a1097ca?s=128&d=identicon&r=PG&f=1", "display_name": "codechao", "link": "https://stackoverflow.com/users/3739187/codechao"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465790590, "post_id": 37779705, "comment_id": 63030559, "body": "Sorry I should have specified, this is my first time using stack. So no, it has never worked for me."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465791293, "post_id": 37779705, "comment_id": 63030718, "body": "if you go in an empty folder (no stack.yaml nor xyz.cabal present) and run <code>stack ghci</code> - what does it tell you? (Probably it just takes some time to compile all the dependencies this might have - this can take quite some time - for example if you compile idris you might have time to grab and trink a cup of coffee / tea)"}, {"owner": {"reputation": 67, "user_id": 3739187, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8695fc5fad44f5d075dea1762a1097ca?s=128&d=identicon&r=PG&f=1", "display_name": "codechao", "link": "https://stackoverflow.com/users/3739187/codechao"}, "edited": false, "score": 0, "creation_date": 1465970392, "post_id": 37779705, "comment_id": 63117146, "body": "sorry for the slow response. It actually gets all the way to the prelude. Strange, I feel like that means something, but I&#39;m not sure what."}, {"owner": {"reputation": 67, "user_id": 3739187, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8695fc5fad44f5d075dea1762a1097ca?s=128&d=identicon&r=PG&f=1", "display_name": "codechao", "link": "https://stackoverflow.com/users/3739187/codechao"}, "edited": false, "score": 0, "creation_date": 1465970603, "post_id": 37779705, "comment_id": 63117242, "body": "It actually runs all the way to the prelude, i.e. all the way through. Strange, I&#39;m sure that means something but I&#39;m not sure what. This cabal is being used by at least 20 other people and no one has reported problems but me. Here&#39;s the output btw <code>Run from outside a project, using implicit global project config Error parsing targets: The specified targets matched no packages. Perhaps you need to run &#39;stack init&#39;? Warning: build failed, but optimistically launching GHCi anyway Configuring GHCi with the following packages: GHCi, version 7.10.3:  Prelude&gt;</code> Obviously cut down for size"}], "owner": {"reputation": 67, "user_id": 3739187, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8695fc5fad44f5d075dea1762a1097ca?s=128&d=identicon&r=PG&f=1", "display_name": "codechao", "link": "https://stackoverflow.com/users/3739187/codechao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 304, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483522457, "creation_date": 1465770658, "last_edit_date": 1483522457, "question_id": 37779705, "link": "https://stackoverflow.com/questions/37779705/stack-commands-other-than-init-not-ever-finishing", "title": "stack commands other than init not ever finishing", "body": "<p>I'm trying to run haskell code using <code>stack ghci</code>, but I am having this problem where <code>stack build</code>, <code>stack ghci</code>, <code>stack</code> anything except <code>init</code> (which runs fine), hangs pretty indefinitely. </p>\n\n<p>Oh and this is on windows 10, running a stack I just downloaded last week. Here's the verbose output of the command it seems to get stuck on when I run <code>stack ghci</code>:</p>\n\n<pre><code>2016-06-12 17:22:46.134672: [debug] Run process: \nC:\\...\\stack\\setup-exe-cache\\x86_64-windows\\setup-Simple-Cabal-1.22.5.0-ghc-7.10.3.exe \n   --builddir=.stack-work\\dist\\2672c1f3 \n   configure \n       --with-ghc=C:\\...\\stack\\x86_64-windows\\ghc-7.10.3\\bin\\ghc.exe \n       --with-ghc-pkg=C:\\...\\stack\\x86_64-windows\\ghc-7.10.3\\bin\\ghc-pkg.exe \n       --user \n       --package-db=clear \n       --package-db=global \n       --package-db=C:\\...\\stack\\snapshots\\ee4b7647\\pkgdb \n       --package-db=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\pkgdb \n       --libdir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\lib \n       --bindir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\bin \n       --datadir=C:\\...\\assignments\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\share \n       --libexecdir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\libexec \n       --sysconfdir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\etc \n       --docdir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\doc\\mp1-haskell-0.1.0.0 \n       --htmldir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\doc\\mp1-haskell-0.1.0.0 \n       --haddockdir=C:\\...\\mp1-haskell\\.stack-work\\install\\5c0a1b09\\doc\\mp1-haskell-0.1.0.0 \n       --dependency=base=base-4.8.2.0-14035a44a8b95c6832da6dae1420f59e \n       --extra-include-dirs=C:\\...\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include \n       --extra-lib-dirs=C:\\...\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib \n       --enable-tests \n       --enable-benchmarks @(stack_9kewhubnl5WIl89fhd1ea2:System.Process.Read src/System\\Process\\Read.hs:283:3)\n</code></pre>\n"}, {"tags": ["postgresql", "haskell", "uuid", "yesod", "yesod-forms"], "answers": [{"tags": [], "owner": {"reputation": 12964, "user_id": 704015, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/rpCnn.png?s=128&g=1", "display_name": "Jezen Thomas", "link": "https://stackoverflow.com/users/704015/jezen-thomas"}, "is_accepted": true, "score": 2, "last_activity_date": 1501148363, "last_edit_date": 1501148363, "creation_date": 1465800736, "answer_id": 37783421, "question_id": 37779364, "link": "https://stackoverflow.com/questions/37779364/how-do-i-use-a-uuid-in-yesod/37783421#37783421", "title": "How do I use a UUID in Yesod?", "body": "<p><strong>update</strong>: See Chris Allen's <a href=\"http://bitemyapp.com/posts/2016-06-15-uuids-with-persistent-yesod.html\" rel=\"nofollow noreferrer\">article</a> on this topic.</p>\n\n<p>Using a <code>Blog</code> model as an example:</p>\n\n<p>First we need to add our <code>uuid</code> field and a uniqueness constraint on that field so we know our UUIDs will be unique and lookups will be fast. The fields defined in our model will correspond with fields in our applicative form.</p>\n\n<pre><code>-- config/models\n\nBlog\n  title Text\n  content Text\n  user UserId\n  createdAt UTCTime\n  uuid Text default=uuid_generate_v4()\n  UniqueUuid uuid\n</code></pre>\n\n<p>Then in our applicative form, we import two modules that give us the UUID functions we need, and extract a value in either a monadic or applicative style.</p>\n\n<pre><code>-- Handler/Home.hs\n\nimport Data.UUID\nimport Data.UUID.V4\n\nform :: UserId -&gt; Form Blog\nform userId = renderDivs $ Blog\n  &lt;$&gt; areq textField \"Title\" Nothing\n  &lt;*&gt; areq textareaField \"Contents\" Nothing\n  &lt;*&gt; pure userId\n  &lt;*&gt; lift (liftIO getCurrentTime)\n  -- either use the following line (monadic style)\n  &lt;*&gt; lift (liftIO $ do { key &lt;- nextRandom; return $ toText key })\n  -- ...or use this style (applicative style)\n  &lt;*&gt; lift (fmap toText $ liftIO nextRandom)\n</code></pre>\n\n<p>I asked a helpful Haskeller in an IRC channel what the difference between the two approaches was, and this was their reply:</p>\n\n<blockquote>\n  <p>Somehow I personally like the monad version more\u2026 But it is syntactically too expensive, so in this case I would probably go with the <code>fmap</code> version\u2026 but if I would have to do more processing on the UUID, I would definitely go the monad version but IO is a Monad type class so it has to implement also Functor type class\u2026 You can think that using an <code>fmap</code> is more \"low level\"</p>\n</blockquote>\n\n<p>n.b. You may need to enable the <code>uuid-ossp</code> extension in your database. You can do that by running <code>CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";</code>.</p>\n"}], "owner": {"reputation": 12964, "user_id": 704015, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/rpCnn.png?s=128&g=1", "display_name": "Jezen Thomas", "link": "https://stackoverflow.com/users/704015/jezen-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 37783421, "answer_count": 1, "score": 1, "last_activity_date": 1501148363, "creation_date": 1465767808, "question_id": 37779364, "link": "https://stackoverflow.com/questions/37779364/how-do-i-use-a-uuid-in-yesod", "title": "How do I use a UUID in Yesod?", "body": "<p>I am using Yesod and Postgresql to build a simple web application.</p>\n\n<p>I would like one of my models to use UUID4s as its primary key, instead of an incremental integer.</p>\n\n<p>I have tried following <a href=\"http://michaelxavier.net/posts/2015-04-14-Adding-a-UUID-Column-to-a-Persistent-Table.html\" rel=\"nofollow\">this example</a> but I couldn't get it to work, and it uses lenses and prisms which in my mind might be too advanced for something that should be simple.</p>\n\n<p>So, how do I give a model a UUID for its ID?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1465765583, "post_id": 37778940, "comment_id": 63025862, "body": "Hint: if I map an operation over an empty list, how much less empty is the result?"}], "answers": [{"tags": [], "owner": {"reputation": 5190, "user_id": 353268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/68f14024956c4a67bd92f44a15505e7c?s=128&d=identicon&r=PG", "display_name": "mariosangiorgio", "link": "https://stackoverflow.com/users/353268/mariosangiorgio"}, "is_accepted": false, "score": 6, "last_activity_date": 1465767750, "last_edit_date": 1465767750, "creation_date": 1465766136, "answer_id": 37779151, "question_id": 37778940, "link": "https://stackoverflow.com/questions/37778940/all-possible-combinations-of-a-lists-elements/37779151#37779151", "title": "All possible combinations of a list&#39;s elements", "body": "<p>Let's start form the base case. The power set of the empty set is a set containing the empty set. So you need to replace <code>subseq [] = []</code> with <code>subseq [] = [[]]</code>. Right now you're saying that the powers of an empty set is empty, which is not the case.</p>\n\n<p>Your other case is missing something too. You need to change it to <code>subseq (x:xs) = (subseq xs) ++ map (x :) (subseq xs)</code>. In plain english, this means that you take the subsets that don't contain the first item (<code>subseq xs</code>) and the subsets that contain it (<code>map (x :) (subseq xs)</code>).</p>\n\n<p>If you omit the <code>(subseq xs)</code> part all you get is a list that contains only the original list because you only consider the sublist where you take every element.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1531758744, "creation_date": 1531758744, "answer_id": 51366368, "question_id": 37778940, "link": "https://stackoverflow.com/questions/37778940/all-possible-combinations-of-a-lists-elements/51366368#51366368", "title": "All possible combinations of a list&#39;s elements", "body": "<p>You may also achieve this task with <code>filterM :: Applicative m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]</code> function which resides in Control.Monad.\nIn this particular case our monad is list so we need a filtering function of type <code>(a -&gt; m Bool)</code> which returns a list of boolean values. This could be <code>\\x -&gt; [True, False]</code> and the monad instance of list will apply them for each element of the provided list undeterministically and will result a list of lists.</p>\n\n<pre><code>Prelude&gt; Control.Monad.filterM (\\n -&gt; [True, False]) [1,2,3]\n[[1,2,3],[1,2],[1,3],[1],[2,3],[2],[3],[]]\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1502, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1531758744, "creation_date": 1465764439, "last_edit_date": 1495542301, "question_id": 37778940, "link": "https://stackoverflow.com/questions/37778940/all-possible-combinations-of-a-lists-elements", "title": "All possible combinations of a list&#39;s elements", "body": "<p>I need to get all possible combinations of a list's elements. I tried the solution <a href=\"https://stackoverflow.com/questions/9658409/haskell-combinations-and-permutation/9663864?noredirect=1#comment63023943_9663864\">here</a> but it does not compile. Please help me figure this out:</p>\n\n<pre><code>subseq :: [a] -&gt; [[a]]\nsubseq [] = []\nsubseq (x:xs) = map (x :) $ subseq xs\n</code></pre>\n\n<p>Basically this is a rewrite of the <code>subsequences</code> function in <code>Data.List</code>. I dont understand the version in the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.OldList.html#subsequences\" rel=\"nofollow noreferrer\">source</a> though. My rationale behind the function above is this.</p>\n\n<p>Apply the cons operator across all elements. This should produce a non deterministic result. However, the result I'm getting is an empty list. Please help.</p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1465788532, "creation_date": 1465788532, "answer_id": 37781418, "question_id": 37778052, "link": "https://stackoverflow.com/questions/37778052/servant-client-with-type-variable-with-fromjson-contraint/37781418#37781418", "title": "Servant client with type variable with FromJSON contraint", "body": "<p>You'll need to tie the type of <code>api</code> to the type of the thing you're sending:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nsend_ :: forall a. (FromJSON a) =&gt; a -&gt; Manager -&gt; BaseUrl -&gt; ExceptT ServantError IO Result\nsend_ = client (api :: Proxy (MyAPI a))\n</code></pre>\n\n<p>or why even bother with <code>api</code> at that point:</p>\n\n<pre><code>send_ = client (Proxy :: Proxy (MyAPI a))\n</code></pre>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 37781418, "answer_count": 1, "score": 2, "last_activity_date": 1466079363, "creation_date": 1465758255, "last_edit_date": 1466079363, "question_id": 37778052, "link": "https://stackoverflow.com/questions/37778052/servant-client-with-type-variable-with-fromjson-contraint", "title": "Servant client with type variable with FromJSON contraint", "body": "<p>I'm trying to create client bindings to Web API using <a href=\"https://hackage.haskell.org/package/servant-0.7.1/docs/Servant-API.html\" rel=\"nofollow\">servant</a> library.\nI want to be able to send any JSON objects.</p>\n\n<pre><code>import           Control.Monad.Trans.Except (ExceptT, runExceptT)\nimport           Data.Proxy\nimport           Network.HTTP.Client (Manager)\nimport           Servant.API\nimport           Servant.Client\nimport           Data.Aeson\n\n-- | This methods accepts any instance of 'ToJSON'\n--   I would like to have only this method exported from the module\nsend :: ToJSON a =&gt; a -&gt; Manager -&gt; IO (Either ServantError Result)\nsend x manager = runExceptT $ send_ x manager baseUrl\n\ntype MyAPI a = \"acceptAnyJson\" \n    :&gt; ReqBody '[JSON] a\n    :&gt; Post '[JSON] Result\n\napi :: ToJSON a =&gt; Proxy (MyAPI a) \napi = Proxy \n\nsend_ :: ToJSON a =&gt; a -&gt; Manager -&gt; BaseUrl -&gt; ExceptT ServantError IO Result\nsend_ = client api\n</code></pre>\n\n<p>Right now when I try to compile it I have error message:</p>\n\n<pre><code>Couldn't match type \u2018a0\u2019 with \u2018a\u2019\n      because type variable \u2018a\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      the inferred type for \u2018send_\u2019:\n      ...\n</code></pre>\n\n<p>How can I parameterize my <code>MyAPI</code>, <code>client</code> and <code>Proxy</code> to accept type variable?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757257, "post_id": 37777844, "comment_id": 63023306, "body": "you can use <code>fromIntegral n</code> but if <code>[1..n]</code> should work you need <code>Enum a</code> so you could use <code>[1..toEnum n]</code> too (don&#39;t forget the <code>Enum a</code> in <code>(Num a, Enum a)</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757299, "post_id": 37777844, "comment_id": 63023317, "body": "as an alternative (you just need the sum) you can use <code>fromIntegral (sum list)</code> instead and don&#39;t need the <code>Enum</code> at all"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757389, "post_id": 37777844, "comment_id": 63023349, "body": "But can you explain why this doesn&#39;t compile? @Carsten"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1465757391, "post_id": 37777844, "comment_id": 63023350, "body": "also note that it will not work with <code>n = length list</code> ;)"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757412, "post_id": 37777844, "comment_id": 63023357, "body": "Why won&#39;t it work?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757429, "post_id": 37777844, "comment_id": 63023361, "body": "this does not compile because <code>(-)</code> needs two arguments of the same type - so <code>sum list</code> has to be <code>a</code> too - but then <code>n</code> needs to be <code>a</code> too"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757463, "post_id": 37777844, "comment_id": 63023375, "body": "it will not work because <code>length [1,2,4] == 3</code> but then you do <code>sum [1,2,3]</code> but you need <code>sum [1,2,3,4]</code> ;)"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757465, "post_id": 37777844, "comment_id": 63023376, "body": "Aren&#39;t <code>Ints</code> Numbers?"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757485, "post_id": 37777844, "comment_id": 63023381, "body": "I don&#39;t understand.. can you please post an answer with working code?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757494, "post_id": 37777844, "comment_id": 63023384, "body": "yes but you claim that your algorithm works for <b>all</b> numbers <code>a</code> - and <code>Int</code> is just one of them"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465757574, "post_id": 37777844, "comment_id": 63023406, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/114473/discussion-between-dopatraman-and-carsten\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1465757790, "post_id": 37777934, "comment_id": 63023477, "body": "What is the signature for <code>missing</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1465757863, "post_id": 37777934, "comment_id": 63023503, "body": "I added it - but you can really check it for yourself using GHCi (actually you&#39;ll learn more if you do  those things yourself) - if you don&#39;t understand <code>Foldable t</code> yet read it like <code>missing :: Num a =&gt; [a] -&gt; a</code> - so it&#39;s exactly what you wanted)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1465757817, "last_edit_date": 1465757817, "creation_date": 1465757577, "answer_id": 37777934, "question_id": 37777844, "link": "https://stackoverflow.com/questions/37777844/how-to-treat-member-of-num-typeclass-as-an-int/37777934#37777934", "title": "How to treat member of Num typeclass as an Int", "body": "<p>as you asked this should work:</p>\n\n<pre><code>missing :: (Num a, Foldable t) =&gt; t a -&gt; a\nmissing xs = fromIntegral (sum [1..length xs + 1]) - sum xs\n</code></pre>\n\n<p>but only if your list of numbers is just missing one number in <code>[1..m]</code> for some <code>m</code></p>\n\n<hr>\n\n<p>your version don't work because you claim</p>\n\n<pre><code>missingNumber :: (Num a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>and then it needs to work for all <code>Num a</code> - for example <code>Double</code> - but then you will mix <code>Int</code> with <code>Double</code> (for example) - which you cannot do</p>\n\n<p><code>fromIntegral</code> saves you here because it will bring back your <code>Int</code> into any <code>Num a</code> you might have there (it's <code>fromIntegral :: (Integral c, Num d) =&gt; c -&gt; d</code> - here you have <code>c ~ Int</code> and <code>d ~ a</code> - where <code>~</code> means type-equality)</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1465757817, "creation_date": 1465757084, "question_id": 37777844, "link": "https://stackoverflow.com/questions/37777844/how-to-treat-member-of-num-typeclass-as-an-int", "title": "How to treat member of Num typeclass as an Int", "body": "<p>This is a function I'm trying to write:</p>\n\n<pre><code>missingNumber :: (Num a) =&gt; [a] -&gt; a\nmissingNumber list = (sum refList) - (sum list)\n  where refList = [1..n]\n        n = length list\n</code></pre>\n\n<p>Given a list of numbers, I want to sum them and compare them to a known list to see if any are missing. This code seems straightforward, but when I run it I get this (rather verbose) error:</p>\n\n<pre><code>Could not deduce (a ~ Int)\nfrom the context (Num a)\n  bound by the type signature for missingNumber :: Num a =&gt; [a] -&gt; a\n  at missingnumber.hs:1:18-36\n  `a' is a rigid type variable bound by\n      the type signature for missingNumber :: Num a =&gt; [a] -&gt; a\n      at missingnumber.hs:1:18\nExpected type: [a]\n  Actual type: [Int]\nIn the first argument of `sum', namely `refList'\nIn the first argument of `(-)', namely `(sum refList)'\nIn the expression: (sum refList) - (sum list)\n</code></pre>\n\n<p>I'm guessing this is happening because <code>n</code> in <code>[1..n]</code> must be an instance of the <code>Enum</code> type class in order to be iterated over in sequence. But (assuming I'm correct), how do I cast <code>a</code> as two types? Also... shouldn't <code>Int</code> be a member of the Num class?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 3, "creation_date": 1465735454, "post_id": 37774347, "comment_id": 63016287, "body": "Your implementation of <code>map</code> looks really strange, since you are ignoring <code>f</code>."}, {"owner": {"reputation": 5190, "user_id": 353268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/68f14024956c4a67bd92f44a15505e7c?s=128&d=identicon&r=PG", "display_name": "mariosangiorgio", "link": "https://stackoverflow.com/users/353268/mariosangiorgio"}, "edited": false, "score": 2, "creation_date": 1465735536, "post_id": 37774347, "comment_id": 63016317, "body": "Is <code>filter</code> defined on your custom list? Can you please post it too?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1465735897, "post_id": 37774347, "comment_id": 63016400, "body": "Apologies I rushed the question, I&#39;m still intending to &#39;apply&#39; f. But even if I don&#39;t apply f, I still don&#39;t understand why I get the error.  I haven&#39;t defined filter on my custom list.  If I don&#39;t use a parameter - would this cause errors? (Even if bad practice - still in the learning phase)"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1465736255, "post_id": 37774347, "comment_id": 63016494, "body": "Actually filter was implemented but not directly by myself! I was working on the exercise from <a href=\"https://github.com/NICTA/course\" rel=\"nofollow noreferrer\">github.com/NICTA/course</a> apologies."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1465736439, "post_id": 37774347, "comment_id": 63016552, "body": "Even if you implemented <code>filter</code> for your list, implementing <code>map</code> in terms of <code>filter</code> does not make sense. <code>filter</code> does not allow to return a different type of list, which <code>map</code> supports."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1465736615, "post_id": 37774347, "comment_id": 63016613, "body": "I do agree with you. It just so happens to be the way the exercise I was doing was written (which wanted an implementation of &#39;map&#39; that would achieve what I stated above."}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1465736922, "post_id": 37774426, "comment_id": 63016698, "body": "Thank you for your answer! I would accept it but I don&#39;t want to mislead anyone. (see my comments in my question). Essentially there was an implementation of &#39;filter&#39; for the custom List type defined."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1465741589, "post_id": 37774426, "comment_id": 63018175, "body": "I added a bit about a dedicated <code>filterList</code> fwiw"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 5, "last_activity_date": 1465742329, "last_edit_date": 1465742329, "creation_date": 1465735728, "answer_id": 37774426, "question_id": 37774347, "link": "https://stackoverflow.com/questions/37774347/why-is-my-implementation-of-a-map-on-a-custom-type-not-correct/37774426#37774426", "title": "Why is my implementation of a map on a custom type not correct?", "body": "<p>First, to explain the error message: you can't use <code>filter</code> in your definition, since</p>\n\n<pre><code> filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>has to do with regular Prelude lists, not your <code>List</code>s -- i.e. <code>[a]</code> not <code>List a</code>. The error message arises because <code>filter</code> expects <code>a</code> in </p>\n\n<pre><code> map f a = filter (\\listElement -&gt; listElement /= Nil) a\n</code></pre>\n\n<p>to be a list of something, but the signature you supplied declares that <code>a</code> is a <code>List</code> of something. Similarly <code>filter</code> returns a Prelude list of something, but the signature requires that it return a <code>List</code> of something. </p>\n\n<p>The natural implementation of <code>map</code> for <code>List</code> would distinguish the cases of <code>List</code> that you gave in the type declaration, that is, it would \"pattern match\":</p>\n\n<pre><code>mapList ::\n    (a -&gt; b)\n    -&gt; List a\n    -&gt; List b\nmapList f Nil = Nil\nmapList f (t :. ls) = f t :. mapList f ls\n</code></pre>\n\n<p>Note that the program you wrote is perfectly valid, it just conflicts with the signature you gave it:</p>\n\n<pre><code>ghci&gt; let mapX f a = filter (\\listElement -&gt; listElement /= Nil) a\nghci&gt; :t mapX\nmapX :: Eq a =&gt; t -&gt; [List a] -&gt; [List a]\n</code></pre>\n\n<p>The <code>Eq</code> constraint is required because you presuppose that <code>List</code>s be tested for equality and thus that their elements can be.  <code>f</code> is not used, so it just ends up as a 'could be anything' parameter, here <code>t</code>. </p>\n\n<p>Of course, if you have your own <code>filterList</code> for <code>List</code>s it will also typecheck</p>\n\n<pre><code>ghci&gt; let filterList pred Nil = Nil; filterList pred (a :. as) = if pred a then a :. filterList pred as else filterList pred as\n\nghci&gt; :t filterList\nfilterList :: (t -&gt; Bool) -&gt; List t -&gt; List t\n\nghci&gt; let mapY f a = filterList (\\listElement -&gt; listElement /= Nil) a\n\nghci&gt; :t mapY\nmapY :: Eq a =&gt; t -&gt; List (List a) -&gt; List (List a)\n</code></pre>\n\n<p>What this function does is delete null elements from a List of Lists, like <code>Prelude.filter (not . Prelude.null)</code>. Similarly, the actual function you defined (without the signature) deleted <code>Nil</code> Lists from a <em>Prelude list</em> of your Lists.</p>\n"}, {"tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 1, "last_activity_date": 1465737222, "creation_date": 1465737222, "answer_id": 37774672, "question_id": 37774347, "link": "https://stackoverflow.com/questions/37774347/why-is-my-implementation-of-a-map-on-a-custom-type-not-correct/37774672#37774672", "title": "Why is my implementation of a map on a custom type not correct?", "body": "<pre><code>filter (\\listElement -&gt; listElement /= Nil) a\n</code></pre>\n\n<p>Here's the source of type error. If your implementation of <code>filter</code> follows reasonable path, <code>listElement</code> should be an element of <code>a</code>, that is, since <code>a</code> has type <code>List a</code>, it is of type <code>a</code>. You compare it for inequality against <code>Nil</code> which is of type <code>List a</code>.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1465742329, "creation_date": 1465735115, "last_edit_date": 1465736806, "question_id": 37774347, "link": "https://stackoverflow.com/questions/37774347/why-is-my-implementation-of-a-map-on-a-custom-type-not-correct", "title": "Why is my implementation of a map on a custom type not correct?", "body": "<p>I'm following the List exercise from <a href=\"https://github.com/NICTA/course\" rel=\"nofollow\">https://github.com/NICTA/course</a></p>\n\n<p>The below snippet copied from part of <a href=\"https://github.com/NICTA/course/blob/master/src/Course/List.hs\" rel=\"nofollow\">https://github.com/NICTA/course/blob/master/src/Course/List.hs</a></p>\n\n<pre><code>data List t =\n  Nil\n  | t :. List t\n  deriving (Eq, Ord)\n\nmap ::\n  (a -&gt; b)\n  -&gt; List a\n  -&gt; List b\nmap f a = filter (\\listElement -&gt; listElement /= Nil) a\n</code></pre>\n\n<p>The above gives me the below error:<br>\nCouldn't match expected type \u2018b\u2019 with actual type \u2018List t0\u2019 \u2018b\u2019 is a rigid type variable bound by the type signature for map :: (a -> b) -> List a -> List b</p>\n\n<p>I'm trying to achieve the below:</p>\n\n<pre><code>&gt;&gt;&gt; map (+10) (1 :. 2 :. 3 :. Nil)\n[11,12,13]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1465720728, "post_id": 37772177, "comment_id": 63012562, "body": "it&#39;s exactly what a list (of <code>Student</code>s) is - <code>Cons</code> is <code>:</code> and <code>Empty</code> is <code>[]</code>"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 2, "creation_date": 1465722132, "post_id": 37772177, "comment_id": 63012848, "body": "The recursive definition of <code>LOS</code> resembles a (linked) list. Values of that type are either the empty list or a node (called <code>Cons</code>) containing some payload and the rest of the list."}, {"owner": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 2, "creation_date": 1465724108, "post_id": 37772177, "comment_id": 63013326, "body": "A good introduction to recursive data types: <a href=\"https://en.wikipedia.org/wiki/Recursive_data_type\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Recursive_data_type</a>"}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 3, "creation_date": 1465726170, "post_id": 37772177, "comment_id": 63013820, "body": "your <code>LOS</code> is literally <code>List Of Students</code>.."}], "answers": [{"tags": [], "owner": {"reputation": 5190, "user_id": 353268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/68f14024956c4a67bd92f44a15505e7c?s=128&d=identicon&r=PG", "display_name": "mariosangiorgio", "link": "https://stackoverflow.com/users/353268/mariosangiorgio"}, "is_accepted": true, "score": 4, "last_activity_date": 1465730945, "creation_date": 1465730945, "answer_id": 37773695, "question_id": 37772177, "link": "https://stackoverflow.com/questions/37772177/haskell-could-anyone-explain-the-below-algebric-data-type/37773695#37773695", "title": "haskell : could anyone explain the below algebric data type", "body": "<p><code>LOS</code> is defining a list of students. You either have an empty list (<code>Empty</code>) or <code>Cons</code>, which holds both a value or the rest of the list.</p>\n\n<p>You can have a list with an element (<code>Cons s1 Empty</code>), a list with two elements (<code>Cons s1 (Cons s2 Empty)</code>) and so on.</p>\n"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 37773695, "answer_count": 1, "score": 1, "last_activity_date": 1465730945, "creation_date": 1465720183, "question_id": 37772177, "link": "https://stackoverflow.com/questions/37772177/haskell-could-anyone-explain-the-below-algebric-data-type", "title": "haskell : could anyone explain the below algebric data type", "body": "<p>could anyone explain the below algebric data type</p>\n\n<pre><code>data LOS = Cons Student LOS | Empty deriving (Show) \n</code></pre>\n\n<p>and </p>\n\n<pre><code>type Name = String\n\n\n\ndata Student = Student           \n  { firstName :: Name\n  , lastName :: Name\n  } deriving (Eq, Show)\n</code></pre>\n\n<p>I find it confusing the construction of the LOS data type</p>\n"}, {"tags": ["haskell", "immutability"], "comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 1, "creation_date": 1465708905, "post_id": 37770984, "comment_id": 63010334, "body": "Reading <a href=\"https://www.joachim-breitner.de/blog/443-A_Solution_to_the_Configuration_Problem_in_Haskell\" rel=\"nofollow noreferrer\">joachim-breitner.de/blog/&hellip;</a> after posting this question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1465711270, "post_id": 37770984, "comment_id": 63010699, "body": "first note that I don&#39;t think you&#39;ll get away without some medium refactoring - so one <i>easy</i> solution is to delete <code>googleClientId :: ...</code> and <code>googleClientSecret :: ...</code> (both definitions) completely, then look where the compiler is complaining about the missing items, move the identifiers into arguments in the so found functions and then provide the arguments where you have them from either arguments you already introduced or from the local values in your <code>main</code> ... TL;DR: make the configuration into arguments instead of global values"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1465717485, "post_id": 37770984, "comment_id": 63011914, "body": "Since <code>generateOAuthUserCode</code> is already an <code>IO</code> action, you could just move the <code>getEnv</code> into the <code>do</code> block there, I think. Or is it just an example for lots of other global variables throughout your codebase? Then read my answer."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1465721059, "post_id": 37770984, "comment_id": 63012624, "body": "Added an alternative approach to my question."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1465730481, "post_id": 37770984, "comment_id": 63014949, "body": "@SaurabhNanda I do not see the advantage of your new approach. Could you elaborate? Also, mind giving me feedback regarding my comment and/or answer? Not sure if I understood your problem correctly."}], "answers": [{"comments": [{"owner": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 0, "creation_date": 1465723649, "post_id": 37771766, "comment_id": 63013208, "body": "Use <code>lookupEnv</code>. Running <code>lookupEnv</code> with <code>unsafePerformIO</code> is safe."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "reply_to_user": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 0, "creation_date": 1465726207, "post_id": 37771766, "comment_id": 63013826, "body": "Nice suggestion, I did not know <code>lookupEnv</code>. But in case of global variables, the OP probably does not want to change their type to <code>Maybe String</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465726929, "post_id": 37771766, "comment_id": 63014002, "body": "Well you can do <code>fromMaybe &quot;&quot; . unsafePerformIO $ lookupEnv &quot;...&quot;</code>"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465728337, "post_id": 37771766, "comment_id": 63014399, "body": "@Bakuriu That would cause failures later on, and obscure the root cause. Since those configuration variables are hard-coded right now, I assume there is no error handling whatsoever. I&#39;d rather have a program crash right at the start then."}, {"owner": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 0, "creation_date": 1465729832, "post_id": 37771766, "comment_id": 63014783, "body": "How do you handle exceptions thrown in IO action passed to <code>unsafePerformIO</code>? If you are practicing <i>fail fast</i> then it&#39;s okay to not handle them."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "reply_to_user": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 0, "creation_date": 1465730344, "post_id": 37771766, "comment_id": 63014908, "body": "@PooyanKhosravi I&#39;m talking about a &quot;quick and dirty&quot; approach here. Fail fast, and rely on the environment variables being set correctly by whoever runs the program. Not very safe, clean or elegant, but the OP asked for the fastest/easiest way."}, {"owner": {"reputation": 3943, "user_id": 2647317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f163870821b443d585648035a69464?s=128&d=identicon&r=PG", "display_name": "Pooyan Khosravi", "link": "https://stackoverflow.com/users/2647317/pooyan-khosravi"}, "edited": false, "score": 0, "creation_date": 1465730649, "post_id": 37771766, "comment_id": 63014991, "body": "@stholzm should have mentioned OP, sorry."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465731184, "post_id": 37771766, "comment_id": 63015128, "body": "It depends. Generally you have a default configuration value and the env variable is used to change that. So replace <code>&quot;&quot;</code> with whichever default is sensible."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465731472, "post_id": 37771766, "comment_id": 63015198, "body": "@Bakuriu depends on the config variable, I guess. Imagine using the wrong database or web service because you forgot to set the env variable! I&#39;d rather fail fast. For other cases, <code>lookupEnv</code> and <code>fromMaybe</code> may be preferrable indeed."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1466085239, "post_id": 37771766, "comment_id": 63179753, "body": "Note that it&#39;s likely that the result of that environment lookup gets cached. That&#39;s probably ideal for this use case, but you wouldn&#39;t want to use the same technique for values that you expect to change."}], "tags": [], "owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "is_accepted": false, "score": 4, "last_activity_date": 1465717186, "last_edit_date": 1465717186, "creation_date": 1465716435, "answer_id": 37771766, "question_id": 37770984, "link": "https://stackoverflow.com/questions/37770984/does-haskell-have-variables-or-easiest-way-to-read-configuration-data/37771766#37771766", "title": "Does Haskell have &quot;variables&quot;? Or, easiest way to read configuration data?", "body": "<p>I assumed that you rely on global variables like <code>googleClientId</code> often in your codebase.</p>\n\n<p><em>You might want to try and at least estimate the cost of the <code>Reader</code> approach before you go the \"technical debt\" route. Global variables are a bad practice anyways, @Carsten has proposed an alternative refactoring. But since you are asking for pragmatic help...</em></p>\n\n<p>Question 1: The <strong>fastest/easiest</strong> way is to use the frowned-upon <code>unsafePerformIO</code>. Like this:</p>\n\n<pre><code>googleClientId = unsafePerformIO $ getEnv \"GOOGLE_CLIENT_ID\"\nmain = putStrLn googleClientId\n</code></pre>\n\n<p>This basically lets you ignore the safety of <code>IO</code> and puts the desired value into a global variable as if it was a plain string. Please note that <code>getEnv</code> <em>crashes</em> if the environment variable does not exist.</p>\n\n<p>Question 2: One cannot \"update\" variables in Haskell. If one creates another variable with the same name in a nested scope, that binding will shadow the outer one in the inner scope, leaving the outer binding intact. That is somewhat confusing, hence the warning.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1465721045, "creation_date": 1465708767, "last_edit_date": 1465721045, "question_id": 37770984, "link": "https://stackoverflow.com/questions/37770984/does-haskell-have-variables-or-easiest-way-to-read-configuration-data", "title": "Does Haskell have &quot;variables&quot;? Or, easiest way to read configuration data?", "body": "<p>I have written my medium-sized Haskell app with hard-coded config variables (like Google OAuth ClientId &amp; ClientSecret). Now that I'm prepping the app for a production deployment, I need to move all these config variable out of the source, to either: (a) environment variables, or (b) a plain-text config file.</p>\n\n<p>Here's what the code, currently, look likes:</p>\n\n<pre><code>googleClientId :: T.Text\ngoogleClientId = \"redacted\"\n\ngoogleClientSecret :: T.Text\ngoogleClientSecret = \"redacted\"\n\ngenerateOAuthUserCode :: IO (OAuthCodeResponse)\ngenerateOAuthUserCode = do\n  r &lt;- asJSON =&lt;&lt; post \"https://accounts.google.com/o/oauth2/device/code\" [\"client_id\" := googleClientId, \"scope\" := (\"email profile\" :: T.Text)]\n  return $ r ^. responseBody\n</code></pre>\n\n<p>What's the <strong>fastest/easiest</strong> way to get <code>googleClientId</code> and <code>googleClientSecret</code> from an environment variable (or config file)? I tried the following:</p>\n\n<pre><code>googleClientId :: T.Text\ngoogleClientId = undefined\n\ngoogleClientSecret :: T.Text\ngoogleClientSecret = undefined\n\nmain :: IO()\nmain = do \n  googleClientId &lt;- getEnv \"GOOGLE_CLIENT_ID\"\n  googleClientSecret &lt;- getENV \"GOOGLE_CLIENT_SECRET\"\n  -- Start the main app, which internally will call generateOAuthUserCode at some point.\n</code></pre>\n\n<p>The expectation was that the global <code>googleClientId</code> and <code>googleClientSecret</code> will be re-bound, but my editor immediately started showing a warning that \"the binding shadows an existing binding\", indicating that Haskell is creating a new binding, instead of changing the existing one.</p>\n\n<p>So, two questions here:</p>\n\n<ol>\n<li>First, the pragmatic one. How to solve the problem at hand, <strong>without</strong> getting into the Reader monad, which might involve changing a lot of function signatures across my app.</li>\n<li>Second, the one oriented to learning. Haskell has immutable <em>values</em>, which is understood and appreciated. Does it even have immutable <em>variable binding</em>? Is it not possible to get dynamic variable bindings, like in Common Lisp?</li>\n</ol>\n\n<p><strong>Edit:</strong>  What about the following approach?</p>\n\n<p>what about the following approach?</p>\n\n<pre><code>outerFunc :: String -&gt; String -&gt; IO ()\nouterFunc googleClientId googleClientSecret = do\n  -- more code comes here\n\n  where\n    generateOAuthUserCode :: IO (OAuthCodeResponse)\n    generateOAuthUserCode = do\n      r &lt;- asJSON =&lt;&lt; post \"https://accounts.google.com/o/oauth2/device/code\" [\"client_id\" := googleClientId, \"scope\" := (\"email profile\" :: T.Text)]\n      return $ r ^. responseBody\n\n    -- more functions depending upon the config variables\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 1682144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c0a919b715043f8d34bb1dc0364f78?s=128&d=identicon&r=PG", "display_name": "objectx", "link": "https://stackoverflow.com/users/1682144/objectx"}, "is_accepted": true, "score": 11, "last_activity_date": 1465706386, "creation_date": 1465706386, "answer_id": 37770785, "question_id": 37770573, "link": "https://stackoverflow.com/questions/37770573/haskell-stack-command-with-ghc-option/37770785#37770785", "title": "haskell-stack command with GHC option", "body": "<p>All of GHC specific options should be placed after <code>--</code></p>\n\n<p>ex.</p>\n\n<pre><code>stack ghc -- -O2 hello.hs\n</code></pre>\n"}], "owner": {"reputation": 1481, "user_id": 2885946, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/8CNNA.png?s=128&g=1", "display_name": "ryo", "link": "https://stackoverflow.com/users/2885946/ryo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 760, "favorite_count": 0, "accepted_answer_id": 37770785, "answer_count": 1, "score": 4, "last_activity_date": 1465706386, "creation_date": 1465703495, "last_edit_date": 1465703845, "question_id": 37770573, "link": "https://stackoverflow.com/questions/37770573/haskell-stack-command-with-ghc-option", "title": "haskell-stack command with GHC option", "body": "<p>I'm using <code>stack</code> command to compile a Haskell code. I'd like to compile with GHC options like <code>-O2</code>. I would like you tell how do I do this.</p>\n\n<p>The following command is not OK. I'd like to do like the below code.</p>\n\n<pre><code>stack ghc -O2 hello.hs\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1467082101, "post_id": 37769351, "comment_id": 63570957, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/12237\" rel=\"nofollow noreferrer\">I think GHC is wrong here</a>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1467083478, "post_id": 37769351, "comment_id": 63571255, "body": "@Cactus Thanks for reporting."}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 1, "answer_count": 0, "score": 10, "last_activity_date": 1465687379, "creation_date": 1465687379, "question_id": 37769351, "link": "https://stackoverflow.com/questions/37769351/displaying-custom-type-errors-in-type-families", "title": "Displaying custom type errors in type families", "body": "<p>GHC 8.0 has a feature for <a href=\"http://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#custom-compile-time-errors\">user-defined type errors</a>. I'm trying that out, but I can't quite get it to do what I want:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleContexts, FlexibleInstances, MultiParamTypeClasses,\n             TypeFamilies, TypeOperators, UndecidableInstances #-}\n\nimport Data.Proxy\nimport GHC.TypeLits\n\ndata DoubleD\ndata IntD\n\ntype family CTypeOf x where\n  CTypeOf (a,b) = EqCType (CTypeOf a) (CTypeOf b)\n  CTypeOf Double = DoubleD\n  CTypeOf Int = IntD\n\n  CTypeOf a = TypeError (Text \"Unsupported type: \" :&lt;&gt;: ShowType a)\n\ntype family EqCType a b where\n  EqCType a a = a\n  EqCType a b = TypeError (Text \"Pair error\")\n\nclass (repr ~ CTypeOf r) =&gt; Dispatch' repr r\ninstance (CTypeOf r ~ DoubleD) =&gt; Dispatch' DoubleD r\ninstance (CTypeOf r ~ IntD) =&gt; Dispatch' IntD r\n\nfoo :: (Dispatch' (CTypeOf a) a) =&gt; Proxy a -&gt; Int\nfoo _ = 3\n\nmain :: IO ()\n--main = print $ foo (Proxy::Proxy (Int, Int))\n--main = print $ foo (Proxy::Proxy (Int, Double))\n--main = print $ foo (Proxy::Proxy Bool)\n--main = print $ foo (Proxy::Proxy (Bool, Bool))\nmain = print $ foo (Proxy::Proxy (Bool, Double))\n</code></pre>\n\n<p>The first four definitions of <code>main</code> work like I expect:</p>\n\n<ol>\n<li>compiles</li>\n<li>error: <code>Pair error</code></li>\n<li>error: <code>Unsupported type: Bool</code></li>\n<li>error: <code>Unsupported type: Bool</code></li>\n</ol>\n\n<p>For the fifth definition, I <em>want</em> to display <code>Unsupported type: Bool</code>, but GHC shows:</p>\n\n<ol start=\"5\">\n<li>error: <code>No instance for (Dispatch' (EqCType (TypeError ...) DoubleD) (Bool, Double))</code></li>\n</ol>\n\n<p>I'm confused why GHC got the first three errors correct, but isn't showing my type error on the final definition. I'm looking for a brief explanation of <strong>why</strong>, plus a workaround if possible. Is this just a limitation of the implementation of custom type errors?</p>\n"}, {"tags": ["date", "haskell", "record"], "answers": [{"comments": [{"owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 0, "creation_date": 1465684278, "post_id": 37769022, "comment_id": 63006595, "body": "But I can&#39;t use the IO monad with servant, can I?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 1, "creation_date": 1465685847, "post_id": 37769022, "comment_id": 63006908, "body": "Sure you can. Where do you want to put your code? Usually using <code>liftIO</code> is all you need."}, {"owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 0, "creation_date": 1465759490, "post_id": 37769022, "comment_id": 63024024, "body": "Can you combine two endpoints in which one is in the IO monad (<code>IO [User]</code>) and the other isn&#39;t (<code>[Friend]</code>) ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "edited": false, "score": 0, "creation_date": 1465765181, "post_id": 37769022, "comment_id": 63025737, "body": "<code>[Friend]</code> is a pure value so I&#39;m sure you can, but I&#39;m exactly sure of what context you&#39;re referring to, so I don&#39;t know how to show you how to do it. Can you come up with a short example of what you&#39;re trying to do? And it would be appropriate to post it as a new question."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1465684150, "creation_date": 1465684150, "answer_id": 37769022, "question_id": 37768964, "link": "https://stackoverflow.com/questions/37768964/how-to-store-current-date-in-a-record-as-a-day-type-only/37769022#37769022", "title": "How to store current date in a record as a Day type only?", "body": "<p><code>currentDay</code> (as well as <code>getCurrentTime</code>) is an IO-action. You have to execute it in the IO-monad to retrieve the current day.</p>\n\n<p>You code should look like:</p>\n\n<pre><code>currentDay :: IO Day\ncurrentDay = utctDay &lt;$&gt; getCurrentTime\n\ncreateUsers :: IO [User]\ncreateUsers = do\n  today &lt;- currentDay\n  return [ User 1 \"A\" today, User 2 \"B\" today ]\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 2930101, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/UYXdd.png?s=128&g=1", "display_name": "OneEyeQuestion", "link": "https://stackoverflow.com/users/2930101/oneeyequestion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 37769022, "answer_count": 1, "score": 0, "last_activity_date": 1465684920, "creation_date": 1465683449, "last_edit_date": 1465684920, "question_id": 37768964, "link": "https://stackoverflow.com/questions/37768964/how-to-store-current-date-in-a-record-as-a-day-type-only", "title": "How to store current date in a record as a Day type only?", "body": "<p>How can I store in a record the current date as a <code>Day</code> type? Is this the correct way of doing it? I want to do this to be able to manipulate dates in the application but also to store them in a database using Opaleye or Esqueleto.</p>\n\n<p>I have this:</p>\n\n<pre><code>import Data.Time\nimport Data.Time.Format\n\ndata User = User\n  { userId    :: Int\n  , name      :: Text\n  , loginDate :: Day\n  } deriving (Eq, Show)\n\n\ncurrentDay :: Day\ncurrentDay = utctDay &lt;$&gt; getCurrentTime ???\n\nusers :: [User]\nusers = [ User 1 \"A\" currentDay\n        , User 2 \"B\" currentDay\n        ]\n</code></pre>\n\n<p>But the type of <code>currentDay</code> is <code>IO Day</code>. How can I get it as <code>Day</code> only? I am guessing that is not possible without breaking type safety but I am not sure. </p>\n\n<p>I could change the type of <code>loginDate</code> to <code>IO Day</code> but then I wouldn't be able to derive <code>Eq</code> and <code>Show</code> and thus be unable to use <code>deriveJSON</code> while using Servant. If I change the type of <code>currentDay</code> to <code>IO Day</code> and <code>users</code> to <code>IO [User]</code> then I cannot use Servant types.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1465683890, "post_id": 37768973, "comment_id": 63006511, "body": "Indeed. Though to define an <code>Integral</code> instance, one <i>needs</i> to first define a <code>Num</code> one, which is another reason to stay away from corrumping <code>div</code> for this purpose."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1465683998, "post_id": 37768973, "comment_id": 63006537, "body": "Can you include an example of how to solve this problem?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 1, "creation_date": 1465684259, "post_id": 37768973, "comment_id": 63006591, "body": "@dopatraman: you&#39;ve already solved it yourself: use the same definition you wrote for <code>div</code>. Just give it a proper name of its own instead of trying to instantiate this existing <code>Integral</code> method."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1465684775, "last_edit_date": 1465684775, "creation_date": 1465683564, "answer_id": 37768973, "question_id": 37768872, "link": "https://stackoverflow.com/questions/37768872/defining-how-custom-datatype-handles-being-passed-to-a-partially-applied-functio/37768973#37768973", "title": "Defining how custom datatype handles being passed to a partially applied function", "body": "<p>The general type for <code>div</code> is</p>\n\n<pre><code>&gt; :t div\ndiv :: Integral a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>in your instance, you picked <code>a</code> to be <code>Coin</code>. However this forces the two arguments to have the same type <code>Coin</code>.</p>\n\n<p>If you want a division function with heterogeneous arguments, you have to define your own custom function, and avoid <code>div</code>.</p>\n\n<pre><code>divCoins :: Int -&gt; Coin -&gt; Coin\ndivCoins x (Coin y) = Coin (div x y)\n</code></pre>\n\n<p>(I'm still puzzled by \"dividing an integer by coins\" when the vice versa looks more natural to me, but I don't know your aim.)</p>\n\n<p>If we want to be picky, <code>div 100 (Coin 5)</code> could be made to type check by adding a <code>Num Coin</code> instance so that <code>100</code> can be of type <code>Coin</code>. I'm not sure if this is a good idea, though. Without knowing the intended usage of <code>Coin</code>, I'd avoid this.</p>\n\n<hr>\n\n<p>Edit: I forgot that <code>Integral</code> requires <code>Num</code>, as @leftaroundabout points out below.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1465684775, "creation_date": 1465682476, "question_id": 37768872, "link": "https://stackoverflow.com/questions/37768872/defining-how-custom-datatype-handles-being-passed-to-a-partially-applied-functio", "title": "Defining how custom datatype handles being passed to a partially applied function", "body": "<p>I have a type <code>Coin</code>:</p>\n\n<pre><code>data Coin = Coin Int deriving (Show)\n</code></pre>\n\n<p>I want to be able to divide an amount of type <code>Int</code> by the coin and obtain the whole number result. Since coins can only ever be whole numbers, I've decided to make the Coin type an instance of the <code>Integral</code> typeclass:</p>\n\n<pre><code>instance Integral Coin where\n  div x (Coin y) = Coin (div x y)\n</code></pre>\n\n<p>So a partially applied <code>div</code> function can still take in a <code>Coin</code> type. However, when I try to compile I get</p>\n\n<pre><code>Couldn't match expected type `Int' with actual type `Coin'\nIn the first argument of `div', namely `x'\nIn the first argument of `Coin', namely `(div x y)'\n</code></pre>\n\n<p>Not sure where I'm going wrong. What I want to be able to do is this:</p>\n\n<pre><code>div 100 (Coin 25) -- evaluated to 4\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "jupyter", "ghci", "let"], "comments": [{"owner": {"reputation": 2050, "user_id": 3024983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/px3w6.jpg?s=128&g=1", "display_name": "Veritas", "link": "https://stackoverflow.com/users/3024983/veritas"}, "edited": false, "score": 0, "creation_date": 1465660223, "post_id": 37765574, "comment_id": 62999918, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/14052093/ghci-let-what-does-it-do\">GHCi &quot;let&quot; -- what does it do?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 6453903, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/apArh.jpg?s=128&g=1", "display_name": "CptSnuggles", "link": "https://stackoverflow.com/users/6453903/cptsnuggles"}, "edited": false, "score": 0, "creation_date": 1465660839, "post_id": 37765639, "comment_id": 63000113, "body": "Heaven just opened it&#39;s doors for me. God bless you and your family. And stuff. ;-)"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 4, "last_activity_date": 1465660203, "creation_date": 1465660203, "answer_id": 37765639, "question_id": 37765574, "link": "https://stackoverflow.com/questions/37765574/haskell-parse-error-with-ghci-with-let/37765639#37765639", "title": "Haskell parse error with ghci with &#39;let&#39;", "body": "<p>Your <code>let</code> isn't in any function is it?</p>\n\n<p>If you're just defining a global \"constant\", you just go:</p>\n\n<pre><code>idle :: Prozess\nidle = Prozess{pid=1, arrival=5, computing=10}\n</code></pre>\n\n<p>Also, note that you don't need the record notation. You can swap that for:</p>\n\n<p><code>idle  = Prozess 1 5 10</code></p>\n"}], "owner": {"reputation": 109, "user_id": 6453903, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/apArh.jpg?s=128&g=1", "display_name": "CptSnuggles", "link": "https://stackoverflow.com/users/6453903/cptsnuggles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 37765639, "answer_count": 1, "score": 1, "last_activity_date": 1465660203, "creation_date": 1465659800, "question_id": 37765574, "link": "https://stackoverflow.com/questions/37765574/haskell-parse-error-with-ghci-with-let", "title": "Haskell parse error with ghci with &#39;let&#39;", "body": "<p>I've been sitting around here for quite some time now and my problem just won't solve by googling, try and error. I've got the following code snippet:</p>\n\n<pre><code>data Prozess = Prozess { pid :: Int, arrival :: Int, computing :: Int } deriving (Show)\n\nlet idle = Prozess{pid=1, arrival=5, computing=10}\n</code></pre>\n\n<p>So I tried to compile it with ghci, but it's keep giving me a \"parse error (possibly incorrect indentation or mismatched brackets)\" at the \"let idle ...\"-line. Weird thing is, I tried compiling this using our Jupyter-Server  and that seems to work nicely. Also, if I compile it without the \"let\"-line and input the -exact- same line afterwards via Terminal in *Main>, it's working fine too.</p>\n\n<p>So what's wrong with ghci? Think I'm losing my mind over this.</p>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1465655323, "post_id": 37764592, "comment_id": 62998294, "body": "Try writing <code>f :: BinTree a -&gt; [[a]]</code>, which converts a binary tree to a list of lists, in which the first list contains the root, the second list the childs, the next the grandchilds and so on. You&#39;re almost done after that."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1465655864, "post_id": 37764592, "comment_id": 62998502, "body": "Otherwise have a look at <a href=\"http://stackoverflow.com/questions/12556469/nicely-printing-showing-a-binary-tree-in-haskell?rq=1\">this</a> question, it might help with designing the function."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465657711, "post_id": 37764592, "comment_id": 62999139, "body": "Think about how you would express levels of a node in terms of the levels of the left and right child nodes. Have you been introduced to the <code>zip</code> function?"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1465670516, "post_id": 37764592, "comment_id": 63003082, "body": "<code>levels ts = roots ts : levels (childs ts)</code>"}, {"owner": {"reputation": 11, "user_id": 5884445, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OjRQqOd1U9A/AAAAAAAAAAI/AAAAAAAAAB8/xeVww3S_6cA/photo.jpg?sz=128", "display_name": "Cyneon Bane", "link": "https://stackoverflow.com/users/5884445/cyneon-bane"}, "edited": false, "score": 0, "creation_date": 1465738573, "post_id": 37764592, "comment_id": 63017190, "body": "My problem is, that i don&#39;t know how i could print it out as above mentioned."}], "answers": [{"tags": [], "owner": {"reputation": 269, "user_id": 2290347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/owtS1.jpg?s=128&g=1", "display_name": "lando", "link": "https://stackoverflow.com/users/2290347/lando"}, "is_accepted": false, "score": 1, "last_activity_date": 1465759532, "last_edit_date": 1465759532, "creation_date": 1465759127, "answer_id": 37778162, "question_id": 37764592, "link": "https://stackoverflow.com/questions/37764592/print-out-a-binary-tree/37778162#37778162", "title": "Print out a Binary Tree", "body": "<p>This works fine:</p>\n\n<pre><code>f Empty = []\nf (Node l v r) = case (f l, f r) of\n                   ((x:xs),(y:ys)) -&gt; [[v],x++y] ++ (zipWith (++) xs ys)\n                   ([],[])         -&gt; [[v]]\n                    ......\n</code></pre>\n\n<p>Complete the patterns. (You can test this with a complete tree to be sure it's a good start).</p>\n"}], "owner": {"reputation": 11, "user_id": 5884445, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OjRQqOd1U9A/AAAAAAAAAAI/AAAAAAAAAB8/xeVww3S_6cA/photo.jpg?sz=128", "display_name": "Cyneon Bane", "link": "https://stackoverflow.com/users/5884445/cyneon-bane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "closed_date": 1466761445, "answer_count": 1, "score": 0, "last_activity_date": 1465759532, "creation_date": 1465653565, "last_edit_date": 1465656243, "question_id": 37764592, "link": "https://stackoverflow.com/questions/37764592/print-out-a-binary-tree", "closed_reason": "Duplicate", "title": "Print out a Binary Tree", "body": "<p>This is my Guidline:</p>\n\n<pre><code>data BinTree \u03b1 = Empty\n   | Node (BinTree \u03b1) \u03b1 (BinTree \u03b1)\n     deriving (Eq, Show)\n</code></pre>\n\n<p>Now i want to create a function:</p>\n\n<pre><code>levels :: BinTree a -&gt; [[a]]\n</code></pre>\n\n<p>This should print out a Binary Tree in a list, but each level in its own. For Example: <code>[[1],[2,3],[4,5,6,7]]</code> or</p>\n\n<pre><code>[1]\n[2,3]\n[4,5,6,7]\n</code></pre>\n\n<p>...</p>\n\n<p>I defined the <code>roots</code> and <code>childs</code>:</p>\n\n<pre><code>roots ts = [ a | Node _ a _ &lt;- ts ]\nchilds ts = [ t | Node l _ r &lt;- ts, t &lt;- [l, r] ]\n</code></pre>\n\n<p>and a traverse function which gets a list of subtree and its node.</p>\n\n<pre><code>traverse' :: [BinTree \u03b1] -&gt; [\u03b1]\ntraverse' [] = []\ntraverse' ts = roots ts ++ traverse' (childs ts)\n\nlevels :: BinTree \u03b1 -&gt; [\u03b1]\nlevels t = traverse [t]\n</code></pre>\n\n<p>But thats not what I really wanted. Does someone has an idea.</p>\n"}, {"tags": ["postgresql", "haskell", "escaping", "bytestring"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465647648, "post_id": 37763466, "comment_id": 62995922, "body": "You want to replace a character by itself? I can&#39;t understand. Anyway, double check you are not using some escaping functions inadvertently, like <code>show</code>, which add unwanted escapes."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465648173, "post_id": 37763466, "comment_id": 62996092, "body": "How are you storing the string to the database? I think that&#39;s where your problem is."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465649412, "post_id": 37763466, "comment_id": 62996475, "body": "@ErikR True, but I think part of the purpose of this question is to repair the damage to strings already stored in the database."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465649918, "post_id": 37763466, "comment_id": 62996632, "body": "Please edit your question. StackOverflow uses <a href=\"https://en.wikipedia.org/wiki/Markdown\" rel=\"nofollow noreferrer\">markdown</a>, not plaintext, hence your backslash-containing strings aren&#39;t shown as intended."}, {"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1465650177, "post_id": 37763466, "comment_id": 62996716, "body": "strip of the start-end quotes and cast them to bytea"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465650531, "post_id": 37763466, "comment_id": 62996830, "body": "The formatting is still wrong."}, {"owner": {"reputation": 120, "user_id": 6110448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933bdac19cecdbb41785ea4e2293cf87?s=128&d=identicon&r=PG&f=1", "display_name": "auermich", "link": "https://stackoverflow.com/users/6110448/auermich"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465654709, "post_id": 37763466, "comment_id": 62998076, "body": "I have edited the question @leftaroundabout. I can&#39;t store it as bytea due to the invalid encoding. Moreover, it seems that storing it as SqlString and retrieving it - wich comes back as SqlByteString - achieves the &quot;best&quot; result, namely the aboved mentioned."}, {"owner": {"reputation": 120, "user_id": 6110448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933bdac19cecdbb41785ea4e2293cf87?s=128&d=identicon&r=PG&f=1", "display_name": "auermich", "link": "https://stackoverflow.com/users/6110448/auermich"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1465654999, "post_id": 37763466, "comment_id": 62998177, "body": "@chi, I am using show in order to obtain a string out of the bytestring. I have also tried to use the unpack function, but no different result."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465656854, "post_id": 37763466, "comment_id": 62998842, "body": "show is meant to escape funny chars, unpack should keep the string as it is"}, {"owner": {"reputation": 120, "user_id": 6110448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933bdac19cecdbb41785ea4e2293cf87?s=128&d=identicon&r=PG&f=1", "display_name": "auermich", "link": "https://stackoverflow.com/users/6110448/auermich"}, "edited": false, "score": 0, "creation_date": 1465657776, "post_id": 37763466, "comment_id": 62999158, "body": "Actually the data is stored correctly in the database, but reading from the database doesn&#39;t work properly. There must be some bug in the &#39;fromSql&#39; conversion function. It&#39;s even worse when you need to handle both lazy and strict bytestrings as strict bytestrings are only supported."}], "answers": [{"tags": [], "owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "is_accepted": false, "score": 0, "last_activity_date": 1465650336, "creation_date": 1465650336, "answer_id": 37764086, "question_id": 37763466, "link": "https://stackoverflow.com/questions/37763466/replace-double-backslash-with-single-backslash-in-haskell/37764086#37764086", "title": "replace double backslash with single backslash in haskell", "body": "<p>possibly you want the postgresql expression</p>\n\n<pre><code>substring(ByteString from e'^\\\\\"(.*)\\\\\"$')::bytea\n</code></pre>\n\n<p>that will give a <code>bytea</code> result that can be used in queries or in an <code>alter table</code>-<code>using</code> DDL</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1465653452, "creation_date": 1465653452, "answer_id": 37764574, "question_id": 37763466, "link": "https://stackoverflow.com/questions/37763466/replace-double-backslash-with-single-backslash-in-haskell/37764574#37764574", "title": "replace double backslash with single backslash in haskell", "body": "<p>Perhaps using <code>read</code> will work for you:</p>\n\n<pre><code>import Data.ByteString.Char8 as BS\n\nbad =  BS.pack \"\\\"\\\\159\\\\DEL*\\\\150\\\\222/\\\\129vr\\\\205\\\\241=mA\\\\192\\\\184\\\"\"\n\ngood = read (BS.unpack bad) :: BS.ByteString\n\n-- returns: \"\\159\\DEL*\\150\\222/\\129vr\\205\\241=mA\\192\\184\"\n</code></pre>\n\n<p>You can also use <code>readMaybe</code> instead for safer parsing.</p>\n"}], "owner": {"reputation": 120, "user_id": 6110448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933bdac19cecdbb41785ea4e2293cf87?s=128&d=identicon&r=PG&f=1", "display_name": "auermich", "link": "https://stackoverflow.com/users/6110448/auermich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 37764574, "answer_count": 2, "score": 2, "last_activity_date": 1465653452, "creation_date": 1465646497, "last_edit_date": 1465650742, "question_id": 37763466, "link": "https://stackoverflow.com/questions/37763466/replace-double-backslash-with-single-backslash-in-haskell", "title": "replace double backslash with single backslash in haskell", "body": "<p>I want to replace \"\\\\\" from a bytestring sequence (Data.ByteString)\nwith \"\\\", but due to the internal escaping of \"\\\" it won't work.\nConsider following example:</p>\n\n<p>The original bytestring: </p>\n\n<pre><code>\"\\159\\DEL*\\150\\222/\\129vr\\205\\241=mA\\192\\184\"\n</code></pre>\n\n<p>After storing in and re-reading from a database I obtain following \nbytestring:</p>\n\n<pre><code> \"\\\"\\\\159\\\\DEL*\\\\150\\\\222/\\\\129vr\\\\205\\\\241=mA\\\\192\\\\184\\\"\"\n</code></pre>\n\n<p>Imagine that the bytestring is used as a cryptographic key, which\nis now a wrong key due to the invalid characters in the sequence.\nThis problem actually arises from the wrong database representation \n(varchar instead of bytea) because it's otherwise considered as an invalid utf-8 sequence.\nI have tried to replace the invalid characters using some sort of \nsplit-modify-concat approach, but all I get is something without\nany backslash inside the sequence, because I can't insert a single backslash\ninto a bytestring.</p>\n\n<p>I really ask for your help.</p>\n"}, {"tags": ["postgresql", "haskell", "template-haskell", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1465720025, "post_id": 37771864, "comment_id": 63012439, "body": "Hi @Martin Vik!  You mean build module separately from whole library?"}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1467116488, "post_id": 37771864, "comment_id": 63588698, "body": "Yes, your approach works if I avoid <code>postgresql-simple</code> dependency for client side code."}], "tags": [], "owner": {"reputation": 126, "user_id": 2327695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776dc31ae6aef6cb38bd4864a08c9ab0?s=128&d=identicon&r=PG", "display_name": "Martin Vlk", "link": "https://stackoverflow.com/users/2327695/martin-vlk"}, "is_accepted": true, "score": 2, "last_activity_date": 1465732626, "last_edit_date": 1465732626, "creation_date": 1465717437, "answer_id": 37771864, "question_id": 37763452, "link": "https://stackoverflow.com/questions/37763452/is-it-possible-ghcjs-to-reuse-code-generated-by-template-haskell/37771864#37771864", "title": "Is it possible GHCJS to reuse code generated by Template Haskell", "body": "<p>EDIT: You can't directly reuse code generated in a ghc build, but you can simply use the module containing your Persistent database model in your ghcjs code. This will generate and build the database stuff with GHCJS and it is then available to your GHCJS code.</p>\n"}], "owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 37771864, "answer_count": 1, "score": 2, "last_activity_date": 1465913477, "creation_date": 1465646377, "last_edit_date": 1465913477, "question_id": 37763452, "link": "https://stackoverflow.com/questions/37763452/is-it-possible-ghcjs-to-reuse-code-generated-by-template-haskell", "title": "Is it possible GHCJS to reuse code generated by Template Haskell", "body": "<p>At this moment GHCJS fails to compile <code>postgresql-simple</code> package (see [<a href=\"https://github.com/ghcjs/ghcjs/issues/267\" rel=\"nofollow\">1</a>]).  I want to use <code>persistent</code> package to generate DB models.  I wonder is it possible to compile models with GHC itself and re-use code generated by Template Haskell in GHCJS sources?</p>\n\n<hr>\n\n<p>I have a workaround for my issue already, but the question is still relevant however.  I'll leave it open for few days and if no one will answer how to use code generated with Template Haskell I'll close it.  I've pasted resulting code at the bottom.</p>\n\n<p><strong>UPDATE</strong>:<br>\n<strong>thomie</strong> suggested me <code>-dth-dec-file</code> flag, which could be written as language pragma in models file, e.g. <code>{-# OPTIONS_GHC -dth-dec-file #-}</code>.  Then after running <code>stack build</code> command there is a file <code>Model.th.hs</code> under <code>.stack-work/dist/&lt;arch&gt;/&lt;cabal-version&gt;/build/src</code> folder.  This file looks like valid Haskell, however GHC rejects it because of parse error (see code at the bottom).  However, I've found a way to compile model with GHCJS.  I've added condition in cabal file to remove <code>postgresql-simple</code> from dependencies:</p>\n\n<pre><code>-- project.cabal\nlibrary\n  -- ...\n  if impl(ghcjs)\n    build-depends:       persistent\n                       , persistent-template\n  else\n    build-depends:       persistent\n                       , persistent-postgresql\n                       , persistent-template\n                       , postgresql-simple\n</code></pre>\n\n<p>Code generated by Template Haskell (to test this code I copied this file in project source folder and added module declaration at top)</p>\n\n<pre><code>-- src/Model.hs:(16,1)-(17,54): Splicing declarations\ninstance Database.Persist.Class.PersistField.PersistField Manufacturer where\n  Database.Persist.Class.PersistField.toPersistValue\n    = \\ ent_a9ov\n        -&gt; (Database.Persist.Types.Base.PersistMap\n            GHC.Base.$\n              (GHC.List.zip\n                 (GHC.Base.map Data.Text.pack [\"name\"])\n                 ((GHC.Base.map Database.Persist.Class.PersistField.toPersistValue)\n                  GHC.Base.$\n                    (Database.Persist.Class.PersistEntity.toPersistFields ent_a9ov))))\n  Database.Persist.Class.PersistField.fromPersistValue\n    = ((\\ x_a9ow\n          -&gt; let columns_a9ox = Data.HashMap.Strict.fromList x_a9ow\n             in\n               (Database.Persist.Class.PersistEntity.fromPersistValues\n                GHC.Base.$\n                  ((GHC.Base.map\n                      (\\ name_a9oy\n                         -&gt; case\n                                Data.HashMap.Base.lookup (Data.Text.pack name_a9oy) columns_a9ox\n                            of {\n                              GHC.Base.Just v_a9oz -&gt; v_a9oz\n                              GHC.Base.Nothing -&gt; Database.Persist.Types.Base.PersistNull }))\n                   GHC.Base.$ [\"name\"])))\n       Control.Monad.&lt;=&lt;\n         Database.Persist.Class.PersistField.getPersistMap)\ninstance Database.Persist.Sql.Class.PersistFieldSql Manufacturer where\n  Database.Persist.Sql.Class.sqlType _\n    = Database.Persist.Types.Base.SqlString\ndata Manufacturer\n  = Manufacturer {manufacturerName :: !Text}\n  deriving (Show, Read, Typeable)\ntype ManufacturerId =\n    Database.Persist.Class.PersistEntity.Key Manufacturer\ninstance Database.Persist.Class.PersistEntity.PersistEntity Manufacturer where\n  type Database.Persist.Class.PersistEntity.PersistEntityBackend Manufacturer = Database.Persist.Sql.Types.SqlBackend\n  data Database.Persist.Class.PersistEntity.Unique Manufacturer\n    = UniqueManufacturer Text\n  newtype Database.Persist.Class.PersistEntity.Key Manufacturer\n    = ManufacturerKey {unManufacturerKey :: Database.Persist.Class.PersistStore.BackendKey Database.Persist.Sql.Types.SqlBackend}\n    deriving (GHC.Show.Show,\n              GHC.Read.Read,\n              GHC.Classes.Eq,\n              GHC.Classes.Ord,\n              Web.PathPieces.PathPiece,\n              Web.HttpApiData.Internal.ToHttpApiData,\n              Web.HttpApiData.Internal.FromHttpApiData,\n              Database.Persist.Class.PersistField.PersistField,\n              Database.Persist.Sql.Class.PersistFieldSql,\n              Data.Aeson.Types.Class.ToJSON,\n              Data.Aeson.Types.Class.FromJSON)\n  data Database.Persist.Class.PersistEntity.EntityField Manufacturer typ\n    = typ ~ Database.Persist.Class.PersistEntity.Key Manufacturer =&gt;\n      ManufacturerId |\n      typ ~ Text =&gt; ManufacturerName\n  Database.Persist.Class.PersistEntity.keyToValues\n    = ((GHC.Types.: [])\n       GHC.Base..\n         (Database.Persist.Class.PersistField.toPersistValue\n          GHC.Base.. unManufacturerKey))\n  Database.Persist.Class.PersistEntity.keyFromValues\n    = ((GHC.Base.fmap ManufacturerKey)\n       GHC.Base..\n         (Database.Persist.Class.PersistField.fromPersistValue\n          GHC.Base.. Database.Persist.TH.headNote))\n  Database.Persist.Class.PersistEntity.entityDef _\n    = Database.Persist.Types.Base.EntityDef\n        (Database.Persist.Types.Base.HaskellName\n           (Database.Persist.TH.packPTH \"Manufacturer\"))\n        (Database.Persist.Types.Base.DBName\n           (Database.Persist.TH.packPTH \"manufacturer\"))\n        (Database.Persist.Types.Base.FieldDef\n           (Database.Persist.Types.Base.HaskellName\n              (Database.Persist.TH.packPTH \"Id\"))\n           (Database.Persist.Types.Base.DBName\n              (Database.Persist.TH.packPTH \"id\"))\n           (Database.Persist.Types.Base.FTTypeCon\n              GHC.Base.Nothing (Database.Persist.TH.packPTH \"ManufacturerId\"))\n           Database.Persist.Types.Base.SqlInt64\n           []\n           GHC.Types.True\n           (Database.Persist.Types.Base.ForeignRef\n              (Database.Persist.Types.Base.HaskellName\n                 (Database.Persist.TH.packPTH \"Manufacturer\"))\n              (Database.Persist.Types.Base.FTTypeCon\n                 (GHC.Base.Just (Database.Persist.TH.packPTH \"Data.Int\"))\n                 (Database.Persist.TH.packPTH \"Int64\"))))\n        [Database.Persist.TH.packPTH \"json\"]\n        [Database.Persist.Types.Base.FieldDef\n           (Database.Persist.Types.Base.HaskellName\n              (Database.Persist.TH.packPTH \"name\"))\n           (Database.Persist.Types.Base.DBName\n              (Database.Persist.TH.packPTH \"name\"))\n           (Database.Persist.Types.Base.FTTypeCon\n              GHC.Base.Nothing (Database.Persist.TH.packPTH \"Text\"))\n           Database.Persist.Types.Base.SqlString\n           []\n           GHC.Types.True\n           Database.Persist.Types.Base.NoReference]\n        [Database.Persist.Types.Base.UniqueDef\n           (Database.Persist.Types.Base.HaskellName\n              (Database.Persist.TH.packPTH \"UniqueManufacturer\"))\n           (Database.Persist.Types.Base.DBName\n              (Database.Persist.TH.packPTH \"unique_manufacturer\"))\n           [(Database.Persist.Types.Base.HaskellName\n               (Database.Persist.TH.packPTH \"name\"), \n             Database.Persist.Types.Base.DBName\n               (Database.Persist.TH.packPTH \"name\"))]\n           []]\n        []\n        [Database.Persist.TH.packPTH \"Show\",\n         Database.Persist.TH.packPTH \"Read\",\n         Database.Persist.TH.packPTH \"Typeable\"]\n        (Data.Map.Base.fromList [])\n        GHC.Types.False\n  Database.Persist.Class.PersistEntity.toPersistFields\n    (Manufacturer x_a9oA)\n    = [Database.Persist.Class.PersistField.SomePersistField x_a9oA]\n  Database.Persist.Class.PersistEntity.fromPersistValues [x1_a9oC]\n    = Manufacturer\n      Data.Functor.&lt;$&gt;\n        ((Database.Persist.TH.mapLeft\n            (Database.Persist.TH.fieldError\n               (Database.Persist.TH.packPTH \"name\")))\n         GHC.Base.. Database.Persist.Class.PersistField.fromPersistValue)\n          x1_a9oC\n  Database.Persist.Class.PersistEntity.fromPersistValues x_a9oB\n    = (Data.Either.Left\n       GHC.Base.$\n         (GHC.Base.mappend\n            (Database.Persist.TH.packPTH\n               \"Manufacturer: fromPersistValues failed on: \")\n            (Data.Text.pack GHC.Base.$ (GHC.Show.show x_a9oB))))\n  Database.Persist.Class.PersistEntity.persistUniqueToFieldNames\n    (UniqueManufacturer {})\n    = [(Database.Persist.Types.Base.HaskellName\n          (Database.Persist.TH.packPTH \"name\"), \n        Database.Persist.Types.Base.DBName\n          (Database.Persist.TH.packPTH \"name\"))]\n  Database.Persist.Class.PersistEntity.persistUniqueToValues\n    (UniqueManufacturer x_a9oD)\n    = [Database.Persist.Class.PersistField.toPersistValue x_a9oD]\n  Database.Persist.Class.PersistEntity.persistUniqueKeys\n    (Manufacturer _name_a9oE)\n    = [UniqueManufacturer _name_a9oE]\n  Database.Persist.Class.PersistEntity.persistFieldDef ManufacturerId\n    = Database.Persist.Types.Base.FieldDef\n        (Database.Persist.Types.Base.HaskellName\n           (Database.Persist.TH.packPTH \"Id\"))\n        (Database.Persist.Types.Base.DBName\n           (Database.Persist.TH.packPTH \"id\"))\n        (Database.Persist.Types.Base.FTTypeCon\n           GHC.Base.Nothing (Database.Persist.TH.packPTH \"ManufacturerId\"))\n        Database.Persist.Types.Base.SqlInt64\n        []\n        GHC.Types.True\n        (Database.Persist.Types.Base.ForeignRef\n           (Database.Persist.Types.Base.HaskellName\n              (Database.Persist.TH.packPTH \"Manufacturer\"))\n           (Database.Persist.Types.Base.FTTypeCon\n              (GHC.Base.Just (Database.Persist.TH.packPTH \"Data.Int\"))\n              (Database.Persist.TH.packPTH \"Int64\")))\n  Database.Persist.Class.PersistEntity.persistFieldDef\n    ManufacturerName\n    = Database.Persist.Types.Base.FieldDef\n        (Database.Persist.Types.Base.HaskellName\n           (Database.Persist.TH.packPTH \"name\"))\n        (Database.Persist.Types.Base.DBName\n           (Database.Persist.TH.packPTH \"name\"))\n        (Database.Persist.Types.Base.FTTypeCon\n           GHC.Base.Nothing (Database.Persist.TH.packPTH \"Text\"))\n        Database.Persist.Types.Base.SqlString\n        []\n        GHC.Types.True\n        Database.Persist.Types.Base.NoReference\n  Database.Persist.Class.PersistEntity.persistIdField\n    = ManufacturerId\n  Database.Persist.Class.PersistEntity.fieldLens ManufacturerId\n    = Database.Persist.TH.lensPTH\n        Database.Persist.Class.PersistEntity.entityKey\n        (\\ (Database.Persist.Class.PersistEntity.Entity _ value_a9oF)\n           key_a9oG\n           -&gt; Database.Persist.Class.PersistEntity.Entity key_a9oG value_a9oF)\n  Database.Persist.Class.PersistEntity.fieldLens ManufacturerName\n    = Database.Persist.TH.lensPTH\n        (manufacturerName\n         GHC.Base.. Database.Persist.Class.PersistEntity.entityVal)\n        (\\ (Database.Persist.Class.PersistEntity.Entity key_a9oH\n                                                        value_a9oI)\n           x_a9oJ\n           -&gt; Database.Persist.Class.PersistEntity.Entity\n                key_a9oH (value_a9oI {manufacturerName = x_a9oJ}))\ninstance Database.Persist.Class.PersistStore.ToBackendKey Database.Persist.Sql.Types.SqlBackend Manufacturer where\n  Database.Persist.Class.PersistStore.toBackendKey\n    = unManufacturerKey\n  Database.Persist.Class.PersistStore.fromBackendKey\n    = ManufacturerKey\ninstance Data.Aeson.Types.Class.ToJSON Manufacturer where\n  Data.Aeson.Types.Class.toJSON (Manufacturer name_a9oL)\n    = Data.Aeson.Types.Internal.object\n        [((Data.Text.pack \"name\") Data.Aeson.Types.Instances..= name_a9oL)]\ninstance Data.Aeson.Types.Class.FromJSON Manufacturer where\n  Data.Aeson.Types.Class.parseJSON\n    (Data.Aeson.Types.Internal.Object obj_a9oK)\n    = ((GHC.Base.pure Manufacturer)\n       GHC.Base.&lt;*&gt;\n         (obj_a9oK Data.Aeson.Types.Instances..: (Data.Text.pack \"name\")))\n  Data.Aeson.Types.Class.parseJSON _ = GHC.Base.mzero\ninstance Data.Aeson.Types.Class.ToJSON (Database.Persist.Class.PersistEntity.Entity Manufacturer) where\n  Data.Aeson.Types.Class.toJSON\n    = Database.Persist.Class.PersistEntity.entityIdToJSON\ninstance Data.Aeson.Types.Class.FromJSON (Database.Persist.Class.PersistEntity.Entity Manufacturer) where\n  Data.Aeson.Types.Class.parseJSON\n    = Database.Persist.Class.PersistEntity.entityIdFromJSON\nmigrateAll :: Database.Persist.Sql.Types.Migration\nmigrateAll\n  = do { let defs_a9oM\n               = [Database.Persist.Types.Base.EntityDef\n                    (Database.Persist.Types.Base.HaskellName\n                       (Database.Persist.TH.packPTH \"Manufacturer\"))\n                    (Database.Persist.Types.Base.DBName\n                       (Database.Persist.TH.packPTH \"manufacturer\"))\n                    (Database.Persist.Types.Base.FieldDef\n                       (Database.Persist.Types.Base.HaskellName\n                          (Database.Persist.TH.packPTH \"Id\"))\n                       (Database.Persist.Types.Base.DBName\n                          (Database.Persist.TH.packPTH \"id\"))\n                       (Database.Persist.Types.Base.FTTypeCon\n                          GHC.Base.Nothing (Database.Persist.TH.packPTH \"ManufacturerId\"))\n                       Database.Persist.Types.Base.SqlInt64\n                       []\n                       GHC.Types.True\n                       (Database.Persist.Types.Base.ForeignRef\n                          (Database.Persist.Types.Base.HaskellName\n                             (Database.Persist.TH.packPTH \"Manufacturer\"))\n                          (Database.Persist.Types.Base.FTTypeCon\n                             (GHC.Base.Just (Database.Persist.TH.packPTH \"Data.Int\"))\n                             (Database.Persist.TH.packPTH \"Int64\"))))\n                    [Database.Persist.TH.packPTH \"json\"]\n                    [Database.Persist.Types.Base.FieldDef\n                       (Database.Persist.Types.Base.HaskellName\n                          (Database.Persist.TH.packPTH \"name\"))\n                       (Database.Persist.Types.Base.DBName\n                          (Database.Persist.TH.packPTH \"name\"))\n                       (Database.Persist.Types.Base.FTTypeCon\n                          GHC.Base.Nothing (Database.Persist.TH.packPTH \"Text\"))\n                       Database.Persist.Types.Base.SqlString\n                       []\n                       GHC.Types.True\n                       Database.Persist.Types.Base.NoReference]\n                    [Database.Persist.Types.Base.UniqueDef\n                       (Database.Persist.Types.Base.HaskellName\n                          (Database.Persist.TH.packPTH \"UniqueManufacturer\"))\n                       (Database.Persist.Types.Base.DBName\n                          (Database.Persist.TH.packPTH \"unique_manufacturer\"))\n                       [(Database.Persist.Types.Base.HaskellName\n                           (Database.Persist.TH.packPTH \"name\"), \n                         Database.Persist.Types.Base.DBName\n                           (Database.Persist.TH.packPTH \"name\"))]\n                       []]\n                    []\n                    [Database.Persist.TH.packPTH \"Show\",\n                     Database.Persist.TH.packPTH \"Read\",\n                     Database.Persist.TH.packPTH \"Typeable\"]\n                    (Data.Map.Base.fromList [])\n                    GHC.Types.False];\n         Database.Persist.Sql.Migration.migrate\n           defs_a9oM\n           (Database.Persist.Types.Base.EntityDef\n              (Database.Persist.Types.Base.HaskellName\n                 (Database.Persist.TH.packPTH \"Manufacturer\"))\n              (Database.Persist.Types.Base.DBName\n                 (Database.Persist.TH.packPTH \"manufacturer\"))\n              (Database.Persist.Types.Base.FieldDef\n                 (Database.Persist.Types.Base.HaskellName\n                    (Database.Persist.TH.packPTH \"Id\"))\n                 (Database.Persist.Types.Base.DBName\n                    (Database.Persist.TH.packPTH \"id\"))\n                 (Database.Persist.Types.Base.FTTypeCon\n                    GHC.Base.Nothing (Database.Persist.TH.packPTH \"ManufacturerId\"))\n                 Database.Persist.Types.Base.SqlInt64\n                 []\n                 GHC.Types.True\n                 (Database.Persist.Types.Base.ForeignRef\n                    (Database.Persist.Types.Base.HaskellName\n                       (Database.Persist.TH.packPTH \"Manufacturer\"))\n                    (Database.Persist.Types.Base.FTTypeCon\n                       (GHC.Base.Just (Database.Persist.TH.packPTH \"Data.Int\"))\n                       (Database.Persist.TH.packPTH \"Int64\"))))\n              [Database.Persist.TH.packPTH \"json\"]\n              [Database.Persist.Types.Base.FieldDef\n                 (Database.Persist.Types.Base.HaskellName\n                    (Database.Persist.TH.packPTH \"name\"))\n                 (Database.Persist.Types.Base.DBName\n                    (Database.Persist.TH.packPTH \"name\"))\n                 (Database.Persist.Types.Base.FTTypeCon\n                    GHC.Base.Nothing (Database.Persist.TH.packPTH \"Text\"))\n                 Database.Persist.Types.Base.SqlString\n                 []\n                 GHC.Types.True\n                 Database.Persist.Types.Base.NoReference]\n              [Database.Persist.Types.Base.UniqueDef\n                 (Database.Persist.Types.Base.HaskellName\n                    (Database.Persist.TH.packPTH \"UniqueManufacturer\"))\n                 (Database.Persist.Types.Base.DBName\n                    (Database.Persist.TH.packPTH \"unique_manufacturer\"))\n                 [(Database.Persist.Types.Base.HaskellName\n                     (Database.Persist.TH.packPTH \"name\"), \n                   Database.Persist.Types.Base.DBName\n                     (Database.Persist.TH.packPTH \"name\"))]\n                 []]\n              []\n              [Database.Persist.TH.packPTH \"Show\",\n               Database.Persist.TH.packPTH \"Read\",\n               Database.Persist.TH.packPTH \"Typeable\"]\n              (Data.Map.Base.fromList [])\n              GHC.Types.False) }\n</code></pre>\n\n<p>Error message reported parse error at <code>-&gt;</code> on line starting with <code>GHC.Base.Nothing -&gt;</code></p>\n\n<pre><code>(\\ name_a9oy\n     -&gt; case\n            Data.HashMap.Base.lookup (Data.Text.pack name_a9oy) columns_a9ox\n        of {\n          GHC.Base.Just v_a9oz -&gt; v_a9oz\n          GHC.Base.Nothing -&gt; Database.Persist.Types.Base.PersistNull }))\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1465650835, "post_id": 37761433, "comment_id": 62996927, "body": "No need to bind a value to <code>a</code> if you aren&#39;t going to use it; <code>main = runMaybeT askPassphrase &gt;&gt; return ()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465663206, "post_id": 37762803, "comment_id": 63000921, "body": "Can you give <code>type</code> of  last example of <code>askPassphrase</code> ? Apologies for same name of functions for both versions.. i have not renamed them as <code>1</code> and <code>2</code>&#39;s. Can you also change your answer with respect to that ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465663764, "post_id": 37762803, "comment_id": 63001109, "body": "Done - and I fixed a typo in the last code example."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465663785, "post_id": 37762803, "comment_id": 63001115, "body": "Also - pehaps this SO answer would help: <a href=\"http://stackoverflow.com/a/32582127/866915\">stackoverflow.com/a/32582127/866915</a>"}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465664352, "post_id": 37762803, "comment_id": 63001310, "body": "your <code>askPassphrase2</code> gives me compiler errors.. What is its <code>type</code> ? <code>lift</code> and <code>runMaybeT</code> is lifting <code>IO</code> further to  <code>t0 IO</code>"}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465667275, "post_id": 37762803, "comment_id": 63002072, "body": "sorry still not compiles for me.. every line should be in same monad.. i guess line 3,4 <code>MaybeT IO ()</code> .. line 1 <code>MaybeT IO (Maybe String)</code>.. if you remove all <code>lift</code>s then it will compile but no <code>MabeT</code> usage would be their."}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465667466, "post_id": 37762803, "comment_id": 63002124, "body": "and i think we can not get it with <code>MaybeT ...</code> type for askPassphrase2 as <code>MaybeT</code> would not let us have failure condition. so may be we should remove all <code>lift</code>s"}, {"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1465669787, "post_id": 37762803, "comment_id": 63002865, "body": "sorry.. my bad.. i had not put <code>askPassphrase2 :: MaybeT IO ()</code> type above the function and it was giving errors.. Thanks."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1465665336, "last_edit_date": 1465665336, "creation_date": 1465641959, "answer_id": 37762803, "question_id": 37761433, "link": "https://stackoverflow.com/questions/37761433/understanding-monadtransformer-examples/37762803#37762803", "title": "understanding MonadTransformer examples", "body": "<p><code>guard</code> is the not what you want in the MaybeT approach. To check for an invalid password <em>and</em> be able to provide your own processing in that case you would just use your original version of <code>getPassphase</code> and <em>lift</em> it into the the <code>MaybeT IO</code> monad:</p>\n\n<pre><code>getPassphease2 = do result &lt;- lift $ getPassphrase1\n                    case result of\n                        Nothing -&gt; lift $ putStrLn \"bad password\"\n                        Just pw -&gt; lift $ putStrLn \"your password is: \" ++ pw\n</code></pre>\n\n<p>Explanation...</p>\n\n<p>The <code>MaybeT IO</code> monad is for giving IO-actions the capability to fail <em>and</em> having that failure automatically handled by the monad. If any step fails, control goes all the way back to the <code>runMaybeT</code> and <code>runMaybeT</code> returns <code>Nothing</code>. It's like throwing an exception.</p>\n\n<p>The point of using <code>MaybeT</code> is that you do no have to explicitly check to see if a step has failed - that checking is performed by the <code>MaybeT</code> monad after each step is called. That means you can write code assuming that each preceding step has succeeded - i.e. as if you were on the \"happy path\". This also means that you can't do something different if the previous step failed.</p>\n\n<p>One possibility using the <code>MaybeT</code> version of <code>getPassphrase</code> is this:</p>\n\n<pre><code>main = do result &lt;- runMaybeT askPassphrase2\n          case result of\n            Just _  -&gt; return ()\n            Nothing  -&gt; putStrLn \"Some failure happened... perhaps wrong password?\"\n</code></pre>\n\n<p>The problem is that if <code>runMaybeT</code> returns <code>Nothing</code> it could mean that any step in <code>askPassphrase</code> failed, not just the <code>guard</code>.              </p>\n\n<p>Another way to use your MaybeT version of <code>getPassphrase</code> is to have <code>askPassphrase</code> run it with <code>runMaybeT</code>:</p>\n\n<pre><code>askPassphrase2 = do result &lt;- lift $ runMaybeT getPassphrase2\n                    case result of\n                      Nothing -&gt; lift $ putStrLn \"bad password\"\n                      Just pw -&gt; lift $ putStrLn $ \"Your password is \" ++ pw\n</code></pre>\n\n<p>Here we're using <code>runMaybeT</code> like a try-catch block.</p>\n"}], "owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 37762803, "answer_count": 1, "score": 0, "last_activity_date": 1465665336, "creation_date": 1465632422, "last_edit_date": 1465662872, "question_id": 37761433, "link": "https://stackoverflow.com/questions/37761433/understanding-monadtransformer-examples", "title": "understanding MonadTransformer examples", "body": "<p>I am going through the tutorial at <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/Monad_transformers</a></p>\n\n<p>I wrote following piece of codes. One without and other with <code>MonadTransformer</code> instance :</p>\n\n<pre><code>-- Simple Get Password functions. \ngetPassphrase1 :: IO (Maybe String)\ngetPassphrase1 = do\n  password &lt;- getLine\n  if isValid password\n  then return $ Just password\n  else return Nothing\n\n\naskPassphrase1 :: IO ()\naskPassphrase1 = do\n  putStrLn \"Enter password &lt; 8 , alpha, number and punctuation:\"\n  p &lt;- getPassphrase1\n  case p of\n    Nothing -&gt; do          -- Q1. ### How to implement this with `MonadTrans` ?\n      putStrLn \"Invalid password. Enter again:\"\n      askPassphrase1\n    Just password -&gt;\n      putStrLn $ \"Your password is \" ++ password\n\n-- The validation test could be anything we want it to be.\nisValid :: String -&gt; Bool\nisValid s = length s &gt;= 8\n            &amp;&amp; any isAlpha s\n            &amp;&amp; any isNumber s\n            &amp;&amp; any isPunctuation s\n</code></pre>\n\n<p>Another using <code>MonadT</code> which i wrote myself.</p>\n\n<pre><code>getPassphrase2 :: MaybeT IO String\ngetPassphrase2 = do\n  password &lt;- lift getLine\n  guard $ isValid password\n  return password\n\naskPassphrase2 :: MaybeT IO ()\naskPassphrase2 = do\n  lift $ putStrLn \"Enter password &lt; 8 , alpha, number and punctuation:\"\n  p &lt;- getPassphrase2\n  -- Q1. How to print \"Invalid password\" ?\n  lift $ putStrLn $ \"Your password is \" ++ p\n\n-- The validation test could be anything we want it to be.\nisValid :: String -&gt; Bool\nisValid s = length s &gt;= 8\n            &amp;&amp; any isAlpha s\n            &amp;&amp; any isNumber s\n            &amp;&amp; any isPunctuation s\n\nmain :: IO ()\nmain = do\n  a &lt;- runMaybeT askPassphrase2\n  return ()\n</code></pre>\n\n<p>Both works.</p>\n\n<p>But i am unable to understand how to add <code>wrong password</code> support in <code>MonadTrans</code> example. ?</p>\n\n<p>Also, is <code>main</code> method ok.. or it can be written in a better way ?</p>\n"}, {"tags": ["haskell", "type-inference"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1465635696, "last_edit_date": 1465635696, "creation_date": 1465635386, "answer_id": 37761861, "question_id": 37761425, "link": "https://stackoverflow.com/questions/37761425/typeclass-instance-turned-int-into-num-a/37761861#37761861", "title": "Typeclass instance turned Int into Num a?", "body": "<p>Type classes are <em>open</em>: later on, possibly in another module, you could define another instance. The compiler can't rely on you not doing that, so it can not commit to the instances you have defined so far.</p>\n\n<p>You could try this for your function instance, instead:</p>\n\n<pre><code>instance (Indexable r, a ~ Int) =&gt; Indexable (a -&gt; r) where\n  idx xs = \\x -&gt; idx (x:xs)\n</code></pre>\n\n<p>Unlike the instance for <code>Int -&gt; r</code>, this instance covers the whole function space <code>a -&gt; r</code>, but requires that <code>a ~ Int</code>. This tells the compiler that there can not be any other instance of the form <code>Char -&gt; r</code> or similar later on, so the compiler is allowed to commit early to the function instance.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 37761861, "answer_count": 1, "score": 1, "last_activity_date": 1465635696, "creation_date": 1465632376, "question_id": 37761425, "link": "https://stackoverflow.com/questions/37761425/typeclass-instance-turned-int-into-num-a", "title": "Typeclass instance turned Int into Num a?", "body": "<p>I tried to create  a variadic function that returns a Repa shape:</p>\n\n<pre><code>class Indexable r where\n  idx :: [Int] -&gt; r\n\ninstance Indexable Int where\n  idx [x] = x\n\ninstance (Indexable b) =&gt; Indexable (Int :. b) where\n  idx (x:xx) = x :. (idx xx)\n\ninstance (Indexable a) =&gt; Indexable (Z :. a) where\n  idx xs = Z :. (idx xs)\n\ninstance (Indexable r) =&gt; Indexable (Int -&gt; r) where\n  idx xs = \\x -&gt; idx (x:xs)\n</code></pre>\n\n<p>It works:</p>\n\n<pre><code>&gt; fromListUnboxed (idx [] (3 :: Int)) [1..3] :: Array U DIM1 Int\nAUnboxed (Z :. 3) [1,2,3]\n</code></pre>\n\n<p>but I have to explicitly use <code>3 :: Int</code> instead of just <code>3</code>, despite my instances explicitly using <code>Int</code>. The following then confused me:</p>\n\n<pre><code>&gt; :t idx [] 3\nidx [] 3 :: (Num a, Indexable (a -&gt; t)) =&gt; t\n</code></pre>\n\n<p>I thought the type signatures in the instances would force the number to be an <code>Int</code>, but it turned into a <code>Num a</code>. Why? And how do I get the compiler to recognize that all the numbers are going to be <code>Int</code>s?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1465632388, "post_id": 37761208, "comment_id": 62991584, "body": "What does it mean &quot;getting those <code>(x, y)</code> indices given a single index?&quot;? Do you want a function like <code>getPair :: Int -&gt; (Int, Int)</code> that given a number <code>i</code> returns the <code>i</code>th pair where the pair are ordered in a certain way? Or what?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465634922, "post_id": 37761208, "comment_id": 62992209, "body": "@Bakuriu Both of the answer have the gist of it. You did get my question right."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465635706, "post_id": 37761461, "comment_id": 62992428, "body": "This is a pretty ingenious way of doing it. And actually, now that I look at it for larger loops, it is half sorted so the cache locality would only be a problem for a single warp. Does there exist a similar algorithm for 3D and more?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465642466, "post_id": 37761461, "comment_id": 62994433, "body": "@MarkoGrdinic I guess it can be made to work for dimension &gt; 2, but the details are fiddly enough to put me off doing the work to figure it out. I&#39;ve added an arbitrary dimensional alternative solution to the answer."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465648943, "post_id": 37761461, "comment_id": 62996307, "body": "I was thinking that something like in your later example would be possible, but it did not see how until you posted it even though I did something similar in the past. At any rate, the 2D case is the most common application of this by far, so it is all good. I accepted your answer before seeing the added algorithm for higher dimensions."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 4, "last_activity_date": 1465643332, "last_edit_date": 1465643332, "creation_date": 1465632609, "answer_id": 37761461, "question_id": 37761208, "link": "https://stackoverflow.com/questions/37761208/how-to-get-the-x-y-coordinates-given-a-index-when-x-y/37761461#37761461", "title": "How to get the (x,y) coordinates given a index when x &lt; y?", "body": "<p>You're asking for a bijection from [0, N(N+1)/2) to pairs (x, y) with 0 &lt;= x &lt; y &lt;= N.</p>\n\n<p>Here's one simple way to define it (in pseudocode, but should be trivial to convert to Haskell):</p>\n\n<pre><code>x0, y0 = i / (N + 1), i % (N + 1)\nif x0 &lt; y0 then result = (x0, y0)\nelse result = (N - 1 - x0, N - y0)\n</code></pre>\n\n<p>Here's a visualisation of the function for N=6. The map is laid out in a table with rows of length N+1=7, with the first row representing the value of the function for i=0 to 6, the next i=7 to 13 and so on. If you look very closely and carefully, you can see that things above the leading diagonal map to their own location in the table, and things on or below the diagonal map rotationally to the later entries.</p>\n\n<pre><code>5,6  0,1  0,2  0,3  0,4  0,5  0,6\n4,6  4,5  1,2  1,3  1,4  1,5  1,6\n3,6  3,5  3,4  2,3  2,4  2,5  2,6\n</code></pre>\n\n<p>And here's the opposite of this visualisation: a table <code>T</code> of size (N+1) by (N+1) with <code>T[x, y] = i</code> where <code>i</code> is mapped to (x, y) by the function above.</p>\n\n<pre><code> -   1   2   3   4   5   6\n -   -   9  10  11  12  13\n -   -   -  17  18  19  20\n -   -   -   -  16  15  14\n -   -   -   -   -   8   7\n -   -   -   -   -   -   0\n -   -   -   -   -   -   -\n</code></pre>\n\n<h2>Higher dimensions</h2>\n\n<p>This method can probably be made to work in higher dimensions, but I don't immediately see how. As an alternative, here's a simple but somewhat inefficient method that does work in arbitrary dimensions.</p>\n\n<p>First, note there's <code>choose(N + 1, k)</code> increasing sequences of length <code>k</code> from the numbers from <code>0</code> to <code>N</code> (where <code>choose(N, k)</code> is the <a href=\"https://en.wikipedia.org/wiki/Binomial_coefficient\" rel=\"nofollow\">binomial coefficient</a>). Of those, <code>choose(N, k - 1)</code> of them end with <code>N</code>. That gives this recursive function that generates the sequences in descending colexicographical order (again in pseudocode):</p>\n\n<pre><code>sequence(N, k, index)\n    = []                                           if k == 0\n    = sequence(N - 1, k - 1, index) + [N]          if index &lt; choose(N, k - 1)\n    = sequence(N - 1, k, index - choose(N, k - 1)) otherwise\n</code></pre>\n\n<p>Here's, <code>sequence(5, 3, index)</code> for <code>index</code> between 0 and 19:</p>\n\n<pre><code> 0 -&gt; [3, 4, 5]\n 1 -&gt; [2, 4, 5]\n 2 -&gt; [1, 4, 5]\n 3 -&gt; [0, 4, 5]\n 4 -&gt; [2, 3, 5]\n 5 -&gt; [1, 3, 5]\n 6 -&gt; [0, 3, 5]\n 7 -&gt; [1, 2, 5]\n 8 -&gt; [0, 2, 5]\n 9 -&gt; [0, 1, 5]\n10 -&gt; [2, 3, 4]\n11 -&gt; [1, 3, 4]\n12 -&gt; [0, 3, 4]\n13 -&gt; [1, 2, 4]\n14 -&gt; [0, 2, 4]\n15 -&gt; [0, 1, 4]\n16 -&gt; [1, 2, 3]\n17 -&gt; [0, 2, 3]\n18 -&gt; [0, 1, 3]\n19 -&gt; [0, 1, 2]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465635255, "post_id": 37761535, "comment_id": 62992307, "body": "I had not expected that I could get the answer to this via the quadratic equation. Your answer has the benefit of being sorted and not requiring the upper bound. Being sorted in particular is good for cache locality. It would be perfect if not for that expensive <code>sqrt</code>. That having said, I think it needs to be elaborated more. I do not understand why solving the quadratic equation and then taking the floor of it gives the correct answer. Neither do I understand the <code>(nmin+1, i - (nmin*(nmin+1)) div 2)</code> part."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465638709, "post_id": 37761535, "comment_id": 62993254, "body": "I explained some more. \u2014 Pretty sure it would be possible to replace the square root with some faster approximation, but I&#39;m not sure about the stability."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465640727, "post_id": 37761535, "comment_id": 62993889, "body": "What sort of triangles are we talking about here? It is not clear to me what connection they have with this problem. Keep in mind, I am not a mathematician and neither are most of the programmers who will look at the question. Maybe you could post some references for this problem if it would be too long to explain on SO. Motivated by the replies, I took a look myself at the pairing functions articles on the net, but I could only find information for non-ordered pairs."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465642508, "post_id": 37761535, "comment_id": 62994443, "body": "Ok, it clicked for me. Having some pictures on that Wiki page helped. First you minimze the n via the quadratic equation which turns out to be x and then calculate y by substracting i from the remainder. Brilliant. I am going to accept Paul Hankin&#39;s answer as it would be more efficient in practice, but your answer did give a lot to think about. Thanks."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1465641209, "last_edit_date": 1465641209, "creation_date": 1465633090, "answer_id": 37761535, "question_id": 37761208, "link": "https://stackoverflow.com/questions/37761208/how-to-get-the-x-y-coordinates-given-a-index-when-x-y/37761535#37761535", "title": "How to get the (x,y) coordinates given a index when x &lt; y?", "body": "<p>We may equivalently consider <a href=\"https://en.wikipedia.org/wiki/Triangular_number\" rel=\"nofollow\"><code>[(x,y) | x&lt;-[0..n], y&lt;-[0..x-1]]</code></a>. This list has length</p>\n\n<p><em>&ell;</em><sub><em>n</em></sub> = <sub><em>x</em>=0</sub>&sum;<sup><em>n</em></sup> <em>x</em>\n<a href=\"http://mathworld.wolfram.com/ArithmeticSeries.html\" rel=\"nofollow\">= <sup><em>n</em>&middot;(<em>n</em>+1)</sup>/<sub>2</sub></a>.</p>\n\n<p>Hence we can get, to a given <em>&ell;</em>, the nearest lower <em>n</em> through</p>\n\n<p>2&middot;<em>&ell;</em><sub><em>n</em></sub> = <em>n</em>&middot;(<em>n</em>+1) = <em>n</em><sup>2</sup> + <em>n</em></p>\n\n<p><em>n</em><sub>~</sub> = -&frac12; &pm; &radic;(&frac14; + 2&middot;<em>&ell;<sub>n</sub></em>)</p>\n\n<p>In particular, for a given index <em>i</em>,</p>\n\n<p><em>n</em><sub><em>i</em>&minus;</sub> = &lfloor;-&frac12; &pm; &radic;(&frac14; + 2&middot;<em>i</em>)&rfloor;</p>\n\n<p>is the x-length of the last fully completed triangle. Thus, the index <em>i</em> lies in the row <em>n</em><sub><em>i</em>&minus;</sub>+1. That triangle had an area of</p>\n\n<p><em>&ell;</em><sub><em>n</em><sub><em>i</em>&minus;</sub></sub> = <sup><em>n</em><sub><em>i</em>&minus;</sub>&middot;(<em>n</em><sub><em>i</em>&minus;</sub>+1)</sup>/<sub>2</sub></p>\n\n<p>which we therefore need to subtract from <em>i</em> to get the remainder index (in y-direction). This gives rise to the definition</p>\n\n<pre><code>lowerTriangularTuple :: Int -&gt; (Int,Int)\nlowerTriangularTuple i = (nmin+1, i - (nmin*(nmin+1))`div`2)\n where nmin = floor $ -1/2 + sqrt(1/4 + 2 * fromIntegral i)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>GHCi&gt; lowerTriangularTuple &lt;$&gt; [0..30]\n[(1,0),(2,0),(2,1),(3,0),(3,1),(3,2),(4,0),(4,1),(4,2),(4,3),(5,0),(5,1),(5,2),(5,3),(5,4),(6,0),(6,1),(6,2),(6,3),(6,4),(6,5),(7,0),(7,1),(7,2),(7,3),(7,4),(7,5),(7,6),(8,0),(8,1),(8,2)]\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 37761461, "answer_count": 2, "score": 1, "last_activity_date": 1465643332, "creation_date": 1465630631, "question_id": 37761208, "link": "https://stackoverflow.com/questions/37761208/how-to-get-the-x-y-coordinates-given-a-index-when-x-y", "title": "How to get the (x,y) coordinates given a index when x &lt; y?", "body": "<p>In the past I've often used loops of the following kind (Haskell example):</p>\n\n<pre><code>  upperBoundToTuples :: Int -&gt; [(Int, Int)]\n  upperBoundToTuples n = [(x,y) | x &lt;- [0..n], y &lt;- [x+1..n]]\n</code></pre>\n\n<p>The above code produces tuples of range (0,1)..(n,n) where for all x &lt; y.</p>\n\n<p>I was wondering if it there was an efficient way of getting those (x,y) indices given a single index? Possible applications include optimization problems on the GPU where loops are not allowed and each thread only gets an index.</p>\n\n<p>Also if it is possible for the 2D case, could such an algorithm be generalized to multiple dimensions?</p>\n"}, {"tags": ["haskell", "stream", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 9, "last_activity_date": 1465896051, "last_edit_date": 1495540733, "creation_date": 1465896051, "answer_id": 37807878, "question_id": 37761078, "link": "https://stackoverflow.com/questions/37761078/are-applicative-transformers-really-superfluous/37807878#37807878", "title": "Are applicative transformers really superfluous?", "body": "<p>Great question! I believe there are two different parts of this question:</p>\n\n<ol>\n<li><strong>Composing</strong> existing applicatives or monads into more complex ones.</li>\n<li><strong>Constructing all</strong> applicatives/monads from some given starting set.</li>\n</ol>\n\n<p>Ad 1.: <strong>Monad transformers are essential for combining monads.</strong> Monads <a href=\"https://stackoverflow.com/q/13034229/1333025\">don't compose directly</a>. It seems that there needs to be an extra bit of information provided by monad transformers that tells how each monad can be composed with other monads (but it could be this information is already somehow present, see <a href=\"https://stackoverflow.com/q/24515876/1333025\">Is there a monad that doesn't have a corresponding monad transformer?</a>).</p>\n\n<p>On the other hand, <strong>applicatives compose directly</strong>, see <a href=\"https://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\">Data.Functor.Compose</a>. This is why don't need applicative transformers for composition. They're also closed under <a href=\"https://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Product.html\" rel=\"nofollow noreferrer\">product</a> (but not <a href=\"https://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Sum.html\" rel=\"nofollow noreferrer\">coproduct</a>).</p>\n\n<p>For example, having <a href=\"https://hackage.haskell.org/package/Stream-0.4.7.2/docs/Data-Stream.html\" rel=\"nofollow noreferrer\">infinite streams</a> <code>data Stream a = Cons a (Stream a)</code> and another applicative <code>g</code>, both <code>Stream (g a)</code> and <code>g (Stream a)</code> are applicatives.</p>\n\n<p>But even though <code>Stream</code> is also a monad (<code>join</code> takes the diagonal of a 2-dimensional stream), its composition with another monad <code>m</code> won't be, neither <code>Stream (m a)</code> nor <code>m (Stream a)</code> will always be a monad.</p>\n\n<p>Furthermore as we can see, they're both different from your <code>MStream g</code> (which is very close to <a href=\"https://wiki.haskell.org/ListT_done_right\" rel=\"nofollow noreferrer\"><code>ListT</code> done right</a>), therefore:</p>\n\n<p>Ad 2.: <strong>Can all applicatives be constructed from some given set of primitives?</strong> Apparently not. One problem is constructing sum data types: If <code>f</code> and <code>g</code> are applicatives, <code>Either (f a) (g a)</code> won't be, as we don't know how to compose <code>Right h &lt;*&gt; Left x</code>.</p>\n\n<p>Another construction primitive is taking a fixed point, as in your <code>MStream</code>  example. Here we might attempt to generalize the construction by defining something like</p>\n\n<pre><code>newtype Fix1 f a = Fix1 { unFix1 :: f (Fix1 f) a }\n\ninstance (Functor (f (Fix1 f))) =&gt; Functor (Fix1 f) where\n    fmap f (Fix1 a) = Fix1 (fmap f a)\n\ninstance (Applicative (f (Fix1 f))) =&gt; Applicative (Fix1 f) where\n    pure k = Fix1 (pure k)\n    (Fix1 f) &lt;*&gt; (Fix1 x) = Fix1 (f &lt;*&gt; x)\n</code></pre>\n\n<p>(which requires not-so-nice <code>UndecidableInstances</code>) and then</p>\n\n<pre><code>data MStream' f g a = MStream (f (a, g a))\n\ntype MStream f = Fix1 (MStream' f)\n</code></pre>\n"}], "owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 7, "accepted_answer_id": 37807878, "answer_count": 1, "score": 22, "last_activity_date": 1465896051, "creation_date": 1465629471, "last_edit_date": 1465665333, "question_id": 37761078, "link": "https://stackoverflow.com/questions/37761078/are-applicative-transformers-really-superfluous", "title": "Are applicative transformers really superfluous?", "body": "<p>There is a lot of talk about <code>Applicative</code> <em>not</em> needing its own transformer class, like this:</p>\n\n<pre><code>class AppTrans t where\n    liftA :: Applicative f =&gt; f a -&gt; t f a\n</code></pre>\n\n<p>But I can define applicative transformers that don't seem to be compositions of applicatives! For example <em>sideeffectful streams</em>:</p>\n\n<pre><code>data MStream f a = MStream (f (a, MStream f a))\n</code></pre>\n\n<p>Lifting just performs the side effect at every step:</p>\n\n<pre><code>instance AppTrans MStream where\n    liftA action = MStream $ (,) &lt;$&gt; action &lt;*&gt; pure (liftA action)\n</code></pre>\n\n<p>And if <code>f</code> is an applicative, then <code>MStream f</code> is as well:</p>\n\n<pre><code>instance Functor f =&gt; Functor (MStream f) where\n    fmap fun (MStream stream) = MStream $ (\\(a, as) -&gt; (fun a, fmap fun as)) &lt;$&gt; stream\n\ninstance Applicative f =&gt; Applicative (MStream f) where\n    pure = liftA . pure\n    MStream fstream &lt;*&gt; MStream astream = MStream\n        $ (\\(f, fs) (a, as) -&gt; (f a, fs &lt;*&gt; as)) &lt;$&gt; fstream &lt;*&gt; astream\n</code></pre>\n\n<p>I know that for any practical purposes, <code>f</code> should be a monad:</p>\n\n<pre><code>joinS :: Monad m =&gt; MStream m a -&gt; m [a]\njoinS (MStream stream) = do\n    (a, as) &lt;- stream\n    aslist &lt;- joinS as\n    return $ a : aslist\n</code></pre>\n\n<p>But while there is a <code>Monad</code> instance for <code>MStream m</code>, it's inefficient. (Or even incorrect?) The <code>Applicative</code> instance is actually useful!</p>\n\n<p>Now note that usual streams arise as special cases for the identity functor:</p>\n\n<pre><code>import Data.Functor.Identity\ntype Stream a = MStream Identity a\n</code></pre>\n\n<p>But the composition of <code>Stream</code> and <code>f</code> is not <code>MStream f</code>! Rather, <code>Compose Stream f a</code> is isomorphic to <code>Stream (f a)</code>.</p>\n\n<p><em>I'd like to know whether <code>MStream</code> is a composition of any two applicatives.</em></p>\n\n<p>Edit:</p>\n\n<p>I'd like to offer a category theoretic viewpoint. A transformer is a \"nice\" endofunctor <code>t</code> on the category <code>C</code> of applicative functors (i.e. lax monoidal functors with strength), together with a natural transformation <code>liftA</code> from the identity on <code>C</code> to <code>t</code>. The more general question is now what useful transformers exist that are not of the form \"compose with <code>g</code>\" (where <code>g</code> is an applicative). My claim is that <code>MStream</code> is one of them.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1465594020, "post_id": 37757307, "comment_id": 62984122, "body": "I <a href=\"https://en.wikipedia.org/w/index.php?title=Object_(category_theory)\" rel=\"nofollow noreferrer\">object</a> to calling this thing <a href=\"http://hackage.haskell.org/package/base/docs/Control-Category.html#t:Category\" rel=\"nofollow noreferrer\"><code>Category</code></a>."}, {"owner": {"reputation": 634, "user_id": 5093690, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a3c8f6b503d9ea35c843eda8d891479f?s=128&d=identicon&r=PG&f=1", "display_name": "qwe", "link": "https://stackoverflow.com/users/5093690/qwe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465594475, "post_id": 37757307, "comment_id": 62984277, "body": "Objection sustained. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1465602950, "post_id": 37757307, "comment_id": 62986616, "body": "Note also that <code>id</code> clashes with <code>Prelude.id</code> and also (categorically!) with <code>Control.Category.id</code>. I&#39;d go with something like <code>ident</code> if I were you."}, {"owner": {"reputation": 634, "user_id": 5093690, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a3c8f6b503d9ea35c843eda8d891479f?s=128&d=identicon&r=PG&f=1", "display_name": "qwe", "link": "https://stackoverflow.com/users/5093690/qwe"}, "edited": false, "score": 0, "creation_date": 1465829528, "post_id": 37757307, "comment_id": 63051826, "body": "Well, I&#39;m using Data.Aeson and it generates its parsers based on field names, so I&#39;m kind of obligated to use these identifiers. Of course, there&#39;s a good chance that Aeson provides me with a way to rename identifiers, but still that won&#39;t help me with my main question. :)"}], "owner": {"reputation": 634, "user_id": 5093690, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a3c8f6b503d9ea35c843eda8d891479f?s=128&d=identicon&r=PG&f=1", "display_name": "qwe", "link": "https://stackoverflow.com/users/5093690/qwe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1465595094, "creation_date": 1465593489, "last_edit_date": 1465595094, "question_id": 37757307, "link": "https://stackoverflow.com/questions/37757307/prefix-lenses-for-a-type", "title": "Prefix lenses for a type", "body": "<p>I have the following data declared:</p>\n\n<pre><code>data Something = Something\n  { self              :: String\n  , id                :: String\n  , description       :: Maybe String\n  , name              :: String\n  } deriving (Generic, Show)\n\ninstance FromJSON Something\n\nmakeLensesFor\n  [ (\"self\", \"somethingSelf\")\n  , (\"id\", \"somethingId\")\n  , (\"description\", \"somethingDescription\")\n  , (\"name\", \"somethingName\")\n  ]\n  ''Something\n</code></pre>\n\n<p>Is it possible to automate the lenses creation as the naming convention is following really simple rules.</p>\n\n<p>After a peek at the source code, I can see there's a LensRules instance, called abbreviatedFields, but, sadly, using it with <code>makeLensesWith abbreviatedFields ''Something</code> generates no lenses at all. Am I doing something wrong?</p>\n\n<p>Here's the source code: <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/src/Control.Lens.TH.html#abbreviatedFields\" rel=\"nofollow\">https://hackage.haskell.org/package/lens-4.14/docs/src/Control.Lens.TH.html#abbreviatedFields</a></p>\n"}, {"tags": ["haskell", "intellij-idea", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 7212399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wn6UV.jpg?s=128&g=1", "display_name": "Pratik Ambani", "link": "https://stackoverflow.com/users/7212399/pratik-ambani"}, "edited": false, "score": 0, "creation_date": 1489297572, "post_id": 37754956, "comment_id": 72605681, "body": "This might help you,  <a href=\"https://gist.github.com/androidfred/a2bef54310c847f263343c529d32acd8\" rel=\"nofollow noreferrer\">gist.github.com/androidfred/a2bef54310c847f263343c529d32acd8</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1006, "user_id": 3894977, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/TIRmd.jpg?s=128&g=1", "display_name": "mrek", "link": "https://stackoverflow.com/users/3894977/mrek"}, "is_accepted": false, "score": 5, "last_activity_date": 1519573628, "creation_date": 1519573628, "answer_id": 48975334, "question_id": 37754956, "link": "https://stackoverflow.com/questions/37754956/how-do-i-set-up-intellij-to-build-haskell-projects-with-stack/48975334#48975334", "title": "How do I set up IntelliJ to build Haskell projects with Stack?", "body": "<p>I suppose you have <a href=\"https://plugins.jetbrains.com/plugin/8258-intellij-haskell\" rel=\"noreferrer\">IntelliJ Haskell plugin</a> installed.</p>\n\n<ol>\n<li>Go to <em>Run -> Edit Configurations -> Haskell Stack -> Haskell Stack Runner</em>:</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/pgM8f.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/pgM8f.png\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"2\">\n<li>Set the name of the configuration. Executable file name should be added automatically. Then press OK.</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/snMpW.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/snMpW.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now, you should be able to build the project.</p>\n\n<p>Output:</p>\n\n<p><code>\n/usr/local/bin/stack build --exec test-project-exe\nIt works!\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 4588, "user_id": 4126843, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/4r8yp.png?s=128&g=1", "display_name": "PHPirate", "link": "https://stackoverflow.com/users/4126843/phpirate"}, "is_accepted": false, "score": 10, "last_activity_date": 1564933182, "last_edit_date": 1564933182, "creation_date": 1529842168, "answer_id": 51009817, "question_id": 37754956, "link": "https://stackoverflow.com/questions/37754956/how-do-i-set-up-intellij-to-build-haskell-projects-with-stack/51009817#51009817", "title": "How do I set up IntelliJ to build Haskell projects with Stack?", "body": "<p>If you want to hit the IntelliJ run button to run the project and use Stack, I think you should use the <a href=\"https://github.com/rikvdkleij/intellij-haskell\" rel=\"noreferrer\">IntelliJ Haskell Plugin</a> as @mrek said.\nThe <a href=\"https://github.com/carymrobbins/intellij-haskforce\" rel=\"noreferrer\">HaskForce plugin</a> says at the moment </p>\n\n<blockquote>\n  <p>Note: Run configurations are not supported for stack at the moment. This is for cabal projects only.</p>\n</blockquote>\n\n<p>The install instructions for everything (from installing Stack to project setup) are in the <a href=\"https://github.com/rikvdkleij/intellij-haskell#getting-started\" rel=\"noreferrer\">readme</a>, but I needed to change it slightly so I put my version here.</p>\n\n<p><strong>Installation instructions for everyone who wants to use Haskell</strong></p>\n\n<ol>\n<li>Install the IntelliJ-Haskell plugin, I would recommend to install the latest beta release from <a href=\"https://github.com/rikvdkleij/intellij-haskell/releases\" rel=\"noreferrer\">GitHub</a>.</li>\n<li>Install Stack, instructions in <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/\" rel=\"noreferrer\">their docs</a> (scroll down for your specific OS).</li>\n<li>In a terminal/command prompt, run <code>stack install hindent</code> and <code>stack install stylish-haskell</code> (this can take a while).</li>\n<li>Restart your computer.</li>\n<li>Make a new project in IntelliJ of type Haskell module, select the Stack binary (probably <code>C:\\Users\\username\\AppData\\Roaming\\local\\bin\\stack.exe</code> or <code>/usr/bin/stack</code>) and Set Default (if it is not already default).\n\n<ul>\n<li>You can also import an existing Stack project with File | New | Project from Existing Sources, click import from Haskell Stack.</li>\n</ul></li>\n<li>Switch on an extra log with File | Settings | Appearance | Notifications | Haskell Log. When something is building which takes a long time you can see progress here (bottom right, Event Log).</li>\n<li>You should have a file <code>app/Main.hs</code>. You could replace everything in it with <code>main = putStrLn \"Hello Haskell!\"</code>.</li>\n<li>Now do as @mrek says: create a run configuration Haskell Stack | Haskell Stack Runner, and run it. You should see the hello message.</li>\n<li>Even better, answering the original question: when you change the message and run again the output has changed!</li>\n<li>In the same way, you can make a test run configuration (Haskell Stack Tester) which runs your tests.</li>\n</ol>\n\n<p>You can start up the interactive console by clicking Terminal at the bottom of IntelliJ and then running <code>stack ghci</code>. When you type <code>main</code> you are calling main, and so on.\nYou could also use <code>stack test</code> instead of the test run configuration.</p>\n"}], "owner": {"reputation": 13667, "user_id": 1120370, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8c82898ff7f2247a7fc0c1e224b4b3de?s=128&d=identicon&r=PG", "display_name": "W.P. McNeill", "link": "https://stackoverflow.com/users/1120370/w-p-mcneill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10014, "favorite_count": 8, "answer_count": 2, "score": 21, "last_activity_date": 1564933182, "creation_date": 1465583213, "last_edit_date": 1465596601, "question_id": 37754956, "link": "https://stackoverflow.com/questions/37754956/how-do-i-set-up-intellij-to-build-haskell-projects-with-stack", "title": "How do I set up IntelliJ to build Haskell projects with Stack?", "body": "<p>I am using Stack to setup, build, and run my Haskell projects from the command line. I want to use IntelliJ as my IDE but am running into problems configuring Stack as my build tool.</p>\n\n<p>I used Stack to create and run a \"Hello, World\" Haskell program on the command line following the instructions in the Stack <a href=\"http://docs.haskellstack.org/en/stable/GUIDE/\">User Guide</a>. Everything worked fine.</p>\n\n<p>I have the HaskForce plugin installed on IntelliJ. The Build, Execution, Deployment -> Compiler -> Haskell Compiler tab gives you a choice between building with Stack and building with Cabal. I selecte Build with stack and configured it like so.</p>\n\n<p><a href=\"https://i.stack.imgur.com/GJjAa.png\"><img src=\"https://i.stack.imgur.com/GJjAa.png\" alt=\"enter image description here\"></a></p>\n\n<p>I can run the project using a Haskell Stack Run configuration. The console output is correct.</p>\n\n<pre><code>/Users/williammcneill/Library/Haskell/bin/stack exec hellohaskell-exe --\nHello, Haskell.\n</code></pre>\n\n<p>However, I cannot figure out how to rebuild the project through the IDE. For example, if I change the output text and rerun the program, I still see the original \"Hello, Haskell\" output. Build -> Make Project | Make Module | Rebuild Project all do nothing.</p>\n\n<p>The Project Settings->Artifacts tab has nothing listed, and I don't see a way to add a Haskell executable here.</p>\n\n<p>My workaround is to build my Haskell programs from the command line even when I'm editing from the IDE.</p>\n\n<p>(It also looks strange to me to specify a path to a project-specific <code>stack.yaml</code> file in the general Haskell compiler settings, but that was the only way I could see how to use Stack to build.)</p>\n\n<p>How do I set up IntelliJ to build Haskell projects using Stack?</p>\n\n<p><em>ghc 7.10.3, stack 1.1.2, HaskForce 0.3-beta.33, IntelliJ IDEA Ultimate 2016.1.3, OS X 10.11.5</em></p>\n\n<hr>\n\n<p>This is Haskforce <a href=\"https://github.com/carymrobbins/intellij-haskforce/issues/282\">issue 282</a>.</p>\n"}, {"tags": ["haskell", "vector", "monads", "mutable"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465570285, "post_id": 37751142, "comment_id": 62972027, "body": "can you please add the actual error?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465570325, "post_id": 37751142, "comment_id": 62972054, "body": "<code>a &lt;- return x</code> is redundant. That just gives you <code>x</code> again."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465570449, "post_id": 37751142, "comment_id": 62972137, "body": "@Carsten Added the error."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465571034, "post_id": 37751142, "comment_id": 62972549, "body": "It would help if you included your imports."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465571062, "post_id": 37751142, "comment_id": 62972569, "body": "If you want to mutate a monadic vector, you <i>have</i> to return a monadic value. That&#39;s the whole point of monads: side effects must appear in the type. A function of type <code>VM.MVector s Int -&gt; Int</code> is necessarily a constant function."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465571457, "post_id": 37751142, "comment_id": 62972828, "body": "Basically you can&#39;t do what you&#39;re trying to do. You&#39;ll probably have to put your entire function in the ST monad. If you show us more of your code we can point out why this is the case."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465571775, "post_id": 37751142, "comment_id": 62973036, "body": "@chi So it is like that. I thought that might be the case with Haskell. So does that mean that is is impossible to mutate a mutable vector passed as an argument into a function? What if I used the IO monad? Actually, I just tried it now and it does seem like it would work. Check out the edit."}], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1465572210, "post_id": 37751768, "comment_id": 62973285, "body": "Right, this is what I was looking for. So that is how the type signature for the ST monad looks like. And the mutable vector and the ST monad have the same <code>s</code> type. Actually, just what are those <code>s</code>&#39;s inside <code>ST s (VM.MVector s Int)</code> supposed to be doing apart from preventing me from inadvertently mutating the vector?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 6, "creation_date": 1465572433, "post_id": 37751768, "comment_id": 62973417, "body": "@MarkoGrdinic <code>s</code> is a dummy type which &quot;taints&quot; all the &quot;pointer-carrying&quot; stuff like <code>STRef s Int</code> or <code>MVector s Int</code>. Its purpose is to prevent you to return these &quot;pointers&quot; from <code>runST</code>, nothing else -- it&#39;s just to prove to the compiler that you played by the rules."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1476593398, "post_id": 37751768, "comment_id": 67407571, "body": "@chi IIRC It is also to prevent you from unsafely interleaving ST actions that are operating on separate chunks of memory. So you can&#39;t try and reference a pointer created in block <code>foo</code> while within <code>bar</code> without running all of <code>foo</code> first."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1465572180, "last_edit_date": 1465572180, "creation_date": 1465571864, "answer_id": 37751768, "question_id": 37751142, "link": "https://stackoverflow.com/questions/37751142/how-to-modify-or-read-a-mutable-vector-passed-as-an-argument-in-a-function/37751768#37751768", "title": "How to modify or read a mutable vector passed as an argument in a function?", "body": "<p>You probably need some example. Here's a basic commented one, but I'm sure you'll find others in the net if you google a bit.</p>\n\n<pre><code>import Control.Monad.ST\nimport qualified Data.Vector.Mutable as VM\n\n-- This returns a reference to a vector, wrapped in the ST s monad.\ntest :: ST s (VM.MVector s Int)\ntest = do\n  v &lt;- VM.new 10       -- create vector\n  VM.write v 3 2000    -- modify it\n  VM.write v 4 3000\n  x &lt;- VM.read v 3     -- access it\n  VM.write v 4 (x+1)   \n  return v             -- return it\n\n-- This instead returns a (wrapped) Int\ntest2 :: ST s Int\ntest2 = do\n  v &lt;- test            -- call test, which performs the allocation\n  VM.read v 4          -- return v[4]\n\n-- This returns a plain pure Int value    \ntest3 :: Int\ntest3 = runST test2\n</code></pre>\n\n<p>Note that <code>runST x</code> can only be used when the type of <code>x</code> is the\npolytype <code>ST s T</code> where <code>T</code> does NOT involve the type variables <code>s</code>.\nThis is how the ST monad achieves referential transparency. </p>\n\n<p>In more simple terms, this means that any \"pointer\" to allocated memory must never be returned by <code>runST</code>. When <code>runST</code> returns, every allocation of mutable things can be freed. Hence, a typical <code>ST s</code> computation performs <code>runST</code> only at the very end, when it's ready to throw away all the mutable data and keep an immutable portion of it. In the example above, the immutable portion was the 4th element (counting from 0, as usual), which is an immutable <code>Int</code>.</p>\n\n<p>If you are not familiar with <code>ST s</code>, I'd recommend you forget about vectors for the moment, and do some practice with <code>STRef s Int</code> (references to <code>Int</code>) and <code>ST</code>. Any <code>ST</code> tutorial would suffice.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 935, "favorite_count": 0, "accepted_answer_id": 37751768, "answer_count": 1, "score": 1, "last_activity_date": 1465572180, "creation_date": 1465569982, "last_edit_date": 1465571856, "question_id": 37751142, "link": "https://stackoverflow.com/questions/37751142/how-to-modify-or-read-a-mutable-vector-passed-as-an-argument-in-a-function", "title": "How to modify or read a mutable vector passed as an argument in a function?", "body": "<pre><code>  test :: VM.MVector s Int -&gt; Int\n  test x = runST $ do\n    a &lt;- return x\n    VM.read a 0 -- Type error\n</code></pre>\n\n<p>I am trying to figure out how to not put everything inside a ST monad into a single function. If I tried to modify <code>x</code> or return a value from it, the compiler would complain about the state part of the mutable vector not matching up.</p>\n\n<p>Would operating on passed mutable vectors be possible in Haskell or do I have to freeze them into the immutable counterparts before doing anything on them?</p>\n\n<p>Edit:</p>\n\n<p>Here is the actual error.</p>\n\n<pre><code>Couldn't match type `s1' with `s'\n  `s1' is a rigid type variable bound by\n       a type expected by the context: ST s1 Int at rjb.hs:17:12\n  `s' is a rigid type variable bound by\n      the type signature for test :: VM.MVector s Int -&gt; Int\n      at rjb.hs:16:11\nExpected type: VM.MVector\n                 (Control.Monad.Primitive.PrimState (ST s1)) Int\n  Actual type: VM.MVector s Int\nRelevant bindings include\n  a :: VM.MVector s Int (bound at rjb.hs:18:5)\n  x :: VM.MVector s Int (bound at rjb.hs:17:8)\n  test :: VM.MVector s Int -&gt; Int (bound at rjb.hs:17:3)\nIn the first argument of `VM.read', namely `a'\nIn a stmt of a 'do' block: VM.read a 0\n</code></pre>\n\n<p>Edit: The following passes type checking.</p>\n\n<pre><code>  test :: VM.MVector (Control.Monad.Primitive.PrimState IO) Int -&gt; IO (Int)\n  test x = VM.read x 0\n</code></pre>\n\n<p>I am guessing that I would be able to mutate the <code>x</code> vector as well. So...</p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1465569011, "last_edit_date": 1465569011, "creation_date": 1465568496, "answer_id": 37750637, "question_id": 37749186, "link": "https://stackoverflow.com/questions/37749186/use-different-configuration-for-ghci-and-stack-ghci/37750637#37750637", "title": "Use different configuration for &quot;ghci&quot; and &quot;stack ghci&quot;", "body": "<p>ghci supports the <code>--ghci-script</code> flag for specifying additional scripts to read at startup.</p>\n\n<p>Docs for <code>--ghci-script</code>: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghc-flag--ghci-script\" rel=\"nofollow\">(link)</a></p>\n"}], "owner": {"reputation": 159, "user_id": 6058497, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/971a52457529da0152bbb4f6b8dfb77f?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Lorenzen", "link": "https://stackoverflow.com/users/6058497/anton-lorenzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 37750637, "answer_count": 1, "score": 1, "last_activity_date": 1483522755, "creation_date": 1465564258, "last_edit_date": 1483522755, "question_id": 37749186, "link": "https://stackoverflow.com/questions/37749186/use-different-configuration-for-ghci-and-stack-ghci", "title": "Use different configuration for &quot;ghci&quot; and &quot;stack ghci&quot;", "body": "<p>I often use <code>ghci</code> for little calculations and <code>stack ghci</code> to work on my actual projects.</p>\n\n<p>To make the first easier I have written a <code>.ghci</code> file with a lot of imported modules in it, but some of these modules aren't present in my stack project and I get nasty errors.</p>\n\n<p>At the moment I use a alias <code>stackghci=\"stack ghci --ghci-options -ignore-dot-ghci\"</code>, but then I have the default prompt again and so on..</p>\n\n<p>Is there a way of specifying two <code>.ghci</code> files; one for stack and one for <code>ghci</code>?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1465564723, "post_id": 37749125, "comment_id": 62968163, "body": "Read <a href=\"http://learnyouahaskell.com/for-a-few-monads-more\" rel=\"nofollow noreferrer\">this tutorial</a> about a few monads, including the <code>State</code> monad."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1465579731, "post_id": 37749125, "comment_id": 62977544, "body": "What I found confusing with the state monad is that the state itself is not actually the monad. what is a xmonad is a function modifying the state and return a value : s -&gt; (a, s)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1465582521, "post_id": 37749125, "comment_id": 62978930, "body": "@mb14 One way to understand it is that the state is both an additional parameter and an additional return value; a function of type <code>a -&gt; b</code> becomes a function of type <code>a -&gt; s -&gt; (b, s)</code>. Currying lets you think of this as taking a value of type <code>a</code> and returning a new function that, when given a state, can return a value of type <code>b</code> and a new state (<code>a -&gt; (s -&gt; (b, s))</code>. The monad, via the <code>&gt;&gt;=</code> operator, is just what lets you chain such functions together. Ultimately, you wind up with a function of type <code>s -&gt; (t, s)</code>, which turns an initial state into a value of type <code>t</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1465589404, "post_id": 37749125, "comment_id": 62982242, "body": "This is irrelevant, but I would recommend using something like <code>data Mov = Fwd | Lft | Rght | ... deriving (Eq, Show)</code> instead of making it a synonym for <code>Char</code>. This will make it easy to get GHC to help you see if you caught all the cases if you use <code>-Wall</code> or <code>-fwarn-incomplete-patterns</code>, and generally makes your intent clearer."}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 1, "last_activity_date": 1465574773, "last_edit_date": 1465574773, "creation_date": 1465571701, "answer_id": 37751715, "question_id": 37749125, "link": "https://stackoverflow.com/questions/37749125/haskell-state-monad-in-tracking-movement-in-2-dimensions/37751715#37751715", "title": "Haskell State monad in tracking movement in 2 dimensions", "body": "<p>Here is some simple 'starter' code extending your module with some reformulations in terms of state. You will need to look at a tutorial like the LYAH chapter while fiddling with them, I'd think. I omit the signatures, which become increasingly complicated, but querying the types in ghci will be instructive.  You need to add</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Monad.Writer -- for the position-remembering example\n</code></pre>\n\n<p>Then the following should all work using your definition of <code>move</code> </p>\n\n<pre><code>step = do                        -- step the state once with your `move`,\n sstate &lt;- get                   -- whatever the state is\n put (move sstate)\n-- this little program could also be written: `modify move` which shows the\n-- link between what you wrote and State a little more clearly\n\nsteps = do                       -- repeatedly apply `step` to the state\n  Sstate _ _ ls &lt;- get           -- til there are no moves, then stop\n  if null ls \n  then return ()       -- could be: unless (null ls) $ do step ; steps\n  else step &gt;&gt; steps\n\nstepsIO = do                     -- do all steps as with `steps`, but print\n  sstate@(Sstate a b ls) &lt;- get  -- the current state at each state update\n  liftIO $ print sstate\n  if null ls then liftIO (putStrLn \"Done!\")\n             else step &gt;&gt; stepsIO\n\nstepsPrintPosition = do           -- do all steps as with `steps`, printing \n  Sstate _ b ls &lt;- get            -- only position at each state update\n  liftIO $ do putStr \"current position: \" \n              print b\n  if null ls then liftIO (putStrLn \"Done!\")\n             else do step \n                     stepsPrintPosition  \n\nstepsAccumulatePositions = do    -- move through all states as with `steps`\n  sstate@(Sstate a b ls) &lt;- get  -- but use `tell` to keep adding the current\n  tell [b]                       -- position to the underlying list \n  if null ls then return ()      -- of positions \n             else step &gt;&gt; stepsAccumulatePositions\n\nexample = Sstate (Dir 0 1) (Pos 0 2) \"ffff\"\n</code></pre>\n\n<p>To use things like <code>step</code>, <code>steps</code>, <code>stepsIO</code> etc, we apply <code>runState</code>; this gives us a function from a state to a new state</p>\n\n<pre><code>runStateT :: StateT s m a -&gt; s -&gt; m (a, s)\n</code></pre>\n\n<p>This of course is just the accessor for the newtype definition </p>\n\n<pre><code>newtype StateT s m a  = StateT {runStateT :: s -&gt; m (a, s)}\n</code></pre>\n\n<p>The wrapping permits us to write fancy <code>s -&gt; m (a, s)</code> things, using simpler <code>s -&gt; m (a, s)</code> bits, but under the newtype hood, its always just a function <code>s -&gt; m (a, s)</code> we are writing in the do notation. </p>\n\n<p>Of course, once we unwrap with <code>runStateT</code> and have our function <code>s -&gt; m (a, s)</code>, we need to supply it with an initial state. It's easiest to see how this works by testing in ghci</p>\n\n<pre><code>&gt;&gt;&gt; example\nSstate (Dir 0 1) (Pos 0 2) \"ffff\"\n\n&gt;&gt;&gt; runStateT step example            -- we step the state once with move\n((),Sstate (Dir 0 1) (Pos 0 3) \"fff\")\n\n&gt;&gt;&gt; runStateT steps example           -- we keep stepping till there are no moves\n((),Sstate (Dir 0 1) (Pos 0 6) \"\")\n\n&gt;&gt;&gt; runStateT stepsIO example         -- we print state at each state update\nSstate (Dir 0 1) (Pos 0 2) \"ffff\"\nSstate (Dir 0 1) (Pos 0 3) \"fff\"\nSstate (Dir 0 1) (Pos 0 4) \"ff\"\nSstate (Dir 0 1) (Pos 0 5) \"f\"\nSstate (Dir 0 1) (Pos 0 6) \"\"\nDone!\n((),Sstate (Dir 0 1) (Pos 0 6) \"\")\n\n&gt;&gt;&gt; runStateT stepsPrintPosition  example   -- print position only at state updates\ncurrent position: Pos 0 2\ncurrent position: Pos 0 3\ncurrent position: Pos 0 4\ncurrent position: Pos 0 5\ncurrent position: Pos 0 6\nDone!\n((),Sstate (Dir 0 1) (Pos 0 6) \"\") \n\n\n-- the WriterT examples accumulate a 'monoid' of things you keep\n-- adding to with `tell xyz` Here we accumulate a [Position]\n-- execXYZ and evalXYZ, where they exist, return less information than runXYZ\n\n&gt;&gt;&gt;  runWriterT $ runStateT stepsAccumulatePositions   example\n(((),Sstate (Dir 0 1) (Pos 0 6) \"\"),[Pos 0 2,Pos 0 3,Pos 0 4,Pos 0 5,Pos 0 6])\n\n&gt;&gt;&gt;  execWriterT $ evalStateT stepsAccumulatePositions   example\n[Pos 0 2,Pos 0 3,Pos 0 4,Pos 0 5,Pos 0 6]\n</code></pre>\n\n<p>In the code above I am using the <code>mtl</code> typeclasses and then using <code>runStateT</code> and <code>runWriterT</code> to \"interpret\" or specialize the class involving signatures. These are pertain to concrete types <code>StateT</code> and <code>WriterT</code> defined in <code>Control.Monad.Trans.{State/Writer}</code> One could omit the classes, and just write directly with those concrete types, importing those modules. The only difference would be that you need to do <code>lift $ tell [b]</code> in the one case where I combine two effects, state and writing or whatever you want to call it.</p>\n\n<p>There is plenty to be said about the analysis of state you are working with but it will emerge how you might rework it, if you think the above through.</p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1465577016, "post_id": 37753208, "comment_id": 62976176, "body": "Thanks. Really Helpful. Seeing code refactored by someone that knows what they are doing really helps my learning process."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1465577155, "post_id": 37753208, "comment_id": 62976247, "body": "Ironically, refactoring other people&#39;s starting points is how I&#39;m doing most of my learning."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1465589472, "post_id": 37753208, "comment_id": 62982277, "body": "@chepner, <code>()</code> looks simplest and most idiomatic to me."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1465577121, "last_edit_date": 1465577121, "creation_date": 1465576591, "answer_id": 37753208, "question_id": 37749125, "link": "https://stackoverflow.com/questions/37749125/haskell-state-monad-in-tracking-movement-in-2-dimensions/37753208#37753208", "title": "Haskell State monad in tracking movement in 2 dimensions", "body": "<p>Note that you don't directly need to use the <code>State</code> monad here, as <code>end</code> and <code>route</code> can be written using <code>foldl'</code> and <code>scanl'</code> once you consider a <code>Mov</code> as something that <em>operates</em> on a state, rather than being <em>part</em> of the state. Record syntax for <code>Sstate</code> also helps.</p>\n\n<pre><code>type Mov = Char\ndata Pos = Pos Int Int deriving (Show, Eq)\ndata Dir = Dir Int Int deriving (Show, Eq)\ndata Sstate = Sstate {direction :: Dir, position :: Pos} deriving (Show, Eq)\n\n-- A helper to simplify move\nchangeDir :: Mov -&gt; Dir -&gt; Dir\nchangeDir 'l' (Dir x y) = Dir (-y) x\nchangeDir 'r' (Dir x y) = Dir y (-x)\nchangeDir m (Dir x y) = Dir y x\n\nmove :: Mov -&gt; Sstate -&gt; Sstate\nmove 'f' oldState@(Sstate (Dir dx dy) (Pos px py))  = oldState { position = Pos (dx + px) (dy + py) }\nmove  m  oldState@(Sstate dir _) = oldState { direction = changeDir m dir }\n\nend :: [Mov] -&gt; Sstate -&gt; Sstate\nend ms initialState = foldl' (flip move) initialState ms\n\nroute :: [Mov] -&gt; Sstate -&gt; [Pos]\nroute ms initialState = map position $ scanl' (flip move) initialState ms\n</code></pre>\n\n<p>Then your examples become:</p>\n\n<pre><code>\u03bb: let x = Sstate {direction = Dir 0 1, position = Pos 0 2}\n\n\u03bb: move 'f' x\nSstate {direction = Dir 0 1, position = Pos 0 3}\n\n\u03bb: end \"ff\" x\nSstate {direction = Dir 0 1, position = Pos 0 4}\n\n\u03bb: route \"ff\" x\n[Pos 0 2,Pos 0 3,Pos 0 4]\n</code></pre>\n\n<p>I'll leave it as an exercise (or to someone more knowledgeable and less lazy than me) to adapt</p>\n\n<pre><code>move :: Mov -&gt; Sstate -&gt; Sstate\nend :: [Mov] -&gt; Sstate -&gt; Sstate\nroute :: [Mov] -&gt; Sstate -&gt; [Pos]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>move :: Mov -&gt; State Sstate ()\n-- or possibly move :: Mov -&gt; State Sstate Sstate ?\n-- Like I said, more knowledgeable than me\nend :: [Mov] -&gt; State Sstate Sstate\nroute :: [Mov] -&gt; State Sstate [Pos]\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 37751715, "answer_count": 2, "score": 6, "last_activity_date": 1465581149, "creation_date": 1465564058, "last_edit_date": 1465581149, "question_id": 37749125, "link": "https://stackoverflow.com/questions/37749125/haskell-state-monad-in-tracking-movement-in-2-dimensions", "title": "Haskell State monad in tracking movement in 2 dimensions", "body": "<p>I am trying to follow the movement of an object, on a 2D plane, which has been given a list of commands \"forward, left or right\".</p>\n\n<p>So far I have functions that take in the components of a state of the object (direction, position and moves) and return the final state after all moves have been completed or all the positions passed along the way.</p>\n\n<p>The state of the object is in the form <code>Sstate (Dir dx dy) (Pos px py) [m]</code> and a move consists of recursively applying the head of the list of moves to generate new states</p>\n\n<p>ie <code>Sstate (Dir 1 0) (Pos 0 0) \"fff\" -&gt; Sstate (Dir 1 0) (Pos 0 1) \"ff\"</code></p>\n\n<pre><code>type Mov = Char\n\ndata Pos = Pos Int Int\n deriving (Show, Eq)\n\ndata Dir = Dir Int Int\n deriving (Show, Eq)\n\ndata Sstate = Sstate Dir Pos [Mov]\n deriving (Show, Eq)\n\nmove :: Sstate -&gt; Sstate\nmove (Sstate (Dir dx dy) (Pos px py) []    )  = Sstate  (Dir dx dy) (Pos px py) []\nmove (Sstate (Dir dx dy) (Pos px py) (m:ms))\n | m == 'f'  = ss dx    dy    (dx + px) (dy + py) ms\n | m == 'l'  = ss (-dy) dx    px        py        ms\n | m == 'r'  = ss dy    (-dx) px        py        ms\n | otherwise = ss dy    dx    px        py        []\n where\n   ss a b c d = Sstate (Dir a b) (Pos c d)\n\nend :: Dir -&gt; Pos -&gt; [Mov] -&gt; Sstate\nend d p ms = iterate move initialState !! n\n where\n   initialState = Sstate d p ms\n   n = length ms + 1\n\nposition :: Sstate -&gt; Pos\nposition (Sstate _ p _) = p\n\nroute :: Dir -&gt; Pos -&gt; [Mov] -&gt; [Pos]\nroute d p ms = map position . take n . iterate  move $ initialState\n where\n   initialState = Sstate d p ms\n   n = length ms + 1\n</code></pre>\n\n<p>giving</p>\n\n<pre><code>\u03bb: let x = Sstate (Dir 0 1) (Pos 0 2) \"ff\"\n\n\u03bb: move x\nSstate (Dir 0 1) (Pos 0 3) \"f\"\n\n\u03bb: end (Dir 0 1) (Pos 0 2) \"ff\"\nSstate (Dir 0 1) (Pos 0 4) \"\"\n\n\u03bb: route (Dir 0 1) (Pos 0 2) \"ff\"\n[Pos 0 2,Pos 0 3,Pos 0 4]\n</code></pre>\n\n<p>This seems to work but it also seems that this is something that is asking for the <code>State monad</code>. I find the <code>State monad</code> confusing but feel that it would help me my understanding if someone would be kind enough to show how it could be used here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465556462, "post_id": 37746472, "comment_id": 62962770, "body": "Can you write more clearly? What do you mean by &#39;Haskell script&#39;. Like a scripting language?"}, {"owner": {"reputation": 977, "user_id": 6385043, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7c3064c86e6a7e521442a3a9bb7303d?s=128&d=identicon&r=PG&f=1", "display_name": "maxik", "link": "https://stackoverflow.com/users/6385043/maxik"}, "edited": false, "score": 3, "creation_date": 1465556623, "post_id": 37746472, "comment_id": 62962862, "body": "Try &#39;<i>.hs</i>&#39;. For further research, good you do that, try <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>."}, {"owner": {"reputation": 8307, "user_id": 133645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rqzq.jpg?s=128&g=1", "display_name": "reto", "link": "https://stackoverflow.com/users/133645/reto"}, "edited": false, "score": 0, "creation_date": 1465556675, "post_id": 37746472, "comment_id": 62962898, "body": "I am glad to read that you seem to be interested in Haskell, however please do some basic research on your own <a href=\"https://en.wikipedia.org/wiki/Haskell_(programming_language)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Haskell_(programming_language)</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1465583318, "post_id": 37746472, "comment_id": 62979374, "body": "Are you looking for a shebang pattern? <code>#!&#47;usr&#47;[local&#47;]bin&#47;runhaskell</code> for example?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 16, "last_activity_date": 1465562002, "creation_date": 1465562002, "answer_id": 37748411, "question_id": 37746472, "link": "https://stackoverflow.com/questions/37746472/what-is-the-extension-for-haskell/37748411#37748411", "title": "What is the extension for Haskell?", "body": "<p>Two common extensions are <code>.hs</code> and <code>.lhs</code>. The difference is in how the compiler handles comments. In a <code>.hs</code> file, comments begin with <code>--</code> or are enclosed in <code>{-</code>/<code>-}</code> pairs.</p>\n\n<pre><code>{- This is a multiline comment\n   about my factorial function\n -}\n\n-- It's simple using builtins\nfactorial n = product [1..n]\n</code></pre>\n\n<p>In a <code>.lhs</code> file, every line is considered a comment, unless it is explicitly marked as code. There are two different styles you can use,\nalthough you must use only one within a single file. First, you can mark\nlines of code by prefix them with <code>&gt;</code>:</p>\n\n<pre><code>In this file, we will implement factorial.\n\n&gt; factorial :: (Enum a, Num a) =&gt; a -&gt; a\n&gt; factorial n = product [1..n]\n</code></pre>\n\n<p>To embed code in a file that can be processed by LaTeX to produce\nnice looking documentation, code can instead appear in a <code>code</code> block:</p>\n\n<pre><code>In this file, we will implement factorial.\n\n\\begin{code}\nfactorial :: (Enum a, Num a) =&gt; a -&gt; a\nfactorial n = product [1..n]\n\\end{code}\n</code></pre>\n\n<p>Both are equivalent to the following <code>.hs</code> file:</p>\n\n<pre><code>-- In this file, we will implement factorial\nfactorial :: (Enum a, Num a) =&gt; a -&gt; a\nfactorial n = product [1..n]\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5507518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6e68fdd2c728218593133c6b619eba3?s=128&d=identicon&r=PG&f=1", "display_name": "Xyz", "link": "https://stackoverflow.com/users/5507518/xyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3654, "favorite_count": 2, "closed_date": 1465583330, "answer_count": 1, "score": 1, "last_activity_date": 1465562002, "creation_date": 1465556102, "last_edit_date": 1465558078, "question_id": 37746472, "link": "https://stackoverflow.com/questions/37746472/what-is-the-extension-for-haskell", "closed_reason": "Needs details or clarity", "title": "What is the extension for Haskell?", "body": "<p>what extension should I use for a Haskell script?\nI tried to research it ,but never got the answer, so please help me.\nI'm really interested in functional programming language and all what I need to test my programs is this problem solved.</p>\n"}, {"tags": ["haskell", "exception", "asynchronous", "concurrency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1465556635, "post_id": 37745981, "comment_id": 62962871, "body": "Interesting. I would try adding a few <code>yield</code>s in the code do be tested so to suggest/force a thread switch."}, {"owner": {"reputation": 93, "user_id": 3284560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9b8bd7d436e5a63188f54920ef13f9ba?s=128&d=identicon&r=PG&f=1", "display_name": "bartfrenk", "link": "https://stackoverflow.com/users/3284560/bartfrenk"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465557934, "post_id": 37745981, "comment_id": 62963692, "body": "A <code>yield</code> just before the <code>if</code> statement exposes the violation, sometimes."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465559465, "post_id": 37745981, "comment_id": 62964637, "body": "You can increase the probability inserting <code>threadDelay</code> as needed."}, {"owner": {"reputation": 93, "user_id": 3284560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9b8bd7d436e5a63188f54920ef13f9ba?s=128&d=identicon&r=PG&f=1", "display_name": "bartfrenk", "link": "https://stackoverflow.com/users/3284560/bartfrenk"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465560436, "post_id": 37745981, "comment_id": 62965233, "body": "That works for sure. But I would prefer not to touch the code under test."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 3, "creation_date": 1465563509, "post_id": 37745981, "comment_id": 62967386, "body": "You can probably make a monad that performs <code>yield</code> in <code>&gt;&gt;=</code>. But in general exception safety is hard to test, it is much easier to reason about it formally. In your example exception safety of <code>casMVar</code> depends on whether async exceptions are masked when it is executed."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465564877, "post_id": 37745981, "comment_id": 62968273, "body": "You can also write your own <code>MVar</code> library which inserts delays/yields. In general, IMO, concurrency and tests do not mix well."}, {"owner": {"reputation": 93, "user_id": 3284560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9b8bd7d436e5a63188f54920ef13f9ba?s=128&d=identicon&r=PG&f=1", "display_name": "bartfrenk", "link": "https://stackoverflow.com/users/3284560/bartfrenk"}, "edited": false, "score": 0, "creation_date": 1465566320, "post_id": 37745981, "comment_id": 62969297, "body": "The tests are part of a suite of exercises I am making while reading Marlow&#39;s Parallel and Concurrent Programming in Haskell. So the implementations are meant to be written by someone that is learning how to formally reason about concurrency."}, {"owner": {"reputation": 93, "user_id": 3284560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9b8bd7d436e5a63188f54920ef13f9ba?s=128&d=identicon&r=PG&f=1", "display_name": "bartfrenk", "link": "https://stackoverflow.com/users/3284560/bartfrenk"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1465566910, "post_id": 37745981, "comment_id": 62969730, "body": "I like your suggestion @Yuras. That works quite smoothly and only requires a minor modification of the return type of the IO functions."}], "answers": [{"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 1, "last_activity_date": 1465716800, "creation_date": 1465716800, "answer_id": 37771801, "question_id": 37745981, "link": "https://stackoverflow.com/questions/37745981/testing-for-correctness-under-asynchronous-exceptions-in-haskell/37771801#37771801", "title": "Testing for correctness under asynchronous exceptions in Haskell", "body": "<p>I don't know of a general method for testing arbitrary code under asynchronous exceptions. For the particular example you gave, I would simply pass an exception throwing value as parameter of <code>casMVar</code>, and check whether after the evaluation of <code>casMVar</code> the <code>MVar</code> is non-empty: </p>\n\n<pre><code>boom = error \"Handle me!\"\n\npokemonHandler :: a -&gt; SomeException -&gt; IO a\npokemonHandler a e = return a\n\nspec :: Spec\nspec = do\n  describe \"casMVar\" $ do\n    it \"puts back a value on the MVar under an exception\" $ do\n      m &lt;- newMVar \"foo\"\n      a &lt;- async $\n        casMVar m boom \"bar\" `catch` pokemonHandler True\n      _ &lt;- wait a\n      val &lt;- readMVar m\n      val `shouldBe` \"foo\"\n</code></pre>\n\n<p>The complete code can be found here <a href=\"https://github.com/capitanbatata/sandbox/tree/master/testing-under-async-exceptions\" rel=\"nofollow\">https://github.com/capitanbatata/sandbox/tree/master/testing-under-async-exceptions</a></p>\n"}], "owner": {"reputation": 93, "user_id": 3284560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9b8bd7d436e5a63188f54920ef13f9ba?s=128&d=identicon&r=PG&f=1", "display_name": "bartfrenk", "link": "https://stackoverflow.com/users/3284560/bartfrenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1465716800, "creation_date": 1465554663, "question_id": 37745981, "link": "https://stackoverflow.com/questions/37745981/testing-for-correctness-under-asynchronous-exceptions-in-haskell", "title": "Testing for correctness under asynchronous exceptions in Haskell", "body": "<p>I am trying to come up with tests for correct behavior under asynchronous exceptions. To make things concrete, consider the following example,</p>\n\n<pre><code>casMVar :: Eq a =&gt; MVar a -&gt; a -&gt; a -&gt; IO Bool\ncasMVar m old new = do\n  cur &lt;- takeMVar m\n  if cur == old\n  then putMVar m new &gt;&gt; return True\n  else putMVar m old &gt;&gt; return False\n</code></pre>\n\n<p>where the invariant is that <code>m</code> is not empty. I think that this invariant is violated under asynchronous exceptions, since such an exception might arrive in the <code>if</code> expression. On my machine it is however not exposed by throwing exceptions at a forked <code>casMVar</code> with increasing delays, like so, </p>\n\n<pre><code>values :: Maybe (List Bool)\nvalues = action &lt;$&gt; killDelays\nwhere\n  killDelays = toDelays &lt;$&gt; [-100..100]\n  toDelays :: Int -&gt; (Int, Int)\n  toDelays dt = if dt &lt; 0 then (-dt, 0) else (0, dt)\n  action :: (Int, Int) -&gt; IO (Maybe Bool)\n  action (s, t) = do\n    m &lt;- newMVar False\n    threadId &lt;- forkIO $ threadDelay s &gt;&gt; void (casMVar m False True)\n    threadDelay t\n    throwTo threadId ThreadKilled\n    tryReadMVar m\n</code></pre>\n\n<p>Although <code>values</code> is a list of <code>Just False</code>'s concatenated with a list of <code>Just True</code>'s.</p>\n\n<p>Is there some way to expose the violation? Or at least to increase the probability that on a <em>some</em> machine the violation is exposed? I am specifically not looking for ways to make this code correct, the question is purely about testing.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 3, "creation_date": 1465552626, "post_id": 37745240, "comment_id": 62960354, "body": "Do you define your own <code>&lt;=</code> ? Prelude already comes with a <code>&lt;=</code> so you should choose which one you want (that is what the second error message is saying). The first error is saying that there is no built in definition for equality between functions. Also, Haskell does not have function overloading."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465554843, "post_id": 37745240, "comment_id": 62961754, "body": "your ordering for the list will be very strange because then <code>[1,1] &lt;= [1,2]</code> and <code>[1,2] &lt;= [1,1]</code> but of course <code>[1,1] &#47;= [1,2]</code> - also you cannot compare empty lists ... why would you do this?"}, {"owner": {"reputation": 349, "user_id": 5272264, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/98128613e53d179b233d139cc64f6e7f?s=128&d=identicon&r=PG&f=1", "display_name": "zaig", "link": "https://stackoverflow.com/users/5272264/zaig"}, "edited": false, "score": 0, "creation_date": 1465555314, "post_id": 37745240, "comment_id": 62962041, "body": "The purpose of the exercise is to understand the principle not to do something that &quot;makes sense&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1465565278, "post_id": 37745240, "comment_id": 62968550, "body": "your exercise wants you to grapple with three things: defining a function <code>&lt;=</code>, which will (try to) work for all types of arguments; defining a new type&#39;s instance of <code>Ord</code> type class (your case 1); and defining an existing type&#39;s instance (for <code>[a]</code>) (your 2) which won&#39;t work even if you hadn&#39;t defined the function <code>&lt;=</code> before, because there already exists an instance for <code>Ord a =&gt; Ord [a]</code> in the <code>Prelude</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1465556450, "post_id": 37746220, "comment_id": 62962765, "body": "Wouldn&#39;t the <code>Ord [a]</code> instance overlap with the <code>Prelude</code> instance?"}, {"owner": {"reputation": 349, "user_id": 5272264, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/98128613e53d179b233d139cc64f6e7f?s=128&d=identicon&r=PG&f=1", "display_name": "zaig", "link": "https://stackoverflow.com/users/5272264/zaig"}, "edited": false, "score": 0, "creation_date": 1465559009, "post_id": 37746220, "comment_id": 62964365, "body": "I understood now what you&#39;re telling at 2. I have one more question. Why does this work <code>instance (Show b, Num a) =&gt; Show (a -&gt; b) where show f = show (f 0)</code> and I don&#39;t have to do <code>instance (Show b, Num a) =&gt; Show (a -&gt; b) where show f = Main.show (f 0)</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1465561810, "post_id": 37746220, "comment_id": 62966126, "body": "Because unlike with <code>&lt;=</code>, which you apparently tried to define anew yourself, you never defined your own <code>show</code> function. Hence it&#39;s clear that <code>show</code> refers to <code>Prelude.show</code>, whereas <code>Main.show</code> simply doesn&#39;t exist."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465561857, "post_id": 37746220, "comment_id": 62966164, "body": "<code>Main.show</code> will not work. The only <code>show</code> in scope is <code>Prelude.show</code>. Prelude is automatically imported so you can just do <code>show</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1465555390, "creation_date": 1465555390, "answer_id": 37746220, "question_id": 37745240, "link": "https://stackoverflow.com/questions/37745240/haskell-function-overloading/37746220#37746220", "title": "Haskell function overloading", "body": "<ol>\n<li><p>Don't do this. You're defining orphan instances here (instances that live neither in the module of the <code>data</code> nor the <code>class</code> they belong to); such instances are &ldquo;invisible&rdquo; in imports, which is generally a pain for larger project maintenance. (Sometimes you won't get around orphan instances, in particular when combining data and classes from unrelated packages; but functions, lists and <code>Ord</code> are all in the base library. If an instance isn't defined there, you can be pretty sure that there's a good reason!</p></li>\n<li><p>If you do define a class instance, look at the class definition! <code>Ord</code> is defined thus:</p>\n\n<pre><code>class (Eq a) =&gt; Ord a where\n  ...\n</code></pre>\n\n<p>that means, any instance of <code>Ord</code> must be an instance of <code>Eq</code> too. This is also what the compiler is telling you. So, if you do define this instance, you also need to add</p>\n\n<pre><code>instance (Num a, Eq b) =&gt; Eq (a -&gt; b) where f==g = f 0 == g 0\n</code></pre>\n\n<p>This is the only instance that is compatible with your <code>Ord</code>. Frankly, it's just wrong though, since most functions that are deemed equal by this instance are <em>not</em> equal!</p></li>\n<li><p>Haskell does <em>not</em> have overloading as such, at all. If you define a function <code>&lt;=</code> in your module <code>Main</code>, this is a completely unrelated function from the standard <code>&lt;=</code> aka <code>Prelude.&lt;=</code>. You can define such a new function, but to use it you will need to disambiguate. The following should work:</p>\n\n<pre><code>instance Ord a =&gt; Ord [a] where\n  (h1:_) &lt;= (h2:_) = h1 Main.&lt;= h2\n</code></pre>\n\n<p>again though, this is not a good idea &ndash; you simply shouldn't define <code>Main.&lt;=</code> in the first place, but put its definition right in the <code>Ord</code> instance.</p></li>\n</ol>\n"}], "owner": {"reputation": 349, "user_id": 5272264, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/98128613e53d179b233d139cc64f6e7f?s=128&d=identicon&r=PG&f=1", "display_name": "zaig", "link": "https://stackoverflow.com/users/5272264/zaig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 37746220, "answer_count": 1, "score": 0, "last_activity_date": 1465555390, "creation_date": 1465552496, "question_id": 37745240, "link": "https://stackoverflow.com/questions/37745240/haskell-function-overloading", "title": "Haskell function overloading", "body": "<ol>\n<li><p>I have to overload function ordering. The argument of the function is a number and they have to be ordered by their value for the argument <code>0</code>. This is what I tried:</p>\n\n<pre><code>Prelude&gt;instance (Num a, Ord b) =&gt; Ord (a -&gt; b) where f &gt; g = f 0 &gt; g 0\n</code></pre>\n\n<p>but it generates the error</p>\n\n<pre><code>Could not deduce (Eq (a -&gt; b))\narising from the superclasses of an instance declaration\nfrom the context (Num a, Ord b)\nbound by the instance declaration at &lt;interactive&gt;:117:10-39\nIn the instance declaration for `Ord (a -&gt; b)'\n</code></pre></li>\n<li><p>I would also like to instantiate the Ord class for lists. Lists ordering will be given by the comparison between first element of each list. For example [1,2] &lt; [2,3] because 1 &lt; 2.</p>\n\n<pre><code>instance Ord a =&gt; Ord [a] where\n    (h1:_) &lt;= (h2:_) = h1 &lt;= h2\n</code></pre>\n\n<p>This also generates the next error:</p>\n\n<pre><code>Ambiguous occurrence `&lt;='\nIt could refer to either `Main.&lt;=',\n                     defined at C:\\Users\\user-name\\Desktop\\test.hs:2:8\n                  or `Prelude.&lt;=',\n                     imported from `Prelude' at C:\\Users\\user-name\\Desktop\\test.hs:1:1\n                     (and originally defined in `GHC.Classes')\n</code></pre></li>\n</ol>\n\n<p>I think I may have not understood very well the function overloading in Haskell. Maybe someone could explain me what I do wrong.</p>\n"}, {"tags": ["multithreading", "haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465552704, "post_id": 37745191, "comment_id": 62960393, "body": "How are you running and testing the program?"}, {"owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "edited": false, "score": 0, "creation_date": 1465553010, "post_id": 37745191, "comment_id": 62960590, "body": "Did you forget a parameter <code>k</code> on the <code>combs</code> function?"}, {"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465554066, "post_id": 37745191, "comment_id": 62961263, "body": "@pdexter have just updated my question with build/run commands and profiling reports for both parallel and sequential versions"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1465554379, "post_id": 37745191, "comment_id": 62961460, "body": "What&#39;s your <code>main</code> for the sequential version? Thanks."}, {"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1465554876, "post_id": 37745191, "comment_id": 62961774, "body": "@d8d0d65b3f7cf42 tried to use threadscope with stack without much success (-eventlog flag seems not supported)"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1465555340, "post_id": 37745191, "comment_id": 62962057, "body": "&quot;not supported&quot; - oh. then this should be reported to <code>stack</code> developers."}, {"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1465729953, "post_id": 37745191, "comment_id": 63014814, "body": "For further reference, -eventlog flag is indeed supported, just needed to drop --executable-profiling/--library-profiling options. Now I can use ThreadScope, yay!"}], "answers": [{"comments": [{"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1465555682, "post_id": 37746179, "comment_id": 62962267, "body": "Thanks for your recommendation! Actually, I ordered it some days ago and have just received it :) Some homework for the weekend..."}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 0, "last_activity_date": 1465555262, "creation_date": 1465555262, "answer_id": 37746179, "question_id": 37745191, "link": "https://stackoverflow.com/questions/37745191/haskell-parallel-code-is-slower-than-sequential-version/37746179#37746179", "title": "Haskell: Parallel code is slower than sequential version", "body": "<blockquote>\n  <p>good approaches for this problem</p>\n</blockquote>\n\n<p>What do you mean by <em>this problem</em>? If it's how to write, analyze and tune a parallel Haskell program, then this is required background reading:</p>\n\n<p>Simon Marlow: Parallel and Concurrent Programming in Haskell\n<a href=\"http://community.haskell.org/~simonmar/pcph/\" rel=\"nofollow\">http://community.haskell.org/~simonmar/pcph/</a></p>\n\n<p>in particular, Section 15 (Debugging, Tuning, ..) </p>\n\n<p>Use threadscope! (a graphical viewer for thread profile information generated by the Glasgow Haskell compiler) <a href=\"https://hackage.haskell.org/package/threadscope\" rel=\"nofollow\">https://hackage.haskell.org/package/threadscope</a></p>\n"}, {"comments": [{"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1465556100, "post_id": 37746183, "comment_id": 62962531, "body": "I understand your point and seems indeed logical, thank you. If you had to to explicitly obtain all numbers (not just the total number of k-combinations), how would you approach this problem?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1465556992, "post_id": 37746183, "comment_id": 62963080, "body": "What do you mean by &quot;obtain all numbers&quot;?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1465567924, "last_edit_date": 1465567924, "creation_date": 1465555275, "answer_id": 37746183, "question_id": 37745191, "link": "https://stackoverflow.com/questions/37745191/haskell-parallel-code-is-slower-than-sequential-version/37746183#37746183", "title": "Haskell: Parallel code is slower than sequential version", "body": "<p>In your sequential version calling <code>combs</code> does not build up a list in memory since after <code>length</code> consumes an element it isn't needed anymore and is freed. Indeed, GHC may not even allocate storage for it.</p>\n\n<p>For instance, this will take a while but won't consume a lot of memory:</p>\n\n<pre><code>main = print $ length [1..1000000000]  -- 1 billion\n</code></pre>\n\n<p>In your parallel version you are generating sub-lists, concatenating them together, building Sets, etc. and therefore the results of each sub-task have to be kept in memory.</p>\n\n<p>A fairer comparison would be to have each parallel task compute the <code>length</code> of the k-bit numbers in its assigned range, and then add up the results. That way the k-bit numbers found by each parallel task wouldn't have to be kept in memory and would operate more like the sequential version.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is an example of how to use <code>parMap</code>. <strike>Note: under 7.10.2 I've had mixed success getting the parallelism to fire - sometimes it does and sometimes it doesn't.</strike> (Figured it out - I was using <code>-RTS -N2</code> instead of <code>+RTS -N2</code>.)</p>\n\n<pre><code>{-\ncompile with: ghc -O2 -threaded -rtsopts foo.hs\n\ncompare:\n\n  time ./foo 26 +RTS -N1\n  time ./foo 26 +RTS -N2\n-}\n\nimport Data.Bits    \nimport Control.Parallel.Strategies\nimport System.Environment\n\nnextKBitNumber :: Integer -&gt; Integer\nnextKBitNumber n\n  | n == 0      = 0\n  | otherwise   = ripple .|. ones\n                       where smallest     = n .&amp;. (-n)\n                             ripple       = n + smallest\n                             newSmallest  = ripple .&amp;. (-ripple)\n                             ones         = (newSmallest `div` smallest) `shiftR` 1 - 1\n\ncombs :: Int -&gt; Int -&gt; [Integer]\ncombs n k = takeWhile (&lt;= end) $ iterate nextKBitNumber start\n  where start = 2^k - 1\n        end   = shift start (n-k)\n\nmain :: IO ()\nmain = do\n  ( arg1 : _) &lt;- getArgs\n  let n = read arg1\n  print $ parMap rseq (length . combs n) [1..n]\n</code></pre>\n"}], "owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 1, "accepted_answer_id": 37746183, "answer_count": 2, "score": 2, "last_activity_date": 1465567924, "creation_date": 1465552353, "last_edit_date": 1495542243, "question_id": 37745191, "link": "https://stackoverflow.com/questions/37745191/haskell-parallel-code-is-slower-than-sequential-version", "title": "Haskell: Parallel code is slower than sequential version", "body": "<p>I am pretty new to Haskell threads (and parallel programming in general) and I am not sure why my parallel version of an algorithm runs slower than the corresponding sequential version.</p>\n\n<p>The algorithm tries to find all k-combinations without using recursion. For this, I am using <a href=\"https://stackoverflow.com/questions/506807/creating-multiple-numbers-with-certain-number-of-bits-set?lq=1\">this</a> helper function, which given a number with k bits set, returns the next number with the same number of bits set:</p>\n\n<pre><code>import Data.Bits    \n\nnextKBitNumber :: Integer -&gt; Integer\nnextKBitNumber n\n  | n == 0      = 0\n  | otherwise   = ripple .|. ones\n                       where smallest     = n .&amp;. (-n)\n                             ripple       = n + smallest\n                             newSmallest  = ripple .&amp;. (-ripple)\n                             ones         = (newSmallest `div` smallest) `shiftR` 1 - 1\n</code></pre>\n\n<p>It is now easy to obtain sequentially all k-combinations in the range [(2^k - 1), (2^(n-k)+...+ 2^(n-1)):</p>\n\n<pre><code>import qualified Data.Stream as ST\n\ncombs :: Int -&gt; Int -&gt; [Integer]\ncombs n k = ST.takeWhile (&lt;= end) $ kBitNumbers start\n  where start = 2^k - 1\n        end   = sum $ fmap (2^) [n-k..n-1]\n\nkBitNumbers :: Integer -&gt; ST.Stream Integer\nkBitNumbers = ST.iterate nextKBitNumber\n\nmain :: IO ()\nmain = do\n  params &lt;- getArgs\n  let n = read $ params !! 0\n      k = read $ params !! 1\n  print $ length (combs n k)\n</code></pre>\n\n<p>My idea is that this should be easily parallelizable splitting this range into smaller parts. For example:</p>\n\n<pre><code>start :: Int -&gt; Integer\nstart k = 2 ^ k - 1\n\nend :: Int -&gt; Int -&gt; Integer\nend n k = sum $ fmap (2 ^) [n-k..n-1]\n\nsplits :: Int -&gt; Int -&gt; Int -&gt; [(Integer, Integer, Int)]\nsplits n k numSplits = fixedRanges ranges []\n  where s                       = start k\n        e                       = end n k\n        step                    = (e-s) `div` (min (e-s) (toInteger numSplits))\n        initSplits              = [s,s+step..e]\n        ranges                  = zip initSplits (tail initSplits)\n        fixedRanges [] acc      = acc\n        fixedRanges [x] acc     = acc ++ [(fst x, e, k)]\n        fixedRanges (x:xs) acc  = fixedRanges xs (acc ++ [(fst x, snd x, k)])\n</code></pre>\n\n<p>At this point, I would like to run each split in parallel, something like:</p>\n\n<pre><code>runSplit :: (Integer, Integer, Int) -&gt; [Integer]\nrunSplit (start, end, k) = ST.takeWhile (&lt;= end) $ kBitNumbers (fixStart start)\n  where fixStart s\n                   | popCount s == k = s\n                   | otherwise       = fixStart $ s + 1\n</code></pre>\n\n<p>For pallalelization I am using the <code>monad-par</code> package:</p>\n\n<pre><code>import Control.Monad.Par\nimport System.Environment\nimport qualified Data.Set as S\n\nmain :: IO ()\nmain = do\n  params &lt;- getArgs\n  let n               = read $ params !! 0\n      k               = read $ params !! 1\n      numTasks        = read $ params !! 2\n      batches         = runPar $ parMap runSplit (splits n k numTasks)\n      reducedNumbers  = foldl S.union S.empty $ fmap S.fromList batches\n  print $ S.size reducedNumbers\n</code></pre>\n\n<p>The result is that the sequential version is way faster and it uses little memory, while the parallel version consumes a lot of memory and it is noticeable slower. </p>\n\n<p>What might be the reasons causing this? Are threads a good approach for this problem? For example, every thread generates a (potentially large) list of integers and the main thread reduces the results; are threads expected to need much memory or are simply meant to produce simple results (i.e. only cpu-intensive computations)?</p>\n\n<p>I compile my program with <code>stack build --ghc-options -threaded --ghc-options -rtsopts  --executable-profiling --library-profiling</code> and run it with <code>./.stack-work/install/x86_64-osx/lts-6.1/7.10.3/bin/combinatorics 20 3 4 +RTS -pa -N4 -RTS</code> for n=20, k=3 and numSplits=4. An example of the profiling report for the parallel version can be found <a href=\"https://gist.github.com/jarandaf/597bdbd3aa2023dc4e3f96b1524de0ec\" rel=\"nofollow noreferrer\">here</a> and for the sequential version <a href=\"https://gist.github.com/jarandaf/56a8685a2d156537b20d1daf628f973b\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": ["haskell", "types", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1465550646, "post_id": 37744238, "comment_id": 62959195, "body": "In GHC 8.0 it is rejected. I just tried <code>class D a where type G a ; bar :: G a -&gt; Int</code> and an ambiguity error is raised."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1465573406, "post_id": 37744238, "comment_id": 62973996, "body": "The same example compiles in GHC 8.0 with the <code>AllowAmbiguousTypes</code> extension. (Was that enabled, maybe by some other extension, in 7.8.3 ?)"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1465550414, "creation_date": 1465549638, "last_edit_date": 1495541755, "question_id": 37744238, "link": "https://stackoverflow.com/questions/37744238/why-are-unconditionally-ambiguous-methods-involving-type-families-not-rejected", "title": "Why are unconditionally ambiguous methods involving type families not rejected?", "body": "<p>I have the following declarations:</p>\n\n<pre><code>class NN a where\n  type Vector a :: *\n\n  vectorize :: Vector a -&gt; WordVector\n\n  compute :: a -&gt; SomeResult\n</code></pre>\n\n<p>In an instance of <code>NN</code>, I have this:</p>\n\n<pre><code>instance NN Model where \n  type Vector Model = Vec\n\n  compute m = ....  vectorize v ...\n</code></pre>\n\n<p><code>compute</code> uses <code>vectorize</code> but this fails to typecheck: GHC says it cannot unifies <code>Vector a0</code> with <code>Vec</code> and variable <code>a0</code> is ambiguous.</p>\n\n<p>I somehow understand why typechecking would fail in the general case of calling <code>vectorize</code> with only typeclass constraint: As type family <code>Vector</code> is open, there is no way, given a particular <code>Vector a</code> image to infer which <code>a</code> it is. Thanks to <a href=\"https://stackoverflow.com/questions/36175839/type-ambiguity-in-haskell-type-families\">this answer</a> I also can understand why it fail to typechecks in the particular case of a call from within a method defined in the same instance: At call site of <code>vectorize</code> there is no relationship between the <code>a</code> of <code>Vector a -&gt; WordVector</code> and the <code>a</code> of <code>compute</code>. </p>\n\n<p>What I don't understand is why the declaration of <code>vectorize</code> is not rejected by the compiler.  Following <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow noreferrer\">this page</a> and the referenced papers, I found the following statement in <a href=\"http://www.cse.unsw.edu.au/~chak/papers/CKP05.html\" rel=\"nofollow noreferrer\">this paper</a>:</p>\n\n<blockquote>\n  <p>Each method must mention the class variable somewhere that is not\n  under an associated synonym. For example, this declaration defines an\n  unconditionally-ambiguous method op, and is rejected: </p>\n\n<pre><code>  class C a where\n     type S a\n     op :: S a \u2192 Int\n</code></pre>\n</blockquote>\n\n<p>Edit: I am using GHC 7.8.3</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "existential-type"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1465558921, "post_id": 37743970, "comment_id": 62964303, "body": "&quot;something easy to code, extend and also simple and elegant&quot;. a true functional programmer!"}], "answers": [{"comments": [{"owner": {"reputation": 1164, "user_id": 113183, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59d2dd3f9614e3016877a70a6fa3607a?s=128&d=identicon&r=PG", "display_name": "fusion", "link": "https://stackoverflow.com/users/113183/fusion"}, "edited": false, "score": 0, "creation_date": 1465553542, "post_id": 37745373, "comment_id": 62960946, "body": "+1 and a thank you for answering the first and the third question. I didn&#39;t think of using scala&#39;s bottom type Nothing but it seems that it works!"}, {"owner": {"reputation": 1164, "user_id": 113183, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59d2dd3f9614e3016877a70a6fa3607a?s=128&d=identicon&r=PG", "display_name": "fusion", "link": "https://stackoverflow.com/users/113183/fusion"}, "edited": false, "score": 0, "creation_date": 1465554076, "post_id": 37745373, "comment_id": 62961272, "body": "Note: you can skip <code>val p = this</code> by using a self type in the trait"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1465552825, "creation_date": 1465552825, "answer_id": 37745373, "question_id": 37743970, "link": "https://stackoverflow.com/questions/37743970/how-to-express-function-type/37745373#37745373", "title": "How to express Function type?", "body": "<h2>Question 1</h2>\n\n<p>I think that you are right, and here is why: <code>Zero1</code> below prints <code>hello</code> every time you use it. The solution, <code>Zero2</code>, involves using a <code>val</code> instead.</p>\n\n<pre><code>def Zero1[A]: Parser[A] = { println(\"hi\"); str =&gt; List() }\nval Zero2: Parser[Nothing] = str =&gt; List()\n</code></pre>\n\n<h2>Question 2</h2>\n\n<p>No idea. I'm still just starting out with Scala. Hope someone answers this.</p>\n\n<h2>Question 3</h2>\n\n<p>The trait one will play better with Scala's <code>for</code> (since you can define custom <code>flatMap</code> and <code>map</code>), which turns out to be (somewhat) like Haskell's <code>do</code>. The following is all you need.</p>\n\n<pre><code>trait Parser[A] extends (String =&gt; List[(A, String)]) {\n  def flatMap[B](f: A =&gt; Parser[B]): Parser[B] = {\n      val p1 = this\n      new Parser[B] {\n        def apply(s1: String) = for {\n          (a,s2) &lt;- p1(s1)\n          p2 = f(a)\n          (b,s3) &lt;- p2(s2)\n      } yield (b,s3)\n    }\n  }\n\n  def map[B](f: A =&gt; B): Parser[B] = {\n    val p = this\n    new Parser[B] {\n      def apply(s1: String) = for ((a,s2) &lt;- p(s1)) yield (f(a),s2) \n    }\n  }\n}\n</code></pre>\n\n<p>Of course, to do anything interesting you need more parsers. I'll propose to you one simple parser combinator: <code>Choice(p1: Parser[A], p2: Parser[A]): Parser[A]</code> which tries both parsers. (And rewrite your existing parsers more to my style).</p>\n\n<pre><code>def choice[A](p1: Parser[A], p2: Parser[A]): Parser[A] = new Parser[A] {\n  def apply(s: String): List[(A,String)] = { p1(s) ++ p2(s) }\n}\n\ndef unit[A](x: A): Parser[A] = new Parser[A] {\n  def apply(s: String): List[(A,String)] = List((x,s))\n}\n\nval character: Parser[Char] = new Parser[Char] {\n  def apply(s: String): List[(Char,String)] = List((s.head,s.tail))\n}\n</code></pre>\n\n<p>Then, you can write something like the following:</p>\n\n<pre><code>val parser: Parser[(Char,Char)] = for {\n  x &lt;- choice(unit('x'),char)\n  y &lt;- char\n} yield (x,y)\n</code></pre>\n\n<p>And calling <code>parser(\"xyz\")</code> gives you <code>List((('x','x'),\"yz\"), (('x','y'),\"z\"))</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1164, "user_id": 113183, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59d2dd3f9614e3016877a70a6fa3607a?s=128&d=identicon&r=PG", "display_name": "fusion", "link": "https://stackoverflow.com/users/113183/fusion"}, "edited": false, "score": 0, "creation_date": 1465560003, "post_id": 37745516, "comment_id": 62964968, "body": "I was also thinking about polymorphic values but I don&#39;t know if you can do something like that in scala. +1 for the covariance"}], "tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": false, "score": 2, "last_activity_date": 1465554893, "last_edit_date": 1465554893, "creation_date": 1465553275, "answer_id": 37745516, "question_id": 37743970, "link": "https://stackoverflow.com/questions/37743970/how-to-express-function-type/37745516#37745516", "title": "How to express Function type?", "body": "<p>Note: I didn't compile it, but I know the problem and can propose two solutions.</p>\n\n<ol>\n<li><p>The more Haskellish way would be to not use subtyping, but to define <code>zero</code> as a polymorphic value. In that style, I would propose to define parsers not as <code>object</code>s deriving from a function type, but as values of one case class:</p>\n\n<pre><code>final case class Parser[T](run: String =&gt; List[(T, String)])\ndef zero[T]: Parser[T] = Parser(...)\n</code></pre>\n\n<p>As shown by @Alec, yes, this will produce a new value every time, since a <code>def</code> is compiled to a method.</p></li>\n<li><p>If you want to use subtyping, you need to make <code>Parser</code> covariant. Then you can give <code>zero</code> a bottom result type:</p>\n\n<pre><code>trait Parser[+A] extends (String =&gt; List[(A, String)])\ncase object Zero extends Parser[Nothing] {...}\n</code></pre></li>\n</ol>\n\n<p>These are in some way quite related; in system F_&lt;:, which is the base of what Scala uses, the types <code>_|_</code> (aka <code>Nothing</code>) and <code>\\/T &lt;: Any. T</code> behave the same (this hinted at in <em>Types and Programming Languages</em>, chapter 28). The two possibilities given here are a consequence of this fact.</p>\n\n<p>With existentials I'm not so familiar with, but I think that while unbounded <code>T forSome {type T}</code> will behave like <code>Nothing</code>, Scala does not allow inhertance from an existential type.</p>\n"}], "owner": {"reputation": 1164, "user_id": 113183, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59d2dd3f9614e3016877a70a6fa3607a?s=128&d=identicon&r=PG", "display_name": "fusion", "link": "https://stackoverflow.com/users/113183/fusion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1465589209, "creation_date": 1465548833, "last_edit_date": 1465589209, "question_id": 37743970, "link": "https://stackoverflow.com/questions/37743970/how-to-express-function-type", "title": "How to express Function type?", "body": "<p>I am currently reading Hutton's and Meijer's paper on parsing combinators in Haskell <a href=\"http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf\" rel=\"nofollow\">http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf</a>. For the sake of it I am trying to implement them in scala. I would like to construct something easy to code, extend and also simple and elegant. I have come up with two solutions for the following haskell code</p>\n\n<pre><code>/* Haskell Code */\ntype Parser a = String -&gt; [(a,String)]\n\nresult :: a -&gt; Parser a\nresult v = \\inp -&gt; [(v,inp)]\n\nzero :: Parser a\nzero = \\inp -&gt; []\n\nitem :: Parser Char\nitem = \\inp -&gt; case inp of\n            [] -&gt; []\n            (x:xs) -&gt; [(x,xs)]\n\n\n/* Scala Code */\nobject Hutton1  {\n\n  type Parser[A] = String =&gt; List[(A, String)]\n\n  def Result[A](v: A): Parser[A] = str =&gt; List((v, str))\n  def Zero[A]: Parser[A] = str =&gt; List()\n  def Character: Parser[Char] = str =&gt; if (str.isEmpty) List() else List((str.head, str.tail))\n\n}\n\nobject Hutton2 {\n  trait Parser[A] extends (String =&gt; List[(A, String)])\n\n  case class Result[A](v: A) extends Parser[A] {\n    def apply(str: String) = List((v, str))\n  }\n\n  case object Zero extends Parser[T forSome {type T}] {\n    def apply(str: String) = List()\n  }\n\n  case object Character extends Parser[Char] {\n    def apply(str: String) = if (str.isEmpty) List() else List((str.head, str.tail))\n  }\n}\n\n\nobject Hutton extends App {\n  object T1 {\n    import Hutton1._\n\n    def run = {\n      val r: List[(Int, String)] = Zero(\"test\") ++ Result(5)(\"test\")\n      println(r.map(x =&gt; x._1 + 1) == List(6))\n      println(Character(\"abc\") == List(('a', \"bc\")))\n    }\n  }\n\n  object T2 {\n    import Hutton2._\n\n    def run = {\n      val r: List[(Int, String)] = Zero(\"test\") ++ Result(5)(\"test\")\n      println(r.map(x =&gt; x._1 + 1) == List(6))\n      println(Character(\"abc\") == List(('a', \"bc\")))\n    }\n  }\n\n  T1.run\n  T2.run\n}\n</code></pre>\n\n<h2>Question 1</h2>\n\n<p>In Haskell, zero is a function value that can be used as it is, expessing all failed parsers whether they are of type Parser[Int] or Parser[String]. In scala we achieve the same by calling the function Zero (1st approach) but in this way I believe that I just generate a different function everytime Zero is called. Is this statement true? Is there a way to mitigate this?</p>\n\n<h2>Question 2</h2>\n\n<p>In the second approach, the Zero case object is extending Parser with the usage of existential <code>types Parser[T forSome {type T}]</code> . If I replace the type with <code>Parser[_]</code> I get the compile error </p>\n\n<pre><code>Error:(19, 28) class type required but Hutton2.Parser[_] found\n      case object Zero extends Parser[_] {\n                           ^\n</code></pre>\n\n<p>I thought these two expressions where equivalent. Is this the case?</p>\n\n<h2>Question 3</h2>\n\n<p>Which approach out of the two do you think that will yield better results in expressing the combinators in terms of elegance and simplicity?</p>\n\n<p>I use scala 2.11.8</p>\n"}, {"tags": ["macos", "haskell", "ghc", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 4990, "user_id": 768535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ee0e32ea742d995b5d4de9de32a437c?s=128&d=identicon&r=PG", "display_name": "Wilbur Vandrsmith", "link": "https://stackoverflow.com/users/768535/wilbur-vandrsmith"}, "edited": false, "score": 0, "creation_date": 1467068560, "post_id": 38037808, "comment_id": 63567905, "body": "From the output of <code>nm</code>, OS X does use the underscore prefix on symbols. The 7.10.3 build was from stack, which I think uses official GHC builds. GHC 8.0.1 does indeed work without issue!"}], "tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": true, "score": 1, "last_activity_date": 1466938803, "creation_date": 1466938803, "answer_id": 38037808, "question_id": 37739590, "link": "https://stackoverflow.com/questions/37739590/calling-dynamic-libraries-from-c-sources-fails-in-ghci/38037808#38037808", "title": "Calling dynamic libraries from c-sources fails in ghci", "body": "<p>That's peculiar.. I don't know much about OSX but <code>dyld: lazy symbol binding failed: Symbol not found: _zlibVersion</code> gives the impression It thinks OSX is an underscore platform (e.g. one where C functions are mangled with an _). </p>\n\n<p>Is this a standard GHC build? and can you try with <code>8.0.1</code>? lots has changed in the linker.</p>\n"}], "owner": {"reputation": 4990, "user_id": 768535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ee0e32ea742d995b5d4de9de32a437c?s=128&d=identicon&r=PG", "display_name": "Wilbur Vandrsmith", "link": "https://stackoverflow.com/users/768535/wilbur-vandrsmith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 38037808, "answer_count": 1, "score": 2, "last_activity_date": 1466938803, "creation_date": 1465530726, "question_id": 37739590, "link": "https://stackoverflow.com/questions/37739590/calling-dynamic-libraries-from-c-sources-fails-in-ghci", "title": "Calling dynamic libraries from c-sources fails in ghci", "body": "<p>I have some C functions from a dynamic library (just <code>zlibVersion</code> here) that I'd like to call from bundled C code in a cabal package. Here I call it both directly as a foreign import and indirectly through the bundled C code to show that the latter crashes ghci, even after the former succeeds.</p>\n\n<p>Main.hs:</p>\n\n<pre><code>module Main (main) where\n\nimport Foreign.C.String (CString, peekCString)\n\nforeign import ccall \"foreign_test\" foreignTest :: IO ()\nforeign import ccall \"zlibVersion\" zlibVersion :: IO CString\n\nmain :: IO ()\nmain = do\n  zlibVersion &gt;&gt;= peekCString &gt;&gt;= putStrLn\n  foreignTest\n</code></pre>\n\n<p>foreign_test.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;zlib.h&gt;\n\nvoid foreign_test() {\n    puts(zlibVersion());\n}\n</code></pre>\n\n<p>It works fine from a compiled binary:</p>\n\n<pre><code>$ cabal build\n$ dist/build/cabal-extra-libs-test/cabal-extra-libs-test\n1.2.5\n1.2.5\n</code></pre>\n\n<p>But the indirect call crashes ghci:</p>\n\n<pre><code>$ cabal repl\nPreprocessing executable 'cabal-extra-libs-test' for\ncabal-extra-libs-test-0.1.0.0...\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Main.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; main\n1.2.5\ndyld: lazy symbol binding failed: Symbol not found: _zlibVersion\n  Referenced from: /var/folders/pz/920gzhqn01q8d6vjkvy1yvdr0000gn/T/ghc6850_0/libghc_1.dylib\n  Expected in: flat namespace\n\ndyld: Symbol not found: _zlibVersion\n  Referenced from: /var/folders/pz/920gzhqn01q8d6vjkvy1yvdr0000gn/T/ghc6850_0/libghc_1.dylib\n  Expected in: flat namespace\n</code></pre>\n\n<p>cabal-extra-libs-test.cabal:</p>\n\n<pre><code>name:                cabal-extra-libs-test\nversion:             0.1.0.0\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable cabal-extra-libs-test\n  default-language: Haskell2010\n  main-is: Main.hs\n  build-depends: base\n\n  c-sources: foreign_test.c\n  extra-libraries: z\n</code></pre>\n\n<p>GHC is 7.10.3 with cabal-install 1.24.0.0 on OS X 10.11.5. Building with stack and stack ghci produces the same crash.</p>\n"}, {"tags": ["parsing", "haskell", "applicative", "command-line-arguments"], "answers": [{"tags": [], "owner": {"reputation": 1358, "user_id": 107512, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2f64d9c4e3a6c51170fac46f54093953?s=128&d=identicon&r=PG", "display_name": "Daniel Chambers", "link": "https://stackoverflow.com/users/107512/daniel-chambers"}, "is_accepted": true, "score": 4, "last_activity_date": 1465528934, "creation_date": 1465528934, "answer_id": 37739395, "question_id": 37739087, "link": "https://stackoverflow.com/questions/37739087/haskell-optparse-applicative-parsing-a-list-of-records-that-have-multiple-field/37739395#37739395", "title": "haskell optparse-applicative: parsing a list of records that have multiple fields", "body": "<p>If you use a subparser with the <code>Alternative</code> typeclass's <code>some</code> function, you can get the effect you're looking for, admittedly with a slightly different command line syntax.</p>\n\n<pre><code>thingSubparser :: Parser ThingINeedMulitpleOf\nthingSubparser = subparser $ command \"thing\" (info thingParser mempty)\n\nloadConfig :: IO Config\nloadConfig = execParser $ info (Config &lt;$&gt; some thingSubparser) fullDesc\n</code></pre>\n\n<p>With this you can write command lines like: </p>\n\n<pre><code>my-exe thing test --mode Mode1 thing test2 --mode Mode2\n</code></pre>\n\n<p>which yield the Config object:</p>\n\n<pre><code>Config [Thing {_name = \"test\", _mode = Mode1},Thing {_name = \"test2\", _mode = Mode2}]\n</code></pre>\n\n<p>I'm not quite sure why you need the subparser and can't just use <code>some</code> against the <code>thingParser</code>, but if I had to guess it'd be because the command gives the parser a delimiter (the \"thing\" argument/command name).</p>\n"}], "owner": {"reputation": 365, "user_id": 1560138, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/370b89d2b931def9f3df67326283b295?s=128&d=identicon&r=PG", "display_name": "tmortiboy", "link": "https://stackoverflow.com/users/1560138/tmortiboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 37739395, "answer_count": 1, "score": 3, "last_activity_date": 1465528934, "creation_date": 1465526162, "question_id": 37739087, "link": "https://stackoverflow.com/questions/37739087/haskell-optparse-applicative-parsing-a-list-of-records-that-have-multiple-field", "title": "haskell optparse-applicative: parsing a list of records that have multiple fields", "body": "<p>If I have the following types and parser: </p>\n\n<pre><code>data Mode = \n     Mode1 \n   | Mode2 \n   deriving (Show, Eq, Read)\n\ndata ThingINeedMulitpleOf = \n   Thing { _name :: String, _mode :: Mode }\n   deriving (Show, Eq)\n\nthingParser :: Parser ThingINeedMulitpleOf\nthingParser = Thing &lt;$&gt; strArgument (metavar \"NAME\")\n                    &lt;*&gt; option auto (long \"mode\" &lt;&gt; metavar \"MODE\")\n</code></pre>\n\n<p>and I build a parser in the following way:</p>\n\n<pre><code>data Config = \n   Config ThingINeedMulitpleOf ThingINeedMulitpleOf\n   deriving (Show, Eq)\n\nloadConfig = execParser $ info (Config &lt;$&gt; thingParser &lt;*&gt; thingParser) fullDesc\n</code></pre>\n\n<p>then I can successfully parse <code>my-exe Thing1 --mode Mode1 Thing2 --mode Mode2</code> but this is only useful if I want exactly two <code>Things</code>.\nI'm running into problems when trying to change the <code>Config</code> to support <em>n</em> <code>Thing</code>s, ie:</p>\n\n<pre><code>data Config = \n   Config [ThingINeedMulitpleOf]\n   deriving (Show, Eq)\n\nloadConfig = execParser $ info (Config &lt;$&gt; many thingParser) fullDesc\n</code></pre>\n\n<p>but I can now no longer parse <code>my-exe Thing1 --mode Mode1 Thing2 --mode Mode2</code>, giving me the error <code>Invalid argument 'Thing1'</code></p>\n\n<p>Interestingly, this works if the <code>ThingINeedMulitpleOf</code> only contains one field.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "edited": false, "score": 0, "creation_date": 1465537402, "post_id": 37739280, "comment_id": 62951786, "body": "This is very helpful. <code>string&#39; :: forall s u (m :: * -&gt; *). Stream s m Char =&gt; [Char] -&gt; ParsecT s u m [Char]</code> became <code>string&#39; :: String -&gt; Parser String</code>, and most of the others became <code>Parser Node</code>, <code>Parser String</code> or <code>Parser ()</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1465530792, "last_edit_date": 1465530792, "creation_date": 1465528000, "answer_id": 37739280, "question_id": 37739029, "link": "https://stackoverflow.com/questions/37739029/understanding-parsec-type-annotations/37739280#37739280", "title": "Understanding parsec type annotations", "body": "<p>I'm no expert with <code>parsec</code>, so I'll let someone else do the heavy lifting if they want to explain the types, but here are some thoughts:</p>\n\n<p>Generally packages try to export more friendly type synonyms. In this case, you can use</p>\n\n<pre><code>type Parsec s u = ParsecT s u Identity -- in Text.Parsec.Prim\ntype Parser = Parsec String ()         -- in Text.Parsec.String\n</code></pre>\n\n<p>so that gets you <code>vimL :: Parser Node</code>, which should make more sense - it is a parser that can be run on a <code>String</code> to produce a <code>Node</code>.</p>\n\n<p><code>forall</code> gets <em>you</em> very little in this context, which is why there are friendly type synonyms available, which you should use. However, I'm willing to bet that in its own guts <code>parsec</code> makes heavy use of higher-rank types, which cannot be expressed without the <code>forall</code> and this is why the signatures GHC proposes to you have an explicit <code>forall</code>.</p>\n\n<p>(Briefly, <code>forall x. &lt;something-with-x&gt;</code> is the same as <code>&lt;some-thing-with-x&gt;</code> but if you have the <code>forall</code> in the middle of the signature, things get much nastier.)</p>\n\n<h1>EDIT</h1>\n\n<p>Some stuff on <code>parsec</code> (<a href=\"https://hackage.haskell.org/package/parsec-3.1.1\" rel=\"nofollow\">from the documentation</a>). The type <code>ParsecT s u m a</code> represents the most general parser possible. Reading the comments in <a href=\"https://hackage.haskell.org/package/parsec-3.1.1/docs/src/Text-Parsec-Prim.html#State\" rel=\"nofollow\">the source</a> helps.</p>\n\n<ul>\n<li><code>s</code> describes the stream type. A parser in the abstract sense takes a sequence of symbols and converts them into some structured output form.</li>\n<li><code>a</code> is the type of the output form.</li>\n<li><code>u</code> is the user state type. <code>parsec</code> already keeps track of some state information (like your position in the text so that it can give you back a meaningful parse error message) so it makes sense to let the user package in some state they would like carried along (there is an example of this in <a href=\"http://research.microsoft.com/en-us/um/people/daan/download/parsec/parsec.pdf\" rel=\"nofollow\">2.12 Advanced: User State</a>)</li>\n<li><code>m</code> is the underlying monad in which things are being run. I think this part will be evident iff you grok monads...</li>\n</ul>\n\n<p>Then, a couple special cases arise:</p>\n\n<ul>\n<li>Taking <code>m = Identity</code> means that we don't need a monadic context of execution. (The <code>Parsec s u a</code> type synonym is for this case.)</li>\n<li>Taking <code>u = ()</code> means that we don't need to hold any state information.</li>\n<li>Taking <code>s = String</code> means our input (stream) will be a string. (Combined with the other two options above, that is what the <code>Parser a</code> type synonym is for.)</li>\n</ul>\n\n<p>Finally, <code>string' :: forall s u (m :: * -&gt; *). Stream s m Char =&gt; [Char] -&gt; ParsecT s u m [Char]</code> means that the output is a <code>String = [Char]</code>, and the user state, monadic context, and input can be anything - provided they satisfy some conditions, hence the <code>Stream s m Char</code> constraint.</p>\n\n<p>That constraint <a href=\"https://hackage.haskell.org/package/parsec-3.1.1/docs/Text-Parsec-Prim.html#t:Stream\" rel=\"nofollow\"><code>Stream s m t</code></a> means that you must be able to \"unfold\" the stream input type <code>s</code> into an <code>m (Maybe (t,s))</code>. The <code>m</code> part means that this unfolding can occur in a monadic context, the <code>Maybe</code> part deals with the fact that you can unfold only as long as you have input, the <code>t</code> is token you are taking off the front of the stream, and <code>s</code> is the remainder of the stream. Finally, the type of the stream <code>s</code> has to uniquely identify the type of the token <code>t</code> coming out, so there is a functional dependency <code>s -&gt; t</code>.</p>\n"}], "owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 37739280, "answer_count": 1, "score": 2, "last_activity_date": 1465530792, "creation_date": 1465525717, "question_id": 37739029, "link": "https://stackoverflow.com/questions/37739029/understanding-parsec-type-annotations", "title": "Understanding parsec type annotations", "body": "<p>I'm using <a href=\"http://hackage.haskell.org/package/parsec\" rel=\"nofollow\">parsec</a> to parse some source code into an AST. I recently turned on the <code>-Wall</code> and <code>-W</code> options in order to catch \"suspicious\" code, and it is complaining about many of <a href=\"https://github.com/wincent/docvim/blob/3361f152da6e0bd93034a8367d079a30be35b451/lib/Docvim/Parse.hs\" rel=\"nofollow\">the parsec-related top-level functions in this file</a> not having explicit type extensions.</p>\n\n<h1>Example 1</h1>\n\n<pre><code>vimL = choice [ block\n              , statement\n              ]\n</code></pre>\n\n<p>The inferred type here is:</p>\n\n<pre><code>vimL :: ParsecT String () Data.Functor.Identity.Identity Node\n</code></pre>\n\n<p>So, if I add that annotation, the compiler complains about not having access to <code>Data.Functor.Identity.Identity</code>, which means I have to <code>import</code> it:</p>\n\n<pre><code>import Data.Functor.Identity\n</code></pre>\n\n<p>And if I do that, I can simplify the type annotation to:</p>\n\n<pre><code>vimL :: ParsecT String () Identity Node\n</code></pre>\n\n<p>and the compiler will still accept it. But it's still not something I understand very deeply.</p>\n\n<h1>Example 2</h1>\n\n<pre><code>link = Link &lt;$&gt; (bar *&gt; linkText &lt;* bar)\n  where\n    bar      = char '|'\n    linkText = many1 $ noneOf \" \\t\\n|\"\n</code></pre>\n\n<p>The inferred type here is:</p>\n\n<pre><code>link :: forall u.\n         ParsecT String u Data.Functor.Identity.Identity Node\n</code></pre>\n\n<p>But I can't use that unless I also use:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>Note that I can dispense with that if I drop the <code>forall</code>. Both of these work:</p>\n\n<pre><code>link :: ParsecT String u Data.Functor.Identity.Identity Node\nlink :: ParsecT String u Identity Node\n</code></pre>\n\n<h1>Example 3</h1>\n\n<pre><code>string' s = mapM_ char' s &gt;&gt; pure s &lt;?&gt; s\n</code></pre>\n\n<p>This one's inferred type is:</p>\n\n<pre><code>string' :: forall s u (m :: * -&gt; *).\n            Stream s m Char =&gt;\n             [Char] -&gt; ParsecT s u m [Char]\n</code></pre>\n\n<p>In order to use that one, I need both:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE KindSignatures #-}\n</code></pre>\n\n<p>But again, if I drop the <code>forall</code> I can simplify the type to the following and the compiler still accepts it:</p>\n\n<pre><code>string' :: Stream s m Char =&gt; [Char] -&gt; ParsecT s u m [Char]\n</code></pre>\n\n<p>Not very simple, though. Going further and dropping the constaint:</p>\n\n<pre><code>string' :: [Char] -&gt; ParsecT s u m [Char]\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>No instance for (Stream s m Char) arising from a use of \u2018char'\u2019\n</code></pre>\n\n<p>I thought:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n</code></pre>\n\n<p>might get me out of that, but it does not.</p>\n\n<h1>Questions</h1>\n\n<p>These mostly go over my head, so I don't want to blindly copy-paste the inferred type signatures in without gaining some more insight first. Can anybody shed some light on what these mean, what would be the best practices for annotating parsec-heavy code, what does the <code>forall</code> buy me if it can be omitted without causing any compiler errors, and whether there are any aliasing tricks that I can employ to make these more readable?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1465528738, "post_id": 37739026, "comment_id": 62949274, "body": "Your mistake is in capitalization.  <code>Word8</code> not <code>word8</code>.  Lower case types are type <i>variables</i> - as in, they are fully polymorphic.  Also, numeric literals don&#39;t need to be converted."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1465531052, "post_id": 37739026, "comment_id": 62949777, "body": "or maybe more to the point the <code>fromInteger</code> is called for you by GHC(i) when you are using a numeric literal in code"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1465531163, "post_id": 37739026, "comment_id": 62949806, "body": "btw: please include the errors you get in your message - I&#39;m not sure here if I understand your problem correctly (is it a type in your actual code - as Thomas pointed out - or just when you copied it here?)"}, {"owner": {"reputation": 43, "user_id": 1730519, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/53b271c6613a4e82e62252b7bf95b6e7?s=128&d=identicon&r=PG", "display_name": "river226", "link": "https://stackoverflow.com/users/1730519/river226"}, "edited": false, "score": 0, "creation_date": 1465590288, "post_id": 37739026, "comment_id": 62982631, "body": "Added Error message and more detail"}, {"owner": {"reputation": 43, "user_id": 1730519, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/53b271c6613a4e82e62252b7bf95b6e7?s=128&d=identicon&r=PG", "display_name": "river226", "link": "https://stackoverflow.com/users/1730519/river226"}, "edited": false, "score": 0, "creation_date": 1465590459, "post_id": 37739026, "comment_id": 62982691, "body": "It looks like the word8 vs. Word8 typo might have been the issue. testing."}], "owner": {"reputation": 43, "user_id": 1730519, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/53b271c6613a4e82e62252b7bf95b6e7?s=128&d=identicon&r=PG", "display_name": "river226", "link": "https://stackoverflow.com/users/1730519/river226"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 630, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1465590882, "creation_date": 1465525706, "last_edit_date": 1465590882, "question_id": 37739026, "link": "https://stackoverflow.com/questions/37739026/converting-int-into-word-8-in-haskell", "title": "Converting Int into Word 8 in Haskell", "body": "<p>So I am working on a project to help me get more comfy with Haskell, and possibly do some cool stuff. I am pulling in binary .MP3 files, and turning them into word8 arrays, but am running into a problem pulling off the bitwise operations.</p>\n\n<p>I have boiled down the necessary operation to simple constant functions like this below, using a function from the Data.Word module, but am having trouble pulling up the specific Word8 instance and function:</p>\n\n<pre><code>one :: Word8\none = fromInteger 1\n</code></pre>\n\n<p>I am using the function from <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Word.html#line-98\" rel=\"nofollow\">this</a>, but I am not having a Word8 Typed returned.</p>\n\n<p>Now since I am fairly new to Haskell, and come from the very different OOP world I may be completely missing the easy answer, or obvious reason for this, but I feel I am just missing a simple import or deceleration. Can anyone tell me what I am doing wrong, or at least point me in the right direction?</p>\n\n<p>Edit:\nError I get:</p>\n\n<pre><code>Iom.hs:13:7:\nNo instance for (Num word8) arising from a use of `fromInteger'\nPossible fix:\n  add (Num word8) to the context of\n    the type signature for one :: word8\nIn the expression: fromInteger 1\nIn an equation for `one': one = fromInteger 1\n</code></pre>\n\n<p>When I tried \"Num Word8\" as:</p>\n\n<pre><code>zero :: Num Word8\nzero = fromInteger 0\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>Iom.hs:12:8:\nExpected a type, but `Num Word8' has kind `GHC.Prim.Constraint'\nIn the type signature for `one': one :: Num Word8\n</code></pre>\n\n<p>Edit 2:</p>\n\n<p>Looks like this was the result of using \"word8\" instead of \"Word8\" for the type. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1465517241, "post_id": 37737900, "comment_id": 62946904, "body": "Per @melpomene&#39;s suggestion, perhaps you want <code>listToTups = map (id &amp;&amp;&amp; sum)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465517076, "post_id": 37737988, "comment_id": 62946880, "body": "That should probably be <code>foldl</code>, not <code>scanl</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465517146, "post_id": 37737988, "comment_id": 62946893, "body": "@melpomene Well, that type-checks at least! So I&#39;d say that&#39;s a pretty good guess."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1465517189, "post_id": 37737988, "comment_id": 62946896, "body": "Well, and the <code>foldl</code> should be a <code>foldr</code>, and then the whole thing turns into a <code>map</code>. :-)"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1465526641, "post_id": 37737988, "comment_id": 62948873, "body": "I understand my mistake now. I should have used the <code>map</code> function instead. What is scan actually used for in the real world?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1465516578, "creation_date": 1465516578, "answer_id": 37737988, "question_id": 37737900, "link": "https://stackoverflow.com/questions/37737900/cannot-scan-list-of-numbers-into-list-of-tuples/37737988#37737988", "title": "Cannot scan list of numbers into list of tuples", "body": "<p>Since</p>\n\n<pre><code>scanl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>and you demand that</p>\n\n<pre><code>scanl _ _ :: Num c =&gt; [[c]] -&gt; [([c], c)]\n</code></pre>\n\n<p>we conclude that <code>b</code> must be <code>([c], c)</code> (by unifying the return type of <code>scanl</code> and the return type of the supplied type signature). However, you also demand that</p>\n\n<pre><code>scanl _ []\n</code></pre>\n\n<p>be well-typed, from which we conclude that <code>b</code> must be <code>[d]</code> (by unifying the type of the second argument to <code>scanl</code> and the type of <code>[]</code>). These two constraints -- that <code>b</code> be a tuple type and that <code>b</code> be a list type -- are not compatible.</p>\n\n<p>Your description of what you're trying to achieve isn't so clear to me, and it's not immediately obvious from the code, either, so I can't offer much advice on how to fix it. I can only hope that the above description of the problem is clear enough that it helps you see a solution for yourself.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 37737988, "answer_count": 1, "score": 1, "last_activity_date": 1465526319, "creation_date": 1465515897, "last_edit_date": 1465526319, "question_id": 37737900, "link": "https://stackoverflow.com/questions/37737900/cannot-scan-list-of-numbers-into-list-of-tuples", "title": "Cannot scan list of numbers into list of tuples", "body": "<p>I'm trying to scan a list of lists and return a list of 2-tuples, the first item the sublist, and the second the sum of the sublist. Here is the function:</p>\n\n<pre><code>listToTups :: (Num a) =&gt; [[a]] -&gt; [([a], a)]\nlistToTups x = scanl (\\acc item -&gt; (item, sum item) : acc) [] x\n</code></pre>\n\n<p>When I try to compile I get this error:</p>\n\n<pre><code>Couldn't match expected type `([a], a)' with actual type `[a0]'\n    In the second argument of `scanl', namely `[]'\n    In the expression:\n      scanl (\\ acc item -&gt; (item, sum item) : acc) [] x\n</code></pre>\n\n<p>This doesn't make sense since the lambda function is clearly returning a list of tuples. What am I doing wrong?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>This is what I'm trying to do. Given a list of [Int], I want to return a list of 2-tuples, the first element being the sublist itself, and the second being the sum. So something like:</p>\n\n<pre><code>[[1,2,3], [4,5,6]] -&gt; [([1,2,3], 6), ([4,5,6], 15)]\n</code></pre>\n\n<p>How can I do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1465502123, "post_id": 37734954, "comment_id": 62941411, "body": "try adding some parentheses: <code>main = putStr (show (mySum [1..5]))</code>. function application is left associative."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1465542255, "post_id": 37734954, "comment_id": 62954117, "body": "First impression of the title: you are trying to print a function (not the value you get when you apply the function). You could easily arrive at the solution by realizing that you want to simply print an <code>Int</code> not a function. Like <code>print n</code> (<code>print = putStrLn . show</code>) and then substitute for <code>n</code>: <code>print (mySum [1..5])</code>. I used <code>print</code> for simplicity but you can just as easily use <code>putStr . show</code> or anything else."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1465512975, "post_id": 37735071, "comment_id": 62945926, "body": "This is all great advice (I upvoted the answer), but I have to ask, why the hybrid answer for number 2....  If using the <code>($)</code>, why not go the whole way with <code>putStr $ show $ mySum [1..5]</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1465514255, "post_id": 37735071, "comment_id": 62946260, "body": "I was thinking <code>putStr $ show $ mySum $ [1..5]</code> (although the last one is really unnecessary) would be too much new operator at once, so limited myself to using it just once to replace one set of parentheses."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 14, "last_activity_date": 1465502455, "last_edit_date": 1465502455, "creation_date": 1465502118, "answer_id": 37735071, "question_id": 37734954, "link": "https://stackoverflow.com/questions/37734954/print-function-that-returns-int/37735071#37735071", "title": "Print function that returns int", "body": "<p>Because function application is left-associative, <code>putStr show mySum [1..5]</code> is implicitly parenthesized as <code>((putStr show) mySum) [1..5]</code>. There are a few options; some are listed below.</p>\n\n<ol>\n<li>Parenthesize explicitly: <code>putStr (show (mySum [1..5]))</code></li>\n<li>Use the <em>right</em>-associative function application operator <code>$</code>; one example is <code>putStr $ show (mySum [1..5])</code></li>\n<li>Use composition with <code>$</code>: <code>putStr . show . mySum $ [1..5]</code></li>\n<li>Use composition with parentheses: <code>(putStr . show . mySum) [1..5]</code></li>\n</ol>\n"}], "owner": {"reputation": 15768, "user_id": 3122885, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/fe1eced7899a319fb446e04b63ac7eea?s=128&d=identicon&r=PG&f=1", "display_name": "octavian", "link": "https://stackoverflow.com/users/3122885/octavian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1478, "favorite_count": 0, "accepted_answer_id": 37735071, "answer_count": 1, "score": -2, "last_activity_date": 1465502455, "creation_date": 1465501703, "question_id": 37734954, "link": "https://stackoverflow.com/questions/37734954/print-function-that-returns-int", "title": "Print function that returns int", "body": "<p>In Haskell, I am trying to print a method which returns an <code>Int</code>. For now, <code>mySum</code> is just a stub because I'm trying to figure out how to print it.</p>\n\n<p>I looked up how to do this and I saw <code>putStr</code> can print a <code>String</code> and show converts an <code>Int</code> to a <code>String</code> so I did this:</p>\n\n<pre><code>mySum :: [Int] -&gt; Int\nmySum _ = 0\n\nmain = putStr show mySum [1..5]\n</code></pre>\n\n<p>However, I am getting these errors:</p>\n\n<pre><code>Couldn't match expected type \u2018([Int] -&gt; Int) -&gt; [Integer] -&gt; t\u2019\n                with actual type \u2018IO ()\u2019\n    Relevant bindings include main :: t (bound at weirdFold.hs:10:1)\n    The function \u2018putStr\u2019 is applied to three arguments,\n    but its type \u2018String -&gt; IO ()\u2019 has only one\n    In the expression: putStr show mySum [1 .. 5]\n    In an equation for \u2018main\u2019: main = putStr show mySum [1 .. 5]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Couldn't match type \u2018a0 -&gt; String\u2019 with \u2018[Char]\u2019\nExpected type: String\n  Actual type: a0 -&gt; String\nProbable cause: \u2018show\u2019 is applied to too few arguments\nIn the first argument of \u2018putStr\u2019, namely \u2018show\u2019\nIn the expression: putStr show mySum [1 .. 5]\n</code></pre>\n\n<p>So how can I actually print the result of the method?</p>\n"}, {"tags": ["html", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "is_accepted": true, "score": 2, "last_activity_date": 1466085206, "last_edit_date": 1466085206, "creation_date": 1465495500, "answer_id": 37733193, "question_id": 37733192, "link": "https://stackoverflow.com/questions/37733192/transform-html-in-haskell/37733193#37733193", "title": "Transform HTML in Haskell", "body": "<p>After some investigation I have found pretty elegant solution in my opinion. It's based on <a href=\"https://hackage.haskell.org/package/tagsoup-0.13.10\" rel=\"nofollow\">tagsoup</a> library. The library has <code>Text.HTML.TagSoup.Tree</code> module which helps to parse HTML into tree structure.</p>\n\n<p>It also contains <code>transformTree</code> function which do transformation pretty trivial. Documentation of that function says:</p>\n\n<blockquote>\n  <p>This operation is based on the Uniplate transform function. Given a list of trees, it applies the function to every tree in a bottom-up manner. </p>\n</blockquote>\n\n<p>You can read about Uniplate more <a href=\"http://community.haskell.org/~ndm/darcs/uniplate/uniplate.htm\" rel=\"nofollow\">here</a>.</p>\n\n<p>This is the code I was satisfied with:</p>\n\n<pre><code>import Text.HTML.TagSoup\nimport Text.HTML.TagSoup.Tree\n\nconvert = transformTree f\n    where\n      f (TagLeaf (TagOpen \"br\" _)) = [TagLeaf (TagText \"\\n\")] -- line breaks\n      f (TagLeaf (TagOpen _ _)) = [] -- ignore all tags without closing pairs\n      f (TagBranch \"a\" attrs inner) = tagExtr \"a\" attrs inner -- keeps href for &lt;a&gt;\n      f (TagBranch \"p\" _ inner) = inner ++ [(TagLeaf (TagText \"\\n\"))]\n      f (TagBranch \"pre\" _ [TagBranch \"code\" _ inner]) = tagExtr \"pre\" [] inner -- &lt;pre&gt;&lt;code&gt; -&gt; &lt;code&gt;\n      f (TagBranch tag _ inner) = if tag `elem` allowedTags then tagExtr tag [] inner else inner\n      f x = [x]\n\ntagExtr tag attrs inner = [TagBranch tag attrs [(extractFrom inner)]]\n\nallowedTags = [\"b\", \"i\", \"a\", \"code\", \"a\", \"pre\", \"em\", \"strong\"]\n\nextractFrom x = TagLeaf $ TagText $ (innerText . flattenTree) x\n</code></pre>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 2, "accepted_answer_id": 37733193, "answer_count": 1, "score": 1, "last_activity_date": 1466085206, "creation_date": 1465495500, "last_edit_date": 1465569713, "question_id": 37733192, "link": "https://stackoverflow.com/questions/37733192/transform-html-in-haskell", "title": "Transform HTML in Haskell", "body": "<p>I want to transform a valid HTML with not very deep level of nesting into another HTML with more restricted rules.</p>\n\n<p>Only the following tags are supported in the resulting HTML:</p>\n\n<pre><code>&lt;b&gt;&lt;/b&gt;, &lt;strong&gt;&lt;/strong&gt;, &lt;i&gt;&lt;/i&gt;, &lt;em&gt;&lt;/em&gt;, &lt;a\nhref=\"URL\"&gt;&lt;/a&gt;, &lt;code&gt;&lt;/code&gt;, &lt;pre&gt;&lt;/pre&gt;\n</code></pre>\n\n<p>Nested tags are not allowed at all.</p>\n\n<p>For the rest of the tags and their combinations I have to create some sort of rules how to handle each.\nSo I have to convert something like: </p>\n\n<p><code>&lt;p&gt;text&lt;/p&gt;</code> into simple string <code>text</code> with linebreak,</p>\n\n<p><code>&lt;b&gt;text &lt;a href=\"url\"&gt;link&lt;/a&gt; text&lt;/b&gt;</code> into <code>text link text</code></p>\n\n<p><code>&lt;a href=\"url\"&gt;text&lt;code&gt; code here&lt;/code&gt;&lt;/a&gt;</code> into <code>&lt;a href=\"url\"&gt;text code here&lt;/a&gt;</code> because <code>&lt;code&gt;</code> is nested inside <code>&lt;a&gt;</code> and so on. </p>\n\n<p>For example HTML (linebreaks are only for convenience):</p>\n\n<pre><code>&lt;p&gt;long paragraph &lt;a href=\"url\"&gt;link&lt;/a&gt; &lt;/p&gt;\n&lt;p&gt;another text &lt;pre&gt;&lt;code&gt;my code block&lt;/code&gt;&lt;/pre&gt; the rest of description&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;inline monospaced text with &lt;a href=\"url\"&gt;link&lt;/a&gt;&lt;/code&gt;&lt;/p&gt;\n</code></pre>\n\n<p>Should be transformed into:</p>\n\n<pre><code>long paragraph &lt;a href=\"url\"&gt;link&lt;/a&gt;\n\nanother text &lt;code&gt;my code block&lt;/code&gt; the rest of description\n\n&lt;code&gt;inline monospaced text with link&lt;/code&gt;\n</code></pre>\n\n<p>Any suggestion on the way to solve that?</p>\n"}, {"tags": ["haskell", "memory", "memory-leaks", "graph-reduction"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1465470631, "post_id": 37724003, "comment_id": 62919830, "body": "In the first version <code>head xs</code> is evaluated first and then <code>last xs</code> can safely run in O(1) space. In the second version the <code>head xs</code> runs <i>second</i> so <code>last xs</code> cannot just throw away all the cons cells, it must keep them around because later (in <code>head xs</code>) the list is still needed."}, {"owner": {"reputation": 77, "user_id": 6194369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00d941916bf82889eb6d81938e52a51f?s=128&d=identicon&r=PG&f=1", "display_name": "road42", "link": "https://stackoverflow.com/users/6194369/road42"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465472003, "post_id": 37724003, "comment_id": 62920721, "body": "Yeah, I also thought, that might be the case. But that contradicts with my tests (the compiled programs I wrote). In my tests &quot;(\\xs -&gt; last xs + head xs)&quot; uses much less memory than &quot;(\\xs -&gt; head xs + last xs)&quot;."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 3, "creation_date": 1465480609, "post_id": 37724003, "comment_id": 62927471, "body": "Okay, I added some <code>unsafePerformIO putStrLn</code>s to your code and it looks like the arguments to the <code>+</code> are being evaluated backwards. So, we can conclude that the example from the wiki is written assuming a left to right evaluation of the arguments to <code>+</code> but when actually run it seems to run in the opposite order. THAT is why the results come back in the opposite order as you would expect. So my initial explanation is correct ONLY if you don&#39;t execute the code ;)"}], "answers": [{"comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1465484330, "post_id": 37727915, "comment_id": 62930322, "body": "Note that the <code>head xs + last xs</code> example is the one causing the space leak in the performed experiments. The original poster presented the experiments in the opposite order as listed on the wiki they reference. Your description is what you would expect, but see my comments as to why it isn&#39;t true in practice."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1465480682, "last_edit_date": 1465480682, "creation_date": 1465480318, "answer_id": 37727915, "question_id": 37724003, "link": "https://stackoverflow.com/questions/37724003/graph-reduction-tricky-space-leak-example/37727915#37727915", "title": "Graph reduction / Tricky space leak example", "body": "<p><code>xs</code> is the same. when you write out <code>[1..200]</code> twice, you're confusing yourself. better to explicitly name all interim entities as they come into existence in the process of an expression's evaluation:</p>\n\n<pre><code>(\\xs -&gt; head xs + last xs) [1,2,3]\nhead xs + last xs        { xs = [1,2,3] }\n(+) (head xs) (last xs)\n(+) 1         (last xs)  { xs = 1:xs1 ; xs1 = [2,3] }\n              (last xs1) { xs1 = 2:xs2 ; xs2 = [3] }\n              (last xs2)\n              3\n4\n</code></pre>\n\n<p>Here we see that the bindings for <code>xs</code> (and <code>xs1</code>) can be safely forgotten as we move along, because there's no more references to <code>xs</code> anywhere. </p>\n\n<p>So you did reduce it correctly, except that the second <code>[1..200]</code> is the same as the first, so we had to hold onto it while finding the <code>last</code> of it first (in the second variant), hence the leak.</p>\n\n<p>Of course a compiler is permitted to optimize this, substituting equals for equals because of referential transparency principle, and perform the enumeration <code>[1..200]</code> <em>twice</em>, thus running in <em>O(1)</em> space for the second variant too.</p>\n\n<p>So in the end, it is a compiler thing. The space leak <em>might</em> happen (not <em>should</em>).</p>\n"}], "owner": {"reputation": 77, "user_id": 6194369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00d941916bf82889eb6d81938e52a51f?s=128&d=identicon&r=PG&f=1", "display_name": "road42", "link": "https://stackoverflow.com/users/6194369/road42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "closed_date": 1465490565, "accepted_answer_id": 37727915, "answer_count": 1, "score": 3, "last_activity_date": 1465480682, "creation_date": 1465469813, "last_edit_date": 1592644375, "question_id": 37724003, "link": "https://stackoverflow.com/questions/37724003/graph-reduction-tricky-space-leak-example", "closed_reason": "Duplicate", "title": "Graph reduction / Tricky space leak example", "body": "<p>I'm wondering about an example for a space leak I read about on this page (sadly it was not explained there):\n<a href=\"https://en.wikibooks.org/wiki/Haskell/Graph_reduction\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Haskell/Graph_reduction</a></p>\n<blockquote>\n<p>Tricky space leak example:</p>\n<p>(\\xs -&gt; head xs + last xs) [1..n]</p>\n<p>(\\xs -&gt; last xs + head xs) [1..n]</p>\n<p>The first version runs on O(1) space. The second in O(n).</p>\n</blockquote>\n<p>I'm not sure, whether I understand correctly (hope you can help). As far as I know, Lazy Evaluation means leftmost outermost evaluation. So, in those examples we would reduce those redexes something like this:</p>\n<blockquote>\n<p>(\\xs -&gt; head xs + last xs) [1..200]</p>\n<p>=&gt; ([1..200] -&gt; head xs + last xs)</p>\n<p>=&gt; head [1..200] + last [1..200]</p>\n<p>=&gt; 1 + last [1..200]</p>\n<p>=&gt; 1 + last [2..200]</p>\n<p>=&gt; ... ...</p>\n<p>=&gt; 1 + last [199..200]</p>\n<p>=&gt; 1 + last [200]</p>\n<p>=&gt; 1 + 200</p>\n<p>=&gt; 201</p>\n</blockquote>\n<p>And</p>\n<blockquote>\n<p>(\\xs -&gt; last xs + head xs) [1..200]</p>\n<p>([1..200] -&gt; last xs + head xs)</p>\n<p>last [1..200] + head [1..200]</p>\n<p>last [2..200] + head [1..200]</p>\n<p>... ...</p>\n<p>last [199..200] + head [1..200]</p>\n<p>last [200] + head [1..200]</p>\n<p>200 + head [1..200]</p>\n<p>200 + 1</p>\n<p>201</p>\n</blockquote>\n<p>Maybe I reduced it the wrong way (please correct me, if I'm wrong), but here I can't see a possible space leak. So, I tested the runtime (not space) first with ghci:</p>\n<pre><code>1&gt;&gt; (\\xs -&gt; head xs + last xs) [1..50000000]\n50000001\n(10.05 secs, 4,003,086,632 bytes)\n2&gt;&gt; (\\xs -&gt; last xs + head xs) [1..50000000]\n50000001\n(2.26 secs, 3,927,748,176 bytes)\n</code></pre>\n<p>According to wikibooks there should be a space leak in the second version, but the runtime is much faster (it might be possible, nothing strange here).</p>\n<p>I have the following source code:</p>\n<pre><code>module Main where\n\nmain = do\n--  let a = (\\xs -&gt; head xs + last xs) [1..20000000]    -- space leak\nlet b = (\\xs -&gt; last xs + head xs) [1..20000000]    -- no space leak\n--  putStrLn (&quot;result for a - (\\\\xs -&gt; head xs + last xs): &quot; ++ show a)\nputStrLn (&quot;result for b - (\\\\xs -&gt; last xs + head xs): &quot; ++ show b)\n</code></pre>\n<p>... and I compiled it with no optimization, then I called the program:</p>\n<pre><code>$ ghc -O0 --make -rtsopts -fforce-recomp Main.hs\n[1 of 1] Compiling Main             ( Main.hs, Main.o )\nLinking Main ...\n\n$ ./Main +RTS -sstderr\nresult for b - (\\xs -&gt; last xs + head xs): 20000001\n   1,600,057,352 bytes allocated in the heap\n         211,000 bytes copied during GC\n          44,312 bytes maximum residency (2 sample(s))\n          21,224 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      3062 colls,     0 par    0.012s   0.012s     0.0000s    0.0001s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0002s    0.0002s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.518s  (  0.519s elapsed)\n  GC      time    0.012s  (  0.012s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.534s  (  0.532s elapsed)\n\n  %GC     time       2.3%  (2.3% elapsed)\n\n  Alloc rate    3,088,101,743 bytes per MUT second\n\n  Productivity  97.6% of total user, 98.0% of total elapsed\n</code></pre>\n<p>That's a nice result, we have 2.3% garbage collection and the used memory is approximately 1 MB. Then I compiled the other case with no optimization and got the following result:</p>\n<pre><code>module Main where\n\nmain = do\n  let a = (\\xs -&gt; head xs + last xs) [1..20000000]    -- space leak\n--  let b = (\\xs -&gt; last xs + head xs) [1..20000000]    -- no space leak\n  putStrLn (&quot;result for a - (\\\\xs -&gt; head xs + last xs): &quot; ++ show a)\n--  putStrLn (&quot;result for b - (\\\\xs -&gt; last xs + head xs): &quot; ++ show b)\n</code></pre>\n<hr />\n<pre><code>$ ghc -O0 --make -rtsopts -fforce-recomp Main.hs\n[1 of 1] Compiling Main             ( Main.hs, Main.o )\nLinking Main ...\n\n$ ./Main +RTS -sstderr\nresult for a - (\\xs -&gt; head xs + last xs): 20000001\n   1,600,057,352 bytes allocated in the heap\n   2,088,615,552 bytes copied during GC\n     540,017,504 bytes maximum residency (13 sample(s))\n     135,620,768 bytes maximum slop\n            1225 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      3051 colls,     0 par    0.911s   0.915s     0.0003s    0.0016s\n  Gen  1        13 colls,     0 par    2.357s   2.375s     0.1827s    0.9545s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.434s  (  0.430s elapsed)\n  GC      time    3.268s  (  3.290s elapsed)\n  EXIT    time    0.094s  (  0.099s elapsed)\n  Total   time    3.799s  (  3.820s elapsed)\n\n  %GC     time      86.0%  (86.1% elapsed)\n\n  Alloc rate    3,687,222,801 bytes per MUT second\n\n  Productivity  14.0% of total user, 13.9% of total elapsed\n</code></pre>\n<p>This is much worse, there's a lot of garbage collection going on and the memory usage is much higher.</p>\n<p>What's actually happening here? I can't see why there is a space leak.</p>\n<hr />\n<p>P.S. If you compile both cases with full optimization (O2), then both programs are almost equally efficient.</p>\n"}, {"tags": ["macos", "haskell", "shared-libraries", "ghc", "haskell-stack"], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1465671520, "creation_date": 1465468912, "last_edit_date": 1465671520, "question_id": 37723674, "link": "https://stackoverflow.com/questions/37723674/ghci-linking-with-cross-calling-dynlibs-fails-on-osx", "title": "GHCi linking with cross-calling dynlibs fails on OSX", "body": "<h3>Setting</h3>\n\n<p>Compiler: GHC 7.10.3</p>\n\n<p>I must use two dynamic libraries (<code>libpetsc</code> and <code>libslepc</code>), one of which uses functions from the other. When linking my application, I encounter the following error, which mentions one such symbol (<code>KSPConvergedReasons</code>). NB. my own code does not use this symbol.</p>\n\n<pre><code>user specified .o/.so/.DLL could not be loaded\n(dlopen($SLEPC_DIR/arch-darwin-c-debug/lib/libslepc.dylib, 5): Symbol\nnot found: _KSPConvergedReasons\n  Referenced from: $SLEPC_DIR/arch-darwin-c-debug/lib/libslepc.dylib\n  Expected in: flat namespace\n in $SLEPC_DIR/arch-darwin-c-debug/lib/libslepc.dylib)\n</code></pre>\n\n<p>Surely enough, <code>nm -u</code> shows <code>_KSPConvergedReasons</code> as an undefined\nsymbol (see below).\nI don't understand the reason of this behaviour since I first compile\nwith all the relevant PETSc and SLEPc headers and link against both\n.dylibs.</p>\n\nNB:\n\n<p>The symbol in question (<code>KSPConvergedReasons</code>) does exist in the callee library (<code>libpetsc</code>):</p>\n\n<pre><code>$ nm ${PETSC_DIR}/${PETSC_ARCH}/lib/libpetsc.3.7.2.dylib | grep KSPConv\n000000000110a652 T _KSPConvergedDefault\n0000000001109703 T _KSPConvergedDefaultCreate\n000000000110b934 T _KSPConvergedDefaultDestroy\n0000000001109a96 T _KSPConvergedDefaultSetUIRNorm\n000000000110a074 T _KSPConvergedDefaultSetUMIRNorm\n000000000106533d T _KSPConvergedLSQR\n0000000001743280 D _KSPConvergedReasons\n...\n</code></pre>\n\n<h3>Build + link sequence</h3>\n\n<p>Build the C code generated from my own library, which in turn uses headers from the two aforementioned libs:</p>\n\n<pre><code>gcc -c -g -w ${SRCDIR}/Internal/InlineC.c -o ${LIBDIR}/InlineC_c.o -I${PETSC_DIR_ARCH}/include -I${PETSC_DIR}/include -I${SLEPC_DIR_ARCH}/include -I${SLEPC_DIR}/include\n</code></pre>\n\n<p>Link :</p>\n\n<pre><code>stack exec ghci ${SRCDIR}/Spec.hs ${SRCDIR}/Internal/InlineC.hs  ${LIBDIR}/InlineC_c.o  -- -isrc/ -L${PETSC_DIR_ARCH}/lib -L${SLEPC_DIR_ARCH}/lib -lpetsc -lmpich -lslepc\n</code></pre>\n\n<h3>Question</h3>\n\n<p>Why is this happening and how can I fix this?</p>\n\n<p>Thank you in advance for any pointers,\nMarco</p>\n\n<hr>\n\n<p>Undefined symbols in calling dynlib :</p>\n\n<pre><code>$ nm -u libslepc.3.7.1.dylib | grep KSP\n\n_KSPAppendOptionsPrefix\n_KSPConvergedReasons\n...\n</code></pre>\n"}, {"tags": ["haskell", "repa"], "comments": [{"owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "edited": false, "score": 0, "creation_date": 1465471150, "post_id": 37722650, "comment_id": 62920172, "body": "You could look into the <a href=\"https://hackage.haskell.org/package/repa-fftw-3.2.3.2/docs/src/Data-Array-Repa-FFTW.html#fft\" rel=\"nofollow noreferrer\">implementation</a> of repa.fftw to see how to get a pointer to the array&#39;s data. Then you could use one of the more general functions of Math.FFT to perform your transform."}, {"owner": {"reputation": 101, "user_id": 6444672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c2defb01d9d866c929d44cae97b389?s=128&d=identicon&r=PG", "display_name": "jpv", "link": "https://stackoverflow.com/users/6444672/jpv"}, "reply_to_user": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "edited": false, "score": 0, "creation_date": 1465549783, "post_id": 37722650, "comment_id": 62958668, "body": "Thanks, i will look at it. I was little bit uncomfortable as this code uses unsafePerformIO but I need to learn how to use it correctly."}], "owner": {"reputation": 101, "user_id": 6444672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c2defb01d9d866c929d44cae97b389?s=128&d=identicon&r=PG", "display_name": "jpv", "link": "https://stackoverflow.com/users/6444672/jpv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1465466175, "creation_date": 1465466175, "question_id": 37722650, "link": "https://stackoverflow.com/questions/37722650/row-or-column-operations-in-repa", "title": "Row or Column operations in Repa", "body": "<p>In Repa (Haskell) is there any way to perform row operations directly?</p>\n\n<p>I want to do an fft of each row of a 2D array but this does not seem to be possible. As I do not want to write my own fft algorithm, it would be nice if I can apply fft (from Repa.FFTW) to each row directly resulting in a matrix of the same size as the original.</p>\n\n<p>I tried to write my own dft function but the performance was very bad. The code for this is below.</p>\n\n<pre><code>dftOnMatrix :: Array D DIM2 Complex -&gt; Array D DIM2 Complex\ndftOnMatrix arr =\n  let (Z :. rs :. cs) = extent arr\n      dftFunc :: (DIM2 -&gt; Complex) -&gt; Int -&gt; Int -&gt; Int -&gt; Complex -&gt; Complex\n      dftFunc f i j k sum = dftFuncCore k sum\n        where\n          val2 = fromIntegral j\n          temp = 2*pi/ fromIntegral cs\n          dftFuncCore k sum = \n            if k == cs\n            then sum\n            else let val1 = fromIntegral k\n                     val = val1*val2*temp\n                     cosval = ( - (cos val))\n                     sinval = ( - (sin val))\n                 in --cosval `seq` (sinval `seq` (dftFuncCore (k+1) (sum + ((f (Z :. i :. k))* (cos val, sin val)))))\n                   dftFuncCore (k+1) (sum + ((f (Z :. i :. k))* (cos val, sin val)))\n  in R.traverse arr id (\\f (Z :. i :. j) -&gt; (1/fromIntegral cs, 0) * dftFunc f i j 0 0)\n</code></pre>\n\n<p>I have tried to analyze this using ghc-core but did not find anything that might affect performance. I might be completely wrong though as my knowledge of core is very limited.</p>\n\n<p>Thanks,</p>\n"}]