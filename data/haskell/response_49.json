[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 19, "user_id": 5688589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98c76c89d1b3e91a31a68f5ee456f11b?s=128&d=identicon&r=PG&f=1", "display_name": "JeffC", "link": "https://stackoverflow.com/users/5688589/jeffc"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1450303119, "post_id": 34322726, "comment_id": 56387516, "body": "I understand how to write a function and recursively call it to the base case, so I could iterate through a list of number and do something with each one. I&#39;m having trouble figuring out how to carry values of variables x and y through the recursion because to compute x and y in  the base case (count = 100) requires the values of x and y from the previous iterations of the loop."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 3, "creation_date": 1450303133, "post_id": 34322726, "comment_id": 56387525, "body": "Instead of updating variables, think of the loop body as a function that takes two variables <code>(x, y)</code> and returns two variables <code>(x&#39;, y&#39;)</code>. Your loop is then that function applied to its own output 100 times."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450304409, "post_id": 34322726, "comment_id": 56388163, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/26203493/how-to-use-recursion-nested-for-loop-in-haskell-without-forloop\">How to use recursion nested for loop in haskell without forloop</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1450308965, "post_id": 34322726, "comment_id": 56390124, "body": "@jberryman I don&#39;t think it is an exact duplicate because the code in the OP contains some printing inside the loop body, if you want to translate this faithfully you must preserve that as well."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1450331962, "post_id": 34322726, "comment_id": 56396783, "body": "Why is this downvoted? :\\"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 3, "last_activity_date": 1450319473, "last_edit_date": 1450319473, "creation_date": 1450304405, "answer_id": 34323206, "question_id": 34322726, "link": "https://stackoverflow.com/questions/34322726/convert-for-loop-to-haskell/34323206#34323206", "title": "Convert For Loop to Haskell", "body": "<p>You can very easily define a function to help you write things that look like imperative loops:</p>\n\n<pre><code>import Control.Monad \n\nloop :: Monad m =&gt; [i] -&gt; a -&gt; (i -&gt; a -&gt; m a) -&gt; m a \nloop is a0 f = foldr (&gt;=&gt;) return (map f is) a0 \n</code></pre>\n\n<p>The definition is not really important (many, many ways to write this function), rather, to understand what it does, look at the type. Given some list of <code>i</code> - the range of values to loop over, and some initial value for your loop, an <code>a</code>, and finally, a function which given a value (<code>i</code>) and a loop state (<code>a</code>), returns a new loop state in some context <code>m</code>. This function produces a computation in that context <code>m</code> which yields the last state.</p>\n\n<p>Use it simply like so:</p>\n\n<pre><code>import System.Environment\nmain = do \n  (c0:c1:c2:c3:_) &lt;- map read &lt;$&gt; getArgs \n  loop [1..100] (0,0) $ \\count (x,y) -&gt; do \n    print (count,x,y) \n    let z = -(c0*x + c1*y)/c2 - c3 \n    return (x+y,y+z) \n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; runghc test.hs 12 34 56 78\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 5, "last_activity_date": 1450305116, "creation_date": 1450305116, "answer_id": 34323395, "question_id": 34322726, "link": "https://stackoverflow.com/questions/34322726/convert-for-loop-to-haskell/34323395#34323395", "title": "Convert For Loop to Haskell", "body": "<p>As suggested, the functional way of doing this is to turn your loop body into a function takes and returns the variables you're interested in:</p>\n\n<pre><code>f (x, y) =\n    let\n        z = -(a*x + b*y)/c - d\n        x' = x + y\n        y' = y + z\n    in\n        (x', y')\n</code></pre>\n\n<p>You can then apply the function to itself 100 times with <code>(0,0)</code> as your start values:</p>\n\n<pre><code>values = take 100 $ iterate f (0,0)\n</code></pre>\n\n<p>And then, optionally, dump all the intermediate values unceremoniously to the screen:</p>\n\n<pre><code>main = print values\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 5688589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98c76c89d1b3e91a31a68f5ee456f11b?s=128&d=identicon&r=PG&f=1", "display_name": "JeffC", "link": "https://stackoverflow.com/users/5688589/jeffc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1450319473, "creation_date": 1450302519, "last_edit_date": 1450303011, "question_id": 34322726, "link": "https://stackoverflow.com/questions/34322726/convert-for-loop-to-haskell", "title": "Convert For Loop to Haskell", "body": "<p>I am relatively new to Haskell. I understand the concepts of recursion and such. But, I am having trouble thinking through how to convert something like the following functional pseudocode into Haskell:</p>\n\n<pre><code>x = 0\n y = 0\n For Count = 1 To 100 { \n     Print (Count, x, y)\n     z = -(A*x + B*y)/C - D\n     x = x + y\n     y = y + z`\n}\n</code></pre>\n\n<p>(note A, B, C and D are constants)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450300394, "post_id": 34322077, "comment_id": 56386153, "body": "I think this is a duplicate of <a href=\"http://stackoverflow.com/questions/7878065/get-size-of-file-in-haskell\" title=\"get size of file in haskell\">stackoverflow.com/questions/7878065/get-size-of-file-in-hask&zwnj;&#8203;ell</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450300529, "post_id": 34322077, "comment_id": 56386210, "body": "i am not trying to find the size. I am trying to find the occurence of specific characters."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 1, "creation_date": 1450300619, "post_id": 34322077, "comment_id": 56386244, "body": "oh ok. first you should change the signature. <code>I&#47;O</code> is not a type, it&#39;s a syntax error. the signature should be something like <code>countChars :: Char -&gt; String -&gt; Int</code>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450300772, "post_id": 34322077, "comment_id": 56386317, "body": "oh yes it was like that i am sorry i posted the wrong code segment,i was trying. It was the same with yours."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450300835, "post_id": 34322077, "comment_id": 56386357, "body": "you should edit your question then. as it is written now, it doesn&#39;t even compile"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450300971, "post_id": 34322077, "comment_id": 56386434, "body": "Okey i did thanks for warning"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450301088, "post_id": 34322077, "comment_id": 56386494, "body": "<code>\\chr fp -&gt; length . filter (==chr) &lt;$&gt; readFile fp</code>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450301271, "post_id": 34322077, "comment_id": 56386576, "body": "I want to find all the &#39;s&#39; so will the code be like this?  \\s /tmp/foo.txt -&gt; length.filter(==s)&lt;$&gt; readFile tmp/foo.txt"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450301338, "post_id": 34322077, "comment_id": 56386606, "body": "do you know how to read in the contents of a file? do you know how to do monadic binding? =&gt; read contents of file into a variable, e.g. <code>s</code> =&gt; calculate <code>count &#39;x&#39; s</code>"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1450301362, "post_id": 34322077, "comment_id": 56386624, "body": "I think the <code>&lt;$&gt;</code> function is too advanced for you yet..."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450339117, "post_id": 34325259, "comment_id": 56400217, "body": "That was a great explanation for my question. Thank you so much :)"}], "tags": [], "owner": {"reputation": 76, "user_id": 1005546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53c8bdbf9b60dea52c99df60e4f2dd7f?s=128&d=identicon&r=PG", "display_name": "Herb", "link": "https://stackoverflow.com/users/1005546/herb"}, "is_accepted": true, "score": 1, "last_activity_date": 1450317570, "last_edit_date": 1450317570, "creation_date": 1450316331, "answer_id": 34325259, "question_id": 34322077, "link": "https://stackoverflow.com/questions/34322077/count-the-occurence-of-a-specific-character-of-a-file-in-haskell/34325259#34325259", "title": "count the occurence of a specific character of a file in haskell", "body": "<p>By reusing your <code>count</code> function. You can map it over a <code>readFile</code> with returns you a file's content as a string:</p>\n\n<pre><code>count :: Eq a =&gt; a -&gt; [a] -&gt; Int\ncount x xs = length [x' | x' &lt;- xs, x==x']\n\ncntFile :: Char -&gt; FilePath -&gt; IO Int\ncntFile c f = count c &lt;$&gt; readFile f\n\nmain :: IO ()\nmain = do\n    cnt &lt;- cntFile 'c' \"test.hs\"\n    print cnt\n</code></pre>\n\n<p>The operator <code>&lt;$&gt;</code> is just the infix notation for <code>fmap</code>, which does to <code>IO</code> and any other <code>Functor</code> what <code>map</code> does to lists.</p>\n\n<p>The longer alternative for beginner would probably be:</p>\n\n<pre><code>cntFile' :: Char -&gt; FilePath -&gt; IO Int\ncntFile' c f = do\n    content &lt;- readFile f\n    let cnt = count c content\n    return cnt\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 34325259, "answer_count": 1, "score": 1, "last_activity_date": 1450317570, "creation_date": 1450299907, "last_edit_date": 1450317521, "question_id": 34322077, "link": "https://stackoverflow.com/questions/34322077/count-the-occurence-of-a-specific-character-of-a-file-in-haskell", "title": "count the occurence of a specific character of a file in haskell", "body": "<p>I am a beginner with haskell and i wonder how i can count the characters in a file in haskell. From <a href=\"https://books.google.com.tr/books?id=olp7lAtpRX0C&amp;pg=PA42&amp;lpg=PA42&amp;dq=how%20to%20count%20the%20characters%20in%20a%20string%20in%20haskell&amp;source=bl&amp;ots=IxJWhB8y62&amp;sig=NaSzRnITy2NUAsVWV77-XDKUjhU&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwjU1s-WneHJAhUFDywKHfu9AR4Q6AEIRzAG#v=onepage&amp;q=how%20to%20count%20the%20characters%20in%20a%20string%20in%20haskell&amp;f=false\" rel=\"nofollow\">this book</a> i wrote the count of any character in any string, but i wonder if i can do the same function with files. The code is similar like following;</p>\n\n<pre><code>count :: Char -&gt; String -&gt; Int \ncount x xs = length [x'|x'&lt;-xs, x==x']\n</code></pre>\n\n<p>Any help would be very great. Thanks!</p>\n\n<p>Edit: I am very new to haskell so this may be a very stupid question :) </p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "garbage-collection", "ghc"], "comments": [{"owner": {"reputation": 5267, "user_id": 1102851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0e1866c32c13460429d2f9ba066949bc?s=128&d=identicon&r=PG", "display_name": "bgamari", "link": "https://stackoverflow.com/users/1102851/bgamari"}, "edited": false, "score": 10, "creation_date": 1450293405, "post_id": 34319743, "comment_id": 56382233, "body": "You may want to see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11134\" rel=\"nofollow noreferrer\">GHC Trac  #11134</a>  as it&#39;s quite possible that you are seeing idle GCs."}, {"owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "reply_to_user": {"reputation": 5267, "user_id": 1102851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0e1866c32c13460429d2f9ba066949bc?s=128&d=identicon&r=PG", "display_name": "bgamari", "link": "https://stackoverflow.com/users/1102851/bgamari"}, "edited": false, "score": 0, "creation_date": 1450294247, "post_id": 34319743, "comment_id": 56382751, "body": "That sounds really useful. Thanks for the pointer!"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1496850488, "post_id": 34319743, "comment_id": 75833479, "body": "Running multiple processes (M) with N capabilities on machine with P cores will make processes fight for resources bad when M * N &gt; P. IIRC there are spinlocks somewhere aggressively eating CPU in that case."}], "owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 431, "favorite_count": 1, "answer_count": 0, "score": 37, "last_activity_date": 1450291409, "creation_date": 1450291409, "question_id": 34319743, "link": "https://stackoverflow.com/questions/34319743/excessive-amount-of-system-calls-when-using-threaddelay", "title": "Excessive amount of system calls when using `threadDelay`", "body": "<p>I'm having a couple of Haskell processes running in production on a system with 12 cores. All processes are compiled with <code>-threaded</code> and run with 12 capabilities. One library they all use is <code>resource-pool</code> which keeps a pool of database connection.</p>\n\n<p>What's interesting is that even though all processes are practically idle they consume around 2% CPU time. Inspecting one of these processes with <code>strace -p $(pgrep processname) -f</code> reveals that the process is doing an unreasonable amount of system calls even though it should not really be doing anything. To put things into perspective:</p>\n\n<ul>\n<li>Running strace on a process with <code>-N2</code> for 5 seconds produces a 66K log file.</li>\n<li>Running it with (unreasonable) <code>-N64</code> yields a 60 <strong>Megabyte</strong> log.</li>\n</ul>\n\n<p>So the number of capabilities increases the amount of system calls being issued drastically.</p>\n\n<p>Digging deeper we find that <code>resource-pool</code> is running a reaper thread which fires every second to inspect if it can clean up some resources. We can simulate the same behavior with this trivial program.</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Monad (forever)\n\nmain :: IO ()\nmain = forever $ do\n  threadDelay (10 ^ 6)\n</code></pre>\n\n<p>If I pass <code>-B</code> to the runtime system I get audio feedback whenever a GC is issued, which in this case is every 60 seconds.</p>\n\n<p>So when I suppress these GC cycles by passing <code>-I0</code> to the RTS running the <code>strace</code> command on the process only yields around 70K large log files. Since the process is also running a <code>scotty</code> server, GC is triggered when requests are coming in, so they seem to happen when I actually need them.</p>\n\n<p>Since we are going to increase the amount of Haskell processes on this machine by a large amount during the course of the next year I was wondering how to keep their idle time at a reasonable level. Apparently passing <code>-I0</code> seems to be a rather bad idea (?). Another idea would be to just decrease the number of capabilities from 12 to maybe something like 4. Is there any other way to tweak the RTS so that I can keep the processes from burning to many CPU cycles while idling?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450289503, "post_id": 34318707, "comment_id": 56379948, "body": "While it&#39;s not likely to help you do what you&#39;re trying to do, you should definitely read Breitner, et al, <a href=\"http://www.cis.upenn.edu/~eir/papers/2014/coercible/coercible-ext.pdf\" rel=\"nofollow noreferrer\">Safe Zero-cost Coercions for Haskell</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450308463, "post_id": 34318941, "comment_id": 56389954, "body": "Definitely incoherent. As soon as you have to apply transitivity twice, GHC will declare incoherence, and that&#39;s surely not the only source of incoherence in this mess. That&#39;s among the reasons GHC&#39;s coercion mechanism needs to use its own specialized instance creation mechanism utterly unlike the usual one."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1450289014, "last_edit_date": 1450289014, "creation_date": 1450288661, "answer_id": 34318941, "question_id": 34318707, "link": "https://stackoverflow.com/questions/34318707/multiparameter-typeclasses-and-illegal-instance-declarations/34318941#34318941", "title": "Multiparameter typeclasses and illegal instance declarations", "body": "<p>I think this has to require <code>UndecidableInstances</code>:</p>\n\n<pre><code>instance (Convertible a b, Convertible b c) =&gt; Convertible a c where\n</code></pre>\n\n<p>Given <code>a</code>, thanks to the functional dependency, we can compute a <code>b</code>. However, there's no guarantee that such <code>b</code> is smaller/simpler than <code>a</code>! It could be e.g. that <code>b ~ [[a]]</code>, in which case we reduce the problem of checking <code>Convertible a c</code> to checking <code>Convertible [[a]] c</code>. This can easily lead to non-termination during instance search, since the class arguments are not decreasing.</p>\n\n<p>Related note: if you satisfy the functional dependency, there is only one type <code>b</code> to which you can convert <code>a</code>. In such case, why do you need transitivity? There's nothing else <code>a</code> can be converted to. In other words, in the transitivity case you need to have <code>c ~ b</code>, or you would have that <code>a</code> determines both <code>b</code> and <code>c</code>, violating the functional dependency. (I guess you do not really want the functional dependency, after all.)</p>\n\n<p>Unrelated note: also watch out for instance overlaps -- the instance above looks quite troublesome. You might also have to use <code>OverlappingInstances</code> and/or <code>IncoherentInstances</code>, both of which can cause headaches.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3345301"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1450289014, "creation_date": 1450287873, "question_id": 34318707, "link": "https://stackoverflow.com/questions/34318707/multiparameter-typeclasses-and-illegal-instance-declarations", "title": "Multiparameter typeclasses and illegal instance declarations", "body": "<p>I made a version of the Convertible class like so:</p>\n\n<pre><code>class Convertible a b where\n  convert :: a -&gt; b\n\ninstance (Convertible a b, Functor f) =&gt; Convertible (f a) (f b) where\n  convert = fmap convert\n</code></pre>\n\n<p>However, I found it annoying that I would have to make a new instance if I ever wanted to string two conversions together. So I tried adding this:</p>\n\n<pre><code>instance (Convertible a b, Convertible b c) =&gt; Convertible a c where\n  convert = convert . convert\n</code></pre>\n\n<p>The compiler complained with this:</p>\n\n<pre><code>Variable \u2018b\u2019 occurs more often than in the instance head\n  in the constraint: Convertible a b\n(Use UndecidableInstances to permit this)\nIn the instance declaration for \u2018Convertible a c\u2019\nVariable \u2018b\u2019 occurs more often than in the instance head\n  in the constraint: Convertible b c\n(Use UndecidableInstances to permit this)\nIn the instance declaration for \u2018Convertible a c\u2019\n</code></pre>\n\n<p>At this point I understand why the compiler is complaining at me, and I'd really rather not turn on UndecidableInstances. The way I currently have my instances set up, there's only one instance of Convertible a b for each a. I hoped that adding a functional dependency a -> b would alleviate this, but now the compiler is complaining about the functor instance:</p>\n\n<pre><code>Illegal instance declaration for \u2018Convertible (f a) (f b)\u2019\n  The coverage condition fails in class \u2018Convertible\u2019\n    for functional dependency: \u2018a -&gt; b\u2019\n  Reason: lhs type \u2018f a\u2019 does not determine rhs type \u2018f b\u2019\n  Using UndecidableInstances might help\nIn the instance declaration for \u2018Convertible (f a) (f b)\u2019\n</code></pre>\n\n<p>Any thoughts about how to get this working? Or perhaps a better design if necessary? I'm thinking I may just have to settle for being explicit about which path of conversions to take.</p>\n"}, {"tags": ["haskell", "typeclass", "aeson"], "comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1450288903, "post_id": 34318080, "comment_id": 56379582, "body": "It looks like &lt;?&gt; is defined in <code>Data.Aeson.Types.Internal</code>, but I had to clone the repository to find it. Is there a better way? Also, that isn&#39;t exposed so I can&#39;t even use it?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450305542, "post_id": 34319392, "comment_id": 56388735, "body": "Another option is to copy the source code of the <code>FromJSON (HashMap Text a)</code> instance, which I believe is pretty short and simple. I think <code>aeson</code> made a big mistake by making its <code>Object</code> a type synonym for <code>HashMap Text Value</code>; if not for that (IMO) misjudgement, they could have offered a much nicer <code>instance (FromJSON v, FromJSON k, Hashable k) =&gt; FromJSON (HashMap k v)</code>."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1450383128, "post_id": 34319392, "comment_id": 56428367, "body": "Sounds like a PR is in order!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450392713, "post_id": 34319392, "comment_id": 56433153, "body": "@dfeuer The current instance for <code>Text</code> uses the name of the type: <code>withObject &quot;HashMap Text a&quot;</code> so you would also need a <code>Typeable k</code> constraint or the like, I believe."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450394064, "post_id": 34319392, "comment_id": 56433664, "body": "@user2407038 I guess it&#39;s a problem (with <code>type Object = HashMap Text Value</code>) because the authors want to leave an <code>Object</code> value alone. With a hypothetical <code>newtype Object = Object (HashMap Text Value)</code>, that could be accomplished without precluding the general instance."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1450290571, "last_edit_date": 1450290571, "creation_date": 1450290189, "answer_id": 34319392, "question_id": 34318080, "link": "https://stackoverflow.com/questions/34318080/fromjson-instance-for-newtype-hashmap-key/34319392#34319392", "title": "FromJSON instance for newtype HashMap key", "body": "<p>Your <code>UUID</code> is a newtype so you have </p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Coerce\n-- other imports...\n\ninstance (FromJSON v) =&gt; FromJSON (HashMap UUID v) where\n  parseJSON = coerce (parseJSON :: Value -&gt; Parser (HashMap Text v)) \n</code></pre>\n\n<p>Or, perhaps the simpler way</p>\n\n<pre><code>  parseJSON = fmap (fromList . map (\\(x,y) -&gt; (UUID x,y)) . toList) . parseJSON\n</code></pre>\n\n<p>Which simply parses the Text HashMap, then converts it to one indexed on UUID. However, the <code>coerce</code> version is better since it has no runtime cost.</p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1450290571, "creation_date": 1450285998, "question_id": 34318080, "link": "https://stackoverflow.com/questions/34318080/fromjson-instance-for-newtype-hashmap-key", "title": "FromJSON instance for newtype HashMap key", "body": "<p>I made a newtype <code>UUID</code> in my application to represent <code>Text</code> ids. </p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\n...\n\nnewtype UUID =\n    UUID Text\n      deriving (Eq, Generic, FromJSON, ToJSON, FromField, ToField, FromText, Show, Read, Hashable)\n</code></pre>\n\n<p>My application needs an instance of <code>FromJSON</code> for <code>HashMap UUID a</code>. HashMap defines an instance for <code>HashMap Text a</code>, is there a way to use it when defining mine?</p>\n\n<p>If I have to redefine the instance, how would I write it? Here's the equivalent from <a href=\"https://hackage.haskell.org/package/aeson-0.10.0.0/docs/src/Data-Aeson-Types-Instances.html\" rel=\"nofollow\"><code>Data.Aeson.Types.Instances</code></a>: </p>\n\n<pre><code>instance (FromJSON v) =&gt; FromJSON (H.HashMap Text v) where\n    parseJSON = withObject \"HashMap Text a\" $ H.traverseWithKey (\\k v -&gt; parseJSON v &lt;?&gt; Key k)\n</code></pre>\n\n<p>How would you write this for <code>UUID</code>? Where are <code>Key</code> and <code>&lt;?&gt;</code> defined, and how can I look that up easily on my own? Hoogle didn't seem to help. </p>\n"}, {"tags": ["haskell", "timeout", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1450285578, "post_id": 34317730, "comment_id": 56377624, "body": "I fear that <code>compute&#39; i = last $ repeat i</code> is optimized so to require no allocation at all. If that&#39;s the case, the GHC scheduler does not have a chance to switch to another Haskell thread. This is a known &quot;limitation&quot; (ok, ok, a bug) of GHC. I hope one day GHC will at least emit a warning in such cases."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1450317809, "post_id": 34317730, "comment_id": 56392700, "body": "To avoid the issue @chi mentioned, if it is in fact your issue, build with <code>-fno-omit-yields</code>"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450319801, "post_id": 34317730, "comment_id": 56393261, "body": "@chi: Could you put that as an answer? Maybe combined with Reid Barton&#39;s suggestion?"}, {"owner": {"reputation": 163, "user_id": 3236367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469cc0fa3bd374f462e054356852d800?s=128&d=identicon&r=PG", "display_name": "Tom&#225;\u0161 Jakl", "link": "https://stackoverflow.com/users/3236367/tom%c3%a1%c5%a1-jakl"}, "edited": false, "score": 0, "creation_date": 1450351841, "post_id": 34317730, "comment_id": 56408211, "body": "Thank you all, now I understand what&#39;s going on much better!"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1450341440, "creation_date": 1450341440, "answer_id": 34330005, "question_id": 34317730, "link": "https://stackoverflow.com/questions/34317730/haskell-timeout-diverging-computation/34330005#34330005", "title": "Haskell Timeout diverging computation", "body": "<p>There's a limitation in the GHC implementation of Haskell threads: context switches occur only during allocation. As a consequence, tight loops which perform no allocation at all can prevent the scheduler to run, switching to other threads.</p>\n\n<p>This is one of such examples: <code>compute' i = last $ repeat i</code> looks as if it's allocating list cells, but unfortunately GHC is able to optimize it as a trivial infinite loop, removing all allocation -- GHC Core looks roughly as <code>f x = f x</code>. This triggers the scheduler shortcoming.</p>\n\n<p>Reid Barton suggests the option <code>-fno-omit-yields</code> to work around this. This will cause GHC not to optimize so much.</p>\n"}], "owner": {"reputation": 163, "user_id": 3236367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469cc0fa3bd374f462e054356852d800?s=128&d=identicon&r=PG", "display_name": "Tom&#225;\u0161 Jakl", "link": "https://stackoverflow.com/users/3236367/tom%c3%a1%c5%a1-jakl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 2, "accepted_answer_id": 34330005, "answer_count": 1, "score": 6, "last_activity_date": 1450341440, "creation_date": 1450284952, "question_id": 34317730, "link": "https://stackoverflow.com/questions/34317730/haskell-timeout-diverging-computation", "title": "Haskell Timeout diverging computation", "body": "<p>I'm trying to write a safe timing-out evaluation function in Haskell. The code goes as follows</p>\n\n<pre><code>import System.Timeout\n\ncompute, compute' :: Int -&gt; Int\ncompute  i = sum [1..300000 + i]\ncompute' i = last $ repeat i\n\ntimedComp :: Int -&gt; a -&gt; IO (Maybe a)\ntimedComp timeLeft toCompute =\n        timeout timeLeft go\n    where\n        go = toCompute `seq` return toCompute\n\nmain = do\n    res &lt;- timedComp 10000 (compute 0)\n    print res\n\n    res' &lt;- timedComp 10000 (compute' 0)\n    print res'\n</code></pre>\n\n<p>(I know that I only evaluate to WHNF.)</p>\n\n<p>When I run main, I get only one Nothing on output and then the program hangs. I tried to compile and run the program multi-threaded but it doesn't help. Tried on both GHC 7.6.3 and 7.8.3. Any suggestions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1450280196, "post_id": 34315382, "comment_id": 56373786, "body": "If I look for the source for that website the only <code>&lt;article&gt;</code> tag doesn&#39;t actually contain any links in it, it would appear that it&#39;s actually populated by javascript that runs after the HTML is loaded."}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1450281246, "post_id": 34315382, "comment_id": 56374631, "body": "Eh No.  <code>&lt;article&gt;</code> runs from line 185 to 267 and includes numerous links - some in the text and some wrapped by wordpress around images (which I actually don&#39;t need)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1450281453, "post_id": 34315382, "comment_id": 56374819, "body": "Ah, yes, you would appear to be correct.  Can you verify that when you download it with <code>simpleHttp</code> that you get the same content?  I would try it myself but I&#39;m currently behind a corporate proxy that makes it difficult to do that."}], "answers": [{"comments": [{"owner": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 0, "creation_date": 1450288499, "post_id": 34318679, "comment_id": 56379355, "body": "Does assume the html is xml compliant?"}, {"owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "reply_to_user": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 1, "creation_date": 1450289079, "post_id": 34318679, "comment_id": 56379685, "body": "Since the option &quot;withParseHTML&quot; is set, an HTML parser is used instead of an XML parser. So it is assumed to be valid HTML."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1450289868, "post_id": 34318679, "comment_id": 56380167, "body": "A bit more readable still with the redundant parents in <code>extractLinks</code> removed."}, {"owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "edited": false, "score": 1, "creation_date": 1450290513, "post_id": 34318679, "comment_id": 56380560, "body": "You are right, I removed the unnecessary parentheses."}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 0, "creation_date": 1450290786, "post_id": 34318679, "comment_id": 56380738, "body": "Hey, thanks. I&#39;ll try it tomorrow. I suppose we should consider ourselves lucky to have such a choice of tools but it does make the density of examples to work from low"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 1, "creation_date": 1470027292, "post_id": 34318679, "comment_id": 64761532, "body": "Might I ask why, in the definition of <code>extractLinks</code> you use a return in the end? I think a bind with a return makes it identity, so we can just ignore that return?"}], "tags": [], "owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "is_accepted": false, "score": 5, "last_activity_date": 1470044773, "last_edit_date": 1470044773, "creation_date": 1450287798, "answer_id": 34318679, "question_id": 34315382, "link": "https://stackoverflow.com/questions/34315382/parsing-html-in-haskell/34318679#34318679", "title": "Parsing html in haskell", "body": "<p>I think you can do this in a very readable way with HXT by composing filters:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nimport Text.XML.HXT.Core\nimport Text.XML.HXT.Curl\nimport Text.XML.HXT.TagSoup\n\nlinks url = extract (readDocument\n  [ withParseHTML yes\n  , withTagSoup\n  , withCurl      []\n  , withWarnings  no\n  ] url)\n\nextract doc = runX $ doc &gt;&gt;&gt; xmlFilter \"article\" &gt;&gt;&gt; xmlFilter \"a\" &gt;&gt;&gt; toHref\n\nxmlFilter name = deep (hasName name)\n\ntoHref = proc el -&gt; do\n   link    &lt;- getAttrValue \"href\" -&lt; el\n   returnA -&lt; link\n</code></pre>\n\n<p>You can call this in the following way:</p>\n\n<pre><code>links \"http://www.amsterdamfoodie.nl/2015/wine-beer-food-restaurants-troost/\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": false, "score": 2, "last_activity_date": 1450341820, "creation_date": 1450341820, "answer_id": 34330101, "question_id": 34315382, "link": "https://stackoverflow.com/questions/34315382/parsing-html-in-haskell/34330101#34330101", "title": "Parsing html in haskell", "body": "<p>OK, so the problem was that <code>&amp;/</code> only looks at immediate children, whereas <code>&amp;//</code> will go through all descendants</p>\n\n<pre><code>findNodes = element \"article\" &amp;// element \"a\"\n</code></pre>\n"}], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1488, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1470044773, "creation_date": 1450278224, "last_edit_date": 1450299177, "question_id": 34315382, "link": "https://stackoverflow.com/questions/34315382/parsing-html-in-haskell", "title": "Parsing html in haskell", "body": "<p>I'm trying to parse the <code>a</code> links from the main part (<code>&lt;article&gt;</code>) of a blog post. I have adapted what I found on <a href=\"https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/text-manipulation/tagsoup\" rel=\"nofollow\">FPComplete</a> but nothing is printed out. (The code does not work as far as I can see as running it on the online IDE and with the Bing target also produces no links.)</p>\n\n<p>In GHCI I can simulate the first line of parseAF and that gets me a large record, which I take to be correct. But <code>cursor $// findNodes &amp;| extractData</code> returns <code>[]</code></p>\n\n<p>I've tried regex but that wasn't happy trying to find such a long piece of text.</p>\n\n<p>Can anyone help?</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule HtmlParser where\n\nimport Network.HTTP.Conduit (simpleHttp)\nimport Prelude hiding (concat, putStrLn)\nimport Data.Text (concat)\nimport Data.Text.IO (putStrLn)\nimport Text.HTML.DOM (parseLBS)\nimport Text.XML.Cursor (Cursor, attribute, element, fromDocument, ($//), (&amp;//), (&amp;/), (&amp;|))\n\n-- The URL we're going to search\nurl = \"http://www.amsterdamfoodie.nl/2015/wine-beer-food-restaurants-troost/\"\n\n-- The data we're going to search for\nfindNodes :: Cursor -&gt; [Cursor]\nfindNodes = element \"article\" &amp;/ element \"a\"\n\n-- Extract the data from each node in turn\nextractData = concat . attribute \"href\"\n\ncursorFor :: String -&gt; IO Cursor\ncursorFor u = do\n     page &lt;- simpleHttp u\n     return $ fromDocument $ parseLBS page\n\n-- Process the list of data elements\nprocessData = mapM_ putStrLn\n\n-- main = do\nparseAF :: IO ()\nparseAF = do\n     cursor &lt;- cursorFor url\n     processData $ cursor $// findNodes &amp;| extractData\n</code></pre>\n\n<p><strong>UPDATE</strong> After more exploring it seems that the problem lies with <code>element \"article\"</code>. If I replace that with <code>element \"p\"</code>, which is OK in this instance as the only <code>p</code>s are in the <code>article</code> anyway, then I get my links. Pretty weird....!!</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 13920, "user_id": 371228, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4028c5dd749d198d7a8f2601d4afe07?s=128&d=identicon&r=PG", "display_name": "bdesham", "link": "https://stackoverflow.com/users/371228/bdesham"}, "edited": false, "score": 1, "creation_date": 1450277462, "post_id": 34314894, "comment_id": 56371806, "body": "Can you please post the errors you\u2019re getting?"}], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 1, "last_activity_date": 1450278797, "creation_date": 1450278797, "answer_id": 34315573, "question_id": 34314894, "link": "https://stackoverflow.com/questions/34314894/how-to-parse-integer-with-base-prefix-using-parsec-in-haskell/34315573#34315573", "title": "How to parse integer with base prefix using parsec in haskell?", "body": "<p>You have two slight errors:</p>\n\n<p>One indention error (<code>return x</code> must be indented compared to <code>do</code>) and the parsers in withPrefix must not be <code>return</code>ed, since they will <code>return</code> their results anyway.</p>\n\n<pre><code>parseNumber = do x &lt;- noPrefix &lt;|&gt; withPrefix\n                 return x\n      where noPrefix = many1 digit\n            withPrefix = do char '#'\n                            prefix &lt;- oneOf \"dox\"\n                            case prefix of\n                                'd' -&gt; many1 digit\n                                'o' -&gt; fmap (show . fst . head . readOct) (many1 octDigit)\n                                'x' -&gt; fmap (show . fst . head . readHex) (many1 hexDigit)\n</code></pre>\n\n<p>This should work</p>\n"}, {"comments": [{"owner": {"reputation": 6006, "user_id": 239558, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2362bc1c423993bbdb8548a3a059702c?s=128&d=identicon&r=PG", "display_name": "user239558", "link": "https://stackoverflow.com/users/239558/user239558"}, "edited": false, "score": 0, "creation_date": 1506461006, "post_id": 34555323, "comment_id": 79829248, "body": "Text.Megaparsec.Lexer doesn&#39;t exist in megaparsec anymore"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1598978448, "post_id": 34555323, "comment_id": 112628701, "body": "At this point, <code>hexadecimal</code> is found in <a href=\"https://hackage.haskell.org/package/megaparsec-8.0.0/docs/Text-Megaparsec-Char-Lexer.html#v:hexadecimal\" rel=\"nofollow noreferrer\">Text.Megaparsec.Char.Lexer</a> instead. Note also that before version 6.0.0 the function returned <code>Integer</code>, i.e. it wasn&#39;t polymorphic in its return type."}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 2, "last_activity_date": 1506683593, "last_edit_date": 1506683593, "creation_date": 1451643802, "answer_id": 34555323, "question_id": 34314894, "link": "https://stackoverflow.com/questions/34314894/how-to-parse-integer-with-base-prefix-using-parsec-in-haskell/34555323#34555323", "title": "How to parse integer with base prefix using parsec in haskell?", "body": "<p>In <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a>\u2014a modern\nfork of Parsec, this problem is non-existent (from\n<a href=\"https://hackage.haskell.org/package/megaparsec-6.2.0/docs/Text-Megaparsec-Char-Lexer.html#v:hexadecimal\" rel=\"nofollow noreferrer\">documentation of <code>hexadecimal</code></a>):</p>\n\n<blockquote>\n  <p>Parse an integer in hexadecimal representation. Representation of\n  hexadecimal number is expected to be according to Haskell report except\n  for the fact that this parser doesn't parse \u201c0x\u201d or \u201c0X\u201d prefix. It is\n  responsibility of the programmer to parse correct prefix before parsing\n  the number itself.</p>\n  \n  <p>For example you can make it conform to Haskell report like this:</p>\n\n<pre><code>hexadecimal = char '0' &gt;&gt; char' 'x' &gt;&gt; L.hexadecimal\n</code></pre>\n</blockquote>\n\n<p>So in your case you can just define (note how it's more readable):</p>\n\n<pre><code>import Data.Void\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport qualified Text.Megaparsec.Char.Lexer as L\n\ntype Parser = Parsec Void String\n\nparseNumber :: Parser Integer\nparseNumber = choice\n  [ L.decimal\n  , (string  \"o#\" *&gt; L.octal)       &lt;?&gt; \"octal integer\"\n  , (string  \"d#\" *&gt; L.decimal)     &lt;?&gt; \"decimal integer\"\n  , (string  \"h#\" *&gt; L.hexadecimal) &lt;?&gt; \"hexadecimal integer\" ]\n</code></pre>\n\n<p>Let's try the parser (note quality of error messages):</p>\n\n<pre><code>\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"\"\n1:1:\n  |\n1 | &lt;empty line&gt;\n  | ^\nunexpected end of input\nexpecting decimal integer, hexadecimal integer, integer, or octal integer\n\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"d#3\"\n3\n\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"h#ff\"\n255\n\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"o#8\"\n1:3:\n  |\n1 | o#8\n  |   ^\nunexpected '8'\nexpecting octal integer\n\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"o#77\"\n63\n\u03bb&gt; parseTest' (parseNumber &lt;* eof) \"190\"\n190\n</code></pre>\n\n<hr>\n\n<p>Full-disclosure: I'm the author/maintainer of Megaparsec.</p>\n"}], "owner": {"reputation": 1601, "user_id": 1617063, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zaLum.png?s=128&g=1", "display_name": "sayantankhan", "link": "https://stackoverflow.com/users/1617063/sayantankhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 1, "accepted_answer_id": 34315573, "answer_count": 2, "score": 3, "last_activity_date": 1506683593, "creation_date": 1450276890, "last_edit_date": 1450277819, "question_id": 34314894, "link": "https://stackoverflow.com/questions/34314894/how-to-parse-integer-with-base-prefix-using-parsec-in-haskell", "title": "How to parse integer with base prefix using parsec in haskell?", "body": "<p>I'm trying to parse an input integer string in haskell using parsec. The string might either be in decimal, octal or hexadecimal. The base is specified by a prefix of <code>#d</code>, <code>#o</code> or <code>#x</code> for decimal, octal and hexadecimal respectively, which is then followed by the integer. If no prefix is specified, the base is assumed to be 10. Here's what I've done so far:</p>\n\n<pre><code>parseNumber = do x &lt;- noPrefix &lt;|&gt; withPrefix\n             return x\n          where noPrefix = many1 digit\n                withPrefix = do char '#'\n                                prefix &lt;- oneOf \"dox\"\n                                return $ case prefix of\n                                    'd' -&gt; many1 digit\n                                    'o' -&gt; fmap (show . fst . head . readOct) (many1 octDigit)\n                                    'x' -&gt; fmap (show . fst . head . readHex) (many1 hexDigit)\n</code></pre>\n\n<p>However, this isn't compiling and is failing with type errors. I don't quite really understand the type error and would just like help in general with this problem. Any alternative ways to solve it will also be appreciated.</p>\n\n<p>Thank you for your time and help. :)</p>\n\n<p>EDIT: <a href=\"http://pastebin.com/PqKU10kf\" rel=\"nofollow\">Here's</a> the error I've been getting.</p>\n"}, {"tags": ["ubuntu", "haskell", "functional-programming", "hugs"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 3, "creation_date": 1450268917, "post_id": 34311904, "comment_id": 56365603, "body": "<code>readFile &quot;file&quot; &gt;&gt;= print . length . words</code> but you should learn some haskell before (follow some tutorial <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1450269608, "post_id": 34311904, "comment_id": 56366075, "body": "It worked perfectly. I will follow the tutorial. Thank you so much :)"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450270710, "post_id": 34312373, "comment_id": 56366890, "body": "So do we use the same logic when we try to find any characters? Are there any shortcut methods for that too??"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450279361, "post_id": 34312373, "comment_id": 56373173, "body": "I tried a code like this but gave an error for the letter &quot;s&quot;. What is the reason for the error?  readFile &quot;/tmp/foo.txt&quot;&gt;&gt;= print . length . filter s ;"}, {"owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1450350981, "post_id": 34312373, "comment_id": 56407702, "body": "Are you looking for total number of a specific character? You may use       <code>readFile &quot;&#47;tmp&#47;foo.txt&quot; &gt;&gt;= print . length . filter (== &#39;s&#39;)</code>."}], "tags": [], "owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "is_accepted": true, "score": 1, "last_activity_date": 1450269699, "creation_date": 1450269699, "answer_id": 34312373, "question_id": 34311904, "link": "https://stackoverflow.com/questions/34311904/word-count-of-a-file-with-haskell/34312373#34312373", "title": "Word count of a file with haskell", "body": "<p>You may use either one of the following: </p>\n\n<pre><code>main = readFile \"/tmp/foo.txt\" &gt;&gt;= print . length . words\n</code></pre>\n\n<p>or</p>\n\n<pre><code>main = do\n    contents &lt;- readFile \"/tmp/foo.txt\"\n    print . length . words $ contents\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 1, "accepted_answer_id": 34312373, "answer_count": 1, "score": 0, "last_activity_date": 1450269699, "creation_date": 1450268447, "question_id": 34311904, "link": "https://stackoverflow.com/questions/34311904/word-count-of-a-file-with-haskell", "title": "Word count of a file with haskell", "body": "<p>I have a problem with Haskell when i am trying to count the words of a file. I am just a beginner and this is my first program so i am pretty sure that it is a very simple mistake. \nI am using hugs to run my code. Until now i learnt how to read from a file but i failed to count the words in it. My code is something like this</p>\n\n<pre><code>main = do {\ncontents &lt;- readFile \"/tmp/foo.txt\";\nlet contents2 = replace\".\"\"\"contents;\nlet contents3 = replace\"!\"\"\"contents2;\nlet lower = map toLower contents3;\nlet chop = words(lower);\nlet count = show(length chop)++\"\\n\";\nputStrln $\"This file has\"++count++\"words\";\n}\n</code></pre>\n\n<p>Any help would be very appreciated. Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1450270009, "post_id": 34309733, "comment_id": 56366366, "body": "That&#39;s correct: an <code>Eq T</code> instance provides a way to compare two values of type <code>T</code>. In your case, that&#39;s two pairs."}], "tags": [], "owner": {"reputation": 605, "user_id": 412832, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YpjzD.jpg?s=128&g=1", "display_name": "Geert Van Laethem", "link": "https://stackoverflow.com/users/412832/geert-van-laethem"}, "is_accepted": false, "score": 4, "last_activity_date": 1450262210, "creation_date": 1450262210, "answer_id": 34309733, "question_id": 34309570, "link": "https://stackoverflow.com/questions/34309570/typeclass-for-my-pair-a-a/34309733#34309733", "title": "Typeclass for my Pair a a", "body": "<p>I think this is the correct one but I am not 100% sure.</p>\n\n<pre><code>instance Eq a =&gt; Eq (Pair a) where\n  (==) (Pair x x') (Pair y y') = x == y &amp;&amp; x' == y'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2138, "user_id": 2794292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e3e4f141c783c6562d345d77f685417?s=128&d=identicon&r=PG&f=1", "display_name": "concept3d", "link": "https://stackoverflow.com/users/2794292/concept3d"}, "is_accepted": true, "score": 6, "last_activity_date": 1450262435, "creation_date": 1450262435, "answer_id": 34309808, "question_id": 34309570, "link": "https://stackoverflow.com/questions/34309570/typeclass-for-my-pair-a-a/34309808#34309808", "title": "Typeclass for my Pair a a", "body": "<p>Your implementation doesn't work because </p>\n\n<pre><code>(==) :: a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>You are assuming (==) takes one argument ((Pair x x') is actually one argument) and it actually needs two. Hence the error, </p>\n\n<pre><code>Couldn't match expected type Pair a -&gt; Bool' with actual type Bool'\n</code></pre>\n\n<p><code>(==)</code> was partially applied so it returned <code>Pair a -&gt; Bool</code> while it was expected to return a Bool.</p>\n"}], "owner": {"reputation": 605, "user_id": 412832, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YpjzD.jpg?s=128&g=1", "display_name": "Geert Van Laethem", "link": "https://stackoverflow.com/users/412832/geert-van-laethem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 2, "accepted_answer_id": 34309808, "answer_count": 2, "score": 3, "last_activity_date": 1450262435, "creation_date": 1450261764, "question_id": 34309570, "link": "https://stackoverflow.com/questions/34309570/typeclass-for-my-pair-a-a", "title": "Typeclass for my Pair a a", "body": "<p>I got the following:</p>\n\n<pre><code>data Pair a =\n  Pair a a\n</code></pre>\n\n<p>And want to instantiate the Eq typeclass to it.</p>\n\n<pre><code>instance Eq (Pair a) where\n  (==) (Pair x x') = x == x'\n</code></pre>\n\n<p>I get the error:</p>\n\n<p><em>Couldn't match expected type Pair a -> Bool' with actual type Bool'</em></p>\n\n<p>What did I write wrong?</p>\n"}, {"tags": ["haskell", "cabal-install", "arrows"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1450277555, "post_id": 34304489, "comment_id": 56371876, "body": "What version of GHC are you using? Polykinded Typeable (for <code>Typeable a, ArrowSwitch a, ...</code>) was new in 7.8 I think."}, {"owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1450282353, "post_id": 34304489, "comment_id": 56375506, "body": "@ReidBarton I got 7.6.3. Installing 7.8 right now."}], "owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1450243440, "creation_date": 1450243440, "question_id": 34304489, "link": "https://stackoverflow.com/questions/34304489/error-when-installing-package-via-cabal-kind-mis-match", "title": "Error when installing package via Cabal - kind mis-match", "body": "<p>I'm trying to install package from this git repo: <a href=\"https://github.com/dwincort/SettableArrow\" rel=\"nofollow\">https://github.com/dwincort/SettableArrow</a></p>\n\n<p>I'm in my catalog and typing: </p>\n\n<pre><code>cabal install SettableArrow.cabal\n</code></pre>\n\n<p>getting this error on line 187:</p>\n\n<pre><code>Kind mis-match\nThe first argument of `ArrowSwitch' should have kind `* -&gt; * -&gt; *',\nbut `a' has kind `*'\nIn the instance declaration for `ArrowSwitch (SA a)'\n</code></pre>\n\n<p>The line where instance is defined:</p>\n\n<pre><code>class Arrow a =&gt; ArrowSwitch a where\nswitch :: (Typeable b, Typeable c) =&gt; a b c -&gt; a (b, Maybe (a b c)) c\n</code></pre>\n\n<p>187:</p>\n\n<pre><code>instance (Typeable a, ArrowSwitch a, ArrowLoop a , ArrowDelay a) =&gt; ArrowSwitch (SA a) where\n   switch (SA def) = SA $ loop $ \n     second (delay def) &gt;&gt;&gt; arr (\\(((b,msf),et),prevSF) -&gt; \n           ...\n</code></pre>\n\n<p>Is the error on my sidee or is something wrong with the code?\nThere is a paper on this if someone is interested:</p>\n\n<blockquote>\n  <p><a href=\"http://haskell.cs.yale.edu/wp-content/uploads/2015/10/dwc-yale-formatted-dissertation.pdf\" rel=\"nofollow\">http://haskell.cs.yale.edu/wp-content/uploads/2015/10/dwc-yale-formatted-dissertation.pdf</a></p>\n</blockquote>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "algebraic-data-types", "state-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450284620, "post_id": 34303970, "comment_id": 56377068, "body": "You wrote <code>(uniform 0 1 :: RVar Double)</code> but you declared the type of the function to be <code>m ()</code>. The monads must match - <code>m</code> must be equal to <code>RVar</code>, which it is not. You may <i>not</i> use the signature <code>(MonadRandom m, MonadState s m) =&gt; s -&gt; m ()</code> in particular because the <code>uniform</code> function is implemented for RVar, not for any MonadRandom."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450284718, "post_id": 34303970, "comment_id": 56377122, "body": "You can have <code>MonadState s m =&gt; s -&gt; RVarT m ()</code>, of course, simply use <code>uniformT :: Distribution Uniform a =&gt; a -&gt; a -&gt; RVarT m a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1450340307, "creation_date": 1450340307, "answer_id": 34329711, "question_id": 34303970, "link": "https://stackoverflow.com/questions/34303970/using-monadrandom-with-monadstate/34329711#34329711", "title": "Using MonadRandom with MonadState", "body": "<p><code>uniform</code> is not polymorphic in the monad it runs in (in other words, you can't run it in any choice of <code>m</code> if all you know is that <code>RandomSource m s</code>):</p>\n\n<pre><code>uniform :: Distribution Uniform a =&gt; a -&gt; a -&gt; RVar a\n</code></pre>\n\n<p>However, if you have a source of entropy, you can <code>runRVar</code> it in any <code>m</code> if <code>RandomSource m s</code>:</p>\n\n<pre><code>runRVar :: RandomSource m s =&gt; RVar a -&gt; s -&gt; m a\n</code></pre>\n\n<p>which means you can write <code>foo</code> with your desired type signature as</p>\n\n<pre><code>foo :: (MonadState s m, RandomSource m s) =&gt; s -&gt; m ()\nfoo s = do\n  p &lt;- runRVar (uniform 0 1 :: RVar Double) s\n  when (p &gt; 0.5) $ put s\n</code></pre>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1450340307, "creation_date": 1450240384, "last_edit_date": 1450339984, "question_id": 34303970, "link": "https://stackoverflow.com/questions/34303970/using-monadrandom-with-monadstate", "title": "Using MonadRandom with MonadState", "body": "<p>I have this bit of code:</p>\n\n<pre><code>import Data.Random\nimport Control.Monad.State\n\nfoo :: s -&gt; StateT s RVar ()\nfoo s = do\n  p &lt;- lift $ (uniform 0 1 :: RVar Double)\n  if p &gt; 0.5 then put s else return ()\n</code></pre>\n\n<p>And I would like to refactor its signature to be of form:</p>\n\n<pre><code>foo :: (MonadState s m, RandomSource m s) =&gt; s -&gt; m ()\n</code></pre>\n\n<p>I thought I could equip <code>RVar</code> with <code>MonadState</code> functions:</p>\n\n<pre><code>{- LANGUAGE MultiParamTypeClasses, FlexibleInstances, UndecidableInstances #-}\ninstance MonadState s m =&gt; MonadState s (RVarT m) where\n  get   = lift get\n  put   = lift . put\n  state = lift . state\n</code></pre>\n\n<p>and write:</p>\n\n<pre><code>foo :: (MonadState s m, RandomSource m s) =&gt; s -&gt; m ()\nfoo s = do\n  p &lt;- (uniform 0 1 :: RVar Double)\n  if p &gt; 0.5 then put s else return ()\n</code></pre>\n\n<p>But I am getting this inexplicable error:</p>\n\n<pre><code>    Couldn't match type \u2018m\u2019\n                   with \u2018t0 (RVarT Data.Functor.Identity.Identity)\u2019\n      \u2018m\u2019 is a rigid type variable bound by\n          the type signature for\n            foo :: (MonadState s m, RandomSource m s) =&gt; s -&gt; m ()\n          at ApproxMedian.hs:99:8\n    Expected type: m Double\n      Actual type: t0 (RVarT Data.Functor.Identity.Identity) Double\n    Relevant bindings include\n      foo :: s -&gt; m () (bound at ApproxMedian.hs:100:1)\n    In a stmt of a 'do' block: p &lt;- lift $ (uniform 0 1 :: RVar Double)\n    In the expression:\n      do { p &lt;- lift $ (uniform 0 1 :: RVar Double);\n           if p &gt; 0.5 then put s else return () }\n    In an equation for \u2018foo\u2019:\n        foo s\n          = do { p &lt;- lift $ (uniform 0 1 :: RVar Double);\n                 if p &gt; 0.5 then put s else return () }\nFailed, modules loaded: Core, Statistics.\n</code></pre>\n\n<ol>\n<li><p>Please explain the error and help make the more generic signature possible?</p></li>\n<li><p>If I wanted to do:</p>\n\n<pre><code>foo :: (MonadRandom m, MonadState s m) =&gt; s -&gt; m ()\n</code></pre></li>\n</ol>\n\n<p>How would I implement it?  I cannot use <code>uniform</code> any more. Because it locks me to signature <code>RVar a</code> but I really want <code>MonadRandom m =&gt; m a</code>, \nor at the very least <code>Monad m =&gt; RVarT m a</code></p>\n"}, {"tags": ["haskell", "transform", "monads", "comonad"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450241483, "post_id": 34302616, "comment_id": 56350309, "body": "I&#39;m thinking you might make something of the fact that <code>Dual f a</code> is isomorphic to <code>forall r . Compose f ((-&gt;) a) r -&gt; Identity r</code>, which I believe is the type of natural transformations from <code>Compose f ((-&gt;) a)</code> to <code>Identity</code>. I don&#39;t know enough to make much of it myself."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 12, "creation_date": 1450255139, "post_id": 34302616, "comment_id": 56356184, "body": "The answer is <a href=\"http://comonad.com/reader/2011/monads-from-comonads/\" rel=\"nofollow noreferrer\">no</a> according to Kmett."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1482566256, "post_id": 34302616, "comment_id": 69826157, "body": "Note that the cited blog only says such a comonad won&#39;t be useful &#39;in practice&#39;, even if it existed. In fact it exists, and I think it may be useful, as it geometrically encodes the structure of a data type."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1482566422, "post_id": 34302616, "comment_id": 69826190, "body": "Also, do note that combining laziness and fixpoints breaks parametricity and hence most of the categorical arguments in an intuitionistic calculus."}], "answers": [{"tags": [], "owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "is_accepted": false, "score": 5, "last_activity_date": 1482560215, "creation_date": 1482560215, "answer_id": 41310861, "question_id": 34302616, "link": "https://stackoverflow.com/questions/34302616/can-you-define-comonads-based-on-monads/41310861#41310861", "title": "Can you define `Comonads` based on `Monads`?", "body": "<p>Yes, in fact any functor gives rise to a unique comonad in this way, unless f==0.</p>\n\n<p>Let F be an endofunctor on Hask. Let</p>\n\n<pre><code>W(a) = \u2200r.F(a-&gt;r)-&gt;r\nW(f) = F(f\u2217)\u2217\n       where g\u2217(h) = h\u2218g\n</code></pre>\n\n<p>The puzzle becomes geometric/combinatoric in nature once you realize the following isomorphism:</p>\n\nTheorem 1.\n\n<p>Suppose neither of the types (\u2200r.r->F(r)) (\u2200r.F(r)->r) is empty. Then there is an isomorphism of types W(a) \u2243 (\u2200r.F(r)->r, a).</p>\n\nProof:\n\n<pre><code>class Functor f =&gt; Fibration f where\n        projection   :: \u2200r. f(r)-&gt;r\n        some_section :: \u2200r. r-&gt;f(r) -- _any_ section will work\n\nto :: forall f a. Fibration f\n      =&gt; (\u2200r.f(a-&gt;r) -&gt; r)\n      -&gt; (\u2200r.f(r)-&gt;r, a)\nto(f) = ( f . fmap const\n        , f(some_section(id)))\n\nfrom :: forall f a. Fibration f\n        =&gt; (\u2200r.f(r)-&gt;r, a)\n        -&gt; (\u2200r.f(a-&gt;r) -&gt; r)\nfrom (\u03c0,\u03b7) = ev(\u03b7) . \u03c0\n\nev :: a -&gt; (a-&gt;b) -&gt; b\nev x f = f x\n</code></pre>\n\n<p>Filling up the details of this (which I can post on request) will require\na bit of parametricity and Yoneda lemma. When F is not a Fibration (as I defined above), W is trivial as you observed.</p>\n\n<p>Let us call a fibration a covering if the projection is unique (though I'm not sure if this usage is appropriate).</p>\n\n<p>Admitting the theorem, you can see W(a) as the coproduct of a's indexed by _all possible fibrations \u2200r.F(r)->r, i.e.</p>\n\n<pre><code>W(a) \u2243 \u2210a\n       \u03c0::\u2200f.F(r)-&gt;r\n</code></pre>\n\n<p>In other words, the functor W (as a presheaf on Func(Hask)) takes a fibration and constructs a canonically trivialized covering space from it.</p>\n\n<p>As an example, let F(a)=(Int,a,a,a). Then we have three evident natural fibrations F(a)->a. Writing the coproduct by +, the following diagram together with the above theorem should hopefully be enough to describe the comonads concretely:</p>\n\n<pre><code>           a\n           ^\n           | \u03b5\n           |\n         a+a+a\n        ^  |  ^\n     W\u03b5 |  |\u03b4 | \u03b5W\n        |  v  |\n(a+a+a)+(a+a+a)+(a+a+a)\n</code></pre>\n\n<p>So the counit is unique. Using evident indices into the coproduct, W\u03b5 maps (i,j) to j, \u03b5W maps (i,j) to i. So \u03b4 must be the unique 'diagonal' map, namely \u03b4(i) == (i,i)!</p>\n\nTheorem 2.\n\n<p>Let F be a Fibration and let \u03a9W be the set of all comonads with the underlying functor W. Then \u03a9W\u22431.</p>\n\n<p>(Sorry I have not formalized the proof.)</p>\n\n<p>An analogous combinatorial argument for the set of monads \u039cW would be interesting too, but in this case \u039cW may not be a singleton. (Take some constant c and set \u03b7:1->c and \u03bc(i,j)=i+j-c.)</p>\n\n<p>Note that the monads/comonads so constructed are <em>not</em> the duals to the original comonads/monads in general. For instance let M be a monad\n(F(a)=(Int,a), \u03b7(x) = (0,x), \u03bc(n,(m,x)) = (n+m,x)), i.e. a <code>Writer</code>. The natural projection is unique hence by the theorem W(a)\u2243a, and there is no way to respect the original algebra.</p>\n\n<p>Note also that a comonad is trivially a Fibration (in possibly many different ways) unless <code>Void</code>, which is why you got a Monad from a Comonad (but that's not necessarily unique!).</p>\n\n<p>A few comments about your observations:</p>\n\n<ul>\n<li><p><code>Dual IO a</code> is essentially Void</p>\n\n<p>As far as I know, in Haskell IO is defined something like:</p>\n\n<pre><code>  -- ghc/libraries/ghc-prim/GHC/Types.hs\n newtype IO a = IO (State# RealWorld -&gt; (# State# RealWorld, a #))\n</code></pre>\n\n<p>which means from the type theory alone the corresponding covering is_   the unique canonical covering  space indexed by all <code>State# RealWorld</code>s. Whether you can (or should) reject this is probably a philosophical, rather than a technical question.</p></li>\n<li><p><code>MonadPlus m =&gt; Dual m a</code> is Void</p>\n\n<p>Right, but do note that if F(a)=0 then W(a)=1 and it's not a comonad (because otherwise the counit  would imply the type W(0)->0 \u2243 1->0). This is the only case where W can not even be a trivial comonad given an  arbitrary functor.</p></li>\n<li><p><code>Dual Reader</code> is..\nThose statements will sometimes be correct, sometimes not. Depends on whether the (co)algebra  of interest agrees with the (bi)algebra of coverings.</p></li>\n</ul>\n\n<p>So I'm surprised how interestingly geometric Haskell really is! I guess there may be very many geometric constructions similar to this. For example a natural generalization of this would be to consider the 'canonical trivialization' of F->G for some covariant functors F,G. Then the automorphism group for the base space would no longer be trivial, so a bit more theory would be required to properly understand this.</p>\n\n<p>Finally, here's a  proof of concept code. Thanks for a great refreshing puzzle, and have a very merry Christmas ;-)</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Comonad\n\nclass Functor f =&gt; Fibration f where\n        x0 :: f ()\n        x0 = some_section ()\n\n        some_section :: forall r. r -&gt; f(r)\n        some_section x = fmap (const x) x0\n\n        projection :: forall r. f(r) -&gt; r\n\nnewtype W f a = W { un_w :: forall r. f(a-&gt;r)-&gt;r }\n\ninstance Functor f =&gt;  Functor (W f) where\n        fmap f (W c) = W $ c . fmap (. f)\n\ninstance Fibration f =&gt; Comonad (W f) where\n        extract = \u03b5\n        duplicate = \u03b4\n\n-- The counit is determined uniquely, independently of the choice of a particular section.\n\u03b5 :: forall f a. Fibration f =&gt; W f a -&gt; a\n\u03b5 (W f) = f (some_section id)\n\n-- The comultiplication is unique too.\n\u03b4 :: forall f a. Fibration f =&gt; W f a -&gt; W f (W f a)\n\u03b4 f = W $ ev(f) . un_w f . fmap const\n\nev :: forall a b. a -&gt; (a-&gt;b)-&gt;b\nev x f = f x\n\n-- An Example\ndata Pair a = P {p1 ::a\n                ,p2 :: a\n                 }\n               deriving (Eq,Show)\n\ninstance Functor Pair where\n        fmap f (P x y) = P (f x)  (f y)\n\ninstance Fibration Pair where\n        x0 = P () ()\n        projection = p1\n\ntype PairCover a = W Pair a\n\n-- How to construct a cover (you will need unsafePerformIO if you want W IO.)\ncover :: a -&gt; W Pair a\ncover x = W $ ev(x) . p1\n</code></pre>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 591, "favorite_count": 10, "answer_count": 1, "score": 31, "last_activity_date": 1482560215, "creation_date": 1450229960, "question_id": 34302616, "link": "https://stackoverflow.com/questions/34302616/can-you-define-comonads-based-on-monads", "title": "Can you define `Comonads` based on `Monads`?", "body": "<p>Okay, so let's say you have the type</p>\n\n<pre><code>newtype Dual f a = Dual {dual :: forall r. f(a -&gt; r)-&gt;r}\n</code></pre>\n\n<p>As it turns out, when <code>f</code> is a Comonad, <code>Dual f</code> is a Monad (fun exercise). Does it work the other way around?</p>\n\n<p>You can define <code>fmap ab (Dual da) = Dual $ \\fb -&gt; da $ fmap (. ab) fb</code> and <code>extract (Dual da) = da $ return id</code>, but I do not know how to define <code>duplicate</code> or <code>extend</code>.</p>\n\n<p>Is this even possible? If not, what the proof there is not (is there a particular Monad <code>m</code> for which you can prove <code>Dual m</code> is not a comonad)?</p>\n\n<p>Some observations:\n<code>Dual IO a</code> is essentially <code>Void</code> (and <code>Const Void</code> is a valid <code>Comonad</code>).\n<code>Dual m a</code> for <code>MonadPlus m</code> <em>is</em> <code>Void</code> (just use <code>dual mzero</code>).\n<code>Dual Reader</code> is <code>Env</code>.\n<code>Dual Writer</code> is <code>Traced</code>.\n<code>Dual State</code> is <code>Store</code>, I think.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 303, "user_id": 672602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/153f1bc1b9c07e9e29fe7916beb958a4?s=128&d=identicon&r=PG", "display_name": "Axim", "link": "https://stackoverflow.com/users/672602/axim"}, "reply_to_user": {"reputation": 418, "user_id": 5420801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/952d114ec8e40abcf85fb35d03abb3cf?s=128&d=identicon&r=PG&f=1", "display_name": "John E.", "link": "https://stackoverflow.com/users/5420801/john-e"}, "edited": false, "score": 0, "creation_date": 1450212414, "post_id": 34298977, "comment_id": 56339925, "body": "@JohnE. I&#39;m sorry but you&#39;re gonna have to elaborate on that."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1450212516, "post_id": 34298977, "comment_id": 56339997, "body": "Try flushing stdout after your putStr. (I think turning off buffering is, when applied generally, a bad idea.)"}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1450212791, "last_edit_date": 1450212791, "creation_date": 1450212471, "answer_id": 34299090, "question_id": 34298977, "link": "https://stackoverflow.com/questions/34298977/how-does-one-put-characters-at-the-beginning-of-an-input-line-in-a-compiled-prog/34299090#34299090", "title": "How does one put characters at the beginning of an input line in a compiled program?", "body": "<p>That is due to <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:BufferMode\" rel=\"nofollow\">buffering</a>, you may turn it off by:</p>\n\n<pre><code>import System.IO (stdout, hSetBuffering, BufferMode(NoBuffering))\n\nmain :: IO ()\nmain = do\n    hSetBuffering stdout NoBuffering\n    -- rest of the code\n</code></pre>\n\n<p>or alternatively do <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#v:hFlush\" rel=\"nofollow\"><code>hFlush stdout</code></a> when you need to flush the io stream.</p>\n"}], "owner": {"reputation": 303, "user_id": 672602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/153f1bc1b9c07e9e29fe7916beb958a4?s=128&d=identicon&r=PG", "display_name": "Axim", "link": "https://stackoverflow.com/users/672602/axim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1450213686, "accepted_answer_id": 34299090, "answer_count": 1, "score": 2, "last_activity_date": 1450212791, "creation_date": 1450211992, "question_id": 34298977, "link": "https://stackoverflow.com/questions/34298977/how-does-one-put-characters-at-the-beginning-of-an-input-line-in-a-compiled-prog", "closed_reason": "Duplicate", "title": "How does one put characters at the beginning of an input line in a compiled program?", "body": "<p>I'm currently writing a basic console application in Haskell, and I wanted to make it obvious to the user when they're being asked for input by putting <code>&gt;</code> at the beginning of the line. Sounds simple enough, right?</p>\n\n<p>Consider this bit of code:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    putStr \"\\nSay something:\\n&gt; \"\n    input &lt;- getLine\n    putStrLn (\"You said \" ++ input)\n</code></pre>\n\n<p>This works perfectly as intended when executed in ghci, however when I compile and run the program, now this happens:</p>\n\n<pre><code>Say something:\nsomething\n&gt; You said something\n</code></pre>\n\n<p>Can someone please explain to me how and why this difference in behavior arises, and how I should go about achieving the result I have in mind?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450214363, "post_id": 34299500, "comment_id": 56341059, "body": "Yes, I&#39;m aware of this limitation, which greatly limits the utility of the instance. What&#39;s not yet clear to me is whether this limitation affects its <i>validity</i>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450216744, "post_id": 34299500, "comment_id": 56342316, "body": "Okay, I think I see how this breaks things now. I posted an answer I suspect proves it."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1450232191, "post_id": 34299500, "comment_id": 56347938, "body": "I hear GHC 8.0 will support time travel with respect to <code>IO</code>."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1450214326, "last_edit_date": 1450214326, "creation_date": 1450214020, "answer_id": 34299500, "question_id": 34298726, "link": "https://stackoverflow.com/questions/34298726/does-backwards-admit-a-monad-instance/34299500#34299500", "title": "Does Backwards admit a Monad instance?", "body": "<p>For this <code>f</code> would need to be lazy, that is, the effect must not depend on the argument. The <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-Fix.html#t:MonadFix\" rel=\"nofollow\">docs</a> say</p>\n\n<blockquote>\n  <p><code>mfix f</code> executes the action <code>f</code> only once, with the eventual output fed back as the input. Hence <code>f</code> should not be strict, for then <code>mfix f</code> would diverge.</p>\n</blockquote>\n\n<p>Buf if <code>f</code> in your case <code>m &gt;&gt;= f</code> will be strict, then so will be the block passed to <code>mfix</code>.</p>\n\n<p>Let's consider a practical example where <code>m</code> is <code>readLine &gt;&gt;= putStrLn</code>. Reversing the order would mean \"print the data, then read it\". Unless the effect of the function behind <code>&gt;&gt;=</code> doesn't depend on the input, this diverges.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1450219155, "last_edit_date": 1495535240, "creation_date": 1450216440, "answer_id": 34300126, "question_id": 34298726, "link": "https://stackoverflow.com/questions/34298726/does-backwards-admit-a-monad-instance/34300126#34300126", "title": "Does Backwards admit a Monad instance?", "body": "<p>No, it is not valid; the monad laws at best hold in some approximate fashion. As <a href=\"https://stackoverflow.com/a/34299500/1477667\">Petr Pudl\u00e1k's answer</a> shows, <code>Backwards m &gt;&gt;= f</code> does not behave very nicely when <code>f</code> is strict in its argument.</p>\n\n<p>According to the monad laws,</p>\n\n<pre><code>pure () &gt;&gt;= (\\() -&gt; m)   =   m\n</code></pre>\n\n<p>But with this instance, if I'm not mistaken,</p>\n\n<pre><code>pure () &gt;&gt;= (\\() -&gt; m) = Backwards $ do\n  fin &lt;- forwards (int `seq` m)\n  int &lt;- pure ()\n  pure fin\n  = Backwards $ fmap fst $ mfix $ \\ ~(_, int) -&gt; do\n     fin &lt;- forwards (int `seq` m)\n     pure (fin, ())\n</code></pre>\n\n<p>If the underlying monad is \"strict\" (i.e., its <code>&gt;&gt;=</code> is strict in its left operand), this will diverge.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1450234955, "creation_date": 1450211144, "last_edit_date": 1450234955, "question_id": 34298726, "link": "https://stackoverflow.com/questions/34298726/does-backwards-admit-a-monad-instance", "title": "Does Backwards admit a Monad instance?", "body": "<p>I just asked this on haskell-cafe, but I figure I might as well ask here too. Is the following <code>Monad</code> instance for <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Applicative-Backwards.html\" rel=\"nofollow\"><code>Backwards m</code></a> valid?</p>\n\n<pre><code>{-# Language RecursiveDo #-}\n\nimport Control.Applicative.Backwards\nimport Control.Monad.Fix\n\ninstance MonadFix m =&gt; Monad (Backwards m) where\n  m &gt;&gt;= f = Backwards $\n    do\n      fin &lt;- forwards (f int)\n      int &lt;- forwards m\n      pure fin\n</code></pre>\n\n<p>If so, could I also add this?</p>\n\n<pre><code>instance MonadFix m =&gt; MonadFix (Backwards m) where\n  mfix f = Backwards $ mfix (forwards . f)\n</code></pre>\n"}, {"tags": ["haskell", "post", "proxy", "get"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1450207891, "post_id": 34296589, "comment_id": 56337266, "body": "Side note: <code>fromJust</code> is bad practice because it can fail"}], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1450204939, "post_id": 34296777, "comment_id": 56335514, "body": "and how to set the data which should be posted?"}, {"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1450210198, "post_id": 34296777, "comment_id": 56338706, "body": "must I replace <code>&quot;body itself as a ByteString&quot;</code> with my data <code>&quot;t=12wwe2&amp;args=aafe32&quot;</code> ?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1450205300, "last_edit_date": 1450205300, "creation_date": 1450204173, "answer_id": 34296777, "question_id": 34296589, "link": "https://stackoverflow.com/questions/34296589/haskell-apply-code-for-get-https-to-post-http/34296777#34296777", "title": "Haskell apply Code for Get/Https to Post/HTTP", "body": "<p>The <code>parseURL</code> function returns a <code>Request</code>, that you can configure to set proxy, HTTP method (GET, POST, PUT etc), headers etc. For example, to set a method, use <code>method</code> record selector. From the <a href=\"http://hackage.haskell.org/package/http-conduit-2.1.8/docs/Network-HTTP-Conduit.html#t:Request\" rel=\"nofollow\">docs</a>:</p>\n\n<pre><code>initReq &lt;- parseUrl \"http://www.example.com/path\"\nlet req = initReq\n            { method = \"POST\"\n            }\n</code></pre>\n\n<p>To set request body:</p>\n\n<pre><code>let req = initReq\n            { method = \"POST\"\n            , requestBody = RequestBodyBS \"body itself as a ByteString\"\n            }\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 34296777, "answer_count": 1, "score": 0, "last_activity_date": 1450205300, "creation_date": 1450203553, "question_id": 34296589, "link": "https://stackoverflow.com/questions/34296589/haskell-apply-code-for-get-https-to-post-http", "title": "Haskell apply Code for Get/Https to Post/HTTP", "body": "<p>I have code which works with a post request and proxy for <code>htpp://</code> sites:</p>\n\n<pre><code>main = do\n  rsp &lt;- browse $ do\n    setProxy . fromJust $ parseProxy \"128.199.232.117:3128\"\n    request $ getRequest \"https://www.youtube.com/watch?v=yj_wyw6Xrq4\"\n    --request $ postRequestWithBody \"http://www.youtube.com/service_ajax\" \"application/x-www-form-urlencoded\" \"se=8pH38AERCAASDQoLeWpfd3l3NlhycTQ%3D&amp;itct=CDMQpUEiEwiS-rKDqN7JAhXQFxwKHeLMCi8o-B0\"\n  print $ rspBody &lt;$&gt; rsp\n</code></pre>\n\n<p>And I have code which works with a get request and proxy for <code>https://</code> sites:</p>\n\n<pre><code>main = do\n    req &lt;- parseUrl \"https://github.com/\"\n    let settings = mkManagerSettings (TLSSettingsSimple True False False) Nothing\n    manager &lt;- newManager settings\n    let ret = addProxy \"128.199.232.117\" 3128 req\n    res &lt;- httpLbs ret manager\n    print res\n</code></pre>\n\n<p>My aim: Have code which works with a post request and proxy for <code>htpps://</code> sites.</p>\n\n<p>My problem: I'm not skilled enought to apply the <code>https://</code> comatible code to my post request.</p>\n\n<p>Could someone show me the solution please? Thanks</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1450203338, "post_id": 34295874, "comment_id": 56334599, "body": "Or you could use &quot;takeUntil isDone $ iterate func initialValue&quot;"}], "tags": [], "owner": {"reputation": 1, "user_id": 3974621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b80a19e4fb60c7d16c4fcf0b8e2d28d0?s=128&d=identicon&r=PG&f=1", "display_name": "Rik", "link": "https://stackoverflow.com/users/3974621/rik"}, "is_accepted": false, "score": 0, "last_activity_date": 1450201158, "creation_date": 1450201158, "answer_id": 34295874, "question_id": 34295599, "link": "https://stackoverflow.com/questions/34295599/how-to-apply-same-function-on-previous-calculated-result-in-haskell/34295874#34295874", "title": "How to apply same function on previous calculated result in Haskell", "body": "<p>I think you may want something like this</p>\n\n<pre><code>funcApplier inp\n    | isDone inp = inp\n    | otherwise = funcApplier (func inp)\n</code></pre>\n\n<p>where <code>isDone</code> is a boolean-returning function that determines that your input is in the state that you desire.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4709293"}, "edited": false, "score": 0, "creation_date": 1450202432, "post_id": 34296030, "comment_id": 56334023, "body": "Iterate can be applied to specific functions? I mean, can I apply iterate to a function like func::[String]-&gt;String-&gt;[[String]]?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 2, "creation_date": 1450204679, "post_id": 34296030, "comment_id": 56335368, "body": "It expectedly only works for functions that return the same type that they accept. Else you cannot apply that function to its own result. So <code>[String] -&gt; [String]</code> would be acceptable, and <code>[String] -&gt; [[String]]</code> would not be. Same is true for your code fragment in the question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450206132, "post_id": 34296030, "comment_id": 56336198, "body": "If you have <code>f :: [String] -&gt; [[String]]</code> you can still iterate with <code>iterate (concat . f)</code>, which will simply collect all of the result lists into one list."}], "tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 2, "last_activity_date": 1450201623, "creation_date": 1450201623, "answer_id": 34296030, "question_id": 34295599, "link": "https://stackoverflow.com/questions/34295599/how-to-apply-same-function-on-previous-calculated-result-in-haskell/34296030#34296030", "title": "How to apply same function on previous calculated result in Haskell", "body": "<p>There is <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:iterate\" rel=\"nofollow\"><code>iterate</code></a> which seems to fit the bill:</p>\n\n<pre><code>result = take however_many_you_need $ iterate func initial_value\n</code></pre>\n\n<p>Haskell's laziness guarantees that <code>func</code> will be calculated just enough times.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4709293"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1450201623, "creation_date": 1450200238, "last_edit_date": 1450201376, "question_id": 34295599, "link": "https://stackoverflow.com/questions/34295599/how-to-apply-same-function-on-previous-calculated-result-in-haskell", "title": "How to apply same function on previous calculated result in Haskell", "body": "<p>I have a Haskell function that <strong><em>returns</em></strong> a list <code>(h:t)</code>.\nI want to apply the function recursively on its own results. Like this:</p>\n\n<pre><code>func (inp1) -&gt; result1;\nfunc (result1) -&gt; result2;\nfunc (result2) -&gt; result3;\n...\n</code></pre>\n\n<p>How can I do this?</p>\n"}, {"tags": ["http", "haskell", "proxy", "get"], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1450203043, "post_id": 34296179, "comment_id": 56334408, "body": "doesnt work @Yuras : <code>Couldn&#39;t match expected type \u2018Data.ByteString.Internal.ByteString\u2019                 with actual type \u2018[Char]\u2019     In the first argument of \u2018addProxy\u2019, namely \u2018&quot;128.199.232.117&quot;\u2019</code>"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 1, "creation_date": 1450203220, "post_id": 34296179, "comment_id": 56334522, "body": "@MartinFischer are you sure you added the <code>OverloadedStrings</code> pragma?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 1, "last_activity_date": 1450202104, "creation_date": 1450202104, "answer_id": 34296179, "question_id": 34295398, "link": "https://stackoverflow.com/questions/34295398/haskell-https-get-proxy-request/34296179#34296179", "title": "Haskell Https Get Proxy Request", "body": "<p>Looks like you are using <a href=\"https://hackage.haskell.org/package/HTTP-4000.2.22/docs/Network-Browser.html#v:browse\" rel=\"nofollow\">HTTP</a> package it the first snippet and <a href=\"http://hackage.haskell.org/package/http-conduit-2.1.8/docs/Network-HTTP-Conduit.html#v:mkManagerSettings\" rel=\"nofollow\">http-conduit</a> in the second one.</p>\n\n<p>Unfortunately <code>HTTP</code> doesn't support <code>https</code>, so your can't \"integrate\" the second snippet into the first one. But <code>http-conduit</code> supports proxies, so you can use <a href=\"http://hackage.haskell.org/package/http-conduit-2.1.8/docs/Network-HTTP-Conduit.html#v:addProxy\" rel=\"nofollow\">addProxy</a> function to set proxy host and port (not tested):</p>\n\n<pre><code>{-# LANGUAGE OverloadesStrings #-}\n...\nrequest &lt;- do\n  req &lt;- parseUrl \"https://github.com/\"\n  return $ addProxy \"128.199.232.117\" 3128 req\n...\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 34296179, "answer_count": 1, "score": 0, "last_activity_date": 1450202104, "creation_date": 1450199664, "question_id": 34295398, "link": "https://stackoverflow.com/questions/34295398/haskell-https-get-proxy-request", "title": "Haskell Https Get Proxy Request", "body": "<p>I have a working <code>getRequest</code> via a <code>Proxy</code> :</p>\n\n<pre><code>main = do\n  rsp &lt;- browse $ do\n    setProxy . fromJust $ parseProxy \"128.199.232.117:3128\"\n    request $ getRequest \"https://www.youtube.com/watch?v=yj_wyw6Xrq4\"\n  print $ rspBody &lt;$&gt; rsp\n</code></pre>\n\n<p>But it's <code>htpps</code> and so basically I get an Exception. But I foud out <a href=\"https://hackage.haskell.org/package/http-conduit-2.1.8/docs/Network-HTTP-Conduit.html\" rel=\"nofollow\">here</a> that it can also work with <code>htpps</code> :</p>\n\n<pre><code>import Network.Connection (TLSSettings (..))\nimport Network.HTTP.Conduit\n\nmain :: IO ()\nmain = do\n    request &lt;- parseUrl \"https://github.com/\"\n    let settings = mkManagerSettings (TLSSettingsSimple True False False) Nothing\n    manager &lt;- newManager settings\n    res &lt;- httpLbs request manager\n    print res\n</code></pre>\n\n<p>But I have no idea how to integrate this into my Proxy getRequest Code?</p>\n\n<p>Could someone show me please? Thanks</p>\n"}, {"tags": ["haskell", "command-line-arguments", "optparse-applicative"], "comments": [{"owner": {"reputation": 14562, "user_id": 71116, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7e3643cd0195fab5a3bfa310b5ea27e7?s=128&d=identicon&r=PG", "display_name": "Michael Steele", "link": "https://stackoverflow.com/users/71116/michael-steele"}, "edited": false, "score": 2, "creation_date": 1450238738, "post_id": 34294202, "comment_id": 56349567, "body": "See the <a href=\"http://stackoverflow.com/a/31955871/71116\">answer</a> that the author of optparse-applicative gave to a similar question. It seems that the <code>Alternative</code> instance of <code>Parser</code> does not do backtracking"}], "owner": {"reputation": 1001, "user_id": 4234663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20acdc3ff5edb482ae83b033c90c2166?s=128&d=identicon&r=PG", "display_name": "j-keck", "link": "https://stackoverflow.com/users/4234663/j-keck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "closed_date": 1450247795, "answer_count": 0, "score": 2, "last_activity_date": 1505238568, "creation_date": 1450196327, "last_edit_date": 1505238568, "question_id": 34294202, "link": "https://stackoverflow.com/questions/34294202/program-mode-determined-from-arguments-count-optparse-applicative", "closed_reason": "Duplicate", "title": "program mode determined from arguments count [optparse-applicative]", "body": "<p>i will determine the program mode from the arguments count (without flags / 'subparser' &amp; 'command') but without success.</p>\n\n<h2>ghci session</h2>\n\n<pre><code>main% stack ghci optparse-applicative\nConfiguring GHCi with the following packages: \nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n\u03bb: :load Main.hs \n[1 of 1] Compiling Main             ( Main.hs, interpreted )\nOk, modules loaded: Main.\n\u03bb: :main -v\nv 0.0.1\n\u03bb: :main a\nmode 1 with a: a\n\u03bb: :main a b\nUsage: &lt;interactive&gt; (-v | a | a b)\n*** Exception: ExitFailure 1\n</code></pre>\n\n<p>with <strong>:main a b</strong> i expected <strong>mode 2 with a: a and b: b</strong> as the result.</p>\n\n<p>what did i miss? thanks!</p>\n\n<hr>\n\n<h2>Main.hs</h2>\n\n<pre><code>module Main where\n\nimport           Options.Applicative\n\ndata AppArgs = ShowVersion\n             | Mode1 {\n                 a :: String\n               }\n             | Mode2 {\n                 a :: String\n               , b :: String\n               }\n\n\nmain :: IO ()\nmain = execParser opts &gt;&gt;= run\n    where opts = info (helper &lt;*&gt; appArgs)\n                 ( fullDesc\n                 &lt;&gt; header \"example\")\n\n\nappArgs :: Parser AppArgs\nappArgs = flag' ShowVersion (short 'v')\n       &lt;|&gt; Mode1 &lt;$&gt; strArgument (metavar \"a\")\n       &lt;|&gt; Mode2 &lt;$&gt; strArgument (metavar \"a\") &lt;*&gt; strArgument (metavar \"b\")\n\n\nrun :: AppArgs -&gt; IO ()\nrun ShowVersion = putStrLn \"v 0.0.1\"\nrun (Mode1 a)   = putStrLn $ \"mode 1 with a: \" ++ a\nrun (Mode2 a b) = putStrLn $ \"mode 2 with a: \" ++ a ++ \" and b: \" ++ b\n</code></pre>\n"}, {"tags": ["haskell", "proxy"], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1450198392, "post_id": 34294669, "comment_id": 56331421, "body": "Thanks, works fine. But @CRDrost could you please also add a &quot;fix&quot; for https url&#39;s ? I found here an example hwo to use https: <a href=\"https://hackage.haskell.org/package/http-conduit-2.1.8/docs/Network-HTTP-Conduit.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/http-conduit-2.1.8/docs/&hellip;</a> but i dont know how to implement this. thanks"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "edited": false, "score": 0, "creation_date": 1450203946, "post_id": 34294669, "comment_id": 56334953, "body": "I mean I think that&#39;s a separate question, but that library apparently starts with <code>requestTemplate = parseUrl &quot;https:&#47;&#47;www.google.com&#47;&quot;</code> (or whatever) and then you would create a proxy (<code>{-# LANGUAGE: OverloadedStrings #-}</code> up top, then <code>myProxy = Proxy &quot;127.0.0.1&quot; 8118</code>), then you would set the request up by filling in the proxy using record syntax and the provided <code>urlEncodedBody</code> function, <code>request = urlEncodedBody [(&quot;IP&quot;, &quot;79.212.82.103&quot;)] (requestTemplate{ proxy = Just myProxy })</code>. Then <code>newManager &gt;&gt;= http request</code> works for one query, or you&#39;ll use <code>do</code> to cache the manager.)"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 3, "last_activity_date": 1450197558, "creation_date": 1450197558, "answer_id": 34294669, "question_id": 34294176, "link": "https://stackoverflow.com/questions/34294176/haskell-proxy-post-request/34294669#34294669", "title": "Haskell Proxy Post request", "body": "<p>It's pretty simple if you keep track of what you're doing.</p>\n\n<p>We need to use <code>request</code> but feed it a POST request rather than a GET request. To make these we use <code>postRequestWithBody</code> which Hackage tells us has the parameters</p>\n\n<pre><code>postRequestWithBody :: String             | URL to POST to\n                       -&gt; String          | Content-Type of body\n                       -&gt; String          | The body of the request\n                       -&gt; Request_String  | The constructed request\n</code></pre>\n\n<p>So replace <code>request $ getRequest \"http://www.google.com\"</code> with:</p>\n\n<pre><code>request $ postRequestWithBody  \"http://www.geocodeip.com/\" \"application/x-www-form-urlencoded\" \"IP=79.212.82.103\"\n</code></pre>\n\n<p>...and you'll be good.</p>\n"}], "owner": {"reputation": 675, "user_id": 4784666, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh3.googleusercontent.com/-Mb9XpU7rE_o/AAAAAAAAAAI/AAAAAAAAABE/KbF_UYZ95wQ/photo.jpg?sz=128", "display_name": "Martin Fischer", "link": "https://stackoverflow.com/users/4784666/martin-fischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 34294669, "answer_count": 1, "score": 2, "last_activity_date": 1450197558, "creation_date": 1450196253, "question_id": 34294176, "link": "https://stackoverflow.com/questions/34294176/haskell-proxy-post-request", "title": "Haskell Proxy Post request", "body": "<p>I have following code working with proxy for a GET Request:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;))\nimport Data.Maybe (fromJust)\nimport Network.Browser\nimport Network.HTTP\nimport Network.HTTP.Proxy (parseProxy)\n\nmain = do\n  rsp &lt;- browse $ do\n    setProxy . fromJust $ parseProxy \"127.0.0.1:8118\"\n    request $ getRequest \"http://www.google.com\"\n  print $ rspBody &lt;$&gt; rsp\n</code></pre>\n\n<p>And this one for Post, but without proxy:</p>\n\n<pre><code>main = do\n  r &lt;- post \"http://www.geocodeip.com\" [\"IP\" := Data.ByteString.Lazy.Char8.pack \"79.212.82.103\"]\n  html &lt;- r ^. responseBody\n  print html\n</code></pre>\n\n<p>But how to make a post request with proxy? I dont get it. please help me!</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1450196290, "post_id": 34293313, "comment_id": 56329836, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/31726783/get-the-root-of-a-rose-tree-in-haskell\">Get the root of a Rose tree in Haskell</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1450196430, "post_id": 34293313, "comment_id": 56329960, "body": "In future questions, please don&#39;t use URL shorteners, and also add enough information about your problem so that we can answer without looking elsewhere."}], "answers": [{"comments": [{"owner": {"reputation": 491, "user_id": 2952838, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/65b2e944774c39cc1f3daf743257bd13?s=128&d=identicon&r=PG&f=1", "display_name": "larry77", "link": "https://stackoverflow.com/users/2952838/larry77"}, "edited": false, "score": 0, "creation_date": 1450199766, "post_id": 34294233, "comment_id": 56332300, "body": "Thanks, but can you adapt your answer to the newest version of the post (and notation for the Node)?"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1450196420, "creation_date": 1450196420, "answer_id": 34294233, "question_id": 34293313, "link": "https://stackoverflow.com/questions/34293313/find-root-and-root-children-of-rose-tree-in-haskell/34294233#34294233", "title": "Find Root and Root Children of Rose Tree in Haskell", "body": "<p>It's just pattern-matching the second argument rather than the first. Given the declaration:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Rose x = Rose x [Rose x] deriving (Show, Eq)\n</code></pre>\n\n<p>we can write:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>root :: Rose x -&gt; x\nroot (Rose x _) = x\n\nchildren :: Rose x -&gt; [Rose x]\nchildren (Rose _ rs) = rs\n</code></pre>\n\n<p>Or we could save ourselves a bit of trouble by writing this with \"record notation\" and define those two implicitly as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Rose x = Rose {root :: x, children :: [Rose x]} deriving (Show, Eq)\n</code></pre>\n\n<p>(But don't be fooled! <code>root</code> does not have type <code>x</code> but type <code>Rose x -&gt; x</code> as before, it's just that the <code>Rose x -&gt;</code> is considered redundant and not written!)</p>\n\n<p>What if you didn't want a <code>[Rose x]</code> but rather just a <code>[x]</code>? Then you want to transform each element of the list with the <code>root</code> function, which takes the element at the current cell in the rose tree. This \"transform every element with a function\" function is called <code>map</code> for lists or <code>fmap</code> in general. So you can write simply <code>map root (children roseTree)</code>, if your tree is called <code>roseTree</code>, to get a <code>[x]</code>. We could write that directly with the function composition operator <code>.</code> as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>childElements :: Rose x -&gt; [x]\nchildElements = map root . children\n</code></pre>\n"}], "owner": {"reputation": 491, "user_id": 2952838, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/65b2e944774c39cc1f3daf743257bd13?s=128&d=identicon&r=PG&f=1", "display_name": "larry77", "link": "https://stackoverflow.com/users/2952838/larry77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1450199642, "creation_date": 1450193993, "last_edit_date": 1450199642, "question_id": 34293313, "link": "https://stackoverflow.com/questions/34293313/find-root-and-root-children-of-rose-tree-in-haskell", "title": "Find Root and Root Children of Rose Tree in Haskell", "body": "<p>I would like to be able to fully answer the question about how to find the root and the the children of a rose tree.\nThe first part (how to find the root) has been essentially answered already on stackoverflow here</p>\n\n<p><a href=\"http://bit.ly/1YdoEhh\" rel=\"nofollow\">http://bit.ly/1YdoEhh</a></p>\n\n<p>The rose tree is defined with the following notation</p>\n\n<pre><code>data Rose a = a :&gt; [Rose a]\nderiving (Eq, Show)\n</code></pre>\n\n<p>and the root can be detected simply as</p>\n\n<pre><code>root (a :&gt; rs) = a\n</code></pre>\n\n<p>I would like to have the expression (with the \":>\" notation for the Node) of the function to find the children of the root.\nExample of expected behavior of this function children</p>\n\n<pre><code>children (1 :&gt; [2 :&gt; [], 3 :&gt; []]) = [2 :&gt; [], 3 :&gt; []] \n</code></pre>\n\n<p>Anyone can help me out?\nThanks!</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1450190066, "post_id": 34291087, "comment_id": 56325093, "body": "have you tried something like <code>unless (0 &lt;= d1 &amp;&amp; d1 &lt;= 255) $ fail &quot;d1 not in [0,255]&quot;</code> <code>Parser</code> is a monad so fail and <code>unless</code> would work"}, {"owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1450191654, "post_id": 34291087, "comment_id": 56326257, "body": "That would not work because the library would already have converted the string to a <code>Word8</code> and that would pass the condition."}], "answers": [{"comments": [{"owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "edited": false, "score": 0, "creation_date": 1450250766, "post_id": 34292465, "comment_id": 56353893, "body": "Thank you, this solves the general problem of parsing a bounded integer too. You have a minor typo - <code>C8.scan</code> should just be <code>scan</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1450282101, "last_edit_date": 1450282101, "creation_date": 1450191635, "answer_id": 34292465, "question_id": 34291087, "link": "https://stackoverflow.com/questions/34291087/parse-ip-address-with-attoparsec/34292465#34292465", "title": "Parse IP address with attoparsec", "body": "<p>My understanding of your question is that you not only want to fail when the input number is too large, but also you don't want the parser to consume more input than is needed. </p>\n\n<p>We can define a function to parse integers up to a maximum, failing otherwise:</p>\n\n<pre><code>import Data.Attoparsec.ByteString.Char8\nimport Data.Word\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString as B\nimport Control.Applicative\nimport Data.List (foldl')\nimport Control.Monad \n\ndecimalMax :: Integral a =&gt; Integer -&gt; Parser a \ndecimalMax dMax = do  \n  let numDigs = ceiling $ log (fromIntegral(dMax+1)) / log 10\n      getVal = foldl' (\\s d -&gt; s*10+fromIntegral (d-48)) 0 . B.unpack\n  val &lt;- getVal &lt;$&gt; scan 0 (\\n c -&gt; \n          if n &gt; numDigs || not (isDigit c) then Nothing else Just (n+1)) \n  if val &lt;= dMax \n    then return $ fromIntegral val \n    else fail $ \"decimalMax: parsed decimal exceeded\" ++ show dMax\n</code></pre>\n\n<p>This function computes the number of digits in the maximum number, then simply consumes at most that many digits. Your parser for IP addresses is remains almost the same:</p>\n\n<pre><code>parseIP :: Parser IP\nparseIP = IP &lt;$&gt; dd &lt;*&gt; dd &lt;*&gt; dd &lt;*&gt; dig where \n  dig = decimalMax 255\n  dd = dig &lt;* char '.' \n\nmain :: IO ()\nmain = do\n  print $ parseOnly parseIP \"131.45.68.123\"\n  print $ parseOnly parseIP \"1000.1000.1000.1000\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "edited": false, "score": 0, "creation_date": 1450250874, "post_id": 34292851, "comment_id": 56353945, "body": "Thank you for replying. Your approach is similar to the earlier answer."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1450195754, "last_edit_date": 1450195754, "creation_date": 1450192689, "answer_id": 34292851, "question_id": 34291087, "link": "https://stackoverflow.com/questions/34291087/parse-ip-address-with-attoparsec/34292851#34292851", "title": "Parse IP address with attoparsec", "body": "<p>For simple non-pathological inputs you could indeed just coerce to <code>Word8</code> from <code>Integer</code>, which is arbitrary-precision and will never overflow:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>byte :: Parser Word8\nbyte = do\n    n &lt;- (decimal :: Parser Integer)\n    if n &lt; 256 then return n \n               else fail $ \"Byte Overflow: \" ++ show n ++ \" is greater than 255.\"\n</code></pre>\n\n<p>Now the modified program,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseIP = do\n    d1 &lt;- byte\n    char '.'\n    d2 &lt;- byte\n    char '.'\n    d3 &lt;- byte\n    char '.'\n    d4 &lt;- byte\n    return $ IP d1 d2 d3 d4\n</code></pre>\n\n<p>should produce the requisite output.</p>\n\n<p>If you wanted to handle people trying to DoS you by writing \"1291293919818283309400919...\" as a really long number, then I foresee a bit more work needed to validate that something is really that length, so that you scan at most three digits before failing immediately on the first <code>char '.'</code>.</p>\n\n<p>The following seems to compile and work with an <code>import qualified Data.ByteString as BS</code> up top:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>scan0to3digits :: Int -&gt; Char -&gt; Maybe Int\nscan0to3digits  = scan 0 helper where\n  helper n c \n    | n &lt; 3 &amp;&amp; isDigit c  = Just (n + 1)\n    | otherwise           = Nothing\n\nbyte :: Parser Word8\nbyte = do\n    raw &lt;- scan 0 scan0to3digits\n    let p = BS.foldl' (\\sum w8 -&gt; 10 * sum + fromIntegral w8 - 48) 0 raw\n    if BS.length raw == 0 \n      then fail \"Expected one or more digits...\"\n      else if p &gt; 255\n        then fail $ \"Byte Overflow: \" ++ show n ++ \" is greater than 255.\"\n        else return (fromInteger p)\n</code></pre>\n"}], "owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 1, "accepted_answer_id": 34292465, "answer_count": 2, "score": 2, "last_activity_date": 1450282101, "creation_date": 1450187826, "last_edit_date": 1450188319, "question_id": 34291087, "link": "https://stackoverflow.com/questions/34291087/parse-ip-address-with-attoparsec", "title": "Parse IP address with attoparsec", "body": "<p>The parser given at <a href=\"https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/text-manipulation/attoparsec\" rel=\"nofollow\">https://www.fpcomplete.com/school/starting-with-haskell/libraries-and-frameworks/text-manipulation/attoparsec</a> appears to work, but it has a problem.</p>\n\n<p>The code (repeated here) is:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\n-- This attoparsec module is intended for parsing text that is\n-- represented using an 8-bit character set, e.g. ASCII or ISO-8859-15.\nimport Data.Attoparsec.Char8\nimport Data.Word\n\n-- | Type for IP's.\ndata IP = IP Word8 Word8 Word8 Word8 deriving Show\n\nparseIP :: Parser IP\nparseIP = do\n  d1 &lt;- decimal\n  char '.'\n  d2 &lt;- decimal\n  char '.'\n  d3 &lt;- decimal\n  char '.'\n  d4 &lt;- decimal\n  return $ IP d1 d2 d3 d4\n\nmain :: IO ()\nmain = print $ parseOnly parseIP \"131.45.68.123\"\n</code></pre>\n\n<p>If the parser is input an invalid IP address such as \"1000.1000.1000.1000\", it does not fail, and returns a garbage result, due to coerced numeric conversion.</p>\n\n<p>Is there a simple way to fix this? One way is to use a larger <code>Word</code> type like <code>Word32</code> and check if the number is less than 256. However, even that probably returns garbage if the input is pathological (e.g. overflows <code>Word32</code> as well). Converting to <code>Integer</code> appears to be an option, as it is unbounded, but again, an adversarial input could make the program run out of memory.</p>\n\n<p>So what would a (hopefully elegant) parser that avoids these problems look like?</p>\n"}, {"tags": ["haskell", "type-systems"], "comments": [{"owner": {"reputation": 610493, "user_id": 88656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fbdff3ffb6f111d172759b4f05bea0e?s=128&d=identicon&r=PG", "display_name": "Eric Lippert", "link": "https://stackoverflow.com/users/88656/eric-lippert"}, "edited": false, "score": 10, "creation_date": 1450197076, "post_id": 34287668, "comment_id": 56330513, "body": "Whether Haskell is strongly typed depends on whether you like its type system or not. See <a href=\"http://ericlippert.com/2012/10/15/is-c-a-strongly-typed-or-a-weakly-typed-language/\" rel=\"nofollow noreferrer\">ericlippert.com/2012/10/15/&hellip;</a>"}, {"owner": {"reputation": 18146, "user_id": 646619, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/bd61a0f309ebc135d2661710c2faf379?s=128&d=identicon&r=PG", "display_name": "Colonel Thirty Two", "link": "https://stackoverflow.com/users/646619/colonel-thirty-two"}, "edited": false, "score": 10, "creation_date": 1450201735, "post_id": 34287668, "comment_id": 56333559, "body": "<a href=\"http://programmers.stackexchange.com/a/38257/102349\">&quot;Strongly-typed&quot; and &quot;weakly-typed&quot; are ill defined.</a> You probably mean to ask if Haskell is dynamically typed (no, it&#39;s not)."}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 13, "creation_date": 1450202753, "post_id": 34287668, "comment_id": 56334223, "body": "Note that in Haskell, you can&#39;t even change the <i>value</i> of a variable after it&#39;s assigned; so even if Haskell were dynamically typed, the runtime-type of a variable would be fixed at assignment."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 610493, "user_id": 88656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fbdff3ffb6f111d172759b4f05bea0e?s=128&d=identicon&r=PG", "display_name": "Eric Lippert", "link": "https://stackoverflow.com/users/88656/eric-lippert"}, "edited": false, "score": 0, "creation_date": 1450277386, "post_id": 34287668, "comment_id": 56371747, "body": "@EricLippert how about mapping <i>weak = type-unsafe</i> and <i>strong = type-safe</i>? how about the rest of my version of the definitions below? however, memsafety, I think \u2014 if you mean memory allocation and pointer dereferencing \u2014 should be viewed as yet one layer below type safety, which is in turn one layer below static type safety."}, {"owner": {"reputation": 610493, "user_id": 88656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fbdff3ffb6f111d172759b4f05bea0e?s=128&d=identicon&r=PG", "display_name": "Eric Lippert", "link": "https://stackoverflow.com/users/88656/eric-lippert"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1450287882, "post_id": 34287668, "comment_id": 56378978, "body": "@ErikAllik: Thank you for so aptly illustrating my central point: that these terms are so ill-defined that you have to have a careful explanation calling out precisely which kinds of safety and guarantees you mean to express. Also, what do you do about languages like C# that are for the most part type safe but have an unsafe subset for interoperating with C programs?  Is such a language strongly typed because it is <i>typically</i> typesafe, or weakly typed because it <i>can</i> be type unsafe?  Again, we have to carefully delineate what we mean."}], "answers": [{"tags": [], "owner": {"reputation": 1075, "user_id": 582225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecd9b5d3527c4cfa71fcb0e0f4ebfe99?s=128&d=identicon&r=PG", "display_name": "BinaryGuy", "link": "https://stackoverflow.com/users/582225/binaryguy"}, "is_accepted": false, "score": 0, "last_activity_date": 1450212201, "last_edit_date": 1450212201, "creation_date": 1450177915, "answer_id": 34287711, "question_id": 34287668, "link": "https://stackoverflow.com/questions/34287668/is-haskell-a-strongly-typed-programming-language/34287711#34287711", "title": "Is Haskell a strongly typed programming language?", "body": "<p>It is strongly typed.  See section 2.3 here: <a href=\"https://wiki.haskell.org/Why_Haskell_matters#Strong_typing\" rel=\"nofollow\">Why Haskell matters</a></p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1450180280, "post_id": 34287995, "comment_id": 56318384, "body": "sorry but you are mixing up strong and static, as well as referring to &quot;type checking&quot; but talking of &quot;type inference&quot; instead: <i>Strong typing gives FP the ability of &quot;type inference&quot; which is powerful to eliminate hidden bugs in compile time and help reduce the size of the source code.</i>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1450196282, "post_id": 34287995, "comment_id": 56329831, "body": "We <i>do</i> have the concept of a variable; we just use the word a bit differently. A variable in a functional language is a lot like a <i>mathematical</i> variable."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450196418, "post_id": 34287995, "comment_id": 56329948, "body": "@goldenbull: by the way the concept of &quot;variable&quot; has more to it than merely the difference you are highlighting \u2014 for example mathematical functions have a clear concept of a variable (and parameter and constant); since Haskell is just generalized/abstract algebra really, the line between math and programming is blurred, and hence saying <i>&quot;Haskell does not have variables&quot;</i> is, while not entirely incorrect <i>per se</i>, not too informative."}], "tags": [], "owner": {"reputation": 73, "user_id": 4177695, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DcvNZPwTso0/AAAAAAAAAAI/AAAAAAAABoY/Vnua8t0gnWA/photo.jpg?sz=128", "display_name": "goldenbull", "link": "https://stackoverflow.com/users/4177695/goldenbull"}, "is_accepted": false, "score": -1, "last_activity_date": 1450178757, "creation_date": 1450178757, "answer_id": 34287995, "question_id": 34287668, "link": "https://stackoverflow.com/questions/34287668/is-haskell-a-strongly-typed-programming-language/34287995#34287995", "title": "Is Haskell a strongly typed programming language?", "body": "<p>I think you are talking about two different things.</p>\n\n<p>First, haskell, and most functional programming (FP) languages, do NOT have the concept \"variable\". Instead, they use the concept \"name\" and \"value\", they just \"bind\" a value to a name. Once the value is bound, you can not bind another value to the same name, this is the key feature of FP.</p>\n\n<p>Strong typing is another topic. Yes, haskell is strongly typed, and so are most FP languages. Strong typing gives FP the ability of \"type inference\" which is powerful to eliminate hidden bugs in compile time and help reduce the size of the source code.</p>\n\n<p>Maybe you are comparing haskell with python? Python is also strongly typed. The difference between haskell and python is \"static typed\" and \"dynamic typed\". The actual meaning of term \"Strong type\" and \"Weak Type\" are ambiguous and fuzzy. That is another long story...</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1450180529, "post_id": 34288004, "comment_id": 56318549, "body": "Strong typing on its own does not let you predict anything whatsoever; it only makes sure Cats don&#39;t ultimately get treated like Dogs (think how terrible that would be for the cat...). Only static combined with strong provides that; but then again even static+weak offers a lot of predictabity."}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": false, "score": 8, "last_activity_date": 1450178779, "creation_date": 1450178779, "answer_id": 34288004, "question_id": 34287668, "link": "https://stackoverflow.com/questions/34287668/is-haskell-a-strongly-typed-programming-language/34288004#34288004", "title": "Is Haskell a strongly typed programming language?", "body": "<p>You seem to mix up dynamic/static and weak/strong typing.</p>\n\n<p>Dynamic or static typing is about whether the type of a variable can be changed during execution.</p>\n\n<p>Weak or strong typing is about being able to predict type errors just from function signatures.</p>\n\n<p>Haskell is both statically and strongly typed.</p>\n\n<p>However, there is no such thing as variable in Haskell so talking about dynamic or static typing makes no sense since every identifier assigned with a value cannot be changed at execution.</p>\n\n<p>EDIT: But like goldenbull said, those typing notions are not clearly defined.</p>\n"}, {"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1450192970, "post_id": 34288753, "comment_id": 56327251, "body": "I wouldn&#39;t say it&#39;s impossible to reinterpret memory, there&#39;s a couple projects that implement assemblers in Python by filling a numpy array with the instructions then pointing ctypes at the memory location and calling it a function, and it&#39;s actually technically possible to swap out an object&#39;s type, but both of these examples are hitting deep, dark corners of Python that mere mortals probably shouldn&#39;t even know about."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450196709, "post_id": 34288753, "comment_id": 56330225, "body": "Variables have types apart from expressions. A function definition in Haskell will have parameters (variables) that are not bound to expressions but that certainly have types. In System F and its relatives, variables (but not expressions) must be explicitly annotated with types."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450197018, "post_id": 34288753, "comment_id": 56330476, "body": "Function arguments are names for the expressions that will be &quot;placed in them&quot; \u2014 that&#39;s what I meant conceptually; I didn&#39;t pretend I was being type theoretically correct in terminology :)"}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 0, "creation_date": 1450201313, "post_id": 34288753, "comment_id": 56333293, "body": "Re: &quot;some people like to think that static typing is about variables having type, and <b>strong typing</b> is about values having type&quot;: Is this a typo? From the subsequent text, it seems that the bolded part was meant to be &quot;dynamic typing&quot;?"}, {"owner": {"reputation": 26764, "user_id": 144746, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/170e317e1e3d42b520786bcec9dfb409?s=128&d=identicon&r=PG", "display_name": "Voo", "link": "https://stackoverflow.com/users/144746/voo"}, "edited": false, "score": 0, "creation_date": 1450202221, "post_id": 34288753, "comment_id": 56333863, "body": "Good summary at the start, but then becomes rather judgmental. I mean: &quot;logical reasoning can be used to draw up conclusions on what the logistics system won&#39;t do or will do for sure (static verification, formal proof, or at least pseudo-proof like QuickCheck)&quot;. At least mention that except for QuickCheck (which is useless if you do have unit tests and insufficient if you don&#39;t) all of those are pretty much research problems and are only applied to some very specific and very small subsets."}, {"owner": {"reputation": 26764, "user_id": 144746, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/170e317e1e3d42b520786bcec9dfb409?s=128&d=identicon&r=PG", "display_name": "Voo", "link": "https://stackoverflow.com/users/144746/voo"}, "edited": false, "score": 0, "creation_date": 1450202361, "post_id": 34288753, "comment_id": 56333974, "body": "(I&#39;m aware of people doing static verification and proofs of protocols and implementations of those, but that&#39;s about it, not full applications). The dynamic site is arguing that if you don&#39;t have unit tests it doesn&#39;t matter if your code compiles, because all the interesting bugs aren&#39;t caught by the compiler anyhow (which is why, every good project even in static+strong languages has unit tests) and unit tests will catch all bugs that a compiler would catch anyhow. On that point I agree, I do find that specifying types for interfaces as documentation is very valuable though."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1450203978, "post_id": 34288753, "comment_id": 56334968, "body": "Neither of your &quot;memory reinterpretation&quot; examples actually reinterpret memory. In fact, <code>int</code> and <code>char</code> usually have different sizes, as do <code>bool</code> and pointer types, so you <i>can&#39;t</i> reinterpret the memory of a <code>char</code> as an <code>int</code> or a pointer as a <code>bool</code>."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 4, "creation_date": 1450212047, "post_id": 34288753, "comment_id": 56339732, "body": "&quot;(e.g. &quot;5&quot;+3==8 in PHP (or does it? ;)))&quot; Was nesting that many parens in an English sentence really necessary? You&#39;ll be talking with a Lisp soon..."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 0, "creation_date": 1450212223, "post_id": 34288753, "comment_id": 56339818, "body": "just 2 parens. @ruakh: no it was what I meant. dynamic typing can also mean completely weak types, like I think in Tcl where everythig is a string. Or assembly where everything is just memory."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 26764, "user_id": 144746, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/170e317e1e3d42b520786bcec9dfb409?s=128&d=identicon&r=PG", "display_name": "Voo", "link": "https://stackoverflow.com/users/144746/voo"}, "edited": false, "score": 0, "creation_date": 1450212466, "post_id": 34288753, "comment_id": 56339965, "body": "@Voo: I knew your top tag was Java before I opened your profile page \u2014 you and I have a veeery different understanding of what types can do; therefore we also have a very different understanding when tests are unavoidable and when they are useless. In any case, reality is different from what you describe \u2014 Haskell teams actually do get away with a lot less testing, courtesy of QuickCheck and expressive types (you don&#39;t need Agda or Idris for type level verification)."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1450212488, "post_id": 34288753, "comment_id": 56339980, "body": "@ErikAllik I was more offended the aesthetic atrocity of the nesting. See <a href=\"http://xkcd.com/541/\" rel=\"nofollow noreferrer\">this &quot;TED talk&quot;</a> for an explanation of the completely avoidable issue."}, {"owner": {"reputation": 26764, "user_id": 144746, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/170e317e1e3d42b520786bcec9dfb409?s=128&d=identicon&r=PG", "display_name": "Voo", "link": "https://stackoverflow.com/users/144746/voo"}, "edited": false, "score": 0, "creation_date": 1450213201, "post_id": 34288753, "comment_id": 56340381, "body": "@Erik &quot;Haskell teams actually do get away with a lot less testing&quot; - citation needed and not just some anecdotes (I am actually rather interested in the topic, so if you actually have a whitepaper that I haven&#39;t seen so far I&#39;m all ears). The interesting unit tests are about <i>business</i> requirements and a compiler can&#39;t catch incorrect implementations of those... sure you can specify more type hints, but who said you specified those correctly?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450216085, "post_id": 34288753, "comment_id": 56341976, "body": "I did not say <i>without testing</i> but with <i>less</i> testing. Mismatches between real life business rules and spec still need to be sanity checked using tests, and so do integratIons. But all or most internal testing (spec &lt;-&gt; impl) can be done away with in favor of types (and QuickCheck/SmallCheck \u2014 they&#39;re way more capable than you might think). For a somewhat related case study by Don Stewart: <a href=\"https://www.dropbox.com/s/28rop2xvdfsvn4b/dons-google-2015-01-27.pdf?dl=0\" rel=\"nofollow noreferrer\">dropbox.com/s/28rop2xvdfsvn4b/dons-google-2015-01-27.pdf?dl=&zwnj;&#8203;0</a>"}, {"owner": {"reputation": 331, "user_id": 439802, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uss8A.png?s=128&g=1", "display_name": "Darael", "link": "https://stackoverflow.com/users/439802/darael"}, "edited": false, "score": 2, "creation_date": 1450218902, "post_id": 34288753, "comment_id": 56343463, "body": "So what&#39;s the other 0.89% of Python? ;)"}, {"owner": {"reputation": 256589, "user_id": 13005, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c4690b9a0df8a4c1e35c088b077942e6?s=128&d=identicon&r=PG", "display_name": "Steve Jessop", "link": "https://stackoverflow.com/users/13005/steve-jessop"}, "reply_to_user": {"reputation": 331, "user_id": 439802, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uss8A.png?s=128&g=1", "display_name": "Darael", "link": "https://stackoverflow.com/users/439802/darael"}, "edited": false, "score": 4, "creation_date": 1450220011, "post_id": 34288753, "comment_id": 56344022, "body": "@Darael: arguing about whether things are Pythonic or not."}, {"owner": {"reputation": 331, "user_id": 439802, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uss8A.png?s=128&g=1", "display_name": "Darael", "link": "https://stackoverflow.com/users/439802/darael"}, "reply_to_user": {"reputation": 256589, "user_id": 13005, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c4690b9a0df8a4c1e35c088b077942e6?s=128&d=identicon&r=PG", "display_name": "Steve Jessop", "link": "https://stackoverflow.com/users/13005/steve-jessop"}, "edited": false, "score": 1, "creation_date": 1450222216, "post_id": 34288753, "comment_id": 56344976, "body": "@SteveJessop I suppose I should count myself lucky nobody pointed out my maths fail (100-(99.9+0.01) is 0.09, not 0.89)"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 26764, "user_id": 144746, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/170e317e1e3d42b520786bcec9dfb409?s=128&d=identicon&r=PG", "display_name": "Voo", "link": "https://stackoverflow.com/users/144746/voo"}, "edited": false, "score": 3, "creation_date": 1450224694, "post_id": 34288753, "comment_id": 56345738, "body": "@Voo: with a sufficiently powerful type system, you <i>can</i> encode business requirements in types. Ocsigen is a web framework written in OCaml, which cannot generate malformed HTML, any attempt to do so would result in a type error. Ur/Web is a web framework written in Ur, which cannot generate malformed HTML, dead links, SQL injections, cross-site scripting attacks, HTML forms without validations, any attempt to do so would result in a type error. Galois is a company using Haskell for government, military, and intelligence software, and they have encoded the rules for distributing classified \u2026"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 2, "creation_date": 1450224801, "post_id": 34288753, "comment_id": 56345776, "body": "\u2026 documents in the type system, making it impossible to write code that violates secrecy. Even if an evil attacker were able to inject a plugin into a government CMS by Galois, it would not be possible for that plugin to leak any information, because it wouldn&#39;t compile. And this is not even talking about dependent typing in languages like Agda, Idris, Epigram, Coq, Isabelle, where you can encode <i>anything</i> you can express in logic as a type."}, {"owner": {"reputation": 981, "user_id": 2373609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Sij07.jpg?s=128&g=1", "display_name": "MatthewRock", "link": "https://stackoverflow.com/users/2373609/matthewrock"}, "edited": false, "score": 0, "creation_date": 1450226292, "post_id": 34288753, "comment_id": 56346274, "body": "Out of curiosity, where does Common Lisp fit in here?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450226726, "post_id": 34288753, "comment_id": 56346403, "body": "Dynamic and strong (with some numeric coercions as typical)."}, {"owner": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 1, "creation_date": 1450241558, "post_id": 34288753, "comment_id": 56350329, "body": "Reinterpretation of memory in C(++) is almost always illegal unless you go through an explicit conversion with <code>memcpy()</code> or (officially only in newer language versions, practically in any sufficiently modern compiler) a union.  In nearly all other cases, it is undefined behavior.  For example, <code>reinterpret_cast&lt;foo*&gt;</code> only guarantees that the reverse conversion can be performed losslessly.  You are expressly prohibited from dereferencing the intermediate pointer by the strict aliasing rule."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 94, "last_activity_date": 1591697187, "last_edit_date": 1591697187, "creation_date": 1450180914, "answer_id": 34288753, "question_id": 34287668, "link": "https://stackoverflow.com/questions/34287668/is-haskell-a-strongly-typed-programming-language/34288753#34288753", "title": "Is Haskell a strongly typed programming language?", "body": "<p><strong>Static</strong> \u2014 types are known at compile time. Java and Haskell have static typing. Also C/C++, C#, Go, Scala, Rust, Kotlin, Pascal to list a few more.</p>\n\n<p>A statically typed language might or might not have type inference. Java almost completely lacks type inference (but it's very slowly changing just a little bit); Haskell has full type inference (except with certain very advanced extensions). </p>\n\n<p>(Type inference is when you only have to declare a minimal amount of types by hand, e.g. <code>var isFoo = true</code> and <code>var person = new Person()</code>, instead of <code>bool isFoo = ...</code> and <code>Person person = ...</code>.)</p>\n\n<p><strong>Dynamic</strong> \u2014 Python, JavaScript, Ruby, PHP, Clojure (and Lisps in general), Prolog, Erlang, Groovy etc. Can also be called \"unityped\"; dynamic typing can be \"emulated\" in a static setting, but the reverse is not true except by using external static analysis tools. Some languages make it possible to mix dynamic and static (see <a href=\"https://en.wikipedia.org/wiki/Gradual_typing\" rel=\"nofollow noreferrer\">gradual typing</a>, e.g. <a href=\"https://typedclojure.org/\" rel=\"nofollow noreferrer\">https://typedclojure.org/</a>).</p>\n\n<p>Some languages enable static typing for one or more modules, applied at import time, for example: <a href=\"http://mypy-lang.org\" rel=\"nofollow noreferrer\">Python+Mypy</a>, <a href=\"http://typedclojure.org\" rel=\"nofollow noreferrer\">Typed Clojure</a>, <a href=\"https://flow.org\" rel=\"nofollow noreferrer\">JavaScript+Flow</a>, <a href=\"https://hacklang.org\" rel=\"nofollow noreferrer\">PHP+Hack</a> to name a few.</p>\n\n<p><strong>Strong</strong> \u2014 values that are intended to be treated as <code>Cat</code> always are; trying to treat them like a <code>Dog</code> will cause a loud <code>meeewww</code>... I mean error.</p>\n\n<p><strong>Weak</strong> \u2014 this effectively boils down to 2 similar but distinct things: type coercion (e.g. <code>\"5\"+3</code> equals <code>8</code> in PHP \u2014 or does it!) and memory reinterpretation (e.g. <code>(int) someCharValue</code> or <code>(bool) somePtr</code> in C, and C++ as well, but C++ wants you to explicitly say <code>reinterpret_cast</code>). So there's really <em>coercion-weak</em> and <em>reinterpretation-weak</em>, and different languages are weak in one or both of these ways.</p>\n\n<p>Interestingly, note that coercion is implicit by nature and memory reinterpretation is explicit (except in Assembly) \u2014 so weak typing consists of an implicit <em>and</em> an explicit behavior. Maybe that's even more of a reason to refer to 2 distinct subcategories under weak typing.</p>\n\n<hr>\n\n<p>There are languages with all 4 possible combinations, and variations/gradations thereof. </p>\n\n<p><strong>Haskell is static+strong</strong>; of course it has <code>unsafeCoerce</code> so it can be static+a bit reinterpret-weak at times, but <code>unsafeCoerce</code> is very much frowned upon except in extreme situations where you are sure about something being the case but just can't seem to persuade the compiler without going all the way back and retelling the entire story in a different way. </p>\n\n<p><strong>C is static+weak</strong> because all memory can freely be reinterpreted as something it originally was not meant to contain, hence weak. But all of those reinterpretations are kept track of by the type checker, so still fully static too. But C does not do implicit coercions, so it's only <em>reinterpret-weak</em>.</p>\n\n<p><strong>Python is dynamic+almost entirely strong</strong> \u2014 there are no types known on any given line of code prior to reaching that line during execution, however values that live at runtime do have types associated with them and it's impossible to reinterpret memory. Implicit coercions are also kept to a meaningful minimum, so one might say Python is 99.9% strong and 0.01% <em>coercion-weak</em>. </p>\n\n<p><strong>PHP and JavaScript are dynamic+mostly weak</strong> \u2014 dynamic, in that nothing has type until you execute and introspect its contents, and also weak in that coercions happen all the time and with things you'd never really expect to be coerced, unless you are only calling methods and functions and not using built-in operations. These coercions are a source of a lot of humor on the internet. There are no memory reinterpretations so PHP and JS are <em>coercion-weak</em>.</p>\n\n<hr>\n\n<p>Furthermore, some people like to think that static typing is about variables having type, and strong typing is about values having type \u2014 this is a very useful way to go about understanding the full picture, but it's <em>not quite true</em>: some dynamically typed languages also allow variables/parameters to be annotated with types/constraints that are enforced at runtime. </p>\n\n<p>In static typing, it's expressions that have a type; the fact of variables having type is only a consequence of variables being used as a means to glue bigger expressions together from smaller ones, so it's not variables per se that have types. </p>\n\n<p>Similarly, in dynamic typing, it's not the variables that lack statically known type \u2014 it's all expressions! Variables lacking type is merely a consequence of the expressions they store lacking type. </p>\n\n<hr>\n\n<p><strong>One final illustration</strong></p>\n\n<p>In dynamic typing, all the cats, dogs and even elephants (in fact entire zoos!) are packaged up in identically sized boxes. </p>\n\n<p>In static typing these boxes look different and have stickers on them saying what's inside. </p>\n\n<p>Some people like it because they can just use a single box form factor and don't have to put any labels on the boxes \u2014 it's only the arrangement of boxes with regards to each other that implicitly (and hopefully) provides type sanity.</p>\n\n<p>Some people also like it because it allows them to do all sorts of tricks with tigers temporarily being transported in boxes that smell like lions, and bears put in the same array of interconnected boxes as wolves or deer.</p>\n\n<p>In such label-free setting of transport boxes, all the possible logicistics scenarios need to be played or simulated in order to detect misalignment in the implicit arrangement, like in a stage performance. No reliable guarantees can be given based on reasoning only, generally speaking. (ad-hoc test cases that need for the entire system to be started up for any partial conclusions to be obtained of its soundness)</p>\n\n<p>With labels and explicit rules on how to deal with boxes of various labels, automated/mechanized logical reasoning can be used to draw up conclusions on what the logistics system won't do or will do for sure (static verification, formal proof, or at least pseudo-proof like QuickCheck), Some aspects of the logistics still need to be verified with trial runs, such as whether the logistics team even got the client right. (integration testing, acceptance testing, end user sanity checks). </p>\n\n<hr>\n\n<p>Moreover, in weak typing dogs can be sliced up and reassembled as frankenstein cats. Whether they like it or not, and whether the result is ugly or not. (weak typing)</p>\n\n<p>But if you add labels to the boxes, it still matters that Frankenstein cats be put in cat boxes. (static+weak typing)</p>\n\n<hr>\n\n<p>In strong typing, while you can put a cat in the box of a dog, but you can only keep pretending it's a dog until you try to humiliate it by feeding it something only dogs would eat \u2014 if that happens, it will scream out loud, but until that time, if you're in dynamic typing, it will silently accept its place (in a static world it would refuse to be put in a dog's box before you can say \"kitty\"). </p>\n"}], "owner": {"reputation": 3111, "user_id": 2846781, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/66799fb2211ee2618b679c10e96629f6?s=128&d=identicon&r=PG&f=1", "display_name": "TheLeonKing", "link": "https://stackoverflow.com/users/2846781/theleonking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7870, "favorite_count": 14, "accepted_answer_id": 34288753, "answer_count": 4, "score": 27, "last_activity_date": 1591697187, "creation_date": 1450177781, "last_edit_date": 1450569016, "question_id": 34287668, "link": "https://stackoverflow.com/questions/34287668/is-haskell-a-strongly-typed-programming-language", "title": "Is Haskell a strongly typed programming language?", "body": "<p>Is Haskell strongly typed? I.e. is it possible to change the type of a variable after you assigned one? I can't seem to find the answer on the internet.</p>\n"}, {"tags": ["haskell", "monads", "traversal", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1450178918, "post_id": 34287571, "comment_id": 56317458, "body": "ah, that&#39;s nicer ! thank you. now I see it&#39;s obvious one had to look for translating an algebra for <code>f</code>  to an algebra for <code>Free f</code> .."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450197021, "post_id": 34287571, "comment_id": 56330479, "body": "I like your <code>iter&#39;</code>. I tried to find something serving that general purpose recently (feeling confident there must be one) but somehow failed to hit on the right type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450197457, "post_id": 34287571, "comment_id": 56330788, "body": "It might be worth benchmarking this against <code>iter&#39; f g = go where ...</code>. Some measurements back when indicated that this tends to be good when at least two arguments stay constant through the recursion."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450210952, "post_id": 34287571, "comment_id": 56339134, "body": "I should mention too that <code>Functor f =&gt; forall b. (f b -&gt; b) -&gt; (a -&gt; b) -&gt; b</code> is equivalent to <code>Free f a</code> and is the definition of the <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free-Church.html\" rel=\"nofollow noreferrer\">Church free monad</a>, and <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/src/Control-Monad-Free-Church.html#toF\" rel=\"nofollow noreferrer\"><code>toF</code></a> is the same as <code>iter&#39;</code>."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1450218990, "post_id": 34287571, "comment_id": 56343508, "body": "@Andr&#225;sKov&#225;cs nice, thanks for spotting and adding this here. I wanted to read about Cayley representation of those things, which encompasses codensity as a special case so that might be a useful link"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1451497455, "post_id": 34287571, "comment_id": 56810468, "body": "btw, this iter&#39; is mentioned by Nicolas Wu who call it handle <a href=\"https://skillsmatter.com/skillscasts/6733-transformers-handlers-in-disguise\" rel=\"nofollow noreferrer\">skillsmatter.com/skillscasts/&hellip;</a>"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 9, "last_activity_date": 1450200356, "last_edit_date": 1450200356, "creation_date": 1450177534, "answer_id": 34287571, "question_id": 34287089, "link": "https://stackoverflow.com/questions/34287089/printing-the-free-monad/34287571#34287571", "title": "Printing the free monad", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Free.html\" rel=\"nofollow\"><code>iter</code></a> and <code>fmap</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nimport Control.Monad.Free\n\ndata Choice x = Choice x x deriving (Functor)\n\n-- iter :: Functor f =&gt; (f a -&gt; a) -&gt; Free f a -&gt; a\n-- iter _   (Pure a) = a\n-- iter phi (Free m) = phi (iter phi &lt;$&gt; m)\n\nshowFreeChoice :: Show a =&gt; Free Choice a -&gt; String\nshowFreeChoice =\n      iter (\\(Choice l r) -&gt; \"(Choice \" ++ l ++ \" \" ++ r ++ \")\")\n    . fmap (\\a -&gt; \"(Pure \" ++ show a ++ \")\")\n</code></pre>\n\n<p><code>fmap</code> converts from <code>Free f a</code> to <code>Free f b</code>, and <code>iter</code> does the rest. You could factor this out, and maybe get a bit better performance:</p>\n\n<pre><code>iter' :: Functor f =&gt; (f b -&gt; b) -&gt; (a -&gt; b) -&gt; Free f a -&gt; b\niter' f g = go where\n  go (Pure a)  = g a\n  go (Free fa) = f (go &lt;$&gt; fa)\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 3, "accepted_answer_id": 34287571, "answer_count": 1, "score": 8, "last_activity_date": 1450200356, "creation_date": 1450176269, "question_id": 34287089, "link": "https://stackoverflow.com/questions/34287089/printing-the-free-monad", "title": "Printing the free monad", "body": "<p>One can translate a free monad to any other monad, but given a value of type <code>Free f x</code>, I want to print the whole tree, not map every node of the AST generated to some other node in another monad.</p>\n\n<p>Gabriel Gonzales <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\">uses</a> the value directly </p>\n\n<pre><code>showProgram :: (Show a, Show r) =&gt; Free (Toy a) r -&gt; String\nshowProgram (Free (Output a x)) =\n    \"output \" ++ show a ++ \"\\n\" ++ showProgram x\nshowProgram (Free (Bell x)) =\n    \"bell\\n\" ++ showProgram x\nshowProgram (Free Done) =\n    \"done\\n\"\nshowProgram (Pure r) =\n    \"return \" ++ show r ++ \"\\n\"\n</code></pre>\n\n<p>which can be abstracted away as </p>\n\n<pre><code>showF :: (x -&gt; b) -&gt; ((Free f x -&gt; b) -&gt; f (Free f x) -&gt; b) -&gt;  Free f x -&gt; b\nshowF backLiftValue backLiftF  = fix (showFU backLiftValue backLiftF)\n    where\n      showFU :: (x -&gt; b) -&gt; ((Free f x -&gt; b) -&gt; f (Free f x) -&gt; b) -&gt; (Free f x -&gt; b) -&gt; Free f x -&gt; b\n      showFU backLiftValue backLiftF next = go . runIdentity . runFreeT where\n          go (FreeF c ) = backLiftF next  c\n          go (Pure x) =   backLiftValue x \n</code></pre>\n\n<p>which is easy to call if we have a polymorphic function like (using <code>Choice x =  Choice x x</code> as a functor)</p>\n\n<pre><code>showChoice :: forall x. (x -&gt; String) -&gt;  Choice x -&gt; String\nshowChoice show (Choice a b) =  \"Choice (\" ++ show  a ++  \",\" ++ show b ++ \")\"\n</code></pre>\n\n<p>But that seems quite complicated for a simple operation...\nWhat other approaches are there to go from <code>f x -&gt; b</code> to <code>Free f x -&gt; b</code>  ? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 0, "creation_date": 1450185316, "post_id": 34290005, "comment_id": 56321782, "body": "I&#39;m not experienced enough to get everything you mean here, but the problem is that Wreq is treating anything other than a <code>200</code> as an Exception, and I need to disable that"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 0, "creation_date": 1450189460, "post_id": 34290005, "comment_id": 56324660, "body": "@SimonH I added an example"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 2, "creation_date": 1450190705, "post_id": 34290005, "comment_id": 56325534, "body": "Thanks, and thanks also for not using the infix operators"}, {"owner": {"reputation": 1169, "user_id": 997994, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8c11f523fb9ff0c4fb407bbda335234?s=128&d=identicon&r=PG", "display_name": "MnZrK", "link": "https://stackoverflow.com/users/997994/mnzrk"}, "edited": false, "score": 0, "creation_date": 1517106880, "post_id": 34290005, "comment_id": 83958289, "body": "@Yuras I think you should update or delete this answer, it is no longer correct."}, {"owner": {"reputation": 2885, "user_id": 1360368, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7997d33ca6f47d0e48080d6f58a72443?s=128&d=identicon&r=PG", "display_name": "Ashesh", "link": "https://stackoverflow.com/users/1360368/ashesh"}, "edited": false, "score": 2, "creation_date": 1532362510, "post_id": 34290005, "comment_id": 89935268, "body": "I think this is a strange design decision to have exceptions by default for non-200 responses. There are many REST api&#39;s I know that respond with non-200 status codes to signal results and not necessarily to always indicate errors that need to blow up in your face. This seems like a nice library but this decision in itself makes it appear very weird to me."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 8, "last_activity_date": 1517172957, "last_edit_date": 1517172957, "creation_date": 1450184541, "answer_id": 34290005, "question_id": 34285433, "link": "https://stackoverflow.com/questions/34285433/wreq-stop-404s-throwing-exceptions/34290005#34290005", "title": "Wreq: Stop 404s throwing exceptions", "body": "<p><strong>NOTE: the answer is outdated, see other answers.</strong></p>\n\n<p>I never used <code>Wreq</code>, but it looks like you should use <code>getWith</code> to pass custom options and <a href=\"http://hackage.haskell.org/package/wreq-0.4.0.0/docs/Network-Wreq.html#v:checkStatus\" rel=\"nofollow noreferrer\">checkStatus</a> to configure status handling.</p>\n\n<p>An example:</p>\n\n<pre><code>getWith (set checkStatus (Just $ \\_ _ _ -&gt; Nothing) defaults)\n  \"http://google.com/hello/world\"\n</code></pre>\n\n<p>The <code>\\_ _ _ -&gt; Nothing</code> is a function to check status code, see <a href=\"http://hackage.haskell.org/package/wreq-0.4.0.0/docs/Network-Wreq-Types.html#t:StatusChecker\" rel=\"nofollow noreferrer\">StatusChecker</a>. It returns nothing indicating that any status code is OK.</p>\n"}, {"tags": [], "owner": {"reputation": 1476, "user_id": 700597, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/rWtor.jpg?s=128&g=1", "display_name": "runeks", "link": "https://stackoverflow.com/users/700597/runeks"}, "is_accepted": false, "score": 2, "last_activity_date": 1468532121, "last_edit_date": 1468532121, "creation_date": 1468530900, "answer_id": 38384394, "question_id": 34285433, "link": "https://stackoverflow.com/questions/34285433/wreq-stop-404s-throwing-exceptions/38384394#38384394", "title": "Wreq: Stop 404s throwing exceptions", "body": "<p>Here's the <code>checkStatus</code> function I ended up with after researching a bit. I couldn't figure out how to convert a <code>HttpException</code> to a <code>SomeException</code>, but then I found <code>Control.Monad.Catch.SomeException</code>. This will ignore 404s and re-throw all other exceptions.</p>\n\n<pre><code>import           Network.HTTP.Client.Types\nimport           Network.HTTP.Types.Status\nimport           Network.HTTP.Types.Header\nimport qualified Control.Exception as E\nimport           Control.Monad.Catch (SomeException(..))\n\nnotFoundMeansNothing :: Status -&gt; ResponseHeaders -&gt; CookieJar -&gt; Maybe E.SomeException\nnotFoundMeansNothing s h c\n    | s == status404 = Nothing\n    | otherwise =\n        if statusIsClientError s || statusIsServerError s then\n            Just . SomeException $ StatusCodeException s h c\n        else\n            Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 8846793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/585b1ea1b9eccf132be32bd295de6f65?s=128&d=identicon&r=PG&f=1", "display_name": "Evelyn Schneider", "link": "https://stackoverflow.com/users/8846793/evelyn-schneider"}, "is_accepted": false, "score": 5, "last_activity_date": 1520848267, "last_edit_date": 1520848267, "creation_date": 1509168947, "answer_id": 46986623, "question_id": 34285433, "link": "https://stackoverflow.com/questions/34285433/wreq-stop-404s-throwing-exceptions/46986623#46986623", "title": "Wreq: Stop 404s throwing exceptions", "body": "<p>For posterity: newer versions of <code>wreq</code> (starting with <code>0.5</code>) have replaced <code>checkStatus</code> with <code>checkResponse</code>, which takes different arguments. An equivalent to Yuras' answer would now be:</p>\n\n<pre><code>getWith opts url\n  where opts = set checkResponse (\\_ _ -&gt; return ()) defaults\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3826, "user_id": 27461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79f06a59954d7cfb349f9dbf92a33704?s=128&d=identicon&r=PG", "display_name": "Brian C. Lane", "link": "https://stackoverflow.com/users/27461/brian-c-lane"}, "edited": false, "score": 0, "creation_date": 1523548567, "post_id": 47624669, "comment_id": 86616754, "body": "This is the correct answer (using Wreq 0.5.2.1 here)"}], "tags": [], "owner": {"reputation": 71, "user_id": 4074877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4674b26d71a05f7d571ddf613bd482b5?s=128&d=identicon&r=PG&f=1", "display_name": "bens", "link": "https://stackoverflow.com/users/4074877/bens"}, "is_accepted": false, "score": 7, "last_activity_date": 1512345427, "creation_date": 1512345427, "answer_id": 47624669, "question_id": 34285433, "link": "https://stackoverflow.com/questions/34285433/wreq-stop-404s-throwing-exceptions/47624669#47624669", "title": "Wreq: Stop 404s throwing exceptions", "body": "<p>To expand on the answer by Evelyn Schneider, I got this to work with</p>\n\n<pre><code>r &lt;- getWith opts url\nwhere \n  opts = set Network.Wreq.checkResponse (Just $ \\_ _ -&gt; return ()) defaults\n</code></pre>\n"}], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1162, "favorite_count": 2, "accepted_answer_id": 34290005, "answer_count": 4, "score": 7, "last_activity_date": 1520848267, "creation_date": 1450171731, "last_edit_date": 1450186707, "question_id": 34285433, "link": "https://stackoverflow.com/questions/34285433/wreq-stop-404s-throwing-exceptions", "title": "Wreq: Stop 404s throwing exceptions", "body": "<p>I am trying to test broken links but, when I use Wreq's <code>get</code> method and run into a 404, I get an exception (see bottom) rather than a statusCode to handle. Only 200s seem to be returned.</p>\n\n<p>I tried to follow the error-handling code in the <a href=\"http://www.serpentine.com/wreq/tutorial.html#error-handling\" rel=\"noreferrer\">tutorial</a> but I can't find a way to return the same type as <code>get u</code>. Moreover, this seems to be more complexity than I need in this instance.</p>\n\n<p>How can I simply prevent the exception and just return the responseStatus as is</p>\n\n<pre><code>verifySeatme :: Maybe URL -&gt; IO UrlStatus\nverifySeatme url = do\n    case url of\n        Nothing -&gt; return None\n        Just \"\" -&gt; return None\n        Just u -&gt; do\n            seatmeResp &lt;- get u --`E.catch` handler\n            -- r ^? responseBody . key \"url\"\n            -- could also check for redirect to errorPage.aspx\n            if seatmeResp ^. W.responseStatus . statusCode == 200\n            then return (Working u)\n            else return Broken\n    where\n        handler e@(StatusCodeException s respHeaders _) =\n            do\n                return respHeaders\n</code></pre>\n\n<p>Here is the exception thrown, and you can see it has the stateCode i want</p>\n\n<pre><code>*Main&gt; re &lt;- get \"https://www.seatme.nl/restaurant/1371/Londen.htm\"\n*** Exception: StatusCodeException (Status {statusCode = 404, statusMessage = \"Not Found\"}) [(\"Cache-Control\",\"private\"),....\n</code></pre>\n\n<p>Yuras suggested using options, but I have been unable to work from the example using <code>params</code> to one using <code>checkStatus :: Lens' Options (Maybe StatusChecker)</code>:</p>\n\n<pre><code>getData :: IO Restos\ngetData = do\n    let opts = defaults &amp; customStatusHandler\n    jdata &lt;- asJSON =&lt;&lt; getWith opts \"http://localhost/restos-short.json\" :: IO Resp\n    let\n        restos = jdata ^. W.responseBody\n    verified &lt;- mapM processEntry restos\n    return verified\n\n-- type StatusChecker = Status -&gt; ResponseHeaders -&gt; CookieJar -&gt; Maybe SomeException\ncustomStatusHandler :: W.StatusChecker\ncustomStatusHandler st res _ =\n    Just res\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 0, "creation_date": 1450358886, "post_id": 34281885, "comment_id": 56412797, "body": "By the way: Welcome to Stack Overflow! On Stack Overflow if you find an answer adequate please accept it by pressing the checkmark below the answer score."}], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 3154128, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5ed294fb59792305ef596f9e7a5de968?s=128&d=identicon&r=PG", "display_name": "cxcfan", "link": "https://stackoverflow.com/users/3154128/cxcfan"}, "edited": false, "score": 0, "creation_date": 1450165463, "post_id": 34283413, "comment_id": 56308614, "body": "So, can we say <code>rpar</code> evaluates its argument to WHNF (weak head normal form) while <code>rseq</code> evaluates its argument to NF?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 175, "user_id": 3154128, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5ed294fb59792305ef596f9e7a5de968?s=128&d=identicon&r=PG", "display_name": "cxcfan", "link": "https://stackoverflow.com/users/3154128/cxcfan"}, "edited": false, "score": 1, "creation_date": 1450165518, "post_id": 34283413, "comment_id": 56308644, "body": "<code>rpar</code> only sparks the computation, as far as I know it does not force any evaluation while <code>rseq</code> will force evaluation to whnf. (For nf you need <code>rdeepseq</code>.) In the case of <code>Integer</code> I believe that whnf == nf."}, {"owner": {"reputation": 175, "user_id": 3154128, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5ed294fb59792305ef596f9e7a5de968?s=128&d=identicon&r=PG", "display_name": "cxcfan", "link": "https://stackoverflow.com/users/3154128/cxcfan"}, "edited": false, "score": 0, "creation_date": 1450165959, "post_id": 34283413, "comment_id": 56308881, "body": "I see. One more question, does <code>rseq</code> start the evaluation of its argument instantly?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 175, "user_id": 3154128, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5ed294fb59792305ef596f9e7a5de968?s=128&d=identicon&r=PG", "display_name": "cxcfan", "link": "https://stackoverflow.com/users/3154128/cxcfan"}, "edited": false, "score": 1, "creation_date": 1450166158, "post_id": 34283413, "comment_id": 56308980, "body": "Hmm, let&#39;s see. <code>rseq a</code> will compute <code>a</code> to whnf when the containing computation is demanded, so when you <code>evaluate . runEval</code> the containing computation <code>a</code> will be computed."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 4, "last_activity_date": 1450164850, "creation_date": 1450164850, "answer_id": 34283413, "question_id": 34281885, "link": "https://stackoverflow.com/questions/34281885/when-are-rpar-and-rseq-expressions-actually-computed-in-haskell-program/34283413#34283413", "title": "When are rpar and rseq expressions actually computed in Haskell program?", "body": "<ol>\n<li><p>The bigger question is: when are things computed in Haskell?</p>\n\n<p>Since Haskell is a lazy language we compute a thing only when that thing is demanded. Specifically in your first program if you never demand <code>r</code> (<a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#v:evaluate\" rel=\"nofollow\"><code>evaluate</code></a> will only compute it to the <code>(,)</code> constructor) the <code>fib</code> calls are never computed and the parallelism is only overhead.</p>\n\n<p>In you second program <code>rseq</code> will demand the result of the containing computation and therefore it is computed regardless of if you <code>print</code> it or not.</p></li>\n<li><p>Running the program with <code>+RTS -N2</code> will make the runtime use 2 Haskell Execution Contexts (HECs). The computations <code>a</code> and <code>b</code> will be added to a spark pool and will be available for either HEC to compute. What happens next is GHC Runtime magic, but if the computations are not too simple you can assume that each HEC will take one spark and compute it. </p>\n\n<p>For more reading on the RTS check out this collection of papers: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ReadingList#DataParallelHaskellandconcurrency\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/wiki/ReadingList#DataParallelHaskellandconcurrency</a> (and the run time section), and possible Simon Marlow's <a href=\"http://chimera.labs.oreilly.com/books/1230000000929\" rel=\"nofollow\">http://chimera.labs.oreilly.com/books/1230000000929</a></p></li>\n</ol>\n"}], "owner": {"reputation": 175, "user_id": 3154128, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5ed294fb59792305ef596f9e7a5de968?s=128&d=identicon&r=PG", "display_name": "cxcfan", "link": "https://stackoverflow.com/users/3154128/cxcfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 665, "favorite_count": 1, "accepted_answer_id": 34283413, "answer_count": 1, "score": 2, "last_activity_date": 1450164850, "creation_date": 1450158159, "question_id": 34281885, "link": "https://stackoverflow.com/questions/34281885/when-are-rpar-and-rseq-expressions-actually-computed-in-haskell-program", "title": "When are rpar and rseq expressions actually computed in Haskell program?", "body": "<p>Consider the following program.\n</p>\n\n<pre><code>import Control.Parallel\nimport Control.Parallel.Strategies\n\nmain = do\n    r &lt;- evaluate (runEval test)\n    print r\n\ntest = do\n    a &lt;- rpar (fib 36)\n    b &lt;- rpar (fib 37)\n    return (a,b)\n\nfib :: Int -&gt; Integer\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n</code></pre>\n\n<p>Note that we deliberately use an inefficient implementation of Fibonacci generator to make computations take some time. Now we compile this program with GHC:</p>\n\n<pre><code>$ ghc rpar.hs -threaded\n</code></pre>\n\n<p>The program takes <strong>3.281s</strong> with <code>+RTS -N1</code> flag and <strong>2.126s</strong> with <code>+RTS -N2</code> flag. Now we replace <code>print r</code> with <code>print \"hello\"</code> in <code>main</code> function and compile the modified program in the same way. New program takes <strong>0.003s</strong> with <code>+RTS -N1</code> and <strong>0.004s</strong> with <code>+RTS -N2</code>. It seems that <code>a</code> and <code>b</code> in <code>test</code> function are not computed in new program.</p>\n\n<p>Then, we modify <code>test</code> function in <code>rpar/rseq</code> style:\n</p>\n\n<pre><code>test = do\n    a &lt;- rpar (fib 36)\n    b &lt;- rseq (fib 37)\n    return (a,b)\n</code></pre>\n\n<p>We conduct the same experiment on this program. (1) <code>print r</code> in <code>main</code> function: the program takes <strong>3.283s</strong> and <strong>2.138s</strong> for <code>+RTS -N1</code> and <code>+RTS -N2</code> flags respectively; (2) <code>print \"hello\"</code> in <code>main</code> function: the program takes <strong>1.956s</strong> and <strong>2.025s</strong> for <code>+RTS -N1</code> and <code>+RTS -N2</code> respectively. Obviously, either of <code>a</code> or <code>b</code> in <code>test</code> is computed in this case.</p>\n\n<p><strong>I have two questions from this example:</strong></p>\n\n<p>(1) when are <code>rpar</code> and <code>rseq</code> expressions actually computed in program? It seems that <code>(fib 36)</code> is not instantly computed when <code>a &lt;- rpar (fib 36)</code> is evaluated.</p>\n\n<p>(2) if a machine has sufficient CPU cores and we specify <code>+RTS -N2</code> flag when running the program, are computations of <code>a</code> and <code>b</code> guaranteed to start simultaneously (or almost simultaneously) ?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 0, "creation_date": 1450152143, "post_id": 34280832, "comment_id": 56303635, "body": "They are not different types, tail recursive functions are a subset of all recursive functions. They can be transformed to a loop by a compiler and therefore not consume stack."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 0, "creation_date": 1450162669, "post_id": 34280832, "comment_id": 56307291, "body": "@fjarri it&#39;s not that clear-cut because of laziness."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 5, "creation_date": 1450162706, "post_id": 34280832, "comment_id": 56307305, "body": "That <code>sum</code> is not tail-recursive; that would be <code>sum = go 0 where go acc [] = acc; go acc (x:xs) = go (x + acc) xs</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450172620, "post_id": 34280832, "comment_id": 56312911, "body": "I don&#39;t recommend using the concept of &quot;tail recursion&quot; to reason about  Haskell."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450187911, "post_id": 34280832, "comment_id": 56323595, "body": "@ReinHenrichs Why is that? GHC (potentially) performs tail call elimination as an optimization, so if you want to reason about the operational semantics of a Haskell program compiled with GHC you (potentially) need to know about tail call elimination."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450201264, "post_id": 34280832, "comment_id": 56333268, "body": "@user2407038 Because sometimes it can harm performance to move to tail recursion. E.g. <code>map2 f xs = go xs [] where go [] acc = reverse acc ; go (y:ys) acc = go ys (f y:acc)</code> is tail recursive and far worse than the non-tail recursive <code>map f [] = [] ; map f (x:xs) = f x:xs</code>. It is unnecessarily more strict, it will prevent any list fusion / deforestation optimization to trigger, and it can allocate a long list even if only the first few elements are needed (e.g. <code>takeWhile p $ map2 f xs</code>). TL;DR: laziness and tail recursion is a strange mix."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450202828, "post_id": 34280832, "comment_id": 56334268, "body": "@user2407038 &quot;GHC (potentially) performs tail call elimination as an optimization.&quot; No. It does not, unless you are referring simply to the facts that all &quot;calls&quot; are &quot;tail calls&quot; and that GHC reduces expressions during evaluation. There is no code in GHC that selectively optimizes tail recursion in Haskel expressions, which is the context that TCO always comes up in. What it <i>does</i> do is left-most outermost reduction, which sometimes amounts to the same thing, so why talk about TCO when we should be talking simply about lazy evaluation?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1450188171, "last_edit_date": 1450188171, "creation_date": 1450169495, "answer_id": 34284669, "question_id": 34280832, "link": "https://stackoverflow.com/questions/34280832/tail-recursion-vs-primitive-recursion/34284669#34284669", "title": "Tail recursion vs Primitive Recursion", "body": "<p>Intuitively, we have tail recursion when we have a recursive function such that, when a recursive call is performed, the result of that call is the result of the function. In a sense, after the recursive call \"there is nothing more to be done\".</p>\n\n<pre><code>-- tail recursion\nf1 n = if ... then ... else f1 (n - 1)\n-- not tail recursion\nf2 n = if ... then ... else 5 * f2 (n - 1)\n</code></pre>\n\n<p>Primitive recursion is another beast. We have primitive recursion when every recursive call is done using an argument which is a \"direct subterm\" of the original one.</p>\n\n<pre><code>-- primitive recursion (&amp; non-tail recursion)\nf1 (x:xs) = g x (f1 xs)   -- xs is  asubterm of x:xs\n\n-- a tree type\ndata T = K Int T T\n-- primitive recursion (&amp; non-tail recursion)\nf2 (K n l r) = h n (f2 l) (f2 r)                    -- l, r are subterms\n-- non-primitive recursion (&amp; tail recursion)\nf3 (K n l (K m rl rr)) = f3 (K m (K n rl l) rl)     -- not a subterm\n</code></pre>\n"}], "owner": {"reputation": 297, "user_id": 5627223, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7ad976e9bf8fd4b8b5304a010bdb3a21?s=128&d=identicon&r=PG&f=1", "display_name": "hiboss", "link": "https://stackoverflow.com/users/5627223/hiboss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 1, "accepted_answer_id": 34284669, "answer_count": 1, "score": 1, "last_activity_date": 1450188171, "creation_date": 1450151490, "question_id": 34280832, "link": "https://stackoverflow.com/questions/34280832/tail-recursion-vs-primitive-recursion", "title": "Tail recursion vs Primitive Recursion", "body": "<p>I am studying about haskell recursion. and when i read about recursion topic which talk about this two different type of recursion. i am understand how tail recursion works and its step to be done. i am not understand how is primitive recursion done in background. can anyone here help explain more about primitive and given some example ? \nFor example : tail recursion</p>\n\n<pre><code> sum:: [Int] -&gt; Int\n sum [] = 0  \n sum (x:xs) = x+ (sum xs) \n</code></pre>\n\n<p>process  of sum [1,2,3,4]:</p>\n\n<pre><code>  = 1 + sum[2,3,4]\n  = 1 + (2 + sum [3,4] )\n  = 1 + ( 2 + ( 3 + sum[4]) )\n  = 1 + (2 +  (3 ( 4 + sum[])))\n  = 1 + (2 + ( 3 + ( 4 + 0 ) ) )  \n  = 10\n</code></pre>\n\n<p>How does primitive recursion works?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1450151031, "post_id": 34280735, "comment_id": 56303295, "body": "Worth a read perhaps: <a href=\"http://chris-taylor.github.io/blog/2013/02/09/io-is-not-a-side-effect/\" rel=\"nofollow noreferrer\">chris-taylor.github.io/blog/2013/02/09/io-is-not-a-side-effe&zwnj;&#8203;ct</a>"}, {"owner": {"reputation": 18146, "user_id": 646619, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/bd61a0f309ebc135d2661710c2faf379?s=128&d=identicon&r=PG", "display_name": "Colonel Thirty Two", "link": "https://stackoverflow.com/users/646619/colonel-thirty-two"}, "edited": false, "score": 1, "creation_date": 1450151363, "post_id": 34280735, "comment_id": 56303395, "body": "IO is done via monads. See <a href=\"http://stackoverflow.com/questions/44965/what-is-a-monad\"><i>What is a Monad?</i></a> for an explanation of what those are."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1450151680, "post_id": 34280735, "comment_id": 56303485, "body": "I think understanding IO and understanding Monads are too often put in the same bucket \u2014 but they are distinct things; even independent, ultimately."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 1, "creation_date": 1450151839, "post_id": 34280735, "comment_id": 56303531, "body": "Actually, I/O <i>can</i> be implemented without monads. Early Haskell implementations did that, with sort of a &quot;conversation&quot; mechanism."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1450152098, "post_id": 34280735, "comment_id": 56303617, "body": "I think early Haskell IO was problematic though. Today, IO could also be implemented in terms of e.g. arrows I think, but then again arrows are also monads... I&#39;d still argue in favor of teaching IO and monads separately though, starting with just IO, not mentioning it&#39;s a monad, and then eventually &quot;discovering&quot; it&#39;s a monad and that monads are more generally useful, and that IO is just a DSL, etc."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1450152151, "post_id": 34280735, "comment_id": 56303640, "body": "<a href=\"http://www.cis.upenn.edu/~cis194/spring13/lectures/08-IO.html\" rel=\"nofollow noreferrer\">cis.upenn.edu/~cis194/spring13/lectures/08-IO.html</a> too was a re-read"}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450152253, "post_id": 34280735, "comment_id": 56303666, "body": "@ErikAllik: It&#39;ld be worth mentioning in the first place that <code>IO</code> <i>is</i> pure and that <code>do</code> expressions have nothing to do with imperative programming before teaching newcomers about it ;). Thinking of it a bit, who was the genius who decided to incorporate such a misleading thing as <code>do</code> in Haskell?"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1450153967, "post_id": 34280735, "comment_id": 56304084, "body": "What side of IO is pure? The Haskell side or the Haskell RTS side? It&#39;s pure from one angle and totally impure from the other."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1450172690, "post_id": 34280735, "comment_id": 56312971, "body": "<code>f :: IO Int</code> is not a function, it is a value. <code>lookInDatabase :: IO DBThing</code> doesn&#39;t return a value: it <i>is</i> a value. It is always the same value, so it is pure."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450174921, "post_id": 34280735, "comment_id": 56314601, "body": "@ReinHenrichs: Haskell functions don&#39;t &quot;return&quot; a value. Instead, they get &quot;applied&quot; to a simpler function. Think of it for a moment. What disallows the <code>0</code> literal from being a function? It has type <code>Num a =&gt; a</code>, and so does <code>id $ 0</code>. That&#39;s one of Haskell&#39;s beauties; functions are sort of like templated values, and values are functions with no arguments. Thus, and taking currying into account, there&#39;s no purpose in diferentiating a function from a value, though it can be done anyways... BTW, <code>f :: IO Int</code> is a type delaration, thus neither a function or a value."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 0, "creation_date": 1450202187, "post_id": 34280735, "comment_id": 56333833, "body": "@KemyLand No. Values are not &quot;functions with no arguments&quot;. Neither <code>0</code> nor <code>id $ 0</code> are functions. And yes, it is easy to differentiate a function from other values: functions are values whose type is constructed using <code>-&gt;</code>. And besides, functions <i>are</i> values."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 0, "creation_date": 1450202465, "post_id": 34280735, "comment_id": 56334046, "body": "@KemyLand It seems that others were able to understand &quot;<code>f :: IO Int</code> is not a function&quot; to mean &quot;A value <code>f</code> of type <code>IO Int</code> is not a function&quot;. Why couldn&#39;t you? Is it because you are trying to find ways to prove that I am wrong rather than trying to engage in a good faith discussion? I am not interested in playing that game."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 0, "creation_date": 1450203740, "post_id": 34280735, "comment_id": 56334830, "body": "@KemyLand &quot;Haskell functions don&#39;t &quot;return&quot; a value.&quot; You yourself say that functions return values in your own answer. You are obviously just trying to pick a fight."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450225513, "post_id": 34280735, "comment_id": 56346019, "body": "@ReinHenrichs: Please don&#39;t take me wrong. I&#39;m not trying to take a fight by no means. Actually, your last comments don&#39;t show any competence, profesionality and/or maturity. Why would you try to argument that I&#39;m trying to &quot;take you wrong&quot;? I don&#39;t care if you&#39;re wrong or not, but whatever the OP learns from the question. This community is for helping each other, not to act in such a inappropiate way. And, you&#39;re right, I wrote an error in my answer, and I&#39;ll fix it. Thank you."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450225587, "post_id": 34280735, "comment_id": 56346040, "body": "@ReinHenrichs: BTW, you said you don&#39;t want to &quot;engage in that game&quot;, but the number of unread messages in my inbox button says otherwise."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450228371, "post_id": 34280735, "comment_id": 56346860, "body": "Hey @ReinHenrichs - could you please elaborate on <code>It is always the same value, so it is pure</code>? I fully trust that you&#39;re right (from knowing your excellent podcasts and reputation), however how can my <code>t = 0, t = 1 ...</code> arguments (which I know aren&#39;t right) be disproved? Could you elaborate please?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450228586, "post_id": 34280735, "comment_id": 56346930, "body": "@KevinMeredith An IO action is a &quot;recipe&quot; for performing IO that the runtime system must execute. The value in question is that recipe, and the recipe is always the same. For example, <code>getLine</code> is always the same recipe to read a line of input from stdin, and this does not change based on what is actually read when it is executed. And FWIW I am frequently wrong, so don&#39;t take what I say on faith."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1450229085, "post_id": 34280735, "comment_id": 56347084, "body": "@KevinMeredith This Haskell I/O tutorial was very helpful to me when I was first working through these things: <a href=\"http://www.vex.net/~trebla/haskell/IO.xhtml\" rel=\"nofollow noreferrer\">vex.net/~trebla/haskell/IO.xhtml</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1450151338, "post_id": 34280767, "comment_id": 56303388, "body": "What part of my answer was deemed incorrect or misleading by the downvoter?"}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 0, "creation_date": 1450151923, "post_id": 34280767, "comment_id": 56303556, "body": "Limitations of the Von Neumann architecture? We all know it&#39;s not perfect, but that&#39;s just too out of context. P.D: I&#39;m not the downvoter."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "edited": false, "score": 0, "creation_date": 1450153893, "post_id": 34280767, "comment_id": 56304068, "body": "John Backus and pure IO have a lot in common; Von Neumann is also relevant I think, but yes, perhaps a bit too broad here."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 10, "last_activity_date": 1450153912, "last_edit_date": 1450153912, "creation_date": 1450150964, "answer_id": 34280767, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io/34280767#34280767", "title": "Understanding pure functions in Haskell with IO", "body": "<p>IO is really a separate language, conceptually. It's the language of the Haskell RTS (runtime system). It's implemented in Haskell as a (relatively simple) embedded DSL whose \"scripts\" have the type <code>IO a</code>.</p>\n\n<p>So Haskell functions that return values of type <code>IO a</code>, are actually not the functions that are being executed at runtime \u2014 what gets executed is the <code>IO a</code> value itself. So these functions actually <em>are</em> pure but their return values <em>represent</em> non-pure computations. </p>\n\n<p>From a language design point of view, IO is a really elegant hack to keep the non-pure ugliness completely isolated away while at the same integrating it tightly into its pure surroundings, without resorting to special casing. In other words, the design does not solve the problems caused by impure IO but it does a great job of at least not affecting the pure parts of your code. </p>\n\n<hr>\n\n<p>The next step would be to look into FRP \u2014 with FRP you can make the layer that contains IO even thinner and move even more of non-pure logic into pure logic. </p>\n\n<p>You might also want to read John Backus' writings on the topic of Function Programming, the limitations of the Von Neumann architecture etc. Conal Elliott is also a name to google if you're interested in the relationship between purity and IO. </p>\n\n<hr>\n\n<p>P.S. also worth noting is that while IO is heavily reliant on monads to work around an aspect of lazy evaluation, and because monads are a very nice way of structuring embedded DSLs (of which IO is just a single example), monads are much more general than IO, so try not to think about IO and monads in the same context too much \u2014 they are two separate things and both could exist without the other. </p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450173074, "post_id": 34280878, "comment_id": 56313215, "body": "&quot;I/O actions are not pure.&quot;  But the rest of your answer is an argument that they <i>are</i> pure, which is correct. Perhaps you mean to say that the <i>execution</i> of IO actions is not pure."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450174678, "post_id": 34280878, "comment_id": 56314410, "body": "@ReinHenrichs: They <i>can&#39;t</i> be pure. My argument is that I/O actions are not pure, but <code>IO</code> (as a monad and in-Haskell concept) is anyways."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450203184, "post_id": 34280878, "comment_id": 56334493, "body": "What is &quot;they&quot;? The values themselves? The evaluation of these values? Both are pure. Execution of these values by the RTS is impure, in some sense, but no one is expecting execution to be pure."}, {"owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450225629, "post_id": 34280878, "comment_id": 56346065, "body": "@ReinHenrichs: Hi again, What do you mean? Please be more specific."}], "tags": [], "owner": {"reputation": 7515, "user_id": 5249858, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900942861bfbfdd27433e3ccbf7d6d0f?s=128&d=identicon&r=PG&f=1", "display_name": "3442", "link": "https://stackoverflow.com/users/5249858/3442"}, "is_accepted": false, "score": 4, "last_activity_date": 1457926285, "last_edit_date": 1457926285, "creation_date": 1450151782, "answer_id": 34280878, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io/34280878#34280878", "title": "Understanding pure functions in Haskell with IO", "body": "<p>First of all, you're right in noticing that I/O actions <em>are not</em> pure. That's impossible. But, purity in all functions is one of Haskell's promising points, so what's happening?</p>\n\n<p>Whether you like it or not, a function that applies into a (may also be incorrectly said \"returns a\") <code>IO Something</code> with some arguments <em>will</em> always return the same <code>IO Something</code> with the same arguments. The <code>IO</code> monad allows you to \"hide\" actions inside of the container the monad acts like. When you have a <code>IO String</code>, that function/object does <em>not</em> contain a <code>String</code>/<code>[Char]</code>, but rather sort of a promise that you'll get that <code>String</code> somehow in the future. Thus, <code>IO</code> contains information of <em>what</em> to do when the impure I/O action needs to be performed.</p>\n\n<p>After all, the only way for an <code>IO</code> action to be performed is by it having the name <code>main</code>, or be a dependency of <code>main</code> thereof. Because of the flexibility of monads, you can \"concatenate\" <code>IO</code> actions. A program like this... (note: this code is not a good idea)</p>\n\n<pre><code>main = do\n    input &lt;- getLine\n    putStrLn input\n</code></pre>\n\n<p>Is syntatic sugar for...</p>\n\n<pre><code>main =\n    getLine &gt;&gt;= (\\input -&gt; putStrLn input)\n</code></pre>\n\n<p>That would state that <code>main</code> is the I/O action resulting from printing to standard output a string read from standard input, followed by a newline character. Did you saw the magic? <code>IO</code> is just a wrapper representing what to <em>do</em>, in an impure context, to produce some given output, but not the <em>result</em> of that operation, because that would need the Haskell language to admit impure code.</p>\n\n<p>Think of it as sort of a receipe. If you have a receipe (read: <code>IO</code> monad) for a cake (read: <code>Something</code> in <code>IO Something</code>), you know how to make the cake, but you can't make the cake (because you could screw that masterpiece). Instead, the master chief (read: the most basic parts of the Haskell runtime system, responsible for applying <code>main</code>) does the dirty work for you (read: doing impure/illegal stuff), and, the best of all, he won't commit any mistakes (read: breaking code purity)... unless the oven breaks of course (read: <code>System.IO.Error</code>), but he knows how to clean that up (read: code will <em>always</em> remain pure).</p>\n\n<p>This is one of the reasons that <code>IO</code> is an opaque type. It's implementation is somewhat controversial (until you read GHC's source code), and is better of to be left as implementation-defined.</p>\n\n<p>Just be happy, because you've been illuminated by purity. A lot of programmers don't even know of Haskell's existence!</p>\n\n<p>I hope this has led some light on you!</p>\n"}, {"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1510925057, "post_id": 34283694, "comment_id": 81655320, "body": "I really like and understand things better with your answer, and I quoted you in another answer, I hope you can read it and tell me if that&#39;s correct in your point of view :). <a href=\"https://stackoverflow.com/questions/47336203/is-print-haskell-a-pure-function/47336322#47336322\" title=\"is print haskell a pure function\">stackoverflow.com/questions/47336203/&hellip;</a>"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1450165987, "creation_date": 1450165987, "answer_id": 34283694, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io/34283694#34283694", "title": "Understanding pure functions in Haskell with IO", "body": "<p>Haskell is pulling a trick here. IO both is and isn't pure, depending on how you look at it.</p>\n\n<p>On the \"IO is pure\" side, you're fallen into the very common error of thinking of a function returning an <code>IO DBThing</code> as of it were returning a <code>DBThing</code>. When someone claims that a function with type <code>Stuff -&gt; IO DBThing</code> is pure they are <em>not</em> saying that you can feed it the same <code>Stuff</code> and always get the same <code>DBThing</code>; as you correctly note that is impossible, and also not very useful! What they're saving is that given particular <code>Stuff</code> you'll always get back the same <code>IO DBThing</code>.</p>\n\n<p>You actually can't get a <code>DBThing</code> out of an <code>IO DBThing</code> at all, so Haskell don't ever have to worry about the database containing different values (or being unavailable) at different times. All you can do with an <code>IO DBThing</code> is combine it with something else that needs a DBThing and produces some other kind of <code>IO thing</code>; the result of such a combination is an <code>IO thing</code>.</p>\n\n<p>What Haskell is doing here is building up a correspondence between manipulation of pure Haskell values and changes that would happen out in the world outside the program. There are things you can do with <em>some</em> ordinary pure values that don't make any sense with impure operations like altering the state of a database. So using the correspondence between <code>IO</code> values and the outside world, Haskell simply doesn't provide you with any operations on <code>IO</code> values that <em>would</em> correspond to things that don't make sense in the real world.</p>\n\n<p>There are several ways to explain how you're \"purely\" manipulating the real world. One is to say that <code>IO</code> is just like a state monad, only the state being threaded through is the entire world outside your program;= (so your <code>Stuff -&gt; IO DBThing</code> function really has an extra hidden argument that receives the world, and actually returns a <code>DBThing</code> along with another world; it's always called with different worlds, and that's why it can return different <code>DBThing</code> values even when called with the same <code>Stuff</code>). Another explanation is that an <code>IO DBThing</code> value is itself an imperative program; your Haskell program is a totally pure function doing no IO, which returns an impure program that does IO, and the Haskell runtime system (impurely) executes the program it returns.</p>\n\n<p>But really these are both simply metaphors. The point is that the <code>IO</code> value simply has a very limited interface which doesn't allow you to do anything that doesn't make sense as a real world action.</p>\n\n<p>Note that the concept of <em>monad</em> hasn't actually come into this. Haskell's IO system really doesn't depend on monads; <code>Monad</code> is just a convenient interface which is sufficiently limited that if you're only using the generic monad interface you <em>also</em> can't break the IO limitations (even if you don't know your monad is actually IO). Since the <code>Monad</code> interface is also interesting enough to write a lot of useful programs, the fact that <code>IO</code> forms a monad allows a lot of code that's useful on other types to be generically reused on <code>IO</code>.</p>\n\n<p>Does this mean you actually get to write pure IO code? Not really. This is the \"of course IO isn't pure\" side of the coin. When you're using the fancy \"combining IO functions together\" you still have to think about your program executing steps one after the other (or in parallel), affecting and being affected by outside conditions and systems; in short exactly the same kind of reasoning you have to use to write IO code in an imperative language (only with a nicer type system than most of them). Making IO pure doesn't really help you banish impurity from the way you have to think about your code.</p>\n\n<p>So what's the point? Well for one, it gets us a compiler-enforced demarcation of code that can do IO and code that can't. If there's no <code>IO</code> tag on the type then impure IO isn't involved. <em>That</em> would be useful in any language just on its own. And the compiler knows this too; Haskell compilers can apply optimizations to non-IO code that would be invalid in most other languages because it's often impossible to know that a given section of code <em>doesn't</em> have side effects (unless you can see the full implementation of everything the code calls, transitively).</p>\n\n<p>Also, because IO is pure, code analysis tools (including your brain) don't have to treat IO-code specially. If you can pick out a code transformation that would be valid on pure code with the same structure as the IO code, you can do it on the IO code. Compilers make use of this. Many transformations are ruled out by the structure that IO code <em>must</em> use (in order to stay within the bounds of things that have a sensible correspondence to things in the outside world) but they would also be ruled out by any pure code that used the same structure; the careful construction of the IO interface makes \"execution order dependency\" look like ordinary \"data dependency\", so you can just use the rules of data dependency to determine the rules of using IO.</p>\n"}, {"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 2, "last_activity_date": 1450171409, "creation_date": 1450171409, "answer_id": 34285307, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io/34285307#34285307", "title": "Understanding pure functions in Haskell with IO", "body": "<p>Short answer: Yes, that <code>f</code> is referential transparent.</p>\n\n<p>Whenever you look at it, it equals the same value.<br />\nBut that doesn't mean it will always <strong>bind</strong> the same value.</p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 0, "last_activity_date": 1605558708, "last_edit_date": 1605558708, "creation_date": 1604346482, "answer_id": 64652353, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io/64652353#64652353", "title": "Understanding pure functions in Haskell with IO", "body": "<blockquote>\n<p>In short, is <code>f</code> (and <code>IO ...</code> functions in general) pure?</p>\n</blockquote>\n<p>So what you're <em>really</em> asking is:</p>\n<h3>Are <code>IO</code> definitions in Haskell pure?</h3>\n<blockquote>\n<p><em>You're really not going to like it.</em></p>\n<p>Deep Thought.</p>\n</blockquote>\n<p><strong>We don't know</strong>.</p>\n<p>From section 6.1.7 (page 75) of the <a href=\"https://www.haskell.org/definition/haskell2010.pdf\" rel=\"nofollow noreferrer\">Haskell 2010 report</a>:</p>\n<blockquote>\n<p>The <code>IO</code> type serves as a tag for operations (actions) that interact with the outside world. The <code>IO</code> type is abstract: no constructors are visible to the user. <code>IO</code> is an instance of the <code>Monad</code> and <code>Functor</code> classes.</p>\n</blockquote>\n<p>the crucial point being:</p>\n<blockquote>\n<p>The <code>IO</code> type is <em>abstract</em></p>\n</blockquote>\n<p>There is no &quot;standard definition&quot; of the <code>IO</code> type, so there's no way to determine if it's pure, let alone an expression of that type. We can't even provide a simple proof that <code>IO</code> is monadic (i.e. it satisfies the <a href=\"https://wiki.haskell.org/Monad_laws\" rel=\"nofollow noreferrer\">monad laws</a>) as <code>return</code> and <code>(&gt;&gt;=)</code>  <em>cannot</em> be defined in standard Haskell 2010.</p>\n<p>To get some idea on how this affects the determining of various <code>IO</code>-related properties, see:</p>\n<ul>\n<li><p><a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.15.736&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">Semantics of <em>fixIO</em></a> by Levent Erkok, John Launchbury and Andrew Moran.</p>\n</li>\n<li><p><a href=\"https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.13.9123&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">Tackling the Awkward Squad</a> by Simon Peyton Jones (starting from section 3.2 on page 20).</p>\n</li>\n</ul>\n<p>So when you next hear or read about Haskell being &quot;referentially transparent&quot; or &quot;purely functional&quot;, you now know that (at least for I/O) they're just conjectures - no <em>actual</em> standard definition means there's no way to prove or disprove them.</p>\n<p>(If you're now wondering how Haskell got into this state, I provide some more details <a href=\"https://stackoverflow.com/a/62557499/13679816\">here</a>.)</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1149, "favorite_count": 2, "answer_count": 5, "score": 6, "last_activity_date": 1605558708, "creation_date": 1450150752, "last_edit_date": 1495540952, "question_id": 34280735, "link": "https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-with-io", "title": "Understanding pure functions in Haskell with IO", "body": "<p>Given a Haskell <strong>value</strong> (edit per <a href=\"https://stackoverflow.com/users/2225384/rein-henrichs\">Rein Heinrich</a>'s <a href=\"https://stackoverflow.com/questions/34280735/understanding-pure-functions-in-haskell-w-io?noredirect=1#comment56312971_34280735\">comment</a>) <code>f</code>:</p>\n\n<pre><code>f :: IO Int\nf = ... -- ignoring its implementation\n</code></pre>\n\n<p>Quoting \"Type-Driven Development with Idris,\"</p>\n\n<blockquote>\n  <p>The key property of a pure function is that the same inputs always produce the same result. This property is known as referential transparency</p>\n</blockquote>\n\n<p>Is <code>f</code>, and, namely all <code>IO ...</code> functions in Haskell, pure? It seems to me that they are not since, <code>lookInDatabase :: IO DBThing</code>, won't <strong>always</strong> return the same value since:</p>\n\n<ul>\n<li>at t=0, the DB might be down</li>\n<li>at t=1, the DB might be up and <code>return MyDbThing</code> would result</li>\n</ul>\n\n<p>In short, is <code>f</code> (and <code>IO ...</code> functions in general) pure? If yes, then please correct my incorrect understanding given my attempt to disprove the functional purity of <code>f</code> with my <code>t=...</code> examples.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450148693, "post_id": 34279816, "comment_id": 56302682, "body": "What is wrong with the first approach? Change <code>docType :: Text</code> to <code>docType :: DocumentType</code> and it seems perfectly sensible. In which way is having an enumeration for your document type poor modularity?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450149030, "post_id": 34279816, "comment_id": 56302755, "body": "Also, if you look at type classes as modelling &quot;something&quot;, then any type class of the form <code>class C x where f0 :: x -&gt; T0; f1 :: x -&gt; T1; .. fn :: x -&gt; Tn</code> is simply modelling a record with field <code>{ f0 :: T0, .. , fn :: Tn }</code>. So your class formulating gives you no more power than your record type formulation (and as you can see, is actually harder to work with)."}, {"owner": {"reputation": 105, "user_id": 1819694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tRbuS.jpg?s=128&g=1", "display_name": "xenrelay", "link": "https://stackoverflow.com/users/1819694/xenrelay"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450151097, "post_id": 34279816, "comment_id": 56303315, "body": "Edited in an attempt to clarify, but I probably didn&#39;t do that well. Your suggestion would work great if this application was going to be a viewer. I might need to add editing later, dunno what the timeline for this is."}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 1819694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tRbuS.jpg?s=128&g=1", "display_name": "xenrelay", "link": "https://stackoverflow.com/users/1819694/xenrelay"}, "edited": false, "score": 0, "creation_date": 1450151241, "post_id": 34280431, "comment_id": 56303360, "body": "Great thoughts. See if the clarification changes anything at all for you."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 4, "last_activity_date": 1450148510, "creation_date": 1450148510, "answer_id": 34280431, "question_id": 34279816, "link": "https://stackoverflow.com/questions/34279816/haskell-types-vs-typeclasses-in-architecture/34280431#34280431", "title": "Haskell Types vs. Typeclasses in architecture", "body": "<p>Well, the class-based proposal doesn't even work.  Classes aren't types.  You can't have <code>[Doc]</code> if <code>Doc</code> is a class.</p>\n\n<p>The usual approach here is to determine what it is you're modeling, exactly.</p>\n\n<p>Do you want a bunch of things that behave uniformly, and can easily be packaged up together?  Then put that behavior into a type.  This is usually done by creating a record that holds a function for each kind of behavior you want.</p>\n\n<p>On the other hand, do you have a bunch of things that require very different handling?  In that case, put the data into a bunch of types and let the type checker (and exhaustiveness checker) guide you along the way to make sure you're always handling the right thing in the right place.</p>\n\n<p>I don't recommend using classes for this at all. Classes are (mostly) good only for the situation where you can write type-polymorphic code that is meaningful when there is a concrete type, but you don't need to know what the type is. (This is a slight exaggeration, but it's close enough to the truth to use it as a first-approximation heuristic.)</p>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 1819694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tRbuS.jpg?s=128&g=1", "display_name": "xenrelay", "link": "https://stackoverflow.com/users/1819694/xenrelay"}, "edited": false, "score": 0, "creation_date": 1450151477, "post_id": 34280668, "comment_id": 56303425, "body": "I actually knew about that functionality, but in the context of, say, Binary Trees. Change the way docContents is presented with each data constructor, and I think that&#39;s an interesting way of thinking about it."}, {"owner": {"reputation": 105, "user_id": 1819694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tRbuS.jpg?s=128&g=1", "display_name": "xenrelay", "link": "https://stackoverflow.com/users/1819694/xenrelay"}, "edited": false, "score": 0, "creation_date": 1450156132, "post_id": 34280668, "comment_id": 56304741, "body": "This breaks the modularity I was looking for, but it is clean, and does what I need it to. Would that there was a way to split different kinds of docs out into different modules."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 2, "last_activity_date": 1450150313, "creation_date": 1450150313, "answer_id": 34280668, "question_id": 34279816, "link": "https://stackoverflow.com/questions/34279816/haskell-types-vs-typeclasses-in-architecture/34280668#34280668", "title": "Haskell Types vs. Typeclasses in architecture", "body": "<blockquote>\n  <p>Suppose I have an application whose core data are Projects, Document\n  Sets (\"DocSets\"), and Documents (\"Docs\"). Docs are not restricted to\n  any particular content-type; they could be spreadsheets, images, HTML,\n  etc., and can have functions/behaviors other documents don't have.</p>\n</blockquote>\n\n<p>It sounds like you don't know that types can have multiple constructors (sum types). Instead of your <code>Doc</code> do:</p>\n\n<pre><code>data Doc = PagedTextDoc {docTitle :: Text, docContents :: ByteString}\n         | SpreadsheetDoc {docTitle :: Text, docContents :: ByteString}\n       ... etc\n</code></pre>\n\n<blockquote>\n  <p>Similarly, I might have multiple kinds of DocSets depending on the\n  type of behavior I need. Maybe this DocSet presents the documents in a\n  flat list, maybe that one associates a status with each document, and\n  has some cool rendering trick based off of status.</p>\n</blockquote>\n\n<pre><code>data DocSet = ListDocset Text [Doc] | KoolDocset [(Status, Doc)] | ...etc\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 1819694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tRbuS.jpg?s=128&g=1", "display_name": "xenrelay", "link": "https://stackoverflow.com/users/1819694/xenrelay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 34280668, "answer_count": 2, "score": 1, "last_activity_date": 1450151002, "creation_date": 1450144540, "last_edit_date": 1450151002, "question_id": 34279816, "link": "https://stackoverflow.com/questions/34279816/haskell-types-vs-typeclasses-in-architecture", "title": "Haskell Types vs. Typeclasses in architecture", "body": "<p>Suppose I have an application whose core data are Projects, Document Sets (\"DocSets\"), and Documents (\"Docs\"). Docs are not restricted to any particular content-type; they could be spreadsheets, images, HTML, etc., and can have functions/behaviors other documents don't have. Similarly, I might have multiple kinds of DocSets depending on the type of behavior I need. Maybe this DocSet presents the documents in a flat list, maybe that one associates a status with each document, and has some cool rendering trick based off of status.</p>\n\n<p>The code might look like this if I wasn't using typeclasses:</p>\n\n<pre><code>data Project = Project {\n  projName :: Text,\n  projDocSets :: [DocSet]\n}\n\ndata DocSet = DocSet {\n  dsName :: Text,\n  dsDocs :: [Doc]\n}\n\ndata Doc = Doc {\n  docTitle :: Text,\n  docType :: Text,\n  docContents :: ByteString\n}\n</code></pre>\n\n<p>The problem I see with this is while it allows there to be multiple kinds of Docs (via the docType field), it essentially uses manual type checking, which doesn't feel right (in my head). I could have data constructors for PagedTextDoc, ContinuousTextDoc, SpreadsheetDoc, ImageDoc, etc. That seems like poor modularity to me.</p>\n\n<blockquote>\n  <p><strong>EDIT:</strong> My \"poor modularity\" comment relies on knowledge that wasn't communicated very well. Each Doc has some common behaviors\n  ((de-)serialization, being grouped into a DocSet, a title, rendering,\n  others as the application evolves), and some unique behaviors\n  (internal representation in an easy-to-edit format, saving incremental\n  edits, partial rendering to HTML assuming application is a web app). </p>\n  \n  <p>Even if that weren't the case, it seems to me like the app would be\n  more modular if I could just create a new module, define my document\n  and what you can do with it, and bang, document is now supported. That\n  way, I define my paginated document over here, my spreadsheet over\n  there, and the two don't care about each other at all.</p>\n</blockquote>\n\n<p>Maybe I could use a typeclass for Docs?</p>\n\n<pre><code>data DocSet = DocSet {\n  dsName :: Text,\n  dsDocs :: [Doc]\n}\n\nclass Doc d where\n  docTitle :: d -&gt; Text\n  docType :: d -&gt; Text\n  docContents :: d -&gt; ByteString\n</code></pre>\n\n<p>The declaration for dsDocs now doesn't typecheck; lists only work for one particular concrete type, vs. any member of a typeclass. The DocSet definitely needs to be able to store/reference multiple kinds of documents.</p>\n\n<p>I've tried to do some searching, but frankly, my Google skills completely fail here. Am I thinking about the data structures correctly? Is the approach with all of (Proj, DocSet, Doc) as a single data constructor each really the best way of handling this, or am I missing something about the way Haskell handles polymorphism?</p>\n"}, {"tags": ["list", "haskell", "find", "tuples"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 5, "creation_date": 1450136111, "post_id": 34278528, "comment_id": 56299105, "body": "Look up... <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:lookup\" rel=\"nofollow noreferrer\">lookup</a>."}, {"owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1450136513, "post_id": 34278528, "comment_id": 56299249, "body": "this is for an exercise where I&#39;m specifically meant to use find"}], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 964015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b3afdd566b092e68363ec93cf09d96?s=128&d=identicon&r=PG", "display_name": "f4st", "link": "https://stackoverflow.com/users/964015/f4st"}, "is_accepted": true, "score": 8, "last_activity_date": 1450139514, "creation_date": 1450139514, "answer_id": 34279086, "question_id": 34278528, "link": "https://stackoverflow.com/questions/34278528/haskell-using-the-find-function-on-a-list-of-tuples/34279086#34279086", "title": "Haskell : using the `find` function on a list of tuples", "body": "<p>It seems like you're trying to use a pattern as an argument to <code>find</code>. Unfortunately, that won't work. You can only do pattern matching in a few places, such as guards and <code>case</code> expressions. </p>\n\n<p>As Jubobs has said in his comment, it's ideal to use <code>Data.List.lookup</code> in this case, but using <code>Data.List.find</code> is definitely possible as well.</p>\n\n<p>If you take a look at the type of <code>Data.List.find</code>, you'll see that it looks like this:</p>\n\n<pre><code>find :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a \n</code></pre>\n\n<p>This tells you two important things:</p>\n\n<ol>\n<li><p>The first argument has to be a predicate function, i.e. a function that returns True when it's argument is of the value you are looking for and returns False otherwise</p></li>\n<li><p>The function returns a <code>Maybe a</code>, which means it may return <code>Nothing</code> and you have to deal with this.</p></li>\n</ol>\n\n<p>Creating the predicate function is pretty easy. You just need something that tests the first value of the tuple using the <code>==</code> operator, perhaps a lambda function such as this:</p>\n\n<pre><code>\\(x, _) -&gt; x == \"Stamina\"\n</code></pre>\n\n<p>And now you can call <code>find</code> like this:</p>\n\n<pre><code>find (\\(x, _) -&gt; x == \"Stamina\") stats\n</code></pre>\n\n<p>Alternatively, you could create a general function for comparing the first element of a tuple to a known value, such as the following:</p>\n\n<pre><code>matchFirst x (y, _) = x == y\n</code></pre>\n\n<p>And later on use the <code>matchFirst</code> function as an argument to <code>find</code>:</p>\n\n<pre><code>find (matchFirst \"Stamina\") stats\n</code></pre>\n\n<p>Now let's take a look at my second point: how do you deal with <code>find</code> not finding anything?</p>\n\n<p>If you are absolutely sure that it will always succeed, you can simply use <code>Data.Maybe.fromJust</code> to extract the tuple from the <code>Maybe</code> like this:</p>\n\n<pre><code>value = snd $ fromJust $ find (matchFirst \"Stamina\") stats\n</code></pre>\n\n<p>Otherwise, if the lookup can actually fail, there are many things you can do. You can, for example, use a sensible default value with <code>Data.Maybe.fromMaybe</code> or you can change your <code>value</code> to have the type <code>Maybe Int</code>.</p>\n\n<p>Finally, one last thing: you've said that <code>value</code> has the type <code>a -&gt; Int</code>, i.e. a function that takes anything and returns an <code>Int</code>. This is not actually the case. Instead, it's just a single value.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1450169817, "creation_date": 1450169817, "answer_id": 34284780, "question_id": 34278528, "link": "https://stackoverflow.com/questions/34278528/haskell-using-the-find-function-on-a-list-of-tuples/34284780#34284780", "title": "Haskell : using the `find` function on a list of tuples", "body": "<p>More alternatives, which are not necessarily better than the above ones:</p>\n\n<p>Using a pattern as the OP suggested</p>\n\n<pre><code>find (\\c -&gt; case c of (\"A\", _) -&gt; True ; _ -&gt; False) [(\"B\",4), (\"A\", 5), (\"C\", 7)]\n</code></pre>\n\n<p>The same, exploiting an extension</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\nfind (\\case (\"A\", _) -&gt; True ; _ -&gt; False) [(\"b\",4), (\"A\", 5), (\"C\", 7)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 0, "last_activity_date": 1450705595, "creation_date": 1450705595, "answer_id": 34397209, "question_id": 34278528, "link": "https://stackoverflow.com/questions/34278528/haskell-using-the-find-function-on-a-list-of-tuples/34397209#34397209", "title": "Haskell : using the `find` function on a list of tuples", "body": "<p>Simple one-liner here using <code>fst</code> and an equality <code>==</code>.</p>\n\n<p>You need to import <code>Data.List</code> and <code>Data.Maybe</code>.</p>\n\n<pre><code>&gt; let set stats = [(\"Strength\",12),(\"Stamina\",60),(\"Health\",100)]\n&gt; snd $ fromJust $ find ((==\"Strength\") . fst) stats\n12\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 5497286, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/843873882983b83fad45d4763304d471?s=128&d=identicon&r=PG&f=1", "display_name": "dfridman1", "link": "https://stackoverflow.com/users/5497286/dfridman1"}, "is_accepted": false, "score": 0, "last_activity_date": 1450797881, "creation_date": 1450797881, "answer_id": 34419115, "question_id": 34278528, "link": "https://stackoverflow.com/questions/34278528/haskell-using-the-find-function-on-a-list-of-tuples/34419115#34419115", "title": "Haskell : using the `find` function on a list of tuples", "body": "<pre><code>fn :: Eq a =&gt; a -&gt; [(a, b)] -&gt; b\nfn x = snd . fromJust . find ((== x) . fst)\n</code></pre>\n\n<p>Then you would have</p>\n\n<pre><code>tuples :: [(String, Int)]\ntuples = undefined  -- a list of tuples\n\nstring :: String\nstring = \"Stamina\"\n\nvalue :: Int\nvalue = fn string tuples \n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3934, "favorite_count": 0, "accepted_answer_id": 34279086, "answer_count": 4, "score": 0, "last_activity_date": 1583916471, "creation_date": 1450135930, "last_edit_date": 1583916471, "question_id": 34278528, "link": "https://stackoverflow.com/questions/34278528/haskell-using-the-find-function-on-a-list-of-tuples", "title": "Haskell : using the `find` function on a list of tuples", "body": "<p>I was wondering if anyone could help me. Suppose I have a tuple of type <code>(String,Int)</code>, and a list of such tuples <code>[(\"Strength\",12),(\"Stamina\",60),(\"Health\",100)]</code> . </p>\n\n<p>How can I use the function <code>find</code> to extract the <code>Int</code> value of the tuple <code>(\"Stamina\",60)</code> if I don't actually know what order the tuples are inside the list but only that a certain tuple containing the string <code>\"Stamina\"</code> exists?</p>\n\n<p>I tried</p>\n\n<pre><code>value =   snd ( find (\"Stamina\", _ ) stats )\n</code></pre>\n\n<p>where <code>stats</code> is the list of tuples and <code>value</code> is defined as</p>\n\n<pre><code>  value :: a -&gt; Int    \n</code></pre>\n\n<p>..but it doesn't work :/ So any ideas? I'm specifically meant to use <code>find</code>.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 20333, "user_id": 774078, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/seSXR.png?s=128&g=1", "display_name": "Sterling Archer", "link": "https://stackoverflow.com/users/774078/sterling-archer"}, "edited": false, "score": 2, "creation_date": 1450127093, "post_id": 34276473, "comment_id": 56295183, "body": "Can you explain more? Why will Simon want to use that?"}, {"owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 0, "creation_date": 1450128344, "post_id": 34276473, "comment_id": 56295867, "body": "Thanks. I&#39;d just worked out that I had used the wrong part of the yaml file but this sped me along."}], "tags": [], "owner": {"reputation": 56, "user_id": 1968694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f708e13377c3fc2a163cb502dce8f94e?s=128&d=identicon&r=PG", "display_name": "dysinger", "link": "https://stackoverflow.com/users/1968694/dysinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1450126700, "creation_date": 1450126700, "answer_id": 34276473, "question_id": 34275754, "link": "https://stackoverflow.com/questions/34275754/install-hdbc-with-stack/34276473#34276473", "title": "Install HDBC with Stack", "body": "<p>You'll want to use </p>\n\n<pre><code>extra-deps:\n- HDBC-2.4.0.1\n</code></pre>\n"}], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 526, "favorite_count": 0, "accepted_answer_id": 34276473, "answer_count": 1, "score": 0, "last_activity_date": 1450126700, "creation_date": 1450123975, "question_id": 34275754, "link": "https://stackoverflow.com/questions/34275754/install-hdbc-with-stack", "title": "Install HDBC with Stack", "body": "<p>I'm one hour into using Stack but have hit a roadblock.</p>\n\n<p>I want to use </p>\n\n<pre><code>import Database.HDBC\nimport Database.HDBC.Sqlite3\n</code></pre>\n\n<p>in my code. HDBC seems to be on <a href=\"https://www.stackage.org/package/HDBC\" rel=\"nofollow\">stackage</a> but I can't work out how to configure for its use</p>\n\n<p>I have already executed <code>https://www.stackage.org/package/HDBC</code>, and have this in my <code>.cabal</code> file</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n                     , CrawlerHTTP\n                     , DbHandler\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , wreq\n                     , lens\n                     , containers\n                     , aeson\n                     , lens-aeson\n                     , HDBC\n  default-language:    Haskell2010\n</code></pre>\n\n<p>And I've tried adding this to my <code>.yaml</code> file</p>\n\n<pre><code># Extra package databases containing global packages\nextra-package-dbs:\n- HDBC-2.4.0.1\n</code></pre>\n\n<p>Where you see capitals I've also tried lowercase</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1450115648, "post_id": 34272667, "comment_id": 56288671, "body": "Good catch.  My guess is there is a regex equivalent of <code>\\d+\\.\\d+</code> matching a Double and fails to match Integer.  I also doubt that you can ever get more than one element since it will greedily match everything after the first Integer to the String."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1450117711, "post_id": 34272667, "comment_id": 56289809, "body": "This sounds a bit buggy to me. That said, <code>Read</code> is intended primarily to parse things that look like Haskell, and nothing that looks like Haskell will sensibly accept <code>&quot;123.&quot; ++ anything</code> except as a <code>Fractional</code> literal."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1450133991, "post_id": 34272667, "comment_id": 56298453, "body": "@dfeuer How sure of that are you? <code>:t 123.456e3</code> =&gt; <code>123.456e3 :: Num a =&gt; a</code> with <code>NumDecimals</code> turned on. ;-)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450141307, "post_id": 34272667, "comment_id": 56300703, "body": "@DanielWagner, woah!  That is some corner case magic."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1450141359, "post_id": 34272667, "comment_id": 56300718, "body": "Anyhow I call this a bug. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ReportABug\" rel=\"nofollow noreferrer\">bug report</a>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1450141498, "post_id": 34272667, "comment_id": 56300754, "body": "Or maybe not?  <code>lex &quot;123.45&quot;</code> gives a single token, so if you wear tokenizer glasses, you didn&#39;t actually find an integer..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1450142193, "post_id": 34272667, "comment_id": 56300895, "body": "@luqui, I do believe the current behavior merits a note in the user&#39;s guide."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450142261, "post_id": 34272667, "comment_id": 56300914, "body": "@DanielWagner, that&#39;s a good point, I suppose, although I&#39;d probably argue it shouldn&#39;t be handled in the parser, and I&#39;d guess it probably isn&#39;t. I imagine that&#39;s parsed as a <code>Fractional a</code> and then GHC makes note of the fact that in fact its <code>Rational</code> representation has a denominator of <code>1</code>."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 2, "creation_date": 1450174581, "post_id": 34272667, "comment_id": 56314326, "body": "Seems very much like a bug to me. As a user, I don&#39;t really care how it&#39;s implemented \u2014 parser, shmarser, whatever. This is inconsistent."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1456433120, "post_id": 34272667, "comment_id": 58957312, "body": "Rolled the title back to <code>reads</code>. The function is called <code>reads</code>, please leave it as is."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1457833512, "creation_date": 1457833512, "answer_id": 35965518, "question_id": 34272667, "link": "https://stackoverflow.com/questions/34272667/cant-reads-dot-separated-integers/35965518#35965518", "title": "Can&#39;t reads dot-separated integers", "body": "<p>Not only is this not documented in the report, it appears to be <em>at variance</em> from the report.</p>\n\n<p>There are many places where for efficiency reasons or otherwise the GHC standard libraries diverge from the reference implementations in the Report. But, unless carefully noted, the implementations should match behavior.</p>\n\n<p>However, if we look at the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#verbatim-307\" rel=\"nofollow\">relevant part</a> of the Haskell Report, we see</p>\n\n<pre><code>instance  Read Int  where  \n  readsPrec p r = [(fromInteger i, t) | (i,t) &lt;- readsPrec p r]  \n        -- Reading at the Integer type avoids  \n        -- possible difficulty with minInt\n\ninstance  Read Integer  where  \n    readsPrec p         = readSigned readDec\n</code></pre>\n\n<p>We see that it uses a different implementation that I don't think has this behavior.</p>\n\n<p>So this is something that certainly should be raised to the libraries list at haskell.org.</p>\n"}], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 35965518, "answer_count": 1, "score": 20, "last_activity_date": 1457833512, "creation_date": 1450112655, "last_edit_date": 1456432970, "question_id": 34272667, "link": "https://stackoverflow.com/questions/34272667/cant-reads-dot-separated-integers", "title": "Can&#39;t reads dot-separated integers", "body": "<p>While trying to read a list of dot-separated integers, I've noticed a strange thing.</p>\n\n<pre><code>Prelude&gt; (reads \"123\") :: [(Integer,String)]\n[(123,\"\")]\nPrelude&gt; (reads \"123.\") :: [(Integer,String)]\n[(123,\".\")]\nPrelude&gt; (reads \"123.456\") :: [(Integer,String)]\n[]\n</code></pre>\n\n<p>I understand why it happens in terms of the implementation (<code>readNumber</code> succeeds and then <code>convert</code> fails), and I understand how to use <code>readDec</code> to overcome it.</p>\n\n<p>My question is, is this behaviour documented somewhere in the report? If so, why?</p>\n"}, {"tags": ["haskell", "reactive-programming", "yampa", "euterpea"], "comments": [{"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1450276120, "post_id": 34271134, "comment_id": 56370801, "body": "Looks like a memory leak where unevaluated expression are filling the heap. What happens if you replace the <code>0,0</code> with <code>sfOut</code>? Unfortunately, I&#39;m not familiar with Euterpea, so I can&#39;t give much advice."}], "owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548725449, "creation_date": 1450107983, "last_edit_date": 1548725449, "question_id": 34271134, "link": "https://stackoverflow.com/questions/34271134/starting-signal-function-with-an-event-haskell-euterpea", "title": "Starting signal function with an event. Haskell - Euterpea", "body": "<p>I'm developing FRP application using Euterpea and got major problem in understanding how to do this one thing.</p>\n\n<p>I got my own Signal function that I want to trigger when specific event occurs. Now my SigFun is just running from the start of the program.</p>\n\n<p>Let's say I have a function that displays fourier transform of the signal on the graph and it works well: (string 1 is the function responsible for generating a waveform of a guitar string.)</p>\n\n<pre><code>    d &lt;- clockedSFToUISF 1 $ toFFT $ string 1 \n                                  -&lt; ()\n    let (s,fft) = unzip d\n        (a1,b1) = unzip s\n    _ &lt;- realtimeGraph graLay 1 Black -&lt; zip a1 fft\n</code></pre>\n\n<p>I tried if-then-else expression in toFFT function:</p>\n\n<pre><code>toFFT ::  SigFun CtrRate b Double -&gt; SigFun CtrRate b (Double, SEvent [Double])\ntoFFT sf = proc input -&gt; do \n       sfOut &lt;- sf -&lt; input\n       fourierData &lt;- fftA 100 256 -&lt; sfOut\n       outA -&lt; if  ______  then (sfOut, fourierData) else (0.0, Nothing)\n</code></pre>\n\n<p>When if-flag is True everything displays properly and program resources ar OK. When the flag is false. The FFT is flat (which is ok), but programs starts consuming a lot of memory:\n<a href=\"https://i.stack.imgur.com/LQlXy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LQlXy.png\" alt=\"Memory graph\"></a></p>\n\n<p>I know that in Yampa there are some functions called switches but I can't find them in Euterpea.</p>\n\n<p>Is it at all possible to \"trigger\" a signal function the way I think it can? I read something about ArrowChoice but it's not clear to me how it may be helpful.</p>\n\n<p>I feel like there is this basic stuff I'm not aware of.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1450106868, "post_id": 34270647, "comment_id": 56282815, "body": "If your list generation is itself a pure computation, use <code>let</code>. If it is the result of a monadic operation, you&#39;ll have to be more specific."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450119202, "post_id": 34270647, "comment_id": 56290638, "body": "&quot;It must build the tail first and then prepend the head&quot; -- this claim depends on the monad. For example, the <code>State</code> monad leaves <code>buildListM</code> perfectly efficient -- try leaving off the base case and watch the numbers scream by after you <code>evalState (buildListM 0) ()</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450122773, "post_id": 34270647, "comment_id": 56292715, "body": "As others have stated, the semantics of monadic computation depend on the monad. But if the monad in particular is one with too-strict bind operator, you will still run into the issue you have described. It is well known that the default <code>sequence</code> and friends have O(n^2) complexity for certain too-strict monads. For a fairly in depth analysis of this problem occurring in the real world, and how it was solved, see <a href=\"https://github.com/Gabriel439/Haskell-Pipes-Library/issues/100\" rel=\"nofollow noreferrer\">here</a>. Spoiler: the solution is to roll your own efficient implementation of sequence/mapM/replicateM, etc."}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1450193363, "post_id": 34270647, "comment_id": 56327560, "body": "Thanks. These are really good explanations to counter the assumption I had."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1450142752, "last_edit_date": 1450142752, "creation_date": 1450119260, "answer_id": 34274517, "question_id": 34270647, "link": "https://stackoverflow.com/questions/34270647/how-to-build-a-haskell-list-inside-a-monad-lazily/34274517#34274517", "title": "How to build a Haskell list inside a monad lazily?", "body": "<p>Many <code>Monads</code> (e.g., <code>IO</code>, strict <code>ST s</code>, strict <code>State s</code>) are \"strict\", in that <code>&gt;&gt;=</code> is strict in its left operand. Others, most notably <code>Identity</code> but also <code>(-&gt;) a</code>, lazy <code>State s</code>, lazy <code>Writer q</code>, lazy <code>ST s</code>, are \"lazy\" in the sense that <code>&gt;&gt;=</code> is not strict in its left operand. Consider applying <code>toListM</code> in the <code>Identity</code> monad:</p>\n\n<pre><code>buildListM 0 = return []\nbuildListM n = buildListM (n - 1) &gt;&gt;= return . (n :)\n</code></pre>\n\n<p>Here, <code>return = Identity</code> and <code>Identity m &gt;&gt;= f = f m</code>, so</p>\n\n<pre><code>buildListM 0 = Identity []\nbuildListM n = Identity . (n :) $ runIdentity (buildListM (n - 1))\n             = Identity (n : runIdentity (buildListM (n - 1)))\n</code></pre>\n\n<p>Since <code>Identity</code> and <code>runIdentity</code> are complete no-ops at runtime, <code>buildListM</code> is actually the same as <code>buildList</code> when run in the <code>Identity</code> monad. It's the particular monad, not the monadic nature, that makes things strict.</p>\n\n<p>You can sometimes do lazy things in \"strict\" monads in one of two ways:</p>\n\n<ol>\n<li><p>Cheat using <code>unsafeInterleaveIO</code> or <code>unsafeInterleaveST</code>.</p></li>\n<li><p>Use the more powerful <code>MonadFix</code> abstraction which lets you get hold of the result of a computation before it's been executed, but that will fail on you if you access such a result before it's available.</p></li>\n</ol>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 2, "accepted_answer_id": 34274517, "answer_count": 1, "score": 8, "last_activity_date": 1450142752, "creation_date": 1450106660, "last_edit_date": 1450119050, "question_id": 34270647, "link": "https://stackoverflow.com/questions/34270647/how-to-build-a-haskell-list-inside-a-monad-lazily", "title": "How to build a Haskell list inside a monad lazily?", "body": "<p>Consider the following two nearly identical functions:</p>\n\n<pre><code>buildList 0 = []\nbuildList n = n : buildList (n - 1)\n\nbuildListM 0 = return []\nbuildListM n = buildListM (n - 1) &gt;&gt;= return . (n :)\n</code></pre>\n\n<p>The laziness aspect of Haskell allows for <code>buildList</code> to generate the list without much overhead in memory because it generates the head of the list and then builds the tail. </p>\n\n<p>But the monadic version <code>buildListM</code> seems to use more memory as <code>n</code> gets larger because it must build the tail first and then prepend the head.</p>\n\n<p>Is this a good way to build lists inside monads, or is there a more efficient way?</p>\n"}, {"tags": ["arrays", "haskell", "immutability"], "comments": [{"owner": {"reputation": 4881, "user_id": 947526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/6a84b61e353299d7f9306e99bfce8854?s=128&d=identicon&r=PG", "display_name": "C-Otto", "link": "https://stackoverflow.com/users/947526/c-otto"}, "edited": false, "score": 2, "creation_date": 1450105684, "post_id": 34270172, "comment_id": 56281893, "body": "You can&#39;t have mutable values in Haskell. Maybe you want to look into Monads?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1450106563, "post_id": 34270172, "comment_id": 56282562, "body": "Mutable values are this way -----&gt; <a href=\"http://stackoverflow.com/tags/c%2B%2B\">click here</a>"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1450107563, "post_id": 34270172, "comment_id": 56283354, "body": "@n.m. thanks and congrats on the most unhelpful comment I have come across yet!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450108410, "post_id": 34270172, "comment_id": 56284017, "body": "You are welcome. Answers are supposed to be helpful, comments can bee jokes and whatnot. Are you a Haskell beginner? Your question doesn&#39;t have an answer that is both helpful and beginner-friendly. Well if you think &quot;don&#39;t do it&quot; is a helpful answer, then here you go."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450108710, "post_id": 34270172, "comment_id": 56284239, "body": "@n.m. yes I am a Haskell beginner (very much so). Ok, I apologise for being sensitive. Perhaps the question was asked incorrectly. I was looking for a solution to a problem that is rather trivial in other languages... and hoping for help on how to get around the restrictions/rules of Haskell. Maybe help on a different way of thinking..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1450109200, "post_id": 34270172, "comment_id": 56284583, "body": "Storing mutable values is not by itself a problem that needs to be solved, it is a tool to solve other, real-world problems. Haskell is a powerful tool to solve real-world problems, built upon mostly immutable values. Immutability is essential for it to work. Haskell can have mutability too (IORef, State monad), but it&#39;s an advanced topic and it is very much advised to learn the basics before trying to deal with mutability."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450117462, "post_id": 34270172, "comment_id": 56289673, "body": "If you are trying to learn Haskell, I would strongly suggest against trying to adapt knowledge from other languages to it. This path is likely to lead to very unidiomatic, hard-to-write code which can easily give you the impression that the language is cumbersome to use. This is not Haskell-specific: moving from any language X to another Y trying to shoehorn idioms from X into Y is very tempting, but rarely the right way."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1450119038, "post_id": 34270172, "comment_id": 56290545, "body": "@chi OTOH, there are still solutions that are expressed with a stateful context in a way that much more clearer and readable. Haskell is flexible enough to allow you provide a very scoped, narrow state solution which is much cleaner than what&#39;s provided by a lot of imperative languages anyway. I don&#39;t think avoiding representing, say, a chess board as a program state just for the sake of it is always worth it. It&#39;s exactly what you&#39;re trying to avoid, namely picking the solution before the problem. In principle, functions ending in <code>a -&gt; a</code> are isomorphic to <code>State a *</code> anyway."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1450121325, "post_id": 34270172, "comment_id": 56291900, "body": "@BartekBanachewicz Agreed: for some tasks, mutability is really the best solution. I am just concerned that learning how to express that in the beginning will lead to bad Haskell code."}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1450108272, "post_id": 34270510, "comment_id": 56283911, "body": "thanks.  This is helpful. The idea was to have a list that will track what set a certain item in an array belongs to. The <code>f x y</code> puts the item at y in the same set as x etc. So, am I correct in believing that the only pure way of doing it is to somehow chain my functions either directly or through <code>State</code>?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 1, "creation_date": 1450109068, "post_id": 34270510, "comment_id": 56284477, "body": "@matthias Pretty much yes. State is typically satisfactory though - there&#39;s a strict variant of it available, as well as the <code>StateT</code>  transformer. Other methods either use <code>IO</code> directly or via some safer wrapper (<code>ST</code> and <code>STM</code> would be notable examples of such)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1450118343, "post_id": 34270510, "comment_id": 56290162, "body": "I don&#39;t think you can change bindings in GHCi either; if I&#39;m not very much mistaken, you can only shadow them."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 3, "last_activity_date": 1450119481, "last_edit_date": 1450119481, "creation_date": 1450106272, "answer_id": 34270510, "question_id": 34270172, "link": "https://stackoverflow.com/questions/34270172/how-to-hold-a-list-mutable-values-in-haskell/34270510#34270510", "title": "How to hold a list mutable values in Haskell?", "body": "<p>All Haskell values are immutable. You can't change a value that's bound to a name (you can <em>shadow</em> them in GHCi, but that's a slightly different thing).</p>\n\n<p>If you want to achieve true<sup>1</sup> mutability, you need an immutable <em>reference</em> to mutable data. To use those, typically you'd want to be in a monadic context.</p>\n\n<p>Here's an example using a rather low-level reference type called <code>IORef</code>:</p>\n\n<pre><code>import Data.IORef\nimport Control.Monad\n\nf :: [Int] -&gt; [Int]\nf = map (+1)\n\nmain = do\n    a &lt;- newIORef [1,2,3,4,5]\n    readIORef a &gt;&gt;= print\n    readIORef a &gt;&gt;= (return . f) &gt;&gt;= writeIORef a\n    readIORef a &gt;&gt;= print\n</code></pre>\n\n<p>Note that the value of <code>a</code> doesn't change; it still points to the same \"value location\". What changes is the actual value that's being pointed to.</p>\n\n<hr>\n\n<p>That being said, this requires using the <code>IO</code> monad which is generally frowned upon. Depending on your needs, a fully pure solution like <code>State</code> might work better.</p>\n\n<pre><code>-- assume previous f\ng :: State [Int] ()\ng = modify f\n</code></pre>\n\n<p>Now you only need to start with some state, and the state monad will chain the modifications for you, like so:</p>\n\n<pre><code>main = print $ execState (g &gt;&gt; g &gt;&gt; g) [1,2,3,4,5]\n</code></pre>\n\n<p>This is essentially equivalent to simple composition:</p>\n\n<pre><code>f . f . f $ [1,2,3,4,5]\n</code></pre>\n\n<p>Which, last but not least, could be your default go-to solution in Haskell.</p>\n\n<hr>\n\n<p>P.S. I'm using a simpler <code>f</code> in my examples, but there's no reason you couldn't do:</p>\n\n<pre><code>(f 1 5) . (f 3 8) $ myArray\n</code></pre>\n\n<hr>\n\n<p><sup>1</sup>This is somewhat ambiguous, but for the sake of simplicity I'd expand this to \"the one that could be backed by direct memory operations\".</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1338, "favorite_count": 1, "accepted_answer_id": 34270510, "answer_count": 1, "score": 2, "last_activity_date": 1450119481, "creation_date": 1450105314, "last_edit_date": 1450112034, "question_id": 34270172, "link": "https://stackoverflow.com/questions/34270172/how-to-hold-a-list-mutable-values-in-haskell", "title": "How to hold a list mutable values in Haskell?", "body": "<p>I would like to have an array, say:</p>\n\n<p><code>myArray = [1,2,3,4,5,6,7,8,9]</code></p>\n\n<p>and be able to run a function that changes a value in the list to another value. I would like to be able to run this function several times with <code>myArray</code> updating to the new set of numbers after each run.</p>\n\n<pre><code>myArray = [1,2,3,4,5,6,7,8,9]\n&gt;&gt;&gt; f 1 5 myAarray \n&gt;&gt;&gt; myArray\n[1,2,3,4,1,6,7,8,9]\n&gt;&gt;&gt; f 3 8 myArray\n&gt;&gt;&gt; myArray\n[1,2,3,4,1,6,7,3,9]\n</code></pre>\n\n<p>How do I create a holder for my values that can have changing values.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "wxhaskell"], "answers": [{"tags": [], "owner": {"reputation": 109, "user_id": 5573696, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AoIOc.png?s=128&g=1", "display_name": "HJvT", "link": "https://stackoverflow.com/users/5573696/hjvt"}, "is_accepted": false, "score": 1, "last_activity_date": 1451774952, "creation_date": 1451774952, "answer_id": 34571519, "question_id": 34269114, "link": "https://stackoverflow.com/questions/34269114/wxhaskell-on-win7-cant-find-wxc-dll-or-so/34571519#34571519", "title": "wxHaskell on win7, can&#39;t find wxc.dll or .so", "body": "<p>This is a GHCi bug; it is solved in GHC 7.10.3</p>\n"}], "owner": {"reputation": 55, "user_id": 5393730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3becf0f6344162efa509f2b997b6a32?s=128&d=identicon&r=PG&f=1", "display_name": "zjyfdu", "link": "https://stackoverflow.com/users/5393730/zjyfdu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1451774952, "creation_date": 1450102340, "last_edit_date": 1450102605, "question_id": 34269114, "link": "https://stackoverflow.com/questions/34269114/wxhaskell-on-win7-cant-find-wxc-dll-or-so", "title": "wxHaskell on win7, can&#39;t find wxc.dll or .so", "body": "<p>I have installed wxwidget and wxhaskell(using cabal) on windows7\nand I made a test.hs</p>\n\n<pre><code>import Graphics.UI.WX\n\nmain :: IO ()\nmain = start gui\n\ngui :: IO ()\ngui = do f &lt;- frame [text := \"Hello\"]\n         inp &lt;- entry f []\n         out &lt;- entry f []\n         but &lt;- button f [ text := \"Hello\"\n                        , on command := do s &lt;- get inp text;\n                                           set out [text := \"Hello \"++s]\n                         ]\n         set f [ layout := floatCentre $ column 5\n                            [ label \"What is your name?\"\n                            , widget inp\n                            , widget but\n                            , widget out\n                            ] ]\n</code></pre>\n\n<p>and then I load and run test.hs in winGHCi, and here is output</p>\n\n<pre><code>\"ghci&gt; \" :load \"test.hs\"\n[1 of 1] Compiling Main             ( test.hs, interpreted )\nOk, modules loaded: Main.\n\"ghci&gt; \" main\ncan't load .so/.DLL for: C:\\Users\\zhaijy\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.10.2\\wxc-0.92.1.1-2q6ESjcRWaMHNPxrdblcRv\\wxc.dll (addDLL: could not load DLL)\n\"ghci&gt; \" \n</code></pre>\n\n<p>I can't figure out how to solve this problem. What do I need to do/add/change so the DLL could be loaded?</p>\n"}, {"tags": ["haskell", "webkit", "ghc", "webkitgtk", "ghcjs"], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1450101802, "creation_date": 1450097653, "last_edit_date": 1450101802, "question_id": 34267599, "link": "https://stackoverflow.com/questions/34267599/accessing-the-webkit-api-from-haskell-via-something-other-than-webkitgtk", "title": "Accessing the WebKit API from Haskell via something other than WebKitGTK", "body": "<p>I'm trying to understand if there is any other way to access the WebKit API directly from from a Haskell (<code>ghc-7.10.2</code> currently) program without having to go through something like <a href=\"https://hackage.haskell.org/package/webkitgtk3\" rel=\"nofollow\"><code>webkitgtk3</code></a>, which is a Haskell wrapper around <a href=\"http://webkitgtk.org\" rel=\"nofollow\">WebKitGTK</a>.</p>\n\n<p>It appears WebKitGTK does not expose the full WebKit API, for example these are offered by WebKit:</p>\n\n<ul>\n<li><a href=\"https://developer.apple.com/library/safari/documentation/WebKit/Reference/HTMLCanvasElementRef/\" rel=\"nofollow\"><code>HTMLCanvasElement</code> @ developer.apple.com</a></li>\n<li><a href=\"https://developer.apple.com/library/safari/documentation/WebKit/Reference/CanvasRenderingContext2DClassRef/\" rel=\"nofollow\"><code>CanvasRenderingContext2DClass</code> @ developer.apple.com</a></li>\n</ul>\n\n<p>but not by WebKitGTK:</p>\n\n<ul>\n<li><a href=\"http://webkitgtk.org/reference/webkitdomgtk/stable/WebKitDOMHTMLCanvasElement.html\" rel=\"nofollow\"><code>WebKitDOMHTMLCanvasElement</code> @ webkitgtk.org</a></li>\n</ul>\n\n<p>Is there any way to access the WebKit API of a running WebKit.app or Safari.app especially on OS X but also Linux and Windows?</p>\n\n<p><em>P.S. Some background to this: I'm developing an application using GHCJS, but since GHCJS is so much slower (and doesn't integrate with all Emacs IDE features, I think), I also want to be able to compile the same (or almost the same) code base using GHC. So I got familiar with <code>webkitgtk</code> and even spent several days trying to <a href=\"https://github.com/Homebrew/homebrew-versions/pull/1077\" rel=\"nofollow\">get <code>webkitgtk-2.4.9</code> to build on OS X via Homebrew</a>, because <code>webkitgtk3</code> only currently builds against <code>2.4.9</code>, only to find out that the nice and fully featured Canvas API which WebKit exposes is <a href=\"https://bugs.webkit.org/show_bug.cgi?id=152250\" rel=\"nofollow\">not at all available through WebKitGTK</a>. Hence the search for alternatives. And it is also for this reason I'm adding <a href=\"/questions/tagged/ghcjs\" class=\"post-tag\" title=\"show questions tagged &#39;ghcjs&#39;\" rel=\"tag\">ghcjs</a> \u2014 it is very likely that other users of GHCJS will find this post interesting.</em></p>\n"}, {"tags": ["c", "haskell", "archlinux", "haskell-stack"], "comments": [{"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1450224763, "post_id": 34267376, "comment_id": 56345761, "body": "Do you get the same error if you try to build with cabal instead of stack?"}, {"owner": {"reputation": 51, "user_id": 1252124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e36505541a02cc56e09ee22d581cc5?s=128&d=identicon&r=PG", "display_name": "LordMord", "link": "https://stackoverflow.com/users/1252124/lordmord"}, "reply_to_user": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1450254047, "post_id": 34267376, "comment_id": 56355578, "body": "@ghorn i haven&#39;t tried but switching to cabal is not really a solution for me."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 1252124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e36505541a02cc56e09ee22d581cc5?s=128&d=identicon&r=PG", "display_name": "LordMord", "link": "https://stackoverflow.com/users/1252124/lordmord"}, "reply_to_user": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1450254171, "post_id": 34283527, "comment_id": 56355640, "body": "@ghorn without knowing more about your setup i can&#39;t really help. Are you trying to include the same library?"}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1450273940, "post_id": 34283527, "comment_id": 56369203, "body": "I can reproduce the issue by making a trivial cabal package with the field &quot;extra-libraries:     HSrts-ghc7.10.3&quot;. Then &quot;cabal configure&quot; shows the error about missing library. I put such a cabal package on <a href=\"https://github.com/ghorn/no-rts\" rel=\"nofollow noreferrer\">github.com/ghorn/no-rts</a>. I&#39;m on debian unstable."}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1450362641, "post_id": 34283527, "comment_id": 56415365, "body": "I couldn&#39;t fix the issue, but I get around it by building my project without the HSrts-ghc7.10.2, and then externally I call ghc to create a new shared library where I use -lHSrts-ghc7.10.2. I&#39;m not sure why your workaround didn&#39;t work for me because they should be identical."}], "tags": [], "owner": {"reputation": 51, "user_id": 1252124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e36505541a02cc56e09ee22d581cc5?s=128&d=identicon&r=PG", "display_name": "LordMord", "link": "https://stackoverflow.com/users/1252124/lordmord"}, "is_accepted": false, "score": 1, "last_activity_date": 1450254280, "last_edit_date": 1450254280, "creation_date": 1450165357, "answer_id": 34283527, "question_id": 34267376, "link": "https://stackoverflow.com/questions/34267376/haskell-missing-c-library-on-arch-linux-works-on-ubuntu/34283527#34283527", "title": "Haskell: Missing C library on Arch Linux works on Ubuntu", "body": "<p>Okay i figured out a workaround, instead of specifiyc the library in the .cabal file:</p>\n\n<pre><code>...  \nextra-libraries: HSrts-ghc7.10.2   \n...\n</code></pre>\n\n<p>you add it to your stack.yaml file:</p>\n\n<pre><code>...\nghc-options:\n    package-name: -lHSrts-ghc7.10.2\n...\n</code></pre>\n\n<p>If you also have a exectuable defined in your .cabal file this will break the executable, since the library is not only included in the library. And including the runtime library in an executable results in an instant segementation fault.</p>\n"}], "owner": {"reputation": 51, "user_id": 1252124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e36505541a02cc56e09ee22d581cc5?s=128&d=identicon&r=PG", "display_name": "LordMord", "link": "https://stackoverflow.com/users/1252124/lordmord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1450254280, "creation_date": 1450097002, "last_edit_date": 1450097069, "question_id": 34267376, "link": "https://stackoverflow.com/questions/34267376/haskell-missing-c-library-on-arch-linux-works-on-ubuntu", "title": "Haskell: Missing C library on Arch Linux works on Ubuntu", "body": "<p>I recently switched my PC at work from <code>Ubuntu</code> to <code>Arch Linux</code>.\nAnd I am now getting the following error (I am using stack to build my project): </p>\n\n<blockquote>\n  <p>setup-Simple-Cabal-1.22.4.0-ghc-7.10.2: Missing dependency on a\n  foreign\n      library:<br>\n      * Missing C library: HSrts-ghc7.10.2<br>\n      This problem can usually be solved by installing the system package that\n      provides this library (you may need the \"-dev\" version). If the library is\n      already installed but in a non-standard location then you can use the flags\n      --extra-include-dirs= and --extra-lib-dirs= to specify where it is.</p>\n</blockquote>\n\n<p>As far as I understand it, the difference in Linux Distribution should not cause any issue.</p>\n\n<p>Things I have tried:<br>\n-add the path where the library is with --extra-lib-dirs<br>\n-make sure that the version of stack/ghc are the same acrose both systems<br>\n-tried unsucesfully to find a relevant difference between the 2 systems<br>\n(gcc version was different but didn't change anything)</p>\n\n<p>I have a docker container based on ubutu where it builds without an issue.</p>\n\n<p>The only thing I can think of is that this library gets handled differently from some random C-library since it contains the Haskell-Runtime. But I have no idea what this difference would be. Or how a differnent handling would cause an issue on my Arch System.</p>\n\n<p>Here my .cabal file (the folder also contains the whole project):\n<a href=\"https://github.com/opencog/atomspace/blob/master/tests/haskell/libExecutionOutputTest/opencoglib.cabal\" rel=\"nofollow\">https://github.com/opencog/atomspace/blob/master/tests/haskell/libExecutionOutputTest/opencoglib.cabal</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1450096958, "post_id": 34266962, "comment_id": 56275743, "body": "Map is a confusing variable name here. It is not the map function."}, {"owner": {"reputation": 4915, "user_id": 181783, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1fb6e1466afe620716fcdd839fe54bba?s=128&d=identicon&r=PG", "display_name": "Olumide", "link": "https://stackoverflow.com/users/181783/olumide"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1450097030, "post_id": 34266962, "comment_id": 56275800, "body": "So <code>map</code> is the value?"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1450097504, "post_id": 34266962, "comment_id": 56276121, "body": "Yes, a <code>LockerMap</code> value"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1450097307, "creation_date": 1450097307, "answer_id": 34267475, "question_id": 34266962, "link": "https://stackoverflow.com/questions/34266962/understanding-haskell-map-lookup-example-in-lyh/34267475#34267475", "title": "Understanding Haskell Map.lookup (Example in LYH)", "body": "<p>There's no \"additional\" <code>map</code> (as in <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>) in that code. It gets more clear if we rename <code>map</code> to <code>m</code>:</p>\n\n<pre><code>lockerLookup :: Int -&gt; LockerMap -&gt; Either String Code  \nlockerLookup lockerNumber m =   \n    case Map.lookup lockerNumber m of   \n      -- snip\n</code></pre>\n\n<p>Now you just need to remember that <code>Map.lookup</code> has type <code>Ord k =&gt; k -&gt; Map k a -&gt; Maybe a</code> and therefore you need to supply a <code>Map</code>. Luckily, the second argument (<code>m</code>) is a <code>LockerMap</code>, which is the same as <code>Map Int (LockerState, Code)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 4915, "user_id": 181783, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1fb6e1466afe620716fcdd839fe54bba?s=128&d=identicon&r=PG", "display_name": "Olumide", "link": "https://stackoverflow.com/users/181783/olumide"}, "edited": false, "score": 0, "creation_date": 1450111495, "post_id": 34267502, "comment_id": 56286193, "body": "So <code>lockerNumber</code> in <code>case Map.lookup lockerNumber map</code> is a type! I thought &quot;Type synonyms (and types generally) can only be used in the type portion of Haskell&quot; (I&#39;m quoting the book here)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4915, "user_id": 181783, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1fb6e1466afe620716fcdd839fe54bba?s=128&d=identicon&r=PG", "display_name": "Olumide", "link": "https://stackoverflow.com/users/181783/olumide"}, "edited": false, "score": 0, "creation_date": 1450116883, "post_id": 34267502, "comment_id": 56289357, "body": "@Olumide No, <code>lockerNumber</code> is a value of the type &quot;keys in the map&quot;, which above I called <code>someKeyType</code>."}, {"owner": {"reputation": 4915, "user_id": 181783, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1fb6e1466afe620716fcdd839fe54bba?s=128&d=identicon&r=PG", "display_name": "Olumide", "link": "https://stackoverflow.com/users/181783/olumide"}, "edited": false, "score": 0, "creation_date": 1450117083, "post_id": 34267502, "comment_id": 56289453, "body": "Oops . I was confusing <code>LockerMap</code> for <code>lockerMap</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1450097387, "creation_date": 1450097387, "answer_id": 34267502, "question_id": 34266962, "link": "https://stackoverflow.com/questions/34266962/understanding-haskell-map-lookup-example-in-lyh/34267502#34267502", "title": "Understanding Haskell Map.lookup (Example in LYH)", "body": "<p>Briefly put, here <code>map</code> is a variable of type <code>LockerMap</code>, which I assume to be of the form <code>Data.Map.Map someKeyType someValueType</code>. It represents a (finite) association between elements of <code>someKeyType</code> and those of <code>someValueType</code>. This is sometimes also called a (finite) mapping, (finite) function, dictionary, hash, etc.</p>\n\n<p>The expression <code>Map.lookup x map</code> simply accesses the <code>map</code> with key value <code>x</code>. The result is <code>Nothing</code> is there is no association for <code>x</code> in the <code>map</code>, and <code>Just v</code> if <code>x</code> is associated with value <code>v</code>.</p>\n"}], "owner": {"reputation": 4915, "user_id": 181783, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1fb6e1466afe620716fcdd839fe54bba?s=128&d=identicon&r=PG", "display_name": "Olumide", "link": "https://stackoverflow.com/users/181783/olumide"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1897, "favorite_count": 1, "accepted_answer_id": 34267502, "answer_count": 2, "score": 1, "last_activity_date": 1450097387, "creation_date": 1450095734, "question_id": 34266962, "link": "https://stackoverflow.com/questions/34266962/understanding-haskell-map-lookup-example-in-lyh", "title": "Understanding Haskell Map.lookup (Example in LYH)", "body": "<p>I'd appreciate help understanding the origin of the extra <code>map</code> in <code>Map.lookup lockerNumber map</code>, from the following example taken from chapter 8 of <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#type-synonyms\" rel=\"nofollow\">Learn You a Haskell for Great Good</a></p>\n\n<pre><code>lockerLookup :: Int -&gt; LockerMap -&gt; Either String Code  \nlockerLookup lockerNumber map =   \n    case Map.lookup lockerNumber map of   \n        Nothing -&gt; Left $ \"Locker number \" ++ show lockerNumber ++ \" doesn't exist!\"  \n        Just (state, code) -&gt; if state /= Taken   \n                                then Right code  \n                                else Left $ \"Locker \" ++ show lockerNumber ++ \" is already taken!\"  \n</code></pre>\n"}, {"tags": ["xml", "haskell", "xml-conduit"], "answers": [{"tags": [], "owner": {"reputation": 1596, "user_id": 5483583, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/58e00258c68a02aeb27dd3bb73728821?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian Schmitthenner", "link": "https://stackoverflow.com/users/5483583/fabian-schmitthenner"}, "is_accepted": true, "score": 1, "last_activity_date": 1450142155, "last_edit_date": 1450142155, "creation_date": 1450141290, "answer_id": 34279344, "question_id": 34266662, "link": "https://stackoverflow.com/questions/34266662/xml-conduit-parse-xml-attributes/34279344#34279344", "title": "xml-conduit parse xml attributes", "body": "<p>Citing <code>Text.XML.Name</code>:</p>\n\n<blockquote>\n  <p>Prefixes are not semantically important; they are included only to simplify pass-through parsing. When comparing names with Eq or Ord methods, prefixes are ignored.</p>\n</blockquote>\n\n<p>The semantic difference lies in the namespace, so the following solves your problem:</p>\n\n<pre><code>test :: [Text]\ntest =[\"&lt;Root xmlns:is=\\\"http://example.com\\\" xmlns:not=\\\"http://example.com/2\\\"\"\n      ,  \"here    = \\\"ok\\\"\"\n      ,  \"is:here = \\\"ok\\\"\"\n      ,  \"not:here=\\\"nok\\\"&gt;\"\n      ,\"&lt;/Root&gt;\"]\n</code></pre>\n\n<p>This also makes sense, because we could name the same namespace differently in different places, but it should still be the same. I think it's also no valid XML to use prefixes without associating namespaces to them.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 1, "accepted_answer_id": 34279344, "answer_count": 1, "score": 0, "last_activity_date": 1450142155, "creation_date": 1450094796, "question_id": 34266662, "link": "https://stackoverflow.com/questions/34266662/xml-conduit-parse-xml-attributes", "title": "xml-conduit parse xml attributes", "body": "<p>Parsing XML with <code>xml-conduit</code> I stumbled upon the following problem: when I have multiple attributes, with the same base name but different prefixes only the first in (lexical) order.</p>\n\n<h2>How can I get the prefixed values if both a prefixed and non-prefixed version of an attribute is present?</h2>\n\n<p>Minimal non-working example:</p>\n\n<p><code>Main.hs</code></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport           Data.Text.Lazy (Text)\nimport qualified Data.Text.Lazy as T\nimport           Text.XML (parseText, def, elementAttributes, documentRoot)\nimport           Data.List (splitAt, drop)\n\nmain :: IO ()\nmain = do\n  putStrLn \"Example1: only the first element is parsed\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines test)\n  putStrLn \"Example2: this behaviour is independent of both having a prefix\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines $ dropAt 1 test)\n  putStrLn \"Example3: also no difference if there is just one attribute with prefix\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines $ dropAt 2 test)\n  putStrLn \"Example4: on its own the last element can be parsed\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines $ dropAt 1 $ dropAt 1 test)\n  putStrLn \"===============\"\n  putStrLn \"Example1: it is always the first element parsed\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines test2)\n  putStrLn \"Example2: really just the first\"\n  putStrLn \"========\\n\"\n  print $ elementAttributes . documentRoot &lt;$&gt; parseText def (T.unlines $ dropAt 1 test2)\n\n\ntest :: [Text]\ntest =[\"&lt;Root\"\n      ,  \"here    = \\\"ok\\\"\"\n      ,  \"is:here = \\\"ok\\\"\"\n      ,  \"not:here=\\\"nok\\\"&gt;\"\n      ,\"&lt;/Root&gt;\"]\n\ntest2 :: [Text]\ntest2 =[\"&lt;Root\"\n       ,  \"is:here = \\\"ok\\\"\"\n       ,  \"here    = \\\"ok\\\"\"\n       ,  \"not:here=\\\"nok\\\"&gt;\"\n       ,\"&lt;/Root&gt;\"]\n\ndropAt :: Int -&gt; [a] -&gt; [a]\ndropAt i xs = let (hd,tl) = splitAt i xs\n              in hd ++ drop 1 tl\n</code></pre>\n\n<p><code>attr.cabal</code></p>\n\n<pre><code>build-depends: base &gt;= 4.7 &amp;&amp; &lt; 5\n             , xml-conduit\n             , text\n\n&gt; stack exec attr\nExample1: only the first element is parsed\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Nothing},\"ok\")])\nExample2: this behaviour is independent of both having a prefix\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Just \"is\"},\"ok\")])\nExample3: also no difference if there is just one attribute with prefix\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Nothing},\"ok\")])\nExample4: on its own the last element can be parsed\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Just \"not\"},\"nok\")])\n===============\nExample1: only the first element is parsed\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Just \"is\"},\"ok\")])\nExample2: this behaviour is independent of both having a prefix\n========\n\nRight (fromList [(Name {nameLocalName = \"here\", nameNamespace = Nothing, namePrefix = Nothing},\"ok\")])\n</code></pre>\n"}, {"tags": ["image", "haskell", "x11"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450100358, "post_id": 34266021, "comment_id": 56278073, "body": "DRAWABLE abstracts X11 drawables (a drawable is almost the same as a window). Use MkDRAWABLE  to wrap a window ID. MkDRAWABLE  is just a newtype constructor, what kind of info you need about it?"}, {"owner": {"reputation": 77, "user_id": 3781700, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc10b25735b55e980649ca1abd6bc261?s=128&d=identicon&r=PG&f=1", "display_name": "Obrazi", "link": "https://stackoverflow.com/users/3781700/obrazi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450102369, "post_id": 34266021, "comment_id": 56279425, "body": "Where is it defined? I think I saw that it was in Graphics.XHB.Shared, but when I try to import it, ghc says it&#39;s part of the hidden package `xhb-0.6.2015.8.1&#39;"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450103544, "post_id": 34266021, "comment_id": 56280221, "body": "Not Graphics.XHB.Gen.Xproto?"}, {"owner": {"reputation": 77, "user_id": 3781700, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc10b25735b55e980649ca1abd6bc261?s=128&d=identicon&r=PG&f=1", "display_name": "Obrazi", "link": "https://stackoverflow.com/users/3781700/obrazi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450104486, "post_id": 34266021, "comment_id": 56280953, "body": "No it isn&#39;t in there."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450105371, "post_id": 34266021, "comment_id": 56281670, "body": "Hm, looks like it&#39;s not exported. But because DRAWABLE is XidLike, it looks like you can use fromXid instead."}, {"owner": {"reputation": 77, "user_id": 3781700, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc10b25735b55e980649ca1abd6bc261?s=128&d=identicon&r=PG&f=1", "display_name": "Obrazi", "link": "https://stackoverflow.com/users/3781700/obrazi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450107310, "post_id": 34266021, "comment_id": 56283165, "body": "So what I need to do is get the id of the window and call fromXid on it? Any idea how I&#39;d get a window ID with this package?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1450107852, "post_id": 34266021, "comment_id": 56283590, "body": "Normally if you want a shot of the entire screen you use the root window (<code>getRoot :: Connection -&gt; WINDOW</code>). WINDOW is also XidLike so you can <code>toXid</code> it. If you need a shot of a specific window you have to identify that window somehow. Normally this involves some simple GUI that allows the user to click on a window."}, {"owner": {"reputation": 77, "user_id": 3781700, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc10b25735b55e980649ca1abd6bc261?s=128&d=identicon&r=PG&f=1", "display_name": "Obrazi", "link": "https://stackoverflow.com/users/3781700/obrazi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1450108031, "post_id": 34266021, "comment_id": 56283727, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/97878/discussion-between-obrazi-and-n-m\">continue this discussion in chat</a>."}], "owner": {"reputation": 77, "user_id": 3781700, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc10b25735b55e980649ca1abd6bc261?s=128&d=identicon&r=PG&f=1", "display_name": "Obrazi", "link": "https://stackoverflow.com/users/3781700/obrazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1450093180, "creation_date": 1450092861, "last_edit_date": 1450093180, "question_id": 34266021, "link": "https://stackoverflow.com/questions/34266021/haskell-x-screenshot-program", "title": "Haskell X Screenshot Program", "body": "<p>I'm trying to make a program that will get me some data structure that contains the pixels currently on screen. I tried to compile <a href=\"https://github.com/xmonad/X11/blob/656104ca552d830562595fa75ff252b54147c16a/examples/ScreenCapture.hs\" rel=\"nofollow\">This example I found on google</a>, but ghc complained that <em>X.getImage</em> isn't in scope. I checked the library on hackage and it doesn't seem to contain a function by that name. But I did find a function by that name in <a href=\"http://hackage.haskell.org/package/xhb\" rel=\"nofollow\">The xhb package</a>.</p>\n\n<pre><code>getImage :: Connection -&gt; GetImage -&gt; IO (Receipt GetImageReply)\n</code></pre>\n\n<p>So it takes a Connection and a <em>GetImage</em>. I looked up the type and it has a constructor <em>MkGetImage</em></p>\n\n<pre><code>MkGetImage\n    format_getImage :: ImageFormat\n    drawable_getImage :: DRAWABLE\n    x_getImage :: Int16\n    y_getImage :: Int16\n    width_getImage :: Word16\n    height_getImage :: Word16\n    plane_mask_GetImage :: Word32    \n</code></pre>\n\n<p>Most of these look familiar from the man page of <em>xgetimage</em>, but I'd never seen <em>DRAWABLE</em> before. Looking in the source on hackage, I find</p>\n\n<pre><code>newtype DRAWABLE = MkDRAWABLE Xid\n</code></pre>\n\n<p>Now this <em>MkDRAWABLE</em> I can't find any info on whatsoever.</p>\n\n<p>I just want to get the pixels on the screen or in some range. It doesn't have to be with a particular library. But if anyone knows how to get this to work that would be great. </p>\n"}, {"tags": ["haskell", "existential-type", "gadt", "data-kinds"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1450070651, "post_id": 34259724, "comment_id": 56261970, "body": "You have no heterogeneous collections - the type <code>Box</code> is useless. You cannot do anything with the value inside, other than call <code>seq</code> on it I guess.. It seems this question is not about heterogeneous collections in Haskell per se, but modelling a type system in Haskell which supports heterogeneous collections. However, if you mean &quot;dynamic&quot; as in &quot;dynamically typed&quot;, then it doesn&#39;t make sense for the representation of a dynamically typed language to statically typed in the meta-language (Haskell)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450073273, "post_id": 34259724, "comment_id": 56262834, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28388715/list-of-any-datakind-in-gadt/\">List of any <code>DataKind</code> in GADT</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1450188629, "post_id": 34269430, "comment_id": 56324074, "body": "Since there is a dog anyway, we can write <code>gimme :: TypeMe t =&gt; Cell -&gt; Maybe t</code>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1450206574, "post_id": 34269430, "comment_id": 56336436, "body": "@user3237465 Yes. Of course both explicit Type t -&gt; and implicit TypeMe t =&gt; versions exist. It&#39;s not obvious to me that implicit is better than explicit in this respect. But it&#39;s certainly good to be light on our feet when choosing the variant we want. It&#39;s often good to write an explicit worker, then expose an implicit wrapper."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 6, "last_activity_date": 1450103331, "creation_date": 1450103331, "answer_id": 34269430, "question_id": 34259724, "link": "https://stackoverflow.com/questions/34259724/how-to-specify-the-type-for-a-heterogenous-collection-in-a-gadt-formulated-ast/34269430#34269430", "title": "How to specify the type for a heterogenous collection in a GADT formulated AST?", "body": "<p>One way to approach this problem is to tag values with run-time type representatives. I'm channelling Stephanie Weirich, here. Let's have a small example. First, give a representation to some types. That's typically done with a <em>singleton</em> construction.</p>\n\n<pre><code>data Type :: * -&gt; * where\n  Int   :: Type Int\n  Char  :: Type Char\n  List  :: Type x -&gt; Type [x]\n</code></pre>\n\n<p>So <code>Type Int</code> contains one value, which I've also called <code>Int</code>, because it acts as the run-time representative of the type <code>Int</code>. If you can see colour even in monochrome things, the <code>Int</code> left of the <code>::</code> is red, and the <code>Int</code> after <code>Type</code> is blue.</p>\n\n<p>Now we can do existential packaging, preserving utility.</p>\n\n<pre><code>data Cell :: * where\n (:::) :: x -&gt; Type x -&gt; Cell\n</code></pre>\n\n<p>A <code>Cell</code> is a value tagged with a run-time representative of its type. You can recover the utility of the value by reading its type tag. Indeed, as types are first-order structures, we can check them for equality in a useful way.</p>\n\n<pre><code>data EQ :: k -&gt; k -&gt; * where\n  Refl :: EQ x x\n\ntypeEQ :: Type x -&gt; Type y -&gt; Maybe (EQ x y)\ntypeEQ Int Int = Just Refl\ntypeEQ Char Char = Just Refl\ntypeEQ (List s) (List t) = case typeEQ s t of\n  Just Refl -&gt; Just Refl\n  Nothing -&gt; Nothing\ntypeEQ _ _ = Nothing\n</code></pre>\n\n<p>A Boolean equality on type representatives is no use: we need the equality test to construct the <em>evidence</em> that the represented types can be unified. With the evidence-producing test, we can write</p>\n\n<pre><code>gimme :: Type x -&gt; Cell -&gt; Maybe x\ngimme t (x ::: s) = case typeEQ s t of\n  Just Refl -&gt; Just x\n  Nothing   -&gt; Nothing\n</code></pre>\n\n<p>Of course, writing the type tags is a nuisance. But why keep a dog and bark yourself?</p>\n\n<pre><code>class TypeMe x where\n  myType :: Type x\n\ninstance TypeMe Int where\n  myType = Int\n\ninstance TypeMe Char where\n  myType = Char\n\ninstance TypeMe x =&gt; TypeMe [x] where\n  myType = List myType\n\ncell :: TypeMe x =&gt; x -&gt; Cell\ncell x = x ::: myType\n</code></pre>\n\n<p>And now we can do things like</p>\n\n<pre><code>myCells :: [Cell]\nmyCells = [cell (length \"foo\"), cell \"foo\"]\n</code></pre>\n\n<p>and then get</p>\n\n<pre><code>&gt; gimme Int (head myCells)\nJust 3\n</code></pre>\n\n<p>Of course, it would all be so much tidier if we didn't have to do the singleton construction and could just pattern-match on such types as we might choose to retain at run-time. I expect we'll get there when the mythical <code>pi</code> quantifier becomes less mythical.</p>\n"}], "owner": {"reputation": 3471, "user_id": 314318, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e0ed39dc4ab81e6c35f2681503b7c62a?s=128&d=identicon&r=PG", "display_name": "troutwine", "link": "https://stackoverflow.com/users/314318/troutwine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 2, "accepted_answer_id": 34269430, "answer_count": 1, "score": 6, "last_activity_date": 1450103331, "creation_date": 1450066876, "question_id": 34259724, "link": "https://stackoverflow.com/questions/34259724/how-to-specify-the-type-for-a-heterogenous-collection-in-a-gadt-formulated-ast", "title": "How to specify the type for a heterogenous collection in a GADT formulated AST?", "body": "<p>I'd like to make a typed AST for a dynamic language. At present, I'm stuck on handling collections. Here's a representative code sample:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\ndata Box = forall s. B s\n\ndata BinOp = Add | Sub | Mul | Div\n             deriving (Eq, Show)\n\ndata Flag = Empty | NonEmpty\n\ndata List :: Flag -&gt; * -&gt; * where\n    Nil :: List Empty a\n    Cons :: a -&gt; List f a -&gt; List NonEmpty a\n\ndata Expr ty where\n    EInt :: Integer -&gt; Expr Integer\n    EDouble :: Double -&gt; Expr Double\n--    EList :: List -&gt; Expr List\n</code></pre>\n\n<p>While I can construct instances of <code>List</code> well enough:</p>\n\n<pre><code>*Main&gt; :t (Cons (B (EInt 1)) (Cons (B (EDouble 2.0)) Nil))\n(Cons (B (EInt 1)) (Cons (B (EDouble 2.0)) Nil))\n  :: List Box 'NonEmpty\n</code></pre>\n\n<p>I'm not at all sure how to encode this type in <code>Expr</code> for <code>EList</code>. Am I even on the right path here? </p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1450059607, "post_id": 34258637, "comment_id": 56259128, "body": "Thanks luqui.  Can you implement == or elem in Haskell so I can see how it would relate to the type signature? To me (a Haskell newbie), it seems that elem is a function that takes two arguments, rather than one that returns another function."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 2, "creation_date": 1450076958, "post_id": 34258637, "comment_id": 56264310, "body": "@Boon Indeed it is a two-argument function, but because of the currying you mention, that&#39;s the same as a function returning a function! Consider <code>f x y = x + y</code> - this is the same as <code>g x = (\\y -&gt; x + y)</code>, really. Likewise <code>elem</code> can&#39;t do anything useful with one argument, so instead it returns a new function that needs to be given its &quot;second&quot; argument."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 7, "last_activity_date": 1450058129, "creation_date": 1450058129, "answer_id": 34258637, "question_id": 34258501, "link": "https://stackoverflow.com/questions/34258501/haskell-type-signature-for-and-elem/34258637#34258637", "title": "Haskell type signature for == and elem", "body": "<p>Yes, operators are curried.  Let's ignore the contexts for a second (the part of the type before <code>=&gt;</code>).</p>\n\n<pre><code>(==) :: a -&gt; a -&gt; Bool\n</code></pre>\n\n<p><code>(-&gt;)</code> associates to the right, so this means:</p>\n\n<pre><code>(==) :: a -&gt; (a -&gt; Bool)\n</code></pre>\n\n<p>That is, it's a function which, given an <code>a</code>, returns another function, which in turn takes an <code>a</code> and gives a <code>Bool</code>.  It returns the function which is only true when its argument is equal to the first <code>a</code>.</p>\n\n<p>(We will set <code>NoMonomorphismRestriction</code> because otherwise it will just be extra confusing for no good reason)</p>\n\n<pre><code>ghci&gt; :set -XNoMonomorphismRestriction\nghci&gt; let f = (==) 1\nghci&gt; f 1\nTrue\nghci&gt; f 2\nFalse\n-- or just\nghci&gt; (==) 1 2\nFalse\n</code></pre>\n\n<p>The part before the (<code>=&gt;</code>) puts constraints on types. <code>Eq a</code> means that <code>a</code> must be a type that supports equality.</p>\n\n<p>As for the <code>t</code> in <code>elem</code>, that might be a bit advanced for you to understand fully right now. I'll give you a little bit.  Because of the context</p>\n\n<pre><code>(Eq a, Foldable t) =&gt; ...\n</code></pre>\n\n<p>we know that <code>t</code> has to be <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html\" rel=\"noreferrer\"><code>Foldable</code></a>.  Lists are foldable, and foldable doesn't mean much more than \"has a <code>toList</code> method\".  So you can read <code>elem</code> as:</p>\n\n<pre><code>elem :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>and in general, when you see a foldable type, just pretend it's a list.</p>\n"}], "owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "accepted_answer_id": 34258637, "answer_count": 1, "score": 3, "last_activity_date": 1450058256, "creation_date": 1450056659, "last_edit_date": 1450057394, "question_id": 34258501, "link": "https://stackoverflow.com/questions/34258501/haskell-type-signature-for-and-elem", "title": "Haskell type signature for == and elem", "body": "<p>In GHCi, doing the following yield:</p>\n\n<pre><code>:t (==) \n\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>or</p>\n\n<pre><code>:t elem\n\nelem :: (Eq a, Foldable t) =&gt; a -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>I am confused with the arrow going from a to a, and then a to Bool.\nIs it because == or elem is a curried function?</p>\n\n<p>The type signature for elem is very similar to ==, except for the additional t.  What does <code>t a</code> in <code>:t elem</code> mean?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1450147124, "last_edit_date": 1450147124, "creation_date": 1450066327, "answer_id": 34259646, "question_id": 34257148, "link": "https://stackoverflow.com/questions/34257148/how-to-detect-last-chunk-in-a-haskell-pipe/34259646#34259646", "title": "How to detect last chunk in a Haskell Pipe?", "body": "<p>I was able to get this to work by changing <code>counterPipe</code>'s input type to <code>Maybe String</code> and injecting an extra <code>Nothing</code> after the upstream pipe finishes:</p>\n\n<pre><code>import Pipes\nimport Pipes.Core (respond)\nimport Control.Applicative ((&lt;*))\n\nwithEOF :: (Monad m) =&gt; Proxy a' a b' b m r -&gt; Proxy a' a b' (Maybe b) m r\nwithEOF p = for p (respond . Just) &lt;* respond Nothing\n\ncounterPipe :: Pipe (Maybe String) String IO Int\ncounterPipe = go 0\n  where\n    go n = do\n        mx &lt;- await\n\n        case mx of\n            Just x -&gt; do\n                yield x\n                let n' = succ n\n                liftIO $ putStrLn $ \"Chunk \" ++ show n'\n                go n'\n            Nothing -&gt; do\n                return n\n\nfinishCounter :: Int -&gt; Pipe a b IO ()\nfinishCounter n = liftIO $ putStrLn $ unwords [\"Finished after\", show n, \"chunks\"]\n</code></pre>\n\n<p>Example driver:</p>\n\n<pre><code>import qualified Pipes.Prelude as P\nmain = runEffect $ withEOF P.stdinLn &gt;-&gt; (counterPipe &gt;&gt;= finishCounter) &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>I think this pattern should be abstractable into something like</p>\n\n<pre><code>whileJust :: (Monad m) =&gt; Proxy a' a b' b m r -&gt; Proxy a' (Maybe a) b' b m (Maybe r)\n</code></pre>\n\n<p>so you could write</p>\n\n<pre><code>withEOF P.stdinLn &gt;-&gt; (whileJust counterPipe &gt;&gt;= maybe (return ()) finishCounter) &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>without having to change your original <code>counterPipe</code> definition;\nbut I've never used <code>Pipes</code> before (the above solution was figured out by just looking at the types and playing type-domino) and so I haven't managed to write <code>whileJust</code> (the signature is probably too generic in ways that I cannot figure out).</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 2, "accepted_answer_id": 34259646, "answer_count": 1, "score": 8, "last_activity_date": 1450147124, "creation_date": 1450045662, "last_edit_date": 1450045917, "question_id": 34257148, "link": "https://stackoverflow.com/questions/34257148/how-to-detect-last-chunk-in-a-haskell-pipe", "title": "How to detect last chunk in a Haskell Pipe?", "body": "<p>I have a small Haskell <code>Pipe</code> that prints out how many times it has run:</p>\n\n<pre><code>counterPipe :: Pipe String String IO r\ncounterPipe = go 0\n  where\n    go n = do\n      await &gt;&gt;= yield\n      let n' = succ n\n      liftIO $ putStrLn $ \"Chunk \" ++ show n'\n      go n'\n</code></pre>\n\n<p>I'd like to be able to print out a message, and potentially perform other tasks, once it has processed the last chunk. How do I go about doing this?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450042938, "post_id": 34256013, "comment_id": 56255049, "body": "Avoiding package dependencies isn&#39;t just a performance issue, it&#39;s about avoiding conflicts with other packages which might have dependencies on different version of the library."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450044759, "post_id": 34256013, "comment_id": 56255631, "body": "@AlexeyRomanov: sure, but in case of dependency conflicts an orphan-instance module probably won&#39;t help either."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450051850, "post_id": 34256013, "comment_id": 56257550, "body": "@leftaroundabout It may help if that module isn&#39;t exposed -- e.g. if it is used only internally in a test suite, which looks likely considering the explicit discussion of quickcheck in the question."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1450074529, "post_id": 34256013, "comment_id": 56263308, "body": "@leftaroundabout It can also help because you can not include the orphan instance module and just define the same instance yourself. (Of course, this only works if 1) you have an application, not a library, and nobody depends on <i>your</i> package; 2) you don&#39;t have any dependencies which themselves use the orphan-instance module.)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1450038828, "creation_date": 1450038828, "answer_id": 34256013, "question_id": 34255835, "link": "https://stackoverflow.com/questions/34255835/instance-declarations-of-uncommon-typeclasses-in-extra-module/34256013#34256013", "title": "Instance declarations of uncommon typeclasses in extra module", "body": "<p>It's generally a good idea to avoid orphan instances: those are always good for surprises, and rather hard to find.</p>\n\n<p>So, yes, put the instance in the module where <code>Tree</code> is defined. This blows up the module a bit, but it shouldn't really be an issue. Of the total build time of the whole package it shouldn't matter much if you have one larger module or two smaller ones.</p>\n\n<p>When you can completely avoid a package dependency, this might make an orphan instance worthwhile, because installing a package is obviously a much greater performance issue than importing a module from an installed package.</p>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 34256013, "answer_count": 1, "score": 1, "last_activity_date": 1450045286, "creation_date": 1450037796, "last_edit_date": 1450045286, "question_id": 34255835, "link": "https://stackoverflow.com/questions/34255835/instance-declarations-of-uncommon-typeclasses-in-extra-module", "title": "Instance declarations of uncommon typeclasses in extra module", "body": "<p>Is it good style to put the instance declarations for uncommon typeclasses in extra modules?</p>\n\n<p>As an example I have this simple tree type:</p>\n\n<pre><code>module Data.Tree where\n\ndata Tree a = Leaf a\n            | Node (Tree a) (Tree a)\n</code></pre>\n\n<p>Suppose I want to use QuickCheck's <code>Arbitrary</code> typeclass to generate random values of type <code>Tree</code> (and be able to use them not only in tests).</p>\n\n<p>What is best? To put them in the same module where <code>Tree</code> is defined</p>\n\n<pre><code>module Data.Tree where\n\nimport QuickCheck.Arbitrary\n\ndata Tree a = ...\n\ninstance Arbitrary a =&gt; Arbitrary (Tree a) where\n    ...\n</code></pre>\n\n<p>or to outsource the instance declaration to another module to avoid the dependency to <code>QuickCheck.Arbitrary</code> in <code>Data.Tree</code></p>\n\n<pre><code>module Data.Tree.Arbitrary where\n\nimport Data.Tree\nimport QuickCheck.Arbitrary\n\ninstance Arbitrary a =&gt; Arbitrary (Tree a) where\n    ...\n</code></pre>\n\n<p>or something else entirely?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1450110402, "post_id": 34254738, "comment_id": 56285427, "body": "Note that your (first) code only compiles because <code>[]</code> is a monad. If you tried to do the same thing with <code>l2</code> being, say, an <code>Int</code>, it would complain about a missing <code>Monad</code> instance. Because of the way the list monad is defined, your first code is equivalent to <code>concatMap (\\_ -&gt; concatMap (\\_ -&gt; l2) (if l &#47;= something2 then (l2++something2) else l2)) (if l &#47;= something then (l2++something) else l2)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 3, "last_activity_date": 1450033121, "last_edit_date": 1495540763, "creation_date": 1450032616, "answer_id": 34254932, "question_id": 34254738, "link": "https://stackoverflow.com/questions/34254738/haskell-combining-do-and-if/34254932#34254932", "title": "Haskell, combining Do and if", "body": "<p>Just put the <code>if</code> clause in the <code>let</code> statement:</p>\n\n<pre><code>doIfFunction :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\ndoIfFunction l1 l2 = do\n    let l2'  = if l /= something  then l2  ++ something  else l2\n    let l2'' = if l /= something2 then l2' ++ something2 else l2'\n    l2''\n</code></pre>\n\n<p>But in this case you don't really need the <code>do</code> notation since you don't use any monadic operation. I believe you want to use the <code>do</code> notation to simulate imperative-style programming. Consider using a <code>where</code> if you think it's more readable:</p>\n\n<pre><code>doIfFunction :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\ndoIfFunction l1 l2 = result\n    where newL2 = if l /= something  then l2 ++ something  else l2\n        result = if l /= something2 then newL2 ++ something2 else newL2\n</code></pre>\n\n<p>Alternatively, when you will be more familiar with Haskell, you could use <a href=\"https://stackoverflow.com/a/34254954/5559663\">leftaroundabout's answer</a> (that would be the most idiomatic way to write what you want to do).</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450034248, "post_id": 34254954, "comment_id": 56251988, "body": "@dfeuer: mainly to avoid scope confusion with three different <code>l2</code> variables. Also because \u2013 not always but often \u2013 point-free definitions are simply cleaner. I agree that pointless may be confusing to a beginner, but I hope I have made sufficiently accessible steps in my explanation."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1450034465, "last_edit_date": 1450034465, "creation_date": 1450032763, "answer_id": 34254954, "question_id": 34254738, "link": "https://stackoverflow.com/questions/34254738/haskell-combining-do-and-if/34254954#34254954", "title": "Haskell, combining Do and if", "body": "<p>Generally, you should avoid to think about <em>modifying</em> anything in Haskell. In fact, you can't, the language doesn't allow it. At all<sup>&dagger;</sup>!</p>\n\n<p>Instead of modifying the list <code>l2</code> itself, you think about creating additional lists which are <em>modified versions</em> of <code>l2</code>. (The immediate benefit is that you can still use the original <code>l2</code> anywhere else; in particular it's fine if some other function / thread still needs this old version and you weren't aware of it.)</p>\n\n<p>I.e., instead of</p>\n\n<pre><code> do\n   modify_something_about_l2\n   modify_something_else_about_l2\n   yield_some_result\n</code></pre>\n\n<p>you want to just <em>evaluate the result</em> of a function-application chain, like</p>\n\n<pre><code>f l2 = some_other_modification (some_modification (l2))\n</code></pre>\n\n<p>or, as we prefer to write it,</p>\n\n<pre><code>f = some_other_modification . some_modification\n</code></pre>\n\n<p>In your particular case:</p>\n\n<pre><code>doIfFunction l1\n  = (\\l2 -&gt; if l /= something2 then (l2++something2) else l2)\n    . (\\l2 -&gt; if l /= something then (l2++something) else l2)\n</code></pre>\n\n<p>If you don't like the &ldquo;backwards style&ldquo; you can also replace the composition operator <code>.</code> with its flipped version:</p>\n\n<pre><code>import Control.Arrow\n\ndoIfFunction l1\n  = (\\l2 -&gt; if l /= something then (l2++something) else l2)\n   &gt;&gt;&gt; (\\l2 -&gt; if l /= something2 then (l2++something2) else l2)\n</code></pre>\n\n<p>Also, you can, via eta-reduction, avoid mentioning the intermediate lists at all:</p>\n\n<pre><code>doIfFunction l1\n  = (if l /= something then (++something) else id)\n   &gt;&gt;&gt; (if l /= something2 then (++something2) else id)\n</code></pre>\n\n<hr>\n\n<h2>That said...</h2>\n\n<p>You're probably thinking: it's mighty inefficient to always create <em>new modified versions</em> of everything, instead of just modifying in-place. Well, sometimes it is, often it is actually no problem at all.</p>\n\n<p>You example is in fact one where it is a problem: to append <code>something</code> to <code>l2</code>, a copy of the entire list needs to be made. Maybe you can avoid this problem very easily: if instead of <em>appending</em>, you <em>prepend</em>:</p>\n\n<pre><code>doIfFunction l1\n  = (if l /= something then (something++) else id)\n   &gt;&gt;&gt; (if l /= something2 then (something2++) else id)\n</code></pre>\n\n<p>then there's no performance penalty. The reason being: a list is just a chain of elements (heads), each with references to the rest of the list. <em>Pre</em>-pending an element is just a matter of making a new head and linking it to the already existing list!</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Even with clever lazy prepending, sometimes the pure-functional style <em>is</em> significantly more time-expensive. Don't worry: although Haskell does not allow modifying values, there are types which <em>encapsulate the concept of destructive modifications</em>, namely the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST-Lazy-Safe.html#t:ST\" rel=\"nofollow\"><code>ST</code> monad</a>. So you can still implement algorithms that need destructive updates efficiently, but basically you don't do it in Haskell but in an embedded &ldquo;domain-specific imperative language&rdquo;, that integrates seamlessly with Haskell.</sub></p>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 34254932, "answer_count": 2, "score": 1, "last_activity_date": 1450034465, "creation_date": 1450031493, "question_id": 34254738, "link": "https://stackoverflow.com/questions/34254738/haskell-combining-do-and-if", "title": "Haskell, combining Do and if", "body": "<p>Hi I was wondering whether there was a way to use <code>do</code> <code>if</code> in haskell in this kind of way</p>\n\n<pre><code>doIfFunction :: Eq a =&gt; [a]-&gt;[a] -&gt;[a]\ndoIfFunction l1 l2 = do\n     if l /= something then (l2++something) else l2\n     if l /= something2 then (l2++something2) else l2\n     l2\n</code></pre>\n\n<p>Basically if this something function returns a different value I want it to add it to <code>l2</code> then return <code>l2</code>. I keep getting <code>l2</code> as being empty at the end and it shouldn't be, is this because of the <code>else l2</code> does it reset the value of <code>l2</code> to what it was at the start?</p>\n\n<p>If so could I do something like this?</p>\n\n<pre><code>doIfFunction :: Eq a =&gt; [a]-&gt;[a] -&gt;[a]\ndoIfFunction l1 l2 = do\n     if l /= something then (let l2 = l2++something) else l2\n     if l /= something2 then (let l2 = l2++something2) else l2\n     l2\n</code></pre>\n\n<p>This gives errors, but I was wondering if this is on the right lines.</p>\n\n<p>When the <code>doIfFunction</code> is being called it will always be <code>doIfFunction l []</code> where <code>l</code> contains values and <code>[]</code> is <code>empty</code></p>\n"}, {"tags": ["haskell", "polymorphism", "constraints", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1450031750, "post_id": 34254274, "comment_id": 56251146, "body": "So by using proxy at call site, we pass a value which we choose to be of type <code>Proxy Show</code>, so that <code>c</code> type variable is <code>Show</code>, type which is used as a constrain with (via <i>ConstraintKinds</i> options) . that <b>same</b> constraint is used in the result function and in the inner function which leads the compiler to look for a show instance on interp2, which it readily finds in its context.... I can understand those things but wonder how easily I will be able to write them"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1450033198, "post_id": 34254274, "comment_id": 56251686, "body": "Isn&#39;t <code>interpMonad</code> a <code>retract</code>?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1450038143, "post_id": 34254274, "comment_id": 56253392, "body": "@arrowd : I forgot what retract was. but interMonad takes, AFAIK, a natural transformation interp2 (defined for all type x uniformly, obvious that going from <code>Choice a</code> to <code>Choice b</code> then transporting to <code>IO b</code> give the same function than transporting from <code>Choice a</code> to <code>IO a</code> then going to <code>IO b</code>) to another natural transformation. interp2 is an arrow in the category of endofunctor from <code>Choice</code> to <code>m</code> <i>viewed as a functor</i> and the free/forgetful adjunction give you, by initially, a unique arrow interpMonad from the monad <code>Free Choice</code> to <code>m</code> viewed as a monad"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1450038502, "post_id": 34254274, "comment_id": 56253527, "body": "@arrowd so it&#39;s one direction of the isomorphism Endo(F, U(m)) / Endo (Free F, m)  . for functor categories Endo <a href=\"http://ncatlab.org/nlab/show/endofunctor\" rel=\"nofollow noreferrer\">ncatlab.org/nlab/show/endofunctor</a>  . correction : &#39;a unique arrow interpMonad&#39; =&gt; &#39;a unique arrow <code>interpMonad interp2</code>&#39; above"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1450038710, "post_id": 34254274, "comment_id": 56253584, "body": "I wonder what is the interpretation of constraints, categorically. <code>forall x</code>  is nice, but the real power comes from giving our computations some abilities"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 1, "creation_date": 1450047424, "post_id": 34254274, "comment_id": 56256488, "body": "@nicolas I have always seen constraints as subsets. That is <code>forall (x : X) . C x =&gt; Proxy x</code> denotes the subset of <code>X</code> which satisfies the predicate <code>C</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1450028957, "creation_date": 1450028957, "answer_id": 34254274, "question_id": 34253216, "link": "https://stackoverflow.com/questions/34253216/free-monad-and-type-constraints/34254274#34254274", "title": "Free monad and type constraints", "body": "<p>I don't see your interpMonad function, so I will include one possible definition here:</p>\n\n<pre><code>interpMonad :: forall f m x . (Functor f, Monad m) \n            =&gt; (forall y . f y -&gt; m y) -&gt; Free f x -&gt; m x \ninterpMonad xx = go . runIdentity . runFreeT  where \n  go (FreeF x) = xx x &gt;&gt;= go . runIdentity . runFreeT\n  go (Pure  x) = return x \n</code></pre>\n\n<p>In order to also have a class constraint on the inner function, you simply add the constraint to the inner function. You also need the correct constraint on the type <code>Free</code>, and you need the extra <code>Proxy</code> to help the typechecker out a bit. Otherwise, the definition of the function is identical:</p>\n\n<pre><code>interpMonadC :: forall f m x c . (Functor f, Monad m, c (Free f x)) \n             =&gt; Proxy c \n             -&gt; (forall y . c y =&gt; f y -&gt; m y) \n             -&gt; (Free f x -&gt; m x) \ninterpMonadC _ xx = go . runIdentity . runFreeT  where \n  go (FreeF x) = xx x &gt;&gt;= go . runIdentity . runFreeT\n  go (Pure  x) = return x \n</code></pre>\n\n<p>And now quite simply:</p>\n\n<pre><code>&gt;:t interpMonadC (Proxy :: Proxy Show) interp2\ninterpMonadC (Proxy :: Proxy Show) interp2\n  :: Show x =&gt; Free Choice x -&gt; IO x\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 34254274, "answer_count": 1, "score": 2, "last_activity_date": 1450034116, "creation_date": 1450023276, "last_edit_date": 1450034116, "question_id": 34253216, "link": "https://stackoverflow.com/questions/34253216/free-monad-and-type-constraints", "title": "Free monad and type constraints", "body": "<p>I am looking for practical strategies or tips for dealing with constraints in haskell, as illustrated by the case below.</p>\n\n<hr>\n\n<p>I have a functor <code>Choice</code> and I want to transform an interpreter from <code>Choice x</code> functor to <code>m x</code> to an interpreter from <code>Free Choice x</code> to <code>m x</code>.</p>\n\n<pre><code>-- Choice : endofunctor  \ndata Choice next = Choice next next deriving (Show)\ninstance Functor Choice where \n   fmap f (Choice a b) = Choice (f a) (f b)\n\n-- I have a function from the functor to a monad m\ninter1 :: Choice x -&gt; IO x\ninter1 (Choice a b) = do \n  x &lt;- readLn :: IO Bool \n  return $ if x then a else b\n\n-- universal property gives me a function from the free monad to m \ngo1 :: Free Choice x -&gt; IO x\ngo1 = interpMonad inter1\n</code></pre>\n\n<p>where</p>\n\n<pre><code>type Free f a = FreeT f Identity a\ndata FreeF f r x = FreeF (f x) | Pure r deriving (Show)\nnewtype FreeT f m r = MkFreeT { runFreeT :: m (FreeF f r (FreeT f m r)) }\n\ninstance Show (m (FreeF f a (FreeT f m a))) =&gt; Show (FreeT f m a) where\n  showsPrec d (MkFreeT m) = showParen (d &gt; 10) $\n    showString \"FreeT \" . showsPrec 11 m\n\ninstance (Functor f, Monad m) =&gt; Functor (FreeT f m) where\n    fmap (f::a -&gt; b) (x::FreeT f m a)  =\n        MkFreeT $ liftM f'  (runFreeT x)\n                where f' :: FreeF f a (FreeT f m a) -&gt; FreeF f b (FreeT f m b)\n                      f' (FreeF (fx::f (FreeT f m a))) =  FreeF $ fmap (fmap f) fx\n                      f' (Pure r) = Pure $ f r\n\ninstance (Functor f, Monad m) =&gt; Applicative (FreeT f m) where\n  pure a = MkFreeT . return $ Pure a\n  (&lt;*&gt;) = ap\n\ninstance (Functor f, Monad m) =&gt; Monad (FreeT f m) where\n    return = MkFreeT . return . Pure\n    (MkFreeT m) &gt;&gt;= (f :: a -&gt; FreeT f m b)  =  MkFreeT $ -- m (FreeF f b (FreeT f m b))\n           m  &gt;&gt;= -- run the effect in the underlying monad !\n             \\case FreeF fx -&gt; return . FreeF . fmap (&gt;&gt;= f) $ fx -- continue to run effects\n                   Pure r -&gt; runFreeT (f r) -- apply the transformation\n\ninterpMonad :: (Functor f, Functor m, Monad m) =&gt;\n               (forall x . f x -&gt; m x) -&gt;\n               forall x. Free f x -&gt; m x\ninterpMonad interp (MkFreeT iFfxF) = (\\case\n      Pure x -&gt; return x\n      FreeF fxF -&gt; let mmx =  interp $ fmap (interpMonad interp) fxF\n                   in join mmx) . runIdentity $ iFfxF\n</code></pre>\n\n<p>All is fine until I require <code>Show x</code> in my interpreter.</p>\n\n<pre><code>interp2 :: Show x =&gt; Choice x -&gt; IO x\ninterp2 (Choice a b) = return a -- we follow left\n\n\ngo2 :: Show x =&gt; Free Choice x -&gt; IO x\ngo2  = interpMonad interp2   -- FAILS\n</code></pre>\n\n<p>Then it can not find the show constraint to apply in interp2</p>\n\n<p>I suspected the quantifiers were the problem, so I simplified to</p>\n\n<pre><code>lifting :: (forall x . x -&gt; b) -&gt;\n           (forall x.  x -&gt; b)\nlifting = id\n\nlifting2 :: (forall x . Show x =&gt; x -&gt; b) -&gt;\n            (forall x . Show x =&gt; x -&gt; b)\nlifting2 = id\n\n\nsomefunction :: Show x =&gt; x -&gt; String\nsomefunction = lifting show    -- FAILS\n\nsomefunction2 :: Show x =&gt; x -&gt; String\nsomefunction2 = lifting2 show  -- OK\n</code></pre>\n\n<p>This highlight the problem : <code>Could not deduce (Show x1) arising from a use of \u2018show\u2019 from the context (Show x)</code> we have two distinct type variable, and constraint do not flow from one to the other.</p>\n\n<hr>\n\n<p>I could write some specialized function playing with the constraints as follows (does not work btw) but my question is what are the practical strategies for dealing with this ? (the equivalent of undefined, look at the type, go on...)</p>\n\n<pre><code>interpMonad2 :: (Functor f, Functor m, Monad m) =&gt;\n               (forall x . ( Show (f x)) =&gt; f x -&gt; m x) -&gt;\n               forall x.  ( Show (Free f x)) =&gt; Free f x -&gt; m x\ninterpMonad2 interp (MkFreeT iFfxF) = (\\case\n      Pure x -&gt; return x\n      FreeF fxF -&gt; let mmx =  interp $ fmap (interpMonad interp) fxF\n                   in join mmx) . runIdentity $ iFfxF\n</code></pre>\n\n<hr>\n\n<p>edit</p>\n\n<p>based on the answer provided, here is the modification for the  <code>lifting</code>  function. </p>\n\n<pre><code>lifting :: forall b c. Proxy c\n           -&gt;  (forall x . c x =&gt; x -&gt; b)\n           -&gt;  (forall x . c x =&gt; x -&gt; b)\nlifting _ = id\n\n\nsomefunction3 :: Show x =&gt; x -&gt; String\nsomefunction3 = lifting (Proxy :: Proxy Show) show\n</code></pre>\n"}, {"tags": ["haskell", "reactive-programming"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1450014600, "post_id": 34251619, "comment_id": 56245091, "body": "BTW, this way of passing around phantom arguments with <code>undefined</code> is risky and somewhat outdated. I would write new code with <a href=\"http://hackage.haskell.org/package/tagged-0.8.2/docs/Data-Tagged.html\" rel=\"nofollow noreferrer\"><code>rate :: Tagged c Double</code></a> instead. That&#39;s also a bit awkward, but definitely better."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1450014653, "last_edit_date": 1450014653, "creation_date": 1450014139, "answer_id": 34251723, "question_id": 34251619, "link": "https://stackoverflow.com/questions/34251619/calling-class-method-ambiguous-type/34251723#34251723", "title": "Calling class method. Ambiguous type", "body": "<p>The problem is that type variables are, by default, scoped only to a single signature. I.e. when you use <code>p</code> in your function signature, the compiler won't connect this at all to the <code>undefined :: p</code> you then use in the definition. Rather, it'll think &ldquo;<code>undefined</code> of some other type which also happens to be referred to as <code>p</code>&ldquo;.</p>\n\n<p>Fortunately, GHC <em>can</em> scope type variables to a whole function definition:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nburst :: \u2200 p . Clock p =&gt; Double -&gt; SigFun p () Double\nburst m = proc () -&gt; do \n     burstEnv &lt;- envLineSeg [1,1,0,0] [(m/(rate (undefined :: p))), (1/4410), (m+1/4410) ] -&lt; ()\n     noise &lt;- noiseWhite 51 -&lt; ()\n     outA -&lt; noise * burstEnv  \n</code></pre>\n\n<p>Note that the <code>\u2200 p</code> is mandatory (<code>forall a p. (AudioSample a, Clock p)</code>) in the example code), otherwise <code>ScopedTypeVariables</code> simply doesn't apply to this function.</p>\n"}], "owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 34251723, "answer_count": 1, "score": 1, "last_activity_date": 1450014653, "creation_date": 1450013494, "question_id": 34251619, "link": "https://stackoverflow.com/questions/34251619/calling-class-method-ambiguous-type", "title": "Calling class method. Ambiguous type", "body": "<p>The title probably is not the clearest one but honestly I don't know what I don't know :(</p>\n\n<p>There is this Clock class:</p>\n\n<pre><code>class Clock c where\n   rate :: c \u2192 Double\n\ndata AudRate\ndata CtrRate\n</code></pre>\n\n<p>And instances:</p>\n\n<pre><code>instance Clock AudRate where\n   rate _ = 44100\ninstance Clock CtrRate where\n   rate _ = 4410\n</code></pre>\n\n<p>My function:</p>\n\n<pre><code>burst :: Clock p =&gt; Double -&gt; SigFun p () Double\nburst m = proc () -&gt; do \n     burstEnv &lt;- envLineSeg [1,1,0,0] [(m/(rate (undefined :: p))), (1/4410), (m+1/4410) ] -&lt; ()\n     noise &lt;- noiseWhite 51 -&lt; ()\n     outA -&lt; noise * burstEnv  \n</code></pre>\n\n<p>GHC tells me that: (rate (undefined :: p))</p>\n\n<pre><code>Could not deduce (Clock p0) arising from a use of `rate'\nfrom the context (Clock p)\n  bound by the type signature for\n             burst1 :: Clock p =&gt; Double -&gt; SigFun p () Double\n  at Karplus.hs:11:11-49\nThe type variable `p0' is ambiguous\n</code></pre>\n\n<p>But the same expression is used in a source code of the library I use.</p>\n\n<pre><code>outFileHelp :: forall a p. (AudioSample a, Clock p) =&gt; \n        ([Double] -&gt; [Double]) -- ^ Post-processing function.\n     -&gt; String              -- ^ Filename to write to.\n     -&gt; Double              -- ^ Duration of the wav in seconds.\n     -&gt; Signal p () a       -- ^ Signal representing the sound.\n     -&gt; IO ()\noutFileHelp f filepath dur sf = \nlet sr          = rate (undefined :: p)\n  numChannels = numChans (undefined :: a)\n  numSamples  = truncate (dur * sr) * numChannels\n  dat         = map (fromSample . (*0.999)) \n                    (f (toSamples dur sf)) :: [Int32]\n                -- multiply by 0.999 to avoid wraparound at 1.0\n  array       = listArray (0, numSamples-1) dat\n  aud = Audio { sampleRate    = truncate sr,\n                channelNumber = numChannels,\n                sampleData    = array }\nin exportFile filepath aud\n</code></pre>\n\n<p>Is it possible to use this expression in my code and make GHC compile it? Are there any extensions? </p>\n"}, {"tags": ["haskell", "data-structures", "functional-programming"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 8, "creation_date": 1450006741, "post_id": 34250459, "comment_id": 56242881, "body": "What is your intended semantics? I guess you&#39;d like your data structure to be a monad, so what should be the difference between &quot;no value&quot; and &quot;no answer&quot; when it comes to sequencing computations? If there is none, <code>Either Bool a</code> seems to suffice (or replacing <code>Bool</code> with something like <code>data Failure = NoValue | NoAnswer</code>)."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1450010343, "post_id": 34250459, "comment_id": 56243851, "body": "<code>Maybe (Maybe a)</code> encodes <i>exactly</i> what you&#39;re describing. Why is this not accepted?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1450048896, "post_id": 34250459, "comment_id": 56256881, "body": "@AJFarmar I list some reasons you might not want to use <code>Maybe (Maybe a)</code> <a href=\"http://stackoverflow.com/a/19073039/791604\">here</a>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1450049696, "post_id": 34250459, "comment_id": 56257091, "body": "@DanielWagner Of course there are reasons like those, but I just don&#39;t understand what &quot;These maybes are indistinguishable&quot; means. The described structure and nested maybes are trivially isomorphic - what&#39;s the problem?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1450051592, "post_id": 34250459, "comment_id": 56257487, "body": "@AJFarmar I suspect it is an echo of my first point there -- <code>Nothing</code> and <code>Just Nothing</code> are simply not self-describing, when compared to <code>DefinitelyDoesn&#39;tExist</code> and <code>Don&#39;tKnowWhetherItExists</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1450051702, "post_id": 34250459, "comment_id": 56257513, "body": "@PetrPudl&#225;k I encourage you to make that an answer! I would upvote it."}], "answers": [{"comments": [{"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 0, "creation_date": 1450005594, "post_id": 34250520, "comment_id": 56242591, "body": "I need to pass a value along."}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "reply_to_user": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 8, "creation_date": 1450005740, "post_id": 34250520, "comment_id": 56242634, "body": "I would then use a custom data structure. You can use <code>Maybe Maybe a</code> but it would be less clear in my opinion than something like <code>Result a = Found a | NotFound | NoAnswer</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1450042750, "post_id": 34250520, "comment_id": 56254995, "body": "Don&#39;t miss the parentheses: <code>Maybe (Maybe a)</code>."}], "tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": false, "score": 1, "last_activity_date": 1450012183, "last_edit_date": 1450012183, "creation_date": 1450005531, "answer_id": 34250520, "question_id": 34250459, "link": "https://stackoverflow.com/questions/34250459/how-can-i-encode-valuenothingundecided-in-haskell/34250520#34250520", "title": "How can I encode Value|Nothing|Undecided in Haskell?", "body": "<p>Why don't you use:</p>\n\n<pre><code>Maybe Bool\n</code></pre>\n\n<p>Mapping is trivial: <code>Nothing</code> is undecided, <code>Just False</code> means that the value doesn't exist and <code>Just True</code> means the value exists</p>\n\n<p>EDIT: I didn't know the result value should be available. In this case <code>Maybe Bool</code> is not enough and <code>Maybe Maybe a</code> could be used. Again, the mapping is trivial:</p>\n\n<ul>\n<li><code>Nothing</code> means no answer</li>\n<li><code>Just Nothing</code> means that you have an answer but no value</li>\n<li><code>Just (Just a)</code> means that you have an answer and it's inside the second <code>Maybe</code></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 0, "creation_date": 1450097796, "post_id": 34260066, "comment_id": 56276324, "body": "when sequencing both &quot;no value&quot; and &quot;no answer&quot; cases just get propagated down the line, whereas the &quot;value&quot; case gets transformed, <code>either bool</code> is obscure, I thought there is a standard type for this, well if there is none, then I will just use a homemade one, thanks for the answer"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 0, "creation_date": 1450127327, "post_id": 34260066, "comment_id": 56295337, "body": "@AlekseyBykov <code>Either Bool</code> (or <code>Either Failure</code>) definitely isn&#39;t obscure. It should be a standard tool in any Haskell programmer&#39;s toolbox. I also don&#39;t understand what &quot;standard type&quot; means if <code>Either Bool</code> doesn&#39;t qualify as that -- everything in that type is in the <code>Prelude</code>!"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "edited": false, "score": 1, "creation_date": 1450128742, "post_id": 34260066, "comment_id": 56296031, "body": "When you see <code>Either Bool</code> in your code how do you know that <code>Left true</code> is no value and then that <code>Left false</code> is no answer can be given, or... might it be the other way around? This is what I mean by obscure. Standard type is something from prelude that is already there with a set of common utility functions that fits the need out of the box without having to write it, just like Either or Maybe but with more cases"}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1450069162, "creation_date": 1450069162, "answer_id": 34260066, "question_id": 34250459, "link": "https://stackoverflow.com/questions/34250459/how-can-i-encode-valuenothingundecided-in-haskell/34260066#34260066", "title": "How can I encode Value|Nothing|Undecided in Haskell?", "body": "<p>The problem with <code>Maybe (Maybe a)</code> is of course that it's difficult to distinguish and remember what is <code>Just Nothing</code> and what is <code>Nothing</code>. But a bigger issue is that then we can't use <code>Maybe</code>'s monad instance, because <code>join</code> collapses <code>Just (Just x)</code> to <code>Just x</code> and <code>Just Nothing</code> to <code>Nothing</code>.</p>\n\n<p>Assuming we want to use the data type for sequencing computations, as a monad, the question becomes what should be the semantics of \"no value\" vs \"no answer\" when it comes to sequencing. If both should just abort the computation, then using <code>Either Bool</code> seems to be the best bet. Or perhaps better, create your own data type for representing the error conditions, like</p>\n\n<pre><code>data Failure = NoValue | NoAnswer\n</code></pre>\n\n<p>and use <code>Either Failure</code>.</p>\n\n<p>An equivalent alternative would be to use <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Except.html#t:ExceptT\" rel=\"nofollow\"><code>Except</code></a>, which provides a <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Except.html#v:throwE\" rel=\"nofollow\">throw/catch</a> interface.</p>\n"}], "owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1450069162, "creation_date": 1450005048, "last_edit_date": 1450005622, "question_id": 34250459, "link": "https://stackoverflow.com/questions/34250459/how-can-i-encode-valuenothingundecided-in-haskell", "title": "How can I encode Value|Nothing|Undecided in Haskell?", "body": "<p>Is there a canonical data structure that might contain a value and encodes 3 possible outcomes: </p>\n\n<ul>\n<li>Value exists (here it is)</li>\n<li>Value doesn't exits</li>\n<li>Answer cannot be given?</li>\n</ul>\n\n<p>I know I can use <code>Maybe Maybe a</code>, but these maybes are indistinguishable.</p>\n"}, {"tags": ["haskell", "clojure", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 29543, "user_id": 3181392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIgPs.png?s=128&g=1", "display_name": "cfrick", "link": "https://stackoverflow.com/users/3181392/cfrick"}, "edited": false, "score": 0, "creation_date": 1450003286, "post_id": 34250083, "comment_id": 56241965, "body": "first of all please pick a language in your tags?  the map there looks like clojure - so how comes haskell into play?  also please add the coude you have tried so far."}, {"owner": {"reputation": 3362, "user_id": 3995789, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/73f5f20561268b78d04b6a665f056eca?s=128&d=identicon&r=PG", "display_name": "user3995789", "link": "https://stackoverflow.com/users/3995789/user3995789"}, "reply_to_user": {"reputation": 29543, "user_id": 3181392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIgPs.png?s=128&g=1", "display_name": "cfrick", "link": "https://stackoverflow.com/users/3181392/cfrick"}, "edited": false, "score": 0, "creation_date": 1450003845, "post_id": 34250083, "comment_id": 56242110, "body": "language doesn&#39;t matter, i want to know how you do this in functional style. @cfrick"}], "answers": [{"tags": [], "owner": {"reputation": 6563, "user_id": 100214, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/db8155dcba940d81cd7a298b4ae99c7c?s=128&d=identicon&r=PG", "display_name": "Frank C.", "link": "https://stackoverflow.com/users/100214/frank-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1450007504, "creation_date": 1450007504, "answer_id": 34250761, "question_id": 34250083, "link": "https://stackoverflow.com/questions/34250083/how-to-map-reduce-referential-data-in-functional-programming/34250761#34250761", "title": "How to map reduce referential data in functional programming", "body": "<p>There are ways to optimize this but it should give you the right idea. See below code for alternate suggestion.</p>\n\n<p>The interesting thing here is you are mapping a fixed tile model over a variable piece type set. There would be efficiency in making the piece model a fixed array as well.</p>\n\n<p><strong><em>Note:</em></strong> the input needs to be a string and not using single quotes as in your example: (e.g. <code>\"00p0r0\"</code> vs. <code>'00p0r0'</code>).</p>\n\n<pre><code>(def empty-tile-map\n  {:piece-count 0\n   :pieces {}\n   :tiles (into [] (repeat 6 {}))})\n\n(defn set-tile\n  \"Sets the tile to the index reference to piece\"\n  [arref indx value]\n  (assoc arref indx {:current value}))\n\n(defn string-to-board-reducer\n  \"Reduce function to create pieces and reference in tile\"\n  [{:keys [piece-count tcount tiles] :as acc} x]\n  (let [ccnt   (inc piece-count)\n        nmap   (assoc acc :tcount (inc tcount))]\n    (if (&gt; (int x) 48)\n      (assoc \n        (assoc\n          (update-in nmap [:pieces] assoc ccnt {:type x})\n          :tiles (set-tile tiles tcount ccnt))\n        :piece-count ccnt)\n      nmap)\n    ))\n\n(defn string-to-board\n  [s]\n  \"Take serializated string and generate board\"\n  (dissoc (reduce string-to-board-reducer \n                  (assoc empty-tile-map :tcount 0) (seq s))\n          :tcount))\n</code></pre>\n\n<p><strong>Alternate</strong>\nBy definition, the input string implicitly contains all the information you want. A series of functions could be defined that work with the serialize string as the board state, replacing it with a new string as you go. Just a suggestion.</p>\n"}], "owner": {"reputation": 3362, "user_id": 3995789, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/73f5f20561268b78d04b6a665f056eca?s=128&d=identicon&r=PG", "display_name": "user3995789", "link": "https://stackoverflow.com/users/3995789/user3995789"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 34250761, "answer_count": 1, "score": 0, "last_activity_date": 1450007504, "creation_date": 1450002244, "question_id": 34250083, "link": "https://stackoverflow.com/questions/34250083/how-to-map-reduce-referential-data-in-functional-programming", "title": "How to map reduce referential data in functional programming", "body": "<p>I want to make a tile based game using functional programming. </p>\n\n<p>Game has 6 tiles and each tile can occupy a piece. Here's my data structure:</p>\n\n<pre><code>{\n :pieces {\n          1 { :type 'p' }\n          2 { :type 'r' }\n          }\n :tiles [{}\n         {}\n         {:current 1}\n         {}\n         {:current 2}\n         {}]\n }\n</code></pre>\n\n<p>This is a serial representation of the game tiles:</p>\n\n<pre><code>'00p0r0'\n</code></pre>\n\n<p>I need a function that transforms this serial data into my data structure.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "edited": false, "score": 0, "creation_date": 1449998627, "post_id": 34249461, "comment_id": 56240770, "body": "Ah, so having it at the end does nothing?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "edited": false, "score": 0, "creation_date": 1450000087, "post_id": 34249461, "comment_id": 56241147, "body": "@k_g shell picks executable from the first directory it finds it in. The order matters, but in this cae you&#39;d like to have <code>~&#47;.cabal&#47;bin</code> somewhere before system-wide directories."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 4, "last_activity_date": 1449997716, "last_edit_date": 1449997716, "creation_date": 1449996921, "answer_id": 34249461, "question_id": 34249319, "link": "https://stackoverflow.com/questions/34249319/cabal-claims-it-has-updated-itself-but-has-not-really/34249461#34249461", "title": "Cabal claims it has updated itself but has not really", "body": "<p>You should add <code>/home/kavi/.cabal/bin</code> to the beginning of the <code>$PATH</code>.</p>\n\n<p><code>which cabal</code> tells which executable shell will pick to execute, on my machine:</p>\n\n<pre><code>% echo $PATH\n/Users/ogre/.local/bin:...\n\n% which cabal\n/Users/ogre/.local/bin/cabal\n</code></pre>\n"}], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 34249461, "answer_count": 1, "score": 0, "last_activity_date": 1449997716, "creation_date": 1449995663, "last_edit_date": 1495535241, "question_id": 34249319, "link": "https://stackoverflow.com/questions/34249319/cabal-claims-it-has-updated-itself-but-has-not-really", "title": "Cabal claims it has updated itself but has not really", "body": "<p>Following the instructions from <a href=\"https://stackoverflow.com/questions/27887249/trying-out-cabal-sandbox-init-and-cabal-not-recognizing-the-command-sandbox\" title=\"this post\">this post</a> on how to update <code>cabal-install</code>, I seemed to be able to install the latest version (or at least some version <code>&gt; 1.18</code>, which is what I wanted.</p>\n\n<pre><code>$ cabal install Cabal cabal-install\nResolving dependencies...\nConfiguring cabal-install-1.22.6.0...\nBuilding cabal-install-1.22.6.0...\nPreprocessing executable 'cabal' for cabal-install-1.22.6.0...\n&lt;snip&gt;\nLinking dist/build/cabal/cabal ...\nInstalling executable(s) in /home/kavi/.cabal/bin\nInstalled cabal-install-1.22.6.0\n</code></pre>\n\n<p>However, when I tried <code>cabal sandbox</code>, it failed, so I checked <code>cabal --version</code>.</p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library \n</code></pre>\n\n<p>As you can see, the version is not the one that cabal claimed to install.</p>\n\n<p>Adding <code>~/.cabal/bin</code> to my path did nothing to help. (Yes, I did restart my terminal).</p>\n\n<pre><code>$ echo $PATH\n&lt;snip&gt;:/home/kavi/.cabal/bin\n$ cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library \n</code></pre>\n\n<p>I tried restarting my computer, but still:</p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library\n</code></pre>\n\n<p>I am using Ubuntu 14.04.</p>\n"}, {"tags": ["haskell", "type-synonyms"], "answers": [{"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 2, "last_activity_date": 1449993472, "last_edit_date": 1449993472, "creation_date": 1449992430, "answer_id": 34248992, "question_id": 34247882, "link": "https://stackoverflow.com/questions/34247882/return-a-value-from-a-list-of-type-synonyms/34248992#34248992", "title": "Return a value from a list of type synonyms", "body": "<p>Type-synonyms has nothing to do with your problem. One great thing about functional programming is that it allows you to abstract more and more ways to combine results. So all common problems are already solved, you only need to find names of solutions. Take a look at <a href=\"http://haddock.stackage.org/lts-3.17/base-4.8.1.0/Data-List.html\" rel=\"nofollow\"><code>Data.List</code></a>, it has <a href=\"http://haddock.stackage.org/lts-3.17/base-4.8.1.0/Data-List.html#v:lookup\" rel=\"nofollow\"><code>lookup</code></a> function:</p>\n\n<pre><code>\u03bb&gt; lookup \"Toughness\" [(\"Strength\", 5), (\"Toughness\", 1)]\nJust 1\n</code></pre>\n\n<p>You see that you currently have no guarantees on type level that you'll find something labelled <code>\"Toughness\"</code> at all. Thus we get <code>Maybe Int</code>. Now you should ask yourself a question, can player exist without <code>\"Toughness\"</code> parameter at all? Probably not. So a better approach would be just:</p>\n\n<pre><code>data Player = Player\n  { hitpoints       :: Int\n  , experience      :: Int\n  , statStrength    :: Int\n  , statToughness   :: Int\n  , skillFisticuffs :: Maybe Int\n  , pos             :: Point }\n</code></pre>\n\n<p>This is much better, you're now <em>guaranteed</em> by the language that any player will have some strength, etc. I don't know about skills in your game, you can make them optional with <code>Maybe</code> wrapper or keep them in a map (list of tuples) with the same effect (see <code>lookup</code>, it also returns <code>Maybe Int</code>).</p>\n"}], "owner": {"reputation": 11, "user_id": 5652223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35f30624873ce45fd36440c742ac0b74?s=128&d=identicon&r=PG&f=1", "display_name": "user5652223", "link": "https://stackoverflow.com/users/5652223/user5652223"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1449993472, "creation_date": 1449979638, "question_id": 34247882, "link": "https://stackoverflow.com/questions/34247882/return-a-value-from-a-list-of-type-synonyms", "title": "Return a value from a list of type synonyms", "body": "<p>So I want to return a value from a list of type synonyms.</p>\n\n<pre><code>type Skill = (String,Int)\ntype Stat = (String,Int)\ndata Player = Player {\n                   hitpoints :: Int,\n                   experience :: Int,\n                   stats :: [Stat],\n                   skills :: [Skill],\n                   pos :: Point\n                   }\n</code></pre>\n\n<p>I want to return the value of the stat <code>\"Toughness\"</code> in </p>\n\n<p><code>Player 10 0 [ (\"Strength\", 5), (\"Toughness\", 1) ] [ (\"Fisticuffs\", 1) ] (1,1)</code></p>\n\n<p>So far I have </p>\n\n<pre><code>instance Combatant Player where\ndefense (Player _ _ ([(s,a)]) _ _) = (List.find (s==\"Toughness\") ([(s,a)]))\n</code></pre>\n\n<p>but it returns the following error</p>\n\n<pre><code>Couldn't match expected type `Int'\n            with actual type `Maybe (GHC.Base.String, Int)'\nIn the expression: (find (s == \"Toughness\") ([(s, a)]))\nIn an equation for `defense':\n    defense (Player _ _ ([(s, a)]) _ _)\n      = (find (s == \"Toughness\") ([(s, a)]))\n\n\nCouldn't match expected type `(GHC.Base.String, Int)\n                              -&gt; ghc-prim-0.4.0.0:GHC.Types.Bool'\n            with actual type `ghc-prim-0.4.0.0:GHC.Types.Bool'\nIn the first argument of `find', namely `(s == \"Toughness\")'\nIn the expression: (find (s == \"Toughness\") ([(s, a)]))\nIn an equation for `defense':\n    defense (Player _ _ ([(s, a)]) _ _)\n      = (find (s == \"Toughness\") ([(s, a)]))\n</code></pre>\n\n<p>I'm still new to Haskell and I don't know what I should do. I've looked at different sources and closes thing I've seen to this is Association lists ? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1449973164, "post_id": 34247300, "comment_id": 56236399, "body": "Choose a structure with O(1) snoc and cons.  I think dlist and sequence should be interesting to you."}, {"owner": {"reputation": 739, "user_id": 2570929, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e6bb8a956268a2fd35b1a809e1ab4d7d?s=128&d=identicon&r=PG", "display_name": "thehandyman", "link": "https://stackoverflow.com/users/2570929/thehandyman"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1449974122, "post_id": 34247300, "comment_id": 56236579, "body": "Hmm, interesting. I took a look at the DList module, but I&#39;m having trouble figuring out how to do pattern matching on them. Is that possible? Or should I rewrite that part of the code?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1449974271, "post_id": 34247300, "comment_id": 56236614, "body": "Afterwards call toList to retain your old api."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1449975546, "post_id": 34247300, "comment_id": 56236830, "body": "There&#39;s also the &quot;poor man&#39;s queue&quot; which would probably work well here: <code>type Q a = ([a], [a])</code>. Cons&#39;d elements go in the left, snoc&#39;d elements go in the right in reverse order. You can use <code>toList (xs, ys) = xs ++ reverse ys</code> to do all the expensive snocs at once."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449979218, "post_id": 34247300, "comment_id": 56237417, "body": "The &quot;poor man&#39;s dequeue&quot; Daniel Wagner suggests is likely to be quite good. You should be able to convert that <code>Map</code> to a <code>Set</code> quicker using <code>fromAscendingList</code> or whatever it&#39;s called. There may even be a faster way, and depending on the size of the <code>Map</code> it might even be better to skip the conversion and just look for elements in the <code>Map</code>."}, {"owner": {"reputation": 739, "user_id": 2570929, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e6bb8a956268a2fd35b1a809e1ab4d7d?s=128&d=identicon&r=PG", "display_name": "thehandyman", "link": "https://stackoverflow.com/users/2570929/thehandyman"}, "edited": false, "score": 0, "creation_date": 1449979614, "post_id": 34247300, "comment_id": 56237485, "body": "I&#39;m not seeing how I would be able to use the poor man&#39;s queue here, since I need the full list to call member on the Set. How could you implement around that?"}, {"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 0, "creation_date": 1449984832, "post_id": 34247300, "comment_id": 56238260, "body": "Write an <code>Ord</code> instance for your poor man&#39;s queue.  It may not be quite as efficient as comparing lists, but it&#39;s probably better than the O(n^2) behavior from appending to the wrong end of a list..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1450127173, "post_id": 34247300, "comment_id": 56295238, "body": "@thehandyman Oh, wait, you only ever snoc. Why not just always cons, and &quot;remember&quot; that the list is reversed...?"}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 4, "last_activity_date": 1450004497, "creation_date": 1450004497, "answer_id": 34250361, "question_id": 34247300, "link": "https://stackoverflow.com/questions/34247300/improve-efficiency-by-removing-concat/34250361#34250361", "title": "Improve efficiency by removing concat", "body": "<p>A simple solution would be to use <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html\" rel=\"nofollow\"><code>Seq</code></a>, where <em>snoc</em> operation is <em>O(1)</em>. This involves converting the input first and then converting the result back, which would be worth, unless the set is large compared to the average length of the lists.</p>\n\n<p>There is however another problem, and that is testing the membership of the lists (or similar structures). Comparison or testing equality on lists is <em>O(n)</em>, and in your case, where you test the membership of a list that is likely a sub-list of a list contained in the set, the testing will indeed be <em>\u03a9(n)</em>. So even then, the complexity of <code>chunk</code> could be in the order of <em>O(n^2)</em> where <em>n</em> is the length of the list argument.</p>\n\n<p>It seems that using a <a href=\"https://en.wikipedia.org/wiki/Trie\" rel=\"nofollow\">trie</a> would be a better solution. A trie is much more efficient than a set of lists in both memory and time complexity. And especially useful for this case is its operation which allows you to take a sub-trie constructed by filtering all elements with a given prefix in <em>O(1)</em>.</p>\n\n<p>An example code (untested):</p>\n\n<pre><code>chunk :: C -&gt; [A] -&gt; [[A]]\nchunk c = go trie\n  where trie = Trie.fromList (map snd (Map.toList c))\n        go :: Trie -&gt; [A] -&gt; [A] -&gt; [[A]]\n        go s l []     = [reverse l | Trie.member [] s]\n        go s l (x:xs)\n          | Trie.member [] s = reverse l : go (Trie.lookupPrefix [x] trie) xs\n          | otherwise        = go (x : l) (Trie.lookupPrefix [x] s)\n</code></pre>\n\n<p>Now each step of <code>go</code> should take only <em>O(n)</em> amortized cost (the only non-<em>O(1)</em> operation is <code>reverse</code>, but this is <em>O(1)</em> amortized, as reversing a <em>k</em>-element list occurs only once after <em>k</em> steps).</p>\n\n<p>And now we can also make a further improvement: When the sub-trie is empty, we know we'll never return an additional element, as we'll never reach the matching case. So we could add a pattern to the top</p>\n\n<pre><code>        go s _ _ | Trie.null s = []\n</code></pre>\n\n<p>Package <a href=\"https://hackage.haskell.org/package/list-tries-0.6.1/docs/Data-ListTrie-Set.html\" rel=\"nofollow\">list-trie</a> seem to be just perfect for this.</p>\n"}], "owner": {"reputation": 739, "user_id": 2570929, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e6bb8a956268a2fd35b1a809e1ab4d7d?s=128&d=identicon&r=PG", "display_name": "thehandyman", "link": "https://stackoverflow.com/users/2570929/thehandyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 34250361, "answer_count": 1, "score": 0, "last_activity_date": 1450004497, "creation_date": 1449972943, "question_id": 34247300, "link": "https://stackoverflow.com/questions/34247300/improve-efficiency-by-removing-concat", "title": "Improve efficiency by removing concat", "body": "<p>I'm attempting to improve the efficiency of a particular function in my code which is taking up a large amount of the runtime. After profiling, I believe this is because of the concat within the code. How could I go about improving this code to be quicker?</p>\n\n<pre><code>chunk :: C -&gt; [A] -&gt; [[A]]\nchunk c = go []\n  where s = Set.fromList (map snd (Map.toList c))\n        go :: [A] -&gt; [A] -&gt; [[A]]\n        go l []     = [l | member l s]\n        go l (x:xs) = if member l s then l : go [x] xs\n                                    else go (l ++ [x]) xs\n</code></pre>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["haskell", "terminology", "functor", "applicative"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449978715, "post_id": 34247025, "comment_id": 56237327, "body": "If you&#39;re interested in <code>Backwards</code> applicative functors, you may also like <code>Data.Functor.Reverse</code>, which folds and traverses backwards. You may also find the <code>tardis</code> state transformer interesting."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 11, "last_activity_date": 1449970583, "creation_date": 1449970583, "answer_id": 34247081, "question_id": 34247025, "link": "https://stackoverflow.com/questions/34247025/applicative-functor-that-reverses-order-of-effects/34247081#34247081", "title": "Applicative functor that reverses order of effects", "body": "<p>The friendly folks on IRC pointed to the <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Applicative-Backwards.html\"><code>Backwards</code></a> applicative offered by the <code>transformers</code> package. You may also like the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#v:-60--42--42--62-\"><code>(&lt;**&gt;)</code></a> operator available in the standard library.</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1450063684, "creation_date": 1449970037, "last_edit_date": 1450063684, "question_id": 34247025, "link": "https://stackoverflow.com/questions/34247025/applicative-functor-that-reverses-order-of-effects", "title": "Applicative functor that reverses order of effects", "body": "<p>Given an applicative functor <code>f</code>, I had an idea of making a new applicative functor <code>Rev f</code> like <code>f</code> but with the order of effects reversed. Here it is:</p>\n\n<pre><code>import Control.Applicative\n\nnewtype Rev f a = Rev {unRev :: f a}\n\ninstance Functor f =&gt; Functor (Rev f) where\n  fmap f (Rev fx) = Rev (fmap f fx)\n\ninstance Applicative f =&gt; Applicative (Rev f) where\n  pure x = Rev (pure x)\n  (Rev ff) &lt;*&gt; (Rev fx) = Rev (pure (\\x f -&gt; f x) &lt;*&gt; fx &lt;*&gt; ff)\n</code></pre>\n\n<p>My questions are</p>\n\n<ol>\n<li>Is that a valid <code>Applicative</code> instance (does it obey the <code>Applicative</code> laws)?</li>\n<li>Does this construction have a name? Is there a module somewhere this is hiding in?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6006, "user_id": 239558, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2362bc1c423993bbdb8548a3a059702c?s=128&d=identicon&r=PG", "display_name": "user239558", "link": "https://stackoverflow.com/users/239558/user239558"}, "edited": false, "score": 0, "creation_date": 1476857377, "post_id": 34245490, "comment_id": 67517053, "body": "wreq has a few outstanding issues wrt supporting latest http-client and stackage nightly as of today.  servant is more up-to-date."}], "answers": [{"comments": [{"owner": {"reputation": 622, "user_id": 311524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c2067d97bbaec06933c9e1eeeb811a9?s=128&d=identicon&r=PG", "display_name": "Diogo Biazus", "link": "https://stackoverflow.com/users/311524/diogo-biazus"}, "edited": false, "score": 0, "creation_date": 1450026139, "post_id": 34249541, "comment_id": 56249073, "body": "Thanks for the reply, but I&#39;ll have to rephrase my question since stack overflown does not bode well with opinion based questions."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 5, "last_activity_date": 1449997692, "creation_date": 1449997692, "answer_id": 34249541, "question_id": 34245490, "link": "https://stackoverflow.com/questions/34245490/wreq-or-servant-for-http-api-client/34249541#34249541", "title": "Wreq or Servant for http API client?", "body": "<p>Both use <code>http-client</code> under the hood.</p>\n\n<p>In Haskell, the most consuming part of writing the web api bindings, are data definitions and JSON serialisation specification. The <code>wreq</code> implementation uses lenses, <code>wreq</code> is lensy HTTP library.</p>\n\n<p>After that, you'd like to provide some functions (using <code>IO</code>) to fetch data from right endpoints:</p>\n\n<pre><code>getStory :: Options -&gt; Int -&gt; Int -&gt; IO Story\ngetStory options projectId storyId =\n    getOne options $ \"/projects/\" ++ show projectId ++ \"/stories/\" ++ show storyId\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type API = \"services\" :&gt; \"v5\" :&gt; \"stories\"\n             :&gt; Header \"X-TrackerToken\" Text\n             :&gt; Capture \":storyId\" StoryId\n             :&gt; Get '[JSON] Story\n\nstory :: Text -&gt; StoryId -&gt; EitherT ServantErr IO Story\nstory :&lt;|&gt; ... =  client api ...\n</code></pre>\n\n<p>They aren't that different. With <code>wreq</code> (or <code>http-client</code> directly) you'd probably implement some helper function (like <code>getOne</code>) to do fetches; when with <code>servant</code> you get it \"for free\".</p>\n"}], "owner": {"reputation": 622, "user_id": 311524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c2067d97bbaec06933c9e1eeeb811a9?s=128&d=identicon&r=PG", "display_name": "Diogo Biazus", "link": "https://stackoverflow.com/users/311524/diogo-biazus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 1, "closed_date": 1450001108, "answer_count": 1, "score": 3, "last_activity_date": 1450027908, "creation_date": 1449957596, "last_edit_date": 1450027908, "question_id": 34245490, "link": "https://stackoverflow.com/questions/34245490/wreq-or-servant-for-http-api-client", "closed_reason": "Opinion-based", "title": "Wreq or Servant for http API client?", "body": "<p>I've been working in two different projects to implement a client binding for the Pivotal Tracker tool. <a href=\"https://github.com/diogob/pivotal-tracker-api\" rel=\"nofollow\">One project</a> uses the <a href=\"https://github.com/bos/wreq\" rel=\"nofollow\">wreq library</a>, while <a href=\"https://github.com/utdemir/hs-pivotal-tracker\" rel=\"nofollow\">the other</a> relies on <a href=\"https://github.com/haskell-servant/servant\" rel=\"nofollow\">servant</a>.</p>\n\n<p>I want to merge both projects, but I'm unsure of which design approach to use. So the questions that would help me to sort this out are:</p>\n\n<ol>\n<li><p>Is there any concrete advantage of defining my API as a type (besides the readability)?</p></li>\n<li><p>Which error handling will generate less code for users of the library, servant's <code>EitherT ServantError IO ()</code> or wreq's Exception style?</p></li>\n</ol>\n"}, {"tags": ["list", "haskell", "circular-list"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1449961526, "post_id": 34245206, "comment_id": 56233877, "body": "The direct answer to &quot;how do I &#39;start off&#39; the list with <code>[[0],[0,1]]</code>&quot; is &quot;use <code>[0] : [0,1] : ...</code> instead of <code>[0] ++ [0,1] ++ ...</code>&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 5013, "user_id": 969617, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/2412de50d273085f5dcf3f2101c3996e?s=128&d=identicon&r=PG", "display_name": "beoliver", "link": "https://stackoverflow.com/users/969617/beoliver"}, "is_accepted": true, "score": 6, "last_activity_date": 1449959384, "last_edit_date": 1449959384, "creation_date": 1449956749, "answer_id": 34245360, "question_id": 34245206, "link": "https://stackoverflow.com/questions/34245206/circular-maps-in-haskell/34245360#34245360", "title": "Circular maps in haskell", "body": "<p>From what I understand...</p>\n\n<p>I have just written a simple flip function that maps 1 to 0 and 0 to 1</p>\n\n<pre><code>flipBit 1 = 0\nflipBit 0 = 1\n</code></pre>\n\n<p>the function <code>h</code> takes a list and joins that list with the flipped version of the list </p>\n\n<pre><code>h xs = xs ++ (map flipBit xs)\n\n*Main&gt; h [0]\n[0,1]\n</code></pre>\n\n<p>The main function <code>fseq</code> takes a list as an argument. It conses the argument into the recursive call</p>\n\n<pre><code>fseq xs = xs : fseq (h xs)\n\n*Main&gt; take 4 $ fseq [0]\n[[0],[0,1],[0,1,1,0],[0,1,1,0,1,0,0,1]]\n</code></pre>\n\n<p>Haskell provides the function <code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]</code> that does exactly this.</p>\n\n<p>We can now wrap this as follows:</p>\n\n<pre><code>thue_morse = fseq [0]\n</code></pre>\n\n<p>or using the function <code>iterate</code></p>\n\n<pre><code>thue_morse = iterate h [0]\n</code></pre>\n\n<p>both give the result</p>\n\n<pre><code>*Main&gt; take 4 thue_morse\n[[0],[0,1],[0,1,1,0],[0,1,1,0,1,0,0,1]]\n</code></pre>\n\n<p>If you wanted to use list comprehensions, you could write something like this:</p>\n\n<pre><code>h xs = xs ++ (map flipBit xs)\nthue_morse = [0] : [ h x | x &lt;- thue_morse]\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 1, "accepted_answer_id": 34245360, "answer_count": 1, "score": 1, "last_activity_date": 1545612298, "creation_date": 1449955791, "last_edit_date": 1545612298, "question_id": 34245206, "link": "https://stackoverflow.com/questions/34245206/circular-maps-in-haskell", "title": "Circular maps in haskell", "body": "<p>I'm tasked with implementing a function that returns the Thue-Morse sequence all the way through. I've done it through primitive recursion but now I have to do it with a circular list (using list comprehension), and it'd have to return this when I call take on it:</p>\n\n<pre><code>&gt;take 4 thueSeq\n[[0],[0,1],[0,1,1,0],[0,1,1,0,1,0,0,1]]\n</code></pre>\n\n<p>Here's my (horrible) attempt at implementation:</p>\n\n<pre><code>&gt; thueSeq = 0: [x | x &lt;- zipWith (mod) (tail thueSeq) [1] ]\n</code></pre>\n\n<p>I'm aware right off the bat that it's wrong (the head is supposed to be [0], not 0) but writing <code>[0] ++ [0,1] ++ ...</code> didn't return a list of lists anyway. </p>\n\n<p>My question is, first off, how do I \"start off\" the list with <code>[[0],[0,1]]</code> because from what I've seen with circular lists, they have the base cases and then recurse through. Secondly, my list comprehension is trying to apply <code>(mod x 1)</code> to each value, but that'd also be wrong since <code>[[0,1]]</code> would turn into <code>[[0,1,0]]</code> instead of <code>[[0,1,1,0]]</code>. So I'm thinking I have to apply it on every other element in the list (the 1st element, 3rd, 5th, etc.)?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 24, "last_activity_date": 1450011800, "last_edit_date": 1450011800, "creation_date": 1449952454, "answer_id": 34244693, "question_id": 34244574, "link": "https://stackoverflow.com/questions/34244574/trouble-understanding-the-type-of-sequence-just-just/34244693#34244693", "title": "Trouble understanding the type of sequence [Just, Just]", "body": "<p>The second <code>sequence</code> works in a different monad.</p>\n\n<p>For the first:</p>\n\n<pre><code>sequence [Just 1, Just 2]\n</code></pre>\n\n<p>we have that <code>Just 1 :: Maybe a</code> and this is a value in the <code>Maybe</code> monad. Concretely, the type <code>[Maybe a]</code> is matched against <code>t (m b)</code> as required by sequence, and we get <code>t ~ []</code>, <code>m ~ Maybe</code>, <code>b ~ a</code> -- hence the <code>Maybe</code> monad.</p>\n\n<p>For the second:</p>\n\n<pre><code>sequence [Just, Just]\n</code></pre>\n\n<p>we have that <code>Just :: a -&gt; Maybe a</code>. Which monad is this in? Now the type <code>[a -&gt; Maybe a]</code> is matched against <code>t (m b)</code>, and we get <code>t ~ []</code>, <code>m ~ (-&gt;) a</code>, <code>b ~ Maybe a</code> -- hence we are now working in the <code>(-&gt;) a</code> monad, and no longer in the <code>Maybe</code> one.</p>\n\n<p>In this <code>(-&gt;) a</code> monad, which is isomorphic to the <code>Reader a</code> monad, we have e.g.</p>\n\n<pre><code>sequence [f, g, h] = \\x -&gt; [f x, g x, h x]\n</code></pre>\n\n<p>Indeed, a computation with the <code>(-&gt;) a</code> monad is a computation \"reading an implicit argument of type <code>a</code>\". The <code>sequence</code> function simply turns a list of such computations (<code>[(-&gt;) a b]</code>, i.e. <code>[a -&gt; b]</code>) into a single computation that reads the implicit argument just once, and produces a list with all the results\n(<code>(-&gt;) a [b]</code>, i.e. <code>a -&gt; [b]</code>).</p>\n"}], "owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 2, "accepted_answer_id": 34244693, "answer_count": 1, "score": 15, "last_activity_date": 1450011800, "creation_date": 1449951731, "question_id": 34244574, "link": "https://stackoverflow.com/questions/34244574/trouble-understanding-the-type-of-sequence-just-just", "title": "Trouble understanding the type of sequence [Just, Just]", "body": "<p>I'm confused as to why I got this in GHCi</p>\n\n<pre><code>:t sequence [Just,Just]\nsequence [Just, Just] :: a -&gt; [Maybe a]\n</code></pre>\n\n<p>To elaborate, I can understand <code>sequence [Just 1, Just 2] :: Num a =&gt; Maybe [a]</code> because when looking at the type of sequence</p>\n\n<pre><code>sequence :: (Monad m, Traversable t) =&gt; t (m a) -&gt; m (t a)\n</code></pre>\n\n<p>it is clear that this function takes a collection of monadic values and return a single monadic value of the collection. Thus, when we call <code>sequence [Just 1, Just 2]</code> we should get back a <code>Just</code> of <code>[1,2]</code>. Following that train of thoughts, shouldn't <code>sequence [Just, Just]</code> return a single <code>Just</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1596, "user_id": 5483583, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/58e00258c68a02aeb27dd3bb73728821?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian Schmitthenner", "link": "https://stackoverflow.com/users/5483583/fabian-schmitthenner"}, "is_accepted": false, "score": 1, "last_activity_date": 1449959933, "last_edit_date": 1449959933, "creation_date": 1449959632, "answer_id": 34245794, "question_id": 34244468, "link": "https://stackoverflow.com/questions/34244468/is-this-haskell-function-recalculating-needlessly/34245794#34245794", "title": "Is this Haskell function recalculating needlessly?", "body": "<p>Using a function as <code>Board</code> type is not such a good idea since the functions get more and more complicated when more calls to <code>setSquareTo</code> are made. \nThen more and more space will be used to save this more and more complicated function. Also, when calling it with a value <code>(x, y)</code> for which <code>setSquareTo</code> hasn't been called for a long time, it takes a long time because the function first checks if the supplied parameter is one of the other coordinates.</p>\n\n<p>So you should use <code>Map (Int, Int) Int</code> or your proposed <code>IntMap (IntMap Int)</code> instead as type for <code>Board</code> instead.</p>\n\n<p>If you use <code>Map (Int, Int) Int</code>, you can use <code>findWithDefault (x, y) 0 b</code> instead of <code>b (x, y)</code> in this case to get 0 if this value doesn't yet exist in the map, so you don't have to initially set every value to 0 which isn't possible when you have an infinite board. </p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1450042180, "last_edit_date": 1450042180, "creation_date": 1449960023, "answer_id": 34245846, "question_id": 34244468, "link": "https://stackoverflow.com/questions/34244468/is-this-haskell-function-recalculating-needlessly/34245846#34245846", "title": "Is this Haskell function recalculating needlessly?", "body": "<p>This is the kind of thing I wrote <a href=\"https://hackage.haskell.org/package/data-inttrie\" rel=\"nofollow\">data-inttrie</a> for. It behaves just like a function from Int, except that it supports efficient single-point modifications through memoization.</p>\n\n<p>You can initialize with any function f with <code>fmap f identity</code>, then use <code>overwrite</code> and <code>modify</code> to change it one value at a time.</p>\n"}], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 34245846, "answer_count": 2, "score": 1, "last_activity_date": 1450042180, "creation_date": 1449951217, "question_id": 34244468, "link": "https://stackoverflow.com/questions/34244468/is-this-haskell-function-recalculating-needlessly", "title": "Is this Haskell function recalculating needlessly?", "body": "<p>I want to compute values in an infinite grid of integers, where each square contains an integer from 0 to 3.  I designed a function that increments a square: it adds one to the value of that square, but if the square would then hold a 4, it sets the square to 0 and calls itself on the four adjacent squares.</p>\n\n<pre><code>type Board = (Int,Int) -&gt; Int\n\nsetSquareTo :: Int -&gt; (Int,Int) -&gt; Board -&gt; Board\nsetSquareTo n (x,y) b (z,w) | x == z &amp;&amp; y == w = n\n                            | otherwise        = b (z,w)\n\nincSquare :: (Int,Int) -&gt; Board -&gt; Board\nincSquare (x,y) b | b (x,y) == 3 = incSquare (x+1,y).incSquare (x,y+1).incSquare (x-1,y).incSquare (x,y-1).setSquareTo 0 (x,y) $ b\n                  | otherwise    = setSquareTo (b (x,y) + 1) (x,y) b\n</code></pre>\n\n<p>Now, I think this is doing only the calculations it needs to when finding the value of <strong>one</strong> square in a board generated by incSquare.  However, it seems like finding the values of two adjacent squares one after the other wastes a lot of time doing the some of the same calculations in each case.  Is this true?</p>\n\n<p>If so is there a way a simple way of improving performance? Would something like </p>\n\n<pre><code>type Board = IntMap (IntMap Int) \n</code></pre>\n\n<p>using the strict version of IntMap be better?  (How would I set every square to 0 initially in that case?)</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449942273, "post_id": 34242336, "comment_id": 56227648, "body": "By the way, the second line <code>Nothing &gt;&gt;= f = Just (f (Nothing))</code> looks wrong -- <code>f</code> does not take a <code>Maybe something</code>, in general."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 3, "creation_date": 1449942865, "post_id": 34242336, "comment_id": 56227874, "body": "&quot;I need to&quot; - so it is homework? Then I&#39;m sure your teacher has already given &quot;some pointers&quot;."}, {"owner": {"reputation": 51, "user_id": 5647834, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8f1682c67b6bb6f529ae2a9a2579157?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5647834/john-smith"}, "edited": false, "score": 0, "creation_date": 1449976332, "post_id": 34242336, "comment_id": 56236940, "body": "No. This is a special teacher and a free course. He advises to do google search."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450094072, "post_id": 34242336, "comment_id": 56273833, "body": "Well, what happened when you tried your definition?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1449945516, "last_edit_date": 1449945516, "creation_date": 1449940268, "answer_id": 34242629, "question_id": 34242336, "link": "https://stackoverflow.com/questions/34242336/haskell-verifying-if-a-constructor-is-monad/34242629#34242629", "title": "Haskell: Verifying if a constructor is Monad", "body": "<p>For that, you have to verify the <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads#Monad_Laws\" rel=\"nofollow\">monad laws</a>. These come in several (equivalent) forms, the closest to Haskell monads being</p>\n\n<pre><code>x &gt;&gt;= return     =  x\nreturn x &gt;&gt;= f   =  f x\n(x &gt;&gt;= f) &gt;&gt;= g  =  x &gt;&gt;= (\\y -&gt; f y &gt;&gt;= g)\n</code></pre>\n\n<p>Start from the first and apply the definitions for <code>&gt;&gt;=</code> and <code>return</code>. You may wish to proceed by cases: either <code>x</code> is <code>Nothing</code> or it is <code>Just a</code> for some value <code>a</code>...</p>\n"}], "owner": {"reputation": 51, "user_id": 5647834, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8f1682c67b6bb6f529ae2a9a2579157?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5647834/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1449945516, "creation_date": 1449938598, "question_id": 34242336, "link": "https://stackoverflow.com/questions/34242336/haskell-verifying-if-a-constructor-is-monad", "title": "Haskell: Verifying if a constructor is Monad", "body": "<p>I have a type </p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>I need to verify if the following type constructor Maybe is a Monad</p>\n\n<pre><code>instance Monad Maybe where\n        return x = Just x\n        Nothing &gt;&gt;= f = Just (f (Nothing))\n        (Just x) &gt;&gt;= f = f x\n</code></pre>\n\n<p>Please give me some pointers how to do above task.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "erlang", "fold"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 3, "creation_date": 1449915706, "post_id": 34238649, "comment_id": 56219876, "body": "The order of arguments to the first argument of <code>foldl</code> and <code>foldr</code> seems to be different in Haskell: <code>foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b</code> and <code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1449918180, "post_id": 34238649, "comment_id": 56220489, "body": "<code>2*x+y</code> vs <code>X+2*Y</code> -- is that intended?"}, {"owner": {"reputation": 3111, "user_id": 2846781, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/66799fb2211ee2618b679c10e96629f6?s=128&d=identicon&r=PG&f=1", "display_name": "TheLeonKing", "link": "https://stackoverflow.com/users/2846781/theleonking"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449918727, "post_id": 34238649, "comment_id": 56220652, "body": "@chi Very observant, it turns out I mixed these two! However, the problem still exists, except that it&#39;s now exactly other way around... <code>foldr</code> behaves the same, but <code>foldl</code> returns a different number."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449923159, "post_id": 34238649, "comment_id": 56221721, "body": "That supports Dogbert&#39;s suggestion: Erlang <code>foldl(f,x,l)</code> seems to be equivalent to Haskell <code>foldl (flip f) x l</code> -- <code>f</code> takes the arguments in a different order."}], "answers": [{"tags": [], "owner": {"reputation": 18731, "user_id": 1220269, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/KVjUY.jpg?s=128&g=1", "display_name": "Nathaniel Waisbrot", "link": "https://stackoverflow.com/users/1220269/nathaniel-waisbrot"}, "is_accepted": true, "score": 12, "last_activity_date": 1449928723, "creation_date": 1449928723, "answer_id": 34240658, "question_id": 34238649, "link": "https://stackoverflow.com/questions/34238649/haskell-vs-erlang-difference-in-foldl/34240658#34240658", "title": "Haskell vs. erlang: difference in foldl?", "body": "<p>You are confusing yourself by not simplifying your fold function.</p>\n\n<p><strong>fold left, Haskell</strong>:</p>\n\n<pre><code>Prelude Debug.Trace&gt; foldl (\\x y -&gt; trace(\"x:\"++show x++\" y:\"++show y) $ x+y) 4 [1,2,3]\nx:4 y:1\nx:5 y:2\nx:7 y:3\n10\n</code></pre>\n\n<p><strong>fold left, Erlang</strong>:</p>\n\n<pre><code>1&gt; lists:foldl(fun (X,Y) -&gt; io:format(\"x:~p y:~p~n\", [X,Y]), X+Y end, 4, [1,2,3]).\nx:1 y:4\nx:2 y:5\nx:3 y:7\n10\n</code></pre>\n\n<p><strong>fold right, Haskell</strong>:</p>\n\n<pre><code>Prelude Debug.Trace&gt; foldr (\\x y -&gt; trace(\"x:\"++show x++\" y:\"++show y) $ x+y) 4 [1,2,3]\nx:3 y:4\nx:2 y:7\nx:1 y:9\n10\n</code></pre>\n\n<p><strong>fold right, Erlang</strong>:</p>\n\n<pre><code>2&gt; lists:foldr(fun (X,Y) -&gt; io:format(\"x:~p y:~p~n\", [X,Y]), X+Y end, 4, [1,2,3]).\nx:3 y:4\nx:2 y:7\nx:1 y:9\n10\n</code></pre>\n\n<p>From this, it's clear that in Haskell, the <code>foldl</code> function will be passed <code>(Accumulator, Element)</code> while the <code>foldr</code> function will be passed <code>(Element, Accumulator)</code>.  On the other hand, both functions in Erlang will be passed <code>(Element, Accumulator)</code>.</p>\n"}], "owner": {"reputation": 3111, "user_id": 2846781, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/66799fb2211ee2618b679c10e96629f6?s=128&d=identicon&r=PG&f=1", "display_name": "TheLeonKing", "link": "https://stackoverflow.com/users/2846781/theleonking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 3, "accepted_answer_id": 34240658, "answer_count": 1, "score": 8, "last_activity_date": 1449928723, "creation_date": 1449915243, "last_edit_date": 1449923282, "question_id": 34238649, "link": "https://stackoverflow.com/questions/34238649/haskell-vs-erlang-difference-in-foldl", "title": "Haskell vs. erlang: difference in foldl?", "body": "<p>I've noticed there's a difference between Haskell and Erlang when it comes to <code>foldl</code>.</p>\n\n<p>For <code>foldr</code>, both languages return the same results:</p>\n\n<pre><code>foldr (\\x y -&gt; 2*x+y) 4 [1, 2, 3] -- returns 49\nlists:foldr(fun(X, Y) \u2212&gt; X+2\u2217Y end, 4, [1,2,3]). % returns 49\n</code></pre>\n\n<p>But the return values for <code>foldl</code> are different:</p>\n\n<pre><code>foldl (\\x y -&gt; x+2*y) 4 [1, 2, 3] -- returns 16\nlists:foldl(fun(X, Y) \u2212&gt; X+2\u2217Y end, 4, [1,2,3]). -- returns 43\n</code></pre>\n\n<p>How can this difference be explained?</p>\n"}, {"tags": ["haskell", "parse-error"], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1449911351, "post_id": 34238104, "comment_id": 56218795, "body": "No, <code>(x:[])</code> or <code>[x]</code>. <code>::</code> is for type declarations."}, {"owner": {"reputation": 39, "user_id": 5660113, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e0087ccfa920d2835567bd2f6f4373?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/5660113/anton"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1449923803, "post_id": 34238104, "comment_id": 56221878, "body": "Yeah, I guess I am think SML."}], "tags": [], "owner": {"reputation": 39, "user_id": 5660113, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e0087ccfa920d2835567bd2f6f4373?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/5660113/anton"}, "is_accepted": false, "score": 1, "last_activity_date": 1449910886, "creation_date": 1449910886, "answer_id": 34238104, "question_id": 34238055, "link": "https://stackoverflow.com/questions/34238055/getting-error-parse-error-in-pattern-length-failed-modules-loaded-none/34238104#34238104", "title": "Getting error &quot;Parse error in pattern: length Failed, modules loaded: none&quot;", "body": "<p>You can not put a conditional in the parameter pattern. A pattern for a list of length 1 would be <code>hd::[]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 7, "last_activity_date": 1449911201, "creation_date": 1449911201, "answer_id": 34238141, "question_id": 34238055, "link": "https://stackoverflow.com/questions/34238055/getting-error-parse-error-in-pattern-length-failed-modules-loaded-none/34238141#34238141", "title": "Getting error &quot;Parse error in pattern: length Failed, modules loaded: none&quot;", "body": "<p>It looks like you're trying to add a guard. You need to bind the input list to <code>l</code> and separate the condition with <code>|</code>:</p>\n\n<pre><code>ascending :: [Int]-&gt;Bool\nascending [] =True\nascending l | ((length l) == 1) =True \nascending l = ((head l)&lt;=l !! 1) &amp;&amp; ascending(tail l)\n</code></pre>\n\n<p>You can replace your use of guards, <code>head</code> and <code>tail</code> with pattern matching instead:</p>\n\n<pre><code>ascending :: [Int]-&gt;Bool\nascending [] = True\nascending [_] = True \nascending (x:y:xs) = (x &lt;= y) &amp;&amp; ascending (y:xs)\n</code></pre>\n"}], "owner": {"reputation": 542, "user_id": 5161239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wSMyp.jpg?s=128&g=1", "display_name": "Ajithkumar_sekar", "link": "https://stackoverflow.com/users/5161239/ajithkumar-sekar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 0, "accepted_answer_id": 34238141, "answer_count": 2, "score": -1, "last_activity_date": 1504684435, "creation_date": 1449910508, "last_edit_date": 1504684435, "question_id": 34238055, "link": "https://stackoverflow.com/questions/34238055/getting-error-parse-error-in-pattern-length-failed-modules-loaded-none", "title": "Getting error &quot;Parse error in pattern: length Failed, modules loaded: none&quot;", "body": "<pre><code> --To check the list is in ascending order or not\n ascending::[Int]-&gt;Bool\n ascending [] =True\n ascending ((length l) == 1) =True \n ascending l  =((head l)&lt;=l !! 1) &amp;&amp; ascending(tail l)\n</code></pre>\n\n<p>This is my Haskell code and when I try to run this code in my GHCI interpreter I get the following error:</p>\n\n<pre><code>  ascending.hs(File_name):4:13: Parse error in pattern: length\n  Failed, modules loaded: none.\n</code></pre>\n\n<p>Could anyone tell me where the bug is?</p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "edited": false, "score": 0, "creation_date": 1449880733, "post_id": 34234810, "comment_id": 56213418, "body": "Works perfect but how could I translate that to a fold/map? We haven&#39;t gone over scanr1 in class sadly (shame because this is like 7 characters long)"}, {"owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "reply_to_user": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "edited": false, "score": 0, "creation_date": 1449881301, "post_id": 34234810, "comment_id": 56213529, "body": "I&#39;ve added a second definition which uses <code>foldr</code>"}], "tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 4, "last_activity_date": 1449885353, "last_edit_date": 1449885353, "creation_date": 1449880583, "answer_id": 34234810, "question_id": 34234728, "link": "https://stackoverflow.com/questions/34234728/haskell-foldr-with-multiplication/34234810#34234810", "title": "Haskell foldr with multiplication", "body": "<pre><code>productFromLeftToRight = scanr1 (*)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>productFromLeftToRight' = \n  snd . foldr (\\x (acc,lst) -&gt; (x * acc, x * acc : lst)) (1,[])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": true, "score": 2, "last_activity_date": 1449887705, "creation_date": 1449887705, "answer_id": 34235606, "question_id": 34234728, "link": "https://stackoverflow.com/questions/34234728/haskell-foldr-with-multiplication/34235606#34235606", "title": "Haskell foldr with multiplication", "body": "<pre><code>productFromLeftToRight nums =\n    init $ foldr (\\x lst -&gt; x * head lst : lst) [1] nums\n</code></pre>\n\n<p>The idea is to use a dummy element <code>1</code> to the answer list and remove it in the end.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 0, "last_activity_date": 1449949897, "creation_date": 1449949897, "answer_id": 34244231, "question_id": 34234728, "link": "https://stackoverflow.com/questions/34234728/haskell-foldr-with-multiplication/34244231#34244231", "title": "Haskell foldr with multiplication", "body": "<p>Here's another one that doesn't do any post-processing after the <code>foldr</code>:</p>\n\n<pre><code>productFromLeftToRight = foldr (\\n ps -&gt; n * foldr const 1 ps : ps) []\n</code></pre>\n\n<p>Here, the inner <code>foldr const 1</code> is acting as a non-partial <code>head</code> function to get the first element of <code>ps</code>:</p>\n\n<pre><code>foldr const 1 (x:xs) = const x (foldr const 1 xs) = x\nfoldr const 1 []     = 1\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 4181391, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27993b1f731fc9932ecf465cdf994490?s=128&d=identicon&r=PG&f=1", "display_name": "Homerdough", "link": "https://stackoverflow.com/users/4181391/homerdough"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 0, "accepted_answer_id": 34235606, "answer_count": 3, "score": 2, "last_activity_date": 1449949897, "creation_date": 1449880001, "question_id": 34234728, "link": "https://stackoverflow.com/questions/34234728/haskell-foldr-with-multiplication", "title": "Haskell foldr with multiplication", "body": "<p>I'm supposed to write a function that will contain the product of each previous multiplication with that number </p>\n\n<p>Basically this:</p>\n\n<pre><code>&gt; productFromLeftToRight [2,3,4,5]\n[120,60,20,5]\n</code></pre>\n\n<p>I'm supposed to use High Order functions, so folds and such. I'm thinking of using a foldr to traverse through the list with a lambda expression. This is what I'm thinking:</p>\n\n<pre><code>&gt; productFromLeftToRight nums = foldr (\\x acc -&gt; [x] * acc ++ acc) [] nums\n</code></pre>\n\n<p>Since it would unravel like <code>f(2 (f 3 (f 4 (f 5 []))))</code> I would think I'm right, but I get the whole print error and I don't know how to multiply a number with the first element of acc ( head acc doesn't work)</p>\n"}, {"tags": ["haskell", "vector"], "answers": [{"comments": [{"owner": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "edited": false, "score": 0, "creation_date": 1449883396, "post_id": 34234633, "comment_id": 56213936, "body": "Is concatenate (++)  O(n+m) or is there an optimization when concatenating vectors that makes it more efficient?"}], "tags": [], "owner": {"reputation": 3279, "user_id": 1231686, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d259a07003c8f42a90ecb426641e478b?s=128&d=identicon&r=PG", "display_name": "Lumen", "link": "https://stackoverflow.com/users/1231686/lumen"}, "is_accepted": false, "score": 0, "last_activity_date": 1449879178, "creation_date": 1449879178, "answer_id": 34234633, "question_id": 34234517, "link": "https://stackoverflow.com/questions/34234517/how-to-map-a-function-over-a-specific-range-of-a-vector-in-haskell/34234633#34234633", "title": "How to map a function over a specific range of a Vector in Haskell", "body": "<p>How about something like</p>\n\n<pre><code>maprange :: (a -&gt; a) -&gt; [a] -&gt; Int -&gt; Int -&gt; [a]\nmaprange f vector skip nb = (take skip vector) ++ (map f (take nb (drop skip vector))) ++ (drop (skip + nb) vector)\n</code></pre>\n\n<p>and then use it like</p>\n\n<pre><code>*Main&gt; maprange (\\x -&gt; 2*x) [1 .. 10] 3 4\n[1,2,3,8,10,12,14,8,9,10]\n</code></pre>\n\n<p>to double the 4 elements after the first 3 elements.</p>\n"}, {"comments": [{"owner": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "edited": false, "score": 0, "creation_date": 1449968483, "post_id": 34237200, "comment_id": 56235441, "body": "Hey Nikita, thanks for the great answer. Clojure style persistent vectors are basically what I&#39;m looking for.  I guess I had assumed that Haskell&#39;s main Vector library was equivalent to Clojure&#39;s. Is persistent-vector preferable to Data.Sequence?"}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "edited": false, "score": 0, "creation_date": 1449992261, "post_id": 34237200, "comment_id": 56239415, "body": "Unless the author of &quot;persistent-vector&quot; messed up somewhere, it should have an edge over <code>Data.Sequence</code> in most use cases, due to the underlying algorithm."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 3, "last_activity_date": 1449910144, "last_edit_date": 1449910144, "creation_date": 1449903212, "answer_id": 34237200, "question_id": 34234517, "link": "https://stackoverflow.com/questions/34234517/how-to-map-a-function-over-a-specific-range-of-a-vector-in-haskell/34237200#34237200", "title": "How to map a function over a specific range of a Vector in Haskell", "body": "<p>The immutable vector implementation of the \"vector\" package is basically an array. This means that any modifying operation on it requires the traversal of the whole array. That limitation doesn't play well with the requirements that you've mentioned.</p>\n\n<p>Since you're saying that you're open to a choice of a different data-structure, the first thing you need to consider is a data-structure driven by the Array-Mapped Trie algorithm. That algorithm allows you to project on the slices of the data-structure, concatenate, drop/take, append/prepend - all in either a constant or logarithmic time. It's efficiency is proven in production with it driving the ubiquitous immutable vector data-structures of such languages as Clojure and Scala.</p>\n\n<p>Fortunately, Haskell has an implementation as well. It's presented by <a href=\"http://hackage.haskell.org/package/persistent-vector\" rel=\"nofollow\">the \"persistent-vector\" package</a>, and here's how you can efficiently solve your problem using it:</p>\n\n<pre><code>mapOverSlice :: Int -&gt; Int -&gt; (a -&gt; a) -&gt; Vector a -&gt; Vector a\nmapOverSlice startIndex length mapper input =\n  let\n    (split1Heading, split1Trail) =\n      splitAt startIndex input\n    (split2Heading, split2Trail) =\n      splitAt (pred length) split1Trail\n    in\n      split1Heading &lt;&gt;\n      map mapper split2Heading &lt;&gt;\n      split2Trail\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27685, "user_id": 610979, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ku5ga.png?s=128&g=1", "display_name": "Frank Schmitt", "link": "https://stackoverflow.com/users/610979/frank-schmitt"}, "is_accepted": false, "score": 0, "last_activity_date": 1449907683, "creation_date": 1449907683, "answer_id": 34237709, "question_id": 34234517, "link": "https://stackoverflow.com/questions/34234517/how-to-map-a-function-over-a-specific-range-of-a-vector-in-haskell/34237709#34237709", "title": "How to map a function over a specific range of a Vector in Haskell", "body": "<p>One way to to this is</p>\n\n<ul>\n<li>zip your original vector with [1..]\u00a0to get a vector with indices</li>\n<li>map over the zipped vector; if the index is within (skip, skip+nb]\u00a0then apply f, else return the original value</li>\n</ul>\n\n<p>The implementation is pretty straightforward:</p>\n\n<pre><code>maprange :: (a -&gt; a) -&gt; [a] -&gt; Int -&gt; Int -&gt; [a]\nmaprange f vector skip nb = map (\\(idx,v) -&gt; if idx &gt; skip &amp;&amp; idx &lt;= skip+nb then f v else v) zipped_vector\n     where zipped_vector = zip [1..] vector\n</code></pre>\n\n<p>The complexity should be O(n) where n is the size of the original vector (I'm not 100% sure about the complexity of zip, though); if you need something more efficient, you should investigate the data structures mentioned in the answer by Nikita Volkov.</p>\n"}], "owner": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 34237200, "answer_count": 3, "score": 2, "last_activity_date": 1449967986, "creation_date": 1449878235, "last_edit_date": 1449967986, "question_id": 34234517, "link": "https://stackoverflow.com/questions/34234517/how-to-map-a-function-over-a-specific-range-of-a-vector-in-haskell", "title": "How to map a function over a specific range of a Vector in Haskell", "body": "<p>I have a very large Vector a and I want to map a function over a small range. For example, if I have a Vector of size 1000, I want to map function f over values at indices 100-200 and then return the entire updated Vector. What is the best way to do this. I'm open to other data structures, but I would prefer not to use mutable vectors.</p>\n\n<p>Edit:\nHere's an equivalent in imperative code.</p>\n\n<pre><code>for (int i = startIdx; i &lt; endIdx ; i++){\nbigVector[i] = myFunction(bigVector[i]);\n}\n</code></pre>\n"}, {"tags": ["c", "swift", "haskell", "functional-programming", "monads"], "answers": [{"comments": [{"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1449924409, "post_id": 34234328, "comment_id": 56222032, "body": "Thank you - your demo is very useful!"}], "tags": [], "owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "is_accepted": true, "score": 3, "last_activity_date": 1449929608, "last_edit_date": 1449929608, "creation_date": 1449877156, "answer_id": 34234328, "question_id": 34233993, "link": "https://stackoverflow.com/questions/34233993/understanding-bind-function/34234328#34234328", "title": "Understanding bind function", "body": "<p>In C++ I think it would look something like this:</p>\n\n<pre><code>#include &lt;functional&gt;\n#include &lt;string&gt;\n#include &lt;utility&gt;\n\nusing P = std::pair&lt;float, std::string&gt;;\nusing FP = std::function&lt;P(P)&gt;;\n\nFP mbind(std::function&lt;P(float)&gt; f) {\n    return [f](P in) {\n        auto &amp;&amp; res = f(in.first);\n        return {res.first, in.second + res.second};\n    };\n}\n</code></pre>\n\n<p>In C you could do something similar by storing function pointers, though the invocation syntax would have to be more verbose since you'll need to pass the state around explicitly.</p>\n"}, {"tags": [], "owner": {"reputation": 9018, "user_id": 1542569, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e5bfeb320707d1af314a1a0fd683d50a?s=128&d=identicon&r=PG&f=1", "display_name": "courteouselk", "link": "https://stackoverflow.com/users/1542569/courteouselk"}, "is_accepted": false, "score": 2, "last_activity_date": 1449879919, "creation_date": 1449879919, "answer_id": 34234719, "question_id": 34233993, "link": "https://stackoverflow.com/questions/34233993/understanding-bind-function/34234719#34234719", "title": "Understanding bind function", "body": "<p>In Swift, perhaps something like this:</p>\n\n<pre><code>let bind: (Float -&gt; (Float, String)) -&gt; ((Float, String) -&gt; (Float, String)) = { \n    lhs in\n\n    return { \n        rhs in\n\n        let result = lhs(rhs.0)\n        return (result.0, \"\\(result.1); \\(rhs.1)\" )\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1449924307, "post_id": 34235171, "comment_id": 56222005, "body": "Yes, the behavior you said is right.  However, I am not sure from the article whether bind should take one argument or two.  Given that it&#39;s Haskell, I assume it has to be one argument, but not sure how bind should be called."}, {"owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "reply_to_user": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "edited": false, "score": 0, "creation_date": 1449936129, "post_id": 34235171, "comment_id": 56225602, "body": "<code>bind</code> always takes two arguments: the initial value <code>(oldFloat,oldString)</code> and the function <code>oldFloat -&gt; (newFloat,newString)</code>"}], "tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 0, "last_activity_date": 1449883788, "creation_date": 1449883788, "answer_id": 34235171, "question_id": 34233993, "link": "https://stackoverflow.com/questions/34233993/understanding-bind-function/34235171#34235171", "title": "Understanding bind function", "body": "<p>It is a <code>bind</code> for Writer monad. The <code>bind</code> function for that monad should do 2 things: </p>\n\n<ol>\n<li><p>Execute computation with <code>Float</code> value. </p></li>\n<li><p>Update the existing log (a <code>String</code> value). </p></li>\n</ol>\n\n<p>Initially you have a tuple <code>(oldFloat,oldString)</code> and want to apply to this tuple a function with type <code>Float -&gt; (Float,String)</code>. </p>\n\n<p>Your function takes an <code>oldFloat</code> value from tuple <code>(oldFloat,oldString)</code> and returns a tuple <code>(newFloat,newString)</code>. </p>\n\n<p>What behavior do you expect from your <code>bind</code> function? I suppose you want to get a tuple containing a <code>newFloat</code> and updated log <code>oldString ++ new string</code>, right? Here is a straitforward implementation of it: </p>\n\n<pre><code>bind f (oldFloat,oldString) =\n    -- apply function f to oldFloat from tuple (oldFloat,oldString) \n    -- to get a new tuple (newFloat,newString)\n    let (newFloat,newString) = f oldFloat\n    -- you want from your bind function to get a tuple containing \n    -- a newFloat and a newString added to oldString\n    in (newFloat, oldString ++ newString)\n</code></pre>\n"}], "owner": {"reputation": 37416, "user_id": 66814, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/syRQP.jpg?s=128&g=1", "display_name": "Boon", "link": "https://stackoverflow.com/users/66814/boon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 34234328, "answer_count": 3, "score": 3, "last_activity_date": 1449929608, "creation_date": 1449875048, "question_id": 34233993, "link": "https://stackoverflow.com/questions/34233993/understanding-bind-function", "title": "Understanding bind function", "body": "<p>In this <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow\">article</a>, the author explains monad using this example (I am guessing Haskell is used):</p>\n\n<blockquote>\n  <p>bind f' :: (Float,String) -> (Float,String)</p>\n  \n  <p>which implies that</p>\n  \n  <p>bind :: (Float -> (Float,String)) -> ((Float,String) ->\n  (Float,String))</p>\n</blockquote>\n\n<p>and proceed to ask to implement the function bind and offer the solution as:</p>\n\n<pre><code>bind f' (gx,gs) = let (fx,fs) = f' gx in (fx,gs++fs)\n</code></pre>\n\n<p>I am having problem understanding the solution. What would this look like in C or Swift?</p>\n\n<p>I have gone as far as I can implementing the example and I am stuck at implementing bind:</p>\n\n<pre><code>let f: Float -&gt; Float = { value in return 2 * value }\nlet g: Float -&gt; Float = { value in return 10 + value }\n\nlet ff: Float -&gt; (Float, String) = { value in return (f(value), \"f called\") }\nlet gg: Float -&gt; (Float, String) = { value in return (g(value), \"f called\") }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1449871919, "post_id": 34231683, "comment_id": 56210596, "body": "Welcome to stackoverflow. Thanks for including a small, self-contained test case -- it makes everything easier! (upvoted!). I updated the question with actual and expected values to make it even easier to diagnose."}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1449906357, "post_id": 34231683, "comment_id": 56217715, "body": "Note that function calls do not need parentheses. You can write <code>print area</code> and <code>print $ a </code>mod` y`. The second one is a matter of personal preference."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1449914988, "last_edit_date": 1449914988, "creation_date": 1449865120, "answer_id": 34231888, "question_id": 34231683, "link": "https://stackoverflow.com/questions/34231683/mod-div-in-haskell/34231888#34231888", "title": "mod, div in Haskell", "body": "<p>Simple; take a look at the types of <code>(**)</code> and <code>mod</code>:</p>\n\n<pre><code>Prelude&gt; :t (**)\n(**) :: Floating a =&gt; a -&gt; a -&gt; a\nPrelude&gt; :t mod\nmod :: Integral a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>It is a rare numeric type that has <em>both</em> the characteristics of an integer <em>and</em> the characteristics of a floating-point number. You have a couple of choices for dealing with this:</p>\n\n<ol>\n<li>Use an exponentiation operation that handles integer-like numbers well. For example, <code>(^) :: (Integral b, Num a) =&gt; a -&gt; b -&gt; a</code>.</li>\n<li>Use a modulus operation that handles floating-point numbers well. For example, <code>mod' :: Real a =&gt; a -&gt; a -&gt; a</code>.</li>\n<li>Explicitly convert to a floating-point type with <code>realToFrac :: (Real a, Fractional b) =&gt; a -&gt; b</code> before calling <code>(**)</code>.</li>\n<li>Explicitly convert to an integer-like type with <code>floor :: (RealFrac a, Integral b) =&gt; a -&gt; b</code> (or another rounding function) before calling <code>mod</code>.</li>\n</ol>\n"}], "owner": {"reputation": 73, "user_id": 4524756, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/67cc227a4067dd4f5bcb3cf596ce5711?s=128&d=identicon&r=PG&f=1", "display_name": "Rivalez", "link": "https://stackoverflow.com/users/4524756/rivalez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2879, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1449914988, "creation_date": 1449864356, "last_edit_date": 1449871713, "question_id": 34231683, "link": "https://stackoverflow.com/questions/34231683/mod-div-in-haskell", "title": "mod, div in Haskell", "body": "<p>Can someone explain why this doesn't work?</p>\n\n<pre><code>main = do\n    let a = 50\n    let y = 7\n    let area = (a ** y) \n    print (area)   \n    print (a `mod` y)\n</code></pre>\n\n<p>I expected it to print:</p>\n\n<pre><code>781250000000   -- 50 to the 7th power\n1              -- remainder of 50/7\n</code></pre>\n\n<p>But instead I get a series of ambiguous type errors like this:</p>\n\n<pre><code>test.hs:2:13:\n    No instance for (Num a0) arising from the literal `50'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n</code></pre>\n"}, {"tags": ["haskell", "sqlite"], "answers": [{"comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1590998787, "post_id": 34276062, "comment_id": 109880605, "body": "I should point out that in the intervening five years opaleye-sqlite has become unmaintained.  It could be brought up to date but would require someone to put in the effort."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": false, "score": 5, "last_activity_date": 1450125093, "creation_date": 1450125093, "answer_id": 34276062, "question_id": 34231581, "link": "https://stackoverflow.com/questions/34231581/what-are-the-tradeoffs-between-the-haskell-sqlite-packages/34276062#34276062", "title": "What are the tradeoffs between the Haskell SQLite packages?", "body": "<p>I've had very good experiences with the ...-simple family of libraries.  They are very full-featured and sit at a nice medium level of abstraction where you get a large amount of flexibility over how you intereact with the database.</p>\n\n<p>I'm the author of <a href=\"https://hackage.haskell.org/package/opaleye-sqlite\" rel=\"noreferrer\">opaleye-sqlite</a>.  It is a somewhat experimental version of Opaleye for SQLite.  The Postgres version of Opaleye is very solid and used in production in several places, but I only know of one person who has used opaleye-sqlite in production.</p>\n"}, {"tags": [], "owner": {"reputation": 4250, "user_id": 1833322, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c32eff9bf6efb2b8e496407efa690e99?s=128&d=identicon&r=PG", "display_name": "Flip", "link": "https://stackoverflow.com/users/1833322/flip"}, "is_accepted": false, "score": 6, "last_activity_date": 1534367901, "creation_date": 1534367901, "answer_id": 51866574, "question_id": 34231581, "link": "https://stackoverflow.com/questions/34231581/what-are-the-tradeoffs-between-the-haskell-sqlite-packages/51866574#51866574", "title": "What are the tradeoffs between the Haskell SQLite packages?", "body": "<p>I looked at the package mentioned. Some of these package are a dependency of another package (like opaleye-sqlite and sqlite-simple) depend on direct-sqlite.</p>\n\n<p>Therefor lets first look at the package that provide the actual driver. Most of them are outdated. There seem to be 3 that still have recent updates:</p>\n\n<ul>\n<li><p><a href=\"https://hackage.haskell.org/package/simplest-sqlite\" rel=\"noreferrer\">https://hackage.haskell.org/package/simplest-sqlite</a> <a href=\"https://github.com/YoshikuniJujo/test_haskell/tree/master/features/ffi/sqlite3/simplest-sqlite\" rel=\"noreferrer\">https://github.com/YoshikuniJujo/test_haskell/tree/master/features/ffi/sqlite3/simplest-sqlite</a> i wouldn't use it because the repository says \"It's just my private Haskell learning/testing repository.\"</p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/persistent-sqlite\" rel=\"noreferrer\">https://hackage.haskell.org/package/persistent-sqlite</a> this one is based on direct-sqlite (seems like part of the direct-sqlite has been forked)</p></li>\n<li><p>The last one being the direct-sqlite package. I used <a href=\"https://packdeps.haskellers.com/reverse/direct-sqlite\" rel=\"noreferrer\">this website</a> to find which package depend on direct-sqlite. Now leaving out package that don't have the purpose of working with sqlite (such as bake: Continuous integration system). And also leaving out packages that haven't seen updates in a long time.</p></li>\n</ul>\n\n<p>That leaves us with the following package that provide extra functionality based on direct-sqlite. This list includes more levels of reverse lookup to see which other package make use of the package listed below.</p>\n\n<ul>\n<li><p><a href=\"https://github.com/yesodweb/persistent/tree/master/persistent-sqlite\" rel=\"noreferrer\">persistent-sqlite</a> as mentioned before</p>\n\n<ul>\n<li><a href=\"https://github.com/bitemyapp/esqueleto\" rel=\"noreferrer\">esqueleto\n</a></li>\n<li><a href=\"https://github.com/jdreaver/eventful\" rel=\"noreferrer\">eventful</a></li>\n</ul></li>\n<li><p><a href=\"https://github.com/lykahb/groundhog\" rel=\"noreferrer\">groundhog-sqlite</a></p></li>\n<li><a href=\"https://github.com/tomjaguarpaw/haskell-opaleye\" rel=\"noreferrer\">opaleye-sqlite</a></li>\n<li><a href=\"https://github.com/valderman/selda\" rel=\"noreferrer\">selda-sqlite</a></li>\n<li><a href=\"https://github.com/nurpax/sqlite-simple\" rel=\"noreferrer\">sqlite-simple</a>\n\n<ul>\n<li><a href=\"https://github.com/tathougies/beam\" rel=\"noreferrer\">beam-sqlite</a></li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2230, "favorite_count": 2, "answer_count": 2, "score": 9, "last_activity_date": 1534367901, "creation_date": 1449863967, "last_edit_date": 1449864665, "question_id": 34231581, "link": "https://stackoverflow.com/questions/34231581/what-are-the-tradeoffs-between-the-haskell-sqlite-packages", "title": "What are the tradeoffs between the Haskell SQLite packages?", "body": "<p>There are many Haskell SQLite bindings, which implies to me that there are many different tradeoffs on using building/using a SQLite binding. I've tried to read through the documentation of many of these packages but it became a blur after a while, and I was unable to really identify the primary tradeoffs of choosing one over another. </p>\n\n<p>A search on Hackage finds:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/direct-sqlite\" rel=\"noreferrer\">direct-sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/HDBC-sqlite3\" rel=\"noreferrer\">HDBC-sqlite3</a></li>\n<li><a href=\"https://hackage.haskell.org/package/hdbi-sqlite\" rel=\"noreferrer\">hdbi-sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/hsql-sqlite3\" rel=\"noreferrer\">hsql-sqlite3</a></li>\n<li><a href=\"https://hackage.haskell.org/package/hsSqlite3\" rel=\"noreferrer\">hsSqlite3</a></li>\n<li><a href=\"https://hackage.haskell.org/package/persistent-sqlite\" rel=\"noreferrer\">persistent-sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/simplest-sqlite\" rel=\"noreferrer\">simplest-sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/sql-simple-sqlite\" rel=\"noreferrer\">sql-simple-sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/sqlite\" rel=\"noreferrer\">sqlite</a></li>\n<li><a href=\"https://hackage.haskell.org/package/sqlite-simple\" rel=\"noreferrer\">sqlite-simple</a></li>\n<li><a href=\"https://hackage.haskell.org/package/sqlite-simple-typed\" rel=\"noreferrer\">sqlite-simple-typed</a></li>\n<li><a href=\"https://hackage.haskell.org/package/bindings-sqlite3\" rel=\"noreferrer\">bindings-sqlite3</a></li>\n</ul>\n\n<p>Nevermind some \"meta\" SQLite packages. <a href=\"https://hackage.haskell.org/package/haskelldb-hdbc-sqlite3\" rel=\"noreferrer\">haskelldb-hdbc-sqlite3</a>, <a href=\"https://hackage.haskell.org/package/haskelldb-hsql-sqlite3\" rel=\"noreferrer\">haskelldb-hsql-sqlite3</a>, <a href=\"https://hackage.haskell.org/package/language-sqlite\" rel=\"noreferrer\">language-sqlite</a>, <a href=\"https://hackage.haskell.org/package/opaleye-sqlite\" rel=\"noreferrer\">opaleye-sqlite</a></p>\n\n<p>Hoping that someone has been able to do this successfully and can help me understand how to choose.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1449862933, "post_id": 34230872, "comment_id": 56206308, "body": "Perhaps generics or SYB can help here, as long as you can add some <code>deriving ...</code> causes and enable a few GHC extensions. Template Haskell can also be used, I believe, but it looks overkill for this."}, {"owner": {"reputation": 613, "user_id": 297666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91f5a549b0c4e1b35bec9b62457a02e2?s=128&d=identicon&r=PG", "display_name": "Jason Hite", "link": "https://stackoverflow.com/users/297666/jason-hite"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449864370, "post_id": 34230872, "comment_id": 56207095, "body": "I played with TH some but it was a lot of headache. I figured there had to be something simple."}, {"owner": {"reputation": 613, "user_id": 297666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91f5a549b0c4e1b35bec9b62457a02e2?s=128&d=identicon&r=PG", "display_name": "Jason Hite", "link": "https://stackoverflow.com/users/297666/jason-hite"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449865296, "post_id": 34230872, "comment_id": 56207600, "body": "PS: The reason I say it seems easy is because the auto-derived show <i>almost</i> does what I want, I just want to tweak it a bit. I know that <code>deriving Show</code> invokes some magic under the hood, but it&#39;s so tantalizing."}], "answers": [{"comments": [{"owner": {"reputation": 613, "user_id": 297666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91f5a549b0c4e1b35bec9b62457a02e2?s=128&d=identicon&r=PG", "display_name": "Jason Hite", "link": "https://stackoverflow.com/users/297666/jason-hite"}, "edited": false, "score": 0, "creation_date": 1449876680, "post_id": 34233787, "comment_id": 56212377, "body": "I came across that article too and came up with something that works well enough <a href=\"https://gist.github.com/jasonmhite/1fa474351af5d14a66ff\" rel=\"nofollow noreferrer\">here</a>, but I can&#39;t say I really understand <i>why</i> it works. I&#39;m having a hard time figuring out what is going on with <code>toConstr</code>."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1449873954, "creation_date": 1449873954, "answer_id": 34233787, "question_id": 34230872, "link": "https://stackoverflow.com/questions/34230872/custom-text-representation-for-sum-type/34233787#34233787", "title": "Custom text representation for sum type", "body": "<p>You could derive <code>Data.Data</code> for your ADT, which exposes a generic descriptor for any custom data type. Then you can write a function that renders any instance of <code>Data</code> in the not-quite-like-Show fashion you need. It's certainly overkill for a single smallish type like Shape, but you could reuse it for multiple, larger types.</p>\n\n<p>I'm not totally familiar with the API for doing so, but <a href=\"http://chrisdone.com/posts/data-typeable\" rel=\"nofollow\">http://chrisdone.com/posts/data-typeable</a> ends with an example of writing a generic function with a signature close to <code>gshow :: Data d =&gt; d -&gt; String</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 3, "last_activity_date": 1449933556, "last_edit_date": 1449933556, "creation_date": 1449877453, "answer_id": 34234390, "question_id": 34230872, "link": "https://stackoverflow.com/questions/34230872/custom-text-representation-for-sum-type/34234390#34234390", "title": "Custom text representation for sum type", "body": "\n\n<p>This is an <em>ideal</em> usage of generics. Our strategy will be to convert the datatype into its generic representation (<code>from :: (Generic a) =&gt; a -&gt; Rep a</code>) and then recurse into <code>Rep a</code>. <code>Rep a</code> is actually a type function, so let's see what it looks like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :info Shape\n[lots of garbage]\ntype instance Rep Shape\n  = D1\n      Main.D1Shape\n      (C1\n         Main.C1_0Shape\n         (S1 NoSelector (Rec0 Int)\n          :*: (S1 NoSelector (Rec0 Float) :*: S1 NoSelector (Rec0 Float)))\n       :+: (C1\n              Main.C1_1Shape\n              (S1 NoSelector (Rec0 Int) :*: S1 NoSelector (Rec0 Float))\n            :+: C1\n                  Main.C1_2Shape\n                  (S1 NoSelector (Rec0 Int)\n                   :*: (S1 NoSelector (Rec0 Float) :*: S1 NoSelector (Rec0 Float)))))\n</code></pre>\n\n<p>Oof. We're in higher-kinded territory here. To traverse this data structure we'll need to recurse into the type itself. Whereas value recursion works by repeatedly calling a function on smaller and smaller parts of a data structure, we will create a one-method class called <code>Jason</code> and then instantiate the method on smaller and smaller parts of the type.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport GHC.Generics\n\ndata Shape = Rectangle Int Float Float |\n             Circle Int Float |\n             Ellipse Int Float Float\n             deriving (Show, Eq, Generic)\n\nclass Jason a where\n  jasonShow :: a -&gt; String\n\n-- Integers can use the regular show.\ninstance Jason Float where jasonShow = show\n-- So can floats.\ninstance Jason Int where jasonShow = show\n\n-- Constant values are easy.\ninstance (Jason c) =&gt; Jason (K1 i c p) where jasonShow = jasonShow . unK1\n\n-- Use generics to pattern match into constructors.\ninstance (Jason (f p), Constructor c) =&gt; Jason (M1 C c f p) where\n  jasonShow constructor@(M1 x) = conName constructor ++ \",\" ++ jasonShow x\n\n-- We don't care about selectors.\ninstance (Jason (f p)) =&gt; Jason (M1 S c f p) where\n  jasonShow (M1 x) = jasonShow x\n\n-- Or whether something is a datatype or not.\ninstance (Jason (f p)) =&gt; Jason (M1 D c f p) where\n  jasonShow (M1 x) = jasonShow x\n\n-- We don't care about the index into the disjoint union (a.k.a. \"|\") of a datatype.\ninstance (Jason (f p), Jason (g p)) =&gt; Jason ((f :+: g) p) where\n  jasonShow (L1 x) = jasonShow x\n  jasonShow (R1 x) = jasonShow x\n\n-- We want to insert a comma when we encounter a product in the datatype.\ninstance (Jason (f p), Jason (g p)) =&gt; Jason ((f :*: g) p) where\n  jasonShow (x :*: y) = jasonShow x ++ \",\" ++ jasonShow y\n\nrenderShape :: Shape -&gt; String\nrenderShape = (++ \";\") . jasonShow . from\n</code></pre>\n\n<p>To output commas for products and the name of the constructor, we special cased those instances:</p>\n\n<ul>\n<li><p><code>M1 C c f p</code> is a type for the meta-information (<code>M</code>) for a constructor (<code>C</code>) wrapped around a value <code>f p</code>. Calling <code>conName</code> on a value of this type will helpfully return a string representing the name of the constructor.</p></li>\n<li><p><code>(f :*: g) p</code> is a type for the product of two values of type <code>f p</code> and <code>g p</code>. Earlier, when we queried for the type of our rectangle, you can see this appear in a couple of places. For example <code>M1 S NoSelector (Rec0 Float) :*: M1 S NoSelector (Rec0 Float)</code> (I expanded out the <code>type S1 = M1 S</code> alias). You can think of <code>:*:</code> as the glue between the numbers in <code>Rectangle 1 2 2</code>.</p></li>\n<li><p>Our base cases in the recursion are <code>Int</code> and <code>Float</code>. We can keep defining more base cases, but our shape is just ints and floats.</p></li>\n</ul>\n\n<p>This is pretty weird code! You don't see so so many esoteric datatypes with weird two-character names everyday. But we did arrive at this nice result:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; renderShape (Rectangle 1 2 2)\n\"Rectangle,1,2.0,2.0;\"\n\u03bb&gt; renderShape (Circle 1 2)\n\"Circle,1,2.0;\"\n\u03bb&gt; renderShape (Ellipse 1 2 2)\n\"Ellipse,1,2.0,2.0;\"\n</code></pre>\n\n<p>It's also a lot of code. But it's <em>generic</em> code, which means you can reuse it with other, non-Shape datatypes.</p>\n\n<h3>on language extensions</h3>\n\n<ul>\n<li><p>DeriveGeneric: allows <code>derive (Generic)</code>, which automatically instances <code>Generic</code> for our datatype <code>Shape</code>.</p></li>\n<li><p>FlexibleContexts: without this, we can't say <code>instance (Jason (f p), Constructor c) =&gt; Jason (M1 C c f p)</code>. The Haskell spec disallows constraints like <code>Jason (f p)</code>. <code>Jason p</code> is OK, but <code>Jason (f p)</code> is no go. Fortunately, GHC is flexible.</p></li>\n<li><p>FlexibleInstances: allows destruct <code>M1 i c f p</code> into three different instances: <code>M1 C c f p</code>, <code>M1 D c f p</code>, and <code>M1 S c f p</code>. Normally disallowed by the spec.</p></li>\n<li><p>TypeOperators: allows the usage of infix type functions <code>:*:</code> and <code>:+:</code>.</p></li>\n</ul>\n\n<h2>see</h2>\n\n<ul>\n<li><p><a href=\"https://hackage.haskell.org/package/base/docs/GHC-Generics.html\" rel=\"nofollow\">GHC.Generics documentation</a></p></li>\n<li><p><a href=\"https://github.com/bos/aeson/blob/master/Data/Aeson/Types/Generic.hs\" rel=\"nofollow\">Using generics to implement JSON encoding/decoding</a></p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/generic-deriving-0.3/docs/src/Generics-Deriving-Show.html\" rel=\"nofollow\">This implementation of Show (just regular Show) with generics</a></p></li>\n<li><p><a href=\"http://jozefg.bitbucket.org/posts/2014-04-25-you-could-have.html\" rel=\"nofollow\">You could've invented GHC.Generics</a> \u2013 a great tutorial</p></li>\n</ul>\n"}], "owner": {"reputation": 613, "user_id": 297666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91f5a549b0c4e1b35bec9b62457a02e2?s=128&d=identicon&r=PG", "display_name": "Jason Hite", "link": "https://stackoverflow.com/users/297666/jason-hite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 34234390, "answer_count": 2, "score": 1, "last_activity_date": 1449933556, "creation_date": 1449861163, "last_edit_date": 1449865657, "question_id": 34230872, "link": "https://stackoverflow.com/questions/34230872/custom-text-representation-for-sum-type", "title": "Custom text representation for sum type", "body": "<p>I'm having trouble grappling with how to turn a sum type into a string without doing a whole bunch of pattern matching. A [simplified] example might be something like this:</p>\n\n<pre><code>data Shape = Rectangle Int Float Float |\n             Circle Int Float |\n             Ellipse Int Float Float\n             deriving (Show, Eq) \n</code></pre>\n\n<p>What I want is a function <code>renderShape :: Shape -&gt; String</code> that takes a <code>Shape</code> and gives me a string that represents the argument in a certain way (I'm generating lines in an input file for a simulation program). Note that I would like this to be distinct from <code>show</code>, as it is doing a bit of extra formatting beyond just turning the data structure into a string. What I actually need it to do is kind of complicated, but for example purposes (because if you can explain generally how to do this I think I can work out the rest), let's just say I want to stick a semicolon on the end and separate with a comma e.g.</p>\n\n<pre><code>renderShape $ Rectangle 1 2 2\n&gt;&gt; \"Rectangle,1,2,2;\"\n</code></pre>\n\n<p>Specifically, what I'm struggling with is that the different constructors for the type have varying number of arguments. I could do something with pattern matching, like</p>\n\n<pre><code>renderShape (Rectangle i x y) = (intercalate \",\" [\"Rectangle\", show i, show x, show y]) ++ \";\"\nrenderShape (Circle i x) = ...\n...\n</code></pre>\n\n<p>but I'd prefer not to as in reality I have a ton of these types of shapes so it'd be awfully tedious.</p>\n\n<p>I've found something that \"works\" by abusing the derived <code>show</code> instance and simply transforming the string, but it seems really ugly:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.List (intercalate)\n\nrenderShape :: Shape -&gt; String\nrenderShape s = intercalate \",\" theWords ++ \";\"\n  where theWords = (words . show) s\n</code></pre>\n\n<p>So my question is, what's the \"nice\" way to do this? It seems to me like there has to be a simple and clean way to go about it, but I can't figure it out for the life of me. I'm also not hugely experienced with Haskell, so if my whole approach is fundamentally wrong or non-idiomatic then I'd welcome alternatives.</p>\n"}, {"tags": ["haskell", "types", "linear-types"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1449851251, "post_id": 34227536, "comment_id": 56200142, "body": "Could you use phantom types to indicate wether a cake has been eaten - like <code>data Cake a = Cake</code> and <code>data Eaten</code>, <code>data Fresh</code> then <code>bake = Cake :: Cake Fresh</code> and <code>eat :: Cake Fresh -&gt; Cake Eaten; eat Cake = Cake</code>?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1449851548, "post_id": 34227536, "comment_id": 56200304, "body": "@epsilonhalbe Sure, but if you then did <code>eatenCookie &lt;- uneatenCookie</code>, nothing would stop you from using <code>uneatenCookie</code> afterwards."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1449852042, "post_id": 34227536, "comment_id": 56200589, "body": "I see - thus you would need to write your own version of <code>&lt;-</code> that takes care of clearing <code>uneatenCookie</code>, but I think that is beyond my haskpertise."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1449859728, "post_id": 34227536, "comment_id": 56204673, "body": "Possibly useful: <a href=\"http://functorial.com/Embedding-a-Full-Linear-Lambda-Calculus-in-Haskell/linearlam.pdf\" rel=\"nofollow noreferrer\">Embedding a Full Linear Lambda Calculus in Haskell</a>. I&#39;ve seen another paper with a similar approach, but I&#39;m having trouble finding it now..."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1449861117, "post_id": 34227536, "comment_id": 56205374, "body": "<a href=\"https://github.com/effectfully/random-stuff/blob/master/Kitchen.agda\" rel=\"nofollow noreferrer\">Here</a> is a naive way to do this in Agda."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1449860265, "post_id": 34228722, "comment_id": 56204946, "body": "<code>withCake (\\cake -&gt; eat cake `afterCake` (\\() -&gt; withCake (\\cake&#39; -&gt; eat cake)))</code> looks like it eats <code>cake</code> twice (and <code>cake&#39;</code> no times)."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449861877, "post_id": 34228722, "comment_id": 56205748, "body": "@Daniel Wagner You are right. Perhaps phantom type techniques &#224; la ST monad could plug that hole."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1449856708, "last_edit_date": 1449856708, "creation_date": 1449853220, "answer_id": 34228722, "question_id": 34227536, "link": "https://stackoverflow.com/questions/34227536/is-there-a-way-to-emulate-linear-types-in-haskell/34228722#34228722", "title": "Is there a way to emulate linear types in Haskell?", "body": "<p>A partial solution. We could define a wrapper type </p>\n\n<pre><code>data Caked a = Caked { getCacked :: IO a } -- ^ internal constructor\n</code></pre>\n\n<p>of which we do not export the constructor/accessor. </p>\n\n<p>It would have two almost-but-not-quite-like-bind functions:</p>\n\n<pre><code>beforeCake :: IO a -&gt; (a -&gt; Caked b) -&gt; Caked b\nbeforeCake a f = Caked (a &gt;&gt;= getCaked . f)\n\nafterCake :: Caked a -&gt; (a -&gt; IO b) -&gt; Caked b\nafterCake (Caked a) f = Caked (a &gt;&gt;= f)\n</code></pre>\n\n<p>The only way for clients to create <code>Caked</code> values would be through:</p>\n\n<pre><code>eat :: Cake -&gt; Caked ()\neat = undefined\n\nkeep :: Cake -&gt; Caked ()\nkeep = undefined\n</code></pre>\n\n<p>And we would allocate <code>Cake</code> values on a callback:</p>\n\n<pre><code>withCake :: (Cake -&gt; Caked b) -&gt; IO b\nwithCake = undefined\n</code></pre>\n\n<p>This, I think, would ensure that <code>eat</code> and <code>keep</code> only get called once within the callback.</p>\n\n<p>Problems: doesn't work with multiple <code>Cake</code> allocations and <code>Cake</code> values can still escape the scope of the callback (could  phantom types help here?)</p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 7, "last_activity_date": 1449860217, "creation_date": 1449860217, "answer_id": 34230637, "question_id": 34227536, "link": "https://stackoverflow.com/questions/34227536/is-there-a-way-to-emulate-linear-types-in-haskell/34230637#34230637", "title": "Is there a way to emulate linear types in Haskell?", "body": "<p>Polakow showed in his Haskell Symposium paper <a href=\"http://functorial.com/Embedding-a-Full-Linear-Lambda-Calculus-in-Haskell/linearlam.pdf\">Embedding a full linear lambda calculus in Haskell (pdf)</a> how to do so.</p>\n\n<p>The main idea is to index each constructor with an input and an output context tracking the resources consumed in the various subterms.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1449914877, "post_id": 34231618, "comment_id": 56219688, "body": "<a href=\"https://github.com/effectfully/random-stuff/blob/master/FreeKitchen.agda\" rel=\"nofollow noreferrer\">Here</a> is the same, but with strictly-positive indexed free monads over indexed (only shapes are indexed) containers. I didn&#39;t include the <code>keep</code> constructor, since I&#39;m not satisfied by the fact that <code>keep</code> doesn&#39;t change neither input nor output index. It seems to me that <code>keep</code> should exclude a cake from a context like <code>eat</code>, but include the cake in the output. My <a href=\"https://github.com/effectfully/random-stuff/blob/master/Kitchen.agda\" rel=\"nofollow noreferrer\">original code</a> does that,but I guess we need to double-index the <code>BakeF</code> functor then."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1449923437, "post_id": 34231618, "comment_id": 56221801, "body": "Thanks, that&#39;s a nice and clean containers example (I haven&#39;t yet gotten around learning much about them)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1449948701, "post_id": 34231618, "comment_id": 56229794, "body": "And <a href=\"https://github.com/effectfully/random-stuff/blob/master/FreerKitchen.agda\" rel=\"nofollow noreferrer\">the same</a> using a <a href=\"http://okmij.org/ftp/Haskell/extensible/more.pdf\" rel=\"nofollow noreferrer\"><code>Freer</code></a> monad."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 15, "last_activity_date": 1449903597, "last_edit_date": 1449903597, "creation_date": 1449864120, "answer_id": 34231618, "question_id": 34227536, "link": "https://stackoverflow.com/questions/34227536/is-there-a-way-to-emulate-linear-types-in-haskell/34231618#34231618", "title": "Is there a way to emulate linear types in Haskell?", "body": "<p>In Haskell, a basic version of this could be expressed with a GADT indexed by a store of cakes (represented by a list of <code>Nat</code>-s):</p>\n\n<pre><code>{-# LANGUAGE\n  TypeFamilies, GADTs, TypeOperators, PartialTypeSignatures,\n  DataKinds, PolyKinds #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\nimport GHC.Exts\n\n-- Allocate a new cake\ntype family New cs where\n  New '[]       = 0\n  New (c ': cs) = c + 1\n\n-- Constraint satisfiable if \"c\" is in \"cs\"\ntype family Elem c cs :: Constraint where\n  Elem c (c ': cs)  = ()\n  Elem c (c' ': cs) = Elem c cs\n\ntype family Remove c cs where\n  Remove c '[]        = '[]  \n  Remove c (c ': cs)  = cs\n  Remove c (c' ': cs) = c' ': Remove c cs\n\ndata Bake :: [Nat] -&gt; [Nat] -&gt; * -&gt; * where\n  Pure :: a -&gt; Bake cs cs a\n  Bake :: (Proxy (New cs) -&gt; Bake (New cs ': cs) cs' a) -&gt; Bake cs cs' a\n  Eat  :: Elem c cs =&gt; Proxy c -&gt; Bake (Remove c cs) cs' a -&gt; Bake cs cs' a\n  Keep :: Elem c cs =&gt; Proxy c -&gt; Bake cs cs' a -&gt; Bake cs cs' a\n\nok :: Bake '[] _ _\nok =\n  Bake $ \\cake1 -&gt;\n  Bake $ \\cake2 -&gt;\n  Eat cake1 $\n  Keep cake2 $\n  Eat cake2 $\n  Pure ()\n\nnot_ok :: Bake '[] _ _\nnot_ok =\n  Bake $ \\cake1 -&gt;\n  Bake $ \\cake2 -&gt;\n  Eat cake1 $\n  Keep cake1 $ -- we already ate that\n  Eat cake2 $\n  Pure ()  \n</code></pre>\n\n<p>Unfortunately we can't remove the type annotations from <code>Bake</code> actions and leave types to be inferred:</p>\n\n<pre><code>foo =\n  Bake $ \\cake1 -&gt;\n  Bake $ \\cake2 -&gt;\n  Eat cake1 $\n  Pure ()\n\n-- Error: Could not deduce (Elem (New cs0) (New cs0 + 1 : New cs0 : cs0))\n</code></pre>\n\n<p>Obviously, <code>(Elem (New cs0) (New cs0 + 1 : New cs0 : cs0))</code> is satisfiable for all <code>cs0</code>, but GHC can't see this, because it cannot decide whether <code>New cs0</code> is inequal to <code>New cs0 + 1</code>, because GHC can't assume anything about the flexible <code>cs0</code> variable. </p>\n\n<p>If we add <code>NoMonomorphismRestriction</code>, <code>foo</code> would typecheck, but that would make even incorrect programs typecheck by pushing all the <code>Elem</code> constraints to the top. This would still prevent doing anything useful with incorrect terms though, but it's a rather ugly solution.</p>\n\n<hr>\n\n<p>More generally, we can express <code>Bake</code> as an indexed free monad, which gets us <code>do</code>-notation with <code>RebindableSyntax</code>, and allows a definition for <code>BakeF</code> that is somewhat clearer than what we've seen before. It could also reduce boilerplate much like the plain old <code>Free</code> monad, although I find it rather unlikely that people would find use for indexed free monads on two different occasions in practical code. </p>\n\n<pre><code>{-# LANGUAGE\n  TypeFamilies, GADTs, TypeOperators, PartialTypeSignatures, StandaloneDeriving,\n  DataKinds, PolyKinds, NoImplicitPrelude, RebindableSyntax, DeriveFunctor #-}\n\nimport Prelude hiding (Monad(..))\nimport GHC.TypeLits\nimport Data.Proxy\nimport GHC.Exts\n\nclass IxFunctor f where\n  imap :: (a -&gt; b) -&gt; f i j a -&gt; f i j b\n\nclass IxFunctor m =&gt; IxMonad m where\n  return :: a -&gt; m i i a\n  (&gt;&gt;=)  :: m i j a -&gt; (a -&gt; m j k b) -&gt; m i k b\n  fail   :: String -&gt; m i j a\n\ninfixl 1 &gt;&gt;\ninfixl 1 &gt;&gt;=\n\n(&gt;&gt;) :: IxMonad m =&gt; m i j a -&gt; m j k b -&gt; m i k b\nma &gt;&gt; mb = ma &gt;&gt;= const mb\n\ndata IxFree f i j a where\n  Pure :: a -&gt; IxFree f i i a\n  Free :: f i j (IxFree f j k a) -&gt; IxFree f i k a\n\nliftf :: IxFunctor f =&gt; f i j a -&gt; IxFree f i j a\nliftf = Free . imap Pure\n\ninstance IxFunctor f =&gt; IxFunctor (IxFree f) where\n  imap f (Pure a)  = Pure (f a)\n  imap f (Free fa) = Free (imap (imap f) fa)\n\ninstance IxFunctor f =&gt; IxMonad (IxFree f) where\n  return = Pure\n  Pure a  &gt;&gt;= f = f a\n  Free fa &gt;&gt;= f = Free (imap (&gt;&gt;= f) fa)\n  fail = error\n\n-- Old stuff for Bake\n\ntype family New cs where\n  New '[]       = 0\n  New (c ': cs) = c + 1\n\ntype family Elem c cs :: Constraint where\n  Elem c (c ': cs)  = ()\n  Elem c (c' ': cs) = Elem c cs\n\ntype family Remove c cs where\n  Remove c '[]        = '[]  \n  Remove c (c ': cs)  = cs\n  Remove c (c' ': cs) = c' ': Remove c cs\n\n-- Now the return type indices of BakeF directly express the change\n-- from the old store to the new store.\ndata BakeF cs cs' k where\n  BakeF :: (Proxy (New cs) -&gt; k) -&gt; BakeF cs (New cs ': cs) k\n  EatF  :: Elem c cs =&gt; Proxy c -&gt; k -&gt; BakeF cs (Remove c cs) k\n  KeepF :: Elem c cs =&gt; Proxy c -&gt; k -&gt; BakeF cs cs k\n\nderiving instance Functor (BakeF cs cs')\ninstance IxFunctor BakeF where imap = fmap\n\ntype Bake = IxFree BakeF\n\nbake   = liftf (BakeF id)\neat  c = liftf (EatF c ())\nkeep c = liftf (KeepF c ())\n\nok :: Bake '[] _ _\nok = do\n  cake1 &lt;- bake\n  cake2 &lt;- bake\n  eat cake1\n  keep cake2\n  eat cake2\n\n-- not_ok :: Bake '[] _ _\n-- not_ok = do\n--   cake1 &lt;- bake\n--   cake2 &lt;- bake\n--   eat cake1\n--   keep cake1 -- already ate it\n--   eat cake2\n</code></pre>\n"}], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1155, "favorite_count": 10, "accepted_answer_id": 34231618, "answer_count": 3, "score": 26, "last_activity_date": 1449903597, "creation_date": 1449849274, "question_id": 34227536, "link": "https://stackoverflow.com/questions/34227536/is-there-a-way-to-emulate-linear-types-in-haskell", "title": "Is there a way to emulate linear types in Haskell?", "body": "<p>I am modeling a system that has an operation that creates a resource and other operations that consume that resource. However, a given resource can only be consumed once - is there a way that I can guarantee that at compile time?</p>\n\n<p>For concreteness, lets say the first operation bakes a cake and that there are two other operations, one for \"choosing to eat\" the cake and one for \"choosing to have the cake\" and that I can only do one or the other.</p>\n\n<pre><code>-- This is my current \"weakly typed\" interface:\nbake :: IO Cake\neat  :: Cake -&gt; IO ()\nkeep :: Cake -&gt; IO ()\n\n-- This is OK\ndo\n  brownie &lt;- bake\n  muffin &lt;- bake\n  eat brownie\n  keep muffin\n\n-- Eating and having the same cake is not OK:\ndo\n  brownie &lt;- bake\n  eat brownie\n  keep brownie -- oops! already eaten!\n</code></pre>\n\n<p>Its easy to enforce the restriction of not keeping an already eaten cake (or vice versa) at runtime by setting an flag on the cake after we use it. But is there a way to enforce this at compile time?</p>\n\n<p>BTW, this question is meant for a proof of concept so I am OK with any black magic that can give me the static safety I want.</p>\n"}, {"tags": ["string", "algorithm", "haskell", "combinations"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449855382, "post_id": 34227379, "comment_id": 56202561, "body": "Scanning <code>allStrings</code> looks incredibly inefficient -- it is similar to computing the successor by <code>\\x -&gt; head . tail $ dropWhile (&#47;= x) [0..]</code>. It works, but requires exponential time/space. I&#39;d instead represent the string as a backwards list, and perform standard &quot;addition with carry&quot; on each char/digit. This would have linear worst-case complexity, as expected. (Further, it&#39;s also amortized constant time, since the geometric sum converges, hence kind-of optimal)"}, {"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449856134, "post_id": 34227379, "comment_id": 56202952, "body": "@chi Yep, <code>allStrings</code> <i>is</i> extremely inefficient. That&#39;s just the first thing that came into my mind. Your suggestion sounds very interesting. Can you please provide that as an answer but with a few more pointers/steps?"}], "answers": [{"comments": [{"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1449849572, "post_id": 34227515, "comment_id": 56199012, "body": "Thanks for the reply. Didn&#39;t think of it that way; will try it! However I&#39;m wondering if this can be done in a more &quot;Haskell-y&quot; way (like with built-in functions, monads, etc.)"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1449850240, "last_edit_date": 1449850240, "creation_date": 1449849196, "answer_id": 34227515, "question_id": 34227379, "link": "https://stackoverflow.com/questions/34227379/generate-next-lexicographical-string-in-haskell/34227515#34227515", "title": "Generate next lexicographical string in Haskell", "body": "<p>I would go and make a helper function <code>f :: Integer -&gt; String</code> and one <code>g :: String -&gt; Integer</code>, where <code>f 1 = \"a\"</code>, ... <code>f 27 = \"aa\"</code>, <code>f 28 = \"ab\"</code> and so on and the inverse <code>g</code>.</p>\n\n<p>Then <code>incrementString = f . succ . g</code></p>\n\n<p>Note: I omitted the implementation of <code>f</code> on purpose for learning</p>\n\n<h2>Update</h2>\n\n<p>for a different approach you could define a increment with carry function <code>inc' :: Char -&gt; (Char, Bool)</code>, and then</p>\n\n<pre><code>incString :: String -&gt; String\nincString = reverse . incString'\n   where incString' [] = []\n         incString' (x:xs) = case inc' x of (x',True) -&gt; x': incString' xs\n                                            (x',False) -&gt; x':xs\n</code></pre>\n\n<p>Note: this function is not tail recursive!</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449862266, "post_id": 34229933, "comment_id": 56205947, "body": "This looks very good to me. Check if <code>incrementString &quot;zzzzzzzz&quot;</code> is what you really want -- I mention this since you wrote that the length of the answer must be 8."}, {"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1449863694, "post_id": 34229933, "comment_id": 56206707, "body": "@chi You&#39;re correct, there&#39;s an issue there. It gives the output of 9 a&#39;s... But I meant that the question-provider (this is part of a bigger exercise question) has mentioned that the answer will be N digits. Reading my question again, it appears that I might have been a little bit unclear. Sorry :/"}], "tags": [], "owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1449857547, "creation_date": 1449857547, "answer_id": 34229933, "question_id": 34227379, "link": "https://stackoverflow.com/questions/34227379/generate-next-lexicographical-string-in-haskell/34229933#34229933", "title": "Generate next lexicographical string in Haskell", "body": "<p>I found this to work. It just uses pattern matching to see if the string begins with a <strong>z</strong> and adds an additional <strong>a</strong> accordingly.</p>\n\n<pre><code>incrementString' :: String -&gt; String\nincrementString' []          = ['a']\nincrementString' ('z':xs)    = 'a' : incrementString' xs\nincrementString' (x:xs)      = succ x : xs\n\nincrementString :: String -&gt; String\nincrementString = reverse . incrementString' . reverse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1449858559, "post_id": 34229979, "comment_id": 56204114, "body": "Thanks for the answer! So this is like considering the string as a base-26 number, right? With characters <code>[a-z]</code> instead of digits."}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "reply_to_user": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1449858612, "post_id": 34229979, "comment_id": 56204139, "body": "@Roshnal Yes, exactly - it&#39;s like considering the string as a base-26 number, with characters <code>[a-z]</code> instead of digits."}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "reply_to_user": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1449858966, "post_id": 34229979, "comment_id": 56204309, "body": "@Roshnal it might require some padding for strings that have <code>a</code>s (considered zeros) as prefixes"}, {"owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "edited": false, "score": 0, "creation_date": 1449859402, "post_id": 34229979, "comment_id": 56204510, "body": "Ah yes, that&#39;s true. Interesting approach, will try this out as well :)"}], "tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 3, "last_activity_date": 1449857712, "creation_date": 1449857712, "answer_id": 34229979, "question_id": 34227379, "link": "https://stackoverflow.com/questions/34227379/generate-next-lexicographical-string-in-haskell/34229979#34229979", "title": "Generate next lexicographical string in Haskell", "body": "<p>Here's a version with base conversion (this way you could add and subtract arbitrarily if you like):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>encode x base = encode' x [] where\n  encode' x' z | x' == 0 = z\n               | otherwise = encode' (div x' base) ((mod x' base):z)\n\ndecode num base =\n  fst $ foldr (\\a (b,i) -&gt; (b + a * base^i,i + 1)) (0,0) num\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; map (\\x -&gt; toEnum (x + 97)::Char) \n       $ encode (decode (map (\\x -&gt; fromEnum x - 97) \"skhfbvqa\") 26 + 1) 26\n\n\"skhfbvqb\"\n</code></pre>\n"}], "owner": {"reputation": 1224, "user_id": 923104, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/iVJr7.jpg?s=128&g=1", "display_name": "Roshnal", "link": "https://stackoverflow.com/users/923104/roshnal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 1, "answer_count": 3, "score": 6, "last_activity_date": 1449857712, "creation_date": 1449848792, "question_id": 34227379, "link": "https://stackoverflow.com/questions/34227379/generate-next-lexicographical-string-in-haskell", "title": "Generate next lexicographical string in Haskell", "body": "<p>If I was given a string like <code>skhfbvqa</code>, how would I generate the <em>next</em> string? For this example, it would be <code>skhfbvqb</code>, and the next string of that would be <code>skhfbvqc</code>, and so on. The given string (and the answer) will always be <em>N</em> characters long (in this case, <em>N=8</em>).</p>\n\n<p><strong>What I tried:</strong></p>\n\n<p>I tried to generate the entire (infinite) list of possible combinations, and get the required (next) string of the given string, but unsurprisingly, it's so slow, that I don't even get the answer for <em>N=6</em>.</p>\n\n<p>I used list comprehension:</p>\n\n<pre><code>allStrings = [ c : s | s &lt;- \"\" : allStrings, c &lt;- ['a'..'z'] ]\n\nmain = do\n    input &lt;- readFile \"k.in\"\n    putStrLn . head . tail . dropWhile (not . (==) input) . map reverse $ allStrings\n</code></pre>\n\n<p>(Please excuse my incredibly bad Haskell-ing :) Still a noob)</p>\n\n<p>So my question is, how can I do this? If there are multiple methods, a comparison between them is much appreciated. Thanks!</p>\n"}, {"tags": ["haskell", "haskell-platform"], "answers": [{"tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 1, "last_activity_date": 1449844588, "creation_date": 1449844588, "answer_id": 34225948, "question_id": 34225845, "link": "https://stackoverflow.com/questions/34225845/i-got-not-in-scope-sorton-error-message/34225948#34225948", "title": "I got &quot;Not in scope SortOn&quot; error message", "body": "<p>did you mean <code>sortBy</code> ?</p>\n\n<pre><code>&gt; :t sortBy\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1568238167, "last_edit_date": 1568238167, "creation_date": 1449844931, "answer_id": 34226062, "question_id": 34225845, "link": "https://stackoverflow.com/questions/34225845/i-got-not-in-scope-sorton-error-message/34226062#34226062", "title": "I got &quot;Not in scope SortOn&quot; error message", "body": "<p>this Error message is there because <code>sortOn</code> has been introduced in <code>base-4.8</code> (see <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:sortOn\" rel=\"nofollow noreferrer\">hackage-base</a>\nbut haskell-platform 2014.2.0 only includes base-4.7.0.1 (see <a href=\"https://www.haskell.org/platform/contents.html\" rel=\"nofollow noreferrer\">haskell-platform-doc</a>)</p>\n\n<p>but you can easily build it on your own with <code>sortBy</code> (see @vikingsteve's answer) <code>compare</code> and <code>on</code> (you need to import <code>Data.List</code> for that)</p>\n"}], "owner": {"reputation": 21, "user_id": 5359853, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-39UwDUdqNxg/AAAAAAAAAAI/AAAAAAAAMKk/6OYEerou9bs/photo.jpg?sz=128", "display_name": "Xusheng Zhang", "link": "https://stackoverflow.com/users/5359853/xusheng-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 34226062, "answer_count": 2, "score": 1, "last_activity_date": 1568238167, "creation_date": 1449844209, "question_id": 34225845, "link": "https://stackoverflow.com/questions/34225845/i-got-not-in-scope-sorton-error-message", "title": "I got &quot;Not in scope SortOn&quot; error message", "body": "<p>Even after I imported the Data.List package, I still get \"Not in scope: sortOn\" error message. I am using HaskellPlatform 2014.2.0 version.</p>\n"}, {"tags": ["haskell", "induction"], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": -2, "last_activity_date": 1449840808, "creation_date": 1449840808, "answer_id": 34224763, "question_id": 34224611, "link": "https://stackoverflow.com/questions/34224611/haskell-induction-i-fail-to-see-why-this-solution-proves-anything/34224763#34224763", "title": "Haskell induction - I fail to see why this solution proves anything", "body": "<p>Try an example.</p>\n\n<pre><code>3 = 1 + 1 + 1 + 0\n</code></pre>\n\n<p>so in <code>Nat</code>, <code>3</code> is represented as <code>Succ (Succ (Succ Zero))</code>. Now for any <code>m :: Nat</code>, (consider the two cases: <code>Zero</code> and <code>Succ (Succ (... (Succ Zero) ...)</code>)</p>\n\n<p>we have </p>\n\n<pre><code>add (Succ (Succ (Succ Zero))) m = \nSucc (add (Succ (Succ Zero)) m) = -- we took 1 from 3 and added it to the overall answer\nSucc (Succ (add (Succ Zero) m)) = -- ditto\nSucc (Succ (Succ (add Zero m))) = -- ditto\nSucc (Succ (Succ m)) -- by applying the base case for `add`\n</code></pre>\n\n<p>So we see the result is \"whatever <code>m</code> was (0 or otherwise), plus three more\", or <code>m+3</code> as you would expect.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 4, "last_activity_date": 1449845092, "creation_date": 1449845092, "answer_id": 34226120, "question_id": 34224611, "link": "https://stackoverflow.com/questions/34224611/haskell-induction-i-fail-to-see-why-this-solution-proves-anything/34226120#34226120", "title": "Haskell induction - I fail to see why this solution proves anything", "body": "<blockquote>\n  <p>That is enough? Can I always treat the hypothesis as valid when I find one single case in which it works?</p>\n</blockquote>\n\n<p>No. You need to:</p>\n\n<ol>\n<li>Show it works for all base (non-recursive) cases. Here you have only one: <code>Zero</code>. So you need to show</li>\n</ol>\n\n<blockquote>\n  <p><code>add Zero m = add m Zero</code> holds.</p>\n</blockquote>\n\n<ol start=\"2\">\n<li>Show that for all recursive cases, assuming the hypothesis for arguments is sufficient to show it for the constructed result. Again, here the only recursive case is <code>Succ</code>; so you need to show that </li>\n</ol>\n\n<blockquote>\n  <p><em>given</em> <code>add n m = add m n</code>, <code>add (Succ n) m = add m (Succ n)</code> holds.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 128, "user_id": 947407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20474e5c7fc041f3e79565316a53d6c?s=128&d=identicon&r=PG", "display_name": "David Kraeutmann", "link": "https://stackoverflow.com/users/947407/david-kraeutmann"}, "is_accepted": false, "score": 3, "last_activity_date": 1449845449, "creation_date": 1449845449, "answer_id": 34226239, "question_id": 34224611, "link": "https://stackoverflow.com/questions/34224611/haskell-induction-i-fail-to-see-why-this-solution-proves-anything/34226239#34226239", "title": "Haskell induction - I fail to see why this solution proves anything", "body": "<p>Maybe it helps if you spell out the problem more formally, including forall quantifiers:</p>\n\n<pre><code>forall (n m : Nat), add n m = add m n\n</code></pre>\n\n<h1>Induction over n</h1>\n\n<p>Apply the induction principle:</p>\n\n<pre><code>forall m, add 0 m = add m 0 \n          -&gt; (forall n m, add n m = add m n -&gt; add (S n) m = add m (S n)) \n          -&gt; forall n m, add n m = add m n\n</code></pre>\n\n<p>Now we need to prove the base case <code>add Z m = add m Z</code> and the inductive case <code>forall n m, add n m = add m n -&gt; add (S n) m = add m (S n)</code></p>\n\n<h3>Base case: <code>forall m, add Z m = add m Z</code></h3>\n\n<p>Let <code>m</code> be any <code>Nat</code> (this is called introduction).</p>\n\n<ul>\n<li>Apply <code>add</code> to LHS and you get <code>m = add m Z</code>.</li>\n<li>Apply <code>forall m, add m Z = m</code> (You can prove this if you want) to rewrite RHS and you get <code>m = m</code>.</li>\n</ul>\n\n<p>This holds by reflexivity of equality.</p>\n\n<h3>Inductive case <code>forall n m, add n m = add m n -&gt; add (S n) m = add m (S n)</code></h3>\n\n<p>Let <code>n</code>, <code>m</code> be any <code>Nat</code> and introduce the hypothesis <code>add n m = add m n</code> (i.e. assume that it holds)</p>\n\n<p>Goal: <code>add (S n) m = add m (S n)</code></p>\n\n<ul>\n<li>Apply <code>add</code> to LHS: <code>S (add n m) = add m (S n)</code></li>\n<li>Rewrite using hypothesis: <code>S (add m n) = add m (S n)</code></li>\n<li>Apply <code>forall x y, S (add x y) = add (S x) y</code> (again, you can prove this if you want to) to LHS to get <code>add m (S n) = add m (S n)</code>.</li>\n</ul>\n\n<p>This holds by reflexivity.</p>\n\n<p>And we're done.</p>\n"}], "owner": {"reputation": 333, "user_id": 4237436, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ef7e273b63b57f9a32661d60c5ee08f3?s=128&d=identicon&r=PG&f=1", "display_name": "enahel", "link": "https://stackoverflow.com/users/4237436/enahel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 1, "answer_count": 3, "score": -2, "last_activity_date": 1449845449, "creation_date": 1449840222, "question_id": 34224611, "link": "https://stackoverflow.com/questions/34224611/haskell-induction-i-fail-to-see-why-this-solution-proves-anything", "title": "Haskell induction - I fail to see why this solution proves anything", "body": "<p>The following is from a homework that I already did, and did wrong. I fail to see why the solution is sufficient. (After one week of reading and googling I turn to asking.)</p>\n\n<p>The example is similar to an example used in the Hutton book on Haskell. </p>\n\n<pre><code>Base case:\n\nadd Zero m\n=   { applying add }\nm\n=   { property of add }\nadd m Zero\n\nInductive case:\n\nadd (Succ n) m\n=   { applying add }\nSucc (add n m)\n=   { induction hypothesis }\nSucc (add m n)\n=   { property of add }\nadd m (Succ n)\n\n\n\n-- Hypothesis:\nadd n m = add m n\n\n-- Method:\nby induction on n\n\n-- Using:\nadd n (Succ m) = Succ (add n m)\nadd n Zero = n\n\ndata Nat = Zero\n         | Succ Nat\n\n\nadd :: Nat -&gt; Nat -&gt; Nat\nadd Zero m = m\nadd (Succ n) m = Succ (add n m) \n</code></pre>\n\n<p>What I fail to see is why the induction case is allowed to stop where it stops. It uses the hypothesis, and then un-applies add to generate something that is the version of the hypothesis of the induction case. </p>\n\n<pre><code>add n m = add m n -- hypothesis\nadd m (Succ n)  -- hypthesis applied to the induction case add (Succ n) m\n</code></pre>\n\n<p>In other words, another version of the hypothesis was generated by already assuming that the hypothesis holds. </p>\n\n<p>That is enough? Can I always treat the hypothesis as valid when I find one single case in which it works? And for the inductive case it is always sufficient if I can generate a version of the hypothesis applied to the inductive case by assuming that the hypothesis itself is already proven?</p>\n\n<p>I have troubles to transfer induction from numbers to function. Please don't let me die stupid. Thanks. </p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 7, "creation_date": 1449816284, "post_id": 34217515, "comment_id": 56179464, "body": "You can only pattern-match on constructors. As you say, <code>++</code> is a function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449817823, "post_id": 34217515, "comment_id": 56180083, "body": "It would be very helpful if you could explain in detail what you want your function to do. The code you&#39;ve written does not seem to make very much sense, so I can&#39;t tell."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1449824606, "post_id": 34217515, "comment_id": 56183415, "body": "Great question! Back in &#39;89, I built a language which allowed, in effect, elem x (_ ++ x : _) = True; elem _ _ = False. I miss it."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1449826480, "post_id": 34217515, "comment_id": 56184462, "body": "@pigworker how about Curry?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1449917094, "post_id": 34217515, "comment_id": 56220181, "body": "@ErikAllik It&#39;s always worth looking for ideas to steal. I&#39;d certainly like to see more fluidity in the input-output modes of the relations we happen to present functionally."}], "answers": [{"comments": [{"owner": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 0, "creation_date": 1449820374, "post_id": 34218050, "comment_id": 56181245, "body": "Thanks @Alexey Romanov. I thought about ambiguity as a cause but expected a more verbose error message like the ones Haskell shows in case of other ambiguities."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 0, "creation_date": 1449832987, "post_id": 34218050, "comment_id": 56188513, "body": "@farhanhubble The logic is basically: because of these issues you can&#39;t match on functions, only on constructors; so it wouldn&#39;t make sense to try and check if a specific function would give you ambiguity. Instead the grammar rules for patterns are defined to require constructors, so you get a parse error. There could be a better message saying <code>++</code> is not a constructor, though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1449865242, "post_id": 34218050, "comment_id": 56207568, "body": "Ambiguity isn&#39;t even the biggest issue, imo. The biggest issue is probably that matching on functions is equivalent to solving the halting problem, and (equivalently) would require the ability to enumerate an infinite domain in finite time."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1449868627, "post_id": 34218050, "comment_id": 56209257, "body": "@ReinHenrichs Yes, that&#39;s what I&#39;ve said in the third sentence."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1449916914, "post_id": 34218050, "comment_id": 56220139, "body": "But <code>++</code> isn&#39;t just any old function. It&#39;s the &quot;plugging-in&quot; function for sublist-in-list zippers. Within first-order inductive data structures, candidate spatial decompositions are searchable. There is still the matter of prioritising the search, which programmers must somehow be able to do. One way to do it is to allow ambiguity in patterns only when the function is doing a computation in some MonadPlus. That way, the context decides how to interpret the choices signalled during matching. So I think it&#39;s a little premature to decide that this isn&#39;t worth thinking about."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 4, "last_activity_date": 1449832767, "last_edit_date": 1449832767, "creation_date": 1449818294, "answer_id": 34218050, "question_id": 34217515, "link": "https://stackoverflow.com/questions/34217515/why-cant-i-pattern-match-on-the-concatenation-function-in-haskell/34218050#34218050", "title": "Why can&#39;t I pattern match on the concatenation function (++) in Haskell?", "body": "<p>Imagine you could. Then matching <code>\"a\\nb\\nc\"</code> could produce <code>x = \"a\", xs = \"b\\nc\"</code> or <code>x = \"a\\nb\", xs = \"c\"</code> and you'd need some ad hoc rule to decide which to use. Matching against functions is also impossible to reasonably implement in general: you need to find an <code>x</code> given <code>f x</code>, and there is no way to do this other than trying all possible <code>x</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 1, "creation_date": 1449820057, "post_id": 34218148, "comment_id": 56181051, "body": "thank you. I am a little surprised that not many sources on Haskell clearly define what constitutes a pattern. After reading your answer I looked up pattern matching on functions and found <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow noreferrer\">this</a>. It clearly mentions that pattern matching works with constructors only. It also uses the (++) function to demonstrate that arbitrary functions cannot be used in patterns."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1449824528, "post_id": 34218148, "comment_id": 56183367, "body": "For posterity, the formal semantics of pattern matching are defined in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-580003.17\" rel=\"nofollow noreferrer\">Haskell report</a>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 1, "creation_date": 1449830235, "post_id": 34218148, "comment_id": 56186874, "body": "@farhanhubble I berlieve you are either following a <i>really bad</i> source, or you failed to properly read it. AFAIK <i>all</i> good sources will clearly explain this."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 1, "creation_date": 1449831494, "post_id": 34218148, "comment_id": 56187686, "body": "@farhanhubble: Another way to phrase it is that when you declare a data type, you get both a <i>value constructor</i> and a <i>pattern constructor</i> (or <i>value deconstructor</i>). When you define a function, you only get the value constructor."}, {"owner": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1449832133, "post_id": 34218148, "comment_id": 56188041, "body": "Interesting perspective @Simon Shine. I&#39;m using <a href=\"http://book.realworldhaskell.org/read/defining-types-streamlining-functions.html#deftypes.pattern\" rel=\"nofollow noreferrer\">Real World Haskell</a> as the primary source and although it introduces pattern matching in the context of Algebraic Data Types and constructors, it doesn&#39;t elaborate that pattern matching is specific to them."}, {"owner": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1449832398, "post_id": 34218148, "comment_id": 56188187, "body": "@user2407038 I looked up the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-580003.17\" rel=\"nofollow noreferrer\">link</a> you provided. It&#39;s a good source and I&#39;ll keep coming back to it for future reference. Having said that, it might not be very helpful for people not familiar with grammars. Thanks a lot."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "edited": false, "score": 0, "creation_date": 1449833344, "post_id": 34218148, "comment_id": 56188715, "body": "@farhanhubble I think the &quot;Construction and deconstruction&quot; paragraph implies it pretty clearly. How could you &quot;check to see if the value was created using&quot; a function?"}], "tags": [], "owner": {"reputation": 1120, "user_id": 4017850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6a76c9f963ab1a978a267c5b2e14cca?s=128&d=identicon&r=PG", "display_name": "beigel", "link": "https://stackoverflow.com/users/4017850/beigel"}, "is_accepted": true, "score": 11, "last_activity_date": 1449818693, "creation_date": 1449818693, "answer_id": 34218148, "question_id": 34217515, "link": "https://stackoverflow.com/questions/34217515/why-cant-i-pattern-match-on-the-concatenation-function-in-haskell/34218148#34218148", "title": "Why can&#39;t I pattern match on the concatenation function (++) in Haskell?", "body": "<p>One problem (as I understand it) is that <code>++</code> is not a constructor of the list data type the way <code>:</code> is. You can think of the list data type being defined as</p>\n\n<pre><code>data [a] = [] | a : [a]\n</code></pre>\n\n<p>Where <code>:</code> is a constructor that appends elements to the front of a list. However, <code>++</code> is a function (defined in the documentation here: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#%2B%2B\">http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#%2B%2B</a>) as</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n(++) []     ys = ys\n(++) (x:xs) ys = x : xs ++ ys\n</code></pre>\n\n<p>We could define our own data type list like</p>\n\n<pre><code>data List a = Empty | Cons a (List a)\n</code></pre>\n\n<p>That would mimic the behavior of our familiar list. In fact, you could use <code>(Cons val)</code> in a pattern. I believe you could also define a type with a concat constructor like so</p>\n\n<pre><code>data CList a = Empty | Cons a (CList a) | Concat (CList a) (CList a)\n</code></pre>\n\n<p>Which you could use to lazily concatenate two lists and defer joining them into one. With such a data type you could pattern match against the <code>Concat xs ys</code> input, but you that would only work on the boundary of two lists and not in the middle of one.</p>\n\n<p>Anyway I'm still fairly new to Haskell myself but I hope this is on point.</p>\n"}], "owner": {"reputation": 438, "user_id": 490648, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icrZE.jpg?s=128&g=1", "display_name": "farhanhubble", "link": "https://stackoverflow.com/users/490648/farhanhubble"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1039, "favorite_count": 2, "accepted_answer_id": 34218148, "answer_count": 2, "score": 6, "last_activity_date": 1449832767, "creation_date": 1449815932, "question_id": 34217515, "link": "https://stackoverflow.com/questions/34217515/why-cant-i-pattern-match-on-the-concatenation-function-in-haskell", "title": "Why can&#39;t I pattern match on the concatenation function (++) in Haskell?", "body": "<p>I'm trying to match <code>**String Newline String**</code> pattern in a function Split.</p>\n\n<pre><code>split::String -&gt; [String]\nsplit[] = []\nsplit (x++'\\n':xs) = [x]++split(xs)\n</code></pre>\n\n<p>I'm getting this error:\n<code>Parse error in pattern: x ++ ('\\n' : xs)</code></p>\n\n<p>What am I doing wrong here?</p>\n\n<p>I know there are other ways of achieving the same result but I'd like to understand what wrong with this pattern. I'm fairly new to Haskell BTW.</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1449816542, "post_id": 34216280, "comment_id": 56179564, "body": "Second question: can you <i>draw</i> an unbalanced tree?"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1449816647, "post_id": 34216897, "comment_id": 56179612, "body": "This answer doesn&#39;t contain a monad tutorial. Approved."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1449847449, "last_edit_date": 1449847449, "creation_date": 1449812761, "answer_id": 34216897, "question_id": 34216280, "link": "https://stackoverflow.com/questions/34216280/haskell-create-an-unbalanced-tree/34216897#34216897", "title": "haskell create an unbalanced tree", "body": "<blockquote>\n  <p>Can you please let me know if <code>t</code> above is a balanced tree with values only at the leaves?</p>\n</blockquote>\n\n<p>I can, but I won't. However, I hope I can guide you through the process of writing a function that will determine whether a given tree is balanced.</p>\n\n<p>The following is certainly not the most <em>efficient</em> way to do it (see the bottom for a hint about that), but it is a very modular way. It's also a good example of the \"computation by transformation\" approach that functional programming (and especially lazy functional programming) encourages. It seems pretty clear to me that the first question to ask is \"how many leaves descend from each node?\" There's no way for us to write down the answers directly in the tree, but we can make a new tree that has the answers:</p>\n\n<pre><code>data CountedTree = CLeaf Integer | CNode Integer Tree Tree\n</code></pre>\n\n<p>Each node of a <code>CountedTree</code> has an integer field indicating how many leaves descend from it.</p>\n\n<p>You should be able to write a function that reads off the total number of leaves from a <code>CountedTree</code>, whether it's a <code>Leaf</code> or a <code>Node</code>:</p>\n\n<pre><code>getSize :: CountedTree -&gt; Integer\n</code></pre>\n\n<p>The next step is to determine whether a <code>CountedTree</code> is balanced. Here's a skeleton:</p>\n\n<pre><code>countedBalanced :: CountedTree -&gt; Bool\ncountedBalanced CLeaf = ?\ncountedBalanced (CNode _ left right)\n  = ?? &amp;&amp; ?? &amp;&amp; getSize left == getSize right\n</code></pre>\n\n<p>I've left the first step for last: convert a <code>Tree</code> into a <code>CountedTree</code>:</p>\n\n<pre><code>countTree :: Tree -&gt; CountedTree\n</code></pre>\n\n<p>And finally you can wrap it all up:</p>\n\n<pre><code>balanced :: Tree -&gt; Bool\nbalanced t = ?? (?? t)\n</code></pre>\n\n<p>Now it turns out that you don't actually have to copy and annotate the tree to figure out whether or not it's balanced. You can do it much more directly. This is a much more <em>efficient</em> approach, but a somewhat less <em>modular</em> one. I'll give you the relevant types, and you can fill in the function.</p>\n\n<pre><code>-- The balance status of a tree. Either it's\n-- unbalanced, or it's balanced and we store\n-- its total number of leaves.\ndata Balance = Unbalanced | Balanced Integer\n\ngetBalance :: Tree -&gt; Balance\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5647834, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8f1682c67b6bb6f529ae2a9a2579157?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5647834/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1449847449, "creation_date": 1449809090, "question_id": 34216280, "link": "https://stackoverflow.com/questions/34216280/haskell-create-an-unbalanced-tree", "title": "haskell create an unbalanced tree", "body": "<p>My Tree definition is </p>\n\n<pre><code>data Tree = Leaf Integer | Node Tree Tree\n</code></pre>\n\n<p>This is a binary tree, with only values at the leaves.\nI am given following definition for balanced trees:</p>\n\n<p>We say that a tree is balanced if the number of leaves in the left and right subtree of every node differs by at most one, with leaves themselves being trivially balanced.</p>\n\n<p>I try to create a balanced tree as follows:</p>\n\n<pre><code>t :: Tree\n\nt = Node (Node (Node (Leaf 1) (Leaf 2)) (Node(Leaf 3)(Leaf 4))) (Node (Node (Leaf 5) (Leaf 6)) (Node (Leaf 7) (Leaf 8)) )\n</code></pre>\n\n<p>Can you please let me know if t above is a balanced tree with values only at the leaves?</p>\n\n<p>Another question, how do I create another tree with values only at the leaves and it is unbalanced as per above definition.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "monads", "syntactic-sugar", "list-definition"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1449816175, "post_id": 34214633, "comment_id": 56179408, "body": "You can see precise description of translation of <code>do</code> expressions to function calls in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1449797167, "post_id": 34214676, "comment_id": 56173998, "body": "Interesting. I didn&#39;t know yet about this <code>LambdaCase</code> extension, and I could have used the <code>case</code> in the middle. Just a detail, you forgot the argument to <code>fail</code> in the last line from of your answer"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1449824098, "last_edit_date": 1449824098, "creation_date": 1449796662, "answer_id": 34214676, "question_id": 34214633, "link": "https://stackoverflow.com/questions/34214633/haskell-how-the-construct-do-calls-fail-function-from-monad/34214676#34214676", "title": "Haskell - How the construct do calls fail function from Monad?", "body": "<p>For instance</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\ntest'' = [Just 1, Nothing, Just 3] &gt;&gt;= \\case\n            Just x -&gt; [1, 2] &gt;&gt;= \\y -&gt; return (x, y)\n            _ -&gt; fail \"...\"\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 1, "accepted_answer_id": 34214676, "answer_count": 1, "score": 1, "last_activity_date": 1449824098, "creation_date": 1449796368, "question_id": 34214633, "link": "https://stackoverflow.com/questions/34214633/haskell-how-the-construct-do-calls-fail-function-from-monad", "title": "Haskell - How the construct do calls fail function from Monad?", "body": "<p>While studying <a href=\"http://learnyouahaskell.com/a-fistful-of-monads#the-list-monad\" rel=\"nofollow\">Monads</a> I understood why when pattern matching on <strong>list definitions</strong> fails, its computation is somewhat \"ignored\" instead of throwing an error:</p>\n\n<pre><code>test :: [(Int, Int)]\ntest = [(x, y) | (Just x) &lt;- [Just 1, Nothing, Just 3], y &lt;- [1, 2]]\n\n*Main&gt; test\n[(1,1),(1,2),(3,1),(3,2)]\n</code></pre>\n\n<p>It's because it is just a <strong>syntactic sugar</strong> for a <code>Monad</code> application using <code>do</code>:</p>\n\n<pre><code>test'' :: [(Int, Int)]\ntest'' = do\n  (Just x) &lt;- [Just 1, Nothing, Just 3]\n  y &lt;- [1, 2]\n  return (x, y)\n\n*Main&gt; test'\n[(1,1),(1,2),(3,1),(3,2)]\n*Main&gt; test == test'\nTrue\n</code></pre>\n\n<p>Similarly, we could try to resemble this logic using the <strong>bind operator</strong> <code>&gt;&gt;=</code>:</p>\n\n<pre><code>test'' :: [(Int, Int)]\ntest'' = [Just 1, Nothing, Just 3] &gt;&gt;= \\(Just x) -&gt; [1, 2] &gt;&gt;= \\y -&gt; return (x, y)\n</code></pre>\n\n<p>However, as expected, the monadic function <code>fail</code> relative to <code>List</code> will not be called in this situation like it was in the previous ones:</p>\n\n<pre><code>*Main&gt; test''\n[(1,1),(1,2)*** Exception: test.hs:11:40-82: Non-exhaustive patterns in lambda\n</code></pre>\n\n<p>So, my question is: <strong>Is it possible to get <code>[(1,1),(1,2),(3,1),(3,2)]</code> using <code>test''</code> style, in a neat way? Is <code>do</code> construct a syntactic sugar for something like this?</strong></p>\n\n<pre><code>test'' :: [(Int, Int)]\ntest'' = [Just 1, Nothing, Just 3] &gt;&gt;= \\maybeX -&gt; [1, 2] &gt;&gt;= \\y -&gt; case maybeX of Just x -&gt; return (x, y)\n                                                                                  _      -&gt; fail undefined\n\n*Main&gt; test''\n[(1,1),(1,2),(3,1),(3,2)]\n*Main&gt; test'' == test\nTrue\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449789846, "post_id": 34213241, "comment_id": 56171708, "body": "Can you given an example of the <code>Code</code> you aim to write to a file, such that the error can be <i>reproduced</i>?"}, {"owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449789914, "post_id": 34213241, "comment_id": 56171738, "body": "<code>fromList [(&#39;e&#39;,[1,1,0]),(&#39;h&#39;,[1,1,1]),(&#39;l&#39;,[0]),(&#39;o&#39;,[1,0])]</code> is one example. When I wrote it to the file that&#39;s how it appears in the file but now I can&#39;t read it back. Sorry, Bit is a datatype with either One or Zero, represented by 1 or 0"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449790072, "post_id": 34213241, "comment_id": 56171808, "body": "I get <i>Not in scope: type constructor or class `Bit&#39;</i>. :("}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 0, "creation_date": 1449790779, "post_id": 34213241, "comment_id": 56172068, "body": "Has  <code>tr2 = read $ show $ tr :: Code</code> same effect?. Can you also post full code that reproduce this problem please?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 0, "creation_date": 1449790899, "post_id": 34213241, "comment_id": 56172095, "body": "@LukaRahne: this should do the same since <code>Code</code> is an alias of <code>Map.Map...</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449791661, "post_id": 34213241, "comment_id": 56172351, "body": "@astiefel: can you please give a definition for <code>Bit</code>?"}, {"owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "edited": false, "score": 0, "creation_date": 1449794670, "post_id": 34213241, "comment_id": 56173359, "body": "Yeah here it is sorry about that. <code>data Bit = One | Zero deriving (Read, Eq, Ord)  instance Show Bit where   show One  = &quot;1&quot;   show Zero = &quot;0&quot;</code>"}, {"owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "edited": false, "score": 0, "creation_date": 1449794828, "post_id": 34213241, "comment_id": 56173396, "body": "Oh I think I may have realized the problem. When I print it, I print 0 and 1 not Zero and One so it can&#39;t read it. Do you think I can map over the 0 and 1&#39;s and change them to Zero and One?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1449796042, "post_id": 34213241, "comment_id": 56173687, "body": "FYI, <code>data Bit = One | Zero deriving (... , Ord)</code> is very strange, because it will conclude that <code>One &lt; Zero</code>! You almost certainly want to rearrange those constructors."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449796171, "post_id": 34213241, "comment_id": 56173719, "body": "Also, if you&#39;re going to the trouble of using <code>ByteString</code>, it really doesn&#39;t pay to go through <code>String</code> with <code>Show</code> and <code>Read</code>. You should look into one of the <i>serialization</i> libraries, such as <code>binary</code> or <code>cereal</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "edited": false, "score": 0, "creation_date": 1449795662, "post_id": 34214481, "comment_id": 56173601, "body": "Thanks so much. I&#39;ve never overridden read before so it&#39;s giving me a warning about the following pattern not matching: <code>_ ((GHC.Types.C# #x) : _) with #x notElem [&#39;1&#39;, &#39;0&#39;]</code>. Is there a way to just tell it to act with its normal read?"}, {"owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "reply_to_user": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "edited": false, "score": 1, "creation_date": 1449796348, "post_id": 34214481, "comment_id": 56173762, "body": "There was a case missing in the Read instance, I updated my answer."}], "tags": [], "owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "is_accepted": true, "score": 5, "last_activity_date": 1472642995, "last_edit_date": 1472642995, "creation_date": 1449795252, "answer_id": 34214481, "question_id": 34213241, "link": "https://stackoverflow.com/questions/34213241/haskell-read-a-map-from-file/34214481#34214481", "title": "Haskell read a Map from file", "body": "<p>The problem is that you override the default implementation of Show, but rely on the default implementation of Read, which expects \"One\" or \"Zero\", not \"1\" or \"0\".</p>\n\n<p>The solution is to write your own implementation of Read (you can leave Eq and Ord as it is):</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as BSC\nimport qualified Data.ByteString as BS\nimport qualified Data.Map as Map\n\ndata Bit = One | Zero deriving (Eq,Ord)\n\ninstance Show Bit where\n  show One = \"1\"\n  show Zero = \"0\"\n\ninstance Read Bit where\n  readsPrec _ ('1':xs) = [(One, xs)]\n  readsPrec _ ('0':xs) = [(Zero, xs)]\n  readsPrec _ _        = []\n\ntype Code = Map.Map Char [Bit]\n\nwriteCode :: FilePath -&gt; Code -&gt; IO ()\nwriteCode fp tr = BS.writeFile (\"code_\" ++ fp) (BSC.pack (show tr))\n\nreadCode :: FilePath -&gt; IO Code\nreadCode f = do s &lt;- BS.readFile (\"code_\" ++ f)\n                let s' = BSC.unpack s\n                return (read s' :: Code)\n</code></pre>\n"}], "owner": {"reputation": 1916, "user_id": 3457762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0429df5bced7c2317a880821a7cc480e?s=128&d=identicon&r=PG&f=1", "display_name": "astiefel", "link": "https://stackoverflow.com/users/3457762/astiefel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 34214481, "answer_count": 1, "score": 3, "last_activity_date": 1472642995, "creation_date": 1449788159, "last_edit_date": 1449789953, "question_id": 34213241, "link": "https://stackoverflow.com/questions/34213241/haskell-read-a-map-from-file", "title": "Haskell read a Map from file", "body": "<p>I have written a map to a file and now am trying to perform a read on it. Is that possible?  One wrench in there is that the code is written and read using ByteString and ByteString.Char8. I keep getting the following error</p>\n\n<pre><code>fromList *** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>My code is as follows:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as BSC\nimport qualified Data.ByteString as BS\nimport qualified Data.Map as Map\n\ntype Code = Map.Map Char [Bit]\n\nwriteCode :: FilePath -&gt; Code -&gt; IO ()\nwriteCode fp tr = BS.writeFile (\"code_\" ++ fp)\n                  (BSC.pack (show (tr :: M.Map Char [Bit])))\n\nreadCode :: FilePath -&gt; IO Code\nreadCode f = do s &lt;- BS.readFile (\"code_\" ++ f)\n                let s' = BSC.unpack s\n                return (read s' :: Code)\n</code></pre>\n"}, {"tags": ["haskell", "build", "cabal"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1449796124, "post_id": 34212980, "comment_id": 56173710, "body": "Note that, while <code>make</code> will always recompile anything dependent on a touched file, <code>cabal build</code> will, for instance, not necessarily recompile downstream modules if you change only one function in a file. It somehow figures out that the interface isn&#39;t affected, and that it&#39;s enough to re-link the files (which is typically <i>much</i> faster than recompiling anything). BTW, I think it&#39;s actually <code>ghc -make</code> that we should be talking about; cabal only invokes that for checking the dependencies within a package."}], "answers": [{"comments": [{"owner": {"reputation": 331, "user_id": 1228878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vd3Pe.jpg?s=128&g=1", "display_name": "tniles", "link": "https://stackoverflow.com/users/1228878/tniles"}, "edited": false, "score": 1, "creation_date": 1449791825, "post_id": 34213927, "comment_id": 56172420, "body": "Also, see <a href=\"http://stackoverflow.com/questions/22630756/how-does-makefile-know-that-a-file-changed-and-then-recompile-it\">this</a> SO thread; apparently make does a simple examination of time stamps to tell if something changed."}, {"owner": {"reputation": 331, "user_id": 1228878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vd3Pe.jpg?s=128&g=1", "display_name": "tniles", "link": "https://stackoverflow.com/users/1228878/tniles"}, "edited": false, "score": 1, "creation_date": 1449792493, "post_id": 34213927, "comment_id": 56172646, "body": "Cabal seems to look a <a href=\"https://www.haskell.org/cabal/FAQ.html\" rel=\"nofollow noreferrer\">bit deeper</a> for changes just due to the nature of its operation."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1449794950, "post_id": 34213927, "comment_id": 56173422, "body": "I don&#39;t know much about <code>cabal</code>s or <code>make</code>s internals either, but I&#39;m fairly confident that the performance difference has little to do with the former being written in Haskell. Compiled Haskell is actually only a little slower than C, provided you keep away from certain performance traps (badly fused lists, too much lazyness etc.). In fact, sometimes an idiomatic Haskell implementation will be <i>faster</i> than a not particularly optimised C solution!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1449804251, "post_id": 34213927, "comment_id": 56175767, "body": "You can <i>edit</i> your answer to incorporate new information or remove things that are found to be incorrect (such as the rather clearly false claim that Cabal is slower because it&#39;s written in Haskell rather than C)."}, {"owner": {"reputation": 331, "user_id": 1228878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vd3Pe.jpg?s=128&g=1", "display_name": "tniles", "link": "https://stackoverflow.com/users/1228878/tniles"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449948326, "post_id": 34213927, "comment_id": 56229671, "body": "@dfeuer: As @leftaroundabout points out, it&#39;s not always that simple to say whether one is faster or not (using words such as &quot;little&quot; and &quot;sometimes&quot; to indicate this). Especially bringing optimization into the mix (also begging the question: &quot;would the distributed/release version of <code>make</code> <i>really</i> be un-optimized?&quot;), one would need to <i>empirically</i> determine which is faster and <i>why</i>. Looking at the source code and the level of compiler optimization is certainly part of this."}, {"owner": {"reputation": 331, "user_id": 1228878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vd3Pe.jpg?s=128&g=1", "display_name": "tniles", "link": "https://stackoverflow.com/users/1228878/tniles"}, "edited": false, "score": 0, "creation_date": 1449948332, "post_id": 34213927, "comment_id": 56229676, "body": "My answer primarily provides some web research to try and help point people in the right direction. Looking at the source code, or performing some profiling experiments, would be two good ways for people to see for themselves."}], "tags": [], "owner": {"reputation": 331, "user_id": 1228878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vd3Pe.jpg?s=128&g=1", "display_name": "tniles", "link": "https://stackoverflow.com/users/1228878/tniles"}, "is_accepted": false, "score": 3, "last_activity_date": 1449791696, "creation_date": 1449791696, "answer_id": 34213927, "question_id": 34212980, "link": "https://stackoverflow.com/questions/34212980/why-is-cabal-build-so-slow-compared-with-make/34213927#34213927", "title": "Why is &quot;cabal build&quot; so slow compared with &quot;make&quot;?", "body": "<p>Disclaimer: I'm not familiar enough with Haskell or <code>make</code> internals to give technical specifics, but some web searching does offer some insight that lines up with my proposal (trying to avoid eliciting opinions by providing references). Also, I'm assuming your makefile is calling <code>ghc</code>, as <code>cabal</code> apparently would.</p>\n\n<p>Proposal: I believe there could be several key reasons, but the main one is that <code>make</code> is written in C, whereas <code>cabal</code> is written in Haskell. This would be coupled with superior dependency checking from <code>make</code> (although I'm not sure how to prove this without looking at the source code). Other supporting reasons, as found on the web:</p>\n\n<ul>\n<li>cabal tries to do a lot more than simply compiling, e.g. appears to take steps with regard to packaging (<a href=\"https://www.haskell.org/cabal/\" rel=\"nofollow\">https://www.haskell.org/cabal/</a>)</li>\n<li>cabal is written in haskell, although the run time is written in C (<a href=\"https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler</a>)</li>\n<li>Again, not being overly familiar with <code>make</code> internals, <code>make</code> may simply have a faster dependency checking mechanism, thereby better tracking these changes. I point this out because from the OP it sounds like there is a significant enough difference to where cabal may be doing a blanket check against all dependencies. I suspect this would be the primary reason for the speed difference, if true.</li>\n</ul>\n\n<p>At any rate, these are open source and can be downloaded from their respective sites (haskell.org/cabal/ and savannah.gnu.org/projects/make/) allowing anyone to examine specifics of the implementations.</p>\n\n<p>It is also likely one could see a lot of variance in speed based upon the switches passed to the compilers in use.</p>\n\n<p>HTH at least point you in the right direction.</p>\n"}], "owner": {"reputation": 767, "user_id": 1721431, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ccd00f0739f0cad0a1b919be0694c567?s=128&d=identicon&r=PG", "display_name": "N.S.", "link": "https://stackoverflow.com/users/1721431/n-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1449791696, "creation_date": 1449786935, "question_id": 34212980, "link": "https://stackoverflow.com/questions/34212980/why-is-cabal-build-so-slow-compared-with-make", "title": "Why is &quot;cabal build&quot; so slow compared with &quot;make&quot;?", "body": "<p>If I have a package with several executables, which I initially build using <code>cabal build</code>. Now I change one file that impacts just one executable, cabal seems to take about a second or two to examine each executable to see if it's impacted or not. On the other hand, <code>make</code>, given an equivalent number of executables and source files, will determine in a fraction of a second what needs to be recompiled. Why the huge difference? Is there a reason, cabal can't just build its own version of a makefile and go from there?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5665784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f65a96f969efd2b3a22b317f1b760076?s=128&d=identicon&r=PG&f=1", "display_name": "Stone", "link": "https://stackoverflow.com/users/5665784/stone"}, "edited": false, "score": 0, "creation_date": 1449779410, "post_id": 34210815, "comment_id": 56166418, "body": "Thanks, I can see the problem now. But how do I get the &quot;a&quot;?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 1, "user_id": 5665784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f65a96f969efd2b3a22b317f1b760076?s=128&d=identicon&r=PG&f=1", "display_name": "Stone", "link": "https://stackoverflow.com/users/5665784/stone"}, "edited": false, "score": 2, "creation_date": 1449779909, "post_id": 34210815, "comment_id": 56166722, "body": "@Stone you could write <code>doit (Ctor x) = Ctor (myFunc x)</code>."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 3, "last_activity_date": 1449778105, "creation_date": 1449778105, "answer_id": 34210815, "question_id": 34210719, "link": "https://stackoverflow.com/questions/34210719/haskell-could-not-deduce/34210815#34210815", "title": "Haskell: &quot;Could not deduce&quot;", "body": "<p><code>myFunc</code> takes a <code>MyClass</code> value as an argument, but in <code>doit</code> you're passing it a value of type <code>MyType a</code>, which is not known to be an instance of <code>MyClass</code>.  Did you perhaps mean to call <code>myFunc</code> on the <code>a</code> value inside <code>x</code>?</p>\n"}], "owner": {"reputation": 1, "user_id": 5665784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f65a96f969efd2b3a22b317f1b760076?s=128&d=identicon&r=PG&f=1", "display_name": "Stone", "link": "https://stackoverflow.com/users/5665784/stone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 34210815, "answer_count": 1, "score": -2, "last_activity_date": 1449778105, "creation_date": 1449777742, "question_id": 34210719, "link": "https://stackoverflow.com/questions/34210719/haskell-could-not-deduce", "title": "Haskell: &quot;Could not deduce&quot;", "body": "<p>I'm stuck at a problem with my Haskell code. This is the simplified code:</p>\n\n<blockquote>\n<pre><code>class MyClass a where\n    myConst :: a\n    myFunc :: a -&gt; a\ninstance MyClass Int where\n    myConst = 3 \n    myFunc = \\x -&gt; 3\ndata MyType a =\n    Ctor a\n\ndoit :: MyClass a =&gt; MyType a -&gt; MyType a \ndoit x = myFunc x\n-- doit x = myConst\n</code></pre>\n</blockquote>\n\n<p>The error message:</p>\n\n<blockquote>\n<pre><code>Could not deduce (MyClass (MyType a)) arising from a use of `myFunc'\nfrom the context (MyClass a)\n  bound by the type signature for\n             doit :: MyClass a =&gt; MyType a -&gt; MyType a\n  at ...\\Example.hs:12:9-37\nIn the expression: myFunc x\nIn an equation for doit: doit x = myFunc x\n</code></pre>\n</blockquote>\n\n<p>I'm very new to Haskell, but imho doit knows that the parameter is constrained to MyClass and thus provides myFunc/myConst.</p>\n"}, {"tags": ["file", "haskell", "io"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1450067554, "creation_date": 1450067554, "answer_id": 34259815, "question_id": 34210013, "link": "https://stackoverflow.com/questions/34210013/having-problems-with-writefile-in-haskell-io/34259815#34259815", "title": "Having problems with writeFile in Haskell IO", "body": "<p>The \"funny\" <code>()</code> is actually the key to understanding this. The output <code>()</code> is emitted by the last line of <code>main</code>, <code>print result</code>, because <code>result</code> has type <code>()</code>. </p>\n\n<p>Why? Because it is bound to the result of <code>print . emit . compile . calc . lexer =&lt;&lt; readFile ifile</code>; or, simplified, to the result of <code>print . f =&lt;&lt; readFile ifile</code> for some pure compiler pipeline <code>f</code>. The result of this is the result of the <code>print</code>, which is just <code>()</code> (<code>print</code> doesn't return anything useful, it just prints its argument to stdout as an effect). </p>\n\n<p>What you want to do is to not <code>print</code> anything then and there, and just bind the actual result of running your compile pipeline; i.e. something like</p>\n\n<pre><code>result &lt;- emit . compile . calc . lexer &lt;$&gt; readFile ifile\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5665831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b922c95eee4b0dabb0ea900ebe1002?s=128&d=identicon&r=PG&f=1", "display_name": "Skillga", "link": "https://stackoverflow.com/users/5665831/skillga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 34259815, "answer_count": 1, "score": 1, "last_activity_date": 1450067554, "creation_date": 1449775239, "last_edit_date": 1450067278, "question_id": 34210013, "link": "https://stackoverflow.com/questions/34210013/having-problems-with-writefile-in-haskell-io", "title": "Having problems with writeFile in Haskell IO", "body": "<p>First of all im new around here and thanks for helping out.</p>\n\n<p>The problem is basically i am being unable to write into a file by using writeFile in Haskell.\nCode: </p>\n\n<pre><code>main = do\n    putStrLn \"Input file: \"\n    ifile &lt;- getLine\n    result &lt;- readFile ifile &gt;&gt;= print . emit . compile . calc . lexer\n    print result\n</code></pre>\n\n<p>This is what i currently have and i know that the function <code>emit</code> is returning correctly.\nAditional info on functions im using:</p>\n\n<pre><code>    emit :: (Int, Int, [Stuff]) -&gt; String\n    compile :: C -&gt; (Int, Int, [Stuff])\n</code></pre>\n\n<p>I can get the result printed with the above code and it returns along lines of:</p>\n\n<pre><code>\"stuff i want\"\n()\n</code></pre>\n\n<p>I'm finding the <code>()</code> funny but i figure i can remove it from the file afterwards.</p>\n\n<p>When i try to use the writeFile in the following manner:</p>\n\n<pre><code>writeFile \"file.txt\" results\n</code></pre>\n\n<p>It gives me the following error:</p>\n\n<pre><code>    Couldn't match type `()' with `[Char]'\n    Expected type: String\n      Actual type: ()\n    In the second argument of `writeFile', namely `result'\n    In a stmt of a 'do' block: writeFile \"result.txt\" result\n    In the expression:\n      do { putStrLn \"Input file: \";\n        ifile &lt;- getLine;\n        result &lt;- readFile ifile &gt;&gt;= print . emit . compile . calc . lexer;\n        writeFile \"result.txt\" result }\n</code></pre>\n\n<p>Anyone knows how i can fix this? \nThanks in advance!</p>\n"}, {"tags": ["haskell", "challenge-response"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1449775664, "post_id": 34209263, "comment_id": 56164326, "body": "The <code>sort</code> is what&#39;s killing you. <code>String</code>s don&#39;t have an O(1) comparison, so sorting the 125,250 strings (with a total length of 20,958,500 characters) is sloow."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 3, "creation_date": 1449777963, "post_id": 34209263, "comment_id": 56165591, "body": "It&#39;s the <code>sort</code>. It really isn&#39;t that slow, it runs well within the time limit, but the <code>sort</code> is forcing every single substring to be in memory at the same time, so you&#39;re getting an out-of-memory exception. If you can count the substrings as they come in, without sorting them first, it should use a lot less memory."}], "answers": [{"tags": [], "owner": {"reputation": 313, "user_id": 4355529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/pvoSZ.jpg?s=128&g=1", "display_name": "Aman Garg", "link": "https://stackoverflow.com/users/4355529/aman-garg"}, "is_accepted": false, "score": 1, "last_activity_date": 1451076088, "last_edit_date": 1451076088, "creation_date": 1451074430, "answer_id": 34466070, "question_id": 34209263, "link": "https://stackoverflow.com/questions/34209263/hackerrank-string-function-calculation/34466070#34466070", "title": "Hackerrank String Function Calculation", "body": "<p>This won't work. Sort gets extremely expensive (memory wise) as the intermediate<br>\n products in this list remain in memory and these products are large. It's a memory<br>\nerror </p>\n\n<p>A better approach would be to use Suffix Arrays <code>O(n log<sup>2</sup>n)</code> \n and then create the<br>\nlongest prefix array (LCP) using <code>Kasai's Algorithm in O(n)</code> and then use the LCP array for<br>\nthe remainder of the problem.  </p>\n\n<p>Calculate <code>LCP[i] and LCP[i+1]</code>\nIf they are equal, then it means that there are two equal sub strings  Proceed this way.</p>\n"}, {"tags": [], "owner": {"reputation": 432, "user_id": 2671590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YyY7f.jpg?s=128&g=1", "display_name": "DoesEatOats", "link": "https://stackoverflow.com/users/2671590/doeseatoats"}, "is_accepted": false, "score": 0, "last_activity_date": 1560611051, "creation_date": 1560611051, "answer_id": 56611537, "question_id": 34209263, "link": "https://stackoverflow.com/questions/34209263/hackerrank-string-function-calculation/56611537#56611537", "title": "Hackerrank String Function Calculation", "body": "<pre><code>#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\n#include&lt;cstring&gt;\nusing namespace std;\n\n#define nb nexta\n#define head height\n#define rank b\n\nconst int maxn = 100010;\nchar s[maxn];\nint n, id[maxn], height[maxn], b[maxn], nexta[maxn];\n\nbool cmp(const int&amp; i, const int&amp; j)\n{\n    return s[i] &lt; s[j];\n}\n\nvoid SuffixSort()\n{\n    int i, j, k, h;\n    for (i = 0; i &lt; n; i++) id[i] = i;\n    sort(id, id + n, cmp);\n    for (i = 0; i &lt; n; i++)\n    {\n        if (i == 0 || s[id[i]] != s[id[i - 1]])\n            b[id[i]] = i;\n        else b[id[i]] = b[id[i - 1]];\n    }\n    for (h = 1; h &lt; n; h &lt;&lt;= 1)\n    {\n        for (i = 0; i &lt; n; i++)\n            head[i] = nexta[i] = -1;\n        for (i = n - 1; i &gt;= 0; i--)\n        {\n            if (id[i])\n            {\n                j = id[i] - h;\n                if (j &lt; 0) j += n;\n                nexta[j] = head[b[j]];\n                head[b[j]] = j;\n            }\n        }\n        j = n - h;\n        nexta[j] = head[b[j]];\n        head[b[j]] = j;\n        for (i = k = 0; i &lt; n; i++)\n            if (head[i] &gt;= 0)\n                for (j = head[i]; j &gt;= 0; j = nexta[j])\n                    id[k++] = j;\n        for (i = 0; i &lt; n; i++)\n            if (i&gt;0 &amp;&amp; id[i] + h &lt; n&amp;&amp;id[i - 1] + h &lt; n&amp;&amp;b[id[i]] == b[id[i - 1]] &amp;&amp; b[id[i] + h] == b[id[i - 1] + h])\n                nb[id[i]] = nb[id[i - 1]];\n            else\n                nb[id[i]] = i;\n        for (i = 0; i &lt; n; i++)\n            b[i] = nb[i];\n    }\n}\n\nvoid GetHeight()\n{\n    int i, j, h; height[0] = 0;\n    for (i = 0; i &lt; n; i++)\n        rank[id[i]] = i;\n    for (h = 0, i = 0; i &lt; n; i++)\n    {\n        if (rank[i] &gt; 0)\n        {\n            j = id[rank[i] - 1];\n            while (s[i + h] == s[j + h])++h;\n            height[rank[i]] = h;\n            if (h&gt;0) --h;\n        }\n    }\n}\n\nint st[maxn], top;\n\nint main()\n{\n    cin &gt;&gt; s;\n    n = strlen(s);\n    top = 0;\n    SuffixSort();\n    GetHeight();\n    height[n] = 0;\n    int best = n;\n    st[top++] = 0;\n    for (int i = 1; i &lt; n + 1; i++)\n    {\n        //cout &lt;&lt; height[i] &lt;&lt; \" \";\n        while (top != 0 &amp;&amp; height[i] &lt; height[st[top - 1]])\n        {\n            int val = height[st[top - 1]];\n            top--;\n            best = max(best, val * (top == 0 ? i : i - st[top - 1]));\n        }\n\n        if (top == 0 || height[i] &gt;= height[st[top - 1]])\n            st[top++] = i;\n    }\n    cout &lt;&lt; best &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2069, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1560611051, "creation_date": 1449772532, "question_id": 34209263, "link": "https://stackoverflow.com/questions/34209263/hackerrank-string-function-calculation", "title": "Hackerrank String Function Calculation", "body": "<p>I'm trying to solve the <a href=\"https://www.hackerrank.com/challenges/string-function-calculation\" rel=\"nofollow\">String Function Calculation problem from Hackerrank</a>. In this problem, we're given a string as input and asked to print a number that represents the maximum of the following function, among all substrings of the input string:</p>\n\n<h3>f(s, t) = number of times the substring 's' appears in string 't' * length of substring 's'</h3>\n\n<p>I submitted the following as an answer:</p>\n\n<pre><code>import Data.List\n\nmain :: IO()\nmain = do\n    stringInput &lt;- getLine\n    print $ solution stringInput\n\nsolution :: String -&gt; Int\nsolution input = maximum $ map sum $ map (map length) $ group $ sort $ substrings input\n\nsubstrings :: String -&gt; [String]\nsubstrings s = tail . inits =&lt;&lt; tails s\n</code></pre>\n\n<p>The idea was to:</p>\n\n<ol>\n<li><p>Get all substrings of <code>s</code>. <code>let s = \"aaaaaa\"; substrings s  = [\"a\",\"aa\",\"aaa\",\"aaaa\",\"aaaaa\",\"aaaaaa\",\"a\",\"aa\",\"aaa\",\"aaaa\",\"aaaaa\",\"a\",\"aa\",\"aaa\",\"aaaa\",\"a\",\"aa\",\"aaa\",\"a\",\"aa\",\"a\"]</code></p></li>\n<li><p>Sort it. <code>[\"a\",\"a\",\"a\",\"a\",\"a\",\"a\",\"aa\",\"aa\",\"aa\",\"aa\",\"aa\",\"aaa\",\"aaa\",\"aaa\",\"aaa\",\"aaaa\"\n,\"aaaa\",\"aaaa\",\"aaaaa\",\"aaaaa\",\"aaaaaa\"]</code></p></li>\n<li><p>Group it. <code>[[\"a\",\"a\",\"a\",\"a\",\"a\",\"a\"],[\"aa\",\"aa\",\"aa\",\"aa\",\"aa\"],[\"aaa\",\"aaa\",\"aaa\",\"aaa\"],[\"aaaa\",\"aaaa\",\"aaaa\"],[\"aaaaa\",\"aaaaa\"],[\"aaaaaa\"]]</code></p></li>\n<li><p>Get the individual lengths of each substring. <code>[[1,1,1,1,1,1],[2,2,2,2,2],[3,3,3,3],[4,4,4],[5,5],[6]]</code></p></li>\n<li><p>Sum the resulting lists. <code>[6,10,12,12,10,6]</code>.</p></li>\n<li><p>Get the maximum. <code>12</code>.</p></li>\n</ol>\n\n<p>This passes the preliminary tests. However, when I submit it it fails all other tests, by 'Runtime Error'. </p>\n\n<p>Test case no. 2, the first to fail, takes 1.47 seconds to run and has the following input:</p>\n\n<p><code>\"aacbbabbabbbbbaaaaaaabbbbcacacbcabaccaabbbcaaabbccccbbbcbccccbbcaabaaabcbaacbcbaccaaaccbccbcaacbaccbaacbbabbabbbbbaaaaaaabbbbcacacbcabaccaabbbcaaabbccccbbbcbccccbbcaabaaabcbaacbcbaccaaaccbccbcaacbaccbaacbbabbabbbbbaaaaaaabbbbcacacbcabaccaabbbcaaabbccccbbbcbccccbbcaabaaabcbaacbcbaccaaaccbccbcaacbaccbaacbbabbabbbbbaaaaaaabbbbcacacbcabaccaabbbcaaabbccccbbbcbccccbbcaabaaabcbaacbcbaccaaaccbccbcaacbaccbaacbbabbabbbbbaaaaaaabbbbcacacbcabaccaabbbcaaabbccccbbbcbccccbbcaabaaabcbaacbcbaccaaaccbccbcaacbaccb\"</code></p>\n\n<p>Could you help me figure out what I'm doing wrong, or what's going on?</p>\n"}, {"tags": ["haskell", "data-structures", "functional-programming", "idris"], "comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1449768778, "post_id": 34208219, "comment_id": 56160802, "body": "I&#39;ve asked similar questions before but I think nobody ever came with a good enough solution."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 6, "creation_date": 1449769138, "post_id": 34208219, "comment_id": 56161035, "body": "Why don&#39;t you think that &quot;accurately reflects what a <code>Complex</code> is&quot;?  (That said, your <code>Real</code> only includes finitely long decimal values, which is a strict subset of the rationals.)  I mean, I suppose you could represent it as the real polynomials mod x^2 + 1, but it&#39;s not clear to me what your objection is."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1449769236, "post_id": 34208219, "comment_id": 56161084, "body": "Mathematically speaking, there is no &quot;fundamental structure&quot; of anything other than what we pick, and if we like we can show two different structures are equivalent and use them interchangeably.  There&#39;s nothing unmathematical about your representation of the integers."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1449769277, "post_id": 34208219, "comment_id": 56161116, "body": "The point is, I just came with those types of nowhere with no mathematical background or real understanding of how those numbers work. I think it is pretty safe to assume that there are better representations than my sketchy solution, so I&#39;m asking what people with greater mathematical knowledge came up with."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 3, "creation_date": 1449769606, "post_id": 34208219, "comment_id": 56161293, "body": "Also, structures, even if truly isomorphic, matter for performance and ease of use, for example. I could encode natural numbers as <code>data Nat = Add Nat Nat | FloorHalf Nat | Two | Zero</code>, but implementing algebraic algorithms on that would be terribly messy. It is quite clear that isn&#39;t a good representation of Nats. I think the same could be said about my arbitrary encodings..."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 5, "creation_date": 1449769878, "post_id": 34208219, "comment_id": 56161414, "body": "I think you&#39;ll tend to find that performance and mathematical elegance are conflicting goals.  You might start by representing naturals in binary, e.g. with <code>[Bool]</code>, but it&#39;s not really clear what you&#39;re going for."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1449770064, "post_id": 34208219, "comment_id": 56161518, "body": "Louis, I&#39;ll be happy if you just point me to links where I can read about different, better thought encodings of numbers whatever the reason is for. I just want to learn, do we really need to complicate that request so much? My goal is mostly mathematical elegance."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1449770450, "post_id": 34208219, "comment_id": 56161757, "body": "The problem with this question is that &quot;natural&quot; and &quot;elegant&quot; are too subjective. I think it is perfectly natural and elegant to define the set of integers as the union of the set of non-negative integers (Nat) and the additive inverse of that set, which corresponds closely to your encoding of <code>Integer</code>. An objective measure is something like &quot;I need a representation of numbers that will be performant in this particular scenario&quot; or &quot;I need a representation of numbers which will allow me to encode these properties about the numbers in the type system&quot; or something of the sort."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1449770552, "post_id": 34208219, "comment_id": 56161797, "body": "Can you just disregard the question and point me to a few interesting resources on numeric encodings that are interesting for you? If I just have some suggestions and pointers that will be already of great help."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1449770656, "post_id": 34208219, "comment_id": 56161848, "body": "You might want to read a bit about homotopy type theory. Heavy stuff, but it gets deeply into the whole issue of non-unique representations."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449770714, "post_id": 34208219, "comment_id": 56161873, "body": "@dfeuer I&#39;ve asked on the #haskell channel those days if there is any resource on HoTT aimed to people without mathematical backgrounds, or, at least, a roadmap for a person without such towards HoTT. I think nobody answered, though. Or I forgot to ask. Don&#39;t remember..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449770860, "post_id": 34208219, "comment_id": 56161941, "body": "Let me know if you find one; I know nothing about type theory myself."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1449775348, "post_id": 34208219, "comment_id": 56164161, "body": "Agda&#39;s <a href=\"https://github.com/agda/agda-stdlib/blob/master/src/Data/Integer/Base.agda#L28\" rel=\"nofollow noreferrer\"><code>Integer</code></a> doesn&#39;t contain two zeros. <a href=\"https://hal.inria.fr/hal-00806920v1/document\" rel=\"nofollow noreferrer\">Here</a> is a survey about constructive reals. To study HoTT, you first need to study ITT, since HoTT = ITT + univalence + HITs. If you&#39;re comfortable with ITT, then the HoTT book should be comprehensible (I&#39;ve read just a few chapters, though)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1449776019, "post_id": 34208219, "comment_id": 56164497, "body": "Thanks, @user3237465, that kind of link is what I&#39;m always looking for. What would you suggest to study ITT? Also, why ITT, not CoC? I thought it was regarded as a better system?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1449777784, "post_id": 34208219, "comment_id": 56165494, "body": "@Viclib, CoC is a weak system as it contains only <code>Prop</code>. CIC has a proper hierarchy of universes as well as ECC (an Extended Calculus of Constructions), which is a mix of CoC and stratified MLTT. Add inductive data types to ECC and you&#39;ll get UTT (Unified Type Theory). And there is also <a href=\"http://www.andres-loeh.de/PiSigma/PiSigma.pdf\" rel=\"nofollow noreferrer\">PiSigma</a>. All these are ITTs (Intensional Type Theory) and it doesn&#39;t matter much which to study, as they all are very similar. I&#39;d suggest to study an implementation of a type theory like Agda or Idris, but I don&#39;t have any good introductions on top of my head."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1449780424, "post_id": 34208219, "comment_id": 56167013, "body": "I see. But where do I learn about them deep enough? What is there to learn, anyway? I guess I&#39;ve successfully implemented coc at this point so I kinda know how it works. But knowing why it works, what can be done with it, or how I&#39;d use it to prove things... is another level..."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1449790680, "post_id": 34208219, "comment_id": 56172040, "body": "Well, Nat is isomorphic to the integers and rational numbers on its own, because all three are countably infinite types. For reals, you need something else however. You might want to look the Cauchy sequence and continued fraction representations of reals."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1449791249, "post_id": 34208219, "comment_id": 56172211, "body": "Here&#39;s a video about how you might implement those real number representations in Haskell: <a href=\"https://m.youtube.com/watch?v=LJQgYBQFtSE\" rel=\"nofollow noreferrer\">m.youtube.com/watch?v=LJQgYBQFtSE</a>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1449794934, "post_id": 34208219, "comment_id": 56173420, "body": "I was actually thinking of that video when I asked the question. The fact you posted it kinda shows how scarce is the published content on the matter..."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1449826801, "post_id": 34208219, "comment_id": 56184654, "body": "@Viclib, I&#39;d study <a href=\"https://github.com/pigworker/CS410-14\" rel=\"nofollow noreferrer\">these</a> Conor McBride&#39;s lectures notes, perhaps."}], "answers": [{"tags": [], "owner": {"reputation": 793, "user_id": 919707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa2dedcafcada278c1cafff49ed1e7f?s=128&d=identicon&r=PG", "display_name": "Alexander Gryzlov", "link": "https://stackoverflow.com/users/919707/alexander-gryzlov"}, "is_accepted": false, "score": 0, "last_activity_date": 1490110573, "creation_date": 1490110573, "answer_id": 42931628, "question_id": 34208219, "link": "https://stackoverflow.com/questions/34208219/how-do-you-formalize-the-numeric-tower-on-functional-languages/42931628#42931628", "title": "How do you formalize the numeric tower on functional languages?", "body": "<p>I realize this is an old question and my answer is in Scala rather than Haskell/Idris, but it could be interesting to see how they do it in <a href=\"https://github.com/non/spire\" rel=\"nofollow noreferrer\">Spire</a>. The approach there is to establish a hierarchy of algebraic structures (i.e., <code>Semigroup</code>/<code>Group</code>/<code>Ring</code>/<code>Field</code>/etc.) first and then instantiate numeric types on top of those, adding various algorithms from numerical methods. I'm sure one could find some useful ideas in there.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 409, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1490110573, "creation_date": 1449768763, "question_id": 34208219, "link": "https://stackoverflow.com/questions/34208219/how-do-you-formalize-the-numeric-tower-on-functional-languages", "title": "How do you formalize the numeric tower on functional languages?", "body": "<p>Everyone knows the elegant way to express natural numbers on dependently typed functional languages:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>Integer, Fraction, Real, Complex and Quaternion are, too, very important for practical programming application. One could implement them as:</p>\n\n<pre><code>data Integer    = Integer (sign : Bool) (modulus : Nat)\ndata Fraction   = Fraction (dividend : Nat) (divisor : Nat)\ndata Real       = Real (exponent : Integer) (fraction : Nat)\ndata Complex    = Complex Real Real\ndata Quaternion = Quaternion Real Real Real Real\n</code></pre>\n\n<p>But none of those really reflect the actual structure/nature of their types as meaningfully as Nats do. Integer isn't isomorphic to actual integers, for example (as Zero occurs twice). Reals needs more than a million of cells to store (3.141592), yet not even 100 to store (4096), which looks unbalanced. Complex is just a tuple of Reals, which doesn't really reflect what a Complex is. I wonder <strong>what is the natural, elegant way to express the numeric tower on functional programming languages?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "edited": false, "score": 0, "creation_date": 1449763554, "post_id": 34206422, "comment_id": 56157439, "body": "And if there aren&#39;t any other lists with <code>1</code> in the head? Leave the empty list empty?"}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "reply_to_user": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "edited": false, "score": 0, "creation_date": 1449763618, "post_id": 34206422, "comment_id": 56157490, "body": "Yeah, sorry forgot to mention that. Just realised I need an then and else"}, {"owner": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "edited": false, "score": 0, "creation_date": 1449763813, "post_id": 34206422, "comment_id": 56157623, "body": "When searching for a list that starts with <code>1</code>, do you want to check only lists after the current empty list or they may be wherever in the list of lists, even before the current empty list?"}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "reply_to_user": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "edited": false, "score": 1, "creation_date": 1449764177, "post_id": 34206422, "comment_id": 56157876, "body": "all the heads of the lists. So the it could be <code>a = [[1,3,1],[],[2,3],[9,1,2,3],[4]]</code> and would give <code>a = [[3,1],[1],[2,3],[9,1,2,3],[4]]</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1449765237, "post_id": 34206422, "comment_id": 56158615, "body": "And what if the number of empty lists doesn&#39;t match the number of lists with <code>1</code> in the head? If there are extra <code>1</code>s, which ones do you want to steal? If there are extra <code>[]</code>s, which do you want to leave empty?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 3, "creation_date": 1449765411, "post_id": 34206422, "comment_id": 56158712, "body": "<code>map</code> might not be the best approach here since you&#39;re not uniformly applying a function to all elements.  Perhaps, an explicit recursion fits better.  Also, I think you want to have these two actions happen both or none at all.  So the number of total numbers stay invariant."}], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449766218, "post_id": 34207219, "comment_id": 56159220, "body": "Ok, whats the best way to use <code>foldl</code>?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1449765700, "creation_date": 1449765700, "answer_id": 34207219, "question_id": 34206422, "link": "https://stackoverflow.com/questions/34206422/map-functions-basics-in-haskell/34207219#34207219", "title": "Map functions basics in Haskell", "body": "<p>This looks like it's going to be a horribly fussy problem to solve in an incremental fashion. Therefore, I suggest you think about monolithic solutions. Start off by counting the total number of empty lists and the total number of lists that start with <code>1</code>. Armed with these results, attack the original input again. The counting is easily done using <code>foldl'</code> if you're familiar with that, or you could use explicit recursion, or if you don't care about efficiency you could filter and count twice; the final attack will be easiest using explicit recursion.</p>\n"}, {"comments": [{"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449767464, "post_id": 34207599, "comment_id": 56160008, "body": "I&#39;m getting an <code>indentation or brackets mismatched</code> error on the <code>foldl</code>. but this look like a great solution"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449767846, "post_id": 34207599, "comment_id": 56160207, "body": "The code <a href=\"http://codepad.org/Z9TUqu7Q\" rel=\"nofollow noreferrer\">compiles</a> - perhaps you have not copied a parentheses or changed the indentation by mistake."}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449768349, "post_id": 34207599, "comment_id": 56160523, "body": "I think whe i copied it the indentations got moved"}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449770483, "post_id": 34207599, "comment_id": 56161771, "body": "Quick question, whats <code>fn</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449770598, "post_id": 34207599, "comment_id": 56161817, "body": "It is the parameter bound in the function <code>(\\(fn,xss&#39;) xs -&gt; ...)</code>, and it indicates whether or not <code>z</code> has been found in the list seen so far."}, {"owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "edited": false, "score": 0, "creation_date": 1449772755, "post_id": 34207599, "comment_id": 56162903, "body": "Also with this if you give <code>a=[[1,2],[],[],[]]</code> you get <code>a=[[2],[1],[1],[1]]</code> is there a way to stop this"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 1, "last_activity_date": 1449775620, "last_edit_date": 1449775620, "creation_date": 1449766861, "answer_id": 34207599, "question_id": 34206422, "link": "https://stackoverflow.com/questions/34206422/map-functions-basics-in-haskell/34207599#34207599", "title": "Map functions basics in Haskell", "body": "<p>The problem is straightforward if approached from the right direction. As a first approximation, you can define your function as a left fold over the input list:</p>\n\n<pre><code>fun :: Eq a =&gt; a -&gt; [[a]] -&gt; [[a]]\nfun z xss = newList \n  where (foundZ, newList, _) = foldl ... (False, [], False) xss\n</code></pre>\n\n<p>Note that the fold will return two values, namely the resulting list and a boolean indicating if a 1 (or in this case, the parameter <code>z</code>) is found in the list. The third parameter indicates if a list has already been replaced (we only want to do one replacement). If we are clever (and we will be) we can use the value of <code>foundZ</code> inside the body of the function passed to <code>foldl</code> - that is, we can use it before it has apparently been computed. All that is left is to write the argument function to foldl:</p>\n\n<pre><code>\\(fn,xss',rpl) xs -&gt;\n  case xs of \n    ...\n</code></pre>\n\n<p>Consider the different possibilities for <code>xs</code>: it is the empty list, it is the list containing a <code>z</code> as its head, and every other list:</p>\n\n<pre><code>    [] | not rpl -&gt; ...\n    (x:r) | x == z &amp;&amp; not fn -&gt; ...\n    _  -&gt; (fn, xs:xss',rpl)\n</code></pre>\n\n<p>Note that when we check for <code>x == z</code> we also check <code>not fn</code> because we only want to take a single <code>z</code> from a single list, so if we already found one, we do not want to do that again. In the case for the empty list, we check for <code>not rpl</code> for the same reason. The last case is obvious, but the first two may not be.</p>\n\n<pre><code>    [] | not rpl -&gt; (fn, (if foundZ then [z] else []):xss', True)\n</code></pre>\n\n<p>The case for the empty list simple checks if the <code>z</code> was found - if so, it returns a singleton list containing that <code>z</code>. </p>\n\n<pre><code>    (x:r) | x == z &amp;&amp; not fn -&gt; (True , r:xss', rpl) \n</code></pre>\n\n<p>The case for the list starting with a <code>z</code> returns <code>True</code> for <code>found</code> and prepends the <em>tail</em> of that list to the result (this is how the 1 gets removed).</p>\n\n<p>Put it all together and you get a simple function:</p>\n\n<pre><code>fun :: Eq a =&gt; a -&gt; [[a]] -&gt; [[a]]\nfun z xss = reverse newList \n  where (foundZ, newList, _) = \n          foldl \n            (\\(fn,xss',rpl) xs -&gt;\n              case xs of \n                [] | not rpl -&gt; (fn, (if foundZ then [z] else []):xss', True)\n                (x:r) | x == z &amp;&amp; not fn -&gt; (True , r:xss', rpl) \n                _  -&gt; (fn, xs:xss', rpl)\n            ) (False, [], False) xss \n</code></pre>\n\n<p>and </p>\n\n<pre><code>&gt;fun 1 [[2,1,3,1],[],[2,3],[1,2,3],[4]]\n[[2,1,3,1],[1],[2,3],[2,3],[4]]\n&gt;fun 1 [[1,2,1,3,1],[],[2,3],[1,2,3],[4]]\n[[2,1,3,1],[1],[2,3],[1,2,3],[4]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 3, "last_activity_date": 1449769822, "creation_date": 1449769822, "answer_id": 34208544, "question_id": 34206422, "link": "https://stackoverflow.com/questions/34206422/map-functions-basics-in-haskell/34208544#34208544", "title": "Map functions basics in Haskell", "body": "<p>Here I attempted to write easy-to-understand functional solution for a\nbeginner. This can be implemented more efficiently, of course.</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>doStuff :: Integral a =&gt; [[a]] -&gt; [[a]]\ndoStuff xs = let n = min holes donors in go n n xs\n  where go _ _ []          = []\n        go 0 m ([]:ys)     = []     : go 0       m ys\n        go n m ([]:ys)     = [1]    : go (n - 1) m ys\n        go n 0 ((1:zs):ys) = (1:zs) : go n       0 ys\n        go n m ((1:zs):ys) = zs     : go n (m - 1) ys\n        go n m (y:ys)      = y      : go n m       ys\n        holes              = count null    xs\n        donors             = count goodish xs\n        count f            = length . filter f\n        goodish (1:_)      = True\n        goodish _          = False\n</code></pre>\n\n<p>It even works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; doStuff [[2,1,3,1],[],[2,3],[1,2,3],[4]]\n[[2,1,3,1],[1],[2,3],[2,3],[4]]\n\u03bb&gt; doStuff [[1,2,1,3,1],[],[2,3],[1,2,3],[4]]\n[[2,1,3,1],[1],[2,3],[1,2,3],[4]]\n\u03bb&gt; doStuff [[1,2,1,3,1],[],[2,3],[1,2,3],[4],[],[]]\n[[2,1,3,1],[1],[2,3],[2,3],[4],[1],[]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "is_accepted": false, "score": 0, "last_activity_date": 1449786936, "creation_date": 1449786936, "answer_id": 34212981, "question_id": 34206422, "link": "https://stackoverflow.com/questions/34206422/map-functions-basics-in-haskell/34212981#34212981", "title": "Map functions basics in Haskell", "body": "<p>IMO <code>map</code> isn't really the right function for this job. Conceptually <code>map</code> transforms each element of a collection using a function that only looks at the element itself. Obviously you can write a <code>map</code> where the function uses \"external\" variables using lambdas, scoping etc. but I suggest staying as close to the concept of <code>map</code> as possible.</p>\n\n<p>The idea of \"take that 1 and put it in the [] list.\" implies (take and put) an imperative approach with side-effects, something we want to avoid as much as possible in a purely functional language as haskell.</p>\n\n<p>You can think about it in another way: there is no need to actually \"move\" the <code>1</code>, i.e. to know which <code>1</code> ends up in which <code>[]</code>. Counting the number of empty lists (let's call it <code>x</code>) and the number of lists that start with <code>1</code> (<code>y</code>) is enough, we just have then to create a new lists that</p>\n\n<ul>\n<li>replaces the first <code>min(x,y)</code> occurrences of empty lists with <code>[1]</code></li>\n<li>Takes the <code>tail</code> of the first <code>min(x,y)</code> lists that start with <code>1</code></li>\n</ul>\n\n<p>A probably improvable implementation:</p>\n\n<pre><code>redistributeOnes :: [[Int]] -&gt; [[Int]]\nredistributeOnes xs = redistributeOnes' n n xs where\n  n = min (length $ filter (==[]) xs) (length $ filter (\\l -&gt; if l == [] then False else (head l) == 1) xs)\n  redistributeOnes' _ _ [] = []\n  redistributeOnes' 0 0 xs = xs\n  redistributeOnes' n m ([]:xs) | n &gt; 0 = [1] : redistributeOnes' (n-1) m xs\n                                | otherwise = [] : redistributeOnes' n m xs\n  redistributeOnes' n m (x:xs)  | head x == 1 &amp;&amp; m &gt; 0 = (tail x) : redistributeOnes' n (m-1) xs\n                                | otherwise = x : redistributeOnes' n m xs\n</code></pre>\n\n<p>Tests:</p>\n\n<pre><code>\u03bb&gt; redistributeOnes [[], [1,2]]\n[[1],[2]]\n\u03bb&gt; redistributeOnes [[], [1,2], [], [], [1,2,3]]\n[[1],[2],[1],[],[2,3]]\n\u03bb&gt; redistributeOnes [[], [1,2], [], [1,2,3]]\n[[1],[2],[1],[2,3]]\n\u03bb&gt; redistributeOnes [[]]\n[[]]\n\u03bb&gt; redistributeOnes [[], [1,2,3]]\n[[1],[2,3]]\n\u03bb&gt; redistributeOnes [[1,2,3]]\n[[1,2,3]]\n\u03bb&gt; redistributeOnes [[1,2,3], [], [], [], [2,5,1], [1,2], [], [1,100]]\n[[2,3],[1],[1],[1],[2,5,1],[2],[],[100]]\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 5449377, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/5c1b0852a7e9e7a953ae50583dcd09e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neo Streets", "link": "https://stackoverflow.com/users/5449377/neo-streets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 34207599, "answer_count": 4, "score": 4, "last_activity_date": 1449786936, "creation_date": 1449763308, "last_edit_date": 1449764259, "question_id": 34206422, "link": "https://stackoverflow.com/questions/34206422/map-functions-basics-in-haskell", "title": "Map functions basics in Haskell", "body": "<p>I'm self learning Haskell and have come across an issue with the <code>map</code> function and was looking for help. What i'm trying to do is take a list of lists and if a list is empty so is <code>[]</code> and one of the other lists has a <code>1</code> in the head. Then to take that <code>1</code> and put it in the <code>[]</code> list.</p>\n\n<pre><code>a = [[2,1,3,1],[],[2,3],[1,2,3],[4]]\n</code></pre>\n\n<p>and make it</p>\n\n<pre><code>a = [[2,1,3,1],[1],[2,3],[2,3],[4]]\n</code></pre>\n\n<p>so far I have something along the lines of I haven't got the complete thing.</p>\n\n<pre><code>((map (\\k-&gt; if ([])&amp;&amp;(elem 1 heads))a) \nwhere heads = map head a\n</code></pre>\n\n<p>But I also have to have it so that if <code>a = [[1,2,1,3,1],[],[2,3],[1,2,3],[4]]</code>\nwill give <code>a = [[2,1,3,1],[1],[2,3],[1,2,3],[4]]</code> so it only moves one <code>1</code> to the empty list.</p>\n\n<p>I know this wont work, but I have been trying to do it for a couple of hours now but i'm not getting anywhere</p>\n"}, {"tags": ["haskell", "haskell-lens", "bounded-types"], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1449756369, "last_edit_date": 1449756369, "creation_date": 1449755127, "answer_id": 34203498, "question_id": 34201600, "link": "https://stackoverflow.com/questions/34201600/prism-for-converting-to-a-bounded-integral/34203498#34203498", "title": "Prism for converting to a Bounded Integral", "body": "<p>A slightly unsatisfying answer: I don't think there's a library that'll help you here.</p>\n\n<p>Really, you'd need something like</p>\n\n<pre><code>safeIntegerToBoundedIntegral :: (Integral b, Bounded b) =&gt; Integer -&gt; Maybe b\nsafeIntegerToBoundedIntegral = boundedFromInteger (minBound, maxBound)\n\n-- helper function's signature lets you avoid `ScopedTypeVariables`\nboundedFromInteger :: Integral b =&gt; (b,b) -&gt; Integer -&gt; Maybe b\nboundedFromInteger (lo,hi) n | toInteger lo &lt;= n &amp;&amp; n &lt;= toInteger hi = Just (fromInteger n)\nboundedFromInteger _ _ = Nothing\n</code></pre>\n\n<p>which I don't currently see on hoogle or hayoo, then you'd be able to express it a little more easily:</p>\n\n<pre><code>integerAsIntegral :: Integral a =&gt; Iso' Integer a\nintegerAsIntegral = iso fromInteger toInteger\n\nintegerAsBoundedIntegral :: (Integral a, Bounded a) =&gt; Prism' Integer a\nintegerAsBoundedIntegral = prism toInteger $ \\n -&gt; \n  maybe (Left n) Right $ safeIntegerToBoundedIntegral n\n\nintegralAsBoundedIntegral :: (Integral a, Integral b, Bounded b) =&gt; Prism' a b\nintegralAsBoundedIntegral = from integerAsIntegral . integerAsBoundedIntegral\n</code></pre>\n\n<p>I split this up the way that I did because I don't know of any guarantee that <code>fromIntegral</code> is order-preserving; \nthat is, that <code>a &lt; b</code> &rArr; <code>fromIntegral a &lt; fromIntegral b</code>, and so I settled on using <code>Integer</code> as the canonical order\nwhen comparing <code>Integral</code>s so it'd at least be consistent.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1449815293, "last_edit_date": 1449815293, "creation_date": 1449766959, "answer_id": 34207640, "question_id": 34201600, "link": "https://stackoverflow.com/questions/34201600/prism-for-converting-to-a-bounded-integral/34207640#34207640", "title": "Prism for converting to a Bounded Integral", "body": "<p>I think the most direct question is not \"Is the number in bounds?\" but \"Can the number go round trip?\" So I'd drop the <code>Bounded</code> question altogether:</p>\n\n<pre><code>narrowIntegral :: (Integral a, Integral b) =&gt; Prism' a b\nnarrowIntegral = prism fromIntegral f where\n  f n | fromIntegral candidate == n = Right candidate\n      | otherwise = Left n\n      where candidate = fromIntegral n\n</code></pre>\n\n<p>The only trouble is that you could potentially hit an <code>Integral</code> type whose <code>fromInteger</code> function is partial. You could try checking bounds in that case, but it might be more fun to go a bit wild with something like this:</p>\n\n<pre><code>narrowIntegral :: (Integral a, NFData a, Integral b, NFData b) =&gt; Prism' a b\nnarrowIntegral = prism fromIntegral f where\n  f n = n `deepseq` unsafePerformIO (narrow n)\n\nnarrow :: (Integral a, Integral b, NFData b) =&gt; a -&gt; IO (Either a b)\nnarrow n = (evaluate . force) (narrow' n) `catches`\n             [Handler (\\(_ :: ArithException) -&gt; return (Left n))\n             ,Handler (\\(_ :: PatternMatchFail) -&gt; return (Left n))\n             ,Handler (\\(_ :: ErrorCall) -&gt; return (Left n))]\n\nnarrow' n\n  | fromIntegral candidate == n = Right candidate\n  | otherwise = Left n\n  where candidate = fromIntegral n\n</code></pre>\n"}], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1449815293, "creation_date": 1449749521, "last_edit_date": 1449751145, "question_id": 34201600, "link": "https://stackoverflow.com/questions/34201600/prism-for-converting-to-a-bounded-integral", "title": "Prism for converting to a Bounded Integral", "body": "<p>I needed a Prism for converting an <code>Integral a =&gt; a</code> to an <code>(Integral b, Bounded b) =&gt; b</code>, ensuring that the <code>a</code> actually fits into the type of <code>b</code>.\nMy current definition (below) requires the use of <code>ScopedTypeVariables</code> and is quite verbose.</p>\n\n<p>I would like to know if there is a better (ideally already defined, and I missed it) way to check if a number fits into a <code>Bounded</code> type, or a function for <em>safe</em> conversion, that I can use to build the prism.</p>\n\n<p>The current definition:</p>\n\n<pre><code>boundedInt :: forall a b. (Integral a, Integral b, Bounded b) =&gt; Prism' a b\nboundedInt = prism fromIntegral f where\n  f n =\n    if n &gt;= fromIntegral (minBound :: b) &amp;&amp; n &lt;= fromIntegral (maxBound :: b)\n    then Right (fromIntegral n)\n    else Left n\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1449748021, "post_id": 34200998, "comment_id": 56146850, "body": "Because <code>()</code> is already in normal form (and, therefore, in WHNF), I don&#39;t think there is any point in using a bang pattern, here."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1449749234, "post_id": 34200998, "comment_id": 56147679, "body": "A bang before a constructor pattern is pointless -- we are forcing the value anyway."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1449751168, "post_id": 34200998, "comment_id": 56148887, "body": "Some investigation of the repo reveals that this bang pattern was introduced by Michael Snoyman in <a href=\"https://github.com/commercialhaskell/stack/commit/5039c19655f496926fa882c93efe2867afb97468\" rel=\"nofollow noreferrer\">this commit</a>. Perhaps you should post your question in the repo&#39;s issue tracker and ask him what he was thinking at the time of writing it. Michael knows his stuff, so I&#39;d say he simply left this superfluous bang in by an oversight."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1449755897, "post_id": 34200998, "comment_id": 56151893, "body": "Maybe it was just to make it more obvious that a forced evaluation is being made?"}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1449757650, "creation_date": 1449757650, "answer_id": 34204374, "question_id": 34200998, "link": "https://stackoverflow.com/questions/34200998/is-a-bang-pattern-on-unit-really-needed-here/34204374#34204374", "title": "Is a bang pattern on unit really needed here?", "body": "<p>If in doubt (and not in a hurry) consult the <a href=\"https://www.haskell.org/report\">specification</a>.</p>\n\n<p>The expression</p>\n\n<pre><code>do !() &lt;- foo\n   bar\n</code></pre>\n\n<p><a href=\"https://www.haskell.org/report/node/2010/haskellch3.html#x8-470003.14\">desugars</a> to </p>\n\n<pre><code>let ok !() = bar\n    ok _   = fail ..\nin foo &gt;&gt;= ok\n</code></pre>\n\n<p>By the <a href=\"https://www.haskell.org/report/node/2010/haskellch4.html#x10-830004.4.3\">rules for function definition</a> this is equivalent to </p>\n\n<pre><code>let ok = \\x -&gt; case x of !() -&gt; bar\n                         _   -&gt; fail ...\nin foo &gt;&gt;= ok\n</code></pre>\n\n<p>Now the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bang-patterns.html\">rules for bang patterns</a> are in the GHC user guide, as it is non-standard haskell. there we find that we can rewrite this into</p>\n\n<pre><code>let ok = \\x -&gt; x `seq` (case x of () -&gt; bar\n                                  _  -&gt; fail ...)\nin foo &gt;&gt;= ok\n</code></pre>\n\n<p>Now <a href=\"https://www.haskell.org/report/node/2010/haskellch6.html#x13-1260006.2\"><code>seq</code> is defined</a> in terms of its argument being \u22a5 or not. So either <code>x</code> is \u22a5, but then the second argument to <code>seq</code>, namely the <code>case x of ...</code> is also \u22a5 according to the <a href=\"https://www.haskell.org/report/node/2010/haskellch3.html#x8-610003.17.3\">semantics of pattern matching</a>. Or <code>x</code> is not \u22a5, and the <code>seq</code> equals its second argument. In either case, the above code is identical to </p>\n\n<pre><code>let ok = \\x -&gt; case x of () -&gt; bar\n                         _  -&gt; fail ...\nin foo &gt;&gt;= ok\n</code></pre>\n\n<p>which, tracing back these steps, is equivalent to </p>\n\n<pre><code>do () &lt;- foo\n   bar\n</code></pre>\n\n<p>So in conclusion: There is no reason to do that in a <code>do</code> expression.</p>\n\n<p>There is, however, a difference between</p>\n\n<pre><code>let () = foo\nin bar\n</code></pre>\n\n<p>(where <code>foo</code> will never be evaluated) and</p>\n\n<pre><code>let !() = foo\nin bar\n</code></pre>\n\n<p>because let-expressions have special provisions in the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bang-patterns.html\">semantics for bang patterns</a>.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 2, "accepted_answer_id": 34204374, "answer_count": 1, "score": 7, "last_activity_date": 1449757650, "creation_date": 1449747724, "last_edit_date": 1449751465, "question_id": 34200998, "link": "https://stackoverflow.com/questions/34200998/is-a-bang-pattern-on-unit-really-needed-here", "title": "Is a bang pattern on unit really needed here?", "body": "<p>While hacking Stack, I found <a href=\"https://github.com/commercialhaskell/stack/blob/master/src/System/Process/Read.hs#L345-L346\" rel=\"noreferrer\">this</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>!() &lt;- atomicModifyIORef (eoExeCache eo) $ \\m' -&gt;\n    (Map.insert name epath m', ())\n</code></pre>\n\n<p>HLint says: \u201cremove that thing\u201d. But I don't think it's a typo. Is there any reason to ever write <code>!()</code>?</p>\n"}, {"tags": ["java", "haskell", "java-stream"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 3, "creation_date": 1449782541, "post_id": 34197567, "comment_id": 56168209, "body": "Yes, <code>Stream</code> is not the right interface here.  Java&#39;s Streams provide only operations which can be efficiently parallelized, which does not include scanl with arbitrary operations."}], "answers": [{"comments": [{"owner": {"reputation": 82276, "user_id": 1587046, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/onb2X.jpg?s=128&g=1", "display_name": "Alexis C.", "link": "https://stackoverflow.com/users/1587046/alexis-c"}, "edited": false, "score": 4, "creation_date": 1449744622, "post_id": 34199267, "comment_id": 56144737, "body": "I know the OP asked for streams, but if you&#39;re working with arrays, you might also consider <code>Arrays.parallelPrefix</code>; for instance <code>Arrays.parallelPrefix(arr, Integer::sum);</code>. It&#39;s not a strict scan left, as I think it needs both an initial value and a binary operator, but well..."}, {"owner": {"reputation": 86357, "user_id": 4856258, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d9ea19ceff450eb6e272da697ced62dc?s=128&d=identicon&r=PG&f=1", "display_name": "Tagir Valeev", "link": "https://stackoverflow.com/users/4856258/tagir-valeev"}, "reply_to_user": {"reputation": 82276, "user_id": 1587046, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/onb2X.jpg?s=128&g=1", "display_name": "Alexis C.", "link": "https://stackoverflow.com/users/1587046/alexis-c"}, "edited": false, "score": 3, "creation_date": 1449746629, "post_id": 34199267, "comment_id": 56145995, "body": "@AlexisC., yes, it&#39;s a good addition (consider writing your answer!). However it should be noted that <code>parallelPrefix</code> needs an associative function like <code>reduce</code>."}], "tags": [], "owner": {"reputation": 86357, "user_id": 4856258, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d9ea19ceff450eb6e272da697ced62dc?s=128&d=identicon&r=PG&f=1", "display_name": "Tagir Valeev", "link": "https://stackoverflow.com/users/4856258/tagir-valeev"}, "is_accepted": true, "score": 6, "last_activity_date": 1449742885, "creation_date": 1449742885, "answer_id": 34199267, "question_id": 34197567, "link": "https://stackoverflow.com/questions/34197567/what-is-the-equivalent-of-haskells-scanl-in-javas-streams/34199267#34199267", "title": "What is the equivalent of Haskell&#39;s scanl in Java&#39;s streams?", "body": "<p>Looks like standard Stream API has no <code>scanl</code> equivalent. One of the reasons is the fact that <code>scanl</code> is strictly left-to-right operation which makes it hard to have benefits from parallel processing (and parallel processing is an important part of Stream API). You may however use third-party libraries like my free <a href=\"https://github.com/amaembo/streamex\" rel=\"noreferrer\">StreamEx</a> library. It extends standard Stream API adding many more useful functions including the <a href=\"http://amaembo.github.io/streamex/javadoc/one/util/streamex/StreamEx.html#scanLeft-java.util.function.BinaryOperator-\" rel=\"noreferrer\"><code>scanLeft</code></a>:</p>\n\n<pre><code>List&lt;Integer&gt; list = IntStreamEx.range(10).boxed().scanLeft(Integer::sum);\nSystem.out.println(list);\n// outputs [0, 1, 3, 6, 10, 15, 21, 28, 36, 45]\n</code></pre>\n\n<p>This <code>scanLeft</code> operation is guaranteed to work even with parallel streams, but you're unlikely to have the speedup unless you have some computational intensive upstream operations which could be parallelized.</p>\n"}], "owner": {"reputation": 6905, "user_id": 304874, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/747fc0ce46f05418e2c1c5ce724fd0f9?s=128&d=identicon&r=PG", "display_name": "Graeme Moss", "link": "https://stackoverflow.com/users/304874/graeme-moss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 1, "accepted_answer_id": 34199267, "answer_count": 1, "score": 7, "last_activity_date": 1449742892, "creation_date": 1449738249, "last_edit_date": 1495539972, "question_id": 34197567, "link": "https://stackoverflow.com/questions/34197567/what-is-the-equivalent-of-haskells-scanl-in-javas-streams", "title": "What is the equivalent of Haskell&#39;s scanl in Java&#39;s streams?", "body": "<p>As <a href=\"https://stackoverflow.com/questions/14423794/equivalent-of-haskell-scanl-in-python\">this question</a> asked for python, what is the equivalent of Haskell's scanl in Java's streams?</p>\n\n<p>The best I've come up with so far is to use</p>\n\n<pre><code>reduce(identity, accumulator, combiner)\n</code></pre>\n\n<p>with an accumulator that keeps the latest result and accumulates the results in a list, though the combiner would presumably not be not used.  I'm also not sure how to prevent it from being used in parallel, where it would not work.</p>\n\n<p>Perhaps Stream is the wrong interface for (an equivalent of) scanl?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1449729403, "post_id": 34193409, "comment_id": 56136252, "body": "The real question is where is this class and why isn&#39;t it using SBV?"}], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": false, "score": 4, "last_activity_date": 1449724537, "creation_date": 1449724537, "answer_id": 34194188, "question_id": 34193409, "link": "https://stackoverflow.com/questions/34193409/why-does-this-solution-to-the-queens-dilemma-run-so-much-slower-than-the-other/34194188#34194188", "title": "Why does this solution to the &quot;queens&quot; dilemma run so much slower than the other in Haskell?", "body": "<p>My guess is that your first version does a depth-first traversal while your second version does a breadth-first traversal of the tree (<a href=\"https://en.wikipedia.org/wiki/Tree_traversal\" rel=\"nofollow noreferrer\">see Tree Traversal on Wikipedia</a>).</p>\n\n<p>As the complexity of the problem grows with the size of the board, the second version uses more and more memory to keep track of each level of the tree while the first version quickly forgets the previous branch it visited.</p>\n\n<p>Managing the memory takes a lot of time!</p>\n\n<p>By <a href=\"https://nikita-volkov.github.io/profiling-cabal-projects/\" rel=\"nofollow noreferrer\">enabling profiling</a>, you can see how the Haskell runtime behaves with your functions.</p>\n\n<p>If you compare the number of calls, they are strictly the same, but still the second version takes more time:</p>\n\n<pre><code>COST CENTRE          MODULE                  no.     entries  %time %alloc   %time %alloc\n\nMAIN                 MAIN                     44           0    0.0    0.0   100.0  100.0\n main                Main                     89           0    0.3    0.0     0.3    0.0\n CAF                 Main                     87           0    0.0    0.0    99.7  100.0\n  main               Main                     88           1    0.2    0.6    99.7  100.0\n   queens2           Main                     94           1    0.0    0.0    55.6   48.2\n    queens2.solve    Main                     95          13    3.2    0.8    55.6   48.2\n     queens2.safe    Main                     96    10103868   42.1   47.5    52.3   47.5\n      queens2.checks Main                    100    37512342   10.2    0.0    10.2    0.0\n   queens1           Main                     90           1    0.0    0.0    43.9   51.1\n    queens1.solve    Main                     91          13    2.0    1.6    43.9   51.1\n     queens1.safe    Main                     92    10103868   29.3   49.5    41.9   49.5\n      queens1.checks Main                     93    37512342   12.7    0.0    12.7    0.0\n</code></pre>\n\n<p>Looking at the heap profile tells you what really happens.</p>\n\n<p>The first version has a small and constant heap use:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KZBb3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KZBb3.png\" alt=\"enter image description here\"></a></p>\n\n<p>While the second version has a huge heap use which must also face garbage collection (look at the peaks):</p>\n\n<p><a href=\"https://i.stack.imgur.com/IsMmN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IsMmN.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1449726441, "creation_date": 1449726441, "answer_id": 34194597, "question_id": 34193409, "link": "https://stackoverflow.com/questions/34193409/why-does-this-solution-to-the-queens-dilemma-run-so-much-slower-than-the-other/34194597#34194597", "title": "Why does this solution to the &quot;queens&quot; dilemma run so much slower than the other in Haskell?", "body": "<p>Looking at the core, the first function generates a <em>single</em> function in core, which is tail recursive (constant stack space - very fast and very nice function. Thanks GHC!). However, the 2nd generates <em>two</em> functions: one to do a single step of the inner loop; and a 2nd function which looks like </p>\n\n<p><code>loop x = case x of { 0 -&gt; someDefault; _ -&gt; do1 (loop (x-1)) }</code></p>\n\n<p>This function likely isn't performant because <code>do1</code> must traverse the entire input list, and each iteration appends new elements to the list (meaning the input list to <code>do1</code> grows monotonically in length). Whereas the core function for the fast version is generating the output list directly, without having to process some other list. It is quite difficult to reason about the performance of list comprehension, I believe, so first translate the function to not use them:</p>\n\n<pre><code>guard b = if b then [()] else [] \n\nsolve_good k = \n          concatMap (\\partial -&gt; \n          concatMap (\\h -&gt; \n          guard (safe h partial) &gt;&gt; return (h:partial)\n           ) [0..n-1]\n           ) (solve $ k-1)\n\nsolve_bad k = \n          concatMap (\\h -&gt; \n          concatMap (\\partial -&gt; \n          guard (safe h partial) &gt;&gt; return (h:partial)\n           ) (solve $ k-1)\n           ) [0..n-1]\n</code></pre>\n\n<p>The transformation is fairly mechanical and is detailed somewhere in the Haskell report, but essentially <code>&lt;-</code> becomes <code>concatMap</code> and conditions become <code>guard</code>s. It is much easier to see what is happening now - <code>solve_good</code> makes a recursive call a single time, then <code>concatMap</code>s over that recursively created list. However, <code>solve_bad</code> makes the recursive call <em>inside</em> the outer <code>concatMap</code>, meaning it will potentially (likely) be recomputed for every element in <code>[0..n-1]</code>. Note that there is no <em>semantic</em> reason for <code>solve $ k-1</code> to be in the inner <code>concatMap</code> - it does not depend on the value that that concatMap binds (the <code>h</code> variable) so it can be safely lifted out above the concatMap which binds <code>h</code> (as is done in <code>solve_good</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 271, "user_id": 4852976, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/609d83a4dd37b831b5cd1619c9b099d7?s=128&d=identicon&r=PG&f=1", "display_name": "UBears", "link": "https://stackoverflow.com/users/4852976/ubears"}, "edited": false, "score": 0, "creation_date": 1449769825, "post_id": 34196506, "comment_id": 56161395, "body": "Thank you! This was the answer I was looking for in simple enough terms that I could understand."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1449734812, "last_edit_date": 1449734812, "creation_date": 1449734406, "answer_id": 34196506, "question_id": 34193409, "link": "https://stackoverflow.com/questions/34193409/why-does-this-solution-to-the-queens-dilemma-run-so-much-slower-than-the-other/34196506#34196506", "title": "Why does this solution to the &quot;queens&quot; dilemma run so much slower than the other in Haskell?", "body": "<p>Simply put,</p>\n\n<pre><code>[ ... | x &lt;- f 42, n &lt;- [1..100] ]\n</code></pre>\n\n<p>will evaluate <code>f 42</code> once to a list, and for each element <code>x</code> in such list it will generate all <code>n</code>s from <code>1</code> to <code>100</code>. Instead,</p>\n\n<pre><code>[ ... | n &lt;- [1..100], x &lt;- f 42 ]\n</code></pre>\n\n<p>will first generate an <code>n</code> from <code>1</code> to <code>100</code>, and for each of them call <code>f 42</code>. So <code>f</code> is now being called 100 times instead of one.</p>\n\n<p>This is no different from what happens in imperative programming when using nested loops:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>for x in f(42):    # calls f once\n   for n in range(1,100): \n      ...\nfor n in range(1,100): \n   for x in f(42): # calls f 100 times\n      ...\n</code></pre>\n\n<p>The fact that your algorithm is recursive makes this swap particularly expensive, since the additional cost factor (100, above) accumulates at each recursive call.</p>\n\n<p>You can also try to bind the result of <code>f 42</code> to some variable so that it does not need to be recomputed, even if you nest it the other way around:</p>\n\n<pre><code>[ ... | let xs = f 42, n &lt;- [1..100], x &lt;- xs ]\n</code></pre>\n\n<p>Note that this will keep the whole <code>xs</code> list in memory for the whole loop, preventing it from being garbage collected. Indeed, <code>xs</code> will be fully evaluated for <code>n=1</code>, and then reused for higher values of <code>n</code>.</p>\n"}], "owner": {"reputation": 271, "user_id": 4852976, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/609d83a4dd37b831b5cd1619c9b099d7?s=128&d=identicon&r=PG&f=1", "display_name": "UBears", "link": "https://stackoverflow.com/users/4852976/ubears"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 2, "accepted_answer_id": 34196506, "answer_count": 3, "score": 4, "last_activity_date": 1449734812, "creation_date": 1449719692, "question_id": 34193409, "link": "https://stackoverflow.com/questions/34193409/why-does-this-solution-to-the-queens-dilemma-run-so-much-slower-than-the-other", "title": "Why does this solution to the &quot;queens&quot; dilemma run so much slower than the other in Haskell?", "body": "<p>In my computer science class we were using Haskell to solve the \"queens\" problem in which you must find all possible placements of n queens in an nxn board.  This was the code we were given:</p>\n\n<pre><code>queens n = solve n\n    where\n        solve 0 = [ [] ]\n        solve k = [ h:partial | partial &lt;- solve(k-1), h &lt;- [0..(n-1)], safe h partial ]\n        safe h partial = and [ not (checks h partial i) | i &lt;- [0..(length partial)-1] ]\n        checks h partial i = h == partial!!i || abs(h-partial!!i) == i+1\n</code></pre>\n\n<p>However, the first time I entered it I accidentally swapped the order in solve k and found that it still gave a correct solution but took much longer:</p>\n\n<pre><code>queens n = solve n\nwhere\n    solve 0 = [ [] ]\n    solve k = [ h:partial | h &lt;- [0..(n-1)], partial &lt;- solve(k-1), safe h partial ]\n    safe h partial = and [ not (checks h partial i) | i &lt;- [0..(length partial)-1] ]\n    checks h partial i = h == partial!!i || abs(h-partial!!i) == i+1\n</code></pre>\n\n<p>Why does this second version take so much longer?  My thought process is that the second version does recursion at every step while the first version does recursion only once and then backtracks.  This is not for a homework problem, I'm just curious and feel like it will help me better understand the language.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449713219, "post_id": 34192469, "comment_id": 56131331, "body": "Perhaps explain first the (essence) of what PE#58 is..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1449713357, "post_id": 34192469, "comment_id": 56131378, "body": "It&#39;s in the comments! :D"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449717413, "post_id": 34192469, "comment_id": 56132372, "body": "I haven&#39;t done any profiling or testing, so this is just guesses, but: in <code>corners</code>, <code>length ring</code> gets increasingly costly, and more importantly even if <code>length</code> were constant-time, <code>corners</code> itself would get increasingly costly. Perhaps you can use some arithmetic to replace <code>map corners rings</code> with a directly-computed list containing just corners without spending so much time skipping non-corners. I would also say that <code>isPrime</code> is easily a suspect for optimization."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1449724255, "post_id": 34192469, "comment_id": 56134295, "body": "I recommend representing your ring as <code>[[A]]</code> for some type <code>A</code>, so that each list in the list represents a &quot;row&quot; which always starts with a corner and ends right before another corner. Then the <code>corner</code> function is constant time. You can generate this &quot;ring&quot; from a flat list <code>[a]</code> in linear time (even if that list is infinite, for any <code>a</code> at all!). Then, the choice of concrete type is important - instead of just <code>Int</code> for the value, store a <code>(Int, Bool)</code> where the bool represents primality - then you can be sure you compute <code>isPrime</code> exactly once per natural, when you create the list."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "edited": false, "score": 0, "creation_date": 1449877414, "post_id": 34193375, "comment_id": 56212580, "body": "Thank you! :) If you&#39;re interested, here is the final solution I arrived at! <a href=\"https://github.com/danmaheshwari/Project-Euler/blob/master/EulerAnswers/p58.hs\" rel=\"nofollow noreferrer\">github.com/danmaheshwari/Project-Euler/blob/master/EulerAnsw&zwnj;&#8203;ers/&hellip;</a>"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1449737160, "last_edit_date": 1449737160, "creation_date": 1449719527, "answer_id": 34193375, "question_id": 34192469, "link": "https://stackoverflow.com/questions/34192469/debugging-inefficient-project-euler-58/34193375#34193375", "title": "Debugging inefficient Project Euler 58", "body": "<h1>Compilation</h1>\n\n<p>As always on Stack Overflow, I feel I need to make sure people are 1. compiling their code instead of using ghci 2. using optimizations.  Think of Haskell more like C in that you should compile to binary and use <code>-O2</code>, and not like Python where you just assume interpreted is a-ok.  So in short:</p>\n\n<pre><code>ghc -O2 -fllvm so.hs\n</code></pre>\n\n<p>If you do this you'll see your algorithm does terminate in a moderate amount of time - a couple minutes and low heap use.</p>\n\n<h1>Algorithm Issues</h1>\n\n<p>Why the heck does it take a couple of minutes?  Lets look!</p>\n\n<ol>\n<li><p><code>corners</code> is building a list of ints then taking the corners.  Why?  You know the length of the side at each new wrapping, just get the four numbers!  <code>[1]</code>  then <code>[3,5,7,9]</code>, <code>[13,17,21,25]</code>. That is, add 2,2,2,2.. 4,4,4,4... 6,6,6,6...  <code>replicate 4 (sidelength-1)</code> each time.</p></li>\n<li><p>[deleted] I thought you were re-verifying primes.</p></li>\n<li><p>A minor point and hidden by your lack of type signatures, but your diagLengths arithmetic is all doubles - use integer arithmetic then cast for oh so meaningless difference in performance  <code>diagLength = map fromIntegral ([1,5..] :: [Int])</code>.</p></li>\n</ol>\n\n<p>EDIT: So I thought the main issue was primes which I was wrong on.  At any rate, the idiomatic solutions I've tried yield results in ~0.3 seconds so it is doable.  I think building and traversing these largish lists for <code>corners</code> is rather killer as that costs allocation and memory accesses.</p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1449729666, "creation_date": 1449729666, "answer_id": 34195312, "question_id": 34192469, "link": "https://stackoverflow.com/questions/34192469/debugging-inefficient-project-euler-58/34195312#34195312", "title": "Debugging inefficient Project Euler 58", "body": "<p>While you can certainly take a brute force approach, there is a very simple functional solution. </p>\n\n<p>Firstly, remark that you only ever need to consider the corners of the spiral. And you can generate those numbers directly (without ever counting the numbers in between). There is a very simple geometric sequence for the corners in the given 7-length spiral:</p>\n\n<pre><code>[3,5,7,9],[13,17,21,25],[31,37,43,49]\n</code></pre>\n\n<p>Note the differences between consecutive elements in each list are constant, and the constant difference per list is increasing according to <code>[2,4,6..]</code>, and the difference between the last corner of one side and the first of the next side is twice the difference between consecutive values of the first list. This prose corresponds exactly to the following code:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\ncorners :: [[Integer]]\ncorners = [1] : go 3 2 where \n  go i0 !d = let l = i0+3*d \n                 d' = d+2 \n             in [i0,i0+d,i0+2*d,l] : go (l+d') d' \n</code></pre>\n\n<p>Note that the first corner is a special case. Also note the use of bang patterns - it is important for functions like these to be strict (corners never examines <code>d</code> so it must be forced manually). This is an important performance consideration.</p>\n\n<p>Next, consider a function which computes the ratio of primes in a single list. Since it must consider the old ratio, it should also take the old ratio as a parameter:</p>\n\n<pre><code>import Data.List (foldl')\nimport Math.NumberTheory.Primes.Testing (isPrime)\n\nprimeRatio :: (Int, Int) -&gt; [Integer] -&gt; (Int, Int) \nprimeRatio pR nums = foldl' (\\(!p,!t) n -&gt; (p + fromEnum (isPrime n), 1+t)) pR nums \n</code></pre>\n\n<p>The <code>fromEnum</code> converts <code>False</code> to <code>0</code> and <code>True</code> to <code>1</code> directly (instead of an <code>if</code>) - otherwise this function is straightforward. Note, again, the bang patterns and the use of <code>foldl'</code> - both important for performance here. Also, the primality test is the highly efficient <a href=\"https://en.wikipedia.org/wiki/Baillie%E2%80%93PSW_primality_test\" rel=\"nofollow\">Baille PSW</a> implemented by  the excellent arithmoi package - what primality test you use will significantly effect your performance. </p>\n\n<p>Now we can finally write a fast loop which consumes each corner list in linear time:</p>\n\n<pre><code>  go !rIndex (cs:css) tgt pR  \n    | tgt pR'   = 2*rIndex+1\n    | otherwise = go (rIndex+1) css tgt pR' \n      where pR' = primeRatio pR cs \n</code></pre>\n\n<p>Note that the final answer (the number of rows) is computed directly from the index (the distance from center to outer row). This must always be an odd number, which is the case for the expression <code>2*x+1</code>. The check for termination is just encoded as a parameter to this function - we don't have to decide what it is yet. If the termination check fails, then all we do is update the current ratio with the next element in the corners list! How simple. </p>\n\n<p>We have one final consideration: the ratio is below 10% for the first few rows. So we must treat those specially:</p>\n\n<pre><code>euler58 :: Integer\neuler58 =  \n  let prefix = 4 -- Number of cases to handle specially\n\n      -- Special and non special cases\n      (first,rest) = splitAt prefix corners \n\n      -- Initial part where the ratio is allowed to fall below the targe\n      initVals = foldl' primeRatio (0,0) first \n\n      go !rIndex (cs:css) tgt pR  \n        | tgt pR'   = 2*rIndex+1\n        | otherwise = go (rIndex+1) css tgt pR' \n          where pR' = primeRatio pR cs \n\n  in go prefix rest (\\(nPrimes, nTotal) -&gt; (nPrimes%nTotal) &lt; (1%10)) initVals \n</code></pre>\n\n<p>This computes the answer (26241) in less than half a second on my machine even when compiled without optimizations. I didn't even bother trying to optimize further - perhaps it could be pushed to be much faster, but it is already \"instant\" so there doesn't seem to be a point. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 2, "accepted_answer_id": 34193375, "answer_count": 2, "score": 3, "last_activity_date": 1449737160, "creation_date": 1449712868, "last_edit_date": 1449724588, "question_id": 34192469, "link": "https://stackoverflow.com/questions/34192469/debugging-inefficient-project-euler-58", "title": "Debugging inefficient Project Euler 58", "body": "<p>I'm trying to solve Project Euler's Problem 58.</p>\n\n<p>For some reason, when I run the following code, it makes it through around 3000 rings before my computer freezes, presumably from how taxing the code is. I'd get the solution given enough resources, but at present, I'm taking too long.</p>\n\n<p>However, it's as efficient as I can get it. I don't know what I could improve to solve the problem.</p>\n\n<p>The function <code>isPrime</code> simply takes an Int and returns if it's prime.</p>\n\n<p>The problem and my current solutions are below.</p>\n\n<pre><code>{-|\n - Problem 58\n -\n - Starting with 1 and spiralling anticlockwise in the following way, a square \n - spiral with side length 7 is formed.\n -\n - 37 36 35 34 33 32 31\n - 38 17 16 15 14 13 30\n - 39 18  5  4  3 12 29\n - 40 19  6  1  2 11 28\n - 41 20  7  8  9 10 27\n - 42 21 22 23 24 25 26\n - 43 44 45 46 47 48 49\n -\n - It is interesting to note that the odd squares lie along the bottom right \n - diagonal, but what is more interesting is that 8 out of the 13 numbers    lying\n - along both diagonals are prime; that is, a ratio of 8/13 \u2248 62%.\n -\n - If one complete new layer is wrapped around the spiral above, a square spiral\n - with side length 9 will be formed. If this process is continued, what is the\n - side length of the square spiral for which the ratio of primes along both \n - diagonals first falls below 10%?\n -}\n\nimport Data.List (genericLength)\nimport Data.List.Split (splitPlaces)\nimport EulerFunctions (isPrime)\n\n-- Each ring is another concentric circle in the spiral. \n-- The first 3 are [1], [2..9], and [10..25]\ntype Ring = [Int]\n\n-- Returns an infinite list of rings.\nrings :: [Ring]\nrings  = [1] : splitPlaces [8,16..] [2..]\n\n-- Given a ring, returns the numbers on its corners.\ncorners     :: Ring -&gt; [Int]\ncorners [1]  = [1]\ncorners ring = let end  = last ring\n                   diff = (length ring) `div` 4\n                in map (\\n -&gt; end - n * diff) [0..3]\n\ndiagPrimes      = scanl1 (+) $ map (genericLength . filter isPrime . corners) rings\ndiagLengths     = [1,5..]\ndiagPrimeRatios = zipWith (/) diagPrimes diagLengths\n\np58 = fst . head . filter ((&lt; 0.1) . snd) $ [1,3..] `zip` tail diagPrimeRatios\n</code></pre>\n"}, {"tags": ["list", "function", "haskell", "input", "integer"], "comments": [{"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "edited": false, "score": 2, "creation_date": 1449707917, "post_id": 34191703, "comment_id": 56129812, "body": "Given your logic, <code>howManyEq</code> can never return 1. Create function that returns <code>+ 1</code> to what you&#39;re returning now. Feed that result into a function that is defined as <code>f 1 = 0</code> and <code>f a = a</code>..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1449707937, "post_id": 34191703, "comment_id": 56129816, "body": "Wel is your example not incorrect? Shouldn&#39;t the first return <code>1</code>. If that&#39;s the case, this is a typical off by one error."}, {"owner": {"reputation": 187, "user_id": 3273373, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/WNvGu.jpg?s=128&g=1", "display_name": "T-Bird", "link": "https://stackoverflow.com/users/3273373/t-bird"}, "edited": false, "score": 1, "creation_date": 1449708076, "post_id": 34191703, "comment_id": 56129870, "body": "<code>howManyEq 3 4 3 5</code> should return 2 because it counts both instances of 3. But <code>howManyEq 3 4 5 6</code> should return 0. I know its kinda illogical, but this is the way my teacher wants it for some reason."}], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 3273373, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/WNvGu.jpg?s=128&g=1", "display_name": "T-Bird", "link": "https://stackoverflow.com/users/3273373/t-bird"}, "edited": false, "score": 0, "creation_date": 1449711454, "post_id": 34192236, "comment_id": 56130863, "body": "Yes this is exactly what I needed, thank you. And I&#39;ll take your advice with making it neater, I didn&#39;t realize there were some things I could leave out."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1449711454, "last_edit_date": 1449711454, "creation_date": 1449711232, "answer_id": 34192236, "question_id": 34191703, "link": "https://stackoverflow.com/questions/34191703/haskell-function-that-counts-input-numbers-and-finds-how-many-are-equal/34192236#34192236", "title": "Haskell function that counts input numbers and finds how many are equal", "body": "<p>Your <code>count</code> function counts the number of equal elements in the remainder of the \"list\". If that number is zero, your teacher wants the result to be zero. If there is one or more, it returns the amount counted in the remainder of the list, but since there is already one element in the head of the list, you should do +1. You can do this by implementing a helper function:</p>\n\n<pre><code>fix :: (Eq a, Num a) =&gt; a -&gt; a\nfix 0 = 0\nfix n = n+1\n</code></pre>\n\n<p>Now you can simply pass the result of your <code>count</code> function through <code>fix</code>:</p>\n\n<pre><code>howManyEq :: Int -&gt; Int-&gt; Int -&gt; Int -&gt; Int\nhowManyEq a b c d = fix $ count (head (toList a b c d)) (tail (toList a b c d))\n\ncount :: Int -&gt; [Int] -&gt; Int\ncount x [] = 0\ncount x (y:ys)\n | x == y = 1 + (count x ys)\n | otherwise = count x ys\n\ntoList :: Int -&gt; Int-&gt; Int -&gt; Int -&gt; [Int]\ntoList a b c d = [a,b,c,d]\n</code></pre>\n\n<p>additional advice:</p>\n\n<ul>\n<li><p>You use <code>head (toList a b c d)</code> in your call to count. But you already know in advance that this is <code>a</code>, so omit this.</p></li>\n<li><p>The same with the tail: simply only feed the last three arguments, so: <code>toList b c d</code>.</p></li>\n<li><p>Use the most generic type signature possible: for <code>toList :: a -&gt; a -&gt; a -&gt; [a]</code> (given the previous fix), for <code>count :: (Eq a, Num b) =&gt; a -&gt; [a] -&gt; b</code>, and for <code>howManyEq :: (Eq a, Eq b, Num b) =&gt; a -&gt; a -&gt; a -&gt; a -&gt; b</code>.</p></li>\n<li><p>If you define the same thing multiple time, you can use a <code>where t = ...</code> clause, like <code>where cys = count x ys</code></p></li>\n</ul>\n\n<p>This would result in something like:</p>\n\n<pre><code>fix :: (Eq a, Num a) =&gt; a -&gt; a\nfix 0 = 0\nfix n = n+1\n\nhowManyEq :: (Eq a, Eq b, Num b) =&gt; a -&gt; a -&gt; a -&gt; a -&gt; b\nhowManyEq a b c d = fix $ count a $ toList b c d\n\ncount :: (Eq a, Num b) =&gt; a -&gt; [a] -&gt; b\ncount x [] = 0\ncount x (y:ys)\n | x == y = 1 + cys\n | otherwise = cys\n where cys = count x ys\n\ntoList :: a -&gt; a -&gt; a -&gt; [a]\ntoList a b c = [a,b,c]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1449717776, "post_id": 34192518, "comment_id": 56132458, "body": "This puts me in mind of <a href=\"https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition\" rel=\"nofollow noreferrer\">FizzBuzzEnterpriseEdition</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449717802, "post_id": 34192518, "comment_id": 56132466, "body": "@DanielWagner, why the downvote? Or was that not yours?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449717906, "post_id": 34192518, "comment_id": 56132481, "body": "I downvoted because there seems to be a serious (and, in my judgment, intentional) mismatch between the intended and actual audiences of this answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449717975, "post_id": 34192518, "comment_id": 56132497, "body": "@DanielWagner, the mismatch wasn&#39;t intentional. I just have very little experience with the dark art of variadic functions in Haskell, and figured this was a good opportunity to give it a whirl."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449725233, "post_id": 34192518, "comment_id": 56134621, "body": "I owe you an apology. The judgment I made about your intentions was uncalled for and unkind. I&#39;m sorry I called it out, and even more sorry I made it in the first place."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1449725824, "post_id": 34192518, "comment_id": 56134808, "body": "@DanielWagner, apology certainly accepted. Everyone makes mistakes!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": -1, "last_activity_date": 1449713273, "creation_date": 1449713273, "answer_id": 34192518, "question_id": 34191703, "link": "https://stackoverflow.com/questions/34191703/haskell-function-that-counts-input-numbers-and-finds-how-many-are-equal/34192518#34192518", "title": "Haskell function that counts input numbers and finds how many are equal", "body": "<p>Here's one way:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeFamilies #-}\n\nclass HowManyEq a where\n  howManyEq' :: Int -&gt; Int -&gt; Int -&gt; a\n\ninstance HowManyEq Int where\n  howManyEq' count x y = count + fromEnum (x == y)\n  {-# INLINE howManyEq' #-}\n\ninstance (HowManyEq a, b ~ Int) =&gt; HowManyEq (b -&gt; a) where\n  howManyEq' count x y b = (howManyEq' $! count + fromEnum (b == x)) x y\n  {-# INLINE howManyEq' #-}\n\nhowManyEq :: HowManyEq a =&gt; Int -&gt; Int -&gt; a\nhowManyEq = howManyEq' 0\n\nhowManyEq4 :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nhowManyEq4 x y z w =\n  case howManyEq x y z w of\n    0 -&gt; 0\n    n -&gt; n + 1\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 3273373, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/WNvGu.jpg?s=128&g=1", "display_name": "T-Bird", "link": "https://stackoverflow.com/users/3273373/t-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1158, "favorite_count": 0, "accepted_answer_id": 34192236, "answer_count": 2, "score": 1, "last_activity_date": 1449713273, "creation_date": 1449707604, "question_id": 34191703, "link": "https://stackoverflow.com/questions/34191703/haskell-function-that-counts-input-numbers-and-finds-how-many-are-equal", "title": "Haskell function that counts input numbers and finds how many are equal", "body": "<p>I'm trying to write a function in Haskell that takes 4 integers as input and counts how many of that input numbers are equal to the first integer.</p>\n\n<p>For example:    </p>\n\n<pre><code>howManyEq 3 4 5 6   returns 0\nhowManyEq 3 4 3 5   returns 2\nhowManyEq 3 4 3 3   returns 3\nhowManyEq 3 3 3 3   returns 4\n</code></pre>\n\n<p>This is the function I have created so far, it works for the first instance when there is no input matching the first integer. But it doesn't count the first 3 when there are other matching integers, it always has one less counted.</p>\n\n<pre><code>howManyEq :: Int -&gt; Int-&gt; Int -&gt; Int -&gt; Int\nhowManyEq a b c d = count (head (toList a b c d)) (tail (toList a b c d))\n\ncount :: Int -&gt; [Int] -&gt; Int\ncount x [] = 0\ncount x (y:ys)\n | x == y = 1 + (count x ys)\n | otherwise = count x ys\n\ntoList :: Int -&gt; Int-&gt; Int -&gt; Int -&gt; [Int]\ntoList a b c d = [a,b,c,d]\n</code></pre>\n\n<p>My function gives me:</p>\n\n<pre><code>howManyEq 3 4 5 6   returns 0\nhowManyEq 3 4 3 5   returns 1\nhowManyEq 3 4 3 3   returns 2\nhowManyEq 3 3 3 3   returns 3\n</code></pre>\n\n<p>I'm not sure how to count the first integer when the other input integers are equal.</p>\n"}, {"tags": ["c++", "haskell", "floating-point", "ieee-754"], "answers": [{"comments": [{"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "edited": false, "score": 0, "creation_date": 1449707341, "post_id": 34191635, "comment_id": 56129626, "body": "This is what I was digging for. I think that the sign bit not defined in a NaN for IEEE is enough for me to back off and solve this some other way."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "edited": false, "score": 0, "creation_date": 1449707418, "post_id": 34191635, "comment_id": 56129665, "body": "Basically I had tool A and tool B that both convert &quot;nan&quot; into some bit pattern in an instruction encoding.  The hardware should handle both, but in order to test tool A with tool B, they have to generate the same bits.  Hence, I have to muck around with stuff past the normal abstraction boundary."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "edited": false, "score": 0, "creation_date": 1449707468, "post_id": 34191635, "comment_id": 56129681, "body": "And in the end, I just made tool A generate the exact bits I wanted rather than delegating that decision to a compiler or runtime (i.e. I encode an explicit bit pattern rather than hoping <code>(0&#47;0)</code> gives the bits I want."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 5, "last_activity_date": 1449707380, "last_edit_date": 1449707380, "creation_date": 1449707229, "answer_id": 34191635, "question_id": 34191455, "link": "https://stackoverflow.com/questions/34191455/haskell-sets-0-0-as-qnan/34191635#34191635", "title": "Haskell sets (0/0) as qnan", "body": "<p>You're asking too much from your NaNs.  According to the IEEE standard, the sign bit on a NaN can be anything.  So the compiler, processor, or floating-point libraries are free to make any choices they want to, and you will get different results on different compilers, processors, and libraries.</p>\n\n<p>In particular, with a program like this, constant folding may mean that the operations are carried out by the compiler instead of in the target environment, depending on how the compiler is run.  The compiler may use native floating-point instructions or it may use something like GMP or MPFR instead.  This isn't uncommon.  Since the IEEE standard says nothing about sign bits, you're going to end up with different values for different implementations.  I would not be entirely surprised if you could demonstrate that the values changed when you turned optimizations on or off, and that's <em>not</em> including things like <code>-ffast-math</code>.</p>\n\n<p>As an example of an optimization, the compiler <em>knows</em> that you are computing a <code>NaN</code>, and maybe it decides not to bother flipping the sign bit afterwards.  This all happens through constant propagation.  Another compiler doesn't do that kind of analysis, and so it emits an instruction to flip the sign bit, and the folks who made your processor don't make that operation behave differently for NaNs.</p>\n\n<p>In short, don't try to make sense of the sign bit on a NaN.</p>\n\n<p>What exactly are you trying to accomplish here?</p>\n"}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 34191635, "answer_count": 1, "score": 7, "last_activity_date": 1450110629, "creation_date": 1449706169, "last_edit_date": 1495540748, "question_id": 34191455, "link": "https://stackoverflow.com/questions/34191455/haskell-sets-0-0-as-qnan", "title": "Haskell sets (0/0) as qnan", "body": "<p>I noticed that Haskell (ghci 7.10.2 from Haskell Platform on Windows) flips the sign on QNAN <code>(0/0 :: Double)</code> from what I've seen in C++ (tested MSVS C++ 2013 and cygwin gcc 4.9.2).  Haskell produces the bit pattern <code>0xfff8000000000000</code> for (0/0) (and -(0/0) produces 0x7ff8...).  This is backwards from C++ implementations seem to do.</p>\n\n<p>Here's a test program to illustrate:</p>\n\n<pre><code>import Data.Word\nimport Unsafe.Coerce\nimport Text.Printf\n\ndblToBits :: Double -&gt; Word64\ndblToBits = unsafeCoerce\n\ntest :: Double -&gt; IO ()\ntest d = putStrLn $ printf \"%12f       0x%x\" d (dblToBits d)\n\ngo = do\n  test (0/0)\n  test (-(0/0))\n  test (1/0)\n  test (-(1/0))\n</code></pre>\n\n<p>This gives the output:</p>\n\n<pre><code>      NaN       0xfff8000000000000  &lt;- I expect 0x7F...?\n      NaN       0x7ff8000000000000  &lt;- I expect 0xFF...?\n Infinity       0x7ff0000000000000\n-Infinity       0xfff0000000000000\n</code></pre>\n\n<p>Note, the infinities work out okay, but the NaN's seem flipped.</p>\n\n<ul>\n<li><p>Is this part of the undefined semantics of NaN in Haskell? I.e. (0/0) means ghc can use whatever NaN pattern they want?  Then do we have a precise way in Haskell of specifying QNAN or SNAN in floating point without resorting to special IEEE libraries <a href=\"https://stackoverflow.com/questions/21344139/ieee-floating-point-signalling-nan-snan-in-haskell\">4</a>?  I am writing an assembler for a piece of hardware that might be picky about it's flavor of NaN.</p></li>\n<li><p>Am I getting burned by <code>unsafeCoerce</code>?  I have no <em>easy</em> way in Haskell to convert from float to bits and back.</p></li>\n</ul>\n\n<p>REFERENCES:</p>\n\n<ol>\n<li>MSVS 2013. The C++ <code>std::numeric_limits&lt;double&gt;::quiet_NaN()</code> from &lt;limits> gives <code>0x7ff8000000000000</code>.  Also tested on cygwin gcc 4.9.2</li>\n<li><a href=\"http://en.cppreference.com/w/cpp/types/numeric_limits/quiet_NaN\" rel=\"nofollow noreferrer\">std::numeric_limits::quiet_NaN</a>.  States that any meaning of the sign bit is implementation defined.  Does Haskell have a similar rule regarding this?</li>\n<li><a href=\"http://www.perlmonks.org/?node_id=984141\" rel=\"nofollow noreferrer\">Perl semantics</a> are consistent with MSV C++</li>\n<li>Possible Haskell <a href=\"https://hackage.haskell.org/package/ieee754\" rel=\"nofollow noreferrer\">library</a> for IEEE</li>\n<li>Slightly related <a href=\"https://stackoverflow.com/questions/21344139/ieee-floating-point-signalling-nan-snan-in-haskell\">question</a> uses the same <code>unsafeCoerce</code> non-sense that I fell back to.</li>\n</ol>\n"}]