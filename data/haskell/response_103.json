[{"tags": ["git", "haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 266, "user_id": 3077968, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa4eab5f463b1aa7d8b684d3655c1d5e?s=128&d=identicon&r=PG&f=1", "display_name": "renegadeborealis", "link": "https://stackoverflow.com/users/3077968/renegadeborealis"}, "is_accepted": true, "score": 8, "last_activity_date": 1482966070, "creation_date": 1482966070, "answer_id": 41370918, "question_id": 41370813, "link": "https://stackoverflow.com/questions/41370813/using-a-private-git-repository-with-stack/41370918#41370918", "title": "Using a private git repository with Stack", "body": "<p>You'll set the authentication in Git itself, not in stack.</p>\n\n<p>If you're using git over ssh, you can set authentication options in <code>~/.ssh/config</code></p>\n\n<pre><code>Host me.github.com\n    HostName github.com\n    PreferredAuthentications publickey\n    IdentityFile ~/.ssh/me_rsa\n</code></pre>\n\n<p><a href=\"https://confluence.atlassian.com/bitbucket/configure-multiple-ssh-identities-for-gitbash-mac-osx-linux-271943168.html\" rel=\"noreferrer\">Here's</a> some good reading if you need more. Good luck!</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 41370918, "answer_count": 1, "score": 4, "last_activity_date": 1483017454, "creation_date": 1482965281, "last_edit_date": 1483017454, "question_id": 41370813, "link": "https://stackoverflow.com/questions/41370813/using-a-private-git-repository-with-stack", "title": "Using a private git repository with Stack", "body": "<p>I'm trying to configure stack to use the Haskell packages of a private git repository. Looking at the documentation it seems that the git repository can be added as <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#local-dependency-packages-extra-dep\" rel=\"nofollow noreferrer\">local dependency</a>. The problem is that I see no way of specifying the credentials for logging into the server.</p>\n\n<p>What is the right way of adding packages of a private git repository using stack?</p>\n\n<p>EDIT: For the sake of completeness I add the section of <code>stack.yaml</code> that edited to be able to use a private repository:</p>\n\n<pre><code>packages:\n- '.'\n- location:\n    git: ssh://git@urlprivate-git-repo.com:7999/project/subproject.git\n    commit: 4ac0e47bfd3\n  subdirs:\n  - subdir-of-the-private-package\n  extra-dep: true\n</code></pre>\n\n<p>As @renegadeborealis pointed out, the authentication is taken care of outside of Stack.</p>\n"}, {"tags": ["haskell", "homebrew"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1482956962, "post_id": 41369064, "comment_id": 69940090, "body": "Remove <code>~&#47;.stack</code> and rerun <code>stack setup</code>. Keep in mind that <code>stack install</code> copies binaries into <code>~&#47;.local&#47;bin</code> on Linux, I&#39;m not sure about the location on macOS."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1482957756, "post_id": 41369064, "comment_id": 69940428, "body": "@Zeta: Uh oh! That doesn&#39;t seem right. I get &quot;Preparing to install GHC to an isolated location.&quot; and &quot;This will not interfere with any system-level installation.&quot;. So that just creates a sandboxed installation at the root, which is not at all the same as fixing the root, right?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1482957947, "post_id": 41369064, "comment_id": 69940496, "body": "@Zeta: In fact, it sounds like doing this <a href=\"https://docs.haskellstack.org/en/v1.0.2/faq/#how-do-i-reset-remove-stack-such-as-to-to-do-a-completely-fresh-build\" rel=\"nofollow noreferrer\">may even have messed up my project-specific installations</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1482958444, "post_id": 41369064, "comment_id": 69940690, "body": "Stack doesn&#39;t install anything at system level by default. It will install everything per-user. Note that GHC will be installed if the current LTS version uses another GHC version than the one you&#39;ve installed. By the way, you can fix the <code>.stack-work</code> easily with a single <code>find</code> command."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1482958694, "post_id": 41369064, "comment_id": 69940811, "body": "@Zeta: So I&#39;m not sure how any of this cleans things up at the system level then. What I was trying to figure out, is how to get the system level back to what <code>brew install haskell-stack</code> does."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1483012673, "creation_date": 1482955982, "last_edit_date": 1495540420, "question_id": 41369064, "link": "https://stackoverflow.com/questions/41369064/how-do-i-restore-my-haskell-setup-to-the-bare-homebrew-configuration", "title": "How do I restore my Haskell setup to the bare Homebrew configuration?", "body": "<p>I have a system setup of Haskell that I've maintained with Homebrew and subsequent <code>cabal install</code> invocations for various packages. I would like to take this back to the bare installation created with <code>brew install haskell-stack</code>.</p>\n\n<p>How do I do this? Right now I seem to have a bunch of stuff lying around (e.g. old docsets, executables like  <code>ghc-mod</code> etc.) at the system level, even after <a href=\"https://stackoverflow.com/a/12048421/656912\">deleting all installed packages</a> with <code>rm -r ~/.ghc</code>. Is there a reliable way to get back to the basic configuration that <code>brew install haskell-stack</code> creates?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "hackage"], "comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1482956702, "post_id": 41369011, "comment_id": 69939969, "body": "There is <code>stack sdist</code> and <code>stack upload</code> which I believe should work without invoking <code>cabal</code> directly."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1482957340, "post_id": 41369011, "comment_id": 69940254, "body": "It seems like <code>stack upload .</code> isn&#39;t seeing the credentials that <code>cabal upload</code> sees (I&#39;m asked for my name, etc.). Any idea how to set those so I&#39;m not asked each time?"}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1482958241, "post_id": 41369011, "comment_id": 69940618, "body": "From what I&#39;m seeing it should save them automatically under &#39;~/.stack/upload/credentials.json&#39; (<a href=\"https://github.com/commercialhaskell/stack/issues/2159\" rel=\"nofollow noreferrer\">in world-readable plain text</a>) after first upload."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1483278214, "post_id": 41369011, "comment_id": 70035953, "body": "@ppb: That seems to work, but after confirming that upload was successful I get &quot;Environment variable GPG_TTY is not set (see man gpg-agent)&quot; and &quot;Unable to find gpg2 or gpg executable&quot;. <a href=\"http://stackoverflow.com/q/41415900/656912\">Any idea what&#39;s happening there?</a>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1483363468, "post_id": 41369011, "comment_id": 70060781, "body": "@ppb: I think <code>stack sdist</code> and <code>stack upload</code> constitute an answer."}], "answers": [{"tags": [], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "is_accepted": true, "score": 9, "last_activity_date": 1483382991, "creation_date": 1483382991, "answer_id": 41431924, "question_id": 41369011, "link": "https://stackoverflow.com/questions/41369011/should-i-use-stack-to-build-and-upload-to-hackage/41431924#41431924", "title": "Should I use stack to build and upload to Hackage?", "body": "<p>Adding an answer based on my earlier comment.\n<hr />\n<code>stack</code> offers equivalent functionality via its</p>\n\n<ul>\n<li><code>stack sdist</code></li>\n<li><code>stack upload</code></li>\n</ul>\n\n<p>commands, which don't require interfacing with <code>cabal</code> directly in stack-based projects.</p>\n\n<p>A full list of commands supported by stack can be obtained via:</p>\n\n<pre><code>$ stack --help\n</code></pre>\n\n<p>and the <a href=\"https://readthedocs.org/projects/stack/\" rel=\"noreferrer\">official documentation</a>.</p>\n\n<p>Individual commands also support <code>--help</code> to see what command line flags they support.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 3, "accepted_answer_id": 41431924, "answer_count": 1, "score": 8, "last_activity_date": 1483382991, "creation_date": 1482955710, "last_edit_date": 1495540497, "question_id": 41369011, "link": "https://stackoverflow.com/questions/41369011/should-i-use-stack-to-build-and-upload-to-hackage", "title": "Should I use stack to build and upload to Hackage?", "body": "<p>Over time I've developed a messy system level Haskell installation that I'm <a href=\"https://stackoverflow.com/q/41369064/656912\">not sure how to completely clean up</a>. But for the most part this isn't of much concern as I simply use <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"noreferrer\">stack</a> to manage per-project Haskell configurations. However as my project requirements diverge from my system Haskell setup, I wonder what the best way is to build and upload packages for Hackage.</p>\n\n<p>Specifically (1) should I be using</p>\n\n<pre><code>stack exec -- cabal sdist\nstack exec -- cabal upload\n</code></pre>\n\n<p>instead of simply</p>\n\n<pre><code>cabal sdist\ncabal upload\n</code></pre>\n\n<p>and (2) should is there any reason to install a project version of cabal (with <code>stack build cabal</code>?)</p>\n\n<p>Or is there some better stack-based approach to building and distributing to Hackage that doesn't involve invoking <code>cabal</code> directly?</p>\n"}, {"tags": ["unix", "haskell", "process"], "answers": [{"comments": [{"owner": {"reputation": 1247, "user_id": 583574, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/afab977a4c6e8ebf09ff8a01bfc9e102?s=128&d=identicon&r=PG", "display_name": "CamilB", "link": "https://stackoverflow.com/users/583574/camilb"}, "edited": false, "score": 0, "creation_date": 1482954970, "post_id": 41368595, "comment_id": 69939227, "body": "I was thinking about that too... Eventually resolved to use <code>terminateProcess</code> for now, since my small program is still only a draft."}], "tags": [], "owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "is_accepted": true, "score": 4, "last_activity_date": 1482997077, "last_edit_date": 1482997077, "creation_date": 1482953846, "answer_id": 41368595, "question_id": 41367691, "link": "https://stackoverflow.com/questions/41367691/how-to-terminate-sigint-a-subprocess-in-haskell/41368595#41368595", "title": "How to terminate (SIGINT) a subprocess in Haskell?", "body": "<p><code>terminateProcess</code> sends a <code>SIGTERM</code> (terminate) signal to the process, which corresponds to the default behavior of the unix command <code>kill</code>, which generally is not what you want when trying to end a process nicely.</p>\n\n<p><code>Ctrl+C</code> sends the signal <code>SIGINT</code> (interrupt), which many applications handle by an orderly shutdown, and in your case probably results in the <code>arecordmidi</code> process saving outstanding data, and closing any pipes and files.</p>\n\n<p>Looks like the way to send <code>SIGINT</code> with <code>System.Process</code> is with <a href=\"http://hackage.haskell.org/package/process/docs/System-Process.html#v:interruptProcessGroupOf\" rel=\"nofollow noreferrer\"><code>interruptProcessGroupOf</code></a>.</p>\n"}], "owner": {"reputation": 1247, "user_id": 583574, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/afab977a4c6e8ebf09ff8a01bfc9e102?s=128&d=identicon&r=PG", "display_name": "CamilB", "link": "https://stackoverflow.com/users/583574/camilb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 41368595, "answer_count": 1, "score": 4, "last_activity_date": 1482997077, "creation_date": 1482949565, "question_id": 41367691, "link": "https://stackoverflow.com/questions/41367691/how-to-terminate-sigint-a-subprocess-in-haskell", "title": "How to terminate (SIGINT) a subprocess in Haskell?", "body": "<p>I'm writing a small program in Haskell which manipulates the commands <code>arecordmidi</code> and <code>aplaymidi</code> to record short improvisations on my digital piano through MIDI. I will press the <kbd>R</kbd> key, my program will create a new subprocess with the command <code>arecordmidi</code>. When I press <kbd>R</kbd> again, I want my recording to stop, by terminating the command <code>arecordmidi</code>. </p>\n\n<p>How do I terminate the <code>arecordmidi</code> subprocess? If in a shell, <kbd>CTRL+C</kbd> would stop recording. This is what I want.</p>\n\n<p>I'm using the following code to create the subprocess:</p>\n\n<pre><code>import System.Process\n\nmain = do\n  let rec_command = \"arecordmidi -p \\\"CASIO USB-MIDI\\\" myRecording.midi\"\n  process &lt;- createProcess (shell rec_command)\n\n  -- I could try the following code, but the documentation of System.Process \n  -- says it's bad to use terminateProcess:\n  let (_, _, _, processHandle) = process\n  terminateProcess processHandle\n</code></pre>\n"}, {"tags": ["haskell", "reflex"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482948319, "post_id": 41367144, "comment_id": 69936257, "body": "<code>(\\r -&gt; decodeXhrResponse r)</code> ~&gt; <code>decodeXhrResponse</code>"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482953858, "post_id": 41367144, "comment_id": 69938778, "body": "Your original program is ambiguous. How about just adding a type signature <code>decodeXhrResponse r :: Maybe Apod</code>."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482955895, "post_id": 41367144, "comment_id": 69939634, "body": "@Reid: Thanks, but changing to  <code>let rspApod = fmapMaybe ( \\r  -&gt; decodeXhrResponse r :: Maybe Apod) asyncEvent</code> does not solve the problem: Gives the same <code>No instance for</code> error. Unfortunately ..."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482956116, "post_id": 41367144, "comment_id": 69939737, "body": "That seems rather hard to believe..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483002089, "post_id": 41367144, "comment_id": 69954220, "body": "Post above the full error after you added the type annotation."}], "answers": [{"comments": [{"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1482999133, "post_id": 41372980, "comment_id": 69952776, "body": "Many thanks for your kind explanation and your solution. Your solution is the same as the one from Reid. Unfortunately, it does not help"}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1483003165, "post_id": 41372980, "comment_id": 69954862, "body": "Even if I annotate the on both sides  <code>let rspApod :: Event Spider (Maybe Apod) = fmap (\\r -&gt; decodeXhrResponse r :: Maybe Apod) asyncEvent</code>, I still get the error `No instance for (aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON Apod) arising from a use of \u2018decodeXhrResponse\u2019"}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1483004442, "post_id": 41372980, "comment_id": 69955610, "body": "I added an additional <code>instance FromJSON (Maybe Apod)</code> declaration and I got 2 errors: <code>Overlapping instances for FromJSON (Maybe Apod)       arising from a use of \u2018aeson-1.0.2.1:Data.Aeson.Types.FromJSON.$gdmparseJSON\u2019</code> and <code>No instance for (aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON Apod)</code>. It seems, that there are 2 different versions of Data.Aeson 1.0 and 0.9!! How is this possible ??"}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1483011948, "post_id": 41372980, "comment_id": 69959810, "body": "@Reid: After I reinstalled ghcjs, reflex and relex-dom your solution is working! Many Thanks for your help"}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 1, "creation_date": 1483011963, "post_id": 41372980, "comment_id": 69959818, "body": "@Fresheyball: After I reinstalled ghcjs, reflex and relex-dom your solution is working! Many Thanks for your help"}], "tags": [], "owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "is_accepted": true, "score": 3, "last_activity_date": 1482984299, "creation_date": 1482984299, "answer_id": 41372980, "question_id": 41367144, "link": "https://stackoverflow.com/questions/41367144/haskell-how-to-fix-the-type-variable-ambigous-compiler-error/41372980#41372980", "title": "Haskell: How to fix the &quot;type variable ambigous&quot; compiler error?", "body": "<p>So the function's original signature is </p>\n\n<p><code>decodeXhrResponse :: FromJSON a =&gt; XhrResponse -&gt; Maybe a</code></p>\n\n<p>So when used the compiler needs to find the <code>FromJSON</code> instance for a given <code>a</code>. In your case the <code>a</code> is <code>Apod</code>, so the compiler should fine the <code>FromJSON</code> instance for <code>Apod</code>. In your code, there is no way for the compiler to know that is your intention. This is a common problem when parsing, where the compiler needs to be told what the goal type is supposed to be. </p>\n\n<p>Now you could argue that it should be able to determine the goal type by the surrounding code like <code>asyncEvent</code>, but its not for some reason. It might be that the surrounding code is just as generic. Consider the following scenario:</p>\n\n<p><code>main = print $ read x</code></p>\n\n<p>How can the compiler know the target type for reading <code>x</code>?</p>\n\n<p><code>read :: Read a =&gt; String -&gt; a</code> obviously this doesn't inform it of the target.</p>\n\n<p><code>print :: Show a =&gt; a -&gt; IO ()</code> and this just asserts that the <code>a</code> must have a <code>Show</code> instance. </p>\n\n<p><code>a</code> is too generic to be parsed to, we need a concrete type. </p>\n\n<p>So when when inlined the functions and changed the type signatures to include <code>Apod</code> you gave the compiler the information it needs to know what <code>FromJSON</code> instance to look up.</p>\n\n<p>Here is how I would have solved this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  mainWidget $ el \"div\" $ do\n    buttonEvent &lt;- button \"GET\"\n    let url = \"https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY\"\n    let defaultReq = xhrRequest \"GET\" url def  \n    asyncEvent &lt;- performRequestAsync (tag (constant defaultReq) buttonEvent)\n    let rspApod = fmapMaybe (\\r -&gt; decodeXhrResponse r :: Maybe Apod) asyncEvent\n    return ()\n</code></pre>\n\n<p>Adding the <code>:: Maybe Apod</code> inline type annotation should give the compiler the information it needs to know your intended parse goal. It reasonable to use type signatures in this way, since it's actually effectful.</p>\n\n<p>Hope that helps!</p>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41372980, "answer_count": 1, "score": 0, "last_activity_date": 1482984299, "creation_date": 1482947124, "question_id": 41367144, "link": "https://stackoverflow.com/questions/41367144/haskell-how-to-fix-the-type-variable-ambigous-compiler-error", "title": "Haskell: How to fix the &quot;type variable ambigous&quot; compiler error?", "body": "<p>I'm using GHCJSi, version 0.2.0-7.10.3: <a href=\"http://www.github.com/ghcjs/ghcjs/\" rel=\"nofollow noreferrer\">http://www.github.com/ghcjs/ghcjs/</a> and the reflex-dom library version 0-4 from <a href=\"https://github.com/reflex-frp/reflex-dom\" rel=\"nofollow noreferrer\">https://github.com/reflex-frp/reflex-dom</a>. I'm not using reflex-dom-0.3 from Hackage.</p>\n\n<p>The following Haskell program does not compile with reflex-dom-0.4:</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo, ScopedTypeVariables, DeriveGeneric, OverloadedStrings #-}\nimport Reflex\nimport Reflex.Dom\nimport Data.Aeson\nimport GHC.Generics\nimport qualified Data.Text as T\ndata Apod = Apod { copyright :: T.Text\n                 , date :: T.Text\n                 , explanation :: T.Text\n                 , hdurl :: T.Text\n                 , media_type :: T.Text\n                 , service_version :: T.Text\n                 , title :: T.Text\n                 , url :: T.Text\n                 } deriving (Generic, Show)\ninstance FromJSON Apod\nmain :: IO ()\nmain = do\n  mainWidget $ el \"div\" $ do\n    buttonEvent &lt;- button \"GET\"\n    let url = \"https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY\"\n    let defaultReq = xhrRequest \"GET\" url def  \n    asyncEvent &lt;- performRequestAsync (tag (constant defaultReq) buttonEvent)\n    let rspApod = fmapMaybe (\\r -&gt; decodeXhrResponse r) asyncEvent\n    return ()\n</code></pre>\n\n<p>I get the error</p>\n\n<pre><code> Xhr00.hs:24:36:\n    No instance for (aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON b0)\n      arising from a use of \u2018decodeXhrResponse\u2019\n    The type variable \u2018b0\u2019 is ambiguous\n    Relevant bindings include\n      rspApod :: Event Spider b0 (bound at Xhr00.hs:24:9)\n    Note: there is a potential instance available:\n      instance (aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON a,\n                aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON b) =&gt;\n                aeson-0.9.0.1:Data.Aeson.Types.Class.FromJSON\n                 (Data.These.These a b)\n        -- Defined in \u2018Data.These\u2019\n       In the expression: decodeXhrResponse r\n    In the first argument of \u2018fmapMaybe\u2019, namely\n      \u2018(\\ r -&gt; decodeXhrResponse r)\u2019\n    In the expression:\n      fmapMaybe (\\ r -&gt; decodeXhrResponse r) asyncEvent\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I inline the reflex-dom library function <code>decodeXhrResponse</code> (and also <code>decodeText</code>). I change the type signature <code>FromJSON a =&gt; XhrResponse -&gt; Maybe a</code> to a signature without a type variable <code>XhrResponse -&gt; Maybe Apod</code>. Then the program compiles successfully.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo, ScopedTypeVariables, DeriveGeneric, OverloadedStrings #-}\nimport Reflex\nimport Reflex.Dom hiding (decodeXhrResponse, decodeText)\n-- import Reflex.Dom\nimport Data.Aeson\nimport GHC.Generics\nimport qualified Data.Text as T\nimport Control.Monad\nimport qualified Data.ByteString.Lazy as BL\nimport Data.Text.Encoding\ndata Apod = Apod { copyright :: T.Text\n                 , date :: T.Text\n                 , explanation :: T.Text\n                 , hdurl :: T.Text\n                 , media_type :: T.Text\n                 , service_version :: T.Text\n                 , title :: T.Text\n                 , url :: T.Text\n                 } deriving (Generic, Show)\ninstance FromJSON Apod\nmain :: IO ()\nmain = do\n  mainWidget $ el \"div\" $ do\n    buttonEvent &lt;- button \"GET\"\n    let nasa = \"https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY\"\n    let defaultReq = xhrRequest \"GET\" nasa def \n    asyncEvent &lt;- performRequestAsync (tag (constant defaultReq) buttonEvent)\n    let rspApod :: Event Spider Apod = fmapMaybe (\\r -&gt; decodeXhrResponse r) asyncEvent\n    return ()\n-- Inlined and changed library function:\n-- decodeXhrResponse :: FromJSON a =&gt; XhrResponse -&gt; Maybe a\ndecodeXhrResponse :: XhrResponse -&gt; Maybe Apod\ndecodeXhrResponse = join . fmap decodeText . _xhrResponse_responseText\n-- Inlined and changed library function:\n-- decodeText :: FromJSON a =&gt; T.Text -&gt; Maybe a\ndecodeText :: T.Text -&gt; Maybe Apod\ndecodeText = decode . BL.fromStrict . encodeUtf8\n</code></pre>\n\n<p>I tried to add a scoped type variable for rspApod like  <code>rspApod :: Event t Apod</code> or  <code>rspApod :: Event Spider Apod</code> but it didn't help.</p>\n\n<p>Questions:</p>\n\n<p>How do I have to change the first program to compile successfully? (inlining and changing a library function is a very bad hack!)</p>\n\n<p>Why does the compiler not find and use the <code>FromJSON</code> instance for the data type <code>Apod</code>?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 35543, "user_id": 149530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b6c8b04130af49735de5be666d67c00?s=128&d=identicon&r=PG", "display_name": "Michael Foukarakis", "link": "https://stackoverflow.com/users/149530/michael-foukarakis"}, "edited": false, "score": 0, "creation_date": 1482942336, "post_id": 41365866, "comment_id": 69933349, "body": "Try <code>--ghc-options -fPIC</code>, and/or check the stack FAQ."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 1, "creation_date": 1482946223, "post_id": 41365866, "comment_id": 69935270, "body": "<a href=\"https://github.com/commercialhaskell/stack/issues/2711\" rel=\"nofollow noreferrer\">Possibly related</a> What stack / gcc version you are using, and what OS?"}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "reply_to_user": {"reputation": 35543, "user_id": 149530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b6c8b04130af49735de5be666d67c00?s=128&d=identicon&r=PG", "display_name": "Michael Foukarakis", "link": "https://stackoverflow.com/users/149530/michael-foukarakis"}, "edited": false, "score": 0, "creation_date": 1482946475, "post_id": 41365866, "comment_id": 69935376, "body": "@MichaelFoukarakis updated question"}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1482954194, "post_id": 41365866, "comment_id": 69938926, "body": "@ppb indeed, I found hack there: changing ghc settings in .stack from <code>(&quot;C compiler flags&quot;, &quot;-fno-PIE -fno-stack-protector&quot;)</code> to <code>(&quot;C compiler flags&quot;, &quot;-fPIC -fno-stack-protector&quot;)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1482955993, "creation_date": 1482955993, "answer_id": 41369066, "question_id": 41365866, "link": "https://stackoverflow.com/questions/41365866/installing-zlib-using-stack-recompile-with-fpic/41369066#41369066", "title": "Installing zlib using stack: recompile with -fPIC", "body": "<p>The issue is in how Cabal invokes hsc2hs. You need commit <a href=\"https://github.com/haskell/cabal/commit/c993a0c6660aa10d8c79ed0cc4961c59acfc91c8\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/commit/c993a0c6660aa10d8c79ed0cc4961c59acfc91c8</a> which is present as of Cabal 1.24.1.0.</p>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1011, "favorite_count": 0, "accepted_answer_id": 41369066, "answer_count": 1, "score": 1, "last_activity_date": 1482955993, "creation_date": 1482941845, "last_edit_date": 1482954549, "question_id": 41365866, "link": "https://stackoverflow.com/questions/41365866/installing-zlib-using-stack-recompile-with-fpic", "title": "Installing zlib using stack: recompile with -fPIC", "body": "<p>When I run</p>\n\n<pre><code>stack --resolver=lts-7.14 install zlib\n</code></pre>\n\n<p>I'm getting message saying that package should be recompiled with <code>-fPIC</code> flag:</p>\n\n<pre><code>Configuring zlib-0.6.1.2...\nBuilding zlib-0.6.1.2...\nPreprocessing library zlib-0.6.1.2...\n/usr/bin/ld: .stack-work/dist/x86_64-linux-nopie/Cabal-1.24.0.0/build/Codec/Compression/Zlib/Stream_hsc_make.o: relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC\n</code></pre>\n\n<p>How to tell stack to recompile <code>zlib</code> with <code>-fPIC</code> flag?</p>\n\n<hr>\n\n<p>I added ghc-options to yaml file:</p>\n\n<pre><code>ghc-options:\n  zlib: -fPIC\n\napply-ghc-options: locals\nrebuild-ghc-options: true\n</code></pre>\n\n<p>Also, I added <code>-fPIC</code> flag to ghc-options in cabal file.</p>\n\n<p>But still, I'm getting the same output:</p>\n\n<pre><code>--  While building package zlib-0.6.1.2 using:\n  /home/vladimir/.stack/setup-exe-cache/x86_64-linux-nopie/Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux-nopie/Cabal-1.24.0.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: /home/vladimir/Desktop/ffmpeg-light/.stack-work/logs/zlib-0.6.1.2.log\n</code></pre>\n\n<p>Where ghc-options are <code>-ddump-hi</code> and <code>-ddump-to-file</code> and no <code>-fPIC</code>. Did I miss something?</p>\n\n<hr>\n\n<h3>GCC, stack and OS versions:</h3>\n\n<p>GCC: gcc (Ubuntu 6.2.0-5ubuntu12) 6.2.0 20161005</p>\n\n<p>Stack: Version 1.3.0, Git revision 99b910d3c8e183aa376cb1e6f0341d86aed6d00e (4372 commits) x86_64 hpack-0.15.0</p>\n\n<p>OS: Ubuntu 16.10</p>\n\n<hr>\n\n<p>Looks like it is <a href=\"https://github.com/commercialhaskell/stack/issues/2711\" rel=\"nofollow noreferrer\">bug</a>.</p>\n\n<h3>I found a hack:</h3>\n\n<p>I replaced</p>\n\n<pre><code>(\"C compiler flags\", \"-fno-PIE -fno-stack-protector\")\n</code></pre>\n\n<p>by</p>\n\n<pre><code>(\"C compiler flags\", \"-fPIC -fno-stack-protector\")\n</code></pre>\n\n<p>in file</p>\n\n<pre><code>/home/you/.stack/programs/x86_64-linux/ghc-8.0.1/lib/ghc-8.0.1/settings\n</code></pre>\n\n<p>Now it compiles and works. I tested it on my project. </p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1482941684, "post_id": 41365731, "comment_id": 69932998, "body": "Doesn&#39;t said chapter explain the usage? What issue do you have using <code>HughesPJ</code> exactly?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1482941806, "post_id": 41365731, "comment_id": 69933052, "body": "@deceze, no, the chapter does not cover HughesPJ.  It lays out how to write you own pretty printer for chapter 5, then says:   &quot;Practical pointers and further reading  GHC already bundles a pretty printing library, Text.PrettyPrint.HughesPJ. It provides the same basic API as our example, but a much richer and more useful set of pretty printing functions. We recommend using it, rather than writing your own.&quot;  Those richer and more useful set of pretty printing functions that are recommended, are to me, somewhat opaque."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1482943774, "post_id": 41365731, "comment_id": 69934087, "body": "To pretty-print json, <a href=\"http://hackage.haskell.org/package/aeson-pretty-0.8.2/docs/Data-Aeson-Encode-Pretty.html\" rel=\"nofollow noreferrer\">use the json pretty-printer</a>!"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1482966326, "post_id": 41365731, "comment_id": 69943585, "body": "@Benjamin Hodgson, please reopen.  I am not asking for a recommendation or offsite resource, but specifically for a resource to be written as the answer to this question illustrating how to use .Text.PrettyPrint.HughesPJ. If you have additionally recommendations in addition to that, that would make an excellent comment."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1482966384, "post_id": 41365731, "comment_id": 69943600, "body": "Recommendations are already covered here: <a href=\"http://stackoverflow.com/questions/9761507/which-pretty-print-library\" title=\"which pretty print library\">stackoverflow.com/questions/9761507/which-pretty-print-libra&zwnj;&#8203;ry</a> (in a not closed question)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483009292, "post_id": 41365731, "comment_id": 69958373, "body": "@Mittenchops I suggest you re-word your question. Remove the &quot;Is there a module in the Haskell universe?&quot; question, which clearly <i>is</i> asking for a recommendation. Even after that, I think this question would still be very broad - you&#39;re basically asking &quot;How do I use <code>pretty</code>?&quot; - so I recommend including some actual code and describing why your attempt didn&#39;t work. Stack Overflow works best when you ask specific code questions, rather than broad how-to questions."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1484892853, "post_id": 41365731, "comment_id": 70706224, "body": "I get that this is closed, but it remains insane to me that if I have something as easy as an html string with embedded newlines and I&#39;m just trying to view the source, I have no discernible way of saying <code>prettyprint myhtml</code> and seeing it rendered coherently.  This hurts stackoverflow usability, and closing it and every similar Haskell pretty print question makes what should be an easy task unapproachable and the learning climb that much steeper."}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1540, "favorite_count": 0, "closed_date": 1482958137, "answer_count": 0, "score": 3, "last_activity_date": 1482942406, "creation_date": 1482941316, "last_edit_date": 1482942406, "question_id": 41365731, "link": "https://stackoverflow.com/questions/41365731/pretty-printing-in-haskell-in-2017", "closed_reason": "Not suitable for this site", "title": "Pretty Printing in Haskell in 2017", "body": "<p>The final paragraph of Chapter 5 of <a href=\"http://book.realworldhaskell.org/read/writing-a-library-working-with-json-data.html\" rel=\"nofollow noreferrer\">Real World Haskell</a> recommends <code>Text.PrettyPrint.HughesPJ</code> for pretty printing rather than custom show types, and provides the <a href=\"http://book.realworldhaskell.org/read/bibliography.html#bib.hughes95\" rel=\"nofollow noreferrer\">originating academic paper</a> for clarifications.  A comment on that also linked to:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/FPretty-1.0/docs/Text-PrettyPrint-FPretty.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/FPretty-1.0/docs/Text-PrettyPrint-FPretty.html</a></li>\n<li><a href=\"http://www.cs.kent.ac.uk/people/staff/oc/pretty.html\" rel=\"nofollow noreferrer\">http://www.cs.kent.ac.uk/people/staff/oc/pretty.html</a></li>\n</ul>\n\n<p>I've looked for examples using Text.PrettyPrint.HughesPJ, and have not found much online.  My questions are:</p>\n\n<ol>\n<li>Is there a module in the Haskellverse approaching the python ease of \"from pprint import pprint as pp; pp(myjson)\"?  </li>\n<li>How can I use HughesPJ in a minimum viable example sense that will generate output similar to python's pretty print (in terms of spaces, indentation, etc., on a json object)?</li>\n</ol>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 4, "creation_date": 1482938866, "post_id": 41364859, "comment_id": 69931418, "body": "So you&#39;re trying to transpose a list of lists?"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 5, "creation_date": 1482938923, "post_id": 41364859, "comment_id": 69931444, "body": "It might be worthwhile looking at <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\">this</a>, which does exactly what you want"}, {"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1482939059, "post_id": 41364859, "comment_id": 69931504, "body": "@EliSadoff yes actually it is transposition, I did not see that it was!  Thanks :)"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 2, "creation_date": 1482939090, "post_id": 41364859, "comment_id": 69931528, "body": "No worries! <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> is an awesome resource."}, {"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1482940283, "post_id": 41364859, "comment_id": 69932197, "body": "@EliSadoff have one more question if you do not mind me asking, do you know any big resources other than the &#39;learn you a haskell&#39; book,that you might have come across?"}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1482941284, "post_id": 41364859, "comment_id": 69932773, "body": "I can recommend <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1482941412, "post_id": 41364859, "comment_id": 69932851, "body": "@Demostroyer I agree with Mika&#39;il. Haskell Programming from First Principles is a truly excellent resource. I strongly recommend it."}, {"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1482944867, "post_id": 41364859, "comment_id": 69934619, "body": "@Mika&#39;il Thanks for the suggestion :)"}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 0, "last_activity_date": 1482943670, "creation_date": 1482943670, "answer_id": 41366321, "question_id": 41364859, "link": "https://stackoverflow.com/questions/41364859/accessing-nth-element-of-a-list-in-list-in-haskell/41366321#41366321", "title": "Accessing nth element of a list in list in Haskell", "body": "<p>Comments answer your question. But, a more generic/abstract version would be one which works with any <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\"><code>Foldable</code></a> data structure, not only lists. That can be done with nested right folds:</p>\n\n<pre><code>import Prelude hiding (foldr)  -- older version ghc\nimport Data.Foldable (foldr, Foldable)\n\ntr :: (Foldable f, Foldable s) =&gt; f (s a) -&gt; [[a]]\ntr = takeWhile (not . null) . foldr (foldr go id) (repeat [])\n  where go i f (x:xs) = (i:x): f xs\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; tr [[10,11],[20],[],[30,31,32]] \n[[10,20,30],[11,31],[32]]\n\n\\&gt; tr [Just 1, Nothing, Just 2]\n[[1,2]]\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1095, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558368800, "creation_date": 1482938204, "question_id": 41364859, "link": "https://stackoverflow.com/questions/41364859/accessing-nth-element-of-a-list-in-list-in-haskell", "title": "Accessing nth element of a list in list in Haskell", "body": "<p>I am trying to build a function which works on lists of lists. This function would take the 1rst element of each list inside the big list, put them into a list together, then do this for the 2nd element, etc. \n        Ex:</p>\n\n<pre><code>tr[[1,2,3],[4,5,6]]    \n=&gt; [[1,4],[2,5],[3,6]\n</code></pre>\n\n<p>It can work for any data type, but for now I am trying to make it work for Int</p>\n\n<p>Here is what I have so far, just the data declaration and a case for empty input:</p>\n\n<pre><code>tr :: [[a]] -&gt; [[a]]\n\ntr [] = []\n</code></pre>\n\n<p>Any help is much appreciated, or even a pointer to a place with information. My idea is that it will use the ++ operator, and the x:xs manipulation of List elements. My problem is figuring out how to access the head of each list respectively, and not just the first list. I can get the 1 from the example using:     head $ head  [[1,2,3]]. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1482951248, "post_id": 41364185, "comment_id": 69937673, "body": "I can&#39;t see anything like that in Control.Lens.Tuple (which only supports tuples up to 9 elements anyway), so it seems unlikely.  Did you need help writing your own lens for this, or were you just checking to make sure you wouldn&#39;t be duplicating something that already existed?"}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "edited": false, "score": 0, "creation_date": 1482961070, "post_id": 41364185, "comment_id": 69941749, "body": "You may need this hack:  <a href=\"https://ivanmiljenovic.wordpress.com/2016/12/28/transmogrify-your-data/\" rel=\"nofollow noreferrer\">ivanmiljenovic.wordpress.com/2016/12/28/transmogrify-your-da&zwnj;&#8203;ta</a>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482979904, "post_id": 41364185, "comment_id": 69946759, "body": "Not writing a lens library. Need to do something like this in actual code where I&#39;m building up a large tuple one/two elements at a time. Very surprised that there isn&#39;t a generic <code>concatTuple</code> function that works on tuples of any length."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482979995, "post_id": 41364185, "comment_id": 69946786, "body": "And there&#39;s probably a good reason why I can&#39;t use a list. Each of my intermediate tuples is the result of an Opaleye leftJoinF. I&#39;m not sure how Opaleye&#39;s type inference would work with lists."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482980108, "post_id": 41364185, "comment_id": 69946815, "body": "@samgersey thanks for the hack. That might help me write my own version of concatTuple."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1482963707, "post_id": 41369465, "comment_id": 69942732, "body": "Well, it would not be a <a href=\"http://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Type.html#t:Simple\" rel=\"nofollow noreferrer\">simple</a> lens, would it? The setter would have type <code>(a,b,c) -&gt; d -&gt; (a,b,c,d)</code> and the getter <code>(a,b,c,d) -&gt; d</code>, for a <code>Lens (a,b,c,d) (a,b,c) d d</code>."}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482965786, "post_id": 41369465, "comment_id": 69943438, "body": "As it sais in docs, <i>&quot;A Simple Lens, Simple Traversal, ... can be used instead of a Lens,Traversal, ... whenever the type variables don&#39;t change upon setting a value.&quot;</i> In our case it does change from <code>(a,b,c)</code> to <code>(a,b,c,d)</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1483157368, "post_id": 41369465, "comment_id": 70013693, "body": "I think you&#39;re both talking past each other here -- @samsergey said &quot;simple <i>list</i>&quot;, not &quot;simple lens&quot;, in his answer."}], "tags": [], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1482959371, "last_edit_date": 1482959371, "creation_date": 1482957915, "answer_id": 41369465, "question_id": 41364185, "link": "https://stackoverflow.com/questions/41364185/lens-setter-to-add-element-to-end-of-tuple/41369465#41369465", "title": "Lens setter to add element to end of tuple", "body": "<p>To get a lens you need a getter an setter functions. Unfortunately, there is no way to obtain a fourth element of a triple, (except for <code>Nothing</code>,  or any other unit type). So, you end up with a bunch of setters, which are trivial pattern-matching functions (one for each n-tuple), but not a lens.</p>\n\n<p>Probably, you need a simple list, or some free construction, if you really need non-uniform container?</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1482959371, "creation_date": 1482935778, "question_id": 41364185, "link": "https://stackoverflow.com/questions/41364185/lens-setter-to-add-element-to-end-of-tuple", "title": "Lens setter to add element to end of tuple", "body": "<p>Is there any lens that will help me do the following transformation for a tuple of any length (say up 10-15 elements, at least):</p>\n\n<pre><code>(a, b, c) -&gt; d -&gt; (a, b, c, d)\n</code></pre>\n"}, {"tags": ["unit-testing", "haskell", "testing", "types"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1482933827, "post_id": 41363586, "comment_id": 69928567, "body": "If <code>T</code> is so abstract that you cannot access its constructors <i>and</i> you provide no functions that operate on values of type <code>T</code>, how would you use it for anything useful in the first place? In the example you have provided, you cannot do anything with a <code>T</code> except <code>show</code> it, which makes the example a bit too contrived to give an answer for."}, {"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 1, "creation_date": 1482936507, "post_id": 41363586, "comment_id": 69930045, "body": "As an addition to the previous comment, it is customary not to hide things permanently but instead export the things which normal users are not intended to see in the form of <code>Internal</code> modules. There is an unwritten (I think) agreement that anything goes inside an <code>Internal</code> module, so as a library author you are free to change anything you want without backward compatibility concerns and if anyone imports the module in their code they are on their own. This is better than deciding for <i>everyone</i> that they cannot import things even if they know what they&#39;re doing."}], "answers": [{"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 0, "last_activity_date": 1530853050, "creation_date": 1530853050, "answer_id": 51203253, "question_id": 41363586, "link": "https://stackoverflow.com/questions/41363586/how-to-test-an-abstract-data-type/51203253#51203253", "title": "How to test an abstract data type?", "body": "<p>The <a href=\"https://www.reddit.com/r/haskell/comments/8w90ia/test_non_public_functions/\" rel=\"nofollow noreferrer\">generally accepted</a> best practice is, for an exposed module <code>A</code>, to create an internal module <code>A.Internal</code> that is either:</p>\n\n<ol>\n<li><p>Exposed but documented to be unstable or unsafe.</p></li>\n<li><p>Not exposed to the users of the package, but only to the testing facilities. <em>(This is made possible by the <a href=\"https://github.com/haskell/cabal/issues/269\" rel=\"nofollow noreferrer\">internal libraries</a> feature released in Cabal 2.0.)</em></p></li>\n</ol>\n\n<p>It is my understanding that functions that are not exposed enjoy more radical optimizations, particularly inlining. I am not sure if it applies to functions in internal libraries too.</p>\n\n<p>On the other hand, situations often arise when a user desperately needs some internal feature of your library and ends up forking and patching it to gain access. This is, of course, unfortunate and undesirable.</p>\n\n<p>I would say generally that the implementation of an abstract type is best kept in an internal library as a safety measure, but you should use your judgement in each particular case.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1530853050, "creation_date": 1482933447, "last_edit_date": 1482935142, "question_id": 41363586, "link": "https://stackoverflow.com/questions/41363586/how-to-test-an-abstract-data-type", "title": "How to test an abstract data type?", "body": "<p>Suppose we have a module that defines an abstract type T:</p>\n\n<pre><code>module AbstractType (T, lexer) where\n\ndata T = T String deriving Show\n\nlexer = (fmap T) . words\n</code></pre>\n\n<p>(Note that we do not export any type constructors for T, so the user would not be able to draft an instance by hand.)</p>\n\n<p>How does one unit test <code>lexer</code> function?</p>\n\n<p>Sure we may use the Show property of T, like this:</p>\n\n<pre><code>module Main where\n\nimport AbstractType\n\nmain = test\n    (show $ lexer \"summer is miles and miles away\")\n        \"[T \\\"summer\\\",T \\\"is\\\",T \\\"miles\\\",T \\\"and\\\",T \\\"miles\\\",T \\\"away\\\"]\"\n\ntest :: (Eq a) =&gt; a -&gt; a -&gt; IO ()\ntest expression expectation\n    | expression == expectation = putStrLn \"Test passed.\"\n    | otherwise = error \"Test failed.\"\n</code></pre>\n\n<p>\u2014 But this is both not beautiful and unfit for cases when our abstract type is not an instance of a class that permits casting to another, constructable type.</p>\n\n<p>Is there a remedy?</p>\n\n<p>P.S. To provide some justification for the case: suppose we have a chain of functions like <code>parser . lexer</code> that we can integration test and see if the whole of it works. As the chain at hand gets more complex, it may nevertheless become desirable to unit test each link individually. </p>\n\n<p>The example is a simplified excerpt from an actual toy text processor I am in the process of writing.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1482931403, "post_id": 41362896, "comment_id": 69927222, "body": "How did you come up with the idea of using <code>&amp;&amp;</code> for this? That&#39;s a <i>logical and operator</i>."}, {"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482931722, "post_id": 41362896, "comment_id": 69927397, "body": "@leftaroundabout was just trying to call the function until the list was empty, and I had used it before in another function I was making and it worked. It does seem to be my problem though."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482932027, "post_id": 41362896, "comment_id": 69927541, "body": "In Haskell, it doesn&#39;t really make a lot of sense to \u201ccall functions until <i>X</i>\u201d. You don&#39;t think about who calls whom, but how <i>the result should look</i>."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "edited": false, "score": 0, "creation_date": 1482932156, "post_id": 41363155, "comment_id": 69927624, "body": "OK cool, I am new to Haskell and did not know there was this Hoogle site that explains this type of stuff.  Is there a way to fix the issue I am having, in that the logical and operator is looking for true on both sides ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "edited": false, "score": 1, "creation_date": 1482932329, "post_id": 41363155, "comment_id": 69927718, "body": "Well yes, <i>don&#39;t use the logical operator</i>!"}, {"owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "edited": false, "score": 0, "creation_date": 1482932513, "post_id": 41363155, "comment_id": 69927805, "body": "Ye I get what you mean now. Thanks for your help with this and that Hoogle site!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1482932292, "last_edit_date": 1482932292, "creation_date": 1482931867, "answer_id": 41363155, "question_id": 41362896, "link": "https://stackoverflow.com/questions/41362896/given-two-lists-the-second-being-positive-integers-repeat-the-first-lists-char/41363155#41363155", "title": "Given two Lists, the second being positive integers, repeat the first lists characters with the respective numbers in the second list", "body": "<p>How did you come up with the idea of using <code>&amp;&amp;</code> for this? That's a logical and operator, i.e. it combines two truth-values (<code>Bool</code>) to a value that's <code>True</code> only if both sides are true.</p>\n\n<p>What you're dealing with are not boolean values but lists, though. You want to combine two <em>lists</em> to a list that starts with the first and continues with the other. IOW, you want a function with type <code>[Char] -&gt; [Char] -&gt; [Char]</code>. Actually it shouldn't matter that the list elements are <code>Char</code>s, this should work for lists containing <em>any</em> types: <code>[a] -&gt; [a] -&gt; [a]</code>.  Well, you can <a href=\"https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">hoogle that</a>! The <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:-43--43-\" rel=\"nofollow noreferrer\">first result</a> is</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]                     infixr 5\n\n     Append two lists, i.e.,\n\n     [x1, ..., xm] ++ [y1, ..., yn] == [x1, ..., xm, y1, ..., yn]\n     [x1, ..., xm] ++ [y1, ...] == [x1, ..., xm, y1, ...]\n\n     If the first list is not finite, the result is the first list.\n</code></pre>\n\n<p>Sounds good, doesn't it? So, this is the function you're trying to write:</p>\n\n<pre><code>replicates :: [Int] -&gt; [a] -&gt; [a]\nreplicates (n:ns) (x:xs) =  replicate n x ++ replicates ns xs\nreplicates _ _ = []\n</code></pre>\n\n<p>Alternatively, you can define this as</p>\n\n<pre><code>replicates ns = concat . zipWith replicate ns\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 3004820, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e08ccd7d8cf7058f4d5eeda35082ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Demostroyer", "link": "https://stackoverflow.com/users/3004820/demostroyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 41363155, "answer_count": 1, "score": 1, "last_activity_date": 1482932292, "creation_date": 1482930893, "last_edit_date": 1482931163, "question_id": 41362896, "link": "https://stackoverflow.com/questions/41362896/given-two-lists-the-second-being-positive-integers-repeat-the-first-lists-char", "title": "Given two Lists, the second being positive integers, repeat the first lists characters with the respective numbers in the second list", "body": "<p>Trying to create a function which takes in two lists, the first being a list of characters, the second being positive integers. The function then repeats the characters in the first list the number of times the same position number in the second list is. Ex:</p>\n\n<pre><code>myCount ['a','b'] ['1','2'] =&gt; ['a','b','b']\n</code></pre>\n\n<p>What I have so far: </p>\n\n<pre><code>myCount :: [Char] -&gt; [Int] -&gt; [Char]       \nmyCount [] [] = []\nmyCount (x:xs) (y:ys) =  replicate y x &amp;&amp; myCount xs ys\n</code></pre>\n\n<p>I am replicating the char from the first list (x) y times and then recursively doing this for the entire lists. \nAny help or pointers in the right direction would be great!</p>\n\n<p>My Error is:</p>\n\n<pre><code>mess.hs:10:43: error:\n\n* Couldn't match expected type `Bool' with actual type `[Char]'\n* In the second argument of `(&amp;&amp;)', namely `myCount xs ys'\n      In the expression: replicate y x &amp;&amp; myCount xs ys\n      In an equation for `myCount':\n          myCount (x : xs) (y : ys) = replicate y x &amp;&amp; myCount xs ys\n</code></pre>\n"}, {"tags": ["sql", "rest", "haskell", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 4, "last_activity_date": 1482933619, "creation_date": 1482933619, "answer_id": 41363633, "question_id": 41362003, "link": "https://stackoverflow.com/questions/41362003/haskell-database-query-inside-scottym-function/41363633#41363633", "title": "Haskell database query inside ScottyM() function", "body": "<p>The <a href=\"http://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html#v:get\" rel=\"nofollow noreferrer\"><code>get</code></a> function's second argument is of type <a href=\"http://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html#t:ActionM\" rel=\"nofollow noreferrer\"><code>ActionM</code></a>. If you investigate further, you'll see this is just shorthand for the more complicated looking <a href=\"http://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty-Internal-Types.html#t:ActionT\" rel=\"nofollow noreferrer\"><code>ActionT</code></a>, with <code>e</code> as <code>Text</code> and <code>m</code> as <code>IO</code>.</p>\n\n<p>Because your <code>do</code> block is of this type, you can't call <code>IO</code> functions directly. You need to use <code>liftIO</code> to get the right type. So just adding a <code>liftIO</code> before the <code>query_</code> call should fix it.</p>\n\n<p>There's an example called <a href=\"https://github.com/scotty-web/scotty/wiki\" rel=\"nofollow noreferrer\">using scotty with IO</a> in the project wiki which shows this.</p>\n"}], "owner": {"reputation": 347, "user_id": 4597077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9248ef487aecc6772fedb9f7b133f3c?s=128&d=identicon&r=PG&f=1", "display_name": "maciej", "link": "https://stackoverflow.com/users/4597077/maciej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 41363633, "answer_count": 1, "score": 0, "last_activity_date": 1482933619, "creation_date": 1482927439, "last_edit_date": 1482928023, "question_id": 41362003, "link": "https://stackoverflow.com/questions/41362003/haskell-database-query-inside-scottym-function", "title": "Haskell database query inside ScottyM() function", "body": "<p>I'm trying to write simple rest API. I use Database.SQLite.Simple, Scotty and Aeson. I have a problem with DB query inside ScottyM() route function. When I have something like this</p>\n\n<pre><code>routes :: [User] -&gt; ScottyM ()\nroutes allUsers = do\n    get \"/users/:id\" $ do\n        id &lt;- param \"id\"\n        json ([x | x &lt;- allUsers, userId x == id] !! 0)\n\nmain = do\n    conn &lt;- open \"data.db\"\n    users &lt;- ( query_ conn \"select id, first_name, second_name, team from users\" :: IO [User] )\n    scotty 3000 (routes users)\n</code></pre>\n\n<p>everything works fine, but in this scenario allUsers will get updated only once at server start. I want to query every time anyone ask about it. So I wrote this: </p>\n\n<pre><code>routes :: Connection -&gt; ScottyM ()\nroutes conn= do\n   get \"/users/:id\" $ do\n        id &lt;- param \"id\"\n        users &lt;- ( query_ conn \"select id, first_name, second_name, team from users\" :: IO [User] )\n        json (users !! id)\n\nmain = do\n    conn &lt;- open \"data.db\"\n    scotty 3000 (routes conn)\n</code></pre>\n\n<p>I get error</p>\n\n<pre><code>Couldn't match expected type \u2018Web.Scotty.Internal.Types.ActionT\n                                Text IO [a0]\u2019\n            with actual type \u2018IO [User]\u2019\nIn a stmt of a 'do' block:\n  users &lt;- (query_\n              conn \"select id, first_name, second_name, team from users\" ::\n              IO [User])\nIn the second argument of \u2018($)\u2019, namely\n  \u2018do { id &lt;- param \"id\";\n        users &lt;- (query_\n                    conn \"select id, first_name, second_name, team from users\" ::\n                    IO [User]);\n        json (users !! id) }\u2019\nIn a stmt of a 'do' block:\n  get \"/users/:id\"\n  $ do { id &lt;- param \"id\";\n         users &lt;- (query_\n                     conn \"select id, first_name, second_name, team from users\" ::\n                     IO [User]);\n         json (users !! id) }\n</code></pre>\n\n<p>how to fix that? Also how can I pass arguments to sql query if I want for example <code>select * from users where id = id from parameters</code>?</p>\n"}, {"tags": ["parsing", "haskell", "rfc5322"], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 3, "last_activity_date": 1482964079, "last_edit_date": 1482964079, "creation_date": 1482927569, "answer_id": 41362041, "question_id": 41360380, "link": "https://stackoverflow.com/questions/41360380/choosing-the-right-readp-parse-result/41362041#41362041", "title": "Choosing the right ReadP parse result", "body": "<p>You should not to do preference. Your problem is that your partial parsers are accepting the more bigger string set than really need.</p>\n\n<p>For example, my solution:</p>\n\n<pre><code>import           Control.Bool\nimport           Control.Applicative\nimport           Data.Char\nimport qualified Data.Text                     as T\nimport           Data.Text (Text)\nimport           Text.ParserCombinators.ReadP\n\nemail :: ReadP Text\nemail = do\n    l &lt;- part\n    a &lt;- char '@'\n    d &lt;- part\n    return . T.pack $ l ++ a:d\n  where\n    part = munch1 (isAscii &lt;&amp;&amp;&gt; (/='@') &lt;&amp;&amp;&gt; (/='&lt;') &lt;&amp;&amp;&gt; (/='&gt;'))\n\nname :: ReadP Text\nname = T.pack &lt;$&gt; chainr1 part sep\n  where\n    part = munch1 (isAlpha &lt;||&gt; isDigit &lt;||&gt; (=='\\''))\n    sep  = (\\xs ys -&gt; xs ++ ' ':ys) &lt;$ munch1 (==' ')\n\nonlyEmail :: ReadP Address\nonlyEmail = Address Nothing &lt;$&gt; email\n\nwithName :: ReadP Address\nwithName = do\n    n &lt;- name\n    skipSpaces\n    e &lt;- between (char '&lt;') (char '&gt;') email\n    return $ Address (Just n) e\n\naddress :: ReadP Address\naddress = skipSpaces *&gt; (withName &lt;|&gt; onlyEmail)\n\nmain = print $ readP_to_S address \"Foo Bar &lt;foo@bar.com&gt;\"\n</code></pre>\n\n<p>Will be printed:</p>\n\n<pre><code>[(Address (Just \"Foo Bar\") \"foo@bar.com\",\"\")]\n</code></pre>\n"}], "owner": {"reputation": 12964, "user_id": 704015, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/rpCnn.png?s=128&g=1", "display_name": "Jezen Thomas", "link": "https://stackoverflow.com/users/704015/jezen-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 41362041, "answer_count": 1, "score": 2, "last_activity_date": 1482964079, "creation_date": 1482921946, "question_id": 41360380, "link": "https://stackoverflow.com/questions/41360380/choosing-the-right-readp-parse-result", "title": "Choosing the right ReadP parse result", "body": "<p>I'm trying to parse a RFC5322 email address. My parser works in the sense that among the results, one of them is correct. However, how do I go about selecting the \u201ccorrect\u201d result?</p>\n\n<p>Given the string <code>Foo Bar &lt;foo@bar.com&gt;</code>, my parser should produce a value of <code>Address (Just \"Foo Bar\") \"foo@bar.com\"</code>.</p>\n\n<p>Alternatively, given the string <code>foo@bar.com</code>, my parser should produce a value of <code>Address Nothing \"foo@bar.com\"</code>.</p>\n\n<p>The value with the name included is preferred.</p>\n\n<p>My parser looks like this:</p>\n\n<pre><code>import           Control.Applicative\nimport           Data.Char\nimport qualified Data.Text                     as T\nimport           Text.ParserCombinators.ReadP\n\nonlyEmail :: ReadP Address\nonlyEmail = do\n  skipSpaces\n  email &lt;- many1 $ satisfy isAscii\n  skipSpaces\n  return $ Address Nothing (T.pack email)\n\nwithName :: ReadP Address\nwithName = do\n  skipSpaces\n  name &lt;- many1 (satisfy isAscii)\n  skipSpaces\n  email &lt;- between (char '&lt;') (char '&gt;') (many1 $ satisfy isAscii)\n  skipSpaces\n  return $ Address (Just $ T.pack name) (T.pack email)\n\nrfc5322 :: ReadP Address\nrfc5322 = withName &lt;|&gt; onlyEmail\n</code></pre>\n\n<p>When I run the parser with <code>readP_to_S rfc5322 \"Foo Bar &lt;foo@bar.com&gt;\"</code>, it produces the following results:</p>\n\n<pre><code>[ (Address {addressName = Nothing, addressEmail = \"F\"},\"oo Bar &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Fo\"},\"o Bar &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo\"},\"Bar &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo \"},\"Bar &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo B\"},\"ar &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Ba\"},\"r &lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar\"},\"&lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar \"},\"&lt;foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;\"},\"foo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;f\"},\"oo@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;fo\"},\"o@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo\"},\"@bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@\"},\"bar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@b\"},\"ar.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@ba\"},\"r.com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar\"},\".com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar.\"},\"com&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar.c\"},\"om&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar.co\"},\"m&gt;\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar.com\"},\"&gt;\")\n, (Address {addressName = Just \"Foo Bar\", addressEmail = \"foo@bar.com\"},\"\")\n, (Address {addressName = Just \"Foo Bar \", addressEmail = \"foo@bar.com\"},\"\")\n, (Address {addressName = Nothing, addressEmail = \"Foo Bar &lt;foo@bar.com&gt;\"},\"\")\n]\n</code></pre>\n\n<p>In this case, the result I actually want appears third-last in the list. How do I express that preference?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1482921943, "post_id": 41359985, "comment_id": 69922040, "body": "zip3 doesn&#39;t construct extra list, because it constructs it by lazy way. Overhead is only in pack/unpack values in/from triple. However, this expression will be evaluated in constant memory space (if as, bs and cs list are already constructed or nobody retain them)."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482932100, "post_id": 41359985, "comment_id": 69927582, "body": "@freestyle This is a bit of an overstatement: while the list is constructed lazily, each cons cell is still constructed and this construction and deconstruction inside <code>scanl&#39;</code> do have some overhead in addition to the sources you list (unless list fusion happens)."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1482950916, "last_edit_date": 1482950916, "creation_date": 1482950385, "answer_id": 41367870, "question_id": 41359985, "link": "https://stackoverflow.com/questions/41359985/haskell-scanning-over-multiple-lists-at-once/41367870#41367870", "title": "Haskell - scanning over multiple lists at once", "body": "<p>As mentioned in the comments, a Haskell program that looks like it's generating an \"extra list\" rarely actually generates the extra list (thanks to lazy evaluation, among other things), so there is unlikely to be additional memory usage introduced by the use of <code>zip3</code>.  If the function is used in such a way that the list can be consumed as it is produced, no actual lists (intermediate or final) will be produced whatsoever.</p>\n\n<p>For example, consider the following <code>Scan.hs</code> program which consumes a large list with <code>sum</code> as it is produced:</p>\n\n<pre><code>import Data.List (scanl')\n\nscanl3 :: (acc -&gt; (a, b, c) -&gt; acc) -&gt; acc -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [acc]\nscanl3 f z as bs cs = scanl' f z $ zip3 as bs cs\n\nmain = print $ sum $ scanl3 (\\z (a, b, c) -&gt; z + a*b + 2*c) \n                            0 [1..100000000] [10,20..] [100,200..]\n</code></pre>\n\n<p>If you compile this for profiling with <code>-O2</code> optimizations:</p>\n\n<pre><code>ghc -prof -rtsopts=all -O2 Scan.hs \n</code></pre>\n\n<p>then run it with heap profiling:</p>\n\n<pre><code>./Scan +RTS -h\nhp2ps Scan.hp\nevince Scan.ps\n</code></pre>\n\n<p>you'll find that it runs in constant memory about 35k), creating neither the intermediate <code>zip3</code> list nor the final <code>scanl3</code> list explicitly.</p>\n\n<p>If <code>scanl3</code> is used in a context where the entire list needs to be held in memory at once, the intermediate list <em>still</em> shouldn't cause any increased memory use, though the only way to be sure would be to profile both it and an alternative implementation in a specific usage case.</p>\n\n<p>With respect to time overhead of using <code>zip3</code> as an intermediate step, again you really need to benchmark against an alternative implementation to be sure.  I compared the above version using <code>zip3</code> against a recursive version:</p>\n\n<pre><code>scanl3 :: (acc -&gt; (a, b, c) -&gt; acc) -&gt; acc -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [acc]\nscanl3 f z (a:as) (b:bs) (c:cs) = z : scanl3 f (f z (a, b, c)) as bs cs\nscanl3 _ z _ _ _ = [z]\n</code></pre>\n\n<p>using the same test case as above compiled with <code>-O2</code> and found the runtime to be nearly identical (15.2sec for <code>zip3</code> versus 16.8sec for recursive).</p>\n\n<p>Note that I didn't explicitly make my recursive version strict, but in the particular usage case (summing it as it was produced), that doesn't make any difference.</p>\n\n<p>Edit:  Actually, I guess it does make a difference.  A strict version using a bang pattern:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nscanl3 :: (acc -&gt; (a, b, c) -&gt; acc) -&gt; acc -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [acc]\nscanl3 f !z (a:as) (b:bs) (c:cs) = z : scanl3 f (f z (a, b, c)) as bs cs\nscanl3 _ z _ _ _ = [z]\n</code></pre>\n\n<p>looks like it might run consistently 0.5-1.0 secs faster (out of 16secs).</p>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 41367870, "answer_count": 1, "score": 2, "last_activity_date": 1482950916, "creation_date": 1482920710, "last_edit_date": 1482923060, "question_id": 41359985, "link": "https://stackoverflow.com/questions/41359985/haskell-scanning-over-multiple-lists-at-once", "title": "Haskell - scanning over multiple lists at once", "body": "<p>Doing some university homework I found myself doing something similar to:</p>\n\n<p><code>scanl' (\\acc (a, b, c) -&gt; expression) 0 $ zip3 as bs cs</code></p>\n\n<p>With different numbers of zipped lists, up to 7. This seems pretty inefficient since it constructs an auxiliary list of tuples.</p>\n\n<p>It isn't very hard to define <code>scanl2, scanl3</code>, etc recursively and avoid constructing an extra list, but the amount of boilerplate required is ridiculous.</p>\n\n<p>Is there a way to have both - lack of boilerplate and low memory usage ?</p>\n"}, {"tags": ["haskell", "error-handling", "try-catch"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482913248, "post_id": 41357956, "comment_id": 69917515, "body": "I marked this as a duplicate of the spoon question because this question essentially reimplements spoon"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1482921160, "post_id": 41357956, "comment_id": 69921612, "body": "In short, it allows to define non-monotonic functions on domains. This is unlike everything else, so it can be surprising. Also, one should be very careful about when errors are generated. E.g. in <code>pureCatch ([[undefined]] !! 0) [4]</code> one could easily think the result will be completely bottom-free, when this is not the case."}], "owner": {"reputation": 60, "user_id": 3064675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09e8a2bac53002c2643a6c9d619eea5e?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Baragona", "link": "https://stackoverflow.com/users/3064675/kevin-baragona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "closed_date": 1482913211, "answer_count": 0, "score": 2, "last_activity_date": 1482912698, "creation_date": 1482912698, "question_id": 41357956, "link": "https://stackoverflow.com/questions/41357956/what-are-the-dangers-of-a-purely-functional-try-catch", "closed_reason": "Duplicate", "title": "What are the dangers of a purely functional try-catch?", "body": "<p>Here I have a little bit of code that seems to implement a \"purely\" functional version of try-catch: Evaluate a value, and if an error occurs, return a different given value of the same type. The example below works in GHCi.</p>\n\n<p>The first argument to pureCatch is the value to attempt to compute. The second argument is the value to use if an exception occurs while calculating it. (Could obviously be replaced with the use of Maybe, but the effect is the same.)</p>\n\n<pre><code>:set -XScopedTypeVariables\nimport System.IO.Unsafe\nimport Control.Exception\n\nlet pureCatch :: a -&gt; a -&gt; a; pureCatch (value :: x) if_err = unsafePerformIO (catch (evaluate (value)) ((\\_ -&gt; (return if_err)) :: (SomeException -&gt; IO x)) )\n\n\n&gt;pureCatch (head [1]) 2\n1\n\n&gt;pureCatch (head []) 2\n2\n\n&gt;pureCatch ([\"value\"] !! 0) \"error\"\n\"value\"\n\n&gt;pureCatch ([] !! 0) \"error\"\n\"error\"\n</code></pre>\n\n<p>Are there any errors that cannot be caught using this technique, apart from serious system errors like out of memory or GHC bugs or something? Could this function be extended to catch any other types of errors?</p>\n\n<p>Is the use of unsafePerformIO really unsafe here? How? Could this crash the program completely?</p>\n\n<p>Is this technique guaranteed to catch all exceptions in the evaluation of \"value\"?</p>\n\n<p>Is there anything non deterministic about this technique, or undefined behavior from the perspective of the Haskell language?</p>\n\n<p>Anything else I should know about this? (Tell me how naughty I am for attempting to catch everything :) ) I'm not necessarily going to use this anywhere, this is intellectual curiosity. I'm not a Haskell programmer.</p>\n\n<p>Can it be written with nicer syntax or not require XScopedTypeVariables?</p>\n\n<p>I get the feeling that this is probably the function that beginning Haskell programmers would love to use to catch errors. So, why not?</p>\n"}, {"tags": ["haskell", "algebra", "category-theory", "comonad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482915425, "post_id": 41357856, "comment_id": 69918494, "body": "<code>e</code> seems to be a natural fit for the unit.  Do you have an idea how you might define, uh, comultiplcation? <code>f(r) -&gt; f(f(r))</code>"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482916065, "post_id": 41357856, "comment_id": 69918810, "body": "@luqui: I think so, e would serve as the counit. Actually I want to check if (forall r. f(r)-&gt;r, a) is a Monad, f must be a Comonad. This was motivated by revising an answer I wrote to another question about Comonads."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482916173, "post_id": 41357856, "comment_id": 69918870, "body": "@luqui: I mean this <a href=\"http://stackoverflow.com/questions/34302616/can-you-define-comonads-based-on-monads\">question</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1482932766, "post_id": 41357856, "comment_id": 69927995, "body": "How about naming this something other but <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"nofollow noreferrer\"><code>&lt;*&gt;</code></a>?"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482983007, "post_id": 41357856, "comment_id": 69947404, "body": "@leftaroundabout: What would be a good fit? I often use \\otimes, but unicode characters often get in the way of correct indentation in Emacs. Any suggestion?"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1482983419, "post_id": 41357856, "comment_id": 69947493, "body": "This is not strictly necessary, but I might better add the condition that f is additionally pointed (i.e. <code>forall r.r-&gt;f(r)</code> is inhabited). Then the question becomes about constructing suitable <code>extend</code> out of such &#39;points&#39; of the functor."}, {"owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 2, "creation_date": 1482997222, "post_id": 41357856, "comment_id": 69951988, "body": "This is almost the definition of a comonad using co-Kleisli arrows, except that co-Kleisli arrows can go between different objects (f a -&gt; b). For this to be a comonad you&#39;d have to extend &lt;*&gt; to the full-blown co-Kleisli composition operator =&gt;=. I don&#39;t see how this could be done, unless you&#39;re working in a discrete category"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1483024657, "post_id": 41357856, "comment_id": 69966788, "body": "@mnish huh? I use unicode characters all the time when coding Haskell in Emacs, don&#39;t see how <code>\u2297</code> would be a problem. Nevertheless something ASCII like, whatever, <code>&gt;*&lt;</code> might be preferrable for compatibility."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "reply_to_user": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 0, "creation_date": 1483060396, "post_id": 41357856, "comment_id": 69981012, "body": "@Bartosz Thanks, true enough! It would be quite interesting if that kind of high level statement actually leads to a concrete combinatorial description. You don&#39;t need to consider general co-Kleisli arrows, endomorphic arrows are enough as long as the derivation is natural."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483066449, "post_id": 41357856, "comment_id": 69982306, "body": "Does the lens package do this?"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483067913, "post_id": 41357856, "comment_id": 69982549, "body": "Skimmed the documentation and I couldn&#39;t find a reason why it can&#39;t do this. Probably this is it."}], "owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1483113837, "creation_date": 1482912211, "last_edit_date": 1483113837, "question_id": 41357856, "link": "https://stackoverflow.com/questions/41357856/does-a-natural-monoidal-structure-on-copoints-of-a-functor-induce-a-comonad", "title": "Does a natural monoidal structure on copoints of a Functor induce a Comonad?", "body": "<p>The situation is as follows (I changed to more standard-ish Haskell notation):</p>\n\n<pre><code>class Functor f =&gt; MonoidallyCopointed f where\n    copointAppend ::  (\u2200r.f(r)-&gt;r) -&gt; (\u2200r.f(r)-&gt;r) -&gt; (\u2200r.f(r)-&gt;r)\n    copointEmpty  ::  \u2200r.f(r)-&gt;r\n</code></pre>\n\n<p>such that for all instance F of <code>MonoidallyCopointed</code> and for all</p>\n\n<pre><code>x,y,z::\u2200r.F(r)-&gt;r\n</code></pre>\n\n<p>The following holds:</p>\n\n<pre><code>x `copointAppend` copointEmpty == copointEmpty `copointAppend` x == x\nx `copointAppend` (y `copointAppend` z) == (x `copointAppend` y) `copointAppend` z\n</code></pre>\n\n<p>Then is it true that F has a natural <code>Comonad</code> instance defined from <code>copointAppend</code> and <code>copointEmpty</code>?</p>\n\n<p>N.B. The converse holds (with <code>copointEmpty = extract</code> and <code>copointAppend f g = f . g . duplicate</code>.)</p>\n\n<p>EDIT</p>\n\n<p>As Bartosz pointed out in the comment, this is mostly the definition of comonads using the co-Kleisli adjunction. So the question is really about the constructivity of this notion. Accordingly,\nthe following question is probably more interesting in terms of real-world applications:</p>\n\n<p>Does there exist a constructive isomorphism between the set of possible <code>Comonad</code> instances of f and the set of possible <code>MonoidallyCopointed</code> instances of f?</p>\n\n<p>This can be useful in practice because a direct definition of <code>Comonad</code> instance can involve a bit of\ntechnical, hard-to-read code that cannot be verified by the type checker. For example,</p>\n\n<pre><code>data W a = W (Maybe a) (Int -&gt; a) (Either (String -&gt; a) (a,a,a,a))\n</code></pre>\n\n<p>has a Comonad instance but the direct definition (with the proof that it's indeed a Comonad!) may not be so easy.\nOn the other hand, providing a <code>MonoidallyCopointed</code> instance may be a little easier (but I'm not perfectly\nsure of this point).</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6562848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64d818cd149213c4983400a3473de33?s=128&d=identicon&r=PG&f=1", "display_name": "user6562848", "link": "https://stackoverflow.com/users/6562848/user6562848"}, "is_accepted": false, "score": 0, "last_activity_date": 1556227092, "creation_date": 1556227092, "answer_id": 55857776, "question_id": 41354320, "link": "https://stackoverflow.com/questions/41354320/limiting-ghcs-memory-usage/55857776#55857776", "title": "Limiting GHC&#39;s memory usage", "body": "<p>one way would be to use containers with memory limits. I'm currently testing this theory, and it works but you'll have a major downside as the limit you're setting for the memory will cause GHC to just allocate swap space. it will take ages.</p>\n\n<p>it would probably be a good idea to look a <a href=\"http://haskell.1045720.n5.nabble.com/Building-on-limited-memory-environments-or-does-M-really-work-td5866310.html\" rel=\"nofollow noreferrer\">this solution</a> too. I'm quoting :</p>\n\n<blockquote>\n  <p>-j just tells GHC to parallelise compilation across modules. This can \n      increase the maximum heap size needed by the compiler. </p>\n  \n  <p>-A sets the nursery size; to first order the doesn't affect the \n      maximum heap size, but rather is helpful when running parallel \n      programs (e.g. ghc with -j) to minimize the frequency with which we \n      must garbage-collect. </p>\n  \n  <p>-M is a bit tricky to define. For one, it defines the maximum heap \n     size beyond which we will terminate. However, we also use it in \n     garbage collector to make various decisions about GC scheduling. I'll \n     admit that I'm not terribly familiar with the details here. </p>\n</blockquote>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 509, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1556227092, "creation_date": 1482889667, "last_edit_date": 1484141896, "question_id": 41354320, "link": "https://stackoverflow.com/questions/41354320/limiting-ghcs-memory-usage", "title": "Limiting GHC&#39;s memory usage", "body": "<p>Is there a way to limit ghc's memory usage during compilation, without compromising code quality? I am on a 2GB machine, and it literally halts during builds. GHC version 7.10.3, Ubuntu 14.04, 4GB swap.</p>\n"}, {"tags": ["haskell", "types", "ghc", "ghci"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482889796, "post_id": 41354231, "comment_id": 69910575, "body": "Non-answers: the <code>:i</code> command show some extra information about a value beyond its type; it also works with classes (however, it is a prefix command just like <code>:t</code>). Also, <code>:set +t</code> will make GHCi print the type of anything that is successfully evaluated at the command prompt (however, it unfortunately doesn&#39;t help with the no-instance-for-Show situation you talk about)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482893533, "post_id": 41354231, "comment_id": 69911320, "body": "I think you should rephrase the question in a way that doesn&#39;t put down GHCi. What you want seems fairly reasonable; people are likely to be more interested in helping if you ask nicely."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482897797, "post_id": 41354231, "comment_id": 69912110, "body": "Well the error message should clue you in to how the repl works. I don&#39;t think what you want is possible. It might be a good idea though. Or it might be an arbitrary special case that would confuse people."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1482900615, "post_id": 41354231, "comment_id": 69912750, "body": "@jberryman, I think a variation on it probably is possible, although I think it should be controlled by an option. The OP&#39;s request doesn&#39;t really sound like a great default to me."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482904078, "post_id": 41354231, "comment_id": 69913846, "body": "Also a non-answer, but perhaps an amusing one: <code>instance (Typeable a, Typeable b) =&gt; Show (a -&gt; b) where show = show . typeOf</code>. But beware the polymorphic function."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482935807, "post_id": 41354231, "comment_id": 69929664, "body": "@dfeuer Point taken, removed that part."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482935948, "post_id": 41354231, "comment_id": 69929740, "body": "@jberryman I find the error messages very &quot;cryptic&quot; (I&#39;m only learning it, so it may be just me)."}], "answers": [{"comments": [{"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482935680, "post_id": 41355511, "comment_id": 69929590, "body": "You mean I can&#39;t even reconfigure the function (<code>Show</code>?) that runs on <code>f</code> in that case?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482938282, "post_id": 41355511, "comment_id": 69931089, "body": "@DmitriZaitsev, you can configure what function is used to print values in GHCi, but that will not help you, unless I&#39;m very confused about what you&#39;re after."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482940154, "post_id": 41355511, "comment_id": 69932126, "body": "I am after printing <code>:t f</code> (before the error message) when typing <code>f</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482946536, "post_id": 41355511, "comment_id": 69935402, "body": "@DmitriZaitsev, right, and you can&#39;t get that at the GHCi command line. You can get an awful lot using emacs or vim to interact with GHCi."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1482900531, "creation_date": 1482900531, "answer_id": 41355511, "question_id": 41354231, "link": "https://stackoverflow.com/questions/41354231/how-can-i-set-up-haskells-ghci-to-interactively-evaluate-functions-to-their-sig/41355511#41355511", "title": "How can I set up Haskell&#39;s GHCI to interactively evaluate functions to their signature (type) instead of getting errors?", "body": "<p>You probably can't do this today. I've opened <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13039#ticket\" rel=\"nofollow noreferrer\">a feature request</a> to see about adding options to control what GHCi reports about type errors at the prompt.</p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1482967102, "creation_date": 1482967102, "answer_id": 41371056, "question_id": 41354231, "link": "https://stackoverflow.com/questions/41354231/how-can-i-set-up-haskells-ghci-to-interactively-evaluate-functions-to-their-sig/41371056#41371056", "title": "How can I set up Haskell&#39;s GHCI to interactively evaluate functions to their signature (type) instead of getting errors?", "body": "<p>GHCi will already happily show you the types of anything you type into the prompt, with the option <code>:set +t</code>. The only issue is that <code>show</code> is called on the thing, and there is no proper manner for showing functions - and the type is only printed for an expression which can be shown in a valid manner. However, you can get around this quite easily: </p>\n\n<pre><code>&gt;newtype ShowType a = ShowType a\nnewtype ShowType a = ShowType a\n&gt;instance Show (ShowType a) where show _ = \"The type is\"\n&gt;:set +t\n&gt;ShowType const\nThe type is\nit :: ShowType (a -&gt; b -&gt; a)\n</code></pre>\n\n<p>Unfortunately, this creates quite a lot of syntactic noise. My preferred solution is to add the following to the <code>.ghci</code> file:</p>\n\n<pre><code>:set +t \ninstance {-# OVERLAPS #-} Show a where show _ = \"The type is\"\n</code></pre>\n\n<p>Adding such a <code>Show</code> instance to any real Haskell module would be a grave mistake, but within the <code>.ghci</code> module, it only scopes over expressions typed into the prompt, so it seems okay to me. With this, you get:</p>\n\n<pre><code>&gt;const\nThe type is\nit :: a -&gt; b -&gt; a\n&gt;show\nThe type is\nit :: Show a =&gt; a -&gt; String\n</code></pre>\n\n<p>Conveniently, when you have a function whose type is 'technically' valid but has unsatisfiable constraints, you still get a type error:</p>\n\n<pre><code>&gt;:t \\x -&gt; x `div` (x / x)\n\\x -&gt; x `div` (x / x) :: (Integral a, Fractional a) =&gt; a -&gt; a\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n&gt;\\x -&gt; x `div` (x / x)\n\n&lt;interactive&gt;:12:1: error:\n    * Ambiguous type variable `a0' arising from a use of `it'\n      prevents the constraint `(Fractional a0)' from being solved.\n</code></pre>\n\n<hr>\n\n<p>However, the absolute simplest solution is to <code>:set +t</code> and to give a <code>let</code> statement when your expression is non-<code>Show</code>able: </p>\n\n<pre><code>&gt;let _f = show\n_f :: Show a =&gt; a -&gt; String\n</code></pre>\n\n<p>Unfortunately, if the left-hand side is the wildcard - <code>let _ = show</code> - then the type is not printed.</p>\n"}], "owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1482967102, "creation_date": 1482888772, "last_edit_date": 1482935752, "question_id": 41354231, "link": "https://stackoverflow.com/questions/41354231/how-can-i-set-up-haskells-ghci-to-interactively-evaluate-functions-to-their-sig", "title": "How can I set up Haskell&#39;s GHCI to interactively evaluate functions to their signature (type) instead of getting errors?", "body": "<p>To see the function's signature in Haskell GHCI, I have to prefix it with <code>:t</code>:</p>\n\n<pre><code>Prelude&gt; f = \\x -&gt; x+1\nPrelude&gt; :t f\nf :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>But typing that prefix every time grows quickly old. If I leave it out, I get error:</p>\n\n<pre><code>Prelude&gt; f\n\n&lt;interactive&gt;:5:1: error:\n\u2022 No instance for (Show (a0 -&gt; a0)) arising from a use of \u2018print\u2019\n    (maybe you haven't applied a function to enough arguments?)\n\u2022 In the first argument of \u2018print\u2019, namely \u2018it\u2019\n  In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Instead of getting this error message, I would like see some useful information about my function <code>f</code> similar to the one I get with <code>:t f</code> (possibly even more information about <code>f</code>).</p>\n\n<p>How can I set up the GHCI to achieve this functionality, i.e. getting function's info upon entering it without <code>:t</code>?</p>\n"}, {"tags": ["scala", "haskell", "monads"], "comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1482890071, "post_id": 41354194, "comment_id": 69910626, "body": "Your questions are not very clearly worded. Can you revise your post and make your questions easier to understand?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482890344, "post_id": 41354194, "comment_id": 69910676, "body": "Near-duplicate: <a href=\"http://stackoverflow.com/q/41310361/2751851\"><i>Monads, composition and the order of computation</i></a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482890715, "post_id": 41354194, "comment_id": 69910741, "body": "Also relevant: <a href=\"http://stackoverflow.com/a/28141248/2751851\">the second answer to <i>Why do we need monads?</i></a>"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 2, "creation_date": 1482913508, "post_id": 41354194, "comment_id": 69917603, "body": "Actually sequencing is possible for more general F-algebras. Think <code>foldl</code>. Monads are significant precisely because they can define more well-behaving T-algebras (like Kleisli algebras)."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 1, "creation_date": 1482913777, "post_id": 41354194, "comment_id": 69917713, "body": "So your instinct (whatever that is) is perhaps correct, sequencing of operations alone does not characterize monads."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1482920738, "post_id": 41354194, "comment_id": 69921376, "body": "In &quot;transparent&quot; monads, where you can access the underlying definition (e.g. state, reader, writer, continuation, list, maybe, ...), you could do everything without mentioning monads at all, and only using plain functions. The monad abstraction is however useful since it is a common ground for all these cases. It&#39;s more about convenience than necessity. In opaque monads like IO or ST, the library does not allow sequencing but through the monad interface, though."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482921382, "post_id": 41354194, "comment_id": 69921730, "body": "@chi: But if I remember correctly, IO and ST are just opaque state monads hiding the internal states. Hiding states is equally possible with F-algebras of the form F(F(a))-&gt;F(a)."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 2, "creation_date": 1482921732, "post_id": 41354194, "comment_id": 69921939, "body": "So if the true motivation of this question was &#39;are monads really necessary just for sequencing?&#39; then the answer is certainly no. A better question would be &#39;what kind of trouble would arise if IO were not a monad?&#39;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1482948693, "post_id": 41354194, "comment_id": 69936451, "body": "@mnish &quot;A better question would be &#39;what kind of trouble would arise if IO were not a monad?&#39;&quot; -- A recent duplicate for this interpretation of the question is <a href=\"http://stackoverflow.com/q/41096040/2751851\"><i>Why wrap an IO result in IO Monad</i></a>"}], "answers": [{"tags": [], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "is_accepted": true, "score": 3, "last_activity_date": 1482897771, "last_edit_date": 1482897771, "creation_date": 1482890469, "answer_id": 41354409, "question_id": 41354194, "link": "https://stackoverflow.com/questions/41354194/monad-vs-sequential-function-calls/41354409#41354409", "title": "Monad vs sequential function calls", "body": "<p>The <a href=\"https://wiki.haskell.org/All_About_Monads\" rel=\"nofollow noreferrer\">Haskell Monad Tutorial</a> clearly shows an example of sequencing function calls in a monadic fashion:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Sheep = ...\n\nfather :: Sheep -&gt; Maybe Sheep\nfather = ...\n\nmother :: Sheep -&gt; Maybe Sheep\nmother = ...\n\n-- comb is a combinator for sequencing operations that return Maybe\ncomb :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b\ncomb Nothing  _ = Nothing\ncomb (Just x) f = f x\n\n-- now we can use `comb` to build complicated sequences\nmothersPaternalGrandfather :: Sheep -&gt; Maybe Sheep\nmothersPaternalGrandfather s = (Just s) `comb` mother `comb` father `comb` father\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 41354409, "answer_count": 1, "score": 2, "last_activity_date": 1482897771, "creation_date": 1482888389, "last_edit_date": 1482888738, "question_id": 41354194, "link": "https://stackoverflow.com/questions/41354194/monad-vs-sequential-function-calls", "title": "Monad vs sequential function calls", "body": "<p>The <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)\" rel=\"nofollow noreferrer\">Wikipedia article on monads</a> says:</p>\n\n<blockquote>\n  <p>Purely functional programs can use monads to structure procedures that include sequenced operations like those found in structured programming.</p>\n</blockquote>\n\n<p>Not looking for an (another) monad tutorial here. Just please give an example of monad making sequenced operations possible when just running one function and then another is not enough. Is it somehow connected with those function calls being lazy per functional language specifications? Why sequential run of not-interchanged functions needs any \"wrapper\"?</p>\n"}, {"tags": ["haskell", "ghc", "liquid-haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1482884899, "post_id": 41352929, "comment_id": 69909696, "body": "Depends... the liquid haskell page says &quot;A modest subset of the language is currently supported <i>(monads recently included!\u2026)</i>&quot;, which tells me that anything that uses any new features (e.g. polykinds) is almost certainly not going to be supported.  But I it sounds like you are expecting LH to verify your dependencies, and I don&#39;t really think it&#39;s built for that. It&#39;s possible your own code could still be supported, depending on which features you use.  Anyway... sounds like you haven&#39;t even installed it yet?  Maybe start by toying around with it."}], "answers": [{"comments": [{"owner": {"reputation": 4215, "user_id": 7347933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/V8E3M.jpg?s=128&g=1", "display_name": "paper1111", "link": "https://stackoverflow.com/users/7347933/paper1111"}, "edited": false, "score": 0, "creation_date": 1504779145, "post_id": 46085554, "comment_id": 79148923, "body": "A link to a solution is welcome, but please ensure your answer is useful without it: <a href=\"//meta.stackexchange.com/a/8259\">add context around the link</a> so your fellow users will have some idea what it is and why it\u2019s there, then quote the most relevant part of the page you&#39;re linking to in case the target page is unavailable. <a href=\"//stackoverflow.com/help/deleted-answers\">Answers that are little more than a link may be deleted.</a>"}], "tags": [], "owner": {"reputation": 1152, "user_id": 729775, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/70ec20c66713dc2fe7ce050263961685?s=128&d=identicon&r=PG", "display_name": "Ranjit Jhala", "link": "https://stackoverflow.com/users/729775/ranjit-jhala"}, "is_accepted": false, "score": 1, "last_activity_date": 1504739292, "creation_date": 1504739292, "answer_id": 46085554, "question_id": 41352929, "link": "https://stackoverflow.com/questions/41352929/can-i-use-liquid-haskell-on-code-that-requires-ghc-8/46085554#46085554", "title": "Can I use Liquid Haskell on code that requires GHC 8?", "body": "<p>yes! You can -- LH supports GHC 8.0.2 now (not 8.2 yet...) You can build/run following the instructions here: </p>\n\n<p><a href=\"https://github.com/ucsd-progsys/liquidhaskell/blob/develop/INSTALL.md#build-with-stack-recommended\" rel=\"nofollow noreferrer\">https://github.com/ucsd-progsys/liquidhaskell/blob/develop/INSTALL.md#build-with-stack-recommended</a></p>\n"}], "owner": {"reputation": 523, "user_id": 1739395, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6877c2a0e8b24a4b4c9b4700d33846e?s=128&d=identicon&r=PG", "display_name": "the-konapie", "link": "https://stackoverflow.com/users/1739395/the-konapie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1504739292, "creation_date": 1482877480, "question_id": 41352929, "link": "https://stackoverflow.com/questions/41352929/can-i-use-liquid-haskell-on-code-that-requires-ghc-8", "title": "Can I use Liquid Haskell on code that requires GHC 8?", "body": "<p>I have a project that is build with stack and requires GHC 8. Is it possible to use Liquid Haskell with my project, given that it requires GHC 8? If so, how should I go about installing and executing Liquid Haskell?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 3, "creation_date": 1482869553, "post_id": 41351442, "comment_id": 69904881, "body": "Notice: <code>init a</code> is <i>O(length a)</i>, sort of expensive. It would be great to implement the sliding window so that moving it one item forth is constant time."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1482870430, "post_id": 41351442, "comment_id": 69905254, "body": "GHCi should not be used for anything performance related.  I suggest <code>ghc -O2</code> or <code>jhc</code>."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 2, "creation_date": 1482870827, "post_id": 41351442, "comment_id": 69905416, "body": "One way to do the sliding window is to pass in the first sum as a <code>Float</code>, pass in the original list (to be used to subtract from the current sum) and the original list with k entries dropped (to be used to add to the current sum). Then the next sum is the sum passed in minus the first element of the subtraction list plus the first element of the addition list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482908475, "post_id": 41351442, "comment_id": 69915479, "body": "Don&#39;t edit a question to change it so radically."}], "answers": [{"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 1, "last_activity_date": 1482877539, "last_edit_date": 1492087555, "creation_date": 1482877539, "answer_id": 41352939, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell/41352939#41352939", "title": "Computing Moving Average in Haskell", "body": "<p>Here's a solution for you.</p>\n\n<p>The idea is to scan <em>two</em> lists, one where the averaging window starts, and another where it ends. Getting a tail end of a list costs as much as scanning the part we're skipping, and we're not copying anything. (If the windows size was usually quite large, we could calculate the <code>remaining_data</code> along with counting the <code>sum initial_data</code>, in one go.)</p>\n\n<p>We generate a list of partial sums as described in my comment, then divide them by the windows width to get averages.</p>\n\n<p>While <code>slidingAverage</code> calculates averages for biased position (window width to the right), <code>centeredSlidingAverage</code> calculates centered averages, using half window width to the left and to the right.</p>\n\n<pre><code>import Data.List (splitAt, replicate)\n\nslidingAverage :: Int -&gt; [Int] -&gt; [Double] -- window size, source list -&gt; list of averages\nslidingAverage w xs = map divide $ initial_sum : slidingSum initial_sum xs remaining_data\n  where\n    divide = (\\n -&gt; (fromIntegral n) / (fromIntegral w))  -- divides the sums by window size\n    initial_sum = sum initial_data\n    (initial_data, remaining_data) = splitAt w xs\n\ncenteredSlidingAverage :: Int -&gt; [Int] -&gt; [Double] -- window size, source list -&gt; list of averages\ncenteredSlidingAverage w xs = slidingAverage w $ left_padding ++ xs ++ right_padding\n  where\n    left_padding = replicate half_width 0\n    right_padding = replicate (w - half_width) 0\n    half_width = (w `quot` 2)   -- quot is integer division\n\nslidingSum :: Int -&gt; [Int] -&gt; [Int] -&gt; [Int] -- window_sum before_window after_window -&gt; list of sums\nslidingSum _ _ [] = []\nslidingSum window_sum before_window after_window = new_sum : slidingSum new_sum new_before new_after\n  where\n    value_to_go = head before_window\n    new_before = tail before_window\n    value_to_come = head after_window\n    new_after = tail after_window\n    new_sum = window_sum - value_to_go + value_to_come\n</code></pre>\n\n<p>When I try <code>length $ slidingAverage 10 [1..1000000]</code>, it takes less than a second on my MBP. <a href=\"https://softwareengineering.stackexchange.com/q/294658/11732\">Due to the laziness</a>, <code>centeredSlidingAverage</code> takes about the same time.</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 9, "last_activity_date": 1534492290, "last_edit_date": 1534492290, "creation_date": 1482881201, "answer_id": 41353462, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell/41353462#41353462", "title": "Computing Moving Average in Haskell", "body": "<p>If you want to learn something new you can take a look at this nice solution for <em>Moving Average</em> problem. It is written by one of my students so I won't claim authorship. I really like it because it's very short. The only problem here is <code>average</code> function. Such functions are known to be bad. Instead you can use <a href=\"https://www.youtube.com/watch?v=6a5Ti0r8Q2s\" rel=\"nofollow noreferrer\"><em>Beautiful folds by Gabriel Gonzalez</em></a>. And yes, this function takes <em><strong>O(k)</strong></em> time (where <code>k</code> is size of window) for calculating average of window (I find it better because you can face floating point errors if you try to add only new element to window and subtract last). Oh, it also uses <code>State</code> monad :)</p>\n\n<pre><code>{-# LANGUAGE UnicodeSyntax #-}\n\nmodule MovingAverage where\n\nimport           Control.Monad       (forM)\nimport           Control.Monad.State (evalState, gets, modify)\n\nmoving :: Fractional a \u21d2 Int \u2192 [a] \u2192 [a]\nmoving n _  | n &lt;= 0 = error \"non-positive argument\"\nmoving n xs = evalState (forM xs $ \\x \u2192 modify ((x:) . take (n-1)) &gt;&gt; gets average) []\n  where\n    average xs = sum xs / fromIntegral n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "is_accepted": true, "score": 5, "last_activity_date": 1482897861, "last_edit_date": 1482897861, "creation_date": 1482882849, "answer_id": 41353651, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell/41353651#41353651", "title": "Computing Moving Average in Haskell", "body": "<p>Here is a straightforward list-based solution which is idiomatic and fast enough, though requires more memory.</p>\n\n<pre><code>import Data.List (tails)\n\nmavg :: Fractional b =&gt; Int -&gt; [b] -&gt; [b]\nmavg k lst = take (length lst-k) $ map average $ tails lst\n   where average = (/ fromIntegral k) . sum . take k\n</code></pre>\n\n<p>This solution allows to use any function instead of <code>average</code> in a moving window.</p>\n\n<p>The following solution is less universal but it is constant in space and seems to be the fastest one. </p>\n\n<pre><code>import Data.List (scanl')\n\nmavg :: Fractional b =&gt; Int -&gt; [b] -&gt; [b]\nmavg k lst = map (/ fromIntegral k) $ scanl' (+) (sum h) $ zipWith (-) t lst\n  where (h, t) = splitAt k lst \n</code></pre>\n\n<p>Finally, the solution which uses  a kind of Okasaki's persistent functional queue, to keep the moving window. It does make sense when dealing with streaming data, like conduits or pipes.</p>\n\n<pre><code>mavg k lst = map average $ scanl' enq ([], take k lst) $ drop k lst\n  where \n    average (l,r) = (sum l + sum r) / fromIntegral k\n\n    enq (l, []) x = enq ([], reverse l) x\n    enq (l, (_:r)) x = (x:l, r)\n</code></pre>\n\n<p>And as it was mentioned in comments to the original post, do not use <code>ghci</code> for profiling. For example, you won't be able to see any benefits of <code>scanl'</code> in <code>ghci</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 4254, "user_id": 931738, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/kUCou.jpg?s=128&g=1", "display_name": "patriques", "link": "https://stackoverflow.com/users/931738/patriques"}, "is_accepted": false, "score": 0, "last_activity_date": 1507363455, "creation_date": 1507363455, "answer_id": 46618036, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell/46618036#46618036", "title": "Computing Moving Average in Haskell", "body": "<p>One simple way of doing it that also uses O(n) complexity </p>\n\n<pre><code>movingAverage :: (Fractional a) =&gt; Int -&gt; [a] -&gt; [a]\nmovingAverage n _ | n &lt;= 0 = error \"non-positive argument\"\nmovingAverage n xs = fmap average $ groupBy n xs\n  where average xs' = sum xs' / fromIntegral (length xs')\n\ngroupBy :: Int -&gt; [a] -&gt; [[a]]\ngroupBy _ [] = []\ngroupBy n xs = go [] xs\n  where\n    go _ []      = []\n    go l (x:xs') = (x:t) : go (x:l) xs'\n      where t = take (n-1) l\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 7486296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db38d15b3aa887d6d46096589d72e609?s=128&d=identicon&r=PG&f=1", "display_name": "Vincent Hui", "link": "https://stackoverflow.com/users/7486296/vincent-hui"}, "is_accepted": false, "score": 0, "last_activity_date": 1547911198, "creation_date": 1547911198, "answer_id": 54268536, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell/54268536#54268536", "title": "Computing Moving Average in Haskell", "body": "<p>Another way is to use STUArray.</p>\n\n<pre><code>import           Data.Array.Unboxed\nimport           Data.Array.ST\nimport           Data.STRef\nimport           Control.Monad\nimport           Control.Monad.ST\n\nmovingAverage  :: [Double] -&gt; IO [Double]\nmovingAverage vals = stToIO $ do\n  let end = length vals - 1\n  myArray &lt;- newArray (1, end) 0 :: ST s (STArray s Int Double)\n  forM_ [1 .. end] $ \\i -&gt; do\n    let cval = vals !! i\n    let lval = vals !! (i-1)\n    writeArray myArray i ((cval + lval)/2)\n  getElems myArray\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 6013690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fac83083581a09a7372c6762773a9d96?s=128&d=identicon&r=PG&f=1", "display_name": "100001", "link": "https://stackoverflow.com/users/6013690/100001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1117, "favorite_count": 1, "accepted_answer_id": 41353651, "answer_count": 5, "score": 4, "last_activity_date": 1547911198, "creation_date": 1482868745, "last_edit_date": 1482908276, "question_id": 41351442, "link": "https://stackoverflow.com/questions/41351442/computing-moving-average-in-haskell", "title": "Computing Moving Average in Haskell", "body": "<p>I'm working on learning Haskell, so I tried to implement a moving average function. Here is my code:</p>\n\n<pre><code>mAverage :: Int-&gt; [Int] -&gt; [Float]\nmAverage x a = [fromIntegral k / fromIntegral x | k &lt;- rawAverage]\n    where\n    rawAverage = mAverage' x a a\n\n-- First list contains original values; second list contains moving average computations\nmAverage' :: Int -&gt; [Int] -&gt; [Int] -&gt; [Int]\nmAverage' 1 a b = b\nmAverage' x a b = mAverage' (x - 1) a' b'\n    where\n    a' = init a\n    b' = zipWith (+) a' (tail b)\n</code></pre>\n\n<p>where the user calls mAverage with a length for each average and the list of values (e.g. <code>mAverage 4 [1,2..100]</code>).</p>\n\n<p>However, when I run the code on the input <code>mAverage 4 [1,2..100000]</code>, I get that it takes 3.6 seconds in ghci (using <code>:set +s</code>) and uses a gigabyte of memory. This seems very inefficient to me, as the equivalent function takes a fraction of a second in Python. Is there some way that I could make my code more efficient?</p>\n"}, {"tags": ["list", "haskell", "elixir"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482869375, "post_id": 41351434, "comment_id": 69904781, "body": "[1] &quot;But that&#39;s doesn&#39;t match the specification&quot; -- In which way? (I suggest that you edit your question to mention that.) [2] While I&#39;m not familiar with Elixir, it feels quite awkward to make a string out of the <code>number</code> argument only so that you can use <code>String.duplicate</code>. You probably should look for a more direct way of implementing the function."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 9, "creation_date": 1482870496, "post_id": 41351434, "comment_id": 69905284, "body": "There&#39;s also <code>List.duplicate&#47;2</code>: <code>List.duplicate(5, 3) #=&gt; [5, 5, 5]</code>."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1482871944, "post_id": 41351434, "comment_id": 69905860, "body": "@Dogbert on <code>iex</code> <code>List.duplicate(7, 3)</code> is returns <code>&#39;\\a\\a\\a&#39;</code>, <code>List.duplicate(8, 3)</code> returns &#39;\\b\\b\\b&#39; and so on... is this it&#39;s expected behavior?"}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482872039, "post_id": 41351434, "comment_id": 69905897, "body": "@duplode absolutely, a more direct way of implementing the function is exactly what I want :)"}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 2, "creation_date": 1482872438, "post_id": 41351434, "comment_id": 69906063, "body": "@MarcusVin&#237;ciusMonteiro yes, <code>[7, 7, 7] == &#39;\\a\\a\\a&#39;</code>. See <a href=\"http://stackoverflow.com/questions/30037914/elixir-lists-interpreted-as-char-lists\" title=\"elixir lists interpreted as char lists\">stackoverflow.com/questions/30037914/&hellip;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1579785388, "post_id": 41351683, "comment_id": 105888141, "body": "Your first function fails on a simple case like <code>replicate(0, :foo)</code>."}], "tags": [], "owner": {"reputation": 4439, "user_id": 969451, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/01b9c940b49b441a3b4e9fc93611b48d?s=128&d=identicon&r=PG", "display_name": "raacer", "link": "https://stackoverflow.com/users/969451/raacer"}, "is_accepted": true, "score": 16, "last_activity_date": 1482873123, "last_edit_date": 1482873123, "creation_date": 1482869886, "answer_id": 41351683, "question_id": 41351434, "link": "https://stackoverflow.com/questions/41351434/elixir-generate-a-list-of-n-occurrences-of-a-given-argument-similar-to-haske/41351683#41351683", "title": "Elixir: generate a list of `n` occurrences of a given argument (similar to Haskell&#39;s replicate)", "body": "<pre class=\"lang-rb prettyprint-override\"><code>def replicate(n, x), do: for _ &lt;- 1..n, do: x\n</code></pre>\n\n<p>If you want the last case to return string then you should add definition for this type using guard, something like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def replicate(n, [x]) when is_integer(x), do: to_string(for _ &lt;- 1..n, do: x)\ndef replicate(n, x), do: for _ &lt;- 1..n, do: x\n\niex(1)&gt; replicate 3, 5\n[5, 5, 5]\niex(2)&gt; replicate 3, 'a'\n\"aaa\"\n</code></pre>\n\n<p>You can also use <a href=\"https://hexdocs.pm/elixir/String.html#duplicate/2\" rel=\"noreferrer\">String.duplicate/2</a> and <a href=\"https://hexdocs.pm/elixir/List.html#duplicate/2\" rel=\"noreferrer\">List.duplicate/2</a> as other suggested:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def replicate(n, x = [c]) when is_integer(c), do: String.duplicate(to_string(x), n)\ndef replicate(n, x), do: List.duplicate(x, n)\n</code></pre>\n\n<p>Also please note that Char list <code>'a'</code> and String <code>\"a\"</code> are <a href=\"http://elixir-lang.org/getting-started/binaries-strings-and-char-lists.html\" rel=\"noreferrer\">different things</a> in Elixir, so ensure you understand this correctly.</p>\n\n<p>And finally if this is not a home task then I'd suggest not to reinvent bicycle but directly use functions from String and List module, when possible.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 2642144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N86R6.jpg?s=128&g=1", "display_name": "Zhivko Chobanov", "link": "https://stackoverflow.com/users/2642144/zhivko-chobanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1582484187, "creation_date": 1582484187, "answer_id": 60365690, "question_id": 41351434, "link": "https://stackoverflow.com/questions/41351434/elixir-generate-a-list-of-n-occurrences-of-a-given-argument-similar-to-haske/60365690#60365690", "title": "Elixir: generate a list of `n` occurrences of a given argument (similar to Haskell&#39;s replicate)", "body": "<p>Building on previous answer, but avoiding the replicate(0, :foo) bug.</p>\n\n<p>def replicate(n, x), do: for i &lt;- 0..n, i > 0, do: x</p>\n"}], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4565, "favorite_count": 0, "accepted_answer_id": 41351683, "answer_count": 2, "score": 12, "last_activity_date": 1582484187, "creation_date": 1482868722, "question_id": 41351434, "link": "https://stackoverflow.com/questions/41351434/elixir-generate-a-list-of-n-occurrences-of-a-given-argument-similar-to-haske", "title": "Elixir: generate a list of `n` occurrences of a given argument (similar to Haskell&#39;s replicate)", "body": "<p>I want a <a href=\"http://elixir-lang.org/\" rel=\"noreferrer\">Elixir</a> function to generate a list of <code>n</code> occurrences of an argument, similar to <a href=\"http://zvon.org/other/haskell/Outputprelude/replicate_f.html\" rel=\"noreferrer\">Haskell's <code>replicate</code></a> function:</p>\n\n<pre><code>Input: replicate 3 5\n\nOutput: [5,5,5]\n\nInput: replicate 5 \"aa\"\n\nOutput: [\"aa\",\"aa\",\"aa\",\"aa\",\"aa\"]\n\nInput: replicate 5 'a'\n\nOutput: \"aaaaa\"\n</code></pre>\n\n<p>I have made a function to \"replicate\" an Integer <code>n</code>times:</p>\n\n<pre><code>import String\n\ndef replicate(number, n)\n  String.duplicate(to_string(number), n) \n  |&gt; split(\"\", trim: true) \n  |&gt; Enum.map(fn n -&gt; String.to_integer(n) end\nend\n</code></pre>\n\n<p>But that's doesn't match the specification :( . Could you help me?</p>\n"}, {"tags": ["haskell", "types", "typeclass", "quickcheck"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482865992, "post_id": 41350192, "comment_id": 69903429, "body": "Latest versions of QC support <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/Test-QuickCheck-Function.html\" rel=\"nofollow noreferrer\">functions</a> but you would have to change your type - <code>newtype Combine&#39; fun a b = Combine (fun a b); type Combine = Combine&#39; (-&gt;); type Combine_Test = Combine&#39; Fun</code> (or create a distinct type replicating the structure but replacing <code>-&gt;</code> with <code>Fun</code>)"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1482896063, "post_id": 41350192, "comment_id": 69911803, "body": "While for this example they want you to use <code>quickCheck</code> on the whole, reducing functions using lambda calculus can generally prove equality."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1482863736, "creation_date": 1482863736, "answer_id": 41350413, "question_id": 41350192, "link": "https://stackoverflow.com/questions/41350192/how-to-test-semigroup-law-for-this-data-type/41350413#41350413", "title": "How to test Semigroup law for this data type?", "body": "<p>Indeed it is not possible or at least not feasible, however you don't really need a test case with such a big argument type as <code>Int</code>!</p>\n\n<p>For smaller types, e.g. <code>Int16</code>, you can just exhaustively try all possible arguments to determine equality. The <a href=\"http://hackage.haskell.org/package/universe-1.0/docs/Data-Universe.html\" rel=\"nofollow noreferrer\">universe package</a> has a convenient class for that:</p>\n\n<pre><code>import Data.Universe\n\ninstance (Universe a, Eq b) =&gt; Eq (Combine a b) where\n  Combine f == Combine g = all (\\x -&gt; f x == g x) universe\n</code></pre>\n\n<p>Then your original check will work, albeit unacceptably slow; I'd recommend changing it to <code>quickCheck (semigroupAssoc :: CombineAssoc Int16 Bool)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "edited": false, "score": 0, "creation_date": 1483652718, "post_id": 41353825, "comment_id": 70196632, "body": "That&#39;s a really good answer! But please see my edit. It seems that the authors intended to use/make a CoArbitrary instance for this type and use it to test. But how?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "edited": false, "score": 0, "creation_date": 1484893695, "post_id": 41353825, "comment_id": 70706566, "body": "The hint is not suggesting making a <code>CoArbitrary (Combine a b)</code>, but rather using a <code>CoArbitrary a</code> instance to implement <code>Arbitrary (Combine a b)</code>. I implicitly use <code>CoArbitrary a</code> (on the argument type) when generating functions with <code>Fun</code> which is provided by the QuickCheck library, the hint is about how you can implement such a generator of functions."}, {"owner": {"reputation": 1169, "user_id": 997994, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8c11f523fb9ff0c4fb407bbda335234?s=128&d=identicon&r=PG", "display_name": "MnZrK", "link": "https://stackoverflow.com/users/997994/mnzrk"}, "edited": false, "score": 0, "creation_date": 1521982381, "post_id": 41353825, "comment_id": 85954579, "body": "Instead of <code>funEquality</code> function you can just use <code>=-=</code> operator from <code>Test.QuickCheck.Checkers</code> to compare any functions in the same way."}, {"owner": {"reputation": 1494, "user_id": 38967, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1d7612656bff189435e631cea343b246?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/38967/daniel"}, "edited": false, "score": 1, "creation_date": 1562876341, "post_id": 41353825, "comment_id": 100527457, "body": "I <i>think</i> <code>combineAssoc</code> is missing a <code>Semigroup b</code>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 10, "last_activity_date": 1562877545, "last_edit_date": 1562877545, "creation_date": 1482884516, "answer_id": 41353825, "question_id": 41350192, "link": "https://stackoverflow.com/questions/41350192/how-to-test-semigroup-law-for-this-data-type/41353825#41353825", "title": "How to test Semigroup law for this data type?", "body": "<p>You can't <strong>decide</strong> whether two functions are equal. But you can <strong>test</strong> it!</p>\n\n<p>Two functions are equal if and only if for any input they give the same output. This is a testable property: generate some inputs, compare the outputs. If they are different, you've got a counter-example.</p>\n\n<pre><code>-- Test.QuickCheck.(===) requires (Eq b, Show b)\n-- but you can use (==) if you prefer.\nfunEquality :: (Arbitrary a, Show a, Eq b, Show b) =&gt; Combine a b -&gt; Combine a b -&gt; Property\nfunEquality (Combine f) (Combine g) =\n  property $ \\a -&gt; f a === g a\n</code></pre>\n\n<p>Notice that the <code>Bool</code> result in the type of \"decidable equality\" <code>(==) :: X -&gt; X -&gt; Bool</code> is replaced with <code>Property</code> in what we might call \"testable equality\" <code>funEquality :: X -&gt; X -&gt; Property</code>. It's actually not necessary to use <code>property</code> and convert the function <code>a -&gt; Property</code> (or <code>a -&gt; Bool</code> if you use <code>(==)</code>) to <code>Property</code>, but the types look neater that way.</p>\n\n<p>We need to rewrite the function corresponding to the associativity property, since we no longer rely on <code>Eq</code>.</p>\n\n<pre><code>type CombineAssoc a b = Combine a b -&gt; Combine a b -&gt; Combine a b -&gt; Property\n\ncombineAssoc :: (Arbitrary a, Show a, Eq b, Show b, Semigroup b) =&gt; CombineAssoc a b\ncombineAssoc f g h = ((f &lt;&gt; g) &lt;&gt; h) `funEquality` (f &lt;&gt; (g &lt;&gt; h))\n</code></pre>\n\n<p>Edit: at this point we're actually still missing a <code>Show</code> instance for <code>Combine</code>. QuickCheck provides a wrapper <code>Fun</code> to both generate and show functions as counterexamples. </p>\n\n<pre><code>main = quickCheck $ \\(Fn f) (Fn g) (Fn h) -&gt;\n  (combineAssoc :: CombineAssoc Int Bool) (Combine f) (Combine g) (Combine h)\n</code></pre>\n"}], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 0, "accepted_answer_id": 41353825, "answer_count": 2, "score": 6, "last_activity_date": 1562877545, "creation_date": 1482862708, "last_edit_date": 1495540484, "question_id": 41350192, "link": "https://stackoverflow.com/questions/41350192/how-to-test-semigroup-law-for-this-data-type", "title": "How to test Semigroup law for this data type?", "body": "<p>I'm trying to solve the same exercise as <a href=\"https://stackoverflow.com/questions/39456716/how-to-write-semigroup-instance-for-this-data-type\">this other question</a> in Chapter 15 of <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">\"Haskell Programming from First Principles\"</a>. I've already made a Semigroup instance, and I'm having trouble writing the QuickCheck part of the exercise.</p>\n\n<p>A Semigroup instance should satisfy:</p>\n\n<pre><code>a &lt;&gt; (b &lt;&gt; c) == (a &lt;&gt; b) &lt;&gt; c\n</code></pre>\n\n<p>where <code>&lt;&gt;</code> is the Semigroup mappend.</p>\n\n<p>I have come up with the following:</p>\n\n<pre><code>import Data.Semigroup\nimport Test.QuickCheck\n\nsemigroupAssoc :: (Eq m, Semigroup m) =&gt; m -&gt; m -&gt; m -&gt; Bool\nsemigroupAssoc a b c = (a &lt;&gt; (b &lt;&gt; c)) == ((a &lt;&gt; b) &lt;&gt; c)\n\nnewtype Combine a b = Combine { unCombine :: (a -&gt; b) }\n\ninstance Semigroup b =&gt; Semigroup (Combine a b) where\n  (Combine f) &lt;&gt; (Combine g) = Combine (\\x -&gt; (f x) &lt;&gt; (g x))\n\ninstance CoArbitrary (Combine a b) where\n  coarbitrary (Combine f) = variant 0\n\ninstance (CoArbitrary a, Arbitrary b) =&gt; Arbitrary (Combine a b) where\n  arbitrary = do\n    f &lt;- arbitrary\n    return $ Combine f\n\ntype CombineAssoc a b = Combine a b -&gt; Combine a b -&gt; Combine a b -&gt; Bool\n\nmain :: IO ()\nmain = do\n  quickCheck (semigroupAssoc :: CombineAssoc Int Bool)\n</code></pre>\n\n<p>Everything compiles except for the <code>quickCheck</code> line, where it complains that there is <code>No instance for (Eq (Combine Int Bool)) arising from a use of \u2018semigroupAssoc\u2019</code>.</p>\n\n<p>I don't think there is a way to test if two arbitrary function are equal (the functions wrapped up by <code>Combine</code>), but the exercise text suggests that such a thing is possible.</p>\n\n<p>Any ideas on how I could make this work?</p>\n\n<p>EDIT:</p>\n\n<p>The authors give a hint for this exercise:</p>\n\n<blockquote>\n  <p>Hint: This function will eventually be applied to a single value\n  of type a. But you\u2019ll have multiple functions that can produce a\n  value of type b. How do we combine multiple values so we have\n  a single b? This one will probably be tricky! Remember that the\n  type of the value inside of Combine is that of a function. If you\n  can\u2019t figure out CoArbitrary, don\u2019t worry about QuickChecking\n  this one.</p>\n</blockquote>\n\n<p>@Li-yao Xia's answer seems to be the best answer. But shouldn't I use this CoArbitrary instance for something?</p>\n"}, {"tags": ["haskell", "compiler-construction", "ghc"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482856994, "post_id": 41348010, "comment_id": 69899413, "body": "It would probably be worth it expanding a little on statement #4."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1482856996, "post_id": 41348010, "comment_id": 69899415, "body": "Uhm... where are these statements taken from? It&#39;s hard if not impossible to answer these without proper context."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482863395, "post_id": 41348010, "comment_id": 69902358, "body": "&quot;ImpredicativeTypes would be hard to implement correctly&quot; ... ImpredicativeTypes is not implemented correctly now, nor has it ever been."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482869021, "post_id": 41348010, "comment_id": 69904643, "body": "I think I heard that RankN full type inference is undecidable (Rank2 already is, IIRC, but I have no references to cite). GHC implements RankN but relies on the user to annotate every polytyped variable with its polytype. It&#39;s not fully automatic."}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1482863186, "post_id": 41350273, "comment_id": 69902256, "body": "(If you see &quot;includes complete type conference&quot; as contained in &quot;correct&quot;, then 2 is false. If not, 3 is false.)"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1482863063, "creation_date": 1482863063, "answer_id": 41350273, "question_id": 41348010, "link": "https://stackoverflow.com/questions/41348010/reducing-impredicativetypes-to-rankntypes-with-cps/41350273#41350273", "title": "Reducing ImpredicativeTypes to RankNTypes with CPS", "body": "<p>None of them. The difficulty in using <code>ImpredicativeTypes</code> comes from not having type inference, requiring the user to provide explicit type signatures. You assume that since <code>RankNTypes</code> are widely used that type inference works in general for <code>RankNTypes</code>, but that's <a href=\"https://prime.haskell.org/wiki/RankNTypes\" rel=\"nofollow noreferrer\">not true</a>:</p>\n\n<blockquote>\n  <p>It is not possible to infer higher-rank types in general; type annotations must be supplied by the programmer in many cases.</p>\n</blockquote>\n"}], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 41350273, "answer_count": 1, "score": -2, "last_activity_date": 1482863063, "creation_date": 1482853140, "last_edit_date": 1482859819, "question_id": 41348010, "link": "https://stackoverflow.com/questions/41348010/reducing-impredicativetypes-to-rankntypes-with-cps", "title": "Reducing ImpredicativeTypes to RankNTypes with CPS", "body": "<p>Which of these four statements is false? </p>\n\n<ul>\n<li><code>newtype</code> and <code>data</code> definitions could be replaced by <code>type</code> constructions of <code>(-&gt;)</code> and <code>forall</code>.</li>\n<li><code>RankNTypes</code> is implemented correctly.</li>\n<li><code>ImpredicativeTypes</code> would be hard to implement correctly even if GADTs didn't exist.</li>\n<li>The first two statements refute the third.</li>\n</ul>\n\n<hr>\n\n<p>Edit: I'm surprised that wasn't clear. <code>data Maybe = Nothing | Just a</code> could be written as <code>type Maybe a = forall b. b -&gt; (a -&gt; b) -&gt; b</code>. <code>data [] a = [] | a : [a]</code> could be written as <code>type [] a = forall b. b -&gt; (a -&gt; b -&gt; b) -&gt; b</code>. (Compare to <code>maybe</code> and <code>foldr</code>.) The same thing ought to be possible for all <code>newtype</code> and <code>data</code> definitions, and is called continuation passing style (CPS).</p>\n\n<p>As far as I know, type inference for types that have deeply nested <code>forall</code>s and <code>(-&gt;)</code> is implemented correctly by <code>ghc</code> using the <code>RankNTypes</code> extension, but <code>ImpredicativeTypes</code>, which allows <code>forall</code>s even in arguments to type constructors other than <code>(-&gt;)</code>, is hopelessly broken.</p>\n\n<p>But couldn't you implement <code>ImpredicativeTypes</code> by translating all <code>data</code> and <code>newtype</code> types to their CPS forms, using <code>RankNTypes</code> machinery for inference and then translating back into <code>data</code>/<code>newtype</code> forms?</p>\n"}, {"tags": ["haskell", "dictionary", "key"], "comments": [{"owner": {"reputation": 1025, "user_id": 2026740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe3644e242eeabe917840ddd85204d1?s=128&d=identicon&r=PG", "display_name": "Daniel Corzo", "link": "https://stackoverflow.com/users/2026740/daniel-corzo"}, "edited": false, "score": 0, "creation_date": 1482851021, "post_id": 41347412, "comment_id": 69896676, "body": "Hello and welcome to StackOverflow. Please take some time to read the help page, especially the sections named <a href=\"http://stackoverflow.com/help/on-topic\">&quot;What topics can I ask about here?&quot;</a> and <a href=\"http://stackoverflow.com/help/dont-ask\">&quot;What types of questions should I avoid asking?&quot;</a>. And more importantly, please read <a href=\"http://meta.stackexchange.com/q/156810/204922\">the Stack Overflow question checklist</a>. You might also want to learn about <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Examples</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1482851884, "post_id": 41347412, "comment_id": 69897090, "body": "I somewhat disagree with the downvote. The question could show some more effort, but the task at hand is small enough to be described precisely in one sentence, as done above."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1482851650, "last_edit_date": 1482851650, "creation_date": 1482851293, "answer_id": 41347556, "question_id": 41347412, "link": "https://stackoverflow.com/questions/41347412/replace-keys-in-data-map/41347556#41347556", "title": "Replace keys in Data.Map", "body": "<p>As far as I can see,  there is no single library function which can perform this for you efficiently. However, you can roll your own doing something like this:</p>\n\n<pre><code>case M.lookup k0 myMap of\n   Nothing -&gt; myMap\n   Just e  -&gt; M.insert k1 e (M.delete k0 myMap)\n</code></pre>\n\n<p>This will require three map operations, costing O(log N) each.</p>\n\n<p>We can do it in two operations as follows:</p>\n\n<pre><code>case updateLookupWithKey (\\_ _ -&gt; Nothing) k0 myMap of\n   (Nothing, _    ) -&gt; myMap\n   (Just e, newMap) -&gt; M.insert k1 e newMap\n</code></pre>\n\n<p>I don't think this can be further improved, since when dealing with two distinct keys we need to access twice the underlying balanced search tree anyway.</p>\n"}], "owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 1, "accepted_answer_id": 41347556, "answer_count": 1, "score": 3, "last_activity_date": 1483618095, "creation_date": 1482850586, "last_edit_date": 1483618095, "question_id": 41347412, "link": "https://stackoverflow.com/questions/41347412/replace-keys-in-data-map", "title": "Replace keys in Data.Map", "body": "<p>If I have two keys k0 and k1, which are in the Data.Map M, how can I remove k0 from the map and replace k1 with k0?</p>\n\n<p>What would be the best approach to complete this task? I have tried to go through the documentation of Data.Map, but I have only been able to find functions which can change values.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1482800610, "creation_date": 1482800610, "answer_id": 41337789, "question_id": 41337704, "link": "https://stackoverflow.com/questions/41337704/how-to-extend-a-partial-record-selector/41337789#41337789", "title": "How to &quot;extend&quot; a (partial) record selector?", "body": "<p>No, and IMO such record selectors should never be introduced in the first place. I'd write this as</p>\n\n<pre><code>type \u211d = Float  -- Note that Double is usually more sensible\n\nnewtype S\u00b9 = S\u00b9 {\u03d1 :: \u211d}  -- in [-\u03c0, \u03c0[\nnewtype \u211dPlus = \u211dPlus {pos\u211d :: \u211d} -- in [0, \u221e[\n\ndata Complex = Polar \u211dPlus S\u00b9\n             | Rectangular \u211d \u211d\n         deriving Show\n</code></pre>\n\n<p>This way, there is no error potential in form of partial record selectors, and also no confusion what to unpack etc.. Even for such a \u201cnon-record type\u201d, you can write your own accessors, preferrably in lens form:</p>\n\n<pre><code>import Control.Lens\n\nr :: Lens' Complex \u211dPlus\nr = lens get set\n where get (Polar r _) = r\n       get (Rectangular x y) = \u211dPlus . sqrt $ x^2 + y^2\n       set (Polar _ \u03b8) r = Polar r \u03b8\n       set (Rectangular x y) (\u211dPlus r) = Rectangular (x * \u03b7) (y * \u03b7)\n        where \u03b7 = r / sqrt (x^2 + y^2)\n</code></pre>\n"}], "owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 41337789, "answer_count": 1, "score": 3, "last_activity_date": 1482800610, "creation_date": 1482799606, "question_id": 41337704, "link": "https://stackoverflow.com/questions/41337704/how-to-extend-a-partial-record-selector", "title": "How to &quot;extend&quot; a (partial) record selector?", "body": "<p><strong>NB:</strong> The type I define below is just a convenient example for the purposes of this question; I'm sure there's no any need for me to roll my own definition of complex numbers in Haskell.</p>\n\n<hr>\n\n<p>I don't know if I'm using the right terminology here, but the selector <code>r</code> below is ane example of what I mean by a \"partial\" record selector:</p>\n\n<pre><code>data Complex = Polar       { r :: Float, y :: Float }\n             | Rectangular { x :: Float, y :: Float }\n             deriving Show\n</code></pre>\n\n<p><code>r</code> is \"partial\" because it cannot be applied to <em>all</em> <code>Complex</code> values; e.g.</p>\n\n<pre><code>r $ Polar 3 0\n-- 3.0\n</code></pre>\n\n<p>...but</p>\n\n<pre><code>r $ Rectangular 3 0\n-- *** Exception: No match in record selector r\n</code></pre>\n\n<p>In this case, however, there's a sensible definition for <code>r $ Rectangular x y</code>, namely:</p>\n\n<pre><code>-- assuming {-# LANGUAGE RecordWildCards #-}\nr :: Complex -&gt; Float\nr Rectangular { .. } = sqrt $ (x * x) + (y * y)\n</code></pre>\n\n<p>GHCi rejects this definition of <code>r</code>, with a <code>multiple declarations of \u2018r\u2019</code> error.</p>\n\n<p>Is there a way to extend <code>r</code> so that it can be applied to <em>any</em> <code>Complex</code> value?</p>\n\n<hr>\n\n<p>Of course, I realize that I can define something like</p>\n\n<pre><code>-- assuming {-# LANGUAGE RecordWildCards #-}\nmodulus :: Complex -&gt; Float\nmodulus Polar       { .. } = r\nmodulus Rectangular { .. } = sqrt $ (x * x) + (y * y)\n</code></pre>\n\n<p>...but I want to know if it is possible to extend the already existing selector <code>r</code>.</p>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482794888, "post_id": 41337207, "comment_id": 69877326, "body": "<a href=\"http://stackoverflow.com/questions/40331179/how-to-automatically-parenthesize-arbitrary-haskell-expressions\">This will probably get you the solution</a>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1482795256, "creation_date": 1482795256, "answer_id": 41337298, "question_id": 41337207, "link": "https://stackoverflow.com/questions/41337207/unexpected-result-when-a-monoid-on-arrows-is-applied/41337298#41337298", "title": "Unexpected Result When a Monoid on Arrows is Applied", "body": "<p>Lets write that a bit more to the point:</p>\n\n<pre><code>xform = prepend \"&lt;\" &gt;&gt;&gt; append \"&gt;\" &lt;+&gt; prepend \"&lt;\" &gt;&gt;&gt; append \"&gt;\"\nxform' = (prepend \"&lt;\" &gt;&gt;&gt; append \"&gt;\") &lt;+&gt; (prepend \"&lt;\" &gt;&gt;&gt; append \"&gt;\")\n</code></pre>\n\n<p>Now <code>xform</code>, because <code>infixr 5 &lt;+&gt;</code> binds more tightly than <code>infixl 1 &gt;&gt;&gt;</code>, is parsed as</p>\n\n<pre><code>xform = prepend \"&lt;\" &gt;&gt;&gt; (append \"&gt;\" &lt;+&gt; prepend \"&lt;\") &gt;&gt;&gt; append \"&gt;\"\n</code></pre>\n\n<p>which as a diagram reads</p>\n\n<pre><code>                           \u250c\u2500append \"&gt;\"\u2500\u2500\u2510\n     \u2500\u2500\u2500\u2500\u2500\u2500prepend \"&lt;\"\u2500\u2500\u2500\u2500\u2500&lt;             +&gt;\u2550\u2550\u2550append \"&gt;\"\u2550\u2550\u2550\u2550\u2550\u25b6\n                           \u2514\u2500prepend \"&lt;\"\u2500\u2518\n</code></pre>\n\n<p>whereas <code>xform'</code> corresponds simply to</p>\n\n<pre><code>            \u250c\u2500prepend \"&lt;\"\u2500\u2500append \"&gt;\"\u2500\u2510\n     \u2500\u2500\u2500\u2500\u2500\u2500\u2500&lt;                         +&gt;\u2550\u2550\u2550\u2550\u25b6\n            \u2514\u2500prepend \"&lt;\"\u2500\u2500append \"&gt;\"\u2500\u2518\n</code></pre>\n\n<p>That should explain it.</p>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1482795983, "post_id": 41337313, "comment_id": 69877572, "body": "Thank you for your answer which is very clear. The graphs by @leftaroundabout clarified a lot too."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1482795774, "last_edit_date": 1482795774, "creation_date": 1482795448, "answer_id": 41337313, "question_id": 41337207, "link": "https://stackoverflow.com/questions/41337207/unexpected-result-when-a-monoid-on-arrows-is-applied/41337313#41337313", "title": "Unexpected Result When a Monoid on Arrows is Applied", "body": "<p>It's not clear from your question what you were expecting it to do.  If this answer still doesn't help, writing what you expect your code to do will help us understand how you're thinking.</p>\n\n<p>The arrow you are working with is <code>Kleisli []</code> -- that is, the arrow built on the list monad.  The list as a monad is a nondeterminism abstraction -- that is, lists behave like collections of possibilities. </p>\n\n<p>The <code>Kliesli [] a b</code> type is equivalent to <code>a -&gt; [b]</code>, treated as a monadic function, that is: it takes a single input and returns many possible outputs.</p>\n\n<p>What <code>&lt;+&gt;</code> does is transform the input by each of its arguments, then take the union of the possibilities.  So if you run the arrow:</p>\n\n<pre><code>arr id &lt;+&gt; arr reverse\n</code></pre>\n\n<p>with the input <code>\"hello\"</code>, then you will get two answers:</p>\n\n<pre><code>hello\nolleh\n</code></pre>\n\n<p>If you compose it with anything, each possibility will be composed:</p>\n\n<pre><code>prepend \"&lt;\" &gt;&gt;&gt; (arr id &lt;+&gt; arr reverse)\n</code></pre>\n\n<p>then you'll get</p>\n\n<pre><code>&lt;hello\nolleh&lt;\n</code></pre>\n\n<p>so each alternative of <code>&lt;+&gt;</code> is being considered \"in parallel\".  The reason the <code>&lt;</code> comes at the of the second line is because the input <code>arr reverse</code> is getting has already had <code>\"&lt;\"</code> prepended.  By contrast, if you did</p>\n\n<pre><code>(arr id &lt;+&gt; arr reverse) &gt;&gt;&gt; prepend \"&lt;\"\n</code></pre>\n\n<p>Then you get</p>\n\n<pre><code>&lt;hello\n&lt;olleh\n</code></pre>\n\n<p>Is this making sense why you get the output you did now?  </p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 41337298, "answer_count": 2, "score": 3, "last_activity_date": 1482795774, "creation_date": 1482794336, "last_edit_date": 1482795140, "question_id": 41337207, "link": "https://stackoverflow.com/questions/41337207/unexpected-result-when-a-monoid-on-arrows-is-applied", "title": "Unexpected Result When a Monoid on Arrows is Applied", "body": "<p>I have this simple \"arrows\":</p>\n\n<pre><code>main = do\n        let\n        -- arr :: (Arrow a) =&gt; (b -&gt; c) -&gt; a b c\n        -- (&gt;&gt;&gt;) :: Category cat =&gt; cat a b -&gt; cat b c -&gt; cat a c\n        -- (&lt;+&gt;) :: ArrowPlus a =&gt; a b c -&gt; a b c -&gt; a b c\n        -- infixr 5 &lt;+&gt;\n        -- infixr 1 &gt;&gt;&gt;\n        -- runKleisli :: Kleisli m a b -&gt; a -&gt; m b\n          prepend x = arr (x ++)\n          append  x = arr (++ x)\n\n          xform = (prepend \"&lt;\") &gt;&gt;&gt; (append \"&gt;\") &lt;+&gt; (prepend \"{\") &gt;&gt;&gt; (append \"}\")\n          xs = [\"foobar\"] &gt;&gt;= (runKleisli xform)\n        mapM_ putStrLn xs\n</code></pre>\n\n<p>The <code>&lt;+&gt;</code> returns:</p>\n\n<pre><code>&lt;foobar&gt;}\n{&lt;foobar}\n</code></pre>\n\n<p>and if I replace the <code>xform</code> with:</p>\n\n<pre><code>xform = ((prepend \"&lt;\") &gt;&gt;&gt; (append \"&gt;\")) &lt;+&gt; ((prepend \"{\") &gt;&gt;&gt; (append \"}\"))\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>&lt;foobar&gt;\n{foobar}\n</code></pre>\n\n<p>Why I get these 2 results? Even looking at <code>infixr</code>s (as comments in the code) doesn't really help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 1, "creation_date": 1482787149, "post_id": 41336345, "comment_id": 69875325, "body": "search by signature."}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "reply_to_user": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 0, "creation_date": 1482787185, "post_id": 41336345, "comment_id": 69875336, "body": "@KarolyHorvath I&#39;m sorry. I don&#39;t understand what you mean."}, {"owner": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 0, "creation_date": 1482787233, "post_id": 41336345, "comment_id": 69875353, "body": "<a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1482787275, "post_id": 41336345, "comment_id": 69875368, "body": "@EliSadoff Go to hoogle and search for the expected type signature of the function."}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "reply_to_user": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 3, "creation_date": 1482787288, "post_id": 41336345, "comment_id": 69875369, "body": "@KarolyHorvath I didn&#39;t find anything for the signature <code>[a] -&gt; [b] -&gt; [(Maybe a, Maybe b)]</code>, so I&#39;m guessing it does not exist."}], "answers": [{"comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 1, "creation_date": 1482790731, "post_id": 41336753, "comment_id": 69876325, "body": "Wow! <code>Or</code> is a better idea. Thank you so much!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1482795900, "post_id": 41336753, "comment_id": 69877557, "body": "It seems that <code>align</code> provides precisely the desired function already - <code>padZip  :: Align f =&gt; f a -&gt; f b -&gt; f (Maybe a, Maybe b)</code> - but as you say, <code>Or a b</code> expresses the intent better than <code>(Maybe a, Maybe b)</code> anyways."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482796089, "post_id": 41336753, "comment_id": 69877590, "body": "@user2407038 Well spotted. I have added that to the answer; thank you."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 39, "last_activity_date": 1482796052, "last_edit_date": 1482796052, "creation_date": 1482790014, "answer_id": 41336753, "question_id": 41336345, "link": "https://stackoverflow.com/questions/41336345/does-haskell-have-a-greedy-zip-one-preserving-all-elements/41336753#41336753", "title": "Does Haskell have a greedy zip (one preserving all elements)?", "body": "<p>A greedy zip can be neatly expressed through a non-exclusive disjunction type (as opposed to <code>Either</code>, which is an exclusive disjunction). Two popular packages offer that. One is the minimalist, dependency-free <a href=\"https://hackage.haskell.org/package/data-or-1.0.0.5/docs/Data-Or.html\" rel=\"noreferrer\"><em>data-or</em></a>:</p>\n\n<pre><code>GHCi&gt; import Data.Or\nGHCi&gt; :t zipOr\nzipOr :: [a] -&gt; [b] -&gt; [Or a b]\nGHCi&gt; zipOr [1, 2, 3] [4, 5]\n[Both 1 4,Both 2 5,Fst 3]\n</code></pre>\n\n<p>The other is <a href=\"https://hackage.haskell.org/package/these-0.7.3/docs/Data-Align.html\" rel=\"noreferrer\"><em>these</em></a>, which comes with lots of bells and whistles:</p>\n\n<pre><code>GHCi&gt; import Data.These \nGHCi&gt; import Data.Align\nGHCi&gt; :t align\nalign :: Align f =&gt; f a -&gt; f b -&gt; f (These a b)\nGHCi&gt; align [1, 2, 3] [4, 5]\n[These 1 4,These 2 5,This 3]\n</code></pre>\n\n<p>I believe <code>Or a b</code> and <code>These a b</code> express your intent better than <code>(Maybe a, Maybe b)</code> (the latter type includes <code>(Nothing, Nothing)</code>, which a greedy zip will never produce). Still, you can express your <code>zip'</code> using either <code>zipOrWith</code> from <code>Data.Or</code>...</p>\n\n<pre><code>import Data.Or\n\nzip' :: [a] -&gt; [b] -&gt; [(Maybe a, Maybe b)]\nzip' = zipOrWith $ \\xy -&gt; case xy of\n    Both x y -&gt; (Just x, Just y)\n    Fst x -&gt; (Just x, Nothing)\n    Snd y -&gt; (Nothing, Just y)\n</code></pre>\n\n<p>... or <code>alignWith</code> from <code>Data.Align</code>:</p>\n\n<pre><code>import Data.These\nimport Data.Align\n\nzip' :: Align f =&gt; f a -&gt; f b -&gt; f (Maybe a, Maybe b)\nzip' = alignWith $ \\xy -&gt; case xy of\n    These x y -&gt; (Just x, Just y)\n    This x -&gt; (Just x, Nothing)\n    That y -&gt; (Nothing, Just y)\n</code></pre>\n\n<p><code>Data.Align</code>, in fact, provides your function under the name of <a href=\"https://hackage.haskell.org/package/these-0.7.3/docs/Data-Align.html#v:padZip\" rel=\"noreferrer\"><code>padZip</code></a>.</p>\n"}], "owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 1, "accepted_answer_id": 41336753, "answer_count": 1, "score": 26, "last_activity_date": 1482798922, "creation_date": 1482786914, "last_edit_date": 1482798922, "question_id": 41336345, "link": "https://stackoverflow.com/questions/41336345/does-haskell-have-a-greedy-zip-one-preserving-all-elements", "title": "Does Haskell have a greedy zip (one preserving all elements)?", "body": "<p>I'm not exactly sure if my nomenclature is correct here, but I was wondering if there was a zip function in Haskell that was greedy. This means that if I had</p>\n\n<pre><code>a = [1, 2, 3]\nb = [4, 5]\nzip' a b\n#=&gt; [(Just 1, Just 4),(Just 2, Just 5),(Just 3, Nothing)]\n</code></pre>\n\n<p>...where <code>zip'</code> is the greedy zip function, it would return a list of tuples the length of the longer list, and where the longer list has an element, but the shorter list does not <code>Nothing</code> is put in the respective tuple position. I am not asking how to write this, but instead was wondering if this exists as a built-in.</p>\n\n<p>Here is my implementation (which is probably not great)</p>\n\n<pre><code>zip' :: [a] -&gt; [b] -&gt; [(Maybe a, Maybe b)]\nzip' (a:xs) [] = (Just a, Nothing) : zip' xs []\nzip' [] (b:ys) = (Nothing, Just b) : zip' [] ys\nzip' [] _ = []\nzip' (a:xs) (b:ys) = (Just a, Just b) : zip' xs ys\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1482783407, "post_id": 41335760, "comment_id": 69874335, "body": "Submitted as <a href=\"https://github.com/commercialhaskell/stack/issues/2876\" rel=\"nofollow noreferrer\">Stack issue 2876</a>."}, {"owner": {"reputation": 353, "user_id": 999007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/07686856841387b6f7e5ff05da35f105?s=128&d=identicon&r=PG", "display_name": "schoettl", "link": "https://stackoverflow.com/users/999007/schoettl"}, "edited": false, "score": 0, "creation_date": 1482792294, "post_id": 41335760, "comment_id": 69876749, "body": "That works! Thank you and +1 for submitting the bug."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1482782445, "creation_date": 1482782445, "answer_id": 41335760, "question_id": 41334608, "link": "https://stackoverflow.com/questions/41334608/how-to-build-a-program-depending-on-a-yesod-application/41335760#41335760", "title": "How to build a program depending on a Yesod application", "body": "<p>This isn't specific to adding a second executable; it happens even with a fresh <code>yesod-postgres</code> project with a single executable.</p>\n\n<p>Instead it appears to be a bug in Stack's <code>lts-6.27</code> package set (and possibly others?).  Here's a workaround.  In your <code>stack.yaml</code>, add the following extra-dep:</p>\n\n<pre><code>extra-deps:\n- yesod-persistent-1.4.0.6\n</code></pre>\n\n<p>and run <code>stack build</code>.  Then, a second <code>stack build</code> should run without rebuilding anything.</p>\n"}], "owner": {"reputation": 353, "user_id": 999007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/07686856841387b6f7e5ff05da35f105?s=128&d=identicon&r=PG", "display_name": "schoettl", "link": "https://stackoverflow.com/users/999007/schoettl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 41335760, "answer_count": 1, "score": 2, "last_activity_date": 1482782445, "creation_date": 1482774537, "last_edit_date": 1482781052, "question_id": 41334608, "link": "https://stackoverflow.com/questions/41334608/how-to-build-a-program-depending-on-a-yesod-application", "title": "How to build a program depending on a Yesod application", "body": "<p>I created a Yesod application using <code>stack new project yesod-postgres</code>. Beside the web application, I want to create another program which uses the same database model and database connection.</p>\n\n<p>I added a second <code>executable</code> section (a copy of the first) in the cabal file with a different name and <code>main-is: myprogram.hs</code>. I can now run <code>stack build &amp;&amp; stack exec myprogram</code> successfully.</p>\n\n<p>The problem is that the build always takes more than 1 minute:</p>\n\n<pre><code>$ stack build\nproject-0.0.0: unregistering\nyesod-persistent-1.4.0.6: configure\nyesod-persistent-1.4.0.6: build\nyesod-persistent-1.4.0.6: copy/register\nyesod-form-1.4.9: configure\nyesod-form-1.4.9: build\nyesod-form-1.4.9: copy/register\nyesod-auth-1.4.15: configure\nyesod-auth-1.4.15: build\nyesod-auth-1.4.15: copy/register\nyesod-1.4.3.1: configure\nyesod-1.4.3.1: build\nyesod-1.4.3.1: copy/register\nclassy-prelude-yesod-0.12.8: configure\nclassy-prelude-yesod-0.12.8: build\nclassy-prelude-yesod-0.12.8: copy/register\nproject-0.0.0: build\nPreprocessing library project-0.0.0...\nIn-place registering project-0.0.0...\nPreprocessing executable 'myprogram' for project-0.0.0...\nLinking .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/myprogram/myprogram ...\nPreprocessing executable 'project' for project-0.0.0...\nLinking .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/project/project ...\nproject-0.0.0: copy/register\nInstalling library in\n/home/jakob/projects/project/project/.stack-work/install/x86_64-linux/lts-6.27/7.10.3/lib/x86_6\n4-linux-ghc-7.10.3/project-0.0.0-1qruVQVcU0k2yXxF1Z1w7r\nInstalling executable(s) in\n/home/jakob/projects/project/project/.stack-work/install/x86_64-linux/lts-6.27/7.10.3/bin\nRegistering project-0.0.0...\nCompleted 6 action(s).\n</code></pre>\n\n<p>How can I speed up the build process? How can I prevent stack from rebuilding the yesod dependencies every time?</p>\n"}, {"tags": ["string", "haskell", "recursion", "tree", "suffix-tree"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482767824, "post_id": 41333083, "comment_id": 69869650, "body": "Your base case is the problem - I bet <code>insert&#39;</code> gets called with a <code>Leaf</code> at some point (just based on the error message and you data types)."}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482769523, "post_id": 41333083, "comment_id": 69870165, "body": "I&#39;ve been thinking about that too. However, after trying some variations I still haven&#39;t figured it out."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482781397, "post_id": 41333083, "comment_id": 69873790, "body": "You might want to use <code>Node [(Char, SuffixTree)]</code> instead, I have a hunch that it will simplify the logic greatly."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1482797756, "last_edit_date": 1482797756, "creation_date": 1482777782, "answer_id": 41335107, "question_id": 41333083, "link": "https://stackoverflow.com/questions/41333083/building-a-suffix-tree-by-inserting-each-suffix-in-haskell/41335107#41335107", "title": "Building a suffix tree by inserting each suffix in Haskell", "body": "<p>Here's how the problem is occurring.</p>\n\n<p>Let's say you're processing <code>buildTree \"nanny\"</code>.  After you've inserted the suffixes \"nanny\", \"anny\", and \"nny\", your tree looks like <code>t1</code> given by:</p>\n\n<pre><code>let t1 = Node t1_content\n    t1_content = [(\"n\",t2),(\"anny\",Leaf 1)]\n    t2 = Node [(\"ny\",Leaf 2),(\"anny\",Leaf 0)]\n</code></pre>\n\n<p>Next, you try to insert the prefix \"ny\":</p>\n\n<pre><code>insert (\"ny\", 3) t1\n= insert' (\"ny\", 3) t1 t1_content\n-- matches guard p == a with p=\"n\", r=\"y\", r'=\"\"\n= insert' (\"y\", 3) t2 t1_content\n</code></pre>\n\n<p>What you <em>intend</em> to do next is insert <code>(\"y\", 3)</code> into <code>t2</code> to yield:</p>\n\n<pre><code>Node [(\"y\", Leaf 3), (\"ny\",Leaf 2),(\"anny\",Leaf 0)])\n</code></pre>\n\n<p>Instead, what happens is:</p>\n\n<pre><code>insert' (\"y\", 3) t2 t1_content\n-- have s=\"y\", a=\"ny\", so p=\"\", r=\"y\", r'=\"ny\"\n-- which matches guard: null p\n= insert' (\"y\", 3) (Node [(\"anny\", Leaf 0)]) t1_content\n-- have s=\"y\", a=\"anny\", so p=\"\", r=\"y\", r'=\"anny\"\n-- which matches guard: null p\n= insert' (\"y\", 3) (Node []) t1_content\n= Node [(\"y\", Leaf 3), (\"n\",t2), (\"anny\",Leaf 1)]\n</code></pre>\n\n<p>and suffix \"y\" has been added to <code>t1</code> instead of <code>t2</code>.</p>\n\n<p>When you next try to insert suffix \"y\", the guard <code>p==a</code> case tries to insert <code>(\"y\",3)</code> into <code>Leaf 3</code> and you get a pattern error.</p>\n\n<p>The reason it works on <code>banana</code> is that you only ever insert a new node at the top level of the tree, so \"adding to t2\" and \"adding to t1\" are the same thing.</p>\n\n<p>I suspect you'll need to substantially rethink the structure of your recursion to get this working.</p>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482797223, "post_id": 41337194, "comment_id": 69877819, "body": "Thank you for your implementation. The idea behind this problem was to implement suffix tree construction in a brute-force, straightforward manner, so that&#39;s why it&#39;s using a non-optimal algorithm. It&#39;s great to have a more efficient alternative, though!"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482797939, "post_id": 41337194, "comment_id": 69877967, "body": "@David this is also the naive approach similar to what you are doing; not the optimal linear algorithm"}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482798385, "post_id": 41337194, "comment_id": 69878048, "body": "Right, sorry for the confusion. What I meant is that in a real world situation, it&#39;s nice to have a faster algorithm at your disposal."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1482794251, "creation_date": 1482794251, "answer_id": 41337194, "question_id": 41333083, "link": "https://stackoverflow.com/questions/41333083/building-a-suffix-tree-by-inserting-each-suffix-in-haskell/41337194#41337194", "title": "Building a suffix tree by inserting each suffix in Haskell", "body": "<p>You are using a <em>quadratic</em> algorithm; whereas optimally, suffix tree can be constructed in <em>linear</em> time. That said, sticking with the same algorithm, a possibly better approach would be to first build the (uncompressed) <em>suffix trie</em> (not tree) and then compress the resulting trie.</p>\n\n<p>The advantage would be that a suffix trie can be represented using <code>Data.Map</code>:</p>\n\n<pre><code>data SuffixTrie\n  = Leaf' Int\n  | Node' (Map (Maybe Char) SuffixTrie)\n</code></pre>\n\n<p>which makes manipulations both more efficient and easier than list of pairs. Doing so, you may also completely bypass common prefix calculations, as it comes out by itself:</p>\n\n<pre><code>import Data.List (tails)\nimport Data.Maybe (maybeToList)\nimport Control.Arrow (first, second)\nimport Data.Map.Strict (Map, empty, insert, insertWith, assocs)\n\ndata SuffixTree\n  = Leaf Int\n  | Node [(String, SuffixTree)]\n  deriving Show\n\ndata SuffixTrie\n  = Leaf' Int\n  | Node' (Map (Maybe Char) SuffixTrie)\n\nbuildTrie :: String -&gt; SuffixTrie\nbuildTrie s = foldl go (flip const) (init $ tails s) (length s) $ Node' empty\n  where\n  go run xs i (Node' ns) = run (i - 1) $ Node' tr\n    where tr = foldr loop (insert Nothing $ Leaf' (i - 1)) xs ns\n  loop x run = insertWith (+:) (Just x) . Node' $ run empty\n    where _ +: Node' ns = Node' $ run ns\n\nbuildTree :: String -&gt; SuffixTree\nbuildTree = loop . buildTrie\n  where\n  loop (Leaf' i) = Leaf i\n  loop (Node' m) = Node $ con . second loop &lt;$&gt; assocs m\n  con (Just x, Node [(xs, tr)]) = (x:xs, tr) -- compress single-child nodes\n  con n = maybeToList `first` n\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; buildTree \"banana\"\nNode [(\"a\",Node [(\"\",Leaf 5),\n                 (\"na\",Node [(\"\",Leaf 3),\n                             (\"na\",Leaf 1)])]),\n      (\"banana\",Leaf 0),\n      (\"na\",Node [(\"\",Leaf 4),\n                  (\"na\",Leaf 2)])]\n</code></pre>\n\n<p>similarly:</p>\n\n<pre><code>\\&gt; buildTree \"mississippi\"\nNode [(\"i\",Node [(\"\",Leaf 10),\n                 (\"ppi\",Leaf 7),\n                 (\"ssi\",Node [(\"ppi\",Leaf 4),\n                              (\"ssippi\",Leaf 1)])]),\n      (\"mississippi\",Leaf 0),\n      (\"p\",Node [(\"i\",Leaf 9),\n                 (\"pi\",Leaf 8)]),\n      (\"s\",Node [(\"i\",Node [(\"ppi\",Leaf 6),\n                            (\"ssippi\",Leaf 3)]),\n                 (\"si\",Node [(\"ppi\",Leaf 5),\n                             (\"ssippi\",Leaf 2)])])]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "is_accepted": false, "score": 2, "last_activity_date": 1482797982, "creation_date": 1482797982, "answer_id": 41337554, "question_id": 41333083, "link": "https://stackoverflow.com/questions/41333083/building-a-suffix-tree-by-inserting-each-suffix-in-haskell/41337554#41337554", "title": "Building a suffix tree by inserting each suffix in Haskell", "body": "<p>Looks like this code does the job, although there may still be improvements to make. I hope that it's general enough to work on any string. I also tried to avoid using <code>++</code>, but it's still better than nothing.</p>\n\n<pre><code>getContent (Node listOfPairs)\n  = listOfPairs\n\ninsert :: (String, Int) -&gt; SuffixTree -&gt; SuffixTree\ninsert (s, n) (Node [])\n  = Node [(s, Leaf n)]\ninsert (s, n) (Node (pair@(a, tree) : pairs))\n  | p == a   = Node ((a, insert (r, n) tree) : pairs)\n  | null p   = Node (pair : (getContent (insert (r, n) (Node pairs))))\n  | p /= a   = Node ([(p, Node [(r, Leaf n), (r', tree)])] ++ pairs)\n  where\n    (p, r, r') = partition s a\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "accepted_answer_id": 41337194, "answer_count": 3, "score": 3, "last_activity_date": 1482797982, "creation_date": 1482765077, "question_id": 41333083, "link": "https://stackoverflow.com/questions/41333083/building-a-suffix-tree-by-inserting-each-suffix-in-haskell", "title": "Building a suffix tree by inserting each suffix in Haskell", "body": "<p>I am working with the following data type:</p>\n\n<pre><code>data SuffixTree = Leaf Int | Node [(String, SuffixTree)] \n                deriving (Eq, Show)\n</code></pre>\n\n<p>Each subtree has a corresponding label (string).\nThe idea is to build the corresponding suffix tree by adding each suffix and its index into an accumulating tree (at the beginning it is <code>Node []</code>).</p>\n\n<p>This is already defined</p>\n\n<pre><code>buildTree s\n    = foldl (flip insert) (Node []) (zip (suffixes s) [0..length s-1]) \n</code></pre>\n\n<p>where <code>suffixes</code> is correctly defined.</p>\n\n<p>I've been trying to implement the <code>insert</code> function for a while but can't seem to succeed.</p>\n\n<p>This is what I have now (the names and style are not the best since this is still work in progress):</p>\n\n<pre><code>insert :: (String, Int) -&gt; SuffixTree -&gt; SuffixTree\ninsert pair tree@(Node content) \n  = insert' pair tree content\n  where\n    insert' :: (String, Int) -&gt; SuffixTree -&gt; [(String, SuffixTree)] -&gt; SuffixTree\n    insert' (s, n) (Node []) subtrees\n      = Node ((s, Leaf n) : subtrees)\n    insert' (s, n) (Node content@((a, tree) : pairs)) subtrees\n      | null p = insert' (s, n) (Node pairs) subtrees\n      | p == a = insert' (r, n) tree subtrees\n      | p /= a = Node ((p, newNode) : (subtrees \\\\ [(a, tree)]))\n      where\n        (p, r, r')  = partition s a\n        newNode     = Node [(r, (Leaf n)), (r', tree)]\n</code></pre>\n\n<p>The <code>partition</code> function takes two strings and returns a tuple consisting of:</p>\n\n<ol>\n<li>The common prefix (if it exists) </li>\n<li>The first string without the prefix</li>\n<li>The second string without the prefix</li>\n</ol>\n\n<p>I think I understand the rules needed to build the tree.</p>\n\n<p>We start by comparing the label of the first subtree to the string we want to insert (say, <code>str</code>). If they don't have a prefix in common, we try to insert in the next subtree.</p>\n\n<p>If the label is a prefix of <code>str</code>, we continue to look into that subtree, but instead of using <code>str</code> we try to insert <code>str</code> without the prefix.</p>\n\n<p>If <code>str</code> is a prefix of label, then we replace the existing subtree with a new <code>Node</code>, having a <code>Leaf</code> and the old subtree. We also adjust the labels.</p>\n\n<p>If we don't have a match between <code>str</code> and any label then we add a new <code>Leaf</code> to the list of subtrees.</p>\n\n<p>However, the biggest problem that I have is that I need to return a new tree containing the changes, so I have to keep track of everything else in the tree (not sure how to do this or if I'm thinking correctly about this).</p>\n\n<p>The code appears to be working correctly on this string: <code>\"banana\"</code>:</p>\n\n<pre><code>Node [(\"a\",Node [(\"\",Leaf 5),(\"na\",Node [(\"\",Leaf 3),(\"na\",Leaf 1)])]),\n(\"na\",Node [(\"\",Leaf 4),(\"na\",Leaf 2)]),(\"banana\",Leaf 0)]\n</code></pre>\n\n<p>However, on this string <code>\"mississippi\"</code> I get an <code>Exception: Non-exhaustive patterns in function insert'</code>.</p>\n\n<p>Any help or ideas are greatly appreciated!</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1482759514, "post_id": 41331625, "comment_id": 69866933, "body": "In the last <code>ujs</code> you are trying to run an RWST action without supplying it with a &quot;configuration&quot; and an initial state.  You are trying to do <code>ask</code> and <code>get</code> - which means you are producing an RWST block - but then to <i>run</i> an RWST block in the same action."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1482764589, "post_id": 41331625, "comment_id": 69868626, "body": "Don&#39;t use <code>unsafePerformIO</code>. It&#39;s unsafe."}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1482826179, "post_id": 41333072, "comment_id": 69884853, "body": "Thank you for your answer, but this is the main problem for me: where can I get config and state? There was a couple of ideas. Work continues."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1482838274, "post_id": 41333072, "comment_id": 69890663, "body": "Why don&#39;t you want add them explicitly?"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1482906760, "post_id": 41333072, "comment_id": 69914789, "body": "Thank you for your ideas. I implemented the function  <code>ujs :: HSL HLangJS HLangJS -&gt; HBConfig -&gt; HLangJS -&gt; HLangJS</code>. I reviewed the application architecture. Now the configuration and status passed to the function."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 2, "last_activity_date": 1482765014, "creation_date": 1482765014, "answer_id": 41333072, "question_id": 41331625, "link": "https://stackoverflow.com/questions/41331625/working-with-monad-transformer-rwst-in-haskell/41333072#41333072", "title": "Working with monad transformer RWST in Haskell", "body": "<p>First of all, I think your <code>HSL</code> type may be more better. <code>HSL</code> is monad but you've restricted it. The state type and monad \"value\" type may be different. Any time, you can restrict them.</p>\n\n<pre><code>type HSL l a = RWST HBConfig [HBLog] l IO a\n</code></pre>\n\n<p>or better:</p>\n\n<pre><code>type HSL l = RWST HBConfig [HBLog] l IO\n</code></pre>\n\n<p>Secondly, your <code>HSL</code> monad can have transformation <code>HSL l a -&gt; l</code> only with defaults values for config and initial state. If you want hide this parameters, you should think about where you can get them? For example, you can get it from IO:</p>\n\n<pre><code>ujs :: HSL l a -&gt; IO l\nujs act = do\n    config &lt;- ...\n    initState &lt;- ...\n    fst &lt;$&gt; execRWST act config initState\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "accepted_answer_id": 41333072, "answer_count": 1, "score": 1, "last_activity_date": 1482765014, "creation_date": 1482756839, "last_edit_date": 1482757195, "question_id": 41331625, "link": "https://stackoverflow.com/questions/41331625/working-with-monad-transformer-rwst-in-haskell", "title": "Working with monad transformer RWST in Haskell", "body": "<p>I am using the monad transformer RWST in a Haskell project. Below is my source code:</p>\n\n<pre><code>type HSL a = RWST HBConfig [HBLog] a IO a       \n\nrunScript :: (HLanguage a, BuilderHSL a) \n          =&gt; HBConfig\n          -&gt; HSL a\n          -&gt; String\nrunScript hbConf srcHSL =  \n    unsafePerformIO $ do\n        (_, s, log) &lt;- runRWST srcHSL hbConf initHLang\n        return $ buildHSL hbConf s \n</code></pre>\n\n<p>I implemented the function <code>HSL HLangJS -&gt; HLangJS</code> as shown below:</p>\n\n<pre><code>ujs :: HSL HLangJS -&gt; HLangJS\nujs srcHSL =  \n    unsafePerformIO $ do\n        (a, s, log) &lt;- runRWST srcHSL defaultHBConfig HLangJS\n        return a \n</code></pre>\n\n<p>Everything is working. BUT!!! I'm sure this is not the best solution!\nThe config and logs must be requested from transformer as shown in this code:</p>\n\n<pre><code>ujs :: HSL a -&gt; a\nujs rws = \n    unsafePerformIO $ liftIO $ do \n        c &lt;- ask\n        s &lt;- get\n        (a, _, _) &lt;- runRWST rws c s\n        return a\n</code></pre>\n\n<p>But this code is not working! How can I implement this?</p>\n"}, {"tags": ["haskell", "types", "automatic-differentiation", "autodiff"], "comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 2, "creation_date": 1482753418, "post_id": 41330431, "comment_id": 69864734, "body": "What happens if you provide a type signiture to timeAndGrad? You may have more luck with the rank-1 approach, too."}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "reply_to_user": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 0, "creation_date": 1482780647, "post_id": 41330431, "comment_id": 69873553, "body": "I edited my question to add a type signature and another approach (which also doesn&#39;t work)."}], "answers": [{"comments": [{"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "edited": false, "score": 0, "creation_date": 1482789010, "post_id": 41335652, "comment_id": 69875816, "body": "Yes, I do need to differentiate a function that&#39;s passed in as an argument. Can you explain a bit more what you mean by &quot;make that argument rank-2 polymorphic?&quot; I also tried switching to the rank-1 version of grad, and it requires me to specify that the function has type ([Forward a] -&gt; Forward a)."}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "edited": false, "score": 0, "creation_date": 1482789260, "post_id": 41335652, "comment_id": 69875889, "body": "The type does not allow a function with type (Num a =&gt; [a] -&gt; a) as you use here, but I am able to pass that in in the code. I&#39;m not sure why the types behave this way."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1482789821, "last_edit_date": 1482789821, "creation_date": 1482781616, "answer_id": 41335652, "question_id": 41330431, "link": "https://stackoverflow.com/questions/41330431/minimal-numeric-ad-example-wont-compile/41335652#41335652", "title": "minimal Numeric.AD example won&#39;t compile", "body": "<p>With <code>where f' = Lift . f . extractAll</code> you essentially create a back door into the automatic-differentiation underlying type that throws away all the derivatives and only keeps the constant-values. If you then use this for <code>grad</code>, it's hardly surprising that you get a zero result!</p>\n\n<p>The sensible way is to just use <code>grad</code> as it is:</p>\n\n<pre><code>dist :: Floating a =&gt; [a] -&gt; a\ndist [x, y] = sqrt $ x^2 + y^2\n-- preferrable is of course `dist = sqrt . sum . map (^2)`\n\nmain = print $ grad dist [1,2]\n-- output: [0.4472135954999579,0.8944271909999159]\n</code></pre>\n\n<p>You don't really need to know anything more complicated to use automatic differentiation. As long as you only differentiate <code>Num</code> or <code>Floating</code>-polymorphic functions, everything will work as-is. If you need to differentiate a function that's passed in as an argument, you need to make that argument rank-2 polymorphic (an alternative would be to switch to the rank-1 version of the <code>ad</code> functions, but I daresay that is less elegant and doesn't really gain you much).</p>\n\n<pre><code>{-# LANGUAGE Rank2Types, UnicodeSyntax #-}\n\nmainWith :: (\u2200n . Floating n =&gt; [n] -&gt; n) -&gt; IO ()\nmainWith f = print $ grad f [1,2]\n\nmain = mainWith dist\n</code></pre>\n"}], "owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 41335652, "answer_count": 1, "score": 1, "last_activity_date": 1482789821, "creation_date": 1482751041, "last_edit_date": 1482780594, "question_id": 41330431, "link": "https://stackoverflow.com/questions/41330431/minimal-numeric-ad-example-wont-compile", "title": "minimal Numeric.AD example won&#39;t compile", "body": "<p>I am trying to compile the following minimal example from Numeric.AD:</p>\n\n<pre><code>import Numeric.AD \ntimeAndGrad f l = grad f l\nmain = putStrLn \"hi\"\n</code></pre>\n\n<p>and I run into this error:</p>\n\n<pre><code>test.hs:3:24:\n    Couldn't match expected type \u2018f (Numeric.AD.Internal.Reverse.Reverse\n                                       s a)\n                                  -&gt; Numeric.AD.Internal.Reverse.Reverse s a\u2019\n                with actual type \u2018t\u2019\n      because type variable \u2018s\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      a type expected by the context:\n        Data.Reflection.Reifies s Numeric.AD.Internal.Reverse.Tape =&gt;\n        f (Numeric.AD.Internal.Reverse.Reverse s a)\n        -&gt; Numeric.AD.Internal.Reverse.Reverse s a\n      at test.hs:3:19-26\n    Relevant bindings include\n      l :: f a (bound at test.hs:3:15)\n      f :: t (bound at test.hs:3:13)\n      timeAndGrad :: t -&gt; f a -&gt; f a (bound at test.hs:3:1)\n    In the first argument of \u2018grad\u2019, namely \u2018f\u2019\n    In the expression: grad f l\n</code></pre>\n\n<p>Any clue as to why this is happening? From looking at previous examples I gather that this is \"flattening\" <code>grad</code>'s type:</p>\n\n<p><code>grad :: (Traversable f, Num a) =&gt; (forall s. Reifies s Tape =&gt; f (Reverse s a) -&gt; Reverse s a) -&gt; f a -&gt; f a</code></p>\n\n<p>but I actually need to do something like this in my code. In fact, this is the most minimal example that won't compile. The more complicated thing I want to do is something like this:</p>\n\n<pre><code>example :: SomeType\nexample f x args = (do stuff with the gradient and gradient \"function\")\n    where gradient = grad f x\n          gradientFn = grad f\n          (other where clauses involving gradient and gradient \"function\")\n</code></pre>\n\n<p>Here's a slightly more complicated version with type signatures that does compile. </p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Numeric.AD \nimport Numeric.AD.Internal.Reverse\n\n-- compiles but I can't figure out how to use it in code\ngrad2 :: (Show a, Num a, Floating a) =&gt; (forall s.[Reverse s a] -&gt; Reverse s a) -&gt; [a] -&gt; [a]\ngrad2 f l = grad f l\n\n-- compiles with the right type, but the resulting gradient is all 0s...\ngrad2' :: (Show a, Num a, Floating a) =&gt; ([a] -&gt; a) -&gt; [a] -&gt; [a]\ngrad2' f l = grad f' l\n       where f' = Lift . f . extractAll\n       -- i've tried using the Reverse constructor with Reverse 0 _, Reverse 1 _, and Reverse 2 _, but those don't yield the correct gradient. Not sure how the modes work\n\nextractAll :: [Reverse t a] -&gt; [a]\nextractAll xs = map extract xs\n           where extract (Lift x) = x -- non-exhaustive pattern match\n\ndist :: (Show a, Num a, Floating a) =&gt; [a] -&gt; a\ndist [x, y] = sqrt(x^2 + y^2)\n\n-- incorrect output: [0.0, 0.0]\nmain = putStrLn $ show $ grad2' dist [1,2]\n</code></pre>\n\n<p>However, I can't figure out how to use the first version, <code>grad2</code>, in code because I don't know how to deal with <code>Reverse s a</code>. The second version, <code>grad2'</code>, has the right type because I use the internal constructor <code>Lift</code> to create a <code>Reverse s a</code>, but I must not be understanding how the internals (specifically the parameter <code>s</code>) works, because the output gradient is all 0s. Using the other constructor <code>Reverse</code> (not shown here) also produces the wrong gradient.</p>\n\n<p>Alternatively, are there examples of libraries/code where people have used the <code>ad</code> code? I think my use case is a very common one.</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 0, "creation_date": 1482748891, "post_id": 41329783, "comment_id": 69863077, "body": "Sorry, I don&#39;t understand your point. I was expecting <code>hypotheticalLift</code> to just pass the second argument of the tuple as-is. It does not need to generate <code>c</code>, just like <code>Control.Arrow.first</code>."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 3, "creation_date": 1482755696, "post_id": 41329783, "comment_id": 69865560, "body": "That means it would have to consume one <code>c</code> from upstream for each <code>c</code> sent downstream. When you want to <code>yield</code> a <code>b</code>, do you put it into a queue that might become arbitrarily large until <code>await</code>ing an <code>a</code> gives you a <code>c</code> as a side effect, or do you immediately <code>await</code> and put the <code>a</code> into a queue until you need it? When you <code>await</code> an <code>a</code>, do you put the accompanying <code>c</code> into a queue that might become arbitrarily large?"}, {"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1482792233, "post_id": 41329783, "comment_id": 69876733, "body": "@Gurkenglas , oh, now I understand that. Thank you."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1482747850, "creation_date": 1482747850, "answer_id": 41329783, "question_id": 41329537, "link": "https://stackoverflow.com/questions/41329537/lifting-a-pipe-to-work-on-tuples/41329783#41329783", "title": "Lifting a pipe to work on tuples", "body": "<p>I don't think it's possible in general. Suppose we did manage to write it:</p>\n\n<pre><code>hypotheticalLift :: Pipe a b m r -&gt; Pipe (a, c) (b, c) m r\n</code></pre>\n\n<p>What behavior should <code>hypotheticalLift (yield b)</code> have? Presumably it should be the same as <code>yield (b, c)</code> for some <code>c</code> -- but which <code>c</code>, and why?</p>\n"}], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 41329783, "answer_count": 1, "score": 1, "last_activity_date": 1482747850, "creation_date": 1482746751, "question_id": 41329537, "link": "https://stackoverflow.com/questions/41329537/lifting-a-pipe-to-work-on-tuples", "title": "Lifting a pipe to work on tuples", "body": "<p>I need a function with type <code>Pipe a b m r -&gt; Pipe (a, c) (b, c) m r</code>.</p>\n\n<p>But no matter how much I play with <code>for</code>, <code>~&gt;</code> or <code>&gt;~</code>; I can not match the types properly.</p>\n\n<p>Can you help me?</p>\n"}, {"tags": ["haskell", "tuples", "functor", "lifting"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482735993, "post_id": 41327198, "comment_id": 69858718, "body": "On your side questions: (1) <code>:t (&lt;$&gt;) f</code> (prefix syntax) and <code>:t (f &lt;$&gt;)</code> (section syntax) would work. (2) With GHC 8, you can also turn on the <code>TypeApplications</code> extension and specialise <code>(&lt;$&gt;)</code> to pairs with <code>:t (&lt;$&gt;) @((,) _) f</code> (3) Going to <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor.html#t:Functor\" rel=\"nofollow noreferrer\">the definition of the class</a> and looking at the instances listed there can help with questions about (possibly existing) instances (in this case, you will find <code>Functor ((,) a)</code> but nothing for larger tuples)."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482743411, "post_id": 41327198, "comment_id": 69860808, "body": "@duplode Thanks, this works, but I still don&#39;t understand how larger tuples are different. Can&#39;t you apply the function to the last argument exactly the same way?"}], "answers": [{"comments": [{"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482745667, "post_id": 41329202, "comment_id": 69861647, "body": "An oversight?? You mean they simply forgot to take care of tuples of length greater than 2??"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 1, "creation_date": 1482746001, "post_id": 41329202, "comment_id": 69861807, "body": "@DmitriZaitsev When you have built a system as big as GHC without forgetting any details, you can put a third question mark in each question. =)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482746547, "post_id": 41329202, "comment_id": 69862064, "body": "@DmitriZaitsev Creating new data types is cheap and <a href=\"http://stackoverflow.com/q/19072930/791604\">encouraged</a>, so anonymous types like tuples and <code>Either</code>s are not as important as they might be in other languages. And again, I think it is unfair to use language like &quot;introducing inconsistency&quot;, which sort of suggests malice on the part of the software authors, when the reality is much more likely &quot;not noticing inconsistency&quot;, which is just the natural conclusion of a 25-year project that is the work of many authors from all across the globe."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482748400, "post_id": 41329202, "comment_id": 69862873, "body": "Can introducing and managing a new type be as simple and effortless and with less code than writing an anonymous triple, especially if you rarely use it? It is quite possible that there is a more substantial reason that we both don&#39;t know, rather than a plain oversight that indeed would be hard to imagine for this 25-year project."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 2, "creation_date": 1482773127, "post_id": 41329202, "comment_id": 69871257, "body": "@DmitriZaitsev Like Daniel Wagner, I also suspect it is an oversight which arose out of the relative rarity of use cases for the instances for larger tuples. Here is a <a href=\"https://mail.haskell.org/pipermail/libraries/2016-January/026579.html\" rel=\"nofollow noreferrer\">discussion about adding the instances</a> in the libraries mailing list earlier this year. Reading it shows that some people dislike the tuple instances because it is supposedly arbitrary and confusing that they only work with the last type parameter. (For what it&#39;s worth, I disagree: it is the only instance the language makes possible, so it isn&#39;t arbitrary.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1482797338, "post_id": 41329202, "comment_id": 69877841, "body": "In my opinion, the oversight was making <code>n</code> tuples distinct types for every <code>n</code> - because of this, GHC technically has not ever conformed to the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-360003.8\" rel=\"nofollow noreferrer\">Haskell standard</a> in its entirety - which explicitly says &quot;Tuples are written (e1, \u2026, ek), and may be of <b>arbitrary length</b> k \u2265 2&quot;. I suppose this design choice was made for performance reasons (a 10-tuple is one constructor instead of 9 constructors) - but the common wisdom is that the appearence of a large tuple in your program is a design error in and of itself."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482835297, "post_id": 41329202, "comment_id": 69889149, "body": "@duplode Thanks, interesting read but disappointingly lengthy discussion seemingly not arriving to any decision. Couldn&#39;t see any convincing argument against allowing long tuples, there is obvious interest and use cases from some folks... I am literally buffled"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1482858748, "post_id": 41329202, "comment_id": 69900238, "body": "@user2407038 IMO, <i>n</i>-tuple expressions <code>(a,b,c,...,\u03c8,\u03c9)</code> should just be syntactic sugar for <code>(((...((a,b),c),...),\u03c8),\u03c9)</code>, then we&#39;d never need to worry about tuples with arity &gt;2. Of course this would incur quite a bit of extra performance penalty unless tuples were made strict-unboxed by default (which might also be a good thing anyway)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1482859142, "post_id": 41329202, "comment_id": 69900428, "body": "Regardless, I&#39;m ambivalent whether even the <code>(a,)</code> functor instance was ever a clever idea \u2013 arguably it would be better to just use <code>Writer</code> to get access to that functor, that would avoid any confusion as to \u201cwhich element do we map over?\u201d and \u201cwhy is <code>length (10,20) \u2261 1</code>?\u201d."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1482745277, "creation_date": 1482745277, "answer_id": 41329202, "question_id": 41327198, "link": "https://stackoverflow.com/questions/41327198/applying-lifted-functions-to-tuples-of-arbitrary-length-in-haskell/41329202#41329202", "title": "Applying lifted functions to tuples (of arbitrary length) in Haskell", "body": "<p>One could (and arguably, GHC should) define a Functor instance for triples and larger tuples. To wit:</p>\n\n<pre><code>instance Functor ((,,) a b) where\n    fmap f (a, b, c) = (a, b, f c)\n</code></pre>\n\n<p>If this instance truly doesn't exist anywhere in <code>base</code>, I suspect that's mostly oversight, though I don't know the history well enough to say for sure. You can include this in any code where it seems useful, with the caveat that you should then <em>absolutely</em> put a fairly strict upper bound on the version of <code>base</code> in your <code>*.cabal</code> file, as this instance might reasonably be included in future versions of <code>base</code>. <a href=\"http://pvp.haskell.org/\" rel=\"nofollow noreferrer\">The PVP</a> allows only the third component of the version to change in such a case, so include at least that many components in your upper bound!</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482745871, "post_id": 41329299, "comment_id": 69861749, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Product.html\" rel=\"nofollow noreferrer\">Product Identity Identity</a>"}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482746477, "post_id": 41329299, "comment_id": 69862035, "body": "I understand that the combinators are more general, in which they pass to the individual lift implementation. My question here is more about the specific implementation for tuples (of any length), and I could not find any information about it when checking that link."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1482745960, "last_edit_date": 1482745960, "creation_date": 1482745747, "answer_id": 41329299, "question_id": 41327198, "link": "https://stackoverflow.com/questions/41327198/applying-lifted-functions-to-tuples-of-arbitrary-length-in-haskell/41329299#41329299", "title": "Applying lifted functions to tuples (of arbitrary length) in Haskell", "body": "<blockquote>\n  <p>Is there any explanation for why a lifted function, when applied to 2-tuple, only applies to the 2nd entry</p>\n</blockquote>\n\n<p>Because tuples are <em>heterogeneous</em> which means that, in general, it would not make sense to try to apply a function of type <code>b -&gt; c</code> to each component of a tuple of type <code>(a, b)</code>.</p>\n\n<p>If you want <em>pairs</em> of values of the same type, you can declare your own type <code>Pair</code> and then have the functor instance apply the function to each component.</p>\n\n<pre><code>data Pair a = Pair { fst :: a\n                   , snd :: a }\n\ninstance Functor Pair where\n  fmap f (Pair fst snd) = Pair (f fst) (f snd)\n</code></pre>\n\n<blockquote>\n  <p>Is it possible to see the type of <code>f &lt;$&gt;</code> when acting on tuples?</p>\n</blockquote>\n\n<p><code>f &lt;$&gt;</code> is a <em>section</em> (a partially applied infix operator). To get its type, you need to wrap it with parentheses like so:</p>\n\n<pre><code>:t (f &lt;$&gt;)\n</code></pre>\n\n<blockquote>\n  <p>The Data.Tuple documentation is extremely brief and has no mention of how functions are lifted to tuples. Is there any source explaining it?</p>\n</blockquote>\n\n<p>The combinator <code>(&lt;$&gt;)</code> (and <code>(&lt;*&gt;)</code>) are more general than just for tuples, you can find them in the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\">Control.Applicative</a> module.</p>\n"}, {"comments": [{"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482835787, "post_id": 41334768, "comment_id": 69889416, "body": "&quot;no such thing happens with pairs because there is a Functor ((,) a) instance in base)&quot; - now I am losing the line, aren&#39;t we looking for why the base only treated 2-tuples in first place?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482856406, "post_id": 41334768, "comment_id": 69899158, "body": "@DmitriZaitsev What I meant is that, since pairs do have a <code>Functor</code> instance, the type of <code>(&lt;$&gt;) @((,) _)</code> requires no extra constraints to demand that <code>((,) a)</code> is a functor. For a somewhat more implausible example of &quot;speculative constraint&quot; in the sense I used above, try <code>:t negate []</code> in GHCi."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482891329, "post_id": 41334768, "comment_id": 69910883, "body": "Thank you for clarifying, but I still feel this shows that &quot;F(x) behaves differently from F(y) because x behaves different from y&quot;. That is, in your example, the interpretation for triples is (inconsistently) different than pairs, which causes the (messy?) differences further down the line. Instead, wouldn&#39;t having a consistent behaviour for all tuples remove this problem?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482892650, "post_id": 41334768, "comment_id": 69911142, "body": "@DmitriZaitsev It is indeed inconsistent. My answer is merely describing the <i>status quo</i> -- I believe it would be a good thing to have instances for <i>n</i>-tuples up to  a sufficiently large <i>n</i>. (Cf. user2407038 and leftaroundabout&#39;s comments to Daniel Wagner&#39;s answer for a more radical interpretation of &quot;consistent behaviour for all tuples&quot;.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1482855946, "last_edit_date": 1495542896, "creation_date": 1482775576, "answer_id": 41334768, "question_id": 41327198, "link": "https://stackoverflow.com/questions/41327198/applying-lifted-functions-to-tuples-of-arbitrary-length-in-haskell/41334768#41334768", "title": "Applying lifted functions to tuples (of arbitrary length) in Haskell", "body": "<p>In this answer, I will just expand a bit on one of the suggestions I made in a comment.</p>\n\n<blockquote>\n  <p>Is it possible to see the type of <code>f &lt;$&gt;</code> when acting on tuples?</p>\n</blockquote>\n\n<p><code>(&lt;$&gt;)</code> is a polymorphic function:</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;)\n(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>With GHC 8, you can use the <code>TypeApplications</code> extension to specialise polymorphic functions by supplying instantiations of some or all of their type variables (in this case, <code>f</code>, <code>a</code> and <code>b</code>, in that order):</p>\n\n<pre><code>GHCi&gt; :set -XTypeApplications \nGHCi&gt; :t (&lt;$&gt;) @Maybe\n(&lt;$&gt;) @Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nGHCi&gt; :t (&lt;$&gt;) @Maybe @Int\n(&lt;$&gt;) @Maybe @Int :: (Int -&gt; b) -&gt; Maybe Int -&gt; Maybe b\nGHCi&gt; :t (&lt;$&gt;) @Maybe @_ @Bool\n(&lt;$&gt;) @Maybe @_ @Bool :: (t -&gt; Bool) -&gt; Maybe t -&gt; Maybe Bool\nGHCi&gt; :t (&lt;$&gt;) @_ @Int @Bool\n(&lt;$&gt;) @_ @Int @Bool\n  :: Functor t =&gt; (Int -&gt; Bool) -&gt; t Int -&gt; t Bool\nGHCi&gt; :t (&lt;$&gt;) @Maybe @Int @Bool\n(&lt;$&gt;) @Maybe @Int @Bool :: (Int -&gt; Bool) -&gt; Maybe Int -&gt; Maybe Bool\n</code></pre>\n\n<p>To use that with pairs, use the prefix syntax for the pair type constructor:</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;) @((,) _)\n(&lt;$&gt;) @((,) _) :: (a -&gt; b) -&gt; (t, a) -&gt; (t, b)\nGHCi&gt; -- You can use the specialised function normally.\nGHCi&gt; -- That includes passing arguments to it.\nGHCi&gt; f x = x + 1\nGHCi&gt; :t (&lt;$&gt;) @((,) _) f\n(&lt;$&gt;) @((,) _) f :: Num b =&gt; (t, b) -&gt; (t, b)\n</code></pre>\n\n<p>The <code>_</code> in <code>((,) _)</code> leaves it unspecified what the type of the first element of the pair (which is the first argument of the <code>(,)</code> type constructor) should be. Every choice of it gives rise to a different <code>Functor</code>. You can be more specific if you wish:</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;) @((,) String) f\n(&lt;$&gt;) @((,) String) f :: Num b =&gt; (String, b) -&gt; (String, b)\n</code></pre>\n\n<p>Lastly, it is worth having a look at what happens if you try that with 3-tuples:</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;) @((,,) _ _) f\n(&lt;$&gt;) @((,,) _ _) f\n  :: (Num b, Functor ((,,) t t1)) =&gt; (t, t1, b) -&gt; (t, t1, b)\n</code></pre>\n\n<p>As Daniel Wagner discusses in <a href=\"https://stackoverflow.com/a/41329202/2751851\">his answer</a>, <em>base</em> doesn't define a <code>Functor</code> instance for 3-tuples. In spite of that, the type checker cannot exclude the possibility that someone somewhere might have defined an instance specific for some choice of the first two type parameters, however pointless that would be. For that reason, the speculative constraint <code>Functor ((,,) t t1)</code> shows up in the type (no such thing happens with pairs because there is a <code>Functor ((,) a)</code> instance in <em>base</em>). As expected, that blows up as soon as we try to instantiate the first two type parameters:</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;) @((,,) Bool String) f\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 Could not deduce (Functor ((,,) Bool String))\n        arising from a use of \u2018&lt;$&gt;\u2019\n      from the context: Num b\n        bound by the inferred type of\n                 it :: Num b =&gt; (Bool, String, b) -&gt; (Bool, String, b)\n        at &lt;interactive&gt;:1:1\n    \u2022 In the expression: (&lt;$&gt;) @((,,) Bool String) f\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1482789589, "post_id": 41336480, "comment_id": 69875981, "body": "From some of the other discussion, including references to mailing list threads, it looks like maybe this wasn&#39;t the motivation.  I just always assumed it was."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1482836033, "post_id": 41336480, "comment_id": 69889559, "body": "Thank you for trying to find an explanation, but is the fact that 2-tuples are isomorphic to another monad where n-tuples for n&gt;2 are not, a sufficient reason to justify making the general behaviour for n-tuples different from 2-tuples?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1482788522, "last_edit_date": 1482788522, "creation_date": 1482788046, "answer_id": 41336480, "question_id": 41327198, "link": "https://stackoverflow.com/questions/41327198/applying-lifted-functions-to-tuples-of-arbitrary-length-in-haskell/41336480#41336480", "title": "Applying lifted functions to tuples (of arbitrary length) in Haskell", "body": "<p>All the other answers here seem pretty good, but I don't think anyone precisely answered your question yet.</p>\n\n<p>I believe the <strong>reason</strong> 2-tuples (and no other tuples) are treated this way by default is because this allows them to be used in the same way as a <code>Writer</code> in a monadic context.  (That is, <code>((,) a)</code> and <code>Writer</code> are isomorphic.)</p>\n\n<p>For example, given a function running in a <code>Writer</code> monad:</p>\n\n<pre><code>import Control.Monad.Writer\n\nfoo :: Int -&gt; Writer [String] Int\nfoo n = do tell [\"Running foo \" ++ show n]\n           if (n &lt;= 0) then do\n             tell [\"We are done!\"]\n             return 1\n           else do\n             rest &lt;- foo (n-1)\n             return (n * rest)\n</code></pre>\n\n<p>you can rewrite it using the <code>Monad</code> instance of <code>((,) a)</code>:</p>\n\n<pre><code>bar :: Int -&gt; ([String], Int)\nbar n = do tell' [\"Running bar \" ++ show n]\n           if (n &lt;= 0) then do\n             tell' [\"We are done!\"]\n             return 1\n           else do\n             rest &lt;- bar (n-1)\n             return (n * rest)\n  where tell' str = (str, ())\n</code></pre>\n\n<p>and you'll find that these do the same thing:</p>\n\n<pre><code>runWriter (foo 5)\nbar 5\n</code></pre>\n\n<p>up to the ordering of the pair.</p>\n\n<p>The definition of <code>tell'</code> is only needed because <code>((,) a)</code> hasn't been made an instance of <code>MonadWriter</code> for some reason.</p>\n\n<p>(Edited to add:)  While you <em>could</em> extend the definition to larger tuples, this doesn't really provide any additional generality over the definition for the pair:  one component of the pair is a monoid to which you can write, and the other component is the underlying \"value\" in the monad context -- if you need more components for one or the other, you can just make the component a tuple itself.</p>\n"}], "owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 815, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1482855946, "creation_date": 1482733582, "last_edit_date": 1495535431, "question_id": 41327198, "link": "https://stackoverflow.com/questions/41327198/applying-lifted-functions-to-tuples-of-arbitrary-length-in-haskell", "title": "Applying lifted functions to tuples (of arbitrary length) in Haskell", "body": "<p>Is there any explanation for why a lifted function, when applied to 2-tuple, only applies to the 2nd entry:</p>\n\n<pre><code>f x = x + 1\nf &lt;$&gt; (2,2)\n    // -&gt; (2,3)\n</code></pre>\n\n<p>On the other hand, tuples of <strong>any other length than 2</strong> return errors.\nAlso </p>\n\n<pre><code>:t f &lt;$&gt;\n</code></pre>\n\n<p>returns an error. Is it possible to see the type of <code>f &lt;$&gt;</code> when acting on tuples?</p>\n\n<p>Is there any explanation for that behaviour?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Tuple.html\" rel=\"nofollow noreferrer\">The Data.Tuple documentation</a> is extremely brief and has no mention of how functions are lifted to tuples. Is there any source explaining it?</p>\n\n<hr>\n\n<p>Update. A part of question about 2-tuples is related to <a href=\"https://stackoverflow.com/questions/13442544/why-does-the-2-tuple-functor-instance-only-apply-the-function-to-the-second-elem\">this answer</a>, where, however, the above question about multiple length tuples is not addressed.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1482744820, "post_id": 41325286, "comment_id": 69861302, "body": "Re: &quot;why this is not enough&quot;: <code>Show a</code> demands that the compiler choose a type it knows how to print, but many types meet this contract. Normally it&#39;s not a problem to have many possible types; but to actually run your code, it needs to choose a single type and its associated <code>Show</code> instance so it knows which implementation of <code>show</code> to use. Since it feels that it may have many choices, it warns you that you might have wanted to make a different choice than the one it made for you."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1482711178, "last_edit_date": 1495541329, "creation_date": 1482711178, "answer_id": 41325422, "question_id": 41325286, "link": "https://stackoverflow.com/questions/41325286/how-to-avoid-print-related-defaulting-warning-in-ghci/41325422#41325422", "title": "How to avoid print-related defaulting warning in GHCi", "body": "<p>Numeric literals have polymorphic types, and so do lists of them:</p>\n\n<pre><code>GHCi&gt; :t 3\n3 :: Num t =&gt; t\nGHCi&gt; :t [3, 1, 4, 1, 5, 9, 2, 6]\n[3, 1, 4, 1, 5, 9, 2, 6] :: Num t =&gt; [t]\n</code></pre>\n\n<p>To get rid of the warnings, specify the type of the list (or of its elements, which boils down to the same thing). That way, there will be no need for defaulting:</p>\n\n<pre><code>GHCi&gt; minmax ([3, 1, 4, 1, 5, 9, 2, 6] :: [Integer])\nJust (1,9)\nGHCi&gt; minmax [3 :: Integer, 1, 4, 1, 5, 9, 2, 6]\nJust (1,9)\n</code></pre>\n\n<p>See also <a href=\"https://stackoverflow.com/q/41144775/2751851\"><em>Exponents defaulting to Integer</em></a> for related suggestions involving a slightly different scenario.</p>\n"}], "owner": {"reputation": 27351, "user_id": 559827, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4aa6db921795b84b986eb4aac8ffd569?s=128&d=identicon&r=PG", "display_name": "kjo", "link": "https://stackoverflow.com/users/559827/kjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 41325422, "answer_count": 1, "score": 1, "last_activity_date": 1482711615, "creation_date": 1482708944, "last_edit_date": 1482711615, "question_id": 41325286, "link": "https://stackoverflow.com/questions/41325286/how-to-avoid-print-related-defaulting-warning-in-ghci", "title": "How to avoid print-related defaulting warning in GHCi", "body": "<p>This code is for an exercise in a textbook.</p>\n\n<p>If I define</p>\n\n<pre><code>minmax :: (Ord a, Show a) =&gt; [a] -&gt; Maybe (a, a)\nminmax [] = Nothing\nminmax [x] = Just (x, x)\nminmax (x:xs) = Just ( if x &lt; xs_min then x else xs_min\n                     , if x &gt; xs_max then x else xs_max\n                     ) where Just (xs_min, xs_max) = minmax xs\n</code></pre>\n\n<p>...then, in <code>ghci</code> I get warnings like these:</p>\n\n<pre><code>*...&gt; minmax [3, 1, 4, 1, 5, 9, 2, 6]\n\n&lt;interactive&gt;:83:1: Warning:\n    Defaulting the following constraint(s) to type \u2018Integer\u2019\n      (Num a0) arising from a use of \u2018it\u2019 at &lt;interactive&gt;:83:1-31\n      (Ord a0) arising from a use of \u2018it\u2019 at &lt;interactive&gt;:83:1-31\n      (Show a0) arising from a use of \u2018print\u2019 at &lt;interactive&gt;:83:1-31\n    In the first argument of \u2018print\u2019, namely \u2018it\u2019\n    In a stmt of an interactive GHCi command: print it\nJust (1,9)\n</code></pre>\n\n<p>I had expected that having <code>Show a</code> in the context for <code>minmax</code>'s type signature would have eliminated such warnings.  I don't understand why this is not enough.</p>\n\n<p>What else must I do to eliminate such warnings?  (I'm particularly interested in solutions that do not require defining a new type expressly for the value returned by <code>minmax</code>.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1482683706, "post_id": 41322709, "comment_id": 69849125, "body": "Types of <code>fooZero</code>, <code>fooOne one</code> and <code>fooThree one two three</code> are all <code>Foo</code>. So that&#39;s the type of <code>f</code> in <code>bar</code>. <code>bar :: Int -&gt; Int -&gt; Foo -&gt; Int</code>."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482683894, "post_id": 41322709, "comment_id": 69849162, "body": "that functions have different signature. <code>Foo</code> is the returned type only."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1482684020, "post_id": 41322709, "comment_id": 69849187, "body": "You are mistaken. <code>fooZero</code>, <code>fooOne</code> and <code>fooThree</code> have different signatures. <code>fooZero</code>, <code>fooOne one</code> and <code>fooThree one two three</code> are all of type <code>Foo</code>."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482684415, "post_id": 41322709, "comment_id": 69849287, "body": "Ok, I am not sure if my example is enough good. What I am trying to ask, if it is possible to pass a generic function/lambda to another function to be executed only if required."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1482684542, "post_id": 41322709, "comment_id": 69849313, "body": "Everything is executed only if required. Haskell is a lazy language. Research what this means."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482684631, "post_id": 41322709, "comment_id": 69849332, "body": "How can I pass it? Can you point me to some documentation?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482684764, "post_id": 41322709, "comment_id": 69849358, "body": "Exactly as you have written. There is no special secret incantation to pass something to a function. Just replace the bar signature and try in ghci."}], "answers": [{"tags": [], "owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "is_accepted": false, "score": 2, "last_activity_date": 1482684835, "creation_date": 1482684835, "answer_id": 41322935, "question_id": 41322709, "link": "https://stackoverflow.com/questions/41322709/how-to-pass-a-generic-function-as-parameter-to-another-function/41322935#41322935", "title": "How to pass a generic function as parameter to another function?", "body": "<p>Just declare it as:</p>\n\n<pre><code>bar :: Int -&gt; Int -&gt; Foo -&gt; Int\nbar a b f = if (a == b) then a\n        else if (a &gt; b) then evalSomething f\n        else a + b\n</code></pre>\n\n<p>And call it as:</p>\n\n<pre><code>bar 5 3 (fooThree one two three)\n</code></pre>\n\n<p>Since Haskell is lazy, fooThree won't actually be evaluated unless it's needed inside evalSomething.</p>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1482687223, "post_id": 41322938, "comment_id": 69849920, "body": "Thank you, the answer I was looking for. My example was too simple so a bit misleading"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1482684852, "creation_date": 1482684852, "answer_id": 41322938, "question_id": 41322709, "link": "https://stackoverflow.com/questions/41322709/how-to-pass-a-generic-function-as-parameter-to-another-function/41322938#41322938", "title": "How to pass a generic function as parameter to another function?", "body": "<p>As n.m. said in the comments, you simply <em>don't need any function type at all there</em> \u2013 the first-order type <code>bar :: Int -&gt; Int -&gt; Foo -&gt; Int</code> will do the job just fine, since you don't actually feed the <code>foo</code> functions any arguments <em>within <code>bar</code></em> \u2013 those arguments are passed before applying <code>bar</code>, i.e. you only pass the result. Thanks to lazyness it won't matter if the <code>foo</code> functions are expensive so you'd rather not evaluate them if not needed: Haskell will make sure function results aren't evaluated if you don't actually need them!</p>\n\n<p>Generally speaking, there <em>is</em> a thing that allows you to \u201cpass generic functions as parameters\u201d though. It's called <em>Rank-2 polymorphism</em>.</p>\n\n<pre><code>{-# LANGUAGE Rank2Types    #-}\n{-# LANGUAGE UnicodeSyntax #-}\n\nbar :: Int -&gt; Int -&gt; (\u2200 t . Monoid t =&gt; t -&gt; Foo) -&gt; Int\nbar a b f\n  | a == b     = a\n  | a &gt; b      = f (mempty :: [])\n  | otherwise  = a + b\n</code></pre>\n\n<p>(If you're not a fan of Unicode syntax, you can also write <code>\u2200</code> as <code>forall</code>.)\nThat doesn't actually seem to be what you want for your application though.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 745, "favorite_count": 0, "accepted_answer_id": 41322938, "answer_count": 2, "score": 1, "last_activity_date": 1482684852, "creation_date": 1482682646, "last_edit_date": 1482683986, "question_id": 41322709, "link": "https://stackoverflow.com/questions/41322709/how-to-pass-a-generic-function-as-parameter-to-another-function", "title": "How to pass a generic function as parameter to another function?", "body": "<p>Let's say I have three functions:</p>\n\n<pre><code>data Foo = Foo { x :: String, y :: String, z:: String }\n\nfooZero :: Foo\nfooZero = Foo \"empty\" \"empty\" \"empty\"\n\nfooOne :: String -&gt; Foo\nfooOne a = Foo a \"empty\" \"empty\"\n\nfooThree :: String -&gt; String -&gt; String -&gt; Foo\nfooThree a b c = Foo (doSomething a) (doSomethingElse b) (doAnotherThing c)\n</code></pre>\n\n<p>Now I want to be able to pass them (<code>f :: (???? -&gt; Foo)</code>) in another function, to be executed only in case it is required by another expensive function (<code>evalSomething</code>):</p>\n\n<pre><code>bar :: Int -&gt; Int -&gt; (???? -&gt; Foo) -&gt; Int\nbar a b f = if (a == b) then a\n            else if (a &gt; b) then evalSomething f -- return Int\n            else a + b\n</code></pre>\n\n<p>in this way:</p>\n\n<pre><code>let one = \"One\"\nlet two = \"Two\"\nlet three = \"Three\"\n\nbar 8 8 (fooZero)\nbar 1 2 (fooOne one)\nbar 5 3 (fooThree one two three)\n</code></pre>\n\n<p>How can I do that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1482682348, "post_id": 41322661, "comment_id": 69848818, "body": "This is a duplicate, I&#39;ll see if I can find it. Long story short, you need a constructor to differentiate types. <code>a</code> would just be an unwrapped type, not a type wrapped in <code>Maybe</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482682629, "post_id": 41322661, "comment_id": 69848874, "body": "This is the difference between <a href=\"https://en.wikipedia.org/wiki/Tagged_union\" rel=\"nofollow noreferrer\">tagged</a> and untagged unions. Haskell uses the latter."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1482698587, "post_id": 41322661, "comment_id": 69852371, "body": "The former, not the latter."}], "owner": {"reputation": 17, "user_id": 7339996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56721cb6ae5e1535b83371dd5357470e?s=128&d=identicon&r=PG&f=1", "display_name": "user7339996", "link": "https://stackoverflow.com/users/7339996/user7339996"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1482683141, "answer_count": 0, "score": 0, "last_activity_date": 1482683063, "creation_date": 1482682268, "last_edit_date": 1482683063, "question_id": 41322661, "link": "https://stackoverflow.com/questions/41322661/why-we-use-word-just-in-maybe-a", "closed_reason": "Duplicate", "title": "why we use word &quot;just&quot; in &quot;Maybe a&quot;", "body": "<p>why in definition of Maybe is :</p>\n\n<pre><code>data Maybe a = Nothing | Just a \n</code></pre>\n\n<p>Why definition isn't like this:</p>\n\n<pre><code>data Maybe a = Nothing | a\n</code></pre>\n\n<p>Why we use Just, isn't be simple wihout this ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1482757623, "post_id": 41322460, "comment_id": 69866279, "body": "You are thinking of <code>(1 $) plus1</code> probably..."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 15, "last_activity_date": 1482680726, "creation_date": 1482680726, "answer_id": 41322496, "question_id": 41322460, "link": "https://stackoverflow.com/questions/41322460/why-doesnt-this-form-violate-the-type-signature-for/41322496#41322496", "title": "Why doesn&#39;t this form violate the type signature for `$`?", "body": "<p>If you try</p>\n\n<pre><code>(($) 1) plus1\n</code></pre>\n\n<p>you will get the type error you expect.</p>\n\n<p>The special syntax <code>($ 1)</code> is called a section, and stands for <code>\\x -&gt; x $ 1</code>, which differs from the plain application <code>($) 1</code>. This syntax can be used with all infix operators (*) e.g. <code>(+ 1)</code> or <code>(* 4)</code>.</p>\n\n<p>(*) Except <code>-</code>, since <code>(- 10)</code> is the negative constant <code>-10</code>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1482680726, "creation_date": 1482680422, "question_id": 41322460, "link": "https://stackoverflow.com/questions/41322460/why-doesnt-this-form-violate-the-type-signature-for", "title": "Why doesn&#39;t this form violate the type signature for `$`?", "body": "<p>The type signature for <code>$</code> is as follows:</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>Thus if <code>plus1 n = n + 1</code>, then we have that</p>\n\n<pre><code>&gt; ($) plus1 1\n2\n</code></pre>\n\n<p>But then why is it that</p>\n\n<pre><code>&gt; ($ 1) plus1\n2\n</code></pre>\n\n<p>as well? The form <code>($ 1) plus1</code> seems to violate the type signature for <code>$</code>.</p>\n"}, {"tags": ["database", "haskell", "authentication", "pool", "servant"], "answers": [{"comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1482690802, "post_id": 41323471, "comment_id": 69850679, "body": "still, is it not possible to use custom monad for authentication handler?"}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1482691261, "post_id": 41323471, "comment_id": 69850795, "body": "It is - we could have given <code>authenticate</code> the signature <code>Controller User</code>, and then had <code>let ctx = runReader (runController authenticate) env :. EmptyContext</code>."}, {"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1482691687, "post_id": 41323471, "comment_id": 69850905, "body": "mmm.. yes, but than I have to pass env to both my auth context and my regular controllers. I&#39;m using <code>enter (convertController env) serverRoutes</code> to convert my <code>Controllers</code> to <code>Handlers</code> if I wanted to use <code>State</code> in my stack than that state would be out of sync for Authentication handler and my regular handlers."}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1482697996, "post_id": 41323471, "comment_id": 69852257, "body": "True, though you can use the <code>Request</code>s <code>Vault</code> (or an <code>IORef</code>) if you want to thread state from the authentication handler to the normal handler."}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1482698094, "post_id": 41323471, "comment_id": 69852277, "body": "You can&#39;t use <code>State</code> in your handlers for sharing and modifying state from different handlers or from within the same handler but on 2 different requests: using <code>State</code> for handlers only lets you read/modify some state within one run of a given handler on a given request.  Regarding the question itself: there&#39;s nothing (yet) that lets one easily call <code>enter</code> once and have it be applied to both the auth context and the handlers. Those are two very separate things, the context might contain various kinds of stuffs, some of which we don&#39;t want to apply this transformation to."}], "tags": [], "owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "is_accepted": true, "score": 7, "last_activity_date": 1482689724, "creation_date": 1482689724, "answer_id": 41323471, "question_id": 41320350, "link": "https://stackoverflow.com/questions/41320350/haskell-servant-passing-custom-data-to-auth-handler/41323471#41323471", "title": "Haskell Servant passing custom data to auth handler", "body": "<p>The <code>AuthHandler</code> you put into the context doesn't have to be defined at the top-level! Generally, you'll want to do it in <code>main</code> so you have access to the database connections etc. which you've created:</p>\n\n<pre><code>type API = \n  ... :&lt;|&gt; (AuthProtect \"myProtection\" :&gt; ...) :&lt;|&gt; ...\n\ntype instance AuthServerData (AuthProtect \"myProtection\") = User\n\nserver :: ServerEnvironment -&gt; Server API\nserver env = ...\n\nsetupEnv :: IO ServerEnvironment\nsetupEnv = ..\n\n-- This is essentially a 'Controller'.\nauthenticate :: ServerEnvironment -&gt; Handler User\nauthenticate conn = ...\n\nmain :: IO ()\nmain = do\n  env &lt;- setupEnv\n  -- Now, because we have access to the env, we can turn our\n  -- 'authenticate' into the right type before putting it\n  -- in the context\n  let ctx = authenticate env :. EmptyContext\n  run 8080 $ serveWithContext myAPI (server conn) ctx\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 41323471, "answer_count": 1, "score": 4, "last_activity_date": 1482689724, "creation_date": 1482661529, "question_id": 41320350, "link": "https://stackoverflow.com/questions/41320350/haskell-servant-passing-custom-data-to-auth-handler", "title": "Haskell Servant passing custom data to auth handler", "body": "<p>I'm using custom monad (with reader) to easily pass data like DB pool to my handlers (before using custom monad I used to pass connection as fn argument).</p>\n\n<p>This is how I've defined my custom monad :</p>\n\n<pre><code>newtype Controller a = Controller\n    { runController :: ReaderT ServerEnvironment Handler a\n    } deriving ( Functor, Applicative, Monad, MonadReader ServerEnvironment, \n                 MonadError ServantErr, MonadIO )\n</code></pre>\n\n<p>This <code>ServerEnvironment</code> is just custom datatype I use to carry my data.</p>\n\n<p>Problem is that for my <code>AuthHandler</code> I have to specifically use function with:</p>\n\n<pre><code>r -&gt; Handler usr\n</code></pre>\n\n<p>as authentication handler, I can't use my custom handler which would be :</p>\n\n<pre><code>r -&gt; Controller usr\n</code></pre>\n\n<p>and I also have no way to pass in my <code>ConnectionPool</code> because signature can't be :</p>\n\n<pre><code>ConnPool -&gt; r -&gt; Handler usr\n</code></pre>\n\n<p><strong>So, how does one pass extra data to authentication handler in servant without using global <code>IO</code> state?</strong></p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1482657138, "post_id": 41319819, "comment_id": 69843334, "body": "Please justify the type signature you gave to <code>printall</code>, or perhaps just remove it and see what happens."}, {"owner": {"reputation": 13, "user_id": 6535785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da86dc6115daf410c26b1110d4c10240?s=128&d=identicon&r=PG&f=1", "display_name": "SirTee", "link": "https://stackoverflow.com/users/6535785/sirtee"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482657401, "post_id": 41319819, "comment_id": 69843386, "body": "@n.m. i guess the type signature is redundant, the same error persists without it"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1482658052, "post_id": 41319819, "comment_id": 69843492, "body": "Great, now you have this <code>printall &quot;&quot; = &quot;&quot;</code> line, and also <code>printall (i:is)</code> line. The latter has <code>print i</code> in the <code>then</code> branch and <code>printall is</code> in the <code>else</code> branch, The types of the two expressions ought to be the same. Are they?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482658269, "post_id": 41319819, "comment_id": 69843540, "body": "If you want your function to return a string without doing any IO, you use <code>[Char]</code> as the return type. If you want it to do IO and not return a value, use <code>IO ()</code> as a return type. If you want to both return a string and do IO then use <code>IO [Char]</code> as a return type. Whatever type you choose, you must be coherent with it in all the branches of your code."}, {"owner": {"reputation": 13, "user_id": 6535785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da86dc6115daf410c26b1110d4c10240?s=128&d=identicon&r=PG&f=1", "display_name": "SirTee", "link": "https://stackoverflow.com/users/6535785/sirtee"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482658323, "post_id": 41319819, "comment_id": 69843549, "body": "@n.m. ohh you just reminded me in haskell each expression must the same type, &#39;print i&#39; would return a single char whereas &#39;printall is&#39; will return a list of char, the two types are not interchangeable. i&#39;m i on the right lines?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1482660203, "post_id": 41319819, "comment_id": 69843921, "body": "No, <code>print t</code> would not return a <code>Char</code>. It&#39;s an IO function. You can check its type by entering <code>:t print</code> at ghci prompt."}, {"owner": {"reputation": 13, "user_id": 6535785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da86dc6115daf410c26b1110d4c10240?s=128&d=identicon&r=PG&f=1", "display_name": "SirTee", "link": "https://stackoverflow.com/users/6535785/sirtee"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482663349, "post_id": 41319819, "comment_id": 69844575, "body": "@n.m. true, now i changed the code to <code>return i</code> it works but only returns the first index as the recursive call is never met, how do i fix that?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482663559, "post_id": 41319819, "comment_id": 69844637, "body": "In order to print a list you need to print a head <b>and</b> print a tail. You are never doing the &quot;and&quot; part."}, {"owner": {"reputation": 13, "user_id": 6535785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da86dc6115daf410c26b1110d4c10240?s=128&d=identicon&r=PG&f=1", "display_name": "SirTee", "link": "https://stackoverflow.com/users/6535785/sirtee"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482665085, "post_id": 41319819, "comment_id": 69844983, "body": "@n.m. oh thanks thats done the trick, i would totally pay you to be my mentor but im a broke student hahaha"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1482662689, "post_id": 41320045, "comment_id": 69844414, "body": "<code>main</code> does not need to be <code>IO ()</code>. It only has to be <code>IO t</code> for some <code>t</code>. <code>main = return 0</code> will compile fine."}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 3, "last_activity_date": 1506553024, "last_edit_date": 1506553024, "creation_date": 1482658460, "answer_id": 41320045, "question_id": 41319819, "link": "https://stackoverflow.com/questions/41319819/haskell-couldnt-match-expected-type-char-with-actual-type-io/41320045#41320045", "title": "Haskell couldn&#39;t match expected type [char] with actual type IO", "body": "<p>As you said in a comment above, each branch of the if clause should have the same type, indeed.</p>\n\n<p>Also, <code>main</code> function must always have <code>IO a</code> type, for some <code>a</code>, which is usually <code>()</code>. This means that the type signature for <code>printall</code> should be:</p>\n\n<pre><code>printall :: [Char] -&gt; IO ()\n</code></pre>\n\n<p>which is the same as:</p>\n\n<pre><code>printall :: String -&gt; IO ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 0, "last_activity_date": 1482667972, "creation_date": 1482667972, "answer_id": 41321014, "question_id": 41319819, "link": "https://stackoverflow.com/questions/41319819/haskell-couldnt-match-expected-type-char-with-actual-type-io/41321014#41321014", "title": "Haskell couldn&#39;t match expected type [char] with actual type IO", "body": "<p><code>print</code> type is <code>print :: Show a =&gt; a -&gt; IO ()</code> </p>\n\n<p>but your <code>printall</code> type is <code>printall :: [Char] -&gt; [Char]</code>, assume it is what you want.</p>\n\n<p>The expression <code>if x then y else z</code> need the same type for <code>y</code> and <code>z</code></p>\n"}], "owner": {"reputation": 13, "user_id": 6535785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da86dc6115daf410c26b1110d4c10240?s=128&d=identicon&r=PG&f=1", "display_name": "SirTee", "link": "https://stackoverflow.com/users/6535785/sirtee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1754, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1506553024, "creation_date": 1482655739, "question_id": 41319819, "link": "https://stackoverflow.com/questions/41319819/haskell-couldnt-match-expected-type-char-with-actual-type-io", "title": "Haskell couldn&#39;t match expected type [char] with actual type IO", "body": "<p>I just started learning Haskell, and i'm on stuck on this error among a bunch of others </p>\n\n<p>i'm trying to print all the characters in the char list recursively with this code </p>\n\n<pre><code>printall :: [Char] -&gt; [Char]\nprintall \"\" = \"\"\nprintall (i:is) = if is /= \"\" then print i else printall is\n\nmain = printall \"hello world\"\n</code></pre>\n\n<p>but i get this error could anyone help me?</p>\n\n<pre><code>intro.hs:14:36: error:\n\u2022 Couldn't match expected type \u2018[Char]\u2019 with actual type\n\u2018IO ()\u2019\n\u2022 In the expression: print i\n  In the expression: if is /= \"\" then print i else printa\nll is\n  In an equation for \u2018printall\u2019:\n      printall (i : is) = if is /= \"\" then print i else p\n rintall is\n\nintro.hs:16:1: error:\n\u2022 Couldn't match expected type \u2018IO t0\u2019 with actual type \u2018\n[Char]\u2019\n</code></pre>\n"}, {"tags": ["haskell", "data-kinds"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1482651631, "creation_date": 1482651631, "answer_id": 41319466, "question_id": 41319345, "link": "https://stackoverflow.com/questions/41319345/nested-type-level-programming/41319466#41319466", "title": "Nested Type-Level Programming", "body": "<p>The problem here is a bit subtle. The reason one might expect GHC to accept this is that you have instances for all possible <code>Lower a</code> since you only provide ways of making <code>Lower D</code> and <code>Lower E</code>. However, one could construct a pathological definition for <code>Lower</code> like</p>\n\n<pre><code>import GHC.Exts (Any)\n\ndata Lower :: Prop1 -&gt; * where\n  SubThing1 :: Lower D\n  SubThing2 :: Lower E\n  SubThing3 :: Lower Any\n</code></pre>\n\n<p>The point is that not only <code>D</code> and <code>E</code> have kind <code>Prop1</code>. It isn't just with things like <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#t:Any\" rel=\"noreferrer\"><code>Any</code></a> that we can play such shenanigans - even the following constructor is allowed (so <code>F Int :: Prop1</code> too)!</p>\n\n<pre><code>  SubThing4 :: Lower (F Int)\n\ntype family F x :: Prop1 where {}\n</code></pre>\n\n<p>So, in summary, the underlying problem is that GHC really can't be sure that the <code>ClassLower (Lower a)</code> constraint (needed due to the use of <code>somefunc2</code>) is going to be satisfied. To do so, it would have to do a fair bit of work checking the GADT constructors and making sure that every possible case is covered by some instance.</p>\n\n<p>In this case, you could solve your problem by adding the <code>ClassLower (Lower a)</code> constraint to the GADT constructor (an enabling <code>FlexibleContexts</code>). </p>\n\n<pre><code>data Upper :: Prop2 -&gt; * where\n  Thing1 :: Upper A\n  Thing2 :: Upper B\n  Thing3 :: ClassLower (Lower a) =&gt; Lower a -&gt; Upper C\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1482859588, "post_id": 41328468, "comment_id": 69900619, "body": "Right, and then you might as well get rid of all the type classes as well."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1482740984, "creation_date": 1482740984, "answer_id": 41328468, "question_id": 41319345, "link": "https://stackoverflow.com/questions/41319345/nested-type-level-programming/41328468#41328468", "title": "Nested Type-Level Programming", "body": "<p>Or you could write out your <code>ClassLower</code> instance like this, using pattern matching (rather than the type variable) to distinguish the cases of the GADT:</p>\n\n<pre><code>instance ClassLower (Lower a) where\n    somefunc2 SubThing1 = \"string3\"\n    somefunc2 SubThing2 = \"string4\"\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 1764211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8259ddc23138acecd67600b2f32aeaa3?s=128&d=identicon&r=PG", "display_name": "user1219", "link": "https://stackoverflow.com/users/1764211/user1219"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 41328468, "answer_count": 2, "score": 2, "last_activity_date": 1482740984, "creation_date": 1482650260, "question_id": 41319345, "link": "https://stackoverflow.com/questions/41319345/nested-type-level-programming", "title": "Nested Type-Level Programming", "body": "<p>I'm attempting to use DataKinds to do type-level programming, but am running into difficulties when I have one of these structures nested in another.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, GADTs, MultiParamTypeClasses, FlexibleInstances #-}\n\nmodule Temp where\n\ndata Prop1 = D | E \n\ndata Lower :: Prop1 -&gt; * where\n  SubThing1 :: Lower D\n  SubThing2 :: Lower E\n\nclass ClassLower a where\n  somefunc2 :: a -&gt; String\n\ninstance ClassLower (Lower D) where\n  somefunc2 a = \"string3\"\n\ninstance ClassLower (Lower E) where\n  somefunc2 a = \"string4\"\n\ndata Prop2 = A | B | C\n\ndata Upper :: Prop2 -&gt; * where\n  Thing1 :: Upper A\n  Thing2 :: Upper B\n  Thing3 :: Lower a -&gt; Upper C\n\nclass ClassUpper a where\n  somefunc :: a -&gt; String\n\ninstance ClassUpper (Upper A) where\n  somefunc a = \"string1\"\n\ninstance ClassUpper (Upper B) where\n  somefunc a = \"string2\"\n\ninstance ClassUpper (Upper C) where\n  somefunc (Thing3 x) = somefunc2 x\n</code></pre>\n\n<p>As soon as I add that last instance of ClassUpper, I end up with an error.</p>\n\n<pre><code>Temp.hs:37:25: error:\n    \u2022 Could not deduce (ClassLower (Lower a))\n        arising from a use of \u2018somefunc2\u2019\n      from the context: 'C ~ 'C\n        bound by a pattern with constructor:\n                   Thing3 :: forall (a :: Prop1). Lower a -&gt; Upper 'C,\n                 in an equation for \u2018somefunc\u2019\n        at /Users/jdouglas/jeff/emulator/src/Temp.hs:37:13-20\n    \u2022 In the expression: somefunc2 x\n      In an equation for \u2018somefunc\u2019: somefunc (Thing3 x) = somefunc2 x\n      In the instance declaration for \u2018ClassUpper (Upper 'C)\u2019\n</code></pre>\n\n<p>I understand that <code>'C ~ 'C</code> indicates type equality, but I don't understand what the underlying problem is, much less the solution or workaround.</p>\n\n<p>What am I not understanding, and what is the best way to tackle this problem?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1482648859, "post_id": 41318977, "comment_id": 69842094, "body": "If you make it in parallel, you would not be able to link <code>a</code> and <code>b</code>, am I right? What are you trying to do?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482655990, "post_id": 41318977, "comment_id": 69843164, "body": "Note that, if you compute them in parallel, you always get <code>b=a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1482646569, "post_id": 41319020, "comment_id": 69841813, "body": "Wouldn&#39;t just replacing the second <code>|</code> with a <code>,</code> do the trick?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 1, "creation_date": 1482647698, "post_id": 41319020, "comment_id": 69841953, "body": "@Arnon No, then it would be a normal list comprehension rather than a parallel one, which will not be a <code>zipWith</code> but rather a <code>concatMap</code>."}, {"owner": {"reputation": 31, "user_id": 7339057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98226f05ac9c394ae8646e145d8e790e?s=128&d=identicon&r=PG&f=1", "display_name": "Zulraidur", "link": "https://stackoverflow.com/users/7339057/zulraidur"}, "edited": false, "score": 0, "creation_date": 1482648748, "post_id": 41319020, "comment_id": 69842080, "body": "That&#39;s at least an explanation. I had a look at the definition myself but since I am very new to Haskell (Started Yesterday) I didn&#39;t quite get it myself. Any tips on how to actually fix it though?"}, {"owner": {"reputation": 31, "user_id": 7339057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98226f05ac9c394ae8646e145d8e790e?s=128&d=identicon&r=PG&f=1", "display_name": "Zulraidur", "link": "https://stackoverflow.com/users/7339057/zulraidur"}, "edited": false, "score": 1, "creation_date": 1482649029, "post_id": 41319020, "comment_id": 69842119, "body": "I just rethought the problem and realised I actually can&#39;t use parallel list comprehension at all..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482694443, "post_id": 41319020, "comment_id": 69851490, "body": "Parallel list comprehensions entered the language just after I did, and I thought it was cool!  Then I proceeded to never use them.  There was a small phase of trying to extend list comprehensions with all sorts of features, but we seem to have grown out of it :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1482645584, "creation_date": 1482645584, "answer_id": 41319020, "question_id": 41318977, "link": "https://stackoverflow.com/questions/41318977/using-variables-in-parallel-list-comprehensions-in-haskell/41319020#41319020", "title": "Using variables in parallel list comprehensions in Haskell", "body": "<p>Quoted from <a href=\"https://prime.haskell.org/wiki/ParallelListComp\" rel=\"nofollow noreferrer\">Haskell Prime</a>:</p>\n\n<blockquote>\n  <p>Parallel comprehensions extend list comprehensions with a notation for\n  zips. The comprehension</p>\n\n<pre><code>[ e | quals1 | ... | qualsN ]\n</code></pre>\n  \n  <p>can be desugared to</p>\n\n<pre><code>zipWithN (\\ p1 ... pN -&gt; e) [p1 | quals1] ... [pN | qualsN]\n</code></pre>\n  \n  <p>where <code>pi</code>\n  is a tuple of the variables defined by <code>qualsi</code> and used by <code>e</code>.</p>\n</blockquote>\n\n<p>So, from your example, <code>[a*b |a&lt;- [x,x-1..1] | b &lt;- [x,x-1..1] , isPalindrome (a*b)]</code> is roughly equivalent to</p>\n\n<pre><code>zipWith (\\a b -&gt; a*b)\n        [ a | a&lt;-[x,x-1..1] ]\n        [ b | b &lt;- [x,x-1..1], isPalindrome (a*b) ]\n</code></pre>\n\n<p>where it is pretty clear why <code>a</code> is not in scope for the last list comprehension. Intuitively, you should think of each <code>|</code> delimited part as being completely independent from the others. Any filtering operation is going to be bound to only <em>one</em> of these parts.</p>\n"}], "owner": {"reputation": 31, "user_id": 7339057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98226f05ac9c394ae8646e145d8e790e?s=128&d=identicon&r=PG&f=1", "display_name": "Zulraidur", "link": "https://stackoverflow.com/users/7339057/zulraidur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 584, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1482668165, "creation_date": 1482644972, "last_edit_date": 1482668165, "question_id": 41318977, "link": "https://stackoverflow.com/questions/41318977/using-variables-in-parallel-list-comprehensions-in-haskell", "title": "Using variables in parallel list comprehensions in Haskell", "body": "<p>In a <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/users_guide/syntax-extns.html#parallel-list-comprehensions\" rel=\"nofollow noreferrer\">parallel list comprehension</a> in Haskell, I encounter a problem when trying to use a guard.</p>\n\n<pre><code>largestPalindrome :: Int -&gt; Int\nlargestPalindrome x = maximum [ a*b\n                              | a &lt;- [x,x-1..1]\n                              | b &lt;- [x,x-1..1]\n                              , isPalindrome (a*b) ]\n</code></pre>\n\n<p>The error that is displayed is</p>\n\n<pre><code>Variable not in scope: a :: Int\n</code></pre>\n"}, {"tags": ["list", "haskell", "recursion", "binary"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482625752, "post_id": 41317392, "comment_id": 69839462, "body": "Storing binary numbers in written order is quite awkward, since you need to know the length of the whole list in order to even know the place value of the first bit.   When using cons-lists, reversed is the elegant way to represent them."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482625888, "post_id": 41317392, "comment_id": 69839475, "body": "Conal Elliott has a pretty abstract treatment of binary addition <a href=\"http://conal.net/blog/posts/parallel-speculative-addition-via-memoization\" rel=\"nofollow noreferrer\">here</a>, if you&#39;re into that kind of thing."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1482626175, "post_id": 41317392, "comment_id": 69839499, "body": "What&#39;s your definition of <code>add&#39;</code>? Are you sure you get <code>(result, carry)</code> and not the other way around?"}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482666038, "post_id": 41317392, "comment_id": 69845192, "body": "It was not my choice on how to store the numbers (it was defined in an exercise). Thanks for the additional information on binary addition, though. The problem was indeed in the <code>add&#39;</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482656132, "post_id": 41318953, "comment_id": 69843182, "body": "I think the outputs of <code>divMod</code> should be <code>(z, c&#39;)</code>"}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482665533, "post_id": 41318953, "comment_id": 69845087, "body": "Thanks! It seems that the functions are defined in the same way (except for the order of the elements in the tuple). However, the error was indeed in the add&#39; function. I have now corrected the code."}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482665756, "post_id": 41318953, "comment_id": 69845125, "body": "However, I also had to add a function to prefix the smaller list with the appropriate number of zeros so that <code>binarySum</code> computes the right thing."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482681225, "post_id": 41318953, "comment_id": 69848544, "body": "@David Nice catch. Fixed the solution here too."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1482681209, "last_edit_date": 1482681209, "creation_date": 1482644532, "answer_id": 41318953, "question_id": 41317392, "link": "https://stackoverflow.com/questions/41317392/adding-two-binary-numbers-stored-as-lists-of-0s-and-1s-in-haskell-without-using/41318953#41318953", "title": "Adding two binary numbers stored as lists of 0s and 1s in Haskell, without using reverse", "body": "<p>You are almost there (at least your explanation seems to indicate so - your code relies on an <code>add</code> function you haven't included). The trick is indeed to keep the carry as a separate number in a tuple in an auxiliary function (which I've named <code>binarySum'</code>). The invariant you are working with is then that the list returned has the same length as the larger of the two lists provided (and is the first digits of their sum) - a carry, if there is any, is held separately. </p>\n\n<pre><code>binarySum :: [Int] -&gt; [Int] -&gt; [Int]\nbinarySum xs ys\n  | length xs &lt; length ys = binarySum (replicate (length ys - length xs) 0 ++ xs) ys\n  | length xs &gt; length ys = binarySum xs (replicate (length xs - length ys) 0 ++ ys)\n  | otherwise = case binarySum' xs ys of\n                    (0, zs) -&gt; zs\n                    (1, zs) -&gt; 1:zs\n  where\n    binarySum' :: [Int] -&gt; [Int] -&gt; (Int, [Int])\n    binarySum' [] ys = (0, ys)\n    binarySum' xs [] = (0, xs)\n    binarySum' (x:xs) (y:ys) = let (c, zs) = binarySum' xs ys\n                                   (c', z) = (x + y + c) `divMod` 2\n                               in (c', z:zs)\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 0, "accepted_answer_id": 41318953, "answer_count": 1, "score": 0, "last_activity_date": 1482681209, "creation_date": 1482619751, "question_id": 41317392, "link": "https://stackoverflow.com/questions/41317392/adding-two-binary-numbers-stored-as-lists-of-0s-and-1s-in-haskell-without-using", "title": "Adding two binary numbers stored as lists of 0s and 1s in Haskell, without using reverse", "body": "<p>I am trying to solve this simple problem in an elegant and expressive way. Usually, I would start from the end of both lists, add the corresponding elements and store a carry to compute the next digits. However, I am struggling to solve this with recursion and without using the <code>reverse</code> function.</p>\n\n<p>This is my first attempt:</p>\n\n<pre><code>binarySum :: [Int] -&gt; [Int] -&gt; [Int]\nbinarySum ls ls'\n  = let (res, c) = binarySum' ls ls' in c : res\n  where\nbinarySum' [x] [y]\n  = let (s, c) = add x y in ([s], c)\nbinarySum' (x : xs) (y : ys)\n  = (s : res, c')\n  where\n    (res, c) = binarySum' xs ys\n    (s, c')  = add' x y c\n</code></pre>\n\n<p>(where the add and add' functions perform the needed operations)</p>\n\n<p>The resulting list appears to be correct, but in reverse order. I don't know how to proceed since I chose to build the result in the pair that is returned along with the carry in the auxiliary function (normally I would do something like <code>s : binarySum'...</code>).</p>\n\n<p>Also I feel like the code is too cluttered and not as elegant as it should be.</p>\n\n<p>Any help is greatly appreciated!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1613, "user_id": 2521614, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/4e9ae4bc8bedf9c49c0e3525168095ec?s=128&d=identicon&r=PG&f=1", "display_name": "Praveen Singh Yadav", "link": "https://stackoverflow.com/users/2521614/praveen-singh-yadav"}, "edited": false, "score": 0, "creation_date": 1482644104, "post_id": 41317935, "comment_id": 69841542, "body": "Thanks. It makes perfect sense. I reached to similar solution after posting the question. But In my code I had to loos the route code. I understand monads but I realised I need to do more exercise of IO."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1482655160, "last_edit_date": 1482655160, "creation_date": 1482626590, "answer_id": 41317935, "question_id": 41316870, "link": "https://stackoverflow.com/questions/41316870/perform-io-inside-wai-application/41317935#41317935", "title": "perform IO inside wai application", "body": "<p>Your design prevents it, because of how you have written <code>app</code>, </p>\n\n<pre><code>app request respond = respond $ case rawPathInfo request of\n</code></pre>\n\n<p>which says that you immediately respond.  Note the type of <a href=\"https://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#t:Application\" rel=\"nofollow noreferrer\"><code>Application</code></a>:</p>\n\n<pre><code>type Application = Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\n</code></pre>\n\n<p>Since the result type has an <code>IO</code>, you have the opportunity to do I/O before yielding a value.  So you could:</p>\n\n<pre><code>app request respond = do\n    whateverResult &lt;- runCommand \"whatever\"\n    respond $ ...\n</code></pre>\n\n<p><i>(You could also do it afterward, at least according to the types:</p>\n\n<pre><code>app request respond = do\n    rcvd &lt;- respond $ ...\n    runCommand \"whatever\"\n    return rcvd\n</code></pre>\n\n<p>Though that's a bit odd to do for the continuation-passing idiom being used here (the <code>(a -&gt; b) -&gt; b</code> pattern in the <code>Application</code> type).  It means that the command will be run after everything else, for some definition of \"everything else\" that we can't know without reading the <code>wai</code> source.)</i></p>\n\n<p>Anyway, you probably don't want the command to be run inside <code>app</code>, but rather in <code>wakeMeUp</code>, which means you need to change some types around.  In particular,</p>\n\n<pre><code>wakeMeUp :: Request -&gt; IO Response\n--                     ^^\n</code></pre>\n\n<p>and suitably monadify the function.  Then your <code>app</code> needs to not call <code>respond</code> immediately, so you can say</p>\n\n<pre><code>app request respond =\n   response &lt;- case rawPathInfo request of\n       \"/\" -&gt; return indexHtml\n--            ^^^^^^\n       \"/wake\" -&gt; wakeMeUp request\n--       no change, because wakeMeUp now has an IO return type\n       ...\n   respond response\n</code></pre>\n\n<p>If this is gibberish to you, it's time to do some monad tutorials. Or if you just want to get the damn thing working, I recommend Dan Piponi's <a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">The IO Monad For People who Simply Don't Care</a>. Happy hacking!</p>\n"}], "owner": {"reputation": 1613, "user_id": 2521614, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/4e9ae4bc8bedf9c49c0e3525168095ec?s=128&d=identicon&r=PG&f=1", "display_name": "Praveen Singh Yadav", "link": "https://stackoverflow.com/users/2521614/praveen-singh-yadav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 41317935, "answer_count": 1, "score": 1, "last_activity_date": 1482655160, "creation_date": 1482613961, "last_edit_date": 1482651305, "question_id": 41316870, "link": "https://stackoverflow.com/questions/41316870/perform-io-inside-wai-application", "title": "perform IO inside wai application", "body": "<p>I am following the basic dispatching section of wai application.</p>\n\n<p>I am able to catch the url parameter. How can I perform IO operation using these params. </p>\n\n<p>I would like to use <code>runCommand</code> of System.Process to execute a system command using these parameters. </p>\n\n<p>:t runCommand give \n<code>runCommand :: String -&gt; IO ProcessHandle</code></p>\n\n<p>my Main.hs</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\nimport Control.Monad\nimport Network.Wai\nimport Network.HTTP.Types\nimport Network.Wai.Handler.Warp (run)\nimport Data.ByteString\nimport Control.Monad\nimport System.Process\nimport qualified Data.ByteString.Lazy.Char8 as L8\n\nmain :: IO ()\nmain = do\n    run 8080 app\n\napp :: Application\napp request respond = respond $ case rawPathInfo request of\n    \"/\" -&gt; indexHtml \n    \"/wake\" -&gt; wakeMeUP request\n    _ -&gt; fourNotFour\n\nindexHtml :: Response\nindexHtml = responseFile\n    status200\n    [(\"Content-Type\",\"text/html\")]\n    \"index.html\"\n    Nothing\n\nwakeMeUP :: Request -&gt; Response\nwakeMeUP request = \n    let query = queryString request\n        hour = join $ lookup \"hour\" query\n        min = join $ lookup \"min\" query\n    --I would like to use runCommand \"using hour and min variables\"\n    in responseLBS\n        status200\n        [(\"Content-Type\",\"text/plain\")]\n        \"Alarm set at...to be coded later\"\n\nfourNotFour :: Response\nfourNotFour = responseLBS\n\n    status404\n    [(\"Content-Type\",\"text/plain\")]\n    \"404 not found\"\n</code></pre>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482610707, "post_id": 41316448, "comment_id": 69836876, "body": "Look at DList, or simply compose and pass an equivalent function as you move down the tree (like <code>(a :) . (b :) . (c :)</code>)"}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482611725, "post_id": 41316448, "comment_id": 69837094, "body": "interesting approach, I added an implementation to the end of the post."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1482618667, "post_id": 41316448, "comment_id": 69838357, "body": "Very nice. The following is obviously a very simple comment, but it illustrates your idea, and it tickled me. Here is a version of reverse using <code>foldr</code>. <code>reverse xs = foldr (\\x f -&gt; f . (x:)) id xs $ []</code>"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482612975, "post_id": 41316668, "comment_id": 69837350, "body": "Are you sure this is correct? <code>fs &lt;*&gt; [a:as]</code> is either a singleton list (if <code>fs</code> has at least one element) or is empty (if <code>fs</code> is empty) - this cannot produce a tree with the shape of the original tree."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482613878, "post_id": 41316668, "comment_id": 69837520, "body": "@user2407038 <code>(&lt;*&gt;)</code> for lists takes all posible combinations; since <code>[a:as]</code> has one element, <code>fs &lt;*&gt; [a:as]</code> has the same number of elements as <code>fs</code>."}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 0, "creation_date": 1482616851, "post_id": 41316668, "comment_id": 69838071, "body": "looks like a very promising approach. I still have the impression that the paths are in the wrong order when trying this out with some data. Am I missing something here? Is the NonEmpty part necessary here?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 0, "creation_date": 1482655619, "post_id": 41316668, "comment_id": 69843103, "body": "@AntonHarald Yes, the paths start from the current node. You will have to <code>fmap reverse</code> the tree if you want them to start at the root. The <code>NonEmpty</code> is not really necessary, I just find it more readable than <code>(a,[a])</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1482612129, "last_edit_date": 1482612129, "creation_date": 1482611663, "answer_id": 41316668, "question_id": 41316448, "link": "https://stackoverflow.com/questions/41316448/attach-the-path-of-each-element-in-a-tree/41316668#41316668", "title": "attach the path of each element in a tree", "body": "<p>Here's another (not necessarily simpler) way to do it, using a recursion scheme called a <em>catamorphism</em>. <code>Data.Tree</code> in the latest version of <em>containers</em> has the <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Tree.html#v:foldTree\" rel=\"nofollow noreferrer\">function</a>:</p>\n\n<blockquote>\n  <p>foldTree :: (a -> [b] -> b) -> Tree a -> b</p>\n</blockquote>\n\n<p>Which is a catamorphism on trees (compared to <code>foldr</code>, which is the catamorphism for lists). Given an auxiliary function, it \"destroys\" the tree starting from the leaves and going upwards to the root.</p>\n\n<p>However, we actually want to go the other way: we want to start at the root and propagate the path information to each subtree.</p>\n\n<p>Turns out that there is a trick for doing this using a catamorphism: instead of making the catamorphism return the path-annotated tree directly, <em>make it return a function</em> that takes a root path and returns the path-annotated tree. Something like:</p>\n\n<pre><code>import Data.Tree\nimport Data.List.NonEmpty\n\ninherit :: Tree a -&gt; Tree (NonEmpty a)\ninherit tree = foldTree algebra tree [] where\n    algebra :: a -&gt; [[a] -&gt; Tree (NonEmpty a)] -&gt; [a] -&gt; Tree (NonEmpty a)\n    algebra a fs as = Node (a:|as) (fs &lt;*&gt; [a:as]) \n</code></pre>\n\n<p>Here, the result of the catamorphism is of type <code>[a] -&gt; Tree (NonEmpty a)</code>. <code>inherit</code> supplies the initial empty path.</p>\n\n<p>A simpler version of this trick is <a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">expressing foldl in terms of foldr</a> (if you squint a little, the first element of a list is like the \u201croot\u201d of a linear tree). A beefed-up version of this trick allows <a href=\"http://www.staff.science.uu.nl/~jeuri101/homepage/Publications/ags.pdf\" rel=\"nofollow noreferrer\">calculating inherited attributes in attribute grammars</a>. </p>\n\n<p>The idea that being able to return functions form a catamorphism increases its expressive power is explained in section 5 of the paper <a href=\"http://www.cs.nott.ac.uk/~pszgmh/fold.pdf\" rel=\"nofollow noreferrer\">\"A tutorial on the universality and expressiveness of fold\"</a>.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482612129, "creation_date": 1482609459, "last_edit_date": 1482611687, "question_id": 41316448, "link": "https://stackoverflow.com/questions/41316448/attach-the-path-of-each-element-in-a-tree", "title": "attach the path of each element in a tree", "body": "<p>Consider the following tree data structure:</p>\n\n<pre><code>data Tree a = Node a [Tree a] deriving Show\n</code></pre>\n\n<p>and a function which attaches to each element its path in the tree:</p>\n\n<pre><code>withPath :: Tree a -&gt; Tree (a, [a])\nwithPath t = go [] t where\n  go path (Node v xs) = Node (v, p) (map (go p) xs) where\n    p = path ++ [v]\n\nwithPath (Node 4 [Node 3 [], Node 5 []])\n--&gt; Node (4,[4]) [Node (3,[4,3]) [],Node (5,[4,5]) []]\n</code></pre>\n\n<p>Is this the way to do it? I'm looking for a way to avoid the construction of the path by concatenation.</p>\n\n<hr>\n\n<p>here is a solution proposed by jberryman.</p>\n\n<pre><code>withPath' :: Tree a -&gt; Tree (a, [a])\nwithPath' t = go id t where\n  go f (Node v xs) = Node (v, f' []) (map (go f') xs) where\n    f' = f . (v:)\n</code></pre>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482599682, "post_id": 41313777, "comment_id": 69834047, "body": "The RTS can determine that a thread is blocked indefinitely if a thread has the only reference to that MVar and is blocked (possibly if all threads owning a reference are blocked; not sure). It&#39;s possible to write simple examples of deadlocks that the RTS can&#39;t detect. You won&#39;t be able to recover a thread once BlockedIndefinitelyOnMVAr is raised; you can catch it and try to do stuff, but it will still be GC&#39;d. See: <a href=\"http://stackoverflow.com/q/6847307/176841\">stackoverflow.com/q/6847307/176841</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1482612441, "post_id": 41313777, "comment_id": 69837250, "body": "An <code>MVar</code> is just the wrong control structure - you probably want a <code>Chan</code>. Trying to recover from a concurrency deadlock is the wrong thing to do. Furthermore, the <code>Maybe</code> does nothing here - you always write <code>Just ..</code> and finally write a single <code>Nothing</code> - just replace <code>MVar (Maybe a)</code> with <code>Chan a</code> and use <code>getChanContents</code>."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482616715, "post_id": 41313777, "comment_id": 69838048, "body": "@user2407038 I&#39;m pretty sure you misunderstood. I&#39;m relying on the blocking behavior. I can&#39;t get that with Chan."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482637662, "post_id": 41313777, "comment_id": 69840775, "body": "I did indeed understand. Relying on the blocking behavior of MVar in this way is the wrong thing to do. You must rewrite your program logic to not rely on it - or else deal with ungraceful exits (crashing on BlockedIndefinitely) and rampant memory leaks, as you simply won&#39;t be able to bully GHC into doing something with an <code>MVar</code> that it cannot do.  (Well, you might be able to - that doesn&#39;t make it a proper solution)"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482676490, "post_id": 41313777, "comment_id": 69847478, "body": "@user2407038 A &quot;proper&quot; solution doesn&#39;t have the semantics OR the interface that I want. I would love to avoid the whole exception catching thing though."}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482586902, "creation_date": 1482586902, "question_id": 41313777, "link": "https://stackoverflow.com/questions/41313777/how-does-the-rts-detect-that-a-thread-is-blocked-indefinitely-on-an-mvar-operati", "title": "How does the RTS detect that a thread is blocked indefinitely on an MVar operation?", "body": "<p>I have this code </p>\n\n<pre><code>mvarToList :: MVar (Maybe a) -&gt; IO [a]\nmvarToList mv = do\n    mby &lt;- takeMVar mv\n    case mby of\n        Nothing -&gt; return []\n        Just x  -&gt; do\n            xs &lt;- unsafeInterleaveIO (mvarToList mv)\n            return (x : xs)\n{-# NOINLINE mvarToList #-}\n\nstreamQuery_ :: FromRow a =&gt; Connection -&gt; Query -&gt; IO [a]\nstreamQuery_ conn q = do\n    mv &lt;- newEmptyMVar\n    void $ forkIO $ do\n        fold_ conn q () (\\_ x -&gt; putMVar mv (Just x))\n        putMVar mv Nothing\n    mvarToList mv\n</code></pre>\n\n<p>It uses the <code>postgresql-simple</code> library which provides a <code>fold_</code> function. It allows you to provide a function that's ran on every row of the query's result. The internal implementation is such that if the provided function blocks, the next result won't be fetched (modulo batching).</p>\n\n<p>What I've done here is basically attached the evaluation of an element of the list to <code>takeMVar</code> which gives me a lazy list that streams results from the DB.</p>\n\n<p>The problem here is leakage. The only way I can hope to avoid any leaks is if SOMEHOW garbage collecting the list results in the RTS determining that the fetching thread is blocked forever (since nothing will be taken from the MVar anymore) and throws an exception to it. Maybe I could even catch that exception and handle cleaning up?</p>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482611945, "post_id": 41313693, "comment_id": 69837152, "body": "If you have an answer to your question, you should post it as an actual answer and not an edit to the question."}], "answers": [{"comments": [{"owner": {"reputation": 11591, "user_id": 1097347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/efffb39e9e98d002a5b9afe2fde7e50d?s=128&d=identicon&r=PG", "display_name": "Uri Goren", "link": "https://stackoverflow.com/users/1097347/uri-goren"}, "edited": false, "score": 0, "creation_date": 1482592752, "post_id": 41314266, "comment_id": 69832332, "body": "The solution seems hard-coded to &#39;XXX&#39; as a substring, is this what the OP wants ?"}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 0, "creation_date": 1482596724, "post_id": 41314266, "comment_id": 69833272, "body": "It&#39;s a great answer, unfortunately not that chatty. So I tried to explain it with some words and removed the hard-coded part of it. It&#39;s added below the initial question. Any remarks on that are welcome.."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 2, "last_activity_date": 1482590953, "creation_date": 1482590953, "answer_id": 41314266, "question_id": 41313693, "link": "https://stackoverflow.com/questions/41313693/remove-a-character-sequence-from-a-string/41314266#41314266", "title": "Remove a Character Sequence From a String", "body": "<pre><code>f :: String -&gt; [String]\nf (a:b:c:right)\n  = (if a == 'X' &amp;&amp; b == 'X' &amp;&amp; c == 'X' then (right:) else id)\n  $ map (a:) $ f (b:c:right)\nf _ = []\n</code></pre>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1152, "favorite_count": 0, "accepted_answer_id": 41314266, "answer_count": 1, "score": 1, "last_activity_date": 1482596590, "creation_date": 1482586100, "last_edit_date": 1482596590, "question_id": 41313693, "link": "https://stackoverflow.com/questions/41313693/remove-a-character-sequence-from-a-string", "title": "Remove a Character Sequence From a String", "body": "<p>Consider a function, which takes a string and returns a list of all possible cases in which three subsequent 'X's can be removed from the list.</p>\n\n<p>Example:</p>\n\n<p><code>\"ABXXXDGTJXXXDGXF\"</code> should become</p>\n\n<pre><code>[\"ABDGTJXXXDGXF\", \"ABXXXDGTJDGXF\"]\n</code></pre>\n\n<p>(The order does not matter)</p>\n\n<p>here is a naive implementation:</p>\n\n<pre><code>f :: String -&gt; [String]\nf xs =  go [] xs [] where\n  go left (a:b:c:right) acc =\n    go (left ++ [a]) (b:c:right) y where        -- (1)\n    y = if a == 'X' &amp;&amp; b == 'X' &amp;&amp; c == 'X'\n      then (left ++ right) : acc\n      else acc\n  go _ _ acc = acc\n</code></pre>\n\n<p>I think the main problem here is the line marked with (1). I'm constructing the left side of the list by appending to it, which is generally expensive.</p>\n\n<p>Usually something like this can be solved by this pattern:</p>\n\n<pre><code>f [] = []\nf (x:xs) = x : f xs\n</code></pre>\n\n<p>Or more explicitly:</p>\n\n<pre><code>f [] = []\nf (x:right) = x : left where\n  left = f right\n</code></pre>\n\n<p>Now I'd have the lists right and left in each recursion. However, I need to accumulate them and I could not figure out how to do so here. Or am I on the wrong path?</p>\n\n<hr>\n\n<p><strong>A solution</strong></p>\n\n<p>Inspired by Gurkenglas' propose, here is a bit more generalized version of it:</p>\n\n<pre><code>import Data.Bool\n\nremoveOn :: (String -&gt; Bool) -&gt; Int -&gt; String -&gt; [String]\nremoveOn onF n xs = go xs where\n  go xs | length xs &gt;= n =\n    bool id (right:) (onF mid) $\n    map (head mid:) $\n    go (tail xs)\n    where\n      (mid, right) = splitAt n xs\n  go _ = []\n\nremoveOn (and . map (=='X')) 3 \"ABXXXDGTJXXXDGXF\"\n--&gt; [\"ABDGTJXXXDGXF\",\"ABXXXDGTJDGXF\"]\n</code></pre>\n\n<p>The main idea seems to be the following:\nTraverse the list starting from its end. Make use of a 'look-ahead' mechanism which can examine the next n elements of the list (thus it must be checked, if the current list contains that many elements). By this recursive traversal an accumulating list of results is being enhanced in the cases the following elements pass a truth test. In any way those results must be added the current first element of the list because they stem from shorter lists. This can be done blindly, since adding characters to a result string won't change their property of being a match.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482584504, "post_id": 41313467, "comment_id": 69830213, "body": "You can use Stack to do it: <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#script-interpreter\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE/#script-interpreter</a>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482584870, "post_id": 41313467, "comment_id": 69830304, "body": "@Sibi <code>stack file.hs</code> does not work. If I understand well, it requires some options at the first line of the file. And the example in your link is rather a  &quot;module&quot;, no ?"}, {"owner": {"reputation": 530, "user_id": 2275559, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Qr2dB.jpg?s=128&g=1", "display_name": "Charlie Harding", "link": "https://stackoverflow.com/users/2275559/charlie-harding"}, "edited": false, "score": 0, "creation_date": 1482585006, "post_id": 41313467, "comment_id": 69830336, "body": "<code>ghc -e</code> works for me on GHC 8.0.1.20161117, with the exact command copied from here"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482585303, "post_id": 41313467, "comment_id": 69830411, "body": "Yeah, for the script interpreter to work - there should be a <code>main</code> function IIRC."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 530, "user_id": 2275559, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Qr2dB.jpg?s=128&g=1", "display_name": "Charlie Harding", "link": "https://stackoverflow.com/users/2275559/charlie-harding"}, "edited": false, "score": 0, "creation_date": 1482586295, "post_id": 41313467, "comment_id": 69830632, "body": "@CharlieHarding Thank you for the test. It works with my file example ? On Windows ?"}, {"owner": {"reputation": 530, "user_id": 2275559, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Qr2dB.jpg?s=128&g=1", "display_name": "Charlie Harding", "link": "https://stackoverflow.com/users/2275559/charlie-harding"}, "edited": false, "score": 0, "creation_date": 1482586505, "post_id": 41313467, "comment_id": 69830683, "body": "@St&#233;phaneLaurent I ran it on mac, by pasting the example code into a file, then calling <code>ghc -e &#39;:script file.hs&#39;</code>. This returned  <code>hello</code> <code>4</code> <code>6</code>"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482599345, "post_id": 41314845, "comment_id": 69833967, "body": "The type of quotes used should make absolutely no difference here."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482599565, "post_id": 41314845, "comment_id": 69834019, "body": "@chepner It does, on Windows."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482599600, "post_id": 41314845, "comment_id": 69834028, "body": "@chepner Should I take a screenshot of my terminal in order that you remove your downvote ?.."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482605364, "post_id": 41314845, "comment_id": 69835579, "body": "You should mention that you are using Windows in the question."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482605767, "post_id": 41314845, "comment_id": 69835719, "body": "@chepner Indeed, I have not finished a sentence : &quot;Now I&#39;m using ghc 8.0.1 <i>on Windows</i>&quot;. I thought I had... That&#39;s why I mentioned a different OS in my question. I correct, thank you."}], "tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1482595919, "creation_date": 1482595919, "answer_id": 41314845, "question_id": 41313467, "link": "https://stackoverflow.com/questions/41313467/run-a-script-not-a-module-with-ghc/41314845#41314845", "title": "Run a script (not a module) with ghc", "body": "<p>This works with double quotes:</p>\n\n<pre><code>ghc -e \":script file.hs\"\n</code></pre>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 41314845, "answer_count": 1, "score": 0, "last_activity_date": 1482605801, "creation_date": 1482584248, "last_edit_date": 1482605801, "question_id": 41313467, "link": "https://stackoverflow.com/questions/41313467/run-a-script-not-a-module-with-ghc", "title": "Run a script (not a module) with ghc", "body": "<p>Previously I used <code>ghc</code> version <code>&lt; 8</code> on Linux and when I had a script in a file, say <code>file.hs</code>, like </p>\n\n<pre><code>let x = \"hello\"\nputStrLn x\ndouble x=2*x\nprint $ double 2\ndouble 3\n</code></pre>\n\n<p>then it was possible to run it and get the outputs in a terminal by doing</p>\n\n<pre><code>ghc -e ':script file.hs'\n</code></pre>\n\n<p>Now I'm using <code>ghc 8.0.1</code> on Windows and this does not work anymore. Is there another way ?</p>\n\n<p>I can get the outputs if I open <code>GHCi</code> and type <code>:script file.hs</code>. But I want these outputs in the terminal.</p>\n\n<p>I don't know whether this is due to the upgrade of <code>ghc</code> or to the OS.</p>\n"}, {"tags": ["windows", "haskell", "configuration-files", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1482584532, "post_id": 41313446, "comment_id": 69830222, "body": "Ok thanks, so there are default values if I understand well. It doesn&#39;t seem that everything is relative to <code>prefix</code>, for example <code>libsubdir: $abi\\$libname</code>. Or is <code>libsubdir</code> automatically a subdirectory of <code>libdir</code> ?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1482584673, "post_id": 41313446, "comment_id": 69830257, "body": "@St&#233;phaneLaurent According to the code, yes. See the function <code>appendSubdirs</code> in the module <code>InstallDirs.hs</code> to see why. The best way to understand this and the related things IMO, is to just see the code. :)"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1482589519, "post_id": 41313446, "comment_id": 69831498, "body": "Thank you. It works fine, but I have another point. The package database (packages.conf.d) goes to <code>%APPDATA%&#47;ghc</code> (<code>%APPDATA%</code> is the default path for installation, this is like <code>~</code> on Linux I think). Do you know how to change that ? I tried the <code>package-db</code> option, unsuccessfully."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1482593899, "post_id": 41313446, "comment_id": 69832574, "body": "I&#39;m still interested if you have an idea but I have a workaround. I automatically use a sandbox using the environment variable <a href=\"https://ro-che.info/articles/2014-03-05-cabal-sandbox-tips\" rel=\"nofollow noreferrer\">CABAL_SANDBOX_CONFIG</a>. Then everything is installed in this sandbox, regardless of the current directory. This is not very convenient if I want to use a local sandbox: I have to do <code>cabal --sandbox-config-file=cabal.sandbox.config sandbox init</code> after creating by hand an empty  <code>cabal.sandbox.config</code> file in the current directory. Then I also use the option <code>--sandbox-config-file</code> for <code>cabal install</code>."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1482584099, "creation_date": 1482584099, "answer_id": 41313446, "question_id": 41313014, "link": "https://stackoverflow.com/questions/41313014/path-variables-in-cabal-configuration-file/41313446#41313446", "title": "Path variables in cabal configuration file", "body": "<p>You can refer <a href=\"https://www.stackage.org/haddock/lts-7.14/Cabal-1.24.2.0/Distribution-Simple-InstallDirs.html#t:PathTemplateVariable\" rel=\"nofollow noreferrer\">here</a> to get more details on them.</p>\n\n<p><code>$abi</code> corresponds to <code>AbiVar</code> type.</p>\n\n<p><code>$pkgid</code> corresponds to <code>PkgIdVar</code> type.</p>\n\n<p>They are not defined in the config file. They will be generated by Cabal during the build steps depending on your architecture etc. You can <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#installation-paths\" rel=\"nofollow noreferrer\">see this guide</a> to understand the installation paths.</p>\n\n<p>For my Linux system, their values are:</p>\n\n<p><code>$abi</code> is x86_64-linux-ghc-7.10.3</p>\n\n<p><code>$pkgid</code> refers to package name along with it's version. Example: <code>array-1.2.3.4</code></p>\n\n<p>But if you want to change the location, my advise would be to just change the <code>prefix</code> path as that is the root installation folder. Everything else will be relative to that.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 41313446, "answer_count": 1, "score": 1, "last_activity_date": 1482585769, "creation_date": 1482580450, "last_edit_date": 1482585769, "question_id": 41313014, "link": "https://stackoverflow.com/questions/41313014/path-variables-in-cabal-configuration-file", "title": "Path variables in cabal configuration file", "body": "<p>On Windows, I want to change the default per-user installation directories of <code>cabal</code>. The relevant part of the <code>config</code> file is:</p>\n\n<pre><code>install-dirs user\n  prefix: C:\\path\\to\\my\\folder\n  -- bindir: $prefix\\bin\n  -- libdir: $prefix\n  -- libsubdir: $abi\\$libname\n  -- libexecdir: $prefix\\$libname\n  -- datadir: $prefix\n  -- datasubdir: $abi\\$pkgid\n  -- docdir: $datadir\\doc\\$abi\\$pkgid\n  -- htmldir: $docdir\\html\n  -- haddockdir: $htmldir\n  -- sysconfdir: $prefix\\etc\n</code></pre>\n\n<p>What are <code>$abi</code> and <code>$pkgid</code> ? They are not defined in the <code>config</code> file. Does <code>cabal</code> have a default value for these variables (which ones) ? How/where can I define them ?</p>\n\n<h3>Edit</h3>\n\n<p>@Sibi's answer is perfect. Just to complete the information, I also modified these parameters:</p>\n\n<pre><code>remote-repo-cache: C:\\path\\to\\my\\folder\\packages\nlogs-dir: C:\\path\\to\\my\\folder\\logs\nworld-file: C:\\path\\to\\my\\folder\\world\nbuild-summary: C:\\path\\to\\my\\folder\\logs\\build.log\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 1, "creation_date": 1482580417, "post_id": 41312909, "comment_id": 69829281, "body": "<code>But... I guess IO isn&#39;t like that?</code> Well, <code>IO</code> is a monad and therefore a functor so it is exactly like that but what you are looking for is probably <code>(&gt;&gt;=)</code> - a way to chain monadic computations. Just don&#39;t go reading monad tutorials! Dig into some haskell book."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1482580497, "post_id": 41312909, "comment_id": 69829302, "body": "<code>map double &lt;$&gt; [1,2,3]</code> is a type error unless you&#39;ve done something very strange."}, {"owner": {"reputation": 2162, "user_id": 3204212, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/fd870d2b3afe56cd9c59c28c0fc715bd?s=128&d=identicon&r=PG&f=1", "display_name": "GreenTriangle", "link": "https://stackoverflow.com/users/3204212/greentriangle"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482580864, "post_id": 41312909, "comment_id": 69829391, "body": "Oh good catch @DanielWagner. I meant to write <code>map double &lt;$&gt; [return 1, return 2, return 3]</code>. I had heard that <code>return</code> wrapped a value in the <code>IO</code> context so I was using that to try and test operations on <code>IO Integer</code>s. But I think I was confused, <code>return x</code> seems to make a <code>Monad x</code>, and only an <code>IO x</code> if you&#39;re inside a do-block? Maybe I&#39;ve hit the limit of what I can learn without getting into monads (which my teacher advised to leave until last)..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1482580883, "post_id": 41312909, "comment_id": 69829399, "body": "You know waht <code>&lt;-</code> and <code>do</code> and <code>return</code> do, why not try  them in the <code>then</code> branch?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 2, "creation_date": 1482581231, "post_id": 41312909, "comment_id": 69829470, "body": "What you will do when someone change file-type after you check? I think this approach is not good (on Ruby too)."}, {"owner": {"reputation": 2162, "user_id": 3204212, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/fd870d2b3afe56cd9c59c28c0fc715bd?s=128&d=identicon&r=PG&f=1", "display_name": "GreenTriangle", "link": "https://stackoverflow.com/users/3204212/greentriangle"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482581519, "post_id": 41312909, "comment_id": 69829545, "body": "@freestyle It&#39;s probably not a good solution for actually measuring sizes, I&#39;m not going to actually use it. I just set it as an exercise for myself as Haskell practice."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1482582360, "post_id": 41312909, "comment_id": 69829721, "body": "@GreenTriangle, another way maybe <code>sizeOf pth = </code>getFileSize pth &lt;|&gt; listDirectory pth &gt;&gt;= fmap sum . mapM sizeOf &lt;|&gt; return 0`"}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 5444309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bf5225a7f0542c18486d6371553560?s=128&d=identicon&r=PG&f=1", "display_name": "esjmb", "link": "https://stackoverflow.com/users/5444309/esjmb"}, "edited": false, "score": 0, "creation_date": 1586253555, "post_id": 41313358, "comment_id": 108054262, "body": "forgive me, but listDirectory isn&#39;t recursive?"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 5, "last_activity_date": 1482583267, "creation_date": 1482583267, "answer_id": 41313358, "question_id": 41312909, "link": "https://stackoverflow.com/questions/41312909/io-woes-when-seeking-sizes-of-directory-contents/41313358#41313358", "title": "IO woes when seeking sizes of directory contents?", "body": "<p>You'd need</p>\n\n<pre><code>sum &lt;$&gt; (listDirectory path &gt;&gt;= mapM sizeOf)\n</code></pre>\n\n<p>Explanation:</p>\n\n<ul>\n<li>The idea to use <code>sum</code> over an <code>IO [Integer]</code> is ok, so we need to get such a thing.</li>\n<li><code>listDirectory path</code> gives us <code>IO [FilePath]</code>, so we need to pass each file path to <code>sizeOf</code>. This is what <code>&gt;&gt;=</code> together with <code>mapM</code> does.</li>\n<li>Note that <code>map</code> alone would give us <code>[IO Integer]</code> that is why we need <code>mapM</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 85, "user_id": 5444309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bf5225a7f0542c18486d6371553560?s=128&d=identicon&r=PG&f=1", "display_name": "esjmb", "link": "https://stackoverflow.com/users/5444309/esjmb"}, "is_accepted": false, "score": 1, "last_activity_date": 1501153550, "last_edit_date": 1501153550, "creation_date": 1501153009, "answer_id": 45348795, "question_id": 41312909, "link": "https://stackoverflow.com/questions/41312909/io-woes-when-seeking-sizes-of-directory-contents/45348795#45348795", "title": "IO woes when seeking sizes of directory contents?", "body": "<p>how about (using Control.Monad.Extra):</p>\n\n<pre><code>du :: FilePath -&gt; IO Integer\ndu path = ifM (doesFileExist path)\n              (getFileSize path) $\n              ifM (doesDirectoryExist path)\n                  (sum &lt;$&gt; (listDirectory path &gt;&gt;= mapM (du . \n                             (addTrailingPathSeparator path ++))))\n                  (return 0)\n</code></pre>\n\n<p>I believe you need to add the path to the output of <code>listDirectory</code> for successful recursive descent as <code>listDirectory</code> only returns filenames without the path, which is required for the subsequent calls to du. </p>\n\n<p>The type of <code>ifM</code> is probably obvious, but is <code>ifM :: Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a</code></p>\n"}], "owner": {"reputation": 2162, "user_id": 3204212, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/fd870d2b3afe56cd9c59c28c0fc715bd?s=128&d=identicon&r=PG&f=1", "display_name": "GreenTriangle", "link": "https://stackoverflow.com/users/3204212/greentriangle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 41313358, "answer_count": 2, "score": 5, "last_activity_date": 1501153550, "creation_date": 1482579664, "last_edit_date": 1482580726, "question_id": 41312909, "link": "https://stackoverflow.com/questions/41312909/io-woes-when-seeking-sizes-of-directory-contents", "title": "IO woes when seeking sizes of directory contents?", "body": "<p>I'm learning Haskell, and my goal today is to write a function <code>sizeOf :: FilePath -&gt; IO Integer</code> (calculate the size of a file or folder), with the logic</p>\n\n<ul>\n<li>If <code>path</code> is a file, <code>System.Directory.getFileSize path</code></li>\n<li>If <code>path</code> is a directory, get a list of its contents, recursively run this function on them, and <code>sum</code> the results</li>\n<li>If it's something other than a file or directory, <code>return 0</code></li>\n</ul>\n\n<p>Here's how I'd implement it in Ruby, to illustrate (Ruby notes: <code>map</code>'s argument is the equivalent of <code>\\d -&gt; size_of d</code>, <code>reduce :+</code> is <code>foldl (+) 0</code>, any function ending <code>?</code> returns a bool, returns are implicit):</p>\n\n<pre><code>def size_of path\n  if File.file? path\n    File.size path\n  elsif File.directory? path\n    Dir.glob(path + '/*').map { |d| size_of d }.reduce :+\n  end\nend\n</code></pre>\n\n<p>Here's my crack at it in Haskell:</p>\n\n<pre><code>  sizeOf :: FilePath -&gt; IO Integer\n  sizeOf path =\n    do\n      isFile &lt;- doesFileExist path\n      if isFile then\n        getFileSize path\n      else do\n        isDir &lt;- doesDirectoryExist path\n        if isDir then\n          sum $ map sizeOf $ listDirectory path\n        else\n          return 0\n</code></pre>\n\n<p>I know where my problem is. <code>sum $ map sizeOf $ listDirectory path</code>, where <code>listDirectory path</code> returns an <code>IO [FilePath]</code> and not a <code>FilePath</code>. But... I can't really imagine any solution solving this. <code>&lt;$&gt;</code> instead of <code>$</code> was the first thing that came to mind, since <code>&lt;$&gt;</code> I understood to be something that let a function of <code>a -&gt; b</code> become a <code>Context a -&gt; Context b</code>. But... I guess IO isn't like that? </p>\n\n<p>I spent about two hours puzzling over the logic there. I tried it on other examples. Here's a relevant discovery that threw me: if <code>double = (*) 2</code>, then <code>map double [1,2,3] == [2,4,6]</code>, but <code>map double &lt;$&gt; [return 1, return 2, return 3] == [[2],[4],[6]]</code>... it wraps them in a list. I think that's what happening to me but I'm way out of my depth.</p>\n"}, {"tags": ["haskell", "monads", "composition"], "comments": [{"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 3, "creation_date": 1482554825, "post_id": 41310361, "comment_id": 69824126, "body": "That&#39;s not function composition, which would be <code>(g . f) x</code>. Secondly the result of <code>f x</code> is not needed, since haskell has call by need aka lazy evaluation. <code>f</code> will be applied as late as possible, I.e. when printing <code>result</code>. Finally, yes, monads create something like hidden parameters, that represent the state of the world, and chains those parameters between the actions  so that despite the lazy evaluation, the effects will happen in the order that is intended"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482589132, "post_id": 41310361, "comment_id": 69831385, "body": "It doesn&#39;t type-check, either. <code>f g x</code> is the same as <code>(f g) x</code>, so you would be trying to add 1 to a function."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1535621783, "post_id": 41310361, "comment_id": 91137415, "body": "C&#39;mon, the OP obv meant <code>f (g x)</code>, and yes, it could be that it requires <code>g x</code> to be computed &quot;before&quot; <code>f</code>, <i>if</i> <code>f</code> is strict in its argument. But if <code>f</code> is lazy, it might not be. Here though, this specific <code>f</code> <i>is</i> strict, because <code>+</code> is."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1482563071, "post_id": 41310465, "comment_id": 69825529, "body": "I <i>really</i> don\u2019t want to come off as negative or antagonistic, but I\u2019m not sure how else to say this: I don\u2019t like this answer much at all. It reads more like a rambling monad tutorial blog post than an attempt to answer OP\u2019s fairly specific question, and even as a seasoned Haskeller, I don\u2019t find it terribly readable. It seems to make the argument that monads are patterns, which is good, but the bulk of the answer is spent saying \u201chere\u2019s what a monad is; it\u2019s a math thing; it has some operations and laws\u201d then saying \u201cand lo, the IO monad\u201d, which doesn\u2019t seem very compelling at all."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1482625408, "post_id": 41310465, "comment_id": 69839427, "body": "@AlexisKing Thanks for the feedback; it is not received as negative or antagonistic. It is indeed more rambling than I&#39;d have normally done; that&#39;s partly because it was composed in a rush, and partly because I really think that people don&#39;t grok the IO monad until they realize that they&#39;re doing metaprogramming."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1535787182, "last_edit_date": 1535787182, "creation_date": 1482555750, "answer_id": 41310465, "question_id": 41310361, "link": "https://stackoverflow.com/questions/41310361/monads-composition-and-the-order-of-computation/41310465#41310465", "title": "Monads, composition and the order of computation", "body": "<p>Yes, monads use function composition to sequence effects, and are not the only way to achieve sequenced effects. </p>\n\n<h1>Strict semantics and side effects</h1>\n\n<p>In most languages, there is sequencing by strict semantics applied first to the function side of an expression, then to each argument in turn, and finally the function is applied to the arguments. So in JS, the function application form,</p>\n\n<pre><code>&lt;Code 1&gt;(&lt;Code 2&gt;, &lt;Code 3&gt;)\n</code></pre>\n\n<p>runs <em>four</em> pieces of code in a specified order: 1, 2, 3, then it checks that the output of 1 was a function, then it calls the function with those two computed arguments. And it does this because <strong>any</strong> of those steps can have side-effects. You would write,</p>\n\n<pre><code>const logVal = (log, val) =&gt; {\n  console.log(log);\n  return val;\n};\nlogVal(1, (a, b) =&gt; logVal(4, a+b))(\n  logVal(2, 2),\n  logVal(3, 3));\n</code></pre>\n\n<p>And that works for those languages. These are <em>side-effects</em>, which we can say in this context means that JS's type system doesn't give you any way to know that they are there.</p>\n\n<p>Haskell does have a strict application primitive, but it wanted to be <em>pure</em>, which roughly means that it wanted the type system to track effects. So they introduced a form of <em>metaprogramming</em> where one of their types is a type-level adjective, \u201cprograms which compute a _____\u201d. A program interacts with the real world; Haskell code in theory doesn't. You have to define \u201c<code>main</code> is a program which computes a unit type\u201d and then the compiler actually just <em>builds that program</em> for you as an executable binary file. By the time that file is <em>run</em> Haskell is not really in the picture any more!</p>\n\n<p>This is therefore <em>more specific</em> than normal function application, because the abstract problem I wrote in JavaScript is,</p>\n\n<ol>\n<li>I have a program which computes {a function from (X, Y) pairs to programs which compute Zs}.</li>\n<li>I also have a program which computes an X, and a program which computes a Y. </li>\n<li>I want to put these all together into a program which computes a Z.</li>\n</ol>\n\n<p>That's not <em>just</em> function composition itself. But a function <strong>can do</strong> that.</p>\n\n<h1>Peeking inside monads</h1>\n\n<p>A monad is a pattern. The pattern is, sometimes you have an adjective which does not add much when you repeat it. For example there is not much added when you say \"a <em>delayed</em> delayed x\" or \"zero or more (zero or more xs)\" or \"either a null or else either a null or else an x.\" Similarly for the IO monad, not much is added by \"a program to compute a program to compute an x\" that is not available in \"a program to compute an x.\"</p>\n\n<p>The pattern is that there is some canonical merging algorithm which merges:</p>\n\n<blockquote>\n  <p>join: given an <code>&lt;adjective&gt; &lt;adjective&gt; x</code>, I will make you an <code>&lt;adjective&gt; x</code>.</p>\n</blockquote>\n\n<p>We also add two other properties, the adjective should be <em>outputtish</em>, </p>\n\n<blockquote>\n  <p>map: given an <code>x -&gt; y</code> and an <code>&lt;adjective&gt; x</code>, I will make you an <code>&lt;adjective&gt; y</code></p>\n</blockquote>\n\n<p>and <em>universally embeddable</em>, </p>\n\n<blockquote>\n  <p>pure: given an <code>x</code>, I will make you an <code>&lt;adjective&gt; x</code>.</p>\n</blockquote>\n\n<p>Given these three things and a couple axioms you happen to have a common \"monad\" idea which you can develop One True Syntax for.</p>\n\n<p>Now this metaprogramming idea obviously contains a monad. In JS we would write,</p>\n\n<pre class=\"lang-ts prettyprint-override\"><code>interface IO&lt;x&gt; {\n  run: () =&gt; Promise&lt;x&gt;\n}\nfunction join&lt;x&gt;(pprog: IO&lt;IO&lt;x&gt;&gt;): IO&lt;x&gt; {\n  return { run: () =&gt; pprog.run().then(prog =&gt; prog.run()) };\n}\nfunction map&lt;x, y&gt;(prog: IO&lt;x&gt;, fn: (in: x) =&gt; y): IO&lt;y&gt; {\n  return { run: () =&gt; prog.run().then(x =&gt; fn(x)) }\n}\nfunction pure&lt;x&gt;(input: x): IO&lt;x&gt; {\n  return { run: () =&gt; Promise.resolve(input) }\n}\n// with those you can also define,\nfunction bind&lt;x, y&gt;(prog: IO&lt;x&gt;, fn: (in: x) =&gt; IO&lt;y&gt;): IO&lt;y&gt; {\n  return join(map(prog, fn));\n}\n</code></pre>\n\n<p>But the fact that a pattern exists does not mean it is useful! I am claiming that these functions turn out to be <em>all you need</em> to resolve the problem above. And it is not hard to see why: you can use <code>bind</code> to create a function scope inside of which the adjective doesn't exist, and manipulate your values there:</p>\n\n<pre class=\"lang-ts prettyprint-override\"><code>function ourGoal&lt;x, y, z&gt;(\n  fnProg: IO&lt;(inX: x, inY: y) =&gt; IO&lt;z&gt;&gt;,\n  xProg: IO&lt;x&gt;,\n  yProg: IO&lt;y&gt;): IO&lt;z&gt; {\n    return bind(fnProg, fn =&gt;\n      bind(xProg, x =&gt;\n        bind(yProg, y =&gt; fn(x, y))));\n}\n</code></pre>\n\n<h1>How this answers your question</h1>\n\n<p>Notice that in the above we <strong>choose</strong> an order of operations by how we write the three <code>bind</code>s. We could have written those in some other order. But we needed all the parameters to run the final program.</p>\n\n<p>This choice of how we sequence our operations is indeed <em>realized</em> in the function calls: <strong>you are 100% right.</strong> But the way that you are doing it, with <em>only</em> function composition, is flawed because it demotes the effects down to side-effects in order to get the types through.</p>\n"}, {"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1482565895, "post_id": 41311273, "comment_id": 69826090, "body": "IMO this question is not really about laziness or strict evaluation order but about how the monadic interface allows sequencing of effects and what it provides over ordinary Haskell evaluation (whether it\u2019s lazy or not). See my overly long answer for what I <i>think</i> OP was asking, and feel free to correct me if you think I\u2019m wildly off-base."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1482569317, "post_id": 41311273, "comment_id": 69826716, "body": "@AlexisKing Laziness is absolutely at the heart of the matter: the use of monads became popular in Haskell precisely because, unlike strict languages, lazy languages can leave some things completely unevaluated and therefore if we left &quot;effectful&quot; things in the lazy fragment those effects might never happen at all! Monads turned out to be useful in their own right later; but originally, they were there to <i>solve a problem</i>, and my view is that this question is precisely asking why the naive, pure solution to that problem isn&#39;t good enough."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1482573776, "post_id": 41311273, "comment_id": 69827725, "body": "Hmm, that\u2019s fair, even if I don\u2019t agree completely (I think that line of reasoning mostly applies to <code>IO</code>, but while <code>IO</code> may have been the driving force behind the invention of monads, the history is somewhat irrelevant for new learners). I don\u2019t know the history of the \u201cdiscovery\u201d of monads, and if you had any literature on their introduction I would be very interested in reading it. IMO, though, I think I disagree with your last sentence: my answer specifically describes why the idea of monadic effects <i>is</i> pure aside from <code>IO</code>. Only OP can give clarification on the intent, though."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1482564244, "creation_date": 1482564244, "answer_id": 41311273, "question_id": 41310361, "link": "https://stackoverflow.com/questions/41310361/monads-composition-and-the-order-of-computation/41311273#41311273", "title": "Monads, composition and the order of computation", "body": "<p>Yes, the functions you proposed are strict for the standard numerical types. But not all functions are! In</p>\n\n<pre><code>f _ = 3\ng x = x * 2\nresult = f (g x)\n</code></pre>\n\n<p>it is <em>not</em> the case that <code>g x</code> must be computed before <code>f (g x)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 13, "last_activity_date": 1535784460, "last_edit_date": 1535784460, "creation_date": 1482565795, "answer_id": 41311433, "question_id": 41310361, "link": "https://stackoverflow.com/questions/41310361/monads-composition-and-the-order-of-computation/41311433#41311433", "title": "Monads, composition and the order of computation", "body": "<p><strong>Disclaimer</strong>: Monads are a lot of things. They are notoriously difficult to explain, so I will not attempt to explain what monads are <em>in general</em> here, since the question does not ask for that. I will assume you have a basic grasp on what the <code>Monad</code> interface is as well as how it works for some useful datatypes, like <code>Maybe</code>, <code>Either</code>, and <code>IO</code>.</p>\n\n<hr>\n\n<h1>What is an effect?</h1>\n\n<p>Your question begins with a note:</p>\n\n<blockquote>\n  <p>All the monad articles often state, that monads allow you to sequence effects in order.</p>\n</blockquote>\n\n<p>Hmm. This is interesting. In fact, it is interesting for a couple reasons, one of which you have identified: it implies that monads let you create some sort of sequencing. That\u2019s true, but it\u2019s only part of the picture: it <em>also</em> states that sequencing happens on <strong>effects</strong>.</p>\n\n<p>Here\u2019s the thing, though\u2026 what is an \u201ceffect\u201d? Is adding two numbers together an effect? Under most definitions, the answer would be no. What about printing something to stdout, is that an effect? In that case, I think most people would agree that the answer is yes. However, consider something more subtle: is short-circuiting a computation by producing <code>Nothing</code> an effect?</p>\n\n<h2>Error effects</h2>\n\n<p>Let\u2019s take a look at an example. Consider the following code:</p>\n\n<pre><code>&gt; do x &lt;- Just 1\n     y &lt;- Nothing\n     return (x + y)\nNothing\n</code></pre>\n\n<p>The second line of that example \u201cshort-circuits\u201d due to the <code>Monad</code> instance for <code>Maybe</code>. Could that be considered an effect? In some sense, I think so, since it\u2019s non-local, but in another sense, probably not. After all, if the <code>x &lt;- Just 1</code> or <code>y &lt;- Nothing</code> lines are swapped, the result is still the same, so the ordering doesn\u2019t matter.</p>\n\n<p>However, consider a slightly more complex example that uses <code>Either</code> instead of <code>Maybe</code>:</p>\n\n<pre><code>&gt; do x &lt;- Left \"x failed\"\n     y &lt;- Left \"y failed\"\n     return (x + y)\nLeft \"x failed\"\n</code></pre>\n\n<p>Now this is more interesting. If you swap the first two lines now, you get a different result! Still, is this a representation of an \u201ceffect\u201d like the ones you allude to in your question? After all, it\u2019s just a bunch of function calls. As you know, <code>do</code> notation is just an alternative syntax for a bunch of uses of the <code>&gt;&gt;=</code> operator, so we can expand it out:</p>\n\n<pre><code>&gt; Left \"x failed\" &gt;&gt;= \\x -&gt;\n    Left \"y failed\" &gt;&gt;= \\y -&gt;\n      return (x + y)\nLeft \"x failed\"\n</code></pre>\n\n<p>We can even replace the <code>&gt;&gt;=</code> operator with the <code>Either</code>-specific definition to get rid of monads entirely:</p>\n\n<pre><code>&gt; case Left \"x failed\" of\n    Right x -&gt; case Left \"y failed\" of\n      Right y -&gt; Right (x + y)\n      Left e -&gt; Left e\n    Left e -&gt; Left e\nLeft \"x failed\"\n</code></pre>\n\n<p>Therefore, it\u2019s clear that monads do impose some sort of sequencing, but this is not because they are monads and monads are magic, it\u2019s just because they happen to enable a style of programming that <em>looks</em> more impure than Haskell typically allows.</p>\n\n<h2>Monads and state</h2>\n\n<p>But perhaps that is unsatisfying to you. Error handling is not compelling because it is simply short-circuiting, it doesn\u2019t actually have any sequencing in the result! Well, if we reach for some slightly more complex types, we can do that. For example, consider the <code>Writer</code> type, which allows a sort of \u201clogging\u201d using the monadic interface:</p>\n\n<pre><code>&gt; execWriter $ do\n    tell \"hello\"\n    tell \" \"\n    tell \"world\"\n\"hello world\"\n</code></pre>\n\n<p>This is even more interesting than before, since now the result of each computation in the <code>do</code> block is unused, but it still affects the output! This is clearly side-effectful, and order is clearly very important! If we reorder the <code>tell</code> expressions, we would get a very different result:</p>\n\n<pre><code>&gt; execWriter $ do\n    tell \" \"\n    tell \"world\"\n    tell \"hello\"\n\" worldhello\"\n</code></pre>\n\n<p>But how is this possible? Well, again, we can rewrite it to avoid <code>do</code> notation:</p>\n\n<pre><code>execWriter (\n  tell \"hello\" &gt;&gt;= \\_ -&gt;\n    tell \" \" &gt;&gt;= \\_ -&gt;\n      tell \"world\")\n</code></pre>\n\n<p>We could inline the definition of <code>&gt;&gt;=</code> again for <code>Writer</code>, but it\u2019s too long to be terribly illustrative here. The point is, though, that <code>Writer</code> is just a completely ordinary Haskell datatype that doesn\u2019t do any I/O or anything like that, and yet we have used the monadic interface to create something that looks like ordered effects.</p>\n\n<p>We can go even further by creating an interface that looks like <em>mutable state</em> using the <code>State</code> type:</p>\n\n<pre><code>&gt; flip execState 0 $ do\n    modify (+ 3)\n    modify (* 2)\n6\n</code></pre>\n\n<p>Once again, if we reorder the expressions, we get a different result:</p>\n\n<pre><code>&gt; flip execState 0 $ do\n    modify (* 2)\n    modify (+ 3)\n3\n</code></pre>\n\n<p>Clearly, monads are a useful tool for creating interfaces that <em>look</em> stateful and have a well-defined ordering despite actually just being ordinary function calls.</p>\n\n<h1>Why can monads do this?</h1>\n\n<p>What gives monads this power? Well, they\u2019re not magic\u2014they\u2019re just ordinary pure Haskell code. But consider the type signature for <code>&gt;&gt;=</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Notice how the second argument depends on <code>a</code>, and the only way to get an <code>a</code> is from the first argument? This means that <code>&gt;&gt;=</code> needs to \u201crun\u201d the first argument to produce a value <em>before</em> it can apply the second argument. This doesn\u2019t have to do with evaluation order so much as it has to do with actually writing code that will typecheck.</p>\n\n<p>Now, it\u2019s true that Haskell is a lazy language. But Haskell\u2019s laziness doesn\u2019t really matter for any of this because all of this code is actually pure, even the example using <code>State</code>! It\u2019s simply a pattern that encodes computations that look sort of stateful in a pure way, but if you actually implemented <code>State</code> yourself, you\u2019d find that it just passes around the \u201ccurrent state\u201d in the definition of the <code>&gt;&gt;=</code> function. There\u2019s not any actual mutation.</p>\n\n<p>And that\u2019s it. Monads, by virtue of their interface, impose an ordering on how their arguments may be evaluated, and instances of <code>Monad</code> exploit that to make stateful-looking interfaces. You don\u2019t <em>need</em> <code>Monad</code> to have evaluation ordering, though, as you found; obviously in <code>(1 + 2) * 3</code> the addition will be evaluated before the multiplication.</p>\n\n<h1>But what about <code>IO</code>??</h1>\n\n<p>Okay, you got me. Here\u2019s the problem: <code>IO</code> is magic.</p>\n\n<p><strong>Monads are not magic, but <code>IO</code> is.</strong> All of the above examples are purely functional, but obviously reading a file or writing to stdout is not pure. So how the heck does <code>IO</code> work?</p>\n\n<p>Well, <code>IO</code> is implemented by the GHC runtime, and you could not write it yourself. However, in order to make it work nicely with the rest of Haskell, there needs to be a well-defined evaluation order! Otherwise things would get printed out in the wrong order and all sorts of other hell would break loose.</p>\n\n<p>Well, it turns out the <code>Monad</code>\u2019s interface is a great way to ensure that evaluation order is predictable, since it works for pure code already. So <code>IO</code> leverages the same interface to guarantee the evaluation order is the same, and the runtime actually defines what that evaluation means.</p>\n\n<p><strong>However, don\u2019t be misled! You don\u2019t need monads to do I/O in a pure language, and you don\u2019t need <code>IO</code> to have monadic effects.</strong> <a href=\"https://stackoverflow.com/a/17004448/465378\">Early versions of Haskell experimented with a non-monadic way to do I/O</a>, and the other parts of this answer explain how you can have pure monadic effects. Remember that monads are not special or holy, they\u2019re just a pattern that Haskell programmers have found useful because of its various properties.</p>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 41311433, "answer_count": 3, "score": 3, "last_activity_date": 1535787182, "creation_date": 1482554271, "question_id": 41310361, "link": "https://stackoverflow.com/questions/41310361/monads-composition-and-the-order-of-computation", "title": "Monads, composition and the order of computation", "body": "<p>All the monad articles often state, that monads allow you to sequence effects in order.</p>\n\n<p>But what about simple composition? Ain't </p>\n\n<pre><code>f x = x + 1\ng x = x * 2\n\nresult = f g x\n</code></pre>\n\n<p>requires <code>g x</code> to be computed before <code>f ...</code>?</p>\n\n<p>Do monads do the same but with handling of effects?</p>\n"}, {"tags": ["haskell", "recursion", "encoding", "tree", "huffman-code"], "answers": [{"comments": [{"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482574791, "post_id": 41309400, "comment_id": 69827977, "body": "Thanks for you solution! However, I&#39;ve only used some basic folds until now and I am a bit lost on how exactly your solution works. I&#39;d greatly appreciate some further explanation (especially on &#39;go&#39; and &#39;run&#39;, as the names are not really suggestive, and the arguments of the fold)"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 1, "last_activity_date": 1482540874, "creation_date": 1482540874, "answer_id": 41309400, "question_id": 41309180, "link": "https://stackoverflow.com/questions/41309180/reconstructing-huffman-tree-from-preorder-bitstring-in-haskell/41309400#41309400", "title": "Reconstructing Huffman tree from (preorder) bitstring in Haskell", "body": "<p>do a right fold:</p>\n\n<pre><code>import Data.Char (chr)\n\ndata Tree a = Leaf a | Node (Tree a) (Tree a)\n  deriving Show\n\nbuild :: [Int] -&gt; [Tree Char]\nbuild xs = foldr go (\\_ _ -&gt; []) xs 0 0\n  where\n  nil = Leaf '?'\n  go 0 run 0 0 = case run 0 0 of\n    []     -&gt; Node nil nil:[]\n    x:[]   -&gt; Node x   nil:[]\n    x:y:zs -&gt; Node x   y  :zs\n\n  go 1 run 0 0 = run 0 1\n  go _ _   _ 0 = error \"this should not happen!\"\n  go x run v 7 = (Leaf $ chr (v * 2 + x)): run 0 0\n  go x run v k = run (v * 2 + x) (k + 1)\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; head $ build [0,0,0,1,1,1,0, ...] -- the list of 01s as in the question\nNode (Node (Node (Leaf 'k') (Leaf 't'))\n      (Node (Node (Leaf 'q') (Leaf 'g')) (Leaf 'r')))\n (Node (Leaf 'w') (Leaf 'a'))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482574606, "post_id": 41309649, "comment_id": 69827925, "body": "Thank you for your very detailed answer! However, I think that this solution is beyond the scope of this exercise and my knowledge of Haskell at this moment. I will however come back to this when I become more comfortable with Haskell&#39;s more advanced topics (also any suggestions on how to improve on functional programming beyond an introductory course is welcome!)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482576037, "post_id": 41309649, "comment_id": 69828270, "body": "@David More than happy to answer any questions you have about my code! My favourite introductory Haskell book is <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\"><i>Learn You A Haskell</i></a> which you can read online for free - it&#39;s readable and funny and it contains an accessible exposition of monads &amp; co."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1483323551, "last_edit_date": 1483323551, "creation_date": 1482544433, "answer_id": 41309649, "question_id": 41309180, "link": "https://stackoverflow.com/questions/41309180/reconstructing-huffman-tree-from-preorder-bitstring-in-haskell/41309649#41309649", "title": "Reconstructing Huffman tree from (preorder) bitstring in Haskell", "body": "<p>Well, you're trying to parse a tree of bytes from a bit-stream. Parsing's one of those cases where it pays to set up some structure: we're going to write a miniature parser combinator library in the style of <a href=\"https://rkrishnan.org/files/wadler-1985.pdf\" rel=\"nofollow noreferrer\"><em>How to Replace Failure by a List of Successes</em></a>, which will allow us to write our code in an idiomatic functional style and delegate a lot of the work to the machine.</p>\n\n<p>Translating <a href=\"http://www.willamette.edu/~fruehr/haskell/seuss.html\" rel=\"nofollow noreferrer\">the old rhyme</a> into the language of monad transformers, and reading \"string\" as \"bit-string\", we have</p>\n\n<pre><code>newtype Parser a = Parser (StateT [Bool] [] a)\n    deriving (Functor, Applicative, Monad, Alternative)\n\nrunParser :: Parser a -&gt; [Bool] -&gt; [(a, [Bool])]\nrunParser (Parser m) = runStateT m\n</code></pre>\n\n<p>A parser is a monadic computation which operates statefully on a stream of Booleans, yielding a collection of successfully-parsed <code>a</code>s. GHC's <code>GeneralizedNewtypeDeriving</code> superpowers allow me to elide the boilerplate instances of <code>Monad</code> et al.</p>\n\n<p>The goal, then, is to write a <code>Parser (Tree SevenBits)</code> - a parser which returns a tree of septuples of Booleans. (You can turn the 7 bits into a <code>Word8</code> at your leisure by <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#deriving-functor-instances\" rel=\"nofollow noreferrer\">deriving a <code>Functor</code> instance</a> for <code>Tree</code> and using <code>fmap</code>.) I'm going to use the following definition of <code>Tree</code> because it's simpler - I'm sure you can figure out how to adapt this code to your own ends.</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) (Tree a) deriving Show\n\ntype SevenBits = (Bool, Bool, Bool, Bool, Bool, Bool, Bool)\n</code></pre>\n\n<p>Here's a parser that attempts to consume a single bit from the input stream, failing if it's empty:</p>\n\n<pre><code>one :: Parser Bool\none = Parser $ do\n    stream &lt;- get\n    case stream of\n        [] -&gt; empty\n        (x:xs) -&gt; put xs *&gt; return x\n</code></pre>\n\n<p>Here's one which attempts to consume a <em>particular</em> bit from the input stream, failing if it doesn't match:</p>\n\n<pre><code>bit :: Bool -&gt; Parser ()\nbit b = do\n    i &lt;- one\n    guard (i == b)\n</code></pre>\n\n<p>Here I'm pulling a sequence of seven Booleans from the input stream using <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:replicateM\" rel=\"nofollow noreferrer\"><code>replicateM</code></a> and packing them into a tuple. We'll be using this to populate <code>Leaf</code> nodes' contents.</p>\n\n<pre><code>sevenBits :: Parser SevenBits\nsevenBits = pack7 &lt;$&gt; replicateM 7 one\n    where pack7 [a,b,c,d,e,f,g] = (a, b, c, d, e, f, g)\n</code></pre>\n\n<p>Now we can finally write the code which parses the tree structure itself. We'll be choosing between the <code>Node</code> and <code>Leaf</code> alternatives using <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:-60--124--62-\" rel=\"nofollow noreferrer\"><code>&lt;|&gt;</code></a>.</p>\n\n<pre><code>tree :: Parser (Tree SevenBits)\ntree = node &lt;|&gt; leaf\n    where node = bit False *&gt; liftA2 Node tree tree\n          leaf = bit True *&gt; fmap Leaf sevenBits\n</code></pre>\n\n<p>If <code>node</code> succeeds in parsing a low bit from the head of the stream, it continues to recursively parse the encoding of the left subtree followed by the right subtree, sequencing the applicative actions with <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:liftA2\" rel=\"nofollow noreferrer\"><code>liftA2</code></a>. The trick is that <code>node</code> fails if it doesn't encounter a low bit at the head of the input stream, which tells <code>&lt;|&gt;</code> to give up on <code>node</code> and try <code>leaf</code> instead.</p>\n\n<p>Note how the structure of <code>tree</code> reflects the structure of the <code>Tree</code> type itself. This is applicative parsing at work. We could alternately have structured this parser monadically, first using <code>one</code> to parse an arbitrary bit and then using a <code>case</code> analysis on the bit to determine whether we should continue to parse a pair of trees or a leaf. In my opinion this version is simpler, more declarative, and less verbose.</p>\n\n<p>Also compare the clarity of this code to the low-level style of @behzad.nouri's <code>foldr</code>-based solution. Rather than building an explicit finite-state machine which switches between parsing nodes and leaves - an imperative-flavoured idea - my design allows you to declaratively describe the grammar to the machine using standard functions like <code>liftA2</code> and <code>&lt;|&gt;</code> and trust that the abstractions will do the right thing.</p>\n\n<p>Anyway, here I'm parsing a simple tree consisting of a pair of <code>Leaf</code>s containing the (binary-encoded) numbers <code>0</code> and <code>1</code>. As you can see, it returns the single successful parse and an empty stream of remaining bits.</p>\n\n<pre><code>ghci&gt; runParser tree $ map (&gt;0) [0, 1, 0,0,0,0,0,0,0, 1, 0,0,0,0,0,0,1]\n[(Node (Leaf (False, False, False, False, False, False, False)) (Leaf (False, False, False, False, False, False, True)),[])]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "edited": false, "score": 0, "creation_date": 1482575064, "post_id": 41309952, "comment_id": 69828054, "body": "This is exactly what I&#39;ve been looking for! It&#39;s an elegant and concise solution. I&#39;ve been thinking of somehow computing the left and right branches recursively, but couldn&#39;t figure out how to feed the appropriate list into the call for right. Returning the list in a pair is a clever idea!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1482584429, "post_id": 41309952, "comment_id": 69830202, "body": "For what it&#39;s worth, this is essentially a written-out version of the <code>State</code> monad."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1482592841, "post_id": 41309952, "comment_id": 69832355, "body": "Yes, it is in fact a <code>State</code> monad. More precisely, it&#39;s a <code>Parser</code>monad that works over <code>[Int]</code>."}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 1, "last_activity_date": 1482548660, "creation_date": 1482548660, "answer_id": 41309952, "question_id": 41309180, "link": "https://stackoverflow.com/questions/41309180/reconstructing-huffman-tree-from-preorder-bitstring-in-haskell/41309952#41309952", "title": "Reconstructing Huffman tree from (preorder) bitstring in Haskell", "body": "<p>Ok, here's a simple (ad-hoc, but easier to understand) way.</p>\n\n<p>We need to buid a function <code>parse</code>, with the following type:</p>\n\n<pre><code>parse  :: [Int] -&gt; Tree Char\n</code></pre>\n\n<p>The approach you mentioned, with stacks, is the imperative one. Here we just lay on the recursive calls. The stack will be built by the compiler and it will just have each recursive call stored in it (At least you can imagine it that way, if you want, or just ignore all this paragraph).</p>\n\n<p>So, the idea is the following: whenever you find a <code>0</code>, you need to make two recursive calls to the algorithm. The first recursive call will read one branch (the left one) of the tree. The second one needs to be called with the rest of the list as argument. The rest left by the first recursive call. So, we need a auxiliar function <code>parse'</code> with the following type (now we return a pair, being the second value the <em>rest of list</em>):</p>\n\n<pre><code>parse' :: [Int] -&gt; (Tree Char, [Int])\n</code></pre>\n\n<p>Next, you can see a piece of code where the <code>0</code> case is just as described before.<br>\nFor the <code>1</code> case, we just need to take the next 7 numbers and make them into a char somehow (I leave the definition of <code>toChar</code> for you), then, just return a <code>Leaf</code> and the rest of the list.</p>\n\n<pre><code>parse' (0:xs) = let (l, xs')    = parse' xs\n                    (r, xs'')   = parse' xs' in (Node 0 l r, xs'') --xs'' should be []\nparse' (1:xs) = let w = toChar (take 7 xs) in (Leaf 0 w , drop 7 xs)\n</code></pre>\n\n<p>Finally, our parse function just calls the auxiliary parse one and returns the first element of the pair. </p>\n\n<pre><code>parse xs = fst $ parse' xs\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 41309952, "answer_count": 3, "score": 4, "last_activity_date": 1483323551, "creation_date": 1482538447, "question_id": 41309180, "link": "https://stackoverflow.com/questions/41309180/reconstructing-huffman-tree-from-preorder-bitstring-in-haskell", "title": "Reconstructing Huffman tree from (preorder) bitstring in Haskell", "body": "<p>I have the following Haskell polymorphic data type:</p>\n\n<pre><code>data Tree a = Leaf Int a | Node Int (Tree a) (Tree a)\n</code></pre>\n\n<p>The tree will be compressed in a bitstring of 0s and 1s. A '0' signifies a Node and it is followed by the encoding of the left subtree, then the encoding of the right subtree. A '1' signifies a Leaf and is followed by 7 bits of information (for example it might be a char). Each node/leaf is supposed to also contain the frequency of the information stored, but this is not important for this problem (so we can put anything there).</p>\n\n<p>For example, starting from this encoded tree</p>\n\n<pre><code>[0,0,0,1,1,1,0,1,0,1,1,1,1,1,1,0,1,0,0,0,0,1,1,1,1,0,0,0,1,1,1,\n 1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1]\n</code></pre>\n\n<p>it is supposed to give back something like this</p>\n\n<pre><code>Node 0 (Node 0 (Node 0 (Leaf 0 'k') (Leaf 0 't')) \n       (Node 0 (Node 0 (Leaf 0 'q') (Leaf 0 'g')) (Leaf 0 'r'))) \n(Node 0 (Leaf 0 'w') (Leaf 0 'a'))\n</code></pre>\n\n<p>(spacing is not important, but it did not fit on one line).</p>\n\n<p>I have little experience working with trees, especially when implementing code. I have a vague idea about how I'd solve this on paper (using something similar to a stack to deal with the depth/levels) but I am still a bit lost.</p>\n\n<p>Any help or ideas are appreciated!</p>\n"}, {"tags": ["haskell", "pointfree"], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": false, "score": 2, "last_activity_date": 1482536065, "last_edit_date": 1482536065, "creation_date": 1482535088, "answer_id": 41308857, "question_id": 41308815, "link": "https://stackoverflow.com/questions/41308815/haskell-function-rewrite-without-bind-return/41308857#41308857", "title": "Haskell function rewrite without bind return", "body": "<p>Self, as you googled for how to pronounce \"&lt;-\" you discovered that I think you were looking for:</p>\n\n<pre><code>main4 :: IO ()\nmain4 = (fmap show $ fmap getit good) &gt;&gt;= putStrLn\n</code></pre>\n\n<p>From here:</p>\n\n<p><a href=\"https://wiki.haskell.org/IO_inside\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/IO_inside</a></p>\n\n<blockquote>\n  <p>A more complex example involves the binding of variables using \"&lt;-\":</p>\n  \n  <p>main = do a &lt;- readLn\n            print a This code is desugared into:</p>\n  \n  <p>main = readLn\n        <code>&gt;&gt;=</code> (\\a -> print a)</p>\n</blockquote>\n\n<p>But @Benjamin Hodgson's answer is better, especially the version that requires no fmaps at all.</p>\n\n<p>And to the subquestion, \"&lt;-\" desugars to a bind, but is pronounced \"is drawn from\" via: <a href=\"https://wiki.haskell.org/Pronunciation\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Pronunciation</a></p>\n"}, {"comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482540062, "post_id": 41308863, "comment_id": 69821861, "body": "And, <code>print = putStrLn . show</code>, so <code>main = good &gt;&gt;= print . getit</code>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1482535858, "last_edit_date": 1482535858, "creation_date": 1482535138, "answer_id": 41308863, "question_id": 41308815, "link": "https://stackoverflow.com/questions/41308815/haskell-function-rewrite-without-bind-return/41308863#41308863", "title": "Haskell function rewrite without bind return", "body": "<p>Variable-binding in <code>do</code>-notation desugars into calls to the <em>bind</em> combinator <code>&gt;&gt;=</code>:</p>\n\n<pre><code>do { x &lt;- m ; rest }  =  m &gt;&gt;= \\x -&gt; do rest\n</code></pre>\n\n<p>So your example translates to:</p>\n\n<pre><code>main = fmap getit good &gt;&gt;= \\x -&gt; putStrLn $ show x\n</code></pre>\n\n<p>Or, in point-free style:</p>\n\n<pre><code>main = fmap getit good &gt;&gt;= putStrLn . show\n</code></pre>\n\n<p>Or, exploiting the relationship between <code>fmap</code> and <code>&gt;&gt;=</code>:</p>\n\n<pre><code>main = good &gt;&gt;= putStrLn . show . getit\n</code></pre>\n\n<p>For many monads this last form will be more efficient. <code>fmap</code> often has to rebuild the mapped structure (for example, lists' <code>fmap</code> runs in O(n) time) whereas function composition is always O(1). </p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 41308863, "answer_count": 2, "score": 1, "last_activity_date": 1482536065, "creation_date": 1482534756, "last_edit_date": 1495541785, "question_id": 41308815, "link": "https://stackoverflow.com/questions/41308815/haskell-function-rewrite-without-bind-return", "title": "Haskell function rewrite without bind return", "body": "<p>On advice I received <a href=\"https://stackoverflow.com/a/41093163/1052117\">here</a>, I am trying to rewrite a function without an extraneous bind assignment and return, but am getting stuck with an extra IO I can't seem to understand how to get out of it.</p>\n\n<p>I have</p>\n\n<pre><code>good :: IO (Either Int String)\n\ngetit :: Either Int String -&gt; Int\n\nmain :: IO ()\nmain = do\n  x &lt;- fmap getit good\n  putStrLn $ show x\n</code></pre>\n\n<p>main works fine.  But....</p>\n\n<pre><code>main2 :: IO ()\nmain2 = do\n  putStrLn $ show $ fmap getit good\n\n-- let's try totally without do\nmain3 :: IO ()\nmain3 = putStrLn $ fmap show $ fmap getit good\n</code></pre>\n\n<p>main2 fails with:</p>\n\n<pre><code>\u2022 No instance for (Show (IO Int)) arising from a use of \u2018show\u2019\n\u2022 In the second argument of \u2018($)\u2019, namely \u2018show $ fmap getit good\u2019\n  In a stmt of a 'do' block: putStrLn $ show $ fmap getit good\n  In the expression: do { putStrLn $ show $ fmap getit good }\n</code></pre>\n\n<p>And main3 fails with:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018IO\u2019 with \u2018[]\u2019\n  Expected type: String\n    Actual type: IO String\n</code></pre>\n\n<p>What's the correct way to rewrite this idiomatically?</p>\n\n<p>(Sub-question: is \"&lt;-\" this guy actually called a bind?  via here: <a href=\"https://stackoverflow.com/questions/7746894/are-there-pronounceable-names-for-common-haskell-operators\">Are there pronounceable names for common Haskell operators?</a> )</p>\n"}, {"tags": ["haskell", "recursion", "memory-leaks", "profiling"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482524489, "post_id": 41306593, "comment_id": 69817813, "body": "What&#39;s your ghc version and how are you compiling?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 1, "creation_date": 1482526259, "post_id": 41306593, "comment_id": 69818384, "body": "It&#39;s set to lts-7.3 so that&#39;s GHC 8.0.1. I&#39;m compiling with stack install --profile. But I get the memory leak with a normal stack install. Using the default ghc options from the stack template:  -threaded -rtsopts -with-rtsopts=-N"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1482531909, "post_id": 41306593, "comment_id": 69819997, "body": "This example is very far from minimal - you are importing your entire library (<code>Network.AMQP.Worker</code>) in your example program. As it stands, this is far too broad."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1482538261, "post_id": 41306593, "comment_id": 69821542, "body": "I was thinking there might be something obvious. So you&#39;re suggesting I reduce it to a minimal example?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 1, "creation_date": 1482538301, "post_id": 41306593, "comment_id": 69821554, "body": "This is my first time hunting down a memory leak. I am wondering if there&#39;s a good way to figure out where they are in a program like this"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1482954478, "post_id": 41306593, "comment_id": 69939049, "body": "I would try getting rid of the monad type classes and just using <code>IO</code>. I&#39;m not sure if it is likely to be the problem but it would be nice to have one fewer thing to worry about."}], "answers": [{"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 3, "last_activity_date": 1483469550, "creation_date": 1483469550, "answer_id": 41450414, "question_id": 41306593, "link": "https://stackoverflow.com/questions/41306593/memory-leak-in-recursive-io-function-pap/41450414#41450414", "title": "Memory leak in recursive IO function - PAP", "body": "<p>The memory leak was in <code>poll</code>. Using <a href=\"https://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html\" rel=\"nofollow noreferrer\"><code>monad-loops</code></a>, I changed the definition to the following: It looks like <code>untilJust</code> does the same thing as my recursion, but fixes the leak. </p>\n\n<p>Can anyone comment as to why my previous definition of <code>poll</code> was leaking memory?</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nmodule Network.AMQP.Worker.Poll where\n\nimport Control.Concurrent (threadDelay)\nimport Control.Monad.Trans.Control (MonadBaseControl)\nimport Control.Monad.Base (liftBase)\nimport Control.Monad.Loops (untilJust)\n\npoll :: (MonadBaseControl IO m) =&gt; Int -&gt; m (Maybe a) -&gt; m a\npoll us action = untilJust $ do\n    ma &lt;- action\n    case ma of\n      Just a -&gt; return $ Just a\n      Nothing -&gt; do\n        liftBase $ threadDelay us\n        return Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": true, "score": 16, "last_activity_date": 1484081633, "last_edit_date": 1484081633, "creation_date": 1483795168, "answer_id": 41521876, "question_id": 41306593, "link": "https://stackoverflow.com/questions/41306593/memory-leak-in-recursive-io-function-pap/41521876#41521876", "title": "Memory leak in recursive IO function - PAP", "body": "<p>Here is a very simple example that demonstrates your problem:</p>\n\n<pre><code>main :: IO ()\nmain = worker\n\n{-# NOINLINE worker #-}\nworker :: (Monad m) =&gt; m ()\nworker =\n  let loop = poll &gt;&gt; loop\n  in loop\n\npoll :: (Monad m) =&gt; m a\npoll = return () &gt;&gt; poll\nIf you remove the `NOINLINE`, or specialize `m` to\n`IO` (while compiling with `-O`), the leak goes away.\n</code></pre>\n\n<p>I wrote a detailed <a href=\"https://ro-che.info/articles/2017-01-10-nested-loop-space-leak\" rel=\"noreferrer\">blog\npost</a> about why\nexactly this code leaks memory. The quick summary is, as Reid points out in his\nanswer, that the code creates and remembers a chain of partial applications of\n<code>&gt;&gt;</code>s.</p>\n\n<p>I also filed a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13080\" rel=\"noreferrer\">ghc ticket</a> about this.</p>\n"}, {"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483896773, "post_id": 41522949, "comment_id": 70276258, "body": "How does the use of <code>NOINLINE</code> make the program comparable to the original leaky one?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483899329, "post_id": 41522949, "comment_id": 70277321, "body": "GHC not inlining or specializing is the generic case (when the function is defined in a different module, not small, etc.) GHC knows many tricks, and when you minimize these tricks may kick in. Using <code>NOINLINE</code> stops many of these tricks lets you minimize further."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1483802266, "creation_date": 1483802266, "answer_id": 41522949, "question_id": 41306593, "link": "https://stackoverflow.com/questions/41306593/memory-leak-in-recursive-io-function-pap/41522949#41522949", "title": "Memory leak in recursive IO function - PAP", "body": "<p>Maybe an easier example to understand is this one</p>\n\n<pre><code>main :: IO ()\nmain = let c = count 0\n       in c &gt;&gt; c\n\n{-# NOINLINE count #-}\ncount :: Monad m =&gt; Int -&gt; m ()\ncount 1000000 = return ()\ncount n = return () &gt;&gt; count (n+1)\n</code></pre>\n\n<p>Evaluating <code>f &gt;&gt; g</code> for IO actions yields some kind of closure that has references to both <code>f</code> and <code>g</code> (it's basically the composition of <code>f</code> and <code>g</code> as functions on state tokens). <code>count 0</code> returns a thunk <code>c</code> that will evaluate to a big structure of closures of the form <code>return () &gt;&gt; return () &gt;&gt; return () &gt;&gt; ...</code>. When we execute <code>c</code> we build up this structure, and since we have to execute <code>c</code> a second time the whole structure is still live. So this program leaks memory (regardless of optimization flags).</p>\n\n<p>When <code>count</code> is specialized to <code>IO</code> and optimizations are enabled, GHC has a variety of tricks available to avoid building up this data structure; but they all rely on knowing that the monad is <code>IO</code>.</p>\n\n<p>Returning to the original <code>count :: Monad m =&gt; Int -&gt; m ()</code>, we can try to avoid building this big structure by changing the last line to</p>\n\n<pre><code>count n = return () &gt;&gt;= (\\_ -&gt; count (n+1))\n</code></pre>\n\n<p>Now the recursive call is hidden inside a lambda, so <code>c</code> is just a small structure <code>return () &gt;&gt;= (\\_ -&gt; BODY)</code>. This does actually avoid the space leak when compiling without optimizations. However when optimizations are enabled, GHC floats out <code>count (n+1)</code> from the body of the lambda (since it doesn't depend on the argument) producing</p>\n\n<pre><code>count n = return () &gt;&gt;= (let body = count (n+1) in \\_ -&gt; body)\n</code></pre>\n\n<p>and now <code>c</code> is a large structure again...</p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 944, "favorite_count": 1, "accepted_answer_id": 41521876, "answer_count": 3, "score": 17, "last_activity_date": 1484081633, "creation_date": 1482519439, "question_id": 41306593, "link": "https://stackoverflow.com/questions/41306593/memory-leak-in-recursive-io-function-pap", "title": "Memory leak in recursive IO function - PAP", "body": "<p>I've written a library called <a href=\"https://hackage.haskell.org/package/amqp-worker\" rel=\"noreferrer\">amqp-worker</a> that provides a function called <code>worker</code> that polls a message queue (like <a href=\"https://www.rabbitmq.com/\" rel=\"noreferrer\">RabbitMQ</a>) for messages, calling a handler when a message is found. Then it goes back to polling. </p>\n\n<p>It's leaking memory. I've profiled it and the graph says <code>PAP</code> (partial function application) is the culprit. <strong>Where is the leak in my code? How can I avoid leaks when looping in <code>IO</code> with <code>forever</code>?</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/NIY2J.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/NIY2J.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here are some relevant functions. <a href=\"https://github.com/seanhess/amqp-worker\" rel=\"noreferrer\">The full source is here</a>.</p>\n\n<p><a href=\"https://github.com/seanhess/amqp-worker/blob/master/test/Example.hs\" rel=\"noreferrer\">Example Program</a>. This leaks</p>\n\n<pre><code>main :: IO ()\nmain = do\n  -- connect\n  conn &lt;- Worker.connect (fromURI \"amqp://guest:guest@localhost:5672\")\n\n  -- initialize the queues\n  Worker.initQueue conn queue\n  Worker.initQueue conn results\n\n  -- publish a message\n  Worker.publish conn queue (TestMessage \"hello world\")\n\n  -- create a worker, the program loops here\n  Worker.worker def conn queue onError (onMessage conn)\n</code></pre>\n\n<p><a href=\"https://github.com/seanhess/amqp-worker/blob/master/src/Network/AMQP/Worker/Worker.hs#L35\" rel=\"noreferrer\">worker</a></p>\n\n<pre><code>worker :: (FromJSON a, MonadBaseControl IO m, MonadCatch m) =&gt; WorkerOptions -&gt; Connection -&gt; Queue key a -&gt; (WorkerException SomeException -&gt; m ()) -&gt; (Message a -&gt; m ()) -&gt; m ()\nworker opts conn queue onError action =\n  forever $ do\n    eres &lt;- consumeNext (pollDelay opts) conn queue\n    case eres of\n      Error (ParseError reason bd) -&gt;\n        onError (MessageParseError bd reason)\n\n      Parsed msg -&gt;\n        catch\n          (action msg)\n          (onError . OtherException (body msg))\n    liftBase $ threadDelay (loopDelay opts)\n</code></pre>\n\n<p><a href=\"https://github.com/seanhess/amqp-worker/blob/master/src/Network/AMQP/Worker/Message.hs#L100\" rel=\"noreferrer\">consumeNext</a></p>\n\n<pre><code>consumeNext :: (FromJSON msg, MonadBaseControl IO m) =&gt; Microseconds -&gt; Connection -&gt; Queue key msg -&gt; m (ConsumeResult msg)\nconsumeNext pd conn queue =\n    poll pd $ consume conn queue\n</code></pre>\n\n<p><a href=\"https://github.com/seanhess/amqp-worker/blob/master/src/Network/AMQP/Worker/Poll.hs#L9\" rel=\"noreferrer\">poll</a></p>\n\n<pre><code>poll :: (MonadBaseControl IO m) =&gt; Int -&gt; m (Maybe a) -&gt; m a\npoll us action = do\n    ma &lt;- action\n    case ma of\n      Just a -&gt; return a\n      Nothing -&gt; do\n        liftBase $ threadDelay us\n        poll us action\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "union", "ghc"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1482519633, "post_id": 41306420, "comment_id": 69816170, "body": "You might find the &quot;lens&quot; library helpful.  It would allow you to write your <code>map</code> function as <code>over _Right</code>."}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1482520932, "post_id": 41306420, "comment_id": 69816618, "body": "I guess that _Right comes from TemplateHaskell, right? Maybe this is too strict, but i was avoiding TH because it is not compatible with SafeHaskell."}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482528216, "post_id": 41306420, "comment_id": 69819061, "body": "My <code>Either</code> example is just an example of my method to avoid pattern matching. It is a safer version of the <code>either</code>  function in the base library. My question is not about specifically <code>Either</code>, i use it only as example."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1482530153, "post_id": 41306420, "comment_id": 69819603, "body": "<code>_Right</code> is not TemplateHaskell.  It&#39;s a function defined in Lens.  (Lens can make use of TH to automate lens generation for user-defined types, but it doesn&#39;t require TH.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482532387, "post_id": 41306420, "comment_id": 69820116, "body": "It is entirely unclear what you want to achieve here - the fact that you &quot;feel&quot; the latter is &quot;nicer&quot; is entirely subjective. The type <code>Processor a b r</code> is isomorphic to <code>Either a b -&gt; r</code>, so you haven&#39;t changed anything, semantically speaking, as your <code>switch</code> function is just function application composed with one direction of said isomorphism."}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482532867, "post_id": 41306420, "comment_id": 69820231, "body": "&quot;&quot;nicer&quot; is entirely subjective&quot; - it is nicer in the same sense that pointless style is nicer."}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482533106, "post_id": 41306420, "comment_id": 69820288, "body": "I do not want to &quot;change something semantically&quot;."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1482536992, "post_id": 41306420, "comment_id": 69821264, "body": "You just need <code>either</code> since you can map any sum type to a nested <code>Either</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482539019, "post_id": 41306420, "comment_id": 69821695, "body": "@user2407038, many stylistic things are subjective.  I think this is a fairly subjective question, yet still valid.  Also, there is another aspect: &quot;niceness&quot; has not only an individual definition, but a community definition."}], "answers": [{"comments": [{"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482528329, "post_id": 41307380, "comment_id": 69819095, "body": "My <code>Either</code> example is just an example of my method to avoid pattern matching. It is a safer version of the <code>either</code>  function in the base library. My question is not about specifically <code>Either</code>, i use it only as example."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1482529815, "post_id": 41307380, "comment_id": 69819509, "body": "Could you explain the sense in which your method is safer than <code>either</code>?"}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482532471, "post_id": 41307380, "comment_id": 69820142, "body": "More safe :  A possible coding mistake is to flip the order of the parameters of <code>either</code>. If the type of values stored in <code>Either</code> are equal than there will be no typing error. <code>Either</code> is a bad example to demonstrate this kind of mistake possibility, but i think generally for other sum types the danger is real. Hence i rather put the processor functions into a record, just so that i can name them."}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482536177, "post_id": 41307380, "comment_id": 69821092, "body": "<code>switch p = either (l p) (r p)</code> - you just hid the pattern matching inside <code>either</code>. Someone had to write <code>either</code>, using pattern matching. I hoped the compiler can be that someone."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1482524188, "creation_date": 1482524188, "answer_id": 41307380, "question_id": 41306420, "link": "https://stackoverflow.com/questions/41306420/point-free-destructuring-with-ghc/41307380#41307380", "title": "Point-free destructuring with GHC", "body": "<p>The <code>either</code> function lets you specify separate functions to apply to <code>Left</code> and <code>Right</code> values in an <code>Either a b</code> value:</p>\n\n<pre><code>switch p ei = either (l p) (r p) ei\n</code></pre>\n\n<p>You can immediately drop <code>ei</code> from both sides to get</p>\n\n<pre><code>switch p = either (l p) (r p)\n</code></pre>\n\n<p>and you can use the <code>Applicative</code> instance for functions to drop <code>p</code>:</p>\n\n<pre><code>switch = either &lt;$&gt; l &lt;*&gt; r\n</code></pre>\n\n<p>For an arbitrary sum type, you need to provide an appropriate <em>catamorphism</em>, which is the fancy name for a function like <code>either</code> that reduces a value wrapped by the sum type to the wrapped type.</p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1482540174, "post_id": 41309220, "comment_id": 69821893, "body": "I consider your first line as the answer to my question."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1482538868, "creation_date": 1482538868, "answer_id": 41309220, "question_id": 41306420, "link": "https://stackoverflow.com/questions/41306420/point-free-destructuring-with-ghc/41309220#41309220", "title": "Point-free destructuring with GHC", "body": "<p>The short answer is no (especially without Template Haskell).</p>\n\n<p>However, like many constructs in functional programming, you can turn it upside down.  Use a Church/Scott encoding (they are the same when the datatype is not recursive).</p>\n\n<pre><code>newtype ChurchEither a b = ChurchEither { switch :: forall c. (a -&gt; c) -&gt; (b -&gt; c) -&gt; c }\n</code></pre>\n\n<p>in which you get the eliminator <code>switch</code> for free, because it's the definition of the type, but you have to write the constructors yourself</p>\n\n<pre><code>left x = ChurchEither (\\l r -&gt; l x)\nright x = ChurchEither (\\l r -&gt; r x)\n</code></pre>\n\n<p>so you haven't really gained anything boilerplate-wise.</p>\n"}], "owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41309220, "answer_count": 2, "score": 1, "last_activity_date": 1482538868, "creation_date": 1482518571, "last_edit_date": 1482538198, "question_id": 41306420, "link": "https://stackoverflow.com/questions/41306420/point-free-destructuring-with-ghc", "title": "Point-free destructuring with GHC", "body": "<p>I do not like to destructure sum typed values with pattern matching. It feels alien for me because of its pointed style.\nI rather write and use <code>switch</code> functions for sum types.</p>\n\n<p>My question is about any sum type generally, but i demonstrate it on <code>Either</code> as example :</p>\n\n<pre><code>data Processor cl cr r = MakeProcessor { l :: cl -&gt; r, r :: cr -&gt; r }\n\nswitch :: Processor cl cr r -&gt; Either cl cr -&gt; r\nswitch p ei = \n    case ei of\n        Left x -&gt; l p x\n        Right x -&gt; r p x\n</code></pre>\n\n<p>With this extension to <code>Either</code> : </p>\n\n<p>instead of this :</p>\n\n<pre><code>map f e = \n    case e of\n        Left x -&gt; Left x\n        Right x -&gt; Right (f x)\n</code></pre>\n\n<p>i can write this :</p>\n\n<pre><code>map f = switch (MakeProcessor { l : Left, r : f &gt;&gt;&gt; Right })\n</code></pre>\n\n<p>, which i feel nicer for most situations.</p>\n\n<p>To write such extension stuff [<code>Processor</code>, <code>switch</code>] for a sum type is mechanical work. So i wonder : is there a way to make the compiler [GHC] do it for me? Or any other way to destructure sum typed values in pointless style?</p>\n\n<hr>\n\n<p>Note : I used <code>Either</code> as just an example. <code>Either</code> was a wrong choice, as many readers thought that my question was about <code>Either</code> specifically, and hence pointed me to <code>either</code>. I should have used a sum type that is not in the base library, like</p>\n\n<pre><code>data Result a b = Fail a | Success b\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482515114, "post_id": 41305639, "comment_id": 69814243, "body": "oh I can see this is clever, thank you very much ! Will try it out, give some time in case someone can beat this, and come back to validate the answer."}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482523050, "post_id": 41305639, "comment_id": 69817342, "body": "Simply redefining my <code>runAction</code> by <code>flip replicateM_</code> made the code about 4 times slower on my machine :("}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482523264, "post_id": 41305639, "comment_id": 69817419, "body": "The first version of your answer did not fulfill its promise, I think some issues may be arising from the fact that <code>runAction</code> was no longer tail recursive. I am now testing your last version"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482524640, "post_id": 41305639, "comment_id": 69817853, "body": "@SvenWilliamson, you&#39;re compiling with optimizations right?"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482525040, "post_id": 41305639, "comment_id": 69817977, "body": "@luqui Oh very sorry no, you have a specific optimization option in mind?"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482525611, "post_id": 41305639, "comment_id": 69818155, "body": "@luqui using -O2 does not change the timing numbers I am getting in the three code proposal I have tested so far :( Thanks v much all the same."}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482527649, "post_id": 41305639, "comment_id": 69818869, "body": "@freestyle I am very sorry, the first idea (based on adding times of each action call) paradoxically gives me worse numbers, (possibly because the system is stretched by solution which seems more memory intensive). As for the solution consisting of subtracting overhead (another clever idea), unfortunately I obtain very unstable numbers (possibly even negative, having removed <code>abs</code>). I feel bad you have spent time on this and I cannot yet validate the answer."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482528831, "post_id": 41305639, "comment_id": 69819250, "body": "@SvenWilliamson, if you are looking for a way to accurately benchmark, which I increasingly suspect, rather than designing a benchmark system for fun, I highly recommend <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1482532074, "post_id": 41305639, "comment_id": 69820038, "body": "@SvenWilliamson, Basically, I think problem is that you don&#39;t control or/and don&#39;t analyse GC (Garbage Collector). As wrote luqui, you can look on <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a> which controls/analyses GC or <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Stats.html\" rel=\"nofollow noreferrer\">GC API</a> in GHC to control/analyse GC yourself."}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482533699, "post_id": 41305639, "comment_id": 69820445, "body": "@luqui, freestyle thank you very much, will check this out tomorrow"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482595644, "post_id": 41305639, "comment_id": 69832996, "body": "@luqui I don&#39;t know what I was doing wrong yesterday but the compiler option <code>-O2</code> makes  huge difference today. This is a big lesson for me. Thank you !!!"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482596270, "post_id": 41305639, "comment_id": 69833153, "body": "@luqui remind me to recompile dependencies when changing compiler options :)"}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 2, "last_activity_date": 1482527907, "last_edit_date": 1482527907, "creation_date": 1482514507, "answer_id": 41305639, "question_id": 41305342, "link": "https://stackoverflow.com/questions/41305342/designing-basic-haskell-bench-marking-code/41305639#41305639", "title": "Designing basic Haskell bench-marking code", "body": "<p>You can try this way:</p>\n\n<pre><code>runAction :: MonadIO m =&gt; m a -&gt; Int -&gt; m NominalDiffTime\nrunAction action = fmap sum . flip replicateM action'\n  where\n    action' = do\n        start &lt;- liftIO getPOSIXTime\n        action\n        end &lt;- liftIO getPOSIXTime\n        let !delta = end - start\n        return delta\n\nbenchmark action name iterations = do\n    time &lt;- realToFrac &lt;$&gt; runAction action iterations\n    liftIO $ printf \"Benchmark: %s, %d iterations ran in %.3f seconds\\n\" \n        name iterations (time :: Double)\n</code></pre>\n\n<p>Or, you can just rewrite your <code>runAction</code>:</p>\n\n<pre><code>runAction = flip replicateM_\n</code></pre>\n\n<p>Or, just fix overhead:</p>\n\n<pre><code>time :: MonadIO m =&gt; m a -&gt; m NominalDiffTime\ntime action = do\n    start &lt;- liftIO getPOSIXTime\n    action\n    end &lt;- liftIO getPOSIXTime\n    let !delta = end - start\n    return delta\n\nbenchmark action name iterations = do\n    !overhead &lt;- time $ replicateM_ iterations (return ())\n    !delta &lt;- time $ replicateM_ iterations action\n    let time = realToFrac . abs $ delta - overhead :: Double\n    liftIO $ printf \"Benchmark: %s, %d iterations ran in %.3f seconds\\n\"\n        name iterations time\n</code></pre>\n"}], "owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 41305639, "answer_count": 1, "score": 2, "last_activity_date": 1482599837, "creation_date": 1482512955, "last_edit_date": 1482599837, "question_id": 41305342, "link": "https://stackoverflow.com/questions/41305342/designing-basic-haskell-bench-marking-code", "title": "Designing basic Haskell bench-marking code", "body": "<p>I would like to write some basic bench-marking code in Haskell, namely design a function:</p>\n\n<pre><code>benchmark :: M a -&gt; String -&gt; Int -&gt; M ()\n</code></pre>\n\n<p>which given an <code>action</code> (a monadic value with respect to my own monad <code>M</code>), a function <code>name</code> for messaging purposes, and a number of <code>iterations</code>, executes the action as many times as <code>iterations</code>, and displays a message on <code>stdout</code> about the time spent executing the code. For the purpose of this question, I assume that the monad <code>M</code> is an instance of the class <code>MonadIO</code>. In particular I have some function:</p>\n\n<pre><code> liftIO :: IO a -&gt; M a \n</code></pre>\n\n<p>Having spent many hours on 'Real World Haskell', I have been warned that \"Non-strict evaluation can turn performance measurement and analysis into something of a minefield\". However, I am not looking for a definitive answer, bur rather for suggestions and guidance on how best to approach this.</p>\n\n<p>My naive approach is to separate the time measuring code:</p>\n\n<pre><code>benchmark action name iterations = do\n  start &lt;- liftIO getPOSIXTime\n  runAction action iterations\n  end &lt;- liftIO getPOSIXTime\n  let time = realToFrac $ (end - start) :: Double \n  liftIO $ printf \"Benchmark: %s, %d iterations ran in %.3f seconds\\n\" \n    name iterations time\n</code></pre>\n\n<p>from the real crunch of the problem, namely that of running an <code>action</code> as a loop:</p>\n\n<pre><code>runAction :: Monad m =&gt; m a -&gt; Int -&gt; m ()\nrunAction action iterations\n  | iterations &lt;= 0   = return ()\n  | otherwise         = do\n    action\n    runAction action (iterations -1) \n</code></pre>\n\n<p>The issue I have with my solution is that it seems the code spends more time in 'boiler-plate' than running the <code>action</code>: if I attempt to benchmark the simplest possible action <code>return ()</code> , I may get a time say of 1000 ms for 1 million iterations. I can see the specifics of the monad <code>M</code> play an important role (replacing <code>M</code> by <code>IO</code> would bring the time down to 250 ms instead of 1000 ms). A one million loop doing nothing may also take in the order of 250 ms in interpreted <code>python</code> or <code>scheme</code> (so the <code>IO</code> monad is not so bad), but it is a lot faster in <code>C</code>. Normally Haskell is mightily fast (not so far from <code>C</code>). I have tried a solution involving <code>forM</code> and <code>[1..1000000]</code> but without improvement.</p>\n\n<p>Is there a way to approach this so the 'boiler-plate' code does not overwhelm the code being tested?   </p>\n\n<p><strong>EDIT:</strong> The problem seemingly goes away when using the <code>-O2</code> compiler optimization option as suggested by @luqui (i.e. a one million monadic loop doing nothing has very good performance relative to other languages, at least in my case). So this question is closed as far as I can see it.</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482508097, "post_id": 41303591, "comment_id": 69810987, "body": "You call <code>map</code>, not <code>Data.HashMap.Lazy.map</code>; Haskell doesn&#39;t try to second guess you just because you provided an argument of the wrong type."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 4, "creation_date": 1482511068, "post_id": 41303591, "comment_id": 69812434, "body": "The idiomatic approach starts at the type and says &quot;does this even make sense?&quot; As far as I can tell, it doesn&#39;t.  It seems like at the minimum, it also needs a <code>ToJSON</code> constraint on <code>a</code>.  I&#39;d start by writing a working function of type <code>Value -&gt; Value</code> and then a second function that does conversions back and forth between arbitrary types and <code>Value</code>. Doing that would also make it clear why you need both constraints."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1482511147, "post_id": 41303591, "comment_id": 69812480, "body": "And for what it&#39;s worth, this is the sort of problem that <code>lens</code> and <code>lens-aeson</code> solve very cleanly - but I can see why you&#39;d want to avoid that for a while."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1482518506, "post_id": 41303591, "comment_id": 69815654, "body": "@Carl That should probably be an answer"}, {"owner": {"reputation": 13858, "user_id": 1235039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/230bedd1687c5c8690bed7c87c5942e4?s=128&d=identicon&r=PG", "display_name": "aquavitae", "link": "https://stackoverflow.com/users/1235039/aquavitae"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1482524399, "post_id": 41303591, "comment_id": 69817786, "body": "@Carl Thanks, as soon as I read it it made perfect sense that I would need a ToJSON constraint. I don&#39;t understand what you mean by a function that does a conversion to <code>Value</code> though - isn&#39;t <code>a</code> already a <code>Value</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482532745, "post_id": 41303591, "comment_id": 69820193, "body": "Your function is already ill-typed regardless of the contents of the right-hand sides. You have a value of type <code>a</code> (a type variable) and try to pattern match on concrete constructors on that value - type variables never have concrete constructors. It looks like you want <code>case toJSON x of ...</code> - there is no automatic type casting in Haskell, which seems to be what you are expecting (if this is the case, perhaps a basic Haskell refresher is in order)."}], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 1, "last_activity_date": 1482539446, "last_edit_date": 1482539446, "creation_date": 1482534829, "answer_id": 41308830, "question_id": 41303591, "link": "https://stackoverflow.com/questions/41303591/recursively-change-a-json-data-structure-in-haskell/41308830#41308830", "title": "Recursively change a JSON data structure in Haskell", "body": "<p>First of all, what <code>FromJSON a =&gt; a</code> does mean? It's type of some thing what says: it can be thing with any type but only from class <code>FromJSON</code>. This class can contain types which very differently constructed and you can't do any pattern matching. You can only do what is specified in the class <code>FromJSON</code> declaration by programmer. Basically, there is one method <code>parseJSON :: FromJSON a =&gt; Value -&gt; Parser a</code>.</p>\n\n<p>Secondly, you should use some isomorphic representation of JSON for your work. The type <code>Value</code> is good one. So, you can do the main work by the function like <code>Value -&gt; Value</code>. After that, you can compose this fuction with <code>parseJSON</code> and <code>toJSON</code> for generalse types.</p>\n\n<p>Like this:</p>\n\n<pre><code>change :: Value -&gt; Value\nchange (Array x)  = Array . fmap change $ x\nchange (Object x) = Object . fmap change $ x\nchange (String x) = Object . parseValue $ x\nchange x          = x\n\napply :: (ToJSON a, FromJSON b) =&gt; (Value -&gt; Value) -&gt; a -&gt; Result b\napply change = fromJSON . change . toJSON\n\nunsafeApply :: (ToJSON a, FromJSON b) =&gt; (Value -&gt; Value) -&gt; a -&gt; b\nunsafeApply change x = case apply change x of\n                         Success x -&gt; x\n                         Error msg -&gt; error $ \"unsafeApply: \" ++ msg\n\napplyContext :: (ToJSON a, FromJSON b) =&gt; a -&gt; b\napplyContext = unsafeApply change\n</code></pre>\n\n<p>You can write more complicated transformations like <code>Value -&gt; Value</code> with <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> and <a href=\"http://hackage.haskell.org/package/lens-aeson\" rel=\"nofollow noreferrer\">lens-aeson</a>. For example:</p>\n\n<pre><code>import Control.Lens\nimport Control.Monad.State\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport Data.Text.Lens\nimport Data.Char\n\nchange :: Value -&gt; Value\nchange = execState go\n  where\n    go = do\n        zoom values go\n        zoom members go\n        _String . _Text . each %= toUpper\n        _Bool %= not\n        _Number *= 10\n\nmain = print $ json &amp; _Value %~ change\n  where json = \"{\\\"a\\\":[1,\\\"foo\\\",false],\\\"b\\\":\\\"bar\\\",\\\"c\\\":{\\\"d\\\":5}}\"\n</code></pre>\n\n<p>Output will be:</p>\n\n<pre><code>\"{\\\"a\\\":[10,\\\"FOO\\\",true],\\\"b\\\":\\\"BAR\\\",\\\"c\\\":{\\\"d\\\":50}}\"\n</code></pre>\n"}], "owner": {"reputation": 13858, "user_id": 1235039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/230bedd1687c5c8690bed7c87c5942e4?s=128&d=identicon&r=PG", "display_name": "aquavitae", "link": "https://stackoverflow.com/users/1235039/aquavitae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 41308830, "answer_count": 1, "score": 2, "last_activity_date": 1482539446, "creation_date": 1482504889, "question_id": 41303591, "link": "https://stackoverflow.com/questions/41303591/recursively-change-a-json-data-structure-in-haskell", "title": "Recursively change a JSON data structure in Haskell", "body": "<p>I am trying to write a function that will take a JSON object, make a change to every string value in it and return a new JSON object.  So far my code is:</p>\n\n<pre><code>applyContext :: FromJSON a =&gt; a -&gt; a\napplyContext x =\n  case x of\n    Array _  -&gt; map applyContext x\n    Object _ -&gt; map applyContext x\n    String _ -&gt; parseValue x\n    _        -&gt; x\n</code></pre>\n\n<p>However, the compiler complains about second second <code>case</code> line:</p>\n\n<pre><code>Couldn't match expected type `[b0]' with actual type `a'\n  `a' is a rigid type variable bound by\n    the type signature for:\n      applyContext :: forall a. FromJSON a =&gt; a -&gt; a\n    at app\\Main.hs:43:17\n</code></pre>\n\n<p>I'm guessing that is because <code>map</code> is meant to work on lists, but I would have naively expected it to use <code>Data.HashMap.Lazy.map</code> instead, since that is what the type actually is in that case. If I explicitly use that function I get </p>\n\n<pre><code>Couldn't match expected type `HashMap.HashMap k0 v20' with actual type `a'\n</code></pre>\n\n<p>which also makes sense, since I haven't constrained <code>a</code> to that extent because then it wouldn't work for the other cases. I suspect that if I throw enough explicit types at this I could make it work but it feels like it should be a lot simpler.  What is an idiomatic way of writing this function, or if this is good then what would be the simplest way of getting the types right?</p>\n"}, {"tags": ["haskell", "out-of-memory"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482504109, "post_id": 41303042, "comment_id": 69809114, "body": "I recommend you read about <a href=\"http://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form\">What is Weak Head Normal Form?</a>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1482510555, "post_id": 41303042, "comment_id": 69812167, "body": "This works fine with <code>ins m c = Map.insertWith&#39; (+) c (1::Int) m</code>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482588665, "post_id": 41304149, "comment_id": 69831250, "body": "I generally don&#39;t recommend <code>deepseq</code> except for parallel programming. While it will work okay in this case, it is overkill even here--it can be expected to force twice as much as necessary! In other contexts, it&#39;s much worse. Also, <code>Data.Bytestring.Char8</code> is not at all appropriate for counting <i>characters</i>, unless the input is known to be restricted to something ASCII-like. Finally, <code>Data.Map</code> is not ideal for maps with small keys. It&#39;s typically much better to use <code>IntMap</code> and convert <code>Char</code> to and from <code>Int</code>."}, {"owner": {"reputation": 253, "user_id": 3066306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc0667aa86409ed04e43f78d7d429b1?s=128&d=identicon&r=PG&f=1", "display_name": "Dune", "link": "https://stackoverflow.com/users/3066306/dune"}, "edited": false, "score": 0, "creation_date": 1482595688, "post_id": 41304149, "comment_id": 69833002, "body": "That really helped! Thanks a lot!"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 7, "last_activity_date": 1482508673, "last_edit_date": 1482508673, "creation_date": 1482507445, "answer_id": 41304149, "question_id": 41303042, "link": "https://stackoverflow.com/questions/41303042/running-out-of-memory-while-counting-characters-in-a-large-file/41304149#41304149", "title": "Running out of memory while counting characters in a large file", "body": "<p>Your <code>ins</code> function is creating tons of <a href=\"https://wiki.haskell.org/Thunk\" rel=\"nofollow noreferrer\">thunks</a> that cause a lot of <a href=\"https://wiki.haskell.org/Memory_leak\" rel=\"nofollow noreferrer\">memory leak</a>. <code>foldl'</code> only evaluates to <a href=\"https://wiki.haskell.org/Weak_head_normal_form\" rel=\"nofollow noreferrer\">weak head normal form</a> which is not enough here. What you need is <a href=\"http://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html#v:deepseq\" rel=\"nofollow noreferrer\"><code>deepseq</code></a> from <code>Control.DeepSeq</code> in order to get to <em>normal form</em>.</p>\n\n<p>Alternatively, instead of association list, use <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\"><code>Data.Map.Strict</code></a> for counting. Also, If your IO is on the order of 2GB, you better use <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Lazy-Char8.html\" rel=\"nofollow noreferrer\">lazy <code>ByteString</code></a> instead of plain strings.</p>\n\n<p>Bellow code should perform in constant memory space regardless of size of input:</p>\n\n<pre><code>import System.Environment (getArgs)\nimport Data.Map.Strict (empty, alter)\nimport qualified Data.ByteString.Lazy.Char8 as B\n\nmain :: IO ()\nmain = getArgs &gt;&gt;= B.readFile . head &gt;&gt;= print . B.foldl' go empty\n  where\n  go = flip $ alter inc\n  inc :: Maybe Int -&gt; Maybe Int\n  inc Nothing  = Just 1\n  inc (Just i) = Just $ i + 1\n</code></pre>\n"}], "owner": {"reputation": 253, "user_id": 3066306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc0667aa86409ed04e43f78d7d429b1?s=128&d=identicon&r=PG&f=1", "display_name": "Dune", "link": "https://stackoverflow.com/users/3066306/dune"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 41304149, "answer_count": 1, "score": 4, "last_activity_date": 1482508673, "creation_date": 1482502427, "question_id": 41303042, "link": "https://stackoverflow.com/questions/41303042/running-out-of-memory-while-counting-characters-in-a-large-file", "title": "Running out of memory while counting characters in a large file", "body": "<p>I want to count the number of occurrences of each character in a large file. Although I know that counting should be implemented in a strict way in Haskell (which I tried to achieve using foldl'), I am still running out of memory. For comparison: the file size is about 2GB, while the computer has 100GB of memory. There are not many different characters in that file - maybe 20. What am I doing wrong?</p>\n\n<pre><code>ins :: [(Char,Int)] -&gt; Char -&gt; [(Char,Int)]\nins [] c = [(c,1)]\nins ((c,i):cs) d\n    | c == d = (c,i+1):cs\n    | otherwise = (c,i) : ins cs d\n\nmain = do\n    [file] &lt;- getArgs\n    txt &lt;- readFile file\n    print $ foldl' ins [] txt\n</code></pre>\n"}, {"tags": ["sql", "haskell", "persistent"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1482495792, "post_id": 41299818, "comment_id": 69805195, "body": "I think you should post it as an separate answer instead of editing your question."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482496829, "post_id": 41299818, "comment_id": 69805715, "body": "I think that I found the cause - but I don&#39;t know how to solve it - it is definitely misworded"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482504107, "post_id": 41299818, "comment_id": 69809111, "body": "Ah, okay. One obvious question: You do know that there is no persistent bindings for Oracle ?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482530981, "post_id": 41299818, "comment_id": 69819759, "body": "Hmm - I already started working with <a href=\"https://hackage.haskell.org/package/persistent-odbc\" rel=\"nofollow noreferrer\">persistent-odbc</a> - it took me a while but I managed to send queries from Haskell to an oracle db."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1482504726, "creation_date": 1482504726, "answer_id": 41303554, "question_id": 41299818, "link": "https://stackoverflow.com/questions/41299818/haskell-persistent-how-to-use-a-foreign-key-as-primary-key-in-a-second-table/41303554#41303554", "title": "haskell-persistent: how to use a foreign key as primary key in a second table", "body": "<blockquote>\n  <p>Can I express in persistent somehow that a primary key is a foreign key?</p>\n</blockquote>\n\n<p>Yes. A sample code example assuming Sqlite as the database:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-7.14\n     --install-ghc\n     runghc\n     --package yesod\n     --package yesod-core\n     --package blaze-html\n     --package text\n     --package persistent\n     --package persistent-template\n     --package persistent-sqlite\n     --package shakespeare\n     --package aeson\n-}\n\n{-# LANGUAGE EmptyDataDecls #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Control.Monad.IO.Class (liftIO)\nimport Control.Monad.Logger (runStderrLoggingT)\nimport Database.Persist\nimport Database.Persist.Sqlite\nimport Database.Persist.TH\n\nshare\n  [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n  [persistLowerCase|\nPost\n    topic String\n    deriving Show \nPostContent\n    pid PostId\n    Primary pid\n    deriving Show\n|]\n\nmain :: IO ()\nmain = mockMigration migrateAll\n</code></pre>\n\n<p>On executing, you get this:</p>\n\n<pre><code>CREATE TABLE \"post\"(\"id\" INTEGER PRIMARY KEY,\"topic\" VARCHAR NOT NULL)\nCREATE TABLE \"post_content\"(\"pid\" INTEGER NOT NULL REFERENCES \"post\", PRIMARY KEY (\"pid\"))\n</code></pre>\n\n<p>You can see in the above example that the <code>pid</code> column in the table <code>post_content</code> is both the primary key and the foreign key.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 41303554, "answer_count": 1, "score": 2, "last_activity_date": 1482504726, "creation_date": 1482489514, "last_edit_date": 1482496802, "question_id": 41299818, "link": "https://stackoverflow.com/questions/41299818/haskell-persistent-how-to-use-a-foreign-key-as-primary-key-in-a-second-table", "title": "haskell-persistent: how to use a foreign key as primary key in a second table", "body": "<h1>UPDATE - found the root cause for the error - but don't know how to solve it</h1>\n\n<p>I just found out that the root of this behaviour is not caused by using <code>sql=\u2026</code> but rather that I use the primary key of the first table as a foreign <strong>and</strong> primary key.</p>\n\n<pre><code>Post\n  topic String\n\n  deriving Show Eq\n\nPostContent\n  Id PostId\n  content String\n\n  deriving Show Eq\n</code></pre>\n\n<p>So the question remains:</p>\n\n<p><strong>Can I express in persistent somehow that a primary key is a foreign key?</strong> - as from an SQL perspective this makes sense (at least I think so)?</p>\n\n<h1>ORIGINAL</h1>\n\n<p>I am doing a port of the haxl example by simon marlow <a href=\"https://simonmar.github.io/posts/2015-10-20-Fun-With-Haxl-1.html\" rel=\"nofollow noreferrer\">Fun With HAXL pt1</a> to oracle/docker - for a proof of concept.</p>\n\n<p>I am using the existing sql scripts to generate the db (as in the real world case that I have the db tables are not in my hand) - I have the following db layout</p>\n\n<h2>table postinfo</h2>\n\n<pre><code>| POSTID NUMBER | POSTDATE DATE | POSTTOPIC VARCHAR2(512 CHAR) |\n</code></pre>\n\n<h2>table postcontent</h2>\n\n<pre><code>| POSTID NUMBER | CONTENT CLOB |\n</code></pre>\n\n<h2>table postviews</h2>\n\n<pre><code>| POSTID NUMBER | VIEWS INT |\n</code></pre>\n\n<p>Of course I want to express the relation that <code>POSTID</code> is a foreign &amp; unique key in <code>postcontent</code> and <code>postview</code> in the corresponding haskell persistent <code>QuasiQuoter</code>. Following the <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">yesod-book</a>, the <a href=\"https://github.com/yesodweb/persistent/wiki/Persistent-entity-syntax#change-tablecollection-key-definition-field-name-andor-type-persistent--21\" rel=\"nofollow noreferrer\">wiki</a> and the <a href=\"https://github.com/yesodweb/persistent/blob/master/persistent-test/src/CompositeTest.hs#L53\" rel=\"nofollow noreferrer\">test cases</a> linked from the wiki.</p>\n\n<p>I created the following template haskell splice:</p>\n\n<pre><code>share [ mkPersist sqlSettings {mpsGeneric = False} , mkMigrate \"compositeMigrate\" , mkDeleteCascade sqlSettings {mpsGeneric = False}] [persistUpperCase|\n\nPost sql=POSTINFO\n  Id Int sql=POSTID\n  date UTCTime sql=POSTDATE\n  topic Text sql=POSTTOPIC\n\n  deriving Show Eq\n\nPostContent sql=POSTCONTENT\n  Id PostId sql=POSTID\n  content Text sql=CONTENT\n  deriving Show Eq\n\nPostViews sql=POSTVIEWS\n  Id PostId sql=POSTID\n  views Int sql=VIEWS\n  deriving Show Eq\n|]\n</code></pre>\n\n<p>which compiles with an error</p>\n\n<pre><code>error:\n    \u2022 Not in scope: type constructor or class \u2018PostId\u2019\n    \u2022 In the quasi-quotation:\n        [persistUpperCase|\n\nPost sql=POSTINFO\n  Id Int sql=POSTID\n  date UTCTime sql=POSTDATE\n  topic Text sql=POSTTOPIC\n\n  deriving Show Eq\n\nPostContent\n  Id PostId sql=POSTID\n  content Text sql=CONTENT\n  deriving Show Eq\n\nPostViews\n  Id PostId sql=POSTID\n  views Int sql=VIEWS\n  deriving Show Eq\n|]\n</code></pre>\n\n<p>One thing to note the following test case quasi-quoter - works,</p>\n\n<pre><code>  Citizen\n    name String\n    age Int Maybe\n    deriving Eq Show\n  Address\n    address String\n    country String\n    deriving Eq Show\n  CitizenAddress\n    citizen CitizenId\n    address AddressId\n    Primary citizen address\n    deriving Eq Show\n</code></pre>\n\n<p>Here is a minimal example reproducing both the error and some working versions just run (and change the <code>#define</code> line accordingly</p>\n\n<pre><code>&gt; stack runhaskell --package persistent-template minimal.hs\n</code></pre>\n\n<h2><code>minimal.hs</code></h2>\n\n<pre><code>{-# LANGUAGE FlexibleInstances          #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n{-# LANGUAGE CPP                        #-}\n\nmodule Minimal where\n\nimport Database.Persist.TH\n\n#define FAILS\nmain :: IO ()\nmain = putStrLn \"It works\"\n\n\n#ifdef WORKS\nshare [ mkPersist sqlSettings {mpsGeneric = False} , mkMigrate \"compositeMigrate\" , mkDeleteCascade sqlSettings {mpsGeneric = False}] [persistUpperCase|\n\nPost sql=POSTINFO\n  Id Int sql=POSTID\n  topic String sql=POSTTOPIC\n\n  deriving Show Eq\n|]\n#endif\n\n#ifdef ALSOWORKS\nshare [ mkPersist sqlSettings {mpsGeneric = False} , mkMigrate \"compositeMigrate\" , mkDeleteCascade sqlSettings {mpsGeneric = False}] [persistUpperCase|\n\nPost sql=POSTINFO\n  Id Int sql=POSTID\n  topic String sql=POSTTOPIC\n\n  deriving Show Eq\n\n\nPostContent sql=POSTCONTENT\n  post PostId sql=POSTID\n  content String sql=POSTCONTENT\n\n  deriving Show Eq\n|]\n#endif\n\n#ifdef FAILS\nshare [ mkPersist sqlSettings {mpsGeneric = False} , mkMigrate \"compositeMigrate\" , mkDeleteCascade sqlSettings {mpsGeneric = False}] [persistUpperCase|\n\nPost sql=POSTINFO\n  Id Int sql=POSTID\n  topic String sql=POSTTOPIC\n\n  deriving Show Eq\n\nPostContent sql=POSTCONTENT\n  Id PostId sql=POSTID\n  content String sql=POSTCONTENT\n\n  deriving Show Eq\n|]\n#endif\n\n-- UPDATE\n\n#ifdef FAILSTOO\nshare [ mkPersist sqlSettings {mpsGeneric = False} , mkMigrate \"compositeMigrate\" , mkDeleteCascade sqlSettings {mpsGeneric = False}] [persistUpperCase|\n\nPost\n  topic String\n\n  deriving Show Eq\n\nPostContent\n  Id PostId\n  content String\n\n  deriving Show Eq\n|]\n#endif\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1482493754, "post_id": 41299684, "comment_id": 69804086, "body": "Did you miss the <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Map.html\" rel=\"nofollow noreferrer\">note at the top of <code>Data.Map</code></a>?"}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1482493961, "post_id": 41299684, "comment_id": 69804203, "body": "Thanks. Not sufficiently explicit to really conclude anything in a real case for me:  &quot;..You will eventually need all the values stored.&quot;, what in memory, serialized on disk for a temp duration, or 10 years, or derivatives of it stored some-place for some-time? Of course the output of the program will directly or indirectly persist in some fashion. Depending on the usage of it, not all of the values will have to be &quot;stored&quot; verbatim. So should I prefer Lazy then? Or doesn&#39;t-matter-it now?..."}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1482494348, "post_id": 41299684, "comment_id": 69804397, "body": "&quot;The stored values don&#39;t represent large virtual data structures to be lazily computed.&quot; --- how large is large? Are &quot;small virtual data structures to be lazily computed&quot; a different matter? Etc.....  ;) ERGO: would be better if I had the exact facts at hand to be able to reason myself about both options for each hands-on use-case --- and those suggestions you pointed to (and I had seen earlier) don&#39;t volunteer such knowledge"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1482494401, "post_id": 41299684, "comment_id": 69804423, "body": "Those are rule of thumbs. The definitive answer is: profile your code. :)"}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1482494545, "post_id": 41299684, "comment_id": 69804501, "body": "Sure. One of course makes the best choice only when knowing EXACTLY the implementation details. Either by writing the package in question, or reading its sources thoroughly (plus gained hard-won real-world experiences), or as in my case by asking more seasoned practitioners on here if they too like to operate on a foundation of all-out in-depth understanding instead of just advertised heuristics-of-thumb and thusly put in said efforts already PLUS happen to happen across the question PLUS choose to spend their time explaining the actual practical differences to the wider audience here ;))"}], "answers": [{"comments": [{"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "edited": false, "score": 1, "creation_date": 1482494969, "post_id": 41301162, "comment_id": 69804734, "body": "Brilliant, that&#39;s exactly the kind of reasoning I was hoping to be able to develop over time! Thanks, much appreciated.  I assume the lazy goes back all the way to the original <code>lines</code> split of the <code>readFile</code>? Well this I can now easily go grasp from the docs again I guess.. cheers!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1482525242, "post_id": 41301162, "comment_id": 69818036, "body": "Wrt the semantic difference, a key point to me, is that a lazy map can be self referential: <code>let m = M.fromList [ (&#39;a&#39;, 1), (&#39;b&#39;, (m Map.! &#39;a&#39;)+1) ]</code> which lets you do fancy neat things that are impossible with strict maps"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 8, "last_activity_date": 1482494639, "creation_date": 1482494639, "answer_id": 41301162, "question_id": 41299684, "link": "https://stackoverflow.com/questions/41299684/data-map-how-do-i-tell-if-i-need-value-strict-maps/41301162#41301162", "title": "Data.Map: how do I tell if I &quot;need value-strict maps&quot;?", "body": "<blockquote>\n  <p>How do I reason about the differences between \"value-strict\" and \"value-lazy\" Data.Maps here? </p>\n</blockquote>\n\n<p>Value lazy is the normal in Haskell. This means that not just values, but thunks (i.e. recipes of how to compute the value) are stored. For example, lets say you extract the value from a line like this:</p>\n\n<pre><code>tail (dropUntil (==':') line)\n</code></pre>\n\n<p>Then a value-strict map would actually extract the value upon insert, while a lazy one would happily just remember how to get it. This is then also what you would get on a <code>lookup</code></p>\n\n<p>Here are some pros and cons:</p>\n\n<ul>\n<li>lazy values may need more memory, not only for the thunk itself, but also for the data that are referenced there (here <code>line</code>).</li>\n<li>strict values may need more memory. In our case this could be so when the string gets interpreted to yield some memory hungry structure like lists, JSON or XML.</li>\n<li>using lazy values may need less CPU if your code doesn't need every value. </li>\n<li>too deep nesting of thunks may cause stack-overflows when the value is finally needed.</li>\n<li>there is also a semantic difference: in lazy mode, you may get away when the code to extract the value would fail (like the above one that fails if there isnt a ':' on the line) if you just need to look whether the key is present. In strict mode, your program crashes upon insert.</li>\n</ul>\n\n<p>As always, there are no fixed measures like: \"If your evaluated value needs less than 20 bytes and takes less than 30\u00b5s to compute, use strict, else use lazy.\"</p>\n\n<p>Normally, you just go with one and when you notice extreme runtimes/memory usage you try the other.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482532480, "post_id": 41301209, "comment_id": 69820145, "body": "Indeed, lazy <code>adjust</code> is almost never what you want anywhere. Lazy <code>insert</code> is fine though."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1482530305, "last_edit_date": 1482530305, "creation_date": 1482494782, "answer_id": 41301209, "question_id": 41299684, "link": "https://stackoverflow.com/questions/41299684/data-map-how-do-i-tell-if-i-need-value-strict-maps/41301209#41301209", "title": "Data.Map: how do I tell if I &quot;need value-strict maps&quot;?", "body": "<p>Here's a small experiment that shows a difference betwen <code>Data.Map.Lazy</code> and <code>Data.Map.Strict</code>. This code exhausts the heap:</p>\n\n<pre><code>import Data.Foldable\nimport qualified Data.Map.Lazy as M\n\nmain :: IO ()\nmain = print $ foldl' (\\kv i -&gt; M.adjust (+i) 'a' kv) \n                      (M.fromList [('a',0)])\n                      (cycle [0])\n</code></pre>\n\n<p>(Better to compile with a small maximum heap, like <code>ghc Main.hs -with-rtsopts=\"-M20m\"</code>.)</p>\n\n<p>The <code>foldl'</code> keeps the map in WHNF as we iterate over the infinite list of zeros. However, thunks accumulate in the modified value until the heap is exhausted.</p>\n\n<p>The same code with <code>Data.Map.Strict</code> simply loops forever. In the strict variant, the values are in WHNF whenever the map is in WHNF.</p>\n"}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 2, "accepted_answer_id": 41301162, "answer_count": 2, "score": 8, "last_activity_date": 1482530305, "creation_date": 1482489047, "last_edit_date": 1482489436, "question_id": 41299684, "link": "https://stackoverflow.com/questions/41299684/data-map-how-do-i-tell-if-i-need-value-strict-maps", "title": "Data.Map: how do I tell if I &quot;need value-strict maps&quot;?", "body": "<p>When choosing between <code>Data.Map.Lazy</code> and <code>Data.Map.Strict</code>, the docs tell us for the former:</p>\n\n<blockquote>\n  <p>API of this module is strict in the keys, but lazy in the values. <em>If you need</em> value-strict maps, use <code>Data.Map.Strict</code> instead.</p>\n</blockquote>\n\n<p>and for the latter likewise:</p>\n\n<blockquote>\n  <p>API of this module is strict in both the keys and the values. <em>If you need</em> value-lazy maps, use <code>Data.Map.Lazy</code> instead.</p>\n</blockquote>\n\n<p>How do more seasoned Haskellers than me tend to intuit this \"need\"? Use-case in point, in a run-and-done (ie. not daemon-like/long-running) command-line tool: <code>readFile</code>ing a simple <code>lines</code>-based custom config file where many (not all) lines define key:value pairs to be collected into a <code>Map</code>. Once done, we rewrite many values in it depending on other values in it that were read later (thanks to immutability, in this process we create a new <code>Map</code> and discard the initial incarnation).</p>\n\n<p>(Although in practice this file likely won't often or ever reach even a 1000 lines, let's just assume for the sake of learning that for some users it will before long.)</p>\n\n<p>Any given run of the tool will perhaps lookup some 20-100% of the (rewritten on load, although with lazy-eval I'm never quite sure \"when <em>really</em>\") key:value pairs, anywhere between once and dozens of times.</p>\n\n<p>How do I reason about the differences between \"value-strict\" and \"value-lazy\" <code>Data.Map</code>s here? What happens \"under the hood\", in terms of mainstream computing if you will?</p>\n\n<p>Fundamentally, such hash-maps are of course about \"storing once, looking up many times\" --- but then, what in computing isn't, \"fundamentally\". And furthermore the whole concept of lazy-eval's thunks seems to boil down to this very principle, so why not <em>always</em> stay value-lazy?</p>\n"}, {"tags": ["haskell", "linker", "haskell-stack", "glu"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482489363, "post_id": 41297444, "comment_id": 69801784, "body": "Try to add flag <code>--include-dirs=&#47;usr&#47;include</code> or <code>--include-dirs=&#47;nix&#47;store&#47;a4vqmz3737v3almi0pzawjgs9gdhprcr-g&zwnj;&#8203;lu-9.0.0-dev&#47;include</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482533019, "post_id": 41297444, "comment_id": 69820274, "body": "If you are using <code>nix</code> (I do not use it so I can&#39;t say for certain) shouldn&#39;t it be the one to manage the setup of a proper environment for compilation? What does just <code>stack install GLURaw</code> give you?"}], "owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482479859, "creation_date": 1482479859, "question_id": 41297444, "link": "https://stackoverflow.com/questions/41297444/gluraw-failing-due-to-missing-header-file", "title": "GLURaw failing due to missing header file", "body": "<p>I'm trying to use <code>gloss</code> which depends on <code>GLURaw</code>, and getting this error:</p>\n\n<p><code>stack install --extra-lib-dirs=/usr/lib/nvidia-367 --extra-lib-dirs=/usr/lib/x86_64-linux-gnu</code></p>\n\n<pre><code>/tmp/stack1018/GLURaw-2.0.0.2/cbits/HsGLURaw.c:74:20: error:\n     fatal error: GL/glu.h: No such file or directory\ncompilation terminated.\n`cc' failed in phase `C Compiler'. (Exit code: 1)\n</code></pre>\n\n<p>I definitely have that file</p>\n\n<pre><code>locate glu.h\n/nix/store/a4vqmz3737v3almi0pzawjgs9gdhprcr-glu-9.0.0-dev/include/GL/glu.h\n/usr/include/GL/glu.h\n</code></pre>\n\n<p>and have no idea where to go from here. Googling about has not been helpful, and I don't have the low level knowledge of <code>cabal</code> or <code>ghc</code>'s means of interacting with C, to troubleshoot. Please help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1482485142, "post_id": 41296387, "comment_id": 69799553, "body": "One must remember that <code>(.)</code> isn&#39;t some built-in magic operator; it&#39;s a normal function defined as any other function would be."}, {"owner": {"reputation": 1909, "user_id": 4876196, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4368b76bec0fddbb8e507521ee69c7da?s=128&d=identicon&r=PG", "display_name": "Kittsil", "link": "https://stackoverflow.com/users/4876196/kittsil"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1482498687, "post_id": 41296387, "comment_id": 69806564, "body": "@AJFarmar The issue (although I did not realize at the time of asking) was primarily that the error message was not helpful. I still don&#39;t understand why max should expect <code>a0 -&gt; Float</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1482475522, "creation_date": 1482475522, "answer_id": 41296484, "question_id": 41296387, "link": "https://stackoverflow.com/questions/41296387/chaining-max-with-operator-in-haskell/41296484#41296484", "title": "Chaining max with . operator in Haskell", "body": "<p>Recall the definition of <code>(.)</code>:</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>You have the expression</p>\n\n<pre><code>max a (max b c)\n</code></pre>\n\n<p>which matches the right hand side of <code>(f . g) x</code> if we set <code>f = max a</code>, <code>g = max b</code>, and <code>x = c</code>. Using these substitutions on the left-hand side of the definition of <code>(.)</code>, we get:</p>\n\n<pre><code>(max a . max b) c = max a (max b c)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 6, "last_activity_date": 1482478873, "creation_date": 1482478873, "answer_id": 41297208, "question_id": 41296387, "link": "https://stackoverflow.com/questions/41296387/chaining-max-with-operator-in-haskell/41297208#41297208", "title": "Chaining max with . operator in Haskell", "body": "<p>Let's introduce some more parentheses in your first example:</p>\n\n<pre><code>max3 a b c = (max a) ((max b) c)\n</code></pre>\n\n<p>Now compare that to the ones in your last one:</p>\n\n<pre><code>max3 a b c = (max a) . ((max b) c)\n</code></pre>\n\n<p>Or, if we write <code>(.)</code> in prefix notation:</p>\n\n<pre><code>max3 a b c = (.) (max a) ((max b) c)\n</code></pre>\n\n<p>And now we see why you get that error. In order to type-check, <code>(max b) c</code> needs to be a function:</p>\n\n<pre><code>(.)       :: (b     -&gt; c    )  -&gt; (a -&gt; b   ) -&gt; a -&gt; c\nmax a     ::  Float -&gt; Float\nmax b c   ::                           Float\n                                  ^^^^^^^^^^^\n</code></pre>\n\n<p>We get a better error message if we use a constrained version of <code>max</code> instead:</p>\n\n<pre><code>maxFloat :: Float -&gt; Float -&gt; Float\nmaxFloat = max\n\nmax3 a b c = max a . max b c\n</code></pre>\n\n<p>Now the error message is a lot better:</p>\n\n<blockquote>\n<pre><code>Couldn't match expected type \u2018a0 -&gt; Float\u2019 with actual type \u2018Float\u2019\nPossible cause: \u2018maxFloat\u2019 is applied to too many arguments\nIn the second argument of \u2018(.)\u2019, namely \u2018maxFloat b c\u2019\nIn the expression: maxFloat a . maxFloat b c\n</code></pre>\n</blockquote>\n\n<p>That being said, let's actually tackle the problem:</p>\n\n<pre><code>max3 a b c = max a ((max b) c)\n           = (max a . max b) c\n</code></pre>\n\n<p>Note that you can also write</p>\n\n<pre><code>max3 :: Ord a =&gt; a -&gt; a -&gt; a -&gt; a   \nmax3 a b = max a . max b\n</code></pre>\n"}], "owner": {"reputation": 1909, "user_id": 4876196, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4368b76bec0fddbb8e507521ee69c7da?s=128&d=identicon&r=PG", "display_name": "Kittsil", "link": "https://stackoverflow.com/users/4876196/kittsil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 41296484, "answer_count": 2, "score": 1, "last_activity_date": 1482478873, "creation_date": 1482475113, "question_id": 41296387, "link": "https://stackoverflow.com/questions/41296387/chaining-max-with-operator-in-haskell", "title": "Chaining max with . operator in Haskell", "body": "<p>I'm trying to use the <code>.</code> operator to write a function that takes three values and returns their maximum.</p>\n\n<p>Obviously, the following work</p>\n\n<pre><code>max3 a b c = max a (max b c)\nmax3 a b c = max a $ max b c\n</code></pre>\n\n<p>but I would like to use <code>.</code>. I tried</p>\n\n<pre><code>max3 a b c = max a . max b c\n</code></pre>\n\n<p>but get the error </p>\n\n<pre><code>Couldn't match expected type `a0 -&gt; Float' with actual type `Float'\nIn the first argument of `max', namely `b'\n</code></pre>\n\n<p>I know that the example is silly, but a nice explanation of the correct way to do this <em>and why</em> would be greatly appreciated.</p>\n"}, {"tags": ["haskell", "erlang", "quickcheck"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482533783, "post_id": 41294502, "comment_id": 69820473, "body": "A QuickCheck property about a stateful or nonstateful function is the same thing - it&#39;s just another function whose return type is <code>Property</code>. You are probably looking for <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/Test-QuickCheck-Monadic.html\" rel=\"nofollow noreferrer\"><code>Test.QuickCheck.Monadic</code></a>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1482543878, "post_id": 41294502, "comment_id": 69822518, "body": "Actually I&#39;m lookin for a real-life example of using Haskell QC to check a real-life stateful system without duplicating core logic in the test itself."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 1, "creation_date": 1482543785, "post_id": 41296826, "comment_id": 69822497, "body": "Isn&#39;t there any support for pre/post conditions in QC? This code looks very different from what&#39;s on John Hughes&#39; slides! Also, is it always possible to have a simplified model of business applications without duplicating the core logic itself?"}, {"owner": {"reputation": 2229, "user_id": 484529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rp6uy.png?s=128&g=1", "display_name": "ijt", "link": "https://stackoverflow.com/users/484529/ijt"}, "edited": false, "score": 0, "creation_date": 1483082541, "post_id": 41296826, "comment_id": 69986538, "body": "A lot of the time the logic in a real world application is obscured by various things. For example, someone may have taken straightforward logic and spread it around in a class hierarchy or deeply nested calls, or you could be dealing with a microservices architecture. It may not always be possible to make a simplified model, but software has a tendency to grow in complexity over time, so it&#39;s likely enough to be worth a try."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1482477115, "creation_date": 1482477115, "answer_id": 41296826, "question_id": 41294502, "link": "https://stackoverflow.com/questions/41294502/state-machine-based-testing-in-haskell-quickcheck/41296826#41296826", "title": "State machine based testing in Haskell QuickCheck", "body": "<p>I don't think there's any explicit support in QuickCheck, but I think the general approach in Haskell would be something like the following example.</p>\n\n<p>It tests a test system (custom <code>List</code> instance) against a model (a real Haskell list).  The key is to generate arbitrary sequences of stateful primitive operations (e.g., <code>Push</code>, <code>Pop</code>, and <code>IsEmpty</code>) and apply them to both the test system and the model in a monadic fashion, checking post conditions after each operation.  In this case, the post conditions are just to test that operations that return values (<code>pop</code> and <code>isEmpty</code>) return the same values for the test system and model, but it could easily be modified to test other post conditions (or add pre-conditions).</p>\n\n<p>If a test fails, it will return a minimal sequence of operations applied to the empty list that causes the post conditions to fail.</p>\n\n<pre><code>{-# LANGUAGE GADTs, StandaloneDeriving #-}\n\nmodule ListTest where\n\nimport Test.QuickCheck\nimport Data.Monoid\nimport Control.Monad\n\n-- |The system to test\n\ndata List a = Empty | Cons a (List a) deriving (Show, Eq)\npush x lst = Cons x lst\npop (Cons x lst) = (Just x, lst)\npop Empty = (Nothing, Empty)\nisEmpty Empty = True\nisEmpty _     = False\n\n-- |The model (based on plain Haskell lists)\n\ntype Model a = [a]\npushM = (:)\npopM []     = (Nothing, [])\npopM (x:xs) = (Just x, xs)\nisEmptyM [] = True\nisEmptyM _  = False\n\n-- |Operations on lists of `a`s\ndata Op a = Push a | Pop | IsEmpty deriving (Show, Eq)\ninstance Arbitrary a =&gt; Arbitrary (Op a) where\n  arbitrary = oneof ([Push &lt;$&gt; arbitrary, pure Pop, pure IsEmpty])\n\n-- |For each op, return tuple of: (return values matched?, (new List, new Model))\ncompare_op :: (Eq a) =&gt; Op a -&gt; (List a, Model a) -&gt; (All, (List a, Model a))\ncompare_op (Push x) (lst, mdl) = -- True b/c no return value to compare\n                                 (All True, (push x lst, pushM x mdl))\ncompare_op Pop      (lst, mdl) = let (y1, lst') = pop lst\n                                     (y2, mdl') = popM mdl\n                                 in  (All (y1 == y2), (lst', mdl'))\ncompare_op IsEmpty  (lst, mdl) = (All (isEmpty lst == isEmptyM mdl), (lst, mdl))\n\n-- |The property that a sequence of operations has matching return values.\nprop_model :: [Op Int] -&gt; Bool\nprop_model ops = (getAll . fst . foldM (flip compare_op) (Empty, [])) ops\n\nmain :: IO ()\nmain = quickCheck prop_model\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1482477115, "creation_date": 1482460910, "question_id": 41294502, "link": "https://stackoverflow.com/questions/41294502/state-machine-based-testing-in-haskell-quickcheck", "title": "State machine based testing in Haskell QuickCheck", "body": "<p>Does Haskell QuickCheck have the state machine based features that John Hughes' describes in the following talk and paper - </p>\n\n<ul>\n<li><a href=\"http://publications.lib.chalmers.se/records/fulltext/232550/local_232550.pdf\" rel=\"nofollow noreferrer\">http://publications.lib.chalmers.se/records/fulltext/232550/local_232550.pdf</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=zi0rHwfiX1Q\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=zi0rHwfiX1Q</a></li>\n</ul>\n\n<p>If not, how does one actually do stateful testing using Haskell's QuickCheck? For example, what is the best way to test a circular buffer using Haskell QuickCheck without reimplementing the core logic in the test itself. </p>\n"}, {"tags": ["haskell", "cabal", "ffi"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482446608, "post_id": 41292462, "comment_id": 69788209, "body": "Huh, that&#39;s pretty lame. Other fields support wildcards (ctrl-f &quot;wildcard&quot; here: <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html\" rel=\"nofollow noreferrer\">haskell.org/cabal/users-guide/developing-packages.html</a>)"}, {"owner": {"reputation": 240, "user_id": 1940358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/756366f85834404637bad7c627e0ac9c?s=128&d=identicon&r=PG", "display_name": "thumphries", "link": "https://stackoverflow.com/users/1940358/thumphries"}, "edited": false, "score": 0, "creation_date": 1482465785, "post_id": 41292462, "comment_id": 69792640, "body": "Indeed, this is likely a bug! Though you can also populate this field programmatically using Setup.hs, as described below. I have done this when working on autogenerated packages, as the wildcard functionality in Cabal is rather restricted."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1482445265, "creation_date": 1482445265, "answer_id": 41292494, "question_id": 41292462, "link": "https://stackoverflow.com/questions/41292462/programmatically-listing-c-sources-in-haskell-cabal-files/41292494#41292494", "title": "Programmatically Listing `C-sources` in Haskell Cabal Files", "body": "<p>Sorry, no programming is allowed in cabal files. This level of simplicity has some drawbacks, as you note, but it also has some benefits: tools are more predictable, and it is drop-dead simple to read somebody else's cabal file (you don't have to turn on your programmer brain!).</p>\n"}, {"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1484071768, "post_id": 41294115, "comment_id": 70355763, "body": "It&#39;s unclear to me from that link how to add <code>src&#47;*.c</code> and <code>include&#47;*.h</code>. I added a new question for it <a href=\"http://stackoverflow.com/questions/41575528/how-to-automatically-include-haskell-c-sources-through-setup-hs-build-script\">here</a>."}], "tags": [], "owner": {"reputation": 145, "user_id": 6840642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e5097e226bafec8ac922e683f1ad195?s=128&d=identicon&r=PG&f=1", "display_name": "Hapal", "link": "https://stackoverflow.com/users/6840642/hapal"}, "is_accepted": false, "score": 3, "last_activity_date": 1482457355, "creation_date": 1482457355, "answer_id": 41294115, "question_id": 41292462, "link": "https://stackoverflow.com/questions/41292462/programmatically-listing-c-sources-in-haskell-cabal-files/41294115#41294115", "title": "Programmatically Listing `C-sources` in Haskell Cabal Files", "body": "<p>I wanted to add a comment, but stackoverflow tells me that I need <em>50 reputation</em> to comment!</p>\n\n<p>You should be able to do this with a custom <code>Setup.hs</code> file.\nHere is an example that might help you:\n<a href=\"https://hackage.haskell.org/package/base-noprelude-4.7.0.0/src/Setup.hs\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-noprelude-4.7.0.0/src/Setup.hs</a></p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1482457355, "creation_date": 1482445084, "question_id": 41292462, "link": "https://stackoverflow.com/questions/41292462/programmatically-listing-c-sources-in-haskell-cabal-files", "title": "Programmatically Listing `C-sources` in Haskell Cabal Files", "body": "<p>I am involved in a Haskell project which involves a lot of C FFI. Thus, for every <code>src/HaskellFile.hs</code> I have in my project, I have a corresponding <code>src/HaskellFile.c</code> C source file. This means I have to manually this all of these C sources in my cabal project:</p>\n\n<pre><code>C-sources:           src/HaskellFile1.c, src/HaskellFile2.c\n</code></pre>\n\n<p>...and so forth.</p>\n\n<p><strong>Question:</strong> Is it possible to programmatically list out these files in my cabal project file? Something like:</p>\n\n<pre><code>C-sources:           src/*.c\n</code></pre>\n\n<p>..? (For the record, I tried the above and it didn't work).</p>\n"}, {"tags": ["haskell", "computer-science"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 14, "creation_date": 1482444984, "post_id": 41292341, "comment_id": 69787673, "body": "There&#39;s probably nothing wrong. But in the Report, the behavior of strict fields is given in terms of <code>seq</code>. Gotta have one or the other as primitive, and it doesn&#39;t matter much which, but people generally think of <code>seq</code> as being the primitive one and strict fields as the derived one. You could probably define <code>seq</code> in terms of <code>($!)</code>, too, but it would suffer from the same complaint."}, {"owner": {"reputation": 41, "user_id": 7332433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b2d474690262e86697509ad1d8a9ac4?s=128&d=identicon&r=PG&f=1", "display_name": "arbrk1", "link": "https://stackoverflow.com/users/7332433/arbrk1"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482465241, "post_id": 41292341, "comment_id": 69792519, "body": "Thank you! The report definitely says that an application of a data constructor with strict fields is defined in terms of <code>$!</code> so my definitions use <code>seq</code> implicitly."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1482518593, "post_id": 41292341, "comment_id": 69815701, "body": "@DanielWagner That should probably be an answer"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1482780300, "post_id": 41292341, "comment_id": 69873470, "body": "The built-in <code>pseq</code> and <code>seq</code> don&#39;t differ semantically.  Similarly, your <code>pseq</code> and <code>seq</code> don&#39;t differ semantically. There is nothing that guarantees that your definition of <code>pseq</code> will provide the <i>operational</i> guarantees that the built-in definition provides. I doubt it does in general even with the current GHC, and, of course, even if it does now, it may not in the future."}], "owner": {"reputation": 41, "user_id": 7332433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b2d474690262e86697509ad1d8a9ac4?s=128&d=identicon&r=PG&f=1", "display_name": "arbrk1", "link": "https://stackoverflow.com/users/7332433/arbrk1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1482444423, "creation_date": 1482444423, "question_id": 41292341, "link": "https://stackoverflow.com/questions/41292341/whats-wrong-with-these-definitions-of-seq-pseq", "title": "What&#39;s wrong with these definitions of seq/pseq?", "body": "<p>There is a widespread opinion that seq/pseq functions are impossible to define in standard Haskell without extensions or primitive operations. But what is the difference between the behaviour of the following functions (defined using only standard Haskell 98/2010) and their real counterparts?</p>\n\n<pre><code>data Seq a b = Seq !a !b\nseq a b = case Seq a b of\n    Seq _ x -&gt; x\n\ndata PSeq a b = PSeq !a b\npseq a b = case PSeq a b of\n    PSeq _ x -&gt; x\n</code></pre>\n\n<p>For example, it's easy to check that this definition satisfies </p>\n\n<pre><code>seq \u22a5 x = \u22a5\n</code></pre>\n\n<p>Some other simple experiments show no difference between these versions of seq/pseq and the real ones. So what's wrong?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 3, "creation_date": 1482438445, "post_id": 41291141, "comment_id": 69784867, "body": "Yes. These days, types and kinds are pretty much the same thing."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482442494, "post_id": 41291141, "comment_id": 69786652, "body": "You can declare a type constructor with kind <code>Char -&gt; ...</code> but there are no types which inhabit the kind <code>Char</code>, because <code>data Char = C# Char#</code> and primitive types are not promotable."}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1482454635, "post_id": 41291141, "comment_id": 69790379, "body": "Have you looked at GADT&#39;s?"}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1482439551, "post_id": 41291286, "comment_id": 69785348, "body": "Check again. You may find things have changed."}, {"owner": {"reputation": 1552, "user_id": 2362671, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0585760afe78ec9aafe1836b826ed495?s=128&d=identicon&r=PG", "display_name": "Come Raczy", "link": "https://stackoverflow.com/users/2362671/come-raczy"}, "edited": false, "score": 1, "creation_date": 1482439923, "post_id": 41291286, "comment_id": 69785538, "body": "<a href=\"https://wiki.haskell.org/Dependent_type\" rel=\"nofollow noreferrer\">this is the first entry</a> for a google search on &#39;Haskell dependent types&#39;"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1482441633, "post_id": 41291286, "comment_id": 69786252, "body": "<code>data MyType c a where MkMyType :: a -&gt; MyType &#39;x&#39; a</code> (or maybe it needs to be <code>&#39;&#39;x&#39;</code>, don&#39;t have my compy to try) has precisely the desired kind.  While it&#39;s true that Haskell doesn&#39;t have full dependent types, I don&#39;t think &quot;No&quot; is the correct answer."}], "tags": [], "owner": {"reputation": 1, "user_id": 6567329, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BkodqnDCiIU/AAAAAAAAAAI/AAAAAAAAAIk/xoHScX9gH0s/photo.jpg?sz=128", "display_name": "Matthew Avant", "link": "https://stackoverflow.com/users/6567329/matthew-avant"}, "is_accepted": false, "score": 0, "last_activity_date": 1482438959, "creation_date": 1482438959, "answer_id": 41291286, "question_id": 41291141, "link": "https://stackoverflow.com/questions/41291141/can-a-haskell-type-constructor-have-non-type-parameters/41291286#41291286", "title": "Can a Haskell type constructor have non-type parameters?", "body": "<p>No. Haskell doesn't have dependent types (yet). See <a href=\"https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/\" rel=\"nofollow noreferrer\">https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/</a> for some discussion of when it may.</p>\n\n<p>In the meantime, you can get behavior like this in Agda, Idris, and Cayenne.</p>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 5329413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6f0686eeef3cf53df83e0e27c0cb4f?s=128&d=identicon&r=PG&f=1", "display_name": "ebrahim", "link": "https://stackoverflow.com/users/5329413/ebrahim"}, "edited": false, "score": 0, "creation_date": 1482508992, "post_id": 41292585, "comment_id": 69811420, "body": "This doesn&#39;t really give what I wanted in my question, but I didn&#39;t know of it and it was a neat thing to learn about. Thanks."}], "tags": [], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "is_accepted": false, "score": 1, "last_activity_date": 1483300771, "last_edit_date": 1483300771, "creation_date": 1482445885, "answer_id": 41292585, "question_id": 41291141, "link": "https://stackoverflow.com/questions/41291141/can-a-haskell-type-constructor-have-non-type-parameters/41292585#41292585", "title": "Can a Haskell type constructor have non-type parameters?", "body": "<p>Look at using Generalized Algebraic Data Types (GADTS), which enable you to define concrete outputs based on input type, e.g. </p>\n\n<pre><code>data CustomMaybe a where\n  MaybeChar :: Maybe a -&gt; CustomMaybe Char\n  MaybeString :: Maybe a &gt; CustomMaybe String\n  MaybeBool :: Maybe a -&gt; CustomMaybe Bool\n\nexampleFunction :: CustomMaybe a -&gt; a\nexampleFunction (MaybeChar maybe) = 'e' \nexampleFunction (MaybeString maybe) = True //Compile error\n\nmain = do \n  print $ exampleFunction (MaybeChar $ Just 10)\n</code></pre>\n\n<p>To a similar effect, RankNTypes can allow the implementation of similar behaviour: </p>\n\n<pre><code>exampleFunctionOne :: a -&gt; a\nexampleFunctionOne el = el\n\ntype PolyType = forall a. a -&gt; a\n\nexampleFuntionTwo :: PolyType -&gt; Int\nexampleFunctionTwo func = func 20\nexampleFunctionTwo func = func \"Hello\" --Compiler error, PolyType being forced to return 'Int'\n\nmain = do\n  print $ exampleFunctionTwo exampleFunctionOne\n</code></pre>\n\n<p>The PolyType definition allows you to insert the polymorphic function within exampleFunctionTwo and force its output to be 'Int'.</p>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 5329413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6f0686eeef3cf53df83e0e27c0cb4f?s=128&d=identicon&r=PG&f=1", "display_name": "ebrahim", "link": "https://stackoverflow.com/users/5329413/ebrahim"}, "edited": false, "score": 0, "creation_date": 1482508840, "post_id": 41293430, "comment_id": 69811342, "body": "The DataKinds extension, the TypeInType project, the notion of a singleton type, and the notion of a dependently-typed language all address my question. I&#39;ll be looking into these things, thanks!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 8, "last_activity_date": 1483615875, "last_edit_date": 1495539964, "creation_date": 1482451402, "answer_id": 41293430, "question_id": 41291141, "link": "https://stackoverflow.com/questions/41291141/can-a-haskell-type-constructor-have-non-type-parameters/41293430#41293430", "title": "Can a Haskell type constructor have non-type parameters?", "body": "<blockquote>\n  <p>Can a Haskell type constructor have non-type parameters?</p>\n</blockquote>\n\n<p>Let's unpack what you mean by <em>type parameter</em>. The word <em>type</em> has (at least) two potential meanings: do you mean <em>type</em> in the narrow sense of <em>things of kind <code>*</code></em>, or in the broader sense of <em>things at the type level</em>? We can't (yet) use values in types, but modern GHC features a very rich kind language, allowing us to use a wide range of things other than concrete types as type parameters.</p>\n\n<h2>Higher-Kinded Types</h2>\n\n<p>Type constructors in Haskell have always admitted non-<code>*</code> parameters. For example, the encoding of the fixed point of a functor works in plain old Haskell 98:</p>\n\n<pre><code>newtype Fix f = Fix { unFix :: f (Fix f) }\n\nghci&gt; :k Fix\nFix :: (* -&gt; *) -&gt; *\n</code></pre>\n\n<p><code>Fix</code> is parameterised by a functor of kind <code>* -&gt; *</code>, not a type of kind <code>*</code>.</p>\n\n<h2>Beyond <code>*</code> and <code>-&gt;</code></h2>\n\n<p>The <code>DataKinds</code> extension enriches GHC's kind system with user-declared kinds, so kinds may be built of pieces other than <code>*</code> and <code>-&gt;</code>. It works by <em>promoting</em> all <code>data</code> declarations to the kind level. That is to say, a <code>data</code> declaration like</p>\n\n<pre><code>data Nat = Z | S Nat  -- natural numbers\n</code></pre>\n\n<p>introduces a <em>kind</em> <code>Nat</code> and <em>type</em> constructors <code>Z :: Nat</code> and <code>S :: Nat -&gt; Nat</code>, as well as the usual type and value constructors. This allows you to write datatypes parameterised by type-level data, such as the customary <em>vector</em> type, which is a linked list indexed by its length.</p>\n\n<pre><code>data Vec n a where\n    Nil :: Vec Z a\n    (:&gt;) :: a -&gt; Vec n a -&gt; Vec (S n) a\n\nghci&gt; :k Vec\nVec :: Nat -&gt; * -&gt; *\n</code></pre>\n\n<p>There's a related extension called <code>ConstraintKinds</code>, which frees constraints like <code>Ord a</code> from the yoke of the \"fat arrow\" <code>=&gt;</code>, allowing them to roam across the landscape of the type system as nature intended. Kmett has used this power to build a <a href=\"https://hackage.haskell.org/package/constraints-0.8/docs/Data-Constraint.html\" rel=\"nofollow noreferrer\">category of constraints</a>, with the newtype <code>(:-) :: Constraint -&gt; Constraint -&gt; *</code> denoting \"entailment\": a value of type <code>c :- d</code> is a proof that if <code>c</code> holds then <code>d</code> also holds. For example, we can prove that <code>Ord a</code> implies <code>Eq [a]</code> for all <code>a</code>:</p>\n\n<pre><code>ordToEqList :: Ord a :- Eq [a]\nordToEqList = Sub Dict\n</code></pre>\n\n<h2>Life after <code>forall</code></h2>\n\n<p>However, Haskell currently maintains a strict separation between the type level and the value level. Things at the type level are always erased before the program runs, (almost) always inferrable, invisible in expressions, and (dependently) quantified by <code>forall</code>. If your application requires something more flexible, such as dependent quantification over runtime data, then you have to manually simulate it using a <em>singleton</em> encoding.</p>\n\n<p>For example, the specification of <code>split</code> says it chops a vector at a certain length according to its (runtime!) argument. The <em>type</em> of the output vector depends on the <em>value</em> of <code>split</code>'s argument. We'd like to write this...</p>\n\n<pre><code>split :: (n :: Nat) -&gt; Vec (n :+: m) a -&gt; (Vec n a, Vec m a)\n</code></pre>\n\n<p>... where I'm using the type function <code>(:+:) :: Nat -&gt; Nat -&gt; Nat</code>, which stands for addition of type-level naturals, to ensure that the input vector is at least as long as <code>n</code>...</p>\n\n<pre><code>type family n :+: m where\n    Z :+: m = m\n    S n :+: m = S (n :+: m)\n</code></pre>\n\n<p>... but Haskell won't allow that declaration of <code>split</code>! There aren't any values of type <code>Z</code> or <code>S n</code>; only types of kind <code>*</code> contain values. We can't access <code>n</code> at runtime directly, but we can use a GADT which we can pattern-match on to <em>learn</em> what the type-level <code>n</code> is:</p>\n\n<pre><code>data Natty n where\n    Zy :: Natty Z\n    Sy :: Natty n -&gt; Natty (S n)\n\nghci&gt; :k Natty\nNatty :: Nat -&gt; *\n</code></pre>\n\n<p><code>Natty</code> is called a <em>singleton</em>, because for a given (well-defined) <code>n</code> there is only one (well-defined) value of type <code>Natty n</code>. We can use <code>Natty n</code> as a run-time stand-in for <code>n</code>.</p>\n\n<pre><code>split :: Natty n -&gt; Vec (n :+: m) a -&gt; (Vec n a, Vec m a)\nsplit Zy xs = (Nil, xs)\nsplit (Sy n) (x :&gt; xs) =\n    let (ys, zs) = split n xs\n    in (x :&gt; ys, zs)\n</code></pre>\n\n<p>Anyway, the point is that values - runtime data - can't appear in types. It's pretty tedious to duplicate the definition of <code>Nat</code> in singleton form (and things get worse if you want the compiler to infer such values); dependently-typed languages like Agda, Idris, or a future Haskell escape the tyranny of strictly separating types from values and give us a range of expressive quantifiers. You're able to use an honest-to-goodness <code>Nat</code> as <code>split</code>'s runtime argument and mention its value dependently in the return type.</p>\n\n<p>@pigworker has written extensively about the unsuitability of Haskell's strict separation between types and values for modern dependently-typed programming. See, for example, <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">the <em>Hasochism</em> paper</a>, or his <a href=\"https://www.youtube.com/watch?v=ad4BVmPni7A\" rel=\"nofollow noreferrer\">talk</a> on the unexamined assumptions that have been drummed into us by four decades of Hindley-Milner-style programming.</p>\n\n<h2>Dependent Kinds</h2>\n\n<p>Finally, for what it's worth, with <code>TypeInType</code> modern GHC unifies types and kinds, allowing us to talk about kind variables using the same tools that we use to talk about type variables. In <a href=\"https://stackoverflow.com/a/40468548/1523776\">a previous post</a> about session types I made use of <code>TypeInType</code> to define a kind for tagged type-level sequences of types:</p>\n\n<pre><code>infixr 5 :!, :?\ndata Session = Type :! Session  -- Type is a synonym for *\n             | Type :? Session\n             | E\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482466591, "post_id": 41295056, "comment_id": 69792791, "body": "The advantage over two separate data types only comes in if you have other things of kind <code>Bool</code> floating around.  Then you can write functions of type <code>Flagged b a -&gt; Flogged b</code>, which would otherwise require defining a type family to convert between the two representations."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1482484115, "post_id": 41295056, "comment_id": 69799029, "body": "The reason type-level Booleans usually aren&#39;t very useful is because people tend to use them as a stand-in for the information they&#39;re actually interested in. Erasing such information to a single bit means you have to reconstruct it by hand. If I had a pound for every Stack Overflow question where the root cause of the problem was inappropriate use of type-level Booleans..."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1482466065, "creation_date": 1482466065, "answer_id": 41295056, "question_id": 41291141, "link": "https://stackoverflow.com/questions/41291141/can-a-haskell-type-constructor-have-non-type-parameters/41295056#41295056", "title": "Can a Haskell type constructor have non-type parameters?", "body": "<p>I'd recommend @Benjamin Hodgson's answer and the references he gives to see how to make this sort of thing <em>useful</em>.  But, to answer your question more directly, using several extensions (<code>DataKinds</code>, <code>KindSignatures</code>, and <code>GADTs</code>), you can define types that are parameterized on (certain) concrete types.</p>\n\n<p>For example, here's one parameterized on the concrete <code>Bool</code> datatype:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, GADTs #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule FlaggedType where\n\n-- The single quotes below are optional.  They serve to notify\n-- GHC that we are using the type-level constructors lifted from\n-- data constructors rather than types of the same name (and are\n-- only necessary where there's some kind of ambiguity otherwise).\ndata Flagged :: Bool -&gt; * -&gt; * where\n  Truish  :: a -&gt; Flagged 'True a\n  Falsish :: a -&gt; Flagged 'False a\n\n-- separate instances, just as if they were different types\n-- (which they are)\ninstance (Show a) =&gt; Show (Flagged 'False a) where\n  show (Falsish x) = show x\ninstance (Show a) =&gt; Show (Flagged 'True a) where\n  show (Truish x) = show x ++ \"*\"\n\n-- these lists have types as indicated\nx = [Truish 1, Truish 2, Truish 3]           -- :: Flagged 'True Integer\ny = [Falsish \"a\", Falsish \"b\", Falsish \"c\"]  -- :: Flagged 'False String\n\n-- this won't typecheck: it's just like [1,2,\"abc\"]\nz = [Truish 1, Truish 2, Falsish 3]          -- won't typecheck\n</code></pre>\n\n<p>Note that this isn't much different from defining two completely separate types:</p>\n\n<pre><code>data FlaggedTrue a = Truish a\ndata FlaggedFalse a = Falsish a\n</code></pre>\n\n<p>In fact, I'm hard pressed to think of any advantage <code>Flagged</code> has over defining two separate types, except if you have a bar bet with someone that you can write useful Haskell code without type classes.  For example, you can write:</p>\n\n<pre><code>getInt :: Flagged a Int -&gt; Int\ngetInt (Truish z) = z    -- same polymorphic function...\ngetInt (Falsish z) = z   -- ...defined on two separate types\n</code></pre>\n\n<p>Maybe someone else can think of some other advantages.</p>\n\n<p>Anyway, I believe that parameterizing types with concrete values really only becomes useful when the concrete type is sufficient \"rich\" that you can use it to leverage the type checker, as in Benjamin's examples.</p>\n\n<p>As @user2407038 noted, most interesting primitive types, like <code>Int</code>s, <code>Char</code>s, <code>String</code>s and so on <em>can't</em> be used this way.  Interestingly enough, though, you <em>can</em> use literal positive integers and strings as type parameters, but they are treated as <code>Nat</code>s and <code>Symbol</code>s (as defined in <code>GHC.TypeLits</code>) respectively.</p>\n\n<p>So something like this is possible:</p>\n\n<pre><code>import GHC.TypeLits\ndata Tagged :: Symbol -&gt; Nat -&gt; *  -&gt; * where\n    One :: a -&gt; Tagged \"one\" 1 a\n    Two :: a -&gt; Tagged \"two\" 2 a\n    Three :: a -&gt; Tagged \"three\" 3 a\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 5329413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6f0686eeef3cf53df83e0e27c0cb4f?s=128&d=identicon&r=PG&f=1", "display_name": "ebrahim", "link": "https://stackoverflow.com/users/5329413/ebrahim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 584, "favorite_count": 2, "accepted_answer_id": 41293430, "answer_count": 4, "score": 8, "last_activity_date": 1483615875, "creation_date": 1482438287, "question_id": 41291141, "link": "https://stackoverflow.com/questions/41291141/can-a-haskell-type-constructor-have-non-type-parameters", "title": "Can a Haskell type constructor have non-type parameters?", "body": "<p>A type constructor produces a type given a type. For example, the Maybe constructor</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>could be a given a concrete type, like Char, and give a concrete type, like Maybe Char. In terms of kinds, one has</p>\n\n<pre><code>GHCI&gt; :k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p>My question: Is it possible to define a type constructor that yields a concrete type given a <em>Char</em>, say? Put another way, is it possible to mix <em>kinds</em> and <em>types</em> in the type signature of a type constructor? Something like</p>\n\n<pre><code>GHCI&gt; :k my_type\nmy_type :: Char -&gt; * -&gt; *\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1482431749, "post_id": 41289559, "comment_id": 69781745, "body": "Can you provide an example type and Monad instance for what you&#39;re imagining? What do you expect bind to do?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1482432230, "post_id": 41289559, "comment_id": 69781984, "body": "Annotating existing values with extra data is more &quot;comonadic&quot; than &quot;monadic&quot;: <a href=\"http://hackage.haskell.org/package/comonad-5/docs/Control-Comonad.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/comonad-5/docs/Control-Comonad.h&zwnj;&#8203;tml</a> <a href=\"http://hackage.haskell.org/package/comonad-5/docs/Control-Comonad-Env-Class.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/comonad-5/docs/&hellip;</a> notice that the 2-tuple, the simplest way  of annotating a value, has <code>Comonad ((,) e)</code> and <code>ComonadEnv e ((,) e)</code> instances. In practice, perhaps it&#39;s just simpler to use a record."}, {"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482442331, "post_id": 41289559, "comment_id": 69786589, "body": "@jberryman yes, I guess I should have asked myself that question. There&#39;s nothing special here, just needs to carry the extra data along. As danidiaz pointed out, maybe a record is the right way to do this. What I was hoping for is a de facto standard for carrying an arbitrary payload along with a vector of coordinates. I imagined there might be a large body of code written for it. The WithAny solution leftroundabout proposes may be the closest thing I&#39;ve seen so far..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482479246, "post_id": 41289559, "comment_id": 69796951, "body": "You might be interested in <a href=\"http://blog.sigfpe.com/2006/12/evaluating-cellular-automata-is.html\" rel=\"nofollow noreferrer\">this excellent article</a> by sigfpe about cellular automata and comonads"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1482436478, "creation_date": 1482436478, "answer_id": 41290729, "question_id": 41289559, "link": "https://stackoverflow.com/questions/41289559/monadic-space-library-a-vector-of-coordinates-wrapped-in-a-monad-of-unspecified/41290729#41290729", "title": "Monadic space library? A vector of coordinates wrapped in a monad of unspecified type?", "body": "<p>Not sure if that's what you mean, but it might be this <a href=\"http://hackage.haskell.org/package/manifolds-0.4.0.0/docs/Data-Manifold-TreeCover.html#t:WithAny\" rel=\"nofollow noreferrer\">what I've defined in the <code>manifolds</code> library</a> (at the moment it's more of an experimental implementation detail, not a stable exported type):</p>\n\n<pre><code>data WithAny x y = WithAny y !x\n</code></pre>\n\n<p><code>WithAny x y</code> behaves as a <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\">vector space</a> (more generally, as a <a href=\"http://hackage.haskell.org/package/manifolds-0.4.0.0/docs/Data-Manifold-PseudoAffine.html#t:Manifold\" rel=\"nofollow noreferrer\">manifold</a>) in the same way as <code>x</code> does, but each value also has an extra <code>y</code> associated with it which is considered simply as a \u201ctag\u201d and not changed through the continuous-space operations. E.g.</p>\n\n<pre><code>  WithAny y x ^+^ WithAny _ \u03be = WithAny y $ x ^+^ \u03be\n</code></pre>\n\n<p>\u201cOrthogonally\u201d to those instances, the type is a monad in the second argument, with</p>\n\n<pre><code>  fmap f (WithAny y x) = WithAny (f y) x\n</code></pre>\n\n<p>(As danidiaz remarks, it's in particular also a comonad, I just haven't added that instance yet.)</p>\n\n<p>Actually I'm a bit skeptical myself if the semantics of this type are really sensible. After all, points annotated with different discrete tags basically live in completely disjoint space(-sector)s, yet they can appear arbitrarily close through the vectorspace view, indeed you have <code>distance (Withany t x) (WithAny q x) \u2261 0</code> even if these points are clearly not the same.</p>\n"}], "owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 41290729, "answer_count": 1, "score": 1, "last_activity_date": 1482436478, "creation_date": 1482431147, "question_id": 41289559, "link": "https://stackoverflow.com/questions/41289559/monadic-space-library-a-vector-of-coordinates-wrapped-in-a-monad-of-unspecified", "title": "Monadic space library? A vector of coordinates wrapped in a monad of unspecified type?", "body": "<p>This must exist, right? It seems to me that points in mathematical spaces are often made to carry extra baggage. In my case, I'd like to label each point in an n-dimensional space with a name and a domain-specific type. Is a monad the right way to represent such extra baggage, or is a parameterized record the best way to do it? And what libraries provide this sort of capability out of box?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 0, "creation_date": 1482432472, "post_id": 41288120, "comment_id": 69782097, "body": "That works - Realistically there are a variety of easier / better ways to do this.  What I&#39;m really struggling with here is trying to figure out if there is a way to tell guards what to do if an argument can&#39;t be deconstructed via the provided pattern.  Should I take your response to mean that :  &quot;Yes, if you define the pattern in the function declaration, that is not possible when using guards&quot;"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 2, "creation_date": 1482432639, "post_id": 41288120, "comment_id": 69782174, "body": "The function-level pattern matching happens first, which means that the first two guard conditions you have can never possibly be met (those where you check for <code>str</code> of zero or one length)"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1482425561, "creation_date": 1482425561, "answer_id": 41288120, "question_id": 41288067, "link": "https://stackoverflow.com/questions/41288067/haskell-pattern-matching-form-xyzs/41288120#41288120", "title": "Haskell - Pattern Matching form (x:y:zs)", "body": "<p>You are pattern matching at the function definition level. The way you have described it, you are only covering the case where the string is at least two characters long:</p>\n\n<pre><code>myFun str@(f:s:rst)\n</code></pre>\n\n<p>You need to handle other cases as well. You can have a catch-all handler like this (needs to go as the last pattern):</p>\n\n<pre><code>myFun _ = ...\n</code></pre>\n\n<p>Or if you want to handle, for instance, the empty string, like this (prior to the catch-all):</p>\n\n<pre><code>myFun [] = ...\n</code></pre>\n\n<p>As to the purpose of your function, you are probably better off just using pattern matching and not using guards.</p>\n\n<pre><code>myFun :: [Char] -&gt; Char\nmyFun [] = error \"empty string\"\nmyFun [x] = x\nmyFun (x:xs) = myFun xs\n</code></pre>\n\n<p>(Note that it would be more idiomatic to return a <code>Maybe Char</code> instead of crashing your program)</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482445458, "post_id": 41292161, "comment_id": 69787845, "body": "Just for fun, you might also like: <code>lastTwo = reverse . take 2 . reverse</code>."}], "tags": [], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "is_accepted": false, "score": 1, "last_activity_date": 1482452090, "last_edit_date": 1482452090, "creation_date": 1482443476, "answer_id": 41292161, "question_id": 41288067, "link": "https://stackoverflow.com/questions/41288067/haskell-pattern-matching-form-xyzs/41292161#41292161", "title": "Haskell - Pattern Matching form (x:y:zs)", "body": "<p>Based on the particularly helpful answer from Chad Gilbert, and some additional tinkering,\nI have found a way to have my cake and eat it to.\nIn case anyone has a similar stumbling block, here is a way to specify uncovered cases prior to declaring your guards:</p>\n\n<pre><code>myFun :: [Char] -&gt; Char\nmyFun \"\" = \"\"\nmyFun str@(s:rst)\n      | rst == \"\" = s\n      | otherwise = myFun (s:rst)\n</code></pre>\n\n<p>This also works with multiple args :</p>\n\n<pre><code>strSplit :: [Char] -&gt; [[Char]] -&gt; [[Char]]\nstrSplit str [] = strSplit str [\"\"]\nstrSplit \"\" _ = [\"\"]\nstrSplit str@(s1:ns) list@(x:xs)\n       | s1 == '|' = strSplit ns (\"\":list)\n       | ns == \"\" = map reverse $ ((s1 : x) : xs)\n       | otherwise  = strSplit ns ((s1 : x) : xs)\n</code></pre>\n\n<p>Or with stuff using the original <code>pattern@(first:second:rest)</code> idea:</p>\n\n<pre><code>    lastTwo :: [Char]-&gt;[Char]\n    lastTwo \"\" = \"\"\n    lastTwo [x] = [x]\n    lastTwo str@(f:s:rst)\n            | rst ==\"\" = [f,s]\n            | otherwise = lastTwo (s:rst)\n</code></pre>\n\n<p>This is probably super obvious to folks more familiar with Haskell, but I didn't realize that you were \"allowed\" to just declare the function multiple times using different syntax to cover different cases.</p>\n"}], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 1, "accepted_answer_id": 41288120, "answer_count": 2, "score": 1, "last_activity_date": 1482452090, "creation_date": 1482425390, "question_id": 41288067, "link": "https://stackoverflow.com/questions/41288067/haskell-pattern-matching-form-xyzs", "title": "Haskell - Pattern Matching form (x:y:zs)", "body": "<p>I am having difficulty understanding how to use pattern matching in guards.</p>\n\n<p>I have this sample function, whose purpose is to return the last character in a string.</p>\n\n<pre><code>myFun :: [Char] -&gt; Char\nmyFun str@(f:s:rst)\n      | str == \"\"  = error \"0 length string\"\n      | length str == 1 = head str\n      | rst == \"\" = s\n      | otherwise = lame (s:rst)\n</code></pre>\n\n<p>It is failing with \"Non-exhaustive patterns in function\" when passed a string with a single character.</p>\n\n<p>I assume that Haskell realizes it can't use the form <code>(f:s:rst)</code> to match a single element list, and then fails prior to trying to evaluate the call to <code>length</code>.</p>\n\n<p>How do I make a guard that will tell Haskell what to do when there is only a single element?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "answers": [{"comments": [{"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1482421285, "post_id": 41286689, "comment_id": 69775527, "body": "Oh wow, I mentally filtered out the parentheses.  Why does it return a tuple of one item though?  It can only Either be Left or Right and never both?  Seems very unintuitive."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 1, "creation_date": 1482421425, "post_id": 41286689, "comment_id": 69775614, "body": "There are two items in the tuple. The second one is a <code>ByteString</code> but I ignored it using the underscore in my answer."}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1482421590, "post_id": 41286689, "comment_id": 69775738, "body": "Oh I get it now!  Right contains the tuple, with the decoded Word32 and the rest of the ByteString that I don&#39;t care about.  Thank you!"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1482420922, "creation_date": 1482420922, "answer_id": 41286689, "question_id": 41286620, "link": "https://stackoverflow.com/questions/41286620/haskell-getting-value-of-either-from-get-monad/41286689#41286689", "title": "Haskell getting value of Either from Get monad", "body": "<p>The type of <code>a</code> is a tuple where the first item is an <code>Either</code>. Try changing your case statement to this:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>case a of\n    (Left val, _) -&gt; SIO.putStrLn \"Communist!\"\n    (Right val, _) -&gt; SIO.putStrLn $ \"Fascist!\"\n</code></pre>\n"}], "owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 41286689, "answer_count": 1, "score": 1, "last_activity_date": 1482420922, "creation_date": 1482420675, "question_id": 41286620, "link": "https://stackoverflow.com/questions/41286620/haskell-getting-value-of-either-from-get-monad", "title": "Haskell getting value of Either from Get monad", "body": "<p>I am a Haskell noob feeling stuck on a rather simple function I am attempting to perform.  Ultimately my goal is to read a strict <code>ByteString</code>, use the <code>Get</code> monad with a decoder to retrieve the first <code>Word32</code> from the <code>ByteString</code>, and perform specific functions where <code>Data.Bits.testBit</code> evaluates to True on various parts of the <code>Word32</code>.</p>\n\n<p>Here is my example code:</p>\n\n<pre><code>import Data.List\nimport Data.Char\nimport Data.Function\nimport System.Random\nimport Data.Bits\nimport Data.Either\nimport Data.Binary.Strict.Get\nimport System.IO as SIO\nimport Data.ByteString.Char8 as B\nimport Data.Word (Word32)\nimport Data.ByteString.UTF8 as BU\n\ndateTemplate = \"YYMMDDhhmmss\"\n\nconvertFromString :: String -&gt; ByteString\nconvertFromString s = BU.fromString s\n\nmahDecoder :: Get Word32\nmahDecoder = do\n  first32Bits &lt;- getWord32be\n  return first32Bits\n\nmain :: IO ()\nmain = do \n  let a = runGet mahDecoder (convertFromString dateTemplate)\n  SIO.putStrLn $ show a\n\n  -- When I uncomment these lines I get the problem\n\n  --case a of\n  --  Left val -&gt; SIO.putStrLn \"Communist!\"\n  --  Right val -&gt; SIO.putStrLn $ \"Fascist!\"\n</code></pre>\n\n<p>When I run the <code>runGet</code> function on the decoder and pass my <code>ByteString</code> in main, I can see it returns an Either instance like so:</p>\n\n<p><code>(Right 1499024717,\"DDhhmmss\")</code></p>\n\n<p>When I attempt to case on Left or Right then it fails with the following error:</p>\n\n<pre><code>HSStackOverflowExamp.hs:31:5:\n    Couldn't match expected type `(Either String Word32, ByteString)'\n                with actual type `Either t0 t1'\n    In the pattern: Left val\n    In a case alternative: Left val -&gt; SIO.putStrLn \"Communist!\"\n    In a stmt of a 'do' block:\n      case a of {\n        Left val -&gt; SIO.putStrLn \"Communist!\"\n        Right val -&gt; SIO.putStrLn $ \"Fascist!\" }\n</code></pre>\n\n<p>Any ideas what I am doing wrong here?  I get the feeling like I am supposed to read all bytes from the ByteString with the decoder.  To be honest I am not entirely sure what the type of <code>a</code> is here.  I still have a very limited understanding of Monads and Monad Transformers.  I was hoping that I didn't need to master every one of the Haskell dark arts before I could implement even simple use cases for practice.  If the answer is to keep reading then I accept that.</p>\n"}, {"tags": ["haskell", "error-handling", "monads", "comonad"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482432703, "post_id": 41282795, "comment_id": 69782203, "body": "From a constructive POV getting <code>(NonEmpty a, e)</code> from <code>Cofree (Either e) a</code> doesn&#39;t make much sense to me, since <code>Cofree</code> is a coinductive type and it&#39;s perfectly OK for a <code>Cofree (Either e) a</code> to be an infinite stream interleaved by <code>Right</code>s, but you promise to always return an <code>e</code>. No surprise <code>vals&#39;n&#39;err</code> feels hackish."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482434158, "post_id": 41282795, "comment_id": 69782907, "body": "@user3237465: yeah. So what signature would you propose?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482482217, "post_id": 41282795, "comment_id": 69798132, "body": "I don&#39;t see a problem to solve here. Consuming a <code>Cofree (Either e) a</code> in a streaming fashion and stopping on <code>Left</code> is a common and sensible way to go, why risk to get an uncatchable leaking bottom of type <code>e</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482492872, "post_id": 41282795, "comment_id": 69803605, "body": "@user3237465: because this is not polymorphic on the error monad, and the manual recursion is totally awkward when working from a REPL / IHaskell."}], "answers": [{"comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1482421051, "post_id": 41286336, "comment_id": 69775365, "body": "Yes, I did. Thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482432643, "post_id": 41286336, "comment_id": 69782175, "body": "<code>vals</code> should surely use <code>foldMap1</code>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482435011, "post_id": 41286336, "comment_id": 69783311, "body": "@dfeuer Maybe, but  instance <code>Foldable1 (Cofree f)</code> has constraint <code>Foldable1 f</code>. This will narrow the set of possible types. On the other hand I do not understand such the constraint, why not <code>instance Foldable f =&gt; Foldable1 (Cofree f)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482473006, "post_id": 41286336, "comment_id": 69794547, "body": "that is indeed surprising."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 4, "last_activity_date": 1482421952, "last_edit_date": 1482421952, "creation_date": 1482419841, "answer_id": 41286336, "question_id": 41282795, "link": "https://stackoverflow.com/questions/41282795/is-there-a-generic-way-to-decompose-the-free-comonad-over-a-failure-monad-into-a/41286336#41286336", "title": "Is there a generic way to decompose the free comonad over a failure monad into a \u201cvalues stream and final error\u201d?", "body": "<p>I think it is bad transformation for large streams, because you can have space leak by laziness. But for small streams it maybe usable.</p>\n\n<p>We can divide this transformation on two:</p>\n\n<pre><code>vals :: Foldable f =&gt; Cofree f a -&gt; NonEmpty a\nvals = NonEmpty.fromList . Foldable.toList\n\nerr :: Monad m =&gt; Cofree m a -&gt; m b\nerr (_ :&lt; m) = m &gt;&gt;= err\n</code></pre>\n\n<p>And then combine together:</p>\n\n<pre><code>vals'n'err :: (Monad m, Foldable m) =&gt; Cofree m a -&gt; (NonEmpty a, m b)\nvals'n'err w = (vals w, err w)\n</code></pre>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1482421952, "creation_date": 1482408200, "last_edit_date": 1482408939, "question_id": 41282795, "link": "https://stackoverflow.com/questions/41282795/is-there-a-generic-way-to-decompose-the-free-comonad-over-a-failure-monad-into-a", "title": "Is there a generic way to decompose the free comonad over a failure monad into a \u201cvalues stream and final error\u201d?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/Control-Comonad-Cofree.html\" rel=\"noreferrer\"><code>Cofree</code></a> comonad is useful for iterating partial functions in a way that's polymorphic on the error type. Its <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/Control-Comonad-Cofree.html#v:coiter\" rel=\"noreferrer\"><code>coiter</code></a> resembles <code>forM</code>-looping in an error monad, but it gathers the produced values in a pure/lazy manner and you only see an error at the end, down in the data struct.</p>\n\n<p>For example, <code>Cofree Identity</code> (no failure permitted!) is an infinite stream, whereas <code>Cofree Maybe</code> is isomorphic to <a href=\"http://hackage.haskell.org/package/semigroups-0.18.1/docs/Data-List-NonEmpty.html\" rel=\"noreferrer\"><code>NonEmpty</code></a>, and <code>Cofree (Either e) a</code> is basically <code>(NonEmpty a, e)</code> (list of successfull-iteration values plus an error that occurs at the end).</p>\n\n<p>Now I wonder what's the best way to evaluate the results, without specific pattern-matching on a single error monad. Extracting all the <em>values</em> is very easy thanks to the <code>Foldable</code> instance (e.g. <code>toList</code>), but I'm not sure how to best get hold of the <em>errors</em>. It would be possible to exploit <code>Foldable</code> for that to just get <em>rid</em> of the values and leave the error part:</p>\n\n<pre><code>vals'n'err :: (Monad m, Foldable m)\n          =&gt; Cofree m a -&gt; (NonEmpty a, (m ()))\nvals'n'err (a :&lt; q) = case toList q of\n        [] -&gt; (a:|[], const () &lt;$&gt; q)\n        l  -&gt; first (pure a&lt;&gt;)\n           $ foldr1 (\\(bs,e) (cs,f) -&gt; (bs&lt;&gt;cs, e&gt;&gt;f)) $ vals'n'err&lt;$&gt;l\n</code></pre>\n\n<p>but this feels a bit hackish. Is there a better solution?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482385620, "post_id": 41276454, "comment_id": 69754502, "body": "What are you trying to do?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482388072, "post_id": 41276454, "comment_id": 69755421, "body": "<code>runST</code> required that it&#39;s argument is polymorphic in all possible <code>s</code>. <code>runST :: (forall s. ST s a) -&gt; a</code>. You aren&#39;t allowed to choose anything about <code>s</code>. If it meant anything, how could the constraint <code>M t ~ ST s</code> ever be satisfied?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482388186, "post_id": 41276454, "comment_id": 69755462, "body": "This question needs the compiler error message and probably needs an example of an <code>instance</code> of <code>C</code>"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482388307, "post_id": 41276454, "comment_id": 69755512, "body": "I&#39;ve fixed my attempt at the type signature for <code>t</code>, but my point is that it&#39;s wrong (and still wrong). One instance of <code>C</code> shouldn&#39;t affect things because the <code>g</code> is intended to work on all instances of <code>C</code> but I&#39;ll try to write a dummy one if you like."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482388984, "post_id": 41276454, "comment_id": 69755802, "body": "Got an example of what <code>t</code> is for <code>ST</code>? I&#39;ll bet <code>M t :: Identity</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482389049, "post_id": 41276454, "comment_id": 69755837, "body": "The link for &quot;disjoin <code>Int</code> sets&quot; goes to <code>MonadRef</code>; I presume it&#39;s supposed to go somewhere else."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1482389084, "post_id": 41276454, "comment_id": 69755858, "body": "@Cirdec check the instance I&#39;ve added to the question. I just need a signature for <code>g</code>."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482394946, "post_id": 41278430, "comment_id": 69758766, "body": "Cheers Daniel. After mucking around with this for a while I figured I needed to box it in a GADT somehow. Can you comment roughly as a general guideline of when you need to wrap a rank-n type in a GADT?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1482395442, "post_id": 41278430, "comment_id": 69759046, "body": "@Clinton When in doubt. =)"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482411358, "post_id": 41278430, "comment_id": 69768896, "body": "Btw, I&#39;ve had a closer look at your code now, and it sure is bizarre. That <code>Equal</code> data type I can&#39;t imagine how you came up with that."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1482435485, "post_id": 41278430, "comment_id": 69783555, "body": "@Clinton Oh, that&#39;s easy: I cheated! Somebody else came up with it ages ago, and I copied. In an earlier version, I had written <code>Box :: (C t, M t ~ ST s) =&gt; ...</code> and I noticed that it was having trouble choosing that type equality to do conversions with, so I added a term-level representation that I could refer to to give it some help."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482457353, "post_id": 41278430, "comment_id": 69790958, "body": "@Clinton <code>Equal</code> is found in <code>Data.Type.Equality</code> under the name <code>(:~:)</code> with recent versions of GHC. Anyways, such a type is an anti-pattern regardless of if you write it with <code>:~:</code> or with primitive equality constraints (which @Daniel Wagner has already pointed out causes difficulties - this is the first hint that this is the wrong direction). Based on &quot;depending on whether the user knows their size at creation time or whether they need to dynamically grow&quot; - you just want an indexed type, not a type which existentially quantifies a typeclass contraint."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482461251, "post_id": 41278430, "comment_id": 69791742, "body": "As in, I should be using &quot;data families&quot;?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482463238, "post_id": 41278430, "comment_id": 69792111, "body": "Or just a GADT would do here wouldn&#39;t it now I think about it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1482393965, "creation_date": 1482393965, "answer_id": 41278430, "question_id": 41276454, "link": "https://stackoverflow.com/questions/41276454/type-signature-for-function-with-runst-and-type-classes/41278430#41278430", "title": "Type signature for function with `runST` and type classes", "body": "<p>The following file compiles for me:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE PolyKinds #-}\n\nimport Control.Monad.ST (ST, runST)\n\ndata D = D\n\nclass C t where\n  type M t :: * -&gt; *\n  f :: t -&gt; M t D\n\ndata T (m :: (* -&gt; *)) = T\n\ninstance (Monad m) =&gt; C (T m) where\n  type M (T m) = m\n  f _ = return D\n\ndata Equal a b where Refl :: Equal a a\n\nconvert :: Equal f g -&gt; f a -&gt; g a\nconvert Refl v = v\n\ndata Box s where\n    Box :: C t =&gt; Equal (M t) (ST s) -&gt; t -&gt; Box s\n\ng :: (forall s. Box s) -&gt; D\ng box = runST (case box of Box eq x -&gt; convert eq (f x))\n\nmain = const (return ()) (g (Box Refl T))\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482393965, "creation_date": 1482385263, "last_edit_date": 1495540423, "question_id": 41276454, "link": "https://stackoverflow.com/questions/41276454/type-signature-for-function-with-runst-and-type-classes", "title": "Type signature for function with `runST` and type classes", "body": "<p>I'm wondering what the appropriate type signature is for <code>g</code>. The one I've got currently doesn't compile. I presume a <code>forall.</code> is needed somewhere but I'm not exactly sure where.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Control.Monad.ST (ST, runST)\n\ndata D\n\nclass C t where\n  type M t :: * -&gt; *\n  f :: t -&gt; M t D\n\ng :: (C t, M t ~ ST s) =&gt; t -&gt; D\ng x = runST (f x)\n\nmain = return ()\n</code></pre>\n\n<p><em>(Added example in response to comment by <a href=\"https://stackoverflow.com/users/414413/cirdec\">@cirdec</a>)</em></p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Control.Monad.ST (ST, runST)\n\ndata D = D\n\nclass C t where\n  type M t :: * -&gt; *\n  f :: t -&gt; M t D\n\ndata T (m :: (* -&gt; *)) = T\n\ninstance (Monad m) =&gt; C (T m) where\n  type M (T m) = m\n  f _ = return D\n\nmain = const (return ()) (runST (f T))\n</code></pre>\n\n<p>I then replace <code>main</code> with the following:</p>\n\n<pre><code>g x = runST (f x)\nmain = const (return ()) (g T)\n</code></pre>\n\n<p>By the looks of it, this should compile, as <code>g T == runST (f T)</code> by definition of <code>g</code>. But it does not. I assume <code>g</code> needs a signature but I'm not sure what it is.</p>\n\n<p><em>(Added background in response to comment by <a href=\"https://stackoverflow.com/users/414413/cirdec\">@cirdec</a>)</em></p>\n\n<p>Basically in my code <code>C</code> is a class of datatypes that can be treated as monadic <a href=\"https://hackage.haskell.org/package/ref-tf\" rel=\"nofollow noreferrer\">disjoint <code>Int</code> sets</a> (I know there are packages on hackage already but my approach has a few more features). <code>C</code> has functions like <code>union</code> and <code>find</code> etc. The actual implementation of these differ depending on whether the user knows their size at creation time or whether they need to dynamically grow, hence the type class. However once these data types are created they can be roughly treated the same. All this occurs in monad code, generally <code>ST</code> or <code>IO</code>, but technically anything that's in the <a href=\"https://hackage.haskell.org/package/ref-tf-0.4.0.1/docs/Control-Monad-Ref.html#t:MonadRef\" rel=\"nofollow noreferrer\">MonadRef</a> will suffice. Then <code>C</code> has a function <code>freeze</code> of result type <code>M t D</code>, where <code>D</code> is some result datatype. For example, for IO freeze will have the type <code>(C t) =&gt; t -&gt; IO D</code> but for <code>ST</code> <code>freeze</code> will look more like <code>(C t) =&gt; t -&gt; ST s D</code>. In the latter case, one should be able to run <code>runST</code> on the result of <code>freeze</code> to get the raw result data. </p>\n"}, {"tags": ["haskell", "aeson", "servant"], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 0, "creation_date": 1482445620, "post_id": 41291684, "comment_id": 69787891, "body": "Aha. Clear. I will try first to make new capturing line with <code>utctime</code> instead of <code>zonedtime</code> and will see if Servant will manage with dispatching between two lines."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1482440970, "creation_date": 1482440970, "answer_id": 41291684, "question_id": 41275758, "link": "https://stackoverflow.com/questions/41275758/zonedtime-fromjson-tojson/41291684#41291684", "title": "ZonedTime fromJSON toJSON", "body": "<p><a href=\"https://en.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601</a> is the standard textual representation for times used in JSON.  When the timezone is UTC, either \"+00:00\" or \"Z\" is a valid timezone suffix.  It looks like Aeson outputs times in ISO 8601 using the \"Z\" suffix if it's UTC and a \"+xx:xx\" suffix otherwise.  Unfortunately, Servant (actually, <code>Web.HttpApiData</code>) uses a naive method of parsing <code>ZonedTime</code> from URL pieces that doesn't permit the \"Z\" suffix.  If you parse a <code>UTCTime</code> instead, then it uses (and requires) the \"Z\" suffix.</p>\n\n<p>You can define a newtype alias for <code>ZonedTime</code> as follows that handles both formats by trying to parse as a <code>ZonedTime</code> and -- failing that -- a <code>UTCTime</code> with conversion:</p>\n\n<pre><code>module ZonedTimeTest where\n\nimport Data.Time.LocalTime\nimport Servant.API\n\nnewtype ZonedTime' = ZonedTime' { getZonedTime :: ZonedTime }\n\ninstance FromHttpApiData ZonedTime' where\n  parseUrlPiece u =     ZonedTime' &lt;$&gt; parseUrlPiece u            -- \"...+xx:xx\"\n                    &lt;!&gt; ZonedTime' . fromUTC &lt;$&gt; parseUrlPiece u  -- \"...Z\"\n    where fromUTC = utcToZonedTime utc\n          infixl 3 &lt;!&gt;\n          Left _ &lt;!&gt; y = y\n          x      &lt;!&gt; _ = x\n</code></pre>\n\n<p>and then <code>Capture \"zt\" ZonedTime'</code> should handle both formats for you (though you'll need to unwrap the <code>ZonedTime'</code> to a <code>ZonedTime</code> where appropriate).</p>\n"}, {"tags": [], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "is_accepted": false, "score": 0, "last_activity_date": 1482722447, "last_edit_date": 1482722447, "creation_date": 1482452558, "answer_id": 41293573, "question_id": 41275758, "link": "https://stackoverflow.com/questions/41275758/zonedtime-fromjson-tojson/41293573#41293573", "title": "ZonedTime fromJSON toJSON", "body": "<p>Ok.</p>\n\n<p>So, as soon as <code>...Z</code> notation is properly parsed by Servant as <code>UTCTime</code>, I just made another capturing line:</p>\n\n<pre><code>:&lt;|&gt; \"myendpoint\" :&gt; Capture \"zt\" ZonedTime :&gt; ...\n:&lt;|&gt; \"myendpoint\" :&gt; Capture \"utct\" UTCTime :&gt; ...\n</code></pre>\n\n<p>And made corresponding handlers. With this literals with <code>+xx:xx</code> get taken as <code>ZonedTime</code> and go to one handler, and literals with <code>Z</code>  are taken by second line and go to second handler, that does the same as the first one, but converts <code>UTC</code> to <code>Zoned</code> on the fly.</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>I came to understand, that the way, how my system is working leads to the fact, that in the URL I may be having different variations of string encoding time.</p>\n\n<ol>\n<li>As a timezone may be <code>+03:00</code> or just <code>Z</code> if it is for UTC.</li>\n<li>I may have fractional seconds like <code>2016-12-09T15:04:26.349857693845+05:00</code></li>\n</ol>\n\n<p>Standard <code>Capture</code> for <code>ZonedTime</code> doesn't understand neither <code>Z</code> as timezone, nor fractional seconds.</p>\n\n<p>So I did somehow in the direction, as proposed in another Answer here.</p>\n\n<p>I put only one Capturing line</p>\n\n<pre><code>\"daymonth\" :&gt; Capture \"zt\" ZonedTime' :&gt; Capture \"fl\" Double :&gt; Get '[JSON] Value\n</code></pre>\n\n<p>and I make new type <code>ZonedTime'</code>, that is doing everything for me.</p>\n\n<pre><code>newtype ZonedTime' = ZonedTime' { unwrap :: ZonedTime }\n\ninstance FromHttpApiData ZonedTime' where\n  parseUrlPiece text = Right zt\n    where\n      strRaw = unpack text\n      str = subRegex (mkRegex \"Z$\") strRaw \"+00:00\"\n      zt = ZonedTime' (parseTimeOrError False defaultTimeLocale \"%Y-%m-%dT%H:%M:%S%Q%z\" str)\n</code></pre>\n\n<ol>\n<li>I deal with <code>Z</code> problem, substituting it with <code>+00:00</code></li>\n<li>Then I write parsing of the string manually, giving the format string, where <code>%Q</code> catches fractional part of seconds.</li>\n</ol>\n"}], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1482722447, "creation_date": 1482380561, "question_id": 41275758, "link": "https://stackoverflow.com/questions/41275758/zonedtime-fromjson-tojson", "title": "ZonedTime fromJSON toJSON", "body": "<p>I am befuzzled by <code>Aeson</code> and <code>Servant</code> conversions of <code>ZonedTime</code>.</p>\n\n<p>To my <code>Servant</code> app I give some time in the url: <code>.../2016-12-18T07:51:00+03:00/...</code>.</p>\n\n<p><code>Servant</code> easily converts it to <code>ZonedTime</code> with <code>... :&gt; Capture \"zt\" ZonedTime :&gt; ...</code>.</p>\n\n<p>Then my app does some calculations and in json-response I want to give back to the client this and some other <code>ZonedTime</code>s \u2014 in case if client wants to give these times to my app again.</p>\n\n<p>If input timezone was not zero <code>+0X:00</code> (X /= 0), then on the output I also get <code>+0X:00</code>, but if on input I give <code>.../2016-12-18T07:51:00+00:00/...</code>,  then in response I get <code>2016-12-18T07:51:00Z</code>. And if I try to feed this string to <code>Servant</code> again with <code>.../2016-12-18T07:51:00Z/...</code>, then <code>Servant</code> fails to convert it to <code>ZonedTime</code>. Actually is returns <code>HTTP 400 (Bad Request)</code>.</p>\n\n<p>Why? What for?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1482366169, "post_id": 41273870, "comment_id": 69749503, "body": "Cabal supports such <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#configurations\" rel=\"nofollow noreferrer\">flags</a> - but you do have to apply the flag with <code>cabal configure -f &lt;flag-name&gt;</code>."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482367265, "post_id": 41273870, "comment_id": 69749774, "body": "Exactly what I was looking for. Can you post this as an answer so I can accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1482370972, "creation_date": 1482370972, "answer_id": 41274611, "question_id": 41273870, "link": "https://stackoverflow.com/questions/41273870/cabal-custom-build-flag/41274611#41274611", "title": "cabal custom build flag", "body": "<p>Cabal supports such <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#configurations\" rel=\"nofollow noreferrer\">flags</a> - but you do have to apply the flag with cabal <code>configure -f &lt;flag-name&gt;</code>. </p>\n"}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 41274611, "answer_count": 1, "score": 1, "last_activity_date": 1482370972, "creation_date": 1482364919, "question_id": 41273870, "link": "https://stackoverflow.com/questions/41273870/cabal-custom-build-flag", "title": "cabal custom build flag", "body": "<p>Is there a way to pass a custom flag to <code>cabal</code>.\nE.g. within my <code>.cabal</code> file I want to write:</p>\n\n<pre><code>if !external\n    cpp-options:      -DINCLUDE_EMBARGOED_IP\n</code></pre>\n\n<p>And then from the command line something like:</p>\n\n<pre><code>% cabal build -fexternal\n</code></pre>\n\n<p>(It's fine if I have to apply the flag at <code>configure</code>.)</p>\n"}]