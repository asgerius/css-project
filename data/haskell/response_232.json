[{"tags": ["haskell", "functional-programming", "key-value"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1560971132, "post_id": 56674254, "comment_id": 99915966, "body": "<code>k&#39;</code> is the key to lookup."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1560971281, "post_id": 56674254, "comment_id": 99916031, "body": "<code>k&#39;</code> is the <code>a</code> in the <code>a -&gt; Maybe b</code> type which you&#39;ve called <code>KVS</code>. It&#39;s a key whose value you are looking up in <code>insert k v vs</code>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1561005325, "post_id": 56674254, "comment_id": 99924292, "body": "Since from your profile you seem to be familiar with JavaScript, perhaps a transliteration would also help: <code>var empty = (k) =&gt; undefined; var insert = (k, v, kvs) =&gt; (k_) =&gt; k_ == k ? v : kvs(k_)</code>. These produce functions that represent a map by returning a value in response to being called with a key, or returning <code>undefined</code> if no value has been inserted for that key. An example of usage in JS\u2014<code>var m = insert(&quot;y&quot;, 2, insert(&quot;x&quot;, 1, empty));</code>, <code>m(&quot;x&quot;) === 1</code>, <code>m(&quot;z&quot;) === undefined</code>\u2014is analogous to the Haskell\u2014<code>m = insert &quot;y&quot; 2 (insert &quot;x&quot; 1 empty)</code>, <code>m &quot;x&quot; == Just 1</code>, <code>m &quot;z&quot; == Nothing</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1561050435, "post_id": 56674254, "comment_id": 99947107, "body": "&quot;I am trying to understand type synonyms and how they can be practically used.&quot; I&#39;m not sure how this relates to the rest of the question, because you don&#39;t give any type signatures involving type synonyms. I generally recommend that beginners <i>avoid</i> using type synonyms, and that others use them sparingly. They don&#39;t actually have much to offer in most cases, beginners tend to think they do more than they can, and they add potentially confusing mental indirection to the code. Until you learn about higher-rank types, type families, or the <code>Constraint</code> kind, I suggest you just not bother."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1560973444, "post_id": 56674377, "comment_id": 99916966, "body": "It might be worth mentioning that adding <code>&#39;</code> at the end of a variable name is allowed in Haskell, as it mimics <a href=\"https://en.wikipedia.org/wiki/Prime_(symbol)\" rel=\"nofollow noreferrer\">the \u2018prime\u2019 symbol</a> often used in mathematics. This could cause confusion as in most languages the quotation mark is reserved only for strings and characters."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1560974201, "last_edit_date": 1560974201, "creation_date": 1560971375, "answer_id": 56674377, "question_id": 56674254, "link": "https://stackoverflow.com/questions/56674254/understanding-key-value-constructors-in-haskell/56674377#56674377", "title": "Understanding key-value constructors in Haskell", "body": "<blockquote>\n  <ol>\n  <li>What is the <code>k'</code> in the lambda? What does it represent?</li>\n  </ol>\n</blockquote>\n\n<p>Here your map is just a function that maps a key <code>k</code> to a <code>Maybe v</code> (value). So <code>k'</code> is the parameter in case we perform a lookup.</p>\n\n<p>Note that, as <a href=\"https://stackoverflow.com/questions/56674254/understanding-key-value-constructors-in-haskell/56674377#comment99916966_56674377\">@AJFarmar says</a>, the single quote (<code>'</code>) can be used as part of an identifier as well, unlike some (most) languages that use this only as part of a character literal. As the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\" rel=\"noreferrer\">Haskell'10 report says on <em>Lexical structure</em></a>:</p>\n\n<blockquote>\n  <p>An identifier consists of a letter followed by zero or more letters, digits, underscores, <strong>and single quotes</strong>.</p>\n</blockquote>\n\n<p>It is frequently used since it mimics the <a href=\"https://en.wikipedia.org/wiki/Prime_(symbol)#Use_in_mathematics,_statistics,_and_science\" rel=\"noreferrer\">prime character [wiki]</a>, which is used in mathematics for:</p>\n\n<blockquote>\n  <p>In mathematics, the prime is generally used to generate more variable names for <strong>things which are similar</strong>, without resorting to subscripts \u2013 x\u2032.</p>\n</blockquote>\n\n<p>&nbsp;</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Where is it getting its value from?</li>\n  </ol>\n</blockquote>\n\n<p>The <code>insert</code> will not pass a value to <code>k'</code>. We simply construct a new function that maps the key <code>k'</code> to a <code>Just v</code> in case that key is the same as the key we added <code>k</code>, or in case that does <em>not</em> hold, we call the original map (to make a lookup in the \"old\" map).</p>\n\n<p>The <code>empty</code> map is a <code>const Nothing</code>, something that maps everything to <code>Nothing</code>, so that means that, regardless what we lookup, we will always retrieve <code>Nothing</code>, which is indeed what an empty map is supposed to do.</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>What is the condition if <code>k' == k</code> checking?</li>\n  </ol>\n</blockquote>\n\n<p>In case of a lookup, it checks if the key we lookup is the same as the key of the key-value pair <code>(k, v)</code> we just inserted. In case that holds, we thus return a <code>Just v</code>, otherwise, we make a call to the old map.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4284057"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 56674377, "answer_count": 1, "score": 3, "last_activity_date": 1560974201, "creation_date": 1560970869, "last_edit_date": 1560971376, "question_id": 56674254, "link": "https://stackoverflow.com/questions/56674254/understanding-key-value-constructors-in-haskell", "title": "Understanding key-value constructors in Haskell", "body": "<p>I am trying to understand type synonyms and how they can be practically used. </p>\n\n<p>This is the type synonym:</p>\n\n<pre><code>empty = const Nothing\ntype KVS a b = a -&gt; Maybe b\n</code></pre>\n\n<p>And I want to make a function to insert a <code>KVS</code> pair with the following code:</p>\n\n<pre><code>insert k v kvs = \\k' -&gt; if k' == k then Just v else kvs k'\n</code></pre>\n\n<p>My question about this code is:</p>\n\n<ol>\n<li>What is the <code>k'</code> in the lambda? What does it represent?</li>\n<li>Where is it getting its value from?</li>\n<li>What is the condition <code>if k' == k</code> checking?</li>\n</ol>\n\n<p>I do understand the concepts of <code>Just</code> and <code>Maybe</code>, but this particular piece of code is what I can't wrap my head around. </p>\n\n<p>An explanation with respect to functional programming would be nice.</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1560964016, "post_id": 56672750, "comment_id": 99912726, "body": "can you explain to me what <code>split a &quot;a&quot; = [&quot;&quot;,&quot;&quot;]</code> is doing here? Why do you split <code>&quot;a&quot;</code> into <code>[&quot;&quot;,&quot;&quot;]</code>?"}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560964214, "post_id": 56672750, "comment_id": 99912812, "body": "Well a is the split character, so it splits &quot;a&quot; into what&#39;s before and after a, so &quot;nothing&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560964277, "post_id": 56672750, "comment_id": 99912847, "body": "but (a) I do not understand why you consider splitting with <code>&#39;a&#39;</code> a special case, and (b) then shouldn&#39;t you use single quotes? like <code>split &#39;a&#39; &quot;a&quot; = ...</code>.?"}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560964389, "post_id": 56672750, "comment_id": 99912901, "body": "to be honest, the base case was given. now that you say it like that, it seems weird to me also.."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1560967154, "post_id": 56672750, "comment_id": 99914171, "body": "<code>a</code> in that case is the <i>name</i> bound to the split character; <code>split a [c] | a == c = [&quot;&quot;, &quot;&quot;]</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1561049756, "post_id": 56672750, "comment_id": 99946788, "body": "Please do not post screenshots of error messages. Instead, copy and paste them."}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1561059460, "post_id": 56672750, "comment_id": 99950876, "body": "why&#39;s that? @dfeuer"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1561060150, "post_id": 56672750, "comment_id": 99951162, "body": "Accessibility, primarily: not everyone can see images. They also defeat search engines, making it hard for people to find questions relevant to the problems they&#39;re facing."}], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1560965673, "post_id": 56672938, "comment_id": 99913474, "body": "what is are pf,sf1,sf in your code? I&#39;m new to haskell and I don&#39;t understand the code that well"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1560965837, "post_id": 56672938, "comment_id": 99913555, "body": "@SavannahGemp: <code>pf</code> is here the <code>takeWhile (&#47;c) txt</code> (prefix), whereas <code>sf</code> is the <code>dropWhile (&#47;c) txt</code> (suffix), <code>sf1</code> is the tail of the suffix, given that tail exists."}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1561012536, "post_id": 56672938, "comment_id": 99926472, "body": "would it maybe also work if i wrote a my_tail function that goes like my_tail [] = [], my_tail xs = tail xs ?"}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1561014262, "post_id": 56672938, "comment_id": 99927271, "body": "Also, do you have a link or sth with a good explaination of pattern matching?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1561025002, "post_id": 56672938, "comment_id": 99932747, "body": "@SavannahGemp: see <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Pattern_matching</a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1560970227, "last_edit_date": 1560970227, "creation_date": 1560964784, "answer_id": 56672938, "question_id": 56672750, "link": "https://stackoverflow.com/questions/56672750/partitioning-a-string-into-more-pieces-with-separating-char-in-haskell/56672938#56672938", "title": "Partitioning a String into more pieces with separating char in Haskell", "body": "<p>The reason why this does not compile is because Haskell, sees your last clause as:</p>\n\n<pre><code>split c st = takeWhile (/=c) st : split c tail ((dropWhile (/=c) st))\n</code></pre>\n\n<p>It thus thinks that you apply <em>three</em> parameters to <code>split</code>: <code>c</code>, <code>tail</code> and <code>((dropWhile (/=c) st))</code>. You should use brackets here, like:</p>\n\n<pre><code>split c st = takeWhile (/=c) st : split c (tail (dropWhile (/=c) st))\n</code></pre>\n\n<p>But that will not fully fix the problem. For example if we try to run your testcase, we see:</p>\n\n<pre><code>Prelude&gt; split '#' \"foo##goo\"\n[\"foo\",\"\",\"goo\"*** Exception: Prelude.tail: empty list\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:tail\" rel=\"nofollow noreferrer\"><strong><code>tail :: [a] -&gt; [a]</code></strong></a> is a \"non-total\" function. For the empty list, <code>tail</code> will error. Indeed:</p>\n\n<pre><code>Prelude&gt; tail []\n*** Exception: Prelude.tail: empty list\n</code></pre>\n\n<p>Eventually, the list will run out of characters, and then <code>tail</code> will raise an error. We might want to use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:span\" rel=\"nofollow noreferrer\"><strong><code>span :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code></strong></a> here, and use pattern matching to determine if there is still some element that needs to be processed, like:</p>\n\n<pre><code>split :: Eq a =&gt; a -&gt; [a] -&gt; [[a]]\nsplit _ [] = [[]]\nsplit c txt = pf : rst\n    where rst | (_:sf1) &lt;- sf = split c sf1\n              | otherwise = []\n          (pf,sf) = span (c /=) txt</code></pre>\n\n<p>Here <code>span (c /=) txt</code> will thus split the non-empty list <code>txt</code> in two parts <code>pf</code> (<em>prefix</em>) is the longest prefix of items that are <em>not</em> equal to <code>c</code>. <code>sf</code> (suffix) are the remaining elements.</p>\n\n<p>Regardless whether <code>sf</code> is empty or not, we emit the prefix <code>pf</code>. Then we inspect the suffix. We know that either <code>sf</code> is empty (we reached the end of the list), or that the the first element of <code>sf</code> is equal to <code>c</code>. We thus use <em>pattern guard</em> to check if this matches with the <code>(_:sf1)</code> pattern. This happens if <code>sf</code> is non-empty. In that case we bind <code>sf1</code> with the tail of <code>sf</code>, and we recurse on the tail. In case <code>sf1</code> is empty, we can stop, and thus return <code>[]</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; split '#' \"foo##goo\"\n[\"foo\",\"\",\"goo\"]\nPrelude&gt; split '#' \"#\"\n[\"\",\"\"]\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 1, "accepted_answer_id": 56672938, "answer_count": 1, "score": 4, "last_activity_date": 1561012904, "creation_date": 1560963955, "last_edit_date": 1561012904, "question_id": 56672750, "link": "https://stackoverflow.com/questions/56672750/partitioning-a-string-into-more-pieces-with-separating-char-in-haskell", "title": "Partitioning a String into more pieces with separating char in Haskell", "body": "<p>I have the following homework:</p>\n\n<blockquote>\n  <p>Define a function split :: Char -> String -> [String] that splits a string, which consists of substrings separated by a separator, into a list of strings. </p>\n</blockquote>\n\n<pre><code>Examples:\n\nsplit '#' \"foo##goo\" = [\"foo\",\"\",\"goo\"]    \nsplit '#' \"#\" = [\"\",\"\"]\n</code></pre>\n\n<p>I have written the following function:</p>\n\n<pre><code>split :: Char -&gt; String -&gt; [String]\nsplit c \"\" = [\"\"]\nsplit a \"a\" = [\"\",\"\"]\nsplit c st =  takeWhile (/=c) st : split c tail((dropWhile (/=c) st))\n</code></pre>\n\n<p>It does not compile, and I can't see why.\nTakeWhile adds all the characters which are not c to the result, then tail drops that c that was found already, and we recursively apply split to the rest of the string, gotten with dropWhile. The : should make a list of \"lists\" as strings are lists of chars in Haskell. Where is the gap in my thinking?</p>\n\n<p>Update:</p>\n\n<p>I have updated my program to the following:</p>\n\n<pre><code>my_tail :: [a]-&gt;[a]\nmy_tail [] = []\nmy_tail xs = tail xs\n\nsplit :: Char -&gt; String -&gt; [String]\nsplit c \"\" = [\"\"]\nsplit a \"a\" = [\"\",\"\"]\nsplit c st =  takeWhile (/=c) st ++ split c (my_tail(dropWhile (/=c) st))\n</code></pre>\n\n<p>I still get an error, the following:\n<a href=\"https://i.stack.imgur.com/ZwZ35.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZwZ35.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why is the expected type [String] and then [Char]?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1560950084, "post_id": 56668023, "comment_id": 99904809, "body": "Not sure, but I think it&#39;s because it&#39;s very easy to compare types for equality, but you can&#39;t compare all values for equality. What happens if you choose <code>a ~ Int -&gt; Int</code>, for example? Then suddenly you can&#39;t compare two values of type <code>a</code> any more. For more info on why this is disallowed for the value-level, you could look at <a href=\"https://stackoverflow.com/questions/1179008/pattern-matching-identical-values\" title=\"pattern matching identical values\">stackoverflow.com/questions/1179008/&hellip;</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1560950281, "post_id": 56668023, "comment_id": 99904944, "body": "This looks like a &quot;pattern matching vs unification&quot; aspect. When GHC matches against instance heads, it uses unification between the instance heads (which might contain type variables) and the constraint to be solved (which might also contain type variables). Instead, in patterns we match a value (which can NOT contain variables) against the pattern (which might contain variables), so pattern matching suffices. Also note that one happens between types, the other between values."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1560991060, "post_id": 56668023, "comment_id": 99921884, "body": "@bradm &quot;you can&#39;t compare all values for equality.&quot; Quite. So I&#39;ve put <code>Eq</code> constraints on the class, and I only try to compare when the two types are the same -- i.e. <code>instance C a a</code>."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1560991417, "post_id": 56668023, "comment_id": 99921926, "body": "@chi &quot; When GHC matches against instance heads, it uses unification between the instance heads&quot; I don&#39;t think that&#39;s the explanation. There&#39;s no <code>~</code> constraint to unify the tyvars after matching the instance head. Note I have an <code>OVERLAPPABLE</code> instance. So GHC needs to choose between those instances <i>before</i> it applies any unification."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1561032251, "post_id": 56668023, "comment_id": 99936570, "body": "@AntC I think GHC uses unification against both instance heads, and then chooses the &quot;most specific&quot; unifying head, or something similar. Even when there is no <code>~</code> you need unification anyway to resolve general constraints."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1561516017, "post_id": 56717868, "comment_id": 100085271, "body": "That&#39;s a useful answer, but I worry a bit: &quot; templates are ordered so the correct match will be the first one&quot;. You can&#39;t always do that, instances <code>C Int b</code>, <code>C a Bool</code> are in no substitution ordering. So if your Wanted is <code>C Int Bool</code>, that&#39;s rejected even if instances marked <code>INCOHERENT</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1561557244, "post_id": 56717868, "comment_id": 100104441, "body": "I&#39;m not sure what you mean here in the last bit -- that situation is precisely what incoherent instances are for, and it should work fine, selecting the unique coherent instance if only one is marked incoherent, or picking one arbitrarily if both are marked incoherent."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1561581072, "post_id": 56717868, "comment_id": 100115935, "body": "To your other point, it looks like there are some misleading obsolete comments in the compiler source, and the list is now sorted (or more accurately &quot;filtered&quot;) at instantiation time rather than being sorted in advance.  I&#39;ve updated that part of my answer."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1561580952, "last_edit_date": 1561580952, "creation_date": 1561226487, "answer_id": 56717868, "question_id": 56668023, "link": "https://stackoverflow.com/questions/56668023/repeated-tyvars-in-instance-heads-binding-or-referencing/56717868#56717868", "title": "Repeated tyvars in instance heads: binding or referencing?", "body": "<p>Instance selection mostly takes place in <code>ghc/compiler/types/InstEnv.hs</code> and it uses \"matching\", a restricted form of unification where a template with variables is unified with another type by substitution of those template variables.</p>\n\n<p>So, when GHC decides it needs an instance dictionary for <code>C Int Int</code>, it attempts to match/unify <code>C Int Int</code> with the templates <code>C a a</code> and <code>C a b</code>, in that order (i.e., by determining through application of the function <code>tcMatchTys</code> from <code>ghc/compiler/types/Unify.hs</code> if there is a substitution for the variables <code>a</code> and/or <code>b</code> that allows one of those templates to match <code>C Int Int</code>).</p>\n\n<p>It's an implementation detail in <code>tcMatchTys</code>, but it looks to me like <code>C Int Int</code> would be matched to the template <code>C a a</code> by binding <code>a</code> to <code>Int</code> based on the first <code>a</code> and then verifying that <code>a</code> is bound to <code>Int</code> based on the second <code>a</code>, so I guess the first <code>a</code> is the binding site and the second <code>a</code> is the referencing site, though it would be more accurate to say that they're both unification/matching sites.  There would be no change to semantics if you changed the order.</p>\n\n<p>Handling of overlapping instances takes place after this matching process.  The full list of matching templates is generated and then folded by <code>insert_overlapping</code>, in <code>lookupInstEnv</code>:</p>\n\n<pre><code>-- in function `lookupInstEnv`, file `InstEnv.hs`\nfinal_matches = foldr insert_overlapping [] all_matches\n</code></pre>\n\n<p>The function <code>insert_overlapping</code> filters out strictly more general instances wherever overlapping is allowed (and also processes incoherent instances).  The final list is then matched to a singleton list, and it's an error if either zero or more than one template matches.</p>\n\n<p>Note that the matching process above can involve polymorphic substitutions, so:</p>\n\n<pre><code>gack :: [t] -&gt; String\ngack xs = foo xs xs\n</code></pre>\n\n<p>uses the same matching process to determine that <code>C [t] [t]</code> matches the template <code>C a a</code> under the substitution <code>a := [t]</code>.  (It also matches <code>C a b</code> under the substitutions <code>a := [t], b := [t]</code>, but the dominant match wins.)</p>\n"}], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1561580952, "creation_date": 1560948421, "question_id": 56668023, "link": "https://stackoverflow.com/questions/56668023/repeated-tyvars-in-instance-heads-binding-or-referencing", "title": "Repeated tyvars in instance heads: binding or referencing?", "body": "<p>My mental model of instance heads is they're type-level pattern matching, with binding of tyvars like binding of variables. With <code>FlexibleInstances</code> you can repeat tyvars in instance heads. But you can't do that at term level. Consider</p>\n\n<pre><code>class (Eq a, Eq b) =&gt; C a b  where\n  foo :: a -&gt; b -&gt; String\n\ninstance C a a  where              -- repeated `a'\n  -- the args are same type so we can compare them\n  foo ...   = \"equal\"              -- see below\n  foo _x _y = \"not equal\"\n\ninstance {-# OVERLAPPABLE #-} C a b  where\n  foo _  _  = \"not comparable\"\n</code></pre>\n\n<p>For that <code>\"equal\"</code> case, I'd like to write</p>\n\n<pre><code>foo  x   x  = \"equal\"\n</code></pre>\n\n<p>But repeated variables aren't allowed in patterns: rejected <code>Conflicting definitions for 'x'</code>. And that's because each variable must get uniquely bound to the arguments to <code>foo</code> <em>then</em> we can reference them. Instead go</p>\n\n<pre><code>foo  x   y  | x == y = \"equal\"\n</code></pre>\n\n<p>So how come the repeated tyvar business works for instances? In <code>instance C a a</code>, which of the <code>a</code>s is the binding site, which the referencing site? Is the compiler under the covers doing something equivalent to binding to differently named tyvars then applying a guard?</p>\n"}, {"tags": ["haskell", "haskell-stack", "great-firewall-of-china"], "answers": [{"comments": [{"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 1, "creation_date": 1594559274, "post_id": 56714509, "comment_id": 111162064, "body": "Interesting. How is the state of things as of mid 2020?"}], "tags": [], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "is_accepted": false, "score": 3, "last_activity_date": 1561197877, "creation_date": 1561197877, "answer_id": 56714509, "question_id": 56668007, "link": "https://stackoverflow.com/questions/56668007/how-to-use-the-tsinghua-mirrors-of-hackage-and-stackage-with-haskell-stack-packa/56714509#56714509", "title": "How to use the Tsinghua mirrors of Hackage and Stackage with Haskell Stack package manager", "body": "<p>I found a solution of sorts: <a href=\"https://github.com/commercialhaskell/stack/issues/4866\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/4866</a> and <a href=\"https://github.com/commercialhaskell/stack/issues/4870\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/4870</a>. Seems Slack 2 deprecated the package format it previously used, which is the format the Tsinghua mirror uses, so Stack 2 doesn't support the mirror. The solution is to use pre-2.0 Slack or switch to Cabal.</p>\n"}, {"tags": [], "owner": {"reputation": 48, "user_id": 6347365, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OzmOY3lL7I0/AAAAAAAAAAI/AAAAAAAAAAo/v-XHBU50lLI/photo.jpg?sz=128", "display_name": "Minh T&#250; Ho&#224;ng", "link": "https://stackoverflow.com/users/6347365/minh-t%c3%ba-ho%c3%a0ng"}, "is_accepted": false, "score": 0, "last_activity_date": 1609522442, "creation_date": 1609522442, "answer_id": 65532047, "question_id": 56668007, "link": "https://stackoverflow.com/questions/56668007/how-to-use-the-tsinghua-mirrors-of-hackage-and-stackage-with-haskell-stack-packa/65532047#65532047", "title": "How to use the Tsinghua mirrors of Hackage and Stackage with Haskell Stack package manager", "body": "<p>[<em>Updated Jan 2021</em>]</p>\n<p>Tsinghua University has updated <a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/hackage/\" rel=\"nofollow noreferrer\">their guide</a> on how to adapt to Stackage &gt;= v2.1.1.</p>\n<p>To save you a few clicks:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code># ADD THESE LINES TO `~/.stack/config.yaml`\n\npackage-indices:\n  - download-prefix: http://mirrors.tuna.tsinghua.edu.cn/hackage/\n    hackage-security:\n        keyids:\n        - 0a5c7ea47cd1b15f01f5f51a33adda7e655bc0f0b0615baa8e271f4c3351e21d\n        - 1ea9ba32c526d1cc91ab5e5bd364ec5e9e8cb67179a471872f6e26f0ae773d42\n        - 280b10153a522681163658cb49f632cde3f38d768b736ddbc901d99a1a772833\n        - 2a96b1889dc221c17296fcc2bb34b908ca9734376f0f361660200935916ef201\n        - 2c6c3627bd6c982990239487f1abd02e08a02e6cf16edb105a8012d444d870c3\n        - 51f0161b906011b52c6613376b1ae937670da69322113a246a09f807c62f6921\n        - 772e9f4c7db33d251d5c6e357199c819e569d130857dc225549b40845ff0890d\n        - aa315286e6ad281ad61182235533c41e806e5a787e0b6d1e7eef3f09d137d2e9\n        - fe331502606802feac15e514d9b9ea83fee8b6ffef71335479a2e68d84adc6b0\n        key-threshold: 3 # number of keys required\n\n        # ignore expiration date, see https://github.com/commercialhaskell/stack/pull/4614\n        ignore-expiry: no\n</code></pre>\n"}], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1609522442, "creation_date": 1560948376, "last_edit_date": 1560975531, "question_id": 56668007, "link": "https://stackoverflow.com/questions/56668007/how-to-use-the-tsinghua-mirrors-of-hackage-and-stackage-with-haskell-stack-packa", "title": "How to use the Tsinghua mirrors of Hackage and Stackage with Haskell Stack package manager", "body": "<p>I'm using version 2.1.1 of the Haskell Stack package manager.</p>\n\n<p>Tsinghua University provides a mirror of Hackage that is available behind the Chinese firewall, as described on <a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/hackage/\" rel=\"nofollow noreferrer\">https://mirrors.tuna.tsinghua.edu.cn/help/hackage/</a>. </p>\n\n<p>When I follow those instructions, however, adding</p>\n\n<pre><code>package-indices:\n  - name: Tsinghua\n    download-prefix: http://mirrors.tuna.tsinghua.edu.cn/hackage/package/\n    http: http://mirrors.tuna.tsinghua.edu.cn/hackage/00-index.tar.gz\n    hackage-security:\n        keyids:\n        - 0a5c7ea47cd1b15f01f5f51a33adda7e655bc0f0b0615baa8e271f4c3351e21d\n        - 1ea9ba32c526d1cc91ab5e5bd364ec5e9e8cb67179a471872f6e26f0ae773d42\n        - 280b10153a522681163658cb49f632cde3f38d768b736ddbc901d99a1a772833\n        - 2a96b1889dc221c17296fcc2bb34b908ca9734376f0f361660200935916ef201\n        - 2c6c3627bd6c982990239487f1abd02e08a02e6cf16edb105a8012d444d870c3\n        - 51f0161b906011b52c6613376b1ae937670da69322113a246a09f807c62f6921\n        - 772e9f4c7db33d251d5c6e357199c819e569d130857dc225549b40845ff0890d\n        - aa315286e6ad281ad61182235533c41e806e5a787e0b6d1e7eef3f09d137d2e9\n        - fe331502606802feac15e514d9b9ea83fee8b6ffef71335479a2e68d84adc6b0\n        key-threshold: 3 # number of keys required\n\n        # ignore expiration date, see https://github.com/commercialhaskell/stack/pull/4614\n        ignore-expiry: yes\n</code></pre>\n\n<p>to ~/.stack/config.yml, then when I run <code>stack run</code> in my project directory, I see:</p>\n\n<blockquote>\n  <p>Cabal file info not found for\n  aeson-1.4.2.0@sha256:8166752a9669597db375343df19805069595fed9c613f98504e418849f40fe18,7007,\n  updating Selected mirror\n  <a href=\"http://mirrors.tuna.tsinghua.edu.cn/hackage/package/\" rel=\"nofollow noreferrer\">http://mirrors.tuna.tsinghua.edu.cn/hackage/package/</a> Downloading root\n  Could not deserialize /root.json: Malformed: (line 1, column 1):\n  unexpected \"&lt;\" expecting white space or JSON value</p>\n</blockquote>\n\n<p>It also has a Stackage mirror; I tried adding changing the Stackage resolver by adding <code>resolver: https://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/lts-13.25.yaml</code> to the <code>stack.yaml</code> for my project, but that fails with:</p>\n\n<blockquote>\n  <p>Exception while reading snapshot from\n  <a href=\"https://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/lts-13.25.yaml\" rel=\"nofollow noreferrer\">https://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/lts-13.25.yaml</a>:\n  Couldn't parse snapshot from\n  <a href=\"https://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/lts-13.25.yaml\" rel=\"nofollow noreferrer\">https://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/lts-13.25.yaml</a>:\n  Error in $: Snapshot must have either resolver or compiler</p>\n</blockquote>\n\n<p>My project is just a default project created with <code>stack new myProjectName</code>, and the only other config change I've made is adding</p>\n\n<pre><code>setup-info: \"http://mirrors.tuna.tsinghua.edu.cn/stackage/stack-setup.yaml\"\nurls:\n  latest-snapshot: http://mirrors.tuna.tsinghua.edu.cn/stackage/snapshots.json\n  lts-build-plans: http://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/\n  nightly-build-plans: http://mirrors.tuna.tsinghua.edu.cn/stackage/stackage-nightly/  \n</code></pre>\n\n<p>to <code>~/.stack/config.yaml</code> as suggested on <a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/stackage/\" rel=\"nofollow noreferrer\">https://mirrors.tuna.tsinghua.edu.cn/help/stackage/</a>. That allowed me to download GHC from that mirror, but doesn't seem to enable pulling packages from there.</p>\n\n<p>What is the recommended way to make Stackage/Hackage (whatever is used by <code>stack (build|run)</code>) use the Tsinghua mirror? Ideally I don't want anything to be pulled from the default AWS mirror.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560932995, "post_id": 56663207, "comment_id": 99895061, "body": "Well in your <code>bintodec</code>, it works with the first <code>Bool</code> the <i>least significant bit</i> (LSB)."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1560933082, "post_id": 56663207, "comment_id": 99895103, "body": "<code>foldr (\\x y -&gt; (if x then 1 else 0) + 2*y) 0 . reverse</code>."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1560975567, "post_id": 56663207, "comment_id": 99917842, "body": "<code>foldr</code> is recursive. Do you just mean that you&#39;re not allowed to use explicit recursion?"}, {"owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560981175, "post_id": 56663207, "comment_id": 99919822, "body": "Yes, I&#39;m aware of that, should have clarified. No explicit recursion"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560934867, "post_id": 56663369, "comment_id": 99896114, "body": "so I essentially approached this &quot;from the wrong side&quot;, given that both the comments and this answer either uses <code>reverse</code> or <code>foldl</code>? And how would I now go about changing your solution towards the required type signature of the function that I have to create?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 1, "creation_date": 1560934977, "post_id": 56663369, "comment_id": 99896186, "body": "@cluu: the type signature is more general, so <code>bin2dec</code> can support <code>[Bool] -&gt; Int</code>, <code>[Bool] -&gt; Integer</code>, etc."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 1, "creation_date": 1560935013, "post_id": 56663369, "comment_id": 99896203, "body": "@cluuu: <code>foldl</code> runs over the list conceptually left-to-right, whereas <code>foldr</code> runs conceptually right-to-left."}, {"owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560935855, "post_id": 56663369, "comment_id": 99896685, "body": "That seems clear now, just one last thing: the bool part. A quick search tells me it replaces an <code>if p then y else x</code> statement, what would be my <code>p</code> in this particular case?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560935939, "post_id": 56663369, "comment_id": 99896725, "body": "<code>bool y x p</code> is the same to <code>if p then x else y</code> indeed, so here <code>p</code> is the <i>eta-reduced</i> parameter in the lambda-expression."}, {"owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560936513, "post_id": 56663369, "comment_id": 99897034, "body": "Though this seems a little tedious, since this assignment calls for no imports, what would be a way to incorporate this?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 0, "creation_date": 1560936553, "post_id": 56663369, "comment_id": 99897051, "body": "@cluuu: you can simply define your own <code>bool</code> function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "edited": false, "score": 2, "creation_date": 1560981046, "post_id": 56663369, "comment_id": 99919783, "body": "@cluuu Your <code>fromEnum</code> is fine. No need to use <code>if</code> or <code>bool</code> if you don&#39;t wanna. Just call <code>fromIntegral</code> after to convert from <code>Int</code> to <code>Integer</code> (or whatever other <code>Num</code> type)."}, {"owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561044988, "post_id": 56663369, "comment_id": 99944343, "body": "@DanielWagner thanks for the tip! that made it a bit more clear for me."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1560945330, "last_edit_date": 1560945330, "creation_date": 1560933259, "answer_id": 56663369, "question_id": 56663207, "link": "https://stackoverflow.com/questions/56663207/binary-to-decimal-in-haskell-without-using-recursion-or-list-comprehensions/56663369#56663369", "title": "Binary to Decimal in Haskell without using recursion or list comprehensions", "body": "<blockquote>\n  <p>which seems like a good starting point, but does not seem to produce correct results for me. It seems to work for any given uneven number, where the list only consists of Trues, yet not for anything else.</p>\n</blockquote>\n\n<p>It works, in the sense that it indeed converts a binary list to an integer. But in your function the <em>first</em> element is the <em>least significant bit (LSB)</em>.</p>\n\n<p>We could for example use a <code>fold</code> here:</p>\n\n<pre><code>import Data.Bool(bool)\n\nbin2dec :: (Foldable f, Integral i) =&gt; f Bool -&gt; i\nbin2dec = <b>foldl</b> (\\a -&gt; (+) (2*a) . bool 0 1) 0</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.Bool&gt; bin2dec [False]\n0\nPrelude Data.Bool&gt; bin2dec [True]\n1\nPrelude Data.Bool&gt; bin2dec [True, False]\n2\nPrelude Data.Bool&gt; bin2dec [True, True]\n3\nPrelude Data.Bool&gt; bin2dec [True, False, False]\n4\nPrelude Data.Bool&gt; bin2dec [True, False, True]\n5\nPrelude Data.Bool&gt; bin2dec [True, True, False]\n6\nPrelude Data.Bool&gt; bin2dec [True, True, True]\n7 \n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 11668924, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fb8R_kUOE60/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rekaoMy4Sd7QZz-8FEdGAEQdnGeHg/mo/photo.jpg?sz=128", "display_name": "cluuu", "link": "https://stackoverflow.com/users/11668924/cluuu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 56663369, "answer_count": 1, "score": 4, "last_activity_date": 1560945330, "creation_date": 1560932735, "last_edit_date": 1560933172, "question_id": 56663207, "link": "https://stackoverflow.com/questions/56663207/binary-to-decimal-in-haskell-without-using-recursion-or-list-comprehensions", "title": "Binary to Decimal in Haskell without using recursion or list comprehensions", "body": "<p>I am currently working on a homework assignment that requires me to implement a function that converts binary to decimal without using list comprehensions or recursion.</p>\n\n<p>I've tried using folds, explicitly using <code>foldr</code>, to implement this, but can't quite get correct results. In a <a href=\"https://stackoverflow.com/questions/48438257/convert-binary-to-decimal-haskell\">related thread</a> I have found the following </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>bintodec :: [Bool] -&gt; Int\nbintodec = foldr (\\x y -&gt; fromEnum x + 2*y) 0\n</code></pre>\n\n<p>which seems like a good starting point, but does not seem to produce correct results for me. It seems to work for any given odd number, where the list only consists of <code>True</code>s, yet not for anything else.</p>\n\n<p>The assigned function is also supposed to have this signature:</p>\n\n<pre><code>binarytoInteger :: [Bool] -&gt; Integer\n</code></pre>\n\n<p>which I tried to achieve using the above definition by using the <code>toInteger</code> function at various points, but could never actually match the type of the function definition.</p>\n\n<p>I would gladly appreciate a hint in the right direction! </p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "shuffle", "purely-functional"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560925231, "post_id": 56660901, "comment_id": 99891257, "body": "That&#39;s an interesting collection of facts. What&#39;s your question?"}, {"owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560925654, "post_id": 56660901, "comment_id": 99891439, "body": "@DanielWagner hopefully I fixed it to make the question more clear"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1560943597, "post_id": 56662592, "comment_id": 99900920, "body": "Note that, in the OP code, the shuffling was driven by the <code>swaps :: [Int]</code> argument rather than a randomness source, making the original function pure. It should be possible to achieve something similar in Haskell."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1560946962, "post_id": 56662592, "comment_id": 99902840, "body": "@chi Fair enough, added the code. Though I don&#39;t think this version can be called Fisher-Yates shuffle..."}, {"owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "edited": false, "score": 0, "creation_date": 1560951378, "post_id": 56662592, "comment_id": 99905634, "body": "@AlexeyRomanov I&#39;m a bit of a Haskell noob so I&#39;m trying to stay away from diving into the language extensions for now. Is there any way the implement that last implementation using swaps without <code>ScopedTypeVariables</code>?"}, {"owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "edited": false, "score": 0, "creation_date": 1560951797, "post_id": 56662592, "comment_id": 99905891, "body": "never mind I was able to remove the ScopedTypeVariables without understanding what it was doing in the first place"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "edited": false, "score": 0, "creation_date": 1560959780, "post_id": 56662592, "comment_id": 99910894, "body": "@Julian The previous version (<a href=\"https://stackoverflow.com/revisions/56662592/2\">stackoverflow.com/revisions/56662592/2</a>) didn&#39;t have it, actually: <code>let newArray :: Int -&gt; [a] -&gt; ST s (STArray s Int a); newArray n xs = newListArray (1,n) xs</code> and then <code>ar &lt;- newArray n xs</code>."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 7, "last_activity_date": 1560947601, "last_edit_date": 1560947601, "creation_date": 1560930503, "answer_id": 56662592, "question_id": 56660901, "link": "https://stackoverflow.com/questions/56660901/pure-knuth-fisher-yates-shuffle-in-haskell/56662592#56662592", "title": "pure Knuth/Fisher-Yates shuffle in haskell", "body": "<p>The <code>ST</code> monad allows exactly such encapsulated mutability, and <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array-ST.html\" rel=\"noreferrer\"><code>Data.Array.ST</code></a> contains arrays which can be mutated in <code>ST</code> and then an immutable version returned outside.</p>\n\n<p><a href=\"https://wiki.haskell.org/Random_shuffle\" rel=\"noreferrer\">https://wiki.haskell.org/Random_shuffle</a> gives two implementations of Fisher-Yates shuffle using <code>ST</code>. They aren't literally <code>[a] -&gt; [a]</code>, but that's because random number generation needs to be handled as well:</p>\n\n<pre><code>import System.Random\nimport Data.Array.ST\nimport Control.Monad\nimport Control.Monad.ST\nimport Data.STRef\n\n-- | Randomly shuffle a list without the IO Monad\n--   /O(N)/\nshuffle' :: [a] -&gt; StdGen -&gt; ([a],StdGen)\nshuffle' xs gen = runST (do\n        g &lt;- newSTRef gen\n        let randomRST lohi = do\n              (a,s') &lt;- liftM (randomR lohi) (readSTRef g)\n              writeSTRef g s'\n              return a\n        ar &lt;- newArray n xs\n        xs' &lt;- forM [1..n] $ \\i -&gt; do\n                j &lt;- randomRST (i,n)\n                vi &lt;- readArray ar i\n                vj &lt;- readArray ar j\n                writeArray ar j vi\n                return vj\n        gen' &lt;- readSTRef g\n        return (xs',gen'))\n  where\n    n = length xs\n    newArray :: Int -&gt; [a] -&gt; ST s (STArray s Int a)\n    newArray n xs =  newListArray (1,n) xs\n</code></pre>\n\n<p>and</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.ST\nimport Control.Monad.Random\nimport System.Random\nimport Data.Array.ST\nimport GHC.Arr\n\nshuffle :: RandomGen g =&gt; [a] -&gt; Rand g [a]\nshuffle xs = do\n    let l = length xs\n    rands &lt;- forM [0..(l-2)] $ \\i -&gt; getRandomR (i, l-1)\n    let ar = runSTArray $ do\n        ar &lt;- thawSTArray $ listArray (0, l-1) xs\n        forM_ (zip [0..] rands) $ \\(i, j) -&gt; do\n            vi &lt;- readSTArray ar i\n            vj &lt;- readSTArray ar j\n            writeSTArray ar j vi\n            writeSTArray ar i vj\n        return ar\n    return (elems ar)\n\n*Main&gt; evalRandIO (shuffle [1..10])\n[6,5,1,7,10,4,9,2,8,3]\n</code></pre>\n\n<p>EDIT: with a fixed <code>swaps</code> argument as in your Go code, the code is quite simple</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Array.ST\nimport Data.Foldable\nimport Control.Monad.ST\n\nshuffle :: forall a. [a] -&gt; [Int] -&gt; [a]\nshuffle xs swaps = runST $ do\n    let n = length xs\n    ar &lt;- newListArray (1,n) xs :: ST s (STArray s Int a)\n    for_ [1..n] $ \\i -&gt;\n        for_ swaps $ \\j -&gt; do\n            vi &lt;- readArray ar i\n            vj &lt;- readArray ar j\n            writeArray ar j vi\n            writeArray ar i vj\n    getElems ar\n</code></pre>\n\n<p>but I am not sure you can reasonably call it Fisher-Yates shuffle.</p>\n"}], "owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 2, "accepted_answer_id": 56662592, "answer_count": 1, "score": 2, "last_activity_date": 1560947601, "creation_date": 1560923934, "last_edit_date": 1560925630, "question_id": 56660901, "link": "https://stackoverflow.com/questions/56660901/pure-knuth-fisher-yates-shuffle-in-haskell", "title": "pure Knuth/Fisher-Yates shuffle in haskell", "body": "<p>In go I could write a function like this:</p>\n\n<pre><code>func pureFisherYates(s []int, swaps []int) []int {\n    newS := copy(s)\n    for i, _ := range newS {\n            for _, j := range swaps {\n                    newS[i], newS[j] = newS[j], newS[i]\n            }\n    }\n}\n</code></pre>\n\n<p>To me this seems like a pure function. It always returns the same output given the same input, and it doesn't mutate the state of the world (except in some strict sense the same way that any other function does, taking up cpu resources, creating heat energy, etc). Yet whenever I look for how to do pure shuffling I find stuff like <a href=\"http://okmij.org/ftp/Haskell/perfect-shuffle.txt\" rel=\"nofollow noreferrer\">this</a>, and whenever I look for specifically Haskell implementation Fisher-Yates I either get an <code>0^2</code> Fisher-Yates implemented with a list or a <code>[a] -&gt; IO [a]</code> implementation. Does there exist a <code>[a] -&gt; [a]</code> <code>O(n)</code> shuffle and if not why is my above go implementation impure.</p>\n"}, {"tags": ["haskell", "windows-10", "cabal"], "comments": [{"owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "edited": false, "score": 0, "creation_date": 1560921950, "post_id": 56660159, "comment_id": 99890145, "body": "Maybe it is related with the way cabal is trying to access internet, you could try <code>cabal --http-transport=plain-http v2-update</code>. If it doesnt work, share the output of <code>cabal -v3 v2-update</code>, to have a more detailed trace."}, {"owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "edited": false, "score": 0, "creation_date": 1560922457, "post_id": 56660159, "comment_id": 99890288, "body": "Replace <code>v2-update</code> for <code>v1-update</code> if you wish, but i would recommend to use v2 commands."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 11667943, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ArfNmp7Kuk0/AAAAAAAAAAI/AAAAAAAACqY/-E1isZpK05A/photo.jpg?sz=128", "display_name": "Fidel", "link": "https://stackoverflow.com/users/11667943/fidel"}, "edited": false, "score": 0, "creation_date": 1560989204, "post_id": 56677367, "comment_id": 99921549, "body": "The solution was also discussed in GitHub, as issue #5574 on haskell/cabal. It was there that the suggestion of erasing the files was given by 23Skidoo. The initial hint that uncover the problematic files was given there and here by JNeira. Thanks again to both (and to the rest of the ones helping).  <a href=\"https://github.com/haskell/cabal/issues/5574\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/issues/5574</a>"}], "tags": [], "owner": {"reputation": 41, "user_id": 11667943, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ArfNmp7Kuk0/AAAAAAAAAAI/AAAAAAAACqY/-E1isZpK05A/photo.jpg?sz=128", "display_name": "Fidel", "link": "https://stackoverflow.com/users/11667943/fidel"}, "is_accepted": false, "score": 2, "last_activity_date": 1560988949, "creation_date": 1560988949, "answer_id": 56677367, "question_id": 56660159, "link": "https://stackoverflow.com/questions/56660159/cabal-new-install-cabal-cabal-install-answered-cabal-exe-could-not-read-inde/56677367#56677367", "title": "&quot;cabal new-install Cabal cabal-install&quot; answered &quot;cabal.exe: Could not read index. Did you call &#39;checkForUpdates&#39;?&quot; on Windows10", "body": "<p>I have tried the \"cabal -v3 v2-update\" and it showed me the file that was missing and its path. At first I tried to restore the file by hand, but someone suggested erasing all the files related to the missing one, and, voil\u00e1, cabal regenerate all of them and started to work.\nThe file missing was called 001-index.cache, and I erased all the files 001-index*.\nThe path was C:\\Users\\fidel\\AppData\\Roaming\\cabal\\packages\\hackage.haskell.org.</p>\n\n<p>Thanks everybody for the suggestions and help.</p>\n"}], "owner": {"reputation": 41, "user_id": 11667943, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ArfNmp7Kuk0/AAAAAAAAAAI/AAAAAAAACqY/-E1isZpK05A/photo.jpg?sz=128", "display_name": "Fidel", "link": "https://stackoverflow.com/users/11667943/fidel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1560988949, "creation_date": 1560919237, "question_id": 56660159, "link": "https://stackoverflow.com/questions/56660159/cabal-new-install-cabal-cabal-install-answered-cabal-exe-could-not-read-inde", "title": "&quot;cabal new-install Cabal cabal-install&quot; answered &quot;cabal.exe: Could not read index. Did you call &#39;checkForUpdates&#39;?&quot; on Windows10", "body": "<p>I've just installed Haskell Platform 8.6.5 in Windows 10 (latest download from <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/</a>), and when trying \"cabal new-update\" or \"cabal v1-update\", it answers with the following error message.</p>\n\n<p>Downloading the latest package list from hackage.haskell.org\ncabal.exe: Could not read index. Did you call 'checkForUpdates'?</p>\n\n<p>I have found no other question regarding this issue here, and although there is one on GitHub (<a href=\"https://github.com/haskell/cabal/issues/5574\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/5574</a>), no solutions so far, at least for Windows.\nCan I use cabal on Windows at all?</p>\n\n<p>I have searched and read all cabal related problems I could, both on here and on GitHub, but most are either for Linux or OS. No good answers for Windows...</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1560915559, "post_id": 56659434, "comment_id": 99888862, "body": "What are some examples of non-<code>IO</code>y things you would want to be able to pass there? What should <code>subPrompt</code> do with them?"}, {"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560915939, "post_id": 56659434, "comment_id": 99888945, "body": "Oh, no, it is always IO. I guess I am asking if there is a way I can make it a specific sort of IO."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1560916953, "post_id": 56659434, "comment_id": 99889114, "body": "Okay, I think I understand: you want to ensure that the third argument to <code>subPrompt</code> is actually a call to <code>prompt</code> (and not, say, <code>deleteDirectory &quot;&#47;&quot;</code>), right? I have written an answer about one approach, but while writing it I pondered: would you also want to allow passing the result of <code>subPrompt</code> as a third argument to <code>subPrompt</code>? (In my answer I assumed &quot;yes&quot;, but it is certainly possible to adapt to the &quot;no&quot; situation, too.)"}, {"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560917399, "post_id": 56659434, "comment_id": 99889193, "body": "You thought correctly :) I want to be able to have an arbitrary number of subPrompts"}], "answers": [{"comments": [{"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1560916092, "post_id": 56659777, "comment_id": 99888970, "body": "Ah, newtype is exactly what I need. I previously struggled with the difference between type and newtype. But this makes it crystal clear - it stops the accidental case, as you said. Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560916734, "post_id": 56659777, "comment_id": 99889079, "body": "This answer would be much better if it changed the types of <code>prompt</code> (and <code>subPrompt</code>?) to return <code>Prompt</code>s instead of <code>IO</code>s and discussed how to use module boundaries to make sure that users can&#39;t accidentally turn arbitrary <code>IO</code> actions into <code>Prompt</code>s."}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 1, "last_activity_date": 1560916133, "last_edit_date": 1560916133, "creation_date": 1560916031, "answer_id": 56659777, "question_id": 56659434, "link": "https://stackoverflow.com/questions/56659434/how-can-i-make-the-signature-of-this-function-more-precise/56659777#56659777", "title": "How can I make the signature of this function more precise", "body": "<p>Nothing wrong with making the second prompt a simple <code>IO a</code> - specially if you document what it is somewhere.</p>\n\n<p>That said, yes, it is good practice to make the types as self-explanatory as possible; you can create an alias:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Prompt a = IO a\n</code></pre>\n\n<p>and then use it in subPrompt's signature:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>subPrompt :: Text -&gt; (Text -&gt; Bool) -&gt; Prompt a -&gt; IO (Maybe (Text, a))\n</code></pre>\n\n<p>This makes the signature more self-explanatory, while still allowing you to pass any <code>IO a</code> as the third parameter (the keyword <code>type</code> just creates an alias).</p>\n\n<p>But wait, there is more: you'd rather not accidentally pass any <code>IO a</code> that isn't actually a prompt! You don't want to pass it an IO action that, say, launches the missiles...</p>\n\n<p>So, we can declare an actual Prompt type (not just an alias, but a real type):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Prompt a = Prompt { getPrompt :: IO a }\n</code></pre>\n\n<p>This allows you to wrap any value of type <code>IO a</code> inside a type, ensuring it doesn't get mixed up with other functions with the same type, but different semantics.</p>\n\n<p>The signature of subPrompt remains the same as before:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>subPrompt :: Text -&gt; (Text -&gt; Bool) -&gt; Prompt a -&gt; IO (Maybe (Text, a))\n</code></pre>\n\n<p>But now you cannot pass just any old <code>IO a</code> to it; to pass your <code>prompt</code>, for example, you have to wrap it:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>subPrompt \"Do we proceed?\" askYesNo (Prompt (prompt \"Please enter your name\" processName))\n</code></pre>\n\n<p>(subPrompt won't be able to call it directly, but will have to extract \"prompt\" from inside the wrapper:  <code>let actualPrompt = getPrompt wrappedPrompt</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 1, "creation_date": 1560917181, "post_id": 56659842, "comment_id": 99889152, "body": "This is an awesome answer. My project is already using the previous style though, which is why I accepted typedfern&#39;s answer. But I&#39;ll strongly consider refactoring to this style in the future. Thanks!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1560917562, "last_edit_date": 1560917562, "creation_date": 1560916628, "answer_id": 56659842, "question_id": 56659434, "link": "https://stackoverflow.com/questions/56659434/how-can-i-make-the-signature-of-this-function-more-precise/56659842#56659842", "title": "How can I make the signature of this function more precise", "body": "<p>One way is to reify the two things as a data structure. So:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Prompt a where\n    Prompt :: Text -&gt; (Text -&gt; Either Text a) -&gt; Prompt a\n    SubPrompt :: Text -&gt; (Text -&gt; Bool) -&gt; Prompt a -&gt; Prompt (Maybe (Text, a))\n</code></pre>\n\n<p>Now because the third argument to <code>SubPrompt</code> is a <code>Prompt</code>, you know it must either be a call to <code>SubPrompt</code> or <code>Prompt</code> -- definitely not some arbitrary <code>IO</code> action that might do filesystem access or some other nasty thing.</p>\n\n<p>Then you can write an interpreter for this tiny DSL into <code>IO</code>:</p>\n\n<pre><code>runPrompt :: Prompt a -&gt; IO a\nrunPrompt (Prompt cue validator) = {- what your old prompt used to do -}\nrunPrompt (SubPrompt cue deeper sub) = {- what your old subPrompt used to do,\n                                          calling runPrompt on sub where needed -}\n</code></pre>\n\n<p>Besides the benefit of being sure you don't have arbitrary <code>IO</code> as an argument to <code>SubPrompt</code>, this has the side benefit that it makes testing easier. Later you could implement a second interpreter that is completely pure; say, something like this, which takes a list of texts to be treated as user inputs and returns a list of texts that the prompt output:</p>\n\n<pre><code>data PromptResult a = Done a | NeedsMoreInput (Prompt a)\n\npurePrompt :: Prompt a -&gt; [Text] -&gt; ([Text], PromptResult a)\npurePrompt = {- ... -}\n</code></pre>\n"}], "owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1016, "favorite_count": 0, "accepted_answer_id": 56659777, "answer_count": 2, "score": 1, "last_activity_date": 1560917562, "creation_date": 1560912970, "question_id": 56659434, "link": "https://stackoverflow.com/questions/56659434/how-can-i-make-the-signature-of-this-function-more-precise", "title": "How can I make the signature of this function more precise", "body": "<p>I have two functions:</p>\n\n<pre><code>prompt :: Text -&gt; (Text -&gt; Either Text a) -&gt; IO a\nsubPrompt :: Text -&gt; (Text -&gt; Bool) -&gt; IO a -&gt; IO (Maybe (Text, a))\n</code></pre>\n\n<p>subPrompt takes a second prompt (argument 3) and displays it if the function in argument 2 comes back as true after running the first prompt.</p>\n\n<p>What I don't like is that argument 3 is <code>IO a</code> I would like it to be something more like:</p>\n\n<pre><code>subPrompt :: Text -&gt; (Text -&gt; Bool) -&gt; prompt -&gt; IO (Maybe (Text, a))\n</code></pre>\n\n<p>But I know I can't do that. I'm stuck trying to think of a way to make it clearer from the signature what the third argument is. Is there some way I can define a clearer type? Or maybe I'm overthinking it and <code>IO a</code> is actually fine - I'm pretty new to haskell.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1560883419, "post_id": 56655146, "comment_id": 99880405, "body": "Have you looked at the type and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#.\" rel=\"nofollow noreferrer\">implementation</a> for <code>(.)</code>? Also ask ghci for <code>:t chop8</code> vs <code>:t chop8 []</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1560884112, "post_id": 56655146, "comment_id": 99880722, "body": "<code>(.)</code> composes two <i>functions</i>, <code>chop8</code> is a function, <code>chop8 xs</code> is not."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1560884275, "post_id": 56655146, "comment_id": 99880785, "body": "The correct version of your first snippet would be <code>decode xs = (map  (chr . bin2int) . chop8) xs</code>. (Actually it&#39;s more idiomatic to avoid the parentheses by using the <code>$</code> operator, but that&#39;s incidental.) Do you see the difference?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11666327, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EnHN4wKWGGQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcxaQgeBWTTXVshk3DQhdGjpB8w3Q/mo/photo.jpg?sz=128", "display_name": "Hartson", "link": "https://stackoverflow.com/users/11666327/hartson"}, "edited": false, "score": 0, "creation_date": 1560889696, "post_id": 56655484, "comment_id": 99883081, "body": "Thanks for your help :) The composition operator can only be applied to functions, not lists!?"}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "reply_to_user": {"reputation": 21, "user_id": 11666327, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EnHN4wKWGGQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcxaQgeBWTTXVshk3DQhdGjpB8w3Q/mo/photo.jpg?sz=128", "display_name": "Hartson", "link": "https://stackoverflow.com/users/11666327/hartson"}, "edited": false, "score": 0, "creation_date": 1560891979, "post_id": 56655484, "comment_id": 99884004, "body": "Yes - the closest thing for lists would be to concatenate them (both composition and concatenation obey identity and associative laws), but that isn&#39;t relevant to this case."}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 4, "last_activity_date": 1560884533, "creation_date": 1560884533, "answer_id": 56655484, "question_id": 56655146, "link": "https://stackoverflow.com/questions/56655146/why-using-the-composition-operator-allows-you-to-avoid-the-need-to-explicitly-re/56655484#56655484", "title": "Why using the composition operator allows you to avoid the need to explicitly refer the initial argument?", "body": "<p>The second version, using what is called point-free style, does not require the \"xs\" parameter because the expression <code>map  (chr . bin2int) . chop8</code> already produces a function of type <code>[Bit] -&gt; String</code> - so all you have is to set <code>decode =</code> to the expression's value.</p>\n\n<p>With the first version, you are explicitly passing the <code>xs</code> argument, so the expression to the right side of <code>=</code> should be of type <code>Int</code>. Since you are explicitly applying chop8 to xs, the result is a concrete list, not a function.</p>\n\n<p>One solution is to explicitly apply map to the result of chop8:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>decode xs = map  (chr . bin2int) $ (chop8 xs)\n</code></pre>\n\n<p>Note the replacement of <code>.</code> with <code>$</code> - \"apply function to parameter\" instead of \"compose function with another function\"</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 11666327, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EnHN4wKWGGQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcxaQgeBWTTXVshk3DQhdGjpB8w3Q/mo/photo.jpg?sz=128", "display_name": "Hartson", "link": "https://stackoverflow.com/users/11666327/hartson"}, "edited": false, "score": 0, "creation_date": 1560889533, "post_id": 56655509, "comment_id": 99883015, "body": "Thanks for that, I understand now! All in all, ( . ) can only be applied to a function, not the result of one!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560903802, "post_id": 56655509, "comment_id": 99886762, "body": "Shouldn&#39;t <code>decode1</code> be <code>(ord . abs) x</code>, not <code>ord . (abs x)</code>?"}, {"owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560905944, "post_id": 56655509, "comment_id": 99887139, "body": "@bradrn, <code>ord . (abs x)</code> is the equivalent of <code>map  (chr . bin2int) . (chop8 xs)</code> in the original question. Neither are valid expressions."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560908207, "post_id": 56655509, "comment_id": 99887516, "body": "@IzaakWeiss That&#39;s what I&#39;m saying! Actually, I&#39;ve just realised that IzaakWeiss <i>did</i> say that <code>decode1</code> &#39;doesn&#39;t even typecheck&#39;; I missed that when I wrote my comment."}], "tags": [], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "is_accepted": true, "score": 9, "last_activity_date": 1560905972, "last_edit_date": 1560905972, "creation_date": 1560884633, "answer_id": 56655509, "question_id": 56655146, "link": "https://stackoverflow.com/questions/56655146/why-using-the-composition-operator-allows-you-to-avoid-the-need-to-explicitly-re/56655509#56655509", "title": "Why using the composition operator allows you to avoid the need to explicitly refer the initial argument?", "body": "<p>The definition of <code>(.)</code> is key here.</p>\n\n<p>To give a simpler example:</p>\n\n<pre><code>decode1, decode2 :: Int -&gt; Char\ndecode1 x = chr . (abs x)\ndecode2 = chr . abs\n</code></pre>\n\n<p>Now, the definition of <code>(.)</code> is <code>f . g = \\a -&gt; f (g a)</code>, so we can use that in both of our definitions:</p>\n\n<pre><code>decode1 x = \\a -&gt; chr (abs x a)\ndecode2 = \\x -&gt; chr (abs x)\n</code></pre>\n\n<p>We can further simplify this, by moving the lambda parameters into the pattern match:</p>\n\n<pre><code>decode1 x a = chr (abs x a)\ndecode2 x = chr (abs x)\n</code></pre>\n\n<p>Obviously <code>decode2</code> is the right funtion; <code>decode1</code> doesn't even typecheck. <code>abs</code> only takes one argument, but <code>decode1</code> calls it with 2! Furthermore, <code>decode1</code> has an extra parameter, <code>a</code>, which we don't want.</p>\n"}], "owner": {"reputation": 21, "user_id": 11666327, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EnHN4wKWGGQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcxaQgeBWTTXVshk3DQhdGjpB8w3Q/mo/photo.jpg?sz=128", "display_name": "Hartson", "link": "https://stackoverflow.com/users/11666327/hartson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 56655509, "answer_count": 2, "score": 1, "last_activity_date": 1560905972, "creation_date": 1560883080, "last_edit_date": 1560896534, "question_id": 56655146, "link": "https://stackoverflow.com/questions/56655146/why-using-the-composition-operator-allows-you-to-avoid-the-need-to-explicitly-re", "title": "Why using the composition operator allows you to avoid the need to explicitly refer the initial argument?", "body": "<p>I can't seem to get my head around why the below code will not compile:</p>\n\n<pre><code>decode :: [Bit] -&gt; String\ndecode xs = map  (chr . bin2int) . (chop8 xs)\n</code></pre>\n\n<p>But the below will:</p>\n\n<pre><code>decode :: [Bit] -&gt; String\ndecode = map  (chr . bin2int) . chop8 \n</code></pre>\n\n<p>When we give the 2nd function a list, it applies chop8 to it, then maps (chr . bin2int) to the elements in the list produced.</p>\n\n<p>So why doesn't the 1st example do the same? Are we not effectively doing the same thing, but just giving chop8 the argument in the function definition?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "zipper"], "comments": [{"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 1, "creation_date": 1560877043, "post_id": 56653064, "comment_id": 99877647, "body": "It has to be a list, since the zipper is supposed to leave a trail of breadcrumbs; it would be more useful if you provide us with a complete code example that does <i>not</i> behave as you expect, that we can run and see what is wrong."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1560877312, "post_id": 56653064, "comment_id": 99877740, "body": "@typedfern done"}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 1, "creation_date": 1560877502, "post_id": 56653064, "comment_id": 99877827, "body": "Ran both examples; both of them produce a list of breadcrumbs with two elements; can&#39;t see where the problem is..."}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 1, "creation_date": 1560877756, "post_id": 56653064, "comment_id": 99877954, "body": "To check how many elements the resulting list has, you can do this: <code>length $ snd $ (myDisk,[]) -: fsTo &quot;programs&quot; -: fsTo &quot;source code&quot;</code> - you&#39;ll see it says the list has two elements."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1560878054, "post_id": 56653064, "comment_id": 99878080, "body": "Yeah, because <code>FSZipper</code> consists of two elements, but if you print the length of the list of <code>FSCrumbs</code> the answer is in both cases 1 Here&#39;s a litte debug helper i wrote:<code>debug :: FSZipper -&gt; IO () debug (item, FSCrumb name ls rs : bs) = do     putStrLn &quot;name:&quot;     print name     putStrLn &quot;ls:&quot;     mapM_ print ls     putStrLn &quot;item:&quot;     print item     putStrLn &quot;rs:&quot;     mapM_ print rs     putStrLn &quot;bs:&quot;     mapM_ print bs     putStrLn &quot;length of bs:&quot;     print $ length bs</code>"}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1560878274, "post_id": 56653064, "comment_id": 99878163, "body": "That command I showed you <i>does</i> print the length of the list of FSCrumbs (notice the use of <code>snd</code> to get the second item, the crumbs list); what command are you using to get that 1?"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1560878381, "post_id": 56653064, "comment_id": 99878209, "body": "I already edited the command an provided it and while I write this I see how stupid I am... I extract the first element and print the length of the rest of the list...."}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 3, "creation_date": 1560878573, "post_id": 56653064, "comment_id": 99878280, "body": "Happens to all of us :) In any case, this is the reason why, when asking questions on  stackoverflow, you should always provide a <i>full</i> example (in this case, an example that actually prints &quot;1&quot;); this way, we can help you much more effectively"}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 1, "last_activity_date": 1560878883, "creation_date": 1560878883, "answer_id": 56654245, "question_id": 56653064, "link": "https://stackoverflow.com/questions/56653064/why-is-the-second-type-of-a-zipper-a-list-of-data-not-not-pure-data/56654245#56654245", "title": "Why is the second type of a Zipper a list of data not not pure data?", "body": "<p>The problem was simply the method used to obtain the number of breadcrumbs;\na simple (and correct) way is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>numberOfBreadcrumbs :: FSZipper -&gt; Int\nnumberOfBreadcrumbs (_, breadcrumbs) = length breadcrumbs\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 56654245, "answer_count": 1, "score": 0, "last_activity_date": 1560878883, "creation_date": 1560873794, "last_edit_date": 1560877298, "question_id": 56653064, "link": "https://stackoverflow.com/questions/56653064/why-is-the-second-type-of-a-zipper-a-list-of-data-not-not-pure-data", "title": "Why is the second type of a Zipper a list of data not not pure data?", "body": "<p>I made my way thru the Tutorial available at <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow noreferrer\">Learn your Haskell</a>\nand I ask myself why the Author uses a list as the second type for the implemented Zipper?</p>\n\n<p>Here is the relevant Code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Name = String\ntype Data = String\ndata FSItem = File Name Data\n    | Folder Name [FSItem]\n    deriving (Show)\n\ndata FSCrumb = FSCrumb Name [FSItem] [FSItem]\n    deriving (Show)\ntype FSZipper = (FSItem, [FSCrumb])\n\n-- -------------------------------------------------------------------------------\n-- Some other code he uses\n-- -------------------------------------------------------------------------------\n\nfsUp :: FSZipper -&gt; FSZipper\nfsUp (item, FSCrumb name ls rs : bs) = (Folder name (ls ++ [item] ++ rs), bs)\n\nfsTo :: Name -&gt; FSZipper -&gt; FSZipper\nfsTo name (Folder folderName items, bs) =\n    let (ls, item:rs) = break (nameIs name) items\n    in  (item, FSCrumb folderName ls rs:bs)\n\nnameIs :: Name -&gt; FSItem -&gt; Bool\nnameIs name (Folder folderName _) = name == folderName\nnameIs name (File   fileName   _) = name == fileName\n\nx -: f = f x\n\n-- -------------------------------------------------------------------------------\n-- Example to work on\n-- -------------------------------------------------------------------------------\n\nmyDisk :: FSItem  \nmyDisk = \n    Folder \"root\"   \n        [ File \"goat_yelling_like_man.wmv\" \"baaaaaa\"  \n        , File \"pope_time.avi\" \"god bless\"  \n        , Folder \"pics\"  \n            [ File \"ape_throwing_up.jpg\" \"bleargh\"  \n            , File \"watermelon_smash.gif\" \"smash!!\"  \n            , File \"skull_man(scary).bmp\" \"Yikes!\"  \n            ]  \n        , File \"dijon_poupon.doc\" \"best mustard\"  \n        , Folder \"programs\"  \n            [ File \"fartwizard.exe\" \"10gotofart\"  \n            , File \"owl_bandit.dmg\" \"mov eax, h00t\"  \n            , File \"not_a_virus.exe\" \"really not a virus\"  \n            , Folder \"source code\"  \n                [ File \"best_hs_prog.hs\" \"main = print (fix error)\"  \n                , File \"random.hs\" \"main = print 4\"  \n                ]  \n            ]  \n        ] \n</code></pre>\n\n<p>The commands you can use:</p>\n\n<pre><code>*Filesystem&gt; let newFocus1 = (myDisk,[]) -: fsTo \"programs\" -: fsTo \"source code\"\n*Filesystem&gt; let newFocus2 = (myDisk,[]) -: fsTo \"pics\" -: fsTo \"ape_throwing_up.jpg\"\n</code></pre>\n\n<p>No matter what I do I always end up with a list with only one Item, so wouldn't it be better to use just <code>FSCrumb</code> instead of <code>[FSCrumb]</code>?</p>\n"}, {"tags": ["haskell", "smallcheck"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1560928773, "post_id": 56653192, "comment_id": 99892951, "body": "yes, but question is different: imagine that you have multiple <code>testProperty</code>, so <code>getResource&#39;</code> will be called in each of them, but my goal is to call it <b>once</b> for all of them"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1560950289, "post_id": 56653192, "comment_id": 99904950, "body": "@Paul-AG In that case you can put the <code>withResource</code> call around the entire <code>testGroup</code> call. See my edit"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 3, "last_activity_date": 1560950228, "last_edit_date": 1560950228, "creation_date": 1560874294, "answer_id": 56653192, "question_id": 56649242, "link": "https://stackoverflow.com/questions/56649242/impure-property-test-with-smallcheck-and-tasty-resource-acquisition/56653192#56653192", "title": "Impure property test with SmallCheck and Tasty: resource acquisition", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/tasty-1.2.3/docs/Test-Tasty.html#v:withResource\" rel=\"nofollow noreferrer\"><strong><code>withResource</code></strong></a>. According to the documentation, it will convert your <code>IO Cfg</code> into an <code>IO Cfg</code> that will yield a resource which <strong>\"will be acquired only once and shared across all the tests in the tree.\"</strong></p>\n\n<p>It also gives you a <code>Cfg -&gt; IO ()</code> function where you can free the <code>Cfg</code> value if needed. I've left that function as a no-op here for now (<code>\\cfg -&gt; pure ()</code>), since I don't know the nature of your resource.</p>\n\n<pre><code>myTests :: IO Cfg -&gt; TestTree\nmyTests getResource =\n  withResource getResource (\\cfg -&gt; pure ()) $ \\getResource' -&gt;\n    testGroup \"My Group\"\n    [\n        testProperty \"MyProperty\" $ \\(x::X) -&gt; monadic $ do\n            Some{..} &lt;- getResource'\n            -- DO I/O...\n    ]\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 56653192, "answer_count": 1, "score": 1, "last_activity_date": 1560950228, "creation_date": 1560861104, "question_id": 56649242, "link": "https://stackoverflow.com/questions/56649242/impure-property-test-with-smallcheck-and-tasty-resource-acquisition", "title": "Impure property test with SmallCheck and Tasty: resource acquisition", "body": "<p>I am trying to write property based test with Tasty library and SmallCheck. But I need IO in the property check function and also I need I/O resource. So, I turned existing test into:</p>\n\n<pre><code>myTests :: IO Cfg -&gt; TestTree\nmyTests getResource = testGroup \"My Group\"\n[\n    testProperty \"MyProperty\" $\n    -- HOW TO CALL getResource here, but not in\n    -- function, so to avoid multiple acquisition\n    -- Some{..} &lt;- getResource\n    \\(x::X) -&gt; monadic $ do -- HERE I WILL DO I/O...\n]\n</code></pre>\n\n<p>So, question is: how to call getResource once? So, not in the <code>\\(x::X) -&gt; ...</code> body but before it. Is it possible?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560860789, "post_id": 56649109, "comment_id": 99867913, "body": "You should use a record here, it does not make sense at all to use a list, since your list contains different concepts (that <i>happen</i> to have the same type)."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 9419947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78daa77f0251eb5ac51d0dd69995d2a1?s=128&d=identicon&r=PG&f=1", "display_name": "UnseenElder", "link": "https://stackoverflow.com/users/9419947/unseenelder"}, "edited": false, "score": 0, "creation_date": 1560861384, "post_id": 56649281, "comment_id": 99868293, "body": "Thank you very much for your answer. My original version might have been because I&#39;m still not very at ease with data constructor techniques."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1560861195, "creation_date": 1560861195, "answer_id": 56649281, "question_id": 56649109, "link": "https://stackoverflow.com/questions/56649109/how-to-write-this-code-shorter-and-so-that-it-may-be-used-for-a-wider-purpose/56649281#56649281", "title": "How to write this code shorter and so that it may be used for a wider purpose?", "body": "<p>It does not make much sense to use a list in the first place. A list should be used for a colleciton of items. But here <code>\"Mathematics\"</code> (the <code>Name</code>), and <code>\"BSc\"</code> (the <code>Type</code>) are orthogonal items. They only \"<em>happen</em>\" to have the same type. If you would later change the type of one of your items, then you can not even use a list (or at least not without using sum types, and that would make it even more ugly).</p>\n\n<p>You better use a record for this, like:</p>\n\n<pre><code><b>data</b> Qualification = <b>Qualification {</b>\n    qualName :: Name,\n    qualType :: Type,\n    qualProvider :: Provider\n<b>}</b>\n\ntype Name = String\ntype Type = String\ntype Provider = String</code></pre>\n\n<p>Now you can create a <code>Qualification</code> as:</p>\n\n<pre><code>num1000101 :: Qualification\nnum1000101 = Qualfication &quot;Mathematics&quot; &quot;BSc&quot; &quot;UCL&quot;</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>num1000101 :: Qualification\nnum1000101 = Qualification {\n    qualName=&quot;Mathematics&quot;,\n    qualType=&quot;BSc&quot;,\n    qualProvider=&quot;UCL&quot;\n  }</code></pre>\n\n<p>The nice thing is that the compiler generated functions for you: <code>qualName :: Qualification -&gt; Name</code>, <code>qualType :: Qualification -&gt; Type</code>, and <code>qualProvider :: Qualification -&gt; Provider</code>, so there is no need to implement \"getters\" yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 3, "last_activity_date": 1560861318, "creation_date": 1560861318, "answer_id": 56649316, "question_id": 56649109, "link": "https://stackoverflow.com/questions/56649109/how-to-write-this-code-shorter-and-so-that-it-may-be-used-for-a-wider-purpose/56649316#56649316", "title": "How to write this code shorter and so that it may be used for a wider purpose?", "body": "<p>Use record syntax</p>\n\n<pre><code>data Qualification = Qualification { name :: String\n                                   , qtype :: String  -- type is reserved word\n                                   , provider :: String}  deriving (Show, Eq)\n\nnum1000101 = Qualification \"Mathematics\" \"BSc\" \"UCL\"\n</code></pre>\n\n<p>now you have functions <code>name</code>,  <code>qtype</code> and <code>provider</code> which work as getters</p>\n\n<pre><code>&gt; name num1000101\n=&gt; \"Mathematics\"\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 9419947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78daa77f0251eb5ac51d0dd69995d2a1?s=128&d=identicon&r=PG&f=1", "display_name": "UnseenElder", "link": "https://stackoverflow.com/users/9419947/unseenelder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1597363324, "creation_date": 1560860654, "last_edit_date": 1597363324, "question_id": 56649109, "link": "https://stackoverflow.com/questions/56649109/how-to-write-this-code-shorter-and-so-that-it-may-be-used-for-a-wider-purpose", "title": "How to write this code shorter and so that it may be used for a wider purpose?", "body": "<p>I'm writing a simple search engine, which is supposed to give out separate parameters of one Data unit. Is there a better (shorter) way you would write this?</p>\n<pre><code>type Qualification = [QualAttrib]\ntype QualAttrib    = String\ntype Name          = String\ntype Type          = String\ntype Provider      = String\n\nnum1000101 :: Qualification\nnum1000101 = [&quot;Mathematics&quot;,&quot;BSc&quot;,&quot;UCL&quot;]\n\ngetQualName a = a !! 0\ngetQualType a = a !! 1\ngetProvider a = a !! 2```\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1560859976, "post_id": 56645356, "comment_id": 99867381, "body": "Please convert the picture to text."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1560869676, "post_id": 56645356, "comment_id": 99873676, "body": "Lookup the term &quot;eta reduction&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1565604320, "post_id": 56645548, "comment_id": 101391780, "body": "Do you mean \\x y -&gt; (==) (map x y) :: Eq [b] =&gt; (a -&gt; b) -&gt; [a] -&gt; [b] -&gt; <i>BOOL</i>. ?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1560848963, "creation_date": 1560848963, "answer_id": 56645548, "question_id": 56645356, "link": "https://stackoverflow.com/questions/56645356/what-is-the-type-of-with-only-one-argument-in-haskell/56645548#56645548", "title": "What is the type of (==) with only one argument in Haskell", "body": "<p><strong>Short answer</strong>: it originates from the fact that the two operands of the <code>(==)</code> should have the same type.</p>\n\n<p>Let us derive the type for <code>\\x y -&gt; (==) (map x y)</code>. We can look up the types for <code>(==) :: Eq c =&gt; c -&gt; c -&gt; Bool</code> and <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>.</p>\n\n<p>Since we apply <code>x :: d</code> and <code>y :: e</code> to <code>map</code>, that thus means that:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nx   ::    d\ny   ::              e\n-----------------------------\nd ~ a -&gt; b, e ~ [a]\n</code></pre>\n\n<p>So <code>x</code> has type <code>a -&gt; b</code>, and <code>y</code> has type <code>[a]</code>.</p>\n\n<p>Now we know that <code>map x y</code> has type <code>map x y :: [b]</code>. This is the parameter in a function application with <code>(==)</code>. We thus can derive the type for <code>(==) (map x y)</code> as:</p>\n\n<pre><code>(==)    :: Eq c =&gt;  c -&gt; c -&gt; Bool\nmap x y ::         [b]\n----------------------------------\nc ~ [b]\n</code></pre>\n\n<p>So since <code>c ~ [b]</code>, this thus means that the type of <code>(==) (map x y) :: Eq [b] =&gt; [b] -&gt; Bool</code>, and thus that <code>\\x y -&gt; (==) (map x y)</code> has type <code>\\x y -&gt; (==) (map x y) :: Eq [b] =&gt; (a -&gt; b) -&gt; [a] -&gt; [b] -&gt; [b]</code>.</p>\n\n<p>Since it holds that:</p>\n\n<blockquote>\n  <p><code>instance Eq a =&gt; Eq [a]</code></p>\n</blockquote>\n\n<p>We can thus change the type constraint from <code>Eq [b]</code> to just <code>Eq b</code>.</p>\n\n<blockquote>\n  <p>Update: I found out that the type of</p>\n\n<pre><code>\\x y z -&gt; (==)(map x y) z\n</code></pre>\n</blockquote>\n\n<p>Since <code>(==) (map x y)</code> is a function, the above indeed holds, since this is the opposite of <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\"><em>&eta;-reduction</em> [Haskell-wiki]</a>.</p>\n"}], "owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 56645548, "answer_count": 1, "score": 2, "last_activity_date": 1560848963, "creation_date": 1560848336, "last_edit_date": 1560848836, "question_id": 56645356, "link": "https://stackoverflow.com/questions/56645356/what-is-the-type-of-with-only-one-argument-in-haskell", "title": "What is the type of (==) with only one argument in Haskell", "body": "<p>I am given the following function and I have to give the most general type.</p>\n\n<pre><code>\\x y -&gt; (==)(map x y)\n</code></pre>\n\n<p>My approach is on the picture attached. The solution is different tho, it is</p>\n\n<pre><code>Eq b=&gt; (a-&gt;b)-&gt;[a]-&gt;[b]-&gt;Bool\n</code></pre>\n\n<p>I do no understand where the [b] is coming from.</p>\n\n<p>Update: I found out that the type of   </p>\n\n<pre><code>\\x y z -&gt; (==)(map x y) z\n</code></pre>\n\n<p>Is the same as the type of my original function. \nSo basically you can drop one of the arguments in the lambda function but it's still kinda there, as we know that (==) takes 2 arguments? But why?</p>\n\n<p><a href=\"https://i.stack.imgur.com/EJt0g.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EJt0g.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "ghc", "callstack"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1560840635, "post_id": 56641648, "comment_id": 99856725, "body": "Point 1 is a bit misleading: if you add <code>HasCallStack</code> you surely have to recompile to make it have an effect. What I think you mean is that you do not need to recompile everything else (other modules &amp; libraries) like when turning profiling on."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1560831046, "creation_date": 1560831046, "answer_id": 56641648, "question_id": 56641366, "link": "https://stackoverflow.com/questions/56641366/why-provide-the-hascallstack-mechanism-since-we-already-have-ghc-prof-fprof/56641648#56641648", "title": "Why provide the `HasCallStack` mechanism since we already have `ghc -prof -fprof-auto-top` in GHC?", "body": "<p><code>HasCallStack</code> has a few basic advantages:</p>\n\n<ol>\n<li><p>It\u2019s lighter-weight, not needing <code>-prof</code>, so it doesn\u2019t require recompilation (because profiled code has a different ABI than non-profiled code)</p></li>\n<li><p>It gives you more control over what\u2019s included in the call stack, based on where you place <code>HasCallStack</code> constraints and where you use <code>withFrozenCallStack</code> to prevent irrelevant/internal details from showing up in traces</p></li>\n<li><p>It allows you to access the call stack from within the program itself using <code>getCallStack</code>, so you can incorporate it into messages for logging, exceptions, and so on</p></li>\n</ol>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1560832219, "creation_date": 1560828310, "last_edit_date": 1560832219, "question_id": 56641366, "link": "https://stackoverflow.com/questions/56641366/why-provide-the-hascallstack-mechanism-since-we-already-have-ghc-prof-fprof", "title": "Why provide the `HasCallStack` mechanism since we already have `ghc -prof -fprof-auto-top` in GHC?", "body": "<p>AFAIK, there are two ways to get a call stack for debugging in Haskell:</p>\n\n<ol>\n<li>add <code>HasCallStack</code> constraint in the code</li>\n<li>compile code with <code>ghc -prof -fprof-auto-top</code></li>\n</ol>\n\n<p>My test code:</p>\n\n<pre><code>import GHC.Stack\n\n-- | a wrapper function to make \"last\" from base traceable\nlast' :: HasCallStack =&gt; [a] -&gt; a\nlast' xs = case xs of [] -&gt; error \"abuse last\"; _ -&gt; last xs\n\n-- | a untraceable partial function\nfoo :: [Int] -&gt; Int\nfoo xs = last' xs + 1\n\n-- | a untraceable partial function\n-- , which looks like traceable, but it's call stack is cut off by \"foo\"\nbar :: HasCallStack =&gt; [Int] -&gt; Int\nbar xs = foo xs\n\n-- | an empty list\n-- , which is also an improper input of \"last'\"\nxs :: [Int]\nxs = []\n\n-- | the program is expected to print a call stack telling how \"bar\" is called\n-- , but we can only know that \"foo\" called \"last'\" improperly from the printed call stack\nmain :: IO ()\nmain = print $ bar xs\n</code></pre>\n\n<p>Following is the call stack I get from both of the above two ways with <a href=\"https://gist.github.com/luochen1990/94179a2492ff7d1ca45153645f1bb449\" rel=\"noreferrer\">this</a> test code:</p>\n\n<pre><code>$ ghc -prof -fprof-auto call-stack-cut-off.hs\n$ ./call-stack-cut-off\ncall-stack-cut-off: abuse last\nCallStack (from HasCallStack):\n  error, called at call-stack-cut-off.hs:5:29 in main:Main\n  last', called at call-stack-cut-off.hs:9:10 in main:Main\nCallStack (from -prof):\n  Main.last' (call-stack-cut-off.hs:5:1-60)\n  Main.foo (call-stack-cut-off.hs:9:1-21)\n  Main.bar (call-stack-cut-off.hs:14:1-15)\n  Main.main (call-stack-cut-off.hs:24:1-21)\n  Main.CAF (&lt;entire-module&gt;)\n</code></pre>\n\n<p>IMO, the call stack from <code>-prof</code> is already good enough and is easier to use. So I'm wondering why the <code>HasCallStack</code> mechanism is added yet. Is there some difference between these two way which will significantly affect the debugging experience?</p>\n"}, {"tags": ["haskell", "exec"], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1560827963, "post_id": 56641293, "comment_id": 99853294, "body": "Your last paragraph seems incorrect; if the <code>exec</code> syscall fails, then <code>executeFile</code> throws an exception that can be caught like any other. It&#39;s only if the <code>exec</code> syscall succeeds, but then something goes wrong with the new program, that there&#39;s no going back."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1560828087, "post_id": 56641293, "comment_id": 99853315, "body": "Yes, but presumably there&#39;s nothing else to clean up at that point. You can catch the exception, maybe log why <code>ls</code> didn&#39;t run, but anything else that should have been done before running <code>ls</code> needs to already have been done."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1560827693, "creation_date": 1560827693, "answer_id": 56641293, "question_id": 56640944, "link": "https://stackoverflow.com/questions/56640944/cleanly-replace-current-haskell-process-exec/56641293#56641293", "title": "Cleanly replace current Haskell process (exec)", "body": "<p>You need to put the <code>executeFile</code> <em>after</em> <code>finally</code>, because it completely replaces <em>any</em> code from the Haskell program.</p>\n\n<pre><code>main = do\n    finally (putStrLn \"opening\" &gt;&gt; putStrLn \"writing\") (putStrLn \"cleaning up\")\n    executeFile \"ls\" True [] Nothing\n</code></pre>\n\n<p>The only exception that can occur from <code>executeFile</code> is a problem with the exec itself, but you have to proceed as if the exec will work and you aren't coming back to the Haskell code; it's a one-way <code>goto</code>, not a subroutine call.</p>\n"}, {"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1560828049, "last_edit_date": 1560828049, "creation_date": 1560827728, "answer_id": 56641295, "question_id": 56640944, "link": "https://stackoverflow.com/questions/56640944/cleanly-replace-current-haskell-process-exec/56641295#56641295", "title": "Cleanly replace current Haskell process (exec)", "body": "<p>There's really nothing Haskell-specific about this. If you want to do things after a process is done, you can't just <a href=\"http://man7.org/linux/man-pages/man3/exec.3.html\" rel=\"nofollow noreferrer\"><code>exec(3)</code></a>/<a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-Process.html#v:executeFile\" rel=\"nofollow noreferrer\"><code>executeFile</code></a> it. You must instead <a href=\"http://man7.org/linux/man-pages/man2/fork.2.html\" rel=\"nofollow noreferrer\"><code>fork(2)</code></a>/<a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-Process.html#v:forkProcess\" rel=\"nofollow noreferrer\"><code>forkProcess</code></a>, then in the parent, do <a href=\"http://man7.org/linux/man-pages/man2/waitpid.2.html\" rel=\"nofollow noreferrer\"><code>waitpid(2)</code></a>/<a href=\"https://hackage.haskell.org/package/unix-2.7.2.2/docs/System-Posix-Process.html#v:getProcessStatus\" rel=\"nofollow noreferrer\"><code>getProcessStatus</code></a> on the child, and do your cleanup once that returns.</p>\n\n<hr>\n\n<p>Edit: The above is to clean up after the new process is done. If you don't care about that, and just want to clean up when your Haskell is done but the new process is still running, then chepner's answer will work.</p>\n"}], "owner": {"reputation": 4918, "user_id": 1631106, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42cac823ac4fa7a9c9e91599a0ff528f?s=128&d=identicon&r=PG", "display_name": "ivan", "link": "https://stackoverflow.com/users/1631106/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8068, "favorite_count": 0, "accepted_answer_id": 56641293, "answer_count": 2, "score": 3, "last_activity_date": 1560828049, "creation_date": 1560824183, "question_id": 56640944, "link": "https://stackoverflow.com/questions/56640944/cleanly-replace-current-haskell-process-exec", "title": "Cleanly replace current Haskell process (exec)", "body": "<p>I'm writing a Haskell program whose sole purpose is to execute another (non-Haskell) program, after gathering some info to determine what arguments that program should be executed with.</p>\n\n<p>Replacing a running Haskell process is easy enough using <code>executeFile</code>, but I'm wondering if there's a way to ensure the Haskell program properly cleans up after itself before it's replaced.</p>\n\n<p>For example, <code>Control.Exception.finally</code> is normally useful to ensure cleanup actions are performed even if an exception occurs, but it will have no effect if we exec a whole different process:</p>\n\n<pre><code>module Main (main) where\n\nimport Control.Exception    (finally)\nimport System.Posix.Process (executeFile)\n\nmain = finally (do putStrLn \"opening file descriptors\"\n                   putStrLn \"writing temporary files\"\n                   executeFile \"ls\" True [] Nothing)\n               (putStrLn \"cleaning up\")\n</code></pre>\n\n<p>The above example will never print \"cleaning up\".</p>\n\n<p>Is there a recommended way to perform such a maneuver \"cleanly\"?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1560805651, "post_id": 56638819, "comment_id": 99848708, "body": "(1) I think there is a typo in the version of <i>transformers</i> you mention in the final paragraph, as 0.1.1.4 would be quite old. (2) On a tangential note, the latest version of transformers (0.5.6.2) provides that alternative <code>WriterT</code> as <code>Control.Monad.Trans.Writer.CPS</code> (I know your question is not about that, but it doesn&#39;t hurt to use the occasion spread the word about it anyway)."}, {"owner": {"reputation": 563, "user_id": 465398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb2047aaf15653beea6ba8299c8ff08?s=128&d=identicon&r=PG", "display_name": "Samuel Rivas", "link": "https://stackoverflow.com/users/465398/samuel-rivas"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1560806123, "post_id": 56638819, "comment_id": 99848866, "body": "There was a typo indeed, thanks. Fixed now."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1560808967, "post_id": 56638819, "comment_id": 99849653, "body": "I haven&#39;t dived into the code much here but expect it&#39;s the same reason all non-CC writer monads are a bad thing: <a href=\"https://blog.infinitenegativeutility.com/2016/7/writer-monads-and-space-leaks\" rel=\"nofollow noreferrer\">blog.infinitenegativeutility.com/2016/7/&hellip;</a>"}, {"owner": {"reputation": 563, "user_id": 465398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb2047aaf15653beea6ba8299c8ff08?s=128&d=identicon&r=PG", "display_name": "Samuel Rivas", "link": "https://stackoverflow.com/users/465398/samuel-rivas"}, "edited": false, "score": 1, "creation_date": 1560850545, "post_id": 56638819, "comment_id": 99862013, "body": "Isn&#39;t <code>CPS.RWS</code> supposed to deal with that problem? It actually seems to run the counting in constant space in this case, but only if I compile against the library. In any case the question is why does the same code behave differently depending on how I compile and link in my example, I do understand why the basic Writer implementation leaks"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1560881838, "post_id": 56638819, "comment_id": 99879699, "body": "Can you try without <code>-fprof-auto</code>? GHC does not correctly optimize when you have that on. This is because it doesn&#39;t optimize across cost centers. E.g. <code>sum $ map _a $ filter _b $ concatMap _c $ unfoldr _d</code> turns into a single loop with no lists in sight, but <code>sum $ map _a $ {-# SCC oof #-} filter _b $ concatMap _c $ unfoldr _d</code> can&#39;t become a loop, because where does the cost center go? With just <code>-fprof</code> and manual <code>SCC</code>s you can avoid the issue, but <code>-fprof-auto</code> is very stupid and has a tendency to break everything."}, {"owner": {"reputation": 563, "user_id": 465398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb2047aaf15653beea6ba8299c8ff08?s=128&d=identicon&r=PG", "display_name": "Samuel Rivas", "link": "https://stackoverflow.com/users/465398/samuel-rivas"}, "edited": false, "score": 0, "creation_date": 1560890299, "post_id": 56638819, "comment_id": 99883346, "body": "You are right! removing <code>-fprof-auto</code> does fix the problem when I link to my local copy"}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1560885288, "creation_date": 1560885288, "answer_id": 56655650, "question_id": 56638819, "link": "https://stackoverflow.com/questions/56638819/different-space-behaviour-when-compiling-from-source-than-when-linking-to-a-pack/56655650#56655650", "title": "Different space behaviour when compiling from source than when linking to a package", "body": "<p>The culprit is, in fact, the profiling system. Note that you don't actually need <code>-prof</code> to detect the space leak\u2014the RTS option <code>-s</code> can print out a \"total memory\" measurement without it. Less scientifically, the space leak makes the program a lot slower, and you can just feel it. Armed with this, I found that disabling <code>-prof</code> reduced the memory usage of the \"local\" version to 2MB (the same as the \"library\" version), and leaving it on used ~1.9GB.</p>\n\n<p>The reason profiling can make things slower is because GHC refuses to optimize as well. It can't aggressively restructure the code you write anymore, because the cost centers imply a certain structure to the code, and sometimes there's no good place for the cost center after an optimization, thereby blocking that optimization. Knowing precisely what's going wrong here would require knowing the flags with which you built the library, but the high-level explanation is that the <code>writer-cps-transformers</code> library was built with less aggressive profiling (and therefore more aggressive optimization) than the <code>RWS.hs</code> file. <code>-fprof-auto</code> is a very aggressive profiling option and it can easily break lots of optimizations. If I use a <code>writer-cps-transformers</code> built with <code>-fprof-auto</code>, I get the same issue. If I use a <code>RWS.hs</code> without profiling or with something weaker, like <code>-fprof-auto-exported</code>, then I fix the issue.</p>\n"}], "owner": {"reputation": 563, "user_id": 465398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb2047aaf15653beea6ba8299c8ff08?s=128&d=identicon&r=PG", "display_name": "Samuel Rivas", "link": "https://stackoverflow.com/users/465398/samuel-rivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 56655650, "answer_count": 1, "score": 8, "last_activity_date": 1560885288, "creation_date": 1560805023, "last_edit_date": 1560835880, "question_id": 56638819, "link": "https://stackoverflow.com/questions/56638819/different-space-behaviour-when-compiling-from-source-than-when-linking-to-a-pack", "title": "Different space behaviour when compiling from source than when linking to a package", "body": "<p>This code leaks or doesn't depending on how I compile the same RWS implementation:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Control.Monad         (replicateM_)\nimport qualified Control.Monad.RWS.CPS as RWS\nimport           Data.Monoid           (Sum (..))\n-- import qualified RWS\n\n{-# ann module \"HLint: ignore Use camelCase\" #-}\n\ncount_a_lot :: Int -&gt; RWS.RWS () (Sum Int) () ()\ncount_a_lot = flip replicateM_ count\n\ncount :: RWS.RWS () (Sum Int) () ()\ncount = RWS.tell . Sum $ 1\n\nmain :: IO ()\nmain = print . snd $ RWS.evalRWS (count_a_lot 10000000) () ()\n</code></pre>\n\n<p>I experimented with two ways of using the CPS version of RWS:</p>\n\n<ul>\n<li><code>import qualified Control.Monad.RWS.CPS as RWS</code> uses the <code>writer-cps-transformers</code> package, from nixpkgs.</li>\n<li><code>import qualified RWS</code> uses <a href=\"https://github.com/minad/writer-cps-transformers/blob/6414485221b1487b9b1b16353e76243658a64d6a/src/Control/Monad/Trans/RWS/CPS/Internal.hs\" rel=\"nofollow noreferrer\">Internal.hs</a>, copied verbatim as <code>RWS.hs</code> to the same local directory as the file pasted above.</li>\n</ul>\n\n<p>If I compile the code above and run it, I can see that it runs in constant space.</p>\n\n<p><a href=\"https://i.stack.imgur.com/nHd6g.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nHd6g.png\" alt=\"hs2ps, constant space\"></a></p>\n\n<p>If I change the imports to compile and link the copy of <code>RWS.hs</code></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Control.Monad (replicateM_)\n-- import qualified Control.Monad.RWS.CPS as RWS\nimport           Data.Monoid   (Sum (..))\nimport qualified RWS\n</code></pre>\n\n<p>I get a space leak. The black retainer there is <code>(103)&lt;*&gt;.\\</code>, and the blue is <code>SYSTEM</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/EwWvn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EwWvn.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why can this be? Or how should I best debug this?</p>\n\n<p>In both cases, I am compiling with ghc (no cabal) with <code>-Wall -O2 -prof -fprof-auto -rtsopts -fexternal-interpreter</code>. I can post more detailed compiler invocation and output lines if it were relevant.</p>\n\n<p>Using <code>ghc-8.4.4</code>, <code>transformers-0.5.5.0</code> and <code>writer-cps-transformers-0.1.1.4</code>. I know these versions are not current, but I am interested in knowing what is going on, rather on solving the actual leak, so I assume the versions aren't that relevant.</p>\n"}, {"tags": ["regex", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1560803098, "post_id": 56638286, "comment_id": 99847795, "body": "You probably need to edit the generated cabal file of your project to add <code>regex</code> as a dependency."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1560804787, "post_id": 56638286, "comment_id": 99848451, "body": "If you are using stack you probably have a <code>package.yaml</code> file, from which the <code>xxxxx.cabal</code> file is generated. You can edit the <code>package.yaml</code> file to add the dependency, so that <code>stack build</code> should work."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1560805268, "post_id": 56638286, "comment_id": 99848585, "body": "The second suggested question (&quot;How do I add...&quot;) addresses the point about <code>package.yaml</code> mentioned by chi."}], "owner": {"reputation": 6896, "user_id": 6797267, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bba37c069bfb5b705b7a0c98bd9b4803?s=128&d=identicon&r=PG&f=1", "display_name": "Lev", "link": "https://stackoverflow.com/users/6797267/lev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "closed_date": 1560805196, "answer_count": 0, "score": 0, "last_activity_date": 1560805228, "creation_date": 1560802292, "last_edit_date": 1560802646, "question_id": 56638286, "link": "https://stackoverflow.com/questions/56638286/unable-to-load-a-haskell-module", "closed_reason": "Duplicate", "title": "unable to load a haskell module", "body": "<p>Using stack version 1.9.3 and\nGHCI version 8.6.3, I follow these steps:</p>\n\n<ul>\n<li><p>create a new project with <code>stack new \"myproject\"</code></p></li>\n<li><p><code>cd</code> into myproject</p></li>\n<li><p>run <code>stack install regex</code> which returns the following</p></li>\n</ul>\n\n<blockquote>\n  <p>base-compat-0.10.5: using precompiled package hashable-1.2.7.0: using\n  precompiled package time-locale-compat-0.1.1.5: using precompiled\n  package utf8-string-1.0.1.1: using precompiled package\n  regex-base-0.93.2: using precompiled package\n  unordered-containers-0.2.9.0: using precompiled package\n  regex-pcre-builtin-0.94.4.8.8.35: using precompiled package\n  regex-tdfa-1.2.3.2: using precompiled package regex-tdfa-text-1.0.0.3:\n  using precompiled package regex-1.0.2.0: using precompiled package\n  Completed 10 action(s).</p>\n</blockquote>\n\n<p>At this point I assume the regex package is correctly installed.</p>\n\n<p>But then in my code when I try to import the regex package with <code>import Text.RE</code> I get the following error </p>\n\n<blockquote>\n  <p>Could not load module \u2018Text.RE\u2019 It is a member of the hidden package\n  \u2018regex-1.0.2.0\u2019. You can run \u2018:set -package regex\u2019 to expose it.\n  (Note: this unloads all the modules in the current scope.) Use -v to\n  see a list of the files searched for.</p>\n</blockquote>\n\n<p>What am I missing out on ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1560793501, "post_id": 56636228, "comment_id": 99843916, "body": "I don&#39;t understand what you&#39;re trying to do. In C a block is just a type of statement (&quot;compound statement&quot;)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1560793784, "post_id": 56636228, "comment_id": 99844025, "body": "<code>forall a. BlockItem a</code> is something that can be tagged with <i>every</i> statement type simultaneously (only <code>Var</code> has this property)."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1560911756, "creation_date": 1560911756, "answer_id": 56659307, "question_id": 56636228, "link": "https://stackoverflow.com/questions/56636228/c-language-ast-using-gadts-and-constructor-subsets/56659307#56659307", "title": "C language AST using GADTs and constructor subsets", "body": "<p>(Haskell pro-tip:  If you ever find yourself having to use the <code>ImpredicativeTypes</code> extension, take your hands off the keyboard and back away from the computer.)</p>\n\n<p>Anyway, to elaborate on @luqui's comment, the type <code>Defn</code> is equivalent to:</p>\n\n<pre><code>data Defn = Func String [forall a. BlockItem a]\n</code></pre>\n\n<p>This is a product type of a <code>String</code> and a list.  The elements of the list have type <code>forall a. BlockItem a</code>, which is the type of things that can be <code>BlockItem a</code> for any <code>a</code> (as chosen by the caller/user of the value).  As @luqui points out, <code>Var \"a\" (Lit 2)</code> has this type -- it can be a <code>BlockItem a</code> for any possible <code>a</code>, but your other block items can't.  For example, <code>Return (Lit 0)</code> can only be <code>BlockItem a</code> when <code>a</code> is a <code>StmtType</code>, so it can't be put in a <code>[forall a. BlockItem a]</code> list -- the type is too general for it.</p>\n\n<p>It's analogous to the following type, which allows storage of things that can be any kind of <code>Num</code>:</p>\n\n<pre><code>data NumList = NL [forall a. Num a =&gt; a]\n</code></pre>\n\n<p>Because <code>3</code> and <code>18 - 1</code> can be any kind of <code>Num</code>, we can put them in the list:</p>\n\n<pre><code>mylist = NL [3, 18-1]\n</code></pre>\n\n<p>Later, we can extract one of the element of this list:</p>\n\n<pre><code>NL [_,x] = mylist\n</code></pre>\n\n<p>and treat it as any kind of <code>Num</code> we want:</p>\n\n<pre><code>&gt; x :: Integer\n17\n&gt; x :: Double\n17.0\n</code></pre>\n\n<p>But we can't put a specific <code>Num</code> type (e.g., an <code>Int</code>) into the list:</p>\n\n<pre><code>badlist = NL [length \"hello\"]  -- type error\n</code></pre>\n\n<p>If we could, then we could write:</p>\n\n<pre><code>&gt; let NL [x] = badlist in sqrt x\n</code></pre>\n\n<p>to take the <code>sqrt</code> of an <code>Int</code>, and all \"type hell\" would break loose.</p>\n\n<p>So, that's what you're doing <em>wrong</em>.  It's hard to tell how you should do it <em>right</em>.  Why doesn't the following work for you, without GADTs and DataKinds?</p>\n\n<pre><code>data Defn = Func String [BlockItem]\n\ndata BlockItem\n  = Var String Expr\n  | Stmt Statement\n\ndata Statement\n  = SideEff Expr\n  | Return Expr\n\ndata Expr\n  = Lit Int\n</code></pre>\n"}], "owner": {"reputation": 4235, "user_id": 1518183, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/822d321afa518348af0f484e24eef47c?s=128&d=identicon&r=PG", "display_name": "user1518183", "link": "https://stackoverflow.com/users/1518183/user1518183"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 56659307, "answer_count": 1, "score": 1, "last_activity_date": 1560911756, "creation_date": 1560792600, "question_id": 56636228, "link": "https://stackoverflow.com/questions/56636228/c-language-ast-using-gadts-and-constructor-subsets", "title": "C language AST using GADTs and constructor subsets", "body": "<p>I would like to define type level safe C language AST. So far, I come up with with something like this:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE ImpredicativeTypes #-}\n{-# LANGUAGE RankNTypes #-}\n\ndata Defn\n  = Func String [Block]\n\ntype Block = forall a. BlockItem a\ntype Stmt = BlockItem StmtType\n\ndata BlockItemKind = StmtType\n\ndata BlockItem :: BlockItemKind -&gt; * where\n  Var :: String -&gt; Expr -&gt; BlockItem a\n  SideEff :: Expr -&gt; BlockItem StmtType\n  Return :: Expr -&gt; BlockItem StmtType\n\ndata Expr\n  = Lit Int\n</code></pre>\n\n<p>The key point is the <code>BlockItem</code> data type. In C standard, there are two very similar structures \u2013 block and statements. Block is basically just list of statements that can also contain variable declaration. In this code, I'm trying to declare statement as subset of block items constructors (as <code>SideEff</code> and <code>Return</code>).</p>\n\n<p>However, this code does not work as expected. Consider following code which is printing this AST:</p>\n\n<pre><code>showDefn :: Defn -&gt; String\nshowDefn (Func name block) = \"func \" ++ name ++ \" . \" ++ show (showBlock &lt;$&gt; block)\n\nshowBlock :: Block -&gt; String\nshowBlock (Var name e) = name ++ \" = \" ++ showExpr e ++ \";\"\nshowBlock e = showStmt e\n\nshowStmt :: Stmt -&gt; String\nshowStmt (SideEff e) = showExpr e ++ \";\"\nshowStmt (Return e) = \"return \" ++ showExpr e ++ \";\"\n\nshowExpr :: Expr -&gt; String\nshowExpr (Lit x) = show x\n</code></pre>\n\n<p>When I'm evaluating <code>showDefn</code> with <code>[Block]</code>, everything works well. This code however not work when I'm using <code>Stmt</code> type:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  -- FOLLOWING WORK\n  print $ showDefn (Func \"foo\" [Var \"a\" (Lit 2), Var \"b\" (Lit 3)])\n\n  -- FOLLOWING DOES NOT WORK\n  print $ showDefn (Func \"foo\" [Return (Lit 0)])\n  print $ showDefn (Func \"foo\" [Var \"a\" (Lit 1), SideEff (Lit 2)])\n</code></pre>\n\n<p>You can run the code <a href=\"https://repl.it/@Nutelac/CheapOliveSearchservice\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Where is the problem? I'm not even sure, if this is the right design.</p>\n"}, {"tags": ["haskell", "type-conversion", "maps"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1560784182, "post_id": 56634048, "comment_id": 99839921, "body": "You can not just convert a <code>ByteString</code> to a <code>String</code>, since that requires an &quot;encoding&quot;."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560784291, "post_id": 56634048, "comment_id": 99839968, "body": "I encoded them from String to ByteString with <code>BSU.fromString</code> and saved them in the Map. <code>BSU.toString</code> gives me the values, so this have to work I guess?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560784451, "post_id": 56634048, "comment_id": 99840067, "body": "Ah, that&#39;s UTF8 then"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560784502, "post_id": 56634048, "comment_id": 99840094, "body": "You can probably <code>fromList . map (both BSU.toString) . toList</code>?"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560785133, "post_id": 56634048, "comment_id": 99840416, "body": "I tired that, but got no usable result. I got it working with the approved Answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560815831, "post_id": 56634048, "comment_id": 99851201, "body": "Are you sure you don&#39;t just want <code>printMap = print db</code>...?"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560849111, "post_id": 56634048, "comment_id": 99861102, "body": "Yes I&#39;m sure. However, this could have worked :)"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1560784493, "creation_date": 1560784493, "answer_id": 56634193, "question_id": 56634048, "link": "https://stackoverflow.com/questions/56634048/how-to-convert-a-map-bytestring-bytestring-to-map-string-string-and-print-it/56634193#56634193", "title": "How to convert a Map ByteString ByteString to Map String String and print it", "body": "<p><code>Map</code> itself isn't a functor, only <code>Map k</code> for some key type <code>k</code>, which is why <code>mapM_</code> only operates on your values. Instead, work with the list of key/value pairs returned by <code>Map.toList</code>.</p>\n\n<pre><code>mapM_ (\\(k, v) -&gt; ...) (Map.toList db)\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 56634193, "answer_count": 1, "score": -1, "last_activity_date": 1560784493, "creation_date": 1560783912, "question_id": 56634048, "link": "https://stackoverflow.com/questions/56634048/how-to-convert-a-map-bytestring-bytestring-to-map-string-string-and-print-it", "title": "How to convert a Map ByteString ByteString to Map String String and print it", "body": "<p>How would someone convert a Map of <code>ByteString:ByteString</code> to a Map <code>String:String</code>? I tried the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Map as Map\nimport Data.ByteString.UTF8 as BSU\n\ntype Key   = ByteString\ntype Valye = ByteString\ntype DB    = Map.Map Key Valye\n\nprintMap :: IO ()\nprintMap = do\n    -- db exists to this point and is of type DB\n    mapM_ putStrLn $ Map.map BSU.toString db\n</code></pre>\n\n<p>This will result in a printable value, but only my values are printed not my keys...\nI know there is also <code>Map.mapKeys</code> which would give me the keys, but how do I obtain both and print them like this?</p>\n\n<pre><code>k0: v0\nk1: v1\nk2: v2\n</code></pre>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560777158, "post_id": 56632058, "comment_id": 99835951, "body": "Ok, thank you very nice again! Would you go another approach than pattern matching with this? The More cases I have the more lines I need to write... Is there a better way for this?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560777291, "post_id": 56632058, "comment_id": 99836038, "body": "@Biskit1943: but here there are three possible outcomes, so it looks like the three clauses are justified here. You could abstract the length comparison away, so creating a function that determines the length of a list, and use a parameter to either return <code>&quot;Too much&quot;</code> or <code>&quot;Too few&quot;</code>."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560777446, "post_id": 56632058, "comment_id": 99836133, "body": "Yeah, but I have more commands than just <code>set</code> lets say I have three more, would you still use this?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560777648, "post_id": 56632058, "comment_id": 99836261, "body": "@Biskit1943: no, as said before, you can abstract that away in a separate function."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1560777967, "last_edit_date": 1560777967, "creation_date": 1560776967, "answer_id": 56632058, "question_id": 56631989, "link": "https://stackoverflow.com/questions/56631989/how-to-match-the-rest-of-the-list-no-matter-the-length/56632058#56632058", "title": "How to match the rest of the list, no matter the length", "body": "<p>You can use the \"<em>cons</em>\" list construction:</p>\n\n<pre><code>parseArgs :: [String] -&gt; Either String Command\nparseArgs [&quot;set&quot;, k, v] = Right $ Command k v\nparseArgs [&quot;set&quot;, _] = Left &quot;To few arguments for set&quot;\nparseArgs <b>(&quot;set&quot;: _: _: _)</b> = Left &quot;To much arguments for set&quot;</code></pre>\n\n<p><code>(\"set\": _: _: _)</code> is a compact form of <code>(\"set\": (_: (_: _)))</code> so we here match with a list that is non-empty, and where the tail is non-empty, and where that tail is non-empty, so a list that contains at least three elements.</p>\n\n<p>In fact <code>[\"set\", _, _, _]</code> is just <em>syntactical sugar</em> for <code>(\"set\": (_: (_: (_:[]))))</code>. So by using a wild card <code>_</code> instead of an empty list <code>[]</code> at the tail, we leave it open what follows next.</p>\n\n<p>You forgot the case where one simply passed <code>[\"set\"]</code>, we can also use the same technique for that:</p>\n\n<pre><code>parseArgs :: [String] -&gt; Either String Command\nparseArgs [&quot;set&quot;, k, v] = Right $ Command k v\nparseArgs (&quot;set&quot;: _: _: _) = Left &quot;To much arguments for set&quot;\nparseArgs <b>(&quot;set&quot;:_)</b> = Left &quot;To few arguments for set&quot;</code></pre>\n\n<p>This will thus match a singleton list, and a list with two elements, where the first element is each time <code>\"set\"</code>.</p>\n\n<p>We can decide to parameterize the length check, like:</p>\n\n<pre><code>checkLength :: Int -&gt; [a] -&gt; Either String b\ncheckLength n _ | n &lt; 0 = Left \"Too much arguments\"\ncheckLength n [] = Left \"Too few arguments\"\ncheckLength n (_:xs) = checkLength (n-1) xs\n</code></pre>\n\n<p>or even simpler with <code>drop</code>:</p>\n\n<pre><code>checkLength :: Int -&gt; [a] -&gt; Either String b\ncheckLength n = Left . foldr (const . const \"Too much\") \"Too few\" . drop n \n</code></pre>\n\n<p>Then we can thus check this as:</p>\n\n<pre><code>parseArgs :: [String] -&gt; Either String Command\nparseArgs [&quot;set&quot;, k, v] = Right $ Command k v\nparseArgs (&quot;set&quot;: xs) = checkLength 2 xs</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 56632058, "answer_count": 1, "score": 1, "last_activity_date": 1560777967, "creation_date": 1560776775, "question_id": 56631989, "link": "https://stackoverflow.com/questions/56631989/how-to-match-the-rest-of-the-list-no-matter-the-length", "title": "How to match the rest of the list, no matter the length", "body": "<p>I want to write a function which takes a <code>list</code> of <code>String</code>s with pattern matching. For example I check for a keyword <code>set</code> like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseArgs :: [String] -&gt; Either String Command\nparseArgs [\"set\", k, v] = Right $ Command k v\nparseArgs [\"set\", _] = Left \"To few arguments for set\"\nparseArgs [\"set\", _, _, _] = Left \"To much arguments for set\"\n</code></pre>\n\n<p>As you can see I want to match <code>parseArgs [\"set\", \"key\", \"value\", ...]</code>. \nBut the current approach only gives me a match on <code>[\"set\", \"key\", \"value\", \"something\"]</code> not for more entries.</p>\n\n<p>How would I achieve this?</p>\n"}, {"tags": ["haskell", "typing"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1560773334, "post_id": 56630940, "comment_id": 99833806, "body": "Your blue comment would be true if we had <code>map1 :: ((d -&gt; e) -&gt; [d]) -&gt; [e]</code> but we have instead <code>map1 :: (d -&gt; e) -&gt; ([d] -&gt; [e])</code> since implicitly <code>-&gt;</code> associates on the right."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1560793598, "post_id": 56630940, "comment_id": 99843953, "body": "Never seen someone use rainbow scratchboard to do homework. I like it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1560802797, "post_id": 56630940, "comment_id": 99847675, "body": "This question doesn&#39;t work with screen readers."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1561052748, "post_id": 56630940, "comment_id": 99948088, "body": "<code>map . map</code> = <code>\\ f -&gt; map (map f)</code> (by the definition of <code>(.)</code>), which you could eta-expand into <code>\\ f xss -&gt; map (\\ xs -&gt; map f xs) xss</code>\u2014in other words, it\u2019s mapping over the interior lists in a list of lists. Can be generalised to any functor: given <code>fmap2 = fmap . fmap</code>, <code>fmap2 succ [Just 1, Nothing, Just 2]</code> = <code>[Just 2, Nothing, Just 3]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1560773858, "last_edit_date": 1560773858, "creation_date": 1560773289, "answer_id": 56630994, "question_id": 56630940, "link": "https://stackoverflow.com/questions/56630940/what-is-the-type-of-map-map-in-haskell/56630994#56630994", "title": "What is the type of map.map in Haskell?", "body": "<p><strong>Short answer</strong>: the arrow type constructor <code>(-&gt;)</code> is a <em>right associative</em> operator.</p>\n\n<p>The arrow is right associative. This means that if you write:</p>\n\n<pre><code>map :: (d -&gt; e) -&gt;  [d] -&gt; [e]\n</code></pre>\n\n<p>more verbose, you wrote:</p>\n\n<pre><code>map :: (d -&gt; e) -&gt; ([d] -&gt; [e])\n</code></pre>\n\n<p>So given the first parameter of <code>(.)</code> has type <code>(a -&gt; b)</code>, this thus means that the type <code>(d -&gt; e) -&gt; ([d] -&gt; [e]) ~ a -&gt; b</code> (<code>~</code> means the same type), and thus <code>a ~ d -&gt; e</code> and <code>b ~ [d] -&gt; [e]</code>. The same of course holds when we type check with the second <code>map</code>.</p>\n\n<p>With that in mind we thus, like the nodes say derive:</p>\n\n<pre><code>(.) map map :: (f -&gt; g) -&gt; ([[f]] -&gt; [[g]])\n</code></pre>\n\n<p>This thus means that this function takes a function of type <code>f -&gt; g</code>, and maps all the elements in the lists of a list to a list of lists maintaining the structure.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; (.) map map (+1) [[1,4,2,5], [], [1,3], [2]]\n[[2,5,3,6],[],[2,4],[3]]\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 56630994, "answer_count": 1, "score": 1, "last_activity_date": 1560773858, "creation_date": 1560773069, "question_id": 56630940, "link": "https://stackoverflow.com/questions/56630940/what-is-the-type-of-map-map-in-haskell", "title": "What is the type of map.map in Haskell?", "body": "<p>I want to find the type of map.map. The first image is a solution that i have found, but i don't quite get. My solution would have been like in the second image, but it is wrong. I do not understand the marked bit of the solution. Why is it like that?</p>\n\n<p><a href=\"https://i.stack.imgur.com/Yng0X.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Yng0X.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/jjiDm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jjiDm.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560750352, "post_id": 56625246, "comment_id": 99823094, "body": "Is there anyway I could turn this into a printer though? For example something of the form &quot;instance Show CTypeF..&quot;. The issue again is I am not sure what to pass as an argument. It should be of the form instance Show CTypeF a where..."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560750552, "post_id": 56625246, "comment_id": 99823151, "body": "@Lana You already have that instance, from <code>deriving (... Show ... )</code>. I don&#39;t understand your comment."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560751026, "post_id": 56625246, "comment_id": 99823308, "body": "I guess I should say what I was really trying to get to here. I was trying to print an instance of Subst, from this library: <a href=\"http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Variables.html#t:HasVars\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/compdata-0.1/docs/&hellip;</a>. This gave me &quot;No instance for (Show (Cxt NoHole CTypeF ()))&quot; So I assumed it was something with the CTypeF printer."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560751350, "post_id": 56625246, "comment_id": 99823406, "body": "I&#39;ll go ahead and make a different question for that though, since the issue does not seem to be about CTypeF. Thank you!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1560749783, "creation_date": 1560749783, "answer_id": 56625246, "question_id": 56625188, "link": "https://stackoverflow.com/questions/56625188/ambiguous-type-variable-a0-arising-from-a-use-of-print/56625246#56625246", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019", "body": "<p>As the error message says, <code>CTypeF</code> takes an argument. <code>CTypeF</code> is not a type, but e.g. <code>CTypeF ()</code> or <code>CTypeF Int</code> or <code>CTypeF [(String, Double)]</code> are.</p>\n\n<p>The situation is analogous to <code>print Nothing</code> and attempting to fix it by adding <code>(Nothing :: Maybe)</code>. You need to specify <code>Maybe ()</code> or <code>Maybe Int</code> or ...</p>\n\n<p>Try</p>\n\n<pre><code>my_test = do\n    let c0 = CIntF :: CTypeF ()\n    print c0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4431, "user_id": 23106, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BYY6E.png?s=128&g=1", "display_name": "Colin Barrett", "link": "https://stackoverflow.com/users/23106/colin-barrett"}, "is_accepted": false, "score": 1, "last_activity_date": 1560749813, "creation_date": 1560749813, "answer_id": 56625251, "question_id": 56625188, "link": "https://stackoverflow.com/questions/56625188/ambiguous-type-variable-a0-arising-from-a-use-of-print/56625251#56625251", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019", "body": "<p>The issue is that, as Haskell sees it, you havent told it what the <code>a</code> in <code>CTypeF a</code> is, at least not enough to print it. You might try <code>print (CIntF :: CTypeF ())</code>. </p>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 56625246, "answer_count": 2, "score": 1, "last_activity_date": 1560749813, "creation_date": 1560749356, "question_id": 56625188, "link": "https://stackoverflow.com/questions/56625188/ambiguous-type-variable-a0-arising-from-a-use-of-print", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019", "body": "<p>I have the following data structure, and I am trying to write a printer for it:</p>\n\n<pre><code>data CTypeF a \n    = CVarF Int \n    | CArrF a a\n    | CIntF\n    | CBoolF\n    deriving (Eq, Data, Show, Functor, Foldable, Traversable)  \n</code></pre>\n\n<p>The following gives me an error:</p>\n\n<pre><code>my_test = do\n    let c0 = CIntF\n    (print CIntF)\n</code></pre>\n\n<p>This is the error message:</p>\n\n<pre><code>\u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Show Constr -- Defined in \u2018Data.Data\u2019\n        instance Show ConstrRep -- Defined in \u2018Data.Data\u2019\n        instance Show DataRep -- Defined in \u2018Data.Data\u2019\n        ...plus 40 others\n        ...plus 166 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n\u2022 In a stmt of a 'do' block: (print CIntF)\n          In the expression:\n            do let c0 = CIntF\n               (print CIntF)\n</code></pre>\n\n<p>I saw the following question <a href=\"https://stackoverflow.com/questions/54865167/ambiguous-type-variable-b1-arising-from-a-use-of-print\">Ambiguous type variable \u2018b1\u2019 arising from a use of \u2018print\u2019</a></p>\n\n<p>and modified my code to do <code>(print CIntF :: CTypeF)</code> but I get:</p>\n\n<pre><code>\u2022 Expecting one more argument to \u2018CTypeF\u2019\n      Expected a type, but \u2018CTypeF\u2019 has kind \u2018* -&gt; *\u2019\n</code></pre>\n\n<p>I am a bit lost on what the issue is. Could someone point out what I'm doing wrong here?</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "type-inference", "unification"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1560755747, "post_id": 56625003, "comment_id": 99825080, "body": "<code>Cxt</code> has no <code>Show</code> instance and therefore cannot be printed, no matter what parameters you give it."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1560757495, "post_id": 56625003, "comment_id": 99825884, "body": "Sorry, but I am new to haskell and I am not understanding your point. I already know the instance is missing and my question is how to implement it. So are you saying you can&#39;t define an instance?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560759976, "post_id": 56625003, "comment_id": 99826996, "body": "@Lana It should still be possible to define a <code>Show</code> instance for <code>Ctx</code>. It would look something like <code>instance (Show (f (Ctx h f a)), Show a) =&gt; Show (Ctx h f a) where &lt;newline&gt; show (Term x) = show x &lt;newline&gt; show (Hole a) = show a</code>. Note that this is untested and so may not work the way you want, but a <code>Show</code> instance would look something along these lines."}], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 2, "last_activity_date": 1560764316, "last_edit_date": 1560764316, "creation_date": 1560763585, "answer_id": 56628441, "question_id": 56625003, "link": "https://stackoverflow.com/questions/56625003/printer-in-haskell-for-subst-in-data-comp-variables/56628441#56628441", "title": "Printer in Haskell for Subst in Data.Comp.Variables", "body": "<p><a href=\"http://hackage.haskell.org/package/compdata-0.12/docs/Data-Comp-Term.html#t:Cxt\" rel=\"nofollow noreferrer\"><code>Cxt</code></a> has a <code>Show</code> instance, but it requires its <code>f</code> parameter to have an instance of <a href=\"http://hackage.haskell.org/package/compdata-0.12/docs/Data-Comp-Derive.html#t:ShowF\" rel=\"nofollow noreferrer\"><code>ShowF</code></a>.</p>\n\n<pre><code>(Functor f, ShowF f, Show a) =&gt; Show (Cxt h f a)\n</code></pre>\n\n<p>So you need to make <code>CTypeF</code> have an instance of <code>ShowF</code>. To do that, you can use <a href=\"http://hackage.haskell.org/package/compdata-0.12/docs/Data-Comp-Derive.html#v:makeShowF\" rel=\"nofollow noreferrer\"><code>makeShowF</code></a> with Template Haskell.</p>\n\n<pre><code>$(makeShowF ''CTypeF)\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 56628441, "answer_count": 1, "score": -2, "last_activity_date": 1560764316, "creation_date": 1560747921, "last_edit_date": 1560751411, "question_id": 56625003, "link": "https://stackoverflow.com/questions/56625003/printer-in-haskell-for-subst-in-data-comp-variables", "title": "Printer in Haskell for Subst in Data.Comp.Variables", "body": "<p>I have a function which returns a <code>Subst</code> defined in this library:\n<a href=\"http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Variables.html#t:Subst\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Variables.html#t:Subst</a></p>\n\n<p>I am trying to print the return value. The printer should show a mapping from variables to terms. </p>\n\n<p>When I try to print the result, I get:</p>\n\n<pre><code>  \u2022 No instance for (Show (Cxt NoHole CTypeF ()))\n        arising from a use of \u2018print\u2019\n  \u2022 In the expression: (print subst)\n</code></pre>\n\n<p>I think this means I must implement a printer. I know that when it's a user defined class, I can do 'deriving show'. Could someone point out how I should go about printing this?</p>\n\n<p>Also, this is my CTypeF structure.</p>\n\n<pre><code>data CTypeF a \n    = CVarF Int \n    | CArrF a a\n    | CIntF\n    | CBoolF\n    deriving (Eq, Data, Functor, Foldable, Traversable, Show)\n</code></pre>\n\n<p>It derives show, so I don't think the issue is here.</p>\n"}, {"tags": ["haskell", "type-inference", "lambda-calculus", "unification", "type-theory"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1560724022, "post_id": 56622617, "comment_id": 99818986, "body": "Unrelated note: I personally wouldn&#39;t call a type of my own <code>Constraint</code> due to possible confusion with <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/glasgow_exts.html#the-constraint-kind\" rel=\"nofollow noreferrer\">the <code>Constraint</code> kind built in to GHC</a>"}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1560724084, "post_id": 56622617, "comment_id": 99818995, "body": "Oh no! okay I&#39;ll change it. Thank you!"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1560800942, "post_id": 56622617, "comment_id": 99846875, "body": "Aha, you need to indent the definition of <code>isVar</code> inside your <code>HasVars</code> instance. That should fix it."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560801227, "post_id": 56622617, "comment_id": 99846980, "body": "omg it works! finally :) Thank you so so much for your help."}], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560736504, "post_id": 56622956, "comment_id": 99820464, "body": "Everything works right now. Just one small thing. Currently I want to test the unify function from this package, and I declare f = (Term (CVarF 2)) and g = (Term CIntF) and t = (f,g). The signature of unify is very confusing to me. I was wondering if you can show a simple function that just calls unify on t?"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560743421, "post_id": 56622956, "comment_id": 99821491, "body": "It should just be <code>unify [t]</code>... what happens when you try that?"}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560744497, "post_id": 56622956, "comment_id": 99821678, "body": "I get: \u2022 Ambiguous type variables \u2018v0\u2019, \u2018m0\u2019 arising from a use of \u2018unify\u2019       prevents the constraint \u2018(Control.Monad.Error.Class.MonadError                                   (UnifError CTypeF v0) m0)\u2019 from being solved.  so I assume I must type it, but the type signature is very strange so I am lost on what that should be"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560745706, "post_id": 56622956, "comment_id": 99821882, "body": "Ah, okay! That means you&#39;re calling <code>unify</code> correctly, as far as its signature is concerned, but whatever it is that you&#39;re doing with the result of <code>unify</code> is too unconstrained. You need to give GHC more information about what you expect from <code>unify</code>, one way or another. See edited answer."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560798821, "post_id": 56622956, "comment_id": 99846025, "body": "For some reason, unifying [t] gives the wrong answer. It results in &quot;head symbol mismatch 2 =/= int&quot;. i implemented everything mentioned above. Was I supposed to implement anything else? I would have expected the solver to map 2 to int."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560799560, "post_id": 56622956, "comment_id": 99846323, "body": "I would too. Can you update your question with an MCVE? You can&#39;t be missing any required instances, or your program wouldn&#39;t compile; it must be that something was written incorrectly. (I suspect the <code>HasVars</code> instance, but I&#39;d need your code to be sure.)"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560799882, "post_id": 56622956, "comment_id": 99846449, "body": "Oh, and be sure to include which versions of libraries you&#39;re using; it looks like <code>compdata</code>&#39;s API has changed between the 0.1 version you linked and the most recent 0.12 version."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560800034, "post_id": 56622956, "comment_id": 99846504, "body": "Yes, definitely. Updating now!"}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 4, "last_activity_date": 1560745500, "last_edit_date": 1560745500, "creation_date": 1560722780, "answer_id": 56622956, "question_id": 56622617, "link": "https://stackoverflow.com/questions/56622617/finding-the-most-general-unifier-in-haskell-using-data-comp-unification-beginne/56622956#56622956", "title": "Finding the most general unifier in Haskell using Data.Comp.Unification (beginner question)", "body": "<p>I believe you can use that library, but you'll have to make a minor change to your data structure. Specifically, you'll have to rewrite it as a signature functor instead of a recursive data type.</p>\n\n<p>Here's what that means: your <code>CType</code> type is recursive because it contains other instances of <code>CType</code> within one of its constructors (<code>CArr</code>). Rewriting a recursive data type as a signature means making a data type that takes a type parameter, and using that type parameter everywhere you'd use recursion instead. Like this:</p>\n\n<pre><code> data CTypeF a \n      = CVar Int \n      | CArr a a\n      | CInt\n      | CBool\n      deriving (Eq, Data)\n</code></pre>\n\n<p>Now, in your program, where you previously passed around <code>CType</code>s, you'll need to work with something a little more complicated than just <code>CTypeF</code>. Your new <code>CType</code>-equivalent needs to apply <code>CTypeF</code> circularly, to itself. Fortunately, <a href=\"http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Term.html#t:Term\" rel=\"nofollow noreferrer\"><code>Term</code></a> does this for you, so import <code>Data.Comp.Term</code> and replace all your <code>CType</code>s with <code>Term CTypeF</code>s. (You can, of course, always alias <code>type CType = Term CTypeF</code> to save some typing; just be aware that <code>Term CTypeF</code> is not literally the same as your original <code>CType</code>; you'll need to add some <code>Term</code> constructors to places that produce and consume <code>CType</code>s.)</p>\n\n<p>Finally, in order to use the unification machinery in <code>compdata</code>, you'll need an instance of <a href=\"http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Variables.html#t:HasVars\" rel=\"nofollow noreferrer\"><code>HasVars</code></a> for <code>CTypeF</code> that identifies your <code>CVar</code> constructor as a variable. You'll also need to make <code>CTypeF</code> both a <code>Functor</code> and <code>Foldable</code>, but if you enable the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-DeriveFunctor\" rel=\"nofollow noreferrer\"><code>DeriveFunctor</code></a> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-DeriveFoldable\" rel=\"nofollow noreferrer\"><code>DeriveFoldable</code></a> language features, GHC can do this for you\u2014it's a strictly mechanical process.</p>\n\n<hr>\n\n<p>When running <code>unify</code>, you need to make sure you're doing it in a context where the error monad <code>m</code> and the variable type <code>v</code> are unambiguous. There are many ways to do this, but for the sake of example, let's say that we're using the simplest error monad <code>Either e</code> as our <code>m</code>, and of course you'll want <code>v</code> to be <code>Int</code>. So you might write:</p>\n\n<pre><code>f = Term (CVar 2)\ng = Term CInt\n\n-- By matching against Left and Right, we're letting GHC know that unify\n-- should return an Either; this disambiguates `m`\nmain = case unify [(f, g)] of\n  Left _      -&gt; print \"did not unify\"\n  Right subst -&gt; doMoreWork subst\n\n-- The Int here disambiguates `v`\ndoMoreWork :: Subst CTypeF Int -&gt; IO ()\ndoMoreWork subst = undefined -- fill in the blank!\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 1, "accepted_answer_id": 56622956, "answer_count": 1, "score": 5, "last_activity_date": 1560800717, "creation_date": 1560719019, "last_edit_date": 1560800717, "question_id": 56622617, "link": "https://stackoverflow.com/questions/56622617/finding-the-most-general-unifier-in-haskell-using-data-comp-unification-beginne", "title": "Finding the most general unifier in Haskell using Data.Comp.Unification (beginner question)", "body": "<p>I have the following structure in haskell, which implements some machinery for printing and calls the unifier. I get the following error from main:</p>\n\n<pre><code>0 =/= int\n</code></pre>\n\n<p>It seems to think that 0 is a number rather than a variable. Below is the full implementation.</p>\n\n<pre><code> data CType \n      = CVar Int \n      | CArr CType CType\n      | CInt\n      | CBool\n      deriving (Eq, Data)\n\ndata Constraint \n  = Equality CType CType\n    deriving (Eq, Data)\n</code></pre>\n\n<p>I have some base types (int and bool), an arrow type, and type variables. \nThen I am running some algorithms that generate equality constraints which are represented in the way above. </p>\n\n<p>My goal is that given a list of constraints, I want to find the most general unifier. </p>\n\n<p>I came across this library: <a href=\"http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Unification.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/compdata-0.1/docs/Data-Comp-Unification.html</a></p>\n\n<p>Since I am new to Haskell, I can't immediately figure out if I can directly apply it. Could I use this library or am I recommended to write the unifier from scratch?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I am currently making the following changes to the code, but am getting a unification error for the equation </p>\n\n<blockquote>\n  <p>f=g</p>\n</blockquote>\n\n<pre><code>module SolveEq where\nimport Data.Data\nimport Data.Void\nimport Data.List as List\nimport Data.Map as Map\nimport Data.Set as Set\nimport Data.Maybe (fromJust)\nimport Data.Maybe (isJust)\nimport Control.Monad\nimport TypeCheck\nimport Data.Comp.Variables\nimport Data.Comp.Unification\nimport Data.Comp.Term\nimport Data.Comp.Derive\nimport Constraint\nimport Lang\n\ndata CTypeF a \n    = CVarF Int \n    | CArrF a a\n    | CIntF\n    | CBoolF\n    deriving (Data, Functor, Foldable, Traversable, Show, Eq)\n\n$(makeShowF ''CTypeF)\n\n\nexample :: String\nexample = showF (CIntF :: CTypeF String)\n\ninstance HasVars CTypeF Int where\nisVar (CVarF x) = Just x\nisVar (CArrF x y) = Nothing\nisVar CIntF = Nothing\nisVar CBoolF = Nothing\n\ntype CType_ = Term CTypeF\n\nf :: CType_\nf = Term (CVarF 0)\n\ng :: CType_\ng = Term CIntF\n\n\nunravel :: CType_ -&gt; CType\nunravel a = \n    case unTerm a of \n        CVarF i -&gt; CVar i\n        CArrF a b -&gt; CArr (unravel a) (unravel b)\n        CIntF -&gt; CInt\n        CBoolF -&gt; CBool\n\ngetUnify :: Either (UnifError CTypeF Int) (Subst CTypeF Int)\ngetUnify = unify [(f,g)]\n\nmain = case getUnify of\n  Left (FailedOccursCheck v term)     -&gt; putStrLn (\"failed occurs check \" ++ show v ++ \": \" ++ (show $ unravel term))\n  Left (HeadSymbolMismatch t1 t2)     -&gt; putStrLn (\"head symbol mismatch \" ++ show (unravel t1)  ++ \" =/= \" ++ (show $ unravel t2))\n  Left (UnifError str)     -&gt; putStrLn str\n  Right (subst :: Subst CTypeF Int) -&gt; print (fmap unravel subst)\n</code></pre>\n\n<p>The issue is in <code>unify [(f,g)]</code> which I would have expected to map 0 to Int. But it seems to not see that 0 is a variable. Is there something wrong with my isVar possibly?</p>\n\n<p>Note: I am running with compdata-0.12</p>\n"}, {"tags": ["haskell", "ghc", "arrows", "category-abstractions"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562147262, "post_id": 56620644, "comment_id": 100283452, "body": "Have you found anything suitable in the meantime, or an alternative approach? In case I haven&#39;t made it clear enough yet: I&#39;m very interested in this too, both the category stuff in general but also the music application in particular. If I can help in some way, don&#39;t hesitate to tap me on Github. Maybe we can fork <code>constrained-categories</code> if it helps."}, {"owner": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562683173, "post_id": 56620644, "comment_id": 100448434, "body": "@leftaroundabout I&#39;ve been working on this a bit on and off. The biggest issue for me so far has been getting a nice type class hierarchy for different kinds of monoidal categories. To be completely general, I want to have a category typeclass like <a href=\"https://github.com/idris-lang/Idris-dev/issues/4736\" rel=\"nofollow noreferrer\">this</a>, which I don&#39;t think is very easy to accomplish in Haskell without a ton of compiler extensions."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562688870, "post_id": 56620644, "comment_id": 100451834, "body": "<a href=\"https://gist.github.com/leftaroundabout/746cfa44fdf1a79a645507e66780eba3\" rel=\"nofollow noreferrer\">gist.github.com/leftaroundabout/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "edited": false, "score": 0, "creation_date": 1560707129, "post_id": 56620997, "comment_id": 99815355, "body": "I&#39;m currently working on a library for preforming various transformations (e.x. translations, transpositions, retrograde inversion, etc...) on abstract representations of musical scores. I haven&#39;t settled on the data type to use for this yet, but I&#39;m pretty sure I need something more general than <code>(,)</code>. Or at least I think it would be nicer with something more general. (I&#39;m thinking of using some variation on sized vectors of this, since e.x. I need to keep track on how many lines there are in a score, and I would like to be able to express this at the type level)"}, {"owner": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "edited": false, "score": 0, "creation_date": 1560707385, "post_id": 56620997, "comment_id": 99815412, "body": "So, I think <code>(,)</code> actually would work for my particular application, in that <code>a</code> is isomorphic to <code>Vec 1 a</code>, <code>(a,a)</code> is isomorphic to <code>Vec 2 a</code>, <code>((a,a),a)</code> isomorphic to <code>Vec 3 a</code> and so on. But this doesn&#39;t seem as clean as using typed vectors, and I&#39;d also like to potentially consider other monoidal categories in the future."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "edited": false, "score": 0, "creation_date": 1560708217, "post_id": 56620997, "comment_id": 99815623, "body": "Yeah. The reason I stayed with <code>(,)</code> in constrained-categories is that <b>a)</b> in many interesting categories, this can indeed be used just fine (I suspect this could somehow be explained with the Yoneda lemma) and <b>b)</b> it helps type inference. But yeah, proper associativity of the tensor product would certainly be nice conceptually; it would actually make type inference more difficult though."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1560705169, "creation_date": 1560705169, "answer_id": 56620997, "question_id": 56620644, "link": "https://stackoverflow.com/questions/56620644/generalized-arrows-and-proc-notation/56620997#56620997", "title": "&quot;Generalized arrows&quot; and proc notation?", "body": "<p>I've wondered about that before, too. But \u2013 <code>proc</code> notation is so widely considered a silly oddball that there's probably not much interest in generalisation either (though I daresay this is what would make it actually useful!)</p>\n\n<p>However, it's actually not <em>necessary</em> to have special syntax. The primary reference that must be named here is Conal Elliott's work on <a href=\"http://conal.net/blog/posts/overloading-lambda\" rel=\"noreferrer\">compiling lambda notation to bicartesian closed categories</a>. Which I thought would have caught on in the Haskell community some time by now, but somehow hasn't. It is available as a GHC plugin, at any rate.</p>\n\n<p>Even that isn't always needed. For some category combinators, you can just wrap a value that's universally quantified in the argument, and treat that as a pseudo-return-value. I call those <a href=\"http://hackage.haskell.org/package/constrained-categories-0.4.0.0/docs/Control-Category-Constrained.html#t:HasAgent\" rel=\"noreferrer\"><code>Agent</code> in constrained-categories</a>; not sure if that's usable for your application, at any rate several things you'd do with arrow-like categories <a href=\"http://hackage.haskell.org/package/constrained-categories-0.4.0.0/docs/Control-Arrow-Constrained.html#g:6\" rel=\"noreferrer\">can be done</a>. (In constrained-categories, the tensor product is fixed to <code>(,)</code>, however, so probably not what you want. Although, could you explain what tensor product you need?)</p>\n"}], "owner": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 3, "answer_count": 1, "score": 12, "last_activity_date": 1561019652, "creation_date": 1560702034, "last_edit_date": 1560710444, "question_id": 56620644, "link": "https://stackoverflow.com/questions/56620644/generalized-arrows-and-proc-notation", "title": "&quot;Generalized arrows&quot; and proc notation?", "body": "<p>When learning about <code>Control.Arrow</code> and Haskell's built-in <code>proc</code> notation, I had the idea that this language might prove very useful as an eDSL for general monoidal categories (using <code>***</code> for tensor and <code>&gt;&gt;&gt;</code> for composition), if only the <code>Arrow</code> typeclass were generalized to allow a general <code>tens :: * -&gt; * -&gt; *</code> operation rather than <code>Arrow</code>'s <code>(,) : * -&gt; * -&gt; *</code>.</p>\n\n<p>After doing some research, I found <a href=\"http://www.megacz.com/berkeley/garrows/\" rel=\"noreferrer\"><code>GArrows</code></a>, which seem to fit my needs. However, the linked <code>Garrow</code> typeclass comes bundled with the so-called \"HetMet\" GHC extensions, and support for other features that (for the time being, anyway), I don't have much use for, such as \"modal types\".</p>\n\n<p>Given that I would like to be able to use such a <code>GArrow</code> typeclass without having to install non-standard GHC extensions:</p>\n\n<ol>\n<li><p>Is there an actual (somewhat standardized) library on Hackage that meets my needs for such a generalized arrow typeclass?</p></li>\n<li><p>Given such a library, is there any way to use such a <code>GArrow</code> type class with a \"generalized <code>proc</code>\" notation without having to cook up my own GHC extension? (With <code>RebindableSyntax</code> perhaps?)</p></li>\n</ol>\n\n<p>Note: Also, I'm fine with using quasiquotation for a generalized <code>proc</code> notation. So perhaps it wouldn't be too difficult to modify something like <a href=\"https://github.com/pepeiborra/arrowp\" rel=\"noreferrer\">this</a> to suit my needs.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1560696168, "post_id": 56619840, "comment_id": 99812817, "body": "there is no (sensible) way to take a type <code>IO a</code> as input and output a non-<code>IO</code> type. Your <code>totalLoss</code> doesn&#39;t involve <code>IO</code> however - it just takes a list of <code>Item</code>s and outputs a <code>Float</code>, so give it an appropriate type signature and it should work fine. (As a general rules, you should never use <code>IO</code> unless you have to - that is, when you have to interact with the world outside your program.)"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1560696305, "post_id": 56619840, "comment_id": 99812843, "body": "Well, I have to use IO because of Time calculation and loading a CSV. The list of <code>Item</code>s I get is IO [Item] so there is no way around it..."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1560696533, "post_id": 56619840, "comment_id": 99812901, "body": "I think you misunderstand. Your program as a whole might well need to use IO to obtain the data it applies this function to. But the function itself should be kept &quot;pure&quot; (that is, not involving IO) where at all possible. And as I said, you&#39;ve already written a perfectly good &quot;pure&quot; function in <code>totalLoss</code>, of type <code>[Item] -&gt; Float</code>, the only reason the compiler doesn&#39;t like it is because you gave it the wrong type signature. In another part of your code, you can use the <code>&gt;&gt;=</code> operator, or a <code>do</code> block, to get a list of <code>Item</code>s from an IO action and feed it to this function."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1560699316, "creation_date": 1560699316, "answer_id": 56620290, "question_id": 56619840, "link": "https://stackoverflow.com/questions/56619840/apply-function-to-list-of-custom-data-structure/56620290#56620290", "title": "Apply function to list of custom data structure", "body": "<p><code>totalLoss</code> is a pure function, so change its type accordingly:</p>\n\n<pre><code>totalLoss :: [Item] -&gt; Float\ntotalLoss items = sum $ map loss items\n</code></pre>\n\n<p>The fundamental issue of this question seems to be that the list of items originate from an impure source (which is a perfectly natural thing).</p>\n\n<p>Write as much of your code as pure functions, and then compose those pure functions with impure input in (or as close as possible to) the <code>main</code> function:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  items &lt;- ioItems -- :: IO [Item]\n  print $ totalLoss items\n</code></pre>\n\n<p>As implied by the comment, <code>ioItems</code> has the type <code>IO [Item]</code>, but you can compose <code>totalLoss</code> with <code>items</code> via <code>do</code> notation.</p>\n\n<p>If you don't want to rely on <code>do</code> notation, you can also compose your functions without that syntactic sugar:</p>\n\n<pre><code>main :: IO ()\nmain = fmap totalLoss ioItems &gt;&gt;= print\n</code></pre>\n\n<p>These two variations of <code>main</code> are equivalent.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1560699321, "creation_date": 1560699321, "answer_id": 56620293, "question_id": 56619840, "link": "https://stackoverflow.com/questions/56619840/apply-function-to-list-of-custom-data-structure/56620293#56620293", "title": "Apply function to list of custom data structure", "body": "<p>Change the type of <code>totalLoss</code> to <code>[Item] -&gt; Float</code>, then use <code>fmap</code> to apply the function to a value of type <code>IO [Item]</code>:</p>\n\n<pre><code>totalLoss :: [Item] -&gt; Float\ntotalLoss items = sum $ map loss items\n\nloss :: Item -&gt; Float\nloss x = (price x) * fromIntegral (stock x)\n\n-- fmap totalLoss :: Functor f =&gt; f [Item] -&gt; f Float\n-- so if you have a value of v :: IO [Item], then\n-- fmap totalLoss v :: IO Float\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 56620290, "answer_count": 2, "score": 2, "last_activity_date": 1560699347, "creation_date": 1560696006, "last_edit_date": 1560699347, "question_id": 56619840, "link": "https://stackoverflow.com/questions/56619840/apply-function-to-list-of-custom-data-structure", "title": "Apply function to list of custom data structure", "body": "<p>Deriving from my previous Question: <a href=\"https://stackoverflow.com/q/56618951/8339179\">Calculation difference between Days</a>\nI wan't to apply a function to a list of my custom data structure <code>Item</code>. The problem is I still do not get it how to handle <code>IO</code> proper, so here is my code:</p>\n\n<pre><code>data Item = Item\n    { name :: String\n    , expire :: Day\n    , stock :: Integer\n    , price :: Float\n    } deriving (Show)\n\ntotalLoss :: IO [Item] -&gt; Float\ntotalLoss items = sum $ map loss items\n\nloss :: Item -&gt; Float\nloss x = (price x) * fromIntegral (stock x)\n</code></pre>\n\n<p>Let's just say, that I am not able to get just <code>[Item]</code> so I have to handle the <code>IO</code> proper. But whatever I do I still get these errors:</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018[IO Item]\u2019\n                  with actual type \u2018IO [Item]\u2019\n    \u2022 In the second argument of \u2018map\u2019, namely \u2018items\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018map loss items\u2019\n      In the expression: sum $ map loss items\n   |\n48 | totalLoss items = sum $ map loss items\n   |                                  ^^^^^\n</code></pre>\n\n<p>With <code>loss :: IO Item -&gt; Float</code> it's the same error and with <code>loss :: IO [Item] -&gt; Float</code> I get an other error.</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018[IO [Item]]\u2019\n                  with actual type \u2018IO [Item]\u2019\n    \u2022 In the second argument of \u2018map\u2019, namely \u2018items\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018map loss items\u2019\n      In the expression: sum $ map loss items\n   |\n48 | totalLoss items = sum $ map loss items\n   |                                  ^^^^^\n</code></pre>\n\n<p>How on Earth am I supposed to solve this?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1560695125, "post_id": 56619698, "comment_id": 99812562, "body": "<code>I expect it to show an error, but it only gives an error.</code> I have no idea what you mean here. Do you get an error when compiling this, or at run time? Or does it run without error but do something unexpected?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4284057"}, "edited": false, "score": 0, "creation_date": 1560695400, "post_id": 56619720, "comment_id": 99812618, "body": "Brilliant! Thank you! Any insight as to why a separate do-block is needed for this part. An explanation with respect to functional programming would be nice."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1560695899, "post_id": 56619720, "comment_id": 99812757, "body": "You could even move the <code>putStrLn</code> out of the <code>if</code> block"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1560696647, "last_edit_date": 1560696647, "creation_date": 1560695098, "answer_id": 56619720, "question_id": 56619698, "link": "https://stackoverflow.com/questions/56619698/getting-putstrln-to-work-inside-an-if-else-block/56619720#56619720", "title": "Getting putStrLn to work inside an if-else block", "body": "<p>If you write both a <code>putStrLn \"this is not a word!\"</code> and a <code>main</code>, you should use a <code>do</code> block here:</p>\n\n<pre><code>main = do\n    putStrLn &quot;Hey there, What's up! ENTER WORD TO CHECK PALINDROME!&quot;\n    word &lt;- getLine\n    if null word\n        then <b>do</b>\n            putStrLn &quot;This is not a word!&quot;\n            main    \n    else do\n        putStrLn  $ show $ checkPalindrome word\n        main</code></pre>\n\n<p>That being said, you can simplify the above by making a call at the bottom of the <code>do</code> block of the <code>main</code>:</p>\n\n<pre><code>main = do\n    putStrLn &quot;Hey there, What's up! ENTER WORD TO CHECK PALINDROME!&quot;\n    word &lt;- getLine\n    if null word\n        then putStrLn &quot;This is not a word!&quot;\n        else putStrLn  $ show $ checkPalindrome word\n    <b>main</b></code></pre>\n\n<p>or we can, like <a href=\"https://stackoverflow.com/questions/56619698/getting-putstrln-to-work-inside-an-if-else-block/56619720#comment99812757_56619720\">@Bergi says</a>, even put more in the <code>main</code> block, like:</p>\n\n<pre><code>main = do\n    putStrLn &quot;Hey there, What's up! ENTER WORD TO CHECK PALINDROME!&quot;\n    word &lt;- getLine\n    <b>putStrLn $</b> if null word\n        then &quot;This is not a word!&quot;\n        else show $ checkPalindrome word\n    main</code></pre>\n\n<p>If you write this without <code>do</code> block, Haskell aims to parse <code>putStrLn \"This is not a word!\" main</code>. This thus means that <code>putStrLn</code> is supposed to have type <code>String -&gt; IO a -&gt; IO a</code>, but that is not the case.</p>\n\n<p>By using a <code>do</code> block, Haskell will <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#dx8-47001\" rel=\"nofollow noreferrer\">desugar the do block [Haskell'10 report]</a> into <code>putStrLn \"This is not a word!\" &gt;&gt; main</code>, and this is sound (at least for the type system). Since the bind operator has type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-62--62-\" rel=\"nofollow noreferrer\"><strong><code>(&gt;&gt;) :: Monad m =&gt; m a -&gt; m b -&gt; m b</code></strong></a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4284057"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56619720, "answer_count": 1, "score": 2, "last_activity_date": 1560696647, "creation_date": 1560694912, "last_edit_date": 1560694936, "question_id": 56619698, "link": "https://stackoverflow.com/questions/56619698/getting-putstrln-to-work-inside-an-if-else-block", "title": "Getting putStrLn to work inside an if-else block", "body": "<p>I am writing a palindrome solution in Haskell, and I want the function to show an error if a null is entered. I do not want to use the error function as that halts the program. Hence, I want to show an error message using putStrLn and continue the loop. </p>\n\n<p>I have tried using show to change the input given to the putStrLn but it doesn't work and throws compile time type-error.</p>\n\n<pre><code>main = do\n    putStrLn \"Hey there, What's up! ENTER WORD TO CHECK PALINDROME!\"\n    word &lt;- getLine\n    if null word\n        then\n            -- putStrLn \"This is not a word!\"\n            main    \n    else do\n        putStrLn  $ show  $ checkPalindrome word\n        main\n</code></pre>\n\n<p>checkPalindrome w = if reverse w == w then True else False</p>\n\n<p>I expect it to show an error, but it only gives an error. What are possible solutions to show a halt-safe error?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1560689862, "last_edit_date": 1560689862, "creation_date": 1560689553, "answer_id": 56619018, "question_id": 56618993, "link": "https://stackoverflow.com/questions/56618993/trying-to-use-newtype-to-pass-off-existing-data-type-as-my-own/56619018#56619018", "title": "Trying to use newtype to pass off existing data type as my own", "body": "<p>You actually did not create a <code>newtype</code> to wrap the <code>Seq a</code> into, you constructed a type <code>MyQueue a</code> that has a <em>data constructor</em> <code>Seq</code> that takes an <code>a</code>. So it can basically store anything.</p>\n\n<p>You likely want to define a <code>MyQueue</code> data constructor that contains a <code>Seq a</code>, like:</p>\n\n<pre><code>newtype MyQueue a = <b>MyQueue (</b>Seq a<b>)</b></code></pre>\n\n<p>Then you can define your <code>empty</code> as:</p>\n\n<pre><code>empty :: <i>MyQueue</i> a\nempty = <b>MyQueue</b> Data.Sequence.empty</code></pre>\n\n<p>Note that the <code>MyQueue</code> in <strong>boldface</strong> is the data <em>constructor</em> whereas the <code>MyQueue</code> after the <code>::</code> is the <em>type constructor</em>.</p>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 56619018, "answer_count": 1, "score": 2, "last_activity_date": 1560689862, "creation_date": 1560689361, "question_id": 56618993, "link": "https://stackoverflow.com/questions/56618993/trying-to-use-newtype-to-pass-off-existing-data-type-as-my-own", "title": "Trying to use newtype to pass off existing data type as my own", "body": "<p>I'm trying to wrap up a <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">Data.Sequence</a> in my own <code>newtype</code> in order to hide unnecessary features.</p>\n\n<p>MyQueue.hs (some parts ommitted):</p>\n\n<pre><code>00 import Data.Sequence\n\n10 newtype MyQueue a = Seq a\n\n23 empty :: MyQueue a\n24 empty = Data.Sequence.empty\n</code></pre>\n\n<p>I get the following error. It appears that I cannot return a <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html#t:Seq\" rel=\"nofollow noreferrer\">Seq</a> type and pass it off as my own type. But then how do I map my own functions to those in Data.Sequence?</p>\n\n<pre><code>MyQueue.hs:24:9: error:\n    \u2022 Couldn't match expected type \u2018MyQueue a\u2019\n                  with actual type \u2018Seq a4\u2019\n    \u2022 In the expression: Data.Sequence.empty\n      In an equation for \u2018empty\u2019: empty = Data.Sequence.empty\n    \u2022 Relevant bindings include\n        empty :: MyQueue a (bound at MyQueue.hs:24:1)\n</code></pre>\n"}, {"tags": ["csv", "haskell", "time"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560689024, "post_id": 56618951, "comment_id": 99811205, "body": "Don&#39;t use <code>do</code>... This is used for monadic calculations. Only in <i>some</i> limited cases you should use <code>do</code>."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560689052, "post_id": 56618951, "comment_id": 99811211, "body": "How would I do this without do?"}], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560692946, "post_id": 56619126, "comment_id": 99812053, "body": "Well I got some errors, which I could handle, but this one I can&#39;t:      \u2022 Couldn&#39;t match expected type \u2018Day -&gt; Integer\u2019                   with actual type \u2018Integer\u2019  Which is from     | 54 | analyseItems today = filter ((0 &gt;) . daysAway today . expire)    |                                      ^^^^^^^^^^^^^^"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 1, "creation_date": 1560692997, "post_id": 56619126, "comment_id": 99812064, "body": "@Biskit1943: sorry, the type of <code>daysAway</code> should be <code>daysAway :: Day -&gt; Day -&gt; Integer</code>."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560700505, "post_id": 56619126, "comment_id": 99813848, "body": "Just one more question, how does this <code>fmap (flip analyseItems items) today</code> work? I&#39;d like to be able write another function which takes also a parameter <code>n</code> for the max. days which an item can be away from the expired date. Like n = 5 =&gt; All items which will expire in 5 Days."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560701013, "post_id": 56619126, "comment_id": 99813965, "body": "<code>today</code> will return the current day, so by using <code>fmap</code> we call <code>analyzeItems thatday items</code>, that will than process the list of days. You could preprocess the day, like <code>fmap (flip analyseItems items . addDays 5)</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1560692978, "last_edit_date": 1560692978, "creation_date": 1560690473, "answer_id": 56619126, "question_id": 56618951, "link": "https://stackoverflow.com/questions/56618951/calculation-difference-between-days/56619126#56619126", "title": "Calculation difference between Days", "body": "<p>A common mistake is to use <code>do</code> in functions that have no monadic context. It is one of the reasons why <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow noreferrer\"><em><code>do</code> notation is considered harmful</em> [Haskell-wiki]</a>. <code>do</code> expressions are in fact <em>syntactical sugar</em>. The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">Haskell report</a> describes how to \"<em>desugar</em>\" these.</p>\n\n<p>For functions like <code>listToItem :: [String] -&gt; Item</code>, you should not use <code>do</code> notation. This will not work, especially since <code>Item</code> is not a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Monad\" rel=\"nofollow noreferrer\"><strong><code>Monad</code></strong></a> type.</p>\n\n<p>We can for example implement <code>listToItem</code> as:</p>\n\n<pre><code>listToItem :: [String] -&gt; Item\nlistToItem [] = error &quot;Empty List&quot;\nlistToItem [n, e, s, p] = <b>Item (read n) (parseDate e) (read s) (read p)</b>\nlistToItem _  = error &quot;To few/much Arguments&quot;</code></pre>\n\n<p>In order to calculate the <code>daysAway</code>, it might be better to make this a pure function, and calculate the difference with a <code>Day</code> parameter:</p>\n\n<pre><code>daysAway :: Day -&gt; Day -&gt; Integer\ndaysAway = flip diffDays</code></pre>\n\n<p>The <code>analyseItems</code> then can just <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><strong><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> the items on the <code>daysAway</code>:</p>\n\n<pre><code>analyseItems :: Day -&gt; [Item] -&gt; [Item]\nanalyseItems today = filter (<b>(0 &gt;) . daysAway today . expire</b>)</code></pre>\n\n<p>Here we thus can obtain a list of <code>Item</code>s that are expired at a given <code>Day</code>. We do not need the <code>getExpired</code> function here at all, or use recursion to filter.</p>\n\n<p>We can <code>transform</code> a list of rows to <code>Item</code>s with a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><strong><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code></strong></a>:</p>\n\n<pre><code>transform :: [[String]] -&gt; [Item]\ntransform = <b>map</b> listToItem</code></pre>\n\n<p>Now we can make an <code>IO Item</code> to obtain the expired items like:</p>\n\n<pre><code>getExpired :: [Item] -&gt; IO [Item]\ngetExpired items = fmap (flip analyseItems items) today</code></pre>\n\n<p>I leave parsing the csv file, processing it through <code>transform</code>, and then filtering it with <code>getExpired</code> as an exercise.</p>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 56619126, "answer_count": 1, "score": 1, "last_activity_date": 1560692978, "creation_date": 1560688970, "question_id": 56618951, "link": "https://stackoverflow.com/questions/56618951/calculation-difference-between-days", "title": "Calculation difference between Days", "body": "<p>I can't get my head around this. I have the following Code:</p>\n\n<pre><code>module Lib\n    ( csvFile\n    , analyse\n    ) where\n\nimport Text.ParserCombinators.Parsec\nimport Data.Time\nimport Data.Time.Calendar\nimport qualified Data.Map as Map\n\ndata Item = Item\n    { name :: String\n    , expire :: Day\n    , stock :: Integer\n    , price :: Float\n    } deriving (Show)\n\n\ncsvFile = endBy line eol\nline = sepBy cell (char ';')\ncell = quotedCell &lt;|&gt; many (noneOf \";\\n\\r\")\n\nquotedCell =\n    do char '\"'\n       content &lt;- many quotedChar\n       char '\"' &lt;?&gt; \"quote at end of cell\"\n       return content\n\nquotedChar =\n        noneOf \"\\\"\"\n    &lt;|&gt; try (string \"\\\"\\\"\" &gt;&gt; return '\"')\n\neol =   try (string \"\\n\\r\")\n    &lt;|&gt; try (string \"\\r\\n\")\n    &lt;|&gt; string \"\\n\"\n    &lt;|&gt; string \"\\r\"\n    &lt;?&gt; \"end of line\"\n\nparseDate :: String -&gt; Day\nparseDate dateString = parseTimeOrError True defaultTimeLocale \"(%Y,%-m,%-d)\" dateString :: Day\n\nanalyse :: [[String]] -&gt; [Item]\nanalyse csvData = do\n    let items = transform h t\n    analyseItems items\n        where\n           h = head csvData\n           t = tail csvData\n\nlistToItem :: [String] -&gt; Item\nlistToItem [] = error \"Empty List\"\nlistToItem [n, e, s, p] = do\n    let name = n\n    let expires = parseDate e\n    let stock = read s :: Integer\n    let price = read p :: Float\n    Item name expires stock price\nlistToItem _  = error \"To few/much Arguments\"\n\ntransform :: [String] -&gt; [[String]] -&gt; [Item]\ntransform line [] = do\n    let items = []\n    let item = listToItem line\n    item : items\ntransform line csvData = do\n    let item = listToItem line\n    item : (transform h t)\n    where\n       h = head csvData\n       t = tail csvData\n\nanalyseItems :: [Item] -&gt; [Item]\nanalyseItems items = do\n    --let sale = getOnSale items\n    getExpired (head items) (tail items)\n\ntoday :: IO Day\ntoday = fmap utctDay getCurrentTime\n\ndaysAway :: Day -&gt; IO Integer\ndaysAway day = fmap (diffDays day) today\n\ngetExpired :: item -&gt; [Item] -&gt; [Item]\ngetExpired item [] = do\n    diff &lt;- daysAway (expire item)\n    case compare diff 0 of\n        LT -&gt; item : []\n        GT -&gt; []\n        EQ -&gt; []\ngetExpired item items = do\n    diff &lt;- daysAway (expire item)\n    case compare diff 0 of\n        LT -&gt; item : getExpired h t\n        GT -&gt; getExpired h t\n        EQ -&gt; getExpired h t\n    where\n        h = head items\n        t = tail items\n</code></pre>\n\n<p>Which I use to read values from a CSV File, where one Value is a Day. I already managed to get these working until I have to compute the difference of today to the day the Item will expire. I don't know how to compute the Day. The Error I get is the following:</p>\n\n<pre><code>/home/max/Documents/haskell/Hausaufgabe_02/analysis/src/Lib.hs:85:13: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018[]\u2019\n      Expected type: [Integer]\n        Actual type: IO Integer\n    \u2022 In a stmt of a 'do' block: diff &lt;- daysAway (expire item)\n      In the expression:\n        do diff &lt;- daysAway (expire item)\n           case compare diff 0 of\n             LT -&gt; item : []\n             GT -&gt; []\n             EQ -&gt; []\n      In an equation for \u2018getExpired\u2019:\n          getExpired item []\n            = do diff &lt;- daysAway (expire item)\n                 case compare diff 0 of\n                   LT -&gt; item : ...\n                   GT -&gt; ...\n                   EQ -&gt; ...\n   |\n85 |     diff &lt;- daysAway (expire item)\n   |             ^^^^^^^^^^^^^^^^^^^^^^\n\n/home/max/Documents/haskell/Hausaufgabe_02/analysis/src/Lib.hs:91:13: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018[]\u2019\n      Expected type: [Integer]\n        Actual type: IO Integer\n    \u2022 In a stmt of a 'do' block: diff &lt;- daysAway (expire item)\n      In the expression:\n        do diff &lt;- daysAway (expire item)\n           case compare diff 0 of\n             LT -&gt; item : getExpired h t\n             GT -&gt; getExpired h t\n             EQ -&gt; getExpired h t\n      In an equation for \u2018getExpired\u2019:\n          getExpired item items\n            = do diff &lt;- daysAway (expire item)\n                 case compare diff 0 of\n                   LT -&gt; item : getExpired h t\n                   GT -&gt; getExpired h t\n                   EQ -&gt; getExpired h t\n            where\n                h = head items\n                t = tail items\n   |\n91 |     diff &lt;- daysAway (expire item)\n   |             ^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Any help is welcome, as I have to finish this homework till Midnight today...</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1560672487, "creation_date": 1560672487, "answer_id": 56617156, "question_id": 56617094, "link": "https://stackoverflow.com/questions/56617094/traversal-lens-with-a-monad-side-effect/56617156#56617156", "title": "Traversal/lens with a monad side effect", "body": "<pre><code>type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>So, really, just</p>\n\n<pre><code>mydata &amp; mytraversal f\n</code></pre>\n\n<p>should do. If you want an operator, it's called <a href=\"https://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Operators.html#v:-37--37--126-\" rel=\"nofollow noreferrer\"><code>(%%~)</code></a>.</p>\n\n<pre><code>mydata &amp; mytraversal %%~ f\n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 5440167, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e384a22ee7c87006ae3d29082aa5ecb?s=128&d=identicon&r=PG&f=1", "display_name": "Philipp Middendorf", "link": "https://stackoverflow.com/users/5440167/philipp-middendorf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 0, "accepted_answer_id": 56617156, "answer_count": 1, "score": 1, "last_activity_date": 1560672487, "creation_date": 1560671769, "question_id": 56617094, "link": "https://stackoverflow.com/questions/56617094/traversal-lens-with-a-monad-side-effect", "title": "Traversal/lens with a monad side effect", "body": "<p>I have a traversal <code>mytraversal</code> and a function <code>f: a -&gt; a</code> that I can use as follows: <code>mydata &amp; mytraversal %~ f</code>.</p>\n\n<p>However, what do I  use if I instead have <code>f: a -&gt; m a</code> for a monad <code>m</code>? In my case, it's a state monad, and I want to modify items of a structure, modifying the current state.</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "map-function", "arity"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1560684630, "post_id": 56615933, "comment_id": 99810273, "body": "Just a comment and not an answer to your question: you mention adding a vector to a point (which makes sense) and then wrote a movePoint function that adds points to points.  I know that Vector and Point are both pairs of Ints, but you&#39;d still be better off defining a different data type for Vector and then writing movePoint :: Point -&gt; Vector -&gt; Point."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1560789917, "post_id": 56615933, "comment_id": 99842471, "body": "This may just be a typo, but your data declaration needs a constructor. So <code>data Point = Point {xCoord :: Int, yCoord :: Int}</code>"}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 8, "last_activity_date": 1560658461, "creation_date": 1560658461, "answer_id": 56616025, "question_id": 56615933, "link": "https://stackoverflow.com/questions/56615933/how-to-use-map-in-haskell-with-a-variable-and-a-list/56616025#56616025", "title": "How to use map in Haskell with a variable and a list", "body": "<p>Partially apply the <code>movePoint</code> function (i.e., call it with fewer arguments than it needs), like this:</p>\n\n<pre><code>movePoints pts vec = map (movePoint vec) pts\n</code></pre>\n\n<p>Doing so creates a new function that only needs one argument, the one that you didn't provide the first time. This is known as currying.</p>\n"}], "owner": {"reputation": 99, "user_id": 10574455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hWckfr1RTX4/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCgUP9w8pfsX4hIhXOB8A1fB1-Q_Q/mo/photo.jpg?sz=128", "display_name": "James Morgson", "link": "https://stackoverflow.com/users/10574455/james-morgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 819, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560676222, "creation_date": 1560657275, "last_edit_date": 1560676222, "question_id": 56615933, "link": "https://stackoverflow.com/questions/56615933/how-to-use-map-in-haskell-with-a-variable-and-a-list", "title": "How to use map in Haskell with a variable and a list", "body": "<p>I'm planning to write am map function which essentially takes in a variable and a list and returns a list.</p>\n\n<p>I've tried to use standard map but from what I've seen it's in the format \"map function list\" when here I'm trying to pass in another argument which is another point.</p>\n\n<pre><code>data Point = {xCoord :: Int,\n              yCoord :: Int}\n\nmovePoint :: Point -&gt; Point -&gt; Point\nmovePoint (Point x y) (Point xMove yMove)\n    = Point (x + xMove)  (y + yMove)\n\n // Add a \"vector\" to a list of points\nmovePoints :: [Point] -&gt; Point -&gt; [Point]\nmovePoints = error \"Not yet\"\n</code></pre>\n\n<p>For example, if I have a vector for example (2,2) and I have a list of Points such as [(-2,1),(0,0), (5,4) etc.] I want to use map to add (2,2) to all the Points in the list and return a list of points, I'm not sure how to do it. I'm a newbie when it comes to Haskell so any tips would be great.</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560660564, "post_id": 56615863, "comment_id": 99806392, "body": "Sounds like a <code>traverse</code> (in the list applicative) to me."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1560671802, "post_id": 56615863, "comment_id": 99807964, "body": "If <code>x</code> matches the pattern, your possible values are <code>[f1 x, f2 x]</code>; if it doesn&#39;t, they are <code>[x]</code>.  Can you compute the list <code>[[c1], [f1 c2, f2 c2], [c3]]</code> (e.g. in your first example where only <code>c2</code> matches)?  Can you clearly state what remains to be done from here?"}], "answers": [{"tags": [], "owner": {"reputation": 725, "user_id": 5309823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y9956.png?s=128&g=1", "display_name": "cole", "link": "https://stackoverflow.com/users/5309823/cole"}, "is_accepted": false, "score": 1, "last_activity_date": 1560679587, "creation_date": 1560679587, "answer_id": 56617828, "question_id": 56615863, "link": "https://stackoverflow.com/questions/56615863/building-an-exponentially-sized-list-in-haskell/56617828#56617828", "title": "Building an exponentially sized list in haskell", "body": "<p>My approach would be to</p>\n\n<ol>\n<li>Solve the problem for the element in the list you're currently looking at (<code>x</code> or <code>my_pattern</code>). This means generating one or more new lists.</li>\n<li>Solve the problem for the rest of the list (<code>xs</code>). This will give you back a list of lists (<code>[[C]]</code>).</li>\n<li>Combine the two solutions. If you have multiple lists generated from step 1, each of these lists (<code>[C]</code>) will combine with each list (also <code>[C]</code>) in the list of lists (<code>[[C]]</code>) from step 2.</li>\n</ol>\n\n<p>I have two possible approaches.</p>\n\n<p>It isn't clear to me how much help you are looking for, so I've left my answers somewhat \"spoiler free.\" Ask for clarification or more details if you need it.</p>\n\n<h1>List comprehension</h1>\n\n<p>Without delving into the weeds of the <code>Applicative</code> or <code>Traversable</code> typeclasses, you can accomplish what you want with a list comprehension.</p>\n\n<p>Let's consider the case where your pattern is matched. I would write a list comprehension as follows:</p>\n\n<pre><code>[ x ++ y | x &lt;- _, y &lt;- _] :: [[C]]\n-- this means\n-- x :: [C]\n-- y :: [C]\n-- _ :: [[C]]\n</code></pre>\n\n<p>This list comprehension creates a list of lists. <code>x</code> is what is being prepended, so it would make sense for it to be coming from the application of the functions <code>f1</code> and <code>f2</code>. <code>y</code> is the tail end of each resulting list. I'll leave you to figure out what it might be.</p>\n\n<p>The non matching case is simpler than this, and can be written like</p>\n\n<pre><code>[ x : y | y &lt;- _] :: [[C]]\n-- note that x is not local to the list comprehension\n-- y :: [C]\n-- _ :: [[C]]\n</code></pre>\n\n<p>although this really is just a special case of the above list comprehension.</p>\n\n<h1>Applicative</h1>\n\n<p>Another way of approaching this problem would be by using the <code>Applicative</code> instance of <code>[a]</code>.</p>\n\n<p>Let's examine the function <code>(&lt;*&gt;)</code> under the list <code>Applicative</code> instance.</p>\n\n<pre><code>-- this is the type when specialized to lists\n(&lt;*&gt;) :: [a -&gt; b] -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>This function has a kind of strange type signature. It takes a list of <em>functions</em>, and a list, then returns you another list. It has the effect of applying each function <code>a -&gt; b</code> to each element of <code>[a]</code> in order.</p>\n\n<pre><code>&gt;&gt;&gt; [(+1), (+2)] &lt;*&gt; [1,2,3]\n-- [2,3,4] comes from (+1)\n-- [3,4,5] comes from (+2)\n[2,3,4,3,4,5]\n</code></pre>\n\n<p>We want to get out <code>[[C]]</code>, not <code>[C]</code>, so if we want to use <code>(&lt;*&gt;)</code> we can specialize its type more to</p>\n\n<pre><code>(&lt;*&gt;) :: [a -&gt; [C]] -&gt; [a] -&gt; [[C]]\n</code></pre>\n\n<p>To avoid confusion, I recommend picking <code>a = [C]</code>, which gives</p>\n\n<pre><code>(&lt;*&gt;) :: [[C] -&gt; [C]] -&gt; [[C]] -&gt; [[C]]\n</code></pre>\n\n<p>Your list of functions should be prepending the right elements onto the lists you're generating. The second argument should be the lists returned by a recursive call.</p>\n"}, {"comments": [{"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560710069, "post_id": 56617897, "comment_id": 99816073, "body": "This almost works! except when something does not match the pattern, the whole thing returns an empty list instead of adding the element to every sublist. Maybe I can do another iteration and add the missing things to every sublist? Doesn&#39;t seem too elegant though.."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560751591, "post_id": 56617897, "comment_id": 99823468, "body": "this will happen when e.g. <code>applicable_f1</code> returns <code>True</code> so <code>f1</code> is applied, and if <code>f1 c</code> then returnes <code>[]</code> then this is what it is. if you don&#39;t want this, take care for <code>applicable_f1</code> to return <code>False</code> in such cases. oh wait maybe there is an error there... will think it over... I just wanted to avoid the explicit <code>if then else</code> with all those lists &amp; head, but maybe it is unavoidable."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560751788, "post_id": 56617897, "comment_id": 99823522, "body": "I did have to filter everything that&#39;s applicable first, then did your solution then reapplied the missing c&#39;s :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1560753061, "post_id": 56617897, "comment_id": 99824000, "body": "I think I fixed it <i>now</i>. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1560752920, "last_edit_date": 1560752920, "creation_date": 1560680126, "answer_id": 56617897, "question_id": 56615863, "link": "https://stackoverflow.com/questions/56615863/building-an-exponentially-sized-list-in-haskell/56617897#56617897", "title": "Building an exponentially sized list in haskell", "body": "<p>You must have</p>\n\n<pre><code>applicable_f1 :: C -&gt; Bool\napplicable_f2 :: C -&gt; Bool\n</code></pre>\n\n<p>defined somehow. Then,</p>\n\n<pre><code>combinations :: [C] -&gt; [[C]]\ncombinations cs = map concat . sequence $\n    [ concat $ [ [ [c]   | not (applicable_f1 c || applicable_f2 c)]\n               , [ f1 c  | applicable_f1 c]\n               , [ f2 c  | applicable_f2 c] ]\n      | c &lt;- cs]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561354496, "post_id": 56657838, "comment_id": 100019975, "body": "I&#39;m hesitant to be bothering you with the comments this much but I think this is mistyped. the Q says <code>f1, f2 :: C -&gt; [C]</code>, not <code>C -&gt; C</code>. (just now noticed this answer :) )"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561377829, "post_id": 56657838, "comment_id": 100031000, "body": "@WillNess How odd. I wonder what the distinction between them is, then. Anyway it&#39;s easy to handle: just <code>f1 x ++ f2 x</code> instead of <code>[f1 x, f2 x]</code>. But then why two functions instead of just one that returns more answers? Puzzling. (I see in your answer you treated them as matching in different conditions -- but the question doesn&#39;t actually <i>say</i> that...)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561403957, "post_id": 56657838, "comment_id": 100044345, "body": "that&#39;s how I&#39;ve interpreted the examples given in the question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561407189, "post_id": 56657838, "comment_id": 100045608, "body": "@WillNess Okay, reviewing the question again I think I understand the distinction between <code>f1</code> and <code>f2</code> now. I&#39;ve updated my answer, and included an updated example."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1561407144, "last_edit_date": 1561407144, "creation_date": 1560897018, "answer_id": 56657838, "question_id": 56615863, "link": "https://stackoverflow.com/questions/56615863/building-an-exponentially-sized-list-in-haskell/56657838#56657838", "title": "Building an exponentially sized list in haskell", "body": "<p>The other answers seem very complicated to me. In this answer I will expand on my comment: this is just a <code>foldMap</code> combining the nondeterminism monad (lists!) with the sequence monoid (lists!).</p>\n\n<p>First write a thing that works on a single element of the list:</p>\n\n<pre><code>singleElement x\n    | matchesThePattern x = [f1 x, f2 x]\n    | otherwise = [[x]]\n</code></pre>\n\n<p>Then apply it to each element:</p>\n\n<pre><code>import Data.Monoid\ncombine = foldMap (Ap . singleElement)\n</code></pre>\n\n<p>That's it. That's the whole code.</p>\n\n<p>For example, suppose we want to repeat each letter either 2 or 3 times, i.e. <code>x</code> -> <code>xx</code> or <code>xxx</code>, and all other characters to stay the same.</p>\n\n<pre><code>singleElement x\n    | 'a' &lt;= x &amp;&amp; x &lt;= 'z' = [[x, x], [x, x, x]]\n    | otherwise = [[x]]\n</code></pre>\n\n<p>Then we can try it in ghci:</p>\n\n<pre><code>&gt; combine \"123def\"\nAp {getAp = [\"123ddeeff\",\"123ddeefff\",\"123ddeeeff\",\"123ddeeefff\",\"123dddeeff\",\"123dddeefff\",\"123dddeeeff\",\"123dddeeefff\"]}\n</code></pre>\n\n<p>Pick a better name than <code>singleElement</code> in your own code, of course.</p>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56617897, "answer_count": 3, "score": 1, "last_activity_date": 1561407144, "creation_date": 1560656216, "last_edit_date": 1560660785, "question_id": 56615863, "link": "https://stackoverflow.com/questions/56615863/building-an-exponentially-sized-list-in-haskell", "title": "Building an exponentially sized list in haskell", "body": "<p>I have two functions which only do something if C is a specific pattern.\nEach function outputs a list of C.</p>\n\n<p>My goal is, given [C], I want to get all possibilities of calling f1 and f2 on the list while leaving the rest unchanged. For example:</p>\n\n<p>suppose the list of C is:</p>\n\n<pre><code>    c1\n    c2 --matches the pattern\n    c3\n</code></pre>\n\n<p>then I want a list of two lists</p>\n\n<pre><code>[[c1] ++ (f1 c2) ++ [c3],[c1] ++ (f2 c2) ++ [c3]]\n</code></pre>\n\n<p>However, if  I have</p>\n\n<pre><code>c1\nc2 --matches the pattern\nc3 --matches the pattern\n</code></pre>\n\n<p>Then we should have 4 lists because we want all combinations of calling f1 and f2.\nSo it would be:</p>\n\n<pre><code>[(f1 c1) ++ (f1 c2) ++ [c3], (f2 c1) ++ (f2 c2) ++ [c3], \n(f1 c1) ++ (f2 c2) ++ [c3], (f2 c1) ++ (f1 c2) ++ [c3]]\n</code></pre>\n\n<p>currently, my code is structured roughly in the following way:</p>\n\n<pre><code>f1 :: C -&gt; [C]\n\nf2 :: C -&gt;  [C]\n\ncombine ::  [C] -&gt; [[C]]\ncombine  my_pattern:xs =  ?\ncombine (x:xs) =  ?\ncombine [] = []\n\n  where first_set = (f1 my_pattern)\n        second_set = (f2 my_pattern)\n</code></pre>\n\n<p>Could someone give intuition on how I could fill the remaining part? Is there any functions from Data.List that can be useful? I looked at the documentation, but wasn't able to immediately notice which one could be helpful. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1560649664, "creation_date": 1560649664, "answer_id": 56615479, "question_id": 56615441, "link": "https://stackoverflow.com/questions/56615441/how-to-fix-exception-prelude-head-empty-list-here/56615479#56615479", "title": "How to fix &#39;*** Exception: Prelude.head: empty list&#39; here", "body": "<p><code>x == head result</code> dies if <code>result</code> is <code>[]</code> -- and <code>result</code> is definitely <code>[]</code> in the first iteration of <code>foldr</code>, so adding a special case for when the input list would not require <code>foldr</code> to do any iterations is fixing exactly the wrong case!</p>\n\n<p>Instead of trying to extract a value from the <code>result</code> list, you could insert <code>x</code> into a list; so consider using the condition</p>\n\n<pre><code>[x] == take 1 result\n</code></pre>\n\n<p>instead -- it never dies.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1560686820, "creation_date": 1560686820, "answer_id": 56618681, "question_id": 56615441, "link": "https://stackoverflow.com/questions/56615441/how-to-fix-exception-prelude-head-empty-list-here/56618681#56618681", "title": "How to fix &#39;*** Exception: Prelude.head: empty list&#39; here", "body": "<p>As said by <a href=\"https://stackoverflow.com/a/56615479/67579\">@DanielWagner</a>, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:head\" rel=\"nofollow noreferrer\"><strong><code>head :: [a] -&gt; a</code></strong></a> will raise an error for empty lists. We can solve this by using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a>, or by using <em>pattern matching</em>:</p>\n\n<pre><code>removeAdjacentDuplicates :: (Foldable f, Eq a) =&gt; f a -&gt; [a]\nremoveAdjacentDuplicates = foldr f []\n    where f x <b>ys@(y:_)</b> | x == y = ys\n          f x ys = (x:ys)</code></pre>\n\n<p>here <code>ys@(y:_)</code> will match given the list is non-empty, with <code>y</code> as head of the list. In that case we thus check if <code>x == y</code>, and if that holds, we return <code>ys</code>. Otherwise we return <code>(x:ys)</code>.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 56615479, "answer_count": 2, "score": 2, "last_activity_date": 1560686820, "creation_date": 1560649013, "question_id": 56615441, "link": "https://stackoverflow.com/questions/56615441/how-to-fix-exception-prelude-head-empty-list-here", "title": "How to fix &#39;*** Exception: Prelude.head: empty list&#39; here", "body": "<p>This is a homework , it's to removing the adjacent duplicates.\nThe result should like this <code>removeAdjacentDuplicates [3,1,2,2,2,2,2,4,4,2,2,3] == [3,1,2,4,2,3]</code></p>\n\n<p>I knew it's not necessary to use <code>head</code> here, but it's not allowed to use rekursion and List-Comprehensions of Form [e | ...]. Only the function in Prelude is permittet, <code>group</code> und so on , which in other packages are also not allowed. <code>map zip filter concat reverse foldr</code> are recommended.</p>\n\n<p>For example , It's not possible to make this: </p>\n\n<pre><code>removeAdjacentDuplicates :: Eq a =&gt; [a] -&gt; [a]\nremoveAdjacentDuplicates (x:xs@(y:_))\n | x == y    = x:tail (removeAdjacentDuplicates xs)\n | otherwise = x:removeAdjacentDuplicates xs\n</code></pre>\n\n<p>so I try like this</p>\n\n<pre><code>removeAdjacentDuplicates = foldr (\\x result -&gt; if ( x == (head result)) then result else (x : result)) []\n\n</code></pre>\n\n<p>but when I test it, it throw <code>*** Exception: Prelude.head: empty list' here</code> out</p>\n\n<p>I have tried to add <code>removeAdjacentDuplicates [] = []</code> before,<br>\nBut error is like this </p>\n\n<pre><code>Equations for \u2018removeAdjacentDuplicates\u2019 have different numbers of arguments\n      H7-1.hs:24:1-32\n      H7-1.hs:25:1-105\n   |\n24 | removeAdjacentDuplicates [] = []\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^...\n</code></pre>\n\n<p>I don't understand where the problem is, and how can I solve it?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "fold"], "comments": [{"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 0, "creation_date": 1560640302, "post_id": 56614808, "comment_id": 99804027, "body": "I&#39;m not quite sure I understand the point, could you maybe give a non-trivial example (i.e. not achievable with <code>map repeat . &lt;.&gt;</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1560640452, "post_id": 56614808, "comment_id": 99804057, "body": "The problem is that <code>zipWith</code> needs at least to evaluate the lists at the top level. Since the right parameter is another <code>zipWith</code> (and that keeps going on), you keep calling endlessly."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560640506, "post_id": 56614808, "comment_id": 99804068, "body": "In short, you can only <code>fold</code> an infinite list here, if you can postpone the evaluation of the right element. But <code>zipWith</code> needs to evaluate both the two lists."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560661834, "post_id": 56614808, "comment_id": 99806556, "body": "You might like <code>map concat . transpose $ repeat [[1,2],[3,4]]</code>. It at least satisfies your two equations... though you might run into trouble if you try to write down the obvious third equation!"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1560642054, "post_id": 56614916, "comment_id": 99804273, "body": "A helpful combinator I use in situations like this is <code>nonempty ~(x:xs) = x:xs</code>. It &quot;asserts&quot; that a list is nonempty, and allows it to be used a bit more lazily thus. I believe this will fix the problem: <code>foldr1 (\\x y -&gt; nonempty (x &lt;.&gt; y)) ...</code>"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1560642692, "post_id": 56614916, "comment_id": 99804375, "body": "I&#39;m actually quite curious what other &quot;situations like this&quot; you&#39;ve encountered."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1560643082, "post_id": 56614916, "comment_id": 99804416, "body": "@luqui I have tried that, and it does work. (Another possibility in this case would be using <code>NonEmpty</code> for the middle layer.)"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 8, "last_activity_date": 1560641179, "creation_date": 1560641179, "answer_id": 56614916, "question_id": 56614808, "link": "https://stackoverflow.com/questions/56614808/stack-overflow-when-folding-infinite-lists/56614916#56614916", "title": "Stack overflow when folding infinite lists?", "body": "<p>I'll expand on what's been said in the comments here. I'm going to borrow (a simplified version of) the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#zipWith\" rel=\"noreferrer\">GHC version of <code>zipWith</code></a>, which should suffice for the sake of this discussion.</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith f [] _ = []\nzipWith f _ [] = []\nzipWith f (x:xs) (y:ys) = f x y : zipWith f xs ys\n</code></pre>\n\n<p>Now, here's what your computation ends up looking like, in it's glorious infinite form.</p>\n\n<pre><code>[[1, 2], [3, 4]] &lt;.&gt; ([[1, 2], [3, 4]] &lt;.&gt; ([[1, 2], [3, 4]] ... ) ... )\n</code></pre>\n\n<p>Okay, so the top-level is a <code>&lt;.&gt;</code>. Fine. Let's take a closer look at that.</p>\n\n<pre><code>zipWith (++) [[1, 2], [3, 4]] ([[1, 2], [3, 4]] &lt;.&gt; ([[1, 2], [3, 4]] ... ) ... )\n</code></pre>\n\n<p>Still no problems yet. Now we look at the patterns for <code>zipWith</code>. The first pattern only matches if the left-hand-side is empty. Welp, that's definitely not true, so let's move on. The second only matches if the right-hand-side is empty. So let's see if the right-hand-side is empty. The right-hand-side looks like</p>\n\n<pre><code>[[1, 2], [3, 4]] &lt;.&gt; ([[1, 2], [3, 4]] &lt;.&gt; ([[1, 2], [3, 4]] ... ) ... )\n</code></pre>\n\n<p>Which is what we started with. So to compute the result, we need access to the result. Hence, stack overflow.</p>\n\n<p>Now, we've established that our problem is with <code>zipWith</code>. So let's play with it. First, we know we're going to be applying this to infinite lists for our contrived example, so we don't need that pesky empty list case. Get rid of it.</p>\n\n<pre><code>-- (I'm also changing the name so we don't conflict with the Prelude version)\nzipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith' f (x:xs) (y:ys) = f x y : zipWith' f xs ys\n\n(&lt;.&gt;) :: [[a]] -&gt; [[a]] -&gt; [[a]]\nxs &lt;.&gt; ys = zipWith' (++) xs ys\n</code></pre>\n\n<p>But that fixes nothing. We still have to evaluate to weak head normal form (read: figure out of the list is empty) to match that pattern.</p>\n\n<p>If only there was a way to do a pattern match without having to get to WHNF... enter <a href=\"https://wiki.haskell.org/Lazy_pattern_match\" rel=\"noreferrer\">lazy patterns</a>. Let's rewrite our function this way.</p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith' f ~(x:xs) ~(y:ys) = f x y : zipWith' f xs ys\n</code></pre>\n\n<p>Now our function will <em>definitely</em> break if given a finite list. But this allows us to \"pretend\" pattern match on the lists without actually doing any work. It's equivalent to the more verbose</p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith' f xs ys = f (head xs) (head ys) : zipWith' f (tail xs) (tail ys)\n</code></pre>\n\n<p>And now we can test your function properly.</p>\n\n<pre><code>*Main&gt; let x = foldr1 (&lt;.&gt;) $ repeat [[1, 2], [3, 4]]\n*Main&gt; x !! 0\n[1,2,1,2,1,2,1,2,1,...]\n*Main&gt; x !! 1\n[3,4,3,4,3,4,3,4,3,...]\n</code></pre>\n\n<p>The obvious downside of this is that it will definitely fail on finite lists, so you have to have a different function for those.</p>\n\n<pre><code>*Main&gt; [[1, 2], [3, 4]] &lt;.&gt; [[1, 2], [3, 4]]\n[[1,2,1,2],[3,4,3,4],*** Exception: Prelude.head: empty list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1560643364, "last_edit_date": 1560643364, "creation_date": 1560641692, "answer_id": 56614954, "question_id": 56614808, "link": "https://stackoverflow.com/questions/56614808/stack-overflow-when-folding-infinite-lists/56614954#56614954", "title": "Stack overflow when folding infinite lists?", "body": "<p><code>zipWith</code> is not -- in fact, it can't possibly be -- as lazy as you'd like. Consider this variation on your example:</p>\n\n<pre><code>GHCi&gt; foldr1 (zipWith (++)) [ [[1,2],[3,4]], [] ]\n[]\n</code></pre>\n\n<p>Any empty list of lists in the input will lead to an empty list of lists result. That being so, there is no way to know any of the elements of the result until the whole input has been consumed. Therefore, your function won't terminate on infinite lists.</p>\n\n<p><a href=\"https://stackoverflow.com/a/56614916/2751851\">Silvio Mayolo's answer</a> goes through some potential workarounds for this issue. My suggestion is using non-empty-lists of lists, instead of plain lists of lists:</p>\n\n<pre><code>GHCi&gt; import qualified Data.List.NonEmpty as N\nGHCi&gt; import Data.List.NonEmpty (NonEmpty(..))\nGHCi&gt; take 10 . N.head $ foldr1 (N.zipWith (++)) $ repeat ([1,2] :| [[3,4]])\n[1,2,1,2,1,2,1,2,1,2]\n</code></pre>\n\n<p><code>N.zipWith</code> <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.List.NonEmpty.html#zipWith\" rel=\"nofollow noreferrer\">doesn't have to deal with an empty list case</a>, so it can be lazier.</p>\n"}], "owner": {"reputation": 2025, "user_id": 1946002, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/rpIgZ.png?s=128&g=1", "display_name": "Nathan BeDell", "link": "https://stackoverflow.com/users/1946002/nathan-bedell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 56614916, "answer_count": 2, "score": 8, "last_activity_date": 1560643364, "creation_date": 1560639712, "question_id": 56614808, "link": "https://stackoverflow.com/questions/56614808/stack-overflow-when-folding-infinite-lists", "title": "Stack overflow when folding infinite lists?", "body": "<p>Consider the following function:</p>\n\n<pre><code>(&lt;.&gt;) :: [[a]] -&gt; [[a]] -&gt; [[a]]\nxs &lt;.&gt; ys = zipWith (++) xs ys\n</code></pre>\n\n<p>This essentially takes two two-dimensional arrays of <code>a</code>s and concatanates them, left to right, e.x.:</p>\n\n<pre><code>[[1,2],[3,4]] &lt;.&gt; [[1,2],[3,4]] == [[1,2,1,2],[3,4,3,4]]\n</code></pre>\n\n<p>I would like to be able to write something like the following:</p>\n\n<pre><code>x = foldr1 (&lt;.&gt;) $ repeat [[1,2],[3,4]]\n</code></pre>\n\n<p>Which should make sense due to Haskell's lazy evaluation, i.e. we should obtain:</p>\n\n<pre><code>x !! 0 == [1,2,1,2,1,2,1,2...]\nx !! 1 == [3,4,3,4,3,4,3,4...]\n</code></pre>\n\n<p>However, when I try to run this example with GHCi, either using <code>foldr1</code> or <code>foldl1</code>, I either get a non-terminating computation, or a stack overflow.</p>\n\n<p>So my question is:</p>\n\n<ol>\n<li>What's going on here?</li>\n<li>Is it possible to do what I'm trying to accomplish here with some function other than <code>foldr1</code> or <code>foldl1</code>? (I'm happy if I need to modify the implementation of <code>&lt;.&gt;</code>, as long as it computes the same function)</li>\n</ol>\n\n<p>Also, note: I'm aware that for this example, <code>map repeat [[1,2],[3,4]]</code> produces the desired output, but I am looking for a solution that works for arbitrary infinite lists, not just those of the form <code>repeat xs</code>.</p>\n"}, {"tags": ["haskell", "try-catch"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560617299, "post_id": 56612123, "comment_id": 99799457, "body": "A function itself does not raise an error, as in <code>[1,2] !! 3</code> does <i>not</i> raise an error. It is the evaluation, since Haskell is lazy, it is thus perfectly possible that such expression will never yield an error."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1560619226, "post_id": 56612123, "comment_id": 99799871, "body": "Show what you tried with catch, that&#39;s a workable solution but you probably mis-used it somehow."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1560627819, "post_id": 56612123, "comment_id": 99801771, "body": "The sort of &quot;exception&quot; thrown by <code>!!</code> is very different than exceptions thrown in a language like Java, and isn&#39;t really intended to be caught. The right answer in Haskell is to check that the index is in bounds <i>first</i> or, even better, restructure your algorithm to not use <code>!!</code> at all (which is easier than it sounds when you get used to the language)."}], "answers": [{"comments": [{"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1560860269, "post_id": 56612590, "comment_id": 99867568, "body": "Thanks, my problem was that I wasn&#39;t inside IO"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1560619439, "creation_date": 1560619439, "answer_id": 56612590, "question_id": 56612123, "link": "https://stackoverflow.com/questions/56612123/check-if-function-returned-an-error-in-haskell/56612590#56612590", "title": "Check if function returned an error in Haskell", "body": "<p>You can use <code>catch</code> as follows:</p>\n\n<pre><code>example :: IO ()\nexample = do\n   let handler :: SomeException -&gt; IO Bool\n       handler e = do\n          putStrLn \"Exception caught:\"\n          print e\n          return False\n   res &lt;- (evaluate ([1,2::Int] !! 3) &gt;&gt; return True) `catch` handler\n   print res\n</code></pre>\n\n<p>The last <code>print</code> will print <code>True</code> on normal termination, and <code>False</code> on exceptional termination.</p>\n\n<p>The output messages in the handler can be removed -- they're only for illustration.</p>\n\n<p>You can replace <code>SomeException</code> with any more specific exception type, if you only want to catch some of them.</p>\n\n<p>Note that you can't catch exceptions outside IO, which makes them more limited. For that reason partial functions like <code>!!</code> should be avoided, preferring functions returning a <code>Maybe a</code> type instead, whose output can be checked anywhere.</p>\n"}], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 56612590, "answer_count": 1, "score": 1, "last_activity_date": 1560619439, "creation_date": 1560615559, "question_id": 56612123, "link": "https://stackoverflow.com/questions/56612123/check-if-function-returned-an-error-in-haskell", "title": "Check if function returned an error in Haskell", "body": "<p>I want to create a function that returns <code>True</code> when a function throws any kind of exception and <code>False</code> if it doesn't.</p>\n\n<p>But I haven't been able to figure out a way to do this with the <code>catch</code> method at <code>Control.Exception</code>.</p>\n\n<p>I want to catch the error thrown by <code>[1,2] !! 3</code> but also custom errors thrown by the usage of <code>error \"Error msg\"</code>.</p>\n"}, {"tags": ["date", "haskell", "io", "io-monad", "do-notation"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1560619592, "post_id": 56611488, "comment_id": 99799947, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/194997/discussion-on-question-by-tabmanrekoj-haskell-how-to-compare-io-tuple-with-norma\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1560628482, "post_id": 56612934, "comment_id": 99801929, "body": "Worth noting that <code>compareDates</code> is really just the (automatically generated) <code>Eq</code> instance for 3-tuples, so it can be shortened to <code>compareDates = (==)</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1560629200, "post_id": 56612934, "comment_id": 99802067, "body": "Or less dependent on pre-defined <code>Eq</code> instances for tuples, <code>compareDates (y1, m1, d1) (y2, m2, d2) = y1 == y2 &amp;&amp; m1 == m2 &amp;&amp; d1 == d2</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1560629315, "post_id": 56612934, "comment_id": 99802094, "body": "There&#39;s certainly no need for <code>do</code> in <code>compareDates</code>; a proper <code>let</code> expression would suffice. <code>let { year1 = xx_fst d2; year2 = xx_fst d2; ... } in year1 == year2 &amp;&amp; month1 == month2 &amp;&amp; day1 == day2</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1560629413, "post_id": 56612934, "comment_id": 99802115, "body": "The last line of your <code>main</code> should just be <code>return (compareDates d1 d2)</code>; there&#39;s no need for a second call to <code>getDate</code> or  <code>&gt;&gt;=</code> which shadows the value read by the first call to <code>getDate</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560651792, "post_id": 56612934, "comment_id": 99805415, "body": "I have taken the liberty of simplifying your code somewhat. In addition to the improvements already listed in the preceding comments, there&#39;s no need to destructure a <code>Day</code> into a tuple and compare tuples when <code>Day</code>s already have a perfectly suitable comparison available."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1560679093, "post_id": 56612934, "comment_id": 99809171, "body": "btw, in your original code, <code>getDate &gt;&gt;= \\d2 -&gt; return (compareDates d1 d2)</code> is equivalent to <code>do { d2 &lt;- getDate ; return (compareDates d1 d2) }</code>, so you end up having two exact same lines <code>d2 &lt;- getDate ; d2 &lt;- getDate ; ...</code> in your <code>do</code> block. so instead of <code>getDate &gt;&gt;= \\d2 -&gt; return (compareDates d1 d2)</code> it is enough if you just wrote <code>return (compareDates d1 d2)</code> (as the comment by chepner is saying, above). another thing is that <code>do {x &lt;- mx; return f x} == fmap f mx</code> so you could&#39;ve also written <code>main = fmap ((2019,6,15) ==) getDate</code> (using <code>==</code>, as Silvio&#39;s comment is saying)."}], "tags": [], "owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "is_accepted": true, "score": 1, "last_activity_date": 1560651695, "last_edit_date": 1560651695, "creation_date": 1560622077, "answer_id": 56612934, "question_id": 56611488, "link": "https://stackoverflow.com/questions/56611488/haskell-how-to-compare-io-tuple-with-normal-tuple/56612934#56612934", "title": "Haskell How to compare IO tuple with normal tuple", "body": "<p>With the help of the comment / chat section I got it to work with the following code:    </p>\n\n<pre><code>getDate :: IO Day\ngetDate = do\n    now &lt;- getCurrentTime\n    tz &lt;- getCurrentTimeZone\n    return . localDay $ utcToLocalTime tz now\n\nmain = do\n    d2 &lt;- getDate\n    return $ fromGregorian 2019 6 15 == d2\n</code></pre>\n"}], "owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 56612934, "answer_count": 1, "score": -1, "last_activity_date": 1560677954, "creation_date": 1560610731, "last_edit_date": 1560677954, "question_id": 56611488, "link": "https://stackoverflow.com/questions/56611488/haskell-how-to-compare-io-tuple-with-normal-tuple", "title": "Haskell How to compare IO tuple with normal tuple", "body": "<p>I try to compare the tuple members (date) of an IO tuple with a normal tuple. </p>\n\n<blockquote>\n  <p><code>d1 -&gt;(Integer, Int, Int)</code> and <code>d2 -&gt; IO (Integer, Int, Int)</code>,</p>\n</blockquote>\n\n<p>Is it possible to compare these two tuples? \nI've tried something like that:</p>\n\n<pre><code>import Data.Time.Clock\nimport Data.Time.Calendar\nimport Data.Time.LocalTime\n\n-- helper functions for tuples\nx_fst (x,_,_) = x\nx_snd (_,x,_) = x\nx_trd (_,_,x) = x\n\ngetDate :: IO (Integer, Int, Int)\ngetDate = do\n    now &lt;- getCurrentTime\n    tiz &lt;- getCurrentTimeZone\n    let zoneNow = utcToLocalTime tiz now\n    let date@(year, month, day) = toGeorgian $ localDay zoneNow\n    return $ date -- here I will return an IO tuple -&gt; IO (Integer, Int, Int)\n\ncompareDates :: a -&gt; IO (Integer, Int, Int) -&gt; IO Bool\ncompareDates d1 d2 = do\n    let year1 = x_fst d1\n    let year2 = x_fst d2\n    let month1 = x_snd d1\n    let month2 = x_snd d2\n    let day1 = x_trd d1\n    let day2 = x_trd d2\n    return $ (year1 == year2 &amp;&amp; month1 == month2 &amp;&amp; day1 == day2)\n</code></pre>\n\n<p>But I get the message that I can't compare an IO tuple with a normal tuple:</p>\n\n<pre><code>Couldn't match expected type `(Integer, Integer, Integer)` \n  with actual type `IO (Integer, Int, Int)`\n  In the second argument of `compareDates`, namely `date`\n</code></pre>\n\n<p>Is there a way around it? I would appreciate any help. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "insert", "set"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1560596840, "post_id": 56609668, "comment_id": 99794524, "body": "<code>x</code> is <code>2</code>, <code>s</code> is <code>empty</code> and <code>y</code> is <code>0</code>."}, {"owner": {"reputation": 395, "user_id": 11019303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2bfaec7dd8db91951fb7515a3908c60?s=128&d=identicon&r=PG&f=1", "display_name": "Sniper", "link": "https://stackoverflow.com/users/11019303/sniper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560597211, "post_id": 56609668, "comment_id": 99794603, "body": "Thankyou and what if i want to insert an element into the set and see it is inserted or not how can i see that?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560600976, "post_id": 56609668, "comment_id": 99795435, "body": "@Sniper If the value <code>x</code> has been inserted into a set <code>s</code> (that is, it is a member of <code>s</code>), then <code>s x == True</code>. That&#39;s the whole concept behind this definition of sets: a set here is just a function from values to <code>Bool</code>s which returns <code>True</code> for a value <code>x</code> if that value is in the set, and returns <code>False</code> otherwise."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1560887107, "post_id": 56609668, "comment_id": 99881985, "body": "The word here should be \u201cpassed,\u201d not \u201cparsed\u201d. \u201cParsed\u201d means something very different."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1560694599, "last_edit_date": 1592644375, "creation_date": 1560610109, "answer_id": 56611418, "question_id": 56609668, "link": "https://stackoverflow.com/questions/56609668/how-values-are-parsed-to-this-insert-function-in-haskell/56611418#56611418", "title": "How values are parsed to this insert function in haskell", "body": "<p>This represents a set as a function that, given an <code>Int</code>, tells you if it is in the et (by returning <code>True</code>) or not (by returning <code>False</code>).</p>\n<p>The empty set is thus the function that returns <code>False</code> no matter what argument you give.</p>\n<p>Inserting into a set means returning a new set/function based on the old set/function.</p>\n<p>There is a minor typo in your function definition, as it is missing the <code>if</code> keyword:</p>\n<pre><code>insert :: Int -&gt; IntSet -&gt; IntSet\ninsert x s = \\y -&gt; if x == y then True else s y\n</code></pre>\n<p>When you insert some new value <code>x</code> into a set, you are getting back a new set returns <code>True</code> if the just inserted value is queried, or else defers the answer to the old set. For example,</p>\n<pre><code>let newset = insert 3 empty in newset 3\n</code></pre>\n<p>evaluates to <code>True</code> because</p>\n<pre><code>newset 3 == (insert 3 empty) 3\n         == (\\y -&gt; if 3 == y then True else empty 3) 3\n         == if 3 == 3 then True else empty 3\n         == True\n</code></pre>\n<p>while <code>let newset = insert 3 empty in newset 4</code> returns <code>False</code> because</p>\n<pre><code>newset 4 == (insert 3 empty) 4\n         == (\\y -&gt; if 3 == y then True else empty 3) 4\n         == if 4 == 3 then True else empty 3\n         == empty 3\n         == (\\_ -&gt; False) 3\n         == False\n</code></pre>\n<p>This works fine (albeit a bit inefficiently) for querying a particular value. But what if you just want to see all the values contained in the set? Conceptually, it's easy (since <code>Int</code> is finite, so are all the possible sets): just filter the list of all <code>Int</code> values using the set/function:</p>\n<pre><code>setToList :: IntSet -&gt; [Int]\nsetToList s = filter s [minBound..maxBound]\n</code></pre>\n<p>Given something like <code>setToList (insert 3 (insert 5 empty))</code>, it is straightforward (though tedious) to show that</p>\n<ul>\n<li><p><code>(insert 3 (insert 5 empty)) minBound</code> is False,</p>\n</li>\n<li><p><code>(insert 3 (insert 5 empty)) (minBound + 1)</code> is False,</p>\n</li>\n<li><p>...</p>\n</li>\n<li><p><code>(insert 3 (insert 5 empty)) 0</code> is False,</p>\n</li>\n<li><p><code>(insert 3 (insert 5 empty)) 1</code> is False,</p>\n</li>\n<li><p><code>(insert 3 (insert 5 empty)) 2</code> is False,</p>\n</li>\n<li><p><code>(insert 3 (insert 5 empty)) 3</code> is True,</p>\n</li>\n<li><p>etc,</p>\n<p>so that the final result is the list <code>[3, 5]</code>. It takes a while, though, because depending on your system, the list <code>[minBound..maxBound]</code> could have quite a few elements. (Check the values of <code>minBound :: Int</code> and <code>maxBound :: Int</code> to see just how many.)</p>\n</li>\n</ul>\n<hr />\n<p>Note that <code>setToList</code> only terminates because <code>Int</code> is a finite type.</p>\n"}], "owner": {"reputation": 395, "user_id": 11019303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2bfaec7dd8db91951fb7515a3908c60?s=128&d=identicon&r=PG&f=1", "display_name": "Sniper", "link": "https://stackoverflow.com/users/11019303/sniper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560694599, "creation_date": 1560596020, "question_id": 56609668, "link": "https://stackoverflow.com/questions/56609668/how-values-are-parsed-to-this-insert-function-in-haskell", "title": "How values are parsed to this insert function in haskell", "body": "<p>I am trying to figure out this piece of code that how it is actually working. This function implementing the concept of Set in Haskell. </p>\n\n<p>I have a general concept about set in Haskell that it is just like a function which is (type IntSet = a -> Bool) but i dont really understand the purpose of using this i mean it is just like another simple function and logic behind inserting is, if you want to insert an element into the set you just extend the characteristic function to include case for that. </p>\n\n<p>Here i am trying to understand this insert function that how to parse values to insert function and also insert element into it. </p>\n\n<pre><code>type IntSet = Int -&gt; Bool \n</code></pre>\n\n<p>If we have an empty set if we want to insert values into this it will always return False because it doesn't contain the value, Understandable! but how to insert value and see its actually inserted. </p>\n\n<pre><code>empty :: IntSet \nempty = \\ _ -&gt; False \n\ninsert :: Int -&gt; IntSet -&gt; IntSet \ninsert x s = \\y -&gt; x ==y then True else s y \n\n\ninput : insert 2 empty 0\n\n\n\nresult = False \n</code></pre>\n\n<p>How values are parsed to insert function and what is the value of <code>s</code> <code>x</code> and <code>y</code> and in else case when it returns <code>s y</code> how this is handled. </p>\n\n<p>I am just a beginner, any valuable input would be appreciated.   </p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 808, "user_id": 9160022, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cce1edae0e83895af88da976cb4c0170?s=128&d=identicon&r=PG&f=1", "display_name": "menfon", "link": "https://stackoverflow.com/users/9160022/menfon"}, "edited": false, "score": 0, "creation_date": 1560603306, "post_id": 56610450, "comment_id": 99796013, "body": "Thank you, that works nicely :). Edit: For others - <code>text</code> comes from <code>Data.Aeson.Encoding</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1560607548, "last_edit_date": 1560607548, "creation_date": 1560602161, "answer_id": 56610450, "question_id": 56609201, "link": "https://stackoverflow.com/questions/56609201/how-to-use-a-sum-type-as-a-key-in-map-when-using-aeson/56610450#56610450", "title": "How to use a sum type as a key in map when using Aeson?", "body": "<p>Here is what a typical instance looks like, using <code>Show</code> and <code>Read</code> (a deriving clause for <code>Read</code> needs to be added to <code>Language</code>):</p>\n\n<pre><code>-- Additional imports\nimport qualified Data.Text as T\nimport Text.Read (readMaybe)\n\ninstance ToJSONKey Language where\n  toJSONKey = toJSONKeyText (T.pack . show)\n\ninstance FromJSONKey Language where\n  fromJSONKey = FromJSONKeyTextParser $ \\t -&gt; case readMaybe (T.unpack t) of\n    Just k -&gt; pure k\n    Nothing -&gt; fail (\"Invalid key: \" ++ show t)\n</code></pre>\n\n<p>There should be a shorter way, I've submitted a proposal to add generic implementations: <a href=\"https://github.com/bos/aeson/issues/710\" rel=\"nofollow noreferrer\">https://github.com/bos/aeson/issues/710</a></p>\n"}], "owner": {"reputation": 808, "user_id": 9160022, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cce1edae0e83895af88da976cb4c0170?s=128&d=identicon&r=PG&f=1", "display_name": "menfon", "link": "https://stackoverflow.com/users/9160022/menfon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 56610450, "answer_count": 1, "score": 0, "last_activity_date": 1560607548, "creation_date": 1560591779, "last_edit_date": 1560605455, "question_id": 56609201, "link": "https://stackoverflow.com/questions/56609201/how-to-use-a-sum-type-as-a-key-in-map-when-using-aeson", "title": "How to use a sum type as a key in map when using Aeson?", "body": "<p>I wanted to encode a simple \"map\" in JSON:</p>\n\n<pre><code>{ \"CS\": \"Ahoj\"\n, \"EN\": \"Hello\"\n}\n</code></pre>\n\n<p>My attempt:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell, DeriveGeneric, DeriveAnyClass #-}\n\nimport Data.Aeson\nimport Data.Aeson.TH (deriveJSON)\nimport Data.Text (Text)\nimport qualified Data.HashMap.Lazy as M\nimport GHC.Generics (Generic)\nimport Data.Hashable (Hashable)\n\ndata Language\n  = CS\n  | EN\n  deriving (Eq, Show, Generic, Hashable)\n\nderiveJSON defaultOptions ''Language\n\nnewtype TranslatedText =\n  TranslatedText (M.HashMap Language Text)\n  deriving (Eq, Show, Generic)\n\nderiveJSON defaultOptions ''TranslatedText\n</code></pre>\n\n<p>I am getting:</p>\n\n<pre><code>/xxx/src/Data.hs:80:1: error:\n    \u2022 No instance for (FromJSONKey Language)\n        arising from a use of \u2018parseJSON\u2019\n    \u2022 In the second argument of \u2018(&lt;$&gt;)\u2019, namely \u2018parseJSON arg_apgG\u2019\n      In the expression: (TranslatedText &lt;$&gt; parseJSON arg_apgG)\n      In a case alternative:\n          arg_apgG -&gt; (TranslatedText &lt;$&gt; parseJSON arg_apgG)\n   |\n80 | deriveJSON defaultOptions ''TranslatedText\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n/xxx/src/Data.hs:80:1: error:\n    \u2022 No instance for (ToJSONKey Language)\n        arising from a use of \u2018toJSON\u2019\n    \u2022 In the expression: toJSON arg1_apfY\n      In a case alternative: TranslatedText arg1_apfY -&gt; toJSON arg1_apfY\n      In the expression:\n        case value_apdm of { TranslatedText arg1_apfY -&gt; toJSON arg1_apfY }\n   |\n80 | deriveJSON defaultOptions ''TranslatedText\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n/xxx/src/Data.hs:80:1: error:\n    \u2022 No instance for (ToJSONKey Language)\n        arising from a use of \u2018toEncoding\u2019\n    \u2022 In the expression: toEncoding arg1_apgk\n      In a case alternative:\n          TranslatedText arg1_apgk -&gt; toEncoding arg1_apgk\n      In the expression:\n        case value_apg9 of {\n          TranslatedText arg1_apgk -&gt; toEncoding arg1_apgk }\n   |\n80 | deriveJSON defaultOptions ''TranslatedText\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I tried writing <code>FromJSONKey</code> and <code>ToJSONKey</code> instances using <code>readMaybe</code> and <code>show</code>, but I don't know how one should construct a <code>Parser</code>? Or is there some better, more automatic way? After all the sum type can easily be converted from/to <code>Text</code>.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "edited": false, "score": 0, "creation_date": 1560596754, "post_id": 56608192, "comment_id": 99794507, "body": "I still get couldn&#39;t match type \u2018Key User\u2019 with \u2018Text\u2019             arising from a use of \u2018UserIdent\u2019"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1560582613, "creation_date": 1560582613, "answer_id": 56608192, "question_id": 56607901, "link": "https://stackoverflow.com/questions/56607901/how-to-extract-values-from-sqllite-in-yesod-persistant/56608192#56608192", "title": "How to extract Values from Sqllite in Yesod persistant", "body": "<p>The first problem is that <code>maybeAuthId</code> can fail and you have to check for that:</p>\n\n<pre><code>maid &lt;- maybeAuthId\ncase maid of\n  Just id_ -&gt; selectList ...\n  _ -&gt; do something in case of unaothorized user\n</code></pre>\n\n<p>And second problem is simple - you have to upperscore entity&amp;field names when using inside Persistent functions:</p>\n\n<pre><code>selectList [UserIdent ==. id_] []\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560582613, "creation_date": 1560579718, "question_id": 56607901, "link": "https://stackoverflow.com/questions/56607901/how-to-extract-values-from-sqllite-in-yesod-persistant", "title": "How to extract Values from Sqllite in Yesod persistant", "body": "<p>I am using Yesod for the first time, I tried out the scaffolded website ,with some minor changes I was able to implement googleOauth , I get back the uid from google and some userinfo ,then I save them to the sqlite database .Here is log that authenticate uses to verify ,just for reference</p>\n\n<pre><code>SELECT \"id\",\"ident\",\"email\",\"name\",\"picture\" FROM \"user\" WHERE \"ident\"=?; [PersistText \"google-uid:11111111111\"]\n</code></pre>\n\n<p>My User model is defined like below </p>\n\n<pre><code>User\n    ident Text\n    email Text\n    name Text\n    picture Text\n    UniqueUser ident\n    deriving Typeable\n</code></pre>\n\n<p>In a subsequent handle ,I want to query the DB using the id i received from google ,to extract the email,name and picture . I tried writing somehting like this </p>\n\n<pre><code>maid &lt;- maybeAuthId\n    let user = selectList [userIdent ==. maid] []\n</code></pre>\n\n<p>But it gives me the following error </p>\n\n<pre><code>Couldn't match expected type \u2018EntityField record (Maybe UserId)\u2019\n                      with actual type \u2018User -&gt; Text\u2019\n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 67048, "user_id": 388787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f786b1ad349a30e02802ae61b4518fc?s=128&d=identicon&r=PG", "display_name": "Dan D.", "link": "https://stackoverflow.com/users/388787/dan-d"}, "is_accepted": true, "score": 3, "last_activity_date": 1560580401, "creation_date": 1560580401, "answer_id": 56607964, "question_id": 56607871, "link": "https://stackoverflow.com/questions/56607871/how-to-remove-server-header-in-servant/56607964#56607964", "title": "How to remove &quot;Server&quot; header in Servant?", "body": "<p>The documentation for <code>setServerName</code> states:</p>\n\n<blockquote>\n  <p>Default server name to be sent as the \"Server:\" header if an application does not set one. If an empty string is set, the \"Server:\" header is not sent. This is true even if an application set one.</p>\n</blockquote>\n\n<p>From <a href=\"http://hackage.haskell.org/package/warp-3.2.27/docs/Network-Wai-Handler-Warp.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/warp-3.2.27/docs/Network-Wai-Handler-Warp.html</a></p>\n\n<p>So to disable the Server header one <code>setServerName</code> with an empty string.</p>\n\n<p>To use this one replaces <code>run port</code> with </p>\n\n<pre><code>runSettings (setPort port (setServerName \"\" defaultSettings))\n</code></pre>\n"}], "owner": {"reputation": 808, "user_id": 9160022, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cce1edae0e83895af88da976cb4c0170?s=128&d=identicon&r=PG&f=1", "display_name": "menfon", "link": "https://stackoverflow.com/users/9160022/menfon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 56607964, "answer_count": 1, "score": 1, "last_activity_date": 1560580401, "creation_date": 1560579503, "question_id": 56607871, "link": "https://stackoverflow.com/questions/56607871/how-to-remove-server-header-in-servant", "title": "How to remove &quot;Server&quot; header in Servant?", "body": "<p>I am using servant library. I tried modifying an approach from some blog post, but it doesn't do anything in case of removing \"Server\" header. (It only works for adding custom headers.)</p>\n\n<pre><code>removeServerHeaderMiddleware :: Middleware\nremoveServerHeaderMiddleware baseApp = \\req responseFunc -&gt; baseApp req (newResponseFunc responseFunc)\n  where\n    newResponseFunc :: (Response -&gt; IO ResponseReceived) -&gt; Response -&gt; IO ResponseReceived\n    newResponseFunc responseFunc = removeServerHeader &gt;&gt;&gt; responseFunc\n    removeServerHeader :: Response -&gt; Response\n    removeServerHeader r = trace (show $ responseHeaders r) $ mapResponseHeaders (filter (\\(k, _) -&gt; k /= \"Server\")) r\n\napp1 :: Application\napp1 = serve imageAPI1 server1\n\nmain :: IO ()\nmain = do\n  let port = 8080\n  putStrLn $ \"Starting server on port \" &lt;&gt; show port &lt;&gt; \".\"\n  run port $ removeServerHeaderMiddleware app1\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>$ http :8080/images\nHTTP/1.1 200 OK\nContent-Type: application/json;charset=utf-8\nDate: Sat, 15 Jun 2019 06:12:58 GMT\nServer: Warp/3.2.27\nTransfer-Encoding: chunked\n</code></pre>\n\n<p>Looking at trace, maybe the header gets added later?</p>\n\n<pre><code>[(\"Content-Type\",\"application/json;charset=utf-8\")]\n</code></pre>\n\n<p>I found <code>setServerName</code> in warp, but I have no clue how to incorporate that with servant.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 1944, "user_id": 1636613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fec4b4cf249a979fcb9b39a306bcce2?s=128&d=identicon&r=PG", "display_name": "Razzi Abuissa", "link": "https://stackoverflow.com/users/1636613/razzi-abuissa"}, "is_accepted": true, "score": 2, "last_activity_date": 1560561915, "creation_date": 1560561915, "answer_id": 56606659, "question_id": 56606590, "link": "https://stackoverflow.com/questions/56606590/pattern-matching-on-a-subset-of-my-data-in-haskell/56606659#56606659", "title": "Pattern matching on a subset of my data in haskell", "body": "<p>If your function is not able to process CV, then it can return <code>Nothing</code>. Here's a simplified example with just 2 options of data, that might demonstrate what you're looking to accomplish</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyType = CV | CA\n\nprocess :: MyType -&gt; Maybe String\nprocess CV = Nothing\nprocess CA = Just \"Got CA!\"\n\nmain = do\n  putStrLn \"Processing CA\"\n\n  case process CA of\n    Nothing -&gt; putStrLn \"Nothing\"\n    Just x -&gt; putStrLn x\n\n  putStrLn \"Processing CV\"\n\n  case process CV of\n    Nothing -&gt; putStrLn \"Nothing\"\n    Just x -&gt; putStrLn x\n</code></pre>\n\n<p>Then on the command line:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ runhaskell script.hs\nProcessing CA\nGot CA!\nProcessing CV\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "is_accepted": false, "score": 5, "last_activity_date": 1560562879, "last_edit_date": 1560562879, "creation_date": 1560562512, "answer_id": 56606698, "question_id": 56606590, "link": "https://stackoverflow.com/questions/56606590/pattern-matching-on-a-subset-of-my-data-in-haskell/56606698#56606698", "title": "Pattern matching on a subset of my data in haskell", "body": "<p>The simplest solution is to just split up your data:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyTypeNoCV \n  = CA MyType MyType\n  | CI\n  | CD\n  | CB\n\ndata MyType\n  = CV Int\n  | CNonV MyTypeNoCV\n</code></pre>\n\n<p>If you want to be more fancy, you can use GADTs give your data type an index. Here is an example where <code>Ty</code> is indexed by an <code>Index</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n\ndata Index = IsBaz | NotBaz\n\ndata Ty :: Index -&gt; * where\n  Foo :: Ty NotBaz\n  Bar :: Ty NotBaz\n  Baz :: Ty IsBaz\n\nf :: Ty NotBaz -&gt; Bool\nf Foo = True\nf Bar = False\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 1, "accepted_answer_id": 56606659, "answer_count": 2, "score": 0, "last_activity_date": 1560562879, "creation_date": 1560560956, "last_edit_date": 1560561305, "question_id": 56606590, "link": "https://stackoverflow.com/questions/56606590/pattern-matching-on-a-subset-of-my-data-in-haskell", "title": "Pattern matching on a subset of my data in haskell", "body": "<p>Suppose I have a structure:</p>\n\n<pre><code>data MyType \n  = CV Int \n  | CA MyType MyType\n  | CI\n  | CD\n  | CB\n</code></pre>\n\n<p>I have a function which expects MyType and I would like to match the following subset of the grammar only:</p>\n\n<pre><code>data MyTypeNoCV \n  = CA MyType MyType\n  | CI\n  | CD\n  | CB\n</code></pre>\n\n<p>I know this isn't possible to do in Haskell. Is there a way I would parametrize the structure to somehow tag the nodes?</p>\n\n<p>Could Data.Void possibly help?</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1560535335, "post_id": 56603025, "comment_id": 99782306, "body": "Why is this downvoted?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560535573, "post_id": 56603025, "comment_id": 99782394, "body": "Because there is an excellent paper which is very approachable and goes into great detail on exactly these questions linked in the documentation."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1560536375, "post_id": 56603025, "comment_id": 99782719, "body": "And pulling in that line of documentation to make this conversation more self-contained: &quot;The concurrency extension for Haskell is described in the paper Concurrent Haskell <a href=\"http://www.haskell.org/ghc/docs/papers/concurrent-haskell.ps.gz\" rel=\"nofollow noreferrer\">haskell.org/ghc/docs/papers/concurrent-haskell.ps.gz</a>&quot;"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560539147, "post_id": 56603025, "comment_id": 99783873, "body": "@DanielWagner would you point out documentation link where to read about sharing of the CPU quantum between unbound Haskell threads? I can not find any Haskell documentation about such low details, but I have feeling that all &quot;magic&quot; is reducing to POSIX threads in the implementation that are started as LWP (bound) or user-space threads (unbound). Right?"}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1560536352, "post_id": 56603258, "comment_id": 99782710, "body": "Is there <i>any</i> performance benefit to <code>forkOS</code>? I was under the impression that <code>forkOS</code> is exactly like <code>forkIO</code>, except the created thread is not allowed to move between OS threads, which seems like it can only be slower (unless there&#39;s some other cost for moving between OS threads)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1560537616, "post_id": 56603258, "comment_id": 99783260, "body": "@HTNW Probably there isn&#39;t. Edited."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1560538856, "post_id": 56603258, "comment_id": 99783761, "body": "@HTNW &quot;slow&quot; is sense of context switching? It&#39;s different"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1560539471, "post_id": 56603258, "comment_id": 99784005, "body": "About 2. If the threads are user-space, how OS can sparse them on OS processes? What library is using under the hood? POSIX threads? Did you mean bound threads only?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1560540563, "post_id": 56603258, "comment_id": 99784459, "body": "Bound threads aren&#39;t any faster. They&#39;re often slower, in fact, as they can&#39;t move between capabilities in the work-stealing queues. The only thing bound threads buy you is compatibility with libraries that use thread-local data, as they guarantee all FFI calls from them will come from the same native thread."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1560570350, "post_id": 56603258, "comment_id": 99790084, "body": "&gt;&quot;Bound threads aren&#39;t any faster&quot; - what kind of &quot;speed&quot; do you mean? Context switching? Because it&#39;s just process and CPU executes it&#39;s machine instructions as anything else. Unbound threads are just user-space POSIX threads that do share OS scheduler resource which is bad. OS processes allow maximal isolation (avoid of interferences), so they have own OS schedule resource, are always planning on all cores, etc. I found here question about forkIO where one unbound thread blocked all other with <code>-thread</code> option due to heavy loading: seems there are interferences: just pthreads are under hood"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1560537694, "last_edit_date": 1560537694, "creation_date": 1560535824, "answer_id": 56603258, "question_id": 56603025, "link": "https://stackoverflow.com/questions/56603025/implementation-of-haskells-forkio/56603258#56603258", "title": "Implementation of Haskell&#39;s forkIO", "body": "<ol>\n<li><p>Haskell threads use cooperative multi-threading. Essentially, each time Haskell needs to allocate memory, it checks if enough time has passed, and if so it switches to the next thread. The exact mechanism is a bit more sophisticated (I think at some point it also involved POSIX signals e.g. 'alarm'), but this should be the main idea.</p></li>\n<li><p>The runtime system makes N Haskell threads run over K OS threads. K can be chosen by the user. It's the OS which then decides on which core(s) each OS thread is run -- this might always be the same core or not.</p></li>\n<li><p>IO heavy operations should not be a big issue. The Haskell runtime uses nonblocking IO and poll/select to multiplex IO over all threads. Also, if you have two running Haskell threads and you dedicate at least two OS threads to the runtime, these should be run over the OS threads, which the OS should allocate to both cores. Feel free to experiment with<code>forkIO</code> vs <code>forkOS</code> to see which provides the best performance for your case, but <code>forkIO</code> should be better in virtually all cases.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "is_accepted": true, "score": 0, "last_activity_date": 1560755774, "last_edit_date": 1560755774, "creation_date": 1560591024, "answer_id": 56609118, "question_id": 56603025, "link": "https://stackoverflow.com/questions/56603025/implementation-of-haskells-forkio/56609118#56609118", "title": "Implementation of Haskell&#39;s forkIO", "body": "<p>Little testing on Windows 10 with 4 core CPU shows results:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad\nimport Control.Concurrent\n\nt1 = forever $ print \"1\"\nt2 = forever $ print \"2\"\n\nmain :: IO ()\nmain = do\n  t1id &lt;- forkOS t1 -- I tried forkOS and forkIO\n  t2id &lt;- forkOS t2\n  getLine\n  putStrLn \"Done\"\n</code></pre>\n\n<p>Both, <code>forkIO</code> and <code>forkOS</code> requires <code>ghc-options: -threaded</code> option to utilize mutli-thread execution. In both cases I see only one OS process, but multiple threads. In the case of <code>forkIO</code> threads number is 4, while in the case of <code>forkOS</code> I get only 3. More interesting is the number of context switches, it's different from mentioned suggestions: in the case of <code>forkIO</code> they are (for different threads): 480000 and 48... and in the case of <code>forkOS</code> they are about 2, 3, 16 for the same time period. This means that <code>forkIO</code> makes more context switches than <code>forkOS</code> (<strong>hundreds of thousands vs tens</strong>) and summary execution time of the same valuable effect should be greater, so <code>forkOS</code> looks more preferable on Windows box.</p>\n\n<p>As I see in GHC source code, POSIX threads are using under the hood.</p>\n\n<p><strong>EDIT</strong>. Linux test (<code>ps -eLf</code>):</p>\n\n<p>forkOS:</p>\n\n<pre><code>UID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\n...        ...   ...   ... ... ...   ... ...           ... ...\nxyz     7432  4865  7432  0    7 10:03 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7448  0    7 10:03 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7449  0    7 10:03 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7450  0    7 10:03 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7451 66    7 10:03 pts/0    00:00:06 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7452  0    7 10:03 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     7432  4865  7453 67    7 10:03 pts/0    00:00:06 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\n</code></pre>\n\n<p>forkIO:</p>\n\n<pre><code>UID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\n...        ...   ...   ... ... ...   ... ...           ... ...\nxyz     8209  4865  8209  0    6 10:08 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     8209  4865  8225  0    6 10:08 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     8209  4865  8226  0    6 10:08 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     8209  4865  8227  0    6 10:08 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     8209  4865  8228 99    6 10:08 pts/0    00:00:06 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\nxyz     8209  4865  8229  0    6 10:08 pts/0    00:00:00 /home/xyz/prj/thr/.stack-work/install/x86_64-linux-tinfo6/lts-13.25/8.6.5/bin/yohoho\n</code></pre>\n\n<p>In Linux in <code>forkIO</code> case we have only 6 LWPs and one of them utilizes CPU on 99%. In the case of <code>forkOS</code> we have 7 LWPs, and 2 of them utilize CPU on about 66%, which from my point of view, looks better. So, seems that <code>forkOS</code> is more preferable in Linux too.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 1, "accepted_answer_id": 56609118, "answer_count": 2, "score": 3, "last_activity_date": 1560755774, "creation_date": 1560534605, "question_id": 56603025, "link": "https://stackoverflow.com/questions/56603025/implementation-of-haskells-forkio", "title": "Implementation of Haskell&#39;s forkIO", "body": "<p>Different OSes have different concurrency subsystems, there are OS processes, POSIX threads and today also \"LWP\" threads in Linux, Windows has processes, fibers, threads, etc. Each process is scheduling by OS scheduler and gets own quantum of CPU time. This is true for Linux \"LWP\"s because they are processes but sharing memory space, and it's not true for user-space threads, where all threads share one CPU time quantum.</p>\n\n<p>Haskell has forkIO. I found in the Haskell sources next commentaries:</p>\n\n<blockquote>\n  <p>Scheduling of Haskell threads is done internally in the Haskell\n  runtime system, and doesn't make use of any operating system-supplied\n  thread packages.</p>\n</blockquote>\n\n<p>also</p>\n\n<blockquote>\n  <p>In terms of performance, 'forkOS' (aka bound) threads are much more\n  expensive than 'forkIO' (aka unbound) threads, because a 'forkOS'\n  thread is tied to a particular OS thread, whereas a 'forkIO' thread\n  can be run by any OS thread.  Context-switching between a 'forkOS'\n  thread and a 'forkIO' thread is many times more expensive than between\n  two 'forkIO' threads.</p>\n</blockquote>\n\n<p>which emphasizes that threads created with <code>forkIO</code> are not scheduling by the OS scheduler. They, as I understand, can be free from common blocking (with <code>-thread</code> option, sure), but however in the case there are 3 open questions for me:</p>\n\n<ol>\n<li>how do they (\"threads\" created with forkIO) share those CPU quantum?</li>\n<li>will they be guaranteed to be distributed to different cores or, since they are represented by one process, no? Or is this non-deterministic behavior?</li>\n<li>Am I right that to avoid interference effects is better to use <code>forkOS</code> than <code>forkIO</code>? I mean if I have 2 threads and one of them serves HTTP and another one makes heavy disk I/O operation, then better solution will be to use <code>forkOS</code> than <code>forkIO</code>? </li>\n</ol>\n"}, {"tags": ["haskell", "constraints", "typeclass", "coerce"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1560521772, "post_id": 56599241, "comment_id": 99775832, "body": "It <i>definitely</i> isn&#39;t sensible to ask for a value with the type you propose. Can you add <code>RealFrac</code> to your constraints? If not, what type do you want to use this with? Perhaps we can help you do something sensible with that type -- but definitely not with <i>every</i> possible pairing of <code>Floating</code> and <code>RealFrac</code> instances."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1560522484, "post_id": 56599241, "comment_id": 99776185, "body": "I <i>agree</i> with your request. IMO, the <code>Num</code> class should have and associated synonym <code>type Abs a :: *</code> and then <code>abs :: a -&gt; Abs a</code> and <code>fromAbs :: Abs a -&gt; a</code>. Then your constraint could be changed to <code>(Floating a, RealFrac (Abs a))</code>, and it would work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1560544297, "post_id": 56599241, "comment_id": 99785768, "body": "@leftaroundabout, aside from <code>abs</code> and <code>signum</code>, <code>Num</code> is just ring operations. What do each of those add to a ring, mathematically?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1560522808, "post_id": 56600173, "comment_id": 99776341, "body": "I&#39;m not sure I like this example. Many <code>Num</code> instances, although you <i>can</i> define them, don&#39;t really make sense mathematically \u2013 specifically, the <code>Num</code> instances for vector types like those from <code>hmatrix</code> and <code>linear</code> caused me all sorts of headache through weird bugs that <i>could</i> have been caught by the type checker, if not for the <code>Num</code> instance that allowed innocuous number-literals to get inferred and unwanted vector type. The correct instance is usually <code>VectorSpace</code> and subclasses of that. For functions, I&#39;m torn \u2013 this instance <i>makes</i> sense, but there might still be better classes."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1560525424, "post_id": 56600173, "comment_id": 99777936, "body": "The <code>instance Num a =&gt; Num (IO a)</code> instance you propose is not lawful; there is a law saying <code>abs x * signum x = x</code>, and this is not validated for <code>x = putStrLn &quot;hi!&quot; &gt;&gt; return 42</code>. (But the rest of the argument is sound. Just a minor quibble.)"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 2, "creation_date": 1560550782, "post_id": 56600173, "comment_id": 99787574, "body": "There&#39;s <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Complex.html#t:Complex\" rel=\"nofollow noreferrer\"><b><code>Data.Complex.Complex</code></b></a> as another example of a type that implements <code>Floating</code> but not <code>RealFrac</code> (and there really isn&#39;t a good instance of <code>RealFrac</code> for it)."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1560551656, "post_id": 56600173, "comment_id": 99787768, "body": "@M.Aroosi Yeah, but you could sensibly apply <code>abs</code> to a complex number to get a real result, as suggested by OP."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1560575110, "post_id": 56600173, "comment_id": 99790642, "body": "You don&#39;t even need to go all the way to <code>IO</code> to for your &quot;generalization&quot; to become unlawful. Consider <code>Maybe</code>. You don&#39;t satisfy <code>x + negate x = fromInteger 0</code> when <code>x</code> is <code>Nothing</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560625066, "post_id": 56600173, "comment_id": 99801204, "body": "I think <code>e -&gt; a</code> is an excellent example already. Since we don&#39;t know what <code>e</code> is, and since it could even be something like <code>Void</code>, there&#39;s absolutely no way to use the argument function! So a function with the requested polymorphic type must be constant and therefore not a ring homomorphism."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 6, "last_activity_date": 1560523215, "last_edit_date": 1560523215, "creation_date": 1560522469, "answer_id": 56600173, "question_id": 56599241, "link": "https://stackoverflow.com/questions/56599241/is-there-a-standard-haskell-function-with-type-floating-a-realfrac-b-a/56600173#56600173", "title": "Is there a standard Haskell function with type: (Floating a, RealFrac b) =&gt; a -&gt; b?", "body": "<p>Consider the following instance of <code>Floating</code>:</p>\n\n<pre><code>import Control.Applicative\n\ninstance (Num a) =&gt; Num (e -&gt; a) where\n    (+) = liftA2 (+)\n    (*) = liftA2 (*)\n    (-) = liftA2 (-)\n    abs = fmap abs\n    signum = fmap signum\n    negate = fmap negate\n    fromInteger = pure . fromInteger\n\ninstance (Fractional a) =&gt; Fractional (e -&gt; a) where\n    fromRational = pure . fromRational\n    recip = fmap recip\n    (/) = liftA2 (/)\n\ninstance (Floating a) =&gt; Floating (e -&gt; a) where\n    pi = pure pi\n    exp = fmap exp\n    log = fmap log\n    sin = fmap sin\n    cos = fmap cos\n    asin = fmap asin\n    acos = fmap acos\n    atan = fmap atan\n    sinh = fmap sinh\n    cosh = fmap cosh\n    asinh = fmap asinh\n    acosh = fmap acosh\n    atanh = fmap atanh\n</code></pre>\n\n<p>Demo:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    print (sqrt sqrt 81)\n    let f = sin^2 + cos^2\n    print (f 42)\n</code></pre>\n\n<p>(This outputs <code>3.0000000000000004</code> and <code>1.0</code>.)</p>\n\n<p>This makes functions an instance of <code>Floating</code>, but the code generalizes to all types that are <code>Monad</code>s or <code>Applicative</code>s.</p>\n\n<p>Your hypothetical function would need to have the type</p>\n\n<pre><code>(Floating a, RealFrac b) =&gt; (e -&gt; a) -&gt; b\n</code></pre>\n\n<p>in this instance. We could set <code>a</code> and <code>b</code> to <code>Double</code>:</p>\n\n<pre><code>(e -&gt; Double) -&gt; Double\n</code></pre>\n\n<p>How do you implement that operation?</p>\n\n<p>Remember that I said this generalizes to all Applicatives? We can replace <code>e -&gt;</code> by <code>IO</code> in the above instances. Then the type you end up with gets even worse:</p>\n\n<pre><code>IO Double -&gt; Double\n</code></pre>\n\n<p>The problem is that <code>Floating</code> can be anything that supports e.g. <code>exp</code> or <code>sin</code> operations (which could be purely symbolic operations e.g. on a syntax tree) while <code>RealFrac</code> must be a number (or something convertible to a number).</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 0, "last_activity_date": 1560557376, "last_edit_date": 1560557376, "creation_date": 1560540957, "answer_id": 56604205, "question_id": 56599241, "link": "https://stackoverflow.com/questions/56599241/is-there-a-standard-haskell-function-with-type-floating-a-realfrac-b-a/56604205#56604205", "title": "Is there a standard Haskell function with type: (Floating a, RealFrac b) =&gt; a -&gt; b?", "body": "<p>Can you afford an <code>Ord</code> constraint?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module FBound (ffloor, fceil) where\nimport Data.List (foldl')\n\n-- |\n-- &gt;&gt;&gt; ffloor . fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\n-- &gt;&gt;&gt; ffloor . (+0.001) . fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\n-- &gt;&gt;&gt; ffloor . (+0.999) . fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\nffloor :: (Ord a, Floating a, Integral b) =&gt; a -&gt; b\nffloor a | a &gt;= 0     = ffloor' a\n         | otherwise  = negate $ fceil' (-a)\n\n-- |\n-- &gt;&gt;&gt; fceil. fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\n-- &gt;&gt;&gt; fceil . (-0.001) . fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\n-- &gt;&gt;&gt; fceil . (-0.999) . fromInteger &lt;$&gt; [-10..10]\n-- [-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10]\nfceil :: (Ord a, Floating a, Integral b) =&gt; a -&gt; b\nfceil a | a &gt;= 0     = fceil' a\n        | otherwise  = negate $ ffloor' (-a)\n\n-- given a &gt;= 0, ffloor' a &lt;= a &lt; ffloor' a + 1\nffloor' :: (Ord a, Floating a, Integral b) =&gt; a -&gt; b\nffloor' = foldl' roundDown 0 . reverse . takeWhile (&gt;=1) . iterate (/2)\n\n-- given a &gt;= 0, fceil' a - 1 &lt; a &lt;= fceil' a\nfceil' :: (Ord a, Floating a, Integral b) =&gt; a -&gt; b\nfceil' a = ffloor' (a/2) `roundUp` a\n\n-- given 2*i &lt;= a &lt; 2*i + 2, roundDown i a &lt;= a &lt; roundDown i a + 1\nroundDown :: (Ord a, Num a, Integral b) =&gt; b -&gt; a -&gt; b\nroundDown i a | a &lt; fromIntegral (2*i + 1) = 2*i\n              | otherwise                  = 2*i + 1\n\n-- given 2*i &lt;= a &lt; 2*i + 2, roundUp i a - 1 &lt; a &lt;= roundUp i a\nroundUp :: (Ord a, Num a, Integral b) =&gt; b -&gt; a -&gt; b\nroundUp i a | a == fromIntegral (2*i)     = 2*i\n            | a &lt;= fromIntegral (2*i + 1) = 2*i + 1\n            | otherwise                   = 2*i + 2\n</code></pre>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1560557376, "creation_date": 1560518964, "last_edit_date": 1560521523, "question_id": 56599241, "link": "https://stackoverflow.com/questions/56599241/is-there-a-standard-haskell-function-with-type-floating-a-realfrac-b-a", "title": "Is there a standard Haskell function with type: (Floating a, RealFrac b) =&gt; a -&gt; b?", "body": "<p>I need to call <code>floor()</code> on a value, which is only constrained to be of class <code>Floating</code>, but <code>floor()</code> requires <code>RealFrac</code>.</p>\n\n<p><strong>How can I do this?</strong></p>\n\n<p>I'm perfectly willing to call <code>abs()</code> before calling <code>floor()</code>, but this alone seems insufficient to solve my constraint conflict.\nAnd <code>coerce</code> complains that the two representations cannot be assumed equivalent, which isn't surprising.</p>\n\n<p>It seems what I need is a function with type signature:</p>\n\n<p><code>(Floating a, RealFrac b) =&gt; a -&gt; b</code></p>\n\n<p>And it seems (to me) perfectly legitimate to give some augmented version of <code>abs()</code> this signature.\nAlas, a Hoogle search on the above type signature left me empty handed.</p>\n\n<p>Any thoughts?</p>\n\n<p>Thanks.<br>\n:)</p>\n"}, {"tags": ["haskell", "haskell-stack", "package-managers"], "comments": [{"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "edited": false, "score": 0, "creation_date": 1560505708, "post_id": 56595516, "comment_id": 99767618, "body": "The hardest part is giving in to a broken dependency ecosystem. When each package that relies on a reusable dependency needs its own independent &quot;reusable&quot; copy, you know you have failed hard somewhere."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "edited": false, "score": 0, "creation_date": 1560507177, "post_id": 56595516, "comment_id": 99768326, "body": "@spectras Sorry but I can&#39;t follow you, could you please give a more detailed description?"}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "edited": false, "score": 2, "creation_date": 1560511489, "post_id": 56595516, "comment_id": 99770430, "body": "The whole point of making re-usable packages is to re-use them. If, when 50 things depend on a package, you end up having 50 copies of the package, like NPM does, your package system failed. What you describe is a broken dependency ecosystem. It is something you want to avoid, not strive for. (Note: I am not blaming NPM itself for the sorry state of JS dependencies, it has to work with what it&#39;s given)."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1560521306, "post_id": 56595516, "comment_id": 99775608, "body": "The practical reason is that Haskell is a compiled language and needs all dependencies to be resolved at compile or link time. You will find the same constraint in C or C++."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560522235, "post_id": 56595516, "comment_id": 99776067, "body": "Can you be more specific about your &quot;this design is too ideal to work in the real world&quot;? What do you believe is stopping it from working? (To my admittedly somewhat naive eyes, it appears to be working pretty well in the very real world we inhabit today.)"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "edited": false, "score": 0, "creation_date": 1560528937, "post_id": 56595516, "comment_id": 99779716, "body": "@spectras If I have to choose between &quot;have copies of different revisions of same package&quot; and &quot;need to use packages careful to avoid diamond-rely-on case&quot;,  I will prefer the former.  And the redurant can be optmized if the package manager is implemented well."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560529513, "post_id": 56595516, "comment_id": 99779955, "body": "@DanielWagner Yes, I mean, the package maintainer is pushed to update his packages&#39; dependencies so that it will not conflict with the recent snapshot, and this makes haskell&#39;s ecosystem fragile (a package may be absent from the latest snapshot someday just because the mantainer have no time to update it&#39;s dependencies),  this makes lot of packages absent from stack, Just have a look at how many recently created Haskell packages choose not using stack."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1561929150, "post_id": 56595516, "comment_id": 100208682, "body": "Stack isn&#39;t limited to using dependencies which are included in a snapshot."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1560522191, "creation_date": 1560522191, "answer_id": 56600100, "question_id": 56595516, "link": "https://stackoverflow.com/questions/56595516/is-it-possible-to-design-stack-haskell-just-like-npm-nodejs/56600100#56600100", "title": "Is it possible to design Stack (Haskell) just like NPM (NodeJS)?", "body": "<p>Yes, it is possible. In fact, <code>cabal</code> used to work that way by default. It was abandoned in the move to nix-style builds, but as far as I know there's no technical problem standing in the way of doing it again.</p>\n\n<p>That said, my experience with nix-style builds is that it is rare to find that forcing each package in the dependency tree to a specific version prevents you from being able to construct a build plan. I'm not sure whether this is so with <code>stack</code>, too -- I don't have much experience with it -- but at least for <code>cabal</code> at the moment there seems little benefit to doing that, and so the simple design with the simpler failure modes seems much more desirable.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1560522191, "creation_date": 1560505334, "question_id": 56595516, "link": "https://stackoverflow.com/questions/56595516/is-it-possible-to-design-stack-haskell-just-like-npm-nodejs", "title": "Is it possible to design Stack (Haskell) just like NPM (NodeJS)?", "body": "<p>The <a href=\"https://docs.haskellstack.org/\" rel=\"nofollow noreferrer\">Haskell Tool Stack</a> is the most popular Haskell package manager for now, it's main goal is to make building haskell packages reproducible.</p>\n\n<p>But the way stack approach it's goal is to find a huge no-conflict-set of package-revisions, and call it <code>snapshot</code>. In this way, the package maintainer is pushed to update his packages' dependencies so that it will not conflict with the recent <code>snapshot</code>.</p>\n\n<p>I have to say, this design is too ideal to work in the real world.</p>\n\n<p>For comparison, NPM (the package manager of NodeJS) approaches this goal via a more practical way: it allows redundancy. In diamond-rely-on case such as <code>a -&gt; b, c; b -&gt; d(v1); c -&gt; d(v2)</code>, NPM just install two different version of <code>d</code> separately for <code>b</code> and <code>c</code>. This way, users who using packages can depending on a package like a blackbox, no need to consider if there is conflicting-deep-dependencies between it's dependences.</p>\n\n<p>I'm wondering is there some practical reason why Stack is not designed to allow redundant revisions of a package. Is it possible to implement such a package manager for Haskell? What is the hardest part of it's implementation?</p>\n"}, {"tags": ["haskell", "ghc", "typeclass", "type-families", "deriving"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560504138, "post_id": 56595002, "comment_id": 99766775, "body": "It will &quot;inherit&quot; the constraint, like <code>instance IsRecord Bar =&gt; Foo Bar</code>."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560504187, "post_id": 56595002, "comment_id": 99766806, "body": "Yeah, but that shouldn&#39;t compile, right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1560504300, "post_id": 56595002, "comment_id": 99766868, "body": "why not? The constraint is false, but that is not a problem. If you later add the instance, in a module that uses this, then it becomes &quot;available&quot;."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560504457, "post_id": 56595002, "comment_id": 99766945, "body": "I understand that in practice this is not a problem, but my question goes towards <i>what</i> is the difference between those two things."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1560504752, "post_id": 56595002, "comment_id": 99767089, "body": "that you simply say that <i>if</i> <code>IsRecord Bar</code> holds, then we can define an <code>instance Foo Bar</code> as specified in that instance. For now that constraint does not hold, if you later add an instance, for example in <i>another</i> module, then the constraint is true, and hence you get an instance. It thus adds extra flexibility."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560505105, "post_id": 56595002, "comment_id": 99767281, "body": "For example in the source code there are instance declarations like <code>instance HasCallStack =&gt; PrintStack</code> that are thus available, given the system uses a call stack. This instance is thus only avaiable then."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560509349, "post_id": 56595002, "comment_id": 99769360, "body": "I see now, thanks! If you could post an answer, I can mark it as the solution. @WillemVanOnsem"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1560525553, "last_edit_date": 1560525553, "creation_date": 1560523446, "answer_id": 56600463, "question_id": 56595002, "link": "https://stackoverflow.com/questions/56595002/deriveanyclass-vs-empty-instance/56600463#56600463", "title": "DeriveAnyClass vs Empty Instance", "body": "<p>Wow! I was going to mark this as a duplicate of <a href=\"https://stackoverflow.com/q/39379006/791604\">What is the difference between <code>DeriveAnyClass</code> and an empty instance?</a>, but it seems the behavior of GHC has changed since that question was asked and answered!</p>\n\n<p>Anyway, if you ask -- either with <code>:i</code> inside ghci or with <code>-ddump-deriv</code> before starting ghci -- what the compiler has done, it's clear what the difference is in your case:</p>\n\n<pre><code>&gt; :i Bar\ndata Bar = Bar  -- Defined at test.hs:15:1\ninstance IsRecord Bar =&gt; Foo Bar -- Defined at test.hs:16:13\n</code></pre>\n\n<p>Indeed, if you change the non-<code>DeriveAnyClass</code> version of your code to match, writing</p>\n\n<pre><code>instance IsRecord Bar =&gt; Foo Bar\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>instance Foo Bar\n</code></pre>\n\n<p>everything works fine. The details of how this instance context was chosen seem a bit complicated; you can read what the GHC manual has to say about it <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#deriving-any-other-class\" rel=\"nofollow noreferrer\">here</a>, though I suspect the description there is either not quite precise or not complete, as I don't get the same answer the compiler does here if I strictly follow the rules stated at the documentation. (I suspect the <em>true</em> answer is that it writes the instance first, then just does the usual type inference thing and copies any constraints it discovers in that way into the instance context.)</p>\n"}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1577, "favorite_count": 0, "accepted_answer_id": 56600463, "answer_count": 1, "score": 2, "last_activity_date": 1560525553, "creation_date": 1560503578, "question_id": 56595002, "link": "https://stackoverflow.com/questions/56595002/deriveanyclass-vs-empty-instance", "title": "DeriveAnyClass vs Empty Instance", "body": "<p>Suppose that I have this type family that throws a custom type error during compile time if the type passed to it is not a record:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type family IsRecord (a :: Type) where\n  ...\n</code></pre>\n\n<p>Now I have this type class that has methods with default implementations, but requires that the type is a record, by adding the <code>IsRecord</code> constraint:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class IsRecord a =&gt; Foo a where\n  foo :: Text\n  foo = \"foo\"\n</code></pre>\n\n<p>When trying to use it incorrectly, if we use it as a regular instance with a type that is not a record, it successfully fails to compile:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Bar = Bar\n\ninstance Foo Bar   -- error: Bar is not a record\n</code></pre>\n\n<p>But if I enable <code>-XDeriveAnyClass</code> and add it to the deriving clause, this doesn't fail to compile, ignoring completely the constraint:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Bar = Bar\n  deriving (Foo)\n</code></pre>\n\n<p>I understand that <code>DeriveAnyClass</code> generates an empty instance declaration, which is what I'm doing on the first example, but still it doesn't throw the error. What's going on?</p>\n\n<p>I'm using GHC 8.6.4</p>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1560498471, "post_id": 56593610, "comment_id": 99764189, "body": "You need brackets: <code>(map chr . map (1+) . map ord) [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</code>. Otherwise it gets evaluated as <code>map chr . map (1+) . (map ord [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;])</code>, which doesn&#39;t work as that last bit is a value rather than a function."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1560498504, "post_id": 56593610, "comment_id": 99764206, "body": "(Also, <code>map chr . map (1+) . map ord</code> is equivalent to <code>map (chr . (1+) . ord)</code>.)"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1560498821, "post_id": 56593610, "comment_id": 99764342, "body": "Lol, in the time it took me to write my answer @bradrn has said just about everything in it in 2 short comments :)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1560498899, "post_id": 56593610, "comment_id": 99764372, "body": "@RobinZigmond But your answer went into much more detail! While I didn&#39;t even bother explaining it properly..."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1560510501, "post_id": 56593791, "comment_id": 99769930, "body": "The form <code>f . g . h $ arg</code> is also fairly idiomatic in Haskell. In the specific case, I&#39;d also exploit <code>chr . (1+) . ord == succ</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1560523065, "post_id": 56593791, "comment_id": 99776498, "body": "Thanks @chi, I use that first idiom myself and am not sure how I managed to leave it out of the answer. And I forgot that <code>Char</code> was an instance of <code>Enum</code> and therefore didn&#39;t think of <code>succ</code>, which of course simplifies it greatly."}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 5, "last_activity_date": 1560534004, "last_edit_date": 1560534004, "creation_date": 1560498769, "answer_id": 56593791, "question_id": 56593610, "link": "https://stackoverflow.com/questions/56593610/understanding-the-map-function-with-function-composition/56593791#56593791", "title": "Understanding the map function with function composition", "body": "<p>Operators (defined as functions with no alphanumeric characters in their name, which are used in infix style) have lower precedence than other functions in Haskell. Therefore your expression:</p>\n\n<pre><code>map chr . map (1+) . map ord ['a', 'b', 'c', 'd', 'e']\n</code></pre>\n\n<p>is parsed as:</p>\n\n<pre><code>(map chr) . (map (1+)) . (map ord ['a', 'b', 'c', 'd', 'e'])\n</code></pre>\n\n<p>And this doesn't make any sense - the <code>.</code> operator combines 2 functions, and <code>map ord ['a', 'b', 'c', 'd', 'e']</code> is not a function, but a list of numbers.</p>\n\n<p>But there are still better alternatives to your correct version with all the nested parentheses. What you want to do is start with the list of characters, and successively <code>map</code> 3 functions over it. That, by definition of function composition, is the same as applying the composition of the 3 <code>map</code> s to it, ie:</p>\n\n<pre><code>(map chr . map (1+) . map ord) ['a', 'b', 'c', 'd', 'e']\n</code></pre>\n\n<p>which as @chi points out below, would often be written like this, using the function application operator <code>$</code> (which has lower precedence than any other operator) to avoid the need for any parentheses:</p>\n\n<pre><code>map chr . map (1+) . map ord $ ['a', 'b', 'c', 'd', 'e']\n</code></pre>\n\n<p>And, because <code>map f . map g</code> is always the same as <code>map (f . g)</code> (this should be obvious when you stop to think about what these expressions mean - it's also the fundamental law the <code>map</code> operation must satisfy in order to make the list type into a <code>Functor</code>), this can be alternatively written as:</p>\n\n<pre><code>map (chr . (1+) . ord) ['a', 'b', 'c', 'd', 'e']\n</code></pre>\n\n<p>In my opinion this is the best and most readable version. </p>\n\n<p>Although even better, as @chi again points out, is to use that <code>chr . (1+) . ord</code> is equivalent to <code>succ</code>, the built-in function for getting the \"next\" value of a type that can be enumerated. So you can just write <code>map succ ['a', 'b', 'c', 'd', 'e']</code></p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 56593791, "answer_count": 1, "score": 0, "last_activity_date": 1560534004, "creation_date": 1560498069, "last_edit_date": 1560507300, "question_id": 56593610, "link": "https://stackoverflow.com/questions/56593610/understanding-the-map-function-with-function-composition", "title": "Understanding the map function with function composition", "body": "<p>I have the following Haskell expression:</p>\n\n<pre><code>let increment x = 1 + x\nin \\xs -&gt; map chr (map increment (map ord xs))\n</code></pre>\n\n<p>I know that the above expression takes a list, and applies the <code>ord</code> function to each element in the list. For a list of chars, the result would be a list of integers (the ASCII value). The <code>increment</code> function then increments each integer in the list by 1. The <code>chr</code> function then converts each integer back into its corresponding character. </p>\n\n<p>And I also have the following expression:</p>\n\n<pre><code>map chr . map (1+) . map ord\n</code></pre>\n\n<p>I am trying to figure out whether the above is equivalent to the first expression.\nHowever when I tried the above expression in GHCI, I got an error:</p>\n\n<pre><code>map chr . map (1+) . map ord ['a', 'b', 'c', 'd', 'e']\n</code></pre>\n\n<p>I am not sure why the expression didn't work. Since function composition is used, wouldn't the expression be evaluated as:</p>\n\n<pre><code>(map chr (map (1+) (map ord ['a', 'b', 'c', 'd', 'e'])))\n</code></pre>\n\n<p>With <code>map (1+)</code> getting a list as a result of <code>map ord</code>, and <code>map chr</code> getting a list as a result of <code>map (1+)</code>?</p>\n"}, {"tags": ["haskell", "rust"], "comments": [{"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 3, "creation_date": 1560490697, "post_id": 56591730, "comment_id": 99761000, "body": "Seems that Rust&#39;s <code>scan</code> isn&#39;t quite the equivalent to Haskell&#39;s <code>scanl</code>; they had to ammend the documentation since it <a href=\"https://github.com/rust-lang/rust/pull/49353/commits/f198b0acf512458bdbe5079d12414ff94b03f7ac\" rel=\"nofollow noreferrer\">confused people</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1560500885, "post_id": 56591730, "comment_id": 99765221, "body": "&quot;The awkward scan behaviour of having to mutate the accumulator can be explained by a lack of GC. &quot; no"}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1560516157, "post_id": 56591730, "comment_id": 99772770, "body": "@Stargateur No? What&#39;s the reason then? The way I see it, if Rust wanted to implement Haskell&#39;s <code>scanl</code>&#39; behavior, the closure would have to clone it&#39;s value because the value needs to go back into the accumulator as well as get returned in a list, and cloning would affect performance. So, the decision of whether to clone was pushed to the user of the API. For numbers, there&#39;s no need, just some awkwardness of <code>*acc += x; Some(*acc)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560526275, "post_id": 56591730, "comment_id": 99778358, "body": "FWIW I have often found it quite annoying that Haskell&#39;s <code>scanl</code> has that extra element on the front. In almost all situations where <code>scanl</code> is actually useful I&#39;ve found myself calling <code>drop 1</code> on the result."}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1560530771, "post_id": 56591730, "comment_id": 99780481, "body": "@DanielWagner I can appreciate that perspective. I haven\u2019t had to simply because the formulas I\u2019m implementing use the initial value."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561235510, "post_id": 56591730, "comment_id": 99999296, "body": "@DanielWagner why not use <code>scanl1</code> then."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561238275, "post_id": 56591730, "comment_id": 99999824, "body": "@WillNess Because its type is too restrictive: the accumulator and the list element type must match."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561276066, "post_id": 56591730, "comment_id": 100004591, "body": "@DanielWagner exactly; but that is what you get when prepending the initial element to the input list, just the same. I thought that was what you meant, from the conversation&#39;s context. the OP thought so too, it seems."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561323291, "post_id": 56591730, "comment_id": 100015098, "body": "@WillNess You say &quot;that is what you get&quot;. What is &quot;that&quot;? You say &quot;the initial element&quot;. What is the initial element? I don&#39;t really understand what you&#39;re objecting to or why you think the OP misunderstood me."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561329081, "post_id": 56591730, "comment_id": 100016134, "body": "@DanielWagner I&#39;m not objecting to anything. It was a misunderstanding on my part. By &quot;you&quot; I meant &quot;we&quot; i.e. a generic user. the OP <a href=\"https://stackoverflow.com/questions/56591730/how-do-i-replicate-haskells-scanl-0-xs-in-rust#comment99780481_56591730\">said</a> they &quot;use the initial value&quot; (the <code>x</code> in <code>scanl g x xs</code>) (in response to your preceding comment) which I took as being contrasted with you supposedly not using it? that&#39;s how I understood their comment, and by consequence, yours. So I erroneously thought you meant <code>scanl1 g (x:xs)</code> instead, which doesn&#39;t even make much sense to me now."}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1560492398, "post_id": 56591982, "comment_id": 99761562, "body": "instead of <code>res[res.len() - 1]</code> one could use <code>res.last().unwrap()</code>, which makes the intention more clear imho"}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 0, "creation_date": 1560519178, "post_id": 56591982, "comment_id": 99774458, "body": "Thanks. Using <code>fold</code> with a vector certainly works, but circumvents the whole purpose of the <code>scan</code> function."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 0, "creation_date": 1560549551, "post_id": 56591982, "comment_id": 99787288, "body": "@Listerone Yes this approach mimics the scan&#39;s intermediate form but not in a lazily way.It would be a better composition integrating successors to my generic approach."}], "tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": false, "score": 9, "last_activity_date": 1561233161, "last_edit_date": 1561233161, "creation_date": 1560490672, "answer_id": 56591982, "question_id": 56591730, "link": "https://stackoverflow.com/questions/56591730/how-do-i-replicate-haskells-scanl-0-xs-in-rust/56591982#56591982", "title": "How do I replicate Haskell&#39;s `scanl (+) 0 xs` in Rust?", "body": "<h2>Edit :</h2>\n\n<p>Despite the old version of this answer mimics the behavior of <code>scanl</code>'s intermediate form, the execution wasn't lazy. Updated the generic implementation from my old answer with <a href=\"https://stackoverflow.com/a/56593816/1601571\">@French Boiethios's answer</a>. </p>\n\n<p>This is the implementation :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn scanl&lt;'u, T, F&gt;(op: F, initial: T, list: &amp;'u [T]) -&gt; impl Iterator&lt;Item = T&gt; + 'u\nwhere\n    F: Fn(&amp;T, &amp;T) -&gt; T + 'u,\n{\n    let mut iter = list.iter();\n    std::iter::successors(Some(initial), move |acc| iter.next().map(|n| op(n, acc)))\n}\n//scanl(|x, y| x + y, 0, &amp;[1, 2, 3, 4, 5]).collect::&lt;Vec&lt;_&gt;&gt;()\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=18dffab413c6adc57a307a3bd5b4ada7\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<hr>\n\n<p>It can be easily implemented by a <code>fold</code> </p>\n\n<p>For an <code>Add</code> operation:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let result = xs.iter().fold(vec![0], |mut acc, val| {\n    acc.push(val + acc.last().unwrap());\n    acc\n});\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9913ba0a67b3ed0eb3155a555e5ab76a\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<hr>\n\n<p>Here is the generic version : </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn scanl&lt;T, F&gt;(op: F, initial: T, list: &amp;[T]) -&gt; Vec&lt;T&gt;\nwhere\n    F: Fn(&amp;T, &amp;T) -&gt; T,\n{\n    let mut acc = Vec::with_capacity(list.len());\n    acc.push(initial);\n\n    list.iter().fold(acc, |mut acc, val| {\n        acc.push(op(val, acc.last().unwrap()));\n        acc\n    })\n}\n//scanl(|x, y| x + y, 0, &amp;[1, 2, 3, 4, 5])\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=720ebfbf2174a0a49b09992bf6324db4\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1560499052, "post_id": 56593816, "comment_id": 99764450, "body": "That&#39;s not as concise and pure as Haskell, tho :P"}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 0, "creation_date": 1560524736, "post_id": 56593816, "comment_id": 99777540, "body": "Thanks. It&#39;s not an issue of being concise. It&#39;s the semantics. I rather like this solution, actually."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 0, "creation_date": 1560524944, "post_id": 56593816, "comment_id": 99777661, "body": "@Listerone <code>successors</code> is maybe the best iterator-related feature in the std lib."}, {"owner": {"reputation": 325, "user_id": 10067591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AzqYZ.png?s=128&g=1", "display_name": "ObliqueMotion", "link": "https://stackoverflow.com/users/10067591/obliquemotion"}, "edited": false, "score": 1, "creation_date": 1560533438, "post_id": 56593816, "comment_id": 99781588, "body": "There is no need to put this into a vector, and then turn it into an iterator. Just use the range syntax.  <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bdea2432d1155021fff86c0ac0e7aeb9\" rel=\"nofollow noreferrer\">playground</a>"}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 7, "last_activity_date": 1560500067, "last_edit_date": 1560500067, "creation_date": 1560498884, "answer_id": 56593816, "question_id": 56591730, "link": "https://stackoverflow.com/questions/56591730/how-do-i-replicate-haskells-scanl-0-xs-in-rust/56593816#56593816", "title": "How do I replicate Haskell&#39;s `scanl (+) 0 xs` in Rust?", "body": "<p>I would do that with <a href=\"https://doc.rust-lang.org/std/iter/fn.successors.html\" rel=\"noreferrer\"><code>successors</code></a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let mut xs = vec![1, 2, 3, 4, 5].into_iter();\n    let vs = std::iter::successors(Some(0), |acc| xs.next().map(|n| n + *acc));\n\n    assert_eq!(vs.collect::&lt;Vec&lt;_&gt;&gt;(), [0, 1, 3, 6, 10, 15]);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": 2, "last_activity_date": 1560519874, "last_edit_date": 1560519874, "creation_date": 1560519498, "answer_id": 56599373, "question_id": 56591730, "link": "https://stackoverflow.com/questions/56591730/how-do-i-replicate-haskells-scanl-0-xs-in-rust/56599373#56599373", "title": "How do I replicate Haskell&#39;s `scanl (+) 0 xs` in Rust?", "body": "<blockquote>\n  <p>The awkward scan behaviour of having to mutate the accumulator can be explained by a lack of GC.</p>\n</blockquote>\n\n<p>There is nothing preventing Rust from doing what you ask.</p>\n\n<p>Example of possible implementation:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Mapscan&lt;I, A, F&gt; {\n    accu: Option&lt;A&gt;,\n    iter: I,\n    f: F,\n}\n\nimpl&lt;I, A, F&gt; Mapscan&lt;I, A, F&gt; {\n    pub fn new(iter: I, accu: Option&lt;A&gt;, f: F) -&gt; Self {\n        Self { iter, accu, f }\n    }\n}\n\nimpl&lt;I, A, F&gt; Iterator for Mapscan&lt;I, A, F&gt;\nwhere\n    I: Iterator,\n    F: FnMut(&amp;A, I::Item) -&gt; Option&lt;A&gt;,\n{\n    type Item = A;\n\n    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {\n        self.accu.take().map(|accu| {\n            self.accu = self.iter.next().and_then(|item| (self.f)(&amp;accu, item));\n            accu\n        })\n    }\n}\n\ntrait IterPlus: Iterator {\n    fn map_scan&lt;A, F&gt;(self, accu: Option&lt;A&gt;, f: F) -&gt; Mapscan&lt;Self, A, F&gt;\n    where\n        Self: Sized,\n        F: FnMut(&amp;A, Self::Item) -&gt; Option&lt;A&gt;,\n    {\n        Mapscan::new(self, accu, f)\n    }\n}\n\nimpl&lt;T: ?Sized&gt; IterPlus for T where T: Iterator {}\n\nfn main() {\n    let xs = [1, 2, 3, 4, 5];\n\n    let vs = xs\n        .iter()\n        .map_scan(Some(0), |acc, x| Some(acc + x));\n\n    assert_eq!(vs.collect::&lt;Vec&lt;_&gt;&gt;(), [0, 1, 3, 6, 10, 15]);\n}\n</code></pre>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 0, "accepted_answer_id": 56593816, "answer_count": 3, "score": 7, "last_activity_date": 1561233161, "creation_date": 1560489179, "last_edit_date": 1560499209, "question_id": 56591730, "link": "https://stackoverflow.com/questions/56591730/how-do-i-replicate-haskells-scanl-0-xs-in-rust", "title": "How do I replicate Haskell&#39;s `scanl (+) 0 xs` in Rust?", "body": "<p>If I have an list of numbers <code>[1, 2, 3, 4, 5]</code> and I wanted to generate a cumulative sum list, in Haskell I would do the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; let xs = [1, 2, 3, 4, 5]\n\n&gt; scanl (+) 0 xs\n[0,1,3,6,10,15]\n</code></pre>\n\n<p>Trying to get this same behaviour seems unnecessarily troublesome in Rust.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let xs = [1, 2, 3, 4, 5];\n\nlet vs = vec![0]\n    .into_iter()\n    .chain(xs.iter().scan(0, |acc, x| {\n        *acc += x;\n        Some(*acc)\n    }))\n    .collect::&lt;Vec&lt;_&gt;&gt;();\n</code></pre>\n\n<p>The awkward <code>scan</code> behaviour of having to mutate the accumulator can be explained by a lack of GC. But, <code>scan</code> also does not include the initial accumulator value, necessitating the need to manually prepend a 0 at the front. This itself was troublesome, as I needed to prepend it with <code>chain</code> and <code>[0].iter()</code> didn't work, nor did <code>[0].into_iter()</code> and <code>vec![0].iter()</code>. It needed <code>vec![0].into_iter()</code>. </p>\n\n<p>I feel like I must be doing something wrong here. But, what? Is there a better way to generate a cumulative sum? Is it back to a <code>for</code> loop?</p>\n"}, {"tags": ["haskell", "pattern-matching", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 3, "creation_date": 1560485676, "post_id": 56591268, "comment_id": 99759772, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17983936/exception-non-exhaustive-patterns-in-function\">Exception: Non-exhaustive patterns in function</a> / <a href=\"https://stackoverflow.com/questions/23178455/non-exhaustive-pattern-in-function-nothirds\">Non exhaustive pattern in function noThirds</a>"}, {"owner": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "reply_to_user": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 0, "creation_date": 1560486509, "post_id": 56591268, "comment_id": 99759923, "body": "There is no &quot;map&quot; word in these posts."}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 2, "creation_date": 1560486718, "post_id": 56591268, "comment_id": 99759960, "body": "Indeed there is not. But the dupes should be sufficient in fixing the &quot;Non-exhaustive patterns&quot; exception, the crux of your question. Regarding map/recursion... <code>map</code> already works over a list, so either use recursion or <code>map</code>. I don&#39;t see how you can use both effectively together."}, {"owner": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "reply_to_user": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 0, "creation_date": 1560486934, "post_id": 56591268, "comment_id": 99760010, "body": "I don&#39;t want to use it together. I have a homework where I have to solve the problem in three different ways (map, recursion and list comprehensions). My post is clear instead of those."}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 2, "creation_date": 1560487490, "post_id": 56591268, "comment_id": 99760133, "body": "Ah... &quot;<i>I has to use recursion [...] and map function</i>&quot; \u2190 I thought &quot;<i>and</i>&quot; here meant you would like to use both together. Running the given code by itself also doesn&#39;t cause any errors, you should include how you&#39;re calling <code>mult</code> (e.g. <code>mult [1, 2, 3]</code>). Overall, your question could be clearer. I personally find the &quot;<i>Non exhaustive pattern in function noThirds</i>&quot; question clear enough to solve your issue with non-exhaustive patterns. But Will&#39;s answer below is good too."}], "answers": [{"comments": [{"owner": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "edited": false, "score": 0, "creation_date": 1560487349, "post_id": 56591463, "comment_id": 99760096, "body": "Thanks for sharing a knowledge. My code is really working for one element list."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "edited": false, "score": 1, "creation_date": 1560487423, "post_id": 56591463, "comment_id": 99760113, "body": "so what does it do for <code>[]</code> or <code>[1,2,3]</code> as the argument?"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 7, "last_activity_date": 1560487699, "last_edit_date": 1560487699, "creation_date": 1560487183, "answer_id": 56591463, "question_id": 56591268, "link": "https://stackoverflow.com/questions/56591268/how-to-fix-non-exhaustive-patterns-in-function/56591463#56591463", "title": "How to fix &quot;Non-exhaustive patterns in function&quot;", "body": "<p><code>[a]</code> is a singleton list -- a list containing only one element, <code>a</code>. </p>\n\n<p>As such <code>map f [a] == [f a]</code> and your definition is equivalent to</p>\n\n<pre><code>mult :: [Int] -&gt; [Int]\nmult [a] = [fun a]\n</code></pre>\n\n<p><code>[a]</code> is equivalent to <code>(a : [])</code> both as an expression (something that appears to the right of <code>=</code>) or a pattern (to the left of <code>=</code>).</p>\n\n<p><code>(a : [])</code> is a pattern that expresses that <code>tail (a : []) == []</code>. So any list with non-null tail will fail to match that pattern. Any empty list will fail to match it as well.</p>\n\n<p>These are the cases that your code does not handle. Hence the \"non-exhaustive pattern handling\" error.</p>\n\n<p>The exhaustive pair of list-matching patterns are <code>[]</code> and <code>(a : as)</code>. One is for empty lists, and the other for non-empty lists with the head element <code>a</code> and tail <code>as</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 2, "creation_date": 1560487616, "post_id": 56591506, "comment_id": 99760163, "body": "Nearly there. Try doing <code>mult []</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1560497604, "post_id": 56591506, "comment_id": 99763793, "body": "You don&#39;t actually need to pattern match. The function is just <code>mult xs = map fun xs</code>, or in pointfree style <code>mult = map fun</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1560510298, "post_id": 56591506, "comment_id": 99769836, "body": "Enable warnings with <code>-Wall</code>: in that way GHC points out which cases are not handled at compile time, before you run the program."}], "tags": [], "owner": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "is_accepted": false, "score": -3, "last_activity_date": 1560487569, "creation_date": 1560487569, "answer_id": 56591506, "question_id": 56591268, "link": "https://stackoverflow.com/questions/56591268/how-to-fix-non-exhaustive-patterns-in-function/56591506#56591506", "title": "How to fix &quot;Non-exhaustive patterns in function&quot;", "body": "<p>Solution:</p>\n\n<pre><code>fun x = 3 * x + 1\nmult :: [Int] -&gt; [Int]\nmult (x:xs) = map fun (x:xs)\n</code></pre>\n"}], "owner": {"reputation": 339, "user_id": 8196562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c57a101112274f9e39d2247873ca93d7?s=128&d=identicon&r=PG&f=1", "display_name": "Barburka", "link": "https://stackoverflow.com/users/8196562/barburka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1725, "favorite_count": 0, "accepted_answer_id": 56591463, "answer_count": 2, "score": 0, "last_activity_date": 1560487699, "creation_date": 1560485373, "last_edit_date": 1560487355, "question_id": 56591268, "link": "https://stackoverflow.com/questions/56591268/how-to-fix-non-exhaustive-patterns-in-function", "title": "How to fix &quot;Non-exhaustive patterns in function&quot;", "body": "<p>I want pass a list as parameter to a function which multiply every element of this list by 3. I has to use recursion (I know how to do it) and map function (there is a problem).</p>\n\n<p>I'm trying passing a list as a parameter as I've seen in other posts but it isn't working.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fun x = 3 * x + 1\nmult :: [Int] -&gt; [Int]\nmult [a] = map fun [a]\n</code></pre>\n\n<p>Code I tried shows:\nException: x: Non-exhaustive patterns in function mult</p>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions"], "answers": [{"comments": [{"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1560479811, "post_id": 56590653, "comment_id": 99758811, "body": "So would (-) 5 x would be equivalent to 5 - x, since its treated like an infix operator?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1560480069, "post_id": 56590653, "comment_id": 99758847, "body": "Yes, that&#39;s the idea. You can use any operator in prefix syntax by surrounding it with parentheses."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1560479200, "creation_date": 1560479200, "answer_id": 56590653, "question_id": 56590448, "link": "https://stackoverflow.com/questions/56590448/haskell-understanding-the-map-function-when-used-with-lambda-function/56590653#56590653", "title": "Haskell: Understanding the map function when used with lambda function", "body": "<p><code>(- 5) 5</code> gives out an error because prefix minus is a special case in the language syntax: <code>(- 5)</code> means minus five, the number, and not a function that subtracts five (see also: <a href=\"https://stackoverflow.com/q/4454559/2751851\"><em>Currying subtraction</em></a>). That being so, I will focus on the <code>(+)</code> case, which is not exceptional.</p>\n\n<p>In your second expression, <code>map (\\f x -&gt; f 5 x) [(-),(+),(*)]</code>, the second element of the result list will be:</p>\n\n<pre><code>(\\f x -&gt; f 5 x) (+)\n</code></pre>\n\n<p>When evaluating such a thing by hand, it is important to be careful to not mix up prefix, infix and sectioned uses of operators. Application here gives out...</p>\n\n<pre><code>\\x -&gt; (+) 5 x  -- Prefix syntax (note the parentheses around the operator)\n</code></pre>\n\n<p>... which is equivalent to...</p>\n\n<pre><code>\\x -&gt; 5 + x  -- Infix syntax\n</code></pre>\n\n<p>... and to:</p>\n\n<pre><code>\\x -&gt; (5 +) x  -- Left section\n\\x -&gt; (+ x) 5  -- Right section\n\n(5 +)          -- Left section, pointfree\n</code></pre>\n\n<p>So the sections, which are patterned after infix usage of the operators, should be the other way around relative to your question. As for <code>map ($ 5) [(-),(+),(*)]</code>, it is equivalent to <code>map (\\f x -&gt; f 5 x) [(-),(+),(*)]</code>, your second expression. You can confirm that by using the fact that <code>($) f x = f x</code> to figure out what the <code>($ 5)</code> right section is.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 56590653, "answer_count": 1, "score": 3, "last_activity_date": 1560479200, "creation_date": 1560476923, "question_id": 56590448, "link": "https://stackoverflow.com/questions/56590448/haskell-understanding-the-map-function-when-used-with-lambda-function", "title": "Haskell: Understanding the map function when used with lambda function", "body": "<p>I have the following two Haskell expressions:</p>\n\n<pre><code>map (\\f x -&gt; f x 5) [(-),(+),(*)]\nmap (\\f x -&gt; f 5 x) [(-),(+),(*)]\n</code></pre>\n\n<p>And I'm trying to figure out whether either expression above is equivalent to the following expression:</p>\n\n<pre><code>map ($ 5) [(-),(+),(*)]\n</code></pre>\n\n<p>I am trying to understand what the difference between the first two expressions is.\nSince for both expressions, there is only one parameter passed to the lambda function (e.g. the operator), the function will be partially applied. </p>\n\n<p>Is it correct to say that the elements in the result list from the first expression will be:</p>\n\n<p>(1) <code>- x 5 = (- x) 5</code></p>\n\n<p>(2) <code>+ x 5 = (+ x) 5</code></p>\n\n<p>(3) <code>* x 5 = (* x) 5</code></p>\n\n<p>And for the second expression:</p>\n\n<p>(1) <code>- 5 x = (- 5) x</code></p>\n\n<p>(2) <code>+ 5 x = (+ 5) x</code></p>\n\n<p>(3) <code>* 5 x = (* 5) x</code></p>\n\n<p>However, I don't think that either expression is equivalent to <code>map ($ 5) [(-),(+),(*)]</code>. This is because <code>(- x) 5</code> (where x is a number) gives an error in GHCI and is an invalid expression. Similarly <code>(- 5) x</code> also gives an error. \nOn the other hand, map ($5) [(-)], results in a function that takes a number and subtracts it from 5. \nIs this reasoning correct? Any insights are appreciated.</p>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1560476190, "post_id": 56590341, "comment_id": 99758229, "body": "Yup, your explanation is correct."}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 3, "last_activity_date": 1560482673, "creation_date": 1560482673, "answer_id": 56590992, "question_id": 56590341, "link": "https://stackoverflow.com/questions/56590341/haskell-understanding-function-application-operator-when-used-with-map-function/56590992#56590992", "title": "Haskell: Understanding function application operator when used with map function", "body": "<p>Correct; you can also apply the operators a second time via:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map ($4) $ map ($ 5) [(-),(+),(*)]\n</code></pre>\n\n<p>producing <code>[5-4, 5 + 4, 5 * 4]</code></p>\n\n<p>Also, you can specify the arguments to the right of the operator, giving the same result:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[((-) 5),(+ 5),(* 5)]\n\n</code></pre>\n\n<p>(The reason the <code>(-) 5</code> has the \"-\" parenthesized, is to prevent the compiler to think you mean \"minus five\", a negative number, the usual interpretation of <code>(- 5)</code>).</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 56590992, "answer_count": 1, "score": 1, "last_activity_date": 1560482673, "creation_date": 1560475829, "question_id": 56590341, "link": "https://stackoverflow.com/questions/56590341/haskell-understanding-function-application-operator-when-used-with-map-function", "title": "Haskell: Understanding function application operator when used with map function", "body": "<p>I have the following Haskell expression:</p>\n\n<pre><code>map ($ 5) [(-),(+),(*)]\n</code></pre>\n\n<p>I know the function application operator ($) applies a function to a given parameter. However since the (-), (+) and (*) functions take two parameters, by applying these functions to 5 through map, the functions are partially applied.</p>\n\n<p>The resulting list will contain three functions that takes another parameter and:</p>\n\n<p>(1) Subtracts the parameter from 5</p>\n\n<p>(2) Adds the parameter to 5</p>\n\n<p>(3) Multiplies the parameter by 5</p>\n\n<p>However is it valid to say that the above expression is equivalent to the following?</p>\n\n<pre><code>[(5 -),(5 +),(5 *)]\n</code></pre>\n\n<p>I think this is correct, since I checked the types of (5 -), (5 +) and (5 *) in GHCI, and they are all functions that take a number and return a number:</p>\n\n<pre><code>(5 -) :: Num a =&gt; a -&gt; a\n(5 +) :: Num a =&gt; a -&gt; a\n(5 *) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>Any insights are appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1560448619, "post_id": 56585931, "comment_id": 99750180, "body": "<code>return</code> does not do what you think it does. Try to write down the type you think <code>getLongestLine</code> <i>should</i> have. Is that the type it <i>does</i> have? And then <a href=\"https://stackoverflow.com/q/940382/791604\">see also</a> for the other half of what&#39;s wrong."}], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1560449326, "post_id": 56586160, "comment_id": 99750485, "body": "Thank you very much, this helped me a lot. I can already see the red line with haskell :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1560449391, "last_edit_date": 1560449391, "creation_date": 1560448731, "answer_id": 56586160, "question_id": 56585931, "link": "https://stackoverflow.com/questions/56585931/why-is-the-return-type-of-my-function-a-int/56586160#56586160", "title": "Why is the return type of my Function a -&gt; Int", "body": "<pre><code>getLongestLine l r\n    | r == []                = return l\n    ....\n</code></pre>\n\n<p><code>return</code> here injects <code>l</code> into any monad, making the type of <code>getLongestLine</code> to be of the form</p>\n\n<pre><code>Monad m =&gt; something -&gt; something -&gt; m (something)\n</code></pre>\n\n<p>Now, this is an incident: you likely did not intend to do that. Unfortunately, since you also did not tell GHC what the type of <code>getLongestLine</code> was intended to be, GHC inferred the unexpected type above and moved on, causing problems later on in the program. With a type signature on <code>getLongestLine</code>, you would have got a type error here.</p>\n\n<p>You were quite unlucky, since the wrong <code>return</code> could have caused a type error, but did not in this case.</p>\n\n<p>Indeed, later on the monad is chosen to be <code>(-&gt;) a</code> since you use composition </p>\n\n<pre><code>length . words . getLongestLine h t\n</code></pre>\n\n<p>This causes the type</p>\n\n<pre><code>getLongestLineLength :: [Char] -&gt; a -&gt; Int\n</code></pre>\n\n<p>to have an additional unwanted <code>a</code> argument, and makes <code>getLongestLineLength</code> to take two arguments instead of one (the second one is passed to <code>getLongestLine</code>, and ignored there).</p>\n\n<p>When you finally pass only one argument, GHC finally complains.</p>\n\n<p>What to do:</p>\n\n<ol>\n<li>Don't use <code>return</code> unless you are working with monads. Use <code>l</code> instead of <code>return l</code>.</li>\n<li>Always annotate the types of your functions, so that GHC can complain early when something's wrong, instead of much later on after having inferred the unexpected types.</li>\n</ol>\n\n<p>There are several other issues in your code, and you will probably need to make some significant change. I'd suggest you split the string in words early with <code>words</code>, and then pass the result <code>[String]</code> to the rest of your program. Instead of computing the longest line, and then computing its length, compute the length first, and then take the maximum.</p>\n\n<pre><code>longestWordLength :: String -&gt; Int\nlongestWordLength = maximum . map length . words\n</code></pre>\n\n<p>Not tightly related to your problem, but general suggestions:</p>\n\n<ol>\n<li>Don't use <code>head</code>, <code>tail</code>, <code>l==[]</code>. Use pattern matching instead of guards whenever possible.</li>\n<li>Turn on warnings with <code>-Wall</code> and solve them. This would have reported the missing type sisgnature to <code>getLongestLine</code>, which caused the misunderstanding.</li>\n</ol>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 56586160, "answer_count": 1, "score": 0, "last_activity_date": 1560449391, "creation_date": 1560447691, "question_id": 56585931, "link": "https://stackoverflow.com/questions/56585931/why-is-the-return-type-of-my-function-a-int", "title": "Why is the return type of my Function a -&gt; Int", "body": "<p>I'm having a problem with my homework, where I have to write a program, which behaves like <code>wc</code>.\nMy current approach is the following:</p>\n\n<pre><code>import qualified Data.ByteString as BS\nimport qualified Data.ByteString.UTF8 as UTF8\n\nnumBytesUtf8 :: String -&gt; Int\nnumBytesUtf8 = BS.length . UTF8.fromString\n\nhelp = \"Wrong number or wrong arguments provided.\\n\\\n    \\Possible arguments are: [l, w, c, b, ll]\\n\\n\\\n    \\options:\\n\\\n    \\    -l  -&gt; Return line count\\n\\\n    \\    -w  -&gt; Return word count\\n\\\n    \\    -c  -&gt; Return character count\\n\\\n    \\    -b  -&gt; Return byte count\\n\\\n    \\    -ll -&gt; Return character count of the longest line\"\n\ngetLongestLine l r\n    | r == []                = return l\n    | length next &gt; length l = getLongestLine next rest\n    | otherwise              = getLongestLine l rest\n    where\n        next = head r\n        rest = tail r\n\ngetLongestLineLength :: [Char] -&gt; a -&gt; Int\ngetLongestLineLength f = length . words . getLongestLine h t\n    where\n        l = lines f\n        h = head l\n        t = tail l\n\nhandleArgs :: [[Char]] -&gt; [Char] -&gt; IO ()\nhandleArgs args f\n    | head args == \"-l\"  = print . length . lines $ f\n    | head args == \"-w\"  = print . length . words $ f\n    | head args == \"-c\"  = print . length $ f\n    | head args == \"-b\"  = print . numBytesUtf8 $ f\n    | head args == \"-ll\" = print ( getLongestLineLength f )\n    | otherwise = putStrLn help\n</code></pre>\n\n<p>However currently I get the following error:</p>\n\n<pre><code>    \u2022 No instance for (Show (a0 -&gt; Int)) arising from a use of \u2018print\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In the expression: print (getLongestLineLength f)\n      In an equation for \u2018handleArgs\u2019:\n          handleArgs args f\n            | head args == \"-l\" = print . length . lines $ f\n            | head args == \"-w\" = print . length . words $ f\n            | head args == \"-c\" = print . length $ f\n            | head args == \"-b\" = print . numBytesUtf8 $ f\n            | head args == \"-ll\" = print (getLongestLineLength f)\n            | otherwise = putStrLn help\n   |\n43 |     | head args == \"-ll\" = print ( getLongestLineLength f )\n   | \n\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I'm still new to this language and got surprisingly far till now. But I don't know what to do with <code>a -&gt; Int</code> and nor how to print it.</p>\n\n<p>Any Help and other Tips are appropriated :)</p>\n"}, {"tags": ["haskell", "polymorphism", "parametric-polymorphism"], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1560440600, "post_id": 56583710, "comment_id": 99746354, "body": "I tried that and compiler subsystem thinks that it&#39;s same type of files and tries to apply functions that won&#39;t work. That&#39;s why I need to have separate <code>HeaderFilePath</code> and <code>SourceFilePath</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1560440920, "post_id": 56583710, "comment_id": 99746546, "body": "@FilipvanHoft I don&#39;t understand your first comment. Your pseudocode already calls the same <code>subload</code> function for both patterns in <code>loadSource</code>; does this not reflect what you actually want to happen? If not, then perhaps you can give some details of what you <i>do</i> want to happen?"}, {"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1560443093, "post_id": 56583710, "comment_id": 99747600, "body": "<code>loadSource</code> isn&#39;t operational that&#39;s how I imagine I might use it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1560446947, "post_id": 56583710, "comment_id": 99749440, "body": "@FilipvanHoft Okay. I don&#39;t think anybody can help you further until you say more about what behavior you want."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1560439113, "creation_date": 1560439113, "answer_id": 56583710, "question_id": 56583390, "link": "https://stackoverflow.com/questions/56583390/how-to-combine-return-type-polymorphism-with-parametric-polymorphism-in-haskell/56583710#56583710", "title": "How to combine return type polymorphism with parametric polymorphism in Haskell?", "body": "<p>Just make your wrapper parameterized, too:</p>\n\n<pre><code>newtype WrappedFilePath a = WrappedFilePath FilePath\n\nloadSource :: FromJSON a =&gt; WrappedFilePath a -&gt; Compiler a\nloadSource (WrappedFilePath p) = subload fp\n</code></pre>\n\n<p>You can reuse <a href=\"https://hackage.haskell.org/package/tagged-0.8.6/docs/Data-Tagged.html\" rel=\"nofollow noreferrer\"><code>Tagged</code></a> instead of creating the new <code>WrappedFilePath</code> if you like.</p>\n"}, {"comments": [{"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "edited": false, "score": 0, "creation_date": 1560960122, "post_id": 56589948, "comment_id": 99911053, "body": "Thanks! That helped, type class with an associated type family covered my cases."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1560471110, "creation_date": 1560471110, "answer_id": 56589948, "question_id": 56583390, "link": "https://stackoverflow.com/questions/56583390/how-to-combine-return-type-polymorphism-with-parametric-polymorphism-in-haskell/56589948#56589948", "title": "How to combine return type polymorphism with parametric polymorphism in Haskell?", "body": "<p>There are several ways to accomplish this, though as @DanielWagner says, it's hard to tell what will work best for you without additional detail on what you're trying to achieve.</p>\n\n<p>The simplest is probably to use a type class with an associated type family (or a multiparameter type class with a functional dependency) to map the type of the file path wrapper to the compiler subtype.  The type family approach looks like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n\nclass Loadable a where\n  filepath :: a -&gt; String\n  type Load a\n</code></pre>\n\n<p>with boilerplatey instances like:</p>\n\n<pre><code>instance Loadable SourceFilepath where\n  filepath (SourceFilepath pth) = pth\n  type Load SourceFilepath = Source\ninstance Loadable HeaderFilepath where\n  filepath (HeaderFilepath pth) = pth\n  type Load HeaderFilepath = Header\ninstance Loadable MetadataFilepath where\n  filepath (MetadataFilepath pth) = pth\n  type Load MetadataFilepath = Metadata\n</code></pre>\n\n<p>Note that there's no problem here mapping two file path wrappers to the same compiler subtype (e.g., <code>type Load HeaderFilepath = Source</code> would work fine).</p>\n\n<p>Given:</p>\n\n<pre><code>subload :: FromJSON b =&gt; FilePath -&gt; Compiler b\nsubload = ...\n</code></pre>\n\n<p>the definition of <code>loadSource</code> is:</p>\n\n<pre><code>loadSource :: (Loadable a, FromJSON (Load a)) =&gt; a -&gt; Compiler (Load a)\nloadSource = subload . filepath\n</code></pre>\n\n<p>after which:</p>\n\n<pre><code>&gt; :t loadSource (SourceFilepath \"bob\")\nloadSource (SourceFilepath \"bob\") :: Compiler Source\n&gt; :t loadSource (MetadataFilepath \"alice\")\nloadSource (MetadataFilepath \"alice\") :: Compiler Metadata\n</code></pre>\n\n<p>You can substantially reduce boilerplate by parametrizing the wrapper, and -- like @DanielWagner -- I don't understand your comment about the compiler treating them as the same type of file, so you'd need to show us what's going wrong when you try that.</p>\n\n<p>Anyway, my complete source for the original type family solution:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Data.Aeson\nimport GHC.Generics\n\nnewtype SourceFilepath = SourceFilepath String deriving (Show)\nnewtype HeaderFilepath = HeaderFilepath String deriving (Show)\nnewtype MetadataFilepath = MetadataFilepath String deriving (Show)\n\ndata Source = Source deriving (Generic)\ndata Header = Header deriving (Generic)\ndata Metadata = Metadata deriving (Generic)\n\ninstance FromJSON Source\ninstance FromJSON Header\ninstance FromJSON Metadata\n\ndata Compiler b = Compiler\n\nsubload :: FromJSON b =&gt; FilePath -&gt; Compiler b\nsubload = undefined\n\nclass Loadable a where\n  filepath :: a -&gt; String\n  type Load a\ninstance Loadable SourceFilepath where\n  filepath (SourceFilepath pth) = pth\n  type Load SourceFilepath = Source\ninstance Loadable HeaderFilepath where\n  filepath (HeaderFilepath pth) = pth\n  type Load HeaderFilepath = Header\ninstance Loadable MetadataFilepath where\n  filepath (MetadataFilepath pth) = pth\n  type Load MetadataFilepath = Metadata\n\nloadSource :: (Loadable a, FromJSON (Load a)) =&gt; a -&gt; Compiler (Load a)\nloadSource = subload . filepath\n</code></pre>\n\n<p>and the complete source for a tagged solution:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Data.Aeson\nimport GHC.Generics\n\nnewtype TypedFilePath a = TypedFilePath FilePath deriving (Show)\n\ndata Source = Source deriving (Generic)\ndata Header = Header deriving (Generic)\ndata Metadata = Metadata deriving (Generic)\n\ninstance FromJSON Source\ninstance FromJSON Header\ninstance FromJSON Metadata\n\ndata Compiler b = Compiler\n\nsubload :: FromJSON b =&gt; FilePath -&gt; Compiler b\nsubload = undefined\n\ntype family Load a where\n  Load Source = Source\n  Load Header = Header\n  Load Metadata = Metadata\n\nloadSource :: FromJSON (Load a) =&gt; TypedFilePath a -&gt; Compiler (Load a)\nloadSource (TypedFilePath fn) = subload fn\n</code></pre>\n"}], "owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 56589948, "answer_count": 2, "score": 2, "last_activity_date": 1560471110, "creation_date": 1560438057, "last_edit_date": 1560443032, "question_id": 56583390, "link": "https://stackoverflow.com/questions/56583390/how-to-combine-return-type-polymorphism-with-parametric-polymorphism-in-haskell", "title": "How to combine return type polymorphism with parametric polymorphism in Haskell?", "body": "<p>I have set of wrapper types <code>FilePath</code>s (due to restrictions of library I'm using, that create a specific storage based on provided type) and couple of records that I need to obtain from these file-paths.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype SourceFilepath = SourceFilepath String deriving (Show)\nnewtype HeaderFilepath = HeaderFilepath String deriving (Show)\n-- ..many more wrappers\n\ndata Source =\n  Source {..}\n\ndata Header = \n  Header {..}\n\ndata Metadata = \n  Metadata {..}\n\n-- .. many more record types\n\n</code></pre>\n\n<p>I want to create generalized function <code>loadSource</code> that accepts some types (actually only filepath wrappers) and based on the provided type produces value of another specific type (<code>Source</code>, <code>Header</code>, <code>Metadata</code>, etc.). Pseudocode:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>loadSource :: a -&gt; Compiler b\nloadSource (SourceFilepath path) = subload path\nloadSource (HeaderFilepath path) = subload path\n-- .. other cases for other types \n--\n-- `a` can be filepath wrappers\n-- different `a` can lead to the same `b` sometimes\n\n</code></pre>\n\n<p>this function isn't operational I get multiple <code>a\u2019 is a rigid type variable bound by the type signature</code> and <code>rigid b..</code> errors.</p>\n\n<p>so I don't have multiple functions like this (code working properly):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>subload :: FromJSON b =&gt; FilePath -&gt; Compiler b\nsubload path = &lt;already implemented operational logic&gt;\n\nloadHeader :: HeaderFilepath -&gt; Comiler Header\nloadHeader (HeaderPath path) = subload path\n\nloadMetadata :: MetadataFilepath -&gt; Comiler Metadata\nloadMetadata (MetadataFilepath path) = subload path\n\n-- .. many more similar functions\n\n</code></pre>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 11, "last_activity_date": 1560431103, "creation_date": 1560431103, "answer_id": 56581198, "question_id": 56581109, "link": "https://stackoverflow.com/questions/56581109/haskell-standalone-executable-without-using-stack-exec/56581198#56581198", "title": "Haskell standalone executable without using &#39;stack exec&#39;", "body": "<p>As you may already be aware, <code>stack build</code> builds the executable, but then places it in a <code>stack</code>-specific path which can most easily be accessed using <code>stack exec</code>. However, there is another command: <code>stack install</code>, which then copies the executable to a convenient location. Normally the default location is in <code>~/.local/bin</code> (I think), but you can use <code>stack install --local-bin-path &lt;PATH&gt;</code> to copy the executable to <code>&lt;PATH&gt;</code>. For instance, use <code>stack install --local-bin-path .</code> to place the executable in your current working directory, or use <code>stack install --local-bin-path bin</code> to place it in your <code>./bin/</code> directory. You can then run the executable using <code>&lt;PATH&gt;/my-exe</code>.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 1, "accepted_answer_id": 56581198, "answer_count": 1, "score": 4, "last_activity_date": 1581859775, "creation_date": 1560430822, "last_edit_date": 1581859775, "question_id": 56581109, "link": "https://stackoverflow.com/questions/56581109/haskell-standalone-executable-without-using-stack-exec", "title": "Haskell standalone executable without using &#39;stack exec&#39;", "body": "<p>How would one go about creating an executable from a <code>stack</code> generated framework (<code>stack new myprog simple</code>)?</p>\n\n<p><code>myprog.cabal</code> shows <code>myprog</code> as executable that can be executed using <code>stack exec myprog</code>.</p>\n\n<p>However: using <code>./myprog</code> will not work. Not unless I call <code>ghc --make src/Main.hs</code>. This works obviously and nicely embeds the modules, but now the executable is called <code>Main</code>.</p>\n\n<p>Is there a way to have <code>stack</code> compile <code>myprog</code> as a complete executable that can be called from anywhere assuming the environmental path is set?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1560432191, "post_id": 56579372, "comment_id": 99740815, "body": "A common misunderstanding is to consider operator precedence to be the same as evaluation order. In <code>f 1 + f 2 * f 3</code> precedence requires that the multiplication is performed first than the addition, but that does not impose any evaluation order between <code>f 1</code>, <code>f 2</code>, <code>f 3</code>. In a pure language like Haskell, the evaluation order is mostly irrelevant to the final result (albeit it can affect performance, in some cases)."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1560426238, "post_id": 56579603, "comment_id": 99737168, "body": "@ceno980: no, note that Haskell is lazy, furthermore <code>(:)</code> is a <i>data constructor</i>, so that means that can not be further evaluated. <code>[60]</code> is just syntactical sugar for <code>60 : []</code>, just like <code>[1,4,2,5]</code> is syntactical sugar for <code>(1:4:2:5:[])</code>."}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1560426352, "post_id": 56579603, "comment_id": 99737231, "body": "I don&#39;t fully understand the above explanation. Am I correct in saying that the expression in the rightmost set of parentheses is evaluated first e.g. (5 : [60])? I also don&#39;t understand the line: 3 : (40 : ([ ] ++ ([50] ++ (5 : [60])))) - why did you introduce the : operator after the 40, and place a [ ] ++ before the 50?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "edited": false, "score": 0, "creation_date": 1560426495, "post_id": 56579603, "comment_id": 99737310, "body": "@ceno980: because that is how <code>(++)</code> is implemented, see edit. The second rule fires, so if the first argument is <code>(50:[])</code> then the second clause fires."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1560427353, "post_id": 56579603, "comment_id": 99737788, "body": "\u201c...as you can read in the Haskell &#39;10 report...\u201d \u2013 except nobody that. Why don&#39;t you explain about <code>:i</code>?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1560436222, "post_id": 56579603, "comment_id": 99743544, "body": "Haskell often appears to have an inversion of evaluation order compared to strict languages. The <i>outside</i> of an expression is generally evaluated first: <code>[50] ++ ([10] ++ [5])</code> has <code>[50] ++ _etc</code> on the outside, so it evaluates to <code>50 : ([10] ++ [5])</code>, and then the outer <code>(:)</code>, because it is a data constructor, gives you a chance to stop evaluating. You can choose to stop, or you can continue deeper and finish with <code>50 : 10 : 5 = [50, 10, 5]</code>. In something like Python, it would happen backwards: <code>[50] ++ ([10] ++ [5])</code> -&gt; <code>[50] ++ [10, 5]</code> -&gt; <code>[50, 10, 5]</code>, but this isn&#39;t Python."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 9, "last_activity_date": 1560427757, "last_edit_date": 1560427757, "creation_date": 1560425825, "answer_id": 56579603, "question_id": 56579372, "link": "https://stackoverflow.com/questions/56579372/haskell-order-of-evaluation-for-and-operators/56579603#56579603", "title": "Haskell: Order of evaluation for (++) and (:) operators", "body": "<p>Both the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-43--43-\" rel=\"noreferrer\"><strong><code>(++) :: [a] -&gt; [a] -&gt; [a]</code></strong></a> and <strong><code>(:) :: a -&gt; [a] -&gt; [a]</code></strong> function have <strong><code>5</code></strong> as <em>precedence</em>, as we can read in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#dx10-82001\" rel=\"noreferrer\"><em>Haskell '10 report</em></a>, and are right associative.</p>\n\n<p>We can also obtain this data with <code>:i</code> in the <code>ghci</code> shell:</p>\n\n<pre><code>Prelude&gt; :i (:)\ndata [] a = ... | a : [a]       -- Defined in \u2018GHC.Types\u2019\n<b>infixr 5</b> :\nPrelude&gt; :i (++)\n(++) :: [a] -&gt; [a] -&gt; [a]       -- Defined in \u2018GHC.Base\u2019\n<b>infixr 5</b> ++</code></pre>\n\n<p>This thus means that:</p>\n\n<pre><code>3 : [40] ++ [50] ++ 5 : [60]\n</code></pre>\n\n<p>is short for:</p>\n\n<pre><code>3 : ([40] ++ ([50] ++ (5 : [60])))\n</code></pre>\n\n<p>The <code>(++)</code> operator is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#%2B%2B\" rel=\"noreferrer\">implemented as</a>:</p>\n\n<blockquote><pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n(++) []     ys = ys\n(++) (x:xs) ys = x : xs ++ ys</code></pre></blockquote>\n\n<p>The <code>(:)</code> is a data constructor, so that means it can not be \"further evaluated\".</p>\n\n<p>This makes sense since it thus means that the <code>++</code> is here only applied to the tail, and hence as long as we are interested in the head, we do not need to evaluate that function. So a right associative <code>(++)</code> is usually cheaper than a left associative <code>(++)</code> although it will result in the same list.</p>\n\n<p>If we thus want to evaluate the full list, it is evaluated as:</p>\n\n<pre><code>   3 : ([40] ++ ([50] ++ (5 : [60])))\n-&gt; 3 : (40 : ([] ++ ([50] ++ (5 : [60]))))\n-&gt; 3 : (40 : ([50] ++ (5 : [60])))\n-&gt; 3 : (40 : (50 : ([] ++ (5 : [60]))))\n-&gt; 3 : (40 : (50 : (5 : [60])))\n</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>   3 : ((40: []) ++ ((50 : []) ++ (5 : (60 : []))))\n-&gt; 3 : (40 : ([] ++ ((50 : []) ++ (5 : (60 : [])))))\n-&gt; 3 : (40 : ((50 : []) ++ (5 : (60 : []))))\n-&gt; 3 : (40 : (50 : ([] ++ (5 : (60 : [])))))\n-&gt; 3 : (40 : (50 : (5 : (60 : []))))\n</code></pre>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1560427757, "creation_date": 1560425059, "question_id": 56579372, "link": "https://stackoverflow.com/questions/56579372/haskell-order-of-evaluation-for-and-operators", "title": "Haskell: Order of evaluation for (++) and (:) operators", "body": "<p>I have the following Haskell expression:</p>\n\n<pre><code>3 : [40] ++ [50] ++ 5 : [60]\n</code></pre>\n\n<p>I would like to know how this expression is evaluated. Which operator has a higher precedence, <code>:</code> or <code>++</code>?\nI think the result of the expression is [3,40,50,5,60], however I did this the following way:</p>\n\n<pre><code>3 : [40] ++ [50] ++ 5 : [60]\n3 : [40] ++ [50] ++ [5,60]\n3 : [40] ++ [50,5,60]\n3: [40,50,5,60]\n[3,40,50,5,60]\n</code></pre>\n\n<p>Is the above the correct way to evaluate the expression? Any insights are appreciated.  </p>\n"}, {"tags": ["haskell", "quantified-constraints"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560626080, "post_id": 56573838, "comment_id": 99801383, "body": "Would it help any if the <code>QuantifiedConstraints</code> syntax distinguished between superclass and instance constraints? I&#39;m rather sad that the committee rejected my suggestion that implication constraints (ill behaved) get a separate extension from quantified constraints (well behaved). I really think the former still need significantly more R &amp; D to get right."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560632386, "post_id": 56573838, "comment_id": 99802705, "body": "You mean you want arrows <code>class S =&gt; C</code> and <code>instance R =&gt; H</code> such that, in <code>f :: (instance R =&gt; H) =&gt; T</code>, you get <code>instance R =&gt; H</code> in scope (exactly like the current extension), but, for <code>g :: (class S =&gt; C) =&gt; T</code>, you get <code>class S =&gt; C</code> (adding <code>S</code> to whatever superclasses <code>C</code> already had)? I don&#39;t think that helps: <code>instance</code> constraints <i>are</i> constraints. Even without quantified constraints, we need to derive wanteds from the superclasses of instance constraints. Adding quantification is enough to emulate <code>class</code> constraints. Separating <code>class</code> constraints would not contain the wonkiness."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560744583, "post_id": 56573838, "comment_id": 99821688, "body": "I&#39;m not quite understanding what you&#39;re saying, which of course doesn&#39;t mean you&#39;re wrong. In the latter case, it would probably look more like <code>(forall a. class S a =&gt; c a) =&gt; T c</code>. But as you suggest, that may not help the problem any. Do you see what I mean about quantification behaving better than implication?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560750970, "post_id": 56573838, "comment_id": 99823297, "body": "@dfeuer Oh, you mean you want <code>forall vars. Ctx vars</code> to be kosher but <code>Req =&gt; Deriv</code> to be gated behind another extension? I don&#39;t think the latter behaves significantly worse than the former. Both let you get overlapping instances, which is the real source of the weirdness, but that the latter just causes errors sometimes instead of silently accepting. I just wish it were better documented."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560751842, "post_id": 56573838, "comment_id": 99823543, "body": "The usual problem with implication constraints is that the local/global instance chosen will affect the way resolution proceeds, since you&#39;ll get different wanteds; resolution can fail because the instance constraints of the chosen instance can&#39;t be satisfied even though there&#39;s another instance in scope whose constraints can be. With plain quantified constraints, I don&#39;t believe that happens, but maybe I&#39;m wrong."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560757979, "post_id": 56573838, "comment_id": 99826108, "body": "@dfeuer Yes, that all makes sense. I can&#39;t say I have any opinions on the matter. I do wonder: is there any trick, <code>Implies</code> or a generalization thereof, that can always resolve such conflicts? As long as there is one I can&#39;t complain."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 6, "last_activity_date": 1560411243, "last_edit_date": 1560411243, "creation_date": 1560403508, "answer_id": 56573838, "question_id": 56573436, "link": "https://stackoverflow.com/questions/56573436/why-is-using-quantifiedconstraints-to-specify-a-subclass-of-a-typeclass-also-dem/56573838#56573838", "title": "Why is using QuantifiedConstraints to specify a subclass of a typeclass also demanding an instance of the subclass?", "body": "<p>The error messages state these errors come from the default definitions of <code>sconcat</code> and <code>stimes</code>. Quantified contexts act like <code>instance</code>s: within your <code>instance Semigroup (Free cls v)</code>, it's as if there is an <code>instance cls v =&gt; Semigroup v</code> in scope. <code>instance</code>s are chosen by matching. <code>sconcat</code> and <code>stimes</code> want <code>Semigroup (Free cls v)</code>, so they match that want against the context <code>instance forall z. cls z =&gt; Semigroup z</code>, succeed with <code>z ~ Free cls v</code>, and get a further wanted of <code>cls (Free cls v)</code>. This happens even though we also have a recursive <code>instance _etc =&gt; Semigroup (Free cls v)</code> around. Remember, we assume that typeclass instances are coherent; there should be no difference whether the quantified context is used or the currently defined instance is used, so GHC just picks whichever instance it feels like using. </p>\n\n<p>However, this is not a good situation. The quantified context <em>overlaps</em> with our instance (actually, it overlaps with <em>every</em> <code>Semigroup</code> instance), which is alarming. If you try something like <code>(&lt;&gt;) = const (Free0 _etc) ([1, 2] &lt;&gt; [3, 4])</code>, you get a similar error, because the quantified context overshadows the real <code>instance Semigroup [a]</code> in the library. I think including some ideas from <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/14877\" rel=\"nofollow noreferrer\">issue 14877</a> can make this less uncomfortable:</p>\n\n<pre><code>class (a =&gt; b) =&gt; Implies a b\ninstance (a =&gt; b) =&gt; Implies a b\ninstance (forall v. cls v `Implies` Semigroup v) =&gt; Semigroup (Free cls u) where\n  Free0 g &lt;&gt; Free0 g' = Free0 $ \\f -&gt; g f &lt;&gt; g' f\n</code></pre>\n\n<p>Using <code>Implies</code> here means that the quantified context no longer matches the want for <code>Semigroup (Free cls v)</code> which is instead discharged by recursion. However, the requirement behind the constraint doesn't change. Essentially, we keep the requirement fragment of the quantified constraint, for the user, that <code>Semigroup v</code> should be implied by <code>cls v</code>, while slapping a safety on the discharge fragment, for the implementation, so it doesn't muck up our constraint resolution. The <code>Implies</code> constraint still can and has to be used to prove the <code>Semigroup v</code> constraint in <code>(&lt;&gt;)</code>, but it's considered as a last resort after the explicit <code>Semigroup</code> instances are exhausted.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 56573838, "answer_count": 1, "score": 4, "last_activity_date": 1560411243, "creation_date": 1560400586, "question_id": 56573436, "link": "https://stackoverflow.com/questions/56573436/why-is-using-quantifiedconstraints-to-specify-a-subclass-of-a-typeclass-also-dem", "title": "Why is using QuantifiedConstraints to specify a subclass of a typeclass also demanding an instance of the subclass?", "body": "<p>I'm playing around with a multikinded tagless encoding of <code>Free</code></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE Rank2Types #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE QuantifiedConstraints #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeOperators #-}\nmodule Free where\nimport GHC.Types\n\ntype (a :: k) ~&gt; (b :: k) = Morphism k a b\n\nnewtype Natural (f :: j -&gt; k) (g :: j -&gt; k) = \n  Natural { getNatural :: forall (x :: j). f x ~&gt; g x }\n\ntype family Morphism k :: k -&gt; k -&gt; Type where\n  Morphism Type = (-&gt;)\n  Morphism (j -&gt; k) = Natural\n\nclass DataKind k where\n  data Free :: (k -&gt; Constraint) -&gt; k -&gt; k\n  interpret :: forall (cls :: k -&gt; Constraint) (u :: k) (v :: k). \n               cls v =&gt; (u ~&gt; v) -&gt; (Free cls u ~&gt; v)\n  call :: forall (cls :: k -&gt; Constraint) (u :: k). \n          u ~&gt; Free cls u\n\ninstance DataKind Type where\n  newtype Free cls u = Free0\n    { runFree0 :: forall v. cls v =&gt; (u ~&gt; v) -&gt; v }\n  interpret f = \\(Free0 g) -&gt; g f\n  call = \\u -&gt; Free0 $ \\f -&gt; f u\n</code></pre>\n\n<p>I can write <code>Semigroup</code> instances for <code>Free Semigroup</code> and <code>Free Monoid</code> without a problem:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Semigroup (Free Semigroup u) where\n  Free0 g &lt;&gt; Free0 g' = Free0 $ \\f -&gt; g f &lt;&gt; g' f\n\ninstance Semigroup (Free Monoid u) where\n  Free0 g &lt;&gt; Free0 g' = Free0 $ \\f -&gt; g f &lt;&gt; g' f\n</code></pre>\n\n<p>These instances are the same, and will be for any other subclass of <code>Semigroup</code>.  </p>\n\n<p>I want to use <code>QuantifiedConstraints</code> so I can just write one instance for all subclasses of <code>Semigroup</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance (forall v. cls v =&gt; Semigroup v) =&gt; Semigroup (Free cls u) where\n  Free0 g &lt;&gt; Free0 g' = Free0 $ \\f -&gt; g f &lt;&gt; g' f\n</code></pre>\n\n<p>But the compiler (GHC-8.6.3) complains that it's unable to deduce <code>cls (Free cls u)</code>: </p>\n\n<pre><code>Free.hs:57:10: error:\n    \u2022 Could not deduce: cls (Free cls u)\n        arising from a use of \u2018GHC.Base.$dmsconcat\u2019\n      from the context: forall v. cls v =&gt; Semigroup v\n        bound by the instance declaration at Free.hs:57:10-67\n    \u2022 In the expression: GHC.Base.$dmsconcat @(Free cls u)\n      In an equation for \u2018GHC.Base.sconcat\u2019:\n          GHC.Base.sconcat = GHC.Base.$dmsconcat @(Free cls u)\n      In the instance declaration for \u2018Semigroup (Free cls u)\u2019\n    \u2022 Relevant bindings include\n        sconcat :: GHC.Base.NonEmpty (Free cls u) -&gt; Free cls u\n          (bound at Free.hs:57:10)\n   |\n57 | instance (forall v. cls v =&gt; Semigroup v) =&gt; Semigroup (Free cls u) where\n   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nFree.hs:57:10: error:\n    \u2022 Could not deduce: cls (Free cls u)\n        arising from a use of \u2018GHC.Base.$dmstimes\u2019\n      from the context: forall v. cls v =&gt; Semigroup v\n        bound by the instance declaration at Free.hs:57:10-67\n      or from: Integral b\n        bound by the type signature for:\n                   GHC.Base.stimes :: forall b.\n                                      Integral b =&gt;\n                                      b -&gt; Free cls u -&gt; Free cls u\n        at Free.hs:57:10-67\n    \u2022 In the expression: GHC.Base.$dmstimes @(Free cls u)\n      In an equation for \u2018GHC.Base.stimes\u2019:\n          GHC.Base.stimes = GHC.Base.$dmstimes @(Free cls u)\n      In the instance declaration for \u2018Semigroup (Free cls u)\u2019\n    \u2022 Relevant bindings include\n        stimes :: b -&gt; Free cls u -&gt; Free cls u (bound at Free.hs:57:10)\n   |\n57 | instance (forall v. cls v =&gt; Semigroup v) =&gt; Semigroup (Free cls u) where\n   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>When I add this as context for the instance, it compiles fine:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance (cls (Free cls u), forall v. cls v =&gt; Semigroup v) =&gt; Semigroup (Free cls u) where\n  Free0 g &lt;&gt; Free0 g' = Free0 $ \\f -&gt; g f &lt;&gt; g' f\n</code></pre>\n\n<p>The added context is a little verbose, but since the whole point of <code>Free</code> is that <code>cls (Free cls u)</code> is always true, not onerous.</p>\n\n<p>What I don't understand is <em>why</em> GHC needs to be able to conclude <code>cls (Free cls u)</code> for the subclass of <code>Semigroup</code> for the <code>Semigroup</code> instance to compile. I tried replacing the definition of <code>(&lt;&gt;)</code> with <code>undefined</code> and got the same error, so I think the issue is not in the implementation itself but in the declaration of the instance; probably due to some aspect of <code>QuantifiedConstraints</code> I don't understand.</p>\n"}]