[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 5, "creation_date": 1437607587, "post_id": 31575662, "comment_id": 51106145, "body": "<a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1437611152, "post_id": 31576108, "comment_id": 51107014, "body": "are <code>:{</code> and <code>:}</code> intentionally smileys?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1437611260, "post_id": 31576108, "comment_id": 51107045, "body": "@immibis They are unintentionally smileys. <code>:{</code> and <code>:}</code> are GHCi&#39;s syntax for entering and leaving multiline mode (you can also set an option to make multiline mode the default with <code>:set +m</code>)."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 6, "last_activity_date": 1437611180, "last_edit_date": 1437611180, "creation_date": 1437610453, "answer_id": 31576108, "question_id": 31575662, "link": "https://stackoverflow.com/questions/31575662/can-be-used-as-part-of-variable-name/31576108#31576108", "title": "Can | be used as part of variable name?", "body": "<p>It cannot be part of a name that contains alphanumeric characters, as in your example. Names of bindings that are not infix operators must contain only alphanumeric characters, single quotes and underscores. There are further restrictions on what may start with an uppercase letter or lowercase letter and a couple minor restrictions on where single quotes can appear. A name can also not start with a number.</p>\n\n<p>The particular character <code>|</code> has special meaning because it is <a href=\"http://learnyouahaskell.com/syntax-in-functions#guards-guards\">the syntax for guards</a>. Your example would be the same as:</p>\n\n<pre><code>Prelude&gt; let prob | A = 3\n</code></pre>\n\n<p>For more details, see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\">the link</a> Eric provided in the comments.</p>\n\n<p><code>camelCase</code> is the recommended (and, by a very large margin, the most prevalent) naming convention, but you could also name things <code>like_this</code> or <code>even'like'this</code>.</p>\n\n<p>The <code>'</code> (single quote) is most often used at the end of a variable name, usually to indicate that it is a modified version of the binding without the single quote. For instance, you might have</p>\n\n<pre><code>ghci&gt; :{\n   |&gt; let x   = 3\n   |&gt;     x'  = x + 1\n   |&gt;     x'' = x' * 2\n   |&gt; in (x, x', x'') \n   |&gt; :}\n(3,4,8)\n</code></pre>\n\n<p>It is possible to make new operators (with new names) in Haskell like this:</p>\n\n<pre><code>ghci&gt; let a .|. b = a + b\nghci&gt; 2 .|. 2\n4\n</code></pre>\n\n<p>Or even, if you <em>really</em> wanted to:</p>\n\n<pre><code>ghci&gt; let a !@#$%^&amp;* b = a - b\nghci&gt; 7 !@#$%^&amp;* 4\n3\n</code></pre>\n\n<p>(Usually you try to use operator names that are far more clear though)</p>\n\n<p>but, as I said, <code>|</code> by itself has special significance.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 31576108, "answer_count": 1, "score": 0, "last_activity_date": 1437619364, "creation_date": 1437607297, "question_id": 31575662, "link": "https://stackoverflow.com/questions/31575662/can-be-used-as-part-of-variable-name", "title": "Can | be used as part of variable name?", "body": "<p>This code causes compiler error : </p>\n\n<pre><code>Prelude&gt; let probBorA = 3\nprobBorA :: Num a =&gt; a\nPrelude&gt; let probB|A = 3\n\n&lt;interactive&gt;:25:11: Not in scope: data constructor \u2018A\u2019\nPrelude&gt; \n</code></pre>\n\n<p>| cannot be used as part of a variable name in Haskell ?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1437615212, "post_id": 31576707, "comment_id": 51107954, "body": "I think the file name should also start with the Capital letter as <a href=\"https://en.wikibooks.org/wiki/Haskell/Modules#Modules\" rel=\"nofollow noreferrer\">mentioned here</a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1437614733, "creation_date": 1437614733, "answer_id": 31576707, "question_id": 31575211, "link": "https://stackoverflow.com/questions/31575211/running-cabal-repl-with-top-level-functions/31576707#31576707", "title": "Running `cabal repl` with Top-level Functions", "body": "<p>If the module is one listed in your project (i.e. in your exposed-modules or other-modules sections):</p>\n\n<pre><code>:m *ModuleName\n</code></pre>\n\n<p>Otherwise:</p>\n\n<pre><code>:l somefile.hs\n</code></pre>\n\n<p>See also <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#ghci-scope\" rel=\"nofollow\">What's really in scope at the prompt?</a> from the Fine Documentation.</p>\n"}], "owner": {"reputation": 831, "user_id": 3371760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/09370cd5d499c9f0f75b54aa1b4daa17?s=128&d=identicon&r=PG", "display_name": "Fried Brice", "link": "https://stackoverflow.com/users/3371760/fried-brice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 31576707, "answer_count": 1, "score": 3, "last_activity_date": 1437614733, "creation_date": 1437604492, "question_id": 31575211, "link": "https://stackoverflow.com/questions/31575211/running-cabal-repl-with-top-level-functions", "title": "Running `cabal repl` with Top-level Functions", "body": "<p>I'm trying to learn to sandbox my Haskell projects with cabal.</p>\n\n<p>I make extensive use of the command interpreter <code>ghci</code>, which imports top-level functions by default.</p>\n\n<p><code>cabal repl</code> also provides a command interpreter, but top-level functions are not imported.</p>\n\n<p>How can I run <code>cabal repl</code> so that top-level constants and functions will be defined in the command interpreter?</p>\n\n<p>Here's a minimal example:</p>\n\n<pre><code>-- somefile.hs\nsomeConstant :: Int\nsomeConstant = 5\n\nmain :: IO ()\nmain = undefined\n</code></pre>\n\n<p>Now, <code>someConstant</code> will be defined when I run <code>ghci somefile.hs</code>, but it won't be defined when I run <code>cabal repl</code>.</p>\n"}, {"tags": ["haskell", "ghci", "winghci"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1437604709, "post_id": 31574597, "comment_id": 51105328, "body": "There&#39;s no <code>:{</code> and <code>:}</code> in your screenshot."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1437605155, "post_id": 31574597, "comment_id": 51105472, "body": "It looks correct now. I&#39;m a bit confused why it didn&#39;t insert &quot;Prelude|&quot; before every line though. Maybe there&#39;s some weird interaction between WinGHCi and multi-line mode and/or pasting."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1437608138, "post_id": 31574597, "comment_id": 51106291, "body": "I use WinGHCi but I&#39;ve never been able to get multiline pasting into it to work."}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1437602989, "post_id": 31574685, "comment_id": 51104612, "body": "<code>let</code> <i>does</i> allow you to define a function with multiple patterns, you just need to write <code>let</code> only once. But more importantly GHCi does not allow you to write code that takes up multiple lines unless you use <code>:{</code> and <code>:}</code>. So your suggestion won&#39;t work without that either."}], "tags": [], "owner": {"reputation": 8313, "user_id": 1648987, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/dcc829df7369ce51e760cbf9f7b7b29b?s=128&d=identicon&r=PG", "display_name": "Karol S", "link": "https://stackoverflow.com/users/1648987/karol-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1437602094, "creation_date": 1437602094, "answer_id": 31574685, "question_id": 31574597, "link": "https://stackoverflow.com/questions/31574597/non-exhaustive-patterns-in-function-max/31574685#31574685", "title": "Non-exhaustive patterns in function max", "body": "<p>GHCi (and in general, <code>let</code>) doesn't allow you to define a function this way. You simply defined 3 functions, overwriting one with another each time.</p>\n\n<p>If you want to keep using GHCi, write something like this:</p>\n\n<pre><code>let max list = case list of\n    [] -&gt; error \"maximum of empty list\"  \n    [x] -&gt; x  \n    (x:xs) -&gt; \n      if x &gt; maxTail then x else maxTail  \n      where maxTail = max xs \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437604101, "post_id": 31574871, "comment_id": 51105078, "body": "You can also write this on one line by delimiting definitions with a <code>;</code>."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437604287, "post_id": 31574871, "comment_id": 51105156, "body": "@sepp2k tried your code, including entering multi line mode but receive error : &quot;&lt;interactive&gt;:74:56: parse error on input \u2018=\u2019&quot;"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437604363, "post_id": 31574871, "comment_id": 51105190, "body": "@blue-sky So did I and I didn&#39;t. Curious. Did you add any additional indentation? Which line was the error on?"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437604634, "post_id": 31574871, "comment_id": 51105300, "body": "@sepp2k I&#39;ve updated question with screenshot, is ghci version same ?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1437654263, "post_id": 31574871, "comment_id": 51126388, "body": "Alternatively use <code>:set +m</code> to allow multiline definitions. (Or use <a href=\"https://github.com/gibiansky/IHaskell\" rel=\"nofollow noreferrer\">IHaskell</a> the <a href=\"https://jupyter.org/\" rel=\"nofollow noreferrer\">Jupyter</a> kernel)"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 8, "last_activity_date": 1437604283, "last_edit_date": 1437604283, "creation_date": 1437602895, "answer_id": 31574871, "question_id": 31574597, "link": "https://stackoverflow.com/questions/31574597/non-exhaustive-patterns-in-function-max/31574871#31574871", "title": "Non-exhaustive patterns in function max", "body": "<p>By using three separate <code>let</code>s, you're defining three separate, non-exhaustive functions named <code>max</code>, each one shadowing the previous ones. In order to define a multi-case function using <code>let</code>, you use the <code>let</code> keyword ones and then just repeat the function signature at the same indentation for each pattern like this:</p>\n\n<pre><code>let max [] = error \"maximum of empty list\"\n    max [x] = x\n    max (x:xs)\n      | x &gt; maxTail = x\n      | otherwise = maxTail\n      where maxTail = max xs\n</code></pre>\n\n<p>In order for this (or any other piece of code that takes up multiple lines) to work in GHCI, you'll need to start multi-line mode by entering <code>:{</code> and then exit it afterwards with <code>:}</code> or write it all in one line using <code>;</code> instead of line breaks (except before <code>|</code> where you'd just write <code>|</code> without a <code>;</code> or line break in front).</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 31574871, "answer_count": 2, "score": 1, "last_activity_date": 1437608760, "creation_date": 1437601715, "last_edit_date": 1437608760, "question_id": 31574597, "link": "https://stackoverflow.com/questions/31574597/non-exhaustive-patterns-in-function-max", "title": "Non-exhaustive patterns in function max", "body": "<p>In ghci this code : </p>\n\n<pre><code>let max [] = error \"maximum of empty list\"  \n\nlet max [x] = x  \n\nlet max (x:xs)   \n    | x &gt; maxTail = x  \n    | otherwise = maxTail  \n    where maxTail = max xs \n</code></pre>\n\n<p>Causes error : <code>*** Exception: &lt;interactive&gt;:26:5-106: Non-exhaustive patterns in function max</code></p>\n\n<p>What is the non-exhaustible pattern here? The zero elem, single elem and multi elem list are catered for ?</p>\n\n<p>Update : \n<a href=\"https://i.stack.imgur.com/ucA5R.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ucA5R.png\" alt=\"enter image description here\"></a></p>\n\n<p>Update 2 : </p>\n\n<p><a href=\"https://i.stack.imgur.com/VOJJd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VOJJd.png\" alt=\"enter image description here\"></a></p>\n\n<p>Update 3 : </p>\n\n<p>Works as expected on Debian (Raspberry Pi) : </p>\n\n<p><a href=\"https://i.stack.imgur.com/l8lIM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/l8lIM.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "io", "readfile", "writefile", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "edited": false, "score": 0, "creation_date": 1437590107, "post_id": 31570472, "comment_id": 51097373, "body": "I try to follow the types but sometimes it gets difficult when the types start looking like alphabet soup ;)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1437587507, "creation_date": 1437587507, "answer_id": 31570472, "question_id": 31567305, "link": "https://stackoverflow.com/questions/31567305/using-pipes-to-read-and-write-binary-data-in-haskell/31570472#31570472", "title": "Using Pipes to read and write binary data in Haskell", "body": "<p>The docs say that <a href=\"https://hackage.haskell.org/package/pipes-binary-0.4.0.4/docs/Pipes-Binary.html#v:decoded\" rel=\"noreferrer\"><code>decoded</code></a> is a lens from a stream of bytes to a stream of decoded values. We can get the latter out of the former using <code>view</code> from <code>lens</code>:</p>\n\n<pre><code>decoder :: Monad m =&gt; Int -&gt; Producer P.ByteString m a -&gt; Producer Int m ()\ndecoder n p = void (view P.decoded p) &gt;-&gt; P.take n\n\nmain :: IO ()\nmain = do\n    withFile \"ints\" WriteMode $ \\h -&gt; do\n         runEffect $ for intStream P.encode &gt;-&gt; P.take 10000 &gt;-&gt; PB.toHandle h\n    withFile \"ints\" ReadMode $ \\h -&gt; do\n         runEffect $ decoder 10000 (PB.fromHandle h) &gt;-&gt; P.print\n</code></pre>\n\n<p>I don't have much experience with <code>pipes</code>, I just followed the types here. The program seems to function as intended though. </p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 31570472, "answer_count": 1, "score": 6, "last_activity_date": 1437587507, "creation_date": 1437578272, "question_id": 31567305, "link": "https://stackoverflow.com/questions/31567305/using-pipes-to-read-and-write-binary-data-in-haskell", "title": "Using Pipes to read and write binary data in Haskell", "body": "<p>I am trying to read and write very many ints in constant memory. I have figured out how to write the ints to memory but have not figured out how to read them back. </p>\n\n<pre><code>import Control.Lens (zoom)\nimport System.IO (IOMode(..), withFile)\nimport Pipes\nimport qualified Pipes.Prelude as P\nimport qualified Pipes.ByteString as PB    \nimport qualified Pipes.Parse as P\nimport qualified Pipes.Binary as P\n\nintStream :: Monad m =&gt; Proxy x' x () Int m b\nintStream = go (0 :: Int) where\n   go i = yield i &gt;&gt; go (i + 1)\n\ndecoder :: Monad m =&gt; Int -&gt;  P.Parser P.ByteString m [Int]\ndecoder n = zoom (P.decoded . P.splitAt n) P.drawAll\n\nmain :: IO ()\nmain = do\n    withFile \"ints\" WriteMode $ \\h -&gt; do\n         runEffect $ for intStream P.encode &gt;-&gt; P.take 10000 &gt;-&gt; PB.toHandle h\n    withFile \"ints\" ReadMode $ \\h -&gt; do\n         xs &lt;- P.evalStateT (decoder 10000000) (PB.fromHandle h)\n         print xs\n</code></pre>\n\n<p>I got the decoder function from the documentation for <a href=\"https://hackage.haskell.org/package/pipes-binary-0.4.0.4/docs/Pipes-Binary.html\">Pipes.Binary</a>. However it uses <code>drawAll</code> which according to the <a href=\"http://haddock.stackage.org/lts-2.19/pipes-parse-3.0.3/Pipes-Parse.html#v:drawAll\">documentation</a> <code>drawAll</code> is not idiomatic use of Pipes and is provided for testing purposes.</p>\n\n<p>My question is how to modify <code>decoder</code> so that it doesn't use <code>drawAll</code> and thus does not load all the values of <code>xs</code> into memory. So instead of printing the list of xs I could <code>P.map print</code> over a stream of decoded <code>ints</code> being read from the file.</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 1238134, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d427c02d3cae2dea5251aa917fd00b01?s=128&d=identicon&r=PG", "display_name": "RazorMx", "link": "https://stackoverflow.com/users/1238134/razormx"}, "edited": false, "score": 0, "creation_date": 1437592938, "post_id": 31569267, "comment_id": 51099204, "body": "Thank you very much. Actually our teacher didn&#39;t request parenthesis so i have to consider simple expressions like this one &quot;2*x + 3^x*3 + y^4 + 4&quot;"}, {"owner": {"reputation": 313, "user_id": 1238134, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d427c02d3cae2dea5251aa917fd00b01?s=128&d=identicon&r=PG", "display_name": "RazorMx", "link": "https://stackoverflow.com/users/1238134/razormx"}, "edited": false, "score": 0, "creation_date": 1437594588, "post_id": 31569267, "comment_id": 51100148, "body": "Actually i&#39;m having problem writing the factor because i don&#39;t know how to handle spaces :("}, {"owner": {"reputation": 313, "user_id": 1238134, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d427c02d3cae2dea5251aa917fd00b01?s=128&d=identicon&r=PG", "display_name": "RazorMx", "link": "https://stackoverflow.com/users/1238134/razormx"}, "edited": false, "score": 0, "creation_date": 1437601874, "post_id": 31569267, "comment_id": 51104136, "body": "Thank you again. I studied a little and was able to find the solution: factor :: Parser Expr factor = (symbol &#39;x&#39;  &gt;&gt;&gt; \\c -&gt; success $ Var [c]) +++ (symbol &#39;y&#39;  &gt;&gt;&gt; \\c -&gt; success $ Var [c]) +++ (natural  &gt;&gt;&gt; \\c -&gt; success $ Const c)"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1437583629, "creation_date": 1437583629, "answer_id": 31569267, "question_id": 31567255, "link": "https://stackoverflow.com/questions/31567255/how-to-parse-simple-expressions/31569267#31569267", "title": "How to parse simple expressions?", "body": "<p>The various parsers you need to write are building the precedence rules for the order of operations of arithmetic into the structure of the parsers. In order from most to least precedence these are</p>\n\n<ul>\n<li>parenthesis and atomic literals like numbers and variables, which you will call a <code>factor</code></li>\n<li>exponentiation, which you will call a <code>power</code></li>\n<li>multiplications, which you will call a <code>term</code></li>\n<li>addition and subtraction, which you will call an <code>expr</code>.</li>\n</ul>\n\n<p>You are starting on the outside with the operators with the lowest precedence and working in to the operators with the highest precedence. Moving in to multiplication, you can write <code>term</code> the same way you wrote <code>expr</code>. An <code>expr</code> consisted of <code>term</code>s; a <code>term</code> will consist of <code>power</code>s</p>\n\n<pre><code>term :: Parser Expr\nterm = power &gt;&gt;&gt; \\p -&gt; (symbol '*' &amp;&amp;&amp; term &gt;&gt;&gt; \\e -&gt; success $ Mul p e) +++ success p\n</code></pre>\n\n<p>In the same way, a <code>power</code> will consist of <code>factor</code>s. Since the right hand side of a <code>Pow</code> is an <code>Int</code>, it just uses a natural number <code>nat</code> instead of recursing.</p>\n\n<pre><code>power :: Parser Expr\npower = factor &gt;&gt;&gt; f -&gt; (symbol '^' &amp;&amp;&amp; nat &gt;&gt;&gt; \\n -&gt; success $ Pow f n) +++ success f\n</code></pre>\n\n<p>I'll leave writing <code>factor</code> for you; the parts I wrote are almost the same as <code>expr</code>, which you already figured out. The parenthesis inside a <code>factor</code> will wrap an arbitrary expression <code>expr</code>, starting over again at the outside at the least precedence. This will allow you to parse things like <code>\"2*(x+1)\"</code></p>\n"}], "owner": {"reputation": 313, "user_id": 1238134, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d427c02d3cae2dea5251aa917fd00b01?s=128&d=identicon&r=PG", "display_name": "RazorMx", "link": "https://stackoverflow.com/users/1238134/razormx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 31569267, "answer_count": 1, "score": 2, "last_activity_date": 1437590768, "creation_date": 1437578144, "last_edit_date": 1437590768, "question_id": 31567255, "link": "https://stackoverflow.com/questions/31567255/how-to-parse-simple-expressions", "title": "How to parse simple expressions?", "body": "<p>My homework is to make an expression parser in Haskell. I couldn't find help for my case from previous questions about parsing in Haskell on SO.</p>\n\n<p>The expression is defined as follow:</p>\n\n<pre><code>data Expr =\n| Const Int\n| Var String\n| Add Expr Expr | Sub Expr Expr | Mul Expr Expr | Pow Expr Int\nderiving Show\n</code></pre>\n\n<p>The type <code>Parser</code> is defined as follow:</p>\n\n<pre><code>type Parser a = String -&gt; Maybe (a, String)\n</code></pre>\n\n<p>The parsers given in my homework are defined as follow:</p>\n\n<pre><code>--Primitive parsers\n\nsuccess :: a -&gt; Parser a\nsuccess v = \\inp -&gt; Just (v, inp)\n\nfailure :: Parser a\nfailure = \\_ -&gt; Nothing\n\nitem :: Parser Char\nitem = \\inp -&gt; case inp of \n                \"\" -&gt; Nothing\n                (c : cs) -&gt; Just (c, cs)\n\n--Sequential parsers\n\n(&gt;&gt;&gt;) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\np &gt;&gt;&gt; f = \\inp -&gt; case p inp of\n                    Nothing -&gt; Nothing\n                    Just (x, cs) -&gt; f x cs\n\n(&amp;&amp;&amp;) :: Parser a -&gt; Parser b -&gt; Parser b \np &amp;&amp;&amp; q = p &gt;&gt;&gt; \\_ -&gt; q\n\n-- Conditional Parsers\n\nsat :: (Char -&gt; Bool) -&gt; Parser Char\nsat f = item &gt;&gt;&gt; \\c -&gt; if f c then success c else failure\n\ndigit :: Parser Char \ndigit = sat isDigit\n\nspace :: Parser Char\nspace = sat isSpace\n\nchar :: Char -&gt; Parser Char\nchar c = sat (== c)\n\n-- Alternative parsers\n\n(+++) :: Parser a -&gt; Parser a -&gt; Parser a\np +++ q = \\inp -&gt; case p inp of\n                    Nothing -&gt; q inp \n                    Just res -&gt; Just res\n\n-- Iterative Parsers\n\nmany :: Parser a -&gt; Parser [a]\nmany p = many1 p +++ success []\n\nmany1 :: Parser a -&gt; Parser [a]\nmany1 p = p &gt;&gt;&gt; \\v -&gt; many p &gt;&gt;&gt; \\vs -&gt; success (v : vs)\n\n--Token\n\nnat :: Parser Int\nnat = many1 digit &gt;&gt;&gt; \\cs -&gt; success (read cs)\n\nspaces :: Parser ()\nspaces = many space &amp;&amp;&amp; success ()\n\ntoken :: Parser a -&gt; Parser a\ntoken p = spaces &amp;&amp;&amp; p\n\nnatural :: Parser Int\nnatural = token nat\n\nsymbol :: Char -&gt; Parser Char\nsymbol c = token (char c)\n</code></pre>\n\n<p>Now I have to develop a function <code>expr</code> that takes a <code>String</code> and converts it into a <code>Expr</code>.</p>\n\n<p>To do that in my homework I find already the function defined as follow:</p>\n\n<pre><code>expr :: Parser Expr\nexpr = term &gt;&gt;&gt; \\t -&gt; (symbol '+' &amp;&amp;&amp; expr &gt;&gt;&gt; \\e -&gt; success $ Add t e) +++ (symbol '-' &amp;&amp;&amp; expr &gt;&gt;&gt; \\e -&gt; success $ Sub t e) +++ success t\n</code></pre>\n\n<p>I understand that I have to develop three functions: <code>term</code>, <code>power</code> and <code>factor</code>.</p>\n\n<p>The function <code>factor</code> should parse a constant or a variable.</p>\n\n<p>The function <code>term</code> should parse a single <code>factor</code> (for example <code>2</code>) or a multiplication between two <code>factor</code>s (for example <code>2*x</code>). </p>\n\n<p>I don't understand very well how monads work and I'm having problems to do my homework. Any help on how these functions should be written?</p>\n\n<p>Here is the image I found in my homework.</p>\n\n<p><a href=\"https://i.stack.imgur.com/BczTfm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BczTfm.png\" alt=\"Diagrams for the parsing of term factor and expressions.\"></a></p>\n"}, {"tags": ["linux", "haskell", "vim", "raspberry-pi", "vi"], "comments": [{"owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "edited": false, "score": 0, "creation_date": 1437557953, "post_id": 31559343, "comment_id": 51074877, "body": "vi or have you access to vim ?"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "edited": false, "score": 0, "creation_date": 1437558442, "post_id": 31559343, "comment_id": 51075206, "body": "@Geoffroy yes, can use vim also"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437558613, "post_id": 31559343, "comment_id": 51075345, "body": "In addition to cxw&#39;s answer, you can run shell commands from vim with <code>:!</code> - e.g. <code>:!ghc -o first first.hs</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1437566960, "post_id": 31559343, "comment_id": 51081016, "body": "It is indeed tricky to get a full GHC with interactive/TH compiled on the R\u03c0 (I did manage it, but <a href=\"http://stackoverflow.com/questions/29379706/ghci-on-raspberry-pi-2\">don&#39;t ask me how</a>). But apparently there are now ready binaries <a href=\"http://www.reddit.com/r/haskell/comments/35bw0b/at_last_debian_unstable_has_working_arm_ghci_and/\" rel=\"nofollow noreferrer\">in Debian-unstable</a>, with those it should be easy enough."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437584140, "post_id": 31559343, "comment_id": 51093813, "body": "@leftaroundabout can you point me where to get copy of Debian-unstable image for pi ?"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437589195, "post_id": 31559343, "comment_id": 51096832, "body": "@leftaroundabout yes, that did the trick, thanks. To install change /etc/apt/sources.list to deb <a href=\"http://http.debian.net/debian\" rel=\"nofollow noreferrer\">http.debian.net/debian</a> sid main contrib non-free  sudo apt-get update sudo apt-get upgrade sudo apt-get install ghc sudo apt-get install cabal-install. Error during installation , needed to run :  gpg --keyserver pgpkeys.mit.edu --recv-key  8B48AD6246925553       gpg -a --export 8B48AD6246925553 | sudo apt-key add -  gpg --keyserver pgpkeys.mit.edu --recv-key  7638D0442B90D010       gpg -a --export 7638D0442B90D010 | sudo apt-key add -"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437589284, "post_id": 31559343, "comment_id": 51096883, "body": "ref for previous comment in question content of : <a href=\"http://stackoverflow.com/questions/30201508/why-cant-i-install-any-packages-with-ghc-7-8-4-on-raspberry-pi\" title=\"why cant i install any packages with ghc 7 8 4 on raspberry pi\">stackoverflow.com/questions/30201508/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "is_accepted": false, "score": 1, "last_activity_date": 1437584557, "last_edit_date": 1437584557, "creation_date": 1437558181, "answer_id": 31559485, "question_id": 31559343, "link": "https://stackoverflow.com/questions/31559343/run-command-from-within-vi-vim/31559485#31559485", "title": "Run command from within vi / vim", "body": "<p>Absolutely in vim, though not necessarily in other vi flavors.  See <a href=\"http://www.ibm.com/developerworks/library/l-vim-script-2/\" rel=\"nofollow\">this tutorial</a> on defining custom commands.  Put the custom command in your <code>vimrc</code> and it will always be available as <code>:Customcmd</code> or whatever you call it.  For one-button access, you can use <code>:remap</code> to assign a hotkey to your custom command or the sequence of built-in commands you want to run.  <a href=\"http://vim.wikia.com/wiki/Mapping_keys_in_Vim_-_Tutorial_(Part_1)\" rel=\"nofollow\">This</a> is a tutorial on keymappings that will give you more information.</p>\n\n<p>I second @statox's referral to <a href=\"https://vi.stackexchange.com\">https://vi.stackexchange.com</a> :)</p>\n"}, {"comments": [{"owner": {"reputation": 2425, "user_id": 4194289, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/cQYY1.png?s=128&g=1", "display_name": "statox", "link": "https://stackoverflow.com/users/4194289/statox"}, "edited": false, "score": 1, "creation_date": 1437571684, "post_id": 31564483, "comment_id": 51084547, "body": "Also for your questions concerning vim and its usage you could be interested in <a href=\"http://vi.stackexchange.com/\">the dedicated stackexchange site</a> where answers are pretty fast ;-)"}], "tags": [], "owner": {"reputation": 2425, "user_id": 4194289, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/cQYY1.png?s=128&g=1", "display_name": "statox", "link": "https://stackoverflow.com/users/4194289/statox"}, "is_accepted": true, "score": 2, "last_activity_date": 1437571456, "creation_date": 1437571456, "answer_id": 31564483, "question_id": 31559343, "link": "https://stackoverflow.com/questions/31559343/run-command-from-within-vi-vim/31564483#31564483", "title": "Run command from within vi / vim", "body": "<p>Maybe you could try adding something like this to your <code>vimrc</code>:</p>\n\n<pre><code>function! ExecuteHS()\n    w\n    !ghc -o first %\n    !./first\nendfunction\n</code></pre>\n\n<p>And to use this function you just have to call it like that <code>:call ExecuteHS()</code>. Vim will be put on background during the execution of your file and will then come back on foreground at the end of the execution.</p>\n\n<p>As a bonus you can add the folowing line to your <code>vimrc</code></p>\n\n<pre><code>nnoremap &lt;key&gt; :call ExecuteHS()&lt;CR&gt;\n</code></pre>\n\n<p>Replacing <code>&lt;key&gt;</code> with your prefered key combination <code>&lt;Leader&gt;e</code> for example. This way you'll simply have to hit <kbd>,</kbd><kbd>e</kbd> (if you didn't changed your leader key) in normal mode to call the function.</p>\n\n<p>That's probably not the cleanest way to do it but it should work for what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1437613189, "creation_date": 1437613189, "answer_id": 31576505, "question_id": 31559343, "link": "https://stackoverflow.com/questions/31559343/run-command-from-within-vi-vim/31576505#31576505", "title": "Run command from within vi / vim", "body": "<p>I use <a href=\"https://github.com/elliottt/vim-haskell\" rel=\"nofollow\">vim-haskell</a>, which includes a couple nice things. In particular, it includes a file for setting up cabal-install as the compiler, which is a very nice way of working. Dump this in <code>~/.vim/compiler/cabal-build.vim</code>:</p>\n\n<pre><code>CompilerSet makeprg=cabal\\ build\nCompilerSet errorformat=\n            \\%W%f:%l:%c:\\ Warning:%m,\n            \\%W%f:%l:%c:\\ Warning:,\n            \\%E%f:%l:%c:%m,\n            \\%E%f:%l:%c:,\n            \\%C\\ \\ %#%m,\n            \\%-G%.%#,\n            \\%-G%.%#\n</code></pre>\n\n<p>And this in <code>~/.vim/ftplugin/haskell.vim</code>:</p>\n\n<pre><code>compiler cabal-build\n</code></pre>\n\n<p>(The argument to <code>compiler</code> should match the name of the file you put in <code>~/.vim/compiler</code>.) Then you can run <code>:make</code> in vim and it will save any changed buffers (assuming <code>autowrite</code> is set) and build your project. When there are errors, it will populate the quick-fix list, which lets you jump to the specific file and line numbers of each error or warning with a key. Read more about this feature with <code>:help quickfix</code>. Once everything is working, you can <code>:!cabal run</code> to run it.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 31564483, "answer_count": 3, "score": 2, "last_activity_date": 1437613189, "creation_date": 1437557806, "last_edit_date": 1437558470, "question_id": 31559343, "link": "https://stackoverflow.com/questions/31559343/run-command-from-within-vi-vim", "title": "Run command from within vi / vim", "body": "<p>As part of learning Haskell, for fun I'm attempting to use Raspberry PI. Having encountered a myriad of issues installing ghci on the PI I've resolved to using just ghc.</p>\n\n<p>So to create, compile &amp; run a new Haskell file : </p>\n\n<pre><code>vi first.hs\ni\nmain = putStrLn \"First\"\nEsc\n:w\n:q\nghc -o first first.hs\n./first\n</code></pre>\n\n<p>Output is : \"First\"</p>\n\n<p>I would like to automate the commands : </p>\n\n<pre><code>Esc\n:w\n:q\nghc -o first first.hs\n./first\n</code></pre>\n\n<p>Can these be added as new command from within vi / vim, something like : </p>\n\n<p>:mycustomcommands</p>\n\n<p>And run from within the vi / vim editor ?</p>\n"}, {"tags": ["python", "haskell", "pyparsing", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 55852, "user_id": 165216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U7Xse.jpg?s=128&g=1", "display_name": "PaulMcG", "link": "https://stackoverflow.com/users/165216/paulmcg"}, "edited": false, "score": 0, "creation_date": 1437654282, "post_id": 31561634, "comment_id": 51126407, "body": "Interesting extension, sort of a Ternary operator class."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1437563991, "creation_date": 1437563991, "answer_id": 31561634, "question_id": 31557571, "link": "https://stackoverflow.com/questions/31557571/choose-parser-based-on-previous-results/31561634#31561634", "title": "choose parser based on previous results", "body": "<p>Here is an outline of a solution which should work. The idea is to implement a new parser class which runs one parser and selects between two alternatives based on the tokens returned.</p>\n\n<pre><code># modeled after class And in pyparsing.py\nclass IfThenElse(ParseExpression):\n\n  def __init__(self, exprs, savelist = True):\n    super(IfThenElse,self).__init__(exprs, savelist)\n    self.parserIf = exprs[1]     # maybe exprs[0]?\n    self.parserThen = exprs[2]\n    self.parserElse = exprs[3]\n    self.mayReturnEmpty = all(e.mayReturnEmpty for e in exprs[2:])\n    self.setWhitespaceChars( ... )\n    self.skipWhitespace = self.exprs[0].skipWhitespace\n\n  def parseImpl(self, instring, loc, doActions = True):\n    loc, toks = self.parserIf._parse(instring, loc, doActions)\n\n    if ...toks...:\n      loc, toks2 = self.parserThen._parse(instring, loc, doActions)\n    else:\n      loc, toks2 = self.parserElse._parse(instring, loc, doActions)\n\n    return loc, toks2   # maybe combine toks and toks2?\n\ndef __str__(self):\n  return \"blah\"         # for now\n</code></pre>\n\n<p>The <code>if ...toks...</code> is where you put your switching logic.</p>\n\n<p>You'll also want to implement a <code>__str__</code> method and possibly a <code>checkRecursion</code> method.</p>\n\n<p>There are some details to figure out... maybe <code>exprs[0]</code> is the \"if\" parser instead of <code>exprs[1]</code>.</p>\n\n<p>Instantiate this parser with <code>IfThenElse(p, q, r)</code> -- should have the same syntax as the <code>And</code> parser.</p>\n"}, {"tags": [], "owner": {"reputation": 55852, "user_id": 165216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U7Xse.jpg?s=128&g=1", "display_name": "PaulMcG", "link": "https://stackoverflow.com/users/165216/paulmcg"}, "is_accepted": true, "score": 1, "last_activity_date": 1437595171, "creation_date": 1437595171, "answer_id": 31572881, "question_id": 31557571, "link": "https://stackoverflow.com/questions/31557571/choose-parser-based-on-previous-results/31572881#31572881", "title": "choose parser based on previous results", "body": "<p>I think in pyparsing one would just write:</p>\n\n<pre><code>oneParserToRuleThemAll = header1 + parser1 | header2 + parser2\n</code></pre>\n\n<p>If the header line matches 'header1', then pyparsing will continue on and use parser1 for the rest of the parsing. Otherwise it will try to match 'header2' and if that matches, will use parser2.</p>\n\n<p>One can definitely get more exotic using dynamic parser elements and parse actions. That would look like this:</p>\n\n<pre><code>foo_parser = ...\nbar_parser = ...\n\nvariable_parser = Forward()\nswitch_parser = Literal(\"foo\") | Literal(\"bar\")\ndef select_variable_parser(tokens):\n    if tokens[0] == \"foo\":\n        variable_parser &lt;&lt;= foo_parser\n    if tokens[0] == \"bar\":\n        varaible_parser &lt;&lt;= bar_parser\nswitch_parser.setParseAction(select_variable_parser)\nparser = switch_parser + variable_parser\n</code></pre>\n\n<p>Note the use of the \"shift-into\" operator &lt;&lt;= to define the variable part of the parser by inserting into the previously-defined Forward().</p>\n\n<p>But this is easier to follow, I think:</p>\n\n<pre><code>parser = \"foo\" + foo_parser | \"bar\" + bar_parser\n</code></pre>\n"}], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 31572881, "answer_count": 2, "score": 2, "last_activity_date": 1437595171, "creation_date": 1437553012, "last_edit_date": 1437554888, "question_id": 31557571, "link": "https://stackoverflow.com/questions/31557571/choose-parser-based-on-previous-results", "title": "choose parser based on previous results", "body": "<p>I'm parsing several outputs and these files have two different headers:</p>\n\n<pre><code>header1 = \" MO EIGENVALUES, MO OCCUPATION NUMBERS, AND CARTESIAN MO EIGENVECTORS AFTER SCF STEP -1\"\n\nheader2 =  \"MO EIGENVALUES, MO OCCUPATION NUMBERS, AND SPHERICAL MO EIGENVECTORS AFTER SCF STEP -1\"\n</code></pre>\n\n<p>Based on the statement that the results are in <em>CARTESIAN</em> or <em>SPHERICAL</em> coordinates, I want to apply the corresponding parser.</p>\n\n<p>In Haskell I can write a parser that decides what to do next based on previous results as follows,</p>\n\n<pre><code>myparser = do\n    xs &lt;- someParser\n    if xs == \"foo\"\n       then parser1\n       else parser2\n</code></pre>\n\n<p>How can I create the same function in python using pyparsing?</p>\n\n<p>note: I don't know <em>a priori</em> if an output is on cartesian or spherical coordinates.</p>\n"}, {"tags": ["performance", "haskell"], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 1, "closed_date": 1437550964, "answer_count": 0, "score": 5, "last_activity_date": 1437548941, "creation_date": 1437548941, "question_id": 31556185, "link": "https://stackoverflow.com/questions/31556185/how-can-i-efficiently-process-a-recursive-data-structure-with-a-high-degree-of-s", "closed_reason": "Duplicate", "title": "How can I efficiently process a recursive data structure with a high degree of sharing?", "body": "<p>Consider a recursive, branching data structure:</p>\n\n<pre><code>data Tree a = Node (Tree a) (Tree a) | Leaf a\n    deriving (Show)\n</code></pre>\n\n<p>It is possible to construct a <code>Tree</code> with many identical branches, and this seems to be handled efficiently (at least in GHC) - for example, by:</p>\n\n<pre><code>maketree :: Integer -&gt; a -&gt; Tree a\nmaketree 1 value = Leaf value\nmaketree depth value = let child = maketree (depth-1) value in Node child child\n</code></pre>\n\n<p><code>maketree 32 \"Hello\"</code> will return a <code>Tree String</code> that conceptually contains 4294967295 nodes - but in practice only 32 nodes will be stored in memory, and the body of <code>maketree</code> will only be evaluated 32 times.</p>\n\n<p>However, suppose we actually try to use the entire tree in some way - say, to count the number of nodes:</p>\n\n<pre><code>count :: Tree a -&gt; Integer\ncount n = case n of\n    Leaf _   -&gt; 1\n    Node a b -&gt; 1 + count a + count b\n</code></pre>\n\n<p><code>count (maketree 32 \"Hello\")</code> will (correctly) evaluate to 4294967295, but it will do so by evaluating the body of <code>count</code> 4294967295 times.</p>\n\n<p>But since there are actually only 32 \"node objects\" stored in memory, and since <code>count</code> is pure (being a Haskell function) it should be possible to cache the result for each node object, and only evaluate <code>count</code> 32 times in total.</p>\n\n<p>Is there any way to make GHC (or any Haskell implementation) do this?</p>\n"}, {"tags": ["sockets", "haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1437554415, "post_id": 31555789, "comment_id": 51072435, "body": "There is a discussion going right now about this in the <a href=\"https://groups.google.com/forum/#!topic/haskell-cafe/sFr3OqFg9g0\" rel=\"nofollow noreferrer\">haskell-cafe mailing list</a>"}, {"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "edited": false, "score": 0, "creation_date": 1574617539, "post_id": 31555789, "comment_id": 104286645, "body": "This discussion on Google Groups is inaccessible."}], "owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1437547667, "creation_date": 1437547667, "question_id": 31555789, "link": "https://stackoverflow.com/questions/31555789/when-to-call-setfdoption-fd-closeonexec-true", "title": "When to call &quot;setFdOption fd CloseOnExec True&quot;?", "body": "<p>I found this when reading the <a href=\"http://haddock.stackage.org/lts-2.19/warp-3.0.13.1/src/Network-Wai-Handler-Warp-Run.html#runSettings\" rel=\"nofollow\">warp source code</a>.</p>\n\n<pre><code>-- | Run an 'Application' with the given 'Settings'.\nrunSettings :: Settings -&gt; Application -&gt; IO ()\nrunSettings set app = withSocketsDo $\n    bracket\n        (bindPortTCP (settingsPort set) (settingsHost set))\n        sClose\n        (\\socket -&gt; do\n            setSocketCloseOnExec socket\n            runSettingsSocket set socket app)\n\n-- Copied from: https://github.com/mzero/plush/blob/master/src/Plush/Server/Warp.hs\nsetSocketCloseOnExec :: Socket -&gt; IO ()\n#if WINDOWS\nsetSocketCloseOnExec _ = return ()\n#else\nsetSocketCloseOnExec socket =\n    setFdOption (fromIntegral $ fdSocket socket) CloseOnExec True\n#endif\n</code></pre>\n\n<blockquote>\n  <p>Sockets used by the web server need to be set so that they are not leaked into processes fork/exec'd by the shell.</p>\n</blockquote>\n\n<p>However, <a href=\"http://haddock.stackage.org/lts-2.19/network-simple-0.4.0.4/src/Network-Simple-TCP.html#acceptFork\" rel=\"nofollow\"><code>acceptFork</code></a> in <code>Network.Simple.TCP</code> module does not set <code>CloseOnExec</code> option. Shouldn't this option be the default?</p>\n"}, {"tags": ["haskell", "conduit", "network-conduit"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1437555412, "post_id": 31555409, "comment_id": 51073087, "body": "Can you provide a complete example? Coming up with the smallest possible example can really help in narrowing down the problem."}], "answers": [{"tags": [], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "is_accepted": true, "score": 0, "last_activity_date": 1437602624, "creation_date": 1437602624, "answer_id": 31574810, "question_id": 31555409, "link": "https://stackoverflow.com/questions/31555409/why-does-await-always-return-nothing-when-using-network-conduits/31574810#31574810", "title": "Why does await always return Nothing when using network conduits?", "body": "<p>I figured out my error, I forgot that cereal serializes bytestring by sending length :: Int followed by the actual data. I was only sending a single byte for the length.</p>\n"}], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 31574810, "answer_count": 1, "score": 0, "last_activity_date": 1437602624, "creation_date": 1437546260, "last_edit_date": 1437562555, "question_id": 31555409, "link": "https://stackoverflow.com/questions/31555409/why-does-await-always-return-nothing-when-using-network-conduits", "title": "Why does await always return Nothing when using network conduits?", "body": "<p>I'm trying to learn how to use conduits. I have a conduit that takes bytestrings and groups them into packets that represent actions being sent to a server. I then have a conduit that takes these packets, acts on them and yields a response packet. Finally I have a conduit that takes the response packets and turns them into a stream of bytestrings. The problem is that yield in the packet handling conduit always returns Nothing. My code looks like this</p>\n\n<pre><code>processingConduit :: ServerState -&gt; Conduit BS.ByteString IO BS.ByteString\nprocessingConduit state = getPacketConduit\n    =$= processPacketConduit state\n    =$= putPacketConduit\n\nprocessPacketConduit :: ServerState -&gt; Conduit ClientPacket IO ServerPacket\nprocessPacketConduit state = awaitForever $ \\packet -&gt; do\n    liftIO $ putStrLn \"got something :)\"\n    let function = case packet of\n            (LoginPacket _ _) -&gt; login\n            _                 -&gt; ugh\n    result &lt;- liftIO $ function state packet\n    yield result\n\ngetPacketConduit :: Conduit BS.ByteString IO ClientPacket\ngetPacketConduit = conduitGet (get :: Get ClientPacket)\n\nputPacketConduit :: Conduit ServerPacket IO BS.ByteString\nputPacketConduit = conduitPut (put :: ServerPacket -&gt; Put)\n</code></pre>\n\n<p>I run the conduit using runTCPServer and it's able to accept connections and the getPacketConduit is able to convert the bytestring into valid packets, but awaitForever never calls its function. If I modify processPacketConduit to use await instead, I can see that it always returns Nothing.</p>\n"}, {"tags": ["haskell", "functional-programming", "typeclass", "currying"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1437532780, "post_id": 31552800, "comment_id": 51063833, "body": "The first case with <code>id</code> is very well explained in <a href=\"http://stackoverflow.com/questions/8745597/defining-a-function-by-equations-with-different-number-of-arguments\">this question</a>. By the way, be sure to take note of and mention in your questions the specific errors you get - it makes it easier both for you and for answerers to find answers."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437532936, "post_id": 31552800, "comment_id": 51063866, "body": "Great point, I will keep it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443978569, "post_id": 31552800, "comment_id": 53697512, "body": "If you&#39;re interested in point-free expressions, you might think this definition cute: <code>fmap = either id</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1437533547, "post_id": 31552901, "comment_id": 51064000, "body": "I understood your answer partially, but I still think it is strange, because (correct me if I am wrong), returning <code>Left x</code> instead of <code>all</code> would also be of type <code>Either e a</code>, they are the same thing... I am trying to think the simplest way possible"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 2, "creation_date": 1437533608, "post_id": 31552901, "comment_id": 51064018, "body": "No, you are wrong. If <code>x :: e</code>, then <code>Left x :: Either e c</code> for any choice of <code>c</code>. If you set <code>c ~ b</code>, you get <code>Left x :: Either e b</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 2, "creation_date": 1437543028, "post_id": 31552901, "comment_id": 51066572, "body": "@FtheBuilder <code>id</code> has type <code>a -&gt; a</code>, the return type matches <b>exactly</b> the type of the argument. So it maps <code>Either a b</code> into an other <code>Either a b</code>. But the return type of <code>fmap</code> does <b>not</b> match exactly the second argument, even though one of its parameters doesn&#39;t change. Hence using simply <code>= id</code> wont work. Also using <code>all</code> doesn&#39;t work for the same reason: the argument has the wrong type. Haskell cannot simply generalize the type of the argument to allow what you want."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1437568147, "post_id": 31552901, "comment_id": 51081909, "body": "@Bakuru, yes, it makes sense, but, what happens here: <code>let a = Left &#39;a&#39;; let b = fmap (+3) a; a == b;</code> =&gt; this outputs <code>True</code>, well, doesn&#39;t it make sense they work for the same types? Sorry for repeating myself again and again, I just think it could be simpler, instead of having to construct <code>Left a</code> again..."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1444035148, "post_id": 31552901, "comment_id": 53714190, "body": "@FtheBuilder: see my answer for how to not have to construct a <code>Left a</code> again."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 7, "last_activity_date": 1437532406, "creation_date": 1437532406, "answer_id": 31552901, "question_id": 31552800, "link": "https://stackoverflow.com/questions/31552800/why-cant-i-make-either-instance-of-functor-using-id-in-haskell/31552901#31552901", "title": "Why can&#39;t I make Either instance of Functor using id in Haskell?", "body": "<p>Let's look at the type of fmap specialized for the <code>Either</code> functor:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Either e a -&gt; Either e b\n</code></pre>\n\n<p>As we can see from this, in <code>fmap f all@(Left _)</code>, the type of <code>all</code> is <code>Either e a</code>. This doesn't match the intended result type <code>Either e b</code> prescribed by the signature of <code>fmap</code>, so <code>fmap f all@(Left _) = all</code> is not well-typed.</p>\n\n<p>Similarly for the case using <code>id</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1437567033, "post_id": 31555830, "comment_id": 51081071, "body": "Your explanation was really amazing, made me understand better how Haskell controls types. By the way, is there any motive which the Haskell makers didn&#39;t make it analyse the <b>given</b> value, to find out whether it could be of the type of the return type? I think this approach is more straight forward,  although I understood why the given program doesn&#39;t compile. Shouldn&#39;t Haskell be the most simple way possible for programmers?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 3, "creation_date": 1437583137, "post_id": 31555830, "comment_id": 51093252, "body": "@FtheBuilder Primarily because we use types to enforce invariants, and so we don&#39;t like when things are done behind our backs to our types. A comparable, if simpler, situation is how there is no implicit casting of numbers in Haskell. In any case, your implicit conversion would be of limited use, as it could only work when you pattern match on <code>Left</code>. There is no total function <code>Either a b -&gt; Either a c</code> (&quot;total&quot; here is the technical term for &quot;works in all cases&quot;)."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437659434, "post_id": 31555830, "comment_id": 51130549, "body": "@duplode Could you please explain better this passage: &quot;Primarily because we use types to enforce invariants, and so we don&#39;t like when things are done behind our backs to our types.&quot;, maybe saying the same thing with different words"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1437660649, "post_id": 31555830, "comment_id": 51131532, "body": "@FtheBuilder The point is you can give very strong guarantees about how Haskell functions behave based <i>only</i> on types. That goes from knowing that for <i>any</i> <code>Functor</code> if <code>fmap</code> follows <code>fmap id = id</code> then can&#39;t do anything but change the values within the functor, to capturing very general concepts merely by clever choices of type classes to fill in a signature, and to designing complex libraries that can&#39;t be used in a wrong way without causing a type error. If types are used like that, implicit conversions can only lead to bugs and confusion. That&#39;s why you don&#39;t see them in Haskell."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 7, "last_activity_date": 1437547814, "creation_date": 1437547814, "answer_id": 31555830, "question_id": 31552800, "link": "https://stackoverflow.com/questions/31552800/why-cant-i-make-either-instance-of-functor-using-id-in-haskell/31555830#31555830", "title": "Why can&#39;t I make Either instance of Functor using id in Haskell?", "body": "<p>What you're trying to do boils down to this:</p>\n\n<pre><code>f :: Either a Bool -&gt; Either a ()\nf (Right _) = Right ()\nf left = left\n</code></pre>\n\n<p>with error:</p>\n\n<pre><code>foo.hs:3:7:\n    Couldn't match type \u2018Bool\u2019 with \u2018()\u2019\n    Expected type: Either a ()\n      Actual type: Either a Bool\n    In the expression: left\n    In an equation for \u2018f\u2019: f left = left\nFailed, modules loaded: none.\n</code></pre>\n\n<p><code>left</code> is bound to the function argument. So the type checker knows it's of type <code>Either a Bool</code>. Then it's used as the return value. We know from the type <code>f :: Either a Bool -&gt; Either a ()</code> that the return value must be of type <code>Either a ()</code>. If <code>left</code> is a valid return value, it's type must match the return type of <code>f</code>. So <code>Either a ()</code> must be equal to <code>Either a Bool</code>; it is not, so the type checker rejects the program.</p>\n\n<p>In turn, it's basically the same problem as this:</p>\n\n<pre><code>\u03bb let l = Left () :: Either () ()\nl :: Either () ()\n\n\u03bb l\nLeft ()\nit :: Either () ()\n\n\u03bb l :: Either () Bool\n\n&lt;interactive&gt;:10:1:\n    Couldn't match type \u2018()\u2019 with \u2018Bool\u2019\n    Expected type: Either () Bool\n      Actual type: Either () ()\n    In the expression: l :: Either () Bool\n    In an equation for \u2018it\u2019: it = l :: Either () Bool\n</code></pre>\n\n<p>We gave <code>l</code> a binding and a type, then tried to use it as a different type. That's invalid (and feeding it through <code>id</code> wouldn't change its type either). Even though <code>Left ()</code> is also valid <em>source code text</em> for a value of type <code>Either () Bool</code>, that doesn't mean that a particular value known to be of type <code>Either () ()</code> that could be defined with the source text <code>Left ()</code> can be used as if it were of type <code>Either () Bool</code>.</p>\n\n<p>If you had a polymorphic value, you could do this:</p>\n\n<pre><code>\u03bb let l = Left ()\nl :: Either () b\n\n\u03bb l :: Either () ()\nLeft ()\nit :: Either () ()\n\n\u03bb l :: Either () Bool\nLeft ()\nit :: Either () Bool\n</code></pre>\n\n<p>Note that the original <code>l</code> value here was polymorphic in <code>b</code>; it can be used as an <code>Either () b</code> for <em>any</em> b.</p>\n\n<p>But your <code>fmap</code> case is subtly different. The <strong>function</strong> <code>fmap</code> is polymorphic in the <code>b</code>, but the value of its argument is \"within the scope of the polymorphism\"; at the point you have your argument the type <code>b</code> has been chosen to be some specific type <em>by the caller of fmap</em>, so it's \"some unknown type that could by anything\" rather than \"any type I feel like choosing\". There is no way to somehow turn a value of type <code>Either a b</code> into a value of type <code>Either a c</code>, so you have to extract the <code>a</code> value and then create an <code>Either a c</code> containing it.</p>\n"}, {"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 0, "last_activity_date": 1444035217, "last_edit_date": 1444035217, "creation_date": 1444034914, "answer_id": 32944508, "question_id": 31552800, "link": "https://stackoverflow.com/questions/31552800/why-cant-i-make-either-instance-of-functor-using-id-in-haskell/32944508#32944508", "title": "Why can&#39;t I make Either instance of Functor using id in Haskell?", "body": "<p>In terms of explaining the type error, I have nothing to add to the previous two answers, however I'd like to mention that <code>Left x :: Either t a</code> is represented in memory the same way as <code>Left x :: Either t b</code>. What this means is that even though the type system does not let you use an <code>Either t a</code> in place of a value of type <code>Either t b</code>, for reasons already explained in perfect clarity by the other answers, you can \"force\" it through the type checker using <code>unsafeCoerce</code>:</p>\n\n<pre><code>import Unsafe.Coerce (unsafeCoerce)\n\ninstance Functor (Either t) where\n  fmap f (Right a) = Right (f a)\n  fmap f l         = unsafeCoerce l\n</code></pre>\n\n<p>And even though <code>unsafeCoerce</code> is generally regarded as something to avoid, if you know what you are doing, and you have a valid reason to do so, such as performance, <code>unsafeCoerce</code> can be useful in letting the compiler know you are sure the runtime value will match the expected structure.</p>\n\n<p>In this case, without <code>unsafeCoerce</code>, and not considering any potential GHC optimizations, <code>fmap f (Left x) = Left x</code> would always construct a new but physically identical <code>Left</code> value, whereas the <code>unsafeCoerce</code> flavor would just return the original <code>Left</code> value with no additional memory allocations.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 3, "accepted_answer_id": 31555830, "answer_count": 3, "score": 6, "last_activity_date": 1444035217, "creation_date": 1437531697, "last_edit_date": 1443968313, "question_id": 31552800, "link": "https://stackoverflow.com/questions/31552800/why-cant-i-make-either-instance-of-functor-using-id-in-haskell", "title": "Why can&#39;t I make Either instance of Functor using id in Haskell?", "body": "<p>When making my custom <code>Either</code>, and <code>Functor</code>, just to understand clearer types and typeclasses, I found the following situation:</p>\n\n<p><strong><code>Functor</code></strong></p>\n\n<pre><code>module Functor (Functor, fmap) where\n\nimport Prelude hiding(Functor, fmap)\n\nclass Functor f where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p><strong><code>Either</code></strong></p>\n\n<pre><code>module Either(Either(..)) where\nimport Prelude hiding(Either(..), Functor, fmap)\n\ndata Either a b = Left a | Right b deriving(Show)\n\ninstance Functor (Either a) where\n  fmap f (Right x) = Right (f x)\n  fmap _ (Left x) = Left x\n</code></pre>\n\n<p>The code showed above compiles fine but, if I change it to use <code>id</code>, it doesn't compile:</p>\n\n<pre><code>instance Functor (Either a) where\n  fmap f (Right x) = Right (f x)\n  fmap _ = id\n</code></pre>\n\n<p>Why?? Did I miss something? The following code also doesn't work:</p>\n\n<pre><code>instance Functor (Either a) where\n  fmap f (Right x) = Right (f x)\n  fmap f all@(Left x) = all\n</code></pre>\n\n<p>... This seems to me very strange because the code showed below compiles:</p>\n\n<pre><code>data Shape = Circle Point Float | Rectangle Point Point deriving (Show)\n\ndata Point = Point Float Float deriving (Show)\n\ntest :: Shape -&gt; String\ntest (Circle _ x) = show x\ntest all@(Rectangle _ x) = show all ++ \" - \"++ show x\n</code></pre>\n\n<p>Thank you in advance </p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437550142, "post_id": 31552064, "comment_id": 51069932, "body": "As you say, <code>(&gt;&gt;=) = join . fmap</code>, but before GHC 7.10 <code>Monad</code> was <i>not</i> automatically a functor. In that sense, we define both <code>join</code> and <code>fmap</code> within <code>bind</code>. It&#39;s also much easier sometimes to implement <code>&gt;&gt;=</code> than join. Try doing it for, say, the parser/state functor."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437577097, "post_id": 31552064, "comment_id": 51088952, "body": "@AJFarmar I don&#39;t think <code>(&gt;&gt;=) = join . fmap</code> works. The arguments are flipped and there are some other problems. But good points!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437577253, "post_id": 31552064, "comment_id": 51089095, "body": "Ah, you&#39;re right,  it&#39;s actually <code>(join .) . flip fmap</code>, but the idea was there, as you say."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437608042, "post_id": 31552064, "comment_id": 51106268, "body": "@AJFarmar, it&#39;s better to go with <code>=&lt;&lt;</code>, which matches the rest of the world better. <code>f =&lt;&lt; m = join (fmap f m)</code> or <code>(=&lt;&lt;) f = join . fmap f</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1532964491, "post_id": 31552064, "comment_id": 90160714, "body": "I&#39;m closing this against a newer question because Alexis&#39; answer there supersedes my answer here."}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 6, "creation_date": 1437555151, "post_id": 31552223, "comment_id": 51072898, "body": "And that&#39;s s terrible reason to exclude <code>join</code>.  It should be part of the Monad class."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1437566238, "post_id": 31552223, "comment_id": 51080508, "body": "@augustss, it&#39;s a <i>sad</i> reason, not a <i>bad</i> one. Being able to use generalized newtype deriving and coercions for monads is a good thing."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1437577334, "post_id": 31552223, "comment_id": 51089156, "body": "@dfeuer It&#39;s as you say, but one can simply define <code>join</code> independently and then use the identity <code>(&gt;&gt;=) = (join .) . flip fmap</code> as I pointed out above, so it&#39;s not that much of a problem."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1437618360, "post_id": 31552223, "comment_id": 51108742, "body": "@dfeuer I think it&#39;s a bad reason. GNTD is, IMO, implemented with an unsound hack.  And now they have constructed an elaborate type system to make the hack sound, and everyone has to pay for it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1437620116, "post_id": 31552223, "comment_id": 51109119, "body": "@augustss, how do you think it should be handled? I agree that type roles are not quite the cleanest language feature ever."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1437643703, "post_id": 31552223, "comment_id": 51119318, "body": "@dfeuer There are two issues, how to decide which GNTD to accept and how to make zero cost coercions.  To decide if a newtype deriving is acceptable I think the compiler should construct an instance declaration and make sure it type checks.  This will rule out the bad cases, but also some good cases.  I&#39;m willing to take that loss.  To get zero cost coercions you could still use coercions the way ghc does, but I would prefer the compiler recognizing identity functions and internally replacing them by coercions.  I consider the current ghc situation an abstraction leak."}, {"owner": {"reputation": 1039, "user_id": 3209348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30cc6bf1460b8cc9b5ff83178dfce208?s=128&d=identicon&r=PG", "display_name": "DirkyJerky", "link": "https://stackoverflow.com/users/3209348/dirkyjerky"}, "edited": false, "score": 1, "creation_date": 1459396657, "post_id": 31552223, "comment_id": 60270553, "body": "As a person who only learned Haskell within the past year, and have researched this issue, I believe that adding join would be better <i>overall</i>, specifically it would <i>lower the bar of entry for people learning the language</i>. When I personally tried to learn monads, Bind was an extremely difficult topic to grasp. Then I learned about join, which was much easier to understand, and once I did I could understand bind by its definition in terms of join (and fmap). It would also make for newer users actually being able to implement Monads for practice without outside help."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 21, "last_activity_date": 1437558291, "last_edit_date": 1437558291, "creation_date": 1437527209, "answer_id": 31552223, "question_id": 31552064, "link": "https://stackoverflow.com/questions/31552064/why-isnt-join-part-of-the-monad-class/31552223#31552223", "title": "Why isn&#39;t `join` part of the `Monad` class", "body": "<p>That was meant to happen with the <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"noreferrer\">Applicative-Monad proposal</a> (which has made it to GHC 7.10). However, there is <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Roles2#join\" rel=\"noreferrer\">a technical issue</a> involving <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Roles\" rel=\"noreferrer\">type roles</a> in GHC which has postponed indefinitely the implementation of what you suggest.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 2, "closed_date": 1532964411, "accepted_answer_id": 31552223, "answer_count": 1, "score": 16, "last_activity_date": 1437558291, "creation_date": 1437526080, "last_edit_date": 1437534065, "question_id": 31552064, "link": "https://stackoverflow.com/questions/31552064/why-isnt-join-part-of-the-monad-class", "closed_reason": "Duplicate", "title": "Why isn&#39;t `join` part of the `Monad` class", "body": "<p>It is a well known fact that <code>(&gt;&gt;=)</code> can be implemented using <code>fmap</code> and <code>join</code> while <code>join</code> can be implemented using <code>&gt;&gt;=</code>. Is there any reason we don't define the <code>Monad</code> class with <code>join</code> included and using the following default definitions?</p>\n\n<pre><code>join x  = x &gt;&gt;= id\nx &gt;&gt;= f = join $ f &lt;$&gt; x\n</code></pre>\n\n<p>This would allow a minimal definition to include either just <code>(&gt;&gt;=)</code> or <code>join</code>, instead of forcing <code>(&gt;&gt;=)</code>. Might be a bit helpful considering category theory tends to favour <code>join</code>.</p>\n\n<p>The usual argument against modifying classes is that we break backwards compatibility. However, in this case, that wouldn't happen - we only add the possibility of defining <code>Monad</code> using <code>join</code>.</p>\n"}, {"tags": ["haskell", "yesod", "applicative", "yesod-forms"], "answers": [{"comments": [{"owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "edited": false, "score": 0, "creation_date": 1437571893, "post_id": 31564569, "comment_id": 51084702, "body": "Cool. Thanks. It is somehow possible to use a record syntax with an applicative style? <code>AutomationRequestCollection { arcItemAbc = ... , arcItemDef = ...}</code>"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1437571667, "creation_date": 1437571667, "answer_id": 31564569, "question_id": 31551274, "link": "https://stackoverflow.com/questions/31551274/nested-form-result-in-haskell/31564569#31564569", "title": "Nested form result in Haskell", "body": "<p>I'm not sure about (b), but (a) should be straightforward Applicative composition, e.g.:</p>\n\n<pre><code>Foo &lt;$&gt; (Bar &lt;$&gt; baz &lt;*&gt; bin) &lt;*&gt; qux\n</code></pre>\n\n<p>It can also be easier to see if you break this into multiple functions:</p>\n\n<pre><code>bar = Bar &lt;$&gt; baz &lt;*&gt; bin\nfoo = Foo &lt;$&gt; bar &lt;*&gt; qux\n</code></pre>\n"}], "owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 31564569, "answer_count": 1, "score": 2, "last_activity_date": 1437571667, "creation_date": 1437520682, "question_id": 31551274, "link": "https://stackoverflow.com/questions/31551274/nested-form-result-in-haskell", "title": "Nested form result in Haskell", "body": "<p>I have the following handler/template combination:</p>\n\n<p><strong>handler/automation.hs</strong></p>\n\n<pre><code>data AutomationRequest = AutomationRequest {\n    arEnabled :: Bool\n  , arTemplate :: Text\n  , arSchedules :: Textarea\n}\n\ngetAutomationR :: Handler Html\ngetAutomationR = do\n    (formWidget, formEnctype) &lt;- generateFormPost form\n    defaultLayout $(widgetFile \"automation\")\n\nform :: Form AutomationRequest\nform extra = do\n    (enabledRes, enabledView) &lt;- mreq checkBoxField \"\" Nothing\n    (templateRes, templateView) &lt;- mreq textField (withPlaceholder \"...\" $ bfs (\"\"::Text)) Nothing\n    (schedulesRes, schedulesView) &lt;- mreq textareaField (withPlaceholder \"...\" $ bfs (\"\"::Text)) Nothing\n    (_, submitView) &lt;- mbootstrapSubmit $ BootstrapSubmit (\"Save\"::Text) (\"btn-primary\"::Text) []\n    let requestRes = AutomationRequest &lt;$&gt; enabledRes &lt;*&gt; templateRes &lt;*&gt; schedulesRes\n        widget = $(widgetFile \"automation-form\")\n    return (requestRes, widget)\n</code></pre>\n\n<p><strong>templates/automation.hamlet</strong></p>\n\n<pre><code>&lt;form method=post role=form action=@{AutomationR} enctype=#{formEnctype}&gt;\n    ^{formWidget}\n</code></pre>\n\n<p><strong>templates/automation-form.hamlet</strong></p>\n\n<pre><code>#{extra}\n\n&lt;div .panel .panel-default&gt;\n    &lt;div .panel-heading&gt;^{fvInput enabledView} ...\n    &lt;div .panel-body&gt;\n        ^{fvInput templateView}\n        ^{fvInput schedulesView}\n\n^{fvInput submitView}\n</code></pre>\n\n<p>This works as expected, but I want additional functionality:</p>\n\n<p>a) I want to be able to nest data structures like:</p>\n\n<pre><code>data AutomationRequestCollection = AutomationRequestCollection {\n    arcItemAbc :: AutomationRequest\n  , arcItemDef :: AutomationRequest\n  ... -- 10 Items\n</code></pre>\n\n<p>}</p>\n\n<pre><code>data AutomationRequest = AutomationRequest {\n    arEnabled :: Bool\n  , arTemplate :: Text\n  , arSchedules :: Textarea\n}\n</code></pre>\n\n<p>I don't know how to apply the nesting to <code>let requestRes = AutomationRequest &lt;$&gt; enabledRes &lt;*&gt; templateRes &lt;*&gt; schedulesRes</code></p>\n\n<p>b) Reuse the HTML panel for itemAbc, itemDef, ...:</p>\n\n<pre><code>-- loop somehow\n&lt;div .panel .panel-default&gt;\n    &lt;div .panel-heading&gt;^{fvInput enabledView} ...\n    &lt;div .panel-body&gt;\n        ^{fvInput templateView}\n        ^{fvInput schedulesView}\n</code></pre>\n\n<p>Any ideas that could push me into the right direction?</p>\n"}, {"tags": ["haskell", "static-linking", "binary-compatibility"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1437532628, "post_id": 31549085, "comment_id": 51063800, "body": "It should be, see e.g. <a href=\"http://stackoverflow.com/a/10549484/477476\">stackoverflow.com/a/10549484/477476</a> and <a href=\"http://stackoverflow.com/a/5953787/477476\">stackoverflow.com/a/5953787/477476</a>"}, {"owner": {"reputation": 2002, "user_id": 1207863, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/VxRRc.png?s=128&g=1", "display_name": "Nate Symer", "link": "https://stackoverflow.com/users/1207863/nate-symer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1437594196, "post_id": 31549085, "comment_id": 51099920, "body": "Wow, the binary that results from <code>ghc -02 test.hs -optl-static -optl-pthread</code> is about 2.5GB (test.hs contains <code>main = print &quot;yes&quot;</code>)."}, {"owner": {"reputation": 2002, "user_id": 1207863, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/VxRRc.png?s=128&g=1", "display_name": "Nate Symer", "link": "https://stackoverflow.com/users/1207863/nate-symer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1438124008, "post_id": 31549085, "comment_id": 51318654, "body": "actually 2.5MB. Someone can&#39;t read <code>ls</code> output haha"}], "answers": [{"tags": [], "owner": {"reputation": 4377, "user_id": 363777, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1EIja.jpg?s=128&g=1", "display_name": "Tobi Nary", "link": "https://stackoverflow.com/users/363777/tobi-nary"}, "is_accepted": false, "score": 1, "last_activity_date": 1448466951, "creation_date": 1448466951, "answer_id": 33920958, "question_id": 31549085, "link": "https://stackoverflow.com/questions/31549085/haskell-binary-compatibility/33920958#33920958", "title": "Haskell binary compatibility", "body": "<p>Yes, because of the static linking - it is all in the binary. And yes, they can get quite big, for example a yesod output can easily alot to 70MB. Yet, it has a HTTP server within that 70 MB.</p>\n\n<p>So, static linking can thus help portability, but has it's drawbacks in terms of executable file size.</p>\n"}], "owner": {"reputation": 2002, "user_id": 1207863, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/VxRRc.png?s=128&g=1", "display_name": "Nate Symer", "link": "https://stackoverflow.com/users/1207863/nate-symer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 2, "answer_count": 1, "score": 11, "last_activity_date": 1448466951, "creation_date": 1437510856, "question_id": 31549085, "link": "https://stackoverflow.com/questions/31549085/haskell-binary-compatibility", "title": "Haskell binary compatibility", "body": "<p>Let's say I write some Haskell code and compile it in an Ubuntu 64-bit installation, statically linking all Haskell packages and c libraries. Would the result be binary compatible with any other 64-bit linux distribution?</p>\n"}, {"tags": ["python", "haskell", "type-declaration"], "comments": [{"owner": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 0, "creation_date": 1437510818, "post_id": 31549024, "comment_id": 51056661, "body": "Not exactly.  I believe Haskell will check your type declarations against your code.  Python is dynamically typed and does not do this."}, {"owner": {"reputation": 489, "user_id": 5081047, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/99300c8c43d47c91299eb7b774910843?s=128&d=identicon&r=PG&f=1", "display_name": "Byte", "link": "https://stackoverflow.com/users/5081047/byte"}, "reply_to_user": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 0, "creation_date": 1437511014, "post_id": 31549024, "comment_id": 51056776, "body": "I see. So despite determining type at compile time (without having to state the type like in java/C++), explicitly using type-declaration removes chances of compile errors? I&#39;m quite new to haskell."}, {"owner": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 1, "creation_date": 1437511109, "post_id": 31549024, "comment_id": 51056821, "body": "It&#39;s my understanding that Haskell code can get quite abstruse, and sometimes the compiler will not be able to infer the function&#39;s type.  Even if it can, it is helpful to human readers, who may be less adept at the kind of abstract reasoning required for type inference.  In this case, it is a form of documentation, but the compiler enforces correctness, unlike (say) comments, which can and do lie."}, {"owner": {"reputation": 489, "user_id": 5081047, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/99300c8c43d47c91299eb7b774910843?s=128&d=identicon&r=PG&f=1", "display_name": "Byte", "link": "https://stackoverflow.com/users/5081047/byte"}, "reply_to_user": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 0, "creation_date": 1437511294, "post_id": 31549024, "comment_id": 51056946, "body": "Thanks. That cleared some of it up. Will it change how the function operates as well? And hopefully someone will give an answer to that with some example code. :) EDIT: Nevermind, I just re-read the tutorial and it seems that it doesn&#39;t actually affect the function in the sense I had worried it might. Thank you for your explanation. @Kevin"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 2, "creation_date": 1437543611, "post_id": 31549024, "comment_id": 51066803, "body": "@Kevin It doesn&#39;t have to get abstruse. Consider the data type <code>data NestedList a = Epsilon | Nested a (NestedList [a])</code> that represents nested lists. The <code>length</code> function is easily definable: <code>length Epsilon = 0; length (Nested _ xs) = 1 + length xs</code>. However GHC is unable to infer the correct type (it will yield an error). The problem is that the function contains <i>polymorphic recursion</i>, i.e. we are using <code>length</code> over the type <code>NestedList [a]</code> while defining it for the type <code>NestedList a</code> and so <code>a</code> and <code>[a]</code> don&#39;t match. Providing the type signature makes the code compilable."}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 5081047, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/99300c8c43d47c91299eb7b774910843?s=128&d=identicon&r=PG&f=1", "display_name": "Byte", "link": "https://stackoverflow.com/users/5081047/byte"}, "edited": false, "score": 0, "creation_date": 1437511841, "post_id": 31549305, "comment_id": 51057234, "body": "Thanks. If the type declaration is different than what the compiler type-inferred, will it give me an error or just continue compilation?"}, {"owner": {"reputation": 1333, "user_id": 550367, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/df9b83d4d489a2f46de18ba42af095f3?s=128&d=identicon&r=PG", "display_name": "Matt Habel", "link": "https://stackoverflow.com/users/550367/matt-habel"}, "reply_to_user": {"reputation": 489, "user_id": 5081047, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/99300c8c43d47c91299eb7b774910843?s=128&d=identicon&r=PG&f=1", "display_name": "Byte", "link": "https://stackoverflow.com/users/5081047/byte"}, "edited": false, "score": 0, "creation_date": 1437512384, "post_id": 31549305, "comment_id": 51057538, "body": "It will error out. The type inference algorithm is always correct based on the source you give it and will complain if the given type is different from the inferred type. But like I said sometimes you mean something different and just entered in the wrong code."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1437518879, "post_id": 31549305, "comment_id": 51060307, "body": "You can make a correct type definition that is different from what the compiler infers. There&#39;s an example in duplode&#39;s answer. Also, it looks like you&#39;re using ML-style syntax as opposed to Haskell syntax. The first type should be <code>Int -&gt; Int -&gt; Int</code> and the second one should be <code>(Int, Int) -&gt; Int</code>."}], "tags": [], "owner": {"reputation": 1333, "user_id": 550367, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/df9b83d4d489a2f46de18ba42af095f3?s=128&d=identicon&r=PG", "display_name": "Matt Habel", "link": "https://stackoverflow.com/users/550367/matt-habel"}, "is_accepted": false, "score": 2, "last_activity_date": 1437567412, "last_edit_date": 1437567412, "creation_date": 1437511597, "answer_id": 31549305, "question_id": 31549024, "link": "https://stackoverflow.com/questions/31549024/are-haskell-type-declarations-used-the-same-way-as-python-class-function-documen/31549305#31549305", "title": "Are haskell type declarations used the same way as python class/function documentation?", "body": "<p>Type declarations are tools for you as the programmer to sanity check your code. The type inference Haskell does will always be correct - but it might not be what you expected when you wrote that code. You may have expected a function with type Int -> Int -> Int, but instead your code may tell the inference algorithm that the function is type (Int, Int) -> Int because you forgot a parentheses somewhere. </p>\n\n<p>They also act as a form of documentation for the programmer. Sometimes it's very helpful to see a function's type while writing your code. Often (if functions are well named), you can figure out what a function is supposed to do just from looking at its name and its type. Documentation is still very useful, but as you start writing and reading more functional programs, types become something you use to help you understand code.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 8, "last_activity_date": 1437569193, "last_edit_date": 1437569193, "creation_date": 1437513189, "answer_id": 31549711, "question_id": 31549024, "link": "https://stackoverflow.com/questions/31549024/are-haskell-type-declarations-used-the-same-way-as-python-class-function-documen/31549711#31549711", "title": "Are haskell type declarations used the same way as python class/function documentation?", "body": "<p>Signatures aren't just for documentation (even though they are very useful for that as well).  They are enforced by the compiler, which means that by adding signatures you can make the types of your functions more restrictive than they would be otherwise. Toy example:\n</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>add x y = x + y\n\naddInt :: Int -&gt; Int -&gt; Int\naddInt x y = x + y\n</code></pre>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; :t add\nadd :: Num a =&gt; a -&gt; a -&gt; a\n*Main&gt; add 2 3\n5\n*Main&gt; add 2.1 3.1\n5.2\n*Main&gt; :t addInt\naddInt :: Int -&gt; Int -&gt; Int\n*Main&gt; addInt 2 3\n5\n*Main&gt; addInt 2.1 3.1 -- addInt will not accept non-Ints.\n\n&lt;interactive&gt;:23:8:\n    No instance for (Fractional Int) arising from the literal \u20182.1\u2019\n    In the first argument of \u2018addInt\u2019, namely \u20182.1\u2019\n    In the expression: addInt 2.1 3.1\n    In an equation for \u2018it\u2019: it = addInt 2.1 3.1\n</code></pre>\n\n<p>Besides that, adding type signatures means you will get better (i.e. easier to understand) errors in tricky situations, as the compiler will know what you want to achieve rather than having to guess everything on its own.</p>\n\n<p>There are also situations in which the compiler can't decide the types without the help of some signatures or other type annotations. Perhaps the simplest example is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readAndShow s = show (read s)\n</code></pre>\n\n<p>If you try to use that without specifying any types...</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Foo.hs:6:17:\n    No instance for (Show a0) arising from a use of \u2018show\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance (GHC.Arr.Ix a, Show a, Show b) =&gt; Show (GHC.Arr.Array a b)\n        -- Defined in \u2018GHC.Arr\u2019\n      instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n      instance (Integral a, Show a) =&gt; Show (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      ...plus 26 others\n    In the expression: show (read s)\n    In an equation for \u2018readAndShow\u2019: readAndShow s = show (read s)\n\nFoo.hs:6:23:\n    No instance for (Read a0) arising from a use of \u2018read\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance (GHC.Arr.Ix a, Read a, Read b) =&gt; Read (GHC.Arr.Array a b)\n        -- Defined in \u2018GHC.Read\u2019\n      instance Read a =&gt; Read (Maybe a) -- Defined in \u2018GHC.Read\u2019\n      instance (Integral a, Read a) =&gt; Read (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Read\u2019\n      ...plus 25 others\n    In the first argument of \u2018show\u2019, namely \u2018(read s)\u2019\n    In the expression: show (read s)\n    In an equation for \u2018readAndShow\u2019: readAndShow s = show (read s)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>... it won't work. <code>read</code> converts a <code>String</code> to <em>some</em> type, and <code>show</code> does the opposite. However, if nothing specifies the type of <code>read s</code>, the compiler can't tell which type you want to read the <code>String</code> as. So you either need to specify the intermediate type...</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readAndShowAsInt s = show (read s :: Int)\n</code></pre>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; readAndShowAsInt \"2\"\n\"2\"\n</code></pre>\n\n<p>... Or have something else pick the type for you:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readAndAdd :: String -&gt; Int -&gt; Int\nreadAndAdd s y = read s + y\n</code></pre>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>*Main&gt; readAndAdd \"2\" 3\n5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1437513923, "last_edit_date": 1437513923, "creation_date": 1437513248, "answer_id": 31549724, "question_id": 31549024, "link": "https://stackoverflow.com/questions/31549024/are-haskell-type-declarations-used-the-same-way-as-python-class-function-documen/31549724#31549724", "title": "Are haskell type declarations used the same way as python class/function documentation?", "body": "<p>In simple cases, the type declaration is just the same type that Haskell would infer, and is just documentation + help against confusing errors. However there are exceptions:</p>\n\n<p>(1) You can give a <em>more restricted</em> type declaration than the inferred one.  E.g.</p>\n\n<pre><code>squareInt :: Int -&gt; Int\nsquareInt x = x*x\n</code></pre>\n\n<p>Without the declaration, that would be inferred as <code>Num t =&gt; t -&gt; t</code> instead.\nBut with it, that function can only be used for <code>Int</code>s, not for any numerical type.  This is sometimes useful for limiting functions to an intended use case, or for preventing type ambiguity errors.</p>\n\n<p>(2) Many language extensions <em>require</em> a type declaration because they go beyond the part of the type system that the inference algorithm supports.  For example, rank n types:</p>\n\n<pre><code>f :: (forall x. Show x =&gt; y) -&gt; (Int, Bool) -&gt; (y, y)\nf g (i, b) = (g i, g b)\n</code></pre>\n\n<p>This includes also the Standard Haskell feature \"polymorphic recursion\", which means calling a function recursively with a <em>different</em> type than it was originally called with.</p>\n"}], "owner": {"reputation": 489, "user_id": 5081047, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/99300c8c43d47c91299eb7b774910843?s=128&d=identicon&r=PG&f=1", "display_name": "Byte", "link": "https://stackoverflow.com/users/5081047/byte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 31549711, "answer_count": 3, "score": 4, "last_activity_date": 1437569193, "creation_date": 1437510651, "question_id": 31549024, "link": "https://stackoverflow.com/questions/31549024/are-haskell-type-declarations-used-the-same-way-as-python-class-function-documen", "title": "Are haskell type declarations used the same way as python class/function documentation?", "body": "<p>I am using the \"Learn you a haskell tutorial\" and have reached the type declarations section. I understand that they change the way GHCI gives you an error message, but do they also affect the way the actual function works? If not, is it essentially like a python function documentation written with \"\"\" \"\"\" underneath \"def someFunction(x): \"? - just an example</p>\n\n<p>Example code:</p>\n\n<pre><code>removeNonUppercase :: [Char] -&gt; [Char]  \nremoveNonUppercase st = [ c | c &lt;- st, c `elem` ['A'..'Z']]\n</code></pre>\n\n<p>EDIT: I ask this because the tutorial explains that haskell is type-inferred at compile time.</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1437512420, "post_id": 31548436, "comment_id": 51057557, "body": "Related: <a href=\"http://stackoverflow.com/questions/31220903/haskell-how-to-create-most-generic-function-possible-that-applies-a-function-to\">How to create most generic function possible that applies a function to tuple items</a>"}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1437513427, "post_id": 31548436, "comment_id": 51058064, "body": "That&#39;s another of my questions. It involves a tuple but isn&#39;t really related \u263a"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1437543641, "post_id": 31548436, "comment_id": 51066808, "body": "Proposal: instead of <code>(a, (b, c))</code>, use <code>(a, (b, (c, ())))</code>. Then it is easy to write the instance <code>ApplyFnToTuple ()</code> which takes no arguments and returns output, and there is no danger of overlap."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437559505, "post_id": 31548436, "comment_id": 51075987, "body": "@DanielWagner That&#39;s a good idea. I originally avoided it but it is by far the easiest approach!"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1437515953, "creation_date": 1437515953, "answer_id": 31550354, "question_id": 31548436, "link": "https://stackoverflow.com/questions/31548436/haskell-function-to-apply-some-function-to-nested-2-tuples/31550354#31550354", "title": "Haskell: Function to apply some function to nested 2-tuples", "body": "<p>The problem is that <em>within</em> the definition of the <code>instance ApplyFnToTuple a</code>, there is no access to the information that <code>a</code> isn't a tuple - I guess GHC doesn't consider how the instance might be chosen in deciding whether it is correct as a definition.  This means it cannot know that <code>TupleFn</code> gives the right result to use, and so the instance doesn't typecheck.</p>\n\n<p>To fix this, you can add an equational constraint to <em>tell</em> it that <code>TupleFn</code> is correct.  Unfortunately since the constraint has to mention the <code>out</code> type, this requires including it as an extra type parameter to the class.  At least, the following seems to work (tested with GHC 7.8 only):</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances,\n             MultiParamTypeClasses,\n             OverlappingInstances #-}\n\ntype family TupleFn ty out where\n    TupleFn (a,b) output = a -&gt; (TupleFn b output)\n    TupleFn b output = b -&gt; output\n\nclass ApplyFnToTuple a out where\n    applyFnToTuple :: a -&gt; TupleFn a out -&gt; out\n\ninstance ApplyFnToTuple b out =&gt; ApplyFnToTuple (a,b) out where\n    applyFnToTuple (a,b) fn = applyFnToTuple b (fn a)\n\ninstance TupleFn a out ~ (a -&gt; out) =&gt; ApplyFnToTuple a out where\n    applyFnToTuple b fn = fn b \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1437566960, "last_edit_date": 1437566960, "creation_date": 1437525935, "answer_id": 31552040, "question_id": 31548436, "link": "https://stackoverflow.com/questions/31548436/haskell-function-to-apply-some-function-to-nested-2-tuples/31552040#31552040", "title": "Haskell: Function to apply some function to nested 2-tuples", "body": "<p>As usual you can do this with singletons and type families:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeFamilies, TypeOperators #-}\n\ntype family Tuple b as where\n    Tuple b '[]       = b\n    Tuple b (a ': as) = (b, Tuple a as)\n\ntype family Function as b where\n    Function '[]       b = b\n    Function (a ': as) b = a -&gt; Function as b\n\ndata SingList as where\n    SNil  :: SingList '[]\n    SCons :: SingList as -&gt; SingList (a ': as)\n\napplyToTuple :: SingList as -&gt; Tuple a as -&gt; Function (a ': as) b -&gt; b\napplyToTuple  SNil       x      f = f x\napplyToTuple (SCons as) (x, xs) f = applyToTuple as xs (f x)\n\nmain = do\n    print $ applyToTuple (SCons (SCons SNil)) ('o',('t','w')) $ \\a b c -&gt; [a,b,c] == \"otw\"\n    print $ applyToTuple (SCons SNil)         ('h','i') $ \\a b -&gt; [a,b] == \"hi\"\n    print $ applyToTuple (SCons (SCons SNil)) (\"hello\",('y','o')) $ \\a b c -&gt; a ++ [b,c]\n</code></pre>\n\n<p><code>Tuple a [b, c, d]</code> reduces to <code>(a, (b, (c, d)))</code>.</p>\n\n<p><code>Function [a, b, c, d] r</code> reduces to <code>a -&gt; b -&gt; c -&gt; d -&gt; r</code>.</p>\n\n<p>Hence if <code>as == [b, c, d]</code>, then</p>\n\n<pre><code>Tuple a as -&gt; Function (a ': as) r -&gt; r\n</code></pre>\n\n<p>reduces to</p>\n\n<pre><code>(a, (b, (c, d))) -&gt; (a -&gt; b -&gt; c -&gt; d -&gt; r) -&gt; r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1437610444, "post_id": 31574250, "comment_id": 51106843, "body": "I think you can simplify the instances by using plain <code>()</code> instead of <code>(a,())</code>."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1437679961, "post_id": 31574250, "comment_id": 51144710, "body": "@&#216;rjanJohansen Thanks; I made the relevant updates. I thought I tried that earlier to no avail but all seemed fine this time :)"}], "tags": [], "owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "is_accepted": false, "score": 2, "last_activity_date": 1437679926, "last_edit_date": 1592644375, "creation_date": 1437600266, "answer_id": 31574250, "question_id": 31548436, "link": "https://stackoverflow.com/questions/31548436/haskell-function-to-apply-some-function-to-nested-2-tuples/31574250#31574250", "title": "Haskell: Function to apply some function to nested 2-tuples", "body": "<h1>My eventual solution, for anyone finding this question:</h1>\n<p>As DanielWagner suggested, I ended up preferring the slightly tweaked formatting (using () at the end of a tuple chain to signify finish). This makes it pretty straightforward like so:</p>\n<pre><code>type family TupleFn ty out where\n    TupleFn () output = output\n    TupleFn (a,b) output = a -&gt; (TupleFn b output)\n\nclass ApplyFnToTuple a where\n    applyFnToTuple :: a -&gt; TupleFn a out -&gt; out\n\ninstance ApplyFnToTuple b =&gt; ApplyFnToTuple (a,b) where\n    applyFnToTuple (a,b) fn = applyFnToTuple b (fn a)\n\ninstance ApplyFnToTuple () where\n    applyFnToTuple _ fn = fn\n</code></pre>\n<p>and this can be used like:</p>\n<pre><code>applyFnToTuple ('a',('b',())) $ \\a b -&gt; [a,b] == &quot;ab&quot;\napplyFnToTuple (&quot;hello&quot;,(12,('r',()))) $ \\h n r -&gt; h ++ show n ++ [r] == &quot;hello12r&quot;\n</code></pre>\n<p>I expect the instances can be tweaked; these were just the first I tried that GHC liked :)</p>\n<p>\u00d8rjan Johansen's approach (see his answer) is a wee bit more complicated but delivers an even neater end case!</p>\n<p>As a side note, where I have wanted to translate some structure into a corresponding function I've actually ended up just using my own data type for the extra power it gives me. The simplest form of that I can come up with (not using DataKinds for now) to use as an example is:</p>\n<pre><code>--using DataKinds these could be done slightly neater:\ndata Cons a b\ndata Nil\n\n-- the list itself, where the type 'a' is built from the above tags\ndata MyList a where\n    LCons :: itemty -&gt; MyList a -&gt; MyList (Cons itemty a)\n    LNil  :: MyList Nil\n\n-- this type family converts that type 'a' to a function signature.\ntype family MyListFn a output where\n    MyListFn (Cons a b) output = a -&gt; (MyListFn b output) \n    MyListFn Nil output = output\n\n-- this function applies items in MyList a to a MyListFn a just\n-- like we did with tuples. Note no type family, because\n-- no type dependant differences in behaviour needed:\napplyFnToMyList :: MyList a -&gt; MyListFn a out -&gt; out\napplyFnToMyList (LCons a b) fn = applyFnToMyList b (fn a)\napplyFnToMyList LNil fn = fn\n</code></pre>\n<p>with very similar usage as the tuple case:</p>\n<pre><code>applyFnToMyList (LCons 'a' (LCons 'b' LNil)) $ \\a b -&gt; [a,b] == &quot;ab&quot;\napplyFnToMyList (LCons &quot;hello&quot; (LCons 12 (LCons 'r' LNil))) $ \\h n r -&gt; h ++ show n ++ [r] == &quot;hello12r&quot;\n</code></pre>\n<p><strong>TL;DR</strong> You can create functions that apply a function of whatever parity required over some elements of a polymorphic data structure in a totally type safe way. Awesome stuff, Haskell!</p>\n"}], "owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 1, "accepted_answer_id": 31550354, "answer_count": 3, "score": 4, "last_activity_date": 1437679926, "creation_date": 1437508476, "question_id": 31548436, "link": "https://stackoverflow.com/questions/31548436/haskell-function-to-apply-some-function-to-nested-2-tuples", "title": "Haskell: Function to apply some function to nested 2-tuples", "body": "<p>Say I have a tuple like <code>('a',(1,(\"Hello\",False))</code>. Just for fun (read: learning), I'd like to create a function that applies some function of the correct form to any such tuple and returns the result. Example usage:</p>\n\n<pre><code>applyFnToTuple ('o',('t','w')) $ \\a b c -&gt; [a,b,c] == \"otw\"\napplyFnToTuple ('h','i') $ \\a b -&gt; [a,b] == \"hi\"\napplyFnToTuple (\"hello\",('y','o')) $ \\a b c -&gt; a ++ [b,c]\n</code></pre>\n\n<p>I've done most of it as follows:</p>\n\n<pre><code>type family TupleFn ty out where\n    TupleFn (a,b) output = a -&gt; (TupleFn b output)\n    TupleFn b output = b -&gt; output\n\nclass ApplyFnToTuple a where\n    applyFnToTuple :: a -&gt; TupleFn a out -&gt; out\n\ninstance ApplyFnToTuple b =&gt; ApplyFnToTuple (a,b) where\n    applyFnToTuple (a,b) fn = applyFnToTuple b (fn a)\n\ninstance ApplyFnToTuple a where\n    applyFnToTuple b fn = fn b \n</code></pre>\n\n<p>The sticking point is that last instance. I fully expect to need to add <code>{-# OVERLAPPABLE #-}</code> since <code>a</code> is more general than the <code>(a,b)</code>. I also struggle to see exactly how GHC could resolve <code>a</code> and the correct version of my <code>TupleFn</code> class and know the correct type sig, but I can easily put that down to my own lack of understanding. But in any case, the actual error GHCI gives me is:</p>\n\n<pre><code>Couldn't match expected type \u2018a -&gt; out\u2019\n                with actual type \u2018TupleFn a out\u2019\n    Relevant bindings include\n      fn :: TupleFn a out (bound at examples.hs:574:22)\n      b :: a (bound at examples.hs:574:20)\n      applyFnToTuple :: a -&gt; TupleFn a out -&gt; out\n        (bound at examples.hs:574:5)\n    The function \u2018fn\u2019 is applied to one argument,\n    but its type \u2018TupleFn a out\u2019 has none\n    In the expression: fn b\n    In an equation for \u2018applyFnToTuple\u2019: applyFnToTuple b fn = fn b\nFailed, modules loaded: none.\n</code></pre>\n\n<p>As far as I can see, no version of my TupleFn returns something with no arguments, so I don't really understand the error. However, I find it can be made to compile simply by changing the last instance to something more concrete eg:</p>\n\n<pre><code>instance ApplyFnToTuple Char where\n    applyFnToTuple b fn = fn b\n</code></pre>\n\n<p>But that means I'd have to define lots of similar instances etc which is undesirable.</p>\n\n<p>What I'd like to know is, is there a relatively easy way to make the more general version work, and why this particular error?</p>\n\n<p>Thankyou :)</p>\n\n<p>PS: I'm running GHC 7.10.1 </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "edited": false, "score": 0, "creation_date": 1437504352, "post_id": 31547125, "comment_id": 51053201, "body": "Thanks, that looks promising. Somewhat dumber followup, it&#39;s noted that it&#39;s unportable and experimental, is that just out of date or overly conservative or is there a more canonical library?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "edited": false, "score": 1, "creation_date": 1437542436, "post_id": 31547125, "comment_id": 51066378, "body": "@BWStearns I think the &quot;portability&quot; and &quot;stability&quot; fields are ones that frequently get set when the package is created, and then people tend to forget they&#39;re there and never update them. The <code>split</code> package is fairly weathered now; and there is definitely nothing more canonical."}], "tags": [], "owner": {"reputation": 681, "user_id": 1072349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/df7cee6d1e4d0768b5da914783c815ad?s=128&d=identicon&r=PG", "display_name": "ajerneck", "link": "https://stackoverflow.com/users/1072349/ajerneck"}, "is_accepted": true, "score": 5, "last_activity_date": 1437504481, "last_edit_date": 1437504481, "creation_date": 1437504105, "answer_id": 31547125, "question_id": 31547011, "link": "https://stackoverflow.com/questions/31547011/split-a-string-while-keeping-delimiters-haskell/31547125#31547125", "title": "Split a string while keeping delimiters Haskell", "body": "<p>You can split a list, keeping delimiters using the <code>keepDelimsL</code> and <code>keepDelimsR</code> functions in the <code>Data.List.Split</code> package, like <a href=\"https://hackage.haskell.org/package/split-0.2.2/docs/Data-List-Split.html\">here</a>:</p>\n\n<pre><code>split (keepDelimsL $ oneOf \"xyz\") \"aazbxyzcxd\" == [\"aa\",\"zb\",\"x\",\"y\",\"zc\",\"xd\"]\n</code></pre>\n"}], "owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 2, "accepted_answer_id": 31547125, "answer_count": 1, "score": 4, "last_activity_date": 1563081245, "creation_date": 1437503694, "last_edit_date": 1563081245, "question_id": 31547011, "link": "https://stackoverflow.com/questions/31547011/split-a-string-while-keeping-delimiters-haskell", "title": "Split a string while keeping delimiters Haskell", "body": "<p>Basically I'm trying to split a <code>String</code> into <code>[[String]]</code> and then concat the results back but keeping the delimiters in the resultant list (even repeating in a row).</p>\n\n<p>Something like the below kind of works, but the delimiter gets crunched into one space instead of retaining all three spaces</p>\n\n<pre><code>unwords . map (\\x -&gt; \"|\" ++ x ++\"|\") . words $ \"foo   bar\"\n-- \"|foo| |bar|\"\n</code></pre>\n\n<p>Ideally I could get something like: </p>\n\n<pre><code>\"|foo||   ||bar|\" -- or\n\"|foo|   |bar|\"\n</code></pre>\n\n<p>I just can't figure out how to preserve the delimiter, all the split functions I've seen have dropped the delimiters from the resulting lists, I can write one myself but it seems like something that would be in a standardish library and at this point I'm looking to learn more than the basics which includes getting familiar with more colloquial ways of doing things.</p>\n\n<p>I think I'm looking for some function like:</p>\n\n<pre><code>splitWithDelim :: Char -&gt; String -&gt; [String]\nsplitWithDelim \"foo   bar\" -- [\"foo\", \" \", \" \", \" \", \"bar\"]\n</code></pre>\n\n<p>or maybe it's best to use regexes here?</p>\n"}, {"tags": ["haskell", "uu-parsinglib"], "answers": [{"comments": [{"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "edited": false, "score": 0, "creation_date": 1437496978, "post_id": 31544445, "comment_id": 51048862, "body": "Thank you, those types make much more sense now!"}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 1, "last_activity_date": 1437495472, "creation_date": 1437495472, "answer_id": 31544445, "question_id": 31541363, "link": "https://stackoverflow.com/questions/31541363/using-uu-parsinglib-to-parse-a-sequence-of-word8s/31544445#31544445", "title": "Using uu-parsinglib to parse a sequence of Word8s", "body": "<p>pSatisfy has type:</p>\n\n<pre><code>pSatisfy :: forall loc state a. (Show a, loc `IsLocationUpdatedBy` a, ListLike state a) =&gt; (a -&gt; Bool) -&gt; Insertion a -&gt; P (Str a state loc) a\n</code></pre>\n\n<p>So the Parser returns the same type as the input (<code>a</code>). Since Parser is </p>\n\n<pre><code>type Parser a = (IsLocationUpdatedBy loc Char, ListLike state Char) =&gt; P (Str Char state loc) a\n</code></pre>\n\n<p>The input to Parser is a ListLike of Char, and hence pSatisfy can only return a Parser Char. So the types do forbid what you're trying to do.</p>\n\n<p>Maybe you should type your function as something like</p>\n\n<pre><code>pRawWord8 :: (IsLocationUpdatedBy loc Word8, ListLike state Word8) =&gt; P (Str Word8 state loc) Word8\n</code></pre>\n\n<p>Or define your own type synonym along these lines.</p>\n"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "accepted_answer_id": 31544445, "answer_count": 1, "score": 0, "last_activity_date": 1437495472, "creation_date": 1437487454, "question_id": 31541363, "link": "https://stackoverflow.com/questions/31541363/using-uu-parsinglib-to-parse-a-sequence-of-word8s", "title": "Using uu-parsinglib to parse a sequence of Word8s", "body": "<p>I'm trying to use uu-parsinglib to operate on <code>[Word8]</code> rather than [Char].\n(I want to use uu-parsinglib for the error reporting.)\nI need a parser that will fetch me the next <code>Word8</code> in the sequence, whatever it is.\nOnce I have that, I can build more complex parsers.\nBut I'm having trouble figuring out how to write it.\nThe closest I've been able to get is:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nmodule Main where\n\nimport Control.Applicative ((&lt;|&gt;))\nimport Data.Word\nimport Text.ParserCombinators.UU.BasicInstances\n\npRawWord8 :: Parser Word8\npRawWord8 = pSatisfy (const True) (Insertion undefined undefined undefined)\n</code></pre>\n\n<p>However, that implementation apparently returns the wrong type. </p>\n\n<pre><code>amy2.hs:10:13:\n    Couldn't match type \u2018Char\u2019 with \u2018Word8\u2019\n    Expected type: Text.ParserCombinators.UU.Core.P\n                     (Str Char state loc) Word8\n      Actual type: Text.ParserCombinators.UU.Core.P\n                     (Str Char state loc) Char\n    In the expression:\n      pSatisfy (const True) (Insertion undefined undefined undefined)\n    In an equation for \u2018pRawWord8\u2019:\n        pRawWord8\n          = pSatisfy (const True) (Insertion undefined undefined undefined)\n</code></pre>\n\n<p>This surprises me, because I don't see how the type signature for <code>pSatisfy</code> is restricting me to returning a <code>Char</code> instead of a <code>Word8</code>.</p>\n\n<p>How can I implement <code>pRawWord8</code>?</p>\n"}, {"tags": ["haskell", "io", "lazy-evaluation", "bytestring", "writefile"], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 8, "creation_date": 1437492886, "post_id": 31543455, "comment_id": 51046240, "body": "re the first point: The <code>Binary</code> instance for <code>[a]</code> forces the spine of the list with <code>length</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1437495676, "post_id": 31543455, "comment_id": 51048096, "body": "The format of Binary encoded bytestrings is <code>Word64 big endian length || data</code>.  Which explains the strict spine mentioned by jberryman.  One could easily make a serialization of chunks and terminating boolean, making an encoding form like <code>Word16 big endian chunk size || Chunk || False || Chunk || .. || True</code>.  This should be able to run in size O(chunk size). To keep the previous format you&#39;d have to re-write the first field, making your IO slightly more complex."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 10, "last_activity_date": 1437495531, "last_edit_date": 1437495531, "creation_date": 1437492676, "answer_id": 31543455, "question_id": 31541058, "link": "https://stackoverflow.com/questions/31541058/why-does-this-not-run-in-constant-memory/31543455#31543455", "title": "Why does this not run in constant memory?", "body": "<p>Two reasons for the memory usage:</p>\n\n<p><strong>First</strong>, <code>Data.Binary.encode</code> doesn't seem to run in constant space. The following program uses 910 MB memory:</p>\n\n<pre><code>import Data.Binary\nimport qualified Data.ByteString.Lazy as B\n\nlen = 10000000 :: Int \n\nmain = B.writeFile \"grids.bin\" $ encode [0..len]\n</code></pre>\n\n<p>If we leave a <code>0</code> out from <code>len</code> we get 97 MB memory usage.</p>\n\n<p>In contrast, the following program uses 1 MB:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8 as B\n\nmain = B.writeFile \"grids.bin\" $ B.pack $ show [0..(1000000::Int)]\n</code></pre>\n\n<p><strong>Second</strong>, in your program <code>shuffleds</code> contains references to contents of <code>grids</code>, which prevents garbage collection of <code>grids</code>. So when we print <code>grids</code>, we also evaluate it and then it has to sit in memory until we finish printing <code>shuffleds</code>. The following version of your program still consumes lots of memory, but it uses constant space if we comment out one of the two lines with <code>B.writeFile</code>. </p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8 as B\n\nwriteGrids :: Int -&gt; Int -&gt; IO ()\nwriteGrids num aa = do\n    rng &lt;- newPureMT\n    let (grids,shuffleds) = createGrids rng aa\n    B.writeFile \"grids.bin\" (B.pack $ show (take num grids))\n    B.writeFile \"shuffleds.bin\" (B.pack $ show (take num shuffleds))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 7, "last_activity_date": 1437517633, "last_edit_date": 1495540010, "creation_date": 1437510169, "answer_id": 31548894, "question_id": 31541058, "link": "https://stackoverflow.com/questions/31541058/why-does-this-not-run-in-constant-memory/31548894#31548894", "title": "Why does this not run in constant memory?", "body": "<p>For what it's worth, here is a full solution combining the ideas of everyone here. Memory consumption is constant at ~6MB (compiled with <code>-O2</code>).</p>\n\n<pre><code>import Control.Arrow (first)\nimport Control.Monad.State (state, evalState)\nimport Data.Binary\nimport GHC.Float (double2Float)\nimport System.Random (next)\nimport System.Random.Mersenne.Pure64 (PureMT, newPureMT, randomDouble)\nimport System.Random.Shuffle (shuffle')\nimport qualified Data.ByteString as B (hPut)\nimport qualified Pipes.Binary as P (encode)\nimport qualified Pipes.Prelude as P (zip, mapM, drain)\nimport Pipes (runEffect, (&gt;-&gt;))\nimport System.IO (withFile, IOMode(AppendMode))\n\nmain :: IO ()\nmain = writeGrids 1000 64\n\n{- Creates and writes num grids of dimensions aa x aa -}\nwriteGrids :: Int -&gt; Int -&gt; IO ()\nwriteGrids num aa = do\n    rng &lt;- newPureMT\n    let (grids, shuffleds) = createGrids rng aa\n        gridFile = \"grids.bin\"\n        shuffledFile = \"shuffleds.bin\"\n        encoder = P.encode . SerList . take num\n    writeFile gridFile \"\"\n    writeFile shuffledFile \"\"\n    withFile gridFile AppendMode $ \\hGr -&gt;\n        withFile shuffledFile AppendMode $ \\hSh -&gt;\n            runEffect\n                $ P.zip (encoder grids) (encoder shuffleds)\n                &gt;-&gt; P.mapM (\\(ch1, ch2) -&gt; B.hPut hGr ch1 &gt;&gt; B.hPut hSh ch2)\n                &gt;-&gt; P.drain -- discards the stream of () results.\n\n{- a random number generator, dimension of grids to make\n   returns a pair of lists, the first is a list of grids of dimensions\n   aa x aa, the second is a list of the shuffled grids corresponding to the first list -}\ncreateGrids :: PureMT -&gt; Int -&gt; ( [[(Float,Float)]], [[(Float,Float)]] )\ncreateGrids rng aa = unzip gridsAndShuffleds where\n       rs = randomFloats rng\n       grids =  map (getGridR aa) (chunksOf (2 * aa * aa) rs)\n       gridsAndShuffleds = shuffler (aa * aa) rng grids\n\n{- length of each grid, a random number generator, a list of grids\n   returns a the list with each grid shuffled -}\nshuffler :: Int -&gt; PureMT -&gt; [[(Float,Float)]] -&gt; [( [(Float,Float)], [(Float,Float)] )]\nshuffler n rng xss = evalState (traverse oneShuffle xss) rng\n    where\n    oneShuffle xs = state $ \\r -&gt; ((xs, shuffle' xs n r), snd (next r))\n\nnewtype SerList a = SerList { runSerList :: [a] }\n    deriving (Show)\n\ninstance Binary a =&gt; Binary (SerList a) where\n    put (SerList (x:xs)) = put False &gt;&gt; put x &gt;&gt; put (SerList xs)\n    put _                = put True\n    get = do\n        stop &lt;- get :: Get Bool\n        if stop\n            then return (SerList [])\n            else do\n                x          &lt;- get\n                SerList xs &lt;- get\n                return (SerList (x : xs))\n\n{- divides list into chunks of size n -}\nchunksOf :: Int -&gt; [a] -&gt; [[a]]\nchunksOf n = go \n     where go xs = case splitAt n xs of\n              (ys,zs) | null ys -&gt; []\n                      | otherwise -&gt; ys : go zs\n\n{- dimension of grid, list of random floats [0,1]\n   returns a list of (x,y) points of length n^2 such that all\n   points are in the range [0,1] and the points are a randomly \n   perturbed regular grid -}\ngetGridR :: Int -&gt; [Float] -&gt; [(Float,Float)]\ngetGridR n rs = pts where\n   nn = n * n\n   (irs,jrs) = splitAt nn rs\n   n' = fromIntegral n\n   grid = [ (p,q) | p &lt;- [0..n'-1], q &lt;- [0..n'-1] ]\n   pts = zipWith (\\(p,q) (ir,jr) -&gt; ((p+ir)/n',(q+jr)/n')) grid (zip irs jrs)\n\n{- an infinite list of random floats in range [0,1] -}\nrandomFloats :: PureMT -&gt; [Float]\nrandomFloats rng = let (d,rng') = first double2Float (randomDouble rng)\n                   in d : randomFloats rng'\n</code></pre>\n\n<p>Comments on the changes:</p>\n\n<ul>\n<li><p><code>shuffler</code> is now a traversal with the <code>State</code> functor. It produces, in a single pass through the input list, a list of pairs, in which each grid is paired with its shuffled version. <code>createGrids</code> then (lazily) unzips this list.</p></li>\n<li><p>The files are written to using <a href=\"https://hackage.haskell.org/package/pipes-binary-0.4.0.4\" rel=\"nofollow noreferrer\"><code>pipes</code></a> machinery, in a way loosely inspired by <a href=\"https://stackoverflow.com/a/21724930/2751851\">this answer</a> (I originally wrote this using <code>P.foldM</code>). Note that the <code>hPut</code> I used is the strict bytestring one, for it acts on strict chunks supplied by the  producer made with <code>P.zip</code> (which, in spirit, is a pair of lazy bytestrings that supplies chunks in pairs).</p></li>\n<li><p><code>SerList</code> is there to hold the custom <code>Binary</code> instance Thomas M. DuBuisson alludes to. Note that I haven't thought too much about laziness and strictness in the <code>get</code> method of the instance. If that causes you trouble, <a href=\"https://stackoverflow.com/questions/11695373/lazy-decoding-of-a-list-with-data-binary\">this question</a> looks useful.</p></li>\n</ul>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 1, "accepted_answer_id": 31543455, "answer_count": 2, "score": 9, "last_activity_date": 1437517633, "creation_date": 1437486671, "last_edit_date": 1437489166, "question_id": 31541058, "link": "https://stackoverflow.com/questions/31541058/why-does-this-not-run-in-constant-memory", "title": "Why does this not run in constant memory?", "body": "<p>I am trying to write a very large amount of data to a file in constant memory.</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as B\n\n{- Creates and writes num grids of dimensions aa x aa -}\nwriteGrids :: Int -&gt; Int -&gt; IO ()\nwriteGrids num aa = do\n    rng &lt;- newPureMT\n    let (grids,shuffleds) = createGrids rng aa\n    createDirectoryIfMissing True \"data/grids/\"\n    B.writeFile (gridFileName num aa)\n                (encode (take num grids))\n    B.writeFile (shuffledFileName num aa)\n                (encode (take num shuffleds))\n</code></pre>\n\n<p>However this consumes memory proportional to the size of <code>num</code>. I know <code>createGrids</code> is a sufficiently lazy function because I have tested it by appending <code>error \"not lazy enough\"</code> (as suggested by the <a href=\"https://wiki.haskell.org/Maintaining_laziness\">Haskell wiki here</a>) to the end of the lists it returns and no errors are raised. <code>take</code> is a lazy function that is defined in <code>Data.List</code>. <code>encode</code> is also a lazy function defined in <code>Data.Binary</code>. <code>B.writeFile</code> is defined in <code>Data.ByteString.Lazy</code>.</p>\n\n<p>Here is the complete code so you can execute it:</p>\n\n<pre><code>import Control.Arrow (first)\nimport Data.Binary\nimport GHC.Float (double2Float)\nimport System.Random (next)\nimport System.Random.Mersenne.Pure64 (PureMT, newPureMT, randomDouble)\nimport System.Random.Shuffle (shuffle')\nimport qualified Data.ByteString.Lazy as B\n\nmain :: IO ()\nmain = writeGrids 1000 64\n\n{- Creates and writes num grids of dimensions aa x aa -}\nwriteGrids :: Int -&gt; Int -&gt; IO ()\nwriteGrids num aa = do\n    rng &lt;- newPureMT\n    let (grids,shuffleds) = createGrids rng aa\n    B.writeFile \"grids.bin\" (encode (take num grids))\n    B.writeFile \"shuffleds.bin\" (encode (take num shuffleds))\n\n{- a random number generator, dimension of grids to make\n   returns a pair of lists, the first is a list of grids of dimensions\n   aa x aa, the second is a list of the shuffled grids corresponding to the first list -}\ncreateGrids :: PureMT -&gt; Int -&gt; ([[(Float,Float)]],[[(Float,Float)]])\ncreateGrids rng aa = (grids,shuffleds) where\n       rs = randomFloats rng\n       grids = map (getGridR aa) (chunksOf (2 * aa * aa) rs) \n       shuffleds = shuffler (aa * aa) rng grids\n\n{- length of each grid, a random number generator, a list of grids\n   returns a the list with each grid shuffled -}\nshuffler :: Int -&gt; PureMT -&gt; [[(Float,Float)]] -&gt; [[(Float,Float)]]\nshuffler n rng (xs:xss) = shuffle' xs n rng : shuffler n (snd (next rng))         xss\nshuffler _ _ [] = []\n\n{- divides list into chunks of size n -}\nchunksOf :: Int -&gt; [a] -&gt; [[a]]\nchunksOf n = go \n     where go xs = case splitAt n xs of\n              (ys,zs) | null ys -&gt; []\n                      | otherwise -&gt; ys : go zs\n\n{- dimension of grid, list of random floats [0,1]\n   returns a list of (x,y) points of length n^2 such that all\n   points are in the range [0,1] and the points are a randomly \n   perturbed regular grid -}\ngetGridR :: Int -&gt; [Float] -&gt; [(Float,Float)]\ngetGridR n rs = pts where\n   nn = n * n\n   (irs,jrs) = splitAt nn rs\n   n' = fromIntegral n\n   grid = [ (p,q) | p &lt;- [0..n'-1], q &lt;- [0..n'-1] ]\n   pts = zipWith (\\(p,q) (ir,jr) -&gt; ((p+ir)/n',(q+jr)/n')) grid (zip irs jrs)\n\n{- an infinite list of random floats in range [0,1] -}\nrandomFloats :: PureMT -&gt; [Float]\nrandomFloats rng = let (d,rng') = first double2Float (randomDouble rng)\n                   in d : randomFloats rng'\n</code></pre>\n\n<p>The required packages are:\n                     , bytestring\n                     , binary\n                     , random\n                     , mersenne-random-pure64\n                     , random-shuffle</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1437485865, "post_id": 31540641, "comment_id": 51040526, "body": "<code>deriving Eq</code> is the &quot;smarter solution&quot;. Otherwise, yes, you&#39;ll need to define all cases."}, {"owner": {"reputation": 199, "user_id": 5013037, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83ee8393e5374303ec3b868da2d9a66d?s=128&d=identicon&r=PG&f=1", "display_name": "fragant", "link": "https://stackoverflow.com/users/5013037/fragant"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1437485905, "post_id": 31540641, "comment_id": 51040549, "body": "Thank you this was my question"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 3, "creation_date": 1437487170, "post_id": 31540719, "comment_id": 51041579, "body": "It might be enough in this case because it&#39;s quite unlikely that we&#39;ll add a new day of the week in the future but it&#39;s a rather dangerous pattern to use: the catch-all case prevents the typechecker from warning you that the definition needs to be modified if you extend the enumeration. It&#39;ll just silently return <code>False</code> for this extra case."}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": true, "score": 9, "last_activity_date": 1437485922, "creation_date": 1437485922, "answer_id": 31540719, "question_id": 31540641, "link": "https://stackoverflow.com/questions/31540641/declaring-algebraic-data-type-to-instance-of-eq/31540719#31540719", "title": "Declaring algebraic data type to instance of Eq", "body": "<p>It's essentially gonna be this unless you want to mess with Template Haskell or GHC's deriving mechanisms.</p>\n\n<pre><code>instance Eq Weekday where\n  Mon == Mon = True\n  Tue == Tue = True\n  Wed == Wed = True\n  Thu == Thu = True\n  Fri == Fri = True\n  Sat == Sat = True\n  Sun == Sun = True\n  _ == _ = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1437486204, "creation_date": 1437486204, "answer_id": 31540834, "question_id": 31540641, "link": "https://stackoverflow.com/questions/31540641/declaring-algebraic-data-type-to-instance-of-eq/31540834#31540834", "title": "Declaring algebraic data type to instance of Eq", "body": "<p>Probably not what you want, but in this case you can define Eq in terms of Enum.  For example:</p>\n\n<pre><code>data Weekday = Mon | Tue | Wed | Thu | Fri | Sat | Sun\n\ninstance Eq Weekday where\n     a == b = fromEnum a == fromEnum b\n</code></pre>\n\n<p>The Enum instance can either be derived, <code>deriving (Enum)</code>, or you once again must make a rather verbose instance declaration much like what Fraser has shown.</p>\n"}], "owner": {"reputation": 199, "user_id": 5013037, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83ee8393e5374303ec3b868da2d9a66d?s=128&d=identicon&r=PG&f=1", "display_name": "fragant", "link": "https://stackoverflow.com/users/5013037/fragant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 31540719, "answer_count": 2, "score": 1, "last_activity_date": 1437487259, "creation_date": 1437485756, "last_edit_date": 1437487259, "question_id": 31540641, "link": "https://stackoverflow.com/questions/31540641/declaring-algebraic-data-type-to-instance-of-eq", "title": "Declaring algebraic data type to instance of Eq", "body": "<pre><code>data Weekday = Mon | Tue | Wed | Thu | Fri | Sat | Sun\n</code></pre>\n\n<p>How do I declare this to an instance of Eq without using <code>deriving Eq</code></p>\n\n<p>Do I have to declare it for every single possibility like: </p>\n\n<pre><code>instance Eq Weekday where\n                   Mon == Mon = True\n                   Mon == _ = False\n                   _ == Mon = False\n                   Tue == Tue = True\n                   ... == ... = ..\n</code></pre>\n\n<p>or is there a smarter solution?</p>\n"}, {"tags": ["android", "haskell", "android-ndk", "java-native-interface", "cross-compiling"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1437501233, "post_id": 31537962, "comment_id": 51051381, "body": "I think that valgrind error means valgrind was build incorrectly, see <a href=\"https://bugs.kde.org/show_bug.cgi?id=138424#c13\" rel=\"nofollow noreferrer\">bugs.kde.org/show_bug.cgi?id=138424#c13</a>. Is it possible to use gdb?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1437501465, "post_id": 31537962, "comment_id": 51051510, "body": "Presumably either you are doing something wrong or there is a bug somewhere, and in either case it is going to be hard to make progress without an actual description of what you are doing (the code you are building, how you are building it, how you built ghc, etc.) One other thing that may help narrow down the possibilities slightly is to try other environments if possible, like Android on x86 (emulator) or a regular Linux distribution on ARM, if you have the hardware for it."}, {"owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437502318, "post_id": 31537962, "comment_id": 51052006, "body": "It&#39;s a fairly long progress to build this. I generate a Haskell library using TH, generate FFI exports for some functions, generate C++ structs and Storable instances for the Haskell data types, generate SWIG files for the C++ code, builds the Swig Java library using automake and libtool, statically linking the whole GHC runtime and all the cabal libraries, some modified to polyfill some glibc functions that&#39;s missing from Bionic and then loading it in an Android app, landing at a stripped 62 MB .so file, I hope it&#39;s just a small, hard to find problem"}, {"owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437502414, "post_id": 31537962, "comment_id": 51052058, "body": "As I have been able to build Haskell executables with my toolchain that uses the Haskell library and run those on the device, and used the Java library on my PC, I have some faith in the build process. However, Android leaves me with very little information. I will look at the post about building valgrind"}, {"owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437506294, "post_id": 31537962, "comment_id": 51054180, "body": "Indeed, if I output the entry point address of memcheck-arm-linux it is  Entry point address:               0x76f30 I followed <a href=\"http://stackoverflow.com/questions/16450650/android-valgrind-build-fails/19255251#19255251\" title=\"android valgrind build fails\">stackoverflow.com/questions/16450650/&hellip;</a>. I defined LD in the script as /opt/ghc/android-14/arm-linux-androideabi-4.8/bin/arm-linux-&zwnj;&#8203;androideabi-ld, which is GNU ld (GNU Binutils) 2.23.2"}, {"owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437606946, "post_id": 31537962, "comment_id": 51105990, "body": "I was able to run gdb on the device and it looks like it&#39;s the strings that are messing things up. I compiled a C++ version (code here <a href=\"http://pastebin.com/4ZpuWjrV\" rel=\"nofollow noreferrer\">pastebin.com/4ZpuWjrV</a>) that also shows some strange behavior with string conversion. The lat string is correctly received by haskell, but lon becomes garbage (A%11N~D%03h%013%1b%01F)"}], "answers": [{"tags": [], "owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "is_accepted": true, "score": 2, "last_activity_date": 1437651442, "creation_date": 1437651442, "answer_id": 31586232, "question_id": 31537962, "link": "https://stackoverflow.com/questions/31537962/segmentation-fault-in-jni-native-code-android/31586232#31586232", "title": "Segmentation fault in JNI native code (Android)", "body": "<p>It turned out the problem was that my cross compile toolchain (<a href=\"https://github.com/neurocyte/ghc-android\" rel=\"nofollow\">https://github.com/neurocyte/ghc-android</a>) has a bug in its hsc2hs script. It's implemented as a wrapper that calls /usr/bin/hsc2hs with some flags. However, it wasn't using the --cc and --ld flag, so the resulting .hs file targeted my build host. By adding these flags, everything works great!</p>\n"}], "owner": {"reputation": 678, "user_id": 1494700, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f0c7b2c2eab3cd08e72a17d997a5792?s=128&d=identicon&r=PG", "display_name": "prinsen", "link": "https://stackoverflow.com/users/1494700/prinsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 1, "accepted_answer_id": 31586232, "answer_count": 1, "score": 1, "last_activity_date": 1437651442, "creation_date": 1437478576, "last_edit_date": 1437490306, "question_id": 31537962, "link": "https://stackoverflow.com/questions/31537962/segmentation-fault-in-jni-native-code-android", "title": "Segmentation fault in JNI native code (Android)", "body": "<p>I have a library in Haskell that I have generated wrappers for via FFI and Swig. I have also managed to cross-compile a shared library that I can load from Java. The wrapped library contains some functions and input/output types for these.</p>\n\n<p>On my Arch machine I am able to use my library from Java. However, when I now tried it out on Android, it segfaults. After some investigation, It seems that if the input object has no fields, it sometimes work. I think it's a problem with data marshalling. However it's hard to debug. In the crash log I find this</p>\n\n<pre><code>W/linker  ( 4783): libAPIsJava.so has text relocations. This is wasting memory and prevents security hardening. Please fix.\n</code></pre>\n\n<p>and this</p>\n\n<pre><code>--------- beginning of crash\nF/libc    ( 4783): Fatal signal 11 (SIGSEGV), code 1, fault addr 0x200019 in tid 4783 (api.flic.io.api)\nI/Icing   ( 1689): Indexing 17F83E8EEF17AFFA030207AF16B79084CE236092 from com.google.android.googlequicksearchbox\nI/DEBUG   (  357): *** *** *** *** *** *** *** *** *** *** *** *** ***     *** *** ***\nI/DEBUG   (  357): Build fingerprint:     'google/shamu/shamu:5.1/LMY47D/1743759:user/release-keys'\nI/DEBUG   (  357): Revision: '33696'\nI/DEBUG   (  357): ABI: 'arm'\nI/DEBUG   (  357): pid: 4783, tid: 4783, name: api.flic.io.api  &gt;&gt;&gt; app.api.flic.io.api &lt;&lt;&lt;\nI/DEBUG   (  357): signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x200019\nI/DEBUG   (  357):     r0 af2033d4  r1 af2033d0  r2 00000000  r3 00200018\nI/DEBUG   (  357):     r4 a2bbf950  r5 af2033dc  r6 af2029a0  r7 af202fff\nI/DEBUG   (  357):     r8 a2af06b0  r9 00200019  sl af2033c8  fp af2030a4\nI/DEBUG   (  357):     ip b6e627dc  sp bec8eee0  lr af2029b0  pc a0b4d248  cpsr 800d0010\nI/DEBUG   (  357): \nI/DEBUG   (  357): backtrace:\nI/DEBUG   (  357):     #00 pc 01be4248  /data/app/app.api.flic.io.api-2/lib/arm/libAPIsJava.so\n</code></pre>\n\n<p>However, Issuing arm-linux-androideabi-addr2line -f -e libAPIsJava.so 01be4248, the output is</p>\n\n<pre><code>$a\n/tmp/ghc27404_0/ghc27404_3.bc:? \n</code></pre>\n\n<p>Which is not of much help. What I would really like is to run the app with valgrind, is something like that possible?</p>\n\n<p>Update: I have now installed valgrind and tried to run the app. However I get </p>\n\n<pre><code>valgrind: mmap(0x108000, 42770432) failed in UME with error 22 (Invalid argument).\nvalgrind: this can be caused by executables with very large text, data or bss segments.\n</code></pre>\n\n<p>Which seems to be a no-go.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437519808, "post_id": 31536329, "comment_id": 51060637, "body": "Why doesn&#39;t it work?"}, {"owner": {"reputation": 11, "user_id": 4654284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee02b8ea3e72f20726d8e0344a4ef61?s=128&d=identicon&r=PG&f=1", "display_name": "S.Trupp", "link": "https://stackoverflow.com/users/4654284/s-trupp"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437546625, "post_id": 31536329, "comment_id": 51068140, "body": "@duplode thank you for the edit. it doesn&#39;t work because there are files there a python glob(&quot;./d*/*/*.xml&quot;) from same directory will list those xml files. it could be a bug  in the package System.FilePath.Find or i use the package wrong way ... when i know more or i have an other solution i will edit my post."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437561712, "post_id": 31536329, "comment_id": 51077492, "body": "Looks like a bug. See <a href=\"https://github.com/bos/filemanip/issues/9\" rel=\"nofollow noreferrer\">github.com/bos/filemanip/issues/9</a> . While that isn&#39;t fixed, you can try the <a href=\"https://hackage.haskell.org/package/Glob\" rel=\"nofollow noreferrer\">Glob</a> package (it has a module name clash with the <code>filemanip</code> you were trying to use, so you&#39;ll need a <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/syntax-extns.html#idp23944304\" rel=\"nofollow noreferrer\">package-qualified import</a> to use it)."}], "owner": {"reputation": 11, "user_id": 4654284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee02b8ea3e72f20726d8e0344a4ef61?s=128&d=identicon&r=PG&f=1", "display_name": "S.Trupp", "link": "https://stackoverflow.com/users/4654284/s-trupp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437519295, "creation_date": 1437473951, "last_edit_date": 1437519295, "question_id": 31536329, "link": "https://stackoverflow.com/questions/31536329/haskell-globbing-with-system-filepath-find", "title": "Haskell globbing with System.FilePath.Find", "body": "<p>How can I list all files and directories matching the pattern <code>./d*/*/*.xml</code>? I would prefer reusing existing solution like <code>System.FilePath.Find</code> rather than rolling my own one.</p>\n\n<p>This na\u00efve solution does not work:</p>\n\n<pre><code>find always (filePath ~~? \"./d*/*/*.xml\") \".\"\n</code></pre>\n"}, {"tags": ["scala", "haskell", "polymorphism", "type-inference"], "comments": [{"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "reply_to_user": {"reputation": 38577, "user_id": 1296806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ec5b08d0fe94845ba49fd4a263c7d99d?s=128&d=identicon&r=PG", "display_name": "som-snytt", "link": "https://stackoverflow.com/users/1296806/som-snytt"}, "edited": false, "score": 0, "creation_date": 1437456120, "post_id": 31530528, "comment_id": 51022378, "body": "@som-snytt  <code>Poly</code> seems like good workaround, so I have to wait for a good syntax for it (to actually see types inside <code>Poly</code> object and have eta-expansion). I mean <code>Shapeless</code> could define eta-expansion to <code>Poly</code> to have nicer syntax. Thanks anyway."}, {"owner": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 0, "creation_date": 1437456327, "post_id": 31530528, "comment_id": 51022435, "body": "@dk15 Eta expansion in Scala is a kind of kludgy bridge between methods and functions\u2014it doesn&#39;t really make sense for Shapeless&#39;s polymorphic function values."}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "reply_to_user": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 0, "creation_date": 1437456428, "post_id": 31530528, "comment_id": 51022479, "body": "@Travis Brown - I mean expand method to <code>Poly</code> instead of <code>Function</code>. So I need convenient bridge to <code>Shapeless</code>&#39;s poly-function instead of scala&#39;s <code>Function</code>"}, {"owner": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 2, "creation_date": 1437457052, "post_id": 31530528, "comment_id": 51022673, "body": "@dk14 Ah, got it. <code>Poly(identity _)</code>, etc. will work in some cases."}, {"owner": {"reputation": 27958, "user_id": 894565, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tcDXH.png?s=128&g=1", "display_name": "Jatin", "link": "https://stackoverflow.com/users/894565/jatin"}, "edited": false, "score": 0, "creation_date": 1437471319, "post_id": 31530528, "comment_id": 51030320, "body": "<code>val a: (Int) =&gt; Int = f _; a(4)</code> ?"}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "reply_to_user": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 0, "creation_date": 1437473063, "post_id": 31530528, "comment_id": 51031505, "body": "@Travis Brown - that&#39;s what I need - I used to write <code>Poly</code> functions by myself (implementing <code>Poly1</code> etc) - now my life (in some cases) became easier. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1437455690, "post_id": 31530866, "comment_id": 51022259, "body": "It&#39;s still not a value - there is no way to pass it into another function in generic way. Simply saying, you&#39;ve defined a method here - not a function"}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1437455792, "post_id": 31530866, "comment_id": 51022288, "body": "See <a href=\"http://stackoverflow.com/questions/2529184/difference-between-method-and-function-in-scala\" title=\"difference between method and function in scala\">stackoverflow.com/questions/2529184/&hellip;</a>"}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1437455838, "post_id": 31530866, "comment_id": 51022300, "body": "I mean <code>id _</code> is still <code>Nothing =&gt; Nothing</code>. I can use it as workaround for aliases, but not as generic solution."}, {"owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "reply_to_user": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1437456073, "post_id": 31530866, "comment_id": 51022367, "body": "Have a look at: <a href=\"http://stackoverflow.com/questions/15264838/in-scala-can-generic-type-parameters-be-used-with-function-definitions\" title=\"in scala can generic type parameters be used with function definitions\">stackoverflow.com/questions/15264838/&hellip;</a>"}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1437456368, "post_id": 31530866, "comment_id": 51022459, "body": "Ok, my question is a bit duplicate, however I&#39;m looking for any generic solution to that problem - as now we have macro and Shapeless - maybe someone created library that can do that."}], "tags": [], "owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "is_accepted": false, "score": 0, "last_activity_date": 1437455667, "creation_date": 1437455667, "answer_id": 31530866, "question_id": 31530528, "link": "https://stackoverflow.com/questions/31530528/how-to-get-generic-polymorphic-lambda-in-scala/31530866#31530866", "title": "How to get generic (polymorphic) lambda in scala?", "body": "<p>It seems to do this you will need to do a bit type hinting to help the Scala type inference system. </p>\n\n<pre><code>def id[T] : T =&gt; T = identity _\n</code></pre>\n\n<p>So I guess if you try to pass identity as a parameter to a function call and the types of that parameter are generic then there should be no problem.</p>\n"}, {"comments": [{"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 2, "creation_date": 1437472617, "post_id": 31534763, "comment_id": 51031211, "body": "it&#39;s not much related to the JVM actually as it happens in compile-time (regular <code>Function</code> is also may be seen workaround). I agree that for now <code>Poly</code> seems like best solution."}], "tags": [], "owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "is_accepted": true, "score": 7, "last_activity_date": 1437469616, "creation_date": 1437469616, "answer_id": 31534763, "question_id": 31530528, "link": "https://stackoverflow.com/questions/31530528/how-to-get-generic-polymorphic-lambda-in-scala/31534763#31534763", "title": "How to get generic (polymorphic) lambda in scala?", "body": "<p>Only methods can be generic on the JVM/Scala, not values. You can make an anonymous instance that implements some interface (and duplicate it for every type-arity you want to work with):</p>\n\n<pre><code>trait ~&gt;[A[_], B[_]] { //exists in scalaz\n  def apply[T](a: A[T]): B[T]\n}\n\nval f = new (List ~&gt; Id) {\n  def apply[T](a: List[T]) = a.head\n}\n</code></pre>\n\n<p>Or use shapeless' <code>Poly</code>, which supports more complicated type-cases. But yeah, it's a limitation and it requires working around.</p>\n"}, {"comments": [{"owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "edited": false, "score": 0, "creation_date": 1437475909, "post_id": 31535900, "comment_id": 51033339, "body": "I think we all would, but it&#39;s probably too big a change to happen in Scala at this stage. You might look to e.g. Idris for a language that takes some inspiration from Scala, but has more support for type-level programming."}], "tags": [], "owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "is_accepted": false, "score": 1, "last_activity_date": 1437474873, "last_edit_date": 1437474873, "creation_date": 1437472788, "answer_id": 31535900, "question_id": 31530528, "link": "https://stackoverflow.com/questions/31530528/how-to-get-generic-polymorphic-lambda-in-scala/31535900#31535900", "title": "How to get generic (polymorphic) lambda in scala?", "body": "<p>I really like @Travis Brown 's solution:</p>\n\n<pre><code>import shapeless._\n\nscala&gt; Poly(identity _)\nres2: shapeless.PolyDefns.~&gt;[shapeless.Id,shapeless.Id] = fresh$macro$1$2$@797aa352\n</code></pre>\n\n<p>-</p>\n\n<pre><code>scala&gt; def f[T](x: T) = x\nf: [T](x: T)T\n\nscala&gt; Poly(f _)\nres3: shapeless.PolyDefns.~&gt;[shapeless.Id,shapeless.Id] = fresh$macro$2$2$@664ea816\n</code></pre>\n\n<p>-</p>\n\n<pre><code>scala&gt; def f[T](l: List[T]) = l.head\nf: [T](l: List[T])T\n\nscala&gt; val ff = Poly(f _)\nff: shapeless.PolyDefns.~&gt;[List,shapeless.Id] = fresh$macro$3$2$@51254c50\n\nscala&gt; ff(List(1,2,3))\nres5: shapeless.Id[Int] = 1\n\nscala&gt; ff(List(\"1\",\"2\",\"3\"))\nres6: shapeless.Id[String] = 1\n</code></pre>\n\n<p><code>Poly</code> constructor (in some cases) will give you eta-expansion into Shapeless2 <code>Poly1</code> function, which is (more-less) truly generic. However it doesn't work for multi-parameters (even with multi type-parameters), so have to \"implement\" <code>Poly2</code> with <code>implicit</code> + <code>at</code> approach (as @som-snytt suggested), something like:</p>\n\n<pre><code>object myF extends Poly2 {\n  implicit def caseA[T, U] = at[T, U]{ (a, b) =&gt; a -&gt; b}\n}\n\nscala&gt; myF(1,2)\nres15: (Int, Int) = (1,2)\n\nscala&gt; myF(\"a\",2)\nres16: (String, Int) = (a,2)\n</code></pre>\n\n<p>P.S. I would really want to see it as a part of language.</p>\n"}, {"comments": [{"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502379053, "post_id": 45617755, "comment_id": 78195015, "body": "That&#39;s really nice! I&#39;d mention that with kind-projector (<a href=\"https://github.com/non/kind-projector\" rel=\"nofollow noreferrer\">typelevel</a> plugin), we (probably, didn&#39;t try yet) could just write: <code>type PolyId = ForAll[Lambda[A =&gt; A]]</code> or even <code>val id = \u03bd[ForAll[Lambda[A =&gt; A]]](a =&gt; a)</code>. Maybe, you could add some interoperabilitty shortcut (it could be in a separate project to keep your solution free from unnecessary dependencies) as well like <code>val id = poly[A =&gt; A](a =&gt; a)</code>"}, {"owner": {"reputation": 6337, "user_id": 1572599, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8125f451db25e510aa1b7fd6c2c0566?s=128&d=identicon&r=PG", "display_name": "Tomas Mikula", "link": "https://stackoverflow.com/users/1572599/tomas-mikula"}, "reply_to_user": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502379658, "post_id": 45617755, "comment_id": 78195456, "body": "For <code>poly[A =&gt; A](a =&gt; a)</code>, we would need to determine and <i>hard-code</i> what trait to implement (here, <code>ForAll</code>). So the plugin would have to come with a library containing a lot of variants on <code>ForAll[F[_]]</code>, like <code>ForAll2[F[_, _]]</code>, <code>ForAllH[F[_[_]]]</code>, <code>ForAllHA[F[_[_]], G[_]]</code>, ... Another option would be to use structural types, which according to some <a href=\"https://github.com/non/kind-projector/pull/44#issuecomment-267750484\" rel=\"nofollow noreferrer\">are a non-starter</a>."}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502382007, "post_id": 45617755, "comment_id": 78197061, "body": "I agree this kind of library would look &quot;ugly&quot;; however, as a separate (pragmatic) project, why not? even let&#39;s say shapeless has its limits on <code>nat</code>s and every-one ok with it. Besides, you could just generate those types with a macros (you can add custom expansion for Intellij IDEA).  Anyways for one plane parameter this one-liner works (Scala 2.12, given that <code>ForAll</code> is defined): <code>val id = \u039b[a](a =&gt; a) : ForAll[Lambda[a =&gt; a =&gt; a]]</code>, which is really cool :)"}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502382056, "post_id": 45617755, "comment_id": 78197096, "body": "also (just for people who read comments here) <code>val toList = \u039b[a](x =&gt; List(x)) : ForAll[Lambda[a =&gt; a =&gt; List[a]]]</code>. <code>toList.apply(5)</code> - scala forced me to explicitly call <code>apply</code> for some reason"}, {"owner": {"reputation": 6337, "user_id": 1572599, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8125f451db25e510aa1b7fd6c2c0566?s=128&d=identicon&r=PG", "display_name": "Tomas Mikula", "link": "https://stackoverflow.com/users/1572599/tomas-mikula"}, "reply_to_user": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502385950, "post_id": 45617755, "comment_id": 78199407, "body": "You needed at least one explicit <code>apply</code>, because it is actually two <code>apply</code>s in a row: <code>toList.apply[Int].apply(5)</code>. You could also write it as <code>toList[Int](5)</code>. This special case when the <code>F[_]</code> in <code>ForAll[F]</code> is a function type could have some additional syntactic convenience, but that&#39;s up to the library."}, {"owner": {"reputation": 6337, "user_id": 1572599, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8125f451db25e510aa1b7fd6c2c0566?s=128&d=identicon&r=PG", "display_name": "Tomas Mikula", "link": "https://stackoverflow.com/users/1572599/tomas-mikula"}, "reply_to_user": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 0, "creation_date": 1502385956, "post_id": 45617755, "comment_id": 78199412, "body": "&gt; &quot;however, as a separate (pragmatic) project, why not?&quot;  Separate from what? It cannot be separate from the plugin."}, {"owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "edited": false, "score": 1, "creation_date": 1502391977, "post_id": 45617755, "comment_id": 78202907, "body": "you can generate/hardcode convinience ForAll stuff in a completely separate project as they don&#39;t require any plugin at all. Shortcuts are more complicated (and maybe it would be a hacky solution), but they still could be a separate plugin that is using your plugin as a library (plugin is essentialy a jar with implemention of &quot;Plugin&quot; interface after all - even kind-projector&#39;s KindRewriter is formally a public class)"}], "tags": [], "owner": {"reputation": 6337, "user_id": 1572599, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8125f451db25e510aa1b7fd6c2c0566?s=128&d=identicon&r=PG", "display_name": "Tomas Mikula", "link": "https://stackoverflow.com/users/1572599/tomas-mikula"}, "is_accepted": false, "score": 2, "last_activity_date": 1502378596, "creation_date": 1502378596, "answer_id": 45617755, "question_id": 31530528, "link": "https://stackoverflow.com/questions/31530528/how-to-get-generic-polymorphic-lambda-in-scala/45617755#45617755", "title": "How to get generic (polymorphic) lambda in scala?", "body": "<p><a href=\"https://github.com/TomasMikula/pascal\" rel=\"nofollow noreferrer\">P\u2200scal</a> is a compiler plugin that provides more concise syntax for encoding polymorphic values as objects with a generic method.</p>\n\n<p>The identity function, as a value, has type <code>\u2200A. A =&gt; A</code>. To translate that into Scala, assume a trait</p>\n\n<pre><code>trait ForAll[F[_]] {\n  def apply[A]: F[A]\n}\n</code></pre>\n\n<p>Then the identity function has type <code>ForAll[\u03bb[A =&gt; A =&gt; A]]</code>, where I use the <a href=\"https://github.com/non/kind-projector\" rel=\"nofollow noreferrer\">kind-projector</a> syntax, or, without kind-projector:</p>\n\n<pre><code>type IdFun[A] = A =&gt; A\ntype PolyId = ForAll[IdFun]\n</code></pre>\n\n<p>And now comes the P\u2200scal syntactic sugar:</p>\n\n<pre><code>val id = \u039b[\u0391](a =&gt; a) : PolyId\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>val id = \u03bd[PolyId](a =&gt; a)\n</code></pre>\n\n<p>(\"\u03bd\" is the Greek lowercase letter \"Nu\", read \"new\")</p>\n\n<p>These are really just shorthands for</p>\n\n<pre><code>new PolyId {\n  def apply[A] = a =&gt; a\n}\n</code></pre>\n\n<p>Multiple type parameters and parameters of arbitrary kinds are supported by P\u2200scal, but you need a dedicated variation on the above <code>ForAll</code> trait for each variant.</p>\n"}], "owner": {"reputation": 21223, "user_id": 1809978, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2c84636f18304749755e15b2319751f6?s=128&d=identicon&r=PG", "display_name": "dk14", "link": "https://stackoverflow.com/users/1809978/dk14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 986, "favorite_count": 5, "accepted_answer_id": 31534763, "answer_count": 4, "score": 12, "last_activity_date": 1599659369, "creation_date": 1437453729, "last_edit_date": 1599659369, "question_id": 31530528, "link": "https://stackoverflow.com/questions/31530528/how-to-get-generic-polymorphic-lambda-in-scala", "title": "How to get generic (polymorphic) lambda in scala?", "body": "<p>Update (2018): my prayers were answered in Dotty (<a href=\"http://dotty.epfl.ch/docs/reference/type-lambdas.html\" rel=\"nofollow noreferrer\">Type Lambdas</a>), so the following Q&amp;A is more &quot;Scala 2.x&quot;-related</p>\n<hr />\n<p>Just a simple example from Scala:</p>\n<pre><code>scala&gt; def f(x: Int) = x\nf: (x: Int)Int\n\nscala&gt; (f _)(5)\nres0: Int = 5\n</code></pre>\n<p>Let's make it generic:</p>\n<pre><code>scala&gt; def f[T](x: T) = x\nf: [T](x: T)T\n\nscala&gt; (f _)(5)\n&lt;console&gt;:9: error: type mismatch;\n found   : Int(5)\n required: Nothing\n              (f _)(5)\n                    ^\n</code></pre>\n<p>Let's look at eta-expansion of polymorphic method in Scala:</p>\n<pre><code>scala&gt; f _ \nres2: Nothing =&gt; Nothing = &lt;function1&gt;\n</code></pre>\n<p>Comparison with Haskell:</p>\n<pre><code>Prelude&gt; let f x = x\n\nPrelude&gt; f 5\n5\nPrelude&gt; f &quot;a&quot;\n&quot;a&quot;\nPrelude&gt; :t f\nf :: t -&gt; t\n</code></pre>\n<p>Haskell did infer correct type <code>[T] =&gt; [T]</code> here.</p>\n<p>More realistic example?</p>\n<pre><code>scala&gt; identity _\nres2: Nothing =&gt; Nothing = &lt;function1&gt;\n</code></pre>\n<p>Even more realistic:</p>\n<pre><code>scala&gt; def f[T](l: List[T]) = l.head\nf: [T](l: List[T])T\n\nscala&gt; f _\nres3: List[Nothing] =&gt; Nothing = &lt;function1&gt;\n</code></pre>\n<p>You can't make alias for identity - have to write your own function. Things like <code>[T,U](t: T, u: U) =&gt; t -&gt; u</code> (make tuple) are impossible to use as values. More general - if you want to pass some lambda that rely on generic type (e.g. uses generic function, for example: creates lists, tuples, modify them in some way) - you can't do that.</p>\n<p>So, how to solve that problem? Any workaround, solution or reasoning?</p>\n<p>P.S. I've used term polymorphic lambda (instead of function) as function is just named lambda</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1437449300, "post_id": 31529579, "comment_id": 51020638, "body": "Related: <a href=\"http://stackoverflow.com/q/3951012/190376\">stackoverflow.com/q/3951012/190376</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 7, "last_activity_date": 1437447894, "creation_date": 1437447894, "answer_id": 31529671, "question_id": 31529579, "link": "https://stackoverflow.com/questions/31529579/where-clauses-in-list-comprehensions/31529671#31529671", "title": "where clauses in list comprehensions", "body": "<p>Well, a naive de-sugaring would be:</p>\n\n<pre><code>cp [] = [[]]\ncp (xs:xss) = concatMap (\\x -&gt; concatMap (\\ ys -&gt; [ x:ys ]) (cp xss)) xs\n----------------------------------------------\ncp [] = [[]]\ncp (xs:xss) = let yss = cp xss in concatMap (\\x -&gt; concatMap (\\ ys -&gt; [ x:ys ]) yss) xs\n</code></pre>\n\n<p>As you can see, in the first version the call <code>cp xss</code> is inside a lambda.  Unless the optimizer moves it, that means it will get re-evaluated each time the function <code>\\x -&gt; concatMap (\\ ys -&gt; [ x:ys ]) (cp xss)</code> gets called.  By floating it out, we avoid the re-computation.</p>\n\n<p>At the same time, GHC does have an optimization pass to float expensive computations out of loops like this, so it may convert the first version to the second automatically.  Your book says the second version 'guarantees' to calculate the value of <code>cp xss</code> only once because, if the expression is expensive to compute, compilers will generally be very hesitant to inline it (converting the second version back into the first).</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 11, "last_activity_date": 1437449307, "creation_date": 1437449307, "answer_id": 31529842, "question_id": 31529579, "link": "https://stackoverflow.com/questions/31529579/where-clauses-in-list-comprehensions/31529842#31529842", "title": "where clauses in list comprehensions", "body": "<p>The two definitions are equivalent in the sense that they denote the same value, of course.</p>\n\n<p>Operationally they differ in the sharing behavior under call-by-need evaluation. jcast already explained why, but I want to add a shortcut that does not require explicitly desugaring the list comprehension. The rule is: any expression that is syntactically in a position where it could depend on a variable <code>x</code> will be recomputed each time the variable <code>x</code> is bound to a value, even if the expression does not actually depend on <code>x</code>.</p>\n\n<p>In your case, in the first definition, <code>x</code> is in scope in the position where <code>cp xss</code> appears, so <code>cp xss</code> will be re-evaluated for each element <code>x</code> of <code>xs</code>. In the second definition <code>cp xss</code> appears outside the scope of <code>x</code> so it will be computed just once.</p>\n\n<p>Then the usual disclaimers apply, namely:</p>\n\n<ul>\n<li><p>The compiler is not required to adhere to the operational semantics of call-by-need evaluation, only the denotational semantics. So it might compute things fewer times (floating out) or more times (floating in) than you would expect based on the above rule.</p></li>\n<li><p>It's not true in general that more sharing is better. In this case, for example, it's probably not better because the size of <code>cp xss</code> grows as quickly as the amount of work that it took to compute it in the first place. In this situation the cost of reading the value back from memory can exceed that of recomputing the value (due to the cache hierarchy and the GC).</p></li>\n</ul>\n"}], "owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 2, "accepted_answer_id": 31529842, "answer_count": 2, "score": 10, "last_activity_date": 1437449307, "creation_date": 1437447113, "last_edit_date": 1437447611, "question_id": 31529579, "link": "https://stackoverflow.com/questions/31529579/where-clauses-in-list-comprehensions", "title": "where clauses in list comprehensions", "body": "<p>What is the difference between the following two formulas?</p>\n\n<pre><code>cp [] = [[]]\ncp (xs:xss) = [x:ys | x &lt;- xs, ys &lt;- cp xss]\n----------------------------------------------\ncp [] = [[]]\ncp (xs:xss) = [x:ys | x &lt;- xs, ys &lt;- yss]\n              where yss = cp xss\n</code></pre>\n\n<p>Sample output: <code>cp [[1,2,3],[4,5]] =&gt; [[1,4],[1,5],[2,4],[2,5],[3,4],[3,5]]</code></p>\n\n<p>According to <em>Thinking Functionally With Haskell</em> (p. 92), the second version is \"a more efficient definition...[which] guarantees that cp xss is computed just once,\" though the author never explains why. I would have thought they were equivalent.</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437439714, "post_id": 31528510, "comment_id": 51018442, "body": "How did you try to compile test-script using ghc ? What command did you gave ? Where you inside the sandboxed directory at that time ?"}, {"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437439835, "post_id": 31528510, "comment_id": 51018475, "body": "I was in the same directory as the sandbox, and I typed &#39;ghc --make diagramstutorial.lhs&#39; to compile it (that was the title of the file)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437443144, "post_id": 31528510, "comment_id": 51019111, "body": "Closely related: <a href=\"http://stackoverflow.com/questions/23120611/installed-parsec-in-sandbox-but-cant-find-libraries-when-trying-to-load-file-i\">Installed parsec in sandbox, but can&#39;t find libraries when trying to load file in ghci</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1437481480, "post_id": 31528929, "comment_id": 51037029, "body": "This is only true for Cabal 1.20 and onwards. For older versions see my reply below which is a global solution and should be preferred."}, {"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1437595703, "post_id": 31528929, "comment_id": 51100823, "body": "Something confusing has happened... This advice worked fine yesterday, but now I get the error <code>cabal.exe: unrecognised command: exec (try --help)</code>. Do you know what might have happened?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1437596438, "post_id": 31528929, "comment_id": 51101288, "body": "@DanielLittlewood What does <code>cabal --version</code> tell you? As Arnon pointed out, <code>cabal exec</code> was added in the 1.20 version. Is it possible that you are using an older version of cabal today? (That is not as implausible as it sounds, given that <code>cabal install cabal-install</code> will perform a local, and not system-wide, installation of the cabal program.)"}, {"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1437596890, "post_id": 31528929, "comment_id": 51101596, "body": "Aha I see! Yes, that&#39;s the problem, I didn&#39;t know cabal would install itself locally as well. Thanks!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1437442697, "last_edit_date": 1437442697, "creation_date": 1437442386, "answer_id": 31528929, "question_id": 31528510, "link": "https://stackoverflow.com/questions/31528510/cabal-installed-modules-wont-import/31528929#31528929", "title": "Cabal-installed Modules won&#39;t import", "body": "<blockquote>\n  <p>I typed <code>ghc --make diagramstutorial.lhs</code> to compile it</p>\n</blockquote>\n\n<p>That will make GHC use the regular user package database (that is, not the sandbox one). Use <code>cabal exec -- ghc --make diagramstutorial.lhs</code> instead, so that GHC runs in the context of your sandbox.</p>\n\n<p>You can also use GHCi within the sandbox with <code>cabal repl</code>. And naturally, if/when you start preparing a cabal package, all cabal commands (<code>cabal build</code>, etc.) will use the sandbox if you are within its directory.</p>\n\n<blockquote>\n  <p>Something that's not clear to me is exactly what a sandbox is</p>\n</blockquote>\n\n<p>A set of packages with an accompanying database local to the directory. Beyond the <code>cabal.sandbox.config</code> configuration file there is also a hidden directory <code>.cabal-sandbox</code>, in which <code>diagrams</code> and the other packages you installed lie.</p>\n"}, {"tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": 1, "last_activity_date": 1437464655, "creation_date": 1437464655, "answer_id": 31533093, "question_id": 31528510, "link": "https://stackoverflow.com/questions/31528510/cabal-installed-modules-wont-import/31533093#31533093", "title": "Cabal-installed Modules won&#39;t import", "body": "<ol>\n<li><p>Find the sandbox directory, and locate the <code>packages.conf.d</code> file.\nFor example, <code>/home/user/.cabal-sandbox/x86_64-linux-ghc-7.8.4-packages.conf.d</code></p></li>\n<li><p>Rerun your GHC commands with the <code>package-db</code> flag:</p>\n\n<p><code>ghci -package-db /home/user/.cabal-sandbox/x86_64-linux-ghc-7.8.4-packages.conf.d --make diagramstutorial.lhs</code></p></li>\n</ol>\n\n<p>Everything should now work</p>\n"}], "owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1211, "favorite_count": 0, "accepted_answer_id": 31528929, "answer_count": 2, "score": 0, "last_activity_date": 1437464655, "creation_date": 1437438805, "question_id": 31528510, "link": "https://stackoverflow.com/questions/31528510/cabal-installed-modules-wont-import", "title": "Cabal-installed Modules won&#39;t import", "body": "<p>There are several things I'm confused about here, so I'll try to explain each of them as clearly as I can.  </p>\n\n<p>I've been trying to install the <code>diagrams</code> package for haskell, using cabal. <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#developing-with-sandboxes\" rel=\"nofollow\">I've seen it suggested</a> to install packages using sandboxes, so that's what I did. Something that's not clear to me is exactly what a sandbox is - I understand that I can initialise one with <code>cabal sandbox init</code> and install packages inside of it with <code>cabal install</code>, but I don't see how to use those packages once they're installed.  </p>\n\n<p>I then tried to compile a test-script using ghc, which resulted in the following error:  </p>\n\n<pre><code>diagramstutorial.lhs:3:10:\n    Could not find module 'Diagrams.Prelude'\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>With a similar error for another module that the script was supposed to load. These modules are definitely both included in the diagrams package, and cabal seems happy that the package is installed correctly. I expect there's something simple I just don't understand, but I don't know what it is.</p>\n"}, {"tags": ["haskell", "random", "mersenne-twister"], "answers": [{"tags": [], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "is_accepted": true, "score": 3, "last_activity_date": 1437435499, "creation_date": 1437435499, "answer_id": 31528067, "question_id": 31527988, "link": "https://stackoverflow.com/questions/31527988/using-system-random-mersenne-pure64-to-generate-a-random-float-in-the-range-0-1/31528067#31528067", "title": "Using System.Random.Mersenne.Pure64 to generate a random Float in the range [0,1]", "body": "<p>I realized I was making a very silly mistake. \nThe function randomDouble in System.Random.Mersenne.Pure64 returns a double already in the range [0,1] (which the <a href=\"http://hackage.haskell.org/package/mersenne-random-pure64-0.2.0.4/docs/System-Random-Mersenne-Pure64.html\" rel=\"nofollow\">documentation does not mention at all</a>) and consquently all my numbers were very small because I was dividing them by the max double.</p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 31528067, "answer_count": 1, "score": 1, "last_activity_date": 1437435499, "creation_date": 1437434923, "question_id": 31527988, "link": "https://stackoverflow.com/questions/31527988/using-system-random-mersenne-pure64-to-generate-a-random-float-in-the-range-0-1", "title": "Using System.Random.Mersenne.Pure64 to generate a random Float in the range [0,1]", "body": "<p>I do not want to use System.Random because it is significantly slower and I need to generate millions of random floats. I also cannot use System.Random.MWC because it is not pure.</p>\n\n<p>I made an attempt at writing this myself but my solution does not generate a uniform range, all the values are very close to 0.</p>\n\n<pre><code>randomRMSP :: (Float,Float) -&gt; PureMT -&gt; (Float,PureMT)                   \nrandomRMSP (lo,hi) rng =\n    let (f,rng') = first double2Float (randomDouble rng)\n    in (lo + f / (maxFloat + 1) * (hi - lo + 1),rng')\n\nmaxRealFloat :: RealFloat a =&gt; a -&gt; a                                           \nmaxRealFloat a = encodeFloat m n where                                          \n    b = floatRadix a                                                            \n    e = floatDigits a                                                           \n    (_, e') = floatRange a                                                      \n    m = b ^ e - 1                                                               \n    n = e' - e\n</code></pre>\n\n<p>I'm pretty sure the maxRealFloat function is correct because it returns the <a href=\"https://en.wikipedia.org/wiki/IEEE_754-1985\" rel=\"nofollow\">correct values for Floats and Doubles according to Wikipedia</a></p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1437427958, "post_id": 31526504, "comment_id": 51014670, "body": "Are you asking how to get core output from GHC, or how to use criterion?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437428424, "post_id": 31526504, "comment_id": 51014860, "body": "Relevant: <a href=\"http://stackoverflow.com/q/9027384/2751851\">Haskell GHC: what is the time complexity of a pattern match with N constructors?</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437434327, "post_id": 31526504, "comment_id": 51016988, "body": "I&#39;d tend to think that pattern matching is faster, considering that <code>Eq</code> instances are usually based on pattern matching anyway."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 14, "last_activity_date": 1437431294, "last_edit_date": 1437431294, "creation_date": 1437429368, "answer_id": 31527024, "question_id": 31526504, "link": "https://stackoverflow.com/questions/31526504/is-pattern-matching-more-performant-than-guards/31527024#31527024", "title": "Is pattern matching more performant than guards?", "body": "<p>Never mind patterns vs. guards, you might as well ask about <code>if</code> vs. <code>case</code>.</p>\n\n<p>Pattern matching is preferrable <em>to equality checks</em>. Equality-checking is not really a natural thing to do in Haskell. <a href=\"http://dev.stephendiehl.com/hask/#boolean-blindness\" rel=\"noreferrer\">Boolean blindness</a> is one problem, but apart from that full equality check is often simply not feasible &ndash; e.g. infinite lists will never compare equal!</p>\n\n<p>How much more efficient direct pattern matching is depends on the type. In case of numbers, don't expect much difference since those patterns are under the hood <em>implemented with equality checks</em>.</p>\n\n<p>I generally prefer patterns &ndash; because they're just nicer and <em>can</em> be more efficient. Equality checks will be either just as expensive, or possibly more expensive, and are just un-idiomatic. Only use boolean evaluation when you have to, otherwise stick to patterns (which can be <a href=\"https://wiki.haskell.org/Pattern_guard\" rel=\"noreferrer\">in guards</a> too)!</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 3, "answer_count": 1, "score": 12, "last_activity_date": 1437431294, "creation_date": 1437427019, "question_id": 31526504, "link": "https://stackoverflow.com/questions/31526504/is-pattern-matching-more-performant-than-guards", "title": "Is pattern matching more performant than guards?", "body": "<p>I've read somewhere lately that pattern matching happens during run-time and not compile-time. (I am looking for the source, but can't find it at the moment.) Is it true? And if so, do guards in functions have the same performance? </p>\n\n<p>Reading this was surprising to me because I used to think GHC was able to optimize some (probably not all) pattern match decisions during compile time. Does this happen at all?</p>\n\n<p>A case for example: </p>\n\n<pre><code>f 1 = 3\nf 2 = 4\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>f' a | a == 1 = 3\n     | a == 2 = 4\n</code></pre>\n\n<p>Do <code>f</code> and <code>f'</code> compile to the same number of instructions (e.g. in Core and/or lower)?</p>\n\n<p>Is the situation any different if I pattern match on a constructor instead of a value?  E.g. if GHC sees that a function from a location is always invoked with one constructor, does it optimize that call in a way that eliminates the run-time check? And if so, can you give me an example showing what the optimization produces?</p>\n\n<h1>In summary</h1>\n\n<p>What is good to know about these two approaches in terms of performance?</p>\n\n<p>When is one preferable performance-wise?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1437455055, "post_id": 31525737, "comment_id": 51022055, "body": "Don&#39;t you need to <code>cabal install --enable-tests</code> and/or <code>cabal configure --enable-tests</code>?"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437455609, "post_id": 31525737, "comment_id": 51022241, "body": "That seems to work, thanks @ReidBarton. Could you change your comment to be an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1437461974, "creation_date": 1437461974, "answer_id": 31532293, "question_id": 31525737, "link": "https://stackoverflow.com/questions/31525737/how-can-i-debug-if-resetting-a-cabal-sandbox-does-not-solve-dependency-errors/31532293#31532293", "title": "How can I debug if resetting a cabal sandbox does not solve dependency errors?", "body": "<p>To get <code>cabal install</code> to install the dependencies of your tests you must use the <code>--enable-tests</code> options. (For most packages that you install you don't plan to run the tests, and then installing the dependencies of the tests is potentially a waste of time.) Based on the error messages in your post I guess you must also use <code>cabal configure --enable-tests</code> in order to use <code>cabal test</code>; I'm not sure what the purpose of that is.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 31532293, "answer_count": 1, "score": 1, "last_activity_date": 1437461974, "creation_date": 1437424063, "question_id": 31525737, "link": "https://stackoverflow.com/questions/31525737/how-can-i-debug-if-resetting-a-cabal-sandbox-does-not-solve-dependency-errors", "title": "How can I debug if resetting a cabal sandbox does not solve dependency errors?", "body": "<p>I have a curious situation. I have a package that used to work properly and for no apparent reason stopped running <code>cabal test</code>.</p>\n\n<pre><code>$ cabal test\nThe sandbox was created after the package was already configured.\nRe-configuring with most recently used options. If this fails, please run\nconfigure manually.\nResolving dependencies...\nConfiguring dump-0.2.6...\ncabal: The following package dependencies were requested\n--dependency='interpolatedstring-perl6=interpolatedstring-perl6-0.9.0-806887e26af0b5e9d9f99d13a2b9d08c'\n--dependency='hspec=hspec-2.1.8-4133af4aaac7344a4e3a6a8a90be2cb8'\n--dependency='haskell-src-meta=haskell-src-meta-0.6.0.10-044625c00cdf446dac843874b8e39126'\nhowever the given installed package instance does not exist.\n</code></pre>\n\n<p>I tried to reinstall the sandbox by running</p>\n\n<pre><code>cabal sandbox delete\ncabal sandbox init\ncabal install\n</code></pre>\n\n<p>Which helps not.</p>\n\n<p>Then I noticed the text saying <code>The sandbox was created after the package was already configured.</code> So I try to run</p>\n\n<pre><code>cabal configure\n</code></pre>\n\n<p>After which I get</p>\n\n<pre><code>$ cabal test     \nRe-configuring with test suites enabled. If this fails, please run configure\nmanually.\nResolving dependencies...\nConfiguring dump-0.2.6...\ncabal: At least the following dependencies are missing:\nhspec -any\n</code></pre>\n\n<p>What might be going wrong? What can I do as the next step to try to debug this?</p>\n\n<h3>Versions</h3>\n\n<pre><code>$ echo {cabal,ghc}\" --version;\" | sh\ncabal-install version 1.22.2.0\nusing version 1.22.2.0 of the Cabal library \nThe Glorious Glasgow Haskell Compilation System, version 7.10.1\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "ffi"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1437421256, "post_id": 31524315, "comment_id": 51011082, "body": "Have you looked <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/options-phases.html#forcing-options-through\" rel=\"nofollow noreferrer\">here</a>? optc might be what you are looking for."}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1437421613, "post_id": 31524315, "comment_id": 51011291, "body": "That is exactly what I was looking for.  Thanks!  If you want to move this down into an answer I&#39;d be happy to accept it."}], "answers": [{"comments": [{"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1463846824, "post_id": 31525294, "comment_id": 62243323, "body": "I guess an equivalent way to this would be to have <code>cc-options : -g -O0</code> in the Cabal file?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1463947488, "post_id": 31525294, "comment_id": 62269240, "body": "That&#39;s just another way to pass options to GHC."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 6, "last_activity_date": 1437422364, "creation_date": 1437422364, "answer_id": 31525294, "question_id": 31524315, "link": "https://stackoverflow.com/questions/31524315/haskell-debug-c-function-imported-through-ffi/31525294#31525294", "title": "Haskell: debug C function imported through FFI", "body": "<p>GHC provides an interface to pass options to many internal components, including the C compiler. The option you're looking for is <code>optc</code>. </p>\n\n<p>For example, you could write <code>ghc -optc -g Main</code>.</p>\n\n<p>You can see a list of all similar options <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/options-phases.html#forcing-options-through\">here</a>.</p>\n"}], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 31525294, "answer_count": 1, "score": 3, "last_activity_date": 1437422364, "creation_date": 1437418830, "question_id": 31524315, "link": "https://stackoverflow.com/questions/31524315/haskell-debug-c-function-imported-through-ffi", "title": "Haskell: debug C function imported through FFI", "body": "<p>I am importing some things in Haskell through the FFI, and would like to be able to debug them with lldb.  For example, I might have the following Haskell file (test.hs):</p>\n\n<pre><code>main = do\n   foo\n   return()\n\nforeign import ccall \"foo\" foo :: IO ()\n</code></pre>\n\n<p>And the following C file (ctest.c):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid foo(){\n    printf(\"test\\n\");\n}\n</code></pre>\n\n<p>I can then compile this with <code>ghc test.hs ctest.c</code>.  If I run the executable through LLDB, I can set a breakpoint at <code>foo</code>, however, it gives me only the assembly code, such as:</p>\n\n<pre><code>test`foo: -&gt;  \n0x1000019e0 &lt;+0&gt;: pushq  %rbp\n0x1000019e1 &lt;+1&gt;: movq   %rsp, %rbp\n0x1000019e4 &lt;+4&gt;: subq   $0x10, %rsp\n0x1000019e8 &lt;+8&gt;: leaq   0x33eb31(%rip), %rdi      ; \"test\\n\"\n</code></pre>\n\n<p>Is there a way to tell GHC to compile the C file I am importing through the FFI with <code>-g</code> so that I can get the debugging symbols?  </p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437426422, "post_id": 31524382, "comment_id": 51013939, "body": "Can we all take a moment to admire how wonderfully well-formatted this answer is?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437457129, "post_id": 31524382, "comment_id": 51022699, "body": "@AJFarmar the wonders of markdown ;) (it&#39;s not really hard to do - but thanks)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1437426438, "last_edit_date": 1437426438, "creation_date": 1437419036, "answer_id": 31524382, "question_id": 31524004, "link": "https://stackoverflow.com/questions/31524004/map-lookup-function-with-fold/31524382#31524382", "title": "Map lookup function with fold", "body": "<p>first here is a <em>working</em> version - I'll come back and explain in a few minutes:</p>\n\n<pre><code>lookUp :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v\nlookUp k = foldl (\\ acc (k',v) -&gt; if k == k' then Just v else acc) Nothing            \n</code></pre>\n\n<p>The problems you have are:</p>\n\n<ul>\n<li>for <code>foldl1</code> you have as type <code>foldl1 :: (a -&gt; a -&gt; a) -&gt; [a] -&gt; a</code> so your need the same type for your elements and your result - but here you want the value as result but fold over tuples of key/value-pairs.</li>\n<li>this is why I switched to the more general <code>foldl</code> (note that I am not interested in if this is the right choice here - see <code>foldl'</code> vs <code>foldl</code> vs <code>foldr</code>)</li>\n<li>this function can never be total (if the key is not in the dictionary/key-value-pair-list) so I opted to reflect this in the result type, which is now <code>Maybe v</code> - of course this makes it really easy to find a initial value: <code>Nothing</code></li>\n</ul>\n\n<p>if you don't like the <code>Maybe</code> part you can use <code>error</code> instead like this too:</p>\n\n<pre><code>lookUp :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; v\nlookUp k = foldl (\\ acc (k',v) -&gt; if k == k' then v else acc) (error \"key not found\")\n</code></pre>\n\n<h2>Remarks:</h2>\n\n<p>this is not the most efficient implementation as you will look through all of your list no matter if you found the key yet - feel free to try to come up with something that does </p>\n\n<p><strong>hint</strong>: Haskell is lazy - maybe you can find something by filtering out the right key/value-pairs, taking the safe-head of this and then maping to the value-part ;) )</p>\n"}], "owner": {"reputation": 1040, "user_id": 4031371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/442e7ad304b6b890126c2edc315570e1?s=128&d=identicon&r=PG", "display_name": "Robin", "link": "https://stackoverflow.com/users/4031371/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 697, "favorite_count": 0, "accepted_answer_id": 31524382, "answer_count": 1, "score": 0, "last_activity_date": 1437426438, "creation_date": 1437417776, "question_id": 31524004, "link": "https://stackoverflow.com/questions/31524004/map-lookup-function-with-fold", "title": "Map lookup function with fold", "body": "<p>I would like to create a \"map lookup\" function using folds.</p>\n\n<p>This is my \"map\" (just a list of tuples):</p>\n\n<pre><code>phoneBook:: [([Char], [Char])]\nphoneBook = [(\"bob\", \"00-21-55\")\n            ,(\"jack\", \"55-51-55\")\n            ,(\"joe\", \"10-61-25\")\n            ,(\"susy\", \"06-21-55\")\n            ,(\"clara\", \"50-31-95\")\n            ]\n</code></pre>\n\n<p>And this is the kind of function I would like to write:</p>\n\n<pre><code>lookUp :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; v\nlookUp k = foldl1 (\\acc (x,y) -&gt; if k == y then y else acc)\n</code></pre>\n\n<p>However, this does not compile, it yields a \"cannot construct infinite type\" error.</p>\n\n<p>Could you explain to my why this is wrong and how I can make it work?</p>\n\n<p>Please note that I am aware of Data.Map and the map functions it exports, I want to do it like this solely to learn how folds work.</p>\n"}, {"tags": ["haskell", "higher-rank-types"], "answers": [{"comments": [{"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437453605, "post_id": 31527796, "comment_id": 51021687, "body": "thanks for the tip how to reformat the code, I&#39;ll review it (together with the &quot;back to the basics&quot; approach that I mentioned). However what I don&#39;t fully get is, are the types in the list really different? The <code>forall</code> is exactly an attempt to uniformize the types. All like <code>forall a. record -&gt; a</code> or something of that shape. Maybe using <code>forall</code> on a return type is more problematic? I still don&#39;t get why the <code>RankNTypes</code> approach doesn&#39;t cut it."}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 1, "creation_date": 1437457688, "post_id": 31527796, "comment_id": 51022892, "body": "ah I see it now. It&#39;s what you said &quot;Existential types could work with a wrapper&quot;. That&#39;s just it. So it&#39;s not doable, except with a wrapper, as in <a href=\"https://wiki.haskell.org/Heterogenous_collections#Existential_types\" rel=\"nofollow noreferrer\">wiki.haskell.org/Heterogenous_collections#Existential_types</a> -- I knew that but somehow it didn&#39;t &quot;connect&quot;. Ok so I&#39;ll check your solution tonight and what I had in mind but I see now that just adding <code>forall</code> can&#39;t cut it. I guess the reason why lies in research papers so that&#39;s it I guess."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437481812, "post_id": 31527796, "comment_id": 51037255, "body": "@EmmanuelTouzery I&#39;m not sure doing existential types without wrappers is &quot;really impossible&quot; as much as &quot;not worth the bother to implement when a wrapper makes it much simpler&quot;. On <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Existential_type</a> there&#39;s a link to <a href=\"http://www.cs.uu.nl/groups/ST/Projects/ehc/ehc-book.pdf\" rel=\"nofollow noreferrer\">a Haskell dialect</a> that tries to do it differently."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 1, "last_activity_date": 1437433770, "creation_date": 1437433770, "answer_id": 31527796, "question_id": 31523905, "link": "https://stackoverflow.com/questions/31523905/rankntypes-illegal-polymorphic-or-qualified-type/31527796#31527796", "title": "rankntypes: Illegal polymorphic or qualified type", "body": "<p>I think the basic problem is that you are trying to put values of different types in one list.  Even <code>ImpredicativeTypes</code> doesn't really allow you to do that in the way that you would need.  Existential types could work with a wrapper, but I think they're overkill as well.</p>\n\n<p>Instead, I suggest changing from inserting tuples to inserting something that always is the same type, based on how you were actually going to <em>use</em> the tuples.  Looking at your linked code I see</p>\n\n<pre><code>\\(name, f) -&gt; defPropertyConst name (return . f . entityVal . fromObjRef)\n</code></pre>\n\n<p>as the function you use on your tuples to get what you <em>actually</em> need from them.  So why not define a global function for that?</p>\n\n<pre><code>stdMember name f = defPropertyConst name (return . f . entityVal . fromObjRef)\n</code></pre>\n\n<p>(The name is just a suggestion; you might want something shorter or even an operator.)</p>\n\n<p>Then change <code>getStandardClassMembers</code> to take a list of such values as its first argument, and probably something similar for the second.</p>\n\n<p>Assuming there are no more type subtleties, you should then be able to write</p>\n\n<pre><code>instance DefaultClass (Entity Project) where\n    classMembers = getStandardClassMembers\n        [\n            stdMember \"name\" projectName,\n            stdMember \"hasCustomIcon\" $ text . not . BS.null . projectIcon,\n            stdMember \"hasDev\" projectHasDev, -- TODO bool as string, ugly..\n            stdMember \"hasUat\" projectHasUat,\n            stdMember \"hasStaging\" projectHasStage,\n            stdMember \"hasProd\" projectHasProd\n        ]\n        []\n</code></pre>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 31527796, "answer_count": 1, "score": 2, "last_activity_date": 1437433770, "creation_date": 1437417418, "last_edit_date": 1437423864, "question_id": 31523905, "link": "https://stackoverflow.com/questions/31523905/rankntypes-illegal-polymorphic-or-qualified-type", "title": "rankntypes: Illegal polymorphic or qualified type", "body": "<p>I am trying to expand (or trying to find out whether it's possible to expand) a function with a type signature that already goes to the limits of my knowledge, because of the libraries I'm using which expose quite polymorphic types and APIs, to something even more polymorphic.</p>\n\n<p>I'm using <code>persistent</code> and <code>hsqml</code>, both libraries having pretty hairy types at moments, at least for me.</p>\n\n<p>I need to wrap <code>persistent</code> entities to <code>hsqml</code> \"proxy\" objects to be exposed to <code>QML</code> (javascript basically).\nFor that purpose I made myself a helper, called <code>getStandardClassMembers</code>. You use it like so:</p>\n\n<pre><code>instance DefaultClass (Entity Project) where\n    classMembers = getStandardClassMembers\n        [\n            (\"name\", projectName),\n            (\"hasCustomIcon\", text . not . BS.null . projectIcon),\n            (\"hasDev\", projectHasDev), -- TODO bool as string, ugly..\n            (\"hasUat\", projectHasUat),\n            (\"hasStaging\", projectHasStage),\n            (\"hasProd\", projectHasProd)\n        ]\n        []\n</code></pre>\n\n<p>The definition of <code>getStandardClassMembers</code> is <a href=\"https://github.com/emmanueltouzery/projectpad/blob/e82a359b7cb8b96c400f70f8d45b59ebef4f46e0/src/Model.hs#L114-L125\" rel=\"nofollow\">there</a>. That define a javascript object with the members I specify, and calls the haskell functions I give to implement the members of the JS object.</p>\n\n<p>That's pretty nice but there is a 'but'. The function in the second position in the pair must return <code>Text</code>. Here you see, for all but the first function, I should rather return a <code>Bool</code>. So ideally I would make the type signature of <code>getStandardClassMembers</code> take a type more polymorphic to not require that that second function returns necessarily a <code>Text</code>. And again I simply don't know if it's possible, but I decided to give it a shot.</p>\n\n<p>So I add <code>RankNTypes</code> to the already massive list of language extensions for that file (I'm kind of forced into that due to the libraries I chose, which are otherwise wonderful).</p>\n\n<p>And I change:</p>\n\n<pre><code>getStandardClassMembers :: (Marshal tr, ToBackendKey SqlBackend record, Typeable record,\n     MarshalMode tr ICanReturnTo () ~ Yes) =&gt;\n    [(String, record -&gt; tr)] -&gt; [(String, ObjRef (Entity record) -&gt; Maybe Int)]\n    -&gt; [Member (GetObjType (ObjRef (Entity record)))]\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>getStandardClassMembers :: (Marshal tr, ToBackendKey SqlBackend record, Typeable record,\n     MarshalMode tr ICanReturnTo () ~ Yes) =&gt;\n    [(String, forall tr. record -&gt; tr)] -&gt; [(String, ObjRef (Entity record) -&gt; Maybe Int)]\n    -&gt; [Member (GetObjType (ObjRef (Entity record)))]\n</code></pre>\n\n<p>(so I added <code>forall tr.</code>)\nand I get:</p>\n\n<pre><code>Illegal polymorphic or qualified type: forall tr. record -&gt; tr\nPerhaps you intended to use ImpredicativeTypes\n</code></pre>\n\n<p>Now I know just enough about these things to know that enabling <code>ImpredicativeTypes</code> is not a good idea. Plus if I enable it, it doesn't work either.</p>\n\n<p>Is what I want achievable or should I give it a rest and be thankful anything works at all with those already pretty messy type signatures and language extension collections?</p>\n\n<p><strong>EDIT</strong> probably the right fix is to forget about my helper and go back to the basics using the <code>hsqml</code> basic API. But otherwise I'm still curious whether that would be possible or not.</p>\n"}, {"tags": ["haskell", "command-line-arguments", "applicative", "optparse-applicative"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4112904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cde56e656330f1d5bd872faaf3dea073?s=128&d=identicon&r=PG&f=1", "display_name": "gedenkt", "link": "https://stackoverflow.com/users/4112904/gedenkt"}, "edited": false, "score": 0, "creation_date": 1437467984, "post_id": 31526065, "comment_id": 51028157, "body": "Thanks! I find the behaviour of <code>many</code> really confusing, as I expected it to work more like Parsec ... Does there exist a more Parsec-style command line parser?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 43, "user_id": 4112904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cde56e656330f1d5bd872faaf3dea073?s=128&d=identicon&r=PG&f=1", "display_name": "gedenkt", "link": "https://stackoverflow.com/users/4112904/gedenkt"}, "edited": false, "score": 0, "creation_date": 1437519072, "post_id": 31526065, "comment_id": 51060381, "body": "@gedenkt Not that I&#39;m aware of. Libraries such as <code>optparse-applicative</code> are streamlined and specialised to handle the more usual argument-and-option-passing use cases. BTW, another thing you might try (though I haven&#39;t tested it) is specifying a custom format for your pairs, as in <code>{item1,item2}</code> instead of <code>item1 item2</code>. I believe the FluxCapacitor example in the <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2\" rel=\"nofollow noreferrer\">readme</a> suggests a way to achieve that with <code>optparse-applicative</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1437425272, "creation_date": 1437425272, "answer_id": 31526065, "question_id": 31522814, "link": "https://stackoverflow.com/questions/31522814/optparse-applicative-parsing-list-of-pairs/31526065#31526065", "title": "optparse-applicative: parsing list of pairs", "body": "<p><em>Disclaimer: I have no experience of doing advanced optparse-applicative tricks, so I might be missing something obvious. Readers: please point it out if that's the case.</em></p>\n\n<p>Your problem is that what <code>many</code> does is (in a hand-wavy description) to apply the parser to each chunk of the input, with the chunks in this case consisting of individual arguments, and then collect the results. So <code>many pairParser</code> applies <code>pairParser</code> to <code>[\"one\"]</code> and then to <code>[\"two\"]</code>, and both parses fail. That being so, you might either replace <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.11.0.2/docs/Options-Applicative-Extra.html#v:execParserPure\" rel=\"nofollow\"><code>execParserPure</code></a> with a function that chunks the arguments in an appropriate way and adjust the rest of the program accordingly, or (what I suspect is the easier choice) abandon <code>pairParser</code> and just post-process the parsed arguments, as in:</p>\n\n<pre><code>pairArgs :: [a] -&gt; [(a, a)]\npairArgs = noLeftover . foldr pairNext (Nothing, [])\n    where\n    noLeftover (m, ps) = case m of\n        Nothing -&gt; ps\n        _       -&gt; []\n    pairNext x (m, ps) = case m of\n        Just y  -&gt; (Nothing, (x, y) : ps)\n        Nothing -&gt; (Just x, ps)\n\nmanyPairsParser :: Parser [(String, String)]\nmanyPairsParser = pairArgs &lt;$&gt; many (argument str (metavar \"s1 s2..\"))\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; testParser manyPairsParser []\nJust []\nGHCi&gt; testParser manyPairsParser [\"foo\"]\nJust []\nGHCi&gt; testParser manyPairsParser [\"foo\",\"bar\"]\nJust [(\"foo\",\"bar\")]\nGHCi&gt; testParser manyPairsParser [\"foo\",\"bar\",\"baz\"]\nJust []\nGHCi&gt; testParser manyPairsParser [\"foo\",\"bar\",\"baz\",\"quux\"]\nJust [(\"foo\",\"bar\"),(\"baz\",\"quux\")]\n</code></pre>\n\n<p>(Note that in the demo above I'm handling failure by returning an empty list of pairs, and considering that an odd number of arguments should lead to failure. You'll need to do some adjustments if you want a different behaviour.)</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 9943938, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/d698268327218e86656b826bc7067248?s=128&d=identicon&r=PG", "display_name": "Huw", "link": "https://stackoverflow.com/users/9943938/huw"}, "is_accepted": false, "score": 3, "last_activity_date": 1529013397, "creation_date": 1529013397, "answer_id": 50866490, "question_id": 31522814, "link": "https://stackoverflow.com/questions/31522814/optparse-applicative-parsing-list-of-pairs/50866490#50866490", "title": "optparse-applicative: parsing list of pairs", "body": "<p>Many and some were a bit too eager in older versions of optparse, and would require the whole construct succeed after a single option before permitting further options.</p>\n\n<p>I changed the logic for many and so they are lazier in how they consume options which are over many and some. You can see the changes and logic <a href=\"https://github.com/pcapriotti/optparse-applicative/pull/191\" rel=\"nofollow noreferrer\">here</a> .</p>\n"}], "owner": {"reputation": 43, "user_id": 4112904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cde56e656330f1d5bd872faaf3dea073?s=128&d=identicon&r=PG&f=1", "display_name": "gedenkt", "link": "https://stackoverflow.com/users/4112904/gedenkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 1, "accepted_answer_id": 31526065, "answer_count": 2, "score": 4, "last_activity_date": 1529013397, "creation_date": 1437413642, "last_edit_date": 1481895639, "question_id": 31522814, "link": "https://stackoverflow.com/questions/31522814/optparse-applicative-parsing-list-of-pairs", "title": "optparse-applicative: parsing list of pairs", "body": "<p>I'm trying to parse a list of pairs with optparse-applicative. Parsing a single pair works, but parsing arbitrarily many using the <code>many</code> combinator fails.</p>\n\n<pre><code>import           Options.Applicative\n\npairParser = (,) &lt;$&gt; argument str (metavar \"s1\")\n                 &lt;*&gt; argument str (metavar \"s2\")\n\ntestParser p = getParseResult . execParserPure (prefs idm)\n  (info (helper &lt;*&gt; p) fullDesc)\n\nmain = do\n  print $ testParser pairParser [\"one\", \"two\"]\n  print $ testParser (many pairParser) []\n  print $ testParser (many pairParser) [\"one\", \"two\"]\n  print $ testParser (many pairParser) [\"one\", \"two\", \"three\", \"four\"]\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Just (\"one\",\"two\")   &lt;- good\nJust []              &lt;- still good\nNothing              &lt;- does not work\nNothing              &lt;- also does not work\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437396259, "post_id": 31516829, "comment_id": 50994740, "body": "Could you write the <i>whole</i> error?"}, {"owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437397320, "post_id": 31516829, "comment_id": 50995553, "body": "ok. I have included the complete error message in the post."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1437401541, "creation_date": 1437401541, "answer_id": 31518783, "question_id": 31516829, "link": "https://stackoverflow.com/questions/31516829/how-to-use-extensible-effects-and-io/31518783#31518783", "title": "How to use extensible-effects and IO?", "body": "<p>This works:</p>\n\n<pre><code>runIOLogger :: SetMember Lift (Lift IO) r =&gt; Eff (Log :&gt; r) a -&gt; Eff r a\nrunIOLogger = freeMap\n  return\n  (\\u -&gt; handleRelay u runIOLogger $ \\(Log txt next) -&gt; do\n           lift $ putStrLn txt\n           runIOLogger next)\n</code></pre>\n\n<p>As well as this:</p>\n\n<pre><code>runIOLogger :: SetMember Lift (Lift IO) r =&gt; Eff (Log :&gt; r) a -&gt; Eff r a\nrunIOLogger = loop\n   where\n     loop :: SetMember Lift (Lift IO) r =&gt; Eff (Log :&gt; r) a -&gt; Eff r a\n     loop = freeMap\n       return\n       (\\u -&gt; handleRelay u loop \n              $ \\(Log txt next) -&gt; \n                  lift (putStrLn txt)  &gt;&gt;  --  Could not deduce ...    :(\n                  loop next)\n</code></pre>\n\n<p>GHC <a href=\"https://en.wikipedia.org/wiki/Polymorphic_recursion\" rel=\"nofollow\">can't infer</a> polymorphic types for recursive bindings, instead it first infers a type with the assumption that the recursively bound variable is monomorphic, then generalizes the resulting type. This means that type inference only fails if we use different instantiations of a recursive binding. For example, this fails to check:</p>\n\n<pre><code>id' a = fst (a, id' (a, a))\n</code></pre>\n\n<p>But this is fine:</p>\n\n<pre><code>id' :: a -&gt; a\nid' a = fst (a, id' (a, a))\n</code></pre>\n\n<p>I'm pretty sure something like this is the issue here, although I haven't made the effort to find out exactly where does inference grind to a halt. </p>\n"}], "owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 1, "accepted_answer_id": 31518783, "answer_count": 1, "score": 3, "last_activity_date": 1437401541, "creation_date": 1437396132, "last_edit_date": 1437397069, "question_id": 31516829, "link": "https://stackoverflow.com/questions/31516829/how-to-use-extensible-effects-and-io", "title": "How to use extensible-effects and IO?", "body": "<p>I'm trying to rewrite the examples from the <a href=\"https://ocharles.org.uk/blog/posts/2013-12-04-24-days-of-hackage-extensible-effects.html\" rel=\"nofollow\">article</a> to the new version of the package <a href=\"http://hackage.haskell.org/package/extensible-effects\" rel=\"nofollow\">extensible-effects</a> 1.11.0.0, but I get \"Could not deduce ...\" when I try to use the lift for IO monad     :(</p>\n\n<p>ghc 7.10.1</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, ScopedTypeVariables, TypeOperators #-}\n{-# LANGUAGE DeriveFunctor, DeriveDataTypeable #-}\nmodule Main where\n\nimport Data.Typeable\nimport Control.Eff\nimport Control.Eff.Lift\n\ndata Log v = Log String v deriving (Functor, Typeable)\n\nlog' :: Member Log r =&gt; String -&gt; Eff r ()\nlog' txt = send . inj $ Log txt ()\n\nverboseAddition :: Member Log r =&gt; Eff r Int\nverboseAddition = do\n   log' \"I'm starting with 1...\"\n   x &lt;- return 1\n\n   log' \"and I'm adding 2...\"\n   y &lt;- return 2\n\n   let r = x + y\n\n   log' $ \"Looks like the result is \" ++ show r\n   return r\n\nrunLogger :: Eff (Log :&gt; r) a -&gt; Eff r ([String],a)\nrunLogger = loop\n   where \n     prefixLogWith txt (l,v) = (txt:l, v)\n     loop = freeMap\n       (\\x -&gt; return ([], x))\n       (\\u -&gt; handleRelay u loop\n              $ \\(Log txt next) -&gt; fmap (prefixLogWith txt) (loop next))\n\nrunIOLogger :: SetMember Lift (Lift IO) r =&gt; Eff (Log :&gt; r) a -&gt; Eff r a\nrunIOLogger = loop\n   where\n     loop = freeMap\n       return\n       (\\u -&gt; handleRelay u loop \n              $ \\(Log txt next) -&gt; \n                  lift (putStrLn txt)  &gt;&gt;  --  Could not deduce ...    :(\n                  loop next)\n\nmain:: IO ()\nmain = --    print $ run $ runLogger verboseAddition -- ok\n       runLift (runIOLogger verboseAddition) &gt;&gt;= print \n</code></pre>\n\n<blockquote>\n<pre><code>Could not deduce (extensible-effects-1.11.0.0:Data.OpenUnion.Internal.Base.M emberUImpl\n                    extensible-effects-1.11.0.0:Data.OpenUnion.Internal.Open Union2.OU2\n                    Lift\n                    (Lift IO)\n                    r)\n  arising from a use of `lift'\nfrom the context (SetMember Lift (Lift IO) r)\n  bound by the type signature for\n             runIOLogger :: SetMember Lift (Lift IO) r =&gt;\n                            Eff (Log :&gt; r) a -&gt; Eff r a\n  at src\\Main.hs:37:16-72\nIn the first argument of `(&gt;&gt;)', namely `lift (putStrLn txt)'\nIn the expression: lift (putStrLn txt) &gt;&gt; loop next\nIn the second argument of `($)', namely\n  `\\ (Log txt next) -&gt; lift (putStrLn txt) &gt;&gt; loop next'\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell", "ghc-generics"], "answers": [{"comments": [{"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437472133, "post_id": 31519008, "comment_id": 51030859, "body": "@AJFarmar I will, but there&#39;s a delay (3 days?) before you can accept your own answer. I can&#39;t accept this one until tomorrow."}], "tags": [], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "is_accepted": true, "score": 2, "last_activity_date": 1437402194, "creation_date": 1437402194, "answer_id": 31519008, "question_id": 31515955, "link": "https://stackoverflow.com/questions/31515955/adding-a-show-constraint-when-using-ghc-generics/31519008#31519008", "title": "Adding a Show constraint when using GHC.Generics", "body": "<p>D'oh! I should have used <code>show (fmap to a)</code> instead of <code>show a</code>.Then all I needed was to add <code>Show g</code> as a constraint.. This simple change compiles fine:</p>\n\n<pre><code>  default get :: (Generic g, GGenetic (Rep g), Show g)\n                =&gt; Reader (Either [String] g)\n  get = do\n    (_, start, _) &lt;- S.get\n    a &lt;- gget\n    (xs, stop, trace) &lt;- S.get\n    let result = fmap to a\n    let msg = show start ++ ':' : show stop ++ ' ' : show result\n    S.put (xs, stop, msg:trace)\n    return result\n</code></pre>\n"}], "owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 3, "accepted_answer_id": 31519008, "answer_count": 1, "score": 1, "last_activity_date": 1440127486, "creation_date": 1437393588, "last_edit_date": 1440127486, "question_id": 31515955, "link": "https://stackoverflow.com/questions/31515955/adding-a-show-constraint-when-using-ghc-generics", "title": "Adding a Show constraint when using GHC.Generics", "body": "<p>I am using GHC Generics. My use case is almost identical to <a href=\"https://wiki.haskell.org/GHC.Generics#Complete_working_example\" rel=\"nofollow\">the example in the wiki</a>, except that I am encoding and decoding gene sequences. </p>\n\n<p>This was all working fine, until I decided to keep a list of what I'd already read, so that I could report it to the user in case of an error. That means that I need to add a <code>Show</code> constraint to my default <code>get</code> implementation. The problem is that I can't figure out how to write the constraint. See the <code>-- HELP!!!</code> comment in the code below.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport Control.Monad.State.Lazy (StateT)\nimport qualified Control.Monad.State.Lazy as S (put, get, gets)\nimport Data.Functor.Identity (Identity)\nimport Data.Word (Word8, Word16)\nimport GHC.Generics\n\ntype Sequence = [Word8]\n\ntype Writer = StateT Sequence Identity\n\ntype Reader = StateT (Sequence, Int, [String]) Identity\n\nclass Genetic g where\n  -- | Writes a gene to a sequence.\n  put :: g -&gt; Writer ()\n\n  default put :: (Generic g, GGenetic (Rep g)) =&gt; g -&gt; Writer ()\n  put = gput . from\n\n  -- | Reads the next gene in a sequence.\n  get :: Reader (Either [String] g)\n\n  default get :: (Generic g, GGenetic (Rep g), Show (Rep g x???)) -- HELP!!!\n    =&gt; Reader (Either [String] g)\n  get = do\n    (_, start, _) &lt;- S.get\n    a &lt;- gget\n    (xs, stop, trace) &lt;- S.get\n    let msg = show start ++ ':' : show stop ++ ' ' : show a\n    S.put (xs, stop, msg:trace)\n    return $ fmap to a\n\nclass GGenetic f where\n  gput :: f a -&gt; Writer ()\n  gget :: Reader (Either [String] (f a))\n</code></pre>\n"}, {"tags": ["haskell", "image-processing", "video-processing", "friday"], "answers": [{"tags": [], "owner": {"reputation": 2971, "user_id": 2156909, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5dd8c24a242eb09bb69de8149ff0360a?s=128&d=identicon&r=PG", "display_name": "P.R.", "link": "https://stackoverflow.com/users/2156909/p-r"}, "is_accepted": false, "score": 7, "last_activity_date": 1437387427, "creation_date": 1437387427, "answer_id": 31513943, "question_id": 31513588, "link": "https://stackoverflow.com/questions/31513588/break-video-into-images-for-processing/31513943#31513943", "title": "Break video into images for processing", "body": "<p>I do not know whether such a library exists, but I suspect not. Video codecs are pretty complicated. If something for haskell exists, it would most likely be an <code>ffmpeg</code> wrapper. Anyway, I would use the <code>ffmpeg</code> command line tool directly if you only need to extract the frames from some videos. Or use a system call to do it dynamically.</p>\n\n<p>The ffmpeg command is pretty simple for this task:</p>\n\n<pre><code>ffmpeg -i \"input.mov\" -an -f image2 \"output_%05d.jpg\"\n</code></pre>\n\n<p><a href=\"https://en.wikibooks.org/wiki/FFMPEG_An_Intermediate_Guide/image_sequence\">https://en.wikibooks.org/wiki/FFMPEG_An_Intermediate_Guide/image_sequence</a></p>\n"}, {"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1437507089, "post_id": 31541148, "comment_id": 51054569, "body": "Nice thnx. I will take a look"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1437697077, "post_id": 31541148, "comment_id": 51151878, "body": "@fakedrake I made a juicypixels to friday conversion library (<a href=\"https://github.com/TomMD/friday-juicypixels\" rel=\"nofollow noreferrer\">github.com/TomMD/friday-juicypixels</a>) and it works beautifully with ffmpeg-light.  Thanks for the motivation."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1437911765, "post_id": 31541148, "comment_id": 51219901, "body": "Wow you are awesome! So how would you make a lazy list of friday images from a video with ffmpeg in haskell?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1437924435, "post_id": 31541148, "comment_id": 51223824, "body": "@fakedrake see my edit, it&#39;s just an application of unsafeInterleaveIO"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1437987428, "post_id": 31541148, "comment_id": 51243252, "body": "This was probably the answer on stackoverflow that taught me the most so far. Thank you"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1437924411, "last_edit_date": 1437924411, "creation_date": 1437486899, "answer_id": 31541148, "question_id": 31513588, "link": "https://stackoverflow.com/questions/31513588/break-video-into-images-for-processing/31541148#31541148", "title": "Break video into images for processing", "body": "<p>Notice there are some slick <a href=\"http://hackage.haskell.org/package/ffmpeg-light\" rel=\"nofollow\">ffmpeg bindings</a> that stream images from a video in the JuicyPixel image types.  There is already a <a href=\"https://github.com/RaphaelJ/friday/issues/12\" rel=\"nofollow\">ticket</a> for making <code>friday</code> and <code>JuicyPixels</code> play nice - if you are actually interested in getting this done in a clean manner I highly recommend you make a patch to friday addressing this ticket.</p>\n\n<p>Also, since the friday maintainer is busy till September, I'd be happy to merge an of your changes with mine on <a href=\"https://github.com/TomMD/friday\" rel=\"nofollow\">my own repository</a> for general use.</p>\n\n<p>EDIT: This is fun.  A way to get a lazy list of images is with <code>unsafeInterleaveIO</code>:</p>\n\n<pre><code>module LazyDemo where\n\nimport Vision.Image.JuicyPixels\nimport Vision.Image (RGBA)\nimport Codec.FFmpeg\nimport System.IO.Unsafe\n\nlazyStream :: FilePath -&gt; IO [RGBA]\nlazyStream fp = do\n    initFFmpeg\n    (rd,close) &lt;- imageReader fp\n    go rd close\n  where\n   go rd close = do\n       mi &lt;- rd\n       case mi of\n           Nothing -&gt; close &gt;&gt; return []\n           Just i  -&gt; (toFridayRGBA i : ) &lt;$&gt; unsafeInterleaveIO (go rd close)\n</code></pre>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 4, "accepted_answer_id": 31541148, "answer_count": 2, "score": 3, "last_activity_date": 1454718542, "creation_date": 1437386346, "last_edit_date": 1454718542, "question_id": 31513588, "link": "https://stackoverflow.com/questions/31513588/break-video-into-images-for-processing", "title": "Break video into images for processing", "body": "<p>I have recently found <a href=\"https://github.com/RaphaelJ/friday\" rel=\"nofollow\">friday</a>, a image processing library for haskell and it seems pretty nice so far, but I would like to be able to load videos and break them up into images. Is there such a library available for haskell?</p>\n"}, {"tags": ["haskell", "reform", "digestive-functors"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441895766, "post_id": 31508704, "comment_id": 52868923, "body": "Stop using CAPTCHA. It&#39;s terrible for accessibility. That will solve your problem."}, {"owner": {"reputation": 23, "user_id": 5133592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4686b4a91103bc911226121ae56cc?s=128&d=identicon&r=PG", "display_name": "Daniel Collins", "link": "https://stackoverflow.com/users/5133592/daniel-collins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441938635, "post_id": 31508704, "comment_id": 52887757, "body": "You are right, but can you suggest an alternative?"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 5133592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4686b4a91103bc911226121ae56cc?s=128&d=identicon&r=PG", "display_name": "Daniel Collins", "link": "https://stackoverflow.com/users/5133592/daniel-collins"}, "is_accepted": true, "score": 0, "last_activity_date": 1441882842, "creation_date": 1441882842, "answer_id": 32500063, "question_id": 31508704, "link": "https://stackoverflow.com/questions/31508704/how-can-i-clear-or-set-values-in-a-digestive-functors-view/32500063#32500063", "title": "how can I clear or set values in a digestive-functors view", "body": "<p>I repeated the question on the bug tracker where someone eventually came up with a <a href=\"https://github.com/jaspervdj/digestive-functors/issues/121\" rel=\"nofollow\">working hack</a>. The view value turns out the be a record. You can mutate its viewInput field before rendering it. viewInput is an association list from paths to forms.</p>\n"}], "owner": {"reputation": 23, "user_id": 5133592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4686b4a91103bc911226121ae56cc?s=128&d=identicon&r=PG", "display_name": "Daniel Collins", "link": "https://stackoverflow.com/users/5133592/daniel-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 32500063, "answer_count": 1, "score": 1, "last_activity_date": 1441882842, "creation_date": 1437365196, "question_id": 31508704, "link": "https://stackoverflow.com/questions/31508704/how-can-i-clear-or-set-values-in-a-digestive-functors-view", "title": "how can I clear or set values in a digestive-functors view", "body": "<p>I have used <code>postForm</code> from <code>Text.Digestive</code> in <code>digestive-functions</code> which returns something like a <code>(Just view, Nothing)</code> in the case of a form error. I can then take the view and render it to HTML to display the form errors. </p>\n\n<p>My issue is that I do not want <em>every</em> field to be rendered as given by the user. Specifically, my captcha value should be reset to a newly computed one rather than reusing the old one (which would give an infinite number of captcha attempts). But I do not know how to compute a new view with one field cleared/set, given the old view.</p>\n\n<p>Alternatively, does anyone know if this would be easier with reform? I haven't looked at it much yet but it seems nice that it does away with the string-based-programming part of digestive-functors.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 2, "creation_date": 1437347859, "post_id": 31506920, "comment_id": 50976573, "body": "It seems that Haskell is a language in constant flux, adding extensions one after another to cope with &quot;strange&quot; behaviors. I hope many of these extensions will eventually be absorbed as defaults of the language."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1437348002, "post_id": 31506920, "comment_id": 50976612, "body": "@mljrg We can only hope. It&#39;s rather silly when you have extensions that makes your code shorter - but by less than it takes to write the language pragma to enable them. The standards committee has been rather dead for a while, but I hear there are efforts to revive the process."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1437348066, "post_id": 31506920, "comment_id": 50976627, "body": "Does that mean Haskell risks dying?!"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1437348169, "post_id": 31506920, "comment_id": 50976656, "body": "@mljrg Haskell as an <i>implementation</i> (GHC) is fine. But the implementation keeps getting further and further ahead of the written standard (currently Haskell 2010, which was a lot behind GHC even when it was written.)"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1437348292, "post_id": 31506920, "comment_id": 50976681, "body": "So everything that is in GHC but not in Haskell Report 2010 is an extension in GHC, is that so?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 3, "creation_date": 1437348500, "post_id": 31506920, "comment_id": 50976713, "body": "@mljrg For language features, that&#39;s mostly the case. Although they separated the language itself from the library once H2010 was finished, and there&#39;s a separate committee for changing the libraries, which is in fact doing a <i>lot</i> recently - the monad/applicative proposal and foldable/traversable proposal you may have heard of (they made big changes in GHC 7.10) came from that."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1437455412, "post_id": 31506920, "comment_id": 51022179, "body": "By the way, this behavior is not specific to record fields. You can also define an ordinary top-level value whose name conflicts with an imported identifier, and then you must use a qualified name to refer to either identifier. Useful if you want to export the new value under a name that conflicts with something you imported."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1437347614, "creation_date": 1437347614, "answer_id": 31506920, "question_id": 31506856, "link": "https://stackoverflow.com/questions/31506856/strange-haskell-behavior-misplaced-error-in-record-syntax/31506920#31506920", "title": "Strange Haskell behavior: misplaced error in record syntax?", "body": "<p>It is not an error to define the record field even if it gives a name clash with something imported from another module.  After all, you can still use it by <em>explicitly</em> prefixing the current module name:</p>\n\n<pre><code>var2 = TypeX {\n       val = \"oranges\"\n     , Main.id = 2              -- no more error\n     }\n</code></pre>\n\n<p>There's also a language extension <code>DisambiguateRecordFields</code> which makes GHC slightly smarter about the field names in record notation, and allows your code as originally written. (But it still won't allow you to define the same field name for two different types in the <em>same</em> module.)</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 31506920, "answer_count": 1, "score": 2, "last_activity_date": 1437376498, "creation_date": 1437347078, "last_edit_date": 1437376498, "question_id": 31506856, "link": "https://stackoverflow.com/questions/31506856/strange-haskell-behavior-misplaced-error-in-record-syntax", "title": "Strange Haskell behavior: misplaced error in record syntax?", "body": "<p>Given the following code, why does Haskell only report an error when it reaches the second <code>id</code>?</p>\n\n<pre><code>data TypeX = TypeX {\n         id :: Int        -- why not the error here?\n       , val :: String\n       } deriving (Show)\nvar1 = TypeX 1 \"bananas\"\nvar2 = TypeX {\n       val = \"oranges\"\n     , id = 2              -- why an error here?\n     }\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>ghci&gt; :l TypeX.lhs\n[1 of 1] Compiling Main             ( TypeX.lhs, interpreted )\n\nTypeX.lhs:8:13:\nAmbiguous occurrence \u2018id\u2019\nIt could refer to either \u2018Main.id\u2019, defined at TypeX.lhs:2:15\n                      or \u2018Prelude.id\u2019,\n                         imported from \u2018Prelude\u2019 at TypeX.lhs:1:1\n                         (and originally defined in \u2018GHC.Base\u2019)\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1437349432, "post_id": 31507095, "comment_id": 50976906, "body": "I could take apart what <code>fresh</code>, <code>mlabel</code> and <code>return</code> are doing here, but I think you&#39;ll learn more about the ST monad by figuring that out yourself. (i.e. I don&#39;t want to prematurely over-explain.)"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437376072, "post_id": 31507095, "comment_id": 50983154, "body": "&#39;mlabel l&#39; gives us state transformer that takes State as input and produces (Leaf (x, oldState), NewState) right? If so, then how can we use bind for &#39;mlabel r&#39; after that? Shouldn&#39;t function that we bind after &#39;&#39;mlabel l&#39; have type Leaf (Char, State) -&gt; ST b?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 1, "creation_date": 1437378639, "post_id": 31507095, "comment_id": 50984474, "body": "@user1685095 because ST is an instance of Monad: in <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>, <code>m</code> can be replaced with <code>ST</code>. So <code>ST a</code> can go on the left side of <code>&gt;=</code>. And that is the type of <code>mlabel r</code> too."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 1, "creation_date": 1437379882, "post_id": 31507095, "comment_id": 50985043, "body": "@user1685095 <code>Leaf (Char, State) -&gt; ST b</code> is not a type, because <code>Leaf</code> is a <i>data</i> constructor. <code>mlabel (l :: Tree a) :: ST (Tree (a,Int)) ~~ State -&gt; ( Tree (a,Int), State)</code>. <code>l&#39;</code> has type <code>Tree (a,Int)</code> but <code>l</code> has type <code>Tree a</code>, as does <code>r</code>. Notice that the second bind is <i>nested</i> inside the first bind&#39;s target function. The value in <code>l&#39;</code> is put aside, and the second bind is performed, with the second target function, <i>inside the scope</i> where <code>l&#39;</code> is accessible still, so <code>return</code> can use both <code>r&#39;</code> and <code>l&#39;</code>."}], "tags": [], "owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "is_accepted": false, "score": 5, "last_activity_date": 1437357471, "last_edit_date": 1437357471, "creation_date": 1437349276, "answer_id": 31507095, "question_id": 31506839, "link": "https://stackoverflow.com/questions/31506839/how-does-this-state-monad-code-works/31507095#31507095", "title": "How does this State monad code works?", "body": "<p>The key thing to realise is that <code>do</code> notation gets translated into <code>Monad</code> functions, so </p>\n\n<pre><code>do n &lt;- fresh\n   return (Leaf (x,n))\n</code></pre>\n\n<p>is short for</p>\n\n<pre><code>fresh &gt;&gt;= (\\n -&gt; \n           return (Leaf (x,n))  )\n</code></pre>\n\n<p>and </p>\n\n<pre><code>do l' &lt;- mlabel l\n   r' &lt;- mlabel r\n   return (Node l' r')\n</code></pre>\n\n<p>is short for </p>\n\n<pre><code>mlabel l &gt;&gt;= (\\l' -&gt; \n              mlabel r &gt;&gt;= (\\r' -&gt;\n                            return (Node l' r') ))\n</code></pre>\n\n<p>This will hopefully allow you to continue figuring out the code's meaning, but for more help, you should read up on the <code>do</code> notation for Monads.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1437350526, "post_id": 31507176, "comment_id": 50977095, "body": "<i>&quot;will&quot;</i> is absolutely the key word to understanding monads, I think."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 8, "last_activity_date": 1437350001, "creation_date": 1437350001, "answer_id": 31507176, "question_id": 31506839, "link": "https://stackoverflow.com/questions/31506839/how-does-this-state-monad-code-works/31507176#31507176", "title": "How does this State monad code works?", "body": "<blockquote>\n  <p>Specifically do n &lt;- fresh. We haven't passed any argument to fresh, right?</p>\n</blockquote>\n\n<p>Exactly. We are writing for an argument that <em>will</em> be passed to <code>fresh</code> when we, for instance, do something like <code>apply (mlabel someTree) 5</code>. A nice exercise that will help you to see more clearly what is going on is first writing <code>mlabel</code> with explicit <code>(&gt;&gt;=)</code> instead of do-notation, and then replacing <code>(&gt;&gt;=)</code> and <code>return</code> with what the <code>Monad</code> instance says that they are.</p>\n"}, {"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437674793, "post_id": 31507302, "comment_id": 51141624, "body": "Is my understading correct that  mlabel l &gt;&gt;= (\\l&#39; -&gt;                mlabel r &gt;&gt;= (\\r&#39; -&gt;                             return (Node l&#39; r&#39;) ))   gives curried functions? And this code could&#39;ve been written as you&#39;ve written it? mlabel l, state &gt;&gt;= \\l&#39; ... etc?"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437675039, "post_id": 31507302, "comment_id": 51141799, "body": "I understand what monads do essentially. I think I&#39;m just not very comfortable with reading code that is written with curried functions. Functional code that you&#39;ve wrote is basically the same code without currying, right?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437685839, "post_id": 31507302, "comment_id": 51147930, "body": "<code>mlabel l &gt;&gt;= f == S (\\s -&gt; let (x,s&#39;) = apply (mlabel l) s in apply (f x) s&#39;)</code>. so it&#39;s a function of one argument <code>s</code>. I don&#39;t know what you mean by &quot;curried&quot; there. It&#39;s a function. In Haskell <code>g x y = ...</code> is the same as <code>g x = \\y -&gt; ...</code>. Both are <i>definitions</i>. These <i>equations</i> do not &quot;create&quot; new objects in memory as they are encountered - the whole program is compiled. And because of lazyness, we can analyze/transform the program by equational reasoning. And compilers are allowed to do so, to."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437685843, "post_id": 31507302, "comment_id": 51147934, "body": "there&#39;s no <code>mlabel l, state &gt;&gt;= \\l&#39;</code>; rather, the function under <code>S</code> gets applied to a state, <code>apply (S f) s = f s</code>, so since <code>mlabel l &gt;&gt;= f = S \\s-&gt; ...</code>, there will be eventual application of <code>\\s-&gt; ...</code> to a state argument. Haskell&#39;s functions are curried, <code>f x y = ...</code> meaning that <code>f x</code> is a function, which gets applied <b><i>perhaps later</i></b> to <code>y</code>. So the function defined by <code>mlabel l</code> will be applied to some initial state, at some point. In your program, <code>label t = ...</code> does that."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437685855, "post_id": 31507302, "comment_id": 51147937, "body": "you really should try to write it all out, as AndrewC suggested, patiently, step by step. ping me if you have troubles with this, and I&#39;ll add it into the answer."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437686618, "post_id": 31507302, "comment_id": 51148292, "body": "f x = x + 1 is a normal function, right? f = \\x + 1 is a curried function?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1437686912, "post_id": 31507302, "comment_id": 51148426, "body": "no, both are  the same. (you meant, <code>f = \\x -&gt; x + 1</code> I presume)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475897943, "post_id": 31507302, "comment_id": 67140060, "body": "<code>Applicative</code> is essential, rather than merely convenient, because of <code>traverse</code>, certain <code>replicateM</code>-like functions, and possibly some other things. What makes <code>Monad</code> essential? <code>MMorph</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1475924933, "post_id": 31507302, "comment_id": 67145552, "body": "<code>join [replicate 5 x | x &lt;- xs] = [ y | x &lt;- xs, y &lt;- replicate 5 x] = xs &lt;* [(),(),(),(),()]</code> is <i>essentially</i> Applicative, <code>[ y | x &lt;- xs, y &lt;- replicate x x] = ?</code> is <i>essentially</i> Monadic. <i>Essentially</i> monadic is a computation that can&#39;t be constructed ahead of time. If we see Functors as computations / programs, Applicative is like a program that can be compiled ahead of time and <i>then</i> run; for Monadic programs the compiler (interpreter) must be present at their run time. So if we can&#39;t do without bind, it&#39;s Monadic. Something like that?"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1475877382, "last_edit_date": 1475877382, "creation_date": 1437351243, "answer_id": 31507302, "question_id": 31506839, "link": "https://stackoverflow.com/questions/31506839/how-does-this-state-monad-code-works/31507302#31507302", "title": "How does this State monad code works?", "body": "<p>With the monadic \"pipelining\" inlined, your code becomes </p>\n\n<pre><code>fresh state = (state, state + 1)\n\nmlabel (Leaf x) state =                   --  do\n  let (n, state') = fresh state           --    n &lt;- fresh\n  in  (Leaf (x,n), state')                --    return (Leaf (x,n))\n\nmlabel (Node l r) state =                 -- do\n  let (l', state') = mlabel l state       --    l' &lt;- mlabel l\n  in let (r', state'') = mlabel r state'  --    r' &lt;- mlabel r\n     in  (Node l' r', state'')            --    return (Node l' r') \n\nmain = let (result, state') = mlabel tree 0  \n       in  print result                         \n\n{- Or with arrows,\n\nmlabel (Leaf x)   = Leaf . (x ,)  &amp;&amp;&amp;  (+ 1)\nmlabel (Node l r) = mlabel l &gt;&gt;&gt; second (mlabel r)\n                              &gt;&gt;&gt; (\\(a,(b,c)) -&gt; (Node a b,c))\nmain              = mlabel tree &gt;&gt;&gt; fst &gt;&gt;&gt; print  $ 0\n-}\n</code></pre>\n\n<p>Or in an imperative pseudocode:</p>\n\n<pre><code>def state = unassigned\n\ndef fresh ():\n    tmp = state \n    state := state + 1     -- `fresh` alters the global var `state`\n    return tmp             -- each time it is called\n\ndef mlabel (Leaf x):       -- a language with pattern matching\n    n = fresh ()           -- global `state` is altered!\n    return (Leaf (x,n))  \n\ndef mlabel (Node l r):\n    l' = mlabel l          -- affects the global\n    r' = mlabel r          --    assignable variable\n    return (Node l' r')    --    `state`\n\ndef main:\n    state := 0             -- set to 0 before the calculation!\n    result = mlabel tree\n    print result\n</code></pre>\n\n<p>Calculating the <code>result</code> changes the <code>state</code> assignable; it corresponds to the <code>snd</code> field in Haskell's <code>(a, State)</code> tuple. And the <code>fst</code> field of the tuple is the newly constructed tree, carrying a numbering alongside its data in its leaves.</p>\n\n<p>These variants are functionally equivalent.</p>\n\n<p>Perhaps you've heard the catch-phrase about monadic bind being a <em>\"programmable semicolon\"</em>. Here the meaning of it is clear: it defines the \"function call protocol\" so to speak, that we use the first returned value as a calculated result, and the second returned value as the updated state, which we pass along to the next calculation, so it gets to see the <em>updated</em> state. </p>\n\n<p>This is the <em>state-passing</em> style of programming (essential for e.g. Prolog), making the state change explicit but having to <em>manually</em> take care of passing along the correct, updated state. Monads allow us to abstract this \"wiring\" of state passing from one calculation to the next, so it is done automatically for us, at the price of having to think in imperative style, and having this state become hidden, implicit again (like the state change is implicit in the imperative programming, which we wanted to eschew in the first place when switching to the functional programming...).</p>\n\n<p>So all that the State monad is doing is to maintain for us this hidden state, and passing it along updated between the consecutive calculations. So it's nothing <em>major</em> after all.</p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 1, "accepted_answer_id": 31507302, "answer_count": 3, "score": 4, "last_activity_date": 1477693315, "creation_date": 1437346912, "last_edit_date": 1477693315, "question_id": 31506839, "link": "https://stackoverflow.com/questions/31506839/how-does-this-state-monad-code-works", "title": "How does this State monad code works?", "body": "<p>This code is from this <a href=\"http://www.cs.nott.ac.uk/~gmh/monads\" rel=\"nofollow\">article</a></p>\n\n<p>I've been able to follow it until this part.</p>\n\n<pre><code>module Test where\n\ntype State = Int\n\ndata ST a = S (State -&gt; (a, State))\n\napply        :: ST a -&gt; State -&gt; (a,State)\napply (S f) x = f x\n\nfresh =  S (\\n -&gt; (n, n+1))\n\ninstance Monad ST where\n    -- return :: a -&gt; ST a\n    return x   = S (\\s -&gt; (x,s))\n\n    -- (&gt;&gt;=)  :: ST a -&gt; (a -&gt; ST b) -&gt; ST b\n    st &gt;&gt;= f   = S (\\s -&gt; let (x,s') = apply st s in apply (f x) s')\n\ndata Tree a = Leaf a | Node (Tree a) (Tree a) deriving (Show)\n\n\nmlabel  :: Tree a -&gt; ST (Tree (a,Int))\n-- THIS IS THE PART I DON'T UNDERSTAND:\nmlabel (Leaf x) = do n &lt;- fresh\n                     return (Leaf (x,n))\nmlabel (Node l r) =  do l' &lt;- mlabel l\n                        r' &lt;- mlabel r\n                        return (Node l' r')\n\nlabel t = fst (apply (mlabel t) 0)\n\ntree = Node (Node (Leaf 'a') (Leaf 'b')) (Leaf 'c')\n</code></pre>\n\n<p>And <code>label tree</code> produces:</p>\n\n<pre><code>Node (Node (Leaf ('a',0)) (Leaf ('b',1))) (Leaf ('c',2))\n</code></pre>\n\n<p>I can see that <code>&gt;&gt;=</code> operator is the tool to 'chain' functions that return monads (or something like that).</p>\n\n<p>And while I think I understand this code, I don't understand how this particular code works.</p>\n\n<p>Specifically <code>do n &lt;- fresh</code>. We haven't passed any argument to fresh, right? What does <code>n &lt;- fresh</code> produces in that case? Absolutely don't understand that. Maybe it has something to do with currying? </p>\n"}, {"tags": ["c", "haskell", "opencl"], "comments": [{"owner": {"reputation": 9332, "user_id": 3100482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w3Q8i.jpg?s=128&g=1", "display_name": "jprice", "link": "https://stackoverflow.com/users/3100482/jprice"}, "edited": false, "score": 0, "creation_date": 1437341385, "post_id": 31506059, "comment_id": 50975085, "body": "What happens if you use <code>Int32</code> instead of <code>Int</code> in your host code?"}, {"owner": {"reputation": 23, "user_id": 5133104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd78a00a4693de166d2da8350efa913?s=128&d=identicon&r=PG&f=1", "display_name": "CHersh", "link": "https://stackoverflow.com/users/5133104/chersh"}, "reply_to_user": {"reputation": 9332, "user_id": 3100482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w3Q8i.jpg?s=128&g=1", "display_name": "jprice", "link": "https://stackoverflow.com/users/3100482/jprice"}, "edited": false, "score": 0, "creation_date": 1437342912, "post_id": 31506059, "comment_id": 50975524, "body": "Wow, I would never have thought the issue was the binary data being sent to the kernel. Changing it to be a 32 bit int seemed to fix that issue, thank you"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 9332, "user_id": 3100482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w3Q8i.jpg?s=128&g=1", "display_name": "jprice", "link": "https://stackoverflow.com/users/3100482/jprice"}, "edited": false, "score": 0, "creation_date": 1437345376, "post_id": 31506059, "comment_id": 50976074, "body": "@jprice You should post that as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1437373773, "post_id": 31507004, "comment_id": 50982227, "body": "You should use <code>CInt</code> for this purpose, it&#39;s the type which is guaranteed to be compatible (via Storable) with the C <code>int</code> type."}], "tags": [], "owner": {"reputation": 9332, "user_id": 3100482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w3Q8i.jpg?s=128&g=1", "display_name": "jprice", "link": "https://stackoverflow.com/users/3100482/jprice"}, "is_accepted": true, "score": 2, "last_activity_date": 1437348460, "creation_date": 1437348460, "answer_id": 31507004, "question_id": 31506059, "link": "https://stackoverflow.com/questions/31506059/opencl-in-haskell-only-processing-some-elements-of-the-input-array/31507004#31507004", "title": "OpenCL in Haskell only processing some elements of the input array", "body": "<p>You need to ensure that the data layout of the buffers in your host code matches what the device expects. This can be achieved in your example code by using <code>Int32</code> instead of <code>Int</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3393, "user_id": 214143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61025b3df4700620a5d9099293f23a5d?s=128&d=identicon&r=PG", "display_name": "Jason Aller", "link": "https://stackoverflow.com/users/214143/jason-aller"}, "edited": false, "score": 0, "creation_date": 1548463114, "post_id": 54374271, "comment_id": 95563501, "body": "When providing an answer to an older question with existing answers it is useful to explain how your answer differs. What are the benefits of using long over cint?"}, {"owner": {"reputation": 1, "user_id": 10969894, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7dSkqnjzh4s/AAAAAAAAAAI/AAAAAAAAAFY/tek3rNUl4cE/photo.jpg?sz=128", "display_name": "Arno", "link": "https://stackoverflow.com/users/10969894/arno"}, "reply_to_user": {"reputation": 3393, "user_id": 214143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61025b3df4700620a5d9099293f23a5d?s=128&d=identicon&r=PG", "display_name": "Jason Aller", "link": "https://stackoverflow.com/users/214143/jason-aller"}, "edited": false, "score": 0, "creation_date": 1548601207, "post_id": 54374271, "comment_id": 95590853, "body": "Thank you Jason Aller, sloppy me... &#39;cint&#39; did not work in my version of the code. So I tried &#39;long&#39;. That did work, so it&#39;s more of an extra option. (Maybe I should ask the question why &#39;cint&#39; didn&#39;t work in my situation?)"}], "tags": [], "owner": {"reputation": 1, "user_id": 10969894, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7dSkqnjzh4s/AAAAAAAAAAI/AAAAAAAAAFY/tek3rNUl4cE/photo.jpg?sz=128", "display_name": "Arno", "link": "https://stackoverflow.com/users/10969894/arno"}, "is_accepted": false, "score": 0, "last_activity_date": 1548468169, "last_edit_date": 1548468169, "creation_date": 1548459995, "answer_id": 54374271, "question_id": 31506059, "link": "https://stackoverflow.com/questions/31506059/opencl-in-haskell-only-processing-some-elements-of-the-input-array/54374271#54374271", "title": "OpenCL in Haskell only processing some elements of the input array", "body": "<p>Using <code>long</code> worked for me:</p>\n\n<p><code>__kernel void duparray(__global long *in, __global long *out )</code></p>\n"}], "owner": {"reputation": 23, "user_id": 5133104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd78a00a4693de166d2da8350efa913?s=128&d=identicon&r=PG&f=1", "display_name": "CHersh", "link": "https://stackoverflow.com/users/5133104/chersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 31507004, "answer_count": 2, "score": 2, "last_activity_date": 1548468169, "creation_date": 1437340960, "last_edit_date": 1437344792, "question_id": 31506059, "link": "https://stackoverflow.com/questions/31506059/opencl-in-haskell-only-processing-some-elements-of-the-input-array", "title": "OpenCL in Haskell only processing some elements of the input array", "body": "<p>So I'm trying to use <code>OpenCL</code> in Haskell, but it seems it's only processing half of the list I give it, placing a 0 between each element then only processing the first <code>n</code> elements, ie: list I give it:<code>[1,2,3,4,5,6]</code> the list it sees: <code>[1,0,2,0,3,0]</code>. I'm using the <code>OpenCL</code> package from <code>cabal</code> and <code>AMD</code>'s <code>OpenCL library version 2.9-1.</code></p>\n\n<p>OpenCL Kernel code (C):</p>\n\n<pre><code>int power(int a, int n, int mod)\n{\n    int power = a;\n    int result = 1;\n\n    while (n)\n    {\n        if (n &amp; 1)\n            result = (result * power) % mod;\n        power = (power * power) % mod;\n        n &gt;&gt;= 1;\n    }\n    return result;\n}\n\nbool witness(int n, int s, int d, int a)\n{\n    int x = power(a, d, n);\n    int y;\n\n    while (s) {\n        y = (x * x) % n;\n        if (y == 1 &amp;&amp; x != 1 &amp;&amp; x != n - 1)\n            return 0;\n        x = y;\n        --s;\n    }\n    if (y != 1)\n        return 0;\n    return 1;\n}\n\nint is_prime_mr(int n)\n{\n    if (((!(n &amp; 1)) &amp;&amp; n != 2) || (n &lt; 2) || (n % 3 == 0 &amp;&amp; n != 3))\n        return 0;\n    if (n &lt;= 3)\n        return 1;\n\n    int d = n / 2;\n    int s = 1;\n    while (!(d &amp; 1)) {\n        d /= 2;\n        ++s;\n    }\n\n    if (n &lt; 1373653)\n        return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 3);\n    if (n &lt; 9080191)\n        return witness(n, s, d, 31) &amp;&amp; witness(n, s, d, 73);\n    if (n &lt; 4759123141)\n        return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 7) &amp;&amp; witness(n, s, d, 61);\n    if (n &lt; 1122004669633)\n        return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 13) &amp;&amp; witness(n, s, d, 23) &amp;&amp; witness(n, s, d, 1662803);\n    if (n &lt; 2152302898747)\n        return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 3) &amp;&amp; witness(n, s, d, 5) &amp;&amp; witness(n, s, d, 7) &amp;&amp; witness(n, s, d, 11);\n    if (n &lt; 3474749660383)\n        return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 3) &amp;&amp; witness(n, s, d, 5) &amp;&amp; witness(n, s, d, 7) &amp;&amp; witness(n, s, d, 11) &amp;&amp; witness(n, s, d, 13);\n    return witness(n, s, d, 2) &amp;&amp; witness(n, s, d, 3) &amp;&amp; witness(n, s, d, 5) &amp;&amp; witness(n, s, d, 7) &amp;&amp; witness(n, s, d, 11) &amp;&amp; witness(n, s, d, 13) &amp;&amp; witness(n, s, d, 17);\n}\n\n__kernel void duparray(__global int *in, __global int *out )\n{\n    int id = get_global_id(0);\n\n    if(id == 1)\n    {\n        int i = 0;\n        for(i = 0; i &lt;= 200; i++)\n        {\n            printf(\"%d\\t\", in[i]);\n        }\n    }\n\n    //printf(\"%d :: %d\\t\\t\",id, in[id]*2);\n    out[id] = (is_prime_mr(in[id]) == 0) ? 0 : in[id];\n    //out[id] = in[id];\n}\n</code></pre>\n\n<p>Haskell code:</p>\n\n<pre><code>import Control.Parallel.OpenCL\nimport Foreign( castPtr, nullPtr, sizeOf )\nimport Foreign.C.Types( CFloat )\nimport Foreign.Marshal.Array( newArray, peekArray )\nimport System.IO\n\nupper = 200\nlower = 0\n\nmain :: IO ()\nmain = do\n  -- Initialize OpenCL\n  (platform:_) &lt;- clGetPlatformIDs\n  (dev:_) &lt;- clGetDeviceIDs platform CL_DEVICE_TYPE_ALL\n  context &lt;- clCreateContext [CL_CONTEXT_PLATFORM platform] [dev] print\n  q &lt;- clCreateCommandQueue context dev []\n\n\n  handle &lt;- openFile \"gpuPrimalityTest.c\" ReadMode\n  programSource &lt;- hGetContents handle\n\n  -- Initialize Kernel\n  program &lt;- clCreateProgramWithSource context (programSource)\n  clBuildProgram program [dev] \"\"\n  kernel &lt;- clCreateKernel program \"duparray\"\n\n  -- Initialize parameters\n  let original = [lower .. upper] :: [Int]\n      elemSize = sizeOf (0 :: Int)\n      vecSize = elemSize * length original\n  -- putStrLn $ \"Original array = \" ++ show original\n  input  &lt;- newArray original\n\n  mem_in &lt;- clCreateBuffer context [CL_MEM_READ_ONLY, CL_MEM_COPY_HOST_PTR] (vecSize, castPtr input)  \n  mem_out &lt;- clCreateBuffer context [CL_MEM_WRITE_ONLY] (vecSize, nullPtr)\n\n  clSetKernelArgSto kernel 0 mem_in\n  clSetKernelArgSto kernel 1 mem_out\n\n  -- Execute Kernel\n  eventExec &lt;- clEnqueueNDRangeKernel q kernel [length original] [] []\n\n  -- Get Result\n  eventRead &lt;- clEnqueueReadBuffer q mem_out True 0 vecSize (castPtr input) [eventExec]\n\n  result &lt;- peekArray (length original) input\n  putStrLn $ \"Result array = \" ++ show (filter (\\x -&gt; x/=0) result)\n\n  return ()\n</code></pre>\n\n<p>For the Haskell code I'm using a modified version of the first example in the Github for the OpenCL package I'm using: <a href=\"https://github.com/IFCA/opencl\" rel=\"nofollow\">https://github.com/IFCA/opencl</a></p>\n\n<p>And I also kept the traces I had in the OpenCL kernel. Those 2 <code>printf</code>'s are how I was attempting to debug this. </p>\n\n<p>Any help is appreciated</p>\n\n<p>Edit: It seems to work when I use <code>32</code> bit ints</p>\n"}, {"tags": ["haskell", "type-inference", "literals", "ghci"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1437331751, "post_id": 31503707, "comment_id": 50972249, "body": "Remember that the space is the function application operator."}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1437328311, "post_id": 31504005, "comment_id": 50971094, "body": "Good answer. Also, If you want to typecheck in <code>ghci</code>, it can be made by enabling <code>FlexibleContexts</code> contexts extension. <code>let x = 1 &quot;one&quot;</code> and <code>:t x</code> will show you the same type in <code>ghci</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437334088, "post_id": 31504005, "comment_id": 50973019, "body": "I don&#39;t think the question is assuming that <code>FlexibleContexts</code> GHC extension is enabled. The type <code>: t (1 &quot;one&quot;)</code> works without enabling that extension which is not an consistent behavior of ghci IMO."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437337179, "post_id": 31504005, "comment_id": 50973955, "body": "@Sibi Indeed. Still, the error without the <code>:t</code> changes if you don&#39;t enable <code>FlexibleContexts</code>."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1437343757, "post_id": 31504005, "comment_id": 50975714, "body": "I did not enable <code>FlexibleContexts</code>. Also, seems strange why are numbers wrapped in functions, and why doesn&#39;t GHC give an error like &quot;Expected [Char] -&gt; t got Num at line ...&quot; which would be much much more clear?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1437344518, "post_id": 31504005, "comment_id": 50975895, "body": "@mljrg This <code>FlexibleContexts</code> difference probably only applies to GHC 7.10 and later; a new restriction in 7.10 is that a type signature won&#39;t be inferred unless all the extensions are enabled that would be needed to write it explicitly."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1437344735, "post_id": 31504005, "comment_id": 50975944, "body": "@mljrg As for the question, the issue is that <code>Num</code>  is not a type, but a type class. In principle, <code>[Char] -&gt; t</code> might be made an instance of <code>Num</code>, even though in practice it doesn&#39;t make sense. In your case, the &quot;no instance...&quot; error (i.e. the type is not an instance, when it should be) is the closest equivalent to the &quot;expected...&quot; one (i.e. the type is not what it should be)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 10, "last_activity_date": 1437346062, "last_edit_date": 1437346062, "creation_date": 1437327381, "answer_id": 31504005, "question_id": 31503707, "link": "https://stackoverflow.com/questions/31503707/strange-haskell-expression-with-type-num-char-t-t/31504005#31504005", "title": "Strange Haskell expression with type Num ([Char] -&gt; t) =&gt; t", "body": "<p>Haskell Report to the rescue! (Quoting <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1360006.4.1\" rel=\"noreferrer\">section 6.4.1</a>)</p>\n\n<blockquote>\n  <p>An integer literal represents the application of the function <code>fromInteger</code> to the appropriate value of type Integer.</p>\n</blockquote>\n\n<p><code>fromInteger</code> has type:</p>\n\n<pre><code>Prelude&gt; :t fromInteger\nfromInteger :: Num a =&gt; Integer -&gt; a\n</code></pre>\n\n<p>So <code>1</code> is actually syntax sugar for <code>fromInteger (1 :: Integer)</code>. Your expression, then, is:</p>\n\n<pre><code>fromInteger 1 \"one\"\n</code></pre>\n\n<p>Which could be written as:</p>\n\n<pre><code>(fromInteger 1) \"one\"\n</code></pre>\n\n<p>Now, <code>fromInteger</code> produces a number (that is, a value of a type which is an instance of <code>Num</code>, as its type tells us). In your expression, this number is applied to a <code>[Char]</code> (the string <code>\"one\"</code>). GHC correctly combines these two pieces of information to deduce that your expression has type:</p>\n\n<pre><code>Num ([Char] -&gt; t) =&gt; t\n</code></pre>\n\n<p>That is, it would be the result (of unspecified type <code>t</code>) of applying a function which is also a <code>Num</code> to a <code>[Char]</code>. That is a valid type in principle. The only problem is that there is no instance of <code>Num</code> for <code>[Char] -&gt; t</code> (that is, functions that take strings are not numbers, which is not surprising).</p>\n\n<p>P.S.: As Sibi and \u00d8rjan point out, in GHC 7.10 and later you will only see the error mentioned in the question if the <code>FlexibleContexts</code> GHC extension is enabled; otherwise the type checker will instead complain about having fixed types and type constructors in the class constraint (that is, <code>Char</code>, <code>[]</code> and <code>(-&gt;)</code>). </p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437344315, "post_id": 31504172, "comment_id": 50975842, "body": "It&#39;s certainly <i>not</i> a &#39;garbled nonsense type&#39;. Why do you say that in your tl;dr?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437406968, "post_id": 31504172, "comment_id": 51002643, "body": "Do you regard the type as being useful and meaningful?"}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1441650998, "post_id": 31504172, "comment_id": 52752236, "body": "@NovaDenizen Yes! For example, see my answer here - <a href=\"http://stackoverflow.com/questions/32443925/haskell-weird-expression/32444024#32444024\" title=\"haskell weird expression\">stackoverflow.com/questions/32443925/haskell-weird-expressio&zwnj;&#8203;n/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1437328412, "creation_date": 1437328412, "answer_id": 31504172, "question_id": 31503707, "link": "https://stackoverflow.com/questions/31503707/strange-haskell-expression-with-type-num-char-t-t/31504172#31504172", "title": "Strange Haskell expression with type Num ([Char] -&gt; t) =&gt; t", "body": "<p>TL;DR:  It's a garbled nonsense type that isn't worth getting worried over.</p>\n\n<p>Integer literals can represent values of any type that implements the <code>Num</code> typeclass.  So <code>1</code> or any other integer literal can be used anywhere you need a number.</p>\n\n<pre><code>doubleVal :: Double\ndoubleVal = 1\n\nintVal :: Int\nintVal = 1\n\nintegerVal :: Integer\nintegerVal = 1\n</code></pre>\n\n<p>This enables us to flexibly use integral literals in any numeric context.  </p>\n\n<p>When you just use an integer literal without any type context, ghci doesn't know what type it is.</p>\n\n<pre><code>Prelude&gt; :type 1\n1 :: Num a =&gt; a\n</code></pre>\n\n<p>ghci is saying \"that '1' is of some type I don't know, but I do know that whatever type it is, that type implements the <code>Num</code> typeclass\".</p>\n\n<p>Every occurrence of an integer literal in Haskell source is wrapped with an implicit <code>fromInteger</code> function.  So <code>(1 \"one\")</code> is implicitly converted to <code>((fromInteger (1::Integer)) \"one\")</code>, and the subexpression <code>(fromInteger (1::Integer))</code> has an as-yet unknown type <code>Num a =&gt; a</code>, again meaning it's some unknown type, but we know it provides an instance of the <code>Num</code> typeclass.  </p>\n\n<p>We can also see that it is applied like a function to <code>\"one\"</code>, so we know that its type must have the form <code>[Char] -&gt; a0</code> where <code>a0</code> is yet another unknown type.  So <code>a</code> and <code>[Char] -&gt; a0</code> must be the same.  Substituting that back into the <code>Num a =&gt; a</code> type we figured out above, we know that <code>1</code> must have type <code>Num ([Char] -&gt; a0) =&gt; [Char] -&gt; a0)</code>, and the expression <code>(1 \"one\")</code> has type <code>Num ([Char] -&gt; a0) =&gt; a0</code>.  Read that last type as \"There is some type a0 which is the result of applying a <code>[Char]</code> argument to a function, and that function type is an instance of the <code>Num</code> class.</p>\n\n<p>So the expression itself has a valid type <code>Num ([Char] -&gt; a0) =&gt; a0</code>.</p>\n\n<p>Haskell has something called the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">Monomorphism restriction</a>.  One aspect of this is that all type variables in expressions have to have a specific, known type before you can evaluate them.  GHC uses type defaulting rules in certain situations when it can, to accomodate the monomorphism restriction.  However, GHC doesn't know of any type <code>a0</code> it can plug into the type expression above that has a <code>Num</code> instance defined.  So it has no way to deal with it, and gives you the \"No Instance for Num...\" message.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1437370139, "last_edit_date": 1437370139, "creation_date": 1437366662, "answer_id": 31508875, "question_id": 31503707, "link": "https://stackoverflow.com/questions/31503707/strange-haskell-expression-with-type-num-char-t-t/31508875#31508875", "title": "Strange Haskell expression with type Num ([Char] -&gt; t) =&gt; t", "body": "<p>Haskell is a very flexible language, but also a very <em>logical</em> one in a rather literal sense.  So often, things that in most languages would just be syntax errors, Haskell will look at them and try its darnedest to make sense of them, with results that are really confusing but are really just the logical consequence of the rules of the language.</p>\n\n<p>For example, if we type your example into Python, it basically tells us \"what you just typed in makes zero sense\":</p>\n\n<pre><code>Python 2.7.6 (default, Sep  9 2014, 15:04:36) \n[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; (1 \"one\")\n  File \"&lt;stdin&gt;\", line 1\n    (1 \"one\")\n           ^\nSyntaxError: invalid syntax\n</code></pre>\n\n<p>Ruby does the same thing:</p>\n\n<pre><code>irb(main):001:0&gt; (1 \"one\")\nSyntaxError: (irb):1: syntax error, unexpected tSTRING_BEG, expecting ')'\n(1 \"one\")\n    ^\n    from /usr/bin/irb:12:in `&lt;main&gt;'\n</code></pre>\n\n<p>But Haskell doesn't give up that easily!  It sees <code>(1 \"one\")</code>, and it reasons that:</p>\n\n<ul>\n<li>Expressions of the form <code>f x</code> are <em>function applications</em>, where <code>f</code> has type like <code>a -&gt; b</code>, <code>x</code> has type <code>a</code> and <code>f x</code> has type <code>b</code>.</li>\n<li>So in the expression <code>1 \"one\"</code>, <code>1</code> must be a function that takes <code>\"one\"</code> (a <code>[Char]</code>) as its argument.</li>\n</ul>\n\n<p>Then given Haskell's treatment of numeric literals, it translates the <code>1</code> into <code>fromInteger 1 :: Num b =&gt; [Char] -&gt; b</code>.  <code>fromInteger</code> is a method of the <code>Num</code> class, meaning that the user is allowed to supply their own implementations of it for any type\u2014including <code>[Char] -&gt; b</code> if you are so inclined.</p>\n\n<p>So the error message means that Haskell, instead of telling you that what you typed is nonsense, tells you that you haven't taught it how to construct a number of type <code>Num b =&gt; [Char] -&gt; b</code>, because that's the really strange thing that would need to be true for the expression to make sense.</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "accepted_answer_id": 31504005, "answer_count": 3, "score": 10, "last_activity_date": 1437370139, "creation_date": 1437325509, "last_edit_date": 1437329775, "question_id": 31503707, "link": "https://stackoverflow.com/questions/31503707/strange-haskell-expression-with-type-num-char-t-t", "title": "Strange Haskell expression with type Num ([Char] -&gt; t) =&gt; t", "body": "<p>While doing some exercises in GHCi I typed and got the following></p>\n\n<pre><code>ghci&gt; (1 \"one\")\n\n&lt;interactive&gt;:187:1:\n  No instance for (Num ([Char] -&gt; a0)) arising from a use of \u2018it\u2019\n  In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>which is an error, howeve if I ask GHCi for the type of the expression it does not give any error:</p>\n\n<pre><code>ghci&gt; :type (1 \"one\")\n(1 \"one\") :: Num ([Char] -&gt; t) =&gt; t\n</code></pre>\n\n<p>What is the meaning of <code>(1 \"one\")</code>?</p>\n\n<p>Why does this expression gives an error, but GHCi tells it is well typed?</p>\n\n<p>What is the meaning of <code>Num ([Char] -&gt; t) =&gt; t</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-lens"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 6, "creation_date": 1437317666, "post_id": 31502356, "comment_id": 50967688, "body": "GHC 7.4.1 is pretty old. You will have a better luck with having recent version of GHC. Also you may want to try <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow noreferrer\">Stack</a> which is more easier."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1437321479, "post_id": 31502356, "comment_id": 50968913, "body": "Looks like you&#39;re being hit by interactions between an old GHC and the lack of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/safe-haskell.html\" rel=\"nofollow noreferrer\">Safe Haskell</a> annotations (in the library) that are redundant with newer GHC versions. Cf. <a href=\"https://github.com/ekmett/ersatz/issues/13\" rel=\"nofollow noreferrer\">github.com/ekmett/ersatz/issues/13</a> ."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1456440446, "post_id": 31502356, "comment_id": 58961423, "body": "@duplode as your commment seems spot on, you should post it as an answer to the question."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1517908753, "creation_date": 1517908753, "answer_id": 48639403, "question_id": 31502356, "link": "https://stackoverflow.com/questions/31502356/how-to-fix-cabal-installation-error/48639403#48639403", "title": "How to fix cabal installation error", "body": "<p>Posting the correct answer from comments as community-wiki:</p>\n\n<blockquote>\n  <p>Looks like you're being hit by interactions between an old GHC and the\n  lack of Safe Haskell annotations (in the library) that are redundant\n  with newer GHC versions. Cf. <a href=\"http://github.com/ekmett/ersatz/issues/13\" rel=\"nofollow noreferrer\">http://github.com/ekmett/ersatz/issues/13</a></p>\n</blockquote>\n"}], "owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 48639403, "answer_count": 1, "score": 3, "last_activity_date": 1517908753, "creation_date": 1437316742, "question_id": 31502356, "link": "https://stackoverflow.com/questions/31502356/how-to-fix-cabal-installation-error", "title": "How to fix cabal installation error", "body": "<p>I'm getting the following error when trying to install the contravariant library (which is needed for lens) with Cabal:</p>\n\n<p>``src/Data/Functor/Contravariant.hs:96:1:\n    StateVar-1.1.0.0:Data.StateVar can't be safely imported! The module itself isn't safe.''</p>\n\n<p>I've not had any success googling solutions, and tried a few fixes (such as getting rid of all my Haskell packages (with ``rm -r ~/.ghc'') and starting again), but I'm not really clear on what's causing this error to occur. I'm using ghc 7.4.1 - could that be the problem?</p>\n\n<p>Thanks,</p>\n\n<p>Reuben</p>\n"}, {"tags": ["haskell", "types", "ghc", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1437313064, "post_id": 31501459, "comment_id": 50966342, "body": "It would be nice if you&#39;d present error messages in some other way. Screenshots from a Windows console, seriously..."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437315703, "post_id": 31501459, "comment_id": 50967113, "body": "It doesn&#39;t realize you&#39;re trying to use <code>goal</code> from the same instance."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437318853, "post_id": 31501459, "comment_id": 50968051, "body": "@leftaroundabout Copying and pasting from the Windows console is pretty annoying, I can understand preferring to take a screenshot."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1437319591, "post_id": 31501459, "comment_id": 50968311, "body": "@&#216;rjan Johansen well, it can&#39;t be more annoying than copying and pasting from <i>a Windows-console screenshot</i>! Question is, why use the Windows console in the first place? Apart from switching to a better OS entirely, there&#39;s also the option of WinGHCi."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437320245, "post_id": 31501459, "comment_id": 50968509, "body": "@leftaroundabout Well you have a point, I&#39;d forgotten how annoying screenshots also are. I thought you could just paste them into SO posts but apparently not. And I use WinGHCi myself, but it has its bugs, and my impression is the GHC docs recommend the console."}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1437340416, "post_id": 31501459, "comment_id": 50974861, "body": "What could be more annoying? Typing out that to text editor and having no computer of your own."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437344465, "post_id": 31501459, "comment_id": 50975887, "body": "The biggest problem with screenshots is that there&#39;s no guarantee that the image will always be hosted and available. Please copy and paste!"}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1437345229, "post_id": 31501459, "comment_id": 50976052, "body": "Screen shot is just additional information. It&#39;s already described in the question."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1437313535, "last_edit_date": 1437313535, "creation_date": 1437312349, "answer_id": 31501698, "question_id": 31501459, "link": "https://stackoverflow.com/questions/31501459/could-not-deduce-from-the-context/31501698#31501698", "title": "Could not deduce from the context", "body": "<p>The hint is right there in the error message:</p>\n\n<blockquote>\n  <p>\u00a0 \u00a0 \u00a0 \u00a0N.B.: \u2018State\u2019 is a type function, and may not be injective</p>\n</blockquote>\n\n<p>What this means: an <a href=\"https://en.wikipedia.org/wiki/Injective_function\">injective function</a> <em>f</em> is a function where from <em>f</em>(<em>x</em>) = <em>f</em>(<em>y</em>) it follows that <em>x</em> = <em>y</em>. Now, we're talking type-level here, so if <code>State</code> were injective, it would follow from <code>State p ~ State q</code> that <code>p ~ q</code>.</p>\n\n<p>In <code>s == goal</code>, the compiler knows it needs to unify <code>goal</code> with <code>s</code> (because <code>==</code> always compares values of the same type), so there we have it:</p>\n\n<pre><code>s :: State p\ngoal :: State q\nState p ~ State q\n</code></pre>\n\n<p>but because <code>State</code> is <em>not</em> injective, the compiler can't infer that <code>p ~ q</code>, i.e. that we're only talking about a single instance of the type class.</p>\n\n<p>Why not? Well, you could come up with:</p>\n\n<pre><code>instance Problem Int where\n  type State Int = Bool\n  goal = True\n\ninstance Problem Double where\n  type State Double = Bool\n  goal = False\n</code></pre>\n\n<p>Now we have <code>State Int ~ State Double</code>. Yet obviously <code>Int</code> and <code>Double</code> aren't the same type, and they define <code>goal</code> in contradictory ways.</p>\n\n<hr>\n\n<p>&ldquo;How to fix this&rdquo; &ndash; well, you need to redesign the class.</p>\n\n<ul>\n<li><p>You can use</p>\n\n<pre><code>class Problem p where \n  data State p :: * \n</code></pre>\n\n<p>In this case, <code>State</code> <em>is</em> injective, because every instantiation needs to be hard-baked into a single <code>instance Problem</code>.</p></li>\n<li><p>If you need the ability to define the actual <code>State</code> types elsewhere, you need to give the compiler an explicit hint which <code>p</code> should be used for <code>goal</code>. The usual solution are proxies or &ndash; preferrable IMO &ndash; <a href=\"http://hackage.haskell.org/package/tagged-0.8.1/docs/Data-Tagged.html\">tagged</a> values:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Tagged\n\nclass Problem p where \n  type State p :: * \n\n  goal :: Eq (State p) =&gt; Tagged p (State p)\n  goal = Tagged undefined\n\n  isGoal :: Eq (State p) =&gt; Tagged p (State p) -&gt; Bool \n  isGoal = isGoalDef\n\nisGoalDef :: forall p . Eq (State p) =&gt; Tagged p (State p) -&gt; Bool \nisGoalDef (Tagged s) = s == g\n    where (Tagged g) = goal :: Tagged p (State p)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 31501698, "answer_count": 1, "score": 0, "last_activity_date": 1437483141, "creation_date": 1437310568, "last_edit_date": 1437483141, "question_id": 31501459, "link": "https://stackoverflow.com/questions/31501459/could-not-deduce-from-the-context", "title": "Could not deduce from the context", "body": "<p>I have this type class. But it cannot deduce that type returned from <code>goal</code> equals <code>isGoal</code>'s first variable's type. How to fix this?</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\nclass Problem p where \n    type State p :: * \n    data Action p :: * \n\n    goal :: Eq (State p) =&gt; State p \n    goal = undefined \n\n    isGoal :: Eq (State p) =&gt; State p -&gt; Bool \n    isGoal s = s == goal \n</code></pre>\n\n<p><strong>Ended up doing this</strong></p>\n\n<pre><code>class Problem p where \n    type State p :: * \n    data Action p :: * \n\n    goal :: p -&gt; State p \n    goal = undefined \n\n    isGoal :: Eq (State p) =&gt; p -&gt; State p -&gt; Bool \n    isGoal p s = s == goal p\n</code></pre>\n"}, {"tags": ["haskell", "blaze-html"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1437291172, "post_id": 31498651, "comment_id": 50961293, "body": "They are of different types. <code>mconcat . intersperse &quot; &quot;</code> together are <code>unwords</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1437344561, "post_id": 31498651, "comment_id": 50975908, "body": "@n.m. Or just <code>concat . Intersperse &quot; &quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 3930256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6nGb.png?s=128&g=1", "display_name": "Berkson", "link": "https://stackoverflow.com/users/3930256/berkson"}, "edited": false, "score": 0, "creation_date": 1437289719, "post_id": 31498778, "comment_id": 50961044, "body": "I&#39;m using <code>{-# LANGUAGE OverloadedStrings #-}</code> and I still can&#39;t use unwords.  I mean, it&#39;s working fine using <code>intersperse &quot; &quot;</code> but I feel that there has to be a way to write it otherwise."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1437289318, "creation_date": 1437289318, "answer_id": 31498778, "question_id": 31498651, "link": "https://stackoverflow.com/questions/31498651/cant-intersperse-and-unwords-be-used-as-drop-in-replacements-for-each-other/31498778#31498778", "title": "Can&#39;t intersperse &quot; &quot; and unwords be used as drop in replacements for each other?", "body": "<p>What you have will work if you use <code>LANGUAGE OverloadedStrings</code>.</p>\n\n<p>Otherwise, use <code>intersperse (text \" \")</code> instead of <code>intersperse \" \"</code>.</p>\n\n<p>E.g.:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Text.Blaze.Html\nimport Text.Blaze.Renderer.String\nimport Data.Maybe\nimport Data.List\nimport Data.Monoid\n\nfoo links = renderHtml $ mconcat $ intersperse \" \" $ catMaybes links\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 1576064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47c868b652ffdc287498a8c604a30013?s=128&d=identicon&r=PG", "display_name": "Lubom&#237;r Sedl&#225;\u0159", "link": "https://stackoverflow.com/users/1576064/lubom%c3%adr-sedl%c3%a1%c5%99"}, "is_accepted": true, "score": 9, "last_activity_date": 1437297136, "last_edit_date": 1437297136, "creation_date": 1437292528, "answer_id": 31499110, "question_id": 31498651, "link": "https://stackoverflow.com/questions/31498651/cant-intersperse-and-unwords-be-used-as-drop-in-replacements-for-each-other/31499110#31499110", "title": "Can&#39;t intersperse &quot; &quot; and unwords be used as drop in replacements for each other?", "body": "<p>The <code>unwords :: [String] -&gt; String</code> function only works on lists of <code>String</code>s. What you have is a list of values of type <code>MarkupM ()</code>.</p>\n\n<p>The reason why <code>intersperse :: a -&gt; [a] -&gt; [a]</code> works is that it works of list on any type. With <code>OverloadedStrings</code> pragma the <code>\" \"</code> value has type <code>MarkupM</code> (because that type has an instance for <code>IsString</code>). The <code>intersperse</code> function takes a list of these markup values and puts spaces in between them but still returns a list of markup values. Finally <code>mconcat</code> joins the list into a single value still of type <code>MarkupM ()</code>. With some pseudo data constructor you can imagine the values like this:</p>\n\n<pre><code>[Markup \"foo\", Markup \"bar\", Markup \"baz\"] -- returned by catMaybes links\n[Markup \"foo\", Markup \" \", Markup \"bar\", Markup \" \", Markup \"baz\"] -- after intersperse\nMarkup \"foo bar baz\" -- after mconcat\n</code></pre>\n\n<p>There is no easy way to get <code>unwords</code> to work in this case as you don't have strings and converting to strings would lose you some benefits. Having the markup encapsulated in appropriate wrapper makes sure that you do not produce not well-formed HTML, for example.</p>\n"}], "owner": {"reputation": 65, "user_id": 3930256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6nGb.png?s=128&g=1", "display_name": "Berkson", "link": "https://stackoverflow.com/users/3930256/berkson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 31499110, "answer_count": 2, "score": 4, "last_activity_date": 1440772649, "creation_date": 1437287975, "last_edit_date": 1440772649, "question_id": 31498651, "link": "https://stackoverflow.com/questions/31498651/cant-intersperse-and-unwords-be-used-as-drop-in-replacements-for-each-other", "title": "Can&#39;t intersperse &quot; &quot; and unwords be used as drop in replacements for each other?", "body": "<p>I was trying to rewrite:</p>\n\n<pre><code>return $ renderHtml $ mconcat $ intersperse \" \" $ catMaybes links\n</code></pre>\n\n<p>Which works just fine, into:</p>\n\n<pre><code>return $ renderHtml $ mconcat $ unwords $ catMaybes links\n</code></pre>\n\n<p>but it is returning:</p>\n\n<pre><code>Couldn't match type \u2018Char\u2019\n               with \u2018blaze-markup-0.7.0.2:Text.Blaze.Internal.MarkupM ()\u2019\nExpected type: H.Html\n  Actual type: Char\nIn the second argument of \u2018($)\u2019, namely\n  \u2018mconcat $ unwords $ catMaybes links\u2019\nIn the second argument of \u2018($)\u2019, namely\n  \u2018renderHtml $ mconcat $ unwords $ catMaybes links\u2019\nIn a stmt of a 'do' block:\n  return $ renderHtml $ mconcat $ unwords $ catMaybes links\n</code></pre>\n\n<p>I'm not the greatest with Haskell yet, but I thought <code>intersperse \" \"</code> and <code>unwords</code> where just drop in replacements for one another?</p>\n\n<p><strong>Edit</strong>:  Ultimately, I'd like to figure out a way to use <code>unwords</code>... Figuring out why it's giving me the error and how I can work around it is the goal! =)</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "edited": false, "score": 4, "creation_date": 1437273658, "post_id": 31497468, "comment_id": 50958445, "body": "Lists must contain all the same type. If you want multiple types, that&#39;s what tuples are for. Tuples also keep the length fixed, which may be important sometimes. Lists don&#39;t."}, {"owner": {"reputation": 426, "user_id": 4143053, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/366b4d4da4bc196bf332c2f69264556f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Behan", "link": "https://stackoverflow.com/users/4143053/kevin-behan"}, "reply_to_user": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "edited": false, "score": 0, "creation_date": 1437273735, "post_id": 31497468, "comment_id": 50958456, "body": "That&#39;s not entirely true, or maybe I&#39;m misunderstanding you, because you can pass a list a group of tuples, so in a sense a list can accept multiple types."}, {"owner": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "edited": false, "score": 3, "creation_date": 1437274382, "post_id": 31497468, "comment_id": 50958551, "body": "Each element of the list will be a tuple. Each of those tuples will contain the same number and types of elements."}, {"owner": {"reputation": 426, "user_id": 4143053, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/366b4d4da4bc196bf332c2f69264556f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Behan", "link": "https://stackoverflow.com/users/4143053/kevin-behan"}, "reply_to_user": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "edited": false, "score": 0, "creation_date": 1437280385, "post_id": 31497468, "comment_id": 50959522, "body": "Of course, my thought is that logic, to an extent, defeats the purpose of a tuple-- I could be wrong. I think that lists are sufficient enough to create that same kind of functionality, maybe they aren&#39;t."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1437280712, "post_id": 31497468, "comment_id": 50959575, "body": "Tuples are fixed length but can mix types. Lists have arbitrary length but only contain elements of a single type."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1437294452, "post_id": 31497468, "comment_id": 50961938, "body": "many untyped counterparts to staticay typed constructs are &quot;sufficient enough&quot; for the same functionality, even Assembly is, so that argument is a tautology and doesn&#39;t suggest you should use untyped or less typed constructs if you&#39;ve chosen a language that builds heavily on its static type system, such as Haskell."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1437294915, "post_id": 31497468, "comment_id": 50962050, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/30518013/is-there-a-difference-between-a-list-and-a-tuple\">Is there a difference between a list and a tuple?</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437300123, "post_id": 31497468, "comment_id": 50963158, "body": "Why ask this question at all if you know full well that the second example won&#39;t work? You&#39;ve answered your own question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437325102, "post_id": 31497468, "comment_id": 50970112, "body": "Relevant as well, even though it&#39;s a Python question: <a href=\"http://stackoverflow.com/questions/626759/whats-the-difference-between-list-and-tuples?rq=1\">What&#39;s the difference between list and tuples?</a> Key quote: &quot;Tuples have structure, lists have order.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 426, "user_id": 4143053, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/366b4d4da4bc196bf332c2f69264556f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Behan", "link": "https://stackoverflow.com/users/4143053/kevin-behan"}, "edited": false, "score": 0, "creation_date": 1437280277, "post_id": 31497610, "comment_id": 50959508, "body": "It&#39;s funny you mention &quot;Learn you a Haskell for Great Good&quot; as I&#39;ve already read it, and my question was inspired by that book; I didn&#39;t think they explained this dilemma properly or thoroughly enough. Great book by the way!"}, {"owner": {"reputation": 426, "user_id": 4143053, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/366b4d4da4bc196bf332c2f69264556f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Behan", "link": "https://stackoverflow.com/users/4143053/kevin-behan"}, "edited": false, "score": 0, "creation_date": 1437281533, "post_id": 31497610, "comment_id": 50959714, "body": "I&#39;m going to look into &quot;The Little Schemer&quot; though thank you for the suggestion! It&#39;s much appreciated!"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1437294533, "post_id": 31497610, "comment_id": 50961956, "body": "lists are also immutable in Haskell; you should never put side effectful expressions in a list comprehension in Python; this is an answer largely about Python to a question solely about Haskell so -1."}, {"owner": {"reputation": 27, "user_id": 5131479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376669718745b4e810eccdc6b19f48eb?s=128&d=identicon&r=PG&f=1", "display_name": "Tom White", "link": "https://stackoverflow.com/users/5131479/tom-white"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439509432, "post_id": 31497610, "comment_id": 51903666, "body": "@ErikAllik Thanks for your feedback! I just noticed this when I was puzzling over some odd emails from stack overflow. (Apparently I got upvoted.)   Yeah, I agree that I had a bit too much python focus; but this is clearly a type system question; and type systems are hard. :(   I typed this into ghci and it worked fine. Prelude&gt; let it_be = [(&quot;Whatever&quot;, 0), (&quot;The&quot;, 1) , (&quot;Fun&quot;, 3), (&quot;you&quot;, 4), (&quot;want&quot;, 5)]; If I wipe away the let it&#39;s python. If I type it wrong in haskell, it feels GOOD  Prelude&gt; let it_be = [(&quot;a&quot;, 0), (&quot;bit different on&quot;, 1), (&quot;stack&quot;,&quot;overflow&quot;)];  Will error as we expect."}], "tags": [], "owner": {"reputation": 27, "user_id": 5131479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376669718745b4e810eccdc6b19f48eb?s=128&d=identicon&r=PG&f=1", "display_name": "Tom White", "link": "https://stackoverflow.com/users/5131479/tom-white"}, "is_accepted": false, "score": 1, "last_activity_date": 1437275042, "creation_date": 1437275042, "answer_id": 31497610, "question_id": 31497468, "link": "https://stackoverflow.com/questions/31497468/why-do-we-use-tuples-if-we-can-use-a-two-dimensional-list/31497610#31497610", "title": "Why do we use tuples, if we can use a two dimensional list?", "body": "<p><em>\"Is there a benefit to specifically reserving varied data-type pairings for tuples like such:\"</em></p>\n\n<p>Yes. The benefits to the use of tuples are related to the usage patterns around the data and any performance requirements. </p>\n\n<p>Tuples are often immutable and have a predictable size. </p>\n\n<p>Since you're writing a haskell program, your lists of \"strings and integers\" are actually a list of a union type (call it whatever you want)... your tuple is just a special case. </p>\n\n<p>This point is a bit more clear if you think about this as python code. (Both strings you provide are valid python code; I originally thought the question was python related) </p>\n\n<p>In python, you would prefer the List of Tuples if you knew that the tuples had a fixed (or predictable) structure. </p>\n\n<p>That would let you write code like: </p>\n\n<pre><code>[ print(name) for jersey, name in list_of_tuples ]  \n</code></pre>\n\n<p>You would choose to use the tuple if you believed that paying for the price of an object representation wasn't worth it, and you preferred expressing every tuple reference with an unpacking. </p>\n\n<p>Fortunately, since you're writing haskell, you have a number of tools to model and represent problems strongly in the type system. I think if you take a bit more time to read up and write some haskell (Learn you a Haskell for Great Good is a great book), you'll have a better understanding of the type system and you'll find the answer for this yourself. </p>\n\n<p>If you're looking to learn more about functional programming in general, The Little Schemer is also spectacular. </p>\n\n<p>((un)Fortunately, in python you can write code that handles both types of data structures, instead of worrying about the types going into the code. Haskell requires you to think a bit differently than that.)</p>\n"}, {"tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": false, "score": 1, "last_activity_date": 1437304385, "last_edit_date": 1437304385, "creation_date": 1437303593, "answer_id": 31500444, "question_id": 31497468, "link": "https://stackoverflow.com/questions/31497468/why-do-we-use-tuples-if-we-can-use-a-two-dimensional-list/31500444#31500444", "title": "Why do we use tuples, if we can use a two dimensional list?", "body": "<p>This question should have probably been more clearly stated as:</p>\n\n<blockquote>\n  <p>Why must we insist on the definition of a list as a collection of elements of exactly one type?</p>\n</blockquote>\n\n<p>From one point of view the answer could be that it allows us to reason about lists in a rigorous way and a whole new class of operations become possible. Ex. how else would you define <code>map</code> for lists?</p>\n\n<p>From another point of view, if lists could hold multple types then the language could not have been staticly typed. Ex. if you are passed a list as an argument what is the type of head element?</p>\n\n<p>You don't have this problem with tuples because you define the type of each element a priori and the length is fixed.</p>\n\n<blockquote>\n  <p>Is there a benefit to specifically reserving varied data-type pairings for tuples...</p>\n</blockquote>\n\n<p>It is absolutely necessary for a statically typed language that lists hold elements of exactly one type, so the question of benefit has no benefit.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1437324593, "last_edit_date": 1437324593, "creation_date": 1437324278, "answer_id": 31503506, "question_id": 31497468, "link": "https://stackoverflow.com/questions/31497468/why-do-we-use-tuples-if-we-can-use-a-two-dimensional-list/31503506#31503506", "title": "Why do we use tuples, if we can use a two dimensional list?", "body": "<blockquote>\n  <p>Why do we use tuples, if we can use a two dimensional list?</p>\n</blockquote>\n\n<p>Because lists and tuples are conceptually different things, and the type system gives us an useful way to state and recognise the difference in code. For one of many possible examples, one might define...</p>\n\n<pre><code>type ListyPair a = [a]\n</code></pre>\n\n<p>... and then...</p>\n\n<pre><code>listyFst :: ListyPair a -&gt; a\nlistyFst [x, _] = x\n\nlistySnd :: ListyPair a -&gt; a\nlistySnd [_, y] = y\n</code></pre>\n\n<p>... so that:</p>\n\n<pre><code>GHCi&gt; listyFst [3,4]\n3\nGHCi&gt; listySnd [3,4]\n4\n</code></pre>\n\n<p>But what happens if the listy \"pair\" has just one element, or none? We would have to throw a runtime error (yuck), or make <code>listyFst</code> and <code>listySnd</code> result in a <code>Maybe a</code> so that we can handle failure cleanly. What if the \"pair\" has more than two elements? Should we just discard them silently, or would it be better to make the functions fail in this case as well?</p>\n\n<p>From the perspective of a strong type system user, when we replace an actual pair with <code>ListyPair</code> we are throwing away useful information. Knowing that there are really just two elements allows us to avoid all of the complications above.</p>\n\n<pre><code>realFst :: (a, b) -&gt; a\nrealFst (x, _) = x\n\nrealSnd :: (a, b) -&gt; b\nrealSnd (_, y) = y \n</code></pre>\n"}], "owner": {"reputation": 426, "user_id": 4143053, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/366b4d4da4bc196bf332c2f69264556f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Behan", "link": "https://stackoverflow.com/users/4143053/kevin-behan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 31503506, "answer_count": 3, "score": 1, "last_activity_date": 1437328952, "creation_date": 1437273343, "last_edit_date": 1437328952, "question_id": 31497468, "link": "https://stackoverflow.com/questions/31497468/why-do-we-use-tuples-if-we-can-use-a-two-dimensional-list", "title": "Why do we use tuples, if we can use a two dimensional list?", "body": "<p>Is there a benefit to specifically reserving varied data-type pairings for tuples like such:</p>\n\n<pre><code>[(23, \"Jordan\"), (8, \"Bryant\")]\n</code></pre>\n\n<p>As opposed to just using a two-dimensional list:</p>\n\n<pre><code>[[23, \"Jordan\"], [8, \"Bryant\"]]\n</code></pre>\n\n<p>I know the second piece of code will not work in Haskell</p>\n"}, {"tags": ["haskell", "random", "coding-style", "where"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1437254363, "post_id": 31495362, "comment_id": 50954955, "body": "&quot;Is this kind of code considered in bad style, wherein I have ~10 lines after a where statement&quot;. Not necessarily, but it&#39;s a good rule of thumb to not have names be in scope places where they&#39;re not used. What you&#39;re really trying to do is function composition (in this case a fancier form of function composition with <code>State</code> would be appropriate). So I guess if you&#39;re finding yourself binding names in a where clause and using them from top to bottom, realize you might be looking for some sort of composition"}, {"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1437254501, "post_id": 31495362, "comment_id": 50955005, "body": "@jberryman Could you perhaps provide an example of some other sort of composition using State?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1437258025, "post_id": 31495362, "comment_id": 50955819, "body": "Well, the specific sort of composition involved is not <code>(.)</code> but rather <code>&lt;=&lt;</code>, from <code>Control.Monad</code>. It chains together monadic computations. In this case, as in many others, it&#39;s better to string things together more explicitly in a <code>do</code> expression."}], "answers": [{"comments": [{"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 0, "creation_date": 1437253863, "post_id": 31495509, "comment_id": 50954817, "body": "I should&#39;ve been more specific! I have edited my question. This is a great answer, but I would prefer to do this purely. Is there a better way to chain this random generation in a pure function?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 6, "creation_date": 1437253959, "post_id": 31495509, "comment_id": 50954848, "body": "@Langston The <code>State</code> monad <i>is</i> pure, it is just a newtype wrapper around a pure function. <a href=\"https://hackage.haskell.org/package/MonadRandom\" rel=\"nofollow noreferrer\"><code>MonadRandom</code></a> can be used either purely or with <code>IO</code> as you wish."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 4, "creation_date": 1437254030, "post_id": 31495509, "comment_id": 50954873, "body": "@Langston <code>g -&gt; (a, g)</code> is an useful pattern to recognise in type signatures - it should immediately bring <code>State</code> to mind. And <code>State</code> is pure, as &#216;rjan has just said."}, {"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 0, "creation_date": 1437254430, "post_id": 31495509, "comment_id": 50954984, "body": "duplode, &#216;rjan, thank you for the clarification! dfeuer, thanks for the answer! Could any of you post an example of how to use the State monad here?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1437252938, "creation_date": 1437252938, "answer_id": 31495509, "question_id": 31495362, "link": "https://stackoverflow.com/questions/31495362/is-using-long-where-statements-bad-coding-style/31495509#31495509", "title": "Is using long where statements bad coding style?", "body": "<p>Yup! This is the sort of situation where a state monad (or even, more specifically, a randomness monad) is really handy. These let you chain together computations that all transform some sort of state, in this case the random seed. See, for example, <code>Control.Monad.State</code> or look for <code>MonadRandom</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 9, "last_activity_date": 1437255054, "last_edit_date": 1437255054, "creation_date": 1437254850, "answer_id": 31495752, "question_id": 31495362, "link": "https://stackoverflow.com/questions/31495362/is-using-long-where-statements-bad-coding-style/31495752#31495752", "title": "Is using long where statements bad coding style?", "body": "<p>By request, here's how to rewrite the function using <code>State</code> in the most direct way. Note that the top level type signature hasn't changed.</p>\n\n<pre><code>makeDummy :: RandomGen g \u21d2 [String] \u2192 FilePath \u2192 g \u2192 (FilePath, g)\nmakeDummy words root = runState $ do\n    numWordsInTitle &lt;- state $ randomR (1 :: Int, 4 :: Int) -- unused\n    title &lt;- state $ randomChoice words\n    year &lt;- state $ randomR (1800 :: Int, 2100 :: Int)\n    resNum &lt;- state $ randomChoice [\"1080\", \"720\", \"480\"]\n    resLetter &lt;- state $ randomChoice [\"P\", \"p\", \"i\", \"I\"]\n    let res = resNum ++ resLetter\n    shuffled &lt;- state $ shuffle [title, show year, resNum ++ resLetter]\n    fileExt &lt;- state $ randomChoice [\".mkv\", \".mp4\", \".ogv\", \".srt\", \"\"]\n    let path = (++ fileExt) $ intercalate \" \" shuffled\n    let fullPath = root &lt;/&gt; path\n    return fullPath\n</code></pre>\n\n<p>More usually, you would avoid most of the uses of <code>state $</code> by defining the utility functions such as <code>randomChoice</code> to already be in the <code>State</code> monad. (This is more or less part of what the <code>MonadRandom</code> package does.)</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1437345402, "last_edit_date": 1437345402, "creation_date": 1437343067, "answer_id": 31506355, "question_id": 31495362, "link": "https://stackoverflow.com/questions/31495362/is-using-long-where-statements-bad-coding-style/31506355#31506355", "title": "Is using long where statements bad coding style?", "body": "<p>Excellent answers already by dfeuer and \u00d8rjan Johansen, but I'll throw my few cents in anyway.  I would recommend the following:</p>\n\n<ol>\n<li>First and foremost, use this as an opportunity to study the <code>State</code> monad.</li>\n<li>But don't actually use the state monad for the solution, use the <a href=\"https://hackage.haskell.org/package/MonadRandom\" rel=\"nofollow\"><code>MonadRandom</code></a> package instead.  The <code>Rand</code> type from there is a specialized <code>newtype</code> wrapper around <code>State</code> with custom operations for randomness, and makes code easier to read.</li>\n<li>There are a bunch of bits here that would benefit from separating these two concerns:\n\n<ul>\n<li>Generating random values.</li>\n<li>Combining them into bigger results.</li>\n</ul></li>\n</ol>\n\n<p>For example, I would start by splitting this into its own function as follows:</p>\n\n<pre><code>makeFullPath :: [String] -&gt; FilePath -&gt; String -&gt; FilePath\nmakeFullPath words root fileExt = \n    root &lt;/&gt; (intercalate \" \" words ++ fileExt)\n</code></pre>\n\n<p>Since that's the result you're returning, let's call this the \"main\" thing that you're trying to do\u2014most of the other code is subordinate to feeding random arguments into that function.  But that splits into two parts: (a) generating the random \"words\", and (b) shuffling them.   Let's write a function for (b) first, assuming you already have the words but not shuffled:</p>\n\n<pre><code>makeShuffledPath \n  :: RandomGen g =&gt; [String] -&gt; FilePath -&gt; String -&gt; Rand g FilePath\nmakeShuffledPath words root fileExt = do\n    shuffled &lt;- shuffle words\n    fileExt &lt;- uniform [\".mkv\", \".mp4\", \".ogv\", \".srt\", \"\"]\n    return (makeFullPath shuffled root fileExt)\n</code></pre>\n\n<p>(Note that I've assumed that <code>shuffle</code> has been rewritten to use <code>MonadRandom</code>.  Also, I haven't tested any of this code, there are probably dumb mistakes in it.  But that's all an exercise for you!)</p>\n\n<p>The generation of a random resolution looks like a complex enough meaningful unit to split apart as well:</p>\n\n<pre><code>randomResolution :: RandomGen g =&gt; Rand g String\nrandomResolution = do\n    resNum &lt;- uniform [\"1080\", \"720\", \"480\"]\n    resLetter &lt;- uniform [\"P\", \"p\", \"i\", \"I\"]\n    return (resNum ++ resLetter)\n</code></pre>\n\n<p>Now, tying it all together:</p>\n\n<pre><code>makeDummy :: RandomGen g =&gt; [String] -&gt; FilePath -&gt; Rand g FilePath\nmakeDummy words root = do\n    title &lt;- uniform words\n    year &lt;- getRandomR (1800 :: Int, 2100 :: Int)\n    resolution &lt;- randomResolution\n    makeShuffledPath [title, show year, resolution] root\n\nrunDummy :: RandomGen g =&gt; [String] -&gt; FilePath -&gt; g -&gt; (FilePath, g)\nrunDummy words root = runRand (makeDummy words root)\n</code></pre>\n"}], "owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 31495509, "answer_count": 3, "score": 8, "last_activity_date": 1437345402, "creation_date": 1437251996, "last_edit_date": 1437253818, "question_id": 31495362, "link": "https://stackoverflow.com/questions/31495362/is-using-long-where-statements-bad-coding-style", "title": "Is using long where statements bad coding style?", "body": "<p>I am a Haskell newbie, so I don't know a lot about the coding style. I have a function that chains a lot of random generators. Is this kind of code considered in bad style, wherein I have ~10 lines after a <code>where</code> statement? If so, what are the alternatives? </p>\n\n<pre><code>#!/usr/bin/env runhaskell\n{-# LANGUAGE UnicodeSyntax #-}\nmodule Main where\n\nmakeDummy :: RandomGen g \u21d2 [String] \u2192 FilePath \u2192 g \u2192 (FilePath, g)\nmakeDummy words root gen0 = (fullPath, gen7)\n  where\n      (numWordsInTitle, gen1) = randomR (1 :: Int, 4 :: Int) gen0 -- unused\n      (title, gen2) = randomChoice words gen1\n      (year, gen3) = randomR (1800 :: Int, 2100 :: Int) gen2\n      (resNum, gen4) = randomChoice [\"1080\", \"720\", \"480\"] gen3\n      (resLetter, gen5) = randomChoice [\"P\", \"p\", \"i\", \"I\"] gen4\n      res = resNum ++ resLetter\n      (shuffled, gen6) = shuffle [title, show year, resNum ++ resLetter] gen5\n      (fileExt, gen7) = randomChoice [\".mkv\", \".mp4\", \".ogv\", \".srt\", \"\"] gen6\n      path = (++ fileExt) $ intercalate \" \" shuffled\n      fullPath = root &lt;/&gt; path\n</code></pre>\n\n<p>As this could be a somewhat subjective subject, please restrain answers to relfect the Haskell community code style norms, rather than personal opinion/aesthetics.  </p>\n\n<p>I am aware of the possibility of using <code>getStdRandom</code>, but would like to use a pure function here, preferrably. </p>\n"}, {"tags": ["haskell", "yesod", "sha", "conduit"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1437287791, "post_id": 31495331, "comment_id": 50960743, "body": "It&#39;s a different implementation, but I&#39;d recommend checking out <a href=\"http://haddock.stackage.org/nightly-2015-07-18/cryptohash-conduit-0.1.1/Crypto-Hash-Conduit.html\" rel=\"nofollow noreferrer\">cryptohash-conduit</a>, which is built on top of the <a href=\"https://www.stackage.org/package/cryptohash\" rel=\"nofollow noreferrer\">cryptohash</a> package (and written by the same author)."}], "answers": [{"comments": [{"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1461260628, "post_id": 31497167, "comment_id": 61130352, "body": "This doesn&#39;t compile due to the missing <code>Int</code> argument to <code>completeSha256Incremental</code>. Do you know what the <code>Int</code> is for?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1461430338, "post_id": 31497167, "comment_id": 61200052, "body": "I looked at the source, and the parameter&#39;s name is <code>pad</code>.  It&#39;s used for zero-padding the end of the input data.  I would assume that using 0 for it doesn&#39;t pad anything, which is probably what you want."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 1, "last_activity_date": 1437269647, "creation_date": 1437269647, "answer_id": 31497167, "question_id": 31495331, "link": "https://stackoverflow.com/questions/31495331/sha256-an-uploaded-file-in-yesod-using-conduit-and-data-digest-pure-sha/31497167#31497167", "title": "SHA256 an uploaded file in Yesod - Using Conduit and Data.Digest.Pure.SHA", "body": "<p>This is only a partial answer.  I am stuck in cabal hell right now and can't install <code>sha-streams</code> to see if things work right.</p>\n\n<p>Calculating a SHA256 incrementally is done like this:</p>\n\n<pre><code>sha256FromChunks :: [ByteString] -&gt; Digest SHA256State\nsha256FromChunks cs = completeSHA256Incremental $\n                          foldl pushChunk sha256Incremental cs\n</code></pre>\n\n<p><code>pushChunk</code> is from <code>Data.Binary.Get</code>.  That shows you how all the function calls fit together, but isn't very practical for a streaming scenario.</p>\n\n<p>To use this with conduit, you would need to turn it into a <code>Sink</code>.</p>\n"}], "owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437269647, "creation_date": 1437251764, "question_id": 31495331, "link": "https://stackoverflow.com/questions/31495331/sha256-an-uploaded-file-in-yesod-using-conduit-and-data-digest-pure-sha", "title": "SHA256 an uploaded file in Yesod - Using Conduit and Data.Digest.Pure.SHA", "body": "<p>I am handling a file upload using yesod, and would like to save the uploaded file to a file on my server with the name being the SHA256 of the contents.</p>\n\n<p>I think the handler-level function will look like: </p>\n\n<pre><code>fileMove fInfo (basePath &lt;&gt; generateSha fInfo)\n</code></pre>\n\n<p>This question is centered around how to write <code>generateSha :: FileInfo -&gt; String</code>.</p>\n\n<p>I see a few functions that are likely to be helpful:</p>\n\n<pre><code>fileSource :: MonadResource m =&gt; FileInfo -&gt; Source m ByteString\nsha256Incremental :: Decoder SHA256State\ncompleteSha256Incremental :: Decoder SHA256State -&gt; Int -&gt; Digest SHA256State\nshowDigest :: Digest t-&gt; String\n</code></pre>\n\n<p>But I'm unsure of a few things:</p>\n\n<ol>\n<li>How to wire this up in the conduit. Ideally I'd have it stream the file.</li>\n<li>Use the SHA interface to incrementally build up the hash. I can get the SHA256 of an empty string easily enough, but I'm not sure how to  add values.  Presumably it's something hidden in the Decoder type?</li>\n<li>What the <code>Int</code> argument of completeSha256Incremental is.</li>\n</ol>\n\n<p>Can somebody point me in the right direction?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 2, "creation_date": 1437250814, "post_id": 31495169, "comment_id": 50953914, "body": "<a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#v:hGetContents\" rel=\"nofollow noreferrer\"><code>hGetContents</code></a> closes the handle. Try something like <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#v:hGetLine\" rel=\"nofollow noreferrer\"><code>hGetLine</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1437255826, "creation_date": 1437255826, "answer_id": 31495883, "question_id": 31495169, "link": "https://stackoverflow.com/questions/31495169/haskell-readwritemode-file-handle/31495883#31495883", "title": "Haskell ReadWriteMode file handle", "body": "<p>Here is something that seems to work. </p>\n\n<pre><code>import System.IO\nimport qualified System.IO.Strict as SIO\nimport GHC.IO.Handle\n\nslurp h = do\n  h' &lt;- hDuplicate h\n  hSeek h' AbsoluteSeek 0\n  SIO.hGetContents h'\n\nmain = do\n    handle   &lt;- openFile \"myfile\" ReadWriteMode\n    contents &lt;- slurp handle\n    putStrLn contents\n    offset &lt;- hTell handle\n    putStrLn $ \"handle position: \" ++ show offset\n    hPutStrLn handle \"Something new\"\n    hClose handle\n</code></pre>\n\n<p><code>System.IO.Strict</code> is from the <a href=\"https://hackage.haskell.org/package/strict-0.3.2/docs/System-IO-Strict.html\" rel=\"nofollow\"><code>strict</code> package</a></p>\n\n<p>Edit: You might not even need to use <code>SIO.hGetContents</code> - just plain <code>hGetContents</code> also seems to work.</p>\n"}], "owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 31495883, "answer_count": 1, "score": 2, "last_activity_date": 1437255826, "creation_date": 1437250509, "question_id": 31495169, "link": "https://stackoverflow.com/questions/31495169/haskell-readwritemode-file-handle", "title": "Haskell ReadWriteMode file handle", "body": "<p>While reading <em>Learn You A Haskell</em>, I found that you can use <em>ReadWriteMode</em> as the third parameter to <code>openFile</code>.</p>\n\n<p>But is this supposed to handle writing and reading to a file?\nI did some tests:</p>\n\n<pre><code>import System.IO\n\nmain = do\n    handle   &lt;- openFile \"myfile\" ReadWriteMode\n    contents &lt;- hGetContents handle\n    putStrLn contents\n    hPutStr handle \"Something\"\n    hClose handle\n</code></pre>\n\n<p>However, this returned an error:</p>\n\n<pre><code>*** Exception: myfile: hPutStr: illegal operation (handle is closed)\n</code></pre>\n\n<p>So, what is the point of the <em>ReadWriteMode</em>? I am looking for any real world cases where this would be used.</p>\n"}, {"tags": ["haskell", "hlist"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437260655, "post_id": 31494797, "comment_id": 50956348, "body": "I don&#39;t know the answer, but do have one observation: I notice that all your instances are of the form <code>HFoldr HUpdateFirst (Endo a) x (HList x)</code>, with <code>x</code> ranging over <code>l</code> ,<code>a &#39;: l</code>, and <code>b &#39;: l</code>. The amount of overlap in these values for <code>x</code> is extremely worrying to me."}], "answers": [{"tags": [], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "is_accepted": true, "score": 0, "last_activity_date": 1437423058, "creation_date": 1437423058, "answer_id": 31525478, "question_id": 31494797, "link": "https://stackoverflow.com/questions/31494797/type-classes-when-implementing-hfoldr/31525478#31525478", "title": "Type Classes When Implementing HFoldr", "body": "<p>The extremely limited version of the answer is that <code>HOccurs</code> seems to be causing problems.  The following code works:</p>\n\n<p><code>\ninstance (HOccursNot a l, r ~ HList l) =&gt; HFoldr HUpdateFirst (Endo a) l r where\n  hFoldr _ _ l = l\ninstance (r ~ HList (a ': l)) =&gt; HFoldr HUpdateFirst (Endo a) (a ': l) r where\n  hFoldr _ f (HCons a r) = HCons (appEndo f a) r\ninstance (r ~ HList (b ': l), HFoldr HUpdateFirst (Endo a) l (HList l))\n    =&gt; HFoldr HUpdateFirst (Endo a) (b ': l) r where\n  hFoldr h f (HCons v l) = HCons v (hFoldr h f l)\n</code></p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 31525478, "answer_count": 1, "score": 2, "last_activity_date": 1437423058, "creation_date": 1437247896, "question_id": 31494797, "link": "https://stackoverflow.com/questions/31494797/type-classes-when-implementing-hfoldr", "title": "Type Classes When Implementing HFoldr", "body": "<p>I'm trying to implement <code>HFoldr</code> for a simple case where you apply an <code>Endo a</code> to the first <code>a</code> in the <code>HList</code>. The code looks like this:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE OverlappingInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Lib\n    ( x2, z3\n    ) where\n\nimport Data.HList\nimport Data.Monoid\n\nx2 :: HList '[Sum Integer, String, Sum Integer, String]\nx2 = 3 .*. \"Hello\" .*. 4 .*. \" World\" .*. HNil\n\ndata HUpdateFirst = HUpdateFirst\n\ninstance (HOccursNot a l, r ~ (HList l)) =&gt; HFoldr HUpdateFirst (Endo a) l r where\n  hFoldr _ _ l = l\ninstance (r ~ (HList (a ': l))) =&gt; HFoldr HUpdateFirst (Endo a) (a ': l) r where\n  hFoldr _ f (HCons v l) = HCons (appEndo f v) l\ninstance (HOccurs a (HList l), r ~ (HList (b ': l)), HFoldr HUpdateFirst (Endo a) l (HList l))\n    =&gt; HFoldr HUpdateFirst (Endo a) (b ': l) r where\n  hFoldr h f (HCons v l) = HCons v (hFoldr h f l)\n\nz3 :: HList '[Sum Integer, String, Sum Integer, String]\nz3 = hFoldr HUpdateFirst (Endo (++ \" X \")) x2\n</code></pre>\n\n<p>If I exclude <code>z3</code>, the code compiles, but when I actually put <code>z3</code> in, I get</p>\n\n<p><code>\n    No instance for (Fail (TypeFound [Char]))\n      arising from a use of \u2018hFoldr\u2019\n    In the expression: hFoldr HUpdateFirst (Endo (++ \" X \")) x2\n    In an equation for \u2018z3\u2019:\n        z3 = hFoldr HUpdateFirst (Endo (++ \" X \")) x2\n</code></p>\n\n<p>As far as I can tell, this is saying that it can't figure out what to do if <code>String</code> isn't in the list, but a) it is and b) that's what the first clause is meant to be for.</p>\n\n<p>I suspect that my problem may lie in not understanding Haskell's inference rules better, so any pointers on that subject would be appreciated as well.</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1437251300, "post_id": 31494426, "comment_id": 50954060, "body": "Laziness doesn&#39;t explain any problems you may be having, unless readConfig uses lazy IO.  If it does, I&#39;d argue that&#39;s a bug that should be fixed."}, {"owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1437251445, "post_id": 31494426, "comment_id": 50954109, "body": "@Carl <code>readConfig</code> uses the <code>readFile</code> function, which is (I believe) lazy. So yes, you are right! Which function should I use to read configurations strictly?"}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1437255729, "post_id": 31494426, "comment_id": 50955294, "body": "Are you sure <code>Config</code> is fully strict? If it was any errors in <code>f</code> would be caught before attempting to write the file because of the bang pattern on <code>newCfg</code>, even if the file was read lazily (I just tested this). You should still make sure the file is read strictly because it could cause problems when trying to write back to the config file. You can do this with the <a href=\"https://hackage.haskell.org/package/strict-0.3.2/docs/System-IO-Strict.html\" rel=\"nofollow noreferrer\"><code>strict</code></a> package. (but melphomene&#39;s temporary and rename is probably a better solution)"}, {"owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1437261147, "post_id": 31494426, "comment_id": 50956436, "body": "@cchalmers I missed a bang pattern in one of the fields of <code>Config</code>. I&#39;ve just fixed this and <code>mutateConfig</code> is working just I expect it to. Thank you very much for your assistance!"}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437246570, "post_id": 31494580, "comment_id": 50952611, "body": "Hi! This still doesn&#39;t work! Btw I don&#39;t need <code>deepseq</code> here since <code>Config</code> is indeed strict."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437254756, "post_id": 31494580, "comment_id": 50955073, "body": "What do you mean by &quot;this&quot; and what do you mean by &quot;doesn&#39;t work&quot;?"}, {"owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437260034, "post_id": 31494580, "comment_id": 50956247, "body": "This - what you suggested. Doesn&#39;t work - still changes the file (and I am left with an empty file after the error is displayed)."}, {"owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437261201, "post_id": 31494580, "comment_id": 50956449, "body": "Anyways, I just found out that <code>Config</code> was not completely strict (due to a bug). See my comment above. Thanks!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437261563, "post_id": 31494580, "comment_id": 50956507, "body": "I suggested two different things (three if you count deepseq)."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "edited": false, "score": 0, "creation_date": 1437262934, "post_id": 31494580, "comment_id": 50956744, "body": "I&#39;m saying it&#39;s still not clear which of my 2 (or 3) suggestions you tried and I&#39;ve been trying to find out and you&#39;ve been avoiding giving out any information."}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 1, "creation_date": 1437298537, "post_id": 31494580, "comment_id": 50962793, "body": "a better way to write <code>evaluate (deepseq newCfg ())</code> is <code>evaluate (force newCfg)</code>"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1437246264, "creation_date": 1437246264, "answer_id": 31494580, "question_id": 31494426, "link": "https://stackoverflow.com/questions/31494426/haskell-preventing-data-modification/31494580#31494580", "title": "Haskell: preventing data modification", "body": "<p>If <code>Config</code> is completely strict (no embedded bottoms within), you can do this:</p>\n\n<pre><code>do\n    cfg &lt;- readConfig\n    let newCfg = f cfg\n    evaluate newCfg\n    writeConfig newCfg\n</code></pre>\n\n<p>If it's not, you could do something like <code>evaluate (</code><a href=\"http://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#v:deepseq\" rel=\"nofollow\"><code>deepseq</code></a><code>newCfg ())</code>.</p>\n\n<p>But there's another problem: In general, writing a file can fail due to I/O errors (for example because the disk is full). To avoid this, you can write to a temporary file and <a href=\"http://hackage.haskell.org/package/directory-1.2.3.0/docs/System-Directory.html#v:renameFile\" rel=\"nofollow\">rename</a> it to the real target at the end. Doing it this way guarantees you only overwrite the config if there were no errors during the writing.</p>\n"}], "owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "accepted_answer_id": 31494580, "answer_count": 1, "score": 1, "last_activity_date": 1437249326, "creation_date": 1437245328, "question_id": 31494426, "link": "https://stackoverflow.com/questions/31494426/haskell-preventing-data-modification", "title": "Haskell: preventing data modification", "body": "<p>I have the following code which does the job of changing the configuration file:</p>\n\n<pre><code>mutateConfig :: (Config -&gt; Config) -&gt; IO ()\nmutateConfig f = do\n    !cfg &lt;- readConfig\n    let !newCfg = f cfg\n     in writeConfig newCfg\n</code></pre>\n\n<p>Bang patterns are used to disable lazy evaluation: i need writeConfig to be called <strong>after</strong> an old configuration was parsed and modified with function <code>f</code>.</p>\n\n<p>But there is still a problem: imagine that <code>f</code> gives an error. In this case writeConfig has already opened the file for writing (because it is called first by lazy evaluation) when an error occures, so the configuration file gets lost.</p>\n\n<p>I have tried to compose a simple step-by-step logic from IO monads (in order to prevent the loss of data) like this</p>\n\n<pre><code>!cfg &lt;- readConfig\nnewCfg &lt;- return $ f cfg\nwriteConfig newCfg\n</code></pre>\n\n<p>but this doesn't work either (I kind of expected that).</p>\n\n<p>What would be the correct way to accomplish this goal?</p>\n"}, {"tags": ["json", "parsing", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437240813, "post_id": 31493702, "comment_id": 50951010, "body": "But this won\u2019t work with the JSON parser, will it? The compiler complains around <code>liftM</code>, saying it expects <code>String -&gt; Day</code> and gets <code>String -&gt; Maybe Day</code> instead. (Maybe the solution is obvious, but as I said, the JSON parser rules are currently too deep for me.)"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437241008, "post_id": 31493702, "comment_id": 50951058, "body": "My answer&#39;s incomplete.  I focused on getting parsePubDate to return a <code>Maybe Day</code> without the big parser picture."}, {"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437241631, "post_id": 31493702, "comment_id": 50951233, "body": "Thank you anyway, this is useful."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 2, "last_activity_date": 1437240846, "last_edit_date": 1437240846, "creation_date": 1437240639, "answer_id": 31493702, "question_id": 31493597, "link": "https://stackoverflow.com/questions/31493597/json-parsing-in-haskell-fail-on-malformed-value/31493702#31493702", "title": "JSON parsing in Haskell: Fail on malformed value", "body": "<p>This is a typical use of the <code>Maybe</code> monad.  It's not that obvious to a beginner, but once you grok monads it becomes second nature.</p>\n\n<pre><code>parsePubDate :: String -&gt; Maybe Day\nparsePubDate = parseTimeM True defaultTimeLocale \"%Y-%-m-%-d\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437241931, "post_id": 31493724, "comment_id": 50951328, "body": "Thank you! How do I write the <code>FromJSON</code> instance for <code>Maybe ArticleInfo</code>? Plain <code>instance FromJSON Mayb ArticleInfo</code> doesn\u2019t work, and neither does <code>instance FromJSON (Maybe ArticleInfo)</code>. I feel like an idiot haggling with the compiler like this, but I\u2019d like to get it working and try to grok it afterwards."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437242192, "post_id": 31493724, "comment_id": 50951389, "body": "@zoul: I think I was having a little tunnel-vision trying to make <code>FromJSON (Maybe ArticleInfo)</code> do what you wanted it to do, where instead you would be okay with the parser just failing and <code>decode</code> returning <code>Nothing</code>. In that case, just follow the steps before the horizontal line. Otherwise, if you do want to get <code>instance FromJSON (Maybe ArticleInfo)</code> working, you\u2019ll need to (a) enable the <code>FlexibleInstances</code> syntax extension, (b) add a <code>join $</code> to your <code>parseArticleInfo</code> definition, and (c) make sure you\u2019re using the most recent revision (I had an error in a previous revision)."}, {"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437242480, "post_id": 31493724, "comment_id": 50951465, "body": "Failing the whole parser is what I was after, now it works. Much appreciated, thank you."}], "tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 2, "last_activity_date": 1437242446, "last_edit_date": 1437242446, "creation_date": 1437240869, "answer_id": 31493724, "question_id": 31493597, "link": "https://stackoverflow.com/questions/31493597/json-parsing-in-haskell-fail-on-malformed-value/31493724#31493724", "title": "JSON parsing in Haskell: Fail on malformed value", "body": "<p>If you\u2019re okay with making the whole parser fail if there\u2019s an invalid date, you can just thread that in without too much hassle:</p>\n\n<pre><code>parseJSON (Object value) = ArticleInfo &lt;$&gt;\n    value .: \"author\" &lt;*&gt;\n    value .: \"title\" &lt;*&gt;\n    (value .: \"pubDate\" &gt;&gt;= parseTimeM True defaultTimeLocale \"%Y-%-m-%-d\")\n</code></pre>\n\n<p>If, instead, you want a parser for <code>Maybe ArticleInfo</code> (which I thought at first, but now realize you probably don\u2019t want), read on\u2026</p>\n\n<hr>\n\n<p>First off, if you want to be parsing a <code>Maybe ArticleInfo</code>, your <code>FromJSON</code> instance is going to need to be for a <code>Maybe ArticleInfo</code>, not an <code>ArticleInfo</code>. (Doing this will require the language extension <code>FlexibleInstances</code>.) Secondly, you are going to need to change your <code>parsePubDate</code> to return a <code>Maybe Day</code> as well, and replace <code>parseTimeOrError</code> with <code>parseTimeM</code>. (Indeed, when <code>parseTimeM</code> is specialized with <code>m ~ Monad</code>, <code>parseTimeM</code> functions identically to the deprecated <code>parseTime</code>.)</p>\n\n<p>Then things get a little more complicated. Somewhat verbosely, you could do:</p>\n\n<pre><code>parseJSON (Object value) = (\\a t pd -&gt; ArticleInfo a t &lt;$&gt; pd) &lt;$&gt;\n    value .: \"author\" &lt;*&gt;\n    value .: \"title\" &lt;*&gt;\n    liftM parsePubDate (value .: \"pubDate\")\n</code></pre>\n\n<p>\u2026but that\u2019s a little repetitive and isn\u2019t a very \u2018nice\u2019 solution. You could alternatively use the <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Maybe.html#t:MaybeT\" rel=\"nofollow\"><code>MaybeT</code></a> monad transformer, which might be a bit nicer:</p>\n\n<pre><code>parseJSON (Object value) =\n  runMaybeT $ ArticleInfo &lt;$&gt; lift (value .: \"author\")\n                          &lt;*&gt; lift (value .: \"title\")\n                          &lt;*&gt; (MaybeT $ parsePubDate &lt;$&gt; value .: \"pubDate\")\n</code></pre>\n\n<p>Also, all this makes <code>Data.Yaml.decode (pack source)</code> return a <code>Maybe (Maybe ArticleInfo)</code>. You can use <code>join</code> to fold the <code>Maybe</code>s together.</p>\n"}], "owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 31493724, "answer_count": 2, "score": 1, "last_activity_date": 1437242446, "creation_date": 1437239894, "last_edit_date": 1437240358, "question_id": 31493597, "link": "https://stackoverflow.com/questions/31493597/json-parsing-in-haskell-fail-on-malformed-value", "title": "JSON parsing in Haskell: Fail on malformed value", "body": "<p>I have a record I want to parse from JSON:</p>\n\n<pre><code>data ArticleInfo = ArticleInfo {\n    author :: String,\n    title :: String,\n    pubDate :: Day\n} deriving (Show, Eq)\n\ninstance FromJSON ArticleInfo where\n    parseJSON (Object value) = ArticleInfo &lt;$&gt;\n        value .: \"author\" &lt;*&gt;\n        value .: \"title\" &lt;*&gt;\n        liftM parsePubDate (value .: \"pubDate\")\n    parseJSON _ = mzero\n\nparsePubDate :: String -&gt; Day\nparsePubDate = parseTimeOrError True defaultTimeLocale \"%Y-%-m-%-d\"\n\nparseArticleInfo :: String -&gt; Maybe ArticleInfo\nparseArticleInfo source = Data.Yaml.decode (pack source)\n</code></pre>\n\n<p>This works, but crashes on malformed dates that don\u2019t fit the <code>\"%Y-%-m-%-d\"</code> format specifier. The parser specification is above my head at the moment \u2013 what do I write there to make the <code>ArticleInfo</code> parser return <code>Nothing</code> when encountering such dates?</p>\n\n<p>(I know I should start by replacing <code>parseTimeOrError</code> with <code>parseTime</code>, but that\u2019s about it. And even <code>parseTime</code> is deprecated, telling me to use <code>parseTimeM</code> whose signature I don\u2019t understand yet.)</p>\n"}, {"tags": ["unit-testing", "haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 0, "creation_date": 1437237316, "post_id": 31493257, "comment_id": 50949994, "body": "This seems reasonable, but could you add some explanation for future readers?"}, {"owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1437237492, "post_id": 31493257, "comment_id": 50950057, "body": "Thanks! I guess it boils down to the <code>exitcode-stdio-1.0</code> \u201cdriver\u201d specified in the Cabal file. It reports the result of the testing suite according to an exit code. Is there a simpler way to integrate the HUnit tests into Cabal without so  much boilerplate, maybe a specialized driver?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1437238381, "post_id": 31493257, "comment_id": 50950326, "body": "The developers of HUnit, like developers of basically every other Haskell library, see process termination as something outside the scope of HUnit."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "edited": false, "score": 0, "creation_date": 1467126110, "post_id": 31493257, "comment_id": 63596046, "body": "@zoul <a href=\"https://hackage.haskell.org/package/tasty\" rel=\"nofollow noreferrer\">Tasty</a>&#39;s <a href=\"https://hackage.haskell.org/package/tasty-0.11.0.3/docs/Test-Tasty.html#v:defaultMain\" rel=\"nofollow noreferrer\"><code>defaultMain</code></a> (with <a href=\"https://hackage.haskell.org/package/tasty-hunit\" rel=\"nofollow noreferrer\">Tasty-hunit</a>) is exactly what you were looking for."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": true, "score": 7, "last_activity_date": 1437237769, "last_edit_date": 1437237769, "creation_date": 1437237131, "answer_id": 31493257, "question_id": 31492666, "link": "https://stackoverflow.com/questions/31492666/running-cabal-test-passes-although-there-are-test-failures/31493257#31493257", "title": "Running \u201ccabal test\u201d passes although there are test failures", "body": "<p><code>main</code> has to be of type <code>IO a</code> where <code>a</code> can be anything, and that value is not tied in any way to the POSIX exit status of the program.  You need to look at the <code>Counts</code> returned by <code>runTest</code> and explicitly choose a successful or failed output code.</p>\n\n<pre><code>import System.Exit\n\nmain :: IO ()\nmain = do\n    cs@(Counts _ _ errs fails) &lt;- runTestTT testSanity\n    putStrLn (showCounts cs)\n    if (errs &gt; 0 || fails &gt; 0) \n        then exitFailure\n        else exitSuccess\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1437238030, "last_edit_date": 1495542691, "creation_date": 1437238030, "answer_id": 31493376, "question_id": 31492666, "link": "https://stackoverflow.com/questions/31492666/running-cabal-test-passes-although-there-are-test-failures/31493376#31493376", "title": "Running \u201ccabal test\u201d passes although there are test failures", "body": "<p>I believe <code>exitcode-stdio-1.0</code> expects the test to communicate failure via the program's exit code. However, if you run the test program manually from the shell (look in the <code>dist/build</code> directory) I think you'll find that the exit code is always 0.</p>\n\n<p>Here is a related SO question which suggests that your test should call <code>exitFailure</code> if your suite doesn't pass:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/8976488/quickcheck-exit-status-on-failures-and-cabal-integration\">QuickCheck exit status on failures, and cabal integration</a></p>\n\n<p>FWIW, it works correctly when using <code>stack</code>:</p>\n\n<pre><code>$ mkdir new-dir\n$ cd new-dir\n$ stack new\n(edit new-template.cabal to add HUnit as a test dependency)\n(add test case to test/Spec.hs)\n$ stack test\n</code></pre>\n\n<p>Perhaps <code>stack</code> is also scanning the test output.</p>\n"}], "owner": {"reputation": 95982, "user_id": 17279, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a08771c878da3724492f3056d5eca168?s=128&d=identicon&r=PG", "display_name": "zoul", "link": "https://stackoverflow.com/users/17279/zoul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 31493257, "answer_count": 2, "score": 6, "last_activity_date": 1437238030, "creation_date": 1437233199, "question_id": 31492666, "link": "https://stackoverflow.com/questions/31492666/running-cabal-test-passes-although-there-are-test-failures", "title": "Running \u201ccabal test\u201d passes although there are test failures", "body": "<p>I have a Cabal test target:</p>\n\n<pre><code>test-suite Tests\n  type:              exitcode-stdio-1.0\n  main-is:           Main.hs\n  hs-source-dirs:    test, src\n  build-depends:     base, \u2026\n  default-language:  Haskell2010\n</code></pre>\n\n<p>And a simple testing <code>Main.hs</code>:</p>\n\n<pre><code>import Test.HUnit\ntestSanity = TestCase $ assertEqual \"Should fail\" 2 1\nmain = runTestTT testSanity\n</code></pre>\n\n<p>Now running <code>cabal test</code> passes:</p>\n\n<pre><code>Test suite Tests: RUNNING...\nTest suite Tests: PASS\nTest suite logged to: dist/test/Project-0.1.0-Tests.log\n1 of 1 test suites (1 of 1 test cases) passed.\n</code></pre>\n\n<p>Even though there are failures correctly logged in the test suite log:</p>\n\n<pre><code>Test suite Tests: RUNNING...\n\nCases: 1  Tried: 0  Errors: 0  Failures: 0\n\n### Failure:\nShould fail\nexpected: 2\n but got: 1\nCases: 1  Tried: 1  Errors: 0  Failures: 1\nTest suite Tests: PASS\nTest suite logged to: dist/test/Project-0.1.0-Tests.log\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437225043, "post_id": 31488861, "comment_id": 50946557, "body": "&gt; There can be plenty of the functions foo in each module (foo1, foo2, etc) and I want to use them from both modules. There can also be datas with the same member names in each module, after all.  If it&#39;s really the case and you don&#39;t want to hide anything. The only solution is to import both modules qualified and not try to create an AB module exporting both"}, {"owner": {"reputation": 23981, "user_id": 2813589, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9axBj.jpg?s=128&g=1", "display_name": "\u30a2\u30ec\u30c3\u30af\u30b9", "link": "https://stackoverflow.com/users/2813589/%e3%82%a2%e3%83%ac%e3%83%83%e3%82%af%e3%82%b9"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437226725, "post_id": 31488861, "comment_id": 50946986, "body": "@mb14, what do you mean exactly?"}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "edited": false, "score": 2, "creation_date": 1437237162, "post_id": 31488861, "comment_id": 50949935, "body": "FWIW, I feel like it would have been more appropriate to add a \u201ccurrent answers are outdated\u201d bounty to the old question rather than ask a new question."}], "answers": [{"comments": [{"owner": {"reputation": 23981, "user_id": 2813589, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9axBj.jpg?s=128&g=1", "display_name": "\u30a2\u30ec\u30c3\u30af\u30b9", "link": "https://stackoverflow.com/users/2813589/%e3%82%a2%e3%83%ac%e3%83%83%e3%82%af%e3%82%b9"}, "edited": false, "score": 0, "creation_date": 1437211292, "post_id": 31489539, "comment_id": 50943279, "body": "<b>First you, as only one foo can be exported you have to decide which one you want to export as the bare foo</b> - I want to use both and there can be plenty of them."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 23981, "user_id": 2813589, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9axBj.jpg?s=128&g=1", "display_name": "\u30a2\u30ec\u30c3\u30af\u30b9", "link": "https://stackoverflow.com/users/2813589/%e3%82%a2%e3%83%ac%e3%83%83%e3%82%af%e3%82%b9"}, "edited": false, "score": 0, "creation_date": 1437219896, "post_id": 31489539, "comment_id": 50945286, "body": "I mean only one foo can be exported as bare <code>foo</code> (whatever the language). I understand you would like <code>A.foo</code> and <code>B.foo</code> but that two different names and none of them are bare <code>foo</code>. So you can have one <code>foo</code> but the other needs to have another name (example <code>Bfoo</code> or <code>B_foo</code> as <code>B.foo</code> is not possible)."}, {"owner": {"reputation": 23981, "user_id": 2813589, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9axBj.jpg?s=128&g=1", "display_name": "\u30a2\u30ec\u30c3\u30af\u30b9", "link": "https://stackoverflow.com/users/2813589/%e3%82%a2%e3%83%ac%e3%83%83%e3%82%af%e3%82%b9"}, "edited": false, "score": 0, "creation_date": 1437226669, "post_id": 31489539, "comment_id": 50946970, "body": "That&#39;s obvious. But the question is how to import them qualified or something."}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1437210829, "last_edit_date": 1437210829, "creation_date": 1437210151, "answer_id": 31489539, "question_id": 31488861, "link": "https://stackoverflow.com/questions/31488861/re-export-qualified-how-to-solve-it-nowadays-any-solution/31489539#31489539", "title": "Re-export qualified - how to solve it nowadays, any solution?", "body": "<p>There is no <em>new</em> solution, but there is still a solution.\nFirst you, as only one <code>foo</code> can be exported you have to decide which one you want to export as the bare <code>foo</code>. Then you just need to hide and alias the other one.</p>\n\n<pre><code>module Foo (\n  module Foo.A\n, module Foo.B\n, bFoo\n) where\n\nimport Foo.A\nimport Foo.B hiding (foo)\nimport qualified B as B\n\nbFoo = B.foo\n</code></pre>\n\n<p>Ok, it's not really elegant but it's a workaround if you really have to.</p>\n"}], "owner": {"reputation": 23981, "user_id": 2813589, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9axBj.jpg?s=128&g=1", "display_name": "\u30a2\u30ec\u30c3\u30af\u30b9", "link": "https://stackoverflow.com/users/2813589/%e3%82%a2%e3%83%ac%e3%83%83%e3%82%af%e3%82%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "closed_date": 1437243248, "answer_count": 1, "score": 5, "last_activity_date": 1437236896, "creation_date": 1437204133, "last_edit_date": 1495541167, "question_id": 31488861, "link": "https://stackoverflow.com/questions/31488861/re-export-qualified-how-to-solve-it-nowadays-any-solution", "closed_reason": "Duplicate", "title": "Re-export qualified - how to solve it nowadays, any solution?", "body": "<p>I have exactly the same issue as described in this question <a href=\"https://stackoverflow.com/questions/4385195/re-export-qualified\">Re-export qualified?</a></p>\n\n<blockquote>\n<pre><code>module Foo.A where\n\nfoo = 42\n</code></pre>\n  \n  <p>and</p>\n\n<pre><code>module Foo.B where\n\nfoo = 12\n</code></pre>\n  \n  <p>and you want to write a super module</p>\n\n<pre><code>module Foo (\n      module Foo.A\n    , module Foo.B\n    ) where\n\nimport Foo.A\nimport Foo.B\n</code></pre>\n  \n  <p>which re-exports those modules, you would get a name clash.</p>\n</blockquote>\n\n<p>It was asked 5 years ago, I suppose there might have been some changes since then. Have there been any? If not, there's still no solution for that?</p>\n\n<p>I do <strong>not</strong> consider Lens for resolving it.</p>\n\n<p><strong>UPDATE</strong>:</p>\n\n<p>There can be plenty of the functions <code>foo</code> in each module (foo1, foo2, etc) and I want to use them from both modules. There can also be <code>data</code>s with the same member names in each module, after all. </p>\n\n<p>So hiding isn't a solution. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 421, "user_id": 5098834, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a721c50859c0fd9002ea36f878338c9?s=128&d=identicon&r=PG&f=1", "display_name": "imatahi", "link": "https://stackoverflow.com/users/5098834/imatahi"}, "edited": false, "score": 0, "creation_date": 1437202467, "post_id": 31488623, "comment_id": 50941551, "body": "I&#39;m confused, which part of that &quot;imports&quot; and which &quot;re-exports&quot;?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 421, "user_id": 5098834, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a721c50859c0fd9002ea36f878338c9?s=128&d=identicon&r=PG&f=1", "display_name": "imatahi", "link": "https://stackoverflow.com/users/5098834/imatahi"}, "edited": false, "score": 0, "creation_date": 1437202718, "post_id": 31488623, "comment_id": 50941619, "body": "@imatahi <code>import</code> imports, and whatever is between the parentheses in <code>module Name ( ... )</code> is exported. If you export a module, everything which was imported from it is re-exported."}, {"owner": {"reputation": 421, "user_id": 5098834, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a721c50859c0fd9002ea36f878338c9?s=128&d=identicon&r=PG&f=1", "display_name": "imatahi", "link": "https://stackoverflow.com/users/5098834/imatahi"}, "edited": false, "score": 0, "creation_date": 1437202901, "post_id": 31488623, "comment_id": 50941658, "body": "Okay, But still I can&#39;t figure out how to apply that for my case."}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 1, "creation_date": 1437233488, "post_id": 31488623, "comment_id": 50948801, "body": "<code>module OneBase   ( module Data.Time   , module UUID   ) where  import Data.Time import UUID</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1437202067, "creation_date": 1437202067, "answer_id": 31488623, "question_id": 31488273, "link": "https://stackoverflow.com/questions/31488273/importing-a-number-of-modules-at-once/31488623#31488623", "title": "Importing a number of modules at once", "body": "<p>Here's an example, taken from <code>Control.Lens</code>, which achieves what you want: it imports everything in a base module and re-exports everything.</p>\n\n<pre><code>module Control.Lens\n  ( module Control.Lens.At\n  , module Control.Lens.Cons\n  , module Control.Lens.Each\n  -- ...\n  ) where\n\nimport Control.Lens.At\nimport Control.Lens.Cons\nimport Control.Lens.Each\n-- ...\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 5098834, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a721c50859c0fd9002ea36f878338c9?s=128&d=identicon&r=PG&f=1", "display_name": "imatahi", "link": "https://stackoverflow.com/users/5098834/imatahi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 31488623, "answer_count": 1, "score": 1, "last_activity_date": 1437202067, "creation_date": 1437199130, "question_id": 31488273, "link": "https://stackoverflow.com/questions/31488273/importing-a-number-of-modules-at-once", "title": "Importing a number of modules at once", "body": "<p>I have a number of modules under the same folder:</p>\n\n<pre><code>/src/Web/MyLib/Types/Entity1.hs\n/src/Web/MyLib/Types/Entity2.hs\n/src/Web/MyLib/Types/Entity3.hs\n\n...\n</code></pre>\n\n<p>Most of them require importing the same modules such as <code>Data.Time, UUID</code> and others. Instead of importing those models to <strong>each</strong> of the modules under <code>/src/Web/MyLib/Types/</code>, is there any way to create one <strong>base</strong> module, say, <code>/src/Web/MyLib/Types/Base.hs</code>, import all those modules (<code>Data.Time, UUID, ...</code>) to it and then only import <code>Base</code> to <code>EntityX</code>? I've tried it and failed. Maybe I did something wrong.</p>\n"}, {"tags": ["haskell", "dynamic-programming"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1437218070, "last_edit_date": 1437218070, "creation_date": 1437203405, "answer_id": 31488768, "question_id": 31487832, "link": "https://stackoverflow.com/questions/31487832/counting-change-in-haskell/31488768#31488768", "title": "Counting change in Haskell", "body": "<p>It's a direct translation of the imperative DP algorithm for the problem, which looks like this (in Python):</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def count(cents, coins):\n    solutions = [1] + [0]*cents # [1, 0, 0, 0, ... 0]\n    for coin in coins:\n        for i in range(coin, cents + 1):\n            solutions[i] += solutions[i - coin]\n    return solutions[cents]\n</code></pre>\n\n<p>In particular, <code>addCoin coin solutions</code> corresponds to</p>\n\n<pre><code>for i in range(coin, cents + 1):\n    solutions[i] += solutions[i - coin]\n</code></pre>\n\n<p>except that <code>addCoin</code> returns a modified list instead of mutating the old one. As to the Haskell version, the result should have an unchanged section at the beginning until the <code>coin</code>-th element, and after that we must implement <code>solutions[i] += solutions[i - coin]</code>. </p>\n\n<p>We realize the unchanged part by <code>take c oldlist</code> and the modified part by <code>zipWith (+) newlist (drop c oldlist)</code>. In the modified part we add together the <code>i</code>-th elements of the old list and <code>i - coin</code>-th elements of the resulting list. The shifting of indices is implicit in the <code>drop</code> and <code>take</code> operations. </p>\n\n<p>A simpler, classic example for this kind of shifting and recursive definition is the Fibonacci numbers:</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>We would write this imperatively as</p>\n\n<pre><code>def fibs(limit):\n    res = [0, 1] + [0]*(limit - 2)\n    for i in range(2, limit):\n        res[i] = res[i - 2] + res[i - 1]\n    return res\n</code></pre>\n\n<p>Turning back to coin change, <code>foldr addCoin (1:repeat 0)</code> corresponds to the initialization of <code>solutions</code> and the for loop on the coins, with the change that the initial list is infinite instead of finite (because laziness lets us do that). </p>\n"}], "owner": {"reputation": 275, "user_id": 1953221, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2949d31fc450441a1fa42423eb931ac0?s=128&d=identicon&r=PG", "display_name": "user1953221", "link": "https://stackoverflow.com/users/1953221/user1953221"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 850, "favorite_count": 1, "accepted_answer_id": 31488768, "answer_count": 1, "score": 7, "last_activity_date": 1437218070, "creation_date": 1437194107, "question_id": 31487832, "link": "https://stackoverflow.com/questions/31487832/counting-change-in-haskell", "title": "Counting change in Haskell", "body": "<p>I came across the following solution to the DP problem of <a href=\"http://www.algorithmist.com/index.php/Coin_Change\">counting change</a>:</p>\n\n<pre><code>count' :: Int -&gt; [Int] -&gt; Int\ncount' cents coins = aux coins !! cents\n  where aux = foldr addCoin (1:repeat 0)\n          where addCoin c oldlist = newlist\n                  where newlist = (take c oldlist) ++ zipWith (+) newlist (drop c oldlist)\n</code></pre>\n\n<p>It ran much faster than my naive top-down recursive solution, and I'm still trying to understand it.</p>\n\n<p>I get that given a list of coins, <code>aux</code> computes every solution for the positive integers. Thus the solution for an amount is to index the list at that position.</p>\n\n<p>I'm less clear on <code>addCoin</code>, though. It somehow uses the value of each coin to draw elements from the list of coins? I'm struggling to find an intuitive meaning for it.</p>\n\n<p>The fold in <code>aux</code> also ties my brain up in knots. Why is <code>1:repeat 0</code> the initial value? What does it represent?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 10203, "user_id": 4672588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edcbc85fb3b43202dab37afb2bd5281e?s=128&d=identicon&r=PG&f=1", "display_name": "cpplearner", "link": "https://stackoverflow.com/users/4672588/cpplearner"}, "edited": false, "score": 2, "creation_date": 1437181642, "post_id": 31486747, "comment_id": 50938020, "body": "<code>execute :: [Instruction] -&gt; State -&gt; Pointer -&gt; State</code> is equivalent to <code>execute :: [Instruction] -&gt; (State -&gt; Pointer -&gt; State)</code> and not to <code>execute :: ([Instruction] -&gt; State -&gt; Pointer) -&gt; State</code>, if I recall correctly."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 3342240, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7176b48e45597d3a8a206e2f358f497?s=128&d=identicon&r=PG&f=1", "display_name": "davenportw15", "link": "https://stackoverflow.com/users/3342240/davenportw15"}, "edited": false, "score": 0, "creation_date": 1437188658, "post_id": 31486792, "comment_id": 50939079, "body": "Thanks for the great answer. I was originally looking for a way to shorten the signature without changing the implementation, but using a tuple/record will certainly shorten it while making the implementation better."}], "tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": true, "score": 3, "last_activity_date": 1437182641, "last_edit_date": 1437182641, "creation_date": 1437181727, "answer_id": 31486792, "question_id": 31486747, "link": "https://stackoverflow.com/questions/31486747/define-haskell-type-with-multiple-contained-types/31486792#31486792", "title": "Define Haskell type with multiple contained types", "body": "<p>Your type synonym is actually a function type (of 2 arguments, uncurried). So when you have a function</p>\n\n<pre><code>fun :: Programm -&gt; State\nfun p = ...\n</code></pre>\n\n<p>that <code>p</code> is a function that needs 2 arguments, namely one <code>[Instruction]</code> and one <code>State</code> to produce a <code>Pointer</code>. But you only get the function, not the needed instructions nor the state. (And no pointer, only if this can be computed from the instructions and the state, but then why have it as parameter to the original function...)</p>\n\n<p>What you seem to want is packing three arguments into one. A tuple is good therefore:</p>\n\n<pre><code>type Program = ([Instruction], State, Pointer)\n</code></pre>\n\n<p>Or use record syntax:</p>\n\n<pre><code>data Program = Program {\n  instructionsOf :: [Instruction],\n  stateOf :: State,\n  pointerOf :: Pointer }\n</code></pre>\n\n<p>Then your code comes closer to English:</p>\n\n<pre><code>fun :: Program -&gt; State\nfun program = run (instructionsOf program)  -- or whatever\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 3342240, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7176b48e45597d3a8a206e2f358f497?s=128&d=identicon&r=PG&f=1", "display_name": "davenportw15", "link": "https://stackoverflow.com/users/3342240/davenportw15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 31486792, "answer_count": 1, "score": 0, "last_activity_date": 1437182641, "creation_date": 1437181125, "question_id": 31486747, "link": "https://stackoverflow.com/questions/31486747/define-haskell-type-with-multiple-contained-types", "title": "Define Haskell type with multiple contained types", "body": "<p>My goal is to replace a signature like</p>\n\n<pre><code>execute :: [Instruction] -&gt; State -&gt; Pointer -&gt; State\n</code></pre>\n\n<p>with</p>\n\n<pre><code>execute :: Program -&gt; State\n</code></pre>\n\n<p>I created the type synonym</p>\n\n<pre><code>type Program = [Instruction] -&gt; State -&gt; Pointer\n</code></pre>\n\n<p>When I define the implementation (e.g. <code>execute [] s _ = s</code>), I receive the following compile error:</p>\n\n<pre><code>Couldn't match expected type \u2018State -&gt; Pointer -&gt; State\u2019\n            with actual type \u2018[Int]\u2019\nThe equation(s) for \u2018execute\u2019 have three arguments,\nbut its type \u2018Program -&gt; State\u2019 has only one\n</code></pre>\n\n<p>Without replacing <code>[Instruction] -&gt; State -&gt; Pointer</code> with <code>Program</code>, it compiles. It appears to attempt to match the <code>Program</code> type to only the first argument. Is there a way to  match the <code>Program</code> type over the first three arguments?</p>\n"}, {"tags": ["haskell", "functor", "boolean-logic", "applicative"], "comments": [{"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 2, "creation_date": 1437168390, "post_id": 31484936, "comment_id": 50934783, "body": "This belongs on <a href=\"http://codegolf.stackexchange.com/\">codegolf.stackexchange.com</a>"}, {"owner": {"reputation": 615, "user_id": 3571042, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eafffaef76417c2adafb5a351bc15ecb?s=128&d=identicon&r=PG&f=1", "display_name": "davik", "link": "https://stackoverflow.com/users/3571042/davik"}, "reply_to_user": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 1, "creation_date": 1437168525, "post_id": 31484936, "comment_id": 50934826, "body": "Does it? I wasn&#39;t sure because it is language specific and I thought codegolf was more of a fun challenge type whereas here I am more trying to learn how to write shorter code with Functors."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437169181, "post_id": 31484936, "comment_id": 50935062, "body": "you can make <code>xor</code> with <code>(||)</code> and <code>not</code>: <code>xor a b = not $ not (not a || not b) || not (a || b) </code> which reduces to <code>(not .) . ap (ap . (((||) . not) .) . (. not) . (||) . not) ((not .) . (||))</code> wich can be written as <code>(not &lt;$&gt;) &lt;$&gt; (&lt;*&gt;) ((&lt;*&gt;) &lt;$&gt; (((||) &lt;$&gt; not) &lt;$&gt;) &lt;$&gt; (&lt;$&gt; not) &lt;$&gt; (||) &lt;$&gt; not) ((not &lt;$&gt;) &lt;$&gt; (||))</code>. Is this short enough for you?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 9, "creation_date": 1437170932, "post_id": 31484936, "comment_id": 50935606, "body": "<code>xor = (&#47;=)</code>..."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437300439, "post_id": 31485211, "comment_id": 50963243, "body": "Erm, is this supposed to look like Perl code, or rather Brainfuck?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437300463, "post_id": 31485211, "comment_id": 50963248, "body": "@leftaroundabout Aw yeah!"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 3, "last_activity_date": 1437169640, "creation_date": 1437169640, "answer_id": 31485211, "question_id": 31484936, "link": "https://stackoverflow.com/questions/31484936/write-xor-in-haskell-with-functors/31485211#31485211", "title": "Write XOR in haskell with functors", "body": "<p>Okay, this is really pointless and silly, but hey-ho.</p>\n\n<p>First, I defined <code>xor</code> in terms of <code>&amp;&amp;</code>, <code>not</code> and <code>||</code>:</p>\n\n<pre><code>xor a b = (a || b) &amp;&amp; (not a || not b)\n</code></pre>\n\n<p>Then if I use the fact that <code>(&amp;&amp;) a b = not (not a || not b)</code>...</p>\n\n<pre><code>xor a b = not ( not (not a || not b) || not (a || b) )\n</code></pre>\n\n<p>Which is low-level enough. Then, I ran it through <a href=\"https://evening-thicket-5270.herokuapp.com\" rel=\"nofollow\"><code>pointfree</code></a> to get this:</p>\n\n<pre><code>xor = (not .) . ap (ap . (((||) . not) .) . (. not) . (||) . not) ((not .) . (||))\n</code></pre>\n\n<p>Now, <code>ap</code> from <code>Control.Monad</code> is the monadic equivalent to <code>(&lt;*&gt;)</code>, and <code>(.)</code> is <code>(&lt;$&gt;)</code> in the function monad, so we can replace a few things:</p>\n\n<pre><code>xor = (not&lt;$&gt;)&lt;$&gt;(&lt;*&gt;)((&lt;*&gt;)&lt;$&gt;(((||)&lt;$&gt;not)&lt;$&gt;)&lt;$&gt;(&lt;$&gt;not)&lt;$&gt;(||)&lt;$&gt; not)((not&lt;$&gt;)&lt;$&gt;(||))\n</code></pre>\n\n<p>And voila, a really ridiculously stupid function that will achieve nothing special! Knock yourself out.</p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437212425, "post_id": 31485657, "comment_id": 50943539, "body": "Nice one! I couldn&#39;t find a way to write it by hand, but this is great!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1437172697, "last_edit_date": 1437172697, "creation_date": 1437172391, "answer_id": 31485657, "question_id": 31484936, "link": "https://stackoverflow.com/questions/31484936/write-xor-in-haskell-with-functors/31485657#31485657", "title": "Write XOR in haskell with functors", "body": "<p>Here is a solution which you could conceivably write by hand (and read, with a bit of guidance!). As @AJFarmar noted, we can write</p>\n\n<pre><code>xor a b = (a || b) &amp;&amp; (not a || not b)\n</code></pre>\n\n<p>and I will use the rewrite he suggested as well, namely <code>a &amp;&amp; b = not (not a || not b)</code>, though in the opposite direction he did:</p>\n\n<pre><code>xor a b = (a || b) &amp;&amp; not (a &amp;&amp; b)\n</code></pre>\n\n<p>You can follow the process below for other definitions, but this one is a particularly short starting definition.</p>\n\n<p>Now we can pick out the chunks <code>a || b</code> and <code>a &amp;&amp; b</code> and, instead of thinking of them as values of type <code>Bool</code> in an environment with <code>a :: Bool</code> and <code>b :: Bool</code>, transform them into a form where we think of them as values of type <code>Bool</code> with two <code>Applicative</code> \"context\" wrappers. Thus <code>(||) :: f (g Bool)</code> and <code>(&amp;&amp;) :: f (g Bool)</code>, where <code>f</code> and <code>g</code> are the particular <code>Applicative</code> instance <code>(-&gt;) Bool</code>. So we are in the partially translated state</p>\n\n<pre><code>xor = (||) &amp;&amp; not (&amp;&amp;)\n</code></pre>\n\n<p>The only problem now is that the infix <code>&amp;&amp;</code> and the <code>not</code> expect pure <code>Bool</code> values, but are being handed doubly-wrapped <code>Bool</code>s. So we will lift them using double <code>liftA*</code> applications. Thus:</p>\n\n<pre><code>xor = liftA2 (liftA2 (&amp;&amp;)) (||) (liftA (liftA not) (&amp;&amp;))\n</code></pre>\n\n<p>There are other ways to spell this, too. I prefer the name <code>(&lt;$&gt;)</code> to <code>liftA</code>. Also, one can think of doubly-wrapped <code>Applicative</code>s as singly wrapped things with a more complicated wrapper, thus:</p>\n\n<pre><code>xor = getCompose (liftA2 (&amp;&amp;) (Compose (||)) (not &lt;$&gt; Compose (&amp;&amp;)))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1437212365, "post_id": 31488825, "comment_id": 50943531, "body": "Haha, that&#39;s a good point, but for argument&#39;s sake, let&#39;s go with the functor route."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1437203869, "creation_date": 1437203869, "answer_id": 31488825, "question_id": 31484936, "link": "https://stackoverflow.com/questions/31484936/write-xor-in-haskell-with-functors/31488825#31488825", "title": "Write XOR in haskell with functors", "body": "<pre><code>xor = (/=)\n</code></pre>\n\n<p>Why make it more complicated?</p>\n"}], "owner": {"reputation": 615, "user_id": 3571042, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eafffaef76417c2adafb5a351bc15ecb?s=128&d=identicon&r=PG&f=1", "display_name": "davik", "link": "https://stackoverflow.com/users/3571042/davik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1044, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1437240105, "creation_date": 1437168244, "question_id": 31484936, "link": "https://stackoverflow.com/questions/31484936/write-xor-in-haskell-with-functors", "title": "Write XOR in haskell with functors", "body": "<p>I'm relatively new to haskell and I just recently learned about Applicative Functors and I made this code for xor with only functors and boolean functions. I'm wondering if you guys can come up with a shorter solution (which I'm sure exists) with functors. </p>\n\n<pre><code>xor :: Bool-&gt;Bool-&gt;Bool\nxor=(&lt;$&gt;) (not&lt;$&gt;) ((&lt;*&gt;).((((not&lt;$&gt;)&lt;$&gt;(&amp;&amp;))&lt;$&gt;)&lt;$&gt;((not&lt;$&gt;)&lt;$&gt;(&amp;&amp;)))&lt;*&gt;(||))\n</code></pre>\n\n<p>I know this probably isn't very good practice; it was more of a brain-teaser for me. </p>\n\n<p>PS I hope this is allowed here</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1437174372, "post_id": 31484511, "comment_id": 50936470, "body": "Any reason you can&#39;t use &quot;reverse&quot;?"}, {"owner": {"reputation": 527, "user_id": 4912976, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/20f1f3818f5ffe2e879ca32d0e05dc4f?s=128&d=identicon&r=PG&f=1", "display_name": "freefall", "link": "https://stackoverflow.com/users/4912976/freefall"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1437206229, "post_id": 31484511, "comment_id": 50942259, "body": "No particular reason. As I wrote, I am just learning and I wanted to implement this &quot;my&quot; way, not the &quot;best&quot; or the &quot;correct&quot; way. I just want to better understand the language. Perhaps I will tackle this problem with the reverse function within a few minutes. So thank you for pointing this out. :)"}], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 3, "last_activity_date": 1437166706, "creation_date": 1437166706, "answer_id": 31484611, "question_id": 31484511, "link": "https://stackoverflow.com/questions/31484511/pick-the-second-last-element-of-the-list/31484611#31484611", "title": "Pick the second last element of the list", "body": "<p>You have multiple errors here.</p>\n\n<p>First, call syntax binds to the left, which means that <code>lastButOne head xs</code> means \"call <code>lastButOne</code> with two arguments, <code>head</code> and <code>xs</code>\", instead of the \"call <code>lastButOne</code> with the result of calling <code>head</code> with <code>xs</code>\".</p>\n\n<p>Second, your function returns a list, even though your description says it should return a single element.</p>\n\n<p>Third, the call <code>lastButOne (head xs)</code> is also a type error, since <code>head</code> returns a single element, but <code>lastButOne</code> expects a list. I believe you meant to simply write <code>head xs</code> here.</p>\n\n<p>But then you get to the fourth error, which is that the first two branches of your function actually return the entire list, which they can't if you want to return a single element.</p>\n\n<p>You also need to think about what the function <em>should</em> return when it isn't at least two elements long. Should it crash, as <code>head</code> does? Or should you actually change the result type to <code>Maybe a</code> and return <code>Nothing</code>?</p>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1437197174, "post_id": 31484621, "comment_id": 50940482, "body": "what&#39;s wrong with doing <code>lst !! (length lst - 2)</code> as the 3rd case? saves you recursion"}, {"owner": {"reputation": 527, "user_id": 4912976, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/20f1f3818f5ffe2e879ca32d0e05dc4f?s=128&d=identicon&r=PG&f=1", "display_name": "freefall", "link": "https://stackoverflow.com/users/4912976/freefall"}, "edited": false, "score": 0, "creation_date": 1437206395, "post_id": 31484621, "comment_id": 50942291, "body": "Thank you for the answer. I haven&#39;t read about the pattern matching yet, that&#39;s why I am using guards."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1437236094, "post_id": 31484621, "comment_id": 50949583, "body": "@ElectricCoffee, it&#39;s slower and also less obviously total than the pattern matching version."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1487155752, "post_id": 31484621, "comment_id": 71652684, "body": "<code>xs !! (length xs - 2)</code> could be more efficient if <code>!!</code> was random-access. Haskell&#39;s standard <code>[]</code> data type denotes a recursive access-O(n) linked-list data structure. <code>length</code> is \u0398(n). Both <code>!!</code> and <code>length</code> are defined using recursion. Don&#39;t avoid recursion in Haskell; learn when and how to use it."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 6, "last_activity_date": 1437166738, "creation_date": 1437166738, "answer_id": 31484621, "question_id": 31484511, "link": "https://stackoverflow.com/questions/31484511/pick-the-second-last-element-of-the-list/31484621#31484621", "title": "Pick the second last element of the list", "body": "<p><code>(head xs)</code> returns an <code>a</code> and you're trying to pass it to <code>lastButOne</code> which requires a <code>[a]</code> argument. You could just return <code>head xs</code> directly in this case. You also have a problem with the first two cases since they return a list, while an element is required. Since there is no such element in this cases you could return an error:</p>\n\n<pre><code>lastButOne :: [a] -&gt; a\nlastButOne xs \n    | null xs = error \"empty list\"\n    | length xs == 1 = error \"list too short\"\n    | length xs == 2 = head xs\n    | otherwise = lastButOne (tail xs)\n</code></pre>\n\n<p>are more functional solution would be to encode the partiality in the function type and return a <code>Maybe a</code> so you can return <code>Nothing</code> if the input list is too short:</p>\n\n<pre><code>lastButOne :: [a] -&gt; Maybe a\nlastButOne xs \n    | null xs = Nothing\n    | length xs == 1 = Nothing\n    | length xs == 2 = Just (head xs)\n    | otherwise = lastButOne (tail xs)\n</code></pre>\n\n<p>finally, a better solution would be to use pattern matching instead of guarding on the length:</p>\n\n<pre><code>lastButOne :: [a] -&gt; Maybe a\nlastButOne [] = Nothing\nlastButOne [_] = Nothing\nlastButOne [x,_] = Just x\nlastButOne (_:xs) = lastButOne xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1503543692, "post_id": 38742766, "comment_id": 78662555, "body": "Do you understand why this is very slow?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503578674, "post_id": 38742766, "comment_id": 78682088, "body": "Hint: you call <code>length</code>."}], "tags": [], "owner": {"reputation": 3330, "user_id": 5690400, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/df85cd18b27e10c099421de04875ee41?s=128&d=identicon&r=PG&f=1", "display_name": "Dari", "link": "https://stackoverflow.com/users/5690400/dari"}, "is_accepted": false, "score": 0, "last_activity_date": 1470224977, "creation_date": 1470224977, "answer_id": 38742766, "question_id": 31484511, "link": "https://stackoverflow.com/questions/31484511/pick-the-second-last-element-of-the-list/38742766#38742766", "title": "Pick the second last element of the list", "body": "<p>I am newbie to Haskell, however this is solution I did:</p>\n\n<pre><code>lastButOne xs = if null xs || length xs == 1\n            then []\n            else\n                if length xs == 2\n                then head xs\n                else lastButOne (tail xs)\n</code></pre>\n"}], "owner": {"reputation": 527, "user_id": 4912976, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/20f1f3818f5ffe2e879ca32d0e05dc4f?s=128&d=identicon&r=PG&f=1", "display_name": "freefall", "link": "https://stackoverflow.com/users/4912976/freefall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3371, "favorite_count": 0, "accepted_answer_id": 31484621, "answer_count": 3, "score": 3, "last_activity_date": 1566737082, "creation_date": 1437166243, "last_edit_date": 1437214636, "question_id": 31484511, "link": "https://stackoverflow.com/questions/31484511/pick-the-second-last-element-of-the-list", "title": "Pick the second last element of the list", "body": "<p>After some time I've decied to back to learning some functional programming. I've decided to pick Haskell this time, because of its features and .. syntax. </p>\n\n<p>At the moment I am doing some exercises and I am stuck. I want to write a function that picks second last element from the list, i.e. given [1,2,3,4] it would 3.</p>\n\n<p>Here's my function.</p>\n\n<pre><code>lastButOne xs \n    | null xs = xs \n    | length xs == 1 = xs \n    | length xs == 2 = lastButOne head xs\n    | otherwise = lastButOne tail xs\n</code></pre>\n\n<p>Unfortunately it yields some errors.</p>\n\n<pre><code>Couldn't match expected type `[a]' with actual type `[a1] -&gt; [a1]'\nRelevant bindings include\n  xs :: [a] (bound at lastButOne.hs:1:12)\n  lastButOne :: [a] -&gt; [a] (bound at lastButOne.hs:1:1)\nProbable cause: `tail' is applied to too few arguments\nIn the first argument of `lastButOne', namely `tail'\nIn the expression: lastButOne tail xs\n</code></pre>\n\n<p>I've tried with some parthness, like (head xs) and (tail xs), but it doesn't help.</p>\n\n<pre><code>   Occurs check: cannot construct the infinite type: a ~ [a]\n   Expected type: [[a]]\n     Actual type: [a]\n   Relevant bindings include\n     xs :: [a] (bound at lastButOne.hs:1:12)\n     lastButOne :: [a] -&gt; [a] (bound at lastButOne.hs:1:1)\n   In the first argument of `head', namely `xs'\n   In the first argument of `lastButOne', namely `(head xs)'\n</code></pre>\n\n<p><strong>Follow-up</strong>:\nOr should I write Follow-up's. Well, my orginal idea was to write a function that yields head element if list length is one. So given the Lee's explanation it's easy to come up with the following:</p>\n\n<pre><code>lastPattern :: [a] -&gt; Maybe a\nlastPattern [] = Nothing\nlastPattern [x] = Just x\nlastPattern [x,_] = Just x\nlastPattern (_:xs) = lastPattern xs\n</code></pre>\n\n<p>Ane here's the first question. <em>What is the pattern for both conditions [x] and [x,_]</em>?</p>\n\n<p>Next thing I wanted to do is to write the same function with the reverse (as pointed out by Paul Johnson). I quickly came up with <code>head (tail (reverse [1,2,3,4]))</code> which seemed to work fine in the REPL. But when I started some coding I end up with</p>\n\n<pre><code> lastRev :: [a] -&gt; a\nlastRev xs \n    | null xs = error \"empty list\"\n    | length xs == 1 = error \"too short\"\n    | otherwise = head (tail (reverse xs))\n</code></pre>\n\n<p>since the head function is <code>head :: [a] -&gt; a</code> . The above function is a little mess for my taste, so to say. <em>Is there any way I could make it to be <code>:: [a] -&gt; Maybe a</code> ?</em> That's the second question.</p>\n\n<p>Last but not least - the third question. <em>Which function is better in terms of performance? How can I measure it in Haskell?</em></p>\n"}, {"tags": ["function", "haskell", "types", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437164707, "post_id": 31484017, "comment_id": 50933379, "body": "Note: <code>[char] s =</code> is incorrect, it&#39;s really <code>char s =</code>. Implementing a <code>Printable</code> instance for lists, or at least for <code>[Char]</code>, <a href=\"http://stackoverflow.com/questions/5941701/why-can-i-not-make-string-an-instance-of-a-typeclass\">would be tricky</a>, I suppose."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437164794, "post_id": 31484017, "comment_id": 50933422, "body": "@9000 Oh, whoops, thanks for pointing that out! Should be fixed now. It&#39;s not tricky, though this approach does require the <code>FlexibleInstances</code> extension. There are more complicated approaches that avoid extensions; e.g. see <code>showList</code> and its history for the core idea."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437165336, "post_id": 31484017, "comment_id": 50933679, "body": "Well, yes. Just printing lists is perfectly doable. I wonder if it is possible at all to make a <code>Printable</code> that prints <code>&quot;[foo] = ...&quot;</code> if called with an argument of type <code>[foo]</code>, without just defining an instance for every supported case (via <code>FlexibleInstances</code>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437165548, "post_id": 31484017, "comment_id": 50933755, "body": "@9000 It is possible, yes, and even fairly easy. For example, my one-line <code>printWithType</code> function does it. You can replicate and specialize the core ideas of <code>printWithType</code> to make a leaner typeclass than <code>Typeable</code>, but the basic idea is the same."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437165621, "post_id": 31484017, "comment_id": 50933783, "body": "@9000 Perhaps the key insight you&#39;re missing is that one can write something like <code>instance Foo a =&gt; Foo [a]</code> to handle all types of lists in one go (provided the element types implement some type class). I&#39;m not too sure, though; maybe you would like to open a fresh question with the details of what you&#39;re wondering?"}, {"owner": {"reputation": 79, "user_id": 5122746, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/97f4b3d26b8de56a948c0c679a23c8ff?s=128&d=identicon&r=PG&f=1", "display_name": "Cap", "link": "https://stackoverflow.com/users/5122746/cap"}, "edited": false, "score": 0, "creation_date": 1438078049, "post_id": 31484017, "comment_id": 51288813, "body": "After working/thinking for years with imperative programming models changing to functional will take a lot of practice and effort. Help from others as here and others eases this. For now these responses are sufficient for me. Thanks!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1437164777, "last_edit_date": 1437164777, "creation_date": 1437164182, "answer_id": 31484017, "question_id": 31483673, "link": "https://stackoverflow.com/questions/31483673/haskell-pattern-matching-for-function-parameters/31484017#31484017", "title": "Haskell pattern matching for function parameters", "body": "<p>Type classes provide something similar to that:</p>\n\n<pre><code>class Printable a where printit :: a -&gt; IO ()\ninstance Printable Int    where printit i = print $ \"Int i = \"    ++ show i\ninstance Printable [Char] where printit s = print $ \"[char] s = \" ++ show s\n</code></pre>\n\n<p>You probably want <code>putStrLn</code> instead of <code>print</code> in both implementations. You may also like the <code>Typeable</code> class; one could write</p>\n\n<pre><code>printWithType :: (Show a, Typeable a) =&gt; a -&gt; IO ()\nprintWithType v = putStrLn $ show v ++ \" :: \" ++ show (typeOf v)\n</code></pre>\n\n<p>...which behaves thus:</p>\n\n<pre><code>&gt; printWithType 3\n3 :: Integer\n&gt; printWithType \"foo\"\n\"foo\" :: [Char]\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 5122746, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/97f4b3d26b8de56a948c0c679a23c8ff?s=128&d=identicon&r=PG&f=1", "display_name": "Cap", "link": "https://stackoverflow.com/users/5122746/cap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 31484017, "answer_count": 1, "score": 1, "last_activity_date": 1437169885, "creation_date": 1437162677, "last_edit_date": 1437169885, "question_id": 31483673, "link": "https://stackoverflow.com/questions/31483673/haskell-pattern-matching-for-function-parameters", "title": "Haskell pattern matching for function parameters", "body": "<p>Is pattern matching not allowed for types to be matched as in the\nfollowing example?</p>\n\n<pre><code>printit :: Int -&gt; IO ()\nprintit i = print $ \"Int i = \" ++ show i\n\nprintit :: [Char] -&gt; IO ()\nprintit s = print $ \"[char] s = \" ++ show s\n\nmain :: IO ()\nmain = do\n    printit 2\n    printit \"two\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437153176, "post_id": 31481037, "comment_id": 50927583, "body": "What do you mean by tiles? How do you implement the matrix? Is it a list of lists? <code>every</code> has type <code>Int -&gt; [a] -&gt; [a]</code>, so I&#39;m not seeing matrix-ey things so far."}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437153225, "post_id": 31481037, "comment_id": 50927614, "body": "@Andr&#225;sKov&#225;cs currently I am using flat matrix. Tiles are e.g. region 2x2 starting at (1, 1)"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437154124, "post_id": 31481037, "comment_id": 50928069, "body": "I think that you should implement a 1-dimensional case (using <code>drop</code> and <code>take</code>), then it would be relatively easy to extend to n-dimensional case. Extract the rows dimension, from each row in a batch extract row spans and build tiles from them."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1437155074, "post_id": 31481037, "comment_id": 50928596, "body": "You should give an example (like for 2-d or 3-d matrix) of the input and desired output - that would answer a lot of questions."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437155855, "post_id": 31481037, "comment_id": 50928982, "body": "So your 2D matrix is a 1D list with dimensions attached? Is this a principal requirement?"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1437158739, "post_id": 31481037, "comment_id": 50930466, "body": "@9000 yes, but it is possible to convert between Matrix and Vector using Numeric.Matrix package as proposed by NovaDenizen"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1437159187, "post_id": 31482182, "comment_id": 50930734, "body": "That package is for... well, numeric matrices. Considering the asker uses the term &#39;tiles&#39;, I imagine he&#39;s really talking about grid like structure rather than a real matrix."}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1437159300, "post_id": 31482182, "comment_id": 50930793, "body": "@Cubic asker has in mind arbitrary tiles on a numeric matrices. I believe it can be seen from the example"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1437159906, "post_id": 31482182, "comment_id": 50931091, "body": "I also found out about <code>Data.Matrix</code>, it has <code>submatrix</code> function"}, {"owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "edited": false, "score": 0, "creation_date": 1437161002, "post_id": 31482182, "comment_id": 50931601, "body": "I do not quite understand how Numeric.Matrix.select works using just two indices, would appreciate some example"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1437164992, "post_id": 31482182, "comment_id": 50933515, "body": "<code>select</code> was the wrong function.  I&#39;ve edited my answer."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": true, "score": 0, "last_activity_date": 1437164963, "last_edit_date": 1437164963, "creation_date": 1437156836, "answer_id": 31482182, "question_id": 31481037, "link": "https://stackoverflow.com/questions/31481037/numeric-matrix-tiles-in-haskell/31482182#31482182", "title": "Numeric matrix tiles in Haskell", "body": "<p>You might instead want to use <a href=\"https://hackage.haskell.org/package/bed-and-breakfast-0.4.3/docs/Numeric-Matrix.html\" rel=\"nofollow\">Numeric.Matrix</a> from the bed-and-breakfast package.  It's a lot more efficient and has a good way of constructing a submatrix (fixed, select was inappropriate).</p>\n\n<pre><code>getTile height width x y m = matrix getElem (height,width) where\n    getElem (i,j) = m `at` (i+x-1, j+y-1)\n</code></pre>\n\n<p>Numeric.Matrix uses 1-based indexing, so that might complicate matters a little.</p>\n"}, {"tags": [], "owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "is_accepted": false, "score": 0, "last_activity_date": 1437220919, "last_edit_date": 1437220919, "creation_date": 1437182364, "answer_id": 31486844, "question_id": 31481037, "link": "https://stackoverflow.com/questions/31481037/numeric-matrix-tiles-in-haskell/31486844#31486844", "title": "Numeric matrix tiles in Haskell", "body": "<p><a href=\"https://hackage.haskell.org/package/matrix-0.2.1/docs/Data-Matrix.html#v:submatrix\" rel=\"nofollow\">submatrix</a></p>\n\n<pre><code>import Data.Matrix\n\nlet flat_matrix=[1,2,3,4,5,6,7,8,9,10]\nlet mat = Data.Matrix.fromList width height flat_matrix\nlet tile = submatrix start_row end_row start_column end_column mat\n</code></pre>\n"}], "owner": {"reputation": 3209, "user_id": 1276374, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/7ce4a877cf573491b23fc6aa1bf18a1d?s=128&d=identicon&r=PG", "display_name": "Boris Mocialov", "link": "https://stackoverflow.com/users/1276374/boris-mocialov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 31482182, "answer_count": 2, "score": 1, "last_activity_date": 1437220919, "creation_date": 1437152445, "last_edit_date": 1437220881, "question_id": 31481037, "link": "https://stackoverflow.com/questions/31481037/numeric-matrix-tiles-in-haskell", "title": "Numeric matrix tiles in Haskell", "body": "<p>Having a numeric matrix, how can tiles be extracted from it using Haskell?</p>\n\n<hr>\n\n<p>Example:</p>\n\n<pre><code>Int -&gt; Int -&gt; Int -&gt; Int -&gt; [Int] -&gt; Int -&gt; Int -&gt; [Int]\ngetTile height width x y xs matrix_height matrix_width = ...\ngetTile 2 2 1 1 [1,2,3,4,5,\n                 6,7,8,9,10] 2 5 = [2,3\n                                    7,8]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1437152512, "post_id": 31480639, "comment_id": 50927271, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+b%29+-%3E+c+-%3E+%28a+-%3E+b%29\" rel=\"nofollow noreferrer\">hoogle</a> can also be helpful for questions like this, although it does really poorly in this case"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1437152677, "post_id": 31480639, "comment_id": 50927349, "body": "tried this exact signature, didn&#39;t find anything"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1437154002, "post_id": 31480639, "comment_id": 50928012, "body": "that&#39;s what I meant by &quot;it does really poorly in this case&quot;, sorry. I think hoogle should be trying to capture common terms and return the most general functions satisfying those types first, but it doesn&#39;t seem to do that"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 12, "last_activity_date": 1437151165, "creation_date": 1437151165, "answer_id": 31480680, "question_id": 31480639, "link": "https://stackoverflow.com/questions/31480639/is-there-a-standard-haskell-function-that-prepends-an-extra-parameter-to-a-funct/31480680#31480680", "title": "Is there a standard Haskell function that prepends an extra parameter to a function", "body": "<p>It's called <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:const\"><code>const</code></a>:</p>\n\n<pre><code>&gt; let foo = const :: (a -&gt; b) -&gt; (c -&gt; a -&gt; b)\n</code></pre>\n"}], "owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1437151165, "creation_date": 1437151023, "question_id": 31480639, "link": "https://stackoverflow.com/questions/31480639/is-there-a-standard-haskell-function-that-prepends-an-extra-parameter-to-a-funct", "title": "Is there a standard Haskell function that prepends an extra parameter to a function", "body": "<p>I have a function <code>a-&gt;b</code> which is to be passed to something of <code>(c-&gt;a-&gt;b)</code> signature. I don't care about <code>c</code> will just ignore it. Is there a standard function that prepends useless parameters: <code>(a-&gt;b) -&gt; (c-&gt;a-&gt;b)</code> ?</p>\n"}, {"tags": ["haskell", "types", "match", "main", "quicksort"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1437149582, "post_id": 31479939, "comment_id": 50925627, "body": "Thank YOU. Problem is that now i dont get time of algorithm but time of algorithm and time of printing."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1437149805, "post_id": 31479939, "comment_id": 50925748, "body": "@MatejKr I have updated the answer to not use printing and instead force the computation using Bang operator."}, {"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1437150049, "post_id": 31479939, "comment_id": 50925902, "body": "Why do I get illegal bang-pattern (use BangPattern). I am a new guy at haskell Thanks"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 1, "creation_date": 1437150132, "post_id": 31479939, "comment_id": 50925943, "body": "@MatejKr Put <code>{-#LANGUAGE BangPatterns#-}</code> on top of your file."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1437153202, "post_id": 31479939, "comment_id": 50927597, "body": "The bang pattern is not correct here. It will not force full evaluation, and not lead to the correct result. Just use something like criterion for benchmarking rather than trying to reinvent the wheel."}, {"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1437154189, "post_id": 31479939, "comment_id": 50928106, "body": "Could you be more specific. I am new to Haskell and don&#39;t know how to do it. Thanks"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1437155390, "post_id": 31479939, "comment_id": 50928748, "body": "@kosmikus Why <code>BangPatterns</code> will not lead to full evaluation here ? Although I accepth that criterion should be used for benchmarking. @MatejKr It&#39;s an Haskell library used for Benchmarking."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1437155764, "post_id": 31479939, "comment_id": 50928939, "body": "Because bang patterns generally do not cause full evaluation, but only evaluate to weak head normal form. And qsort1 returns  a list."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1437156565, "last_edit_date": 1437156565, "creation_date": 1437148729, "answer_id": 31479939, "question_id": 31479433, "link": "https://stackoverflow.com/questions/31479433/haskell-couldnt-match-type-with-io/31479939#31479939", "title": "Haskell - Couldn&#39;t match type [] with IO", "body": "<p>Your <code>main</code> function isn't right. Unless <code>qsort1</code> is an <code>IO</code> action you cannot perform it in an IO monad. Instead you can put it in the let binding:</p>\n\n<pre><code>main = do\n    start &lt;- getCurrentTime\n    let x = qsort1 (take 1000000 $ randomRs ((1 :: Int), 100000) (mkStdGen 42))\n    end &lt;- getCurrentTime\n    print (diffUTCTime end start) \n</code></pre>\n\n<p>Also note that I have explicitly given a type annotation for <code>1</code> to avoid some compile errors.</p>\n\n<p>But that being said you cannot actually find the the total time taken to do the sorting because of lazy evaluation. <code>x</code> will never be computed because it's never used in the program. If you run <code>main</code>, it give you this output which is definetly wrong:</p>\n\n<pre><code>\u03bb&gt; main\n0.000001s\n</code></pre>\n\n<p>Instead you can use this to calculate the computation:</p>\n\n<pre><code>main = do\n    start &lt;- getCurrentTime\n    let x = qsort1 (take 1000000 $ randomRs ((1 :: Int), 100000) (mkStdGen 42))\n    print x\n    end &lt;- getCurrentTime\n    print (diffUTCTime end start)  \n</code></pre>\n\n<p><s>Instead of printing, you can also use the <code>BangPatterns</code> extension to force the computation of <code>qsort1</code>:</p>\n\n<pre><code>main = do\n    start &lt;- getCurrentTime\n    let !x = qsort1 (take 1000000 $ randomRs ((1 :: Int), 100000) (mkStdGen 42))\n    end &lt;- getCurrentTime\n    print (diffUTCTime end start)   \n</code></pre>\n\n<p></s>     </p>\n\n<p><code>BangPatterns</code> will not lead to full evaluation as @kosmikus points out. Instead use a library like <code>criterion</code> which has been specially made for benchnmarking.</p>\n"}, {"tags": [], "owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "is_accepted": false, "score": 0, "last_activity_date": 1438092047, "creation_date": 1438092047, "answer_id": 31678558, "question_id": 31479433, "link": "https://stackoverflow.com/questions/31479433/haskell-couldnt-match-type-with-io/31678558#31678558", "title": "Haskell - Couldn&#39;t match type [] with IO", "body": "<p>I used method below and it works fine:</p>\n\n<pre><code>main = do\n        let arr = take 1000000 $ randomRs ((1 :: Int), 10000000) (mkStdGen 59)\n        defaultMain [\n          bgroup \"qs\" [ bench \"1\"  $ nf quickSort arr ]\n          ]\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2021, "favorite_count": 0, "accepted_answer_id": 31479939, "answer_count": 2, "score": 4, "last_activity_date": 1438097412, "creation_date": 1437147130, "last_edit_date": 1438097412, "question_id": 31479433, "link": "https://stackoverflow.com/questions/31479433/haskell-couldnt-match-type-with-io", "title": "Haskell - Couldn&#39;t match type [] with IO", "body": "<p>I am new at Haskell. Why am I getting the error message</p>\n\n<blockquote>\n  <p>(Couldn't match type '[]' with 'IO' \u2014 Haskell) in folowing code.</p>\n</blockquote>\n\n<p>In main I only need time of algorithm running without the result.</p>\n\n<p>Only want to measure algorithm time.</p>\n\n<pre><code>qsort1 :: Ord a =&gt; [a] -&gt; [a]\nqsort1 []     = []\nqsort1 (p:xs) = qsort1 lesser ++ [p] ++ qsort1 greater\n    where\n        lesser  = [ y | y &lt;- xs, y &lt; p ]\n        greater = [ y | y &lt;- xs, y &gt;= p ]\n\nmain = do\n    start &lt;- getCurrentTime\n    qsort1 (take 1000000 $ randomRs (1, 100000) (mkStdGen 42))\n    end &lt;- getCurrentTime\n    print (diffUTCTime end start) \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1437143988, "post_id": 31478311, "comment_id": 50921990, "body": "&quot;is there a way to get GHC to tell me what these signatures should be?&quot; - Have you looked at <a href=\"https://wiki.haskell.org/GHC/Typed_holes\" rel=\"nofollow noreferrer\">typed holes</a>?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437144415, "post_id": 31478311, "comment_id": 50922332, "body": "I just did, and got what seems to be nonsense back, as detailed in the edit."}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1437144670, "post_id": 31478311, "comment_id": 50922552, "body": "According to <code>ghci</code>, <code>apply :: ((t, t) -&gt; (b, b)) -&gt; D t t -&gt; D b b</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1437144848, "post_id": 31478311, "comment_id": 50922685, "body": "That seems to be what <code>ghc</code> infers but surely <code>apply</code> can have a more general type because <code>apply id x</code> should be valid."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1437145128, "post_id": 31478311, "comment_id": 50922875, "body": "@Clinton <code>id :: x -&gt; x</code> does match <code>(t,t) -&gt; (b,b)</code>, with <code>t=b</code> and <code>x=(t,t)</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1437145449, "post_id": 31478311, "comment_id": 50923068, "body": "My point is that &#39;apply id x&#39; should be valid for x :: D a b not just D a a."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437147046, "post_id": 31478311, "comment_id": 50924095, "body": "@Clinton Ah, here&#39;s the problem then.  You want existentials.  Think of it this way, when you have <code>apply id</code>, the compiler sees <code>id</code> specialized to only one type in context, not the more general form as defined elsewhere.  There are all sorts of technical reasons for doing it this way that don&#39;t fit well into a SO comment, but be assured that they are good reasons."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437147107, "post_id": 31478311, "comment_id": 50924136, "body": "@bheklilr: you mean universals (at higher rank)?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437147168, "post_id": 31478311, "comment_id": 50924178, "body": "@Andr&#225;sKov&#225;cs Quite possibly, but I thought this could be achieved in a limited sense using <code>ExistentialQuantification</code>?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1437147280, "post_id": 31478311, "comment_id": 50924248, "body": "Can I write the type signature as a rank-n type then? If so how?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1437149576, "post_id": 31478311, "comment_id": 50925620, "body": "I think you need <a href=\"http://www.cis.upenn.edu/~bcpierce/papers/thesis.pdf\" rel=\"nofollow noreferrer\">intersection types</a> to properly typify this function. Something like <code>apply :: ((a, b) -&gt; (c, d)) &amp; ((b, a) -&gt; (d, c)) -&gt; D a b -&gt; D c d</code>."}, {"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1437204650, "post_id": 31478311, "comment_id": 50941979, "body": "@user3237465 You can &quot;deal&quot; with type-level abstractions and their equivalence proofs. <code>apply :: forall t. ((a, b) ~ t (c, d), (b, a) ~ t (d, c)) =&gt; ((c, d) -&gt; (a, b)) -&gt; D c d -&gt; D a b</code>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "edited": false, "score": 0, "creation_date": 1437222658, "post_id": 31478311, "comment_id": 50945938, "body": "@mniip I don&#39;t see, how equivalence proofs can help in this case. <code>(a, b) -&gt; (c, d)</code> and <code>(b, a) -&gt; (d, c)</code> are really two different types. Could you elaborate? I can&#39;t make your <code>apply</code> typecheck, when the body of the function is provided."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 8, "last_activity_date": 1443210180, "last_edit_date": 1443210180, "creation_date": 1437148420, "answer_id": 31479839, "question_id": 31478311, "link": "https://stackoverflow.com/questions/31478311/tricky-type-signature-for-pairs-of-reversed-pairs/31479839#31479839", "title": "Tricky type signature for pairs of reversed pairs", "body": "<p>Multiple types fit <code>apply</code>, but the inferred <code>((t, t) -&gt; (b, b)) -&gt; D t t -&gt; D b b</code> is the most sensible and usable one. The alternatives are going to be higher-rank, so let's enable that language extension:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>First, we can make <code>apply id</code> work:</p>\n\n<pre><code>apply :: (forall a. a -&gt; a) -&gt; D a b -&gt; D a b\napply f (D x y) = D (f x) (f y)\n</code></pre>\n\n<p>However, now <code>id</code> is the <em>only</em> function with which <code>apply</code> works (all total functions of type <code>forall a. a -&gt; a</code> are equal to <code>id</code>). </p>\n\n<p>Here's another type:</p>\n\n<pre><code>apply :: (forall a. a -&gt; (c, c)) -&gt; D a b -&gt; D c c\napply f (D x y) = D (f x) (f y)\n</code></pre>\n\n<p>But this too comes at a price. Now the <code>f</code>-s can only be constant functions that ignore the previous fields of <code>D</code>. So <code>apply (const (0, 0))</code> works, but we have no way to inspect the argument of <code>f</code>. </p>\n\n<p>In contrast, the inferred type is pretty useful. We can express transformations with it that look at the actual data contained in <code>D</code>. </p>\n\n<p>At this point, we might ask: why does GHC infer what it infers? After all, some functions work with the alternative types, but don't work with the default type. Could it be better to sometimes infer higher-ranked types? Well, such types are often extremely useful, but inferring them is unfeasible.</p>\n\n<p>Type inference for rank-2 types is rather complicated, and not very practical either, because it's not possible to infer <em>most general</em> types. With rank-1 inference, we can infer a type that is more general than all other valid types for the same expression. There's no such guarantee with rank-2 types. And inference for rank-3 and above types is just <a href=\"http://www.cs.bu.edu/pub/jbw/types/finite-rank.ps\" rel=\"nofollow\"><em>undecidable</em></a>. </p>\n\n<p>For these reasons, GHC sticks to rank-1 inference, so it never infers types with <code>forall</code>-s inside function arguments. </p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1443216204, "last_edit_date": 1443216204, "creation_date": 1443214800, "answer_id": 32790592, "question_id": 31478311, "link": "https://stackoverflow.com/questions/31478311/tricky-type-signature-for-pairs-of-reversed-pairs/32790592#32790592", "title": "Tricky type signature for pairs of reversed pairs", "body": "<p>Taking things to extremes of generality, we want a type that looks like</p>\n\n<pre><code>apply :: tf -&gt; D a b -&gt; D c d\n</code></pre>\n\n<p>where <code>tf</code> represents the type of <code>f</code>. In order to apply <code>f</code> to <code>(a,b)</code> and get <code>(c,d)</code>, we need</p>\n\n<pre><code>tf ~ (a,b) -&gt; (c,d)\n</code></pre>\n\n<p>In order to apply <code>f</code> to <code>(b,a)</code> to get <code>(d,c)</code>, we need</p>\n\n<pre><code>tf ~ (b,a) -&gt; (d,c)\n</code></pre>\n\n<p>If we turn on <code>TypeFamilies</code> (or <code>GADTs</code>) we get the magic constraint we need to express that:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\napply :: (((a,b) -&gt; (c,d)) ~ tf,\n          ((b,a) -&gt; (d,c)) ~ tf) =&gt;\n         tf -&gt; D a b -&gt; D c d\n</code></pre>\n\n<p>I suspect this is one of the most general types available. Unfortunately, it's pretty wild; working through whether a particular application will pass the type checker is not always so easy. Note also that for reasons I don't personally understand, you can't reliably define specializations using</p>\n\n<pre><code>apply' :: ...\napply' = apply\n</code></pre>\n\n<p>Instead, you sometimes must use</p>\n\n<pre><code>apply' f = apply f\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1443216204, "creation_date": 1437143694, "last_edit_date": 1437144393, "question_id": 31478311, "link": "https://stackoverflow.com/questions/31478311/tricky-type-signature-for-pairs-of-reversed-pairs", "title": "Tricky type signature for pairs of reversed pairs", "body": "<p>Lets say I have the following data type:</p>\n\n<pre><code>data D a b = D (a,b) (b,a)\n</code></pre>\n\n<p>And I want to define the following function on it:</p>\n\n<pre><code>apply f (D x y) = D (f x) (f y)\n</code></pre>\n\n<p>What is the type signature of <code>apply</code>?</p>\n\n<p>Here are some examples of <code>f</code> which are okay:</p>\n\n<pre><code>f :: a -&gt; a -- OK\nf :: (a, b) -&gt; (b, a) -- OK\nf :: (a, b) -&gt; ((a, c), (b, c)) -- OK\n</code></pre>\n\n<p>In all of the above cases, we end up with a valid type D.</p>\n\n<p>But this is not okay:</p>\n\n<pre><code>f :: (a, b) -&gt; (a, a)\n</code></pre>\n\n<p>Because when we send such a function through <code>apply</code> we end up having to attempt to construct <code>D (a,a) (b,b)</code> which is not valid unless <code>a = b</code>.</p>\n\n<p>I can't seem to work out a type signature to express all this? Also, in general, is there a way to get GHC to tell me what these signatures should be?</p>\n\n<p><strong>Typed Holes Edit:</strong></p>\n\n<p>In an attempt to find the type using typed holes, I tried the following:</p>\n\n<pre><code>x = apply _ (D (1::Int,'a') ('b',2::Int))\n</code></pre>\n\n<p>And got:</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: (Int, Int) -&gt; (b, b)\nWhere: \u2018b\u2019 is a rigid type variable bound by\n           the inferred type of x :: D b b\n</code></pre>\n\n<p>Which seems to me to be nonsense as <code>f :: (Int, Int) -&gt; (b, b)</code> is clearly not going to work here.</p>\n"}, {"tags": ["haskell", "type-families", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "edited": false, "score": 0, "creation_date": 1470029208, "post_id": 31478918, "comment_id": 64762001, "body": "What is the purpose of NFData?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "edited": false, "score": 0, "creation_date": 1470035284, "post_id": 31478918, "comment_id": 64764387, "body": "@jonaprieto <a href=\"https://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html\" rel=\"nofollow noreferrer\">See the docs</a>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1437145521, "creation_date": 1437145521, "answer_id": 31478918, "question_id": 31477176, "link": "https://stackoverflow.com/questions/31477176/how-can-i-define-nfdata-instance-for-recursive-singleton-type/31478918#31478918", "title": "How can I define NFData instance for recursive singleton type?", "body": "<p>First, you need to provide <code>NFData</code> instances for singleton lists.</p>\n\n<pre><code>instance NFData (SList '[]) where\n  rnf SNil = ()\n\ninstance (NFData (Sing x), NFData (SList xs)) =&gt; NFData (SList (x ': xs)) where\n  rnf (SCons x xs) = rnf x `seq` rnf xs\n</code></pre>\n\n<p>Note that you can't solve this in a single instance, because that way you couldn't provide the recursive <code>NFData</code> constraints:</p>\n\n<pre><code>instance NFData (SList xs) where\n  rnf SNil = ()\n  rnf (SCons x xs) = ? -- no way to know if NFData (Sing x)\n</code></pre>\n\n<p>Similarly, you have to write separate instances for the <code>T</code> cases:</p>\n\n<pre><code>instance NFData (ST A) where\n  rnf SA = ()\n\ninstance NFData (SList xs) =&gt; NFData (ST (B xs)) where\n  rnf (SB xs) = rnf xs\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "accepted_answer_id": 31478918, "answer_count": 1, "score": 3, "last_activity_date": 1437145521, "creation_date": 1437140289, "question_id": 31477176, "link": "https://stackoverflow.com/questions/31477176/how-can-i-define-nfdata-instance-for-recursive-singleton-type", "title": "How can I define NFData instance for recursive singleton type?", "body": "<p>I'm using <code>singletons</code> library. I have this data type:</p>\n\n<pre><code>import Control.DeepSeq\nimport Data.Singletons.Prelude\nimport Data.Singletons.TH\n\ndata T =\n      A\n    | B [T]\n\ngenSingletons [''T]\n</code></pre>\n\n<p>I want generated singleton type <code>ST</code> to be instance of <code>NFData</code>.\nIt would be straightforward if type <code>T</code> wouldn't be recursive.\nI tried to write this:</p>\n\n<pre><code>instance NFData (ST a) where\n    rnf SA = ()\n    rnf (SB (x `SCons` xs)) = rnf x `seq` rnf xs\n</code></pre>\n\n<p>but this fails on last line with message:</p>\n\n<pre><code>Could not deduce (NFData (Sing n1)) arising from a use of `rnf'\nfrom the context (a ~ 'B n)\n  bound by a pattern with constructor\n             SB :: forall (z_azEs :: T) (n_azEt :: [T]).\n                   (z_azEs ~ 'B n_azEt) =&gt;\n                   Sing n_azEt -&gt; Sing z_azEs,\n           in an equation for `rnf'\nor from (n ~ (n0 : n1))\n  bound by a pattern with constructor\n             SCons :: forall (a0 :: BOX) (z0 :: [a0]) (n0 :: a0) (n1 :: [a0]).\n                      (z0 ~ (n0 : n1)) =&gt;\n                      Sing n0 -&gt; Sing n1 -&gt; Sing z0,\n           in an equation for `rnf'\nIn the second argument of `seq', namely `rnf xs'\nIn the expression: rnf x `seq` rnf xs\nIn an equation for `rnf':\n    rnf (SB (x `SCons` xs)) = rnf x `seq` rnf xs\n</code></pre>\n\n<p>I understand that GHC wants <code>x</code> and <code>xs</code> in pattern <code>SB (x ``SCons`` xs))</code> to be instances of <code>NFData</code>, but I have trouble figuring out how exactly to tell this.\nWhat should I write in the context of this instance to make it work?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "purely-functional"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1437140306, "post_id": 31477074, "comment_id": 50919394, "body": "If you have lazy evaluation, it means any impure actions happen in random order. That kinda stops people trying to sneak impure actions in; actions that happen in random order aren&#39;t very useful."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1437140786, "post_id": 31477074, "comment_id": 50919740, "body": "@MathematicalOrchid I don&#39;t get that... Haskell already separates impure actions in the IO monad so they are sequenced independently of the evaluation strategy..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1437141020, "post_id": 31477074, "comment_id": 50919896, "body": "@Bakuriu Haskell separates impure actions into the IO monad <i>because</i> otherwise their ordering would be completely arbitrary, which is <i>because</i> of lazy evaluation. If it weren&#39;t for lazy evaluation, you could just &quot;cheat&quot; and write pretend functions which are actually impure. But because of laziness, it&#39;s hopeless to try, no matter how tempted you might be."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1437141023, "post_id": 31477074, "comment_id": 50919900, "body": "Anyway one thing about lazy vs strict evaluation is that in lazy evaluation you are able to think more compositionally (i.e. in a more declarative/functional way) and obtain an <i>efficient</i> solution. Using a strict evaluation strategy this may not be possible. For example with lazy evaluation you can do things like: <code>getFirstTrue p = head . filter p</code> without worrying that it will traverse the whole list before returning the first element. If you use strict evaluation you want to avoid this thing. This become more important with things like folds/maps etc mixed together."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1437141292, "post_id": 31477074, "comment_id": 50920081, "body": "@MathematicalOrchid From my point of view Io makes sense to separate pure vs impure <i>independently</i> of the evaluation strategy. It&#39;s smart to do so even in a strict language. The fact that it solves even that problem is just a plus."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1437141467, "post_id": 31477074, "comment_id": 50920197, "body": "@Bakuriu Separating them out is a very smart move. My point is that lazy evaluation kind of <i>forces</i> you to do it, whereas in a strict language you might be tempted to bypass the separation &quot;just this one time&quot;, which slowly leads to being &quot;all the time&quot;. And I think that&#39;s what the sentiments the OP is asking about refers to."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437143566, "post_id": 31477074, "comment_id": 50921680, "body": "@Sibi It&#39;s not so much that lazy evaluation <i>led</i> to purity; rather, lazy evaluation forced them to keep Haskell pure. For information, at some stage in <a href=\"http://www.se-radio.net/2008/08/episode-108-simon-peyton-jones-on-functional-programming-and-haskell/\" rel=\"nofollow noreferrer\">Software Engineering Radio podcast #108</a>, SPJ explains why &quot;purity kept us pure&quot;."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437144527, "post_id": 31477074, "comment_id": 50922428, "body": "@Jubobs Sorry, I should have worded it properly. I would like to understand how lazy evaluation forced them to keep Haskell pure. I will edit the question."}], "answers": [{"comments": [{"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1437145518, "post_id": 31477982, "comment_id": 50923114, "body": "I will inform the Lispers, MLers, and Discipline Disciplers that their preferred languages aren&#39;t &quot;true&quot; functional languages.  I think you just get the historical utility and role of functional purity wrong."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 2, "creation_date": 1437149598, "post_id": 31477982, "comment_id": 50925632, "body": "@jcast Well, it depends on what you mean by functional language. My point is that Haskell was designed to be <i>very</i> functional and the biggest step in this direction is utter separation between side effects and evaluation of expressions. So, yes I&#39;d definitely say that those languages are less &quot;purely-functional&quot; than Haskell, yet I do <i>not</i> think that Haskell is more pure just because it is lazy evaluated."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1437162893, "post_id": 31477982, "comment_id": 50932549, "body": "@Bakuriu They are less purely functional <i>languages</i> because there is no language support for writing pure code. They do <i>allow</i> you to write purely functional code though; And it is in fact how significant portions of code are written."}, {"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1437351735, "post_id": 31477982, "comment_id": 50977305, "body": "@Cubic &lt;serious&gt;Indeed.&lt;/serious&gt; &lt;flippant&gt;C also allows you to write purely functional code.&lt;/flippant&gt;&lt;admittedly&gt;There&#39;s not a lot of pure functional C around.&lt;/admittedly&gt;"}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 2, "last_activity_date": 1437143210, "last_edit_date": 1495540423, "creation_date": 1437142708, "answer_id": 31477982, "question_id": 31477074, "link": "https://stackoverflow.com/questions/31477074/how-lazy-evaluation-forced-haskell-to-be-pure/31477982#31477982", "title": "How lazy evaluation forced Haskell to be pure", "body": "<p>It depends by what you mean for \"pure\" in this context.</p>\n\n<ul>\n<li><p>If for <em>pure</em> you mean as in <em>purely functional</em>, then what @MathematicalOrchid is true: with lazy evaluation you wouldn't know in which sequence impure actions are executed and hence you wouldn't be able to write meaningful programs at all and you are forced to be more pure (using the <code>IO</code> monad).</p>\n\n<p>However I find this not really satisfying in this case. A true functional language already separates pure and impure code, so even a strict one <em>should</em> have some kind of <code>IO</code>.</p></li>\n<li><p>However it's possible that the statement is more broad and refers to pure in the fact that you are able to express more easily, in a more declarative, compositional and yet efficient way the code.</p></li>\n</ul>\n\n<p>Looking at <a href=\"https://stackoverflow.com/a/355535/510937\">this</a> answer which makes exactly the statement you are citing it links to the article <a href=\"http://www.cse.chalmers.se/~rjmh/Papers/whyfp.html\" rel=\"nofollow noreferrer\">Why Functional Programming Matters</a> by Hughes which is probably the one you are talking about.</p>\n\n<p>The paper shows how <em>higher order functions</em> and <em>lazy evaluation</em> allow to write more <strong>modular</strong> code. Note that it does <em>not</em> say anything about purely functional etc. The point it is making is about being more modular and more declarative without losing in efficiency.</p>\n\n<p>The article provides some examples. For example the Newton-Raphson algorithm: in a strict language you have to combine together the code that computes the next approximation and the one that checks if you obtained a good enough solution.</p>\n\n<p>With lazy evaluation you can generate the infinite list of approximations in a function and call this from an other function that returns the first good enough approximation.</p>\n\n<hr>\n\n<p>In <em>Thinking Functionally with Haskell</em> Richard Bird makes precisely this point. If we look at Chapter 2, exercise D:</p>\n\n<blockquote>\n  <p>Beaver is an eager evaluator, while Susan is a lazy one.</p>\n  \n  <p>[...]</p>\n  \n  <p>What alternative might Beaver prefer to <code>head . filter p . map f</code>?</p>\n</blockquote>\n\n<p>And the answer says:</p>\n\n<blockquote>\n  <p>[...] Instead of defining <code>first p f = head . filter p . map f</code>,\n  Beaver might define</p>\n\n<pre><code>first :: (b -&gt; Bool) -&gt; (a -&gt; b) -&gt; [a] -&gt; b\nfirst p xs | null xs = error \"Empty list\"\n           | p x = x\n           | otherwise = first p f (tail xs)\n           where x = f (head xs)\n</code></pre>\n  \n  <p><strong>The point is that with eager evaluation most functions have to be defined using explicit recursion, not in terms of useful component\n  functions like <code>map</code> and <code>filter</code>.</strong></p>\n</blockquote>\n\n<p>So pure here means that allows declarative, compositional and yet efficient definitions while with eager evaluation using declarative and compositional definitions can lead to unnecessarily inefficient code.</p>\n"}, {"comments": [{"owner": {"reputation": 154, "user_id": 2307853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6844e99a738ded1126fd1c424eb815a?s=128&d=identicon&r=PG", "display_name": "Max Barraclough", "link": "https://stackoverflow.com/users/2307853/max-barraclough"}, "edited": false, "score": 1, "creation_date": 1600728508, "post_id": 31478674, "comment_id": 113173791, "body": "The first link is now broken."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 154, "user_id": 2307853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6844e99a738ded1126fd1c424eb815a?s=128&d=identicon&r=PG", "display_name": "Max Barraclough", "link": "https://stackoverflow.com/users/2307853/max-barraclough"}, "edited": false, "score": 0, "creation_date": 1600860364, "post_id": 31478674, "comment_id": 113219960, "body": "@MaxBarraclough Thanks. I&#39;ve found another copy on Microsoft&#39;s servers, and I fixed the broken link."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 11, "last_activity_date": 1600875030, "last_edit_date": 1600875030, "creation_date": 1437144793, "answer_id": 31478674, "question_id": 31477074, "link": "https://stackoverflow.com/questions/31477074/how-lazy-evaluation-forced-haskell-to-be-pure/31478674#31478674", "title": "How lazy evaluation forced Haskell to be pure", "body": "<p>It's not so much that lazy evaluation <em>led</em> to purity; Haskell was pure to begin with. Rather, lazy evaluation forced the designers of the language to <em>keep</em> the language pure.</p>\n<p>Here is a relevant passage from the article <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/history.pdf?from=https%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fhistory-of-haskell%2Fhistory.pdf\" rel=\"nofollow noreferrer\">A History of Haskell: Being Lazy with Class</a>:</p>\n<blockquote>\n<p>Once we were committed to a lazy language, a pure one was inescapable. The converse is not true, but it is notable that in practice most pure programming languages are also lazy. Why? Because <strong>in a call-by-value language, whether functional or not, the temptation to allow unrestricted side effects inside a \u201cfunction\u201d is almost irresistible</strong>.</p>\n<p>Purity is a big bet, with pervasive consequences. Unrestricted side effects are undoubtedly very convenient. Lacking side effects, Haskell\u2019s input/output was initially painfully clumsy, which was a source of considerable embarrassment. Necessity being the mother of invention, this embarrassment ultimately led to the invention of monadic I/O, which we now regard as one of Haskell\u2019s main con- tributions to the world, as we discuss in more detail in Section 7.</p>\n<p>Whether a pure language (with monadic effects) is ultimately the best way to write programs is still an open question, but it certainly is a radical and elegant attack on the challenge of programming, and it was that combination of power and beauty that motivated the designers. <strong>In retrospect, therefore, perhaps the biggest single benefit of laziness is not laziness per se, but rather that laziness kept us pure</strong>, and thereby motivated a great deal of productive work on monads and encapsulated state.</p>\n</blockquote>\n<p>(my emphasis)</p>\n<p>I also invite you to listen to 18'30'' of <a href=\"http://www.se-radio.net/2008/08/episode-108-simon-peyton-jones-on-functional-programming-and-haskell/\" rel=\"nofollow noreferrer\">Software Engineering Radio podcast #108</a> for an explanation by the man himself. And here is a longer but relevant passage from SPJ's interview in <a href=\"http://www.codersatwork.com\" rel=\"nofollow noreferrer\">Peter Seibel's <em>Coders at Work</em></a>:</p>\n<blockquote>\n<p>I now think <strong>the important thing about laziness is that it kept us pure</strong>. [...]</p>\n<p>[...] if you have a lazy evaluator, it\u2019s harder to predict exactly when an expression is going to be evaluated. So that means if you want to print something on the screen, every call-by-value language, where the order of evaluation is completely explicit, does that by having an impure \u201cfunction\u201d\u2014I\u2019m putting quotes around it because it now isn\u2019t a function at all\u2014with type something like string to unit. You call this function and as a side effect it puts something on the screen. That\u2019s what happens in Lisp; it also happens in ML. It happens in essentially every call-by-value language.</p>\n<p>Now in a pure language, if you have a function from string to unit you would never need to call it because you know that it just gives the answer unit. That\u2019s all a function can do, is give you the answer. And you know what the answer is. But of course if it has side effects, it\u2019s very important that you do call it. In a lazy language the trouble is if you say, \u201c<code>f</code> applied to <code>print &quot;hello&quot;</code>,\u201d then whether <code>f</code> evaluates its first argument is not apparent to the caller of the function. It\u2019s something to do with the innards of the function. And if you pass it two arguments, <code>f</code> of <code>print &quot;hello&quot;</code> and <code>print &quot;goodbye&quot;</code>, then you might print either or both in either order or neither. So somehow, with lazy evaluation, doing input/output by side effect just isn\u2019t feasible. You can\u2019t write sensible, reliable, predictable programs that way. So, we had to put up with that. It was a bit embarrassing really because you couldn\u2019t really do any input/output to speak of. So for a long time we essentially had programs which could just take a string to a string. That was what the whole program did. The input string was the input and result string was the output and that\u2019s all the program could really ever do.</p>\n<p>You could get a bit clever by making the output string encode some output commands that were interpreted by some outer interpreter. So the output string might say, \u201cPrint this on the screen; put that on the disk.\u201d An interpreter could actually do that. So you imagine the functional program is all nice and pure and there\u2019s sort of this evil interpreter that interprets a string of commands. But then, of course, if you read a file, how do you get the input back into the program? Well, that\u2019s not a problem, because you can output a string of commands that are interpreted by the evil interpreter and using lazy evaluation, it can dump the results back into the input of the program. So the program now takes a stream of responses to a stream of requests. The stream of requests go to the evil interpreter that does the things to the world. Each request generates a response that\u2019s then fed back to the input. And because evaluation is lazy, the program has emitted a response just in time for it to come round the loop and be consumed as an input. But it was a bit fragile because if you consumed your response a bit too eagerly, then you get some kind of deadlock. Because you\u2019d be asking for the answer to a question you hadn\u2019t yet spat out of your back end yet.</p>\n<p>The point of this is <strong>laziness drove us into a corner in which we had to think of ways around this I/O problem.</strong> I think that that was extremely important. The single most important thing about laziness was it drove us there.</p>\n</blockquote>\n<p>(my emphasis)</p>\n"}, {"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1437356211, "post_id": 31479079, "comment_id": 50978188, "body": "Most uses of <code>unsafePerformIO</code> that I&#39;ve seen aren&#39;t even for IO, but for situations where <code>ST</code> doesn&#39;t quite fit (for example: concurrent algorithms that always return the same result given the same arguments, but which can&#39;t be proven to do so just using the type system)"}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 1, "last_activity_date": 1437146048, "creation_date": 1437146048, "answer_id": 31479079, "question_id": 31477074, "link": "https://stackoverflow.com/questions/31477074/how-lazy-evaluation-forced-haskell-to-be-pure/31479079#31479079", "title": "How lazy evaluation forced Haskell to be pure", "body": "<p>Strictly speaking, this claim isn't true, because Haskell has <code>unsafePerformIO</code>, which is a big hole in the language's functional purity.  (It exploits a hole in GHC Haskell's functional purity which ultimately goes back to the decision to implement unboxed arithmetic by adding a strict fragment to the language).  <code>unsafePerformIO</code> exists because the temptation to say \"well, I'll implement just this one function using side-effects internally\" is irresistible to most programmers.  But if you look at the drawbacks of <code>unsafePerformIO</code>[1], you see exactly what people are saying:</p>\n\n<ul>\n<li><code>unsafePerformIO a</code> is not guaranteed to ever execute <code>a</code>.</li>\n<li>Nor is it guaranteed to execute <code>a</code> only once, if it does execute.</li>\n<li>Nor is there any guarantee about the relative ordering of the I/O performed by <code>a</code> with other parts of the program.</li>\n</ul>\n\n<p>Those drawbacks keep <code>unsafePerformIO</code> mostly limited to the safest and most careful uses, and are <em>why</em> people do use <code>IO</code> directly until it becomes too inconvenient.</p>\n\n<p>[1] Besides the type-unsafety; <code>let r :: IORef a; r = unsafePerformIO $ newIORef undefined</code> gives you a <em>polymorphic</em> <code>r :: IORef a</code>, which can be used to implement <code>unsafeCast :: a -&gt; b</code>.  ML has a solution for reference allocation that avoids that, and Haskell could have solved it in a similar way if purity wasn't considered desirable anyway (the monomorphism restriction is nearly a solution anyway, you just have to ban people from working around it by using a type signature, like I did above).</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1600882572, "post_id": 31483875, "comment_id": 113231763, "body": "From another perspective, the cheating is much more <i>constrained</i>, and therefore much more <i>interesting</i>. It often takes years before a Haskell programmer develops a decent sense of <i>when</i> and <i>how</i> to cheat!"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 8, "last_activity_date": 1437163527, "creation_date": 1437163527, "answer_id": 31483875, "question_id": 31477074, "link": "https://stackoverflow.com/questions/31477074/how-lazy-evaluation-forced-haskell-to-be-pure/31483875#31483875", "title": "How lazy evaluation forced Haskell to be pure", "body": "<p>I think the answer by Jubobs already sums it up nicely (with good references). But, in my own words, what I think SPJ and friends are referring to is this:</p>\n\n<p>Having to go through this \"monad\" business can be really inconvenient at times. The sheer volume of questions on Stack Overflow asking \"how do I just remove this <code>IO</code> thing?\" is testament to the fact that sometimes, you really <em>really</em> want to just print out this one value right here &mdash; usually for the purposes of figuring out what the actual **** is going on!</p>\n\n<p>In an eager language, it would be sorely tempting to just start adding magic impure functions that let you do impure stuff directly, like in other languages. No doubt you'd start with small things at first, but slowly you slide down this slippery slope, and before you know it, effects are all over the place.</p>\n\n<p>In a lazy language like Haskell, this temptation still exists. There are many times when it would be <em>really helpful</em> to be able to just quickly sneak this one little effect in here or there. Except that because of <strong>laziness</strong>, adding effects turns out to be almost utterly useless. You can't <em>control</em> when anything happens. Even just <code>Debug.trace</code> tends to produce utterly incomprehensible results.</p>\n\n<p>In short, if you're designing a <em>lazy</em> language, you really are <em>forced</em> to come up with a coherent story for how you're handling effects. You can't just go \"meh, we'll pretend this function is just magic\"; without the ability to control effects more precisely, you'll instantly end up in a horrible mess!</p>\n\n<p><strong>TL;DR</strong> In an eager language, you can get away with cheating. In a lazy language, you really <em>have</em> to do things properly, or it just plain doesn't work.</p>\n\n<p>And <em>that</em> is why we hired Alex &mdash; wait, wrong window...</p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1382, "favorite_count": 1, "accepted_answer_id": 31483875, "answer_count": 4, "score": 11, "last_activity_date": 1600875030, "creation_date": 1437139993, "last_edit_date": 1437144605, "question_id": 31477074, "link": "https://stackoverflow.com/questions/31477074/how-lazy-evaluation-forced-haskell-to-be-pure", "title": "How lazy evaluation forced Haskell to be pure", "body": "<p>I remember seeing a presentation in which SPJ said that lazy evaluation forced them to keep Haskell pure (or something along that line). I often see many Haskellers saying the same.</p>\n\n<p>So, I would like to understand how lazy evaluation strategy forced them to keep Haskell pure as opposed to a strict evaluation stragegy ?</p>\n"}, {"tags": ["haskell", "mmap"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1437148252, "post_id": 31476005, "comment_id": 50924835, "body": "I suspect this is because of the strange way you&#39;re converting the <code>ByteString</code>  to a <code>Vector</code>.  Does it work if you do something like <a href=\"http://stackoverflow.com/questions/18682527/how-to-convert-between-bytestring-and-storable-vector#answer-18888945\">this</a> (where you keep the same <code>ForeignPtr</code>)?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1437162672, "post_id": 31476005, "comment_id": 50932437, "body": "I strongly would suggest using <a href=\"https://hackage.haskell.org/package/mmap-0.5.9/docs/System-IO-MMap.html#v:mmapFileByteString\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mmap-0.5.9/docs/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437188761, "post_id": 31476005, "comment_id": 50939095, "body": "This is not an answer, because I haven&#39;t investigated for real, but: the body of your <code>unsafeUseAsCString</code> looks fishy to me. It&#39;s typical that the callback you give functions of this kind should not return anything that references the pointer it&#39;s given as an argument; but your return value references <code>fptr</code> which references <code>ptr</code>. Are you double-sure that doing this is okay?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437188585, "post_id": 31487269, "comment_id": 50939066, "body": "&quot;Just conventionally read the file into a <code>ByteString</code>... All this <code>mmap</code> stuff is dangerous and not a whole lot faster.&quot; Do you have evidence for this claim? I would have expected that if you want to access a few events at random positions from a very large file, this way would be significantly faster than reading in the whole file."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437188832, "post_id": 31487269, "comment_id": 50939106, "body": "By the way, despite my nitpick, this looks like a great answer based on really expert knowledge."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437188857, "post_id": 31487269, "comment_id": 50939109, "body": "If the file is too big, use <a href=\"https://hackage.haskell.org/package/base-4.5.0.0/docs/GHC-IO-Handle.html#v:hSeek\" rel=\"nofollow noreferrer\">hseek</a> and read 8 bytes out of it.  This is essentially what the OS does when you read from an mmap&#39;ed region of memory."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437188957, "post_id": 31487269, "comment_id": 50939121, "body": "Using hseek would certainly be one way, but it&#39;s not as modular: it means that functions that access the big data structure have to be aware that they&#39;re accessing something that came from a file (rather than, say, a dynamically generated vector or a vector that came from parsing something on the network or whatever). Pretty much all the arguments for memory mapping in other languages apply equally well here."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437189482, "post_id": 31487269, "comment_id": 50939213, "body": "All programmers, as part of software engineering practice, have to settle on a compromise between safety, simplicity, modularity, and performance in their code design.  The older I get, the closer I hang out to the &quot;safety&quot; pole."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437189747, "post_id": 31487269, "comment_id": 50939247, "body": "I&#39;m fine with making observations about tradeoffs, and even judgment calls about tradeoffs. All I&#39;m saying is that you seem to be misrepresenting the tradeoff by downplaying the good things about memory mapping, which makes your judgment call sound disingenuous."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437190103, "post_id": 31487269, "comment_id": 50939324, "body": "You can still use the mmap&#39;ed <code>ByteString</code> without directly touching any icky <code>ForeignPtr</code>s by creating a pure <code>readEvent :: ByteString -&gt; Int -&gt; Event</code> function."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1437247132, "post_id": 31487269, "comment_id": 50952763, "body": "&quot;<code>mmap</code> is dangerous&quot; \u2192 I wouldn&#39;t have considered it if reading all events into memory wouldn&#39;t have blown up in memory several times. &quot;<code>toForeignPtr</code>&quot; I searched for a function like that, but apparently it is not visible anymore in the current version of <code>bytestring</code>?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1437250674, "post_id": 31487269, "comment_id": 50953873, "body": "The module is there on the most recent version on <a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0\" rel=\"nofollow noreferrer\">hackage</a>, and you can import Data.ByteString.Internal with no problem.  The API docs have the &#39;hide&#39; attribute set so they aren&#39;t autogenerated and on hackage, because the implementors view the functions there as not part of the stable API."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1437381304, "post_id": 31487269, "comment_id": 50985734, "body": "I always thought those &quot;blackened&quot; modules where somehow not available. Re: &quot;If you want absolute fastest performance without regard to safety, program in C.&quot; I am glad to say that I have a pure Haskell codebase and I&#39;d rather not change that :)"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1437382811, "post_id": 31487269, "comment_id": 50986557, "body": "And just to add this: I think now that this (hopefully) working I think it is safer to use than using C for the same task. Sure there are some <i>undefined behavior</i> cases when dealing with mmapped files, but <code>mmapAERFile</code> goes from filename to <b>immutable</b> vector of events. All the memory delocation is handled by the garbage collector. I consider this quite safe to use."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1437407495, "post_id": 31487269, "comment_id": 51003000, "body": "You could take a layer of complexity out by using <a href=\"https://hackage.haskell.org/package/mmap-0.5.9/docs/System-IO-MMap.html#v:mmapFileForeignPtr\" rel=\"nofollow noreferrer\">mmapFileForeignPtr</a> to directly get a ForeignPtr, without depending on undocumented ByteString internals."}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": true, "score": 1, "last_activity_date": 1437187621, "creation_date": 1437187621, "answer_id": 31487269, "question_id": 31476005, "link": "https://stackoverflow.com/questions/31476005/how-to-do-memory-mapped-io-on-custom-data-types/31487269#31487269", "title": "How to do memory mapped IO on custom data types?", "body": "<p><code>mmapFileByteString</code> performs a <code>mmap</code>, which creates a <code>ForeignPtr</code>, and sticks that <code>ForeignPtr</code> into a <code>ByteString</code>.  <code>unsafeUseAsCString</code> coerces the <code>ForeignPtr</code> into a <code>Ptr</code>, from which you then create a new <code>ForeignPtr</code>.  Then you take that second <code>ForeignPtr</code> and use it with <code>S.unsafeFromForeignPtr0</code> to create a vector.</p>\n\n<p>Having two <code>ForeignPtr</code>s pointing at the same memory is a no no.  The GHC runtime treats them as two separate objects.  After all references to the <code>ByteString</code> are gone, the finalizer for its<code>ForeignPtr</code> will be called, deallocating the <code>mmap</code> and reclaiming the underlying memory.  This leaves the second <code>ForeignPtr</code> pointing at an invalid region.</p>\n\n<p>The solution here is to use <a href=\"http://hackage.haskell.org/package/bytestring-0.9.1.4/docs/Data-ByteString-Internal.html#v%3AtoForeignPtr\" rel=\"nofollow\"><code>Data.ByteString.Internal.toForeignPtr</code></a> to extract and re-use the <code>ForeignPtr</code> from the <code>ByteString</code>.  Replace the <code>unsafeUseAsCString</code> block with this:</p>\n\n<pre><code>let (fptr,offset,len) = Data.ByteString.Internal.toForeignPtr bs\n-- it might be worthwhile to assert that offset == 0\nlet count = len `div` 8\nreturn $ S.unsafeFromForeignPtr0 (castForeignPtr fptr) count\n</code></pre>\n\n<p>IMHO, the real solution here is not to fiddle with all this stuff at all.  Just conventionally read the file into a <code>ByteString</code>, pull out 8-byte substrings from that and manually conver them into <code>Event</code>s.  All this <code>mmap</code> and <code>ForeignPtr</code> stuff is dangerous, and not a whole lot faster than doing things safely and correctly.  If you want absolute fastest performance without regard to safety, program in C.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 31487269, "answer_count": 1, "score": 3, "last_activity_date": 1437187621, "creation_date": 1437136583, "last_edit_date": 1437137523, "question_id": 31476005, "link": "https://stackoverflow.com/questions/31476005/how-to-do-memory-mapped-io-on-custom-data-types", "title": "How to do memory mapped IO on custom data types?", "body": "<h3>The Setup</h3>\n\n<p>I recently implemented <code>mmap</code> based file reading and directly ran into strange behavior. The relevant code is:</p>\n\n<pre><code>-- | map whole aedat file into memory and return it as a vector of events\n-- TODO what are the finalizing semantics of this?\nmmapAERData :: S.Storable a =&gt; FilePath -&gt; IO (S.Vector (AER.Event a))\nmmapAERData name = do\n    -- mmap file into memory and find the offset behind the header\n    bs &lt;- dropHeader &lt;$&gt; mmapFileByteString name Nothing\n    -- some conversion is necessary to get the 'ForeignPtr' from\n    -- a 'ByteString'\n    B.unsafeUseAsCString bs $ \\ptr -&gt; do\n      fptr &lt;- newForeignPtr_ ptr\n      let count = B.length bs `div` 8 -- sizeof one event\n      return $ S.unsafeFromForeignPtr0 (castForeignPtr fptr) count\n</code></pre>\n\n<p><a href=\"https://github.com/fhaust/aer/blob/master/src/Data/AER/AEDat.hs#L36-L47\" rel=\"nofollow\">\u2192 code in context</a></p>\n\n<p>Some explanation: The AEDat Format is basically a long list of two Word32s. One encodes the <em>address</em> the other the <em>timestamp</em>. Before that there are some lines of header text that I drop in the <code>dropHeader</code> function. I could do this directly on a <code>ForeignPtr</code> if absolutely necessary, but I prefer to use the common function that works on <code>ByteStrings</code> instead.</p>\n\n<p>The the <code>Storable</code> instances can be found <a href=\"https://github.com/fhaust/aer/blob/master/src/Data/AER/Types.hs#L57-L66\" rel=\"nofollow\">here</a> and <a href=\"https://github.com/fhaust/aer/blob/master/src/Data/AER/DVS128.hs#L48-L54\" rel=\"nofollow\">here</a>. I am not sure about the <em>alignment</em> here, but I suspect that an alignment of 8 should be correct.</p>\n\n<h3>The Problem</h3>\n\n<p>Reading the data works quite well, but after some time the memory seems to get corrupted somehow:</p>\n\n<pre><code>&gt;&gt;&gt; es &lt;- DVS.mmapDVSData \"dataset.aedat\" \n&gt;&gt;&gt; es S.! 1000\nEvent {address = Address {polarity = D, posX = 6, posY = 50}, timestamp = 74.771407s}\n&gt;&gt;&gt; :type es\nes :: S.Vector (DVS.Event DVS.Address)\n&gt;&gt;&gt; _ &lt;- evaluate (V.convert es :: V.Vector (DVS.Event DVS.Address))\n&gt;&gt;&gt; es S.! 1000\nEvent {address = Address {polarity = D, posX = 0, posY = 44}, timestamp = 0s}\n</code></pre>\n\n<p>Apparently accessing all elements of <code>es</code> somehow corrupts my memory. Or the garbage collector recycles it? Either way, this is strange. What can I do about that?</p>\n"}, {"tags": ["haskell", "monads", "state-monad", "purely-functional"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1437137202, "post_id": 31475770, "comment_id": 50917424, "body": "Chances are you would have to reimplement many of the functionalities already offered by the <code>State</code> monad. Think of the latter as a design pattern. You can also combine <code>State</code> with other monads easily."}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437137862, "post_id": 31475770, "comment_id": 50917830, "body": "But if I don&#39;t use State then I don&#39;t need to combine it with other monads. I would prefer some code examples."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1437139008, "post_id": 31475770, "comment_id": 50918550, "body": "Well, in the example you give, using <code>State</code> is probably overkill. Do you have a specific, real-life example?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1437139526, "post_id": 31475770, "comment_id": 50918873, "body": "@ais The <code>State</code> type is simply a wrapper around argument passing with a tuple returned.  The purpose of using it is to have a better defined set of functions, where you basically say &quot;All of these functions are designed to work together&quot;, and to reduce the amount of typing you need to do.  You can do everything that <code>State</code> can using just argument passing, but <code>do</code> notation makes the argument passing transparent.  This aids the readability of your code, makes it more composable, and reduces how much you actually have to write to achieve the same goal."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437139554, "post_id": 31475770, "comment_id": 50918892, "body": "@ais It&#39;s like making a class in OOP to wrap up certain operations.  You can achieve the same thing by just passing around a bunch of values to functions, much like in C, but it takes less code and makes it more usable.  The <code>State</code> monad is just a design pattern like a class in OOP, making it easier to reuse code in particular contexts."}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1437139645, "post_id": 31475770, "comment_id": 50918958, "body": "@Jubobs This is the question. I just use passing state and I don&#39;t feel the need to use something else. So I want some example which show why State can be better solution."}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437139783, "post_id": 31475770, "comment_id": 50919061, "body": "@bheklilr Can you show me a code which can demonstrate it?"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1437142302, "post_id": 31477621, "comment_id": 50920779, "body": "This is a great example."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1437143950, "post_id": 31477621, "comment_id": 50921966, "body": "shouldn&#39;t <code>(get &lt;*&gt; modify (+1))</code> in the applicative <code>preLabel&#39;</code> be <code>(get &lt;* modify (+1))</code>?"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 16, "last_activity_date": 1437144046, "last_edit_date": 1437144046, "creation_date": 1437141608, "answer_id": 31477621, "question_id": 31475770, "link": "https://stackoverflow.com/questions/31475770/why-must-we-use-state-monad-instead-of-passing-state-directly/31477621#31477621", "title": "Why must we use state monad instead of passing state directly?", "body": "<p>State passing is often tedious, error-prone, and hinders refactoring. For example, try labeling a binary tree or rose tree in postorder:</p>\n\n<pre><code>data RoseTree a = Node a [RoseTree a] deriving (Show)\n\npostLabel :: RoseTree a -&gt; RoseTree Int\npostLabel = fst . go 0 where\n  go i (Node _ ts) = (Node i' ts', i' + 1) where\n\n    (ts', i') = gots i ts\n\n    gots i []     = ([], i)\n    gots i (t:ts) = (t':ts', i'') where\n      (t', i')   = go i t\n      (ts', i'') = gots i' ts\n</code></pre>\n\n<p>Here I had to manually label states in the right order, pass the correct states along, and had to make sure that both the labels and child nodes are in the right order in the result (note that naive use of <code>foldr</code> or <code>foldl</code> for the child nodes could have easily led to incorrect behavior).</p>\n\n<p>Also, if I try to change the code to preorder, I have to make changes that are easy to get wrong:</p>\n\n<pre><code>preLabel :: RoseTree a -&gt; RoseTree Int\npreLabel = fst . go 0 where\n  go i (Node _ ts) = (Node i ts', i') where -- first change\n\n    (ts', i') = gots (i + 1) ts -- second change\n\n    gots i []     = ([], i)\n    gots i (t:ts) = (t':ts', i'') where\n      (t', i')   = go i t\n      (ts', i'') = gots i' ts\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>branch = Node ()\nnil  = branch []\ntree = branch [branch [nil, nil], nil]\npreLabel tree == Node 0 [Node 1 [Node 2 [],Node 3 []],Node 4 []]\npostLabel tree == Node 4 [Node 2 [Node 0 [],Node 1 []],Node 3 []]\n</code></pre>\n\n<p>Contrast the state monad solution:</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Applicative\n\npostLabel' :: RoseTree a -&gt; RoseTree Int\npostLabel' = (`evalState` 0) . go where\n  go (Node _ ts) = do\n    ts' &lt;- traverse go ts\n    i   &lt;- get &lt;* modify (+1)\n    pure (Node i ts')\n\npreLabel' :: RoseTree a -&gt; RoseTree Int\npreLabel' = (`evalState` 0) . go where\n  go (Node _ ts) = do\n    i   &lt;- get &lt;* modify (+1)\n    ts' &lt;- traverse go ts\n    pure (Node i ts')\n</code></pre>\n\n<p>Not only is this code more succinct and easier to write correctly, the logic that results in pre- or postorder labeling is far more transparent.</p>\n\n<hr>\n\n<p>PS: bonus applicative style:</p>\n\n<pre><code>postLabel' :: RoseTree a -&gt; RoseTree Int\npostLabel' = (`evalState` 0) . go where\n  go (Node _ ts) =\n    flip Node &lt;$&gt; traverse go ts &lt;*&gt; (get &lt;* modify (+1))\n\npreLabel' :: RoseTree a -&gt; RoseTree Int\npreLabel' = (`evalState` 0) . go where\n  go (Node _ ts) =\n    Node &lt;$&gt; (get &lt;* modify (+1)) &lt;*&gt; traverse go ts\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": false, "score": 1, "last_activity_date": 1437142714, "creation_date": 1437142714, "answer_id": 31477986, "question_id": 31475770, "link": "https://stackoverflow.com/questions/31475770/why-must-we-use-state-monad-instead-of-passing-state-directly/31477986#31477986", "title": "Why must we use state monad instead of passing state directly?", "body": "<p>In my experience, the point of many Monads doesn't really click until you get into larger examples, so here is an example use of <code>State</code> (well, <code>StateT ... IO</code>) to parse an incoming request to a web service.</p>\n\n<p>The pattern is that this web service can be called with a bunch of options of different types, though all except for one of the options have decent defaults. If I get a incoming JSON request with an unknown key value, I should abort with an appropriate message. I use the state to keep track of what the current config is, and what the remainder of the JSON request is, along with a bunch of accessor methods.</p>\n\n<p>(Based on code currently in production, with the names of everything changed and the details of what this service actually does obscured)</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule XmpConfig where\n\nimport Data.IORef\nimport Control.Arrow (first)\nimport Control.Monad\nimport qualified Data.Text as T\nimport Data.Aeson hiding ((.=))\nimport qualified Data.HashMap.Strict as MS\nimport Control.Monad.IO.Class (liftIO)\nimport Control.Monad.Trans.State (execStateT, StateT, gets, modify)\nimport qualified Data.Foldable as DF\nimport Data.Maybe (fromJust, isJust)\n\ndata Taggy = UseTags Bool | NoTags\nnewtype Locale = Locale String\n\ndata MyServiceConfig = MyServiceConfig {\n    _mscTagStatus :: Taggy\n  , _mscFlipResult :: Bool\n  , _mscWasteTime :: Bool\n  , _mscLocale :: Locale\n  , _mscFormatVersion :: Int\n  , _mscJobs :: [String]\n  }\n\nbaseWebConfig :: IO (IORef [String], IORef [String], MyServiceConfig)\nbaseWebConfig = do\n  infoRef &lt;- newIORef []\n  warningRef &lt;- newIORef []\n  let cfg = MyServiceConfig {\n        _mscTagStatus = NoTags\n        , _mscFlipResult = False\n        , _mscWasteTime = False\n        , _mscLocale = Locale \"en-US\"\n        , _mscFormatVersion = 1\n        , _mscJobs = []\n        }\n  return (infoRef, warningRef, cfg)\n\nparseLocale :: T.Text -&gt; Maybe Locale\nparseLocale = Just . Locale . T.unpack  -- The real thing does more\n\nparseJSONReq :: MS.HashMap T.Text Value -&gt;\n                IO (IORef [String], IORef [String], MyServiceConfig)\nparseJSONReq m = liftM snd\n                 (baseWebConfig &gt;&gt;= (\\c -&gt; execStateT parse' (m, c)))\n  where\n    parse' :: StateT (MS.HashMap T.Text Value,\n                      (IORef [String], IORef [String], MyServiceConfig))\n              IO ()\n    parse' = do\n      let addWarning s = do let snd3 (_, b, _) = b\n                            r &lt;- gets (snd3 . snd)\n                            liftIO $ modifyIORef r (++ [s])\n          -- These two functions suck a key/value off the input map and\n          -- pass the value on to the handler \"h\"\n          onKey      k h = onKeyMaybe k $ DF.mapM_ h\n          onKeyMaybe k h = do myb &lt;- gets fst\n                              modify $ first $ MS.delete k\n                              h (MS.lookup k myb)\n          -- Access the \"lns\" field of the configuration\n          config setter = modify (\\(a, (b, c, d)) -&gt; (a, (b, c, setter d)))\n\n      onKey \"tags\" $ \\x -&gt; case x of\n        Bool True -&gt;       config $ \\c -&gt; c {_mscTagStatus = UseTags False}\n        String \"true\" -&gt;   config $ \\c -&gt; c {_mscTagStatus = UseTags False}\n        Bool False -&gt;      config $ \\c -&gt; c {_mscTagStatus = NoTags}\n        String \"false\" -&gt;  config $ \\c -&gt; c {_mscTagStatus = NoTags}\n        String \"inline\" -&gt; config $ \\c -&gt; c {_mscTagStatus = UseTags True}\n        q -&gt; addWarning (\"Bad value ignored for tags: \" ++ show q)\n      onKey \"reverse\" $ \\x -&gt; case x of\n        Bool r -&gt; config $ \\c -&gt; c {_mscFlipResult = r}\n        q -&gt; addWarning (\"Bad value ignored for reverse: \" ++ show q)\n      onKey \"spin\" $ \\x -&gt; case x of\n        Bool r -&gt; config $ \\c -&gt; c {_mscWasteTime = r}\n        q -&gt; addWarning (\"Bad value ignored for spin: \" ++ show q)\n      onKey \"language\" $ \\x -&gt; case x of\n        String s | isJust (parseLocale s) -&gt;\n          config $ \\c -&gt; c {_mscLocale = fromJust $ parseLocale s}\n        q -&gt; addWarning (\"Bad value ignored for language: \" ++ show q)\n      onKey \"format\" $ \\x -&gt; case x of\n        Number 1 -&gt; config $ \\c -&gt; c {_mscFormatVersion = 1}\n        Number 2 -&gt; config $ \\c -&gt; c {_mscFormatVersion = 2}\n        q -&gt; addWarning (\"Bad value ignored for format: \" ++ show q)\n      onKeyMaybe \"jobs\" $ \\p -&gt; case p of\n        Just (Array x) -&gt; do q &lt;- parseJobs x\n                             config $ \\c -&gt; c {_mscJobs = q}\n        Just (String \"test\") -&gt;\n          config $ \\c -&gt; c {_mscJobs = [\"test1\", \"test2\"]}\n        Just other -&gt; fail $ \"Bad value for jobs: \" ++ show other\n        Nothing    -&gt; fail \"Missing value for jobs\"\n      m' &lt;- gets fst\n      unless (MS.null m') (fail $ \"Unrecognized key(s): \" ++ show (MS.keys m'))\n\n    parseJobs :: (Monad m, DF.Foldable b) =&gt; b Value -&gt; m [String]\n    parseJobs = DF.foldrM (\\a b -&gt; liftM (:b) (parseJob a)) []\n    parseJob :: (Monad m) =&gt; Value -&gt; m String\n    parseJob (String s) = return (T.unpack s)\n    parseJob q = fail $ \"Bad job value: \" ++ show q\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1437143861, "last_edit_date": 1495541408, "creation_date": 1437143861, "answer_id": 31478376, "question_id": 31475770, "link": "https://stackoverflow.com/questions/31475770/why-must-we-use-state-monad-instead-of-passing-state-directly/31478376#31478376", "title": "Why must we use state monad instead of passing state directly?", "body": "<p>As an example to my <a href=\"https://stackoverflow.com/questions/31475770/why-to-use-state-monad-instead-of-passing-state-directly?noredirect=1#comment50918873_31475770\">comment</a> above, you can write code using the <code>State</code> monad like</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Text (Text)\nimport qualified Data.Text as Text\nimport Control.Monad.State\n\ndata MyState = MyState\n    { _count :: Int\n    , _messages :: [Text]\n    } deriving (Eq, Show)\nmakeLenses ''MyState\n\ntype App = State MyState\n\nincrCnt :: App ()\nincrCnt = modify (\\my -&gt; my &amp; count +~ 1)\n\nlogMsg :: Text -&gt; App ()\nlogMsg msg = modify (\\my -&gt; my &amp; messages %~ (++ [msg]))\n\nlogAndIncr :: Text -&gt; App ()\nlogAndIncr msg = do\n    incrCnt\n    logMsg msg\n\napp :: App ()\napp = do\n    logAndIncr \"First step\"\n    logAndIncr \"Second step\"\n    logAndIncr \"Third step\"\n    logAndIncr \"Fourth step\"\n    logAndIncr \"Fifth step\"\n</code></pre>\n\n<p>Note that using additional operators from <code>Control.Lens</code> also lets you write <code>incrCnt</code> and <code>logMsg</code> as</p>\n\n<pre><code>incrCnt = count += 1\n\nlogMsg msg = messages %= (++ [msg])\n</code></pre>\n\n<p>which is another benefit of using <code>State</code> in combination with the <code>lens</code> library, but for the sake of comparison I'm not using them in this example.  To write the equivalent code above with just argument passing it would look more like</p>\n\n<pre><code>incrCnt :: MyState -&gt; MyState\nincrCnt my = my &amp; count +~ 1\n\nlogMsg :: MyState -&gt; Text -&gt; MyState\nlogMsg my msg = my &amp; messages %~ (++ [msg])\n\nlogAndIncr :: MyState -&gt; Text -&gt; MyState\nlogAndIncr my msg =\n    let incremented = incrCnt my\n        logged = logMsg incremented msg\n    in logged\n</code></pre>\n\n<p>At this point it isn't too bad, but once we get to the next step I think you'll see where the code duplication really comes in:</p>\n\n<pre><code>app :: MyState -&gt; MyState\napp initial =\n    let first_step  = logAndIncr initial     \"First step\"\n        second_step = logAndIncr first_step  \"Second step\"\n        third_step  = logAndIncr second_step \"Third step\"\n        fourth_step = logAndIncr third_step  \"Fourth step\"\n        fifth_step  = logAndIncr fourth_step \"Fifth step\"\n    in fifth_step\n</code></pre>\n\n<p>Another benefit of wrapping this up in a <code>Monad</code> instance is that you can use the full power of <code>Control.Monad</code> and <code>Control.Applicative</code> with it:</p>\n\n<pre><code>app = mapM_ logAndIncr [\n    \"First step\",\n    \"Second step\",\n    \"Third step\",\n    \"Fourth step\",\n    \"Fifth step\"\n    ]\n</code></pre>\n\n<p>Which allows for much more flexibility when processing values calculated at runtime compared to static values.</p>\n\n<p>The difference between manual state passing and using the <code>State</code> monad is simply that the <code>State</code> monad is an abstraction over the manual process.  It also happens to fit several other widely used more general abstractions, like <code>Monad</code>, <code>Applicative</code>, <code>Functor</code>, and a few others.  If you also use the <code>StateT</code> transformer then you can compose these operations with other monads, such as <code>IO</code>.  Can you do all of this without <code>State</code> and <code>StateT</code>?  Of course you can, and there's no one stopping you from doing so, but the point is that <code>State</code> abstracts this pattern out and gives you access to a huge toolbox of more general tools.  Also, a small modification to the types above makes the same functions work in multiple contexts:</p>\n\n<pre><code>incrCnt :: MonadState MyState m =&gt; m ()\nlogMsg :: MonadState MyState m =&gt; Text -&gt; m ()\nlogAndIncr :: MonadState MyState m =&gt; Text -&gt; m ()\n</code></pre>\n\n<p>These will now work with <code>App</code>, or with <code>StateT MyState IO</code>, or any other monad stack with a <code>MonadState</code> implementation.  It makes it significantly more reusable than simple argument passing, which is only possible through the abstraction that is <code>StateT</code>.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2289, "favorite_count": 5, "accepted_answer_id": 31477621, "answer_count": 3, "score": 10, "last_activity_date": 1437345008, "creation_date": 1437135742, "last_edit_date": 1437345008, "question_id": 31475770, "link": "https://stackoverflow.com/questions/31475770/why-must-we-use-state-monad-instead-of-passing-state-directly", "title": "Why must we use state monad instead of passing state directly?", "body": "<p>Can someone show a  simple example where state monad can be better than passing state directly?</p>\n\n<pre><code>bar1 (Foo x) = Foo (x + 1)\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>bar2 :: State Foo Foo\nbar2 = do\n  modify (\\(Foo x) -&gt; Foo (x + 1))\n  get\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 1750, "user_id": 3864685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd0d8ab040f481989e93b910c38c957?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwani", "link": "https://stackoverflow.com/users/3864685/ashwani"}, "edited": false, "score": 1, "creation_date": 1437125780, "post_id": 31472417, "comment_id": 50910706, "body": "<code>Num</code> does not derive <code>Ord</code> in haskell. So you can not use <code>&gt;</code> and <code>&lt;</code> operators on members of <code>Num</code> class."}], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 4937439, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZmHu9gy1S7c/AAAAAAAAAAI/AAAAAAAADpE/tKoIiG2kniU/photo.jpg?sz=128", "display_name": "Sandeep Tuniki", "link": "https://stackoverflow.com/users/4937439/sandeep-tuniki"}, "edited": false, "score": 0, "creation_date": 1437126228, "post_id": 31472621, "comment_id": 50911000, "body": "Thank u very much for helping :-) I&#39;m fairly new to haskell, and these error messages are very cryptic for me to make sense of them !!!"}], "tags": [], "owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "is_accepted": true, "score": 6, "last_activity_date": 1437126370, "last_edit_date": 1437126370, "creation_date": 1437125475, "answer_id": 31472621, "question_id": 31472417, "link": "https://stackoverflow.com/questions/31472417/haskell-throws-an-error-while-specifying-the-type-of-a-parameter/31472621#31472621", "title": "Haskell throws an error while specifying the type of a parameter", "body": "<p>The method <code>&gt;</code> is defined in the <code>Ord</code> class, so you need to add an additional constraint to your type signature:</p>\n\n<pre><code>signum :: (Ord a, Num a) =&gt; a -&gt; Int\n</code></pre>\n\n<p>In GHCi, you can view the methods of a class with <code>:i &lt;Class&gt;</code>, for example:</p>\n\n<pre><code>*Main&gt; :i Ord\nclass Eq a =&gt; Ord a where\n  compare :: a -&gt; a -&gt; Ordering\n  (&lt;) :: a -&gt; a -&gt; Bool\n  (&lt;=) :: a -&gt; a -&gt; Bool\n  (&gt;) :: a -&gt; a -&gt; Bool\n  (&gt;=) :: a -&gt; a -&gt; Bool\n  [...]\n</code></pre>\n\n<p>Alternatively, you can check the method itself:</p>\n\n<pre><code>*Main&gt; :i (&gt;)\nclass Eq a =&gt; Ord a where\n  ...\n  (&gt;) :: a -&gt; a -&gt; Bool\n  ...\n    -- Defined in \u2018GHC.Classes\u2019\ninfix 4 &gt;\n</code></pre>\n\n<p>The reason why the original <code>signum</code> doesn't have this constraint is because it doesn't use the methods from <code>Ord</code>.  Instead, it uses functions specialized to a type in question (like <code>ltInt</code>) or pattern matches directly (see the <code>Word</code> instance): <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Num.html#signum\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Num.html#signum</a></p>\n"}], "owner": {"reputation": 383, "user_id": 4937439, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZmHu9gy1S7c/AAAAAAAAAAI/AAAAAAAADpE/tKoIiG2kniU/photo.jpg?sz=128", "display_name": "Sandeep Tuniki", "link": "https://stackoverflow.com/users/4937439/sandeep-tuniki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 31472621, "answer_count": 1, "score": 0, "last_activity_date": 1437126370, "creation_date": 1437124895, "question_id": 31472417, "link": "https://stackoverflow.com/questions/31472417/haskell-throws-an-error-while-specifying-the-type-of-a-parameter", "title": "Haskell throws an error while specifying the type of a parameter", "body": "<p>I just started learning Haskell. I'm trying to implement a function which takes a number as it's input, and return -1, 0 or 1 depending on it's value. The input can be any number (integer or a floating point). Here is the code:</p>\n\n<pre><code>signum :: (Num a) =&gt; a -&gt; Int\nsignum x\n    | x &gt; 0 = 1\n    | x &lt; 0 = -1\n    | otherwise = 0\n</code></pre>\n\n<p>But when I try to load it into <strong>ghci</strong>, it shows the following error:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( run_it.hs, interpreted )\n\nrun_it.hs:7:13:\nCould not deduce (Ord a) arising from a use of `&gt;'\nfrom the context (Num a)\n  bound by the type signature for Main.signum :: Num a =&gt; a -&gt; Int\n  at run_it.hs:5:11-29\nPossible fix:\n  add (Ord a) to the context of\n    the type signature for Main.signum :: Num a =&gt; a -&gt; Int\nIn the expression: x &gt; 0\nIn a stmt of a pattern guard for\n               an equation for `signum':\n  x &gt; 0\nIn an equation for `signum':\n    signum x\n      | x &gt; 0 = 1\n      | x &lt; 0 = - 1\n      | otherwise = 0\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What does this error mean?</p>\n"}, {"tags": ["haskell", "functional-dependencies", "type-families"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1437124255, "post_id": 31472057, "comment_id": 50909771, "body": "Why even have the <code>[*]</code> index in your <code>Foo</code> GADT, if it&#39;s always equal to <code>[]</code>?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437128638, "post_id": 31472057, "comment_id": 50912446, "body": "Pretend there&#39;s another constructor :)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437128831, "post_id": 31472057, "comment_id": 50912575, "body": "Could you include the other constructors as well? The current set of constructors makes our job rather easy (see user3237465&#39;s answer below for reference)."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437158787, "post_id": 31472057, "comment_id": 50930499, "body": "@Andr&#225;sKov&#225;cs ah, I see what you mean. I added another one... does this make a difference?"}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 6, "last_activity_date": 1437127549, "creation_date": 1437127549, "answer_id": 31473322, "question_id": 31472057, "link": "https://stackoverflow.com/questions/31472057/defined-a-type-family-any-way-to-prove-that-vs-us-implies-vs/31473322#31473322", "title": "Defined a type family (++); any way to prove that (vs ++ us) ~ &#39;[] implies (vs ~ &#39;[]) and (us ~ &#39;[])?", "body": "<p><a href=\"https://twitter.com/pigworker/status/261219712501956609\" rel=\"noreferrer\">Don't touch the green smile!</a></p>\n\n<blockquote>\n  <p>The presence of \u2018green slime\u2019 \u2014 defined functions in the return types\n  of constructors \u2014 is a danger sign.</p>\n</blockquote>\n\n<p>The simplest workaround is to generalize <code>test</code> and then instantiate:</p>\n\n<pre><code>gtest :: Foo xs Int -&gt; Int\ngtest (Foo0 x) = x\ngtest (Foo2 x y) = gtest x + gtest y\n\ntest :: Foo '[] Int -&gt; Int\ntest = gtest\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437203523, "post_id": 31487744, "comment_id": 50941785, "body": "@Andr&#225;sKov&#225;cs It might be that it was never used before. I discovered it not long ago myself and wrote an <a href=\"http://mniip.com/pages/BidirectionalTypeFamilyInference\" rel=\"nofollow noreferrer\">article about it</a>."}], "tags": [], "owner": {"reputation": 796, "user_id": 2337954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac2ebcf2a09563be6eceb2d36a9f531?s=128&d=identicon&r=PG", "display_name": "mniip", "link": "https://stackoverflow.com/users/2337954/mniip"}, "is_accepted": false, "score": 4, "last_activity_date": 1437237148, "last_edit_date": 1437237148, "creation_date": 1437193174, "answer_id": 31487744, "question_id": 31472057, "link": "https://stackoverflow.com/questions/31472057/defined-a-type-family-any-way-to-prove-that-vs-us-implies-vs/31487744#31487744", "title": "Defined a type family (++); any way to prove that (vs ++ us) ~ &#39;[] implies (vs ~ &#39;[]) and (us ~ &#39;[])?", "body": "<p>You could add two type families that would serve as inverses of <code>++</code>, and without loss of generality add them as constraints to the Foo2 constructor. Through those inverse type families GHC would be able to infer exactly what you're asking from it.</p>\n\n<p>Here's an example implementation of <code>CutX</code> and <code>CutY</code> such that <code>r ~ a ++ b</code> &lt;=> <code>a ~ CutY r b</code> &lt;=> <code>b ~ CutX r a</code>.</p>\n\n<pre><code>type family (xs :: [*]) ++ (ys :: [*]) where\n  '[] ++ ys = ys\n  (x ': xs) ++ ys = x ': (xs ++ ys)\n\ntype family CutX (rs :: [*]) (xs :: [*]) where\n    CutX '[] xs = '[]\n    CutX rs '[] = rs\n    CutX (r ': rs) (x ': xs) = CutX rs xs\n\ntype family ZipWithConst (xs :: [*]) (ys :: [*]) where\n    ZipWithConst '[] ys = '[]\n    ZipWithConst xs '[] = '[]\n    ZipWithConst (x ': xs) (y ': ys) = y ': ZipWithConst xs ys\n\ntype CutY rs ys = ZipWithConst rs (CutX rs ys)\n\ndata Foo :: [*] -&gt; * -&gt; * where\n  Foo0 :: a -&gt; Foo '[] a\n  Foo1 :: Foo '[a] a\n  Foo2 :: (rs ~ (vs ++ us), us ~ CutX rs vs, vs ~ CutY rs us) =&gt; Foo vs a -&gt; Foo us a -&gt; Foo rs a\n</code></pre>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 31473322, "answer_count": 2, "score": 3, "last_activity_date": 1437237148, "creation_date": 1437123792, "last_edit_date": 1437158749, "question_id": 31472057, "link": "https://stackoverflow.com/questions/31472057/defined-a-type-family-any-way-to-prove-that-vs-us-implies-vs", "title": "Defined a type family (++); any way to prove that (vs ++ us) ~ &#39;[] implies (vs ~ &#39;[]) and (us ~ &#39;[])?", "body": "<p>Defined:</p>\n\n<pre><code>type family (xs :: [*]) ++ (ys :: [*]) where\n  '[] ++ ys = ys\n  (x ': xs) ++ ys = x ': (xs ++ ys)\n</code></pre>\n\n<p>I have a GADT that's kinda like</p>\n\n<pre><code>data Foo :: [*] -&gt; * -&gt; * where\n  Foo0 :: a -&gt; Foo '[] a\n  Foo1 :: Foo '[a] a\n  Foo2 :: Foo vs a -&gt; Foo us a -&gt; Foo (vs ++ us) a\n</code></pre>\n\n<p>And I want to do something like</p>\n\n<pre><code>test :: Foo '[] Int -&gt; Int\ntest (Foo0 x) = x\ntest (Foo2 x y) = test x + test y\n</code></pre>\n\n<p>But I can't use <code>test</code> on <code>x</code> or <code>y</code> because <code>x ~ Foo '[] Int</code> and <code>y ~ Foo '[] Int</code> have to be proven.  But I want to say that this is proven from the fact that <code>vs ++ us ~ '[]</code> means that the individual <code>vs</code> and <code>us</code> of <code>x</code> and <code>y</code> are necessarily <code>'[]</code>.</p>\n\n<p>Is there any way to do this with type families, or maybe switching over to a multi param typeclass approach with fundeps?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["user-interface", "haskell", "infinite-scroll", "slickgrid", "threepenny-gui"], "comments": [{"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1437222141, "post_id": 31471157, "comment_id": 50945790, "body": "Threepenny-GUI (version 0.6) currently does not have an infinite scrolling widget built-in. Essentially, you have implement your own. Judging from the example that you have linked to, the key is that div elements are created and destroyed whenever the table is being scrolled, so that only the currently visible entries are present in the DOM tree."}, {"owner": {"reputation": 31, "user_id": 5126372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3c7212c10477730fbe29f9f52e6615e?s=128&d=identicon&r=PG&f=1", "display_name": "user5126372", "link": "https://stackoverflow.com/users/5126372/user5126372"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1437373420, "post_id": 31471157, "comment_id": 50982107, "body": "@ErikAllik Thanks for the edits. I don&#39;t have a working code towards infinite scrolling. The code I got so far has two ListBoxes one for page numbers and another displays data rows. I plan to post the code on github."}, {"owner": {"reputation": 31, "user_id": 5126372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3c7212c10477730fbe29f9f52e6615e?s=128&d=identicon&r=PG&f=1", "display_name": "user5126372", "link": "https://stackoverflow.com/users/5126372/user5126372"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1437374244, "post_id": 31471157, "comment_id": 50982414, "body": "@HeinrichApfelmus Could you please guide any example/skelton code? I wanted to understand what kind of events I could use? Will ListBox wouldn&#39;t be a good choice here? I think, I should confess that I am new to Haskell :)"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1437401573, "post_id": 31471157, "comment_id": 50998634, "body": "@user5126372 I currently don&#39;t have any example code for infinite scrolling, sorry. What I&#39;m saying is that it&#39;s more complicated to implement and definitely not supported by the simple-minded <code>ListBox</code> thing."}], "owner": {"reputation": 31, "user_id": 5126372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3c7212c10477730fbe29f9f52e6615e?s=128&d=identicon&r=PG&f=1", "display_name": "user5126372", "link": "https://stackoverflow.com/users/5126372/user5126372"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1437132836, "creation_date": 1437120664, "last_edit_date": 1495542301, "question_id": 31471157, "link": "https://stackoverflow.com/questions/31471157/how-to-build-infinite-scroll-listbox-using-threepenny-gui", "title": "How to build Infinite-scroll listbox using threepenny-gui", "body": "<p>Hello Haskell and Threepenny-GUI community,</p>\n\n<p>I want to display a <a href=\"https://hackage.haskell.org/package/threepenny-gui-0.4.0.1/docs/Graphics-UI-Threepenny-Widgets.html#t:ListBox\" rel=\"nofollow noreferrer\">ListBox</a> which has infinite scrolling support. I have a table in an SQLite database with 100k - 1000k rows. I want to display rows in a ListBox. I got help from this post <a href=\"https://stackoverflow.com/questions/24784883/using-threepenny-gui-reactive-in-client-server-programming\">threepenny-gui-reactive-in-client-server</a>. I got the GUI working with two ListBoxes, one for the page number and the other for actual rows for that page. </p>\n\n<p>Though my goal is to create a GUI that has just one display, something like a basic version but similar to this example using SlickGrid: <a href=\"http://mleibman.github.io/SlickGrid/examples/example4-model.html\" rel=\"nofollow noreferrer\">http://mleibman.github.io/SlickGrid/examples/example4-model.html</a>.</p>\n"}, {"tags": ["haskell", "compiler-errors", "type-inference", "typeclass", "type-families"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437122773, "post_id": 31470914, "comment_id": 50908923, "body": "I&#39;d like to note here that with modern GHC features and libraries (closed type families, data kinds, singletons) we have more powerful and convenient type-level programming facilities than what&#39;s presented in the quoted paper."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437123377, "post_id": 31470914, "comment_id": 50909292, "body": "Also, why can&#39;t you have the modified instances for <code>Nat</code>?"}, {"owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437189021, "post_id": 31470914, "comment_id": 50939135, "body": "The modified instances compile, but when I try to derive instances for <code>LikeInt</code> it fails."}], "answers": [{"comments": [{"owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "edited": false, "score": 0, "creation_date": 1437189159, "post_id": 31474807, "comment_id": 50939159, "body": "I deliberately defined <code>LikeInt</code> that way to show a discrepancy between programmer logic and compiler logic. In my actual project I needed instances defined differently on different subsets of natural numbers, so in this case you could say <code>likeInt</code> is only defined this way for positive integers."}], "tags": [], "owner": {"reputation": 144, "user_id": 5097169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89af5881e326759c5678a3eb56f5c3e0?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Karetnikov", "link": "https://stackoverflow.com/users/5097169/nikita-karetnikov"}, "is_accepted": false, "score": 0, "last_activity_date": 1437132574, "creation_date": 1437132574, "answer_id": 31474807, "question_id": 31470914, "link": "https://stackoverflow.com/questions/31470914/type-class-instance-checking-cant-detect-piecewise-instances/31474807#31474807", "title": "Type class instance checking can&#39;t detect &quot;piecewise instances&quot;", "body": "<p>Can't you just define this instance?</p>\n\n<pre><code>instance Nat n =&gt; LikeInt n where\n  likeInt = toInt\n\n*Main&gt; likeInt (undefined :: Zero)\n0\n*Main&gt; likeInt (undefined :: One)\n1\n*Main&gt; likeInt (undefined :: Two)\n2\n*Main&gt; likeInt (undefined :: Three)\n3\n</code></pre>\n\n<p>Or would you like to avoid the <code>Nat</code> constraint?</p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457747977, "creation_date": 1457747977, "answer_id": 35952852, "question_id": 31470914, "link": "https://stackoverflow.com/questions/31470914/type-class-instance-checking-cant-detect-piecewise-instances/35952852#35952852", "title": "Type class instance checking can&#39;t detect &quot;piecewise instances&quot;", "body": "<p>The compiler told you what to do.</p>\n\n<p>You had</p>\n\n<pre><code>instance (Nat n) =&gt; LikeInt (Succ n) where\n  likeInt = toInt\n</code></pre>\n\n<p>And the compiler said:</p>\n\n<blockquote>\n<pre><code>Could not deduce (Nat (Succ n)) arising from a use of \u2018toInt\u2019\nfrom the context (Nat n)\n</code></pre>\n</blockquote>\n\n<p>So we change the context to give the constraint the compiler asked for. Magic!</p>\n\n<pre><code>instance (Nat (Succ n)) =&gt; LikeInt (Succ n) where\n  likeInt = toInt\n</code></pre>\n\n<p>(and this indeed compiles).</p>\n"}], "owner": {"reputation": 277, "user_id": 1904049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5999425ea996041803f0097a00dd355d?s=128&d=identicon&r=PG", "display_name": "Herng Yi", "link": "https://stackoverflow.com/users/1904049/herng-yi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1457747977, "creation_date": 1437119659, "question_id": 31470914, "link": "https://stackoverflow.com/questions/31470914/type-class-instance-checking-cant-detect-piecewise-instances", "title": "Type class instance checking can&#39;t detect &quot;piecewise instances&quot;", "body": "<p>I have a family of data types indexed by type-level integers, and I define them as instances of some type class in a \"piecewise\" manner, which causes problems when trying to derive instances of another class. To illustrate, I have isolated the problem as follows. Consider this code:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, TypeSynonymInstances,\n             FlexibleInstances  , UndecidableInstances #-}\n\ndata Zero\ndata Succ n\n\ntype One   = Succ Zero\ntype Two   = Succ One\ntype Three = Succ Two\n\nclass Nat n where\n  toInt :: n -&gt; Int\n\ninstance Nat Zero where\n  toInt _ = 0\ninstance Nat One where ------------------------- START MODIFY\n  toInt _ = 1\ninstance (Nat n) =&gt; Nat (Succ (Succ n)) where\n  toInt _ = 2 + toInt (undefined :: n) --------- END MODIFY\n</code></pre>\n\n<p>This is a slight modification of the type-level integers defined in <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/assoc-types/fun-with-type-funs/typefun.pdf\" rel=\"nofollow\">\"Fun with type functions\" by Kiselyov, Jones and Shan</a>. This compiles fine and <code>toInt</code> seems to work as expected. Right now <code>Nat</code> contains all integers <code>Zero</code>, <code>One</code>, <code>Two</code> and so on.</p>\n\n<p>However GHC complains after I add the following lines and recompile:</p>\n\n<pre><code>class LikeInt n where\n  likeInt :: n -&gt; Int\n\ninstance (Nat n) =&gt; LikeInt (Succ n) where\n  likeInt = toInt\n</code></pre>\n\n<p>Error: Could not deduce the <code>(Nat (Succ n))</code> arising from a use of \"<code>toInt</code>\" from the context <code>(Nat n)</code>.</p>\n\n<p>My guess is that when GHC infers that <code>toInt</code> has an argument of type <code>Succ n</code>, but the only instances for <code>Nat</code> are for <code>Zero</code>, <code>Succ Zero</code> and <code>(Nat n0) =&gt; Succ (Succ n0)</code>, and <code>Succ n</code> matches to none of those. This guess is supported by a successful compile when I replace the <code>MODIFY</code> block with the original</p>\n\n<pre><code>instance (Nat n) =&gt; Nat (Succ n) where\n  toInt _ = 1 + toInt (undefined :: n)\n</code></pre>\n\n<p><strong>How can I get <code>likeInt</code> to work just like <code>toInt</code>, even with the modified block? This is important for my actual project.</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1437104412, "post_id": 31467921, "comment_id": 50902070, "body": "So... what have you tried? What do you know about Haskell&#39;s <code>Eq</code> and what is your equivalent of <code>Person</code> in haskell? I can guess, but that kind of thing should be part of the question."}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1437112061, "post_id": 31467921, "comment_id": 50903954, "body": "I think that your Python have some issues...."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1437118102, "post_id": 31467921, "comment_id": 50906617, "body": "Python doesn&#39;t have the <code>new</code> keyword; also <code>if &lt;bool&gt;: return True; else: return False</code> is reduced to just <code>return &lt;bool&gt;</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1437120678, "post_id": 31467921, "comment_id": 50907871, "body": "hi Erik, i removed the new keyword... about the if else error, the <code>return False</code> is left indented by one level actually which is like an else here...."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1437141679, "post_id": 31467921, "comment_id": 50920348, "body": "He meant that <code>a==b: return true; else: return false</code> is the same as just <code>return a==b</code>"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 5, "creation_date": 1437108347, "post_id": 31468113, "comment_id": 50902934, "body": "I think it&#39;s worth pointing out that this Eq instance is equivalent to the automatically derived one."}, {"owner": {"reputation": 167922, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1437108597, "post_id": 31468113, "comment_id": 50903000, "body": "@Cubic: In this case, yes. In a more general case where there are fields other than <code>name</code>, no. (Not saying you are wrong, just explaining why I decided to actually implement <code>Eq</code>.)"}], "tags": [], "owner": {"reputation": 167922, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 4, "last_activity_date": 1437104927, "creation_date": 1437104927, "answer_id": 31468113, "question_id": 31467921, "link": "https://stackoverflow.com/questions/31467921/pythons-in-the-land-of-haskell/31468113#31468113", "title": "Python&#39;s ==, in the land of Haskell", "body": "<pre><code>data Person = Person { name::String } deriving (Show)\n\ninstance Eq Person where\n    x == y = (name x) == (name y)\n\nmain = do\n    let personOne = Person { name=\"saran\" }\n    let personTwo = Person { name=\"madhavan\" }\n    let personThree = Person { name=\"saran\" }\n    print $ personOne == personTwo\n    print $ personOne == personThree\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "closed_date": 1437350669, "accepted_answer_id": 31468113, "answer_count": 1, "score": 0, "last_activity_date": 1437119626, "creation_date": 1437103413, "last_edit_date": 1437119626, "question_id": 31467921, "link": "https://stackoverflow.com/questions/31467921/pythons-in-the-land-of-haskell", "closed_reason": "Duplicate", "title": "Python&#39;s ==, in the land of Haskell", "body": "<p>A sample code that shows how two objects can be compared in Python using <code>==</code> operator:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>class Person:\n  def __init__(name):\n    this.name = name\n\n  def __eq__(nextPerson):\n    if this.name == nextPerson.name:\n      return True\n    return False\n\nif __name__ == '__main__':\n   personOne = Person(\"saran\")\n   personTwo = Person(\"madhavan\")\n   personThree = Person(\"saran\")\n   print personOne == personTwo\n   print personOne == personThree\n</code></pre>\n\n<p>This must print:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>False\nTrue\n</code></pre>\n\n<p>How can I write the above code using <code>Eq</code> typeclass in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1437110781, "post_id": 31467740, "comment_id": 50903553, "body": "Note: to convert a <code>Just (Just x)</code> to a <code>Just x</code> you can use the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:join\" rel=\"nofollow noreferrer\"><code>join</code></a> function. It works with any monad, not just <code>Maybe</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1437117666, "post_id": 31467740, "comment_id": 50906383, "body": "&quot;Why do we need the outer <code>Just</code>?&quot; Because there are two distinct kinds of failures: either we can fail to find the key, or we can succeed in finding the key but discover that there&#39;s no associated value. To model the two distinct kinds of failure, we use two levels of <code>Maybe</code>. (Other models are certainly possible, including ones which throw away information about which kind of failure we encountered.)"}], "answers": [{"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 4, "last_activity_date": 1437102650, "creation_date": 1437102650, "answer_id": 31467843, "question_id": 31467740, "link": "https://stackoverflow.com/questions/31467740/multiple-just-data-constructors-to-wrap-a-value/31467843#31467843", "title": "Multiple Just data constructors to wrap a value", "body": "<p><code>Just 5</code> has type <code>Maybe Int</code>, and <code>Just (Just 5)</code> has type <code>Maybe (Maybe Int)</code>  The values are of different types.</p>\n\n<p>There's not a lot of differrence between<code>Maybe a</code> and <code>Maybe (Maybe a)</code>.  <code>Just x</code> is very similar to <code>Just (Just x)</code>, and <code>Nothing :: Maybe a</code> is very similar to <code>Nothing :: Maybe (Maybe a)</code>.  The only real difference is the existence of <code>Just Nothing</code>, which has no comparable value in <code>Maybe a</code>.  </p>\n\n<p>If you consider type <code>a</code> to have cardinality of N (there are N possible values of type <code>a</code>), then <code>Maybe a</code> has cardinality of N+1, with N values like <code>Just x</code> and one value of <code>Nothing</code>. So <code>Maybe (Maybe a)</code> has a cardinality of N+2.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437102650, "creation_date": 1437101787, "question_id": 31467740, "link": "https://stackoverflow.com/questions/31467740/multiple-just-data-constructors-to-wrap-a-value", "title": "Multiple Just data constructors to wrap a value", "body": "<p>Is <code>Just 5</code> same as <code>Just (Just 5)</code>. Theoretically, i am sure the answer is no but does in real life, do we use values like <code>Just (Just (Just ..... (Just 5)))</code></p>\n\n<p>At least one example i encountered is in <a href=\"https://github.com/cyga/real-world-haskell/blob/master/ch15/MovieReview.hs#L34\" rel=\"nofollow\">real world haskell</a> as,</p>\n\n<pre><code>maybeReview alist = do\ntitle &lt;- lookup1 \"title\" alist\nreturn (MovieReview title)'\n\nlookup1 key alist = case lookup key alist of\n                      Just (Just s@(_:_)) -&gt; Just s\n                      _ -&gt; Nothing\n</code></pre>\n\n<p>Why do we need the outer <code>Just</code> data constructor in this line, </p>\n\n<pre><code>Just (Just s@(_:_)) -&gt; Just s\n</code></pre>\n"}, {"tags": ["haskell", "generics", "aeson"], "comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1437098441, "post_id": 31467255, "comment_id": 50900601, "body": "have you tried adding a derived <code>Read</code> instance?"}, {"owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437099338, "post_id": 31467255, "comment_id": 50900813, "body": "Deriving <code>Read</code> makes no difference, but thank you for the suggestion."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437100230, "post_id": 31467255, "comment_id": 50901033, "body": "I&#39;m not too surprised, but it was the first thing I would have tried. Unfortunately I have no experience with using the default implementation of any method in the <code>FromJSON</code> and <code>ToJSON</code> classes (I&#39;ve always implemented them manually in order to fit a pre-existing schema)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1437101465, "post_id": 31467255, "comment_id": 50901306, "body": "I think you forgot to exorcise the demons. Check with your local clergy."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1437101560, "post_id": 31467255, "comment_id": 50901336, "body": "You should try asking ghci for the types of those nothings."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1437101880, "post_id": 31467255, "comment_id": 50901412, "body": "Also, you might want to try <code>eitherDecode</code> with a type signature to check for encode/decode mismatches."}, {"owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1437104780, "post_id": 31467255, "comment_id": 50902158, "body": "Good call @dfeuer - I&#39;ve added <code>eitherDecode</code> and <code>:t</code> information to the question."}], "answers": [{"comments": [{"owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "edited": false, "score": 0, "creation_date": 1437105208, "post_id": 31468028, "comment_id": 50902257, "body": "Interesting, but it makes incremental testing annoying when you can&#39;t parse your base cases."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "edited": false, "score": 1, "creation_date": 1437105636, "post_id": 31468028, "comment_id": 50902352, "body": "Check the <a href=\"http://json.org/\" rel=\"nofollow noreferrer\">json spec</a>.  The top-level parsing element is an <code>object</code>, but nullary types only fit in as a <code>value</code>.  The automatically derived parser only knows how to parse an <code>object</code>."}, {"owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "edited": false, "score": 1, "creation_date": 1437105879, "post_id": 31468028, "comment_id": 50902416, "body": "Sure, but check the <a href=\"http://hackage.haskell.org/package/aeson-0.9.0.1/docs/Data-Aeson-Parser.html#v:json\" rel=\"nofollow noreferrer\">docs for aeson</a>. &quot;In aeson 0.8 and earlier, it parsed only object or array types, in conformance with the now-obsolete RFC 4627.&quot; Looks like it&#39;s meant to be able to parse things that aren&#39;t objects at the top level?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "reply_to_user": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "edited": false, "score": 0, "creation_date": 1437110750, "post_id": 31468028, "comment_id": 50903541, "body": "<a href=\"http://hackage.haskell.org/package/aeson-0.9.0.1/docs/Data-Aeson-Parser.html#v:value\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-0.9.0.1/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": false, "score": 3, "last_activity_date": 1437104314, "creation_date": 1437104314, "answer_id": 31468028, "question_id": 31467255, "link": "https://stackoverflow.com/questions/31467255/parsing-data-types-with-all-nullary-constructors-using-generic-decode/31468028#31468028", "title": "Parsing data types with all nullary constructors using generic decode", "body": "<p>JSON is fundamentally a collection of key-value pairs, where values can be a few primitive types or another collection of key-value pairs.  Nullary types just don't fit in very well with the whole idea of being JSON entities by themselves.  However, they work fine when placed within other types that mesh well with the JSON concept.</p>\n\n<pre><code>data F = F { a :: CharClass, b :: CharClass }\n    deriving (Generic, Show)\n\ninstance FromJSON F\ninstance ToJSON F\n</code></pre>\n\n<p>This looks more like the sort of key-value collection JSON was designed for.</p>\n\n<pre><code>*Main&gt; let x = F Fighter Rogue\n*Main&gt; x\nF {a = Fighter, b = Rogue}\n*Main&gt; decode $ encode x :: Maybe F\nJust (F {a = Fighter, b = Rogue})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "is_accepted": true, "score": 2, "last_activity_date": 1437106046, "creation_date": 1437106046, "answer_id": 31468239, "question_id": 31467255, "link": "https://stackoverflow.com/questions/31467255/parsing-data-types-with-all-nullary-constructors-using-generic-decode/31468239#31468239", "title": "Parsing data types with all nullary constructors using generic decode", "body": "<p>The version of aeson that <code>stack</code> installed on my machine was from the 0.8 series, and in aeson 0.8 or earlier, <a href=\"http://hackage.haskell.org/package/aeson-0.9.0.1/docs/Data-Aeson-Parser.html#v:json\" rel=\"nofollow\">only objects and arrays were parsed at the root level</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1437116340, "creation_date": 1437116340, "answer_id": 31470065, "question_id": 31467255, "link": "https://stackoverflow.com/questions/31467255/parsing-data-types-with-all-nullary-constructors-using-generic-decode/31470065#31470065", "title": "Parsing data types with all nullary constructors using generic decode", "body": "<p>In aeson 0.9, <code>decode</code> uses <code>value</code> parser. So nullable object (represented as string) at top-level will work.</p>\n\n<p>For 0.8 the below example works. I don't know why <code>decodeWith</code> isn't exposed.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport Control.Applicative\nimport GHC.Generics\nimport Data.Aeson\nimport Data.Aeson.Parser\nimport Data.ByteString.Lazy as L\nimport Data.Attoparsec.ByteString.Char8 (endOfInput, skipSpace)\nimport qualified Data.Attoparsec.Lazy as L\n\ndata CharClass = Fighter | Rogue | Wizard deriving (Generic, Show)\n\ninstance ToJSON CharClass\ninstance FromJSON CharClass\n\ndecodeWith p to s =\n    case L.parse p s of\n      L.Done _ v -&gt; case to v of\n                      Success a -&gt; Just a\n                      _         -&gt; Nothing\n      _          -&gt; Nothing\n{-# INLINE decodeWith #-}\n\nvalueEOF = value &lt;* skipSpace &lt;* endOfInput\n\ndecodeValue :: (FromJSON a) =&gt; L.ByteString -&gt; Maybe a\ndecodeValue = decodeWith valueEOF fromJSON\n\nmain :: IO ()\nmain = print (decodeValue (encode Fighter) :: Maybe CharClass)\n</code></pre>\n"}], "owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 1, "accepted_answer_id": 31468239, "answer_count": 3, "score": 2, "last_activity_date": 1437116340, "creation_date": 1437097918, "last_edit_date": 1495540270, "question_id": 31467255, "link": "https://stackoverflow.com/questions/31467255/parsing-data-types-with-all-nullary-constructors-using-generic-decode", "title": "Parsing data types with all nullary constructors using generic decode", "body": "<p>I have the following code:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, OverloadedStrings #-}\n\nimport Data.Aeson\nimport GHC.Generics\n\ndata CharClass = Fighter | Rogue | Wizard deriving (Generic, Show)\n\ninstance FromJSON CharClass\ninstance ToJSON CharClass\n</code></pre>\n\n<p>I can encode values of this type:</p>\n\n<pre><code>*Main&gt; encode Fighter\n\"\\\"Fighter\\\"\"\n</code></pre>\n\n<p>But round-tripping doesn't work:</p>\n\n<pre><code>*Main&gt; eitherDecode $ encode Fighter\nLeft \"Failed reading: satisfy\"\n*Main&gt; :t eitherDecode $ encode Fighter\neitherDecode $ encode Fighter :: FromJSON a =&gt; Either String a\n</code></pre>\n\n<p>It looks a lot like <a href=\"https://stackoverflow.com/questions/28143342/haskell-adts-with-aeson\">this answered question</a>, but adding the expected type doesn't work:</p>\n\n<pre><code>*Main&gt; eitherDecode $ encode Fighter :: Either String CharClass \nLeft \"Failed reading: satisfy\"\n</code></pre>\n\n<p>Interestingly, it does work for <code>fromJSON</code>/<code>toJSON</code>:</p>\n\n<pre><code>*Main&gt; fromJSON $ toJSON Fighter :: Result CharClass\nSuccess Fighter\n</code></pre>\n\n<p>Making at least one of the constructors non-nullary also makes things work, like if I do this:</p>\n\n<pre><code>data CharClass = Fighter Int | Rogue | Wizard deriving (Generic, Show)\n</code></pre>\n\n<p>And then try to round-trip again:</p>\n\n<pre><code>*Main&gt; decode $ encode (Fighter 0) :: Maybe CharClass\nJust (Fighter 0)\n</code></pre>\n\n<p>I'm sure I'm missing something simple, but attempting to trace this through the generic code made my head spin.</p>\n"}, {"tags": ["haskell", "yesod", "conduit", "http-conduit"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1437108678, "creation_date": 1437108678, "answer_id": 31468578, "question_id": 31467171, "link": "https://stackoverflow.com/questions/31467171/how-does-one-pipe-rawrequestbody-into-requestbodysource/31468578#31468578", "title": "How does one pipe `rawRequestBody` into `requestBodySource`?", "body": "<p>The function <a href=\"http://haddock.stackage.org/lts-2.18/yesod-core-1.4.12/Yesod-Core-Handler.html#v:waiRequest\" rel=\"nofollow\">waiRequest</a> will give you back the WAI <a href=\"http://haddock.stackage.org/lts-2.18/wai-3.0.3.0/Network-Wai.html#t:Request\" rel=\"nofollow\">Request</a> value. You can use <a href=\"http://haddock.stackage.org/nightly-2015-07-15/wai-conduit-3.0.0.2/Network-Wai-Conduit.html\" rel=\"nofollow\">sourceRequestBody</a> to get a <code>Source</code> from that.</p>\n"}], "owner": {"reputation": 2274, "user_id": 1740868, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4fe9e46bcf6b3b5b9787fb33c6847696?s=128&d=identicon&r=PG", "display_name": "Nathan Kot", "link": "https://stackoverflow.com/users/1740868/nathan-kot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 31468578, "answer_count": 1, "score": 2, "last_activity_date": 1437108678, "creation_date": 1437097152, "question_id": 31467171, "link": "https://stackoverflow.com/questions/31467171/how-does-one-pipe-rawrequestbody-into-requestbodysource", "title": "How does one pipe `rawRequestBody` into `requestBodySource`?", "body": "<p>Yesod has <code>rawRequestBody</code> with the following type signature:</p>\n\n<pre><code>rawRequestBody :: MonadHandler m =&gt; Source m ByteString\n</code></pre>\n\n<p>And http-conduit has this function that converts a source into a <code>RequestBody</code>:</p>\n\n<pre><code>requestBodySource :: Int64 -&gt; Source (ResourceT IO) ByteString -&gt; RequestBody\n</code></pre>\n\n<p>I want to be able to stream the <code>rawRequestBody</code> to an S3 object by converting it into a <code>RequestBody</code> <em>inside a handler</em>, <code>ResourceT IO ~ MonadHandler</code> doesn't compute and I can't seem to do <code>MonadHandler m =&gt; m -&gt; ResourceT IO</code></p>\n\n<p>I've tried:</p>\n\n<p><a href=\"https://www.stackage.org/lts-2.18/hoogle?q=transpipe\" rel=\"nofollow\"><code>transPipe</code></a> - if we get <code>Source Handler ByteString</code> from <code>rawRequestBody</code> it seems like the only way to get at the <code>ByteString</code> is to <code>consume</code> it, i.e </p>\n\n<pre><code>transPipe ??? rawRequestBody :: Source (ResourceT IO) ByteString\n</code></pre>\n\n<p><a href=\"https://www.stackage.org/lts-2.18/hoogle?q=handlertoio\" rel=\"nofollow\"><code>handlerToIO</code></a> - however it seems like the request body is cleared so there won't be any data available</p>\n\n<p>Please help :)</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "is_accepted": false, "score": 10, "last_activity_date": 1437091750, "creation_date": 1437091750, "answer_id": 31466540, "question_id": 31466539, "link": "https://stackoverflow.com/questions/31466539/where-does-stack-build-store-generated-executables/31466540#31466540", "title": "Where does `stack build` store generated executables?", "body": "<p>The <code>stack path --local-install-root</code> command solves this problem. E.g., to setup your path for the binaries from <code>stack --stack-yaml stack-7.8.yaml</code>, do</p>\n\n<pre><code>export PATH=$(stack --stack-yaml stack-7.8.yaml path --local-install-root):$PATH\n</code></pre>\n\n<p>Note: the <code>stack exec</code> command can also be used here, but I don't want to clutter my scripts with calls to <code>stack --stack-yaml stack-7.8.yaml exec &lt;cmd&gt;</code> instead of plain <code>&lt;cmd&gt;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 9059617, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FoMCORdGyCo/AAAAAAAAAAI/AAAAAAAAAB0/C6zgyvlzF2M/photo.jpg?sz=128", "display_name": "Patrick Jennings", "link": "https://stackoverflow.com/users/9059617/patrick-jennings"}, "is_accepted": false, "score": 5, "last_activity_date": 1570746830, "creation_date": 1570746830, "answer_id": 58331961, "question_id": 31466539, "link": "https://stackoverflow.com/questions/31466539/where-does-stack-build-store-generated-executables/58331961#58331961", "title": "Where does `stack build` store generated executables?", "body": "<p>To answer the question in the title, the executables are stored in a project-local <code>.stack-work</code> folder. For me, the full path from the project folder is <code>.stack-work/dist/e626a42b/build/{PROJECT_NAME}-exe</code>. Other executables, such as the test and bench executables, are also stored here, in <code>{PROJECT_NAME}-test</code> and <code>{PROJECT_NAME}-bench</code> respectively.</p>\n"}], "owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2081, "favorite_count": 3, "answer_count": 2, "score": 12, "last_activity_date": 1570746830, "creation_date": 1437091750, "question_id": 31466539, "link": "https://stackoverflow.com/questions/31466539/where-does-stack-build-store-generated-executables", "title": "Where does `stack build` store generated executables?", "body": "<p>I'm using multiple <code>stack.yaml</code> files to build against GHC 7.8 and 7.10. How do I set up my <code>PATH</code> to include the binaries for a specific <code>stack.yaml</code> file, e.g. <code>stack-7.8.yaml</code>?</p>\n"}, {"tags": ["haskell", "recursion", "church-encoding", "catamorphism", "recursion-schemes"], "comments": [{"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 0, "creation_date": 1437086072, "post_id": 31464976, "comment_id": 50897536, "body": "What is your failure? I&#39;ve tried this (adding <code>newtype</code> for convenience) and it works fine."}, {"owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "reply_to_user": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 0, "creation_date": 1437086802, "post_id": 31464976, "comment_id": 50897763, "body": "I updated my question"}, {"owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "reply_to_user": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 1, "creation_date": 1437087322, "post_id": 31464976, "comment_id": 50897916, "body": "The <code>newtype</code> turned out to be essential and not merely a convenience. The code works now."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440866589, "post_id": 31464976, "comment_id": 52454281, "body": "It is in fact true that any algebraic data type has a church encoding."}, {"owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "edited": false, "score": 0, "creation_date": 1442424222, "post_id": 31464976, "comment_id": 53080640, "body": "Yep. I even tried to Church-encode the base functor: <a href=\"http://nponeccop.livejournal.com/454146.html\" rel=\"nofollow noreferrer\">nponeccop.livejournal.com/454146.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "is_accepted": false, "score": 4, "last_activity_date": 1514857573, "last_edit_date": 1514857573, "creation_date": 1437087821, "answer_id": 31465996, "question_id": 31464976, "link": "https://stackoverflow.com/questions/31464976/catamorphisms-for-church-encoded-lists/31465996#31465996", "title": "Catamorphisms for Church-encoded lists", "body": "<p>The <code>newtype</code> wrapper turned out to be the crucial step I missed. Here is the code along with a sample catamorphism from <code>recursion-schemes</code>. </p>\n\n<pre><code>{-# LANGUAGE LambdaCase, Rank2Types, TypeFamilies #-}\n\nimport Data.Functor.Foldable\n\nnewtype ListC a = ListC { foldListC :: forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b }\n\ntype instance Base (ListC a) = ListF a\n\ncons :: a -&gt; ListC a -&gt; ListC a\ncons x (ListC xs) = ListC $ \\cons' nil' -&gt; x `cons'` xs cons' nil'\nnil :: ListC a\nnil = ListC $ \\cons' nil' -&gt; nil'\n\ntoList :: ListC a -&gt; [a]\ntoList f = foldListC f (:) []\nfromList :: [a] -&gt; ListC a\nfromList l = foldr cons nil l\n\ninstance Recursive (ListC a) where\n  project xs = foldListC xs f Nil\n    where f x Nil = Cons x nil\n          f x (Cons tx xs) = Cons x $ tx `cons` xs\n\nlen = cata $ \\case Nil -&gt; 0\n                   Cons _ l -&gt; l + 1\n</code></pre>\n"}], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1514857573, "creation_date": 1437082709, "last_edit_date": 1514856678, "question_id": 31464976, "link": "https://stackoverflow.com/questions/31464976/catamorphisms-for-church-encoded-lists", "title": "Catamorphisms for Church-encoded lists", "body": "<p>I want to be able to use <code>cata</code> from <code>recursion-schemes</code> package for lists in Church encoding. </p>\n\n<pre><code>type ListC a = forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b\n</code></pre>\n\n<p>I used a second rank type for convenience, but I don't care. Feel free to add a <code>newtype</code>, use GADTs, etc. if you feel it is necessary.</p>\n\n<p>The idea of Church encoding is widely known and simple:</p>\n\n<pre><code>three :: a -&gt; a -&gt; a -&gt; List1 a \nthree a b c = \\cons nil -&gt; cons a $ cons b $ cons c nil\n</code></pre>\n\n<p>Basically \"abstract unspecified\" <code>cons</code> and <code>nil</code> are used instead of \"normal\" constructors. I believe everything can be encoded this way (<code>Maybe</code>, trees, etc.).</p>\n\n<p>It's easy to show that <code>List1</code> is indeed isomorphic to normal lists:</p>\n\n<pre><code>toList :: List1 a -&gt; [a]\ntoList f = f (:) []\n\nfromList :: [a] -&gt; List1 a\nfromList l = \\cons nil -&gt; foldr cons nil l\n</code></pre>\n\n<p>So its base functor is the same as of lists, and it should be possible to implement <code>project</code> for it and use the machinery from <code>recursion-schemes</code>.</p>\n\n<p>But I couldn't, so my question is \"how do I do that?\". For normal lists, I can just pattern match:</p>\n\n<pre><code>decons :: [a] -&gt; ListF a [a]\ndecons [] = Nil\ndecons (x:xs) = Cons x xs\n</code></pre>\n\n<p>Since I cannot pattern-match on functions, I have to use a fold to deconstruct the list. I could write a fold-based <code>project</code> for normal lists:</p>\n\n<pre><code>decons2 :: [a] -&gt; ListF a [a]\ndecons2 = foldr f Nil\n  where f h Nil = Cons h []\n        f h (Cons hh t) = Cons h $ hh : t\n</code></pre>\n\n<p>However I failed to adapt it for Church-encoded lists:</p>\n\n<pre><code>-- decons3 :: ListC a -&gt; ListF a (ListC a)\ndecons3 ff = ff f Nil\n  where f h Nil = Cons h $ \\cons nil -&gt; nil\n        f h (Cons hh t) = Cons h $ \\cons nil -&gt; cons hh (t cons nil)\n</code></pre>\n\n<p><code>cata</code> has the following signature:</p>\n\n<pre><code>cata :: Recursive t =&gt; (Base t a -&gt; a) -&gt; t -&gt; a\n</code></pre>\n\n<p>To use it with my lists, I need:</p>\n\n<ol>\n<li>To declare the base functor type for the list using <code>type family instance Base (ListC a) = ListF a</code></li>\n<li>To implement <code>instance Recursive (List a) where project = ...</code></li>\n</ol>\n\n<p>I fail at both steps.</p>\n"}, {"tags": ["haskell", "ghci", "maybe"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 3, "creation_date": 1437117068, "post_id": 31464546, "comment_id": 50906122, "body": "What does that expression have to do with <code>Maybe</code>?"}, {"owner": {"reputation": 5151, "user_id": 2565025, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/24803583/picture?type=large", "display_name": "Joe Susnick", "link": "https://stackoverflow.com/users/2565025/joe-susnick"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1437429658, "post_id": 31464546, "comment_id": 51015337, "body": "When I posted the question I also had the way of writing it which didn&#39;t have the error: ( Just &quot;I am a basic string...&quot;) so the original (pre-edited) question was wondering why the expected type which was a Just &quot;something&quot; would be wrapped in [ ]."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 6, "last_activity_date": 1437084503, "last_edit_date": 1437084503, "creation_date": 1437081478, "answer_id": 31464702, "question_id": 31464546, "link": "https://stackoverflow.com/questions/31464546/why-does-the-maybe-type-wrap-its-value-in-a-list/31464702#31464702", "title": "Why does the Maybe type wrap its value in a list?", "body": "<p>List <code>[]</code> is a functor too. GHC unifies <code>fmap</code> to be on lists, and deduces from the first argument that its type is <code>fmap :: (String -&gt; String) -&gt; [String] -&gt; String</code>:</p>\n\n<pre><code>\u03bb Prelude &gt; :t (fmap :: (String -&gt; String) -&gt; [String] -&gt; [String]) (++ \"String to be appended to\")  (\"I am a basic string, not a type constructor\")\n\n&lt;interactive&gt;:1:88:\n    Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n    Expected type: [String]\n    Actual type: [Char]\n</code></pre>\n\n<p>But you probably expect <code>fmap</code> to be specialised to <code>fmap :: (String -&gt; String) -&gt; Maybe String -&gt; Maybe String</code>, which would give a different error message:</p>\n\n<pre><code>\u03bb Prelude &gt; (fmap :: (String -&gt; String) -&gt; Maybe String -&gt; Maybe String) (++ \"String to be appended to\")  (\"I am a basic string, not a type constructor\")\n\n&lt;interactive&gt;:11:96:\n    Couldn't match expected type \u2018Maybe String\u2019\n                with actual type \u2018[Char]\u2019\n    In the second argument of \u2018fmap ::\n                                 (String -&gt; String) -&gt; Maybe String -&gt; Maybe String\u2019, namely\n      \u2018(\"I am a basic string, not a type constructor\")\u2019\n</code></pre>\n\n<p>Sometimes GHC doesn't get our intentions, and finds the \"wrong\" cause of our error.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1437119469, "creation_date": 1437119469, "answer_id": 31470860, "question_id": 31464546, "link": "https://stackoverflow.com/questions/31464546/why-does-the-maybe-type-wrap-its-value-in-a-list/31470860#31470860", "title": "Why does the Maybe type wrap its value in a list?", "body": "<p>Your code will work if you simply add a <code>Just</code>:</p>\n\n<pre><code>fmap (++ \"xyz\") (Just \"another string\")\n</code></pre>\n\n<p>results in: <code>Just \"another stringxyz\"</code></p>\n"}], "owner": {"reputation": 5151, "user_id": 2565025, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/24803583/picture?type=large", "display_name": "Joe Susnick", "link": "https://stackoverflow.com/users/2565025/joe-susnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 31464702, "answer_count": 2, "score": 0, "last_activity_date": 1437119469, "creation_date": 1437080866, "last_edit_date": 1437116821, "question_id": 31464546, "link": "https://stackoverflow.com/questions/31464546/why-does-the-maybe-type-wrap-its-value-in-a-list", "title": "Why does the Maybe type wrap its value in a list?", "body": "<p>I'm going through <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow\">learnyouahaskell</a>, great book, and I'm at the chapter on typeclasses. Here's the question. In GHCi when I enter</p>\n\n<pre><code>fmap (++ \"String to be appended to\") (\"I am a basic string, not a type constructor\")\n</code></pre>\n\n<p>I get the error </p>\n\n<pre><code>Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\nExpected type: [[Char]]\n  Actual type: [Char]\nIn the second argument of \u2018fmap\u2019, namely\n  \u2018(\"I am a basic string, not a type constructor\")\u2019\n</code></pre>\n\n<p>I understand why I'm getting this error (because a functor requires a type constructor with a value like <code>Just \"I am a value being passed to the Maybe type constructor\"</code> but I don't understand why the error reads expected type <code>[[Char]]</code> is the Maybe type actually wrapping the value in a list? What's the deal?</p>\n"}, {"tags": ["haskell", "parsec", "functional-dependencies"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1437084154, "post_id": 31464337, "comment_id": 50896873, "body": "I tried to make <code>StreamDep s t | s -&gt; t</code> superclass of <code>Stream</code> and use that: <code>data MStream s = forall t. StreamDep s t =&gt; MStream (Maybe t) (m ()) s</code>. Also <code>data MStream s = forall m t. Stream s m t =&gt; MStream (Maybe t) (m ()) s</code>. I&#39;d say, not worth the pain."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1437085266, "creation_date": 1437085266, "answer_id": 31465532, "question_id": 31464337, "link": "https://stackoverflow.com/questions/31464337/using-functional-dependency-to-eliminate-type-parameter/31465532#31465532", "title": "Using functional dependency to eliminate type parameter", "body": "<p>With</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE ExistentialQuantification  #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule MStream where\n\nimport Control.Monad ( liftM )\n\n-- Class so we don't need to carry `m` in `MStream` definition.\nclass StreamDep s t | s -&gt; t where\nclass StreamDep s t =&gt; Stream s m t where\n  uncons :: s -&gt; m (Maybe (t, s))\n\ndata MStream s = forall t. StreamDep s t =&gt; MStream (Maybe t) s\n\ndata ParsecT s u m a = ParsecT s u (m a)\ninstance Monad m =&gt; Monad (ParsecT s u m) where\n\ngetInput :: ParsecT s u m s\ngetInput = undefined\n\ninstance StreamDep s t =&gt; StreamDep (MStream s) t where\n\ninstance (Monad m, Stream s m t) =&gt; Stream (MStream s) m t where\n  uncons (MStream _ s) = fmap (\\(t, s') -&gt; (t, MStream (Just t) s')) `liftM` uncons s\n\ngetPrevToken :: (Monad m, Stream s m t) =&gt; ParsecT (MStream s) u m (Maybe t)\ngetPrevToken = (\\(MStream t _) -&gt; t) `liftM` getInput\n\nmstream :: StreamDep s t =&gt; s -&gt; MStream s\n</code></pre>\n\n<p>I get quite close, but get an error:</p>\n\n<pre><code>Pars.hs:28:35:\n    Could not deduce (t1 ~ t)\n    from the context (Monad m, Stream s m t)\n      bound by the type signature for\n                 getPrevToken :: (Monad m, Stream s m t) =&gt;\n                                 ParsecT (MStream s) u m (Maybe t)\n      at Pars.hs:27:17-76\n    or from (StreamDep s t1)\n      bound by a pattern with constructor\n                 MStream :: forall s t. StreamDep s t =&gt; Maybe t -&gt; s -&gt; MStream s,\n               in a lambda abstraction\n</code></pre>\n\n<p>Yet by using both contexts <code>Stream s m t</code> and <code>StreamDep s t1</code> it should be obvious that <code>(t ~ t1)</code>.</p>\n\n<p>By using artillery, we can make it compile:</p>\n\n<pre><code>getPrevToken :: (Monad m, Stream s m t) =&gt; ParsecT (MStream s) u m (Maybe t)\ngetPrevToken = (\\(MStream t _) -&gt; unsafeCoerce t) `liftM` getInput\n</code></pre>\n\n<p>But I cannot try this, as it requires modification to <code>parsec</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 0, "last_activity_date": 1437093729, "last_edit_date": 1437093729, "creation_date": 1437093345, "answer_id": 31466751, "question_id": 31464337, "link": "https://stackoverflow.com/questions/31464337/using-functional-dependency-to-eliminate-type-parameter/31466751#31466751", "title": "Using functional dependency to eliminate type parameter", "body": "<p>So, I solved this by moving the goalposts (somewhat):</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, FlexibleInstances,\n             MultiParamTypeClasses, FunctionalDependencies #-}\n\nmodule MStream where\n\nimport Text.Parsec\nimport Control.Monad ( liftM )\n\nclass Stream s m t =&gt; MStream s m t | s -&gt; t where\n  getPrevToken :: ParsecT s u m (Maybe t)\n\ndata MStreamImpl s t = MStreamImpl (Maybe t) s\n\ninstance Stream s m t =&gt; MStream (MStreamImpl s t) m t where\n  getPrevToken = (\\(MStreamImpl t _) -&gt; t) `liftM` getInput\n\ninstance Stream s m t =&gt; Stream (MStreamImpl s t) m t where\n  uncons (MStreamImpl _ s) = fmap (\\(t, s') -&gt; (t, MStreamImpl (Just t) s')) `liftM` uncons s\n\nmstream :: s -&gt; MStreamImpl s t\nmstream = MStreamImpl Nothing\n\nsillyParser :: MStream s m Char =&gt; ParsecT s u m String\nsillyParser = do\n  t &lt;- getPrevToken\n  maybe (string \"first\") (\\c -&gt; string $ \"last\" ++ [c]) t\n</code></pre>\n\n<p>Instead of trying to remove the type parameter from <code>MStream</code>, I turned <code>MStream</code> into a typeclass, with a canonical instance <code>MStreamImpl</code>.  So now, the <code>sillyParser</code> type signature can be written in a more compact manner simply by replacing the <code>Stream</code> context with an <code>MStream</code> context.</p>\n"}], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 31466751, "answer_count": 2, "score": 2, "last_activity_date": 1437093729, "creation_date": 1437080049, "last_edit_date": 1437093455, "question_id": 31464337, "link": "https://stackoverflow.com/questions/31464337/using-functional-dependency-to-eliminate-type-parameter", "title": "Using functional dependency to eliminate type parameter", "body": "<p>I am trying to implement a Parsec <code>Stream</code> wrapper that will remember the last <code>uncons</code>'d token in order to provide some look-behind capability.  I want the wrapper to work with any <code>Stream</code> instance.  Here's what I have so far:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses #-}\nmodule MStream where\n\nimport Text.Parsec\nimport Control.Monad ( liftM )\n\ndata MStream s t = MStream (Maybe t) s\n\ninstance Stream s m t =&gt; Stream (MStream s t) m t where\n  uncons (MStream _ s) = fmap (\\(t, s') -&gt; (t, MStream (Just t) s')) `liftM` uncons s\n\ngetPrevToken :: Stream s m t =&gt; ParsecT (MStream s t) u m (Maybe t)\ngetPrevToken = (\\(MStream t _) -&gt; t) `liftM` getInput\n\nmstream :: s -&gt; MStream s t\nmstream = MStream Nothing\n</code></pre>\n\n<p>This works, but I don't like having to carry the <code>t</code> parameter in the <code>MStream</code> type constructor.  Surely it should be sufficient to require only the <code>s</code> parameter, since <code>t</code> can be derived from <code>s</code> as long as there is a witness for <code>Stream s m t</code>.  I've tried using type families and GADTs, but I keep running into obscure errors about ambiguous type variables and unsatisfied functional dependencies.</p>\n\n<p>Is there a way to remove <code>t</code> from the <code>MStream</code> type constructor so I don't have to write:</p>\n\n<pre><code>sillyParser :: Stream s m Char =&gt; ParsecT (MStream s Char) u m String\nsillyParser = do\n  t &lt;- getPrevToken\n  maybe (string \"first\") (\\c -&gt; string $ \"last\" ++ [c]) t\n</code></pre>\n"}, {"tags": ["haskell", "lambda-calculus", "gadt", "type-families"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 5, "creation_date": 1437079980, "post_id": 31463874, "comment_id": 50894908, "body": "I read \u201cWhy won&#39;t GHC reduce my family?\u201d and it sounded very brutal."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1437080985, "post_id": 31463874, "comment_id": 50895400, "body": "@JoachimBreitner Even the best compilers can&#39;t do everything you want them to"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1437085678, "post_id": 31463874, "comment_id": 50897419, "body": "I&#39;d suspect overlapping definitions in <code>Remove</code>, based on <a href=\"https://wiki.haskell.org/GHC/Type_families#Closed_family_simplification\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/Type_families#Closed_family_simplificat&zwnj;&#8203;ion</a>. You&#39;d probably need a constraint, witnessing that types are inequal"}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1437087564, "post_id": 31465834, "comment_id": 50897991, "body": "So it seems that <code>Remove &quot;x&quot; &#39;[&quot;x&quot;]</code> unifies with <code>&#39;[]</code>, but doesn&#39;t normalise to it, at least not at the interactive prompt. Any idea why? &quot;GHC seems to be just lazy&quot; is certainly true, but I was hoping for a more illuminating explanation!"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1437088315, "post_id": 31465834, "comment_id": 50898209, "body": "I&#39;m not 100% sure. <a href=\"https://wiki.haskell.org/GHC/Type_families#Closed_family_simplification\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/Type_families#Closed_family_simplificat&zwnj;&#8203;ion</a> there is section about how GADTs make things harder. So maybe not <i>lazy</i>, but <i>careful</i> (which someone could understand as the same :) )."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1437086782, "creation_date": 1437086782, "answer_id": 31465834, "question_id": 31463874, "link": "https://stackoverflow.com/questions/31463874/why-wont-ghc-reduce-my-type-family/31465834#31465834", "title": "Why won&#39;t GHC reduce my type family?", "body": "<p>It works. GHC seems to be just lazy.</p>\n\n<pre><code>\u03bb *Main &gt; :t (Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\")))\n(Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\")))\n  :: Expr (Remove \"x\" '[\"x\"])\n\n\u03bb *Main &gt; :t (Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\"))) :: Expr '[]\n(Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\"))) :: Expr '[]\n  :: Expr '[]\n\n\u03bb *Main &gt; :t (Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\"))) :: Expr '[\"x\"]\n\n&lt;interactive&gt;:1:2:\n    Couldn't match type \u2018'[]\u2019 with \u2018'[\"x\"]\u2019\n    Expected type: Expr '[\"x\"]\n      Actual type: Expr (Remove \"x\" '[\"x\"])\n    In the expression:\n        (Lam (Proxy :: Proxy \"x\") (Var (Proxy :: Proxy \"x\"))) ::\n          Expr '[\"x\"]\n</code></pre>\n\n<hr>\n\n<p>I changed definitions so there isn't dependency on singletons library (easier to test in ad-hoc):</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, DataKinds, TypeFamilies, GADTs #-}\n\nimport Data.Proxy\nimport GHC.TypeLits\n\ntype family Remove (x :: Symbol) (xs :: [Symbol]) where\n    Remove x '[] = '[]\n    Remove x (x ': xs) = Remove x xs\n    Remove x (y ': xs) = y ': Remove x xs\n\ndata Expr (free :: [Symbol]) where\n    Var :: KnownSymbol a =&gt; Proxy a -&gt; Expr '[a]\n    Lam :: KnownSymbol a =&gt; Proxy a -&gt; Expr as -&gt; Expr (Remove a as)\n--    App :: Expr free1 -&gt; Expr free2 -&gt; Expr (Union free1 free2)\n</code></pre>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 1, "accepted_answer_id": 31465834, "answer_count": 1, "score": 6, "last_activity_date": 1437119247, "creation_date": 1437078302, "last_edit_date": 1437119247, "question_id": 31463874, "link": "https://stackoverflow.com/questions/31463874/why-wont-ghc-reduce-my-type-family", "title": "Why won&#39;t GHC reduce my type family?", "body": "<p>Here's an untyped lambda calculus whose terms are indexed by their free variables. I'm using the <a href=\"https://hackage.haskell.org/package/singletons-1.1.2.1\" rel=\"nofollow\"><code>singletons</code></a> library for singleton values of type-level strings.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Data.Singletons\nimport Data.Singletons.TypeLits\n\ndata Expr (free :: [Symbol]) where\n    Var :: Sing a -&gt; Expr '[a]\n    Lam :: Sing a -&gt; Expr as -&gt; Expr (Remove a as)\n    App :: Expr free1 -&gt; Expr free2 -&gt; Expr (Union free1 free2)\n</code></pre>\n\n<p>A <code>Var</code> introduces a free variable. A lambda abstraction binds a variable which appears free in the body (if there's one which matches). Applications join up the free variables of the two parts of the expression, removing duplicates (so the free variables of <code>x y</code> are <code>x</code> and <code>y</code>, while the free variables of <code>x x</code> are just <code>x</code>). I wrote out those type families:</p>\n\n<pre><code>type family Remove x xs where\n    Remove x '[] = '[]\n    Remove x (x ': xs) = Remove x xs\n    Remove x (y ': xs) = y ': Remove x xs\n\ntype family Union xs ys where\n    Union xs ys = Nub (xs :++ ys)\n\ntype family xs :++ ys where\n    '[] :++ ys = ys\n    (x ': xs) :++ ys = x ': (xs :++ ys)\n\ntype family Nub xs where\n    Nub xs = Nub' '[] xs\n\ntype family Nub' seen xs where\n    Nub' seen '[] = '[]\n    Nub' seen (x ': xs) = If (Elem x seen) (Nub' seen xs) (Nub' (x ': seen) (x ': xs))\n\ntype family If c t f where\n    If True t f = t\n    If False t f = f\n\ntype family Elem x xs where\n    Elem x '[] = False\n    Elem x (x ': xs) = True\n    Elem x (y ': xs) = Elem x xs\n</code></pre>\n\n<p>I tested this out at the interactive prompt:</p>\n\n<pre><code>ghci&gt; :t Var (sing :: Sing \"x\")\nVar (sing :: Sing \"x\") :: Expr '[\"x\"]  -- good\nghci&gt; :t (Lam (sing :: Sing \"x\") (Var (sing :: Sing \"x\")))\n(Lam (sing :: Sing \"x\") (Var (sing :: Sing \"x\")))\n  :: Expr (Remove \"x\" '[\"x\"])  -- not so good\n</code></pre>\n\n<p>I was surprised to learn that the type of the identity function <code>\\x. x</code> is <code>Expr (Remove \"x\" '[\"x\"])</code>, not <code>Expr '[]</code>. GHC seems unwilling to evaluate the type family <code>Remove</code>.\nI experimented a little more and learned that it's not a problem with my type family per se - GHC is happy to reduce it in this case:</p>\n\n<pre><code>ghci&gt; :t (Proxy :: Proxy (Remove \"x\" '[\"x\"]))\n(Proxy :: Proxy (Remove \"x\" '[\"x\"])) :: Proxy '[]\n</code></pre>\n\n<p>So: Why won't GHC reduce <code>Remove \"x\" '[\"x\"]</code> to <code>'[]</code> when I query the type of my GADT? In general, when will-or-won't the type checker evaluate a type family? Are there heuristics I can use to avoid being surprised by its behaviour?</p>\n"}, {"tags": ["scala", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1437079449, "post_id": 31464145, "comment_id": 50894630, "body": "Could you please explain what <code>is strict in it&#39;s spine</code> means?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1437080500, "post_id": 31464145, "comment_id": 50895155, "body": "Ah, <code>Apply</code> and <code>Bind</code> are nice finds! Btw you don&#39;t have to <i>make</i> those instances, they&#39;re already given in that package :-)"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1437080769, "post_id": 31464145, "comment_id": 50895294, "body": "@Bergi Good point, but I added them here for completeness, so one sees what they are."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1437090085, "post_id": 31464145, "comment_id": 50898677, "body": "I think the discussion of strictness should probably be preceded by an explanation of the essential problem: given a value but no key, the only <code>Map</code> you can make is empty, and <code>pure = const empty</code> violates the <code>Applicative</code> laws."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1437140152, "post_id": 31464145, "comment_id": 50919289, "body": "In your clarification of spine (thanks), <code>seq l () == ()</code> since the Weak Head Normal Form of <code>Cons a l</code> does not require evaluating <code>l</code>? Same reason that <code>&gt; seq [1..] () == ()</code>, no?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1437190200, "post_id": 31464145, "comment_id": 50939341, "body": "Conal Elliott&#39;s <a href=\"http://conal.net/papers/type-class-morphisms/\" rel=\"nofollow noreferrer\">Denotational design with type class morphisms</a> discusses the design of a <code>Map</code>-alike that implements <code>Applicative</code>. I think it could also be a <code>Monad</code> on the subcategory of Hask that only contains <code>Semigroup</code> instances. (By which I mean one could probably implement a law-abiding <code>(&gt;&gt;=) :: Semigroup b =&gt; TMap k a -&gt; (a -&gt; TMap k b) -&gt; TMap k b</code>.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437190656, "post_id": 31464145, "comment_id": 50939430, "body": "(Oops, rereading the paper it seems he even proves one can implement <code>Monad</code> without the <code>Semigroup</code> restriction! Sweet.)"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437204523, "post_id": 31464145, "comment_id": 50941944, "body": "@DanielWagner thanks for the pointer, added section about that into the answer."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1437204892, "post_id": 31464145, "comment_id": 50942014, "body": "@KevinMeredith maybe scala versions would help: <code>Cons(h: A, t: =&gt; List&lt;A&gt;)</code>, but strict is <code>SCons(h: A, t: List&lt;A&gt;)</code>. That (memoized) function indirection makes thing work for non-strict version."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 6, "last_activity_date": 1437805354, "last_edit_date": 1437805354, "creation_date": 1437079334, "answer_id": 31464145, "question_id": 31463460, "link": "https://stackoverflow.com/questions/31463460/no-monad-instance-for-data-map-but-scalas-map/31464145#31464145", "title": "No Monad Instance for `Data.Map`, but Scala&#39;s Map?", "body": "<p>It's hard to reason what Scala's <code>flatMap</code> is supposed to do:</p>\n\n<pre><code>trait Map[A, B+] extends Iterable[(A, B)] {\n  def flatMap[B](f: (A) \u21d2 GenTraversableOnce[B]): Map[B]\n}\n</code></pre>\n\n<p>It takes a <strong>key, value</strong> pair of map (because flatMap comes from <code>Iterable</code>, where <code>A</code> is <code>(A,B)</code>):</p>\n\n<pre><code>scala&gt; val m = Map(\"one\" -&gt; 1, \"two\" -&gt; 2)\nm: scala.collection.immutable.Map[String,Int] = Map(one -&gt; 1, two -&gt; 2)\n\nscala&gt; m.flatMap (p =&gt; p match { case (_, v) =&gt; List(v, v + 3) })\nres1: scala.collection.immutable.Iterable[Int] = List(1, 4, 2, 5)\n</code></pre>\n\n<p>This isn't monadic bind, it's more closer to <code>Foldable</code>'s <code>foldMap</code></p>\n\n<pre><code>\u03bb &gt; import Data.Map\n\u03bb &gt; import Data.Monoid\n\u03bb &gt; import Data.Foldable\n\u03bb &gt; let m = fromList [(\"one\", 1), (\"two\", 2)]\n\u03bb &gt; (\\v -&gt; [v, v + 3]) `foldMap` m\n[1,4,2,5]\n</code></pre>\n\n<hr>\n\n<p><code>Map</code> is lawful <a href=\"https://hackage.haskell.org/package/semigroupoids-1.2.2/docs/Data-Functor-Apply.html\" rel=\"nofollow\"><code>Ord k =&gt; Apply (Map k v)</code></a> and <a href=\"https://hackage.haskell.org/package/semigroupoids-1.2.2/docs/Data-Functor-Bind.html\" rel=\"nofollow\"><code>Ord k =&gt; Bind (Map k v)</code></a>:</p>\n\n<pre><code>-- | A Map is not 'Applicative', but it is an instance of 'Apply'\ninstance Ord k =&gt; Apply (Map k) where\n  (&lt;.&gt;) = Map.intersectionWith id\n  (&lt;. ) = Map.intersectionWith const\n  ( .&gt;) = Map.intersectionWith (const id)\n\n-- | A 'Map' is not a 'Monad', but it is an instance of 'Bind'\ninstance Ord k =&gt; Bind (Map k) where\n  m &gt;&gt;- f = Map.mapMaybeWithKey (\\k -&gt; Map.lookup k . f) m\n</code></pre>\n\n<p>Which is a bit like <code>ZipList</code> instance could be, <em>zipping</em> elements by key. <em>Note:</em> <code>ZipList</code> isn't <code>Bind</code> (only <code>Apply</code>) because you cannot remove elements from between the range.</p>\n\n<p>And you cannot make it <code>Applicative</code> or <code>Monad</code>, because there are no way to make lawful <code>pure</code> / <code>return</code>, which should have a value at all keys. Or it might be possible if some <code>Finite</code> type class is constraining <code>k</code> (because <code>Map</code> is strict in it's spine, so you cannot create infinite maps).</p>\n\n<hr>\n\n<p><em>EDIT:</em> pointed out in the comments. If we think properly, the above tries to make a concrete (inspectable) representation of <code>MaybeT (Reader k) v = k -&gt; Maybe v</code> with <code>Map k v</code>. But we fail, as we cannot represent <code>pure x = const x</code>. But we can try to do that by explicitly representing that case:</p>\n\n<pre><code>module MMap (main) where\n\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Test.QuickCheck\nimport Test.QuickCheck.Function\n\nimport Control.Applicative\nimport Control.Monad\n\n-- [[ MMap k v ]] \u2245 k -&gt; Maybe v \ndata MMap k v = MConstant v\n              | MPartial (Map k v)\n  deriving (Eq, Ord, Show)\n\n-- Morphism\nlookup :: Ord k =&gt; k -&gt; MMap k v -&gt; Maybe v\nlookup _ (MConstant x) = Just x\nlookup k (MPartial m)  = Map.lookup k m\n\ninstance Functor (MMap k) where\n  fmap f (MConstant v) = MConstant (f v)\n  fmap f (MPartial m)  = MPartial (fmap f m)\n\ninstance Ord k =&gt; Applicative (MMap k) where\n  pure = MConstant\n  (MConstant f) &lt;*&gt; (MConstant x) = MConstant (f x)\n  (MConstant f) &lt;*&gt; (MPartial x)  = MPartial (fmap f x)\n  (MPartial f)  &lt;*&gt; (MConstant x) = MPartial (fmap ($x) f)\n  (MPartial f)  &lt;*&gt; (MPartial x)  = MPartial (Map.intersectionWith ($) f x)\n\ninstance Ord k =&gt; Monad (MMap k) where\n  return = MConstant\n  (MConstant x) &gt;&gt;= f = f x\n  (MPartial m) &gt;&gt;= f  = MPartial $ Map.mapMaybeWithKey (\\k -&gt; MMap.lookup k . f) m\n\ninstance (Ord k, Arbitrary k, Arbitrary v) =&gt; Arbitrary (MMap k v) where\n  arbitrary = oneof [ MConstant &lt;$&gt; arbitrary \n                    , MPartial . Map.fromList &lt;$&gt; arbitrary\n                    ]\n\nprop1 :: Int -&gt; Fun Int (MMap Int Int) -&gt; Property\nprop1 x (Fun _ f) = (return x &gt;&gt;= f) === f x\n\nprop2 :: MMap Int Int -&gt; Property\nprop2 x = (x &gt;&gt;= return) === x\n\nprop3 :: MMap Int Int -&gt; Fun Int (MMap Int Int) -&gt; Fun Int (MMap Int Int) -&gt; Property\nprop3 m (Fun _ f) (Fun _ g) = ((m &gt;&gt;= f) &gt;&gt;= g) === (m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g))\n\nmain :: IO ()\nmain = do\n  quickCheck prop1\n  quickCheck prop2\n  quickCheck prop3\n</code></pre>\n\n<p>It indeed works! Yet this a bit fishy definition, as we cannot define semantically correct <code>Eq</code> instance:</p>\n\n<pre><code>m1 = MConstant 'a'\nm2 = MPartial (Map.fromList [(True, 'a'), (False, 'a')])\n</code></pre>\n\n<p>The <code>m1</code> are <code>m2</code> are semantically equivalent (<code>lookup k</code> has same results), but structurally different. And we can't know when <code>MPartial</code> have all key-values defined.</p>\n\n<hr>\n\n<p>Spine refers to, uh, data structure spine. For example list defined as</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>ins't strict in the spine, but</p>\n\n<pre><code>data SList a = SNil | SCons a !(SList a)\n</code></pre>\n\n<p>is.</p>\n\n<p>You can define infinite <code>List</code>, but <code>SList</code>s:</p>\n\n<pre><code>\u03bb Prelude &gt; let l = Cons 'a' l\n\u03bb Prelude &gt; let sl = SCons 'a' sl\n\u03bb Prelude &gt; l `seq` ()\n()\n\u03bb Prelude &gt; sl `seq` () -- goes into infinite loop\n</code></pre>\n\n<p>As <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/src/Data-Map-Base.html#Map\" rel=\"nofollow\"><code>Map</code> is also strict in it's spine</a></p>\n\n<pre><code>data Map k a  = Bin {-# UNPACK #-} !Size !k a !(Map k a) !(Map k a)\n              | Tip\n</code></pre>\n\n<p>we cannot construct infinite <code>Map</code>, even we had means to get all values of <code>k</code> type. But we can construct infinite ordinary Haskell list: <code>[]</code> to make <code>pure</code> for <code>Applicative ZipList</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1437080354, "post_id": 31464219, "comment_id": 50895083, "body": "Before posting, I had this same very same question. So, from ghci, I ran <code>return x :: Map Int Int</code>"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1437118197, "post_id": 31464219, "comment_id": 50906676, "body": "This would only work if there was a <code>Monad</code> instance, which you already know doesn&#39;t exist."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1437079603, "creation_date": 1437079603, "answer_id": 31464219, "question_id": 31463460, "link": "https://stackoverflow.com/questions/31463460/no-monad-instance-for-data-map-but-scalas-map/31464219#31464219", "title": "No Monad Instance for `Data.Map`, but Scala&#39;s Map?", "body": "<p>How would you implement <code>return</code> for <code>Data.Map</code>? Presumably <code>return x</code> would have <code>x</code> as a value, but with what key(s)?</p>\n"}, {"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1437147364, "post_id": 31464259, "comment_id": 50924292, "body": "The right identity law doesn&#39;t seem to hold: <code>m &gt;&gt;= return</code> for any map with non-<code>mempty</code> key. Invalid instances destroy equational reasoning, please don&#39;t make them."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1437148410, "post_id": 31464259, "comment_id": 50924928, "body": "@phadej: Thanks. I initially planned to incorporate a check of the monad laws in my answer, but then forgot it. I&#39;ve removed the nonsense :-)"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 3, "last_activity_date": 1437148331, "last_edit_date": 1495535627, "creation_date": 1437079782, "answer_id": 31464259, "question_id": 31463460, "link": "https://stackoverflow.com/questions/31463460/no-monad-instance-for-data-map-but-scalas-map/31464259#31464259", "title": "No Monad Instance for `Data.Map`, but Scala&#39;s Map?", "body": "<p>No, there is no <code>Monad</code> instance for <code>Map</code> indeed.</p>\n\n<blockquote>\n  <p>I see that Scala's Map implements <code>flatMap</code>.</p>\n</blockquote>\n\n<p>I assume you notice that alone <a href=\"https://stackoverflow.com/q/27750046/1048572\">doesn't make it a monad</a>?</p>\n\n<p>But we can try nonetheless to make Haskell's <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a> a <code>Monad</code>. How would it intuitively work? We'd map over the values of the map, return a new map for each, and then <code>join</code> together all those maps by using <code>unions</code>. That should work!</p>\n\n<p>Indeed, if we take a closer look at the classes that <code>Map</code> implements we see something very similar:</p>\n\n<pre><code>import Data.Map\nimport Data.Traversable\nimport Data.Foldable\nimport Data.Monoid\n</code></pre>\n\n<p>where <code>Monoid.mconcat</code> takes the role of our <code>unions</code>, and <code>Traversable</code> offers a <code>foldMapDefault</code> that does exactly what we want (and could be used for <code>&gt;&gt;=</code>)!</p>\n\n<p>However, when we want to implement <code>return</code> we have a problem - there's no key! We get a value, but we cannot make a <code>Map</code> from that! That's the same problem Scala has avoided by making <code>flatMap</code> more generic than a monad. We could solve this by getting a default value for the key, e.g. by requiring the key type to be a <code>Monoid</code> instance, and make an <code>instance (Ord k, Monoid k) =&gt; Monad (Map k)</code> with that - but it will fail to satisfy the monad laws because of the limited <code>return</code>.</p>\n\n<p>Still, all the use cases of the overloaded <code>flatMap</code> in Scala are covered by equivalent methods on Haskell <code>Map</code>s. You'll want to have a closer look at <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#v:mapMaybe\" rel=\"nofollow noreferrer\"><code>mapMaybe</code></a>/<a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#v:mapMaybeWithKey\" rel=\"nofollow noreferrer\"><code>mapMaybeWithkey</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow noreferrer\"><code>foldMap</code></a>/<a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#v:foldMapWithKey\" rel=\"nofollow noreferrer\"><code>foldMapWithKey</code></a>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1437805354, "creation_date": 1437076812, "last_edit_date": 1495535354, "question_id": 31463460, "link": "https://stackoverflow.com/questions/31463460/no-monad-instance-for-data-map-but-scalas-map", "title": "No Monad Instance for `Data.Map`, but Scala&#39;s Map?", "body": "<p>Using <code>:i Map</code>, I don't see a <code>Monad</code> instance for it.</p>\n\n<pre><code>ghci&gt; import Data.Map\nghci&gt; :i Map\ntype role Map nominal representational\ndata Map k a\n  = containers-0.5.5.1:Data.Map.Base.Bin {-# UNPACK #-} !containers-0.5.5.1:Data.Map.Base.Size\n                                         !k\n                                         a\n                                         !(Map k a)\n                                         !(Map k a)\n  | containers-0.5.5.1:Data.Map.Base.Tip\n    -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\u2019\ninstance (Eq k, Eq a) =&gt; Eq (Map k a)\n  -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\u2019\ninstance Functor (Map k)\n  -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\u2019\ninstance (Ord k, Ord v) =&gt; Ord (Map k v)\n  -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\u2019\ninstance (Ord k, Read k, Read e) =&gt; Read (Map k e)\n  -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\u2019\ninstance (Show k, Show a) =&gt; Show (Map k a)\n  -- Defined in \u2018containers-0.5.5.1:Data.Map.Base\n</code></pre>\n\n<p>However, I see that Scala's <a href=\"http://www.scala-lang.org/api/2.11.5/index.html#scala.collection.immutable.Map\" rel=\"nofollow noreferrer\">Map</a> implements <code>flatMap</code>.</p>\n\n<p>I do not know if <code>Map</code> if obeys the Monad Laws.</p>\n\n<p>If my observation on <code>Data.Map</code> is correct, then why isn't there an <code>instance Monad (Map)</code> in Haskell?</p>\n\n<p>I looked at this <a href=\"https://stackoverflow.com/questions/4973335/does-there-exist-a-monad-instance-for-data-map-data-intmap\">answer</a>, but it looks like it uses Monad Transformers.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1437128892, "post_id": 31466079, "comment_id": 50912608, "body": "Indeed, putting happy-1.19.5 into my path (was 1.18.9) allowed me to install haskell-src-meta. Thanks!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1437088425, "creation_date": 1437088425, "answer_id": 31466079, "question_id": 31458887, "link": "https://stackoverflow.com/questions/31458887/can-haskell-src-meta-be-installed-to-be-used-with-ghc-7-10-1/31466079#31466079", "title": "Can haskell-src-meta be installed to be used with GHC 7.10.1?", "body": "<p>Looks like your happy executable needs to be upgraded. You can install the new version with cabal-install. Alternatively, using stack will automatically install the correct version of happy.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22, "favorite_count": 0, "accepted_answer_id": 31466079, "answer_count": 1, "score": 0, "last_activity_date": 1437088425, "creation_date": 1437061607, "last_edit_date": 1437082882, "question_id": 31458887, "link": "https://stackoverflow.com/questions/31458887/can-haskell-src-meta-be-installed-to-be-used-with-ghc-7-10-1", "title": "Can haskell-src-meta be installed to be used with GHC 7.10.1?", "body": "<p>I tried, but I got this error:</p>\n\n<p><a href=\"https://gist.github.com/Wizek/a3e02b93b9f672a91f54\" rel=\"nofollow\">https://gist.github.com/Wizek/a3e02b93b9f672a91f54</a></p>\n\n<p>I remember trying with GHC 7.8.4 too, and AFAIR that also failed similarly.</p>\n\n<h1>Misc</h1>\n\n<p>I've used a new &amp; empty cabal sandbox</p>\n\n<p>cabal-install version 1.22.2.0</p>\n"}, {"tags": ["haskell", "set"], "comments": [{"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1437060021, "post_id": 31456563, "comment_id": 50883388, "body": "Real World Haskell has two chapters that might help you: <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow noreferrer\">Profiling and Optimization</a> and <a href=\"http://book.realworldhaskell.org/read/testing-and-quality-assurance.html\" rel=\"nofollow noreferrer\">Testing and Quality Assurance</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1437070131, "creation_date": 1437070131, "answer_id": 31461517, "question_id": 31456563, "link": "https://stackoverflow.com/questions/31456563/transitive-closure-of-a-graph-in-haskell/31461517#31461517", "title": "Transitive closure of a graph in Haskell", "body": "<p>Some comments:</p>\n\n<ol>\n<li><p>Some ideas for Quickcheck tests:</p>\n\n<ul>\n<li>Create a random connected graph and verify that every pair of points is in the transitive closure.</li>\n<li>Verify that for any random graph the transitive closure of the transitive closure is just the same as doing the transitive closure just once.</li>\n<li>Verify that your code returns the same answer as another implementation (such as from the <a href=\"https://hackage.haskell.org/package/fgl\" rel=\"nofollow\">fgl</a> library.)</li>\n</ul></li>\n</ol>\n\n<p>However, when I look at the fgl library I see that they just use a fixed graph to test their path query functions. Then they know exactly what the answers should be for all the tests.</p>\n\n<p>Another idea is to solve an ACM (programming competition) problem which involves finding the transitive closure of a graph, and use your code in that solution. Both <a href=\"http://acm.timus.ru\" rel=\"nofollow\">Timus</a> and <a href=\"http://codeforces.com\" rel=\"nofollow\">codeforces</a> accept Haskell programs.</p>\n\n<ol start=\"2\">\n<li>In <code>isMemberOfTransitiveGraph</code> you have the common sub-expression <code>transitiveClusureOfGraph gr</code>. Now GHC could (and should) detect this and factor it out so that it doesn't get evaluated twice, but it doesn't always do that. Moreover, being an interpreter, ghci won't perform common sub-expression elimination. So, given that <code>transitiveClusureOfGraph</code> is an expensive operation, you should write this function like</li>\n</ol>\n\n<p>this:</p>\n\n<pre><code>isMemberOfTransitiveGraph (x,y) gr\n  | S.member (x,y) closure = T\n  | S.member (y,x) closure = F\n  | otherwise              = U\n  where\n    closure = transitiveClusureOfGraph gr in\n</code></pre>\n\n<ol start=\"3\">\n<li><p>Also, computing the transitive closure for the entire graph is\nan expensive way to determine if a specific pair is in the closure.\nA better way to implement <code>isMemberOfTransitiveClosure</code> is to simply\nperform a depth-first search start at one member of the pair until you a) either find the other element or b) fill out the connected component without finding the other element. Otherwise you are performing a lot of work on the other connected components which is irrelevant to the question you are trying to answer.</p></li>\n<li><p>If you are really concerned about efficiency, restrict your node type to <code>Int</code> and use <code>Data.IntSet</code> or even <code>Data.BitSet</code> for sets of nodes.</p></li>\n</ol>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "accepted_answer_id": 31461517, "answer_count": 1, "score": 3, "last_activity_date": 1437290926, "creation_date": 1437055585, "last_edit_date": 1495540270, "question_id": 31456563, "link": "https://stackoverflow.com/questions/31456563/transitive-closure-of-a-graph-in-haskell", "title": "Transitive closure of a graph in Haskell", "body": "<p>The following program has as its purpose the transitive closure of relation (as a set of ordered pairs - a graph) and a test about membership of an ordered pair to that relation.</p>\n\n<p>I tried to make the program efficient through the use of Data.Set instead of lists and eliminating redundancies in the generation of the missing pair.</p>\n\n<p>I would like to know:</p>\n\n<ol>\n<li>how to use QuickCheck to verify its correctness;</li>\n<li>how calculate the efficiency of the program, if it is possible, or\nhow does it compare with similar solutions of the problem (ex.\n<a href=\"https://stackoverflow.com/questions/19212558/transitive-closure-from-a-list-using-haskell\">Transitive closure from a list</a> ).</li>\n</ol>\n\n<p>Any criticism and suggestion will be appreciated.</p>\n\n<pre><code>import Data.Set as S\nimport Data.Foldable as F (foldMap)\n\ndata TruthValue = F | U | T deriving (Show,Eq)\n\nisMemberOfTransitiveGraph :: Ord t =&gt; (t, t) -&gt; Set (t, t) -&gt; TruthValue\n(x,y) `isMemberOfTransitiveGraph` gr\n  | S.member (x,y) closure = T -- as suggested by user5402\n  | S.member (y,x) closure = F -- as suggested by user5402\n  | otherwise = U\n  where\n  closure = transitiveClusureOfGraph gr -- as suggested by user5402\n\ntransitiveClusureOfGraph :: Ord a =&gt; Set (a, a) -&gt; Set (a, a)\ntransitiveClusureOfGraph gr = F.foldMap (transitiveClosureOfArgument gr) domain\n  where\n  domain = S.map fst gr\n\ntransitiveClosureOfArgument :: Ord a =&gt; Set (a, a) -&gt; a -&gt; Set (a, a)\ntransitiveClosureOfArgument gr x = S.map ((,) x) $ recursiveImages gr (S.singleton x)\n\nrecursiveImages :: Ord a =&gt; Set (a, a) -&gt; Set a -&gt; Set a\nrecursiveImages gr imgs = f gr imgs S.empty\n  where\n  f :: Ord a =&gt; Set (a, a) -&gt; Set a -&gt; Set a -&gt; Set a\n  f gr imgs acc\n    | S.null imgs = acc\n    | otherwise = f gr (newImgs S.\\\\ acc) (S.union newImgs acc)\n    where\n    newImgs = F.foldMap (imaginsOf gr) imgs\n\nimaginsOf :: (Ord b, Eq a) =&gt; Set (a, b) -&gt; a -&gt; Set b\nimaginsOf gr arg =  S.foldr (\\(a,b) acc -&gt; if a == arg then S.insert b acc else acc) S.empty gr\n</code></pre>\n\n<p>**</p>\n\n<h2>EXAMPLE 1</h2>\n\n<p>**</p>\n\n<pre><code>someLessThan = S.fromList [(\"1\",\"2\"),(\"1\",\"4\"),(\"3\",\"4\"),(\"2\",\"8\"),(\"3\",\"5\"),(\"4\",\"7\"),(\"4\",\"8\"),(\"3\",\"9\")]\n\n&gt; transitiveClusureOfGraph someLessThan\n&gt; fromList [(\"1\",\"2\"),(\"1\",\"4\"),(\"1\",\"7\"),(\"1\",\"8\"),(\"2\",\"8\"),(\"3\",\"4\"),(\"3\",\"5\"),(\"3\",\"7\"),(\"3\",\"8\"),(\"3\",\"9\"),(\"4\",\"7\"),(\"4\",\"8\")]\n\na `isLessThan` b = (a,b) `isMemberOfTransitiveGraph`  someLessThan\n&gt; \"1\" `isLessThan` \"8\"\n&gt; T\n&gt; \"8\" `isLessThan` \"1\"\n&gt; F\n&gt; \"1\" `isLessThan` \"9\"\n&gt; U\n&gt; \"9\" `isLessThan` \"1\"\n&gt; U\n</code></pre>\n\n<p>**</p>\n\n<h2>EXAMPLE 2</h2>\n\n<p>**</p>\n\n<pre><code>someTallerThan = S.fromList  [(\"Alexandre\",\"Andrea\"),(\"Andrea\",\"John\"),(\"George\",\"Frank\"),(\"George\",\"Lucy\"),(\"John\",\"Liza\"),(\"Julia\",\"Lucy\"),(\"Liza\",\"Bob\"),(\"Liza\",\"Frank\")]\n\n&gt; transitiveClusureOfGraph someTallerThan\n&gt; fromList [(\"Alexandre\",\"Andrea\"),(\"Alexandre\",\"Bob\"),(\"Alexandre\",\"Frank\"),(\"Alexandre\",\"John\"),(\"Alexandre\",\"Liza\"),(\"Andrea\",\"Bob\"),(\"Andrea\",\"Frank\"),(\"Andrea\",\"John\"),(\"Andrea\",\"Liza\"),(\"George\",\"Frank\"),(\"George\",\"Lucy\"),(\"John\",\"Bob\"),(\"John\",\"Frank\"),(\"John\",\"Liza\"),(\"Julia\",\"Lucy\"),(\"Liza\",\"Bob\"),(\"Liza\",\"Frank\")]\n\na `isTallerThan` b = (a,b) `isMemberOfTransitiveGraph` someTallerThan\n&gt; \"Alexandre\" `isTallerThan` \"Frank\"\n&gt; T\n&gt; \"Frank\" `isTallerThan` \"Alexandre\"\n&gt; F\n&gt; \"Alexandre\" `isTallerThan` \"George\"\n&gt; U\n&gt; \"George\" `isTallerThan` \"Alexandre\"\n&gt; U\n</code></pre>\n\n<p>**</p>\n\n<h2>EXAMPLE 3</h2>\n\n<p>**</p>\n\n<pre><code>incomeIsLessOrEqualThan = S.fromList [(\"Bob\",\"Liza\"),(\"Liza\",\"Tom\"),(\"Tom\",\"Bob\"),(\"Tom\",\"Mary\"),   (\"Tom\",\"Tom\")]\n\n&gt; S.filter (\\(a,b) -&gt; a /= b) $ transitiveClusureOfGraph incomeIsLessOrEqualThan\n\n&gt; fromList [(\"Bob\",\"Liza\"),(\"Bob\",\"Mary\"),(\"Bob\",\"Tom\"),(\"Liza\",\"Bob\"),(\"Liza\",\"Mary\"),(\"Liza\",\"Tom\"),(\"Tom\",\"Bob\"),(\"Tom\",\"Liza\"),(\"Tom\",\"Mary\")]\n</code></pre>\n"}, {"tags": ["sockets", "haskell", "syntax"], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 5122746, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/97f4b3d26b8de56a948c0c679a23c8ff?s=128&d=identicon&r=PG&f=1", "display_name": "Cap", "link": "https://stackoverflow.com/users/5122746/cap"}, "edited": false, "score": 0, "creation_date": 1437050611, "post_id": 31450278, "comment_id": 50876041, "body": "Thanks, that certainly helps me understand so will accept the solution."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 4, "last_activity_date": 1437038591, "creation_date": 1437038591, "answer_id": 31450278, "question_id": 31449905, "link": "https://stackoverflow.com/questions/31449905/haskell-socket-action-invocation-syntax/31450278#31450278", "title": "Haskell socket action invocation syntax", "body": "<p>It only really means \"take this expression to produce this type\". Convoluted? Not really, consider</p>\n\n<pre><code>x = 0\n</code></pre>\n\n<p>What type is x of? <code>Num a =&gt; a</code>. What if you wanted specifically an <code>Int</code>?</p>\n\n<pre><code>x = 0 :: Int\n</code></pre>\n\n<p>That's all there is to it. It's not specific to sockets at all, it's a part of standard Haskell syntax.</p>\n"}], "owner": {"reputation": 79, "user_id": 5122746, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/97f4b3d26b8de56a948c0c679a23c8ff?s=128&d=identicon&r=PG&f=1", "display_name": "Cap", "link": "https://stackoverflow.com/users/5122746/cap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 31450278, "answer_count": 1, "score": 1, "last_activity_date": 1437038591, "creation_date": 1437037588, "question_id": 31449905, "link": "https://stackoverflow.com/questions/31449905/haskell-socket-action-invocation-syntax", "title": "Haskell socket action invocation syntax", "body": "<p>In the code snippet <code>s &lt;- socket :: IO (Socket Inet Stream TCP)</code> what does the sub-expression starting with \"::\" mean?</p>\n\n<p>I can understand when \"::\" is used in a function signature as in <code>socket :: (Family f, Type t, Protocol  p) =&gt; IO (Socket f t p)</code>, but not when \"::\" is used in the action invocation as in this case.</p>\n\n<p>This is as listed in the example code at <a href=\"http://hackage.haskell.org/package/socket-0.5.2.0/docs/System-Socket.html\" rel=\"nofollow\">the Haskell socket manual</a></p>\n"}, {"tags": ["haskell", "file-io", "text-parsing"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1437033512, "post_id": 31448358, "comment_id": 50865061, "body": "Please compile with -O2 if you haven&#39;t."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1437033646, "post_id": 31448358, "comment_id": 50865137, "body": "Don&#39;t use <code>String</code>. Use either <code>ByteString</code> or (more likely) <code>Text</code>. The <code>String</code> type is very flexible, but very inefficient for just about everything."}, {"owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437033648, "post_id": 31448358, "comment_id": 50865140, "body": "@Andr&#225;sKov&#225;cs I forgot to mention, I did compile it with -O2. Actually it doesn&#39;t make a difference :-\\ Anyway: k&#246;szi"}, {"owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1437033744, "post_id": 31448358, "comment_id": 50865205, "body": "@MathematicalOrchid but <code>readFile</code> has <code>readFile :: FilePath -&gt; IO String</code>. How should I force using <code>ByteString</code> or <code>Text</code>?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1437033852, "post_id": 31448358, "comment_id": 50865270, "body": "@septi Have a look in <code>Data.Text.IO</code>. You&#39;ll find another <code>readFile</code> function that returns a <code>Text</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": false, "score": 5, "last_activity_date": 1437034158, "creation_date": 1437034158, "answer_id": 31448694, "question_id": 31448358, "link": "https://stackoverflow.com/questions/31448358/parsing-ascii-file-efficiently-in-haskell/31448694#31448694", "title": "Parsing ASCII file efficiently in Haskell", "body": "<p>Your Haskell version uses the type <code>String</code> to represent the text of the file. <code>String</code> is an alias for <code>[Char]</code> which is a linked list of characters. That's not a good representation for large strings.</p>\n\n<p>Try using the <a href=\"http://hackage.haskell.org/package/text\">text</a> package instead. It represents strings as arrays (in the <code>Data.Text.*</code> modules) or as linked lists of arrays (in the <code>Data.Text.Lazy.*</code> modules). To port your existing code, you probably want the latter, because I guess you don't want to load the full 600MB file into memory at once. Look in the <a href=\"http://hackage.haskell.org/package/text/docs/Data-Text-Lazy.html\"><code>Data.Text.Lazy</code></a> and <a href=\"http://hackage.haskell.org/package/text/docs/Data-Text-Lazy-IO.html\"><code>Data.Text.Lazy.IO</code></a> modules for variants of the <code>readFile</code>, <code>filter</code>, <code>isPrefixOf</code> etc. functions you're using.</p>\n\n<p>If you're sure you only want to support ASCII, you can also look into using the <a href=\"http://hackage.haskell.org/package/bytestring\"><code>bytestring</code></a> package instead of the <code>text</code> package.</p>\n"}, {"comments": [{"owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "edited": false, "score": 0, "creation_date": 1437034987, "post_id": 31448852, "comment_id": 50865911, "body": "Wow, that&#39;s impressive. Got under half a second with that!"}, {"owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "edited": false, "score": 0, "creation_date": 1437035477, "post_id": 31448852, "comment_id": 50866198, "body": "Does this read the whole file into memory? Since I also need to parse files larger than 10GB\u2026"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "edited": false, "score": 0, "creation_date": 1437036182, "post_id": 31448852, "comment_id": 50866631, "body": "Yes, it loads everything. See the edit of the answer."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 11, "last_activity_date": 1437036132, "last_edit_date": 1437036132, "creation_date": 1437034596, "answer_id": 31448852, "question_id": 31448358, "link": "https://stackoverflow.com/questions/31448358/parsing-ascii-file-efficiently-in-haskell/31448852#31448852", "title": "Parsing ASCII file efficiently in Haskell", "body": "<p>I benchmarked the following solution:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString.Char8 as B\n\nmain =\n  print . length . filter (B.isPrefixOf \"foo\") . B.lines =&lt;&lt; B.readFile \"test.txt\"\n</code></pre>\n\n<p><code>text.txt</code> is a 170 MB file with 8 million lines, and half of the lines start with \"foo\". I compiled with GHC 7.10 and <code>-O2 -fllvm</code>. </p>\n\n<p>The <code>ByteString</code> version ran in <strong>0.27</strong> seconds, while the original version ran in <strong>5.16</strong> seconds.</p>\n\n<p>However, the strict <code>ByteString</code> version uses 170 MB memory loading the full file. Changing the import to <code>Data.ByteString.Lazy.Char8</code> I got <strong>0.39</strong> sec runtime and 1 MB memory usage.</p>\n"}], "owner": {"reputation": 20694, "user_id": 531222, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9bec8a835a986f86131125137da13a83?s=128&d=identicon&r=PG&f=1", "display_name": "tamasgal", "link": "https://stackoverflow.com/users/531222/tamasgal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 3, "accepted_answer_id": 31448852, "answer_count": 2, "score": 9, "last_activity_date": 1437036668, "creation_date": 1437033120, "last_edit_date": 1437036668, "question_id": 31448358, "link": "https://stackoverflow.com/questions/31448358/parsing-ascii-file-efficiently-in-haskell", "title": "Parsing ASCII file efficiently in Haskell", "body": "<p>I wanted to reimplement some of my ASCII parsers in Haskell since I thought I could gain some speed. However, even a simple \"grep and count\" is much slower than a sloppy Python implementation.</p>\n\n<p>Can someone explain me why and how to do it correctly?</p>\n\n<p>So the task is, count the lines which starts with the string \"foo\".</p>\n\n<p>My very basic <strong>Python</strong> implementation:</p>\n\n<pre><code>with open(\"foo.txt\", 'r') as f:\n    print len([line for line in f.readlines() if line.startswith('foo')])\n</code></pre>\n\n<p>And the <strong>Haskell</strong> version:</p>\n\n<pre><code>import System.IO \nimport Data.List\n\ncountFoos :: String -&gt; Int\ncountFoos str = length $ filter (isPrefixOf \"foo\") (lines str)\n\nmain = do\n    contents &lt;- readFile \"foo.txt\"\n    putStr (show $ countFoos contents)\n</code></pre>\n\n<p>Running both with <code>time</code> on a ~600MB file with 17001895 lines reveals that the <strong>Python implementation is almost 4 times faster than the Haskell</strong> one (running on my MacBook Pro Retina 2015 with PCIe SSD):</p>\n\n<pre><code>&gt; $ time ./FooCounter                                                           \n1770./FooCounter  20.92s user 0.62s system 98% cpu 21.858 total\n\n&gt; $ time python foo_counter.py                                                   \n1770\npython foo_counter.py  5.19s user 1.01s system 97% cpu 6.332 total\n</code></pre>\n\n<p>Compared to unix command line tools:</p>\n\n<pre><code>&gt; $ time grep -c foo foo.txt                                                     \n1770\ngrep -c foo foo.txt   4.87s user 0.10s system 99% cpu 4.972 total\n\n&gt; $ time fgrep -c foo foo.txt                                                     \n1770\nfgrep -c foo foo.txt  6.21s user 0.10s system 99% cpu 6.319 total\n\n&gt; $ time egrep -c foo foo.txt                                                     \n1770\negrep -c foo foo.txt  6.21s user 0.11s system 99% cpu 6.317 total\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Using Andr\u00e1s Kov\u00e1cs' implementation (<code>ByteString</code>), I got it under half a second!</p>\n\n<pre><code>&gt; $ time ./FooCounter                                                                                                               \n1770\n./EvtReader  0.47s user 0.48s system 97% cpu 0.964 total\n</code></pre>\n"}, {"tags": ["haskell", "generics", "dependent-type"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437030492, "post_id": 31446425, "comment_id": 50863361, "body": "What do you mean by all data type names? From example, if <code>data Foo = A Int | B Bool</code>, then <code>names (A 0) == [&quot;Int&quot;]</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437031266, "post_id": 31446425, "comment_id": 50863787, "body": "That&#39;s how I think it will work. And for any value of the product type <code>data AB = AB Int Bool</code> I imagine I would get back <code>[&quot;Int&quot;, &quot;Bool&quot;]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1437058079, "last_edit_date": 1437058079, "creation_date": 1437041724, "answer_id": 31451416, "question_id": 31446425, "link": "https://stackoverflow.com/questions/31446425/writing-a-type-level-function-for-use-with-ghc-generics/31451416#31451416", "title": "writing a type-level function for use with GHC.Generics", "body": "<p>First tip, if you don't know this already: you can view type <code>Rep</code>-s by <code>:kind!</code> in GHCi. For example:</p>\n\n<pre><code>&gt; :kind! Rep [Int]\nRep [Int] :: * -&gt; *\n= D1\n    GHC.Generics.D1[]\n    (C1 GHC.Generics.C1_0[] U1\n     :+: C1\n           GHC.Generics.C1_1[]\n           (S1 NoSelector (Rec0 Int) :*: S1 NoSelector (Rec0 [Int])))\n</code></pre>\n\n<p>As to the actual question, for the current job <code>datatypeName</code> isn't applicable, instead we can recover the types of fields using <code>typeOf</code> from <code>Data.Typeable</code>.</p>\n\n<pre><code>{-# LANGUAGE MonomorphismRestriction #-}\n\nimport GHC.Generics\nimport Data.Typeable\n\nclass Names f where\n  names' :: f a -&gt; [TypeRep]\n\ninstance Names U1 where\n  names' _ = []\n\ninstance (Names a, Names b) =&gt; Names (a :+: b) where\n  names' (L1 x) = names' x\n  names' (R1 x) = names' x\n\ninstance (Names a, Names b) =&gt; Names (a :*: b) where\n  names' (a :*: b) = names' a ++ names' b\n\ninstance Names f =&gt; Names (M1 i c f) where\n  names' (M1 fa) = names' fa\n\ninstance (Typeable t) =&gt; Names (Rec0 t) where\n  names' (K1 x) = [typeOf x]\n\nnames x = names' (from x)  \n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>&gt; data Foo = Foo Int Bool () deriving (Generic)\n&gt; names $ Foo 0 True ()\n[Int,Bool,()]\n</code></pre>\n\n<p>Note though that this implementation is not recursive, it just looks at the fields of the topmost constructor.</p>\n\n<pre><code>&gt; names [0, 1]\n[Integer, [Integer]]\n</code></pre>\n\n<p>A recursive version would involve more machinery, since some types have representations that easily lead to infinite loops in naive implementations, and thus we'd have to keep track of visited fields. </p>\n"}], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 1, "accepted_answer_id": 31451416, "answer_count": 1, "score": 3, "last_activity_date": 1437058079, "creation_date": 1437026902, "question_id": 31446425, "link": "https://stackoverflow.com/questions/31446425/writing-a-type-level-function-for-use-with-ghc-generics", "title": "writing a type-level function for use with GHC.Generics", "body": "<p>I'm trying to use <code>GHC.Generics</code> to write a generic function which will return all of the data type names used in a value.</p>\n\n<p>Here is what I have so far:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures, DeriveGeneric, TypeOperators, FlexibleContexts #-}\n{-# LANGUAGE MonomorphismRestriction #-}\n\nmodule Lib4 where\n\nimport GHC.Generics\n\nclass Names f where\n  names' :: f a -&gt; [String]\n\ninstance Names U1 where\n  names' _ = []\n\ninstance (Names a, Names b) =&gt; Names (a :+: b) where\n  names' (L1 x) = names' x\n  names' (R1 x) = names' x\n\ninstance (Names a, Names b) =&gt; Names (a :*: b) where\n  names' (a :*: b) = names' a ++ names' b\n\ninstance Names (M1 i c a) where\n  names' (M1 x) = ...  -- use datatypeName here?\n\nnames x = names' (from x)\n</code></pre>\n\n<p>The only part that is missing is in the <code>M1 i c a</code> instance definition.</p>\n\n<p>How do I invoke <code>datatypeName</code> to get at the name of the type?</p>\n\n<p>I'm following Stephan Diehl's \"What I Wish I Knew...\" blog post on Generics [1]</p>\n\n<p>[1] <a href=\"http://dev.stephendiehl.com/hask/#generic\" rel=\"nofollow\">http://dev.stephendiehl.com/hask/#generic</a></p>\n"}, {"tags": ["algorithm", "haskell", "divide-and-conquer"], "answers": [{"comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1437037680, "post_id": 31446754, "comment_id": 50867594, "body": "Oh, I totally missed that <code>minfree</code> works on unordered list, but <code>minfree</code> only works fast on ordered list."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1437032060, "last_edit_date": 1437032060, "creation_date": 1437028195, "answer_id": 31446754, "question_id": 31446342, "link": "https://stackoverflow.com/questions/31446342/the-smallest-free-number-divide-and-conquer-algorithm/31446754#31446754", "title": "The smallest free number - divide and conquer algorithm", "body": "<p>You have pathological input on which <code>head . (\\\\) [0..]</code> performs in O(N) time. <code>\\\\</code> is defined as <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-OldList.html\" rel=\"nofollow\">follows</a>:</p>\n\n<pre><code>(\\\\) =  foldl (flip delete)\n</code></pre>\n\n<p><code>delete x xs</code> is an O(N) operation that removes the first <code>x</code> from <code>xs</code>. <code>foldl (flip delete) xs ys</code> deletes all elements of <code>ys</code> from <code>xs</code> one by one. </p>\n\n<p>In <code>[0..] \\\\ [0..9999999]</code>, we always find the next element to be deleted at the head of the list, so the result can be evaluated in linear time.</p>\n\n<p>If you instead type <code>minfree' (reverse [0..9999999])</code> into GHCi, that takes quadratic time and you find that it pretty much never finishes. </p>\n\n<p>The divide-and-conquer algorithm on the other hand would not slow down on the reversed input.</p>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 1, "accepted_answer_id": 31446754, "answer_count": 1, "score": 3, "last_activity_date": 1437032060, "creation_date": 1437026493, "last_edit_date": 1437027175, "question_id": 31446342, "link": "https://stackoverflow.com/questions/31446342/the-smallest-free-number-divide-and-conquer-algorithm", "title": "The smallest free number - divide and conquer algorithm", "body": "<p>I'm reading a book <em>Pearls of Functional Algorithm Design</em>. Tried implementing the divide and conquer solution for <em>smallest free number</em> problem. </p>\n\n<pre><code>minfree xs = minfrom 0 (length xs) xs\n\nminfrom a 0 _  = a\nminfrom a n xs = if m == b - a\n                    then minfrom b (n-m) vs\n                    else minfrom a (m)   us\n    where b = a + 1 + (n `div` 2)\n          (us,vs) = partition (&lt;b) xs\n          m = length us\n</code></pre>\n\n<p>But this one works no faster than the solution that one might call \"naive\" solution. Which is</p>\n\n<pre><code>import Data.List ((\\\\))\nminfree' = head . (\\\\) [0..]\n</code></pre>\n\n<p>I don't know why this is like this, what's wrong with the divide and conquer algorithm and how to improve it.</p>\n\n<p>Tried using <code>BangPatterns</code>, implementing the version of <code>partition</code> that also returns first list's length in the tuple, so it eliminates additional traversal for <code>m =length us</code>. None of them made improvement.</p>\n\n<p>First one takes more than 5 seconds, whereas second one does it almost instantly in <em>ghci</em> on input <code>[0..9999999]</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1437048263, "post_id": 31445568, "comment_id": 50874378, "body": "This is a pretty frequent unsolved issue with Haskell package management, and I&#39;m sure everyone would love a better way of doing it."}], "answers": [{"tags": [], "owner": {"reputation": 106969, "user_id": 189179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab16b3716e0e72b8b1a7741d68f5ee2?s=128&d=identicon&r=PG", "display_name": "Ben James", "link": "https://stackoverflow.com/users/189179/ben-james"}, "is_accepted": false, "score": 1, "last_activity_date": 1437027375, "last_edit_date": 1437027375, "creation_date": 1437026550, "answer_id": 31446352, "question_id": 31445568, "link": "https://stackoverflow.com/questions/31445568/package-instance-dependencies/31446352#31446352", "title": "Package instance dependencies", "body": "<p>An instance must depend on the <code>Car</code> type and the <code>Printable</code> class, unless it is possible to derive <code>Printable</code> from other classes of which <code>Car</code> is an instance. (A very simple but useless example would be if <code>Printable</code> were defined as <code>class Show a =&gt; Printable a</code>, and there is an instance <code>Show Car</code>.)</p>\n\n<p>You could define an instance <code>Print Car</code> in a third package, but this would be an <a href=\"https://wiki.haskell.org/Orphan_instance\" rel=\"nofollow\">orphan instance</a>.</p>\n\n<p>A workaround for orphanness, as described in the page I linked, is to create a <code>newtype</code>, for example:</p>\n\n<pre><code>newtype PrintableCar = PrintableCar Car\n\ninstance Print PrintableCar where\n    print (PrintableCar car) = ...\n</code></pre>\n\n<p>Now, to print a car you must wrap it in the <code>PrintableCar</code> constructor.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437027375, "creation_date": 1437022219, "question_id": 31445568, "link": "https://stackoverflow.com/questions/31445568/package-instance-dependencies", "title": "Package instance dependencies", "body": "<p>I'm developing two packages, one has a class, the other a data type. This packages can be used independently, but when used together, it makes sense for the data type to be an instance of the class.</p>\n\n<p>Is there a way to define this relationship without making one of the packages depend on another?</p>\n\n<p>Here's a simple example, lets say I've got a <code>Car</code> package and a <code>Print</code> package. There's a way to \"print\" cars, but if I've got no interest into printing, I should be able to use the <code>Car</code> package by itself. Likewise, if I've got no interest in <code>Car</code>s, I should be able to use the print package by itself.</p>\n\n<p>Is the only solution to create a third package, <code>PrintCars</code>, that depends on the previous two?</p>\n\n<p>(The reason why I'm asking this is that I'm defining a new class which I want to include lots of sensible instances for existing types (as well as one of my own), but I don't want to depend on a whole bunch of large packages nor make a separate package for each combination).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 753, "user_id": 4803555, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/987de0ad150cc5d480bde50a580373a4?s=128&d=identicon&r=PG&f=1", "display_name": "Buckeye14Guy", "link": "https://stackoverflow.com/users/4803555/buckeye14guy"}, "edited": false, "score": 0, "creation_date": 1437050506, "post_id": 31450955, "comment_id": 50875958, "body": "This makes great sense. Thanks for the examples; going over it with the picture makes absolute sense. Now I understand the use of the EndNode constructor. I guess I should now try to find a way to solve the problem using that way. <i>or go as far as possible</i>"}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 2, "last_activity_date": 1437040437, "creation_date": 1437040437, "answer_id": 31450955, "question_id": 31444185, "link": "https://stackoverflow.com/questions/31444185/how-do-you-create-and-use-datatypes-in-haskell/31450955#31450955", "title": "How do you create and use datatypes in Haskell?", "body": "<p>Yes, these are mutually recursive data types.</p>\n\n<p>To create values of these types you are likely to use recursion too.  For example, here's a minimal road system - two nodes where each one lets you drive to the other:</p>\n\n<pre><code>nodeA, nodeB :: Node\nnodeA = EndNode (Road 99 nodeB)\nnodeB = EndNode (Road 99 nodeA)\n</code></pre>\n\n<p>Note how the definition of nodeA refers to nodeB and vice versa.</p>\n\n<p>If I read the example in the book correctly it can be written like this:</p>\n\n<pre><code>aRoad, bRoad :: Road\naRoad = Road 50 a1\nbRoad = Road 10 b1\n\na1, a2, a3, a4 :: Node\na1 = Node (Road 5 a2) (Road 30 b1)\na2 = Node (Road 40 a3) (Road 20 b2)\na3 = Node (Road 10 a4) (Road 25 b3)\na4 = EndNode (Road 0 b4)\n\nb1, b2, b3, b4 :: Node\nb1 = Node (Road 90 b2) (Road 30 a1)\nb2 = Node (Road 2 b3) (Road 20 a2)\nb3 = Node (Road 8 b4) (Road 25 a3)\nb4 = EndNode (Road 0 a4)\n</code></pre>\n\n<p>Note again the mutual recursion of a1 and b1, a2 and b2 etc. for the crossing roads.</p>\n\n<p>I've written the roads inline but of course you could name them all if you wanted:</p>\n\n<pre><code>roadA1ToB1 :: Road\nroadA1ToB1 = Road 30 b1\n</code></pre>\n\n<p>If you did it this way the cycle of definitions would involve four of them - the definition of (the node) <code>a1</code> would use <code>roadA1ToB1</code>, which would use <code>b1</code>, which would use <code>roadB1ToA1</code>, which would use <code>a1</code>.</p>\n"}], "owner": {"reputation": 753, "user_id": 4803555, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/987de0ad150cc5d480bde50a580373a4?s=128&d=identicon&r=PG&f=1", "display_name": "Buckeye14Guy", "link": "https://stackoverflow.com/users/4803555/buckeye14guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 31450955, "answer_count": 1, "score": 1, "last_activity_date": 1437040437, "creation_date": 1437012019, "last_edit_date": 1437019211, "question_id": 31444185, "link": "https://stackoverflow.com/questions/31444185/how-do-you-create-and-use-datatypes-in-haskell", "title": "How do you create and use datatypes in Haskell?", "body": "<p>I am an <strong>Absolute Newbie</strong> to Haskell. But I really like it. I have been reading <em>Learn You A Haskell</em> and <em>Real World Haskell</em> and practicing along. I am on the Functionally Solving Problems section in the <em>Learn You A Haskell</em> book and I need someone to explain the following to me:</p>\n\n<pre><code>     data Node = Node Road Road | EndNode Road  \n     data Road = Road Int Node \n</code></pre>\n\n<p>Questions:</p>\n\n<ul>\n<li>Is this some recursive data type creation?</li>\n<li>Why Can't I do: <strong>Node \"A\" \"B\"</strong> and get a valid Node type? When I try something I can an error saying that Haskell can't match [Char] with Expected Road and I understand that. But I can't create a <strong>Node X Y</strong> without a <strong>Road Int Node</strong>. I thought Road was a type synonym for String but since it isn't declared it certainly is not. If anyone read the book and understood this thing PLEASE EXPLAIN WHAT THOSE DATA TYPES MEAN AND PROVIDE EXAMPLE IF POSSIBLE.</li>\n</ul>\n\n<p>Edit: <a href=\"http://learnyouahaskell.com/functionally-solving-problems\" rel=\"nofollow\">The Chapter In Question >> Heathrow to London problem</a></p>\n"}]