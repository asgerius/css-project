[{"tags": ["shell", "haskell", "directory", "optparse-applicative"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 3, "creation_date": 1516838497, "post_id": 48433552, "comment_id": 83858633, "body": "Not a shell limitation <i>or</i> a Haskell limitation -- you couldn&#39;t write a program in C that changed the directory of a separate C program that launched it, either, without the parent process&#39;s active participation, or using debugger interfaces or the like."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1516838620, "post_id": 48433552, "comment_id": 83858670, "body": "@CharlesDuffy I see, thanks. It seems that instead of changing directories I&#39;ll have to print out the path so the user can copy and <code>cd</code> to it. Out of curiosity, how does the <code>cd</code> program command work to change directories?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1516838645, "post_id": 48433552, "comment_id": 83858676, "body": "<code>cd</code> is not a separate program, it&#39;s a shell builtin. <code>&#47;usr&#47;bin&#47;cd</code> may exist on your OS, but doesn&#39;t actually <i>work</i> to change directories in the shell that invokes it."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1516838701, "post_id": 48433552, "comment_id": 83858703, "body": "<code>cd</code> a shell builtin, alright."}], "answers": [{"tags": [], "owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "is_accepted": true, "score": 4, "last_activity_date": 1516895502, "last_edit_date": 1516895502, "creation_date": 1516838750, "answer_id": 48433663, "question_id": 48433552, "link": "https://stackoverflow.com/questions/48433552/how-to-change-the-parent-working-directory-from-which-my-executable-is-run/48433663#48433663", "title": "How to change the parent working directory from which my executable is run?", "body": "<p>In general, you can't do this. No program can change its parent process's directory, no matter what language it's written in, using standard UNIX interfaces. A program can only change its own directory (and, by extension, the initial working directory of any programs it subsequently starts).</p>\n\n<p>However, <em>with the shell's active participation</em>, you can make something very similar. Consider instructing your users to run a shell function such as the following:</p>\n\n<pre><code># this wrapper works on any POSIX shell, but will avoid setting a global variable \"dir\" if\n# the active shell (like bash, ksh, or even dash) supports local variables.\nchdirWithMyHaskellProgram() {\n    local dir 2&gt;/dev/null || \\\n      declare dir 2&gt;/dev/null || \\\n      : \"current shell does not support local variables; proceeding anyhow\"\n    dir=\"$(myHaskellProgram \"$@\")\" &amp;&amp; cd -- \"$dir\"\n}\n</code></pre>\n\n<p>...will cause <code>chdirWithMyHaskellProgram --foo-bar</code> to call <code>myHaskelProgram --foo-bar</code>, and change to the directory named in the output of same, if and only if the exit status indicates success.</p>\n\n<hr>\n\n<p>Consider having <code>myHaskelProgram --eval</code> emit the source code to the above function. If you implemented this, then your user would need to put <code>eval \"$(myHaskelProgram --eval)\"</code> in their dotfiles, but would thereafter have the desired functionality.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 48433663, "answer_count": 1, "score": 0, "last_activity_date": 1551524866, "creation_date": 1516837824, "last_edit_date": 1551524866, "question_id": 48433552, "link": "https://stackoverflow.com/questions/48433552/how-to-change-the-parent-working-directory-from-which-my-executable-is-run", "title": "How to change the parent working directory from which my executable is run?", "body": "<p>My project is a command-line application in Haskell and uses the <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\">opt-parse</a> applicative package to handle parsing of command line options.</p>\n\n<p>I am trying to implement a functionality which can change the working directory of the shell from which the command was run.</p>\n\n<p>For example, I want to do something like</p>\n\n<pre><code>$ program foo\n</code></pre>\n\n<p>and have the shell change to a specified directory my program has associated with the passed option <code>foo</code>.</p>\n\n<pre><code>$ program foo\ninput 'foo'; now changing to directory '~/mydirectories/foodirectory'\n[~/mydirectories/foodirectory]$\n</code></pre>\n\n<p>I attempted to implement this functionality using the <a href=\"https://hackage.haskell.org/package/directory-1.3.1.5/docs/System-Directory.html#g:2\" rel=\"nofollow noreferrer\"><code>setCurrentDirectory</code></a> function from the <code>directory</code> package, however this does not appear to affect the working directory in the shell from which the directory is run; no change in the working directory appears. I am imagining that it is setting some kind of internal-to-the-program working directory, as I see no change in the shell from which the executable was run.</p>\n\n<p>Is it possible to have my program change directories in this manner? Such directory-switching functionality would improve the convenience of using my application.</p>\n\n<p><strong>How can I implement directory-switching functionality from a command-line executable?</strong></p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516830333, "post_id": 48432127, "comment_id": 83855406, "body": "Any attempt yourself?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516830690, "post_id": 48432127, "comment_id": 83855596, "body": "there are not really loops in Haskell, it is all with recursion."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1516830919, "post_id": 48432254, "comment_id": 83855710, "body": "And without recursion <code>concat (iterate (map (+1)) [1,2,3])</code>"}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 2, "last_activity_date": 1516830980, "last_edit_date": 1516830980, "creation_date": 1516830752, "answer_id": 48432254, "question_id": 48432127, "link": "https://stackoverflow.com/questions/48432127/haskell-repeat-a-given-finite-list-indefinitely/48432254#48432254", "title": "Haskell : repeat a given finite list indefinitely", "body": "<p>Quick example in GHCi: </p>\n\n<pre><code>&gt; let f x = x ++ (f $ map (+1) x)\n&gt; take 10 $ f [3,4,5]\n[3,4,5,4,5,6,5,6,7,6]\n</code></pre>\n\n<p>Here, we define a recursive function <code>f</code>, that simply appends to the initial list the output of the recursive call with each number incremented by one. We can break it out to examine the function more closely. </p>\n\n<p>GHCi will give you information on what type <code>f</code> is using </p>\n\n<pre><code>&gt; :t f\nf :: Num b =&gt; [b] -&gt; [b]\n</code></pre>\n\n<p>This means it will work on any list of things with a <code>Num</code> instance (like <code>Int</code>). </p>\n\n<p>So what does <code>f</code> do?</p>\n\n<pre><code>&gt; let f x = x ++ (f $ map (+1) x)\n            ^ -- Start with the initial list we pass in \n                      ^ -- Modify each element of that list and increment their values by 1. \n                      ^ -- This is where the `Num` constraint comes in\n                  ^ -- Recursively call f with the new \"initial list\"\n               ^ -- Append the result of calling f recursively to the initial list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1516833068, "last_edit_date": 1516833068, "creation_date": 1516831376, "answer_id": 48432421, "question_id": 48432127, "link": "https://stackoverflow.com/questions/48432127/haskell-repeat-a-given-finite-list-indefinitely/48432421#48432421", "title": "Haskell : repeat a given finite list indefinitely", "body": "<p>The components you need for this are:</p>\n\n<ul>\n<li><code>map (+ 1) :: Num n =&gt; [n] -&gt; [n]</code> to add 1 to each element of the list</li>\n<li><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]</code> to create an infinite list where each element is a function over the previous element</li>\n<li><code>concat :: [[a]] -&gt; [a]</code> to flatten a list of lists</li>\n<li><code>take 9 :: [a] -&gt; [a]</code> which we will use to get the first 9 elements, for the sake of testing, to avoid trying to print an infinite list</li>\n</ul>\n\n\n\n<pre><code>\u03bb&gt; [3,4,5] &amp; iterate (map (+ 1)) &amp; concat &amp; take 9\n[3,4,5,4,5,6,5,6,7]\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1516833068, "creation_date": 1516830303, "last_edit_date": 1516832390, "question_id": 48432127, "link": "https://stackoverflow.com/questions/48432127/haskell-repeat-a-given-finite-list-indefinitely", "title": "Haskell : repeat a given finite list indefinitely", "body": "<p>I am a new one in Haskell and i am trying to define a function that it takes a finite list and create an infinite list adding in each repetition 1 to each element of the list. for example if i have the list [3,4,5] the function will generate the list [3,4,5,4,5,6,5,6,7....]</p>\n\n<p>I'm thinking something like the loop, which will be infinite and it will add each loop one to each element and then add it in the list. But the problem is that I dont know exactly how to write it in Haskell!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516825102, "post_id": 48430911, "comment_id": 83852749, "body": "So you want <code>[f1, p1, f2, p2, ...]</code>? Any attempt from your side?"}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 97, "user_id": 2020493, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6deecfc7faff693bcb387f3b0417a42f?s=128&d=identicon&r=PG", "display_name": "user2020493", "link": "https://stackoverflow.com/users/2020493/user2020493"}, "edited": false, "score": 0, "creation_date": 1516828523, "post_id": 48431484, "comment_id": 83854490, "body": "@user2020493 That&#39;s exactly what my code is doing except it uses zero-based indexing for the positions :-)"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 1, "last_activity_date": 1516829770, "last_edit_date": 1516829770, "creation_date": 1516827545, "answer_id": 48431484, "question_id": 48430911, "link": "https://stackoverflow.com/questions/48430911/how-do-i-merge-the-results-of-two-functions-into-a-list-in-haskell/48431484#48431484", "title": "How do I merge the results of two functions into a list in Haskell?", "body": "<p>I think you're basically looking for <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\">indexing</a> the fibonaccis at every prime:</p>\n\n<pre><code>result = [fibs !! p | p &lt;- primes]\n</code></pre>\n\n<p>However, that's not really efficient, repeatedly scanning through the <code>fibs</code>. Better do it by repeatedly dropping a bit - the distance between every two primes - from the list, and taking the heads of each of the so-produced lists:</p>\n\n<pre><code>result = map head $ tail $ scanl (flip drop) fibs $ zipWith (-) primes (0:primes)\n</code></pre>\n\n<p>To use one-based indexing, it's</p>\n\n<pre><code>result = [fibs !! (p-1) | p &lt;- primes]\nresult = map head $ tail $ scanl (flip drop) fibs $ zipWith (-) primes (1:primes)\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 2020493, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6deecfc7faff693bcb387f3b0417a42f?s=128&d=identicon&r=PG", "display_name": "user2020493", "link": "https://stackoverflow.com/users/2020493/user2020493"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1516830973, "creation_date": 1516825054, "last_edit_date": 1516830973, "question_id": 48430911, "link": "https://stackoverflow.com/questions/48430911/how-do-i-merge-the-results-of-two-functions-into-a-list-in-haskell", "title": "How do I merge the results of two functions into a list in Haskell?", "body": "<p>I want to create an infinite list with fibonacci in a good spot. My original thought was just to call and then truncate the list returned by and then stick them together. I don't know how to just take the first element from the list. Would someone be able to point me in the right direction?</p>\n"}, {"tags": ["string", "haskell", "concatenation"], "comments": [{"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517168742, "post_id": 48430231, "comment_id": 83974153, "body": "@nicodp Is there any command out there which could give <code>string1 string1string2 string1string2string3 string1string2string3string4 string2 string2string1string3string4</code>  etc. :) ?"}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516824862, "post_id": 48430650, "comment_id": 83852626, "body": "thank you. and how can i combine several commands? because you wrote &quot;and then you can&quot;, one after another in the &quot;*Main&gt;&quot;?"}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516826761, "post_id": 48430650, "comment_id": 83853617, "body": "The first command gave me that error  <code>&lt;interactive&gt;:1:47: error:     * Couldn&#39;t match type Char&#39; with [Char]&#39;       Expected type: [[[Char]]]         Actual type: [[Char]]     * In the second argument of map&#39;, namely listofstrings&#39;       In the expression: map (\\ ls -&gt; ls ++ [&quot;\\n&quot;]) listofstrings       In an equation for listsWithNewLines&#39;:           listsWithNewLines = map (\\ ls -&gt; ls ++ [&quot;\\n&quot;]) listofstrings</code>"}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516827269, "post_id": 48430650, "comment_id": 83853851, "body": "Edited, instead of <code>listofstrings</code> you should use <code>permutations listofstrings</code>"}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516827856, "post_id": 48430650, "comment_id": 83854170, "body": "Great nicodp! and how can i write the output to a text file on windows ?"}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516830307, "post_id": 48430650, "comment_id": 83855396, "body": "Could go in this direction? <code>import Data.Set import Data.Maybe import Text.Printf import System.IO import System.Environment import Data.List  listofstrings = [&quot;string1&quot;, &quot;string2&quot;, &quot;string3&quot;, &quot;string4&quot;] main = listsWithNewLines &lt;= map (\\ls -&gt; ls ++ [&quot;\\n&quot;]) (permutations listofstrings) mapM_ putStr (concat listsWithNewLines) writeFile :: .&#47;outpu -&gt; mapM_ -&gt; IO ()</code>"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": -2, "last_activity_date": 1516839352, "last_edit_date": 1516839352, "creation_date": 1516823822, "answer_id": 48430650, "question_id": 48430231, "link": "https://stackoverflow.com/questions/48430231/formating-output-of-haskell-permutation/48430650#48430650", "title": "Formating output of Haskell permutation", "body": "<p>What you can do is to use <code>map</code> to get a new list of strings but with new-line characters appended to each line:</p>\n\n<pre><code>listsWithNewLines = map (++ [\"\\n\"]) $ permutations listofstrings\n</code></pre>\n\n<p>and then print them out using <code>mapM_</code>:</p>\n\n<pre><code>mapM_ putStr (concat listsWithNewLines)\n</code></pre>\n\n<p>Why <code>mapM_</code>? Because you want to perform an <code>IO</code> action that returns nothing <code>()</code>, in other words, you want to do some computation inside the <code>IO</code> monad.</p>\n\n<p>Let's review the <code>mapM_</code>'s type: </p>\n\n<pre><code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()\n</code></pre>\n\n<p>Our computation will be <code>putStr</code>, that has the following type:</p>\n\n<pre><code>putStr :: String -&gt; IO ()\n</code></pre>\n\n<p>And as we want a list of strings as the second argument for <code>mapM_</code>, we need to flatten our list of strings with new lines like so: <code>concat listWithNewLines</code></p>\n\n<p>Hence, we end up with the following type:</p>\n\n<pre><code>(String -&gt; IO ()) -&gt; [String] -&gt; IO ()\n</code></pre>\n\n<p>which is the type of <code>mapM_</code>, but with <code>a = String</code>, <code>b = ()</code> and <code>m = IO</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516825227, "post_id": 48430662, "comment_id": 83852814, "body": "Thank you. I tried it <a href=\"https://repl.it/@jonasss/RespectfulDarkorchidIrishwaterspaniel\" rel=\"nofollow noreferrer\">repl.it/@jonasss/RespectfulDarkorchidIrishwaterspaniel</a> but that does not work. Whats my fault here?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516825689, "post_id": 48430662, "comment_id": 83853045, "body": "Your fault is not explaining exactly what doesn&#39;t work and how. I can&#39;t diagnose a problem if I don&#39;t know the symptoms."}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516825937, "post_id": 48430662, "comment_id": 83853177, "body": "In your example you take already the outpupt of the listofstrings= [&quot;string1&quot;, &quot;string2&quot;, &quot;string3&quot;, &quot;string4&quot;] from example of the first post. On that listofstrings i want to perform the permutations  command, and the outpupt generated there is nicely formated by your proposal.  How can i fix it to make the string input generic? Second, how can i write this to a file?"}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1516826358, "post_id": 48430662, "comment_id": 83853414, "body": "I also tried that code <code>import Data.List  listofstrings= [&quot;string1&quot;, &quot;string2&quot;, &quot;string3&quot;, &quot;string4&quot;]</code> in a .hs file, and with ghci i executed <code>*Main&gt; permutations listofstrings; joined = unlines (concat &lt;$&gt; listofstrings); putStr joined</code> but that does not work"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 4, "last_activity_date": 1516836226, "last_edit_date": 1516836226, "creation_date": 1516823862, "answer_id": 48430662, "question_id": 48430231, "link": "https://stackoverflow.com/questions/48430231/formating-output-of-haskell-permutation/48430662#48430662", "title": "Formating output of Haskell permutation", "body": "<p>You can join strings of each sublist with <code>concat</code>, then you can join lines together with <code>unlines</code>:</p>\n\n<pre><code>unlines (concat &lt;$&gt; permutations listofstrings)\n</code></pre>\n\n<p><a href=\"https://repl.it/repls/RespectfulDarkorchidIrishwaterspaniel\" rel=\"nofollow noreferrer\">Here's an example</a></p>\n"}], "owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 48430650, "answer_count": 2, "score": -4, "last_activity_date": 1516839352, "creation_date": 1516822161, "last_edit_date": 1516822755, "question_id": 48430231, "link": "https://stackoverflow.com/questions/48430231/formating-output-of-haskell-permutation", "title": "Formating output of Haskell permutation", "body": "<p>i have this list in my .hs file</p>\n\n<pre><code>listofstrings= [\"string1\", \"string2\", \"string3\", \"string4\"]\n</code></pre>\n\n<p>and i am calling the file in ghci with </p>\n\n<pre><code>load permutations.hs\n</code></pre>\n\n<p>with this command</p>\n\n<pre><code>permutations listofstrings\n</code></pre>\n\n<p>i get </p>\n\n<pre><code>[[\"string1\",\"string2\",\"string3\",\"string4\"],[\"string2\",\"string1\",\"string3\",\"string4\"],[\"string3\",\"string2\",\"string1\",\"string4\"],[\"string2\",\"string3\",\"string1\",\"string4\"],[\"string3\",\"string1\",\"string2\",\"string4\"],[\"string1\",\"string3\",\"string2\",\"string4\"],[\"string4\",\"string3\",\"string2\",\"string1\"],[\"string3\",\"string4\",\"string2\",\"string1\"],[\"string3\",\"string2\",\"string4\",\"string1\"],[\"string4\",\"string2\",\"string3\",\"string1\"],[\"string2\",\"string4\",\"string3\",\"string1\"],[\"string2\",\"string3\",\"string4\",\"string1\"],[\"string4\",\"string1\",\"string2\",\"string3\"],[\"string1\",\"string4\",\"string2\",\"string3\"],[\"string1\",\"string2\",\"string4\",\"string3\"],[\"string4\",\"string2\",\"string1\",\"string3\"],[\"string2\",\"string4\",\"string1\",\"string3\"],[\"string2\",\"string1\",\"string4\",\"string3\"],[\"string4\",\"string1\",\"string3\",\"string2\"],[\"string1\",\"string4\",\"string3\",\"string2\"],[\"string1\",\"string3\",\"string4\",\"string2\"],[\"string4\",\"string3\",\"string1\",\"string2\"],[\"string3\",\"string4\",\"string1\",\"string2\"],[\"string3\",\"string1\",\"string4\",\"string2\"]]\n</code></pre>\n\n<p>how can i get a list for each combination with linebreak and without comma, \" , [], spaces and rest of the signs?</p>\n\n<p>So it should look like this</p>\n\n<pre><code>string1string2string3string4\nstring2string1string3string4\nstring3string2string1string4\nstring2string3string1string4\nstring3string1string2string4\nstring1string3string2string4\nstring4string3string2string1\nstring3string4string2string1\nstring3string2string4string1\nstring4string2string3string1\nstring2string4string3string1\nstring2string3string4string1\nstring4string1string2string3\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 1, "creation_date": 1516809348, "post_id": 48425995, "comment_id": 83843286, "body": "Can you paste the errors you get?"}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "reply_to_user": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 0, "creation_date": 1516809801, "post_id": 48425995, "comment_id": 83843612, "body": "Sure, I&#39;ve just added them"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516810413, "post_id": 48425995, "comment_id": 83844079, "body": "The error messages do not match the code you posted (for example, the errors mention <code>rb1&#39;</code> and <code>rb2&#39;&#39;</code>, but they&#39;re nowhere in your code). Are you sure you have posted your actual code? Perhaps you have omitted some parts?"}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1516810933, "post_id": 48425995, "comment_id": 83844487, "body": "Source code is also included.."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516812151, "post_id": 48425995, "comment_id": 83845318, "body": "I still don&#39;t see any mentions of <code>rb1&#39;</code> or <code>rb2&#39;&#39;</code>"}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1516812228, "post_id": 48425995, "comment_id": 83845364, "body": "I meant if I tried to fight rb1 and rb1 with each other (using the results of the previous fight in the next fight) a couple of times outside the function - everything would be OK,"}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516812621, "post_id": 48425995, "comment_id": 83845650, "body": "@Fyodor Soikin OK. If I comment out those definitions of rb1 and rb2 it still doesn&#39;t compile with an error about the infinite types (the first one)."}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 1, "creation_date": 1516812761, "post_id": 48425995, "comment_id": 83845748, "body": "I guess there&#39;s a problem with your <code>damage</code> function, but I haven&#39;t figured out why (it&#39;s making me mad without types :P). You can try this definition instead: <code>damage aRobot attackDamage = robot (getName aRobot, getAttack aRobot, getHP aRobot - attackDamage)</code> and it should work."}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1516813034, "post_id": 48425995, "comment_id": 83845933, "body": "I&#39;ll try, but I took all the definitions from the book :) And the <code>damage</code> function works good if you try it by itself, Actually the task is (literaly): <i>...Write a threeRoundFight function that takes two robots and has them fight for three rounds, returning the winner. To avoid having so many different variables for robot state, use a series of nested lambda functions so you can just overwrite robotA and robotB.</i>"}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1516862790, "post_id": 48430363, "comment_id": 83865365, "body": "Brilliant! It really helped. Still it doesn&#39;t explain the author&#39;s general idea of using this type of language constructions without any explanation. Initally a used that type synonyms: <code>type RTuple = (String, Int, Int) type Robot a = (RTuple -&gt; a) -&gt; a</code>, but they didn&#39;t help me because I didn&#39;t use this idea of <code>{-# LANGUAGE RankNTypes #-}</code>. Thnak you."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1516871459, "post_id": 48430363, "comment_id": 83869489, "body": "In my opinion, there&#39;s no advantage here. I have no idea about why the book suggests this. It could be a nice exercise for its own sake, since it forces you to use a lot of functions / continuations. But continuation passing style is known to make things much harder, and is only worth it when you need something like <code>callCC</code> or some other &quot;early exit&quot; mechanism. I would not consider suggesting this to a beginner."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1516822665, "creation_date": 1516822665, "answer_id": 48430363, "question_id": 48425995, "link": "https://stackoverflow.com/questions/48425995/functional-object-oriented-programming-in-haskell/48430363#48430363", "title": "Functional object-oriented programming in Haskell", "body": "<p>As far as I can see, your code works fine in an untyped setting (say, Scheme or JavaScript).</p>\n\n<p>In a typed setting it could work, but only if it involves fairly complex types, namely rank-2 types. The type inference engine can not infer those, which must be annotated manually.</p>\n\n<p>To stress the point, let's try to use rank-1 types, only, adding all the annotations. This part compiles fine.</p>\n\n<pre><code>type Robot a = ((String, Int, Int) -&gt; a) -&gt; a\n\nrobot :: (String, Int, Int) -&gt; Robot a\nrobot (name, attack, hp) = \\message -&gt; message (name, attack, hp)\n\nname :: (String, Int, Int) -&gt; String\nname (nm, _, _) = nm\nattack :: (String, Int, Int) -&gt; Int\nattack (_, a, _) = a\nhp :: (String, Int, Int) -&gt; Int\nhp (_, _, p) = p\n\ngetName :: Robot String -&gt; String\ngetName r = r name\ngetAttack :: Robot Int -&gt; Int\ngetAttack r = r attack\ngetHP :: Robot Int -&gt; Int\ngetHP r = r hp\n\nsetName :: Robot (Robot a) -&gt; String -&gt; Robot a\nsetName r nm = r $ \\(_, a, hp) -&gt; robot (nm, a, hp)\nsetAttack :: Robot (Robot a) -&gt; Int -&gt; Robot a\nsetAttack r a = r $ \\(nm, _, hp) -&gt; robot (nm, a, hp)\nsetHP :: Robot (Robot a) -&gt; Int -&gt; Robot a\nsetHP r hp = r $ \\(nm, a, _) -&gt; robot (nm, a, hp)\n\nprintRobot :: Robot String -&gt; String\nprintRobot r = r $ \\(nm, a, hp) -&gt; nm ++ \" attack:\" ++ show a ++ \" hp:\" ++ show hp\n\ndamage :: Robot (Robot a) -&gt; Int -&gt; Robot a\ndamage r ad = r $ \\(nm, a, hp) -&gt; robot (nm, a, hp - ad)\n\nfight :: Robot Int -&gt; Robot (Robot a) -&gt; Robot a\nfight atacker defender = damage defender power where\n  power = if getHP atacker &gt; 10\n          then getAttack atacker\n          else 0\n</code></pre>\n\n<p>Above, a <code>Robot a</code> indicates a robot value which can only be used to compute values of type <code>a</code>. E.g. from a <code>Robot Int</code> you can extract the attack and HP, but not the name.</p>\n\n<p>Looking at the code... a lot of weird types arise! The type of <code>fight</code> is very puzzling:</p>\n\n<pre><code>fight :: Robot Int -&gt; Robot (Robot a) -&gt; Robot a\n</code></pre>\n\n<p>The first robot must produce its attack, so it is a <code>Robot Int</code>, while the second one must fight and produce a <code>Robot a</code>, hence the weird type <code>Robot (Robot a)</code>.</p>\n\n<p>From this, we get that we can't hope to type both <code>fight r1 r2</code> and <code>fight r2 r1</code>: that would require <code>Int = Robot a</code>, which is impossible.</p>\n\n<pre><code>  \u2022 Couldn't match type \u2018Int\u2019 with \u2018((String, Int, Int) -&gt; a) -&gt; a\u2019\n      Expected type: Robot (Robot a)\n        Actual type: Robot Int\n</code></pre>\n\n<p>What could be the solution? Use rank-2 robots:</p>\n\n<pre><code>newtype Robot = Robot (forall a. ((String, Int, Int) -&gt; a) -&gt; a)\n</code></pre>\n\n<p>The <code>forall a</code> here indicates that a rank-2 robot can generate <em>any</em> result we choose, not just a single one. Hence, from a rank-2 robot we can extract both name and HP.</p>\n\n<p>We need to wrap/unwrap everything using the constructor, which can be a bit annoying:</p>\n\n<pre><code>robot :: (String, Int, Int) -&gt; Robot\nrobot (name, attack, hp) = Robot (\\message -&gt; message (name, attack, hp))\ngetName :: Robot -&gt; String\ngetName (Robot r) = r name\n-- etc.\n</code></pre>\n\n<p>Now, <code>fight</code> should work. I'll leave the rest for the OP to try.</p>\n\n<p>Note that theoretical results (Yoneda's lemma) state that the polymorphic type we used, <code>forall a. ((String, Int, Int) -&gt; a) -&gt; a</code> is isomorphic to <code>(String, Int, Int)</code>, so we indeed we have reinvented tuples in a more complicated way.</p>\n\n<p>Concluding: I am a bit surprised that a Haskell book suggested this approach. It seems quite advanced material to me. I wonder what the intended solution was.</p>\n"}], "owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 2, "accepted_answer_id": 48430363, "answer_count": 1, "score": 2, "last_activity_date": 1516822665, "creation_date": 1516807511, "last_edit_date": 1516810735, "question_id": 48425995, "link": "https://stackoverflow.com/questions/48425995/functional-object-oriented-programming-in-haskell", "title": "Functional object-oriented programming in Haskell", "body": "<p>Folowing the book <a href=\"https://livebook.manning.com/#!/book/get-programming-with-haskell\" rel=\"nofollow noreferrer\">\"Get programming with Haskell\"</a> I stumbled over rather confusing excercise. One of the chapters explains how to make simple objects using closures. So, for instance we have a tuple wich desribes a primitive robot:\n<code>(name, attack, hp)</code>. And using this tuple we can construct a robot like this:</p>\n\n<pre><code>robot (name,attack,hp)  = \\message -&gt; message (name,attack,hp)\n</code></pre>\n\n<p>for instance:</p>\n\n<pre><code>killerRobot = robot (\"Kill3r\", 25, 200)\n</code></pre>\n\n<p>And so on, the author explains how to make accessor functions using this structure:</p>\n\n<pre><code>hp (_,_,hp) = hp\nattack (_,a,_) = a\n\ngetHP aRobot = aRobot hp\ngetAttack aRobot = aRobot attack\n</code></pre>\n\n<p>so we can examine how many hit point the certain robot has:</p>\n\n<pre><code>getHP killerRobot\n</code></pre>\n\n<p>So far so good and I'm not going to rewrite the entire chapter, but I can't catch one further thing. Next we have a function:</p>\n\n<pre><code>damage aRobot attackDamage = aRobot (\\(n,a,h) -&gt;\n                                      robot (n,a,h-attackDamage))\n</code></pre>\n\n<p>and another function </p>\n\n<pre><code>fight aRobot defender = damage defender attack\n  where attack = if getHP aRobot &gt; 10\n                 then getAttack aRobot\n                 else 0\n</code></pre>\n\n<p>which emulates a combat between two robots.\nSo we can write something like that:</p>\n\n<pre><code>gentleGiant = robot (\"Mr. Friendly\", 10, 300)\ngentleGiantRound1 = fight killerRobot gentleGiant\nkillerRobotRound1 = fight gentleGiant killerRobot\ngentleGiantRound2 = fight killerRobotRound1 gentleGiantRound1\nkillerRobotRound2 = fight gentleGiantRound1 killerRobotRound1\ngentleGiantRound3 = fight killerRobotRound2 gentleGiantRound2\nkillerRobotRound3 = fight gentleGiantRound2 killerRobotRound2\n</code></pre>\n\n<p>and it works just fine. But when I try to put this into a function, which incapsulates these steps and returns the result of the last step (actually the task is slightly different) I get a whole bunch of errors related to type system I guess. I'll show a simplified version which throws errors:</p>\n\n<pre><code>roundFights rb1 rb2 = \n let rb2' = fight rb1 rb2\n in fight rb2' rb1\n</code></pre>\n\n<p>The second fight makes compiler explode with errors. All those functions don't have type signatures intentionally - the same thing inside the book - because it's just one of the introductory chapters and type signatures have not yet explained.</p>\n\n<p>Can someone suggest what's wrong?</p>\n\n<p>Here is the source code:</p>\n\n<pre><code>robot (name, attack, hp) = \\message -&gt; message (name, attack, hp)\n\nname (nm, _, _) = nm\nattack (_, a, _) = a\nhp (_, _, p) = p\n\ngetName r = r name\ngetAttack r = r attack\ngetHP r = r hp\n\nsetName r nm = r $ \\(_, a, hp) -&gt; robot (nm, a, hp)\nsetAttack r a = r $ \\(nm, _, hp) -&gt; robot (nm, a, hp)\nsetHP r hp = r $ \\(nm, a, _) -&gt; robot (nm, a, hp)\n\nprintRobot r = r $ \\(nm, a, hp) -&gt; nm ++ \" attack:\" ++ show a ++ \" hp:\" ++ show hp\n\ndamage r ad = r $ \\(nm, a, hp) -&gt; robot (nm, a, hp - ad)\nfight atacker defender = damage defender power where\n  power = if getHP atacker &gt; 10\n          then getAttack atacker\n          else 0\n\nlives = map getHP\n\nroundFights rb1 rb2 = \n   let rb2' = fight rb1 rb2\n   in fight rb2' rb1\n\n\nrb1 = robot(\"Killer\", 25, 200)\nrb2 = robot(\"Slayer\", 15, 200)\n</code></pre>\n\n<p>and the erorrs sheet I get: </p>\n\n<pre><code>D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:27:18:\n    Occurs check: cannot construct the infinite type:\n      t8 ~ ((t7, t8, t8) -&gt; t0) -&gt; t0\n    Expected type: ((t7, t8, t8) -&gt; ((t7, t8, t8) -&gt; t0) -&gt; t0) -&gt; t6\n      Actual type: ((t7, t8, t8) -&gt; t8) -&gt; t6\n    Relevant bindings include\n      rb2' :: ((t4, t5, t5) -&gt; t5) -&gt; t8\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:26:8)\n      rb2 :: ((t2, t3, t6) -&gt; ((t2, t3, t6) -&gt; t) -&gt; t)\n             -&gt; ((t4, t5, t5) -&gt; t5) -&gt; t8\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:25:17)\n      rb1 :: ((t7, t8, t8) -&gt; t8) -&gt; t6\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:25:13)\n      roundFights :: (((t7, t8, t8) -&gt; t8) -&gt; t6)\n                     -&gt; (((t2, t3, t6) -&gt; ((t2, t3, t6) -&gt; t) -&gt; t)\n                         -&gt; ((t4, t5, t5) -&gt; t5) -&gt; t8)\n                     -&gt; t6\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:25:1)\n    In the second argument of `fight', namely `rb1'\n    In the expression: fight rb2' rb1\n\nD:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:30:27:\n    No instance for (Num t1) arising from the literal `200'\n    The type variable `t1' is ambiguous\n    Relevant bindings include\n      rb1 :: (([Char], t1, t1) -&gt; t) -&gt; t\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:30:1)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus three others\n    In the expression: 200\n    In the first argument of `robot', namely `(\"Killer\", 25, 200)'\n    In the expression: robot (\"Killer\", 25, 200)\n\nD:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:31:27:\n    No instance for (Num t1) arising from the literal `200'\n    The type variable `t1' is ambiguous\n    Relevant bindings include\n      rb2 :: (([Char], t1, t1) -&gt; t) -&gt; t\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:31:1)\n    Note: there are several potential instances:\n      instance Num Double -- Defined in `GHC.Float'\n      instance Num Float -- Defined in `GHC.Float'\n      instance Integral a =&gt; Num (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      ...plus three others\n    In the expression: 200\n    In the first argument of `robot', namely `(\"Slayer\", 15, 200)'\n    In the expression: robot (\"Slayer\", 15, 200)\n\nD:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:33:8:\n    No instance for (Ord t1) arising from a use of `fight'\n    The type variable `t1' is ambiguous\n    Relevant bindings include\n      rb2' :: (([Char], t1, t1) -&gt; t) -&gt; t\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:33:1)\n    Note: there are several potential instances:\n      instance Integral a =&gt; Ord (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      instance Ord () -- Defined in `GHC.Classes'\n      instance (Ord a, Ord b) =&gt; Ord (a, b) -- Defined in `GHC.Classes'\n      ...plus 24 others\n    In the expression: fight rb1 rb2\n    In an equation for rb2': rb2' = fight rb1 rb2\n\nD:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:34:8:\n    No instance for (Ord t1) arising from a use of `fight'\n    The type variable `t1' is ambiguous\n    Relevant bindings include\n      rb1' :: (([Char], t1, t1) -&gt; t) -&gt; t\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:34:1)\n    Note: there are several potential instances:\n      instance Integral a =&gt; Ord (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      instance Ord () -- Defined in `GHC.Classes'\n      instance (Ord a, Ord b) =&gt; Ord (a, b) -- Defined in `GHC.Classes'\n      ...plus 24 others\n    In the expression: fight rb2' rb1\n    In an equation for rb1': rb1' = fight rb2' rb1\n\nD:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:35:9:\n    No instance for (Ord t1) arising from a use of `fight'\n    The type variable `t1' is ambiguous\n    Relevant bindings include\n      rb2'' :: (([Char], t1, t1) -&gt; t) -&gt; t\n        (bound at D:\\Dropbox\\Documents\\Work\\HS\\GetProg\\Unit 10\\Robot.hs:35:1)\n    Note: there are several potential instances:\n      instance Integral a =&gt; Ord (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      instance Ord () -- Defined in `GHC.Classes'\n      instance (Ord a, Ord b) =&gt; Ord (a, b) -- Defined in `GHC.Classes'\n      ...plus 24 others\n    In the expression: fight rb1' rb2'\n    In an equation for rb2'': rb2'' = fight rb1' rb2' Failed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1516796967, "post_id": 48422051, "comment_id": 83834411, "body": "And what&#39;s not so purely functional about IORef?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 11, "last_activity_date": 1516797573, "last_edit_date": 1516797573, "creation_date": 1516797033, "answer_id": 48422542, "question_id": 48422051, "link": "https://stackoverflow.com/questions/48422051/can-this-be-coded-without-using-a-mutable-variable/48422542#48422542", "title": "Can this be coded without using a mutable variable?", "body": "<p>There's no need to do this in <code>IO</code>, you might as well use a pure state monad:</p>\n\n<pre><code>import Control.Monad.Trans.State\nimport System.Random (randomRIO)\n\nmaxtries = 5\n\nplayerA :: IO (Int -&gt; State Int (Maybe Ordering))\nplayerA = do\n   secret &lt;- randomRIO (1,100)\n   return $ \\guess -&gt; state $ \\tries\n          -&gt; if tries &lt; maxtries then (Just $ guess`compare`secret, tries+1)\n                                 else (Nothing, tries)\n\nplayerB :: Monad m =&gt; (Int -&gt; m (Maybe Ordering)) -&gt; Int -&gt; Int -&gt; m (Maybe Int)\nplayerB guessfunc lowbound highbound = do\n    let guess = (lowbound + highbound)`div`2\n    response &lt;- guessfunc guess\n    case response of\n        Just GT -&gt; playerB guessfunc lowbound (guess - 1)\n        Just LT -&gt; playerB guessfunc (guess + 1) highbound\n        Just EQ -&gt; return $ Just guess\n        Nothing -&gt; return Nothing\n\nmain = do\n   pa &lt;- playerA\n   print . (`evalState`0) $ playerB pa 1 100\n</code></pre>\n\n<p>Notice that <code>playerB</code> doesn't know the monad is <code>State Int</code>. That's important so she can't cheat by manipulating the state variable between calls to <code>guessfunc</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1516818661, "post_id": 48422661, "comment_id": 83849249, "body": "Usually &quot;brute force&quot; means &quot;try every possible input&quot;. But you can do much better here than that; e.g. binary search will recover <code>42</code> with only a couple dozen queries, far under the 2^(couple dozen) that brute force would need."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516818984, "post_id": 48422661, "comment_id": 83849415, "body": "Sure, since we get more than a single bit for every attempt, rather the whole ordering."}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 0, "last_activity_date": 1516797372, "creation_date": 1516797372, "answer_id": 48422661, "question_id": 48422051, "link": "https://stackoverflow.com/questions/48422051/can-this-be-coded-without-using-a-mutable-variable/48422661#48422661", "title": "Can this be coded without using a mutable variable?", "body": "<p>Note that you're using IO for random generation and to keep track of attempts left. The number itself can be hidden inside a purest monadless function:</p>\n\n<pre><code>playerA :: Int -&gt; Int -&gt; Ordering\nplayerA = compare\n</code></pre>\n\n<p>This way, <code>playerA 42</code> is an opaque (in terms of structure, not purity) object that returns Ordering when fed with a number, but you can never retrieve that 42 of it by any means described in the Report, without bruteforcing.</p>\n"}], "owner": {"reputation": 161, "user_id": 9261858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df1d12f9e960a7d9227643a8570fbdd?s=128&d=identicon&r=PG&f=1", "display_name": "Retired Writing Code for Fun", "link": "https://stackoverflow.com/users/9261858/retired-writing-code-for-fun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1516797573, "creation_date": 1516795414, "question_id": 48422051, "link": "https://stackoverflow.com/questions/48422051/can-this-be-coded-without-using-a-mutable-variable", "title": "Can this be coded without using a mutable variable?", "body": "<p>Consider the following (very dull) game:\n    - Player A thinks of a number between 1 and 100.\n    - Player B is allowed 5 attempts to guess the number. Player A will respond to each guess as \"too big\", \"too small\" or \"correct\".</p>\n\n<p>I wanted to simulate this in Haskell, which is trivial, of course. To make things interesting, though, I wanted to write the code in such a way that Player B can't \"cheat\". That means two things:\n    - The Player B code isn't allowed to see the correct value of the secret number. The Player A code gives the Player B code a function with which to check its guesses.\n    - The Player B code isn't allowed to call that function more than five times. Somehow, the Player A code has to keep count of how many times the function is called.</p>\n\n<p>This is very easy to achieve in an OO language with private mutable variables.</p>\n\n<p>In Haskell, I coded it using an IORef to keep count of the number of calls. That's fine, I think my solution is correct. But my question is:</p>\n\n<p>\"Can this be done in Haskell without IORef or similar? Is there a purely functional solution that I've missed?\"</p>\n\n<p>Here is my Haskell code:</p>\n\n<pre><code>import Data.IORef (newIORef, readIORef, writeIORef)\nimport System.Random (randomRIO)\n\nlowest = 1\nhighest = 100\nmaxtries = 5\n\nplayerA :: IO (Int -&gt; IO (Maybe Ordering))\nplayerA = do\n    secret &lt;- randomRIO (lowest, highest)\n    print (\"Secret\", secret)\n    tries &lt;- newIORef maxtries\n    return $ \\ guess -&gt; do\n        t &lt;- readIORef tries\n        if t == 0 then\n            return Nothing\n        else do\n            writeIORef tries $ t - 1\n            return $ Just $ guess `compare` secret\n\nplayerB :: (Int -&gt; IO (Maybe Ordering)) -&gt; Int -&gt; Int -&gt; IO ()\nplayerB guessfunc lowbound highbound = do\n    let guess = (lowbound + highbound) `div` 2\n    response &lt;- guessfunc guess\n    print (lowbound, highbound, guess, response)\n    case response of\n        Just GT -&gt; playerB guessfunc lowbound (guess - 1)\n        Just LT -&gt; playerB guessfunc (guess + 1) highbound\n        Just EQ -&gt; putStrLn \"Player B wins\"\n        Nothing -&gt; putStrLn \"Player B loses\"\n\nmain :: IO ()\nmain = do\n    guessfunc &lt;- playerA\n    playerB guessfunc lowest highest\n</code></pre>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1516791699, "post_id": 48419533, "comment_id": 83831150, "body": "can you show us the definition of your data types and the context where you want to use this?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516792318, "post_id": 48419533, "comment_id": 83831563, "body": "What persistent backend are you using? The definition of what a <code>Key</code> is depends on what kind of database we&#39;re talking about."}, {"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1516794605, "post_id": 48419533, "comment_id": 83832974, "body": "@epsilonhalbe It&#39;s all auto generated by Yesod."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1516794675, "post_id": 48419533, "comment_id": 83833017, "body": "Then show the corresponding lines in your config and where you use it"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1516793356, "creation_date": 1516793356, "answer_id": 48421421, "question_id": 48419533, "link": "https://stackoverflow.com/questions/48419533/get-id-from-entity-record/48421421#48421421", "title": "Get id from Entity record", "body": "<p>You have to use a combination of <code>fromSqlKey</code> and <code>entityKey</code>. A sample program demonstrating it:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-9.0\n     --install-ghc\n     runghc\n     --package persistent\n     --package persistent-sqlite\n     --package persistent-template\n     --package mtl\n-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\nimport           Control.Monad.IO.Class  (liftIO, MonadIO)\nimport Control.Monad.Reader\nimport           Database.Persist\nimport           Database.Persist.Sqlite\nimport           Database.Persist.TH\nimport Data.Int\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    deriving Show\n|]\n\ninsertPerson :: MonadIO m =&gt; ReaderT SqlBackend m (Key Person)\ninsertPerson =  insert $ Person \"Michael\" $ Just 26\n\nmain :: IO ()\nmain = runSqlite \":memory:\" $ do\n    runMigration migrateAll\n    michaelId &lt;- insertPerson\n    (michael :: Entity Person) &lt;- getJustEntity michaelId\n    liftIO $ print $ (fromSqlKey . entityKey $ michael :: Int64)\n</code></pre>\n\n<p>And it's output:</p>\n\n<pre><code>~/g/scripts $ stack persist.hs\nMigrating: CREATE TABLE \"person\"(\"id\" INTEGER PRIMARY KEY,\"name\" VARCHAR NOT NULL,\"age\" INTEGER NULL)\n1\n</code></pre>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 48421421, "answer_count": 1, "score": 1, "last_activity_date": 1516793356, "creation_date": 1516787949, "question_id": 48419533, "link": "https://stackoverflow.com/questions/48419533/get-id-from-entity-record", "title": "Get id from Entity record", "body": "<p>I have an <code>Entity record</code>, specifically <code>Entity User</code> and I need to extract the Id which the User has in the database as an <code>Int</code>.</p>\n\n<p>From reading the <a href=\"https://www.stackage.org/haddock/lts-10.3/persistent-2.7.1/Database-Persist-Types.html#t:Entity\" rel=\"nofollow noreferrer\">docs</a> it seems <code>entityKey</code> would be useful here but I'm not quite sure how I would go about getting an <code>Int</code> out.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516780888, "post_id": 48417359, "comment_id": 83824524, "body": "What does the error say?"}, {"owner": {"reputation": 151, "user_id": 4948872, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/741307b81adf8818465d1a6f8b0ea5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Spam", "link": "https://stackoverflow.com/users/4948872/spam"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516781310, "post_id": 48417359, "comment_id": 83824698, "body": "1)  * No instance for (Show (Maybe b0 -&gt; Maybe (a0, b0)))         arising from a use of <code>show&#39;         (maybe you haven&#39;t applied a function to enough arguments?)     * In the expression: show (unpack (Just 5))       In an equation for </code>it&#39;: it = show (unpack (Just 5)) 2.1)* Couldn&#39;t match expected type <code>[Maybe a]&#39;                   with actual type </code>Maybe [t0]&#39;  2.2)for (Just [1,2]): (Just [2,3]) --Couldn&#39;t match expected type <code>[Maybe [t]]&#39;                   with actual type </code>Maybe [Integer]&#39;"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1516781453, "post_id": 48417359, "comment_id": 83824768, "body": "That message tells you exactly what the problem is.  Did you follow its advice?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516783811, "post_id": 48417359, "comment_id": 83826055, "body": "I find it a bit weird to start with monads (which is usually seen as an intermediate or advanced topic) whereas this question shows that calling functions based on the type signature is a problem."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516785285, "post_id": 48417359, "comment_id": 83827012, "body": "As the error reports: <code>maybe you haven&#39;t applied a function to enough arguments?</code>"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1516795888, "creation_date": 1516795888, "answer_id": 48422188, "question_id": 48417359, "link": "https://stackoverflow.com/questions/48417359/haskell-monad-beginner/48422188#48422188", "title": "Haskell Monad Beginner", "body": "<p>You can use <code>unpack</code> in GHCi like this:</p>\n\n<pre><code>Prelude&gt; unpack (Just 5) (Just 42)\nJust (5,42)\nPrelude&gt; unpack [[42,1337],[123]] [[\"foo\"],[\"bar\",\"baz\"]]\n[([42,1337],[\"foo\"]),([42,1337],[\"bar\",\"baz\"]),([123],[\"foo\"]),([123],[\"bar\",\"baz\"])]\nPrelude&gt; :m +Data.Monoid\nPrelude Data.Monoid&gt; unpack (Product 7, \"foo\") (Product 6, \"bar\")\n(Product {getProduct = 42},(\"foo\",\"bar\"))\n</code></pre>\n\n<p>Notice that the function works with any <code>Monad</code>, not only <code>Maybe</code>. The above GHCi session demonstrates that by also calling <code>unpack</code> with two lists, and two tuples (which are <code>Monad</code> instances when the first element is a <code>Monoid</code>).</p>\n\n<p>There's nothing inherently wrong with the expression <code>unpack (Just 5)</code>:</p>\n\n<pre><code>Prelude Data.Monoid&gt; :t unpack (Just 5)\nunpack (Just 5) :: Num a =&gt; Maybe b -&gt; Maybe (a, b)\n</code></pre>\n\n<p>The reason you see an error is because, as you can see from the above type inquiry, the expression is <em>a function</em>. Again, there's nothing wrong with functions, but GHCi doesn't know how to render functions because it relies on the <code>Show</code> type class to turn expressions into printable values, and functions don't have <code>Show</code> instances.</p>\n\n<p>To address the second question, <code>rest</code> isn't <code>Just []</code>. First, <code>Just</code> isn't a type, but a data constructor, but secondly, even if you meant <code>Maybe [a]</code>, that's not necessarily true, because you don't know whether or not the <code>Monad</code> in question is <code>Maybe</code> or some other <code>Monad</code>.</p>\n\n<p>Finally, as far as I can tell, <code>rest</code> is the result of calling <code>unpack</code>, the result of which has the type <code>Monad m =&gt; m (a,b)</code>. Since <code>rest</code> is bound using <code>do</code> notation, it must, then, have the type <code>(a,b)</code>, unless I'm mistaken.</p>\n"}], "owner": {"reputation": 151, "user_id": 4948872, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/741307b81adf8818465d1a6f8b0ea5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Spam", "link": "https://stackoverflow.com/users/4948872/spam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 48422188, "answer_count": 1, "score": 0, "last_activity_date": 1516795984, "creation_date": 1516780449, "last_edit_date": 1516795984, "question_id": 48417359, "link": "https://stackoverflow.com/questions/48417359/haskell-monad-beginner", "title": "Haskell Monad Beginner", "body": "<p>Hello I have a code which I'm trying to understand:  </p>\n\n<pre><code>zipM:: Monad m =&gt; [m a] -&gt; [m b] -&gt; m [(a,b)]\nzipM [] list = return []\nzipM list [] = return []\nzipM (hFirst:tFirst) (hSecond:tSecond) = do\n  rest &lt;- zipM tFirst tSecond\n  headUnpacked &lt;- unpack hFirst hSecond\n  return (headUnpacked : rest) -- rest = Just []\n\nunpack ::Monad m =&gt; m a -&gt; m b -&gt; m (a,b)\nunpack first second = do\n  fi &lt;- first\n  se &lt;- second\n  return (fi, se)\n</code></pre>\n\n<p>Generally I got a point but still have problem at two moments.</p>\n\n<ol>\n<li>How to  call 'unpack' in console ?  I tried   <code>unpack (Just 5)</code> and it's causing an error.</li>\n<li>Since <code>'rest'</code>  is <code>'Just []'</code>  how can I perform simple list add?<br>\nI tried <code>(Just 4): (Just [])</code> and also <code>(Just [1,2]): (Just [2,3])</code> both of which result in errors.</li>\n</ol>\n\n<p>I'll be most grateful if someone will show with some basic explanation how to perform this two actions.</p>\n"}, {"tags": ["haskell", "functional-programming", "fibonacci"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1516778163, "post_id": 48416591, "comment_id": 83823121, "body": "It is unclear what your expect result type is. Is it supposed to be a list of strings?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1516778228, "post_id": 48416591, "comment_id": 83823152, "body": "What does the list that you want have to do with fibonacci numbers?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1516778275, "post_id": 48416591, "comment_id": 83823173, "body": "Btw, for better efficiency drop the <code>fib</code> function with the indexed access and just use <code>fibonacci = fibs</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516782426, "post_id": 48416591, "comment_id": 83825288, "body": "The two lists do not match..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516782637, "post_id": 48416591, "comment_id": 83825377, "body": "The first list is in fact <i>semantically</i> correct, the last one is incorrect, there you only shift a zero and a one at the right end into the binary representation."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1516812410, "post_id": 48416591, "comment_id": 83845494, "body": "Thanks. But, I have to obtained this succession 0, 1, 10, 101, 1010, 10101, 101010, 1010101, 10101010, 101010101, 1010101010,.. by Fibonacci (oeis.org/A056830) In this web it is explained how, but I can&#39;t transpose to Haskell"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1516812387, "post_id": 48416962, "comment_id": 83845479, "body": "Thanks. But, I have to obtained this succession 0, 1, 10, 101, 1010, 10101, 101010, 1010101, 10101010, 101010101, 1010101010,.. by Fibonacci (oeis.org/A056830) In this web it is explained how, but I can&#39;t transpose to Haskell"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1516779098, "last_edit_date": 1516779098, "creation_date": 1516778773, "answer_id": 48416962, "question_id": 48416591, "link": "https://stackoverflow.com/questions/48416591/fibonacci-bit-representation-haskell/48416962#48416962", "title": "Fibonacci Bit Representation Haskell", "body": "<p>There are many ways to add digits together in order to get a number. Here's one way. Probably not the most efficient way, but on the other hand built up from smaller functions.</p>\n\n<p>Values like <code>[1,0,1]</code>,<code>[1,0,0,0]</code>, and <code>[1,1,0,1]</code> are lists in their own right, so what we can do first is to index them. The only trouble is that we'd like to index them in descending order. You can do that by reversing them, indexing them, and then reverse them again, e.g.:</p>\n\n<pre><code>Prelude&gt; reverse $ zip [0..] $ reverse [1,1,0,1]\n[(3,1),(2,1),(1,0),(0,1)]\n</code></pre>\n\n<p>The first element in each tuple is the order of magnitude, so you just need to make it a power of ten:</p>\n\n<pre><code>Prelude&gt; :m +Data.Bifunctor\nPrelude Data.Bifunctor&gt; reverse $ fmap (first (10 ^)) $ zip [0..] $ reverse [1,1,0,1]\n[(1000,1),(100,1),(10,0),(1,1)]\n</code></pre>\n\n<p>Now you can simply multiply the elements of the tuples together:</p>\n\n<pre><code>Prelude Data.Bifunctor&gt; reverse $ fmap (uncurry (*) . first (10 ^)) $ zip [0..] $ reverse [1,1,0,1]\n[1000,100,0,1]\n</code></pre>\n\n<p>Finally, you can add all of those numbers together. In fact, you don't need to reverse the reversed list:</p>\n\n<pre><code>Prelude Data.Bifunctor&gt; sum $ fmap (uncurry (*) . first (10 ^)) $ zip [0..] $ reverse [1,1,0,1]\n1101\n</code></pre>\n\n<p>You can put such a combination in a function and map your values over it.</p>\n\n<hr>\n\n<p>A more efficient solution would probably be to just be to do a <strong>left fold</strong> (<code>foldl</code>), e.g.:</p>\n\n<pre><code>Prelude&gt; foldl (\\acc x -&gt; (10 * acc) + x) 0 [1,1,0,1]\n1101\nPrelude&gt; foldl (\\acc x -&gt; (10 * acc) + x) 0 [1,1,1]\n111\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1516795062, "post_id": 48418090, "comment_id": 83833246, "body": "Thanks.  But, I have to obtained this succession 0, 1, 10, 101, 1010, 10101, 101010, 1010101, 10101010, 101010101, 1010101010,..  by Fibonacci (<a href=\"https://oeis.org/A056830\" rel=\"nofollow noreferrer\">oeis.org/A056830</a>) In this web it is explained how, but I can&#39;t transpose to Haskell"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1516783201, "creation_date": 1516783201, "answer_id": 48418090, "question_id": 48416591, "link": "https://stackoverflow.com/questions/48416591/fibonacci-bit-representation-haskell/48418090#48418090", "title": "Fibonacci Bit Representation Haskell", "body": "<p>An idea could be to represent binary values in decimal notation. So we \"transform\" <code>2</code> into <code>10</code>.</p>\n\n<p>We can do that by writing a recursive function:</p>\n\n<pre><code>bintodec :: Integral i =&gt; i -&gt; i\nbintodec 0 = 0\nbintodec i = (mod i 2) + 10 * bintodec (div i 2)\n</code></pre>\n\n<p>This only works for positive values, but that is not really a problem here, since Fibonacci numbers are positive numbers.</p>\n\n<p>Now we already have a definition of the Fibonacci numbers, like in your answer:</p>\n\n<pre><code>fibs :: Num n =&gt; [n]\nfibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>So the only thing we still have to do is <code>map</code> every elements of <code>fibs</code> with <code>bintodec</code>:</p>\n\n<pre><code>binfibs :: Integral i =&gt; [i]\nbinfibs = map bintodec fibs\n</code></pre>\n\n<p>The first 15 numbers are then:</p>\n\n<pre><code>Prelude&gt; take 15 binfibs\n[0,1,1,10,11,101,1000,1101,10101,100010,110111,1011001,10010000,11101001,101111001]\n</code></pre>\n\n<p>The nice thing is here that we do not use any binary lists to process it, but keep working in the integer world, which is usually more safe.</p>\n\n<hr>\n\n<p>Based on the second list however, this has nothing to do with Fibonacci numbers. There you start with <code>0</code>, and you then shift a zero or a one in at the right end of the number.</p>\n\n<p>We can use <code>iterate</code> for this:</p>\n\n<pre><code>iterate (\\x -&gt; 10 * x + 1-(mod x 2)) 0\n</code></pre>\n\n<p>which produces:</p>\n\n<pre><code>Prelude&gt; take 15 $ iterate (\\x -&gt; 10 * x + 1-(mod x 2)) 0\n[0,1,10,101,1010,10101,101010,1010101,10101010,101010101,1010101010,10101010101,101010101010,1010101010101,10101010101010]\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 48418090, "answer_count": 2, "score": 1, "last_activity_date": 1516783201, "creation_date": 1516777297, "last_edit_date": 1516779309, "question_id": 48416591, "link": "https://stackoverflow.com/questions/48416591/fibonacci-bit-representation-haskell", "title": "Fibonacci Bit Representation Haskell", "body": "<p>I already have the following functions</p>\n\n<pre><code>toBin, auxBin :: Integer -&gt; [Integer]\ntoBin 0 = [0]\ntoBin n = reverse (auxBin n)\n\nauxBin 0 = []\nauxBin n = n `mod` 2 : auxBin (n `div` 2)\n\nfib :: Int -&gt; Integer\nfib n = fibs !! n\n  where\n    fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci = [fib n | n &lt;- [0..]]\n</code></pre>\n\n<p>But when I map the Fibonacci list with the <code>toBin</code> function, I obtained an incorrect list:</p>\n\n<p>Becuase, I obtained this:</p>\n\n<pre><code>[[0],[1],[1],[1,0],[1,1],[1,0,1],[1,0,0,0],[1,1,0,1],[1,0,1,0,1],[1,0,0,0,1,0]]\n</code></pre>\n\n<p>But, I want this:</p>\n\n<pre><code>[0,1,10,101,1010,10101,101010,1010101,10101010,101010101]\n</code></pre>\n\n<p>Could you help me?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 2, "creation_date": 1516797960, "post_id": 48414999, "comment_id": 83835029, "body": "Theres always this: <code>split = foldr (\\(a, b) (as, bs) -&gt; (a:as, b:bs)) ([], []) </code>"}], "answers": [{"tags": [], "owner": {"reputation": 217, "user_id": 9258064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0af189f66edc1d675dc4f3e41c1f150b?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Maurice Williams", "link": "https://stackoverflow.com/users/9258064/mark-maurice-williams"}, "is_accepted": false, "score": 5, "last_activity_date": 1516769741, "last_edit_date": 1516769741, "creation_date": 1516769422, "answer_id": 48415019, "question_id": 48414999, "link": "https://stackoverflow.com/questions/48414999/transform-a-list-of-pairs-into-pair-of-list-using-list-comprehension/48415019#48415019", "title": "transform a list of pairs into pair of list using list comprehension", "body": "<p>The <strong>split</strong> function you are looking for already exists in the standard Haskell Prelude library; it is called <strong>unzip</strong>.</p>\n\n<p>Using list comprehensions:</p>\n\n<pre><code>split xs = ([a | (a,_) &lt;- xs], [b| (_,b) &lt;- xs])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": false, "score": 2, "last_activity_date": 1516783640, "creation_date": 1516783640, "answer_id": 48418223, "question_id": 48414999, "link": "https://stackoverflow.com/questions/48414999/transform-a-list-of-pairs-into-pair-of-list-using-list-comprehension/48418223#48418223", "title": "transform a list of pairs into pair of list using list comprehension", "body": "<p>While you've got a correct answer, here's one way to approach this more systematically.</p>\n\n<p>If you break the problem down into</p>\n\n<ol>\n<li>Making a list of the \"firsts\", and</li>\n<li>Making a list of the \"seconds\", and</li>\n<li>Making a pair of those lists,</li>\n</ol>\n\n<p>you get</p>\n\n<pre><code>firsts  xs = [a | (a, _) &lt;- xs]\nseconds xs = [b | (_, b) &lt;- xs]\nsplit xs = (firsts xs, seconds xs)\n</code></pre>\n\n<p>and then you can \"inline\" the auxiliary functions</p>\n\n<pre><code>split xs = ([a | (a, _) &lt;- xs], [b | (_, b) &lt;- xs])\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 8877063, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/82a1b0089abbf4e0f28693c723422410?s=128&d=identicon&r=PG&f=1", "display_name": "codingmonk", "link": "https://stackoverflow.com/users/8877063/codingmonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1516783640, "creation_date": 1516769252, "last_edit_date": 1516769425, "question_id": 48414999, "link": "https://stackoverflow.com/questions/48414999/transform-a-list-of-pairs-into-pair-of-list-using-list-comprehension", "title": "transform a list of pairs into pair of list using list comprehension", "body": "<p>Haskell  </p>\n\n<pre><code>split:: [(a,b)] -&gt; ([a],[b])\n</code></pre>\n\n<p>Function should return </p>\n\n<pre><code>split [(1,\u2019a\u2019), (2,\u2019b\u2019), (3,\u2019c\u2019)] = ([1,2,3], \"abc\")\n</code></pre>\n\n<p>Please how do i do it using list comprehension? thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1516753004, "post_id": 48412890, "comment_id": 83815767, "body": "What&#39;s unclear about the error message? The result of <code>:</code> and its right operand have the same type. The expected result type is <code>[[a]]</code> (as per your type signature), but <code>xs</code> has type <code>[a]</code> (also per your type signature)."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516753418, "post_id": 48412890, "comment_id": 83815880, "body": "how would you solve it? i am not in school, i am doing this for fun."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1516768365, "post_id": 48412890, "comment_id": 83819503, "body": "@melpomene, while what you say is true, the error message is actually complaining Amy something else: the mismatch between the types of the two arguments to <code>(:)</code>. Based on the type of the first argument, it&#39;s expecting the second argument to have type <code>[[[a]]]</code> but sees it has type <code>[a]</code>. In fact, both arguments have the wrong types to match the expected result type, but the type checker only reported the first problem it noticed."}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1516754200, "post_id": 48413059, "comment_id": 83816079, "body": "Thanks. whats a more efficient way to do this?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1516754388, "post_id": 48413059, "comment_id": 83816130, "body": "How about looking the standard implementation?"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1516754838, "post_id": 48413059, "comment_id": 83816242, "body": "i tried finding this but couldnt. do you have a link?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1516755050, "post_id": 48413059, "comment_id": 83816307, "body": "Use <a href=\"https://hayoo.fh-wedel.de/?query=inits\" rel=\"nofollow noreferrer\">Hayoo</a>, click <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:inits\" rel=\"nofollow noreferrer\">the <code>Data.List</code> version</a>, then <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.OldList.html#inits\" rel=\"nofollow noreferrer\">on <code>Source</code></a>. \u2014 Admittedly, turns out the standard implementation is a bit complicated here, but that&#39;s apparently the way to go to make this inherently not so performance-great function run well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 1, "creation_date": 1516768644, "post_id": 48413059, "comment_id": 83819569, "body": "@dopatraman, the simplest way to do it with very well-behaved and pretty good performance characteristics is <code>inits xs = [] : zipWith (\\k _ -&gt; take k xs) [1..] xs</code>. The standard library gets fancier to improve constant factors."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1516753837, "creation_date": 1516753837, "answer_id": 48413059, "question_id": 48412890, "link": "https://stackoverflow.com/questions/48412890/why-is-my-implementation-of-inits-failing/48413059#48413059", "title": "Why is my implementation of inits failing?", "body": "<p>It seems like you've designed this as a mirrored version of</p>\n\n<pre><code>tails' :: [a] -&gt; [[a]]\ntails' [] = [[]]\ntails' xs = xs : tails' (tail xs)\n</code></pre>\n\n<p>The reason that works is that the <code>:</code> operator prepends a single element <code>xs</code> to a list. This could also be written</p>\n\n<pre><code>tails' xs = [xs] ++ tails' (tail xs)\n</code></pre>\n\n<p>But in <code>inits'(init xs) : xs</code>, this doesn't apply: the single element would be <code>inits'(init xs)</code>, but that's in fact already a nested list. The <code>++</code> version would however work:</p>\n\n<pre><code>inits' xs = inits'(init xs) ++ [xs]\n</code></pre>\n\n<p>Mind, this is pretty inefficient, because <code>++</code> always needs to traverse the entire LHS list, and this happens over and over in the recursion.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1516753837, "creation_date": 1516752528, "question_id": 48412890, "link": "https://stackoverflow.com/questions/48412890/why-is-my-implementation-of-inits-failing", "title": "Why is my implementation of inits failing?", "body": "<p>Here's how I've implemented it:</p>\n\n<pre><code>inits' :: [a] -&gt; [[a]]\ninits' [] = [[]]\ninits' xs = inits'(init xs) : xs\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018a\u2019 with \u2018[[a]]\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      inits' :: forall a. [a] -&gt; [[a]]\n  Expected type: [[[a]]]\n    Actual type: [a]\n\u2022 In the second argument of \u2018(:)\u2019, namely \u2018xs\u2019\n  In the expression: inits' (init xs) : xs\n  In an equation for \u2018inits'\u2019: inits' xs = inits' (init xs) : xs\n</code></pre>\n\n<p>seems that to produce inits I'd have to call init on every sublist. What am I doing wrong?</p>\n"}, {"tags": ["function", "haskell", "io"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 8, "creation_date": 1516747480, "post_id": 48412023, "comment_id": 83813980, "body": "<code>getChar</code> is not a function; it&#39;s a constant."}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516747605, "post_id": 48412023, "comment_id": 83814023, "body": "Right. But a constant can be represented as a function that ignores its arguments and give you back a specific value?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1516747609, "post_id": 48412023, "comment_id": 83814025, "body": "ghc doesn&#39;t implement it this way, but you can indeed think of <code>IO</code> as assembling an imperative program (in e.g. C or assembler code). Or rather: Your Haskell program runs and creates one big <code>IO</code> value (an imperative program) bound to <code>main</code>. The Haskell runtime system then takes the value of <code>main</code> and executes it."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1516747655, "post_id": 48412023, "comment_id": 83814036, "body": "No, in Haskell a function is something of type <code>A -&gt; B</code> for some types A and B. That is, a function takes exactly one argument. There is no <code>-&gt;</code> in <code>getChar</code>&#39;s type."}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516748435, "post_id": 48412023, "comment_id": 83814326, "body": "So, could the phrase &quot;When executed&quot; mean that taking the user actions into consideration, the ghc compiler figures out how to do this execution?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1516750376, "post_id": 48412023, "comment_id": 83814984, "body": "Much as with other programming languages, the implementation of <code>getChar</code> ultimately involves some OS syscalls to actually read the char. The &quot;when executed&quot; part you read in some documentation only means that, just because some IO action is returned, that does not mean it is executed. E.g. <code>length [getChar,getChar]</code> does not perform any IO. Here you can pretend two IO actions are created but not executed (actually, doe to the laziness, they won&#39;t even be created, but that&#39;s another issue)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1516752421, "post_id": 48412023, "comment_id": 83815619, "body": "If you want to see the source of select <code>IO</code> functions - <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/src/GHC-IO-Handle-Text.html#hGetChar\" rel=\"nofollow noreferrer\">it&#39;s there in plain text</a>."}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1516753003, "post_id": 48412023, "comment_id": 83815765, "body": "Thanks. Yeah, I can see they are using this an extension that refers to C++. hmmm."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1516759367, "post_id": 48412023, "comment_id": 83817413, "body": "@HassanShahin There is no C++ involved. <code>CPP</code> refers to the C preprocessor, which is merely used to process some configuration macros (for instance, one such macro enables parts of the code depending on the compiler version, for backward compatibility purposes)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516767991, "post_id": 48412023, "comment_id": 83819416, "body": "@chi, the actions in that case won&#39;t be created <i>because they already exist</i>. <code>getChar</code> doesn&#39;t need any evaluation."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1516768298, "post_id": 48412023, "comment_id": 83819488, "body": "&quot;Unless you give me the implementation of this function, and I study that implementation, I can&#39;t guarantee it is pure.&quot; - actually you can guarantee that all Haskell functions are pure, that&#39;s kinda the point of Haskell"}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1516754625, "post_id": 48413048, "comment_id": 83816190, "body": "Sure, many thanks. It&#39;s my bad. I totally forgot that getChar is ALREADY PREPARED computation. As you know, when introducing a functional language, probably in the Introduction, or in Chapter 1 of a textbook, they refer to pure and impure functions, and to make their point of the benefits of pure functions, they take getChar as an example. When you take a function like square a = a*a (where a is a Int), I (as a beginner) have to ask where are the arguments for getChar. Since they don&#39;t provide such an argument,  the question then arises &quot;Who said it is a function?&quot;. Hence the confusion."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1516755298, "post_id": 48413048, "comment_id": 83816380, "body": "@HassanShahin Please ask if there is anything that needs further clarification!"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1516755400, "post_id": 48413048, "comment_id": 83816412, "body": "@HassanShahin Also, I do recommend you to watch the video I linked to from my answer. It is the principal creator of Haskell explaining things there. I really love that video."}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1516755533, "post_id": 48413048, "comment_id": 83816448, "body": "Thanks again! You have no idea how many tutorials, Haskell books, videos I have read, watched (including SPJ ones). I even went for Category theory. All is fine, I guess. Sometimes you stumble with vey tiny things that you can&#39;t wrap your brain around. This is one of those incidents. Many thanks."}, {"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 0, "creation_date": 1516757158, "post_id": 48413048, "comment_id": 83816893, "body": "There was a time before Haskell had IO? What was it even useful for?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 2, "creation_date": 1516757445, "post_id": 48413048, "comment_id": 83816950, "body": "@Qwertie Haskell was founded around 1987, and gained IO around 1997. Before that, there was a more ad-hoc solution for interacting with the real world, somewhat similar to the modern <code>interact</code> Prelude function. See also <a href=\"https://stackoverflow.com/q/17002119/2108477\">this answer</a>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 1, "creation_date": 1516772780, "post_id": 48413048, "comment_id": 83820729, "body": "@Qwertie Mathematics has no IO either, and yet it is quite useful indeed for reasoning about computation. In much the same way Haskell was developing as a way to represent computation. It was &quot;a bit embarrassing&quot; to be lacking any IO functionality, but it was a tolerable failing for a research language that was exploring new ideas."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 5, "last_activity_date": 1516753749, "creation_date": 1516753749, "answer_id": 48413048, "question_id": 48412023, "link": "https://stackoverflow.com/questions/48412023/regarding-when-executed-in-haskell-io-monad/48413048#48413048", "title": "Regarding (When Executed) in Haskell IO Monad", "body": "<p>Haskell functions are not the same as <em>computations</em>.</p>\n\n<p>A computation is a piece of imperative code (perhaps written in C or Assembler, and then compiled to machine code, directly executable on a processor), that is by nature effectful and even unrestricted in its effects. That is, once it is ran, a computation may access and alter any memory and perform any operations, such as interacting with keyboard and screen, or even launching missiles.</p>\n\n<p>By contrast, a function in a pure language, such as Haskell, is unable to alter arbitrary memory and launch missiles. It can only alter its own personal section of memory and return a result that is specified in its type.</p>\n\n<p>So, in a sense, Haskell is a language that <em>cannot do anything</em>. <a href=\"https://www.youtube.com/watch?v=iSmkqocn0oQ&amp;t=202s\" rel=\"noreferrer\">Haskell is useless</a>. This was a major problem during the 1990's, until <code>IO</code> was integrated into Haskell.</p>\n\n<p>Now, an <code>IO a</code> value is a link to a separately prepared <em>computation</em> that will, eventually, hopefully, produce <code>a</code>. You will not be able to create an <code>IO a</code> out of pure Haskell functions. All the <code>IO</code> primitives are designed separately, and packaged into GHC. You can then compose these simple computations into less trivial ones, and eventually your program may have any effects you may wish.</p>\n\n<p>One point, though: pure functions are <em>separate from each other</em>, they can only influence each other if you use them together. Computations, on the other hand, may interact with each other freely (as I said, they can generally do anything), and therefore can (and do) accidentally break each other. That's why there are so many bugs in software written in imperative languages! So, in Haskell, computations are kept in <code>IO</code>.</p>\n\n<p>I hope this dispels at least some of your confusion.</p>\n"}], "owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 1, "accepted_answer_id": 48413048, "answer_count": 1, "score": 0, "last_activity_date": 1516755070, "creation_date": 1516747187, "last_edit_date": 1516755070, "question_id": 48412023, "link": "https://stackoverflow.com/questions/48412023/regarding-when-executed-in-haskell-io-monad", "title": "Regarding (When Executed) in Haskell IO Monad", "body": "<p>I have no problem with the IO Monad. But I want to understand the followings:</p>\n\n<ol>\n<li>In All/almost Haskell tutorials/ text books they keep saying that getChar is not a pure function, because it can give you a different result. My question is: Who said that this is a function in the first place. Unless you give me the implementation of this function, and I study that implementation, I can't guarantee it is pure. So, where is that implementation?</li>\n<li>In All/almost Haskell tutorials/ text books, it's said that, say <code>(IO String)</code> is an action that (When executed) it can give you back a value of type String. This is fine, but who/where this execution is taking place. Of course! The computer is doing this execution. This is OK too. but since I am only a beginner, I hope you forgive me to ask, where is the recipe for this \"execution\". I would guess it is not written in Haskell. Does this later idea mean that, after all, that a Haskell program is converted into a C-like program, which will eventually be converted into Assembly -> Machine code? If so, where one can find the implementation of the IO stuff in Haskell?</li>\n</ol>\n\n<p>Many thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 3, "creation_date": 1516739980, "post_id": 48410394, "comment_id": 83810484, "body": "Is it time for <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">an introduction</a>?"}, {"owner": {"reputation": 5029, "user_id": 8836582, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5f737b956bfd27d77d622fb17290f5d5?s=128&d=identicon&r=PG&f=1", "display_name": "Dawn17", "link": "https://stackoverflow.com/users/8836582/dawn17"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1516740073, "post_id": 48410394, "comment_id": 83810534, "body": "I am following that page, but understanding this specific function will give me better understanding."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1516740231, "post_id": 48410394, "comment_id": 83810604, "body": "Why not write another function using that syntax and experiment?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516744997, "post_id": 48410394, "comment_id": 83812886, "body": "By the way, I personally dislike the code above, and I would not recommend you learn that style. It uses guards instead of proper pattern matching, relies on the partial <code>head,tail</code> (when pattern matching would avoid those! at least they are used safely here), calls <code>length</code> repeatedly causing a loss of efficiency. Finally, <code>foo</code> is still partial since <code>foo []</code> is undefined."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 5, "last_activity_date": 1516742041, "last_edit_date": 1516742041, "creation_date": 1516740580, "answer_id": 48410571, "question_id": 48410394, "link": "https://stackoverflow.com/questions/48410394/learning-the-haskell-syntax/48410571#48410571", "title": "Learning the haskell syntax", "body": "<p>It looks like you need a tutorial, not a stack overflow answer, but I'll quickly breeze through the answers to your question: what is <code>(elem: rest)</code>.</p>\n\n<p>First off, we're looking at pattern matching. Pattern matching breaks an argument into component parts based on matching values with constructors for its type. If that's confusing, it's only because you haven't used it much before. For a more straightforward example, imagine a custom data type:</p>\n\n<pre><code>data Foo = Foo Int\n</code></pre>\n\n<p><code>Foo</code> here is just wrapping an <code>Int</code>, and we can pattern match on it by saying:</p>\n\n<pre><code>bar :: Foo -&gt; Int\nbar (Foo x) = x\n</code></pre>\n\n<p>This unwraps that <code>Int</code> by <em>pattern matching</em> with <code>Foo</code>'s constructor to assign the <code>Int</code> to <code>x</code>.</p>\n\n<p>How is this relevant to the code above? Well a Haskell list has the constructor <code>(:)</code>. This is used as an operator, so you see it used infix rather than prefix (i.e. <code>3:something</code> rather than <code>: 3 something</code>, though you can do the latter if you enclose it in parens: <code>(:) 3 something</code> as with all operators). <code>(:)</code> is known as the \"cons\" operator, and it prepends something to the list.</p>\n\n<p>If I were to re-write a list using <code>(:-:)</code> instead of <code>(:)</code>, I could write:</p>\n\n<pre><code>data MyList a = a :-: MyList\n              | Null\n</code></pre>\n\n<p>This is a recursively-defined datatype, in that each element is either <code>Null</code>, or contains another <code>MyList</code> type. This is the same with lists: each element is defined as either <code>something : [moreSomethings]</code> or <code>[]</code>.</p>\n\n<p>That first case there is special, and leads to what we're doing in <code>(elem:rest)</code>. We're splitting out the head of the list from the tail by pattern matching on the <code>(:)</code> operator. For list <code>lst</code>, <code>elem = head lst</code> and <code>rest = tail lst</code>.</p>\n\n<p>This syntax is common everywhere, though you usally see it written as <code>(x:xs)</code> rather than <code>(elem:rest)</code>. Consider this transcription of <code>map</code>:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f (x:xs) = f x : map f xs\n</code></pre>\n\n<p>Literally this means to take the first element of the list you pass it, apply the function to it, and \"cons\" that to <code>map f xs</code> (mapping the same function over the rest of the list).</p>\n\n<p>The only thing this is missing is a default case -- what happens when you get to the end of the list? Well we mentioned earlier that a list could either be <code>(x:xs)</code> or <code>[]</code>, so let's pattern match on <code>[]</code></p>\n\n<pre><code>-- from above\nmap _ [] = []\n</code></pre>\n\n<p>Now the map of any function over an empty list is just an empty list. This is necessary because <code>map f (x:xs)</code> will not match against an empty list, and Haskell will complain that you have not written a total function, but a <a href=\"https://en.wikipedia.org/wiki/Partial_function\" rel=\"nofollow noreferrer\">partial function</a>.</p>\n\n<hr>\n\n<p>Pattern matching is an exceptionally idiomatic Haskell construct, and you should use it a lot. For instance, you can parse <code>Char</code> digits 0-9 using:</p>\n\n<pre><code>-- |This is analogous to @digitToInt@ in @Data.Char@, but will not\n-- parse hex digits ([a-fA-F]).\nmyDigitToInt :: Char -&gt; Int\nmyDigitToInt '0' = 0\nmyDigitToInt '1' = 1\nmyDigitToInt '2' = 2\nmyDigitToInt '3' = 3\nmyDigitToInt '4' = 4\nmyDigitToInt '5' = 5\nmyDigitToInt '6' = 6\nmyDigitToInt '7' = 7\nmyDigitToInt '8' = 8\nmyDigitToInt '9' = 9\nmyDigitToInt _   = error \"Invalid digit\"\n</code></pre>\n\n<p>You can re-write your very strange function above using a bit more pattern matching:</p>\n\n<pre><code>foo' :: [Int] -&gt; [Int]\nfoo' []         = []  -- zero-element list\nfoo' (0:xs)     = 0 : foo' rest  -- n-element list starting with zero\nfoo' [x]        = [x-1]  -- one-element list\nfoo' (x1:x2:xs) = (x1-1) : x2 + length xs + 1 : xs  -- n-element list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 619, "user_id": 8514005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a3ae487b2140f9d08079450b6903d?s=128&d=identicon&r=PG&f=1", "display_name": "JohEker", "link": "https://stackoverflow.com/users/8514005/joheker"}, "is_accepted": false, "score": 2, "last_activity_date": 1516742014, "creation_date": 1516742014, "answer_id": 48410921, "question_id": 48410394, "link": "https://stackoverflow.com/questions/48410394/learning-the-haskell-syntax/48410921#48410921", "title": "Learning the haskell syntax", "body": "<pre><code>foo :: [Int] -&gt; [Int]\n\nfoo (elem : rest)\n    | elem == 0 &amp;&amp; null rest = [elem]\n    | null rest = [elem - 1]\n    | elem == 0 = 0:(foo rest)\n    | otherwise = elem - 1 : head rest + length rest : tail rest\n</code></pre>\n\n<p>This is a case of two important concepts: Pattern matching and recursiveness. As mentioned above we are \"breaking down\" the components by saying how the input could look like.</p>\n\n<pre><code>foo :: [Int]-&gt;[Int]\nfoo (1:2:3:rest) = [rest]\n</code></pre>\n\n<p>In this case we say \"if the input starts with a 1 followed by a 2 which is followed by a 3 which is followed by some rest <strong>then do this.</strong></p>\n\n<p>As you now can tell, the <code>: or \"cons\"</code> is an operator that works on lists by putting the argument to the front of a list with the same type.</p>\n\n<p>Next thing is recursiveness. A recursive function is a different way of \"looping\" as we would call it in some other languages. We have an initial value, we do something with it, we apply that result to ourselves with updated arguments.</p>\n\n<pre><code>foo :: Int -&gt; Int\nfoo 0       = 0\nfoo someInt = someInt + foo (someInt -1)\n</code></pre>\n\n<p>Here we will add the input together with the result of the same function with a decreased input value. When we hit the basecase 0 we will stop and return whatever the previous results are added with 0, and we return that value as a final result.</p>\n\n<p>In your example we have only one recursive option, the rest are similar to a \"base case\" and will instantly return the value of the calculations as the final result</p>\n\n<p>The recursive magic happends in this case when : <code>elem == 0 = 0:(foo rest)</code></p>\n\n<p>Now we know the things we need to know to break this function down.</p>\n\n<pre><code>foo (elem : rest)    -- if we have some elem followed by some rest\n    | elem == 0 &amp;&amp; null rest = [elem]    -- We call this the basecase of the recursive function\n    | null rest = [elem -1]    -- whatever the value of elem is, if the rest does not exist, we return a list containing the elem decreased by one\n    | elem == 0 = 0:(foo rest) -- whatever the rest, if elem equals 0, we take a zero and we add it in the front of whatever list comes out if we use the rest as the input argument to our function.\n    | otherwise = elem -1 : head rest + length rest : tail rest\n      -- in any other case not mentioned do the following: \n      -- take the first element of the rest, add it together with the lenght of the list, put that element in the front of the remaining elements of the rest, decrease the elem by one and put it in the front of that list\n</code></pre>\n\n<p>^ i hope this is not too hard to read</p>\n"}], "owner": {"reputation": 5029, "user_id": 8836582, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5f737b956bfd27d77d622fb17290f5d5?s=128&d=identicon&r=PG&f=1", "display_name": "Dawn17", "link": "https://stackoverflow.com/users/8836582/dawn17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1516742041, "creation_date": 1516739918, "question_id": 48410394, "link": "https://stackoverflow.com/questions/48410394/learning-the-haskell-syntax", "title": "Learning the haskell syntax", "body": "<pre><code>foo :: [Int] -&gt; [Int]\n\nfoo (elem : rest)\n    | elem == 0 &amp;&amp; null rest = [elem]\n    | null rest = [elem - 1]\n    | elem == 0 = 0:(foo rest)\n    | otherwise = elem - 1 : head rest + length rest : tail rest\n</code></pre>\n\n<p>I am studying Haskell. I am quite sure how the sample function above works.\nI understand that <code>[Int] -&gt; [Int]</code> indicates input type and return type. </p>\n\n<p>What exactly is the (elem : rest)? Is it like a for loop?\nAnd I know that <code>|</code> works like <code>if</code>, but I am quite confused because the syntax looks inconsistent. </p>\n\n<p>Please help me understanding this function.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "ghc", "operator-precedence"], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1516745847, "post_id": 48411699, "comment_id": 83813262, "body": "You may want to explain how <code>lazy</code>&#39;s magical actually-strict-but-treated-lazy property plays into this."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1516746161, "post_id": 48411699, "comment_id": 83813402, "body": "<i>This can throw either &quot;a&quot; or &quot;b&quot;.</i> But does this actually happens? I played with this example as well after reading Imprecise exceptions article. But didn&#39;t discover combination of ghc flags/ghc versions/code example where <code>&quot;b&quot;</code> is thrown. It&#39;s always <code>&quot;a&quot;</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1516750938, "post_id": 48411699, "comment_id": 83815160, "body": "@Shersh if you look at <code>pseq</code>&#39;s documentation, it heavily implies that the usage of <code>lazy</code> stops strictness analysis from transforming <code>a `pseq` b</code> into <code>b `pseq` a `pseq` b</code>. You need to find an example that causes that optimization with <code>seq</code> and use <code>unsafePerformIO</code> or <code>error</code> to expose it."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516751555, "post_id": 48411699, "comment_id": 83815363, "body": "I kinda think this answer misses the more substantial cause for the poor performance of <code>pseq</code>. It is actually not an overhead, but rather an algorithmic mishap. (I deliver my theory in the answer nearby.)"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1516754740, "post_id": 48411699, "comment_id": 83816224, "body": "@Shersh ah sorry I got confused. I do not know of an example where that happens, although it probably exists as that is the motivation behind <code>pseq</code>, and it is likely to be related to parallelism."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516754776, "post_id": 48411699, "comment_id": 83816231, "body": "@Kindaro If it is not overhead, why does optimization get rid of it?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516755161, "post_id": 48411699, "comment_id": 83816337, "body": "@Li-yaoXia To find out, we would have to hunt down the exact optimization that removes the wild allocation of <code>go</code> that we observe in the <code>pseq</code> example. Quoting GHC manual, <i>The -O* options specify convenient \u201cpackages\u201d of optimisation flags; the -f* options described later on specify individual optimisations to be turned on/off</i> and so many they are.  Overall, your argument implies any optimization may only remove something you call <i>overhead</i> which I consider improbable. GHC optimizations are as tricky as they are many."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1516755651, "post_id": 48411699, "comment_id": 83816491, "body": "Without optimizations you pay the cost of calling <code>pseq</code> as a function in addition to whatever <code>seq</code> does afterwards. This reduces to a <code>seq</code> as soon as you inline and partially evaluate."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516756781, "post_id": 48411699, "comment_id": 83816781, "body": "@Li-yaoXia This is clear to me. But, as I see it, this alone does not explain the rather large memory allocation in <code>go</code> in the <code>pseq</code> case."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516756940, "post_id": 48411699, "comment_id": 83816824, "body": "Note that even without optimizations enabled, <code>seq</code> turns into a <code>case</code> in when used in <code>go</code>. <code>pseq</code> remains a function. If I use <code>lpseq a b = a `seq` lazy b</code> to replicate <code>pseq</code> locally, it inlines to a <code>case</code> and a call to <code>lazy</code>. If I use <code>liseq a b = a `seq` id b</code>, it inlines to a <code>case</code> and a call to <code>id</code>. In order of performance, I get <code>pseq</code> &lt; <code>liseq</code> &lt; (<code>seq</code> ~ <code>lpseq</code>). Hypothesis: <code>lazy</code> has a minimal effect on performance here and apparently doesn&#39;t live to runtime. The function calls to <code>pseq</code> and <code>id</code> seem to be the culprits."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516758882, "post_id": 48411699, "comment_id": 83817280, "body": "@Kindaro The naive <code>go</code> allocates a closure for <code>x + acc</code> and just calls <code>go</code> recursively. The <code>pseq</code> version allocates two closures for <code>x + acc</code> and <code>go acc&#39; xs</code>, and calls <code>pseq</code>. The <code>seq</code> version makes calls to <code>+</code> and <code>go</code> successively."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516759344, "post_id": 48411699, "comment_id": 83817406, "body": "@HTNW, Li-yao Xia: I added my source code and the timings to my answer. Kindly do take a look and let me know if it is in agreement with your measures, so we may have a common baseline."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1516767499, "post_id": 48411699, "comment_id": 83819286, "body": "Does <code>lazy</code> actually introduce any indirection? I doubt it. It doesn&#39;t actually have an implementation; it&#39;s 100% pure compiler magic. But there may well be indirection from the <code>pseq</code> call."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 6, "last_activity_date": 1516769390, "last_edit_date": 1516769390, "creation_date": 1516745583, "answer_id": 48411699, "question_id": 48410245, "link": "https://stackoverflow.com/questions/48410245/always-guaranteed-evaluation-order-of-seq-with-strange-behavior-of-pseq-in/48411699#48411699", "title": "Always guaranteed evaluation order of `seq` (with strange behavior of `pseq` in addition)", "body": "<p>I only see such a difference with optimizations turned off.\nWith <code>ghc -O</code> both <code>pseq</code> and <code>seq</code> perform the same.</p>\n\n<p>The relaxed semantics of <code>seq</code> allow transformations resulting in slower code indeed. I can't think of a situation where that actually happens. We just assume GHC does the right thing. Unfortunately, we don't have a way to express that behavior in terms of a high-level semantics for Haskell.</p>\n\n<blockquote>\n  <p>Why pseq is slower?</p>\n</blockquote>\n\n<pre><code>pseq x y = x `seq` lazy y\n</code></pre>\n\n<p><code>pseq</code> is thus implemented using <code>seq</code>. The observed overhead is due to the extra indirection of calling <code>pseq</code>.</p>\n\n<p>Even if these ultimately get optimized away, it may not necessarily be a good idea to use <code>pseq</code> instead of <code>seq</code>. While the stricter ordering semantics seem to imply the intended effect (that <code>go</code> does not accumulate a thunk), it may disable some further optimizations: perhaps evaluating <code>x</code> and evaluating <code>y</code> can be decomposed into low-level operations, some of which we wouldn't mind to cross the <code>pseq</code> boundary.</p>\n\n<blockquote>\n  <p>Does there exist some example where seq a b has different results depending on evaluation order (same code but different compiler flags/different compilers/etc.)?</p>\n</blockquote>\n\n<p>This can throw either <code>\"a\"</code> or <code>\"b\"</code>. </p>\n\n<pre><code>seq (error \"a\") (error \"b\")\n</code></pre>\n\n<p>I guess there is a rationale explained in the paper about exceptions in Haskell, <a href=\"https://www.microsoft.com/en-us/research/publication/a-semantics-for-imprecise-exceptions/\" rel=\"nofollow noreferrer\"><em>A Semantics for imprecise exceptions</em></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516759488, "post_id": 48412705, "comment_id": 83817440, "body": "Side note: <code>NoImplicitPrelude</code> is not needed if you <code>import Prelude</code> yourself. It exists because only because <code>import Prelude()</code> still imports typeclass instances while hiding all the names."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516759707, "post_id": 48412705, "comment_id": 83817507, "body": "@HTNW Wow, I didn&#39;t know. I will fix the code in the answer shortly."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1516760024, "post_id": 48412705, "comment_id": 83817566, "body": "I see an issue with your method. If you&#39;re using <code>-fprof-auto</code>, you&#39;ll get cost centers in awkward places. These cost centers proceed to get in the way of optimization, because GHC avoids moving potential allocations between cost centers. Indeed, any of the functions <code>seq</code>, <code>pseq</code>, <code>lpseq</code>, <code>liseq</code>, or <code>flip const</code> in place of <code>seq</code> in <code>go</code> produces the same STG when I disable profiling."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516760617, "post_id": 48412705, "comment_id": 83817699, "body": "@HTNW (that is, they are identical when profiling is off and <code>-O2</code> is on)"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516760892, "post_id": 48412705, "comment_id": 83817750, "body": "@HTNW Oh no. You&#39;re right again. If I redo the profiling with cost centres manually placed before each of the RHS of the definition of <code>go</code>, do you think it will give more correct results?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1516760954, "post_id": 48412705, "comment_id": 83817762, "body": "I think it should."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1516770803, "post_id": 48412705, "comment_id": 83820137, "body": "@HTNW Unfortunately, it looks like the addition of any cost centres grossly skews the digits agains <code>pseq</code>. At the same time, the build of <code>pseq</code> without profiling performs on the level with <code>seq</code> even if no optimizations are enabled. So, I will have to remake my answer altogether..."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 3, "last_activity_date": 1516813075, "last_edit_date": 1516813075, "creation_date": 1516751237, "answer_id": 48412705, "question_id": 48410245, "link": "https://stackoverflow.com/questions/48410245/always-guaranteed-evaluation-order-of-seq-with-strange-behavior-of-pseq-in/48412705#48412705", "title": "Always guaranteed evaluation order of `seq` (with strange behavior of `pseq` in addition)", "body": "<p><strong>Edit:</strong> My theory foiled as the timings I observed were in fact heavily skewed by the influence of profiling itself; with profiling off, the data goes against the theory. Moreover, the timings vary quite a bit between versions of GHC. I am collecting better observations even now, and I will further edit this answer as I arrive to a conclusive point.</p>\n\n<hr>\n\n<p>Concerning the question \"why <code>pseq</code> is slower\", I have a theory.</p>\n\n<ol>\n<li><ul>\n<li>Let us re-phrase <code>acc' `seq` go acc' xs</code> as <code>strict (go (strict acc') xs)</code>. </li>\n<li>Similarly, <code>acc' `pseq` go acc' xs</code> is re-phrased as <code>lazy (go (strict acc') xs)</code>.</li>\n</ul></li>\n<li><ul>\n<li>Now, let us re-phrase <code>go acc (x:xs) = let ... in ...</code> to <code>go acc (x:xs) = strict (go (x + acc) xs)</code> in the case of <code>seq</code>.</li>\n<li>And to <code>go acc (x:xs) = lazy (go (x + acc) xs)</code> in the case of <code>pseq</code>.</li>\n</ul></li>\n</ol>\n\n<p>Now, it is easy to see that, in the case of <code>pseq</code>, <code>go</code> gets assigned a lazy thunk that will be evaluated at some later point. In the definition of <code>sum</code>,  <code>go</code> never appears to the left of <code>pseq</code>, and thus, during the run of <code>sum</code>, the evaulation will not at all be forced. Moreover, this happens for every recursive call of <code>go</code>, so thunks accumulate.</p>\n\n<p>This is a theory built from thin air, but I do have a partial proof. Specifically, I did find out that <code>go</code> allocates linear memory in <code>pseq</code> case but not in the case of <code>seq</code>. You may see for yourself if you run the following shell commands:</p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>for file in SumNaive.hs SumPseq.hs SumSeq.hs \ndo\n    stack ghc                \\\n        --library-profiling  \\\n        --package parallel   \\\n        --                   \\\n        $file                \\\n        -main-is ${file%.hs} \\\n        -o ${file%.hs}       \\\n        -prof                \\\n        -fprof-auto\ndone\n\nfor file in SumNaive.hs SumSeq.hs SumPseq.hs\ndo\n    time ./${file%.hs} +RTS -P\ndone\n</code></pre>\n\n<p>-- And compare the memory allocation of the <code>go</code> cost centre.</p>\n\n<pre><code>COST CENTRE             ...  ticks     bytes\nSumNaive.prof:sum.go    ...    782 559999984\nSumPseq.prof:sum.go     ...    669 800000016\nSumSeq.prof:sum.go      ...    161         0\n</code></pre>\n\n<hr>\n\n<p><em><strong>postscriptum</strong></em></p>\n\n<p>Since there appears to be discord on the question of which optimizations actually play to what effect, I am putting my exact source code and <code>time</code> measures, so that there is a common baseline.</p>\n\n<p><em>SumNaive.hs</em></p>\n\n<pre><code>module SumNaive where\n\nimport Prelude hiding (sum)\n\nsum :: Num a =&gt; [a] -&gt; a\nsum = go 0\n  where\n    go acc []     = acc\n    go acc (x:xs) = go (x + acc) xs\n\nmain = print $ sum [1..10^7]\n</code></pre>\n\n<p><em>SumSeq.hs</em></p>\n\n<pre><code>module SumSeq where\n\nimport Prelude hiding (sum)\n\nsum :: Num a =&gt; [a] -&gt; a\nsum = go 0\n  where\n    go acc []     = acc\n    go acc (x:xs) = let acc' = x + acc\n                    in acc' `seq` go acc' xs\n\nmain = print $ sum [1..10^7]\n</code></pre>\n\n<p><em>SumPseq.hs</em></p>\n\n<pre><code>module SumPseq where\n\nimport Prelude hiding (sum)\nimport Control.Parallel (pseq)\n\nsum :: Num a =&gt; [a] -&gt; a\nsum = go 0\n  where\n    go acc []     = acc\n    go acc (x:xs) = let acc' = x + acc\n                    in acc' `pseq` go acc' xs\n\nmain = print $ sum [1..10^7]\n</code></pre>\n\n<p>Time without optimizations:</p>\n\n<pre><code>./SumNaive +RTS -P  4.72s user 0.53s system 99% cpu 5.254 total\n./SumSeq +RTS -P  0.84s user 0.00s system 99% cpu 0.843 total\n./SumPseq +RTS -P  2.19s user 0.22s system 99% cpu 2.408 total\n</code></pre>\n\n<p>Time with <code>-O</code>:</p>\n\n<pre><code>./SumNaive +RTS -P  0.58s user 0.00s system 99% cpu 0.584 total\n./SumSeq +RTS -P  0.60s user 0.00s system 99% cpu 0.605 total\n./SumPseq +RTS -P  1.91s user 0.24s system 99% cpu 2.147 total\n</code></pre>\n\n<p>Time with <code>-O2</code>:</p>\n\n<pre><code>./SumNaive +RTS -P  0.57s user 0.00s system 99% cpu 0.570 total\n./SumSeq +RTS -P  0.61s user 0.01s system 99% cpu 0.621 total\n./SumPseq +RTS -P  1.92s user 0.22s system 99% cpu 2.137 total\n</code></pre>\n\n<p>It may be seen that:</p>\n\n<ul>\n<li><p>Naive variant has poor performance without optimizations, but excellent performance with either <code>-O</code> or <code>-O2</code> -- to the extent that it outperforms all others.</p></li>\n<li><p><code>seq</code> variant has a good performance that's very little improved by optimizations, so that with either <code>-O</code> or <code>-O2</code> the Naive variant outperforms it.</p></li>\n<li><p><code>pseq</code> variant has consistently poor performance, about twice better than Naive variant without optimization, and four times worse than others with either <code>-O</code> or <code>-O2</code>. Optimization affects it about as little as the <code>seq</code> variant.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 13, "last_activity_date": 1516819363, "last_edit_date": 1516819363, "creation_date": 1516816447, "answer_id": 48428785, "question_id": 48410245, "link": "https://stackoverflow.com/questions/48410245/always-guaranteed-evaluation-order-of-seq-with-strange-behavior-of-pseq-in/48428785#48428785", "title": "Always guaranteed evaluation order of `seq` (with strange behavior of `pseq` in addition)", "body": "<p>The answers so far have focused on the <code>seq</code> versus <code>pseq</code> performance issues, but I think you originally wanted to know which of the two you should use.</p>\n\n<p>The short answer is:  while both should generate nearly identically performing code in practice (at least when proper optimization flags are turned on), the primitive <code>seq</code>, and not <code>pseq</code>, is the correct choice for your situation.  Using <code>pseq</code> is non-idiomatic, confusing, and potentially counterproductive from a performance standpoint, and your reason for using it is based on a flawed understand of what its order-of-evaluation guarantee means and what it implies with respect to performance.  While there are no guarantees about performance across different sets of compiler flags (much less across other compilers), if you ever run into a situation where the <code>seq</code> version of the above code runs significantly slower than the <code>pseq</code> version using \"production quality\" optimization flags with the GHC compiler, you should consider it a GHC bug and file a bug report.</p>\n\n<p>The long answer is, of course, longer...</p>\n\n<p>First, let's be clear that <code>seq</code> and <code>pseq</code> are <em>semantically</em> identical in the sense that they both satisfy the equations:</p>\n\n<pre><code>seq _|_ b = _|_\nseq a b = b -- if a is not _|_\npseq _|_ b = _|_\npseq a b = b -- if a is not _|_\n</code></pre>\n\n<p>This is really the only thing that either of them guarantees semantically, and since the definition of the Haskell language (as given in the Haskell report say) only makes -- at best -- semantic guarantees and does not deal with performance or implementation, there's no reason to choose between one or the other for reasons of guaranteed performance across different compilers or compiler flags.</p>\n\n<p>Furthermore, in your particular <code>seq</code>-based version of the function <code>sum</code>, it's not too difficult to see that there is no situation in which <code>seq</code> is called with an undefined first argument but a defined second argument (assuming the use of a standard numeric type), so you aren't even <em>using</em> the semantic properties of <code>seq</code>.  You could re-define <code>seq</code> as <code>seq a b = b</code> and have exactly the same semantics.  Of course, you know this -- that's why your first version didn't use <code>seq</code>.  Instead, you're using <code>seq</code> for an incidental performance side-effect, so we're out of the realm of semantic guarantees and back in the realm of specific GHC compiler implementation and performance characteristics (where there aren't really any <em>guarantees</em> to speak of).</p>\n\n<p>Second, that brings us to the <strong>intended purpose</strong> of <code>seq</code>.  It is rarely used for its semantic properties because those properties aren't very useful.  Who would want a computation <code>seq a b</code> to return <code>b</code> <em>except</em> that it should fail to terminate if some unrelated expression <code>a</code> fails to terminate?  (The exceptions -- no pun intended -- would be things like handling exceptions, where you might use <code>seq</code> or <code>deepSeq</code> which is based on <code>seq</code> to force evaluation of a non-terminating expression in either an uncontrolled or controlled way, before starting evaluation of another expression.)</p>\n\n<p>Instead, <code>seq a b</code> is intended to force evaluation of <code>a</code> to weak head normal form before returning the result of <code>b</code> to prevent accumulation of thunks.  The idea is, if you have an expression <code>b</code> which builds a thunk that could potentially accumulate on top of another unevaluated thunk represented by <code>a</code>, you can prevent that accumulation by using <code>seq a b</code>.  The \"guarantee\" is a weak one:  GHC guarantees that it understands you don't want <code>a</code> to remain an unevaluated thunk when <code>seq a b</code>'s value is demanded.  Technically, it doesn't guarantee that <code>a</code> will be \"evaluated before\" <code>b</code>, whatever that means, but <em>you don't need that guarantee.</em>  When you worry that, without this guarantee, GHC might evaluate the recursive call first and still accumulate thunks, this is as ridiculous as worrying that <code>pseq a b</code> might evaluate its first argument, then wait 15 minutes (just to make absolutely sure the first argument has been evaluated!), before evaluating its second.</p>\n\n<p>This is a situation where you should trust GHC to do the right thing.  It may seem to you that the only way to realize the performance benefit of <code>seq a b</code> is for <code>a</code> to be evaluated to WHNF before evaluation of <code>b</code> starts, but it is conceivable that there are optimizations in this or other situations that technically start evaluating <code>b</code> (or even fully evaluate <code>b</code> to WHNF) while leaving <code>a</code> unevaluated for a short time to improve performance while still preserving the semantics of <code>seq a b</code>.  By using <code>pseq</code> instead, you may prevent GHC from making such optimizations.  (In your <code>sum</code> program situation, there undoubtedly is no such optimization, but in a more complex use of <code>seq</code>, there might be.)</p>\n\n<p>Third, it's important to understand what <code>pseq</code> is actually <em>for</em>.  It was first described in <a href=\"https://simonmar.github.io/bib/papers/multicore-ghc.pdf\" rel=\"noreferrer\">Marlow 2009</a> in the context of concurrent programming.  Suppose we want to parallelize two expensive computations <code>foo</code> and <code>bar</code> and then combine (say, add) their results:</p>\n\n<pre><code>foo `par` (bar `seq` foo+bar)  -- parens redundant but included for clarity\n</code></pre>\n\n<p>The intention here is that -- when this expression's value is demanded -- it creates a spark to compute <code>foo</code> in parallel and then, via the <code>seq</code> expression, starts evaluating <code>bar</code> to WHNF (i.e., it's numeric value, say) before finally evaluating <code>foo+bar</code> which will wait on the spark for <code>foo</code> before adding and returning the results.</p>\n\n<p>Here, it's conceivable that GHC will recognize that for a specific numeric type, (1) <code>foo+bar</code> automatically fails to terminate if <code>bar</code> does, satisfying the formal semantic guarantee of <code>seq</code>; and (2) evaluating <code>foo+bar</code> to WHNF will automatically force evaluation of <code>bar</code> to WHNF preventing any thunk accumulation and so satisfying the informal implementation guarantee of <code>seq</code>.  In this situation, GHC may feel free to optimize the <code>seq</code> away to yield:</p>\n\n<pre><code>foo `par` foo+bar\n</code></pre>\n\n<p>particularly if it feels that it would be more performant to start evaluation of <code>foo+bar</code> before finishing evaluating <code>bar</code> to WHNF.</p>\n\n<p>What GHC isn't smart enough to realize is that -- if evaluation of <code>foo</code> in <code>foo+bar</code> starts before the <code>foo</code> spark is scheduled, the spark will fizzle, and no parallel execution will occur.</p>\n\n<p>It's really only in this case, where you need to explicitly delay demanding the value of a sparked expression to allow an opportunity for it to be scheduled before the main thread \"catches up\" that you need the extra guarantee of <code>pseq</code> and are willing to have GHC forgo additional optimization opportunities permitted by the weaker guarantee of <code>seq</code>:</p>\n\n<pre><code>foo `par` (bar `pseq` foo+bar)\n</code></pre>\n\n<p>Here, <code>pseq</code> will prevent GHC from introducing any optimization that might allow <code>foo+bar</code> to start evaluating (potentially fizzling the <code>foo</code> spark) before <code>bar</code> is in WHNF (which, we hope, allows enough time for the spark to be scheduled).</p>\n\n<p>The upshot is that, if you're using <code>pseq</code> for anything other than concurrent programming, you're using it wrong.  (Well, maybe there are some weird situations, but...)  If all you want to do is force strict evaluation and/or thunk evaluation to improve performance in non-concurrent code, using <code>seq</code> (or <code>$!</code> which is defined in terms of <code>seq</code> or Haskell strict data types which are defined in terms of <code>$!</code>) is the correct approach.</p>\n\n<p>(Or, if @Kindaro's benchmarks are to be believed, maybe merciless benchmarking with specific compiler versions and flags is the correct approach.)</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 3, "accepted_answer_id": 48428785, "answer_count": 3, "score": 19, "last_activity_date": 1516842666, "creation_date": 1516739283, "last_edit_date": 1516842666, "question_id": 48410245, "link": "https://stackoverflow.com/questions/48410245/always-guaranteed-evaluation-order-of-seq-with-strange-behavior-of-pseq-in", "title": "Always guaranteed evaluation order of `seq` (with strange behavior of `pseq` in addition)", "body": "<p>The documentation of <code>seq</code> function says the following:</p>\n\n<blockquote>\n  <p>A note on evaluation order: the expression <code>seq a b</code> does not guarantee that <code>a</code> will be evaluated before <code>b</code>. The only guarantee given by <code>seq</code> is that the both <code>a</code> and <code>b</code> will be evaluated before <code>seq</code> returns a value. In particular, this means that <code>b</code> may be evaluated before <code>a</code>. If you need to guarantee a specific order of evaluation, you must use the function <code>pseq</code> from the \"parallel\" package.</p>\n</blockquote>\n\n<p>So I have a lazy version of <code>sum</code> function with accumulator:</p>\n\n<pre><code>sum :: Num a =&gt; [a] -&gt; a\nsum = go 0\n  where\n    go acc []     = acc\n    go acc (x:xs) = go (x + acc) xs\n</code></pre>\n\n<p>Obviously, this is extremely slow on big lists. Now I'm rewriting this function using <code>seq</code>:</p>\n\n<pre><code>sum :: Num a =&gt; [a] -&gt; a\nsum = go 0\n  where\n    go acc []     = acc\n    go acc (x:xs) = let acc' = x + acc\n                    in acc' `seq` go acc' xs\n</code></pre>\n\n<p>And I see huge performance increase! But I wonder how reliable it is? Did I get it by luck? Because GHC can evaluate recursive call first (according to documentation) and still accumulate thunks. It looks like I need to use <code>pseq</code> to ensure that <code>acc'</code> is always evaluated before recursive call. But with <code>pseq</code> I see performance decrease in compare to <code>seq</code> version. Numbers on my machine (for calculating <code>sum [1 .. 10^7]</code>:</p>\n\n<ul>\n<li>naive: <code>2.6s</code></li>\n<li><code>seq</code>: <code>0.2s</code></li>\n<li><code>pseq</code>: <code>0.5s</code></li>\n</ul>\n\n<p>I'm using GHC-8.2.2 and I compile with <code>stack ghc -- File.hs</code> command.</p>\n\n<p>After I tried to compile with <code>stack ghc -- -O File.hs</code> command performance gap between <code>seq</code> and <code>pseq</code> is gone. They now both run in <code>0.2s</code>.</p>\n\n<p>So does my implementation exhibit the properties I want? Or does GHC has some implementation quirk? Why is <code>pseq</code> slower? Does there exist some example where <code>seq a b</code> has different results depending on evaluation order (same code but different compiler flags/different compilers/etc.)?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1516740943, "post_id": 48410172, "comment_id": 83810967, "body": "How have you amended the <code>make</code> function to fit the new type? Removed its first parameter; left the parameter in but never use it; or something else?"}, {"owner": {"reputation": 521, "user_id": 1683138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/eb95ffc417ea1a8f577d12bbad58a29d?s=128&d=identicon&r=PG", "display_name": "roman-kashitsyn", "link": "https://stackoverflow.com/users/1683138/roman-kashitsyn"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1516741007, "post_id": 48410172, "comment_id": 83811006, "body": "Yes, I have just removed the first parameter."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1516742311, "post_id": 48410172, "comment_id": 83811661, "body": "Are you sure you are actually creating the trees? Maybe laziness kicked in and removed <i>all</i> of your computations."}, {"owner": {"reputation": 521, "user_id": 1683138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/eb95ffc417ea1a8f577d12bbad58a29d?s=128&d=identicon&r=PG", "display_name": "roman-kashitsyn", "link": "https://stackoverflow.com/users/1683138/roman-kashitsyn"}, "edited": false, "score": 0, "creation_date": 1516744805, "post_id": 48410172, "comment_id": 83812802, "body": "Well, the program outputs the correct result, and the tree slots are marked as strict. If I make them lazy, the program actually becomes significantly slower and allocates much more memory (the &quot;total memory in use&quot; is still low though)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1516745248, "post_id": 48410172, "comment_id": 83812991, "body": "It seems likely you are benefitting from the same or similar optimization that makes static allocations for enumerations and just points to the (shared, static) value for any given nullary constructor."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1516814695, "post_id": 48410172, "comment_id": 83846992, "body": "Having looked at the code, I think you&#39;ve found one of the rare points where GHC will do common subexpression elimination on non-primitive types, and it pays off.  You&#39;re using linear space in the size of a tree instead of exponential, because <code>make</code> uses the same child element for both sides.  This benchmark looks like it was designed explicitly to punish purity and optimization."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1516833882, "post_id": 48431890, "comment_id": 83857145, "body": "The way to know for sure if you&#39;re seeing CSE would be to look at the optimised Core. Compile with <code>-ddump-simpl</code> to get at it"}], "tags": [], "owner": {"reputation": 521, "user_id": 1683138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/eb95ffc417ea1a8f577d12bbad58a29d?s=128&d=identicon&r=PG", "display_name": "roman-kashitsyn", "link": "https://stackoverflow.com/users/1683138/roman-kashitsyn"}, "is_accepted": false, "score": 3, "last_activity_date": 1516829307, "creation_date": 1516829307, "answer_id": 48431890, "question_id": 48410172, "link": "https://stackoverflow.com/questions/48410172/ghc-optimizes-allocations-away/48431890#48431890", "title": "GHC optimizes allocations away", "body": "<p>I believe the sudden memory usage drop caused by the <a href=\"https://wiki.haskell.org/GHC_optimisations#Common_subexpression_elimination\" rel=\"nofollow noreferrer\">Common Sub-expression Elimination</a> optimization. The original code was:</p>\n\n<pre><code>make i d = Node i (make d d2) (make d2 d2)\n--                      ^           ^\n--                      |           d2 != d\n--                      d != d2\n</code></pre>\n\n<p>Since expressions constructing the left and the right subtrees are different, the compiler is not able eliminate any allocations.</p>\n\n<p>If I remove the unused integer, the code looks like this</p>\n\n<pre><code>make d = Node (make (d - 1)) (make (d - 1))\n--            ^              ^\n--            |              |\n--            `--------------`----- identical\n</code></pre>\n\n<p>If I add the <code>-fno-cse</code> flag to GHC, the memory allocation is as high as expected, but the code is rather slow. I couldn't find a way to suppress this optimization locally so I decided to \"outsmart\" the compiler by adding extra unused arguments:</p>\n\n<pre><code>make' :: Int -&gt; Int -&gt; Tree\nmake' _  0 = Node Nil Nil\nmake' !n d = Node (make' (n - 1) (d - 1)) (make' (n + 1) (d - 1))\n</code></pre>\n\n<p>The trick worked, the memory usage dropped by expected 30%. But I wish there was a nicer way to tell the compiler what I want.</p>\n\n<p>Thanks to @Carl for mentioning the CSE optimization.</p>\n"}], "owner": {"reputation": 521, "user_id": 1683138, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/eb95ffc417ea1a8f577d12bbad58a29d?s=128&d=identicon&r=PG", "display_name": "roman-kashitsyn", "link": "https://stackoverflow.com/users/1683138/roman-kashitsyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1516829307, "creation_date": 1516738961, "question_id": 48410172, "link": "https://stackoverflow.com/questions/48410172/ghc-optimizes-allocations-away", "title": "GHC optimizes allocations away", "body": "<p>I'm trying to improve performance of <a href=\"http://benchmarksgame.alioth.debian.org/u64q/program.php?test=binarytrees&amp;lang=ghc&amp;id=5\" rel=\"nofollow noreferrer\">this binary-trees benchmark</a> from <a href=\"http://benchmarksgame.alioth.debian.org/u64q/haskell.html\" rel=\"nofollow noreferrer\">The Computer Language Benchmark Game</a>. The idea is to build lots of binary trees to benchmark memory allocation. The Tree data definition looks like this:</p>\n\n<pre><code>data Tree = Nil | Node !Int !Tree !Tree\n</code></pre>\n\n<p>According to the problem statement, there's no need to store an <code>Int</code> in every node and other languages <a href=\"http://benchmarksgame.alioth.debian.org/u64q/program.php?test=binarytrees&amp;lang=ocaml&amp;id=2\" rel=\"nofollow noreferrer\">don't have it</a>.</p>\n\n<p>I use GHC 8.2.2 and get the following RTS report when run the original code:</p>\n\n<pre><code>stack --resolver lts-10.3 --compiler ghc-8.2.2 ghc -- --make -O2 -threaded -rtsopts -funbox-strict-fields -XBangPatterns -fllvm -pgmlo opt-3.9 -pgmlc llc-3.9 binarytrees.hs -o binarytrees.ghc_run\n./binarytrees.ghc_run +RTS -N4 -sstderr -K128M -H  -RTS 21\n...\n      19,551,302,672 bytes allocated in the heap\n       7,291,702,272 bytes copied during GC\n         255,946,744 bytes maximum residency (18 sample(s))\n             233,480 bytes maximum slop\n         635 MB total memory in use (0 MB lost due to fragmentation)\n...\nTotal   time   58.620s  ( 39.281s elapsed)\n</code></pre>\n\n<p>So far so good. Let's remove this Int, which is actually never used. The definition becomes</p>\n\n<pre><code>data Tree = Nil | Node !Tree !Tree\n</code></pre>\n\n<p>In theory we are going to save about 25% of total memory (3 integers in every node instead of 4). Let's try it:</p>\n\n<pre><code> ...\n 313,388,960 bytes allocated in the heap\n     640,488 bytes copied during GC\n      90,016 bytes maximum residency (2 sample(s))\n      57,872 bytes maximum slop\n           5 MB total memory in use (0 MB lost due to fragmentation)\n ...\n Total   time    9.596s  (  9.621s elapsed)\n</code></pre>\n\n<p>5MB total memory in use and almost zero GC? Why? Where did all the allocations go?</p>\n"}, {"tags": ["scala", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 30038, "user_id": 16673, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2bd7c0e93b52c224e284d18ac34752b8?s=128&d=identicon&r=PG", "display_name": "Suma", "link": "https://stackoverflow.com/users/16673/suma"}, "is_accepted": false, "score": 2, "last_activity_date": 1516734386, "last_edit_date": 1516734386, "creation_date": 1516733316, "answer_id": 48408795, "question_id": 48408707, "link": "https://stackoverflow.com/questions/48408707/scala-equivalent-to-haskell-pattern-matching-on-constructors/48408795#48408795", "title": "Scala equivalent to Haskell pattern Matching on constructors", "body": "<p>The types you have created are <a href=\"http://danielwestheide.com/blog/2013/02/13/the-neophytes-guide-to-scala-part-13-path-dependent-types.html\" rel=\"nofollow noreferrer\">path dependent</a>. Change the type declaration to this:</p>\n\n<pre><code>trait Function\n\nobject Function {\n  case class Const(value: Double) extends Function\n  case class Param(value: String) extends Function\n  case class Var(value: String) extends Function\n  case class Add(f1: Function, f2: Function) extends Function\n}\n\nimport Function._\n</code></pre>\n\n<p>With your original defintion the <code>Const</code> need to be created inside of the same <code>Function</code> object to match. You are matching inside of <code>Op</code>, but the <code>Const</code> you are matching are created inside of <code>HelloWorld</code>, therefore you are matching <code>HelloWorld.Const</code> againt <code>Op.Const</code>.</p>\n\n<p>Is there any reason why <code>Op</code> and <code>HelloWorld</code> are derived from the <code>Function</code> trait? (You do not use this in your example, but perhaps you have some reason out of that). Following would look more natural to me:</p>\n\n<pre><code>object HelloWorld {\n  def som(f1:Function, f2: Function): Function  = {\n    (f1, f2) match {\n      case (Const(a), Const(b)) =&gt; Const(a + b)\n      case _ =&gt; Add(f1, f2)\n    }\n  }\n\n  def main(args: Array[String]): Unit = {\n    val s =  som(Const(3),Const(5))\n    println(s)\n  }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 1, "last_activity_date": 1516734014, "creation_date": 1516734014, "answer_id": 48408960, "question_id": 48408707, "link": "https://stackoverflow.com/questions/48408707/scala-equivalent-to-haskell-pattern-matching-on-constructors/48408960#48408960", "title": "Scala equivalent to Haskell pattern Matching on constructors", "body": "<p>To define this piece of <code>Haskell</code> in <code>Scala</code>:</p>\n\n<pre><code>data Fonction =\nConst Float\n    | Param String\n    | Var String\n    | Add Fonction Fonction\n</code></pre>\n\n<p>I'd proceed as follows:</p>\n\n<pre><code>trait Function\n\ncase class Const(v: Float) extends Function\ncase class Param(v: String) extends Function\ncase class Var(v: String) extends Function\ncase class Add(f1: Function, f2: Function) extends Function\n</code></pre>\n\n<p>And now your code will work as expected:</p>\n\n<pre><code>scala&gt; HelloWorld.main(Array())\nConst(8.0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94, "user_id": 9258411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/klmDD.jpg?s=128&g=1", "display_name": "gee", "link": "https://stackoverflow.com/users/9258411/gee"}, "edited": false, "score": 0, "creation_date": 1516816554, "post_id": 48409461, "comment_id": 83848093, "body": "Thanks a lot. Interesting. I got a strange warning though :      <code>defined object Function     warning: previously defined trait Function is not a companion to object Function.     Companions must be defined together; you may wish to use :paste mode for this.</code>"}, {"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "reply_to_user": {"reputation": 94, "user_id": 9258411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/klmDD.jpg?s=128&g=1", "display_name": "gee", "link": "https://stackoverflow.com/users/9258411/gee"}, "edited": false, "score": 0, "creation_date": 1516821098, "post_id": 48409461, "comment_id": 83850461, "body": "@user9258411, You should put <code>object Function</code> and <code>sealed trait Function</code> in the same file and in the same package. In other words they should be a part of the same &quot;compilation unit&quot;. I&#39;m not sure what happens in REPL. Probably you should define both in a single input action and that&#39;s probably yhy <code>:paste</code> is suggested to you."}, {"owner": {"reputation": 94, "user_id": 9258411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/klmDD.jpg?s=128&g=1", "display_name": "gee", "link": "https://stackoverflow.com/users/9258411/gee"}, "edited": false, "score": 0, "creation_date": 1516832440, "post_id": 48409461, "comment_id": 83856478, "body": "Yes I got this only in the REPL. Thanks"}, {"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "reply_to_user": {"reputation": 94, "user_id": 9258411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/klmDD.jpg?s=128&g=1", "display_name": "gee", "link": "https://stackoverflow.com/users/9258411/gee"}, "edited": false, "score": 0, "creation_date": 1516835594, "post_id": 48409461, "comment_id": 83857778, "body": "@user9258411, if some answer helped you (and this doesn&#39;t have to be the most upvoted one i.e. not necessary mine in this question), you should mark that answer as Accepted."}], "tags": [], "owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "is_accepted": true, "score": 3, "last_activity_date": 1516736469, "last_edit_date": 1516736469, "creation_date": 1516735950, "answer_id": 48409461, "question_id": 48408707, "link": "https://stackoverflow.com/questions/48408707/scala-equivalent-to-haskell-pattern-matching-on-constructors/48409461#48409461", "title": "Scala equivalent to Haskell pattern Matching on constructors", "body": "<p>Although @nicodp code is technically correct (but IMHO not quite), it provides no explanation. The reason why your code doesn't work as expect is because you define your cases inside <code>trait Function</code>. The thing is that in the Java world <a href=\"https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html\" rel=\"nofollow noreferrer\">inner classes can be static and non-static</a> and Scala copies this part of the behavior. And classes defined inside a <code>trait</code> are non-static. Particularly it means that an instance of <code>HelloWorld.Const(42)</code> is not equal to an instance of <code>Op.Const(42)</code> because they capture different \"outer\" values of different types (the <code>Op</code> object and the <code>HelloWorld</code> object). And this is also why your pattern matching doesn't work as you might expect. If you make you write your pattern matching as:</p>\n\n<pre><code>object Op extends Function {\n  def som(f1: Function, f2: Function): Function =\n    (f1, f2) match {\n      // this doesn't work\n      //case (Const(a), Const(b)) =&gt; Const(a + b) \n      // this works\n      case (HelloWorld.Const(a), HelloWorld.Const(b)) =&gt; Const(a + b)\n      case _ =&gt; Add(f1, f2)\n    }\n}\n</code></pre>\n\n<p>it will work but this is probably not what you want. The way to work this around is to define your <code>case class</code>es in a static context. You may do it in just top level as in @nicodp suggested. Another choice is to put them into a <code>Function</code> a <a href=\"https://docs.scala-lang.org/tour/singleton-objects.html\" rel=\"nofollow noreferrer\">companion object</a> like this:</p>\n\n<pre><code>sealed trait Function \n\nobject Function {\n  case class Const(value: Double) extends Function\n  case class Param(value: String) extends Function\n  case class Var(value: String) extends Function\n  case class Add(f1: Function, f2: Function) extends Function\n}\n\nobject Op {\n\n  import Function._\n\n  def som(f1: Function, f2: Function): Function =\n    (f1, f2) match {\n      //          case (HelloWorld.Const(a), HelloWorld.Const(b)) =&gt; Const(a + b)\n      case (Const(a), Const(b)) =&gt; Const(a + b)\n      case _ =&gt; Add(f1, f2)\n    }\n}\n\nobject HelloWorld {\n  import Function._\n\n  def main(args: Array[String]): Unit = {\n    val s = Op.som(Const(3), Const(5))\n    println(s)\n  }\n}\n</code></pre>\n\n<p>Note that you replace <code>extends Function</code> with <code>import Function._</code></p>\n\n<p>Also note that it is suggested to use <code>sealed</code> on such traits so you (compiler) know your pattern-matching is exhaustive.</p>\n"}], "owner": {"reputation": 94, "user_id": 9258411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/klmDD.jpg?s=128&g=1", "display_name": "gee", "link": "https://stackoverflow.com/users/9258411/gee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 48409461, "answer_count": 3, "score": 0, "last_activity_date": 1516736469, "creation_date": 1516732959, "question_id": 48408707, "link": "https://stackoverflow.com/questions/48408707/scala-equivalent-to-haskell-pattern-matching-on-constructors", "title": "Scala equivalent to Haskell pattern Matching on constructors", "body": "<p>In Haskell I have got constructors defined like this :</p>\n\n<pre><code>data Fonction =\nConst Float\n    | Param String\n    | Var String\n    | Add Fonction Fonction\n\ninfix 3 @+\n\n(@+) :: Fonction -&gt; Fonction -&gt; Fonction\n(@+) (Const k) (Const k') = Const (k + k')\n</code></pre>\n\n<p>In Scala, quite new for me,  I tried :</p>\n\n<pre><code>trait Function {\n  case class Const(value: Double) extends Function\n  case class Param(value: String) extends Function\n  case class Var(value: String) extends Function\n  case class Add(f1: Function, f2: Function) extends Function\n}\n\nobject Op extends Function {\n   def som(f1:Function, f2: Function): Function  = \n    (f1, f2) match {\n       case (Const(a),Const(b)) =&gt; Const(a + b)\n       case _  =&gt; Add(f1,f2)\n   }  \n}\n\nobject HelloWorld extends Function {\n  def main(args: Array[String]): Unit = {\n    val s =  Op.som(Const(3),Const(5))\n    println(s)\n   }\n}\n</code></pre>\n\n<p>but the pattern (Const(3), Const(5)) isn't matched since I get <code>Add(Const(3.0),Const(5.0))</code></p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516721474, "post_id": 48405328, "comment_id": 83799270, "body": "Well the error is self-explaining. You write in your guard <code>a &amp;&amp; b &amp;&amp; ...</code>, but <code>a</code> is (according to your definition) an <code>Int</code>, and this is not a correct type of operand for <code>&amp;&amp;</code>."}, {"owner": {"reputation": 1364, "user_id": 4848006, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/uFXUI.jpg?s=128&g=1", "display_name": "Neji Soltani", "link": "https://stackoverflow.com/users/4848006/neji-soltani"}, "edited": false, "score": 0, "creation_date": 1516721526, "post_id": 48405328, "comment_id": 83799316, "body": "try to explain what you need exactly in order to get the adequate answer"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1516721985, "post_id": 48405328, "comment_id": 83799677, "body": "The <code>&amp;&amp;</code> doesn&#39;t distribute the <code>&gt;= m</code> across to the other values. You have to be explicit <code>a &gt;= m &amp;&amp; b &gt;= m &amp;&amp; c &gt;= m</code>. Also, don&#39;t forget to divide <code>m</code> by <code>3</code> to get the average instead of just the sum."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 6906708, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/255c8ebf12a91c14bf842d51d19bbb20?s=128&d=identicon&r=PG&f=1", "display_name": "thecodesalim", "link": "https://stackoverflow.com/users/6906708/thecodesalim"}, "edited": false, "score": 0, "creation_date": 1516722056, "post_id": 48405400, "comment_id": 83799731, "body": "I understand now, Thanks"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1516722260, "last_edit_date": 1516722260, "creation_date": 1516721546, "answer_id": 48405400, "question_id": 48405328, "link": "https://stackoverflow.com/questions/48405328/couldnt-match-expected-type-bool-with-actual-type-int/48405400#48405400", "title": "Couldn&#39;t match expected type \u2018Bool\u2019 with actual type \u2018Int\u2019", "body": "<p>The <code>&amp;&amp;</code> operator has type <code>Bool -&gt; Bool -&gt; Bool</code>. This means that both operands have to be <code>Bool</code> and the result is also a <code>Bool</code>.</p>\n\n<p>So for example, in the expression <code>a &amp;&amp; b &gt;= m</code>, the right operand (<code>b &gt;= m</code>) is a <code>Bool</code>, but the left operand (<code>a</code>) is not - it's an <code>Int</code>.</p>\n\n<p>So that's why you get an error: the left operand needs to be a <code>Bool</code>, too.</p>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1516726137, "post_id": 48405644, "comment_id": 83802599, "body": "Really like that <code>&lt;pre&gt;&lt;code&gt;...&lt;&#47;code&gt;&lt;&#47;pre&gt;</code> trick for using html to highlight code, totally stealing it."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1516722822, "last_edit_date": 1516722822, "creation_date": 1516722342, "answer_id": 48405644, "question_id": 48405328, "link": "https://stackoverflow.com/questions/48405328/couldnt-match-expected-type-bool-with-actual-type-int/48405644#48405644", "title": "Couldn&#39;t match expected type \u2018Bool\u2019 with actual type \u2018Int\u2019", "body": "<p>You write in your code:</p>\n\n<pre><code>howManyAboveAverage :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAboveAverage a b c\n          <b>| a && b && c &gt;= m = 3</b>\n          | a && b &gt;= m = 2\n          | b && c &gt;= m = 2\n          | a && c &gt;= m = 2\n          | a || b || c &gt;= m = 1\n          | otherwise = 0\n          where m = a + b + c</code></pre>\n\n<p>I here put one case in boldface, but the error applies to all of them. You write as a condition <code>a &amp;&amp; b &amp;&amp; c &gt;= m</code>. For Haskell this means that you write it like <code>a &amp;&amp; b &amp;&amp; (c &gt;= m)</code>. Now <code>(&amp;&amp;)</code> is an operator that takes two booleans as operands, and calculates the logical and of these two. But the operands are no booleans. <code>c &gt;= m</code> is a boolean, but <code>a</code> and <code>b</code> are no booleans.</p>\n\n<p>So we have to write the condition on all operands like:</p>\n\n<pre><code>howManyAboveAverage :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAboveAverage a b c\n          | a <b>&gt;= m</b> && b <b>&gt;= m</b> && c &gt;= m = 3\n          | a <b>&gt;= m</b> && b &gt;= m = 2\n          | b <b>&gt;= m</b> && c &gt;= m = 2\n          | a <b>&gt;= m</b> && c &gt;= m = 2\n          | a <b>&gt;= m</b> || b <b>&gt;= m</b> || c &gt;= m = 1\n          | otherwise = 0\n          where m = a + b + c</code></pre>\n\n<p>So now we have booleans, and the program will compile, but it is still semantically incorect. The average is the sum of the elements <em>divided by the number of elements</em>. Here the number of elements is 3, so we should divide it by three. Since dividing a number can lead to numerical errors, and would mean we have to work in the <em>floating point world</em>, it is safer to multiply the element with which we compare with three instead, so:</p>\n\n<pre><code>howManyAboveAverage :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAboveAverage a b c\n          | <b>a3</b> &gt;= m  && <b>b3</b> &gt;= m  && <b>c3</b> &gt;= m = 3\n          | <b>a3</b> &gt;= m  && <b>b3</b> &gt;= m = 2\n          | <b>b3</b> &gt;= m  && <b>c3</b> &gt;= m = 2\n          | <b>a3</b> &gt;= m  && <b>c3</b> &gt;= m = 2\n          | <b>a3</b> &gt;= m  || <b>b3</b> &gt;= m  || <b>c3</b> &gt;= m = 1\n          | otherwise = 0\n          where m = a + b + c\n                <b>a3 = 3 * a</b>\n                <b>b3 = 3 * b</b>\n                <b>c3 = 3 * c</b></code></pre>\n\n<p>Now it works, but still it is not elegant: it requires five guards to check the number of conditions, and a total of twelve comparisons. This would thus be rather inefficient.</p>\n\n<p>A better idea is probably to convert <code>True</code> to <code>1</code> and <code>False</code> to <code>0</code>, we can do this with the <code>bool</code> <em>catamorphism</em> function: <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Bool.html#v:bool\" rel=\"noreferrer\"><strong><code>bool :: a -&gt; a -&gt; Bool -&gt; a</code></strong></a>. If we construct it like <code>bool 0 1</code> then we have a function that converts <code>False</code> to <code>0</code>, and <code>True</code> to <code>1</code>, we can then write it like:</p>\n\n<pre><code><b>import Data.Bool(bool)</b>\n\nhowManyAboveAverage :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAboveAverage a b c = <b>booltoint (3*a &gt;= m)\n                          + booltoint (3*b &gt;= m)\n                          + booltoint (3*c &gt;= m)</b>\n          where m = a + b + c\n                <b>booltoint = bool 0 1</b></code></pre>\n\n<p>It can further be improved, but I leave this as an exercise.</p>\n"}], "owner": {"reputation": 95, "user_id": 6906708, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/255c8ebf12a91c14bf842d51d19bbb20?s=128&d=identicon&r=PG&f=1", "display_name": "thecodesalim", "link": "https://stackoverflow.com/users/6906708/thecodesalim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2756, "favorite_count": 0, "accepted_answer_id": 48405644, "answer_count": 2, "score": 0, "last_activity_date": 1516722822, "creation_date": 1516721376, "question_id": 48405328, "link": "https://stackoverflow.com/questions/48405328/couldnt-match-expected-type-bool-with-actual-type-int", "title": "Couldn&#39;t match expected type \u2018Bool\u2019 with actual type \u2018Int\u2019", "body": "<pre><code>howManyAboveAverage :: Int -&gt; Int -&gt; Int -&gt; Int\nhowManyAboveAverage a b c\n          | a &amp;&amp; b &amp;&amp; c &gt;= m = 3\n          | a &amp;&amp; b &gt;= m = 2\n          | b &amp;&amp; c &gt;= m = 2\n          | a &amp;&amp; c &gt;= m = 2\n          | a || b || c &gt;= m = 1\n          | otherwise = 0\n          where m = a + b + c\n</code></pre>\n\n<p>please why isnt this code running, I'm getting alot of errors i dont understand</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "cumulative-sum"], "comments": [{"owner": {"reputation": 4881, "user_id": 947526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/6a84b61e353299d7f9306e99bfce8854?s=128&d=identicon&r=PG", "display_name": "C-Otto", "link": "https://stackoverflow.com/users/947526/c-otto"}, "edited": false, "score": 0, "creation_date": 1516709637, "post_id": 48401445, "comment_id": 83790824, "body": "I suggest you write it yourself. Did you try that?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1516709654, "post_id": 48401445, "comment_id": 83790839, "body": "What was it that you tried with <code>scanl</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1516709827, "post_id": 48401445, "comment_id": 83790963, "body": "<code>scanl</code> (or <code>scanl1</code>) seems the right tool for this job. I&#39;d suggest to insist on that route."}], "answers": [{"comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1516712086, "post_id": 48401553, "comment_id": 83792557, "body": "What do you think of something like: <code>cumulativeAmount&#39; = map sum . tail . inits</code>? Would you consider this to be pretty inefficient?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 1, "creation_date": 1516712294, "post_id": 48401553, "comment_id": 83792697, "body": "@RoadRunner: yeah, since the time complexity is O(n^2), not O(n)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1516709861, "creation_date": 1516709861, "answer_id": 48401553, "question_id": 48401445, "link": "https://stackoverflow.com/questions/48401445/haskell-sums-accumulated-in-lists/48401553#48401553", "title": "Haskell -- Sums Accumulated in Lists", "body": "<p>This is exactly the purpose of <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:scanl1\" rel=\"noreferrer\"><strong><code>scanl1 :: (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]</code></strong></a>:</p>\n\n<pre><code>Prelude&gt; scanl1 (+) [1,2,5,8,8,0,4,2]\n[1,3,8,16,24,24,28,30]\n</code></pre>\n\n<p><code>scanl1</code> takes as input a function <code>f :: a -&gt; a -&gt; a</code> (here <code>(+)</code>), and a list of <code>a</code>s. It constructs a list where the first item is the first item of the list. This is the first value of the <em>accumulator</em>. Then for every value, the accumulator is updated by calling <code>f</code> with the accumulator and the next value of the list, this item is then yielded.</p>\n\n<p>So in case of <code>scal1 (+) [1,2,5]</code> the first item we emit is <code>1</code>, we also set the accumulator to <code>1</code>. The next item is <code>2</code>, so we call <code>(+) 1 2</code> (which is <code>3</code>) and this is the result and the new accumulator, next we call <code>(+) ((+) 1 2) 5</code> (which is <code>8</code>), etc.</p>\n\n<p>But I think it is better, as an exercise to use recursion. Like said before we use an accumulator. We can implement this by introducing an extra function where the accumulator is a function we pass through the recursive calls (and update). So in that case it looks like:</p>\n\n<pre><code>cumulativeAmount :: [Integer] -&gt; [Integer]\ncumulativeAmount [] = ...\ncumulativeAmount (x:xs) = go x xs\n    where go x xs = ...\n</code></pre>\n\n<p>so here the first argument of <code>go</code> (<code>x</code>) is the accumulator. I leave it as an exercise to implement it with recursion.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1516710026, "post_id": 48401578, "comment_id": 83791093, "body": "This is actually quite inefficient: since it means that calculating the <i>i</i>-th item, will not reduce the cost of calculating the <i>i+1</i>-th item. Furthermore it uses <code>length</code> which means we first will calculate <code>xs</code>, this can again be troublesome since it can blow up memory, and it is possible that the list has infinite length."}, {"owner": {"reputation": 247, "user_id": 9064464, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aahL1.jpg?s=128&g=1", "display_name": "SindreKjr", "link": "https://stackoverflow.com/users/9064464/sindrekjr"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516710123, "post_id": 48401578, "comment_id": 83791172, "body": "Makes sense. I didn&#39;t actually test the code or think much about the efficiency; I just brought to bear the first solution that I could think of. From other comments, looks like scanl is what one should use."}], "tags": [], "owner": {"reputation": 247, "user_id": 9064464, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aahL1.jpg?s=128&g=1", "display_name": "SindreKjr", "link": "https://stackoverflow.com/users/9064464/sindrekjr"}, "is_accepted": false, "score": 3, "last_activity_date": 1516798239, "last_edit_date": 1516798239, "creation_date": 1516709924, "answer_id": 48401578, "question_id": 48401445, "link": "https://stackoverflow.com/questions/48401445/haskell-sums-accumulated-in-lists/48401578#48401578", "title": "Haskell -- Sums Accumulated in Lists", "body": "<p>Off the top of my head, you could solve this with a list comprehension, like so: </p>\n\n<pre><code>cumulativeAmount xs = [ sum $ take x xs | x &lt;- [1..length xs] ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 4, "last_activity_date": 1516712021, "last_edit_date": 1516712021, "creation_date": 1516710258, "answer_id": 48401686, "question_id": 48401445, "link": "https://stackoverflow.com/questions/48401445/haskell-sums-accumulated-in-lists/48401686#48401686", "title": "Haskell -- Sums Accumulated in Lists", "body": "<p>What about using an accumulator:</p>\n\n<pre><code>cumulativeAmount :: (Num a) =&gt; [a] -&gt; [a]\ncumulativeAmount xs = go xs 0\n    where go [] acc = []\n          go (x:xs) acc = (acc+x) : go xs (acc+x)\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; cumulativeAmount [1,2,5,8,8,0,4,2]\n[1,3,8,16,24,24,28,30]\n</code></pre>\n\n<p>The above code keeps a state variable <code>acc</code> to accumulate sums whenever a new number is encountered, and adds the new sum to the resulting list.  </p>\n\n<p>Now a good exercise would be to replace the above code with higher order functions. </p>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 1, "accepted_answer_id": 48401553, "answer_count": 3, "score": 3, "last_activity_date": 1516798239, "creation_date": 1516709548, "last_edit_date": 1516711784, "question_id": 48401445, "link": "https://stackoverflow.com/questions/48401445/haskell-sums-accumulated-in-lists", "title": "Haskell -- Sums Accumulated in Lists", "body": "<p>I need to create or know if there is a function in Haskell that allows you to add items from a list. So, for example:</p>\n\n<pre><code>cumulativeAmount :: [Integer] -&gt; [Integer]\n\ncumulativeAmount [1,2,5,8,8,0,4,2] = [1,3,8,16,24,24,28,30]\n\ncumulativeAmount [1,4,7,0,5] = [1, 1+4, 1+4+7, 1+4+7+0, 1+4+7+0+5] = [1,5,12,12,17]\n</code></pre>\n\n<p>I tried to use the <code>map</code> and <code>scanl</code> function, but I didn't get what I wanted, because I added all the elements.</p>\n"}, {"tags": ["haskell", "ghc", "recursion-schemes", "catamorphism"], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1516713899, "post_id": 48400973, "comment_id": 83793770, "body": "Try replacing <code>p x</code> with <code>undefined</code>. Does the error go away? Why/why not? \u2014 Pass the predicate explicitly to <code>alg :: forall a1. (a1 -&gt; Bool) -&gt; ListF a1 [a1] -&gt; [a1]</code> with <code>catafilter = cata . alg</code>. Which <code>forall</code>s can you remove? Can you freely rename your type variables or not?"}], "tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": false, "score": 5, "last_activity_date": 1516712514, "last_edit_date": 1516712514, "creation_date": 1516708016, "answer_id": 48400973, "question_id": 48400105, "link": "https://stackoverflow.com/questions/48400105/specifying-a-function-type-signature-in-a-where-clause/48400973#48400973", "title": "Specifying a function type signature in a where clause", "body": "<p>This works</p>\n\n<pre><code>{-# Language ScopedTypeVariables #-}\n\nimport Data.Functor.Foldable \n\ncatafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg\n  where\n    alg :: ListF a [a] -&gt; [a]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<hr>\n\n<p>If you omit the <code>forall</code>, these are completely different <code>a</code>s (even though syntactically they are the same). </p>\n\n<p>Because of implicit quantification, your uncommented version is taken to be</p>\n\n<pre><code>catafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg\n  where\n    alg :: forall a1. ListF a1 [a1] -&gt; [a1]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>This explains your error message:</p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019 with actual type \u2018a1\u2019\n</code></pre>\n\n<p>The predicate (<code>p :: a -&gt; Bool</code>) expects an argument of type <code>a</code> but it was given <code>x :: a1</code> from <code>Cons x xs :: ListF a1 [a1]</code>! </p>\n\n<p>See if the explicitly quantified version makes sense given the bindings from the error message:</p>\n\n<pre><code>xs         :: [a1] \nx          :: a1\nalg        :: ListF a1 [a1] -&gt; [a1] \np          :: a -&gt; Bool \ncatafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1516711220, "last_edit_date": 1516711220, "creation_date": 1516710509, "answer_id": 48401771, "question_id": 48400105, "link": "https://stackoverflow.com/questions/48400105/specifying-a-function-type-signature-in-a-where-clause/48401771#48401771", "title": "Specifying a function type signature in a where clause", "body": "<p>Without extensions, the original uncommented code</p>\n\n<pre><code>catafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    alg :: ListF a [a] -&gt; [a]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>is equivalent, after enabling <code>ScopedTypeVariables</code>, to explicitly quantifying all the type variables, as follows:</p>\n\n<pre><code>catafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    alg :: forall a. ListF a [a] -&gt; [a]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>This in turn is equivalent to (by alpha converting the quantified variables)</p>\n\n<pre><code>catafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    alg :: forall b. ListF b [b] -&gt; [b]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>and this triggers a type error since <code>p</code> wants an <code>a</code> argument, but <code>p x</code> passes a <code>b</code> argument. </p>\n\n<p>The point is, with the extension enabled, a function starting with <code>forall b. ...</code> is promising that it can work with any choice of <code>b</code>. This promise is too strong for <code>alg</code>, which only works on the same <code>a</code> of <code>catafilter</code>.</p>\n\n<p>So, the solution is the following. The type of <code>catafilter</code> can promise to work with any <code>a</code> its caller might choose: we can add <code>forall a.</code> there.\nInstead, <code>alg</code> must promise only to work with the same <code>a</code> of <code>catafilter</code>, so we reuse the type variable <code>a</code> without adding another <code>forall</code>.</p>\n\n<pre><code>catafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    alg :: ListF a [a] -&gt; [a]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>this compiles since <code>ScopedTypeVariables</code> sees that <code>a</code> is in scope, and does not add an implicit <code>forall</code> in <code>alg</code> (as it would happen without th extension).</p>\n\n<p>Summary:</p>\n\n<ul>\n<li>Without <code>ScopedTypeVariables</code>, every type annotation has its own implicit <code>forall ...</code> on top, quantifying all the variables. No annotation can refer to variables of other annotations (you can reuse the same name, but it is not considered the same variable).</li>\n<li>With <code>ScopedTypeVariables</code>, the definition <code>foo :: forall t. T t u ; foo = def</code> is handled as follows:\n\n<ul>\n<li>the type variable <code>t</code> is universally quantified and brought in scope when type checking <code>def</code>: type annotations in <code>def</code> can refer to <code>t</code></li>\n<li>the type variable <code>u</code>, if currently in scope, refers to the externally defined <code>u</code></li>\n<li>the type variable <code>u</code>, if not in scope, is universally quantified but not brought in scope when type checking <code>def</code> (for compatibility, here we follow the same behavior without the extension)</li>\n</ul></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1526317069, "post_id": 50315732, "comment_id": 87687059, "body": "Thanks for your additional answer! For me it was important to have a normal type signature of the function <code>alg</code> as a compiler  checkable signature and not only as a comment. A comment may be wrong. And thanks to the answers of chi and Icland_jack I now understand <i>forall</i>"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1526334877, "post_id": 50315732, "comment_id": 87695325, "body": "I left the comment in from your O.P. It is the two type annotations that are doing the work, and they <i>are</i> checked by the compiler."}], "tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 1, "last_activity_date": 1526211669, "creation_date": 1526211669, "answer_id": 50315732, "question_id": 48400105, "link": "https://stackoverflow.com/questions/48400105/specifying-a-function-type-signature-in-a-where-clause/50315732#50315732", "title": "Specifying a function type signature in a where clause", "body": "<p>This works, and avoids all that counter-intuitive mucking around with <code>forall</code>s</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Functor.Foldable \n\ncatafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    -- alg :: ListF a [a] -&gt; [a]\n    alg  (Nil :: ListF aa [aa])  =  [] :: [aa]\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>On the <code>alg Nil</code> equation I could actually use tyvar <code>a</code>: I used <code>aa</code> merely to show they're distinct bindings. Because <code>aa</code> appears on a pattern, the compiler unifies it with <code>a</code> from the signature for <code>catafilter</code>.</p>\n\n<p>You could also/instead put the type annotations on the <code>alg Cons</code> equation.</p>\n\n<p>I understand @Jogger's confusion as to why ghc is so fussy about the position of the <code>forall</code>; and the nervousness that a <code>forall</code> perhaps indicates <code>RankNTypes</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1561201950, "creation_date": 1561201950, "answer_id": 56714976, "question_id": 48400105, "link": "https://stackoverflow.com/questions/48400105/specifying-a-function-type-signature-in-a-where-clause/56714976#56714976", "title": "Specifying a function type signature in a where clause", "body": "<p>The problem is that <code>alg</code> depends on an external <code>p</code>, so <code>alg</code>'s type can't be simply polymorphic.</p>\n\n<p>One simple way around it is to make it independent of any external entities by passing them in as the function arguments, so that the function can have its simply polymorphic type as expected:</p>\n\n<pre><code>catafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ncatafilter = cata . alg\n  where\n    alg :: (b -&gt; Bool) -&gt; ListF b [b] -&gt; [b]\n    alg p Nil  =  []\n    alg p (Cons x xs)  =  if (p x) then x : xs else xs\n</code></pre>\n\n<p>This doesn't need any language extensions.</p>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 48401771, "answer_count": 4, "score": 3, "last_activity_date": 1561201950, "creation_date": 1516705364, "last_edit_date": 1516711267, "question_id": 48400105, "link": "https://stackoverflow.com/questions/48400105/specifying-a-function-type-signature-in-a-where-clause", "title": "Specifying a function type signature in a where clause", "body": "<p>The following function implements the good old <em>filter</em> function from lists\nby using the <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\">recursion-schemes</a> library.</p>\n\n<pre><code>import Data.Functor.Foldable \n\ncatafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a] \ncatafilter p = cata alg \n  where\n    -- alg :: ListF a [a] -&gt; [a]\n    alg  Nil  =  []\n    alg  (Cons x xs) = if (p x) then x : xs else xs\n</code></pre>\n\n<p>It compiles and a short test like <code>catafilter odd [1,2,3,4]</code> is successful.\nHowever, if I uncomment the type signature for <code>alg</code> I get the following error:</p>\n\n<pre><code>src/cata.hs:8:30: error:\n    \u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018a1\u2019\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          alg :: forall a1. ListF a1 [a1] -&gt; [a1]\n        at src/cata.hs:6:5-29\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          catafilter :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]\n        at src/cata.hs:3:1-39\n    \u2022 In the first argument of \u2018p\u2019, namely \u2018x\u2019\n      In the expression: (p x)\n      In the expression: if (p x) then x : xs else xs\n    \u2022 Relevant bindings include\n        xs :: [a1] (bound at src/cata.hs:8:18)\n        x :: a1 (bound at src/cata.hs:8:16)\n        alg :: ListF a1 [a1] -&gt; [a1] (bound at src/cata.hs:7:5)\n        p :: a -&gt; Bool (bound at src/cata.hs:4:12)\n        catafilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a] (bound at src/cata.hs:4:1)\n  |\n8 |     alg  (Cons x xs) = if (p x) then x : xs else xs\n  |                              ^\n</code></pre>\n\n<p>The answer to the SO question <a href=\"https://stackoverflow.com/questions/6928884/type-signature-in-a-where-clause\">type-signature-in-a-where-clause</a>\nsuggests to use the <em>ScopedTypeVariables</em> extension. \nThe comment in the last answer to <a href=\"https://stackoverflow.com/questions/10609936/why-is-it-so-uncommon-to-use-type-signatures-in-where-clauses\">why-is-it-so-uncommon-to-use-type-signatures-in-where-clauses</a>\nsuggests to use a <em>forall</em> quantification.</p>\n\n<p>So I added:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>at the top of my module and tried different type signatures for <em>alg</em> like: \n<code>alg :: forall a. ListF a [a] -&gt; [a]</code> or \n<code>alg :: forall b. ListF b [b] -&gt; [b]</code> or adding a <em>forall</em> to the <em>catalist</em> type signature. Nothing compiled!</p>\n\n<p>Question: Why I'm not able to specify a type signature for <em>alg</em>? </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1516711301, "post_id": 48400244, "comment_id": 83792041, "body": "The script interpreter is okay for my needs, since it will have all dependencies written out, and so I have dependencies under version control. Nice. Thank you!"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 2, "last_activity_date": 1516705785, "creation_date": 1516705785, "answer_id": 48400244, "question_id": 48399750, "link": "https://stackoverflow.com/questions/48399750/local-install-packages-with-stack-for-use-with-runhaskell/48400244#48400244", "title": "Local install packages with Stack for use with runhaskell", "body": "<p>You probably want to use the script interpreter. Sorry over concision on the answer but I'm on my phone. Here's the docs for it: <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#script-interpreter\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/GUIDE/#script-interpreter</a></p>\n\n<p>You could also just do \"stack build regex-posix\", and then the package will be available to runhaskell. However, this is more error prone because no package hiding is used so it's trickier to tell what the script actually depends on</p>\n"}], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 48400244, "answer_count": 1, "score": 1, "last_activity_date": 1516710417, "creation_date": 1516704340, "question_id": 48399750, "link": "https://stackoverflow.com/questions/48399750/local-install-packages-with-stack-for-use-with-runhaskell", "title": "Local install packages with Stack for use with runhaskell", "body": "<p>I am developing many small haskell programs that I indent to use as script files. My ideal use-case is to <code>stack runhaskell one-of-the-scripts.hs</code> to run them.</p>\n\n<p>Some of the files use dependencies on packages in hackage, such as <a href=\"https://hackage.haskell.org/package/regex-posix-0.95.2\" rel=\"nofollow noreferrer\">regex-posix</a>. Therefore I get an error message saying </p>\n\n<pre><code>    Could not find module `Text.Regex.Posix'\n    Use -v to see a list of the files searched for.\n  |\n2 | import Text.Regex.Posix\n  | ^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I have considered two options:</p>\n\n<ol>\n<li><p>Use a cabal package and specify dependencies therein. I don't like this solution since it (by what I understand) is used in a workflow where I always compile my code. I would like to use <code>stack runhaskell</code> instead!</p></li>\n<li><p>Ditch stack and use cabal straight up instead, as suggested in an answer to a  similar question here on SO: <a href=\"https://stackoverflow.com/a/13485987/4050510\">https://stackoverflow.com/a/13485987/4050510</a>. I dont like this, since I would like to have all my dependencies listed in some file explicitly.</p></li>\n</ol>\n\n<p>What is the simplest way to install packages from hackage locally, and have then available for <code>stack runhaskell</code> ?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1516702194, "post_id": 48398963, "comment_id": 83785805, "body": "Try to run the parser with <code>eitherDecode</code> to see the error message."}, {"owner": {"reputation": 15, "user_id": 9256057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e7eb8495f74da9278f4701acd8a87f?s=128&d=identicon&r=PG&f=1", "display_name": "bongsun", "link": "https://stackoverflow.com/users/9256057/bongsun"}, "reply_to_user": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1516703209, "post_id": 48398963, "comment_id": 83786554, "body": "Thanks @erdeszt, it now shows  <code>Left &quot;Error in $.path[4]: expected Text, encountered Number&quot;</code>  which refers to the following:  <code>(&quot;path&quot;,Array [String &quot;networking&quot;,String &quot;interfaces&quot;,String &quot;eth0&quot;,String &quot;bindings&quot;,Number 0.0,String &quot;address&quot;])</code>  I&#39;m not sure why it would fail here."}, {"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1516707172, "post_id": 48398963, "comment_id": 83789251, "body": "It can&#39;t convert the array under <code>path</code> into a <code>Vector</code> because it holds different types(Text vs Number). I don&#39;t have a ghci at hand right now but I can get back in a few hours if you still have no solution."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1516710651, "creation_date": 1516710651, "answer_id": 48401809, "question_id": 48398963, "link": "https://stackoverflow.com/questions/48398963/aeson-parser-returning-nothing-for-array-field/48401809#48401809", "title": "Aeson Parser Returning &#39;Nothing&#39; for Array field", "body": "<pre><code>fmap (V.! 2) (o .: \"path\")\n</code></pre>\n\n<p><code>o .: \"path\"</code> here must have type <code>Parser (Vector Text)</code> but the array you give contains a number.</p>\n\n<p>Instead, do not decode the array, i.e., use <code>o .: \"path\"</code> at type <code>Parser Value</code>, and then destruct the value explicitly by pattern matching or using <code>withArray</code>. Then given an <code>Array</code> (i.e., <code>Vector Value</code>, which is heterogeneous) you can get the second element <code>(V.! 2)</code> and convert it to <code>Text</code> (by pattern matching, with <code>withText</code>, or with <code>parseJSON</code>).</p>\n\n<pre><code>(o .: \"path\") &gt;&gt;= withArray \"Path info\" (parseJSON . (V.! 2))\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9256057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e7eb8495f74da9278f4701acd8a87f?s=128&d=identicon&r=PG&f=1", "display_name": "bongsun", "link": "https://stackoverflow.com/users/9256057/bongsun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 48401809, "answer_count": 1, "score": 1, "last_activity_date": 1516710651, "creation_date": 1516701935, "last_edit_date": 1516704723, "question_id": 48398963, "link": "https://stackoverflow.com/questions/48398963/aeson-parser-returning-nothing-for-array-field", "title": "Aeson Parser Returning &#39;Nothing&#39; for Array field", "body": "<p>I'm trying to extract the 3rd element of the 'path' key from the following JSON input:     </p>\n\n<pre><code>{\n  \"certname\": \"some.server.name\",\n  \"path\": [\n    \"networking\",\n    \"interfaces\",\n    \"eth0\",\n    \"bindings\",\n    0,\n    \"address\"\n  ],\n  \"name\": \"networking\",\n  \"value\": \"192.168.1.1\",\n  \"environment\": \"develop\"\n}\n</code></pre>\n\n<p>but all I get is 'Nothing' when running this program:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Control.Monad        (mzero)\nimport           Data.Aeson\nimport           Data.ByteString.Lazy (ByteString)\nimport           Data.Text\nimport qualified Data.Vector          as V\n\ndata HostNicIp =\n  HostNicIp { hniHost :: !Text\n            , hniNic  :: !Text\n            , hniIp   :: !Text\n            } deriving Show\n\ninstance FromJSON HostNicIp where\n  parseJSON (Object o) =\n    HostNicIp\n      &lt;$&gt; (o .: \"certname\")\n      &lt;*&gt; fmap (V.! 2) (o .: \"path\")\n      &lt;*&gt; (o .: \"value\" )\n  parseJSON _  = mzero\n\nmain :: IO ()\nmain = print ( decode demo :: Maybe HostNicIp )\n\ndemo :: ByteString\ndemo = \"{\\\"certname\\\":\\\"some.server.name\\\",\\\"path\\\":[\\\"networking\\\",\\\"interfaces\\\",\\\"eth0\\\",\\\"bindings\\\",0,\\\"address\\\"],\\\"name\\\":\\\"networking\\\",\\\"value\\\":\\\"192.168.1.1\\\",\\\"environment\\\":\\\"develop\\\"}\"\n</code></pre>\n\n<p>Commenting <code>hniNic</code> out and its related logic makes the program parse everything else</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Running this with <code>eitherDecode</code> makes it complain about encountering a <code>Number</code> instead of <code>Text</code></p>\n\n<pre><code>*Main&gt; eitherDecode demo :: Either String HostNicIp \nLeft \"Error in $.path[4]: expected Text, encountered Number\"\n</code></pre>\n\n<p>while the raw <code>Object</code> seems to be parsed OK </p>\n\n<pre><code>*Main&gt; eitherDecode demo :: Either String Object\nRight (fromList [(\"certname\",String \"some.server.name\"),(\"path\",Array [String \"networking\",String \"interfaces\",String \"eth0\",String \"bindings\",Number 0.0,String \"address\"]),(\"environment\",String \"develop\"),(\"value\",String \"192.168.1.1\"),(\"name\",String \"networking\")])\n</code></pre>\n\n<p>Is it possible to use Aeson for heterogeneous lists? How should I approach this?</p>\n"}, {"tags": ["haskell", "monad-transformers", "free-monad"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1516673692, "post_id": 48392810, "comment_id": 83774178, "body": "You may find <a href=\"https://github.com/lexi-lambda/mtl-style-example\" rel=\"nofollow noreferrer\">this example of mtl style</a> informative."}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1516718188, "post_id": 48392810, "comment_id": 83796831, "body": "Ah, I actually had that cloned down, but completely forgot about it! Thanks, will check it out (this time for sure) :)"}], "answers": [{"comments": [{"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "edited": false, "score": 0, "creation_date": 1516718160, "post_id": 48393045, "comment_id": 83796812, "body": "Huh, that&#39;s quite straightforward! :) I don&#39;t know why I was trying to be all fancy and define my own monad transformers and stuff :/ Thanks!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1516672629, "creation_date": 1516672629, "answer_id": 48393045, "question_id": 48392810, "link": "https://stackoverflow.com/questions/48392810/limiting-effects-like-with-freer-using-mtl-style/48393045#48393045", "title": "Limiting effects, like with `Freer`, using MTL-style", "body": "<p>That's quite straightforward.</p>\n\n<pre><code>import Control.Monad.IO.Class\n</code></pre>\n\n<p>Instead of an <code>Effect</code> datatype representing the syntax of our DSL, we define an <code>EffectMonad</code> typeclass that abstracts the monad itself.</p>\n\n<pre><code>class Monad m =&gt; EffectMonad m where\n  readFilename :: String -&gt; m String\n  writeOutput :: Show a =&gt; a -&gt; m ()\n  computation :: Int -&gt; Int -&gt; m Int\n</code></pre>\n\n<p>The program is the same (up to the type signature).</p>\n\n<pre><code>program :: EffectMonad m =&gt; m ()\nprogram = do\n  contents &lt;- readFilename \"test.txt\"\n  writeOutput contents\n  result &lt;- computation 12 22\n  writeOutput result\n</code></pre>\n\n<p>And an interpreter is given as an instance (if you are layering effects with transformers, that's where we run into the <code>O(n*m)</code> instance problem).</p>\n\n<pre><code>instance EffectMonad IO where\n  readFilename filename = readFile filename\n  writeOutput s = print s\n  computation i1 i2 = do\n    print \"Imagine the networking happening here\"\n    pure $ i1 + i2\n</code></pre>\n\n<p>Then running the program is just instantiating it with the right type.</p>\n\n<pre><code>main :: IO ()\nmain = program\n</code></pre>\n"}], "owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 48393045, "answer_count": 1, "score": 1, "last_activity_date": 1516672629, "creation_date": 1516670708, "last_edit_date": 1516672270, "question_id": 48392810, "link": "https://stackoverflow.com/questions/48392810/limiting-effects-like-with-freer-using-mtl-style", "title": "Limiting effects, like with `Freer`, using MTL-style", "body": "<p>Motivation: To be able to control effects in MTL like we can in <code>Free</code>/<code>Freer</code>-style.</p>\n\n<p>The example might be slightly contrived\u2014imagine a program with some basic operations (GHC 8.2 using <code>freer-simple</code>), </p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-10.2 --install-ghc runghc --package freer-simple\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE LambdaCase #-}\nimport Control.Monad.Freer\n\ndata Effect next where\n  ReadFilename :: String -&gt; Effect String\n  WriteOutput :: Show a =&gt; a -&gt; Effect ()\n  Computation :: Int -&gt; Int -&gt; Effect Int\n\nreadFilename :: Member Effect effs =&gt; String -&gt; Eff effs String\nreadFilename = send . ReadFilename\n\nwriteOutput :: (Member Effect effs, Show a) =&gt; a -&gt; Eff effs ()\nwriteOutput = send . WriteOutput\n\ncomputation :: Member Effect effs =&gt; Int -&gt; Int -&gt; Eff effs Int\ncomputation i1 i2 = send $ Computation i1 i2\n</code></pre>\n\n<p>With this, we can model a program that does some simple operations, reading a file and outputting it, doing a computation and outputting it,</p>\n\n<pre><code>program :: Eff '[Effect, IO] ()\nprogram = do\n contents &lt;- readFilename \"test.txt\"\n writeOutput contents\n result &lt;- computation 12 22\n writeOutput result\n</code></pre>\n\n<p>We can then implement our interpreters, which will be were we decide how to run the code. Our first interpreter will be placed client-side, and will run <code>IO</code> instructions locally, and it will send off the pure instructions to a server, for calculation,</p>\n\n<pre><code>runClientEffect :: Eff '[Effect, IO] a -&gt; IO a\nrunClientEffect = runM . interpretM (\\case\n  ReadFilename filename -&gt; readFile filename\n  WriteOutput s -&gt; print s\n  Computation i1 i2 -&gt; do\n    print \"Imagine the networking happening here\"\n    pure $ i1 + i2)\n</code></pre>\n\n<p>The server side we can skip for now. </p>\n\n<p>What this hopefully demonstrates is an interface that relies on some aspects being pure, and thereby able to be sent to a server, while others are impure, and are run locally.</p>\n\n<p>What I struggle with, is how to do this in an MTL-style, namely how to limit the amount of <code>IO</code> that can be done in the monad operations.</p>\n\n<p>Let me know if the question is too vague!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1516668414, "post_id": 48392523, "comment_id": 83772863, "body": "No, Haskell does not allow that. You can sometimes emulate something like it using classy prisms from the lens package, but that\u2019s usually used for composing algebraic datatypes, not ad-hoc name overloading."}], "answers": [{"comments": [{"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1516668838, "post_id": 48392567, "comment_id": 83772974, "body": "I like the names :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1516668845, "last_edit_date": 1516668845, "creation_date": 1516668699, "answer_id": 48392567, "question_id": 48392523, "link": "https://stackoverflow.com/questions/48392523/multiple-data-constructors-using-same-pattern/48392567#48392567", "title": "Multiple data constructors using same pattern", "body": "<p>This is not supported by Haskell. If you absolutely must have two types with a constructor of the same name, you may do so by putting them in different modules. I strongly recommend that you do not get in the practice of doing this, as it can be quite confusing unless you reliably qualify any ambiguous names, even when they are technically not imported in an ambiguous way.</p>\n\n<p>I have enjoyed defining</p>\n\n<pre><code>data Tsil a = Lin | Snoc (Tsil a) a\n</code></pre>\n\n<p>on occasion; you may like to steal my naming.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 48392567, "answer_count": 1, "score": 0, "last_activity_date": 1516668845, "creation_date": 1516668322, "last_edit_date": 1516668714, "question_id": 48392523, "link": "https://stackoverflow.com/questions/48392523/multiple-data-constructors-using-same-pattern", "title": "Multiple data constructors using same pattern", "body": "<p>I have the following data definitions:</p>\n\n<pre><code>data Listr a = Nil | Cons a (Listr a) deriving Show\ndata Listl a = Nil | Cons (Listl a) a deriving Show\n</code></pre>\n\n<p>Haskell complains about <code>Multiple declarations of \u2018Cons\u2019</code>. (It will complain about Nil as well).\nIs this not supported by Haskell? How would one go about declaring something like the above?\nOf course I could use:</p>\n\n<pre><code>data Listr a = Nill | Consl a (Listr a) deriving Show\ndata Listl a = Nilr | Consr (Listl a) a deriving Show\n</code></pre>\n\n<p>But I would prefer the first.</p>\n"}, {"tags": ["haskell", "frp", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 7694443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d48a5bd45667adb939b0f43c1f1aab26?s=128&d=identicon&r=PG&f=1", "display_name": "Stephen Morgan", "link": "https://stackoverflow.com/users/7694443/stephen-morgan"}, "is_accepted": true, "score": 1, "last_activity_date": 1516708330, "creation_date": 1516708330, "answer_id": 48401074, "question_id": 48392106, "link": "https://stackoverflow.com/questions/48392106/reflex-create-a-resettable-delayed-event/48401074#48401074", "title": "Reflex: Create a resettable delayed event", "body": "<p>It seems that I missed the rather obvious:</p>\n\n<pre><code>delayedReset :: MonadWidget t m =&gt; Event t () -&gt; m (Event t ())\ndelayedReset ev = do\n    endEv &lt;- delay 2 ev\n    countDyn &lt;- foldDyn ($) (0 :: Int) $ leftmost\n      [ (+1) &lt;$ ev, subtract 1 &lt;$ endEv ]\n    return $ attachPromptlyDynWithMaybe ifZero countDyn endEv\n  where\n    ifZero 0 a = Just a\n    ifZero _ _ = Nothing\n</code></pre>\n\n<p>The constraints can be relaxed, though this makes them much more verbose.</p>\n\n<p>In the end, though, I went with my first solution. I think the performance hit is minor enough and it simplifies some other aspects of the program.</p>\n"}], "owner": {"reputation": 135, "user_id": 7694443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d48a5bd45667adb939b0f43c1f1aab26?s=128&d=identicon&r=PG&f=1", "display_name": "Stephen Morgan", "link": "https://stackoverflow.com/users/7694443/stephen-morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 48401074, "answer_count": 1, "score": 5, "last_activity_date": 1516708330, "creation_date": 1516665281, "last_edit_date": 1516666580, "question_id": 48392106, "link": "https://stackoverflow.com/questions/48392106/reflex-create-a-resettable-delayed-event", "title": "Reflex: Create a resettable delayed event", "body": "<p>I'm using Reflex within Haskell, and am trying to create an event which fires (for question purposes) a set period of time after another, let's say 2 seconds. However, the counter should reset whenever the original event fires, so that if the original event fires twice 1 second apart, there should only be one firing of the second event: 2 seconds after the last original event.</p>\n\n<p>I've managed to implement this behaviour with</p>\n\n<pre><code>delayedReset :: MonadWidget t m =&gt; Event t () -&gt; m (Event t ())\ndelayedReset ev = fmap (switch . current) . widgetHold (return never) $ timer &lt;$ ev\n  where\n    timer = delay 2 =&lt;&lt; getPostBuild\n</code></pre>\n\n<p>but it seems overkill to use widgetHold; it seems that we should only really need a MonadHold constraint. Is there a more idiomatic way to write this function?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 3, "last_activity_date": 1516646758, "creation_date": 1516646758, "answer_id": 48388316, "question_id": 48386744, "link": "https://stackoverflow.com/questions/48386744/haskell-stack-install-hfmt-error/48388316#48388316", "title": "haskell : stack install hfmt error", "body": "<p>With reports like this, it's best to include the output of <code>stack --version</code> to know what version of the tool you're using. Also, <em>how</em> you installed Stack can be useful information.</p>\n\n<p>As for <code>hfmt</code>: there's no version of it present in a Stackage snapshot, which you can see here:</p>\n\n<p><a href=\"https://www.stackage.org/package/hfmt\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/hfmt</a></p>\n\n<p>On my machine, I was able to build successfully against LTS 10.3, using this command:</p>\n\n<pre><code>stack install hfmt-0.2.0 --resolver lts-10.3\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 5646611, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CaIAC9Nv068/AAAAAAAAAAI/AAAAAAAACgU/cmlghu0uhYE/photo.jpg?sz=128", "display_name": "Matthew Ha", "link": "https://stackoverflow.com/users/5646611/matthew-ha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1516812594, "creation_date": 1516640655, "last_edit_date": 1516812594, "question_id": 48386744, "link": "https://stackoverflow.com/questions/48386744/haskell-stack-install-hfmt-error", "title": "haskell : stack install hfmt error", "body": "<p>I'm totally new in haskell, and trying to install hfmt using stack.</p>\n\n<pre><code>stack install hfmt\n</code></pre>\n\n<p>but it shows </p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for hfmt-0.2.0:\n\n  hindent-4.6.4 must match ==5.* (latest applicable is 5.2.5)\n  hlint-1.9.35 must match ==2.* (latest applicable is 2.0.15)\n  stylish-haskell-0.6.1.0 must match ==0.8.* (latest applicable is 0.8.1.0)\n\nneeded for unknown reason - stack invariant violated.\n</code></pre>\n\n<p>So, I tried to re-install hindent , hlint and stylish-haskell again.\nHowever I couldn't find any command - <code>stack upgrade</code> or <code>stack update</code>.. even I failed to remove these packages.</p>\n\n<p>Could you help install/update these package?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 1, "creation_date": 1516640744, "post_id": 48386727, "comment_id": 83760970, "body": "Could you please provide us the definition of <code>Expanding</code>? It seems to me that you are missing one more argument."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1516661609, "post_id": 48386727, "comment_id": 83771088, "body": "Did you read the error message? &quot;Probable cause: \u2018Expanding\u2019 is applied to too few arguments&quot;. If so and you&#39;re unsure what it means, then you&#39;ll get a better answer if you say so and are as detailed as possible about what you don&#39;t understand."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9252787, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W5_9ybk6mWU/AAAAAAAAAAI/AAAAAAAAADk/jGc2tE5bqSA/photo.jpg?sz=128", "display_name": "Michael George Hart Spaceman", "link": "https://stackoverflow.com/users/9252787/michael-george-hart-spaceman"}, "edited": false, "score": 0, "creation_date": 1516644803, "post_id": 48386824, "comment_id": 83763179, "body": "This is from a Haskell program was originally build with an earlier version of the compiler; so it a very confusing to  wonder why I need another of the type WinStep when that parameter does not exist"}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 1, "user_id": 9252787, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W5_9ybk6mWU/AAAAAAAAAAI/AAAAAAAAADk/jGc2tE5bqSA/photo.jpg?sz=128", "display_name": "Michael George Hart Spaceman", "link": "https://stackoverflow.com/users/9252787/michael-george-hart-spaceman"}, "edited": false, "score": 0, "creation_date": 1516646917, "post_id": 48386824, "comment_id": 83764360, "body": "Mmm... could you provide the type of <code>Expanding</code>?"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 1, "last_activity_date": 1516640961, "creation_date": 1516640961, "answer_id": 48386824, "question_id": 48386727, "link": "https://stackoverflow.com/questions/48386727/haskelle-newbee-has-no-idea-how-fix-this/48386824#48386824", "title": "Haskelle Newbee has no idea how fix this", "body": "<p>Your problem is here:</p>\n\n<pre><code>    | id == raava_expanding = Expanding direction' wsize wstep\n</code></pre>\n\n<p>The compiler is saying you are missing one more argument for <code>Expanding</code> of type <code>WinStep</code>. If you don't put that argument, you are returning a function of type <code>WinStep -&gt; Window</code> instead of the expected type <code>Window</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9252787, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W5_9ybk6mWU/AAAAAAAAAAI/AAAAAAAAADk/jGc2tE5bqSA/photo.jpg?sz=128", "display_name": "Michael George Hart Spaceman", "link": "https://stackoverflow.com/users/9252787/michael-george-hart-spaceman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "closed_date": 1516679493, "answer_count": 1, "score": -3, "last_activity_date": 1516640961, "creation_date": 1516640590, "last_edit_date": 1516640782, "question_id": 48386727, "link": "https://stackoverflow.com/questions/48386727/haskelle-newbee-has-no-idea-how-fix-this", "closed_reason": "Not suitable for this site", "title": "Haskelle Newbee has no idea how fix this", "body": "<p>This code :</p>\n\n<pre><code>foreign export ccall rvcb_create_context :: Ptr Spec -&gt; CInt -&gt; CInt -&gt; CInt -&gt; CInt -&gt; CInt -&gt; IO (Ptr Context)\nrvcb_create_context specPtr id direction alignment size step = do\n  spec &lt;- deRefStablePtr $ castPtrToStablePtr $ castPtr specPtr\n\n  let wsize = fi size\n      wstep = fi step\n      alignment'\n        | alignment == raava_start = AlignStart\n        | alignment == raava_end   = AlignEnd\n      direction'\n        | direction == raava_tostart = ToStart\n        | direction == raava_toend   = ToEnd\n      window\n        | id == raava_single    = Single\n        | id == raava_rolling   = Rolling alignment' wsize wstep\n        | id == raava_expanding = Expanding direction' wsize wstep\n        | otherwise            =\n          error (printf \"impossible id %s\" (show id))\n</code></pre>\n\n<p>Generates this error and I have not idea how to fix even though I have vague idea of what its</p>\n\n<pre><code>121:35: error:\n    \u2022 Couldn't match expected type \u2018Window\u2019\n                  with actual type \u2018WinStep -&gt; Window\u2019\n    \u2022 Probable cause: \u2018Expanding\u2019 is applied to too few arguments\n      In the expression: Expanding direction' wsize wstep\n      In an equation for \u2018window'\u2019:\n          window'\n            | id == raava_single = Single\n            | id == raava_rolling = Rolling alignment' wsize wstep\n            | id == raava_expanding = Expanding direction' wsize wstep\n            | otherwise = error (printf \"impossible id %s\" (show id))\n      In the expression:\n        do spec &lt;- deRefStablePtr $ castPtrToStablePtr $ castPtr specPtr\n           let wsize = fi size\n               wstep = fi step\n               ....\n           let context = genContext spec window\n           contextPtr &lt;- newStablePtr context\n           ....\n    |\n121 |         | id == raava_expanding = Expanding direction' wsize wstep\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516632121, "post_id": 48384074, "comment_id": 83755088, "body": "You probably should write <code>foo i j k = i + j + k</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 9, "creation_date": 1516632203, "post_id": 48384074, "comment_id": 83755149, "body": "And nothing is evaluated. Haskell will only build an expression tree that <i>can</i> later be evaluated in case we need it."}, {"owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516632352, "post_id": 48384074, "comment_id": 83755262, "body": "@WillemVanOnsem that is good to know. However, if we do need this code somewhere and it will be evaluated, how does one explain the values i, j and k? What I am unsure about are the implications of i depending on j, j depending on k, and k depending on x. Will j somehow be concatenated to i, or does something else happen?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516632669, "post_id": 48384074, "comment_id": 83755513, "body": "well you should see variables are references to <i>expressions</i>. So if <code>func x</code> is somehow evaluated, it will evaluate <code>foo i j k</code> and at that point <code>i = bar j</code>, <code>j = baz k</code>, <code>k = bat x</code>. Now that thus means that we will call <code>bar j</code>, in case <code>bar</code> needs <code>j</code> (that is not certain), it will also evaluate <code>baz k</code>, and if <code>baz k</code> needs <code>k</code>, it will evaluate <code>bat x</code>. Then we need to evaluate <code>j</code>, but since it is a reference to the same expression, we do not need to do that a second time, since it was already evaluated before, the same for <code>k</code>."}, {"owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516632964, "post_id": 48384074, "comment_id": 83755742, "body": "@WillemVanOnsem so if <code>bar</code> needs <code>j</code> and <code>baz</code> needs <code>k</code>, the variables will be unraveled to <code>i = bar baz bat x</code>, <code>j = baz bat x</code>, <code>k = bat x</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516633156, "post_id": 48384074, "comment_id": 83755883, "body": "no, first of all the synax is wrong (you need parenthesis). But furthermore the calculations are &quot;shared&quot;. So if the first thread will calculate <code>k</code>, we do no longer need to calculate <code>bat x</code> a second time."}, {"owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516633647, "post_id": 48384074, "comment_id": 83756284, "body": "<code>bat x</code> is calculated by the first thread as <code>k</code> and the other threads will not have to calculate it again. But does the function <code>foo</code> apply the value <code>k</code> a total of three times in its additions, two of them indirectly through the values <code>j</code> and <code>i</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1516633717, "post_id": 48384074, "comment_id": 83756331, "body": "Could you fix your code to not have a serious type error?  As it stands, it&#39;s really hard to tell exactly what you mean, as you could mean several different things, depending on how you fix it.  Is <code>foo</code> a function or not?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516633729, "post_id": 48384074, "comment_id": 83756340, "body": "@SimonCarlson: the value of <code>k</code> is calculated <i>at most</i> one time. It also depends on the functions <code>bar</code>, <code>baz</code>, and <code>bat</code>."}, {"owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1516633789, "post_id": 48384074, "comment_id": 83756389, "body": "@Carl <code>foo</code> is supposed to be a function. I just got started with Haskell and am unsure of the syntax, if you could edit the code so that <code>foo</code> is a function that would be swell."}, {"owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516633849, "post_id": 48384074, "comment_id": 83756435, "body": "@WillemVanOnsem thank you."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516634332, "post_id": 48384074, "comment_id": 83756734, "body": "Where clauses are not evaluated. They introduce variable bindings (definitions). Definitions like <code>foo x = func i j k</code> are not evaluated either. Expressions are evaluated."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1516634366, "post_id": 48384074, "comment_id": 83756759, "body": "You might like to play with this to get some intuition about evaluation order (or the lack thereof): <a href=\"http://chrisuehlinger.com/LambdaBubblePop/\" rel=\"nofollow noreferrer\">chrisuehlinger.com/LambdaBubblePop</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516636461, "post_id": 48385259, "comment_id": 83758262, "body": "&quot;and it&#39;s up to foo to decide (via foo&#39;s formula) how and when to evaluate each of the supplied expressions&quot;  No it&#39;s not. You can force some amount of sequentiality using constructs like <code>seq</code>, but generally it&#39;s not up to any particular function but up to the RTS to determine if, when and how anything is evaluated."}, {"owner": {"reputation": 831, "user_id": 3371760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/09370cd5d499c9f0f75b54aa1b4daa17?s=128&d=identicon&r=PG", "display_name": "Fried Brice", "link": "https://stackoverflow.com/users/3371760/fried-brice"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516636694, "post_id": 48385259, "comment_id": 83758452, "body": "I should say &quot;assuming you print the result&quot; or something, which is the assumption of the question."}, {"owner": {"reputation": 831, "user_id": 3371760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/09370cd5d499c9f0f75b54aa1b4daa17?s=128&d=identicon&r=PG", "display_name": "Fried Brice", "link": "https://stackoverflow.com/users/3371760/fried-brice"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516636810, "post_id": 48385259, "comment_id": 83758549, "body": "Assuming the result is called for, <code>foo</code>&#39;s formula will be used to decide which arguments get evaluated and in what order."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1516640846, "post_id": 48385259, "comment_id": 83761038, "body": "@FriedBrice <code>foo</code>&#39;s formula does not unique define a reduction order. The compiler is free to generate code that evaluates <code>i</code>, <code>j</code>, and <code>k</code> in any order. Remember that parse tree is not evaluation order."}], "tags": [], "owner": {"reputation": 831, "user_id": 3371760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/09370cd5d499c9f0f75b54aa1b4daa17?s=128&d=identicon&r=PG", "display_name": "Fried Brice", "link": "https://stackoverflow.com/users/3371760/fried-brice"}, "is_accepted": false, "score": 3, "last_activity_date": 1516636113, "last_edit_date": 1516636113, "creation_date": 1516635708, "answer_id": 48385259, "question_id": 48384074, "link": "https://stackoverflow.com/questions/48384074/understanding-order-of-evaluation-in-haskell/48385259#48385259", "title": "Understanding order of evaluation in Haskell", "body": "<p>First off, <code>foo i j k</code> will parse as <code>((foo i) j) k</code>. This is because all functions in Haskell take exactly one argument. The one arg of <code>foo</code> is <code>i</code>, then the result <code>(foo i)</code> is a function whose one arg is <code>j</code>, etc. So, it's neither <code>foo(i(j(k)))</code> nor <code>foo (i, j, k)</code>; however, I should warn you that <code>((foo i) j) k</code> ends up being in some sense equivalent to <code>foo (i, j, k)</code> for reasons that we can go into if you'd like.</p>\n\n<p>Second, <code>i</code>, <code>j</code>, and <code>k</code> will be passed to <code>foo</code> not as reduced values but as expressions, and it's up to <code>foo</code> to decide (via <code>foo</code>'s formula) how and when to evaluate each of the supplied expressions. In the case of <code>(+)</code>, I'm pretty sure it's simply left-to-right. So, <code>i</code> will be forced first, but of course to evaluate <code>i</code>, all the others will need to be evaluated, so you trace out the data dependency tree to its leaves, which bottoms out at <code>x</code>.</p>\n\n<p>Perhaps the subtlety here is that there is a distinction between \"reduced\" and \"fully reduced.\" <code>i</code> will be reduced first, in the sense that one layer of abstraction--the name<code>i</code>--is removed and replaced with the formula for <code>i</code>, but it's nor fully reduced at that point, and to fully reduce <code>i</code> we need to fully reduce it's data dependencies.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1516640872, "creation_date": 1516640872, "answer_id": 48386798, "question_id": 48384074, "link": "https://stackoverflow.com/questions/48384074/understanding-order-of-evaluation-in-haskell/48386798#48386798", "title": "Understanding order of evaluation in Haskell", "body": "<p>The order of evaluation is not specified (in the Haskell report) for addition. As a result the evaluation order depends on the type of your number and it's <code>Num</code> instance.</p>\n\n<p>For example, below are two types with Num instances and reversed order of evaluation.  I have used a custom Show instance and debug print outs to make the point easier to see in the output.</p>\n\n<pre><code>import Debug.Trace\n\nnewtype LeftFirst = LF { unLF :: Integer }\ninstance Show LeftFirst where show (LF x) = x `seq` \"LF\"++show x\nnewtype RightFirst = RF { unRF :: Integer }\ninstance Show RightFirst where show (RF x) = x `seq` \"RF\"++show x\n\ninstance Num LeftFirst where\n    (+) a b = a `seq` LF (unLF a + unLF b)\n    fromInteger x = trace (\"LF\" ++ show x) (LF x)\n\ninstance Num RightFirst where\n    (+) a b = b `seq` RF (unRF a + unRF b)\n    fromInteger x = trace (\"RF\" ++ show x) (RF x)\n\nfunc :: Num a =&gt; a -&gt; a\nfunc x = foo i j k\n  where\n    foo i j k = i + j + k\n    k = bat x\n    j = baz k\n    i = bar j\n\nbar,baz,bat :: Num a =&gt; a -&gt; a\nbar = (+1)\nbaz = (+2)\nbat = (+3)\n</code></pre>\n\n<p>And notice the output:</p>\n\n<pre><code>*Main&gt; func (0 :: LeftFirst)\nLF0\nLF3\nLF2\nLF1\nLF14\n*Main&gt; func (0 :: RightFirst)\nRF3\nRF0\nRF2\nRF1\nRF14\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1516647266, "post_id": 48387194, "comment_id": 83764544, "body": "N.B. this description of evaluation depends critically (and silently) on the fact that <code>(+) :: Int -&gt; Int -&gt; Int</code> is strict. With a lazier operation, there may be significantly more possible orders for the various steps outlined in the &quot;Execution&quot; section, and indeed some of the steps might never happen at all."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516647353, "post_id": 48387194, "comment_id": 83764589, "body": "@DanielWagner Could you kindly elaborate? I will gladly integrate your corrections as a <i>postscriptum</i>, with attribution."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1516647641, "post_id": 48387194, "comment_id": 83764718, "body": "As far as I can tell, there is no actual <i>correction</i> needed: everything stated here is correct. It is merely slightly misleading, in that it bakes in some assumptions about which functions demand which values. For example, the fact that <code>bat x</code> is the first thing computed is true, but only because <code>(+)</code> forces at least one of its arguments, and both of its arguments force <code>bat x</code> eventually. e.g. compare the term <code>let f _ _ = () in f (f (bar j) j) k</code>, which has the exact same dependency graph as <code>+ (+ (bar j) j) k</code>, but in which <code>bat x</code> need never be evaluated at all."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1516648016, "post_id": 48387194, "comment_id": 83764880, "body": "In other words, a complete explanation (which I understand this answer isn&#39;t really trying to be) would need to discuss how one chooses which node in the computation graph to reduce first; in this example, &quot;the deepest leaf&quot; is the right answer, but that&#39;s only coincidence."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516648751, "post_id": 48387194, "comment_id": 83765194, "body": "@DanielWagner To be honest, I don&#39;t even know how to begin explaining this. It&#39;s more than a bit beyond my level of knowledge. I added a note that, hopefully, relays some of your points. Please edit the answer further if you find it desirable, as I really cannot proceed further with the subject of evaluation order."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1516795400, "post_id": 48387194, "comment_id": 83833463, "body": "I\u2019m not convinced your explanation is correct at any thx optimization level.  With absolutely no optimization, <code>bat x</code> is not computed in step 2, instead a thunk is created.  With even a little bit of strictness analysis different things will happen.  With a lot of optimization it will turn into the same code as if you\u2019d written it in C."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 13, "last_activity_date": 1516648604, "last_edit_date": 1516648604, "creation_date": 1516642410, "answer_id": 48387194, "question_id": 48384074, "link": "https://stackoverflow.com/questions/48384074/understanding-order-of-evaluation-in-haskell/48387194#48387194", "title": "Understanding order of evaluation in Haskell", "body": "<h3>Intro</h3>\n\n<p>I will assume you meant to write this code:</p>\n\n<pre><code>func :: Int -&gt; Int\nfunc x = foo\n  where\n    foo = i + j + k\n    k = bat x\n    j = baz k\n    i = bar j\n</code></pre>\n\n<p>This way it will type check and all three functions you defined in the <code>where</code> clause will eventually get called. If this is not what you meant, still do read on, as I will not only give you a depiction of the way your code evaluates, but also a method of determining the answer yourself. It may be a bit of a long story, but I hope it will worth your time.</p>\n\n<h3>Core</h3>\n\n<p>Evaluation of code absolutely depends on your choice of the compiler, but I suppose you will be using GHC, and if so, it will transform your code several times before reducing it to machine code.</p>\n\n<p>First, <em>\"<code>where</code> clauses\"</em> will be replaced with <em>\"<code>let</code> clauses\"</em>. This is done so as to reduce Haskell syntax to a simpler <em>Core</em> syntax. Core is similar enough to a math theory called <em>lambda calculus</em> for its eventual evaluation to proceed according to this solid foundation. At this point your code will look somewhat like this:</p>\n\n<pre><code>func = \u03bbx -&gt;\n      let { k = bat x } in\n      let { j = baz k } in\n      +\n        (+ (bar j) j)\n        k\n</code></pre>\n\n<p>As you see, one of the function definitions from the <code>where</code> clause of your Haskell code disappeard altogether by the time of its arrival to Core stage (actually, it was inlined), and the others were rewritten to <code>let</code> notation. The binary operation (+) got rewritten to <em>polish notation</em> to make it unambiguous (it is now clear that <code>i + j</code> should be computed first). All these conversions were performed without altering the meaning of the code.</p>\n\n<h3>Graph machine</h3>\n\n<p>Then, the resulting <em>lambda expression</em> will be reduced to a directed graph and executed by a <em>Spineless Tagless Graph machine</em>. In a sense, Core to STG machine is what assembler is to Turing machine, though the former is a lambda expression, while the latter a sequence of imperative instructions. (As you may see by now, the distinction between functional and imperative languages runs rather deep.) An STG machine will translate the expressions you give it to imperative instructions that are <em>executable</em> on a conventional computer, through a rigorously defined <em>operational semantics</em> -- that is, to every syntactic feature of Core (of which it only has about 4) there is a piece of imperative assembler instructions that performs the same thing, and a Core program will be translated to a combination of these pieces.</p>\n\n<p>The key feature of the operational semantics of Core is its <em>laziness</em>. As you know, Haskell is a lazy language. What that means is that a function to be computed and the value of this function look the same: as a sequence of bytes in RAM. As the program starts, everything is laid out as functions (<em>closures</em>, to be precise), but once a function's return value is computed, it will be put in the place of the closure so that all further accesses to this location in memory would immediately receive the value. In other words, a value is computed only when it is needed, and only <em>once</em>.</p>\n\n<p>As I said, an expression in Core will be turned to a directed graph of computations that depend on each other. For example:</p>\n\n<p><a href=\"https://i.stack.imgur.com/vVZgi.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/vVZgi.png\" alt=\"enter image description here\"></a></p>\n\n<p>If you look closely, I hope this graph  will remind you of the program we started with. Please note two particulars about it:</p>\n\n<ul>\n<li><p>All the arrows eventually lead to <code>x</code>, which is consistent with our idea that supplying <code>x</code> is enough to evaluate <code>func</code>.</p></li>\n<li><p>Sometimes two arrows lead to the same box. That means the value of this box will be evaluated once, and the second time we shall have the value for free.</p></li>\n</ul>\n\n<p>So, the STG machine will take some Core code and create an executable that computes the value of a graph more or less similar to the one in the picture.</p>\n\n<h3>Execution</h3>\n\n<p>Now, as we made it to the graph, it's easy to see that the <em>computation</em> will proceed thus:</p>\n\n<ol>\n<li>As <code>func</code> is called, the value of <code>x</code> is received and put in the corresponding box.</li>\n<li><code>bat x</code> is computed and put in a box.</li>\n<li><code>k</code> is set to be the same as <code>bat x</code>. (This step will probably be dropped by some of the optimizations GHC runs on the code, but literally a <code>let</code> clause requests that its value be stored separately.)</li>\n<li><code>baz k</code> is computed and put in a box.</li>\n<li><code>j</code> is set to be the same as <code>baz k</code>, the same as with <code>k</code> in step 6. <code>bar j</code> is computed and put in a box.</li>\n<li>Contrary to what one would expect in the light of steps 3 and 5, <code>i</code> is not set to anything. As we saw in the listing of Core for our program, it was optimized away.</li>\n<li><code>+ (bar j) j</code> is computed. <code>j</code> is already computed, so <code>baz k</code> will <em>not</em> be called this time, thanks to laziness.</li>\n<li>The topmost value is computed. Again, there is no need to compute <code>bat x</code> this time, as it was computed previously and stored in the right box.</li>\n<li>Now, the value of <code>func x</code> is itself a box, ready to be used by the caller any number of times.</li>\n</ol>\n\n<p>I would highlight that this is what's going to be happening at the time you <em>execute</em> the program, as opposed to compiling it. </p>\n\n<h3>Epilogue</h3>\n\n<p>That's the story, to the best of my knowledge. For further clarifications, I refer the reader to the works of Simon Peyton Jones: <a href=\"https://www.microsoft.com/en-us/research/publication/the-implementation-of-functional-programming-languages\" rel=\"noreferrer\">the book on the design of Haskell</a> and <a href=\"https://www.microsoft.com/en-us/research/publication/implementing-lazy-functional-languages-on-stock-hardware-the-spineless-tagless-g-machine/\" rel=\"noreferrer\">the article on the design of Graph machine</a>, together describing all the inner workings of GHC to the smallest peculiarity.</p>\n\n<p>To review the Core generated by GHC, simply pass the flag <code>-ddump-simpl</code> as you compile something. It will hurt your eyes at first, but one gets used to it.</p>\n\n<p>Enjoy!</p>\n\n<p><em><strong>postscriptum</strong></em></p>\n\n<p>As @DanielWagner pointed out in the comments, the laziness of Haskell has some further consequences that we should have needed to consider were we to dissect a less contrived case. Specifically: a computation may <em>not need</em> to evaluate some of the boxes it points to, or even any of those boxes at all. In such case, these boxes will stay untouched and unevaluated, while the computation completes and delivers its result that is in actuality independent of the subordinate boxes anyway. An example of such a function: <code>f x = 3</code>. This has far-reaching consequences: say, if <code>x</code> were impossible to compute, as in \"infinite loop\", a function that <em>does not use</em> <code>x</code> in the first place would not enter that loop at all. Thus, it is sometimes desirable to know in detail which sub-computations will necessarily be launched from a given computation and which may not. Such intricacies reach a bit farther than I'm prepared to describe in this answer, so at this cautionary note I will end.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1516664841, "creation_date": 1516664841, "answer_id": 48392044, "question_id": 48384074, "link": "https://stackoverflow.com/questions/48384074/understanding-order-of-evaluation-in-haskell/48392044#48392044", "title": "Understanding order of evaluation in Haskell", "body": "<p>If I understand your question (and follow-up comments) correctly, I guess you aren't really interested in the \"order of evaluation\" or the details of how a particular Haskell compiler actually performs the evaluation.  Instead, you're simply interested in understanding what the following program <em>means</em> (i.e., its \"semantics\"):</p>\n\n<pre><code>func x = foo i j k\n  where\n    foo i j k = i + j + k\n    k = bat x\n    j = baz k\n    i = bar j\n</code></pre>\n\n<p>so that you can predict the value of, say, <code>func 10</code>.  Right?</p>\n\n<p>If so, then what you need to understand is:</p>\n\n<ul>\n<li>how names are scoped (e.g., so that you understand that the <code>x</code> in the definition of <code>k</code> refers to the parameter <code>x</code> in the definition of <code>func x</code> and so on)</li>\n<li>the concept of \"referential transparency\", which is basically the property of Haskell programs that a variable can be replaced with its definition without affecting the meaning of the program.</li>\n</ul>\n\n<p>With respect to variable scoping when a <code>where</code> clause is involved, it's useful to understand that a <code>where</code> clause is attached to a particular \"binding\" -- here, the <code>where</code> clause is attached to the binding for <code>func x</code>.  The <code>where</code> clause simultaneously does three things:</p>\n\n<p>First, it pulls into its own scope the name of the thing that's being defined in the associated binding (here <code>func</code>) and the names of any parameters (here <code>x</code>).  Any reference to <code>func</code> or <code>x</code> within the <code>where</code> clause will refer to the <code>func</code> and <code>x</code> in the <code>func x</code> binding that's being defined (assuming that the <code>where</code> clause doesn't <em>itself</em> define new binding for <code>func</code> or <code>x</code> that \"shadow\" those binding -- that's not an issue here).  In your example, the implication is that the <code>x</code> in the definition <code>k = bat x</code> refers to the parameter <code>x</code> in the binding for <code>func x</code>.</p>\n\n<p>Second, it introduces into its own scope the names of all the things being defined by the <code>where</code> clause (here, <code>foo</code>, <code>k</code>, <code>j</code>, and <code>i</code>), though <em>not</em> the parameters.  That is, the <code>i</code>, <code>j</code>, and <code>k</code> in the binding <code>foo i j k</code> are <strong>NOT</strong> introduced into scope, and if you compile your program with the <code>-Wall</code> flag, you'll get a warning about shadowed bindings.  Because of this, your program is actually equivalent to:</p>\n\n<pre><code>func x = foo i j k\n  where\n    foo i' j' k' = i' + j' + k'\n    k = bat x\n    j = baz k\n    i = bar j\n</code></pre>\n\n<p>and we'll use this version in what follows.  The implication of the above is that the <code>k</code> in <code>j = baz k</code> refers to the <code>k</code> defined by <code>k = bat x</code>, while the <code>j</code> in <code>i = bar j</code> refers to the <code>j</code> defined by <code>j = baz k</code>, but the <code>i</code>, <code>j</code>, and <code>k</code> defined by the <code>where</code> clause have nothing to do with the <code>i'</code>, <code>j'</code>, and <code>k'</code> parameters in the binding <code>foo i' j' k'</code>.  Also note that the order of bindings <em>doesn't matter.</em>  You could have written:</p>\n\n<pre><code>func x = foo i j k\n  where\n    foo i' j' k' = i' + j' + k'\n    i = bar j\n    j = baz k\n    k = bat x\n</code></pre>\n\n<p>and it would have meant exactly the same thing.  Even though <code>i = bar j</code> is defined before the binding for <code>j</code> is given, that makes no difference -- it's still the same <code>j</code>.</p>\n\n<p>Third, the <code>where</code> clause <em>also</em> introduces into the scope of the right-hand side of the associated binding the names discussed in the previous paragraph.  For your example, the names <code>foo</code>, <code>k</code>, <code>j</code>, and <code>i</code> are introduced into the scope of the expression on the right hand side of the associated binding <code>func x = foo i j k</code>.  (Again, there's a subtlety if any shadowing is involved -- a binding in the <code>where</code> clause would <em>override</em> the bindings of <code>func</code> and <code>x</code> introduced on the left-hand side and also generate a warning if compiled with <code>-Wall</code>.  Fortunately, your example doesn't have this problem.)</p>\n\n<p>The upshot of all this scoping is that, in the program:</p>\n\n<pre><code>func x = foo i j k\n  where\n    foo i' j' k' = i' + j' + k'\n    k = bat x\n    j = baz k\n    i = bar j\n</code></pre>\n\n<p>every usage of each name refers to the same thing (e.g., all the <code>k</code> names refer to the same thing).</p>\n\n<p>Now, the referential transparency rule comes into play.  You can determine the meaning of an expression by substituting any name by its definition (taking care to avoid name collisions or so-called \"capture\" of names).  Therefore, if we were evaluating <code>func 10</code>, it would be equivalent to:</p>\n\n<pre><code>func 10                                        -- binds x to 10\n= foo i j k                                    -- by defn of func\n</code></pre>\n\n<p>at this stage, the definition of <code>foo</code> is used which binds <code>i'</code> to <code>i</code>, <code>j'</code> to <code>j</code>, and <code>k'</code> to <code>k</code> in order to produce the expression:</p>\n\n<pre><code>= i + j + k                                    -- by defn of foo\n= bar j + baz k + bat x                        -- by defs of i, j, k\n= bar (baz k) + baz k + bat x                  -- by defn of j\n= bar (baz (bat x)) + baz (bat x) + bat x      -- by defn of k\n= bar (baz (bat 10)) + baz (bat 10) + bat 10   -- by defn of x\n</code></pre>\n\n<p>So, if we defined:</p>\n\n<pre><code>bat = negate\nbaz y = 7 + y\nbar z = 2*z\n</code></pre>\n\n<p>then we'd expect:</p>\n\n<pre><code>func 10 = 2 * (7 + negate 10) + (7 + negate 10) + negate 10\n        = -19\n</code></pre>\n\n<p>which is exactly what we get:</p>\n\n<pre><code>&gt; func 10\n-19\n</code></pre>\n"}], "owner": {"reputation": 1651, "user_id": 1738415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cf9cfa75d371c16d38c833867d545593?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Carlson", "link": "https://stackoverflow.com/users/1738415/simon-carlson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1915, "favorite_count": 1, "accepted_answer_id": 48387194, "answer_count": 4, "score": 7, "last_activity_date": 1516664841, "creation_date": 1516632073, "last_edit_date": 1516633848, "question_id": 48384074, "link": "https://stackoverflow.com/questions/48384074/understanding-order-of-evaluation-in-haskell", "title": "Understanding order of evaluation in Haskell", "body": "<p>I am trying to understand how where clauses evaluate in Haskell. Say we got this toy example where bar, baz and bat are defined functions somewhere:</p>\n\n<pre><code>func x = foo i j k\n  where\n    foo i j k = i + j + k\n    k = bat x\n    j = baz k\n    i = bar j\n</code></pre>\n\n<p>How does the line <code>func x = foo i j k</code> expand? Does it evaluate to something like <code>func x = foo(i(j(k)), j(k), k)</code> or <code>func x = foo(i, j, k)</code>?</p>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516630033, "post_id": 48383300, "comment_id": 83753587, "body": "IIRC, the reason that RWH states that we&#39;ll never use <code>foldl</code> in practice is because you should use <code>foldl&#39;</code> instead."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516630509, "post_id": 48383300, "comment_id": 83753937, "body": "If you are using a left fold to produce a lazy data structure (which, in particular, you need to consume lazily, typically because it&#39;s too large to manifest in memory) <i>and</i> you need to do some computation in between each step which you want to perform immediately - not when the result is actually evaluated - then using <code>foldl</code> is appropriate. But these are very restrictive conditions, so in practice, <code>foldl</code> is never used."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1516631149, "post_id": 48383300, "comment_id": 83754372, "body": "A rough guideline is: if your fold returns some type which is represented in constant-space (e.g. <code>Int</code>), prefer <code>foldl&#39;</code> so that the whole fold requires constant space. Otherwise, if the return type is a lazy list/tree/whatever, prefer <code>foldr</code>, so that it can be consumed lazily."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516649121, "post_id": 48383427, "comment_id": 83765367, "body": "It is debatable whether this bang-pattern version of <code>myfold</code> is actually tail-recursive, as seems to be implied by &quot;have your cake and eat it too&quot;. <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/bang-patterns.html\" rel=\"nofollow noreferrer\">The documentation</a> says it should behave the same as the bang-pattern free <code>myfold f b (x:xs) = b `seq` myfold f (f b x) xs</code>, which is not tail-recursive."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1516651446, "post_id": 48383427, "comment_id": 83766469, "body": "That is still tail-recursive, as <code>seq</code> returns the return value of its second argument."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 8, "last_activity_date": 1516640069, "last_edit_date": 1516640069, "creation_date": 1516630025, "answer_id": 48383427, "question_id": 48383300, "link": "https://stackoverflow.com/questions/48383300/why-does-foldl-seems-to-be-harmful-despite-being-tail-recursive/48383427#48383427", "title": "Why does foldl seems to be harmful despite being tail-recursive?", "body": "<blockquote>\n  <p>It seems, then, that Haskell non-strict evaluation makes tail-recursiveness less important. Yet, I have this feeling that for counting items in lists a strict <code>foldl</code> should perform better than any <code>foldr</code>, because there's no way we can extract anything from an <code>Integer</code>.</p>\n</blockquote>\n\n<p>That is correct, and tail-calls <em>are</em> more efficient. But this benefit can be outweighed by the cost of creating large thunks, and this is the case for <code>foldl</code>.</p>\n\n<p>The way to have your cake and eat it too is to make sure that the accumulator is not thunked, but rather eagerly evaluated:</p>\n\n<pre><code>myfold:: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nmyfold f !b [] = b\nmyfold f !b (x:xs) = myfold f (f b x) xs\n</code></pre>\n\n<p>Which is, of course, the <code>foldl'</code> function.</p>\n\n<p>TL;DR: Never use <code>foldl</code>, but do use <code>foldl'</code>.</p>\n"}], "owner": {"reputation": 2930, "user_id": 211280, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30d93884d1d9fefdc8f93d4ed9079d04?s=128&d=identicon&r=PG", "display_name": "manu", "link": "https://stackoverflow.com/users/211280/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 1, "accepted_answer_id": 48383427, "answer_count": 1, "score": 6, "last_activity_date": 1516640069, "creation_date": 1516629610, "last_edit_date": 1516640038, "question_id": 48383300, "link": "https://stackoverflow.com/questions/48383300/why-does-foldl-seems-to-be-harmful-despite-being-tail-recursive", "title": "Why does foldl seems to be harmful despite being tail-recursive?", "body": "<p>I've always believed that tail-recursive functions are better in terms of\nperformance than non tail-recursive versions. So, counting items in a list <em>might</em> be implemented like so:</p>\n\n<pre><code>count:: [a] -&gt; Int\ncount [] = 0\ncount (x:xs) = 1 + count xs\n</code></pre>\n\n<p>But this function is not tail recursive, and so is not as performant as possible. The fix is to <em>accumulate</em> counts, like so:</p>\n\n<pre><code>_count:: Num b =&gt; b -&gt; [a] -&gt; b\n_count b [] = b\n_count b (x:xs) = _count (b + 1) xs\n\ncount:: [a] -&gt; Int\ncount = _count 0\n</code></pre>\n\n<p>This can be easily implemented with a tail-recursive fold:</p>\n\n<pre><code>myfold:: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nmyfold f b [] = b\nmyfold f b (x:xs) = myfold f (f b x) xs\n\ncount = myfold incr 0\n   where incr c _ = c + 1\n</code></pre>\n\n<p>But, then I remembered something about left vs right folds.  It turned out\n<code>myfold</code> is a left fold, which according to Real World Haskell shouldn't be used:</p>\n\n<blockquote>\n  <p>This is convenient for testing, but we will never use foldl in practice.</p>\n</blockquote>\n\n<p>...because of the thunking of the application of <code>f b x</code>.</p>\n\n<p>So, I tried to rewrite <code>myfold</code> as a right fold:</p>\n\n<pre><code>myfoldr:: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nmyfoldr f b [] = b\nmyfoldr f b (x:xs) = f x (myfoldr f b xs)\n</code></pre>\n\n<p>But that's not tail-recursive.</p>\n\n<p>It seems, then, that Haskell non-strict evaluation makes tail-recursiveness\nless important.  Yet, I have this feeling that for <em>counting</em> items in lists a strict <code>foldl</code> should perform better than any <code>foldr</code>, because there's no way we can extract anything from an <code>Integer</code>.</p>\n\n<p>To sum up, I think these are the better implementations (using folds) for map and count:</p>\n\n<pre><code>map:: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f = foldr g []\n  where g x fxs = (f x):fxs\n\ncount:: [a] -&gt; Int\ncount = foldl incr 0\n  where incr c _ = c + 1\n</code></pre>\n\n<p>Is this correct?  </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1517302361, "post_id": 48376430, "comment_id": 84029167, "body": "One answer is to use something like <code>stack runghc -- -XLambdaCase filename.hs</code>. I <i>think</i> it&#39;s possible to achieve this via a <code>.ghci</code> file as well, but I&#39;m not sure."}], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 3, "last_activity_date": 1517302740, "creation_date": 1517302740, "answer_id": 48517432, "question_id": 48376430, "link": "https://stackoverflow.com/questions/48376430/enable-package-wide-extensions-in-stack-runghc/48517432#48517432", "title": "Enable package-wide extensions in &quot;stack runghc&quot;", "body": "<p>Yes, stack should probably have some better support for this -\n see <a href=\"https://github.com/commercialhaskell/stack/issues/3338\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/3338</a> .</p>\n\n<p>I'd say the summary is that <code>stack runghc</code> came before <code>stack ghci</code>, it's ended up having a much simpler meaning that does not take cabal files into account at all.  Not sure how to make things consistent and intuitive on the commandline without changing the meaning of <code>runghc</code>.</p>\n\n<p>In that issue, I describe a hacky workaround.  Copying it here:</p>\n\n<p>Here's a workaround for now.  Put the following in <code>~/.local/bin/stack-run-ghc.sh</code> and make it user executable:</p>\n\n<pre><code>#/bin/sh\nghc $(echo \"$*\" | sed 's/--interactive//g')\n</code></pre>\n\n<p>This takes the arguments, removes <code>--interactive</code>, and calls ghc.  With this, I can build stack using ghc via the following:</p>\n\n<p><code>stack ghci --with-ghc stack-run-ghc.sh --ghci-options src/main/Main.hs</code></p>\n"}], "owner": {"reputation": 5774, "user_id": 105137, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/253329f6f7506a5299db1cb608d8defd?s=128&d=identicon&r=PG", "display_name": "kostmo", "link": "https://stackoverflow.com/users/105137/kostmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1517302740, "creation_date": 1516605762, "last_edit_date": 1517261231, "question_id": 48376430, "link": "https://stackoverflow.com/questions/48376430/enable-package-wide-extensions-in-stack-runghc", "title": "Enable package-wide extensions in &quot;stack runghc&quot;", "body": "<p>If I have the following in my <code>package.yaml</code> file:</p>\n\n<pre><code>default-extensions:\n- LambdaCase\n</code></pre>\n\n<p>I am able to compile my project which makes use of the <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#lambdacase\" rel=\"nofollow noreferrer\">LambdaCase syntax</a> like this:</p>\n\n<pre><code>myFunction = \\case\n  Nothing -&gt; \"empty\"\n  Just x -&gt; x\n</code></pre>\n\n<p>However, if the project is run with <code>stack runghc</code>, the <code>LambdaCase</code> extension is not respected.</p>\n\n<p>My project has about 200 modules, so I would rather not have to add <code>{-# LANGUAGE LambdaCase #-}</code> to the top of every file.</p>\n\n<p>Is there a way to enable a project-wide GHC extension with <code>stack runghc</code> analogously to the package-wide <code>default-extensions</code> property in <code>package.yaml</code>?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1516571354, "post_id": 48371862, "comment_id": 83731098, "body": "<code>fmap</code> expects a function, whereas the expression <code>fmap (&#47;) x</code> produces a <code>Failable (a -&gt; a)</code> (because <code>&#47;</code> is a binary function). Maybe you&#39;re looking for <code>ap</code> instead of <code>fmap</code>."}], "answers": [{"comments": [{"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 1, "creation_date": 1516571932, "post_id": 48372075, "comment_id": 83731271, "body": "A more natural way to write that last implementation might be: <code>(&#47;) &lt;$&gt; x &lt;*&gt; y</code>."}, {"owner": {"reputation": 81, "user_id": 7334370, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-vlQRvZMKqto/AAAAAAAAAAI/AAAAAAAADu0/Oq_HBklkrwQ/photo.jpg?sz=128", "display_name": "M&#225;rton Kardos", "link": "https://stackoverflow.com/users/7334370/m%c3%a1rton-kardos"}, "edited": false, "score": 0, "creation_date": 1516572660, "post_id": 48372075, "comment_id": 83731458, "body": "You guys are amazing, I just started out on Applicatives, thanks for the response"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 2, "last_activity_date": 1516572077, "last_edit_date": 1516572077, "creation_date": 1516571494, "answer_id": 48372075, "question_id": 48371862, "link": "https://stackoverflow.com/questions/48371862/haskell-couldnt-match-expected-type-a-a-with-actual-type-failable-a/48372075#48372075", "title": "Haskell : Couldn&#39;t match expected type \u2018a -&gt; a\u2019 with actual type \u2018Failable (a -&gt; a)\u2019", "body": "<p>I've come up with this definition instead:</p>\n\n<pre><code>(//) :: (Eq a, Fractional a) =&gt; Failable a -&gt; Failable a -&gt; Failable a\n_ // (Success 0) = Failure \"Division by zero\"\nf@(Failure _) // _ = f\n_ // f@(Failure _) = f\n(Success v) // y = fmap (/v) y\n</code></pre>\n\n<p>What happens with your definition is that you are passing to <code>fmap</code> in the second equation of <code>(//)</code>, something of type <code>Failable (a -&gt; a)</code>, where it expects to have something of type <code>a -&gt; b</code>.</p>\n\n<p>What you can do is to make it an instance of <code>Applicative</code>, and make your <code>Functor</code> to be applicative, as follows:</p>\n\n<pre><code>class (Functor f) =&gt; Applicative f where  \n    pure :: a -&gt; f a  \n    (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b  \n</code></pre>\n\n<p>And make an instance of your functor likewise:</p>\n\n<pre><code>instance Applicative Failable where\n  pure = Success\n  (&lt;*&gt;) fun (Success x) = fmap (\\f -&gt; f x) fun\n</code></pre>\n\n<p>Therefore, you can define <code>(//)</code> as follows:</p>\n\n<pre><code>(//) :: (Eq a, Fractional a) =&gt; Failable a -&gt; Failable a -&gt; Failable a\n_ // (Success 0) = Failure \"Division by zero\"\nx // y = (&lt;*&gt;) (fmap (/) x) y\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>As Asad pointed out in the comments, a more natural and clearer way to write the last line would be:</p>\n\n<pre><code>x // y = (/) &lt;$&gt; x &lt;*&gt; y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1516571520, "creation_date": 1516571520, "answer_id": 48372077, "question_id": 48371862, "link": "https://stackoverflow.com/questions/48371862/haskell-couldnt-match-expected-type-a-a-with-actual-type-failable-a/48372077#48372077", "title": "Haskell : Couldn&#39;t match expected type \u2018a -&gt; a\u2019 with actual type \u2018Failable (a -&gt; a)\u2019", "body": "<p>I think you are trying to lift <code>(/)</code> to the <code>Failable</code> functor.\nYou could achieve that using pattern matching, but I think you want to do it using the <code>Functor</code> functions (<code>fmap</code>), alone.</p>\n\n<p>This is however impossible. At best, <code>fmap (/)</code> can provide</p>\n\n<pre><code>(/)      :: Num a =&gt; a          -&gt;           a -&gt; a\nfmap (/) :: Num a =&gt; Failable a -&gt; Failable (a -&gt; a)\n</code></pre>\n\n<p>and we have no general way to turn that ugly <code>Failable (a -&gt; a)</code> into <code>Failable a -&gt; Failable a</code>.</p>\n\n<p>This is why we have a more powerful type class: <code>Applicative</code>, for doing precisely that</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>So... congratulations. You have just discovered the issue for which such a type class was introduced.</p>\n\n<p>I'd recommend you write a <code>Applicative</code> instance. After that, (omitting the zero check)</p>\n\n<pre><code>(//) = liftA2 (/)\n-- or, (this being the most popular style, nowadays)\nx // y = (/) &lt;$&gt; x &lt;*&gt; y\n-- or,\nx // y = fmap (/) x &lt;*&gt; y\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 7334370, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-vlQRvZMKqto/AAAAAAAAAAI/AAAAAAAADu0/Oq_HBklkrwQ/photo.jpg?sz=128", "display_name": "M&#225;rton Kardos", "link": "https://stackoverflow.com/users/7334370/m%c3%a1rton-kardos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 48372077, "answer_count": 2, "score": 2, "last_activity_date": 1516572077, "creation_date": 1516569852, "last_edit_date": 1516571092, "question_id": 48371862, "link": "https://stackoverflow.com/questions/48371862/haskell-couldnt-match-expected-type-a-a-with-actual-type-failable-a", "title": "Haskell : Couldn&#39;t match expected type \u2018a -&gt; a\u2019 with actual type \u2018Failable (a -&gt; a)\u2019", "body": "<p>I'm trying to experiment with functors and safe division in Haskell, but I got this little error, and I can't really figure out why. </p>\n\n<p>here goes my code :</p>\n\n<pre><code>module Main\nwhere\n\ndata Failable a = Failure String | Success a\n\ninstance (Show a) =&gt; Show (Failable a) where\n    show (Failure s) = \"Failure : \" ++ s\n    show (Success x) = \"Success : \" ++ (show x)\n\ninstance Functor Failable where\n    fmap f (Success x) = Success (f x)\n    fmap _ (Failure s) = Failure s\n\n(//) :: (Num a) =&gt; Failable a -&gt; Failable a -&gt; Failable a\n_ // (Success 0) = Failure \"Division by zero\"\nx // y = fmap (fmap (/) x) y\n\nmain = do\n    print $ (Success 1) // (Success 2)\n</code></pre>\n\n<p>And the output :</p>\n\n<pre><code>main.hs:16:16:\nCouldn't match expected type \u2018a -&gt; a\u2019\n            with actual type \u2018Failable (a -&gt; a)\u2019\nRelevant bindings include\n  y :: Failable a (bound at main.hs:16:6)\n  x :: Failable a (bound at main.hs:16:1)\n  (//) :: Failable a -&gt; Failable a -&gt; Failable a\n    (bound at main.hs:15:1)\nPossible cause: \u2018fmap\u2019 is applied to too many arguments\nIn the first argument of \u2018fmap\u2019, namely \u2018(fmap (/) x)\u2019\nIn the expression: fmap (fmap (/) x) y\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "binary-search-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516564342, "post_id": 48371006, "comment_id": 83728845, "body": "Why do you use parenthesis that way? Pattern matching is also linear: you can not use the same variable name twice in the head of a function."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1516564705, "post_id": 48371006, "comment_id": 83728952, "body": "Your second <code>if</code> in the node case is missing an <code>else</code>."}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566218, "post_id": 48371006, "comment_id": 83729529, "body": "I&#39;ve updated my question to be more specifically about the recursive call line now"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516567560, "post_id": 48371006, "comment_id": 83729949, "body": "<code>h</code> is an <code>Int</code>, and you can compare that directly -- replace <code>h.value</code> with <code>h</code>. Remember that every <code>if</code> needs an <code>else</code>: you have to handle the &quot;equal&quot; case on <code>Node</code>."}], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516564916, "post_id": 48371084, "comment_id": 83729049, "body": "Thank you, I&#39;ve gotten the insideBST i (Leaf z) = i == z line working , and I reformated my third line to look like :    insideBST i (Node h l r) = if i &gt; r then inBST i r                But now that third line returns a &quot; parse error (possibly incorrect indentation or mismatched brackets)  &quot; . Is there some indentation for an if statement I&#39;m missing?"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516565374, "post_id": 48371084, "comment_id": 83729216, "body": "oh wait well for one my r value is a tree not an Int"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516565991, "post_id": 48371084, "comment_id": 83729449, "body": "okay so for a line like this:   &quot;     insideBST i (Node h l r) = if h.value &gt; i then insideBST i l else if h.value &lt; i then insideBST i r         &quot;   is it possible to get the int value for the head simply like that? I know of course you can&#39;t do h.value in haskell, thats just to show the effect I&#39;d like to obtain"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566202, "post_id": 48371084, "comment_id": 83729525, "body": "I&#39;ve updated my question to be more specifically about this line now"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566236, "post_id": 48371084, "comment_id": 83729535, "body": "I can&#39;t help you with that part, you didn&#39;t show your data declaration."}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566650, "post_id": 48371084, "comment_id": 83729670, "body": "Sorry, I&#39;ve updated my question to show the declaration"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566747, "post_id": 48371084, "comment_id": 83729699, "body": "So <code>h</code> is an <code>Int</code> not some product type.  Just use <code>h</code> instead of <code>h.value</code>."}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516566902, "post_id": 48371084, "comment_id": 83729748, "body": "okay, Im still getting an &quot; parse error (possibly incorrect indentation or mismatched brackets) &quot; error. My code is:   <a href=\"https://justpaste.it/1g0eh\" rel=\"nofollow noreferrer\">justpaste.it/1g0eh</a>     [ sorry for other site link, just wanted to paste it somewhere so you could see the formatting of indentations ]"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516567337, "post_id": 48371084, "comment_id": 83729872, "body": "edit: nvm, I looked online and realized I was missing my last else statement. everything works now. thank you so much for your help"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1516564623, "creation_date": 1516564623, "answer_id": 48371084, "question_id": 48371006, "link": "https://stackoverflow.com/questions/48371006/checking-if-an-int-is-in-a-bst-haskell/48371084#48371084", "title": "checking if an Int is in a BST Haskell", "body": "<p>You have a few syntactic errors in your function definition and one semantic issue.  From the top, you said:</p>\n\n<pre><code>insideBST (i Leaf i) = True\n</code></pre>\n\n<p>This pattern makes no sense. When you have a function with separate arguments you don't combine them inside a single parenthetical.  The fixed syntax is:</p>\n\n<pre><code>insideBST i (Leaf i) = True\n</code></pre>\n\n<p>... But the semantics is wrong.  You can't bind <code>i</code> to two different values - it does not mean \"these two values are the same\" as in prolog like languages.  Instead:</p>\n\n<pre><code>insideBST i (Leaf l) = i == l\n</code></pre>\n\n<p>The same syntactic fix can be done for the <code>Node</code> line of <code>insideBST</code>, but you also need to fix that to use the same function name - you seemed to have switched to <code>inBST</code>, now we have:</p>\n\n<pre><code>insideBST i (Node h l r) = ...\n</code></pre>\n\n<p>Finally, your function application is just a space and not parenthesis like you've used.  As a result <code>inBST (i r)</code> is parsed as applying the function <code>i</code> to the argument <code>r</code> then applying the function <code>inBST</code> to that result.   Use <code>insideBST i r</code>. </p>\n"}], "owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 48371084, "answer_count": 1, "score": -1, "last_activity_date": 1516566670, "creation_date": 1516564129, "last_edit_date": 1516566670, "question_id": 48371006, "link": "https://stackoverflow.com/questions/48371006/checking-if-an-int-is-in-a-bst-haskell", "title": "checking if an Int is in a BST Haskell", "body": "<p>I'm trying to design a function in haskell to check if a Binary Search Tree contains an integer, and if it does the function will return the bool 'True'. Since I'm dealing with BST's, I have a pretty good idea of how to complete this function, but am having trouble when dealing with the passed in integer. My current outline looks like this:</p>\n\n<pre><code>insideBST :: Int -&gt; Tree -&gt; Bool       --function receives input Int, and a tree, returns bool\ninsideBST (i Leaf i) = True   --base case, if function receives leaf whose int matches what was passed in to function, return True.\ninsideBST (i Node h l r) = if i &gt; r then insideBST(i r)   --if i &gt; root, inBST(r)\n                       else if i &lt; r then insideBST(i l)   --if i &lt; root, insideBST(l)\n</code></pre>\n\n<p>But I'm having trouble with the second line determining (i leaf i), my intention was to check if the int received in this function is the same as the int of the leaf, and if so return True. But I'm getting a Parse error in pattern: i, </p>\n\n<p>How do I write this correctly? checking if the int received matches the int of the leaf</p>\n\n<p>------------- EDIT --------------</p>\n\n<p>After some great help I've fixed the glaring errors in my original code:</p>\n\n<pre><code>insideBST i (Leaf z) = i == z              -- if leaf i value = int i recieved, return True\ninsideBST i (Node h l r) = if h.value &gt; i then insideBST i l else if h.value &lt; i then insideBST i r\n</code></pre>\n\n<p>Now my question is with my last line, I want it so that if the Int value of head  is greater than the i Int value, it will call the insideBST function for the left subtree, else if head is not greater than i, it will call the right subtree. This code gives me an parse error (possibly incorrect indentation or mismatched brackets)\nIs it something with my long if statement? Maybe that isnt formatted correctly</p>\n\n<p>This is my tree declaration:</p>\n\n<p>data Tree = Node Int Tree Tree | Leaf Int\n  deriving (Eq,Show)</p>\n"}, {"tags": ["list", "haskell", "fibonacci"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1516563959, "post_id": 48370947, "comment_id": 83728712, "body": "&quot;Causes error&quot; should include the actual error message."}, {"owner": {"reputation": 71, "user_id": 5668727, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aaa6f733ff4ec88dbfc1fe5fea5975a6?s=128&d=identicon&r=PG&f=1", "display_name": "Bonny Mahajan", "link": "https://stackoverflow.com/users/5668727/bonny-mahajan"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1516564187, "post_id": 48370947, "comment_id": 83728793, "body": "@ThomasM.DuBuisson done"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516564932, "post_id": 48370947, "comment_id": 83729057, "body": "What is the meaning of <code>map snd listNum $ filter (\\x -&gt; x `elem` primes) [1,2 ..]</code> supposed to be?"}, {"owner": {"reputation": 71, "user_id": 5668727, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aaa6f733ff4ec88dbfc1fe5fea5975a6?s=128&d=identicon&r=PG&f=1", "display_name": "Bonny Mahajan", "link": "https://stackoverflow.com/users/5668727/bonny-mahajan"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516564984, "post_id": 48370947, "comment_id": 83729075, "body": "I was trying to say filter using the indexes which will be [1, 2 .. ] ( so as to get those indexes that are prime or in the list of primes)                              and once done stitch map snd ( i.e. second ) elements - so the actual fibbonaci elements - into a single list and return that @FyodorSoikin"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516574250, "post_id": 48370947, "comment_id": 83731867, "body": "How long does it take to work out <code>elem 4 primes</code>?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516580661, "post_id": 48370947, "comment_id": 83733444, "body": "The <code>$</code> operator is not for stitching lists. Use <code>++</code> for that."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1516622921, "last_edit_date": 1516622921, "creation_date": 1516583434, "answer_id": 48373470, "question_id": 48370947, "link": "https://stackoverflow.com/questions/48370947/show-all-numbers-at-prime-indexes-in-a-list-haskell-filter-error/48373470#48373470", "title": "Show all numbers at prime indexes in a list - haskell - filter error", "body": "<p>Here's what I think you intended as the original logic of <code>partC</code>. You got the syntax mostly right, but the logic has a flaw.</p>\n\n<pre><code>partC = snd &lt;$&gt; filter ((`elem` primes) . fst) (zip [1..] fib)\n-- note that (&lt;$&gt;) = fmap = map, just infix\n-- list comprehension\npartC = [fn | (idx, fn) &lt;- zip [1..] fib, idx `elem` primes]\n</code></pre>\n\n<p>But this cannot work. As @DanRobertson notes, you'll try to check <code>4 `elem` primes</code> and run into an infinite loop, because <code>primes</code> is infinite and <code>elem</code> tries to be <em>really sure</em> that <code>4</code> isn't an element before giving up. We humans know that <code>4</code> isn't an element of <code>primes</code>, but <code>elem</code> doesn't.</p>\n\n<p>There are two ways out. We can write a custom version of <code>elem</code> that gives up once it finds an element larger than the one we're looking for:</p>\n\n<pre><code>sortedElem :: Ord a =&gt; a -&gt; [a] -&gt; Bool\nsortedElem x (h:tl) = case x `compare` h of\n                           LT -&gt; False\n                           EQ -&gt; True\n                           GT -&gt; sortedElem x tl\nsortedElem _ [] = False\n-- or\nsortedElem x = foldr (\\h tl -&gt; case x `compare` h of\n                                    LT -&gt; False\n                                    EQ -&gt; True\n                                    GT -&gt; tl\n                     ) False\n</code></pre>\n\n<p>Since <code>primes</code> is a sorted list, <code>sortedElem</code> will always give the correct answer now:</p>\n\n<pre><code>partC = snd &lt;$&gt; filter ((`sortedElem` primes) . fst) (zip [1..] fib)\n</code></pre>\n\n<p>However, there is a performance issue, because every call to <code>sortedElem</code> has to start at the very beginning of <code>primes</code> and walk all the way down until it figures out whether or not the index is right. This leads into the second way:</p>\n\n<pre><code>partC = go primeDiffs fib\n  where primeDiffs = zipWith (-) primes (1:primes)\n     -- primeDiffs = [1, 1, 2, 2, 4, 2, 4, 2, 4, 6, ...]\n     -- The distance from one prime (incl. 1) to the next\n        go (step:steps) xs = x:go steps xs'\n          where xs'@(x:_) = drop step xs\n        go [] _ = [] -- unused here\n     -- in real code you might pull this out into an atOrderedIndices :: [Int] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>We transform the list of indices (<code>primes</code>) into a list of offsets, each one building on the next, and we call it <code>primeDiffs</code>. We then define <code>go</code> to take such a list of offsets and extract elements from another list. It first <code>drop</code>s the elements being skipped, and then puts the top element into the result before building the rest of the list. Under <code>-O2</code>, on my machine, this version is twice as fast as the other one when finding <code>partC !! 5000</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 5668727, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aaa6f733ff4ec88dbfc1fe5fea5975a6?s=128&d=identicon&r=PG&f=1", "display_name": "Bonny Mahajan", "link": "https://stackoverflow.com/users/5668727/bonny-mahajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517004142, "creation_date": 1516563789, "last_edit_date": 1517004142, "question_id": 48370947, "link": "https://stackoverflow.com/questions/48370947/show-all-numbers-at-prime-indexes-in-a-list-haskell-filter-error", "title": "Show all numbers at prime indexes in a list - haskell - filter error", "body": "<p>This is for a class\nWe're supposed to write 3 functions : </p>\n\n<p>1 : Prints list of fibbonaci numbers\n2 : Prints list of prime numbers\n3 : Prints list of fibonacci numbers whose indexes are prime</p>\n\n<p>EG : Let this be fibbonaci series </p>\n\n<p>Then In partC - certain elements are only shown</p>\n\n<p>1: 1</p>\n\n<p>*2: 1 (shown as index 2 is prime ) </p>\n\n<p>*3: 2  (shown as index 3 is prime )</p>\n\n<p>4: 3</p>\n\n<p>*5: 5 (shown )</p>\n\n<p>6: 8</p>\n\n<p>*7: 13  (shown as index 7 prime and so on)</p>\n\n<p>I'm done with part 1 &amp; 2 but I'm struggling with part 3. I created a function listNum that creates a sort of mapping [Integer, Integer] from the Fibbonaci series - where 1st Int is the index and 2nd int is the actual fibbonaci numbers.</p>\n\n<p>Now my function partC is trying to stitch snd elements of the fibonaci series by filtering the indexes but I'm doing something wrong in the filter step.</p>\n\n<p>Any help would be appreciated as I'm a beginner to Haskell.\nThanks!</p>\n\n<pre><code>   fib :: [Integer]\n   fib = 0 : 1 : zipWith (+) fib (tail fib)\n\n   listNum :: [(Integer, Integer)]\n   listNum = zip [1 .. ] fib\n\n   primes :: [Integer]\n   primes = sieve (2 : [3,5 ..])\n\n        where\n            sieve (p:xs) = p : sieve [x | x &lt;- xs , x `mod` p &gt; 0]\n\n   partC :: [Integer]  -- Problem in filter part of this function\n   partC = map snd listNum $ filter (\\x -&gt; x `elem` primes) [1,2 ..]\n\n   main = do\n      print (take 10 fib)    -- Works fine\n      print (take 10 primes) --works fine\n      print (take 10 listNum) --works fine\n      print ( take 10 partC) -- Causes error \n</code></pre>\n\n<p>Error : </p>\n\n<pre><code>prog0.hs:14:9: error:\n    \u2022 Couldn't match expected type \u2018[Integer] -&gt; [Integer]\u2019\n              with actual type \u2018[Integer]\u2019\n    \u2022 The first argument of ($) takes one argument,\n     but its type \u2018[Integer]\u2019 has none\n     In the expression:\n    map snd listNum $ filter (\\ x -&gt; x `elem` primes) [1, 2 .. ]\n  In an equation for \u2018partC\u2019:\n      partC\n        = map snd listNum $ filter (\\ x -&gt; x `elem` primes) [1, 2 .. ]\n\n\n\n  |\n    14 | partC = map snd listNum $ filter (\\x -&gt; x `elem` primes) [1,2 ..]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516563700, "post_id": 48370927, "comment_id": 83728621, "body": "You do not design something to a variable, you declare a variable, that is something different."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516563786, "post_id": 48370927, "comment_id": 83728646, "body": "You could define a function <code>withbar x = x 2 3</code>, and then use <code>withbar foo</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1516566464, "post_id": 48370927, "comment_id": 83729613, "body": "No, you can&#39;t do that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1516567798, "post_id": 48370927, "comment_id": 83730036, "body": "You don&#39;t want to use tuples, but that&#39;s exactly what is needed here, together with (un)currying."}], "answers": [{"tags": [], "owner": {"reputation": 1600, "user_id": 3946040, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/J512N.png?s=128&g=1", "display_name": "Zak", "link": "https://stackoverflow.com/users/3946040/zak"}, "is_accepted": false, "score": 1, "last_activity_date": 1516584647, "last_edit_date": 1516584647, "creation_date": 1516584261, "answer_id": 48373553, "question_id": 48370927, "link": "https://stackoverflow.com/questions/48370927/haskell-assigning-multiple-values-to-something-so-they-could-be-passed-to-a-fu/48373553#48373553", "title": "Haskell | Assigning multiple values to something so they could be passed to a function as a single argument", "body": "<p>In order to get your example of <code>foo bar == 5</code> to work, you need to make sure the types match...</p>\n\n<p><code>foo</code> takes two <code>Int</code>s and returns an <code>Int</code> and has type <code>foo :: Int -&gt; (Int -&gt; Int)</code>. The brackets aren't strictly necessary but I've added them in for clarity (<code>-&gt;</code> is right-associative).</p>\n\n<p>You can see from this that your example won't work. You're trying to pass a function <code>bar</code> as the first argument where it's actually expecting an <code>Int</code>. The only way this would work is if <code>bar</code> returned an <code>Int</code> in which case you would only be able to pass in one variable.</p>\n\n<p>Because of the bracketing above, you can't give <code>foo</code> an <code>(Int -&gt; Int)</code> as an argument. This would be the only way to pass in two variables without tuples or something else but isn't possible.</p>\n\n<p>So unfortunately, I think the best way to achieve this would be with tuples and perhaps <code>uncurry</code> as suggested. Interesting question though!</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1516626481, "post_id": 48374059, "comment_id": 83751335, "body": "E<a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Cont.html#v:callCC\" rel=\"nofollow noreferrer\">cc</a>entric pun intended?"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 5, "last_activity_date": 1518327044, "last_edit_date": 1518327044, "creation_date": 1516589317, "answer_id": 48374059, "question_id": 48370927, "link": "https://stackoverflow.com/questions/48370927/haskell-assigning-multiple-values-to-something-so-they-could-be-passed-to-a-fu/48374059#48374059", "title": "Haskell | Assigning multiple values to something so they could be passed to a function as a single argument", "body": "<p>There's the sane answer:</p>\n\n<pre><code>Data.Tuple.uncurry :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c\ndata A; data B; data C\nfoo :: A -&gt; B -&gt; C\nbar :: (A, B)\nuncurry foo bar :: C\n</code></pre>\n\n<p>There's the eccentric answer:</p>\n\n<pre><code>bar :: (A -&gt; B -&gt; c) -&gt; c\nbar f = f A B\nbar foo :: C\n</code></pre>\n\n<p>There's the cheating answer:</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\n#define bar A B\nfoo bar :: C\n-- expansion: foo A B :: C\n-- Don't try to use this in any other way!\n-- (bar, 2) ~&gt; (A B, 2) -&gt; error\n-- It's incredibly unhygienic and WILL explode at some point\n-- You probably want to uppercase the name to make it stick out\n-- Or maybe\n#undef bar\n#define AP2(x) (fst (x)) (snd (x))\nbar :: (A, B)\nfoo AP2(bar) :: C\n#define BAR AP2(bar)\nfoo BAR :: C\n-- expansion: foo (fst (A, B)) (snd (A, B))\n</code></pre>\n\n<p>There's the dependent answer (which is just a boosted <code>uncurry</code>):</p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleInstances, FlexibleContexts, FunctionalDependencies, GADTs, MultiParamTypeClasses, TypeOperators, UndecidableInstances #-}\n\ndata HList (xs :: [*]) where\n  Hil :: HList '[]\n  Hons :: x -&gt; HList xs -&gt; HList (x : xs)\n\nclass AppHList f (a :: [*]) r | f a -&gt; r where\n  appHList :: f -&gt; HList a -&gt; r\ninstance AppHList x '[] x where\n  appHList x Hil = x\ninstance (f ~ (a -&gt; b), a ~ x, AppHList b xs r) =&gt; AppHList f (x : xs) r where\n  appHList f (Hons x xs) = appHList (f x) xs\n\n-- if it's not obvious, HLists of two elements are isomorphic to 2-tuples\n-- toT (Hons a (Hons b Hil)) = (a, b)\n-- toH (a, b) = (Hons a (Hons b Hil))\n-- toT . toH = id = toH . toT\n-- and we get\n-- uncurry = (. toH) . appHList\n-- so, on some level, they are the same\n\nbar :: HList [A, B]\nbar = Hons A$Hons B$Hil\nappHList foo bar :: C\n</code></pre>\n\n<p>There's the <em>unhinged</em> answer:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleInstances, GADTs, TypeOperators #-}\nimport GHC.TypeLits\n\nclass FooType t\n  foo :: t\n-- GADTs is only here for the ~s, and they aren't really needed\n-- They're only here to make foo (B, A) a \"needed (A, B) got (B, A)\"\n-- instead of a \"instance not found\"\ninstance (a ~ A, b ~ B) =&gt; FooType ((a, b) -&gt; C) where\n  foo (a, b) = foo a b \ninstance FooType (A -&gt; B -&gt; C) where\n  foo a b = _\n-- This instance pulls in GHC.TypeLits, DataKinds, TypeOperators, and UndecidableInstances\n-- all in the name of pretty error messages.\ninstance {-# OVERLAPPABLE #-} TypeError (Text \"foo is a function from \"\n                                    :&lt;&gt;: ShowType A\n                                    :&lt;&gt;: Text \" and \"\n                                    :&lt;&gt;: ShowType B\n                                    :&lt;&gt;: Text \" to \"\n                                    :&lt;&gt;: ShowType C\n                                    :$$: Text \"It may not be given the type \"\n                                    :&lt;&gt;: ShowType t\n                                         ) =&gt; FooType t where\n  foo = undefined\n</code></pre>\n\n<p>There's the real answer:</p>\n\n<p>No. The simple and utter fact is that <code>foo</code> has two <code>(-&gt;)</code>s in its type, and that means you need two function applications to consume it completely. There are various tricks (in order, <code>uncurry</code>, continuation passing style, going outside the language to circumvent its rules, funky pseudo-dependently-typed \"fun stuff\", and overloading <code>foo</code>) to move this burden somewhere else (resp. in <code>uncurry</code>'s definition, in <code>bar</code>'s definition, in the expanded post-CPP code, in <code>appHList</code>, in one of the instances of <code>FooType</code>) but none of them really achieve what you want. (CPS is backwards and notoriously hard to read, CPP is just broken, and the typeclass thing requires massively modifying <code>foo</code> (most of the language extensions were just for effect; sue me), and <code>uncurry</code> and its fancier cousin <code>appHList</code> require an extra function call).</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1518327044, "creation_date": 1516563640, "question_id": 48370927, "link": "https://stackoverflow.com/questions/48370927/haskell-assigning-multiple-values-to-something-so-they-could-be-passed-to-a-fu", "title": "Haskell | Assigning multiple values to something so they could be passed to a function as a single argument", "body": "<p>Is it possible to \"assign\" and pass values in Haskell in the following way:</p>\n\n<pre><code>foo :: Int -&gt; Int -&gt; Int\nfoo x y = x + y\n\nbar :: ??\nbar = 2 3 -- ??\n\nfoo bar == 5\n</code></pre>\n\n<p>Foo is some function that takes two ints. I want to assign those ints to a single bar and pass that bar to foo so that it could yield it's result. I would like to achieve this without using tuples, new types or value separation like this:</p>\n\n<pre><code>bar1 = 2\nbar2 = 3\nfoo bar1 bar2 == 5\n</code></pre>\n\n<p>This question is out of curiosity and not any practical reason.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516559226, "post_id": 48370125, "comment_id": 83727073, "body": "It is actually very weird to define an <code>Eq</code> like this: it does not satisfy the <i>equality constraints</i>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516559305, "post_id": 48370125, "comment_id": 83727104, "body": "Whether this is a reasonable way to define <code>==</code> aside, what you&#39;ve actually done is just state that any <code>Concat</code> is equal to another <code>Concat</code> regardless of what they contain."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516560165, "post_id": 48370125, "comment_id": 83727411, "body": "This is a tricky data structure to write an <code>Eq</code> instance for, because simple recursion isn&#39;t enough. I assume you would want something like <code>Concat (Concat (Text &quot;foo&quot;) (Text &quot;bar&quot;)) (Test &quot;baz&quot;)</code> and <code>Concat (Text &quot;foo&quot;) (Concat (Text &quot;bar&quot;) (Text &quot;baz&quot;))</code> to be considered equal."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516560715, "post_id": 48370125, "comment_id": 83727608, "body": "That is, <code>Concat a b == Concat c d</code> can be true without <code>a == c</code> or <code>b == d</code> being true. Your data type doesn&#39;t provide a unique representation for a single document; it combines modeling a <i>document</i> with the concatenation operation on two documents. A simple type like <code>newtype Doc = Doc [Text]</code> seems more reasonable, with a separate <code>concatDoc</code> function to combine two documents into one."}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561244, "post_id": 48370125, "comment_id": 83727780, "body": "Ah I see, I thought I was just checking that as well but didn&#39;t come up with anything else, I&#39;ll be giving it a try with all the suggestions :)"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516559509, "post_id": 48370251, "comment_id": 83727170, "body": "Isn&#39;t this a complicated way to write <code>_ == _ = False</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516559580, "post_id": 48370251, "comment_id": 83727204, "body": "@ReinHenrichs because of the whitespace?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516559617, "post_id": 48370251, "comment_id": 83727215, "body": "Because nodes are equal if leaves are equal, but leaves are never equal. The base case is always something that returns <code>False</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516559699, "post_id": 48370251, "comment_id": 83727243, "body": "@ReinHenrichs \u2026 time to log off for today. Sorry."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516560517, "post_id": 48370251, "comment_id": 83727544, "body": "It happens to the best of us."}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561477, "post_id": 48370251, "comment_id": 83727864, "body": "Thanks for your help Zeta, clear and straight to where my issue was :)"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 1, "last_activity_date": 1516559668, "last_edit_date": 1516559668, "creation_date": 1516559437, "answer_id": 48370251, "question_id": 48370125, "link": "https://stackoverflow.com/questions/48370125/custom-eq-instance-for-data-type/48370251#48370251", "title": "Custom Eq Instance for Data Type", "body": "<p>According to your code, any <code>Concat</code> will be equal to another <code>Concat</code>. Let's try to check the equality by hand:</p>\n\n<pre><code>Concat NewLine (Text \"Huh\") == Concat (Text \"Example\") (Text \"Concat\")\n= True -- inserted definition of `==`\n</code></pre>\n\n<p>We never look at the elements of your <code>Concat</code>. But at some point we have to check that <code>Newline == Text \"Example\"</code> and return <code>False</code>. An important hint is that you never inspect <code>a1</code>, <code>b1</code> and so on. As soon as we try to use them, the instance comes naturally:</p>\n\n<pre><code>instance Eq Doc where\n  Concat a1 b1 == Concat a2 b2 = a1 == a2 &amp;&amp; b1 == b2\n  Text ...     == ...          = -- left as exercise\n  Newline ...  == ...          = -- left as exercise\n  _            == _            = False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561381, "post_id": 48370414, "comment_id": 83727834, "body": "Hey Rein, thank you so much, very very clear and deep but easy to understand explanation, have a good one mate :D"}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561758, "post_id": 48370414, "comment_id": 83727940, "body": "EDIT: I ran into some issues, my example should be returning <code>True</code> and it&#39;s giving me <code>False</code> instead"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561800, "post_id": 48370414, "comment_id": 83727961, "body": "Which definition are you using? Your example is not structurally equal."}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516561890, "post_id": 48370414, "comment_id": 83727989, "body": "I&#39;m using the first one since I was already trying to go down that way, reading your post again, I missed some information, I&#39;ll be trying with the generate, but just one thing, is there anyway to make the 1st example verify if the generated doc is equal instead of structure?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 1, "creation_date": 1516562156, "post_id": 48370414, "comment_id": 83728093, "body": "You could add a case for <code>Concat a (Concat b c) == Concat (Concat a&#39; b&#39;) c&#39;</code>, but that would only handle that one case. It wouldn&#39;t also handle <code>Concat (Text &quot;foo&quot;) NewLine == Text &quot;foo\\n&quot;</code>. There are too many special cases to handle elegantly. The easiest way to get non-structural equality is to do as diagrams does and consider <code>Doc</code> as a quotient type, using <code>(==) `on` generate</code> as an equivalence relation: &quot;Two docs are equal if they generate equal things.&quot;"}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516562255, "post_id": 48370414, "comment_id": 83728136, "body": "Ah ok, yea that would make it really limited, thanks for all your help and time, appreciate it, I&#39;ve got it all figured out now thanks to you! Cya next time :D"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516562501, "post_id": 48370414, "comment_id": 83728217, "body": "You&#39;re welcome! Also FWIW: this idea of &quot;transporting the question from a domain where the answer is hard to a domain where the answer is easy and then asking it there&quot; is the motivation for Category Theory and, in some ways, most of programming."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516637248, "post_id": 48370414, "comment_id": 83758815, "body": "What does &quot;does not satisfy the equality constraints&quot; mean, exactly?"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 4, "last_activity_date": 1516561062, "last_edit_date": 1516561062, "creation_date": 1516560371, "answer_id": 48370414, "question_id": 48370125, "link": "https://stackoverflow.com/questions/48370125/custom-eq-instance-for-data-type/48370414#48370414", "title": "Custom Eq Instance for Data Type", "body": "<p>There are two questions here, so let's take them in turn.</p>\n\n<p><strong>What's wrong with my definition?</strong></p>\n\n<p>You define any two <code>Concat</code> documents as equal, regardless of what they contain. You also define any other values as inequal, regardless of what they contain. This means that, for instance,</p>\n\n<pre><code>Concat (Text \"foo\") Newline == Concat (Text \"bar\") Newline\n</code></pre>\n\n<p>gives <code>True</code>, while</p>\n\n<pre><code>Text \"foo\" == Text \"foo\"\n</code></pre>\n\n<p>gives <code>False</code>.</p>\n\n<p>Let's write a definition for <em>structural equality</em> instead: two <code>Doc</code>s are equal if they have the same structure:</p>\n\n<pre><code>instance Eq Doc where\n  -- Concats are equal if the things they are concat-ing are equal\n  Concat a b == Concat a' b' = a == a' &amp;&amp; b == b'\n  -- Newlines are always equal\n  NewLine = NewLine = True\n   -- Two texts are equal if the text they contain is equal\n  Text a = Text a' = a == a'\n  -- Everything else is inequal\n  _ = _ = False\n</code></pre>\n\n<p><strong>How can I write an Eq instance that doesn't care about structure, only whether the generated documents are the same?</strong></p>\n\n<p>If we want to compare the generated documents, we can do just that:</p>\n\n<pre><code>instance Eq Doc where\n  doc == doc' = generate doc == generate doc'\n</code></pre>\n\n<p>assuming that <code>generate :: Doc -&gt; String</code> does what it says. We can also use <code>on</code> from <code>Data.Function</code> to write this as</p>\n\n<pre><code>(==) == (==) `on` generate\n</code></pre>\n\n<p>As William mentions in the comments, this \"does not satisfy the equality constraints\". However, there is precedent for this: the <a href=\"http://hackage.haskell.org/package/diagrams\" rel=\"nofollow noreferrer\">diagrams</a> package considers two diagrams to be equivalent if they generate the same instructions for drawing a diagram. The reasoning behind this is explored in <a href=\"https://repository.upenn.edu/cgi/viewcontent.cgi?article=1773&amp;context=cis_papers\" rel=\"nofollow noreferrer\">the paper introducing Diagrams</a>:</p>\n\n<blockquote>\n  <p>The particularly attentive reader may have noticed something\n  strange about this Semigroup instance: (&lt;>) is not associative!\n  d1 &lt;> (d2 &lt;> d3) and (d1 &lt;> d2) &lt;> d3 are not equal, since they result\n  in trees of two different shapes. However, intuitively it seems that\n  d1 &lt;> (d2 &lt;> d3) and (d1 &lt;> d2) &lt;> d3 are still \u201cmorally\u201d the same, that is,\n  they are two representations of \u201cthe same\u201d diagram. We can formalize\n  this idea by considering Diagram as a quotient type, using some\n  equivalence relation other than structural equality. In particular, associativity\n  does hold if we consider two diagrams d1 and d2 equivalent\n  whenever unD d1 \u2261 unD d2, where unD::Diagram \u2192 [Prim]\n  \u201ccompiles\u201d a Diagram into a flat list of primitives.</p>\n</blockquote>\n"}], "owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "accepted_answer_id": 48370414, "answer_count": 2, "score": 1, "last_activity_date": 1516561062, "creation_date": 1516558544, "question_id": 48370125, "link": "https://stackoverflow.com/questions/48370125/custom-eq-instance-for-data-type", "title": "Custom Eq Instance for Data Type", "body": "<p>I'm having some issues getting to create my own Eq instance for my data type.</p>\n\n<p>This is my code:</p>\n\n<pre><code>data Doc = Empty -- Adds \"\"\n    | Text String\n    | NewLine -- Adds \"\\n\"\n    | Concat Doc Doc -- Joins two Doc's\n\ninstance (Eq Doc) =&gt; Eq (Doc) where\n    Concat a1 b1 == Concat a2 b2 = True\n    _ == _ = False\n</code></pre>\n\n<p>My objective is that it only returns <code>True</code> when the final Doc is the same, for example:</p>\n\n<pre><code>*Main&gt; Concat (Concat (Text \"The \") (Text \"birds\"))(Concat Empty NewLine) == Concat Empty (Text \"The birds\\n\")\n</code></pre>\n\n<p>This should be <code>True</code> and with the code I have it does return True, but it's returning True every single time, even if I have totally different sentences.</p>\n\n<p>I've been battling around with this for a while and searched around but came up with nothing. Any of you guys have any idea or suggestion as to what I'm doing wrong here?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 4, "last_activity_date": 1516559279, "creation_date": 1516559279, "answer_id": 48370230, "question_id": 48370023, "link": "https://stackoverflow.com/questions/48370023/reader-monad-clarification/48370230#48370230", "title": "Reader Monad clarification", "body": "<p>To answer your function, <code>Monad</code> is class over types of <em>kind</em> <code>* -&gt; *</code>.</p>\n\n<ul>\n<li><code>[Int] :: *</code> = list of integers</li>\n<li><code>[] :: * -&gt; *</code> = list</li>\n<li><code>Reader e a :: *</code> = reader with environment e resulting in a</li>\n<li><code>Reader e :: * -&gt; *</code> = reader with environment e</li>\n<li><code>Reader :: * -&gt; * -&gt; *</code> = reader</li>\n</ul>\n\n<p>We are lousy when we say <em><code>Reader</code> has a monad instance</em>, when we mean\n<em><code>Reader</code> with any environment has a monad instance</em>.</p>\n\n<p>(Similarly, <code>Writer w</code> is a <code>Monad</code> when <code>w</code> is a <code>Monoid</code>, <code>Writer</code> isn't a\n<code>Monad</code>).</p>\n\n<hr>\n\n<p>To answer your second question, it's easier to think in terms of\nthe <code>Reader e a</code> as the same as function <code>e -&gt; a</code>.</p>\n\n<p>Function has the same monad definition, but without <code>newtype</code> wrappers and\nunwrappers. Think <code>Reader = (-&gt;)</code>:</p>\n\n<pre><code>instance Monad ((-&gt;) e) where\n    return x = \\_ -&gt; x -- alternatively, return = const !\n    r &gt;&gt;= f  = \\e -&gt; f (r e) e\n</code></pre>\n\n<p>Yet, the <code>join</code> definition is probably most insightful:</p>\n\n<pre><code>join :: Reader e (Reader e a) -&gt; Reader e a\n</code></pre>\n\n<p>But with bare function:</p>\n\n<pre><code>join :: (e -&gt; e -&gt; a) -&gt; (e -&gt; a)\njoin f e = f e e\n</code></pre>\n\n<p>And if we write it for <code>Reader</code> we have to add <code>runReader</code> and <code>Reader</code> in\nright places (and move variable binding to the lambda on RHS):</p>\n\n<pre><code>join f = Reader $ \\e -&gt; runReader (runReader f e) e\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1516559300, "creation_date": 1516559300, "answer_id": 48370234, "question_id": 48370023, "link": "https://stackoverflow.com/questions/48370023/reader-monad-clarification/48370234#48370234", "title": "Reader Monad clarification", "body": "<ol>\n<li><p>There's no partial application. <code>Reader</code> is a <code>newtype</code> definition that 'wraps' exactly <em>one</em> value (<code>runReader</code>), which is a function of the type <code>e -&gt; a</code>. So, <code>Reader r</code> just pattern-matches the function out of the <code>Reader</code> wrapper. <code>r</code> is bound to the function of type <code>e -&gt; a</code>.</p></li>\n<li><p><code>f</code> is a function, as is <code>r</code>. <code>r e</code> invokes the function <code>r</code> with the value <code>e</code>, and then <code>f</code> is invoked with the result of that function call.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 9, "last_activity_date": 1516560512, "last_edit_date": 1516560512, "creation_date": 1516559553, "answer_id": 48370270, "question_id": 48370023, "link": "https://stackoverflow.com/questions/48370023/reader-monad-clarification/48370270#48370270", "title": "Reader Monad clarification", "body": "<blockquote>\n  <p>My first question is, why is Reader partially applied on the left hand side of bind? <code>(Reader r)</code> instead of <code>(Reader r a)</code>.</p>\n</blockquote>\n\n<p>It isn\u2019t. That use of <code>Reader</code> is fully saturated, as it must be. However, I can understand your confusion\u2026 remember that in Haskell, types and values are in different namespaces, and defining a datatype with <code>data</code> or <code>newtype</code> brings new names into scope in both namespaces. For example, consider the following declaration:</p>\n\n<pre><code>data Foo = Bar | Baz\n</code></pre>\n\n<p>This definition binds three names, <code>Foo</code>, <code>Bar</code>, and <code>Baz</code>. However, the part on the left-hand side of the equals sign is bound in the type namespace, since <code>Foo</code> is a type, and the constructors on the right hand side are bound in the value namespace, since <code>Bar</code> and <code>Baz</code> are essentially values.</p>\n\n<p>All of these things have types as well, which can be helpful to visualize. <code>Foo</code> has a <em>kind</em>, which is essentially the \u201ctype of a type-level thing\u201d, and <code>Bar</code> and <code>Baz</code> both have a type. These types can be written as follows:</p>\n\n<pre><code>Foo :: *\nBar :: Foo\nBaz :: Foo\n</code></pre>\n\n<p>\u2026where <code>*</code> is the kind of types.</p>\n\n<p>Now, consider a slightly more complicated definition:</p>\n\n<pre><code>data Foo a = Bar Integer String | Baz a\n</code></pre>\n\n<p>Once again, this definition binds three names: <code>Foo</code>, <code>Bar</code>, and <code>Baz</code>. Once again, <code>Foo</code> is in the type namespace and <code>Bar</code> and <code>Baz</code> are in the value namespace. Their types, however, are more elaborate:</p>\n\n<pre><code>Foo :: * -&gt; *\nBar :: Integer -&gt; String -&gt; Foo a\nBaz :: a -&gt; Foo a\n</code></pre>\n\n<p>Here, <code>Foo</code> is a type constructor, so it\u2019s essentially a type-level function that accepts a type (<code>*</code>) as an argument. Meanwhile, <code>Bar</code> and <code>Baz</code> are value-level functions that accept various values as arguments.</p>\n\n<p>Now, return to the definition of <code>Reader</code>. Avoiding record syntax for a moment, we can reformulate it as follows:</p>\n\n<pre><code>newtype Reader r a = Reader (r -&gt; a)\n</code></pre>\n\n<p>This binds one name in the type namespace and one name in the value namespace, but the confusing part is that they\u2019re both named <code>Reader</code>! This is totally allowed in Haskell, though, since the namespaces are separate. Each <code>Reader</code> has a kind/type in this case, too:</p>\n\n<pre><code>Reader :: * -&gt; * -&gt; *\nReader :: (r -&gt; a) -&gt; Reader r a\n</code></pre>\n\n<p>Note that the type-level <code>Reader</code> takes two arguments, but the value-level <code>Reader</code> only takes one. When you pattern-match against a value, you are using the value-level constructor (since you\u2019re deconstructing a value that was built up using that same constructor), and the value only contains one value (as it must, since <code>Reader</code> is a <code>newtype</code>), so the pattern only binds a single variable.</p>\n\n<hr>\n\n<blockquote>\n  <p>What goes on in this part of the definition: <code>(f (r e))</code>, what is it's purpose?</p>\n</blockquote>\n\n<p><code>Reader</code> is essentially a mechanism for composing a lot of functions that all take the same argument. It\u2019s a way to avoid having to thread a value around everywhere, since the various instances will do the plumbing automatically.</p>\n\n<p>To understand the definition of <code>&gt;&gt;=</code> for <code>Reader</code>, let\u2019s specialize the type of <code>&gt;&gt;=</code> to <code>Reader</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: Reader r a -&gt; (a -&gt; Reader r b) -&gt; Reader r b\n</code></pre>\n\n<p>For the purpose of clarity, we can also expand <code>Reader r a</code> to <code>r -&gt; a</code>, just to get a better intuition for what the type actually <em>means</em>:</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>Let\u2019s also name the arguments here for the purpose of discussion:</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n(&gt;&gt;=)    f           g             =  ...\n</code></pre>\n\n<p>Let\u2019s think about this for a moment. We are given two functions, <code>f</code> and <code>g</code>, and we are expected to produce a function that produces a value of type <code>b</code> from a value of type <code>a</code>. We only have <em>one</em> way to produce a <code>b</code>, and that\u2019s by calling <code>g</code>. But in order to call <code>g</code>, we have to have an <code>a</code>, and we only have one way to get an <code>a</code>: call <code>f</code>! We <em>can</em> call <code>f</code>, since it only needs an <code>r</code>, which we already have, so we can start attaching the functions together to produce the <code>b</code> we need.</p>\n\n<p>This is a little confusing, so it might help to see this flow of values visually:</p>\n\n<pre><code>          +------------+\n          | input :: r |\n          +------------+\n             |       |\n             v       |\n+--------------+     |\n| f input :: a |     |\n+--------------+     |\n       |             |\n       v             v\n  +------------------------+\n  | g (f input) input :: b |\n  +------------------------+\n</code></pre>\n\n<p>In Haskell, this looks like this:</p>\n\n<pre><code>f &gt;&gt;= g = \\input -&gt; g (f input) input\n</code></pre>\n\n<p>\u2026or, renaming things a little to match the definition in your question:</p>\n\n<pre><code>r &gt;&gt;= f = \\e -&gt; f (r e) e\n</code></pre>\n\n<p>Now, we need to reintroduce some wrapping and unwrapping, since the real definition is on the <code>Reader</code> type, not <code>(-&gt;)</code> directly. This means we need to add some uses of the <code>Reader</code> wrapper and the <code>runReader</code> unwrapper, but otherwise the definition is the same:</p>\n\n<pre><code>Reader r &gt;&gt;= f = Reader (\\e -&gt; runReader (f (r e)) e)\n</code></pre>\n\n<p>At this point, you can check your intuition: <code>Reader</code> is a way to thread a value around between a lot of functions, and here we\u2019re composing two functions, <code>r</code> and <code>f</code>. Therefore, we should need to pass the value in twice, which we do: there are two uses of <code>e</code> in the above definition.</p>\n"}], "owner": {"reputation": 700, "user_id": 1454320, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23b44010eac84ae1f264e1f30efe3ecd?s=128&d=identicon&r=PG", "display_name": "oskar132", "link": "https://stackoverflow.com/users/1454320/oskar132"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 2, "accepted_answer_id": 48370270, "answer_count": 3, "score": 2, "last_activity_date": 1516564639, "creation_date": 1516557932, "last_edit_date": 1516564639, "question_id": 48370023, "link": "https://stackoverflow.com/questions/48370023/reader-monad-clarification", "title": "Reader Monad clarification", "body": "<p>I am trying to make sense of the reader monad but can't seem to grasp what bind (>>=) does in this monad.</p>\n\n<p>Here's the implementation I am analyzing:</p>\n\n<pre><code>newtype Reader e a = Reader { runReader :: (e -&gt; a) }\n\ninstance Monad (Reader e) where \n    return a         = Reader $ \\e -&gt; a \n    (Reader r) &gt;&gt;= f = Reader $ \\e -&gt; runReader (f (r e)) e\n</code></pre>\n\n<ol>\n<li>My first question is, why is Reader partially applied on the left\nhand side of bind? <code>(Reader r)</code> instead of <code>(Reader r a)</code>.</li>\n<li>What goes on in this part of the definition: <code>(f (r e))</code>, what is it's purpose?</li>\n</ol>\n\n<p>Thanks a lot for helping me out.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1516558016, "post_id": 48369951, "comment_id": 83726696, "body": "<code>instance Show (GMap Int v) where</code>  I tried also, but ghc 8.0.2 throws exception <code>Illegal instance declaration for </code>Show (GMap Int v)`"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1516560956, "post_id": 48369951, "comment_id": 83727685, "body": "It also also say what needs to be done for it to work."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1516565187, "post_id": 48369951, "comment_id": 83729143, "body": "With your advice I implemented it as follow  <code>instance (k ~ Int, Show v) =&gt; Show (GMap k v) where   show (GMapInt k) = &quot;GMapInt (&quot; ++ (show k) ++ &quot;)&quot;</code>  but I want to implement a general <code>instance Show GMap</code> without restriction to <code>Int</code> only."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1516557466, "creation_date": 1516557466, "answer_id": 48369951, "question_id": 48369713, "link": "https://stackoverflow.com/questions/48369713/instance-implementation-for-in-a-class-nested-data-type/48369951#48369951", "title": "Instance implementation for in a class nested data type", "body": "<p>The <code>GMapInt</code> constructor is specific to, well, <code>GMap Int</code>, so you can't use it to construct/deconstruct <code>GMap k</code> for <code>k</code> other than <code>Int</code>.</p>\n\n<p>You probably want this instance:</p>\n\n<pre><code>instance Show (GMap Int v) where                                                                                                                                      \n  show (GMapInt _) = undefined\n</code></pre>\n\n<p>or, if <code>Int</code> is the <em>only</em> key type whose maps you whish to be showable (which I'd find strange),</p>\n\n<pre><code>instance (k ~ Int) =&gt; Show (GMap k v) where                                                                                                                                      \n  show (GMapInt _) = undefined\n</code></pre>\n\n<p>The latter has the advantage that the type checker doesn't need to know that the keys are <code>Int</code> before resolving e.g. <code>show empty</code> (which wouldn't compile in the first approach without an explicit type signature), it instead can utilise the knowledge that the key type <em>must always</em> be <code>Int</code>. Often useful, though probably not the right thing in your application.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1516607041, "last_edit_date": 1516607041, "creation_date": 1516605063, "answer_id": 48376283, "question_id": 48369713, "link": "https://stackoverflow.com/questions/48369713/instance-implementation-for-in-a-class-nested-data-type/48376283#48376283", "title": "Instance implementation for in a class nested data type", "body": "<p>You can't pattern match on a data constructor of a data family like <code>GMap</code> without already knowing it's key type -- i.e. it's not like a GADT, because it's open, so it would be impossible to cover all cases.  So if you want to implement a generic show, you need to do it without accessing the representation directly.  I have two alternatives for you:</p>\n\n<h2>Catch-all instance</h2>\n\n<p>After playing around a little, the simplest way I could come up with was to add a method to the class for use in the instance.</p>\n\n<pre><code>class GMapKey k where\n  data GMap k :: * -&gt; *\n  empty       :: GMap k v\n  lookup      :: k -&gt; GMap k v -&gt; Maybe v\n  insert      :: k -&gt; v -&gt; GMap k v -&gt; GMap k v\n  showGMap    :: (Show v) =&gt; GMap k v -&gt; String\n</code></pre>\n\n<p>Then you can make a single general catch-all instance.</p>\n\n<pre><code>instance (GMapKey k, Show v) =&gt; Show (GMap k v) where\n  show = showGMap\n</code></pre>\n\n<p>This is a little less smooth than I would desire, but it's not too awfully bad.  My main lament with this method is that it precludes <code>deriving Show</code> on the instances, i.e.</p>\n\n<pre><code>instance GMapKey Int where\n  data GMap Int v        = GMapInt (Data.IntMap.IntMap v)\n      deriving (Show)\n  ...\n</code></pre>\n\n<p>is illegal because it overlaps with our catch-all instance. This could be kind of a pain if the type gets complex.  The next method does not suffer from this problem.</p>\n\n<p>Anyway, now we have an instance and can use it like usual.</p>\n\n<pre><code>example :: (GMapKey k, Show v) =&gt; GMap k v -&gt; String\nexample gmap = show gmap\n</code></pre>\n\n<h2>Dictionary method</h2>\n\n<p>If you need to use <code>deriving Show</code>, you could do it a more modern way using the <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\"><code>constraints</code></a> package.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, TypeApplications #-}\nimport Data.Constraint\n</code></pre>\n\n<p>It also involves adding a method, but instead of returning a <code>String</code>, it returns a whole <code>Show</code> dictionary.</p>\n\n<pre><code>class GMapKey k where\n  data GMap k :: * -&gt; *\n  empty       :: GMap k v\n  lookup      :: k -&gt; GMap k v -&gt; Maybe v\n  insert      :: k -&gt; v -&gt; GMap k v -&gt; GMap k v\n  showGMap    :: (Show v) =&gt; Dict (Show (GMap k v))\n</code></pre>\n\n<p>You can instantiate with <code>deriving</code>, and the <code>showGMap</code> instance is always the same.  </p>\n\n<pre><code> instance GMapKey Int where\n   data GMap Int v        = GMapInt (Data.IntMap.IntMap v)\n       deriving (Show)\n   ...\n   showGMap = Dict\n</code></pre>\n\n<p>(You could even use <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/users_guide/type-class-extensions.html#class-default-signatures\" rel=\"nofollow noreferrer\"><code>DefaultSignatures</code></a> to avoid having to mention <code>showGMap</code> in the instances at all!)</p>\n\n<p>Unfortunately, a catch-all instance will still overlap with this, and so we won't have a global <code>Show</code> instance for <code>GMap</code>s.  However, we can manufacture one locally wherever we need it, using <a href=\"https://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint.html#v:withDict\" rel=\"nofollow noreferrer\"><code>withDict</code></a></p>\n\n<pre><code>example :: forall k v. (GMapKey k, Show v) =&gt; GMap k v -&gt; String\nexample gmap = withDict @k @v (show gmap)\n</code></pre>\n\n<p>which is annoying in a different way.  Fortunately we only need to do this when we need a <em>generic</em> <code>Show (GMap k v)</code> instance -- if we already know what <code>k</code> is then the specific <code>Show</code> instances we derived will work.</p>\n\n<p>Maybe there's a way to get the best of both worlds?</p>\n"}], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 48376283, "answer_count": 2, "score": 1, "last_activity_date": 1516607041, "creation_date": 1516556061, "question_id": 48369713, "link": "https://stackoverflow.com/questions/48369713/instance-implementation-for-in-a-class-nested-data-type", "title": "Instance implementation for in a class nested data type", "body": "<p>I'd like to know how <code>instance Show</code> could be implemented for <code>Gmap</code> data type presented in following code snippet <a href=\"https://wiki.haskell.org/Type_families#The_class_declaration\" rel=\"nofollow noreferrer\">Type families</a> article without usage of <code>deriving Show</code>.</p>\n\n<pre><code>class GMapKey k where\n  data GMap k :: * -&gt; *\n  empty       :: GMap k v\n  lookup      :: k -&gt; GMap k v -&gt; Maybe v\n  insert      :: k -&gt; v -&gt; GMap k v -&gt; GMap k v\n\ninstance GMapKey Int where\n  data GMap Int v        = GMapInt (Data.IntMap.IntMap v)\n  empty                  = GMapInt Data.IntMap.empty\n  lookup k   (GMapInt m) = Data.IntMap.lookup k m\n  insert k v (GMapInt m) = GMapInt (Data.IntMap.insert k v m)\n</code></pre>\n\n<p>For this initiating implementation:</p>\n\n<pre><code>instance Show (GMap k v) where                                                                                                                                      \n  show (GMapInt _) = undefined\n</code></pre>\n\n<p>compiler throws:</p>\n\n<pre><code>* Couldn't match type `k' with `Int'\n  `k' is a rigid type variable bound by\n    the instance declaration\n    at /home/x/src/GMapAssoc.hs:27:10\n  Expected type: GMap k v\n    Actual type: GMap Int v\n* In the pattern: GMapInt _\n  In an equation for `show': show (GMapInt _) = undefined\n  In the instance declaration for `Show (GMap k v)'\n* Relevant bindings include\n    show :: GMap k v -&gt; String\n</code></pre>\n\n<p>Aside from the main question, I'd like to understand why compiler does not complain in this case:</p>\n\n<pre><code>instance Show (GMap k v) where                                                                                                                                      \n  show _ = undefined\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516555927, "post_id": 48369663, "comment_id": 83725997, "body": "Do you know what <code>\\x -&gt; ...</code> is?"}], "answers": [{"comments": [{"owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "edited": false, "score": 0, "creation_date": 1516556440, "post_id": 48369724, "comment_id": 83726178, "body": "Thank you! Are going to check your answer as the solution asap."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1516556113, "creation_date": 1516556113, "answer_id": 48369724, "question_id": 48369663, "link": "https://stackoverflow.com/questions/48369663/from-two-functions-create-a-tuple-transform/48369724#48369724", "title": "From two functions create a tuple transform", "body": "<p>If <code>a = f x</code> and <code>f :: T -&gt; (B, C)</code>, then <code>a</code> is already a <code>(B, C)</code> and not a function anymore. We only get a <code>B</code> or a <code>C</code> out of it, but we cannot plug in another <code>T</code>.</p>\n\n<p>So we need to build two functions from <code>f</code> instead, such that</p>\n\n<pre><code>firstF x  = fst (f x)\nsecondF x = snd (f x)\n</code></pre>\n\n<p>Actually, we're done at that point:</p>\n\n<pre><code>pf = (firstF, secondF)\n</code></pre>\n\n<p>We can now write <code>f2p</code>:</p>\n\n<pre><code>f2p :: (a -&gt; (b,c)) -&gt; (a -&gt; b, a -&gt; c)\nf2p f = (fst . f, snd . f)\n</code></pre>\n"}], "owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 48369724, "answer_count": 1, "score": 0, "last_activity_date": 1516556113, "creation_date": 1516555791, "question_id": 48369663, "link": "https://stackoverflow.com/questions/48369663/from-two-functions-create-a-tuple-transform", "title": "From two functions create a tuple transform", "body": "<p>What I am trying to do is that from a function, f, returning a pair. I want to make a pair of two functions, pf. And than implement the transform f2p.  </p>\n\n<pre><code>f :: a -&gt; (b,c)\npf :: (a-&gt;b,a-&gt;c)\nf2p :: (a -&gt; (b,c)) -&gt; (a-&gt;b,a-&gt;c)\n</code></pre>\n\n<p>I find this suprisingly difficult, I think I should use function composition in some manner but the question seems so strangely formulated. What I have tried is just to create a dummy function for f looking like this.</p>\n\n<pre><code>f n = (n,n+1)\n</code></pre>\n\n<p>just to be able to work with the two other functions. But when I come to write the function pf, whatever I do I can not make it work like the defenition want it to. For example,</p>\n\n<pre><code>pf = (fst a, snd a)\n     where a = f 3\n</code></pre>\n\n<p>This just makes it into pf :: (Integer, Integer), wich is not really what I want. If I try to force it with pf :: (Num t) => (t->t,t->t) I get </p>\n\n<blockquote>\n  <p>Could not deduce (Num (t -> t)) arising from a use of \u2018f\u2019</p>\n</blockquote>\n\n<p>I could really need some guidance!</p>\n"}, {"tags": ["string", "haskell", "slice"], "answers": [{"tags": [], "owner": {"reputation": 6633, "user_id": 392025, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ac8fa292707d21768f9ebe17de4b523?s=128&d=identicon&r=PG", "display_name": "Aurel B&#237;l&#253;", "link": "https://stackoverflow.com/users/392025/aurel-b%c3%adl%c3%bd"}, "is_accepted": false, "score": 5, "last_activity_date": 1516553707, "creation_date": 1516553707, "answer_id": 48369307, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices/48369307#48369307", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<p>Simple using the <code>take</code> function:</p>\n\n<pre><code>substring :: Int -&gt; Int -&gt; Text -&gt; Text\nsubstring start end text = take (end - start) (drop start text)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1516554039, "last_edit_date": 1516554039, "creation_date": 1516553717, "answer_id": 48369310, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices/48369310#48369310", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<p>Usually one uses <a href=\"https://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:drop\" rel=\"noreferrer\"><strong><code>drop :: Int -&gt; Text -&gt; Text</code></strong></a> and <a href=\"https://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:take\" rel=\"noreferrer\"><strong><code>take :: Int -&gt; Text -&gt; Text</code></strong></a> to obtain a slice of the subtext. We can combine the two to make some sort of <code>substring</code>:</p>\n\n<pre><code>import Data.Text as Tx(Text, drop, take)\n\nsubstring :: Int -&gt; Int -&gt; Tx.Text -&gt; Tx.Text\nsubstring start length = Tx.take length . Tx.drop start\n</code></pre>\n\n<p>or if we want to use the end index (exclusive), we can create a <code>slice</code> function:</p>\n\n<pre><code>import Data.Text as Tx(drop, take)\n\nslice :: Int -&gt; Int -&gt; Tx.Text -&gt; Tx.Text\nslice start end = Tx.take (end-start) . Tx.drop start\n</code></pre>\n\n<p>We then can use it like:</p>\n\n<pre><code>Prelude Tx&gt; slice 5 9 \"This is a test\"\n\"is a\"\n</code></pre>\n\n<p>This is not <em>fully</em> equivalent to Python's slice notation, since for instance Python uses negative indices as a way to count from the last element (i.e. <code>-1</code> is the last element), and we can use <code>'foobar'[-5:-2]</code> to obtain a slice that where the indices mean \"<em>taking a slice from the</em> last but four <em>to the</em> last but one <em>element</em>\".</p>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 5, "last_activity_date": 1597529062, "last_edit_date": 1597529062, "creation_date": 1516554299, "answer_id": 48369404, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices/48369404#48369404", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<p>Also, you can define the function in terms of <code>Data.Text.take</code> and <code>drop</code>, both functions from <code>Data.Text</code> library:</p>\n<pre><code>slice :: Int -&gt; Int -&gt; Text -&gt; Text\nslice a b = (Data.Text.take (b - a)) . (Data.Text.drop a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75, "user_id": 4428059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7b75f971b6dd0e4a4c68035ecb79e9a?s=128&d=identicon&r=PG&f=1", "display_name": "cealex", "link": "https://stackoverflow.com/users/4428059/cealex"}, "is_accepted": false, "score": 1, "last_activity_date": 1606469817, "creation_date": 1606469817, "answer_id": 65034993, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices/65034993#65034993", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<pre><code>import Data.List\n\nsubstring :: Int -&gt; Int -&gt; String -&gt; String\n\nsubstring i j s = take (j-i) ( drop i s )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 2721685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b7217decf734af6d806fb0e2abe837?s=128&d=identicon&r=PG&f=1", "display_name": "jokkebk", "link": "https://stackoverflow.com/users/2721685/jokkebk"}, "is_accepted": false, "score": 0, "last_activity_date": 1618821804, "creation_date": 1618821804, "answer_id": 67158727, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices/67158727#67158727", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<p>Using the dot operator and sections gives a nice definition with <code>take</code> and <code>drop</code>:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>slice off n = (take n).(drop off)\n</code></pre>\n<p>You can then just use <code>slice 2 3 &quot;hello!&quot;</code> to get <code>&quot;llo&quot;</code></p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6475, "favorite_count": 0, "accepted_answer_id": 48369404, "answer_count": 5, "score": 2, "last_activity_date": 1618821804, "creation_date": 1516553425, "last_edit_date": 1516554177, "question_id": 48369242, "link": "https://stackoverflow.com/questions/48369242/in-haskell-how-can-i-get-a-substring-of-a-text-between-two-indices", "title": "In Haskell, how can I get a substring of a Text between two indices?", "body": "<p>I'm trying to fint the Haskell equivalent of the Python:</p>\n\n<pre><code>&gt;&gt;&gt;\"This is a test\"[5:9]\n'is a'\n</code></pre>\n\n<p>I'm using the <code>Data.Text</code> module, if that makes any difference.</p>\n"}, {"tags": ["haskell", "aeson", "gadt"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516553518, "post_id": 48369238, "comment_id": 83725137, "body": "This representation is quite weird. I would expect that a country carries both its id and name, so <code>Country Int String</code> as a constructor. Exhaustively enumerating possible types for <code>a</code> is also quite an anti-pattern, since it prevents code reuse."}, {"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516553773, "post_id": 48369238, "comment_id": 83725218, "body": "Actually in the json post I will receive the country name and that will be converted to country id while saving in database . post data will be like {&quot;country&quot; : &quot;country one&quot;} . Hence I am trying to represent country name and id seperately."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516664201, "post_id": 48369238, "comment_id": 83771813, "body": "You say, &quot;I want to put constraint of <code>a</code> to take only values of <code>String</code> and <code>Integer</code>&quot;. Why do you want this constraint?"}, {"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "edited": false, "score": 0, "creation_date": 1516687349, "post_id": 48369238, "comment_id": 83777866, "body": "Because in my use case only those two types are valid. Since a is polymorphic anyone can write Country SomeOtherType which is invalid type for Country. I hope that makes sense."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516665083, "post_id": 48369521, "comment_id": 83772036, "body": "I agree that GADTs are overkill, but this representation seems strictly worse than <code>data Country a = Country a</code>: one cannot write the types <code>Country Int -&gt; Country String</code> and vice versa that guarantee that the given country identifier is in the appropriate format at input and output."}, {"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "edited": false, "score": 0, "creation_date": 1516687452, "post_id": 48369521, "comment_id": 83777906, "body": "Is this a better representation ? <code>newtype CountryId = CountryId Int</code> and <code>newtype CountryText = CountryText String</code> or should I actually look into GADTs instead ?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1516689645, "post_id": 48369521, "comment_id": 83778758, "body": "Yes, this is definitely better representation if you want to write functions like <code>Country Int -&gt; Country String</code>. Note that your types share nothing between them, so it was wrong idea to wrap them into a single type."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1516554953, "creation_date": 1516554953, "answer_id": 48369521, "question_id": 48369238, "link": "https://stackoverflow.com/questions/48369238/representing-country-id-and-text-in-haskell-datatype/48369521#48369521", "title": "Representing Country Id and Text in Haskell datatype", "body": "<p>GADT's is an overkill for this task, IMO.</p>\n\n<p>Can't you just use ADT?</p>\n\n<pre><code>data Country = CountryWithInt Int\n             | CountryWithString String\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516554953, "creation_date": 1516553405, "question_id": 48369238, "link": "https://stackoverflow.com/questions/48369238/representing-country-id-and-text-in-haskell-datatype", "title": "Representing Country Id and Text in Haskell datatype", "body": "<p>I have a list of country id and country text in json</p>\n\n<pre><code>{\n 1 : \"country one\",\n 2 : \"country two\"\n}\n</code></pre>\n\n<p>I have created below code to represent country id and text in haskell</p>\n\n<pre><code>data Country a = Country a\n\ncountry1 :: Country String -- Representing country name\ncountry1 = Country \"country one\"\n\ncountry2 :: Country Integer -- Representing country id\ncountry2 = Country 2 \n</code></pre>\n\n<p>Above code is working fine. But I want to put constraint of <strong>a</strong> to take only values of String and Integer.</p>\n\n<p>For that I tried below code . However, it is not working.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata Country a where\n    Country :: (String, Integer) =&gt; a -&gt; Country a\n\ntoId :: Country String -&gt; Country Integer\ntoId Country a = Country 1\n\ntoText :: Country Integer -&gt; Country String\ntoText Country a = Country \"country one\"\n</code></pre>\n\n<p>Can anyone help to figure out how I can implement the above code in best way so that it is working ?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 5288415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f03bfa6f2b9de3b0545d25044a701f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Kamau", "link": "https://stackoverflow.com/users/5288415/kevin-kamau"}, "edited": false, "score": 0, "creation_date": 1516556466, "post_id": 48369573, "comment_id": 83726194, "body": "Thanks. How did you know to use the word <code>split</code> and not Data.List.Split"}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 107, "user_id": 5288415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f03bfa6f2b9de3b0545d25044a701f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Kamau", "link": "https://stackoverflow.com/users/5288415/kevin-kamau"}, "edited": false, "score": 0, "creation_date": 1516556718, "post_id": 48369573, "comment_id": 83726299, "body": "That&#39;s because the name of the library is <code>split</code>: go to <a href=\"https://hackage.haskell.org/package/split-0.2.3.2\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/split-0.2.3.2</a> and you will see the legend <code>split: Combinator library for splitting lists</code>. Also, from the url you have <code>split-0.2.3.2</code>, which is parsed as <code>{name-of-the-library}-{version-of-the-library}</code>. <code>Data.List.Split</code> is the library&#39;s module structure and just says how you will import it. Here you have the actual <code>cabal</code> file for the <code>split</code> lib: <a href=\"https://hackage.haskell.org/package/split-0.2.3.2/split.cabal\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/split-0.2.3.2/split.cabal</a>"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 1, "last_activity_date": 1516555265, "creation_date": 1516555265, "answer_id": 48369573, "question_id": 48369107, "link": "https://stackoverflow.com/questions/48369107/adding-a-library-a-haskell-project/48369573#48369573", "title": "Adding a library a Haskell Project", "body": "<p>You should add your library <code>split</code> and the specific version to the <code>cabal</code> file in the <code>build-depends</code> section. So for example, if you have in your <code>cabal</code> file the following:</p>\n\n<pre><code>build-depends:\n  base &gt;=4.7\n</code></pre>\n\n<p>now <code>Stack</code> knows that your project depends on the <code>base</code> library and it should require a version greater or equal to <code>4.7</code>. Hence, to add your <code>split</code> library, you should add something like:</p>\n\n<pre><code>build-depends:\n  split == 0.2.3.2\n</code></pre>\n\n<p>That says simply that you need the <code>0.2.3.2</code> version of the <code>split</code> library.</p>\n\n<p>Here you can read more about this: <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">Stack documentation</a> (read the workflow section) and here you have an example of a <code>cabal</code> file that requires some libraries <a href=\"https://github.com/nicodelpiano/coverage/blob/master/coverage.cabal#L48\" rel=\"nofollow noreferrer\">project.cabal example</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 107, "user_id": 5288415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f03bfa6f2b9de3b0545d25044a701f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Kamau", "link": "https://stackoverflow.com/users/5288415/kevin-kamau"}, "is_accepted": false, "score": 0, "last_activity_date": 1516609751, "creation_date": 1516609751, "answer_id": 48377372, "question_id": 48369107, "link": "https://stackoverflow.com/questions/48369107/adding-a-library-a-haskell-project/48377372#48377372", "title": "Adding a library a Haskell Project", "body": "<p>I think I found another way to do it. I needed to insert <code>split</code> as one of the dependencies in the <code>package.yaml</code> file like this:</p>\n\n<p><code>dependencies:\n    - split\n</code>\nThis is the followed up by deleting the <code>cabal</code> file and then typing <code>stack build</code> in the terminal.</p>\n\n<p>The result is that it creates a new <code>cabal</code> file without me having to make any specific changes to the <code>cabal</code> file.</p>\n\n<p>The new <code>cabal</code> file now has <code>split</code> as one the dependencies as so:</p>\n\n<p><code>build-depends:\n    base\n  , split\n</code></p>\n\n<p>At the top of the newly generated <code>cabal</code> file it says that it has been generated from the <code>package.yaml</code> file by <code>hpack</code>.</p>\n"}], "owner": {"reputation": 107, "user_id": 5288415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f03bfa6f2b9de3b0545d25044a701f?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Kamau", "link": "https://stackoverflow.com/users/5288415/kevin-kamau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1516609751, "creation_date": 1516552656, "question_id": 48369107, "link": "https://stackoverflow.com/questions/48369107/adding-a-library-a-haskell-project", "title": "Adding a library a Haskell Project", "body": "<p>I am going through some of the Haskell exercises in <a href=\"http://exercism.io/\" rel=\"nofollow noreferrer\">exercism</a>. I have reached a point where I need to include a library in my project. But to be more clear I would like to include the library Data.List.Split. The library can be found <a href=\"https://hackage.haskell.org/package/split-0.2.3.2/docs/Data-List-Split.html\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>I have tried going through some of <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">Stack's</a> documentation and I don't seem to understand how to do it. My project has:</p>\n\n<ol>\n<li><code>package.yaml</code>  </li>\n<li><code>stack.yaml</code> </li>\n<li><code>cabal</code> file </li>\n</ol>\n\n<p>I wish they had a \"dummies guide to using stack\", something absolute beginners would be able understand.</p>\n\n<p>Please use examples as you explain your answer.</p>\n"}, {"tags": ["haskell", "indentation"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 4, "creation_date": 1516543830, "post_id": 48367657, "comment_id": 83721887, "body": "<code>let</code> bindings in <code>do</code> blocks don&#39;t need an <code>in</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1516545003, "creation_date": 1516545003, "answer_id": 48367892, "question_id": 48367657, "link": "https://stackoverflow.com/questions/48367657/haskell-indentation-issue-with-do-and-let-in-statements/48367892#48367892", "title": "haskell indentation issue with do and let ..in statements", "body": "<p>In a <strong><code>do</code> clause</strong>, the <strong><code>in</code> keyword should not be used</strong>.</p>\n\n<p>So you can fix it with writing:</p>\n\n<pre><code>fold' list = do\n    let result = foldl (+) list\n    putStrLn $ \"Reduced \" ++ show(result)   -- no \"in\" keyword\n    return $ result</code></pre>\n\n<p>The scope of the <code>let</code> statement is the rest of the clauses.</p>\n\n<p>The translation is like specified in <a href=\"https://www.haskell.org/onlinereport/exps.html\" rel=\"nofollow noreferrer\"><em>section 3.14 of the Haskell report</em> [link]</a>:</p>\n\n<blockquote>\n<pre><code>do {e}                =   e\ndo {e;stmts}          =   e &gt;&gt; do {stmts}\ndo {p &lt;- e; stmts}    = let ok p = do {stmts}\n                            ok _ = fail \"...\"\n                        in e &gt;&gt;= ok\ndo {let decls; stmts} =   let decls in do {stmts}\n</code></pre>\n</blockquote>\n\n<p>So in case we define two <code>let</code> statements with the same name (which is <em>not</em> recommended), the first one moving to the top will count.</p>\n\n<p>So for:</p>\n\n<pre><code>foo = do\n    let x = \"4\"\n    putStrLn x\n    let x = \"2\"\n    putStrLn x\n</code></pre>\n\n<p>It will translate into:</p>\n\n<pre><code>foo = let x = \"4\" in (putStrLn x &gt;&gt; (let x = \"2\" in putStrLn x))\n</code></pre>\n\n<p>So the first <code>putStrLn</code> will use the <code>x</code> defined by <code>let x = \"4\"</code> whereas the last one will use the <code>x</code> defined in <code>let x = \"2\"</code>.</p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 48367892, "answer_count": 1, "score": 1, "last_activity_date": 1516545003, "creation_date": 1516543699, "question_id": 48367657, "link": "https://stackoverflow.com/questions/48367657/haskell-indentation-issue-with-do-and-let-in-statements", "title": "haskell indentation issue with do and let ..in statements", "body": "<p>I tried various combinations to fix the indentation for the following code but failed. How shall i fix the below</p>\n\n<pre><code>fold' list = do\n    let result = foldl (+) list\n    in putStrLn $ \"Reduced \" ++ show(result)\n    return $ result\n\n parse error on input `in'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "types", "dependent-type"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1516550455, "post_id": 48365766, "comment_id": 83724092, "body": "I never said that <code>Control</code> is the type of Church numerals. I said that <code>Control a</code> is the type of Church numerals. This was before the edit."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516551078, "post_id": 48365766, "comment_id": 83724280, "body": "Do you want <a href=\"https://en.wikipedia.org/wiki/Substructural_type_system\" rel=\"nofollow noreferrer\">linear types</a>?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516551991, "post_id": 48365766, "comment_id": 83724612, "body": "@chepner Not linear types, but from the same page you referenced I see that what I&#39;m looking for are <a href=\"https://en.wikipedia.org/wiki/Substructural_type_system#Affine_type_systems\" rel=\"nofollow noreferrer\">affine types</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516558679, "post_id": 48365766, "comment_id": 83726907, "body": "@AaditMShah Yeah, after I posted it, I remembered affine types are the &quot;at most once&quot; version instead of &quot;exactly once&quot;. Linear types are just the ones getting all the attention lately :)"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1516612149, "post_id": 48365766, "comment_id": 83742572, "body": "If you want linear types and are using Haskell, you may be interested in the following very recent GHC extension: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/LinearTypes\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/LinearTypes</a>"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 1, "creation_date": 1516612235, "post_id": 48365766, "comment_id": 83742622, "body": "That extension does not (currently) appear to support affine types though..."}], "answers": [{"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1516532169, "post_id": 48365863, "comment_id": 83718615, "body": "True, but in my case I want <code>Control a</code> to be <code>(a -&gt; a) -&gt; a -&gt; a</code> because it&#39;s used in the context of a bigger function <code>reduce :: (b -&gt; Control a) -&gt; [b] -&gt; a -&gt; a; reduce f = foldr f id</code>. I could trivially define a new data type <code>data Control a = Break a | Continue a</code> and then define <code>reduce</code> as <code>reduce :: (b -&gt; a -&gt; Control a) -&gt; [b] -&gt; a -&gt; a; reduce f [] a = a; reduce f (x:xs) a = case f x a of { Break a -&gt; a; Continue a -&gt; reduce f xs a }</code>. However, this is not as natural. Plus, I just want to know if there&#39;s a dependent type for the subset <code>{ 0, 1 }</code> of Church numerals."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1516533379, "post_id": 48365863, "comment_id": 83718920, "body": "@AaditMShah Just curious, if <code>Control</code> is restricted as you want, how would <code>reduce</code> be different from <code>\\_ _ -&gt; id</code>? Your new definition of <code>Control</code> via <code>data</code> is very different from the old one, is it intentional?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 2, "creation_date": 1516547001, "post_id": 48365863, "comment_id": 83722871, "body": "<code>data Control = Break | Continue</code> would work more like you want."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516548366, "post_id": 48365863, "comment_id": 83723324, "body": "@n.m. Good question. The <code>reduce</code> function behaves just like <code>foldl</code> but with early termination. For example, <code>reduce (\\b -&gt; if b == 0 then break else \\k a -&gt; k (b * a)) [1000,999..] 1</code> evaluates to <code>0</code>. As you can see, in the else branch I&#39;m returning <code>\\k a -&gt; k (b * a)</code> which is neither <code>break</code> nor <code>continue</code>. However, it&#39;s valid because it uses the free variable <code>b</code> and only applies <code>k</code> once. Essentially, I want to restrict the type <code>(a -&gt; a) -&gt; a -&gt; a)</code> in such a way that <code>(a -&gt; a)</code> can only be applied at most once. Without free variables only <code>break</code> and <code>continue</code> are valid values."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516549043, "post_id": 48365863, "comment_id": 83723573, "body": "@n.m. Perhaps my original question was lacking in details. I&#39;ll update it. Anyway, my new definition of <code>Control</code> isn&#39;t very different from the old one. Both <code>forall a. (a -&gt; a) -&gt; a -&gt; a</code> and <code>forall a. a -&gt; Control a</code> have exactly two values. However they need to carry additional information which is why they are defined the way they are."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1516531371, "last_edit_date": 1516531371, "creation_date": 1516531021, "answer_id": 48365863, "question_id": 48365766, "link": "https://stackoverflow.com/questions/48365766/haskell-type-is-too-permissive-need-to-apply-continuation-at-most-once/48365863#48365863", "title": "Haskell type is too permissive: need to apply continuation at most once", "body": "<p>We may recognize that <code>const id</code> is Church zero, and <code>id</code> is Church one, so we need Church naturals less than two - but if you want a two-element type, why not use <code>Bool</code>? Then interpret <code>True</code> as <code>const id</code> and <code>False</code> as <code>id</code>, or the other way. We can also say that <code>Control a</code> values are valid if they are in the image of the interpretation.</p>\n\n<p>All types with two inhabitants are isomorphic, so if you restrict <code>Control</code> (which you could do with some dependent types), that would be just isomorphic to <code>Bool</code>. It makes more sense to define subsets of types when there isn't a compact standalone characterization of the subset.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1516569263, "last_edit_date": 1516569263, "creation_date": 1516563761, "answer_id": 48370943, "question_id": 48365766, "link": "https://stackoverflow.com/questions/48365766/haskell-type-is-too-permissive-need-to-apply-continuation-at-most-once/48370943#48370943", "title": "Haskell type is too permissive: need to apply continuation at most once", "body": "<p>You can write your own ad hoc class for this:</p>\n\n<pre><code>class HasId p where\n  theId :: p a a\ninstance HasId (-&gt;) where\n  theId = id\n\ntype B = forall p a. HasId p =&gt; p a a -&gt; p a a\n</code></pre>\n\n<p>This definitely shouldn't have any legitimate extra values.</p>\n\n<p>Note that while <code>HasId</code> doesn't have any laws (and really can't have any), it admits exactly one instance for <code>(-&gt;)</code>, the only type we really care about.</p>\n\n<p>[Edit: I have completely changed this answer a couple times as my ideas matured.]</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 48365863, "answer_count": 2, "score": 2, "last_activity_date": 1516974966, "creation_date": 1516530029, "last_edit_date": 1516974966, "question_id": 48365766, "link": "https://stackoverflow.com/questions/48365766/haskell-type-is-too-permissive-need-to-apply-continuation-at-most-once", "title": "Haskell type is too permissive: need to apply continuation at most once", "body": "<p>Suppose I have the following type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Control a = (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>I want exactly two values to inhabit this type when universally quantified:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>break :: Control a\nbreak = const id\n\ncontinue :: Control a\ncontinue = id\n</code></pre>\n\n<p>However, the astute amongst you would notice that <code>Control a</code> is the type of <a href=\"https://en.wikipedia.org/wiki/Church_encoding#Church_numerals\" rel=\"nofollow noreferrer\">Church numerals</a>, of which there are infinitely many. Is there any way to restrict this type so that the continuation can be applied at most once? Perhaps using dependent types?</p>\n\n<hr>\n\n<p>Note that <code>Control</code> can appear in the context of a bigger function. For example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mult :: Int -&gt; Control Int\nmult 0 = \\k a -&gt; k 0\nmult b = \\k a -&gt; k (b * a)\n</code></pre>\n\n<p>As you can see <code>\\k a -&gt; k (b * a)</code> is neither <code>break</code> nor <code>continue</code> but is still a valid inhabitant of <code>Control</code>. However, it's not an inhabitant of <code>Control a</code>. It's an inhabitant of <code>Control Int</code>.</p>\n\n<p>Thus, what I'm really asking is whether there's a way to check that a continuation is applied at most once at the type level.</p>\n"}, {"tags": ["haskell", "codeworld"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516529122, "post_id": 48365642, "comment_id": 83717920, "body": "Yes, I have tried the first triangle."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516529210, "post_id": 48365642, "comment_id": 83717944, "body": "<a href=\"https://stackoverflow.com/posts/48365642/edit\">Edit</a> your post to include what you&#39;ve done so far."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516529535, "post_id": 48365642, "comment_id": 83718002, "body": "@hnefatl I just have edited"}, {"owner": {"reputation": 8576, "user_id": 327074, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/785321440230453d4a2a721f753bd538?s=128&d=identicon&r=PG", "display_name": "icc97", "link": "https://stackoverflow.com/users/327074/icc97"}, "edited": false, "score": 1, "creation_date": 1516529838, "post_id": 48365642, "comment_id": 83718062, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/1774395/koch-snowflake-implementation-in-haskell?rq=1\" title=\"koch snowflake implementation in haskell\">stackoverflow.com/questions/1774395/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 8576, "user_id": 327074, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/785321440230453d4a2a721f753bd538?s=128&d=identicon&r=PG", "display_name": "icc97", "link": "https://stackoverflow.com/users/327074/icc97"}, "edited": false, "score": 0, "creation_date": 1516530596, "post_id": 48365642, "comment_id": 83718241, "body": "@icc97  No, because he does the exercise with monads and I need to do it with CodeWorld."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1516533064, "post_id": 48365983, "comment_id": 83718846, "body": "Do you know any manual to see examples o the defined functions?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1516533251, "post_id": 48365983, "comment_id": 83718889, "body": "I think you need to figure that out yourself. Start with the geometry and then translate it into Haskell."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 0, "last_activity_date": 1516531806, "creation_date": 1516531806, "answer_id": 48365983, "question_id": 48365642, "link": "https://stackoverflow.com/questions/48365642/koch-snowflake-in-haskell-codeworld/48365983#48365983", "title": "Koch snowflake in Haskell (CodeWorld)", "body": "<p>I'm going to answer in the most general terms, because I'm not going to do your homework for you.</p>\n\n<p>You need a type to represent a line between two points. You need a function that takes one line and returns 4, where the new 4 lines are the </p>\n\n<pre><code>_/\\_ \n</code></pre>\n\n<p>pattern of the Koch snowflake. Then you need a recursive function to call it to the right depth.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 48365983, "answer_count": 1, "score": -1, "last_activity_date": 1516531806, "creation_date": 1516528822, "last_edit_date": 1516529515, "question_id": 48365642, "link": "https://stackoverflow.com/questions/48365642/koch-snowflake-in-haskell-codeworld", "title": "Koch snowflake in Haskell (CodeWorld)", "body": "<p>Through the <code>Haskell</code> package, <code>CodeWorld</code> (<a href=\"https://hackage.haskell.org/package/codeworld-api\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/codeworld-api</a>) , I need to draw Koch's snowflake.</p>\n\n<p>You can use this package online, in case you don't want to download it:  <a href=\"https://code.world/#\" rel=\"nofollow noreferrer\">https://code.world/#</a></p>\n\n<p>A link so you can see what I need to do:  <a href=\"https://upload.wikimedia.org/wikipedia/commons/f/fd/Von_Koch_curve.gif\" rel=\"nofollow noreferrer\">https://upload.wikimedia.org/wikipedia/commons/f/fd/Von_Koch_curve.gif</a></p>\n\n<p>I'm not quite sure how it would be done, can you help me?</p>\n\n<p>And if by the way, you know some manuals to work with this package, well much better.</p>\n\n<p>I've done this:</p>\n\n<pre><code>import CodeWorld\n\nmain :: IO ()\nmain = drawingOf triangle\n\ntriangle :: Picture\ntriangle = polygon [(9,9),(0,-9),(-9,9)]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1516526695, "post_id": 48365311, "comment_id": 83717328, "body": "Is there any problem with your current version?"}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516527052, "post_id": 48365311, "comment_id": 83717415, "body": "It works as expected but writing those <code>ifA</code> <code>ifB</code> <code>ifC</code> is tedious."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516527385, "post_id": 48365311, "comment_id": 83717503, "body": "BTW your <code>ifC</code> isn&#39;t quite like <code>ifA</code> and <code>ifB</code>. Perhaps try <code>Just ()</code> for it."}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516527751, "post_id": 48365311, "comment_id": 83717594, "body": "Thanks, that makes sense."}], "answers": [{"comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1516529976, "post_id": 48365577, "comment_id": 83718100, "body": "What should I read to master <code>lens</code>? I can only find beginner tutorials."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1516560648, "post_id": 48365577, "comment_id": 83727589, "body": "@DulguunOtgon I think that depends on what you mean by \u201cmaster\u201d. I mostly learned how to use it by reading the documentation and looking into things as I found I needed them, after learning the basics."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516618987, "post_id": 48365577, "comment_id": 83746622, "body": "FTR, you can&#39;t actually compose a prism with a lens. What you can do is compose a setter with a setter, and both <code>Prism</code> and <code>Lens</code> are actually polymorphic types which include <code>ASetter</code> as a specialisation."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 5, "last_activity_date": 1516528751, "last_edit_date": 1516528751, "creation_date": 1516528377, "answer_id": 48365577, "question_id": 48365311, "link": "https://stackoverflow.com/questions/48365311/if-pattern-matching-with-maybe-a-result/48365577#48365577", "title": "If pattern matching with `Maybe a` result", "body": "<p><a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Prism.html\" rel=\"nofollow noreferrer\">Prisms</a><sup>\u2020</sup> from the <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> package model this. You can generate prisms for your type using <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-TH.html#v:makePrisms\" rel=\"nofollow noreferrer\"><code>makePrisms</code></a>, then use <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Fold.html#v:-94--63-\" rel=\"nofollow noreferrer\"><code>^?</code></a> (or its prefix equivalent, <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Fold.html#v:preview\" rel=\"nofollow noreferrer\"><code>preview</code></a>) to access members of the sum type, producing <code>Nothing</code> if a different value is provided:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ndata MyData\n  = A Int\n  | B String\n  | C\n  deriving (Show)\n\nmakePrisms ''MyData\n</code></pre>\n\n\n\n<pre><code>ghci&gt; A 42 ^? _A\nJust 42\nghci&gt; A 42 ^? _B\nNothing\nghci&gt; C ^? _C\nJust ()\n</code></pre>\n\n<p>The nice thing about prisms is that they compose with other optics (e.g. <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Lens.html\" rel=\"nofollow noreferrer\">lenses</a>, <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Fold.html\" rel=\"nofollow noreferrer\">folds</a>, and <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Traversal.html\" rel=\"nofollow noreferrer\">traversals</a>), as well as use them to traverse through nested sum types by composing prisms:</p>\n\n<pre><code>ghci&gt; (A 42, C) ^? _1._A\nJust 42\nghci&gt; (B \"hello\", C) ^? _1._A\nNothing\nghci&gt; Just (A 42) ^? _Just._A\nJust 42\nghci&gt; Just (B \"hello\") ^? _Just._A\nNothing\nghci&gt; Nothing ^? _Just._A\nNothing\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> package is fairly complicated, and explaining all of its features is well outside the scope of this answer. If you don\u2019t need much of it, your solution is probably fine. But if you find yourself writing that sort of code a lot, it\u2019s likely that lens can help, as long as you\u2019re willing to accept the steep learning curve and often-confusing type errors.</p>\n\n<hr>\n\n<p><sup>\u2020 More generally, <code>^?</code> works on any <a href=\"https://hackage.haskell.org/package/lens/docs/Control-Lens-Fold.html\" rel=\"nofollow noreferrer\"><code>Fold</code></a> that produces zero or one value (or more, it just ignores all but the first one), but prisms are specifically designed with sum types in mind, so they are more relevant here.</sup></p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 0, "last_activity_date": 1516617355, "creation_date": 1516617355, "answer_id": 48379559, "question_id": 48365311, "link": "https://stackoverflow.com/questions/48365311/if-pattern-matching-with-maybe-a-result/48379559#48379559", "title": "If pattern matching with `Maybe a` result", "body": "<p>Here's a cute idiom that I use from time to time, since I'm not yet up on my lenses.</p>\n\n<pre><code>{-# LANGUAGE MonadComprehensions #-}\n\nexample1 v = [ x | A x &lt;- pure v ] &gt;&gt;= mbMult3\n</code></pre>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 48365577, "answer_count": 2, "score": 3, "last_activity_date": 1516617355, "creation_date": 1516526068, "last_edit_date": 1516527694, "question_id": 48365311, "link": "https://stackoverflow.com/questions/48365311/if-pattern-matching-with-maybe-a-result", "title": "If pattern matching with `Maybe a` result", "body": "<p>Following code illustrates my intention. I want to pattern match, if it doesn't result is <code>Nothing</code>, if matches result is <code>Just something</code></p>\n\n<pre><code>data MyData = \n      A Int\n    | B String\n    | C\n\n\nifA (A i) = Just i \nifA _     = Nothing\n\nifB (B str) = Just str\nifB _     = Nothing\n\nifC C = Just () \nifC _ = Nothing \n\n\n\nmbMult3 i = Just (i*3)\n\nconcWorld str = Just (str ++ \"World\")\n\nexample1 v = ifA v &gt;&gt;= mbMult3\n\nexample2 v = ifB v &gt;&gt;= concWorld\n\n-- example2 (B \"Hello ,\") == Just \"Hello, World\"\n-- example2 (A 3) == Nothing\n</code></pre>\n\n<p>Are there other ways to do <code>ifA</code> <code>ifB</code> <code>ifC</code>. </p>\n\n<p><strong>Edit:</strong> </p>\n\n<ol>\n<li>I suspect that <code>lens</code> library might have something. But I know nothing about <code>lens</code> for now.</li>\n<li>Updated <code>ifC</code></li>\n</ol>\n"}, {"tags": ["haskell", "binary-tree", "binary-search-tree"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1516523896, "post_id": 48365022, "comment_id": 83716685, "body": "Take a look at <code>isBST l &lt; h</code> - what type is <code>h</code> and what is <code>isBST l</code>, I think you need to make your 2nd line a bit more complex, <code>isBST l &amp;&amp;isBST r &amp;&amp;...</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516526064, "post_id": 48365022, "comment_id": 83717175, "body": "FYI <code>if x then True else False</code> is just  <code>x</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516526360, "post_id": 48365022, "comment_id": 83717253, "body": "<code>the left subtree must always contain only nodes less than the head</code> and how do you express this condition?"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516526103, "post_id": 48365209, "comment_id": 83717189, "body": "Nope this doesn&#39;t work. And your data structure is broken (can you represent a tree with an even number of elements?)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516526261, "post_id": 48365209, "comment_id": 83717236, "body": "This does not work, since it does not forces that all subelements on the left are less than the value and vice versa."}, {"owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "edited": false, "score": 0, "creation_date": 1516529834, "post_id": 48365209, "comment_id": 83718061, "body": "Hope you guys can comment on the update; just trying to learn here"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516542290, "post_id": 48365209, "comment_id": 83721393, "body": "@Aky: now it is semantically correct (+1), but it is a bit inefficient, since for every node, you will check all the subnodes. But you thus check each node multiple times (for different bounds)."}], "tags": [], "owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "is_accepted": false, "score": 1, "last_activity_date": 1516529243, "last_edit_date": 1516529243, "creation_date": 1516525257, "answer_id": 48365209, "question_id": 48365022, "link": "https://stackoverflow.com/questions/48365022/determine-if-binary-tree-is-bst-haskell/48365209#48365209", "title": "Determine if binary tree is BST haskell", "body": "<p>I like Willem Van Onsem's pedagogical approach in his answer.</p>\n\n<p>I was going to delete my answer, but am going to post a \"correction\" instead, at the risk of being wrong again:</p>\n\n<pre><code>data Tree = Empty | Node Int Tree Tree deriving show\n\nisBST :: Tree -&gt; Bool\n\nisBST Empty = True\nisBST (Node h l r) = f (&lt;=h) l &amp;&amp; f (&gt;=h) r &amp;&amp; isBST l &amp;&amp; isBST r\n   where\n     f _ Empty = True\n     f c (Node h l r) = c h &amp;&amp; f c l &amp;&amp; f c r\n</code></pre>\n\n<p>Note that I'm using Wikipedia's definition of BST, that </p>\n\n<blockquote>\n  <p>the key in each node must be greater than or equal to any key stored\n  in the left sub-tree, and less than or equal to any key stored in the\n  right sub-tree.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516543205, "post_id": 48365455, "comment_id": 83721685, "body": "An easier way to check bounds is with functions. No bound is <code>const True</code> and an upper bound of <code>r</code> is <code>(&lt;= r)</code> (or <code>(&lt; r)</code> if you prefer). An interval (finite or not) is just a pair of functions."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516543310, "post_id": 48365455, "comment_id": 83721716, "body": "@n.m.: yeah, or we can define four variants of the function. It was more to define an example that is (hopefully) easy to understand."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1516559484, "post_id": 48365455, "comment_id": 83727164, "body": "Rather than maintaining a pair of Maybe Int bounds, it is much simpler to just do an in-order traversal of the tree and test whether the resulting list is sorted: it will be sorted iff the tree is a proper search tree."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1516543291, "last_edit_date": 1516543291, "creation_date": 1516527329, "answer_id": 48365455, "question_id": 48365022, "link": "https://stackoverflow.com/questions/48365022/determine-if-binary-tree-is-bst-haskell/48365455#48365455", "title": "Determine if binary tree is BST haskell", "body": "<blockquote>\n  <p>Is it something wrong with my haskell formatting?</p>\n</blockquote>\n\n<p>No, it is a semantical error. You write:</p>\n\n<pre><code>(isBST l) &lt; h\n</code></pre>\n\n<p>So this means you ask Haskell to determine whether <code>l</code> is a binary search tree, which is <code>True</code> or <code>False</code>, but you can not compare <code>True</code> or <code>False</code> with <code>h</code>. Even if you could (some languages see <code>True</code> as <code>1</code> and <code>False</code> as <code>0</code>), then it would still be incorrect, since we want to know whether <em>all</em> nodes in the left subtree are less than <code>h</code>.</p>\n\n<p>So we will somehow need to define bounds. A way to do this is to pass parameters through the recursion and perform checks. A problem with this is that the root of the tree for example, has no bounds. We can fix this by using a <code>Maybe Int</code> is a boundary: if it is <code>Nothing</code>, the boundary is \"inactive\" so to speak, if it is <code>Just b</code>, then the boundary is \"active\" with value <code>b</code>.</p>\n\n<p>In order to make this check more convenient, we can first write a way to check this:</p>\n\n<pre><code>checkBound :: (a -&gt; a -&gt; Bool) -&gt; Maybe a -&gt; a -&gt; Bool\ncheckBound _ Nothing _ = True\ncheckBound f (Just b) x = f b x\n</code></pre>\n\n<p>So now we can make a \"sandwich check\" with:</p>\n\n<pre><code>sandwich :: Ord a =&gt; Maybe a -&gt; Maybe a -&gt; a -&gt; Bool\nsandwich low upp x = checkBound (&lt;) low x &amp;&amp; checkBound (&gt;) upp x\n</code></pre>\n\n<p>So <code>sandwich</code> is given a lowerbound and an upperbound (both <code>Maybe a</code>s), and a value, and checks the lower and upper bounds.</p>\n\n<p>So we can write a function <code>isBST'</code> with:</p>\n\n<pre><code>isBST' :: Maybe Int -&gt; Maybe Int -&gt; Tree -&gt; Bool\nisBST' low upp ... = ....\n</code></pre>\n\n<p>There are two cases we need to take into account: the <code>Leaf x</code> case, in which the \"sandwich constraint\" should be satisfied, and the <code>Node h l r</code> case in which <code>h</code> should satisfy the \"sandwich constraint\" and furthermore <code>l</code> and <code>r</code> should satsify different sandwhich constraints. For the <code>Leaf x</code> it is thus like:</p>\n\n<pre><code>isBST' low upp (Leaf x) = sandwich low upp x\n</code></pre>\n\n<p>For the node case, we first check the same constraint, and then enforce a sandwich between <code>low</code> and <code>h</code> for the left part <code>l</code>, and a sandwich between <code>h</code> and <code>upp</code> for the right part <code>r</code>, so:</p>\n\n<pre><code>isBST' low upp (Node h l r) = sandwich low upp h &amp;&amp;\n                              isBST' low jh l &amp;&amp;\n                              isBST' jh upp r\n    where jh = Just h\n</code></pre>\n\n<p>Now the only problem we still have is to call <code>isBST'</code> with the root element: here we use <code>Nothing</code> as intial bounds, so:</p>\n\n<pre><code>isBST :: Tree -&gt; Bool\nisBST = isBST' Nothing Nothing\n</code></pre>\n\n<p>There are of course other ways to enforce constraints, like passing and updating functions, or by implement four variants of the <code>isBST'</code> function that check a subset of the constraints.</p>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 1, "last_activity_date": 1516548122, "creation_date": 1516548122, "answer_id": 48368361, "question_id": 48365022, "link": "https://stackoverflow.com/questions/48365022/determine-if-binary-tree-is-bst-haskell/48368361#48368361", "title": "Determine if binary tree is BST haskell", "body": "<p>Martin, I'd recommend you to look at Willem's answer.</p>\n\n<p>Another thing, you could also use your <code>maxInt</code> function that you asked in a previous question to define this function:</p>\n\n<pre><code>isBST (Node h l r) = ... (maxInt l) ... -- at some point we will need to use this\n</code></pre>\n\n<p>Taking your definition of BSTs:</p>\n\n<blockquote>\n  <p>I understand that for a binary tree to be a bst, the left subtree must\n  always contain only nodes less than the head. and the right subtree\n  must always contain only nodes greater than the head.</p>\n</blockquote>\n\n<p>I'll add that also the subtrees of a node should be BSTs as well.</p>\n\n<p>So we can define this requirement with:</p>\n\n<pre><code>isBST (Node h l r) =\n  ((maxInt l) &lt; h) -- the left subtree must contain nodes less than the head\n  &amp;&amp; ((minInt r) &gt; h) -- the right must contain nodes greater than the head\n  &amp;&amp; (...) -- the left subtree should be a BST\n  &amp;&amp; (...) -- the right subtree should be a BST\n</code></pre>\n\n<p>Recall that you might need to define <code>minInt :: Tree -&gt; Int</code>, as you probably know how to do that.</p>\n"}], "owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2766, "favorite_count": 0, "accepted_answer_id": 48368361, "answer_count": 3, "score": 1, "last_activity_date": 1516548122, "creation_date": 1516523594, "last_edit_date": 1516524055, "question_id": 48365022, "link": "https://stackoverflow.com/questions/48365022/determine-if-binary-tree-is-bst-haskell", "title": "Determine if binary tree is BST haskell", "body": "<p>I'm trying to write a bool function to return True if a binary tree is a bst using recursion, and I need a little guidance on haskell syntax. </p>\n\n<p>I understand that for a binary tree to be a bst, the left subtree must always contain only nodes less than the head. and the right subtree must always contain only nodes greater than the head. I was structuring my function as such:</p>\n\n<pre><code>isBST :: Tree -&gt; Bool       --recieve Tree, return bool\nisBST (Lead i) = True       --return true if its only one leaf in tree\nisBST (Node h l r) = if (((isBST l) &lt; h) &amp;&amp; ((isBST r) &gt; h)) then True else False   \n--return true if left subtree &lt; head AND right subtree &gt; head\n</code></pre>\n\n<p>But this code results in the error:</p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018Bool\u2019 with actual type \u2018Int\u2019</p>\n</blockquote>\n\n<p>Referring to the <code>&lt; h</code> and <code>&gt; h</code>  parts specifically. Is it something wrong with my haskell formatting? Thanks in advance</p>\n"}, {"tags": ["haskell", "currying"], "answers": [{"tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 2, "last_activity_date": 1516521167, "creation_date": 1516521167, "answer_id": 48364768, "question_id": 48364679, "link": "https://stackoverflow.com/questions/48364679/in-haskell-how-would-i-return-a-curried-function-that-has-a-recursive-definitio/48364768#48364768", "title": "In Haskell, how would I return a curried function that has a recursive definition?", "body": "<p>Actually, all functions in Haskell are curried by default, so you can just do</p>\n\n<pre><code>fold c h n = if n == 0 then c else h (fold c h (n-1))\n</code></pre>\n\n<p>If you still prefer to have an <code>f</code> inside, then</p>\n\n<pre><code>fold c h = f\n    where\n        f 0 = c\n        f n = h (f (n-1))\n</code></pre>\n\n<p>These versions are equivalent, and can be called like</p>\n\n<pre><code>fold 1 (*10) 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 1, "last_activity_date": 1516521529, "creation_date": 1516521529, "answer_id": 48364809, "question_id": 48364679, "link": "https://stackoverflow.com/questions/48364679/in-haskell-how-would-i-return-a-curried-function-that-has-a-recursive-definitio/48364809#48364809", "title": "In Haskell, how would I return a curried function that has a recursive definition?", "body": "<p>You're close.  Just declare a function that closes over <code>c</code> and <code>h</code>.</p>\n\n<pre><code>foldn c h = f where\n  f 0 = c\n  f n =  h . f $ n-1\n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 48364768, "answer_count": 2, "score": -2, "last_activity_date": 1516580291, "creation_date": 1516520486, "last_edit_date": 1516580291, "question_id": 48364679, "link": "https://stackoverflow.com/questions/48364679/in-haskell-how-would-i-return-a-curried-function-that-has-a-recursive-definitio", "title": "In Haskell, how would I return a curried function that has a recursive definition?", "body": "<p>I am trying to achieve the following (defined in Javascript) in Haskell:\nJS:</p>\n\n<pre><code>const fold = (c, h) =&gt; {\n  const f = (n) =&gt; {\n    return n === 0 ? c : h (f(n-1))\n  }\n  return f\n}\n\nfold(1, (x)=&gt;x*10)(3)\n</code></pre>\n\n<p>Repl Link: <a href=\"https://repl.it/repls/ExperiencedTeemingLorikeet\" rel=\"nofollow noreferrer\">https://repl.it/repls/ExperiencedTeemingLorikeet</a></p>\n\n<p>I tried something along these lines (but does not work):</p>\n\n<pre><code>foldn c h =\n f  = f' n\n      where f' 0 = c\n            f' n =  h(f'(n-1))\n f\n</code></pre>\n\n<p>Essentially I am trying to create a named curried function \"f\" that can be returned. Also note that the definition of \"f\" is <em>recursive</em>\nHow can I do this in Haskell?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1516516813, "creation_date": 1516516813, "answer_id": 48364330, "question_id": 48364248, "link": "https://stackoverflow.com/questions/48364248/haskell-module-import-path-navigation/48364330#48364330", "title": "Haskell module import path navigation", "body": "<p>Typically you don't save \"just code\" but modules <code>module ModuleName where</code>.  Modules are saved under a file name and path that reflects the module name so you'd have file <code>ADirectory/A.hs</code> (note the capital letter at the start) which starts with <code>module ADirectory.A where</code> and same with the others.</p>\n\n<p>After writing your code people collect the modules into the package. \n Sometimes off-handedly called \"cabalization\" due to using the <code>cabal-install</code> tool (or the alternative, <code>stack</code>), this can be done with <code>cabal init</code> and making sure your cabal file lists each module.</p>\n\n<p>Inside modules such as the file <code>ADirectory/A.hs</code>, you can import the other modules.  For example <code>A</code> can import <code>B</code> via <code>import BDirectory.B</code>.</p>\n\n<p>Finally, if it isn't already obvious, the import statements refer to modules which the compiler must already have installed. It isn't possible to import something based on a file system path.</p>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 48364330, "answer_count": 1, "score": 0, "last_activity_date": 1516516813, "creation_date": 1516515927, "question_id": 48364248, "link": "https://stackoverflow.com/questions/48364248/haskell-module-import-path-navigation", "title": "Haskell module import path navigation", "body": "<p>I have a directory structure which goes something like this</p>\n\n<pre><code>a\n- a.hs\n- b\n-- b.hs\n- c\n-- c.hs\n</code></pre>\n\n<p>I want to import c.hs in to b.hs but I can't work out how to go up a directory and in to b. Typically this would be something like <code>../c/c.hs</code>. </p>\n\n<p>What is the Haskell way to do this?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree", "tree-traversal", "preorder"], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516505974, "post_id": 48363452, "comment_id": 83713724, "body": "ok, so far after the declaration of my function I have this line: &quot;   preorder (Leaf n) = [n]  &quot;  covering the case in which my tree only has one node, in which case the function will return a list containing only that int.  Then I have the line &quot; preorder (Node n l r) = [n] ++ preorder l ++ preorder r  &quot; trying to combine lists and recursively call the function"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516506065, "post_id": 48363452, "comment_id": 83713736, "body": "Do I need to specify the list this function returns more?  With these three lines currently I get an error saying &quot;  Couldn&#39;t match expected type \u2018a\u2019 with actual type \u2018Int\u2019  &quot;"}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516506604, "post_id": 48363452, "comment_id": 83713806, "body": "Yes, because your type <code>a</code> isn&#39;t bounded in your definition, as your trees do not have elements of arbitrary types but elements of type <code>Int</code>, so you have to address the type I gave you in the answer: <code>preorder :: Tree -&gt; [Int]</code>."}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516506819, "post_id": 48363452, "comment_id": 83713832, "body": "The story would be different if your tree datatype was generalized like this: <code>data Tree a = Leaf a | Node a (Tree a) (Tree a)</code>. There you&#39;d have trees that could be of any type (not only ints, but of type <code>a</code>), so you can instantiate your <code>Int</code> trees with the datatype <code>Tree Int</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516508362, "post_id": 48363452, "comment_id": 83714054, "body": "What was &quot;subyacent&quot; supposed to be?"}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516508427, "post_id": 48363452, "comment_id": 83714068, "body": "Thank you! I was able to get my function working perfectly. I understand now why it didn&#39;t work, because I needed to specify my return types better, and how to format a recursive call combining multiple lists."}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516569617, "post_id": 48363452, "comment_id": 83730615, "body": "@Martin if this question has helped you, please consider marking it as solved, thanks!"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 3, "last_activity_date": 1516508407, "last_edit_date": 1516508407, "creation_date": 1516505795, "answer_id": 48363452, "question_id": 48363379, "link": "https://stackoverflow.com/questions/48363379/haskell-preorder-traversal-of-binary-tree/48363452#48363452", "title": "Haskell preorder traversal of binary tree", "body": "<p>It will depend on the underlying definition of the tree. They might be using another tree definition, a common one is like:</p>\n\n<pre><code>data Tree a b = Leaf b | Branch a (Tree a b) (Tree a b)\n</code></pre>\n\n<p>So they might need to get functions that map values of type <code>a</code> and <code>b</code> to the type <code>c</code>. As your tree definition only has elements of type <code>Int</code>, it would suffice for the <code>preorder</code> function to be of type <code>Tree -&gt; [Int]</code>.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>If you want a generalization of your trees in the type of their elements, you can declare this datatype:</p>\n\n<pre><code>data Tree a = Leaf a | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>and with this definition, you can define the type of the <code>preorder</code> function as follows:</p>\n\n<pre><code>preorder :: Tree a -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "accepted_answer_id": 48363452, "answer_count": 1, "score": 0, "last_activity_date": 1516508407, "creation_date": 1516504978, "question_id": 48363379, "link": "https://stackoverflow.com/questions/48363379/haskell-preorder-traversal-of-binary-tree", "title": "Haskell preorder traversal of binary tree", "body": "<p>I'm trying to write a function that will traverse a binary tree and return a list of the integers encountered. \nMy data Tree declaration is as follows:</p>\n\n<pre><code>data Tree = Node Int Tree Tree | Leaf Int\n   deriving (Eq,Show)\n</code></pre>\n\n<p>My first idea was to start the function off with:</p>\n\n<pre><code>preorder :: Tree -&gt; [a]  --take in tree, return list of ints\n</code></pre>\n\n<p>But I've seen some people solving this problem online by using a function declaration format similar to:</p>\n\n<pre><code>preorder :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Tree -&gt; [c]\n</code></pre>\n\n<p>And I don't really understand what this line is doing, is it taking multiple inputs? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1516491380, "post_id": 48362173, "comment_id": 83711254, "body": "Are you familiar with pattern matching yet? If so, what are some ways you might match on a <code>Tree</code> value?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516491502, "post_id": 48362173, "comment_id": 83711276, "body": "Well how would you define it in words? What is the maximum of a <code>Tree</code> (without the Haskell syntax)."}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516493662, "post_id": 48362173, "comment_id": 83711730, "body": "@WillemVanOnsem I would first check that the node is not null. Then get two ints, left_max and right_max that call the function recursively like so: int left_max = findmax(root.left) and right_max = findmax(root.left) . int max would be set to whichever one of these values is larger. If the current int value of the root passed into findmax() is greater than int max, then max will be set = root.intvalue. At the end of the function, int max will be returned."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516496346, "post_id": 48362173, "comment_id": 83712233, "body": "You&#39;ve tagged this <a href=\"https://stackoverflow.com/questions/tagged/binary-search-tree\">binary-search-tree</a>. Is this actually a binary search tree? If so, there&#39;s a bunch faster way to get the maximum! Your example suggests it&#39;s not, in which case you should remove that tag."}, {"owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "edited": false, "score": 0, "creation_date": 1516496601, "post_id": 48362173, "comment_id": 83712282, "body": "My question was for a binary tree, not a binary search tree. I know that if it was a bst I could just get the furthest left node. I&#39;ll remove the tag"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1516494643, "creation_date": 1516494643, "answer_id": 48362525, "question_id": 48362173, "link": "https://stackoverflow.com/questions/48362173/haskell-binary-tree-max-int/48362525#48362525", "title": "Haskell binary tree max int?", "body": "<p>Let me start it for you:</p>\n\n<pre><code>maxInt :: Tree -&gt; Int\nmaxInt (Leaf x) = ?\nmaxInt (Node x l r) = ?\n</code></pre>\n\n<p>You may find it helpful to use the standard function <code>max</code>, which takes two arguments and returns their maximum:</p>\n\n<pre><code>max 3 17 = 17\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 2, "last_activity_date": 1516497331, "last_edit_date": 1516497331, "creation_date": 1516495164, "answer_id": 48362558, "question_id": 48362173, "link": "https://stackoverflow.com/questions/48362173/haskell-binary-tree-max-int/48362558#48362558", "title": "Haskell binary tree max int?", "body": "<p>To begin with, we have this datatype:</p>\n\n<pre><code>data Tree = Node Int Tree Tree | Leaf Int\n  deriving (Eq,Show)\n</code></pre>\n\n<p>That means, we have two <code>constructors</code> for things of type <code>Tree</code>: either we have a <code>Leaf</code> with a single <code>Int</code> value, or we have a <code>Node</code> which allows us to represent bigger trees in a recursive fashion.</p>\n\n<p>So, for example we can have these trees:</p>\n\n<pre><code>Leaf 0\n</code></pre>\n\n<p>And more complex ones:</p>\n\n<pre><code>Node 3 (Leaf 0) (Leaf 4)\n</code></pre>\n\n<p>Recall that this tree representation have information both in the leaves and in the nodes, so for our function we will need to take that into account.</p>\n\n<p>You guessed correctly the type of the function <code>maxInt</code>, so you are halfway through!</p>\n\n<p>In order to define this function, given we have a custom defined datatype, we can be confident in using pattern-matching.</p>\n\n<p>Pattern-matching is, putting it simple, a way to define our functions by equations described by, on the left side, one element of our datatype (either <code>Leaf</code> or <code>Node</code>, in our case) and on the right side, the result value. I'd recommend you to learn more about pattern-matching here: <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">pattern matching in Haskell</a></p>\n\n<p>Hence, we start our function by its type, as you correctly guessed:</p>\n\n<pre><code>maxInt :: Tree -&gt; Int\n</code></pre>\n\n<p>As we have seen earlier, we will use pattern-matching for this. What would be the first equation, that is, the first pattern-matching case for our function? The simplest tree we have given our datatype is <code>Leaf value</code>. So we start with:</p>\n\n<pre><code>maxInt (Leaf n) = n\n</code></pre>\n\n<p>Why <code>n</code> as a result? Because we don't have any other value than <code>n</code> in the tree and therefore it's the maximum.</p>\n\n<p>What happens in a more complex case?</p>\n\n<pre><code>maxInt (Node n leftTree rightTree) = ...\n</code></pre>\n\n<p>Well... we can think that the maximum value for the tree <code>(Node n leftTree rightTree)</code> would be the maximum among <code>n</code>, the maximum value of <code>leftTree</code> and <code>rightTree</code>.</p>\n\n<p>Would you be encouraged to write the second equation? I strongly recommend you to first read the chapter of the book I just linked above. Also, you might want to read about <a href=\"http://learnyouahaskell.com/recursion\" rel=\"nofollow noreferrer\">recursion in Haskell</a>.</p>\n"}], "owner": {"reputation": 604, "user_id": 6365949, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/1Hn9j.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/6365949/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1114, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1516497331, "creation_date": 1516491118, "last_edit_date": 1516496612, "question_id": 48362173, "link": "https://stackoverflow.com/questions/48362173/haskell-binary-tree-max-int", "title": "Haskell binary tree max int?", "body": "<p>I'm trying to write a haskell function that will return the max int inside a binary tree of integers. My binary tree is defined as follows:</p>\n\n<pre><code>data Tree = Node Int Tree Tree | Leaf Int\nderiving (Eq,Show)\n</code></pre>\n\n<p>The way I understand it this declaration is saying that for the 'Tree' data type, it can either be a single leaf int, or be a subtree containing two more trees. \nSo my maxInt function will look something like this ( I think )</p>\n\n<pre><code>maxInt :: Tree -&gt; Int      --maxInt function receives Tree, returns int\nmaxInt --something to detect if the Tree received is empty \n--if only one node, return that int\n--look through all nodes, find largest\n</code></pre>\n\n<p>and so when my function is given something like \nmaxInt (Node 5 (Leaf 7) (Leaf 2)) , the correct value for maxInt to return would be 7.</p>\n\n<p>I'm new to haskell and don't really know where to start with this problem, I would really appreciate some guidance. Thank you</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516489182, "post_id": 48361850, "comment_id": 83710732, "body": "GHC 8.0.2 tries to be <i>more</i> deterministic. I think maybe the interface files are deterministic, or something like that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1516489278, "post_id": 48361850, "comment_id": 83710758, "body": "It may be that GHC runs out of memory trying to build a bunch of things at once, but when it has some build products on hand it can finish the job. Just guessing."}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1516499565, "post_id": 48361850, "comment_id": 83712751, "body": "@dfeuer, you&#39;re right - I tried playing around with the memory allocated to the VM and it does work fine with 1.5GB instead of 1GB."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1517610060, "post_id": 48361850, "comment_id": 84180611, "body": "@dfeuer can you post your comment as an answer so it can be accepted?"}], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 380, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1516488340, "creation_date": 1516488340, "question_id": 48361850, "link": "https://stackoverflow.com/questions/48361850/third-times-the-charm-nondeterministic-stack-ghc", "title": "Third time&#39;s the charm - Nondeterministic Stack / GHC", "body": "<p>I've been trying to install the package <code>text</code> using Stack inside an Ubuntu VM. The funny thing is - it doesn't the work the first time (Stack stops with a segfault), it doesn't work the second time (an internal GHC error) but it works the third time.</p>\n\n<p>The VM is set up using the following <code>Vagrantfile</code>.</p>\n\n<pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n\n  config.vm.box = \"ubuntu/trusty64\"\n  config.ssh.forward_x11 = true\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.memory = \"1024\"\n    vb.cpus = 1\n  end\n\n  config.vm.hostname = \"stack-project\"\n  config.vm.provision \"shell\", path: \"root-bootstrap.sh\"\n</code></pre>\n\n<p>The <code>root-bootstrap.sh</code> file is</p>\n\n<pre><code>#!/bin/bash\nset -x\nset -e\n\nexport DEBIAN_FRONTEND=\"noninteractive\"\n\napt-get -qq update &amp;&gt;/dev/null\napt-get -qq install software-properties-common \\\n  pkg-config wget dpkg nano vim \\\n  &amp;&gt;/dev/null\n\n# Haskell Stack\nwget -qO- https://get.haskellstack.org/ | sh\n\nchown -R vagrant $HOME\n</code></pre>\n\n<p>After running <code>vagrant up &amp;&amp; vagrant ssh</code> (the two files need to be put in the same folder), I checked that Stack was installed.</p>\n\n<pre><code>vagrant@stack-project:~$ stack --version\nVersion 1.6.3, Git revision b27e629b8c4ce369e3b8273f04db193b060000db (5454 commits) x86_64 hpack-0.20.0\n</code></pre>\n\n<p>I tried installing <code>text</code> next</p>\n\n<pre><code>vagrant@stack-project:~$ stack install --resolver lts-10.3 text\nWriting implicit global project config file to: /home/vagrant/.stack/global-project/stack.yaml\nNote: You can change the snapshot via the resolver field there.\nUsing resolver: lts-10.3 specified on command line\nDownloaded lts-10.3 build plan.\nPreparing to install GHC to an isolated location.\nThis will not interfere with any system-level installation.\n\nWarning: Retry number 0 after a total delay of 0 us\n         If you see this warning and stack fails to download, but running the\n         command again solves the problem, please report here:\n         https://github.com/commercialhaskell/stack/issues/3510\nDownloaded ghc-8.2.2.\nInstalled GHC.\nSelected mirror https://s3.amazonaws.com/hackage.fpcomplete.com/\nDownloading root\nSelected mirror https://s3.amazonaws.com/hackage.fpcomplete.com/\nDownloading timestamp\nDownloading snapshot\nDownloading mirrors\nCannot update index (no local copy)\nDownloading index\nUpdated package index downloaded\nUpdate complete\nPopulated index cache.\nSegmentation fault (core dumped)\n</code></pre>\n\n<p>I noticed that the VM has ~75 MB memory free when the segfault happens. On running it the second time,</p>\n\n<pre><code>vagrant@stack-project:~$ stack install --resolver lts-10.3 text\n[1 of 2] Compiling Main             ( /home/vagrant/.stack/setup-exe-src/setup-mPHDZzAJ.hs, /home/vagrant/.stack/setup-exe-src/setup-mPHDZzAJ.o )\n[2 of 2] Compiling StackSetupShim   ( /home/vagrant/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /home/vagrant/.stack/setup-exe-src/setup-shim-mPHDZzAJ.o )\nLinking /home/vagrant/.stack/setup-exe-cache/x86_64-linux/tmp-Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 ...\ntext-1.2.2.2: download\ntext-1.2.2.2: configure\ntext-1.2.2.2: build\n\n--  While building custom Setup.hs for package text-1.2.2.2 using:\n      /home/vagrant/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.0.1.0 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure (-6)\n    Logs have been written to: /home/vagrant/.stack/global-project/.stack-work/logs/text-1.2.2.2.log\n\n    Configuring text-1.2.2.2...\n    Preprocessing library for text-1.2.2.2..\n    Building library for text-1.2.2.2..\n    [ 1 of 44] Compiling Data.Text.Encoding.Error ( Data/Text/Encoding/Error.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Encoding/Error.o )\n    [ 2 of 44] Compiling Data.Text.Internal.Builder.Int.Digits ( Data/Text/Internal/Builder/Int/Digits.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Builder/Int/Digits.o )\n    [ 3 of 44] Compiling Data.Text.Internal.Builder.RealFloat.Functions ( Data/Text/Internal/Builder/RealFloat/Functions.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Builder/RealFloat/Functions.o )\n    [ 4 of 44] Compiling Data.Text.Internal.Encoding.Utf16 ( Data/Text/Internal/Encoding/Utf16.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Encoding/Utf16.o )\n    [ 5 of 44] Compiling Data.Text.Internal.Encoding.Utf32 ( Data/Text/Internal/Encoding/Utf32.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Encoding/Utf32.o )\n    [ 6 of 44] Compiling Data.Text.Internal.Functions ( Data/Text/Internal/Functions.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Functions.o )\n    [ 7 of 44] Compiling Data.Text.Internal.Read ( Data/Text/Internal/Read.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Read.o )\n    [ 8 of 44] Compiling Data.Text.Internal.Unsafe ( Data/Text/Internal/Unsafe.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Unsafe.o )\n    [ 9 of 44] Compiling Data.Text.Internal.Unsafe.Shift ( Data/Text/Internal/Unsafe/Shift.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Unsafe/Shift.o )\n    [10 of 44] Compiling Data.Text.Array  ( Data/Text/Array.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Array.o )\n    [11 of 44] Compiling Data.Text.Internal.Unsafe.Char ( Data/Text/Internal/Unsafe/Char.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Unsafe/Char.o )\n    [12 of 44] Compiling Data.Text.Internal.Encoding.Utf8 ( Data/Text/Internal/Encoding/Utf8.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Encoding/Utf8.o )\n    [13 of 44] Compiling Data.Text.Internal ( Data/Text/Internal.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal.o )\n    [14 of 44] Compiling Data.Text.Internal.Search ( Data/Text/Internal/Search.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Search.o )\n    [15 of 44] Compiling Data.Text.Internal.Fusion.Size ( Data/Text/Internal/Fusion/Size.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Fusion/Size.o )\n    [16 of 44] Compiling Data.Text.Internal.Fusion.Types ( Data/Text/Internal/Fusion/Types.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Fusion/Types.o )\n    [17 of 44] Compiling Data.Text.Internal.Fusion.CaseMapping ( Data/Text/Internal/Fusion/CaseMapping.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Fusion/CaseMapping.o )\n    [18 of 44] Compiling Data.Text.Internal.Fusion.Common ( Data/Text/Internal/Fusion/Common.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Fusion/Common.o )\n    [19 of 44] Compiling Data.Text.Unsafe ( Data/Text/Unsafe.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Unsafe.o )\n    [20 of 44] Compiling Data.Text.Internal.Private ( Data/Text/Internal/Private.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Private.o )\n    [21 of 44] Compiling Data.Text.Internal.Fusion ( Data/Text/Internal/Fusion.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Fusion.o )\n    [22 of 44] Compiling Data.Text.Show   ( Data/Text/Show.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Show.o )\n    [23 of 44] Compiling Data.Text.Internal.Encoding.Fusion.Common ( Data/Text/Internal/Encoding/Fusion/Common.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Encoding/Fusion/Common.o )\n    [24 of 44] Compiling Data.Text.Internal.Lazy.Encoding.Fusion ( Data/Text/Internal/Lazy/Encoding/Fusion.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Lazy/Encoding/Fusion.o )\n    [25 of 44] Compiling Data.Text.Internal.Encoding.Fusion ( Data/Text/Internal/Encoding/Fusion.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Internal/Encoding/Fusion.o )\n    [26 of 44] Compiling Data.Text.Encoding ( Data/Text/Encoding.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Encoding.o )\n    [27 of 44] Compiling Data.Text.Foreign ( Data/Text/Foreign.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text/Foreign.o )\n    [28 of 44] Compiling Data.Text        ( Data/Text.hs, .stack-work/dist/x86_64-linux/Cabal-2.0.1.0/build/Data/Text.o )\n    ghc: internal error: Unable to commit 1048576 bytes of memory\n        (GHC version 8.2.2 for x86_64_unknown_linux)\n        Please report this as a GHC bug:  http://www.haskell.org/ghc/reportabug\n</code></pre>\n\n<p>You'd think that re-running <code>stack install</code> would give the same GHC error again, right? Wrong.</p>\n\n<pre><code>vagrant@stack-project:~$ stack install --cabal-verbose --resolver lts-10.3 text\ntext-1.2.2.2: configure\ntext-1.2.2.2: build\ntext-1.2.2.2: copy/register\n</code></pre>\n\n<p>As a check, I tried using <code>stack ghci --ghc-options \"-package text\"</code> which worked fine and I could use the functions normally. I installed <code>megaparsec</code> (any library depending on <code>text</code> will do) and it installed fine.</p>\n\n<p>What combination of a stack bug, a GHC bug and a ghost am I encountering here?</p>\n\n<p>Other stuff that might be relevant:</p>\n\n<ol>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/4012\" rel=\"nofollow noreferrer\">Ticket 4012</a> -  Compilation results are not deterministic. If I were guessing, this is the difference between the second time and the third time. The milestone version is currently 8.4.1, whereas the GHC in lts-10.3 is 8.2.2.</li>\n<li>An <a href=\"https://conf.researchr.org/event/icfp-2016/hiw-2016-papers-ghc-determinism\" rel=\"nofollow noreferrer\">ICFP 2016 paper</a> (indirectly?) claiming that GHC 8.0.2 is deterministic.</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1, "user_id": 9245043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0485ad22da970dfed3098a9ebf05e43?s=128&d=identicon&r=PG&f=1", "display_name": "boy man", "link": "https://stackoverflow.com/users/9245043/boy-man"}, "edited": false, "score": 0, "creation_date": 1516471406, "post_id": 48359433, "comment_id": 83705530, "body": "If it is indeed possible"}, {"owner": {"reputation": 1, "user_id": 9245043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0485ad22da970dfed3098a9ebf05e43?s=128&d=identicon&r=PG&f=1", "display_name": "boy man", "link": "https://stackoverflow.com/users/9245043/boy-man"}, "edited": false, "score": 0, "creation_date": 1516471420, "post_id": 48359433, "comment_id": 83705535, "body": "if it can be done"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516476432, "post_id": 48359433, "comment_id": 83707150, "body": "Note that the linked duplicate assumes you want a cyclic list, and that you can&#39;t have an empty list."}], "owner": {"reputation": 1, "user_id": 9245043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0485ad22da970dfed3098a9ebf05e43?s=128&d=identicon&r=PG&f=1", "display_name": "boy man", "link": "https://stackoverflow.com/users/9245043/boy-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1516472183, "answer_count": 0, "score": 0, "last_activity_date": 1516471727, "creation_date": 1516471389, "last_edit_date": 1516471727, "question_id": 48359433, "link": "https://stackoverflow.com/questions/48359433/how-to-create-doubly-linked-list-in-haskell", "closed_reason": "Duplicate", "title": "How to create doubly linked list in haskell?", "body": "<p>How do you create a doubly linked list in Haskell? I am trying to familiarize myself with the Haskell language and am trying to create this data structure using Haskell's functional paradigm.</p>\n"}, {"tags": ["multithreading", "haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 7, "last_activity_date": 1516469453, "last_edit_date": 1516469453, "creation_date": 1516468221, "answer_id": 48358879, "question_id": 48358718, "link": "https://stackoverflow.com/questions/48358718/how-does-ghc-recognize-that-a-thread-is-blockedindefinitelyonmvar/48358879#48358879", "title": "How does GHC recognize that a thread is BlockedIndefinitelyOnMVar?", "body": "<p>It <a href=\"https://github.com/ghc/ghc/blob/9d299253e29558b7d18e6643e1a84fb2bbbecfe5/libraries/base/Control/Concurrent.hs#L643\" rel=\"noreferrer\">uses the garbage collector</a>.</p>\n\n<p>From Control.Concurrent:</p>\n\n<blockquote>\n  <p>GHC attempts to detect when threads are deadlocked using the garbage\n  collector.  A thread that is not reachable (cannot be found by\n  following pointers from live objects) must be deadlocked, and in this\n  case the thread is sent an exception.  The exception is either\n  'BlockedIndefinitelyOnMVar', 'BlockedIndefinitelyOnSTM',\n  'NonTermination', or 'Deadlock', depending on the way in which the\n  thread is deadlocked.</p>\n  \n  <p>Note that this feature is intended for debugging, and should not be\n  relied on for the correct operation of your program.  There is no\n  guarantee that the garbage collector will be accurate enough to detect\n  your deadlock, and no guarantee that the garbage collector will run in\n  a timely enough manner.  Basically, the same caveats as for finalizers\n  apply to deadlock detection.</p>\n  \n  <p>There is a subtle interaction between deadlock detection and\n  finalizers (as created by 'Foreign.Concurrent.newForeignPtr' or the\n  functions in \"System.Mem.Weak\"): if a thread is blocked waiting for a\n  finalizer to run, then the thread will be considered deadlocked and\n  sent an exception.  So preferably don't do this, but if you have no\n  alternative then it is possible to prevent the thread from being\n  considered deadlocked by making a 'StablePtr' pointing to it.  Don't\n  forget to release the 'StablePtr' later with 'freeStablePtr'.</p>\n</blockquote>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "accepted_answer_id": 48358879, "answer_count": 1, "score": 3, "last_activity_date": 1516469453, "creation_date": 1516467360, "question_id": 48358718, "link": "https://stackoverflow.com/questions/48358718/how-does-ghc-recognize-that-a-thread-is-blockedindefinitelyonmvar", "title": "How does GHC recognize that a thread is BlockedIndefinitelyOnMVar?", "body": "<p>If a thread waits on an <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent-MVar.html#t:MVar\" rel=\"nofollow noreferrer\"><code>MVar</code></a> that doesn't have a possible producer, GHC is usually smart enough to throw <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Exception-Base.html#t:BlockedIndefinitelyOnMVar\" rel=\"nofollow noreferrer\"><code>BlockedIndefinitelyOnMVar</code></a> and kill the thread. How is this detection implemented?</p>\n\n<p>Does it check that all references to an <code>MVar</code> are from threads that are waiting on it, or something like that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516466362, "post_id": 48358101, "comment_id": 83703767, "body": "Very not clear what you&#39;re trying you do in Haskell there. For example, what is the purpose of <code>IO ()</code> in <code>Logger</code> and why are you discarding it in bind?"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1516466887, "creation_date": 1516466887, "answer_id": 48358650, "question_id": 48358101, "link": "https://stackoverflow.com/questions/48358101/try-to-make-haskell-logger-for-learning-but-restrictions-of-monad-instances-stan/48358650#48358650", "title": "Try to make Haskell logger for learning but restrictions of Monad instances stand in my way", "body": "<p>You can use <code>RebindableSyntax</code> to redefine <code>(&gt;&gt;=)</code> in any way you want.</p>\n\n<p>Note that this is does not satisfy the monad laws, unless you consider an equivalence relation on programs that is oblivious to differences in logging.</p>\n\n<p>There is also some more noise with those <code>return</code> because is no <code>let!</code> syntax that desugars to <code>(&gt;&gt;=)</code>.</p>\n\n<p>Also, why would you not call <code>log</code> just where it is necessary?</p>\n\n<pre><code>{-# LANGUAGE RebindableSyntax #-}\n\nimport qualified Control.Monad as Monad\nimport Prelude (IO, Show(show), (++), putStrLn, ($), fromInteger, Int, (+))\n\nclass CMonad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=) :: Show a =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n\nlog :: Show a =&gt; a -&gt; IO ()\nlog x = putStrLn $ \"Expression is: \" ++ show x\n\ninstance CMonad IO where\n  return = Monad.return\n  m &gt;&gt;= k = m Monad.&gt;&gt;= \\a -&gt; log a Monad.&gt;&gt; k a\n\nmain :: IO Int\nmain = do\n  x &lt;- return (42 :: Int)\n  y &lt;- return (43 :: Int)\n  z &lt;- return (x + y)\n  return z\n</code></pre>\n"}], "owner": {"reputation": 2659, "user_id": 581085, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5ef2ca8729e462595f1500b554ef95e0?s=128&d=identicon&r=PG", "display_name": "Dragno", "link": "https://stackoverflow.com/users/581085/dragno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 48358650, "answer_count": 1, "score": 0, "last_activity_date": 1516466887, "creation_date": 1516463773, "last_edit_date": 1516466023, "question_id": 48358101, "link": "https://stackoverflow.com/questions/48358101/try-to-make-haskell-logger-for-learning-but-restrictions-of-monad-instances-stan", "title": "Try to make Haskell logger for learning but restrictions of Monad instances stand in my way", "body": "<pre><code>import Control.Monad\n\ndata Logger l a = Logger {runLogger :: (IO (),a,l)}\n\niologger :: (Show l)=&gt; l-&gt;a-&gt;(a-&gt;b)-&gt;Logger l b\niologger l a f = Logger (print l,f a,l) \n\ninstance (Show l)=&gt;Monad (Logger l) where\n  return a = iologger (show \"\") a id\n  logger&gt;&gt;=f = let (_,va,vl) = runLogger logger\n           in iologger vl va f\n</code></pre>\n\n<p>The above code does not compile. What I want to make is something like this(code below is F# computation expressions)</p>\n\n<pre><code>let loggedWorkflow = \nlogger\n    {\n    let! x = 42\n    let! y = 43\n    let! z = x + y\n    return z\n    }\n</code></pre>\n\n<p>The above code logs the result because of this</p>\n\n<pre><code>type LoggingBuilder() =\n    let log p = printfn \"expression is %A\" p\n\n    member this.Bind(x, f) = \n        log x\n        f x\n\n    member this.Return(x) = \n        x\n</code></pre>\n\n<p>But this does not work in Haskell because <code>print</code> wants <code>Show</code> restriction. The <code>Writer</code> monad cannot do this also because is explicit. In every code you write you must put <code>tell</code>. Any ideas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1516464396, "post_id": 48357902, "comment_id": 83703062, "body": "So using <code>splitOn</code> from <code>Data.List.Split</code> is not allowed?"}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1516464424, "post_id": 48357902, "comment_id": 83703078, "body": "@RoadRunner nope, only Prelude"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516464432, "post_id": 48357902, "comment_id": 83703085, "body": "Hint: take a look at the implementation of <code>splitOn</code>."}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516465231, "post_id": 48357902, "comment_id": 83703372, "body": "@WillemVanOnsem I have, it uses functions from Data.List and I may only use Prelude functions"}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1516465552, "post_id": 48357902, "comment_id": 83703479, "body": "@RoadRunner wouldn&#39;t that make it [[a]] then? Since &quot;&quot; is a list, [&quot;&quot;] would be a list of lists am I wrong?"}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516469599, "post_id": 48358826, "comment_id": 83704929, "body": "This is nice and handy and I appreciate the help and idea, the thing is I can&#39;t change my type since it&#39;s given already, it needs to stay <code>sep :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]</code>"}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1516470823, "post_id": 48358826, "comment_id": 83705336, "body": "@Wireless The type doesn&#39;t need to change from what you were given. <code>String</code> is <code>[Char]</code>, and <code>[String]</code> is <code>[[Char]]</code>, so <code>sep2</code> is already <code>[Char] -&gt; [Char] -&gt; [[Char]]</code>, which is a lot like <code>[a] -&gt; [a] -&gt; [[a]]</code>, so you can just use a more general type signature (the one you were given)."}], "tags": [], "owner": {"reputation": 619, "user_id": 8514005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a3ae487b2140f9d08079450b6903d?s=128&d=identicon&r=PG&f=1", "display_name": "JohEker", "link": "https://stackoverflow.com/users/8514005/joheker"}, "is_accepted": true, "score": 2, "last_activity_date": 1516467974, "creation_date": 1516467974, "answer_id": 48358826, "question_id": 48357902, "link": "https://stackoverflow.com/questions/48357902/haskell-splitoneof-definition-issues/48358826#48358826", "title": "Haskell SplitOneOf definition issues", "body": "<p>When we are comparing lists or in this case as i understand we compare strings, there are a few things we need to understand. We can't check if something of type <code>[a]</code> is an element of some other type <code>[a]</code>. We can compare them, but we can never compare the elements by forcing an entire list upon another.</p>\n\n<pre><code>[a] `elem` [a] // makes no sense\n a  `elem` [a] // is what we are looking for.\n</code></pre>\n\n<p>To clean up a string is easy, one way is to replace all elements which holds for some kind of requirement with something else. In this case we could replace all the elements with a space, and we can apply the prelude function <code>words</code> on the result.</p>\n\n<pre><code>sep :: String -&gt; String -&gt; String\nsep _ [] = []\nsep s1 (s:ss) | s `elem` s1 = \" \" ++ sep s1 ss\n              | otherwise   =   s : sep s1 ss\n</code></pre>\n\n<p>And then we can ofcourse make it a bit more haskell by binding it together with some high effective haskell functions.</p>\n\n<pre><code>sep2 :: String -&gt; String -&gt; [String]\nsep2 s1 s2 = words $ map(\\x -&gt; if (x `elem` s1) then ' ' else x) s2\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 48358826, "answer_count": 1, "score": -2, "last_activity_date": 1516554153, "creation_date": 1516462614, "last_edit_date": 1516554153, "question_id": 48357902, "link": "https://stackoverflow.com/questions/48357902/haskell-splitoneof-definition-issues", "title": "Haskell SplitOneOf definition issues", "body": "<p>Hello Guys :D back with another Haskell question here. So I'm practicing for my final exam and I was doing an exercise from past exams and it's basically making the function splitOneOf if I'm not mistaken, I wish to create a function that upon detecting one of a given list of characters removes them from another list and returns a list of strings, from where it split.</p>\n\n<p>What I have so far, which is not much since it doesn't work, is this</p>\n\n<pre><code>sep :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\nsep _ [] = []\nsep n xs\n    | n `elem` xs = ... (I had stuff in here, didn't put for sake of it being easier to understand where I'm at trouble)\n    | otherwise = error \"Error\"\n</code></pre>\n\n<p>What I want as a result would be this:</p>\n\n<pre><code>ghci&gt; sep \" \\t\\n\" \"As armas\\te\\tos bar\u00f5es\\n   que\"\n    **&gt; [\"As\",\"armas\",\"e\",\"os\",\"bar\u00f5es\",\"que\"]\n</code></pre>\n\n<p>EDIT: After testing out the help you gave me, it's giving me an error, this is what I have:</p>\n\n<pre><code>sep :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\nsep _ [] = []\nsep n (x:xs) \n    | x `elem` n = \" \" ++ sep n xs\n    | otherwise  = x : sep n xs\n</code></pre>\n\n<p>And it's giving me the following error: </p>\n\n<pre><code>Couldn't match type 'Char' with '[a]'\n  Expected type: [[a]]\n    Actual type: [Char]\n  In the expression: \" \" ++ sep n xs\n\nCouldn't match type '[a]' with 'Char'\n  Expected type: [Char]\n    Actual type: [[a]]\nIn the second argument of \u00b4(++)\u00b4, namely \u00b4sep n xs\u00b4\n</code></pre>\n"}, {"tags": ["list", "haskell", "primes"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1516460501, "post_id": 48356941, "comment_id": 83701815, "body": "You should probably add a base case <code>a [] = []</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1516912159, "post_id": 48356941, "comment_id": 83895664, "body": "Note that this function is probably <i>intended</i> to be run on an infinite list as in <code>a [2..]</code> or <code>a [3,5..]</code> in which case it generates an (infinite) list of primes without ever needing the base case."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1516462275, "post_id": 48357077, "comment_id": 83702400, "body": "Minor point: I&#39;d rather say &quot;it generates&quot; or &quot;it outputs&quot; than &quot;it prints&quot;, since the function does not involve I/O on its own, it only returns the new list. (+1)"}], "tags": [], "owner": {"reputation": 71, "user_id": 9240247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b204a0daf529cb587d6bc53e79aa5e8?s=128&d=identicon&r=PG&f=1", "display_name": "Professor Flitwick", "link": "https://stackoverflow.com/users/9240247/professor-flitwick"}, "is_accepted": false, "score": 6, "last_activity_date": 1516542807, "last_edit_date": 1516542807, "creation_date": 1516457211, "answer_id": 48357077, "question_id": 48356941, "link": "https://stackoverflow.com/questions/48356941/modify-haskell-function-to-run-correctly/48357077#48357077", "title": "Modify haskell function to run correctly", "body": "<p>What you have here is a recursive function: You are calling <code>a bs</code> in your definition. Eventually bs will be the empty list, and at that point you get an exception. You can, for example, add the following line to your code:</p>\n\n<pre><code>a [] = []\n</code></pre>\n\n<p>Then the output will become:</p>\n\n<pre><code>[3,5,7,11,13,17,19,23,29,31,37,41]\n</code></pre>\n\n<p>As for what this function does, it returns every element in the list which is not a multiple of any previous element in the list. If you give it a list <code>[2..x]</code> where <code>x</code> is any integer, this is the same thing as a list of all prime numbers from <code>2</code> to <code>x</code>. </p>\n\n<p>Another way of getting a list of primes is the one you've found:\nYou start from 3 and make the Haskell list comprehension skip any multiples of 2.</p>\n"}], "owner": {"reputation": 15, "user_id": 6190644, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f0e58568f9c41a22a7c7a29ea058d163?s=128&d=identicon&r=PG&f=1", "display_name": "Netherar", "link": "https://stackoverflow.com/users/6190644/netherar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516542807, "creation_date": 1516456398, "question_id": 48356941, "link": "https://stackoverflow.com/questions/48356941/modify-haskell-function-to-run-correctly", "title": "Modify haskell function to run correctly", "body": "<p>I have the following haskell code:</p>\n\n<pre><code>a (b : bs) = b : [c | c &lt;- (a bs), c `rem` b /= 0]\n</code></pre>\n\n<p>Can someone explain what this code does?\nRunning a as</p>\n\n<pre><code>a [3,5..42]\n</code></pre>\n\n<p>returns </p>\n\n<pre><code>  Prelude&gt; a [3,5..42]\n[3,5,7,11,13,17,19,23,29,31,37,41*** Exception: &lt;interactive&gt;:71:1-46: Non-exhaustive patterns in function a\n</code></pre>\n\n<p>From what i can see, the function works like the Sieve of Eratosthenes. The function considers b as a prime number and filters out the multiples of b. But i'm not really sure how. On top of that, the function throws this exception.</p>\n"}, {"tags": ["haskell", "module"], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 0, "creation_date": 1516461479, "post_id": 48357683, "comment_id": 83702146, "body": "Thanks for the response, but with this solution, &quot;librarymodule&quot; will not be able to read the contents of libraryconfig.txt anymore because that file used to be in the same directory. How would I use cabal in my situation? I can&#39;t figure it out"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 0, "creation_date": 1516462755, "post_id": 48357683, "comment_id": 83702522, "body": "You have to change the path to <code>libraryconfig.txt</code> inside the library, either make it an absolute path, or make it configurable."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 0, "creation_date": 1516462878, "post_id": 48357683, "comment_id": 83702564, "body": "In a <code>cabal</code>  package you can specify <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#pkg-field-data-files\" rel=\"nofollow noreferrer\"><code>data-files</code></a> to install together with your package, and <code>cabal</code> provides your package a custom module that abstracts the location of those files."}, {"owner": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 0, "creation_date": 1516463594, "post_id": 48357683, "comment_id": 83702802, "body": "I just created the cabal file inside &quot;root&quot; using the command &quot;cabal init&quot; and did &quot;cabal install &lt;cabalfile&gt;&quot; which created a dist folder, whats next?"}, {"owner": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 0, "creation_date": 1516464569, "post_id": 48357683, "comment_id": 83703129, "body": "did a stack --init solver, only it does still not see libraryconfig.txt even though it is included using data-files"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "edited": false, "score": 1, "creation_date": 1516465696, "post_id": 48357683, "comment_id": 83703533, "body": "I added a small example in my answer. I hope that will be sufficient to work but note that it will take time to learn these tools (<code>stack</code> or <code>cabal-install</code>) to fully understand what is happening."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1516465569, "last_edit_date": 1516465569, "creation_date": 1516461086, "answer_id": 48357683, "question_id": 48356636, "link": "https://stackoverflow.com/questions/48356636/importing-a-haskell-module-from-the-parent-directory/48357683#48357683", "title": "Importing a haskell module from the parent directory", "body": "<p>GHC has a <code>-i</code> option. Under <code>root/scripts/</code>, this will add <code>root/source/</code> to the search path:</p>\n\n<pre><code>ghc -i../source script1.hs\n</code></pre>\n\n<p>Also consider packaging your library using <code>cabal</code> so you can install it and use it anywhere without worrying about paths.</p>\n\n<hr>\n\n<p>Here is a minimal example of a library with <code>data-files</code>:</p>\n\n<pre><code>source/\n\u251c\u2500\u2500 mylibrary.cabal\n\u251c\u2500\u2500 LibraryModule.hs\n\u2514\u2500\u2500 libraryconfig.txt\n</code></pre>\n\n<h3><code>mylibrary.cabal</code></h3>\n\n<pre><code>name: mylibrary\nversion: 0.0.1\nbuild-type: Simple\ncabal-version: &gt;= 1.10\ndata-files: libraryconfig.txt\n\nlibrary\n  exposed-modules: LibraryModule\n  other-modules: Paths_mylibrary\n  build-depends: base\n  default-language: Haskell2010\n</code></pre>\n\n<h3><code>LibraryModule.hs</code></h3>\n\n<pre><code>module LibraryModule where\n\nimport Paths_mylibrary  -- This module will be generated by cabal\n\n-- Some function that uses the data-file\nprintConfig :: IO ()\nprintConfig = do\n  n &lt;- getDataFileName \"libraryconfig.txt\"\n  -- Paths_mylibrary.getDataFileName resolves paths for files associated with mylibrary\n  c &lt;- readFile n\n  print c\n</code></pre>\n\n<p>See this link for information about the <code>Paths_*</code> module: <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#accessing-data-files-from-package-code\" rel=\"noreferrer\">https://www.haskell.org/cabal/users-guide/developing-packages.html#accessing-data-files-from-package-code</a></p>\n\n<p>Now running <code>cabal install</code> should install <code>mylibrary</code>.</p>\n\n<p>Then, under <code>scripts/script1.hs</code>, you can just run <code>ghc script1.hs</code>, using the library you installed.</p>\n"}], "owner": {"reputation": 155, "user_id": 4660266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56e8126826ff166f7ac290473fd4a09?s=128&d=identicon&r=PG&f=1", "display_name": "JonasAnon", "link": "https://stackoverflow.com/users/4660266/jonasanon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 1, "accepted_answer_id": 48357683, "answer_count": 1, "score": 1, "last_activity_date": 1516465569, "creation_date": 1516454548, "question_id": 48356636, "link": "https://stackoverflow.com/questions/48356636/importing-a-haskell-module-from-the-parent-directory", "title": "Importing a haskell module from the parent directory", "body": "<p>Given the following directory structure:</p>\n\n<pre><code>root\n\u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 script1.hs\n\u2514\u2500\u2500 source\n \u00a0\u00a0 \u251c\u2500\u2500 librarymodule.hs\n \u00a0\u00a0 \u2514\u2500\u2500 libraryconfig.txt\n</code></pre>\n\n<p>Where \"librarymodule.hs\" would be a library exporting multiple functions, where the output is influenced by the contents of the libraryconfig.txt file in his directory.</p>\n\n<p>script1.hs is the file needing to use the functions declared in librarymodule.hs.</p>\n\n<p>I can't find a solution on the internet for a structure as given above and hoped someone could help out.</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 1, "creation_date": 1516446973, "post_id": 48355417, "comment_id": 83697415, "body": "your code should work perfectly"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516448382, "post_id": 48355417, "comment_id": 83697873, "body": "I would also use <code>False</code> here, since it could be possible that the first expression is <code>undefined</code>."}, {"owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516448574, "post_id": 48355417, "comment_id": 83697929, "body": "@WillemVanOnsem I did wonder if the catch-all could be anything other than <code>False</code>, didn&#39;t think of <code>undefined</code> though as I&#39;m not that familiar with it"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1516451907, "post_id": 48355417, "comment_id": 83699000, "body": "@WillemVanOnsem The function is already strict in the first argument because of the pattern match with. <code>True</code>. So using <code>_</code> vs. <code>False</code> won&#39;t make a difference."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1516452651, "post_id": 48355417, "comment_id": 83699234, "body": "@sepp2k: yeah indeed, since the pattern guard <code>True &lt;- undefined</code> will error, but nevertheless it is better to be explicit over implicit."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1516453591, "post_id": 48355417, "comment_id": 83699479, "body": "Also keep in mind that in Haskell, as in many (FP) languages with algebraic data types, the <code>if</code> conditional is not as important as <code>case of</code> (and other related pattern matching constructs). Often, good Haskell code uses booleans much less frequently. In Haskell we would never have Java&#39;s <code>Scanner.hasNext()</code> and <code>next()</code>, the latter throwing when the first returns false. We would simply have <code>next :: .. -&gt; Maybe Stuff</code> (or some monadic variant), where booleans disappeared in favor of better types."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516456340, "post_id": 48355417, "comment_id": 83700337, "body": "@chi: Although that is more a matter of API design than functional programming or algebraic data types. This particular Java API you mention is widely considered broken even amongst OO and Java programmers. (The same is true for the equivalent <code>TryParse</code> idiom in .NET.)"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1516553058, "post_id": 48355417, "comment_id": 83724964, "body": "For the   &quot;Maybe there are clever ways to defer argument evaluation in SML&quot;   part: the simple way is just to make <code>t</code> and <code>f</code> parameters functions <code>unit -&gt; &#39;a</code>."}, {"owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1516558553, "post_id": 48355417, "comment_id": 83726858, "body": "@AlexeyRomanov I did consider something like that.. specifically, I was thinking there might be an ML equivalent of &quot;autoclosures&quot; in Swift, but I don&#39;t know if they have a clean syntax in ML. But anyway, syntax is a secondary issue, so yeah..."}], "answers": [{"comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1516456447, "post_id": 48355585, "comment_id": 83700367, "body": "Although you can always trivially introduce laziness by wrapping the arguments in lambdas (and you can hide this wrapping in a language with macros). Smalltalk, for example, implements conditionals in a manner which is essentially identical to the Church encoding of Booleans in lambda-calculus."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 3, "last_activity_date": 1516447717, "creation_date": 1516447717, "answer_id": 48355585, "question_id": 48355417, "link": "https://stackoverflow.com/questions/48355417/could-if-then-else-always-be-replaced-by-a-function-call/48355585#48355585", "title": "Could `if-then-else` (always) be replaced by a function call?", "body": "<p>Yes, a lazy language will evaluate an expression only when it needs to. Therefore it is no problem to convert the then/else parts of the expression into function arguments.</p>\n\n<p>This is unlike strict languages like Idris or OCaml, where arguments for a function call are evaluated before the called function is executed.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1516448328, "creation_date": 1516448328, "answer_id": 48355675, "question_id": 48355417, "link": "https://stackoverflow.com/questions/48355417/could-if-then-else-always-be-replaced-by-a-function-call/48355675#48355675", "title": "Could `if-then-else` (always) be replaced by a function call?", "body": "<p>Like the <a href=\"https://wiki.haskell.org/If-then-else\" rel=\"noreferrer\"><em>Haskell Wikipedia on <code>if-then-else</code></em></a> says:</p>\n\n<blockquote>For processing conditions, the `if-then-else` **syntax was defined in Haskell98**. However it could be simply replaced by the function `if'`\nwith\n\n<pre><code>if' :: Bool -&gt; a -&gt; a -&gt; a\nif' True  x _ = x\nif' False _ y = y</code></pre></blockquote>\n\n<p>So if we use the above <code>if'</code> function, and we <em>need to evaluate it</em> (since Haskell is lazy, we do not necessary need to evaluate an <code>if</code>-<code>then</code>-<code>else</code> expression at all), Haskell will first evaluate the first operand to decide if it is <code>True</code> or <code>False</code>. In case it is <code>True</code>, it will return the first expression, if it is <code>False</code> it will return the second expression. Note that this does <em>not</em> per se means that we (fully) evaluate these expressions. Only when we need the result, we will evaluate the expressions.</p>\n\n<p>But in case the condition is <code>True</code>, there is no reason at all to ever evaluate the second expression, since we ignore it.</p>\n\n<p>In case we share an expression over multiple parts of the expression tree, it is of course possible that another call will (partially) evaluate the other expression.</p>\n\n<p><code>ghci</code> even has an option to override the <code>if &lt;expr&gt; then &lt;expr&gt; else &lt;expr&gt;</code> syntax: the <a href=\"https://downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/syntax-extns.html#rebindable-syntax\" rel=\"noreferrer\"><strong><code>-XRebindable</code></strong></a> flag. It will, besides other things also:</p>\n\n<blockquote>\n  <p>Conditionals (e.g. <code>if e1 then e2 else e3</code>) means <code>ifThenElse e1 e2 e3</code>. However case expressions are unaffected.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "edited": false, "score": 0, "creation_date": 1516460290, "post_id": 48357403, "comment_id": 83701745, "body": "I am (passingly) familiar with the lambda calculus encoding of booleans, but I think the issue I&#39;m talking about has to do with normal order vs. applicative order evaluation... unless I&#39;m missing your point."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1516460462, "post_id": 48357403, "comment_id": 83701805, "body": "Also, whether <code>if-then-else</code> <i>could</i> be syntactic sugar is a different question than <i>is</i> it syntactic sugar (as it is in Haskell, for a <code>case</code> expression)."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1516459270, "creation_date": 1516459270, "answer_id": 48357403, "question_id": 48355417, "link": "https://stackoverflow.com/questions/48355417/could-if-then-else-always-be-replaced-by-a-function-call/48357403#48357403", "title": "Could `if-then-else` (always) be replaced by a function call?", "body": "<p>Yes, you can regard <code>if/then/else</code> as syntactic sugar. In fact, a programming language doesn't even need Boolean primitives, so you can also consider <code>True</code> and <code>False</code> as syntactic sugar.</p>\n\n<p>The <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus\" rel=\"nofollow noreferrer\">lambda calculus</a> defines Boolean values as a set of functions that take two arguments:</p>\n\n<pre><code>true = \u03bbt.\u03bbf.t\nfalse = \u03bbt.\u03bbf.f\n</code></pre>\n\n<p>Both functions are functions that takes two values, <code>t</code> for <em>true</em>, and <code>f</code> for <em>false</em>. The function <code>true</code> always returns the <code>t</code> value, whereas the function <code>false</code> always returns the <code>f</code> value.</p>\n\n<p>In Haskell, you can define similar functions like this:</p>\n\n<pre><code>true  = \\t f -&gt; t\nfalse = \\t f -&gt; f\n</code></pre>\n\n<p>You could then write your <code>cond</code> function like:</p>\n\n<pre><code>cond = \\b t f -&gt; b t f\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>Prelude&gt; cond true \"foo\" \"bar\"\n\"foo\"\nPrelude&gt; cond false \"foo\" \"bar\"\n\"bar\"\n</code></pre>\n\n<p>Read more in Travis Whitaker's article <a href=\"http://programmable.computer/posts/church_encoding.html\" rel=\"nofollow noreferrer\">Scrap Your Constructors: Church Encoding Algebraic Types</a>.</p>\n"}], "owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "accepted_answer_id": 48355675, "answer_count": 3, "score": 2, "last_activity_date": 1516461895, "creation_date": 1516446706, "last_edit_date": 1516461895, "question_id": 48355417, "link": "https://stackoverflow.com/questions/48355417/could-if-then-else-always-be-replaced-by-a-function-call", "title": "Could `if-then-else` (always) be replaced by a function call?", "body": "<p>This question is out of curiousity about how PLs work, more than anything else. (It actually came to me while looking at SML which differs from Haskell in that the former uses call-by-value - but my question is about Haskell.)</p>\n\n<p>Haskell (as I understand) has \"call-by-need\" semantics. \nDoes this imply that if I define a function as follows:</p>\n\n<pre><code>cond True thenExp elseExp = thenExp \ncond _ thenExp elseExp = elseExp\n</code></pre>\n\n<p>that this will always behave exactly like an if-then-else expression?\nOr, in another sense, can if-then-else be regarded as syntactic sugar for something that could've been defined as a function?</p>\n\n<hr>\n\n<p><strong>Edit:</strong></p>\n\n<p>Just to contrast the behaviour of Haskell with Standard ML, define (in SML)</p>\n\n<p><code>cond p t f = if p then t else f;</code> </p>\n\n<p>and then the factorial function</p>\n\n<p><code>fun factc n = cond (n=0) 1 (n * factc (n-1));</code></p>\n\n<p>evaluating factc 1 (say) never finishes, because the recursion in the last argument of <code>cond</code> never terminates. </p>\n\n<p>However, defining </p>\n\n<p><code>fun fact n = if n=0 then 1 else fact (n-1);</code></p>\n\n<p>works as we expect because the then branch is only evaluated as needed.</p>\n\n<p>Maybe there are clever ways to defer argument evaluation in SML (don't know as I'm not that familiar with it yet) but the point is that in a call-by-value type language, if-then-else often behaves differently. \nMy question was whether this (call-by-need vs call-by-value) was the principle reason behind this difference (and the consensus seems to be \"yes\"). </p>\n"}, {"tags": ["haskell", "haskell-stack", "reflex", "stackage"], "answers": [{"tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": true, "score": 1, "last_activity_date": 1516461666, "last_edit_date": 1516461666, "creation_date": 1516460895, "answer_id": 48357643, "question_id": 48355206, "link": "https://stackoverflow.com/questions/48355206/broken-dependency-in-haskell-stack/48357643#48357643", "title": "Broken dependency in haskell stack?", "body": "<p>The recomended way to create a development environnement for reflex-dom is to use <a href=\"https://github.com/reflex-frp/reflex-platform\" rel=\"nofollow noreferrer\">try-reflex</a>.</p>\n\n<p>It is tricky to build reflex-dom with stack, because some needed changes have not yet been added to the upstream libraries.</p>\n\n<p>If you really want to build a reflex-dom environnement with stack, please consider these hints: </p>\n\n<ul>\n<li>Do not use a GHC compiler with a version higher than 8.0.2</li>\n<li>Do not use the reflex /reflex-dom versions from Hackage, they are outdated.</li>\n<li>Use versions of reflex / reflex-dom from Github. </li>\n<li><a href=\"https://github.com/hansroland/reflex-dom-inbits\" rel=\"nofollow noreferrer\">This repo</a> contains a stack.yaml file, that used to work.</li>\n<li>You may also try the stack.yaml file from the answer to <a href=\"https://stackoverflow.com/questions/46391975/how-do-i-build-stack-configuration-that-allows-me-to-build-project-with-reflex-f\">this SO question</a>.</li>\n</ul>\n"}], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 48357643, "answer_count": 1, "score": 1, "last_activity_date": 1516469316, "creation_date": 1516445407, "last_edit_date": 1516469316, "question_id": 48355206, "link": "https://stackoverflow.com/questions/48355206/broken-dependency-in-haskell-stack", "title": "Broken dependency in haskell stack?", "body": "<p>I am relatively new to haskell, stack, ghc, etc.</p>\n\n<p>Have been trying a few projects with ghcjs and haven't been able to build any of them, including <a href=\"https://github.com/reinh/reflex-dom-stack-demo\" rel=\"nofollow noreferrer\">reflex-dom-stack-demo</a>. I am getting the following error:</p>\n\n<pre><code>In the dependencies for semigroupoids-5.0.0.4:             \n    tagged-0.8.1 from stack configuration does not match &gt;=0.8.5 &amp;&amp; &lt;1 (latest matching version is 0.8.5)              \nneeded due to ghcjs-0.2.0 -&gt; semigroupoids-5.0.0.4\n</code></pre>\n\n<p>Now I cannot understand whether I misconfigured something or there is truly a broken dependency. Deleted <code>~/.stack</code> multiple times throughout my experiments.</p>\n\n<p>I found <a href=\"https://github.com/fpco/stackage/issues/3185\" rel=\"nofollow noreferrer\">this bug in stackage</a>  but am unsure whether this is what affects me, and whether it would be fixed once the fix moves through.</p>\n\n<p>Using Ubuntu 17.10..</p>\n\n<p>Any insight is welcome.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1516446532, "creation_date": 1516446532, "answer_id": 48355389, "question_id": 48355028, "link": "https://stackoverflow.com/questions/48355028/how-does-haskell-compiler-infer-these-list-of-lists-types/48355389#48355389", "title": "How does Haskell compiler infer these (list of lists) types?", "body": "<p>The problematic part is:</p>\n\n<pre><code>in  packHelper ( (splitOff:acc) (drop (length splitOff) zs) )\n</code></pre>\n\n<p>Note: you have parentheses around both supposed <code>packHelper</code> arguments.\nFix is easy:</p>\n\n<pre><code>in  packHelper (splitOff:acc) (drop (length splitOff) zs)\n</code></pre>\n\n<p>Then <code>packHelper</code> is applied to two arguments and type-checking works out.</p>\n\n<p>The type-error you see is caused by GHC trying to unify</p>\n\n<pre><code>-- infered from last `in`\n-- - [[]] is `[[a1]`` \"some\" list-of-lists\n-- - [a] is the type of xs\n-- - [[a]] is the result type of `pack`\npackHelper :: [[a]] -&gt; ([a] -&gt; [[a]])\n</code></pre>\n\n<p>with</p>\n\n<pre><code>-- because in inner `in` packHelper is applied to one argument only,\n-- but result should be [[a]], the result type of `pack`\n-- first argument can be \"something\" so far.\npackHelper :: b      -&gt; [[a]]\n</code></pre>\n\n<p>So GHC get's missmatch between <code>[a] -&gt; [[a]]</code> and <code>[[a]]</code> which it reports.</p>\n\n<p>In general such errors \"<code>a -&gt; b</code> doesn't match <code>b</code>\" are usually a sign that you forgot to apply an argument.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 48355389, "answer_count": 1, "score": 1, "last_activity_date": 1516446532, "creation_date": 1516444263, "question_id": 48355028, "link": "https://stackoverflow.com/questions/48355028/how-does-haskell-compiler-infer-these-list-of-lists-types", "title": "How does Haskell compiler infer these (list of lists) types?", "body": "<p>I'm trying to create a function that packs equal elements to a list. This is a training problem so I want to make my own sollution to work. I'm not looking for alternative ways to solve the problem, I would just like to understand why this code does not compile.</p>\n\n<p>Here's the function:</p>\n\n<pre><code>pack :: Eq a =&gt; [a] -&gt; [[a]]\npack xs = let packHelper acc [] = acc\n              packHelper acc zs = let splitOff = takeWhile (\\y -&gt; y == (head zs)) zs\n                                  in  packHelper ( (splitOff:acc) (drop (length splitOff) zs) )\n          in  packHelper [[]] xs \n</code></pre>\n\n<p>And the test case:</p>\n\n<pre><code>pack ['a', 'a', 'a', 'a', 'b', 'c', 'c', 'a', 'a', 'd', 'e', 'e', 'e', 'e']\n==\n[\"aaaa\",\"b\",\"cc\",\"aa\",\"d\",\"eeee\"]\n</code></pre>\n\n<p>The current implementation does not compile and gives this error:</p>\n\n<pre><code>main.hs:109:15: error:\n* Couldn't match type `[a1] -&gt; [[a1]]' with `[[a1]]'\n  Expected type: [[a1]] -&gt; [[a1]]\n    Actual type: [[a1]] -&gt; [a1] -&gt; [[a1]]\n* In the expression:\n    let\n      packHelper acc [] = acc\n      packHelper acc zs\n        = let ...\n          in packHelper ((splitOff : acc) (drop (length splitOff) zs))\n    in packHelper [[]] xs\n  In an equation for `pack':\n      pack xs\n        = let\n            packHelper acc [] = acc\n            packHelper acc zs = ...\n          in packHelper [[]] xs\n* Relevant bindings include\n    packHelper :: [[a1]] -&gt; [[a1]]\n      (bound at main.hs:109:15)\n    |\n109 | pack xs = let packHelper acc [] = acc\n    |               ^^^^^^^^^^^^^^^^^^^^^^^^...\n\nmain.hs:111:52: error:\n* Couldn't match expected type `[a1] -&gt; [[a1]]'\n              with actual type `[[a1]]'\n* The function `splitOff : acc' is applied to one argument,\n  but its type `[[a1]]' has none\n  In the first argument of `packHelper', namely\n    `((splitOff : acc) (drop (length splitOff) zs))'\n  In the expression:\n    packHelper ((splitOff : acc) (drop (length splitOff) zs))\n* Relevant bindings include\n    splitOff :: [a1]\n      (bound at main.hs:110:39)\n    zs :: [a1]\n      (bound at main.hs:110:30)\n    acc :: [[a1]]\n      (bound at main.hs:110:26)\n    packHelper :: [[a1]] -&gt; [[a1]]\n      (bound at main.hs:109:15)\n    |\n111 |                                   in  packHelper ( (splitOff:acc) \n(drop (length splitOff) zs) )\n    |                                                    \n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nmain.hs:112:15: error:\n* Couldn't match expected type `[a] -&gt; [[a]]'\n              with actual type `[[a0]]'\n* The function `packHelper' is applied to two arguments,\n  but its type `[[a0]] -&gt; [[a0]]' has only one\n  In the expression: packHelper [[]] xs\n  In the expression:\n    let\n      packHelper acc [] = acc\n      packHelper acc zs\n        = let ...\n          in packHelper ((splitOff : acc) (drop (length splitOff) zs))\n    in packHelper [[]] xs\n* Relevant bindings include\n    xs :: [a]\n      (bound at main.hs:109:6)\n    pack :: [a] -&gt; [[a]]\n      (bound at main.hs:109:1)\n    |\n112 |           in  packHelper [[]] xs \n    |               ^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Why does the compiler expect [[a1]] -> [[a1]] and not [[a1]] -> [a1] -> [[a1]] for packHelper?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1516443054, "post_id": 48354787, "comment_id": 83696247, "body": "it tells me that there is no instance for (Show (Aposta -&gt; IO ()))"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1516444665, "post_id": 48354787, "comment_id": 83696696, "body": "That&#39;s because you are not trying to print a <code>Maybe Int</code> as you wrote in the question, you are trying to print some function, and functions can not be printed. E.g. if you are trying to <code>print joga</code>, that will trigger that arrow. You should post all the relevant code in your question, otherwise it becomes impossible to debug."}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1516445009, "post_id": 48354787, "comment_id": 83696802, "body": "so what are u saying is that im not trying to show the result of (premio ap x) ? im showing premio?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1516446984, "post_id": 48354787, "comment_id": 83697423, "body": "I have no idea: you wrote that <code>premio ap x</code> is of type <code>Maybe Int</code>, but the error shows a different type. Something is wrong, but I can&#39;t see from the posted code, only."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1516442619, "creation_date": 1516442619, "answer_id": 48354787, "question_id": 48354758, "link": "https://stackoverflow.com/questions/48354758/i-o-how-can-i-put-somehing-in-screen-withouth-being-string/48354787#48354787", "title": "I/O how can i put somehing in screen withouth being string?", "body": "<p>Since <code>arroz</code> is <code>premio ap x</code> which has type <code>Maybe Int</code>, you can simply <code>print arroz</code>.</p>\n\n<p><code>print</code> works on any type that can be printed, i.e. on those types in class <code>Show</code>.</p>\n\n<p>(You probably don't want to use <code>print</code> on values that are already strings, though, since that will print the <em>escaped</em> string, with quotes around. Use <code>putStr</code> and <code>putStrLn</code> for strings.)</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516448469, "creation_date": 1516442401, "last_edit_date": 1516448469, "question_id": 48354758, "link": "https://stackoverflow.com/questions/48354758/i-o-how-can-i-put-somehing-in-screen-withouth-being-string", "title": "I/O how can i put somehing in screen withouth being string?", "body": "<p>So im doing this function and i need her to display on the screen the result of (premio ap x) , the problem is that (premio ap x)::Maybe Int , so its not a string.</p>\n\n<pre><code>   joga :: Aposta -&gt; IO ()\n\n    joga x= do\n            ap &lt;- leAposta;\n            let arroz = (premio ap x)\n            putStr  ^^^^^^^^^^\n            return ()\n</code></pre>\n\n<p>How can i convert this to a string? Or there is another way to display on the screen things that are not strings.</p>\n\n<hr>\n\n<p>update :full code</p>\n\n<pre><code>  comuns :: Aposta -&gt; Aposta -&gt; (Int,Int)\n  comuns (Ap a (b,c)) (Ap k (l,\u00e7)) = (cnum a k, cnum [b,c] [l,\u00e7])\n\n\n  cnum::[Int]-&gt;[Int]-&gt;Int\n  cnum [] l2 = 0\n  cnum (x:xs) l2 | elem x l2 = 1 + cnum xs l2\n           |otherwise = cnum xs l2\n\n\n  premio :: Aposta -&gt; Aposta -&gt; Maybe Int\n  premio l1 l2 | x == (5,2)= Just 1\n         | x == (5,1)= Just 2\n         | x == (5,0)= Just 3\n         | x == (4,2)= Just 4\n         | x == (4,1)= Just 5\n         | x == (4,0)= Just 6\n         | x == (3,2)= Just 7\n         | x == (2,2)= Just 8\n         | x == (3,1)= Just 9\n         | x == (3,0)= Just 10\n         | x == (1,2)= Just 11\n         | x == (2,1)= Just 12\n         | x == (2,0)= Just 13\n         |otherwise = Nothing\nwhere \n    x = comuns l1 l2\n\n\n\n   leAposta :: IO Aposta\n   leAposta = do \n        putStrLn \"Insira como lista as 5 estrelas\"\n        num &lt;-getLine\n        putStrLn \"Insira em par as 2 estrelas\"\n        es&lt;-getLine\n        let ap = (Ap (read num) (read es))\n        if (valida ap) \n            then return ap\n        else do \n            putStrLn \"Aposta invalida\"\n            leAposta\n</code></pre>\n"}, {"tags": ["haskell", "f#"], "comments": [{"owner": {"reputation": 9581, "user_id": 1659828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lkOPa.jpg?s=128&g=1", "display_name": "Honza Brestan", "link": "https://stackoverflow.com/users/1659828/honza-brestan"}, "edited": false, "score": 1, "creation_date": 1516442955, "post_id": 48354646, "comment_id": 83696207, "body": "Are you asking whether this is possible in F# in general, or specifically in case where your implementation calls <code>GetBytes()</code>, which presumably returns a collection of bytes? If it&#39;s the former case, I can write an answer with some details, but in case of the latter nothing other than fixing the type parameter to <code>byte</code> would type check, even in Haskell I believe"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 9581, "user_id": 1659828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lkOPa.jpg?s=128&g=1", "display_name": "Honza Brestan", "link": "https://stackoverflow.com/users/1659828/honza-brestan"}, "edited": false, "score": 0, "creation_date": 1516443209, "post_id": 48354646, "comment_id": 83696296, "body": "I will be grateful for the answer for both cases: my learning of F# is in progress, so my question is wide and theoretical"}], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 1, "creation_date": 1516446677, "post_id": 48355294, "comment_id": 83697294, "body": "Your example with <code>&#39;Any</code> in type declaration and then in interface, looks like introducing of type parameter and &quot;propagating&quot; it with <code>ScopedTypeVariables</code> extension in Haskell. Possibility to make more specific implementation (more narrow) in this case looks different from Haskell, but may be I don&#39;t see right analogue."}], "tags": [], "owner": {"reputation": 9581, "user_id": 1659828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lkOPa.jpg?s=128&g=1", "display_name": "Honza Brestan", "link": "https://stackoverflow.com/users/1659828/honza-brestan"}, "is_accepted": false, "score": 4, "last_activity_date": 1516446025, "creation_date": 1516446025, "answer_id": 48355294, "question_id": 48354646, "link": "https://stackoverflow.com/questions/48354646/is-there-such-thing-like-rigid-type-in-f/48355294#48355294", "title": "Is there such thing like &quot;rigid type&quot; in F#?", "body": "<p>In your example, the outer <code>GetEnumerator()</code> implementation calls <code>__.GetBytes()</code>, which I would expect to have a type <code>unit -&gt; IEnumerable&lt;byte&gt;</code> and that fixes the generic type parameter to be a <code>byte</code> as well. If you were able to say your type implements <code>IEnumerable&lt;'Any&gt;</code>, what should be the program behavior if I wanted <code>'Any</code> to be let's say a <code>bool</code>, but it still gave me a collection of bytes? Programs like that don't type check in F#, because the language specification wants the programmer to make all such conversions explicitly to make sure it is meaningful for their program.</p>\n\n<p>If you want to specify an <a href=\"https://stackoverflow.com/questions/2173107/what-exactly-is-an-open-generic-type-in-net\">open generic</a> interface implementation, it's definitely possible (and common). You can have your type implement a generic interface like <code>IEnumerable&lt;'Any&gt;</code>, but the type parameter <code>'Any</code> has to be specified on the type level. So you cannot write this</p>\n\n<pre><code>type MyEnumerable () =\n    interface IEnumerable&lt;'Any&gt; with ...\n</code></pre>\n\n<p>but you can do it if you declare the type parameter on the type itself in addition to the interface:</p>\n\n<pre><code>type MyEnumerable&lt;'Any&gt; () =\n    interface IEnumerable&lt;'Any&gt; with ...\n</code></pre>\n\n<p>This is mainly due to F#'s origin in .NET where interfaces existed before generics and are closely tied to how the runtime works with types, but having the type disconnected from type parameters in its interface implementation would often not make sense anyway as such interface could only have very limited capability, or would do things not related to the type itself, which would most likely be a bad design anyway.</p>\n\n<p>Now if I get back to your example, you can try adding the <code>'Any</code> type parameter to the interface and the type it's implementing it, but the compiler will give you errors due to the reasons in the first paragraph. So you have to decide whether the type itself really is generic, an in that case the <code>GetEnumerator</code> implementation should change, or whether it really only implements an \"enumerable of bytes\", in which case your original code is correct and cannot be more generalized.</p>\n"}, {"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 1, "creation_date": 1516464413, "post_id": 48357731, "comment_id": 83703072, "body": "Exactly: multiparam typeclass! This is the closest analogue."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1516462271, "last_edit_date": 1516462271, "creation_date": 1516461472, "answer_id": 48357731, "question_id": 48354646, "link": "https://stackoverflow.com/questions/48354646/is-there-such-thing-like-rigid-type-in-f/48357731#48357731", "title": "Is there such thing like &quot;rigid type&quot; in F#?", "body": "<p>Your code snippet is analogous to Haskell instance, not Haskell class. This code snippet says that the surrounding type is an instance of <code>IEnumerable&lt;byte&gt;</code> which would be analogous to something like <code>instance IEnumerable T Byte</code> in Haskell (where <code>T</code> is the type in which you implemented <code>IEnumerable</code>). </p>\n\n<p>I guess the key insight here is that <code>IEnumerable</code> must be seen as a <em>multiparam type class</em>, with one parameter denoting the type that is the sequence, and the other parameter denoting the element of the sequence. </p>\n\n<p>In F# the first parameter is <em>implicit</em> - it's not mentioned directly on the interface declaration, but every interface has it - it's the type on which the interface is implemented.</p>\n\n<pre><code>// F#\ntype MyType = MyType with\n    interface IEnumerable&lt;byte&gt; with\n        member this.GetEnumerator() = xyz\n\n\n-- Haskell\nclass IEnumerable t e where\n    getEnumerator :: t -&gt; [e]\n\ndata MyType = MyType\n\ninstance IEnumerable MyType Byte where\n    getEnumerator t = xyz\n</code></pre>\n\n<p>Here, it's easy to see that both <code>t</code> and <code>e</code> would in fact be \"rigid\" types. The multiparam-ness reflects the fact that the same type <code>t</code> may have multiple <code>IEnumerable</code> implementations for different <code>e</code>, same way you can implement multiple concrete <code>IEnumerable&lt;e&gt;</code> on a type in F#.</p>\n\n<p>The one thing that F# <em>cannot</em> do (as such) is provide an implementation for any <code>e</code>, like this:</p>\n\n<pre><code>instance IEnumerable MyType e where\n    getEnumerator t = ...\n</code></pre>\n\n<p>To achieve a similar (though not identical) effect in F#, one would create another interface and implement it:</p>\n\n<pre><code>type AnyEnumerable =\n    abstract member AnyEnumerate&lt;'a&gt;() : IEnumerable&lt;'a&gt;\n\ntype MyType = MyType with\n    interface AnyEnumerable with\n        member this.AnyEnumerate&lt;'a&gt;() = \n            { new IEnumerable&lt;'a&gt; with\n                  member this.GetEnumerator() = ... }\n\nlet x = MyType.AnyEnumerate&lt;int&gt;()\nlet y = MyType.AnyEnumerate&lt;string&gt;()\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 48357731, "answer_count": 2, "score": 2, "last_activity_date": 1516462271, "creation_date": 1516441507, "question_id": 48354646, "link": "https://stackoverflow.com/questions/48354646/is-there-such-thing-like-rigid-type-in-f", "title": "Is there such thing like &quot;rigid type&quot; in F#?", "body": "<p>In Haskell type class can introduce \"interface\" where you have some \"free\" type parameters, something like \"for all a: instances support this set of functions\". And if you instantiate such type-class, you can not narrow this <code>a</code> type, otherwise you get error about rigid type <code>a</code> (like \"for all, but now become more narrow, which breaks original type promise to be for all\"). OK, I implemented <code>IEnumerable</code> interface in my F# type (class):</p>\n\n<pre><code>    interface System.Collections.Generic.IEnumerable&lt;byte&gt; with\n        member __.GetEnumerator () = (__.GetBytes ()).GetEnumerator ()\n</code></pre>\n\n<p>and this is compiling, works as I expected, all is fine. But here I made more narrow interface: <code>IEnumerable&lt;byte&gt;</code> instead of <code>IEnumerable&lt;'Any&gt;</code>. So, what is type parameter in <code>IEnumerable</code>? You can implement more specific, narrow interface, right? It's not like \"forall\" in Haskell, or?</p>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516437913, "post_id": 48354060, "comment_id": 83694865, "body": "Related: <a href=\"https://arxiv.org/pdf/1201.2145.pdf\" rel=\"nofollow noreferrer\">arxiv.org/pdf/1201.2145.pdf</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1516438062, "post_id": 48354060, "comment_id": 83694900, "body": "@liliscent  I need a function that does it for any number, but that is efficient enough to reach that number in a short time interval (25 seconds-50 seconds)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1516438352, "post_id": 48354060, "comment_id": 83694972, "body": "@liliscent   I understand the mathematical concept you want to tell me, but I don&#39;t know how to write it in Haskell, I&#39;m just starting."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1516449683, "post_id": 48354060, "comment_id": 83698287, "body": "@liliscent I need to do a program in Haskell, that for any number n gives you the Pythagorean triples that start with that number, as I said above.  But, my teacher asks me for that large number so that we can do it taking into account the algorithmic complexity and the importance of efficiency in functional programming."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1516453347, "post_id": 48354060, "comment_id": 83699411, "body": "You\u2019ve edited the question to give a much more reasonable problem (145780150 vs 20^100000). Hopefully you can see that this is much more tractable as it is easier to factorise the smaller number. If you are given an even number, divide by two and factorise/find out the numbers divisors, filter by some conditions and then use the formula from @liliscent\u2019s comment to get <code>b</code>, <code>c</code>. The problem is a little more difficult to solve if you are given an odd number but I think it can be done. If you can write down a clear precise mathematical description of a solution, people here can help with Haskell"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1516454436, "post_id": 48354060, "comment_id": 83699731, "body": "To get <code>a = m^2 - n^2</code> consider that <code>m^2 - n^2 = (m - n)(m + n)</code> so you want to factorise a in this case too"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516455990, "post_id": 48354060, "comment_id": 83700219, "body": "@DanRobertson Then,  1. I factor the given number into prime numbers. 2.  And, after factoring how do I get m and n?  I just don&#39;t quite understand the steps I have to take."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1516456224, "post_id": 48354060, "comment_id": 83700294, "body": "@liliscent You can explain in another way the algorithm you mentioned earlier, that I didn&#39;t quite understand it."}, {"owner": {"reputation": 19091, "user_id": 6246044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YMZMd.jpg?s=128&g=1", "display_name": "Rory Daulton", "link": "https://stackoverflow.com/users/6246044/rory-daulton"}, "edited": false, "score": 0, "creation_date": 1516456253, "post_id": 48354060, "comment_id": 83700309, "body": "@liliscent: The problem is more difficult than you show, since you left out the possible common factor of a, b, and c (call it k). The complete formula is a=2kmn, b=k(m^2-n^2), c=k(m^2+n^2). So even a given even number could be b, and if it is a it must be factored into 3 divisors other than 2. You could limit it to m and n relatively prime or to k square-free."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1516482418, "post_id": 48354060, "comment_id": 83708941, "body": "Please don&#39;t add solutions to your question. Instead, move it from your question to a new answer below (<a href=\"https://stackoverflow.com/help/self-answer\">answering your own question is perfectly fine to do on this site</a>). Also, <code>`</code> should only be used to mark inline code or literal commands (and things like that), not the non-code names of languages. So, <code>ghc</code> would be fine, since it&#39;s a terminal command, but <code>GHC</code> or <code>Haskell</code> are not really good, since none of them are used at the terminal or in code."}], "answers": [{"comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516466620, "post_id": 48357081, "comment_id": 83703859, "body": "The hard part is going through all the divisors of <code>a^2</code>. If you get stuck then update your question with what you have"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1516467023, "post_id": 48357081, "comment_id": 83704001, "body": "Could you make the algorithm for <code>pythagoreanTriple 25</code>?  And I take it like example, please."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516467802, "post_id": 48357081, "comment_id": 83704268, "body": "I\u2019ve Updated my answer"}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 1, "last_activity_date": 1516467761, "last_edit_date": 1516467761, "creation_date": 1516457230, "answer_id": 48357081, "question_id": 48354060, "link": "https://stackoverflow.com/questions/48354060/pythagorean-triple-in-haskell/48357081#48357081", "title": "Pythagorean Triple in Haskell", "body": "<p>Here\u2019s what to do as an algorithm. Try converting to Haskell and if you get stuck, edit your question to show where you got.</p>\n\n<ol>\n<li>Input <code>a</code></li>\n<li>Factorise <code>a</code> into primes</li>\n<li>Thereby give a factorisation of <code>a^2</code></li>\n<li>Because <code>a^2+b^2=c^2</code>, we have <code>a^2=(c-b)(c+b)</code></li>\n<li>For each factorisation of <code>a^2</code> as <code>a^2=xy</code> with <code>x&lt;y</code> but not necessarily primes or <code>x&gt;1</code>:\n\n<ol>\n<li>Get <code>c = (x+y)/2</code></li>\n<li>Get <code>b = (y-x)/2</code></li>\n<li>Output <code>(a,b,c)</code></li>\n</ol></li>\n</ol>\n\n<p>Ok here is an example for 50:</p>\n\n<ol>\n<li>Input <code>a=50</code></li>\n<li><code>50=2*5^2</code></li>\n<li><code>50^2=2^2*5^4</code></li>\n<li>Not really a step</li>\n<li>Factorisations <code>(x,y)</code> are: <code>(1,2500), (2,1250), (4,625), (5,500), (10,250), (20,125), (25,100)</code> Other factorisations have <code>x&gt;=y</code> (equivalent to <code>x&gt;=a</code>)</li>\n<li>Corresponding output (where integer solutions exist): <code>none, (50,624,626), none, none, (50,120,130), none, none</code>.</li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 48357081, "answer_count": 1, "score": 1, "last_activity_date": 1516477469, "creation_date": 1516436872, "last_edit_date": 1516477469, "question_id": 48354060, "link": "https://stackoverflow.com/questions/48354060/pythagorean-triple-in-haskell", "title": "Pythagorean Triple in Haskell", "body": "<p>I need to run a <code>Haskell</code>program in which I enter a number, and tell me the pythagorean triangles (a, b, c) so that 'a' is the number entered. This is it;</p>\n\n<pre><code>pythagoreanTriple :: Integer -&gt; [(Integer, Integer, Integer)]\n\npythagoreanTriple 25 == [(25,60,65),(25,312,313)]\n\npythagoreanTriple 20 == [(20,15,25),(20,21,29),(20,48,52),(20,99,101)]\n</code></pre>\n\n<p>I've tried it this way, but it's very inefficient, because for low numbers it works, but when they ask for a high number it doesn't work.</p>\n\n<pre><code> pythagoreanTriple :: Integer -&gt; [(Integer, Integer, Integer)]\n\n pythagoreanTriple n = [(n,b,c) | c &lt;- [2..n^2], b &lt;- [2..c-1], n^2 + b^2 == c^2]\n</code></pre>\n\n<p>I need the function to work for <code>pythagoreanTriple 14578950150</code>, but I can't get it.</p>\n\n<p>In case you don't know what a Pythagorean Triple is: <a href=\"https://en.wikipedia.org/wiki/Pythagorean_triple\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Pythagorean_triple</a></p>\n\n<p><strong>I've done the algorithm you told me, but it doesn't give the same results as the example, and it takes a long time.</strong></p>\n\n<p><strong>SOLUTION</strong></p>\n\n<pre><code>pythagoreanTriple :: Integer -&gt; [(Integer, Integer, Integer)]\npythagoreanTriple a = [(a,b,c) | c &lt;- [a+1..(a^2+1) `div` 2]\n                               , let b = (round . sqrt . fromIntegral) (c^2 - a^2)\n                               , a^2 + b^2 == c^2]\n</code></pre>\n"}, {"tags": ["haskell", "fixed-point-iteration"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516432762, "post_id": 48353457, "comment_id": 83693809, "body": "<code>convergeM</code> cannot be written, but it is not needed. Write a function that combines the effects of <code>converge</code> and <code>last</code> <i>efficiently</i> (i.e. without traversing the list twice), and you should be able to loft it."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516433670, "post_id": 48353457, "comment_id": 83693977, "body": "@n.m. Why can&#39;t it?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516434665, "post_id": 48353457, "comment_id": 83694196, "body": "Because it wants to return <code>[m a]</code> but it only allowed to return things that look like <code>m something</code>. <code>m [a]</code> is OK but then <code>last</code> won&#39;t work and you need <code>lastM</code>. Not that it&#39;s hard to do, but it&#39;s wasteful."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516435857, "post_id": 48353457, "comment_id": 83694460, "body": "@n.m. Wasteful in a sense of lines of code exerted on <code>lastM</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516436561, "post_id": 48353457, "comment_id": 83694598, "body": "Wasteful in a sense of building a list and then traversing it to find its last element. Why would you do that?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1516437498, "post_id": 48353457, "comment_id": 83694785, "body": "@n.m. I have sketched a solution according to what you are saying and I will update the question with it shortly, but I believe it will be to the benefit of everyone observing if you yourself compose an answer -- a form both more spacious and more endurant. There are quite a few presuppositions worth unraveling here."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516448780, "post_id": 48353457, "comment_id": 83697995, "body": "@Kindaro: I still do not see why you need the <i>last</i> element, why not build and access the list in reverse"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1516480665, "post_id": 48353457, "comment_id": 83708404, "body": "@Kindaro I believe it&#39;s impossible to write <code>fixpM</code> without getting the side effects of the intermediate approximations. Think about it; it doesn&#39;t make sense that you can get the approximation out of a computation and check whether it&#39;s close to the previous one without actually doing the computation! If you mean, e.g. <code>State s</code> altering the <code>s</code> as the approximations are calculated, well, <i>too bad</i>. You can alter the argument to <code>fixpM</code> to restore the state as well as possible, but a) <code>fixpM</code> can&#39;t do that itself and b) good luck doing that to <code>IO</code> or the like."}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1572205871, "creation_date": 1516430898, "last_edit_date": 1572205871, "question_id": 48353457, "link": "https://stackoverflow.com/questions/48353457/there-is-a-function-that-searches-for-an-attractive-fixed-point-through-iteratio", "title": "There is a function that searches for an attractive fixed point through iteration. Can we generalize it to monadic functions?", "body": "<h3>Intro</h3>\n\n<p><em><a href=\"https://en.wikipedia.org/wiki/Fixed_point_(mathematics)\" rel=\"nofollow noreferrer\">Fixed points</a></em> are such arguments to a function that it would return unchanged: <code>f x == x</code>. An example would be <code>(\\x -&gt; x^2) 1 == 1</code> -- here the fixed point is 1.</p>\n\n<p><em>Attractive fixed points</em> are those fixed points that can be found by iteration from some starting point. For example, <code>(\\x -&gt; x^2) 0.5</code> would converge to 0, thus 0 is an attractive fixed point of this function.</p>\n\n<p>Attractive fixed points can be, with luck, approached (and, in some cases, even reached in that many steps) from a suitable non-fixed point by iterating the function from that point. Other times, the iteration will diverge, so there should first be a proof in place that a fixed point will attract the iterating process. For some functions, the proof is common knowledge.</p>\n\n<h3>The code</h3>\n\n<p>I have tidied up some <a href=\"https://stackoverflow.com/a/7443379/2108477\">prior art</a> that accomplishes the task neatly. I then set out to extend the same idea to monadic functions, but to no luck. This is the code I have by now:</p>\n\n<pre><code>module Fix where\n\n-- | Take elements from a list until met two equal adjacent elements. Of those,\n--   take only the first one, then be done with it.\n--\n--   This function is intended to operate on infinite lists, but it will still\n--   work on finite ones.\nconverge :: Eq a =&gt; [a] -&gt; [a]\nconverge = convergeBy (==)\n\n-- \\ r a = \\x -&gt; (x + a / x) / 2\n-- \\ -- ^ A method of computing square roots due to Isaac Newton.\n-- \\ take 8 $ iterate (r 2) 1\n-- [1.0,1.5,1.4166666666666665,1.4142156862745097,1.4142135623746899,\n-- 1.414213562373095,1.414213562373095,1.414213562373095]\n-- \\ converge $ iterate (r 2) 1\n-- [1.0,1.5,1.4166666666666665,1.4142156862745097,1.4142135623746899,1.414213562373095]\n\n-- | Find a fixed point of a function. May present a non-terminating function\n--   if applied carelessly!\nfixp :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nfixp f = last . converge . iterate f\n\n-- \\ fixp (r 2) 1\n-- 1.414213562373095\n\n-- | Non-overloaded counterpart to `converge`.\nconvergeBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\nconvergeBy _ [ ] = [ ]\nconvergeBy _ [x] = [x]\nconvergeBy eq (x: xs@(y: _))\n    | x `eq` y = [x]\n    | otherwise = x : convergeBy eq xs\n\n-- \\ convergeBy (\\x y -&gt; abs (x - y) &lt; 0.001) $ iterate (r 2) 1\n-- [1.0,1.5,1.4166666666666665,1.4142156862745097]\n\n-- | Non-overloaded counterpart to `fixp`.\nfixpBy :: (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a\nfixpBy eq f = last . convergeBy eq . iterate f\n\n-- \\ fixpBy (\\x y -&gt; abs (x - y) &lt; 0.001) (r 2) 1\n-- 1.4142156862745097\n\n-- | Find a fixed point of a monadic function. May present a non-terminating\n--   function if applied carelessly!\n--   TODO\nfixpM :: (Eq a, Monad m) =&gt; (m a -&gt; m a) -&gt; m a -&gt; m a\nfixpM f = last . _ . iterate f\n</code></pre>\n\n<p><em>(It may be loaded in <code>repl</code>. There are examples to be run in the comments, for illustration.)</em></p>\n\n<h3>The problem</h3>\n\n<p>There is an <code>_</code> in the definition of <code>fixpM</code> above. It is a function of type <code>[m a] -&gt; [m a]</code> that should do, in principle, the same as the function <code>converge</code> above, but <em>kinda lifted</em>. I have come to suspect it can't be written.</p>\n\n<p>I do have composed another, specialized code for <code>fixpM</code>:</p>\n\n<pre><code>fixpM :: (Eq a, Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m a\nfixpM f x = do\n    y &lt;- f x\n    if x == y\n        then return x\n        else fixpM f y\n\n-- \\ fixpM (\\x -&gt; (\".\", x^2)) 0.5\n-- (\"............\",0.0)\n</code></pre>\n\n<p><em>(An example run is, again, found in a comment.)</em></p>\n\n<p>-- But it is a whole different algorithm, not an extension / generalization of the pure function we started with. In particular, we do not pass the stage where a list of <code>inits</code> up to the first repetition is made available.</p>\n\n<p><strong>Can we not extend the pure algorithm to work on monadic functions?</strong></p>\n\n<p><strong>And why so?</strong></p>\n\n<p>I would admire a hint towards a piece of theory that explains how to either prove impossibility or construct a solution in a routine fashion, but perhaps this is just a triviality I'm missing while busy typing idle questions, in which case a straightforward counterexample would defeat me.</p>\n\n<p><strong>P.S.</strong> I understand this is a somewhat trivial exercise. Still, I want to have become done with it once and forever.</p>\n\n<p><strong>P.S. 2</strong> A better approximation to the pure variant, as suggested by @n-m (retaining <code>iterate</code>), would look like this:</p>\n\n<pre><code>fixpM :: (Eq a, Monad m) =&gt; (m a -&gt; m a) -&gt; m a -&gt; m a\nfixpM f = collapse . iterate f\n  where\n    collapse (mx: mxs @(my: _)) = do\n        x &lt;- mx\n        y &lt;- my\n        if x == y\n            then return x\n            else collapse mxs\n</code></pre>\n\n<p>Through the use of <code>iterate</code>, its behaviour with regard to the monad is different in that the effects are retained between consecutive approximations. Performance-wise, these functions are of the same complexity.</p>\n\n<p><strong>P.S. 3</strong> A more complete rendition of the ideas offered by @n-m encodes the algorithm, as far as I can see, one to one with the pure variant:</p>\n\n<pre><code>fixpM :: (Eq a, Monad m) =&gt; (m a -&gt; m a) -&gt; m a -&gt; m a\nfixpM f = lastM . convergeM . iterate (f &gt;&gt;= \\x -&gt; return x )\n\nconvergeM :: (Monad m, Eq a) =&gt; [m a] -&gt; m [a]\nconvergeM = convergeByM (==)\n\nconvergeByM :: (Monad m, Eq a) =&gt; (a -&gt; a -&gt; Bool) -&gt; [m a] -&gt; m [a]\nconvergeByM _ [ ] = return [ ]\nconvergeByM _ [mx] = mx &gt;&gt;= \\x -&gt; return [x]\nconvergeByM eq xs = do\n    case xs of\n        [ ] -&gt; return [ ]\n        [mx] -&gt; mx &gt;&gt;= \\x -&gt; return [x]\n        (mx: mxs @(my: _)) -&gt; do\n            x &lt;- mx\n            y &lt;- my\n            if x `eq` y\n                then return [x]\n                else do\n                    xs &lt;- convergeM mxs\n                    return (x:xs)\n\nlastM :: Monad m =&gt; m [a] -&gt; m a\nlastM mxs = mxs &gt;&gt;= \\xs -&gt; case xs of\n    [] -&gt; error \"Fix.lastM: No last element!\"\n    xs -&gt; return . head . reverse $ xs\n</code></pre>\n\n<p>Unfortunately, it happens to be rather lengthy. More substantially, both these solutions have the same somewhat undesirable behaviour with regard to the effects of the monad: all the effects are retained between consecutive approximations.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1516424016, "post_id": 48352605, "comment_id": 83692153, "body": "Haskell is a very type-oriented language.  The answers to your questions almost entirely come from the types involved.  Could you please include the type of  <code>zmult</code>, and the definition of the type <code>Z</code> and everything it depends on?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1516424476, "post_id": 48352605, "comment_id": 83692235, "body": "Also, for what it&#39;s worth, that staircase pattern almost always means the function should be rewritten with some sort of helper.  This looks like it should be rewritten with a helper function like <code>combine :: Sumbool -&gt; Sumbool -&gt; Sumbool ; combine RRight _ = RRight ; combine _ x = x</code> and <code>foldr1 combine</code>."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 4, "creation_date": 1516425287, "post_id": 48352605, "comment_id": 83692391, "body": "If you&#39;re trying to understand this person&#39;s code because you have to, that&#39;s fine. But if you&#39;re trying to understand it for educational purposes, delete this code, empty your recycle bin, and then go find better code to decipher."}, {"owner": {"reputation": 57, "user_id": 9243053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUyZn.png?s=128&g=1", "display_name": "Ryan O&#39;Connor", "link": "https://stackoverflow.com/users/9243053/ryan-oconnor"}, "edited": false, "score": 0, "creation_date": 1516466598, "post_id": 48352605, "comment_id": 83703850, "body": "Hi Carl, please check out the following link for the entire code. Hopefully this makes it easier for you to provide advice. By the way, this code was exported from Coq. Thanks!!!  <a href=\"https://github.com/coq-contribs/qarith-stern-brocot/blob/master/quadratic.hs\" rel=\"nofollow noreferrer\">github.com/coq-contribs/qarith-stern-brocot/blob/master/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 9243053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUyZn.png?s=128&g=1", "display_name": "Ryan O&#39;Connor", "link": "https://stackoverflow.com/users/9243053/ryan-oconnor"}, "edited": false, "score": 0, "creation_date": 1517080754, "post_id": 48444744, "comment_id": 83952137, "body": "Hi SnowOnion, thanks for taking a look at the code and providing a response! I&#39;m still not clear on how I can print the output of same_ratio_dec_inf. I see it is expecting 8 arguments, which I think I can specify by entering 8 integers and using the toZ function to convert them to the expected input format. But I&#39;m not sure what I need to do print the output. If you&#39;ve got any ideas, that would be great. Thanks again!"}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "reply_to_user": {"reputation": 57, "user_id": 9243053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUyZn.png?s=128&g=1", "display_name": "Ryan O&#39;Connor", "link": "https://stackoverflow.com/users/9243053/ryan-oconnor"}, "edited": false, "score": 0, "creation_date": 1517112778, "post_id": 48444744, "comment_id": 83959104, "body": "@RyanO&#39;Connor At line 46, change <code>data Sumbool = LLeft | RRight</code> to <code>data Sumbool = LLeft | RRight deriving Show</code>. It makes type <code>Sumbool</code> an instance of typeclass <code>Show</code> and automatically generates a default implementation of <code>show :: Sumbool -&gt; String</code>, hence values of type <code>Sumbool</code> become printable."}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "reply_to_user": {"reputation": 57, "user_id": 9243053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUyZn.png?s=128&g=1", "display_name": "Ryan O&#39;Connor", "link": "https://stackoverflow.com/users/9243053/ryan-oconnor"}, "edited": false, "score": 0, "creation_date": 1517299118, "post_id": 48444744, "comment_id": 84027302, "body": "@RyanO&#39;Connor haha I can <a href=\"https://stackoverflow.com/help/privileges/comment\">comment everywhere</a> finally :)"}], "tags": [], "owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "is_accepted": true, "score": 0, "last_activity_date": 1516888973, "creation_date": 1516888973, "answer_id": 48444744, "question_id": 48352605, "link": "https://stackoverflow.com/questions/48352605/how-to-display-the-value-of-a-function-in-haskell/48444744#48444744", "title": "How to display the value of a function in Haskell?", "body": "<p>I'm not clear what you are confused about, but I tried something. Maybe it helps.</p>\n\n<p>In your link (<a href=\"https://github.com/coq-contribs/qarith-stern-brocot/blob/master/quadratic.hs\" rel=\"nofollow noreferrer\">https://github.com/coq-contribs/qarith-stern-brocot/blob/master/quadratic.hs</a>) there's some usages of <code>qquadratic_</code>:</p>\n\n<pre><code>lazy_plus_ x y = qquadratic_  0 1 1 0 0 0 0 1 x y\nlazy_mult_ x y = qquadratic_  1 0 0 0 0 0 0 1 x y\n...\n</code></pre>\n\n<p>I wondered the expected type of <code>x</code> <code>y</code>, so I:</p>\n\n<pre><code>*Quadratic&gt; :t qquadratic_\nqquadratic_\n:: (Integral a, Integral a1, Integral a2, Integral a3, Integral a4,\n    Integral a5, Integral a6, Integral a7) =&gt;\n    a\n    -&gt; a1\n    -&gt; a2\n    -&gt; a3\n    -&gt; a4\n    -&gt; a5\n    -&gt; a6\n    -&gt; a7\n    -&gt; [Char]\n    -&gt; [Char]\n    -&gt; [Char]\n</code></pre>\n\n<p>We get: 1. <code>x</code> and <code>y</code> are strings (of some desired format) 2. <code>qquadratic_</code> will return string eventually (so is <code>lazy_plus_</code>, <code>lazy_mult_</code>, ...), making it easy to see the output.</p>\n\n<p>Then I tried to construct some <code>x</code> and <code>y</code>. They are fed to <code>toQ</code>, and according to the definition of <code>toQ</code>,</p>\n\n<pre><code>toQPos \"I\"= One\ntoQPos \"\" = One\ntoQPos ('L':xs) = (DL (toQPos xs))\ntoQPos ('R':xs) = (NR (toQPos xs))\n\ntoQ \"0\"= Zero\ntoQ ('-':xs) = (Qneg (toQPos xs))\ntoQ ('+':xs) = (Qpos (toQPos xs))\ntoQ (x:xs) = (Qpos (toQPos (x:xs)))\n</code></pre>\n\n<p>I guessed some inputs:</p>\n\n<pre><code>*Quadratic&gt; lazy_plus_ \"0\" \"0\"\n\"0\"\n*Quadratic&gt; lazy_plus_ \"+R\" \"+I\"\n\"RR\"\n</code></pre>\n\n<p>If you know what the original Coq program does, you may come up with some meaningful inputs.</p>\n"}], "owner": {"reputation": 57, "user_id": 9243053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUyZn.png?s=128&g=1", "display_name": "Ryan O&#39;Connor", "link": "https://stackoverflow.com/users/9243053/ryan-oconnor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 48444744, "answer_count": 1, "score": 0, "last_activity_date": 1516888973, "creation_date": 1516422662, "last_edit_date": 1516466806, "question_id": 48352605, "link": "https://stackoverflow.com/questions/48352605/how-to-display-the-value-of-a-function-in-haskell", "title": "How to display the value of a function in Haskell?", "body": "<p>I'm new to Haskell and am finding it difficult to make sense of it. I'm trying to understand someone else's code by testing out a function but cannot figure out how to do this. The function is below:</p>\n\n<pre><code>same_ratio_dec_inf a b c d e f g h =\ncase z_eq_dec (zmult a f) (zmult b e) of\nLLeft -&gt;\n  (case z_eq_dec (zmult b g) (zmult c f) of\n     LLeft -&gt;\n       (case z_eq_dec (zmult c h) (zmult d g) of\n          LLeft -&gt;\n            (case z_eq_dec (zmult a g) (zmult c e) of\n               LLeft -&gt;\n                 (case z_eq_dec (zmult a h) (zmult d e) of\n                    LLeft -&gt; z_eq_dec (zmult b h) (zmult d f)\n                    RRight -&gt; RRight)\n               RRight -&gt; RRight)\n          RRight -&gt; RRight)\n     RRight -&gt; RRight)\nRRight -&gt; RRight\n</code></pre>\n\n<p>If I \":t same_ratio_dec_inf\" I get:</p>\n\n<pre><code>same_ratio_dec_inf :: Z -&gt; Z -&gt; Z -&gt; Z -&gt; Z -&gt; Z -&gt; Z -&gt; Z -&gt; Sumbool\n</code></pre>\n\n<p>Sumbool is defined earlier as follows:</p>\n\n<p>data Sumbool = LLeft\n               | RRight</p>\n\n<p>I see some other code where Z inputs are given as follows:</p>\n\n<pre><code>showQ  (qquadratic (toZ a) (toZ b) (toZ c) (toZ d) (toZ e) (toZ f) (toZ g) (toZ h) (toQ x) (toQ y))\n</code></pre>\n\n<p>So I think I can give the function the right inputs...it's just unclear to me how to generate and show the output.\nAny help would be appreciated.\nThanks!!</p>\n\n<p>edit: the entire code can be found here: <a href=\"https://github.com/coq-contribs/qarith-stern-brocot/blob/master/quadratic.hs\" rel=\"nofollow noreferrer\">https://github.com/coq-contribs/qarith-stern-brocot/blob/master/quadratic.hs</a></p>\n"}, {"tags": ["haskell", "primes"], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1516412776, "post_id": 48351740, "comment_id": 83690369, "body": "Be careful about rounding error using floating-point numbers here. <a href=\"https://wiki.haskell.org/Generic_number_type#squareRoot\" rel=\"nofollow noreferrer\">wiki.haskell.org/Generic_number_type#squareRoot</a>"}], "tags": [], "owner": {"reputation": 6346, "user_id": 2587908, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LhXQO.jpg?s=128&g=1", "display_name": "sfjac", "link": "https://stackoverflow.com/users/2587908/sfjac"}, "is_accepted": true, "score": 3, "last_activity_date": 1516411671, "creation_date": 1516411671, "answer_id": 48351740, "question_id": 48351697, "link": "https://stackoverflow.com/questions/48351697/whats-wrong-with-this-prime-testing-function/48351740#48351740", "title": "What&#39;s wrong with this Prime-testing function?", "body": "<p><code>sqrt</code> requires a float - try</p>\n\n<pre><code>isPrime n = divTest n (floor (sqrt (fromIntegral  n)))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6346, "user_id": 2587908, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LhXQO.jpg?s=128&g=1", "display_name": "sfjac", "link": "https://stackoverflow.com/users/2587908/sfjac"}, "edited": false, "score": 2, "creation_date": 1516418326, "post_id": 48351850, "comment_id": 83691274, "body": "For large numbers, this is quite a bit more expensive, but it will of course work."}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 6346, "user_id": 2587908, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LhXQO.jpg?s=128&g=1", "display_name": "sfjac", "link": "https://stackoverflow.com/users/2587908/sfjac"}, "edited": false, "score": 1, "creation_date": 1516439046, "post_id": 48351850, "comment_id": 83695127, "body": "Yeah good point. I just wanted to suggest a straightforward method for the OP."}], "tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 3, "last_activity_date": 1516425225, "last_edit_date": 1516425225, "creation_date": 1516412852, "answer_id": 48351850, "question_id": 48351697, "link": "https://stackoverflow.com/questions/48351697/whats-wrong-with-this-prime-testing-function/48351850#48351850", "title": "What&#39;s wrong with this Prime-testing function?", "body": "<p>Since <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:sqrt\" rel=\"nofollow noreferrer\"><code>sqrt</code></a> is of type: <code>Floating a =&gt; a -&gt; a</code>, you need to pass a floating point number instead of an integer. You can do this by applying <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral</code></a> to <code>n</code>, as shown in the other answer. </p>\n\n<p>Another way you could do this problem is by breaking it up into two functions.</p>\n\n<p>The first function could find all factors up to <code>n</code>:</p>\n\n<pre><code>factors :: Integer -&gt; [Integer]\nfactors n = filter divides_n [1..n]\n    where divides_n m = n `mod` m == 0\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; factors 15\n[1,3,5,15]\n</code></pre>\n\n<p>Then we could use this to check if a number is prime or not, if <code>factors</code> only contains <code>1</code> and <code>n</code>:</p>\n\n<pre><code>isPrime :: Integer -&gt; Bool\nisPrime n = factors n == [1,n]\n</code></pre>\n\n<p>Which works as expected:</p>\n\n<pre><code>*Main&gt; isPrime 2\nTrue\n*Main&gt; isPrime 3\nTrue\n*Main&gt; isPrime 4\nFalse\n*Main&gt; isPrime 5\nTrue\n*Main&gt; isPrime 15\nFalse\n</code></pre>\n\n<p>The benefit of this approach is that you don't have to do anything tricky to test if a number is prime or not.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1516423160, "last_edit_date": 1516423160, "creation_date": 1516422610, "answer_id": 48352595, "question_id": 48351697, "link": "https://stackoverflow.com/questions/48351697/whats-wrong-with-this-prime-testing-function/48352595#48352595", "title": "What&#39;s wrong with this Prime-testing function?", "body": "<p>An alternative to computing the square root is to compute the quotient <em>and</em> the remainder, and stop when the quotient is less than the divisor.</p>\n\n<pre><code>-- Work our way up from 3, testing odd divisors only.\ndivTest :: Int -&gt; Int -&gt; Bool\ndivTest n test | r == 0 = False\n               | q &lt; test = True -- test &gt; sqrt n, and we've tested all the smaller divisors\n               | otherwise = divTest n (test + 2)\n\nisPrime :: Int -&gt; Bool\nisPrime 1 = False\nisPrime 2 = True\nisPrime n = n `mod` 2 /= 0 &amp;&amp; divTest n 3\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 2579798, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZkaF7.png?s=128&g=1", "display_name": "mocha2007", "link": "https://stackoverflow.com/users/2579798/mocha2007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 48351740, "answer_count": 3, "score": 2, "last_activity_date": 1516425225, "creation_date": 1516411180, "question_id": 48351697, "link": "https://stackoverflow.com/questions/48351697/whats-wrong-with-this-prime-testing-function", "title": "What&#39;s wrong with this Prime-testing function?", "body": "<p>I've looked just about everywhere and I can't find why the following code does not work:</p>\n\n<pre><code>isPrime :: Int -&gt; Bool\nisPrime 1 = False\nisPrime n = divTest n (floor (sqrt n))\n    where\n    divTest :: Int -&gt; Int -&gt; Bool\n    divTest n test\n        | test == 1         = True\n        | mod n test == 0   = False\n        | otherwise         = divTest n (test-1)\n</code></pre>\n\n<p>I get two errors, which are really long, so I'll put what I think are the important bits:</p>\n\n<pre><code>No instance for (RealFrac Int) arising from a use of \u2018floor\u2019\n</code></pre>\n\n<p>and</p>\n\n<pre><code>No instance for (Floating Int) arising from a use of \u2018sqrt\u2019\n</code></pre>\n\n<p>And yes, I know this probably isn't anywhere near efficient. I'm learning. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516421519, "post_id": 48351669, "comment_id": 83691774, "body": "That&#39;s exactly what I&#39;m looking for, thanks! Corollary: does the usual <code>@</code> syntax work for view patterns (e.g. if I need the map reference inside the function?) <code>f k map@((!? k) -&gt; Just _) = foo map</code> ?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1516478964, "post_id": 48351669, "comment_id": 83707893, "body": "Yeah I think so, but give it a try yourself"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 1, "last_activity_date": 1516410930, "creation_date": 1516410930, "answer_id": 48351669, "question_id": 48351597, "link": "https://stackoverflow.com/questions/48351597/pattern-matching-on-function-application-in-a-pattern-match/48351669#48351669", "title": "Pattern matching on function application in a pattern match?", "body": "<p>Your first example <em>does</em> use pattern matching, but just in a <code>case</code> expression. But I think what you're looking for is the <code>ViewPatterns</code> extension, which can be useful for eliminating boilerplate (in particular in a <code>case</code> expression, where you can use both pattern matching and guards together).</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nf k ((!? k)-&gt; Just _) = foo\nf _ _ = bar\n</code></pre>\n\n<p>Notice though that you need to switch the order of the arguments in order for <code>k</code> to be in scope in the view pattern for the seconds argument.</p>\n\n<p>But I don't think this is better than your first version of <code>f</code>.</p>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 48351669, "answer_count": 1, "score": 1, "last_activity_date": 1516410930, "creation_date": 1516410156, "question_id": 48351597, "link": "https://stackoverflow.com/questions/48351597/pattern-matching-on-function-application-in-a-pattern-match", "title": "Pattern matching on function application in a pattern match?", "body": "<p>I'd like to pattern match against a value returned from function application. For instance:</p>\n\n<p>If I have a <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\"><code>Map</code></a> and I'd like to alternate on a key being in that map, do I have a better option than:</p>\n\n<pre><code>f map k = case map !? k of\n            Just _  -&gt; foo\n            Nothing -&gt; bar\n</code></pre>\n\n<p>In this particular case I could just as easily use <code>member</code> and guard, like:</p>\n\n<pre><code>f map k | member k map = foo\n        | otherwise    = bar\n</code></pre>\n\n<p>but would prefer to use pattern matching in some cases.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 65, "user_id": 6716023, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a2685b90720ec180cd5e2a21d66d7f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Domba", "link": "https://stackoverflow.com/users/6716023/domba"}, "edited": false, "score": 0, "creation_date": 1516410587, "post_id": 48351545, "comment_id": 83689978, "body": "I&#39;ve also tried     <code>printCategories&#39; c = [((name c) ++)] &lt;*&gt; (concatMap (\\c -&gt;      printCategories&#39; c) $ sub c)</code> for a single category but it gives the same result"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1516410693, "post_id": 48351545, "comment_id": 83689992, "body": "Hint: you presumably want <code>printCategories [Category &quot;a&quot; []]</code> to produce <code>[&quot;a&quot;]</code>, but your function <i>always</i> produces a <code>&quot;&gt;&quot;</code> as a substring of any results. You are missing a base case. Proposal: write <code>printCategory :: Category -&gt; [String]</code> instead; the base case will be much more clear."}, {"owner": {"reputation": 65, "user_id": 6716023, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a2685b90720ec180cd5e2a21d66d7f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Domba", "link": "https://stackoverflow.com/users/6716023/domba"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516413024, "post_id": 48351545, "comment_id": 83690417, "body": "Thanks man, just adding the base case for my single category function solved the problem! :)"}], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 6716023, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a2685b90720ec180cd5e2a21d66d7f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Domba", "link": "https://stackoverflow.com/users/6716023/domba"}, "is_accepted": true, "score": 0, "last_activity_date": 1516413375, "creation_date": 1516413375, "answer_id": 48351890, "question_id": 48351545, "link": "https://stackoverflow.com/questions/48351545/why-dont-nested-maps-in-haskell-behave-like-i-would-expect/48351890#48351890", "title": "Why don&#39;t nested maps in Haskell behave like I would expect?", "body": "<p>As Daniel Wagner hinted in comments, all I was missing in my <code>printCategories'</code> function which works on single category was the base case <code>printCategory (Category a []) = [a]</code> and the solution for the problem was to then <code>concatMap</code> the single category function over the list of categories.</p>\n"}], "owner": {"reputation": 65, "user_id": 6716023, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a2685b90720ec180cd5e2a21d66d7f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Domba", "link": "https://stackoverflow.com/users/6716023/domba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 48351890, "answer_count": 1, "score": 0, "last_activity_date": 1516413375, "creation_date": 1516409557, "question_id": 48351545, "link": "https://stackoverflow.com/questions/48351545/why-dont-nested-maps-in-haskell-behave-like-i-would-expect", "title": "Why don&#39;t nested maps in Haskell behave like I would expect?", "body": "<p>I want to be able to present hierarchy of recursive custom data type Category as a list of strings where each string presents a path to the specific category. The category type looks like this :</p>\n\n<pre><code>data Category = Category\n { name :: String\n , sub  :: [Category] }\n</code></pre>\n\n<p>For example, category hierarchy <code>Category \"A\" [Category \"B\" [Category \"C\" []], Category \"D\" []]</code>\nin its string representation would look like <code>[\"A &gt; B &gt; C\", \"A &gt; B &gt; D\"]</code> where <code>\" &gt; \"</code> is the delimiter. What I've tried is: </p>\n\n<pre><code>printCategories :: [Category] -&gt; [String]\nprintCategories xs = concatMap (\\c -&gt; ((name c)++) &lt;$&gt; (\" &gt; \" ++) &lt;$&gt; (printCategories $ sub c)) xs\n</code></pre>\n\n<p>The problem is that it always returns empty list <code>[]</code> and also it compiles perfectly fine so there are no errors which could lead me to solution.</p>\n"}, {"tags": ["json", "haskell", "browser", "yesod"], "comments": [{"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 1, "creation_date": 1519415446, "post_id": 48351199, "comment_id": 84917199, "body": "For people reading this, this is discussed on <a href=\"https://github.com/yesodweb/yesod/issues/1479\" rel=\"nofollow noreferrer\">github.com/yesodweb/yesod/issues/1479</a>"}], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 894, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1519429496, "creation_date": 1516406320, "last_edit_date": 1519429496, "question_id": 48351199, "link": "https://stackoverflow.com/questions/48351199/yesod-neterr-connection-reset-in-browser-when-sending-large-json-body", "title": "Yesod: net::ERR_CONNECTION_RESET in browser when sending large JSON body", "body": "<p>I'm sending a large JSON body (~3MB) in a production app (it's a base64 encoded file). When I send a JSON body, Yesod seems to think this worked:</p>\n\n<pre><code>POST /send-json\n  Accept: */*\n  Status: 200 OK 0.000098s\n</code></pre>\n\n<p>But the browser doesn't get a response back and instead gets <code>net::ERR_CONNECTION_RESET</code>. I've reproduced this in Chrome, Safari and Firefox.</p>\n\n<p>Could this be a bug somewhere, in maybe warp or wai? My expectation would be that if Yesod is configured with:</p>\n\n<pre><code>maximumContentLength _ _ = Just (10 * 1024 * 1024) -- 10 megabytes\n</code></pre>\n\n<p>that receiving a large request body shouldn't be a problem.</p>\n\n<p>Version Info: <a href=\"https://gist.github.com/MaxGabriel/10e8a999eabcc9cb566c087978f5c3ac\" rel=\"nofollow noreferrer\">https://gist.github.com/MaxGabriel/10e8a999eabcc9cb566c087978f5c3ac</a></p>\n\n<p>LTS: LTS-Haskell 9.14</p>\n\n<p>I reproduced this issue in this repo here: <a href=\"https://github.com/MaxGabriel/large-files\" rel=\"nofollow noreferrer\">https://github.com/MaxGabriel/large-files</a>. It's the yesod-simple template with just 1 additional commit: <a href=\"https://github.com/MaxGabriel/large-files/commit/38addf762feaa5cbff19b84821c7980eec10b160\" rel=\"nofollow noreferrer\">https://github.com/MaxGabriel/large-files/commit/38addf762feaa5cbff19b84821c7980eec10b160</a>. Instead of sending a file, I just copy a string a bunch of times to create a huge JSON body (a few megabytes).</p>\n\n<p>I can't reproduce this issue sending a binary file in a form.</p>\n\n<p>I can't reproduce this issue from <code>curl</code>.</p>\n\n<p>EDIT: If I actually consume the body using <code>requireCheckJsonBody</code>, then the issue goes away. If I ignore the body and just <code>return ()</code> then I get the error. Because of this, I think there's a good chance this is a bug in Yesod or somewhere else in the stack</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1516405188, "post_id": 48350898, "comment_id": 83688777, "body": "So have you tried to do what the compiler suggests?"}], "answers": [{"tags": [], "owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "is_accepted": true, "score": 1, "last_activity_date": 1516445135, "creation_date": 1516445135, "answer_id": 48355151, "question_id": 48350898, "link": "https://stackoverflow.com/questions/48350898/persistent-upsert-does-not-compile/48355151#48355151", "title": "Persistent upsert does not compile", "body": "<p>Embarassingly, it really was as simple as adding <code>{-# LANGUAGE TypeFamilies      #-}</code>. I hadn't tried that because I misread the error message and none of my other modules needed that extension. Thanks, Fyodor!</p>\n"}], "owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 48355151, "answer_count": 1, "score": 0, "last_activity_date": 1516445135, "creation_date": 1516403872, "question_id": 48350898, "link": "https://stackoverflow.com/questions/48350898/persistent-upsert-does-not-compile", "title": "Persistent upsert does not compile", "body": "<p>I'm trying to do something in Persistent with PostgreSQL that seems like it should be simple: Given a list of <code>Attendance</code> records, overwrite any existing rows with same unique key or insert if they don't exist. Here are the types:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkDeleteCascade sqlSettings, mkMigrate \"migrateAllEvents\"] [persistLowerCase|\nEvent json sql=events\n    description Text\n    date UTCTime\n    UniqueEvent date\nAttendance json\n    attending Bool\n    eventId EventId\n    user UserId\n    UniqueAttendance eventId user\n|]\n</code></pre>\n\n<p>I don't have keys, so I can't use <code>repsert</code>, but I think <code>upsert</code> is what I need. The <a href=\"https://hackage.haskell.org/package/persistent-2.7.3/docs/Database-Persist-Class.html#v:upsert\" rel=\"nofollow noreferrer\">documentation for <code>upsert</code></a> looks a bit vague to me: If the record exists and I leave the updates blank, I understand that it will retain the entity as it was. But that's not equivalent to the behavior of <code>repsert</code>, as claimed, is it? It also doesn't say what happens when no uniqueness constraint exists.</p>\n\n<p>What I tried was </p>\n\n<pre><code>runDb (mapM_ ups atts)\n where \n  -- ups rec = upsert rec [AttendanceAttending =. True] also doesn't work\n  ups rec = upsert rec [AttendanceAttending =. (attendanceAttending rec)]\n</code></pre>\n\n<p>but this leads to an error that I don't really understand:</p>\n\n<pre><code>\u2022 Illegal equational constraint BaseBackend backend ~ SqlBackend\n  (Use GADTs or TypeFamilies to permit this)\n\u2022 When checking the inferred type\n    ups :: forall (m :: * -&gt; *) backend.\n           (BaseBackend backend ~ SqlBackend, PersistUniqueWrite backend,\n            MonadIO m) =&gt;\n           Attendance -&gt; ReaderT backend m (Entity Attendance)\n</code></pre>\n\n<p>Any idea what causes this error? <code>upsertBy</code> is also the same. I have imported Esqueleto in that same file, but <code>hiding ((=.))</code>, so it should be pure Persistent.</p>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1516399831, "post_id": 48350234, "comment_id": 83687092, "body": "Could you please insert definition of <code>sequence</code> function? If this is is a standard function from <code>base</code> package, then what&#39;s the type of <code>block</code>? It&#39;s always useful to add complete type signatures to functions you need help with (if this is not obviosly clear from the context)."}, {"owner": {"reputation": 121, "user_id": 7756975, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0634a910d385fc6d13ccc62e8ea37e56?s=128&d=identicon&r=PG&f=1", "display_name": "R. Bosman", "link": "https://stackoverflow.com/users/7756975/r-bosman"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1516400120, "post_id": 48350234, "comment_id": 83687203, "body": "I have updated the code fragment, you are right I removed a bit too much info"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 4, "creation_date": 1516404476, "post_id": 48350234, "comment_id": 83688573, "body": "Maybe <code>block</code> doesn&#39;t actually change the <code>Env</code> at all?  try <code>runState (sequence block)</code> with some initial map with a <code>block</code> you expect to change things, and making sure that it does return a changed map."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 7756975, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0634a910d385fc6d13ccc62e8ea37e56?s=128&d=identicon&r=PG&f=1", "display_name": "R. Bosman", "link": "https://stackoverflow.com/users/7756975/r-bosman"}, "edited": false, "score": 0, "creation_date": 1516440804, "post_id": 48353406, "comment_id": 83695609, "body": "Thanks for the effort in your answer! I have looked at the code again and found my issue. The problem was when I had nested blocks. If I had multiple levels the top one would always return the size of the 1st enclosed block, no matter what happens at a deeper level. Solved it by having all args to fStatBlock return the correct envSize, and then returning <code>return (maximum $ map fst xs, concatMap snd xs)</code>"}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 1, "last_activity_date": 1516430476, "creation_date": 1516430476, "answer_id": 48353406, "question_id": 48350234, "link": "https://stackoverflow.com/questions/48350234/haskell-state-monad-get-updated-state-after-sequence/48353406#48353406", "title": "Haskell State monad: get updated state after sequence", "body": "<p>As Justin L. suggests, the problem probably is that <code>block</code> is not changing the <code>Env</code>.  Here's your example code, unchanged, with some test code added to make a complete program.  Function <code>setValue</code> produces an <code>EnvState</code> that changes the <code>Env</code>.  Using <code>setValue</code> in the call to <code>fStatBlock</code> <strong>does</strong> result in a size that is one greater than it would be if based on the original <code>env</code>.</p>\n\n<p><strong>complete program</strong></p>\n\n<pre><code>import Control.Monad.State \nimport Data.Map as M\n\ntype Code = [Int]\n\n\n-- begin original code ------\n\ntype EnvState = State Env (Int, Code)\ntype Env = M.Map String Int\n\nfStatBlock :: [EnvState] -&gt; EnvState\nfStatBlock block = do origEnv &lt;- get\n                      xs      &lt;- sequence block -- prelude sequence\n                      newEnv  &lt;- get\n                      put origEnv\n                      return (M.size newEnv, concatMap snd xs)\n\n-- end original code -------\n\n\nsetValue :: String -&gt; Int -&gt; EnvState\nsetValue name value = state (\\env -&gt; ((0,[]), insert name value env))\n\nmain = do\n    let env = fromList [(\"x\", 5), (\"y\", 10)]\n        fsb = fStatBlock [setValue \"a\" 15] \n    print $ fst $ fst $ runState fsb env\n</code></pre>\n\n<p><strong>results</strong></p>\n\n<pre><code>$ ./main \n3\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 7756975, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0634a910d385fc6d13ccc62e8ea37e56?s=128&d=identicon&r=PG&f=1", "display_name": "R. Bosman", "link": "https://stackoverflow.com/users/7756975/r-bosman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 48353406, "answer_count": 1, "score": 1, "last_activity_date": 1516430476, "creation_date": 1516399628, "last_edit_date": 1516400102, "question_id": 48350234, "link": "https://stackoverflow.com/questions/48350234/haskell-state-monad-get-updated-state-after-sequence", "title": "Haskell State monad: get updated state after sequence", "body": "<p>I'm building a C# compiler in haskell as part of a compilers course.\nI am using the state monad, and the problem lies in the code for the block. I'm using the state to wrap the env of declared vars. When parsing a block, I want to extend this state (because of declarations inside the block), but afterwards return to the original block (since declerations don't go outside the block). However, I want to know the size of the new updated state first. So I have the code below:</p>\n\n<pre><code>type EnvState = State Env (Int, Code)\ntype Env = M.Map String Int\n\nfStatBlock :: [EnvState] -&gt; EnvState\nfStatBlock block = do origEnv &lt;- get\n                      xs      &lt;- sequence block -- prelude sequence\n                      newEnv  &lt;- get\n                      put origEnv\n                      return (M.size newEnv, concatMap snd xs)\n</code></pre>\n\n<p>The env is of type Data.Map.</p>\n\n<p>My problem is that the newEnv isn't the updated env after sequence, but equal to the origEnv. Therefore, the size returned is 100% dependent on the size of the original env, and does not change no matter what is inserted in the sequence. (I have tested the insert method and it works).</p>\n\n<p>Is this somehow due to lazy evaluation? Weird execution order? Or should this give the new, updated env and am I doing something wrong somewhere else? Thanks for the help.</p>\n"}, {"tags": ["haskell", "serialization", "monads"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516406916, "post_id": 48349476, "comment_id": 83689283, "body": "Monads are allowed to do arbitrary computation (within the limits of their effects). The only serialisation of that that I can think of is the original Haskell source code (not available at runtime). In Haskell functions are (first class) values but not data. Applicatives would also not be serialisable for the same reason. You want some representation of your drawings with only data (no functions or applicatives), e.g. a list of drawing commands (begin path, move to, stroke path, push transform,...). Or perhaps you could output your drawings to svg or some other standard drawing description."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516407073, "post_id": 48349476, "comment_id": 83689308, "body": "Alternatively you could do extensive dsl work to serialise some things (eg like in <code>sbv</code>) but you definitely can\u2019t deserialise such things into programs with performance comparable to compiled programs (likely not even comparable to interpreted languages)"}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516529387, "post_id": 48349476, "comment_id": 83717979, "body": "I don&#39;t need that much performance. I also can use just a &#39;Monoid&#39;. Will <b><i>Monoid</i></b> work better?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516538359, "post_id": 48349476, "comment_id": 83720233, "body": "Without knowing any details, <code>Monoid</code> seems like a better starting point"}], "owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1516401559, "creation_date": 1516395686, "last_edit_date": 1516401559, "question_id": 48349476, "link": "https://stackoverflow.com/questions/48349476/serialize-a-program-written-in-a-free-monad", "title": "Serialize a program written in a free monad?", "body": "<p>I would like to serialize small drawings in Rasterific to JSON.</p>\n\n<p>I want to serialize programs/drawing actions such as:</p>\n\n<pre><code>withTexture (uniformTexture drawColor) $ do\n            fill $ circle (V2 0 0) 30\n            stroke 4 JoinRound (CapRound, CapRound) $\n                   circle (V2 400 200) 40\n</code></pre>\n\n<p>How can I do such an serialization to JSON?</p>\n\n<p>My ideas so far: Perhaps it is better to use the monoid instance. There is also an answer on stackoverflow that advises to use a 'data type' for function calls and an interpreter function that evaluated the code (ie. calls the function): <a href=\"https://stackoverflow.com/questions/42701878/how-to-serialize-function-type-to-json-in-haskell\">How to serialize function type to json in haskell?</a></p>\n"}, {"tags": ["c++", "haskell", "llvm"], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "edited": false, "score": 0, "creation_date": 1516395135, "post_id": 48348367, "comment_id": 83685023, "body": "This sounds like a good approach. What would be the best way to pass the Module to llvm-hs and from there back to C++?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "edited": false, "score": 0, "creation_date": 1516436661, "post_id": 48348367, "comment_id": 83694617, "body": "It seems you need <a href=\"https://hackage.haskell.org/package/llvm-hs-5.1.3/docs/LLVM-Module.html#v:moduleAST\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/llvm-hs-5.1.3/docs/&hellip;</a> but I haven&#39;t figured out how to construct a <code>LLVM.Module</code> without <code>LLVM.Internal.Module</code>."}, {"owner": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "edited": false, "score": 0, "creation_date": 1516472579, "post_id": 48348367, "comment_id": 83705934, "body": "That&#39;s exactly the link I am missing. How do I get my module from C++ to Haskell?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "edited": false, "score": 0, "creation_date": 1516477550, "post_id": 48348367, "comment_id": 83707457, "body": "The only way I found is <code>LLVM.Internal.Module.newModule</code>: <a href=\"https://hackage.haskell.org/package/llvm-hs-5.1.3/docs/LLVM-Internal-Module.html#v:newModule\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/llvm-hs-5.1.3/docs/&hellip;</a>"}, {"owner": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "edited": false, "score": 0, "creation_date": 1516486063, "post_id": 48348367, "comment_id": 83709928, "body": "I guess I will try that. Normally I shy away from everything labeled &quot;internal&quot;, but it seems to be the only way. Thank you for your help!"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1516390699, "creation_date": 1516390699, "answer_id": 48348367, "question_id": 48347500, "link": "https://stackoverflow.com/questions/48347500/how-can-i-integrate-haskell-llvm-passes-with-c-llvm-passes-if-at-all/48348367#48348367", "title": "How can I integrate Haskell LLVM passes with C++ LLVM passes (if at all)?", "body": "<p>As there seem no way to register passes via C interface, there is no way to do it via Haskell either. So the problem is not even in writing a pass in a foreign language, but with its registration.</p>\n\n<p>I think you can achieve what you want by creating a stub pass (say, <code>HaskellPass</code>), which would hand a <code>Module</code> to Haskell side. You'd also need to compile Haskell code into a <code>foreign library</code>, so you can link to it from C++.</p>\n"}], "owner": {"reputation": 231, "user_id": 2091724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333a4c952bd041cd832ac2684927650b?s=128&d=identicon&r=PG", "display_name": "Oliver Gerlach", "link": "https://stackoverflow.com/users/2091724/oliver-gerlach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 48348367, "answer_count": 1, "score": 3, "last_activity_date": 1516390699, "creation_date": 1516386861, "question_id": 48347500, "link": "https://stackoverflow.com/questions/48347500/how-can-i-integrate-haskell-llvm-passes-with-c-llvm-passes-if-at-all", "title": "How can I integrate Haskell LLVM passes with C++ LLVM passes (if at all)?", "body": "<p>I have a set of custom LLVM passes written in C++. Know I am up to add some new passes with analysis algorithms to be tested. To speed things up, I'd like to write these passes in Haskell. I know that LLVM-hs exists and has a FFI. However, I could not find a way to pass the IR preprocessed by the C++ passes to Haskell and vice versa. Can it be done and if yes, how?</p>\n"}, {"tags": ["haskell", "idris", "dependent-type"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1516387494, "post_id": 48346106, "comment_id": 83681228, "body": "What is the equivalent Haskell code you tried? Could the discrepancy come from the fact that GHC knows some theory for the built-in type-level <code>+</code> , and in particular <code>n + 0 = n</code> (which is otherwise not so trivial if you define addition from scratch)."}], "answers": [{"comments": [{"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1516397416, "post_id": 48348969, "comment_id": 83686023, "body": "Thanks! The definition involving <code>aux</code> is exactly what I was looking for, and your explanation makes perfect sense. I had read hasochism, but I had only remembered the pain and forgotten about the pleasure. I&#39;ll need to go over it again."}, {"owner": {"reputation": 793, "user_id": 919707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa2dedcafcada278c1cafff49ed1e7f?s=128&d=identicon&r=PG", "display_name": "Alexander Gryzlov", "link": "https://stackoverflow.com/users/919707/alexander-gryzlov"}, "edited": false, "score": 0, "creation_date": 1516466094, "post_id": 48348969, "comment_id": 83703672, "body": "I think the original issue is rather that matching on <code>Refl</code> works only when both sides are coerced into being syntactically equal, e.g., by some previous pattern matching."}, {"owner": {"reputation": 793, "user_id": 919707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa2dedcafcada278c1cafff49ed1e7f?s=128&d=identicon&r=PG", "display_name": "Alexander Gryzlov", "link": "https://stackoverflow.com/users/919707/alexander-gryzlov"}, "edited": false, "score": 0, "creation_date": 1516466109, "post_id": 48348969, "comment_id": 83703676, "body": "Also <code>aux</code> is just a specialized version of <code>cong</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1516393369, "creation_date": 1516393369, "answer_id": 48348969, "question_id": 48346106, "link": "https://stackoverflow.com/questions/48346106/pattern-match-on-equality/48348969#48348969", "title": "Pattern Match on Equality", "body": "<p>I think this can be related to <a href=\"http://homepages.inf.ed.ac.uk/slindley/papers/hasochism.pdf\" rel=\"noreferrer\">Hasochism</a>.</p>\n\n<p>The word Hasochism was used by Lindley and McBride to descibe the pain and pleasure of using (pseudo-) dependent types like GADTs in Haskell. In Haskell, as soon as we match on <code>Refl</code>, GHC invokes a theorem prover which will propagate that equality for us. This is the \"pleasure\" part.</p>\n\n<p>The \"pain\" part lies in not having full dependent types. We do not really have <code>f : (x : T) -&gt; ...</code> in Haskell. If <code>x</code> is universally quantified, it has to be a type in Haskell, and it will be erased at runtime, so we can't pattern match on it directly. We have to use singletons, and other techniques. Also, in Haskell we can't write <code>g : (h : *-&gt;*) (x : *) -&gt; h x -&gt; ...</code> and pass the first two arguments to make <code>h x = Int</code>. For that, <code>h</code> would need to be a type-level function, e.g. <code>g (\\t:* -&gt; t) Int 42</code>, but we haven't those. The lack of this feature greatly simplifies the \"pleasure\" part, though, and the type erasure makes the language more efficient (even though we should have the option of avoiding the erasure, with <code>pi</code> types), so it's not that bad.</p>\n\n<p>Anyway, in Agda/Coq/Idris, unless you want to use some automagic stuff (like tactics), you have to write your own dependent elimination, and bring your equality proofs around where you need them, e.g. using your <code>cong</code>.</p>\n\n<p>As an alternative, this also compiles:</p>\n\n<pre><code>rightIdentityAlt : (n : Nat) -&gt; n = (plus n Z)\nrightIdentityAlt Z = Refl\nrightIdentityAlt (S y) = aux y (rightIdentityAlt y) \n  where\n  aux : (m : Nat) -&gt; m = plus n Z -&gt; S m = plus (S n) Z\n  aux _ Refl = Refl\n</code></pre>\n\n<p>Note the innermost function <code>aux</code>, which involves two variables <code>m</code> and <code>n</code>. This is done so, when matching against <code>Refl</code>, this results in substituting <code>m</code> with <code>plus n Z</code> without affecting the <code>n</code>. To play this \"trick\" we need two distinct variables.</p>\n\n<p>The issue with the original code is that <code>m</code> and <code>n</code>, there, are multiple occurrences of the same variable <code>n</code>. This makes the dependent matching to replace <em>both</em> with <code>S y</code>, and check the resulting type, which triggers the error.</p>\n\n<p>Personally, I can understand better the dependent pattern matching in Coq, where you can use <code>match .. return ...</code> to express the resulting type of each match. Further, that is an expression which can be nested, without requiring separate definitions. Here it is, annotated with some comments showing how each match affects the required type.</p>\n\n<pre><code>Fixpoint rightIdentityAlt (n: nat): n = plus n O :=\n   match n return n = plus n O with\n   | O =&gt; (* required: n = plus n O with n := O\n             hence   : O = plus O O *)\n      eq_refl\n   | S y =&gt;  (* required: n = plus n O with n := S y\n                hence   : S y = plus (S y) O *)\n      match rightIdentityAlt y in _ = o return S y = S o with\n      | eq_refl =&gt; (* required: S y = S o with o := y\n                      hence   : S y = S y *)\n         eq_refl\n      end\n   end\n.\n</code></pre>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 3, "accepted_answer_id": 48348969, "answer_count": 1, "score": 11, "last_activity_date": 1517498433, "creation_date": 1516381463, "last_edit_date": 1517498433, "question_id": 48346106, "link": "https://stackoverflow.com/questions/48346106/pattern-match-on-equality", "title": "Pattern Match on Equality", "body": "<p>I'm sort of new to Idris. I've used a little agda before, and I have a heavy background in GHC Haskell. I'm trying to understand why something that works in GHC Haskell doesn't work in Idris. The following code does not compile (idris version 0.12.3, nobuiltins, noprelude):</p>\n\n<pre><code>data Nat = S Nat | Z\n\nplus : Nat -&gt; Nat -&gt; Nat\nplus Z right        = right\nplus (S left) right = S (plus left right)\n\nrightIdentityAlt : (n : Nat) -&gt; n = (plus n Z)\nrightIdentityAlt Z = Refl\nrightIdentityAlt (S y) = case rightIdentityAlt y of\n  Refl =&gt; Refl\n</code></pre>\n\n<p>This fails with the following error:</p>\n\n<blockquote>\n  <p>idris_binary.idr:21:3-7:When checking left hand side of IdrisBinary.case block in rightIdentityAlt at idris_binary.idr:20:31:\n  Unifying y and plus y Z would lead to infinite value</p>\n</blockquote>\n\n<p>The roughly equivalent GHC haskell code does typecheck. I can get the Idris version to typecheck if I instead use:</p>\n\n<pre><code>cong : (x : Nat) -&gt; (y : Nat) -&gt; (f : Nat -&gt; Nat) -&gt; x = y -&gt; f x = f y\ncong _ _ _ Refl = Refl\n\nrightIdentity : (n : Nat) -&gt; n = (plus n Z)\nrightIdentity Z = Refl\nrightIdentity (S x) = cong x (plus x Z) S (rightIdentity x)\n</code></pre>\n\n<p>I think that the reason that <code>rightIdentityAlt</code> works in GHC Haskell but not in Idris deals with a difference in how unification work in the two language. In GHC Haskell, the unifications learned from a pattern matching on a GADT just propogate everywhere, but in Idris, it seems like you need to refine the original types with a <code>with</code> clause. Here's my attempt at doing that:</p>\n\n<pre><code>rightIdentityAlt : (n : Nat) -&gt; n = (plus n Z) \nrightIdentityAlt Z = Refl\nrightIdentityAlt (S y) with (rightIdentityAlt y) \n  rightIdentityAlt (S y) | Refl {A = Nat} {x = y} = Refl\n</code></pre>\n\n<p>Blast. Still no good. Now we've lost the equality we were originally trying to prove:</p>\n\n<pre><code>idris_binary.idr:26:20:When checking left hand side of with block in IdrisBinary.rightIdentityAlt:\nType mismatch between\n    plus y Z (Inferred value)\nand\n    y (Given value)\nHoles: IdrisBinary.rightIdentityAlt\n</code></pre>\n\n<p>I understand that the pragmatic answer is just to rewrite this using <code>cong</code> or to so something involving tactics, but I really want to understand why the way I want to write <code>rightIdentityAlt</code> doesn't work. Pattern matching on <code>=</code> isn't bringing evidence into scope the way I would expect it to. Is there a way to get it to do this, or is there something fundamentally wrong with this approach in Idris?</p>\n"}, {"tags": ["haskell", "lambda", "anonymous-function", "let", "expression-evaluation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516374611, "post_id": 48344012, "comment_id": 83673679, "body": "No, <code>g</code> is <code>g = \\h k x -&gt; k (h x)</code> the variables on the left are parameters as well."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516396956, "post_id": 48344012, "comment_id": 83685814, "body": "<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:.\" rel=\"nofollow noreferrer\"><code>g = flip (.) = (&gt;&gt;&gt;)</code></a>. <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Function.html#v:-38-\" rel=\"nofollow noreferrer\"><code>g h k x = k . h $ x = x &amp; (h &gt;&gt;&gt; k) = h x &amp; k</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 8, "last_activity_date": 1516374735, "creation_date": 1516374735, "answer_id": 48344130, "question_id": 48344012, "link": "https://stackoverflow.com/questions/48344012/how-does-this-let-expression-work/48344130#48344130", "title": "How does this let expression work?", "body": "<p><code>g h k = ...</code> is a function definition. It means that the result of applying <code>g</code> to two arguments (named <code>h</code> and <code>k</code>) will evaluate to the <code>...</code> part. In other words it's a shortcut for <code>g = \\h -&gt; \\k -&gt; ...</code>.</p>\n\n<p>So we can simplify the expression step by step as follows:</p>\n\n<pre><code>let g h k = (\\x -&gt; k (h x)) in g (+1) (\\x -&gt; x+x) 20\nlet g = \\h -&gt; \\k -&gt; (\\x -&gt; k (h x)) in g (+1) (\\x -&gt; x+x) 20\n(\\h -&gt; \\k -&gt; (\\x -&gt; k (h x))) (+1) (\\x -&gt; x+x) 20\n(\\k -&gt; (\\x -&gt; k ((+1) x))) (\\x -&gt; x+x) 20\n(\\x -&gt; (\\x -&gt; x+x) ((+1) x)) 20\n(\\x -&gt; x+x) ((+1) 20)\n(\\x -&gt; x+x) 21\n21 + 21\n42\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 118, "user_id": 4464460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/955174b99bbf044a6f5e9783bc146698?s=128&d=identicon&r=PG&f=1", "display_name": "unnicolo", "link": "https://stackoverflow.com/users/4464460/unnicolo"}, "edited": false, "score": 0, "creation_date": 1516378052, "post_id": 48344163, "comment_id": 83675832, "body": "Is there maybe a term for this transfer of variables between the head of the function and the lambda expression? I would like to understand it better, if possible, by reading more about it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 118, "user_id": 4464460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/955174b99bbf044a6f5e9783bc146698?s=128&d=identicon&r=PG&f=1", "display_name": "unnicolo", "link": "https://stackoverflow.com/users/4464460/unnicolo"}, "edited": false, "score": 3, "creation_date": 1516382142, "post_id": 48344163, "comment_id": 83678331, "body": "@unnicolo It&#39;s just syntactic sugar. <code>f x = x</code> is desugared to <code>f = \\x -&gt; x</code>. All functions are ultimately defined by just binding names to lambda expressions, and moving the parameter from the lambda expression to the left-hand side of the binding is just a lighter-weight syntax for doing so."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1516374842, "creation_date": 1516374842, "answer_id": 48344163, "question_id": 48344012, "link": "https://stackoverflow.com/questions/48344012/how-does-this-let-expression-work/48344163#48344163", "title": "How does this let expression work?", "body": "<p>Think of a function definition. If you write:</p>\n\n<pre><code>g h k x = k (h x)\n</code></pre>\n\n<p>Then it is a function that takes three parameters <code>h</code>, <code>k</code> and <code>x</code> and returns <code>k (h x)</code>. This is equivalent to:</p>\n\n<pre><code>g h k = \\x -&gt; k (h x)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>g h = \\k x -&gt; k (h x)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>g = \\h k x -&gt; k (h x)\n</code></pre>\n\n<p>So we can transfer variables between the head of the function, and the lambda-expression in the body. In fact a Haskell compiler will rewrite it.</p>\n\n<p>So with the <code>let</code> expression, we define a locally scoped function like the one defined above. Now if we call <code>g (+1) (\\x -&gt; x+x) 20</code>, then will thus call <code>g</code> with <code>h = (+1)</code>, <code>k = (\\x -&gt; x+x)</code> and <code>x = 20</code>.</p>\n\n<p>So we will evaluate it as:</p>\n\n<pre><code>(\\x -&gt; x+x) ((+1) 20)\n</code></pre>\n\n<p>which evaluates to:</p>\n\n<pre><code>   (\\x -&gt; x+x) ((+1) 20)\n-&gt; ((+1) 20)+((+1) 20)\n-&gt; 21 + 21\n-&gt; 42\n</code></pre>\n"}], "owner": {"reputation": 118, "user_id": 4464460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/955174b99bbf044a6f5e9783bc146698?s=128&d=identicon&r=PG&f=1", "display_name": "unnicolo", "link": "https://stackoverflow.com/users/4464460/unnicolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 1, "accepted_answer_id": 48344163, "answer_count": 2, "score": 10, "last_activity_date": 1516436848, "creation_date": 1516374370, "last_edit_date": 1516436848, "question_id": 48344012, "link": "https://stackoverflow.com/questions/48344012/how-does-this-let-expression-work", "title": "How does this let expression work?", "body": "<p>Given this line of Haskell code, my task was to evaluate it to its most simple form. </p>\n\n<pre><code>let g h k = (\\x -&gt; k (h x)) in g (+1) (\\x -&gt; x+x) 20\n</code></pre>\n\n<p>I have already been given the answer (and of course evaluated it myself in GHCI): <code>42</code></p>\n\n<p>However, I would like get a better understanding of how the evaluation actually works here. In general, I think I know how (simple) let expressions work:</p>\n\n<p>Example</p>\n\n<pre><code>a = let y = 5 in y * 5  -- a == 25\n</code></pre>\n\n<p>This evaluates to <code>25</code> because we bind <code>y</code> to the value of <code>5</code> and <code>a</code> gets assigned to the value of <code>y*5</code> (the part after the <code>in</code>). The binding <code>y = 5</code> is only valid within the scope of the <code>let</code>.</p>\n\n<p>So far, the only interpretation (which at least evaluates to 42) is the following:</p>\n\n<pre><code>let g h k = (\\x -&gt; k (h x)) in g (+1) (\\x -&gt; x+x) 20\n</code></pre>\n\n<ul>\n<li><code>g</code> is <code>(\\x -&gt; k (h x))</code></li>\n<li><code>h</code> is <code>(+1)</code> (the function <code>(\\x -&gt; x+1)</code>)</li>\n<li><p><code>k</code> is <code>(\\x -&gt; x+x)</code></p>\n\n<ol>\n<li><code>20</code> is the input of <code>g</code> which yields <code>k (h 20)</code></li>\n<li><code>h 20</code> gives <code>20 + 1</code> = <code>21</code></li>\n<li><code>k (h 20)</code> = <code>k 21</code> = <code>21 + 21</code> = <code>42</code></li>\n</ol></li>\n</ul>\n\n<p>But what confuses me is the use of <code>g h k</code> after the let. What does that mean?</p>\n"}, {"tags": ["haskell", "type-conversion", "division"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1516373587, "post_id": 48343743, "comment_id": 83672989, "body": "<code>Fractional</code> is also a <code>Num</code>."}, {"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516373684, "post_id": 48343743, "comment_id": 83673045, "body": "Yes, I know that <code>Fractional</code> is a subclass of <code>Num</code>, but not every instance of <code>Num</code> can be converted to <code>Fractional</code>. So why is it converted in that case?"}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 1, "creation_date": 1516373734, "post_id": 48343743, "comment_id": 83673081, "body": "I don&#39;t believe <code>Num</code> defines <code>&#47;</code> operator. <code>Fractional</code> does. So the only way your expression type checks is if your operands are <code>Fractional</code> instances. ghci is trying to pick the most general type it can. <code>Num</code> doesn&#39;t work in this case. It&#39;s not that <code>Num</code> is being converted to <code>Fractional</code>"}, {"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "edited": false, "score": 0, "creation_date": 1516373881, "post_id": 48343743, "comment_id": 83673183, "body": "Does it mean that the command <code>:t sum [1,2,3]</code> should return <code>Fractional a =&gt; a</code> instead of <code>Num a =&gt; a</code>?"}, {"owner": {"reputation": 1722, "user_id": 697188, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b0927ded7bba64ba28a6ec4279a754a6?s=128&d=identicon&r=PG", "display_name": "Michael Welch", "link": "https://stackoverflow.com/users/697188/michael-welch"}, "edited": false, "score": 0, "creation_date": 1516373939, "post_id": 48343743, "comment_id": 83673225, "body": "Like I said in edited comment, the compiler is inferring the most general type it can for any given expression. For your given <code>sum</code> example that&#39;s <code>Num</code> but for the given division <code>&#47;</code> example that&#39;s Fractional."}, {"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "edited": false, "score": 0, "creation_date": 1516374010, "post_id": 48343743, "comment_id": 83673278, "body": "Ah ok, thanks! Now I see what happens."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "edited": false, "score": 1, "creation_date": 1516374290, "post_id": 48343883, "comment_id": 83673457, "body": "Thanks! What I was missing was indeed the fact that the type of a numerical literal depends on the context in which it is used."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1516374005, "creation_date": 1516374005, "answer_id": 48343883, "question_id": 48343743, "link": "https://stackoverflow.com/questions/48343743/division-in-haskell-on-num-instances/48343883#48343883", "title": "Division in Haskell on `Num` instances", "body": "<blockquote>\n  <p>I thought that numeric conversions had to be explicit in Haskell.</p>\n</blockquote>\n\n<p>That is correct, but here we have <em>numerical literals</em>. If you write <code>2</code>, that is <em>not</em> per se an <code>Int</code>, or an <code>Integer</code>. We do not know it at that point.</p>\n\n<p>If we then for instance write <code>2 / 3</code>, then Haskell will derive that we use a function <code>(/) :: Fractional a =&gt; a -&gt; a -&gt; a</code>, so it concludes that <code>2</code> and <code>3</code> should be <code>Fractional</code>, so in this case it will use a floating point parser to parse the <code>2</code> literal.</p>\n\n<p>In case you would however explicitly state that <code>2</code> is an <code>Int</code>, then it will go wrong:</p>\n\n<pre><code>Prelude&gt; (2 :: Int) / 3\n\n&lt;interactive&gt;:4:1: error:\n    \u2022 No instance for (Fractional Int) arising from a use of \u2018/\u2019\n    \u2022 In the expression: (2 :: Int) / 3\n      In an equation for \u2018it\u2019: it = (2 :: Int) / 3\n</code></pre>\n\n<p>So by forcing Haskell to use an <code>Int</code>, Haskell sees no way to parse it as a type that supports the <code>(/)</code> function.</p>\n\n<p>Now to make it more specific to your question, if we analyze <code>sum [1,2,3]</code>. <code>sum</code> has type <code>sum :: Num a =&gt; [a] -&gt; a</code>, so in case the elements of the list are <code>Fractional</code>, then the <code>sum ...</code> has also a <code>Fractional</code> type.</p>\n\n<p>For the denominator you actually make an <em>explicit</em> conversion. Indeed, you write <code>fromIntegral (length [1,2,3])</code>. Now <code>length :: [a] -&gt; Int</code> returns an <code>Int</code>. The <code>fromIntegral</code> will convert any <code>Integral</code> type to a generic <code>Num</code> type. So it can convert an <code>Int</code> to a <code>Float</code>.</p>\n"}], "owner": {"reputation": 327, "user_id": 1060988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560039efbfdbc514c39e6423bab192ea?s=128&d=identicon&r=PG", "display_name": "ablondin", "link": "https://stackoverflow.com/users/1060988/ablondin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 48343883, "answer_count": 1, "score": 1, "last_activity_date": 1516374005, "creation_date": 1516373538, "question_id": 48343743, "link": "https://stackoverflow.com/questions/48343743/division-in-haskell-on-num-instances", "title": "Division in Haskell on `Num` instances", "body": "<p>Consider the following excerpt from GHCI:</p>\n\n<pre><code>Prelude&gt; :t sum [1,2,3]\nsum [1,2,3] :: Num a =&gt; a\nPrelude&gt; :t fromIntegral (length [1,2,3])\nfromIntegral (length [1,2,3]) :: Num b =&gt; b\nPrelude&gt; :t sum [1,2,3] / fromIntegral (length [1,2,3])\nsum [1,2,3] / fromIntegral (length [1,2,3]) :: Fractional a =&gt; a\n</code></pre>\n\n<p>I understand that both <code>sum [1,2,3]</code> and <code>fromIntegral (length [1,2,3])</code> are instances of <code>Num</code>. What puzzles me is, why does the compiler convert the operands to <code>Fractional</code>? I thought that numeric conversions had to be explicit in Haskell.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516364661, "post_id": 48341021, "comment_id": 83667287, "body": "How would you do this without a GADT?"}, {"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516367670, "post_id": 48341021, "comment_id": 83669106, "body": "<code>data Kind a = IntK Int | StringK String | BoolK Bool</code> etc. And then just use <code>dataKinds :: IO Kind a</code> as above."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1516371558, "post_id": 48341021, "comment_id": 83671598, "body": "That&#39;s not the same. In this declaration all constructors construct values of the same type, but in your GADT declaration constructors construct values of different types."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1516374618, "post_id": 48341021, "comment_id": 83673684, "body": "That corresponds to <code>... where IntK :: Int -&gt; Kind a; StringK :: String -&gt; Kind a; ...</code> in GADT syntax."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1516429891, "post_id": 48341021, "comment_id": 83693203, "body": "Incidentally, you can do a little factoring: <code>case n of { 1 -&gt; pure $ \u2026; 2 -&gt; pure $ \u2026; 3 -&gt; pure $ \u2026; \u2026 }</code> can be written <code>pure $ case n of { 1 -&gt; \u2026; 2 -&gt; \u2026; 3 -&gt; \u2026; \u2026 }</code>."}, {"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "edited": false, "score": 0, "creation_date": 1516705985, "post_id": 48341021, "comment_id": 83788434, "body": "melopmene: That is actually the correct answer to this problem! Thanks for that, and also thanks to Fyodor who explained why it&#39;s the correct answer!"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1516365631, "creation_date": 1516365631, "answer_id": 48341361, "question_id": 48341021, "link": "https://stackoverflow.com/questions/48341021/returning-polymorphic-types-with-gadts-in-haskell/48341361#48341361", "title": "Returning polymorphic types with GADTs in Haskell", "body": "<p>You might need an existential wrapper, e.g.</p>\n\n<pre><code>data SomeKind where\n   SomeKind :: Kind a -&gt; SomeKind\n\ndataKinds :: IO SomeKind\ndataKinds =\n  Randy.getStdRandom (Randy.randomR (1,6)) &gt;&gt;= \\n -&gt;\n    case n of\n       1 -&gt; pure . SomeKind $ IntK n\n       2 -&gt; pure . SomeKind $ IntK n\n       3 -&gt; pure . SomeKind $ StringK (show n)\n       4 -&gt; pure . SomeKind $ StringK (show n)\n       5 -&gt; pure . SomeKind $ BoolK True\n       6 -&gt; pure . SomeKind $ BoolK False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "edited": false, "score": 0, "creation_date": 1516367973, "post_id": 48341386, "comment_id": 83669295, "body": "The existential wrapper worked, thanks! I suppose I&#39;m pointlessly criticising the language itself now, but you&#39;d think that the above code would work without the wrapper."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "reply_to_user": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "edited": false, "score": 1, "creation_date": 1516369801, "post_id": 48341386, "comment_id": 83670385, "body": "Richard Eisenberg (who has been working on <code>-XDependentTypes</code> for GHC) comments on future work: <a href=\"https://www.reddit.com/r/haskell/comments/4amov2/the_future_of_dependent_haskell/d14xtjs/?context=3\" rel=\"nofollow noreferrer\">\u201cA key step along this path is lightweight existentials, allowing you do use <code>exists x. ...</code> in a type as easily as <code>forall x. ...</code>.\u201d</a> so maybe in the future we can write <code>IO (exists xx. Kind xx)</code>."}], "tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": true, "score": 4, "last_activity_date": 1516365672, "creation_date": 1516365672, "answer_id": 48341386, "question_id": 48341021, "link": "https://stackoverflow.com/questions/48341021/returning-polymorphic-types-with-gadts-in-haskell/48341386#48341386", "title": "Returning polymorphic types with GADTs in Haskell", "body": "<p>Make the type <code>xx</code> of <code>Kind xx</code> existential (does not appear in return type)</p>\n\n<pre><code>data SomeKind where\n  SomeKind :: Kind xx -&gt; SomeKind\n\n-- Only works because of: instance           Show (Kind a)\n-- Would not work with:   instance Show a =&gt; Show (Kind a)\ninstance Show SomeKind where\n  show :: SomeKind -&gt; String\n  show (SomeKind kind) = show kind\n</code></pre>\n\n<p>And implement <code>dataKinds :: IO SomeKind</code>.</p>\n\n<hr>\n\n<p>(Implement <code>dataKinds</code> with an <code>fmap</code>)</p>\n\n<p>(Extract <code>Kind</code> out of <code>SomeKind</code>, can we write a <code>Show</code> instance?)</p>\n\n<pre><code>data Some :: (k -&gt; Type) -&gt; Type where\n  Some :: f xx -&gt; Some f\n\ninstance ??? =&gt; Show (Some f) where\n  show :: Some f -&gt; String\n  show (Some some) = show some\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "accepted_answer_id": 48341386, "answer_count": 2, "score": 0, "last_activity_date": 1516365672, "creation_date": 1516364517, "question_id": 48341021, "link": "https://stackoverflow.com/questions/48341021/returning-polymorphic-types-with-gadts-in-haskell", "title": "Returning polymorphic types with GADTs in Haskell", "body": "<p>Take the following code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs #-}\n\n\nmodule Lib where\n\nimport System.Random as Randy\n\nsomeFunc :: IO ()\nsomeFunc = dataKinds &gt;&gt;= \\n -&gt; putStrLn (show n)\n\ndata Kind a where\n  IntK :: Int -&gt; Kind Int\n  StringK :: String -&gt; Kind String\n  BoolK :: Bool -&gt; Kind Bool\n  OtherK :: a -&gt; Kind a\n\n\ninstance Show (Kind a) where\n  show (IntK n)    = \"KindInt \" ++ show n\n  show (StringK s) = \"KindString \" ++ s\n  show (BoolK b)   = \"KindBool \" ++ show b\n\n\ndataKinds :: IO (Kind a)\ndataKinds =\n  Randy.getStdRandom (Randy.randomR (1,6)) &gt;&gt;= \\n -&gt;\n    case n of\n       1 -&gt; pure $ IntK n\n       2 -&gt; pure $ IntK n\n       3 -&gt; pure $ StringK (show n)\n       4 -&gt; pure $ StringK (show n)\n       5 -&gt; pure $ BoolK True\n       6 -&gt; pure $ BoolK False\n</code></pre>\n\n<p>This code will not compile, basically because the compiler doesn't like the fact that the <code>pure $ IntK n</code> specifies that <code>Kind Int</code> is returned by the first line, but <code>StringK</code> and <code>BoolK</code> are returned by the last four lines:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Int\u2019\n  Expected type: IO (Kind Int)    \n    Actual type: IO (Kind String)                               \n\u2022 In the expression: pure $ StringK (show n)\n</code></pre>\n\n<p>This strikes me as odd. I can do this easily without GADTs, just using the normal <code>data</code> declaration. But I had assumed that an enhancement like GADTs would not reduce the flexibility of the type system but add to it. Am I doing something wrong? I've only just encountered this extension so it's possible I've misunderstood something. How can I make the program compile using GADTs?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 2007549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4938a3a24d781090702afa69346e264?s=128&d=identicon&r=PG", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/2007549/emanuel-borsboom"}, "is_accepted": true, "score": 1, "last_activity_date": 1516366360, "creation_date": 1516366360, "answer_id": 48341582, "question_id": 48339070, "link": "https://stackoverflow.com/questions/48339070/set-compiler-for-1-package-in-haskell-stack/48341582#48341582", "title": "Set compiler for 1 package in Haskell Stack", "body": "<p>The recommended approach is to have two stack project files (e.g. <code>stack-frontend.yaml</code> using GHCJS and <code>stack-backend.yaml</code> using GHC), and then use the <code>--stack-yaml</code> argument to switch between them (e.g. use <code>stack --stack-yaml=stack-frontend.yaml build</code> to build the frontend, and <code>stack --stack-yaml=stack-backend.yaml build</code> to build the backend).  Both <code>stack-*.yaml</code> files can include the shared servant API.</p>\n"}], "owner": {"reputation": 468, "user_id": 1461226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e671198ed6050a12f482e5a01b88359?s=128&d=identicon&r=PG", "display_name": "rtytgat", "link": "https://stackoverflow.com/users/1461226/rtytgat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 48341582, "answer_count": 1, "score": 0, "last_activity_date": 1516366360, "creation_date": 1516358059, "question_id": 48339070, "link": "https://stackoverflow.com/questions/48339070/set-compiler-for-1-package-in-haskell-stack", "title": "Set compiler for 1 package in Haskell Stack", "body": "<p>I'm trying to write a small web application fully in Haskell. I have 3 logical packages:</p>\n\n<ul>\n<li>A backend, using <code>servant</code></li>\n<li>A frontend, using <code>reflex</code>, <code>reflex-dom</code> and <code>servant-reflex</code></li>\n<li>A shared package defining the Servant API for communication between the 2 and some data types for that API to use.</li>\n</ul>\n\n<p>That last package is giving me trouble. I don't know how to structure the project so the other 2 packages can use it. I see 2 options at the moment:</p>\n\n<ol>\n<li>Each package has its own stack file and git repository. Import the shared package using an <code>extra-deps</code> git link. The problem with this approach is it means I have to push any change to the shared package to GitHub before I can test it out with the other packages. Also I'd have to build everything separately.</li>\n<li>Use a single repository with a single stack.yml file. I'd prefer this, since it keeps everything together and also assures all packages are using the same resolver. In this case I would list all the packages in the <code>packages:</code> option. However, the client needs to be compiled with GHCJS, not GHC, and I don't see an option in the documentation to override the compiler for 1 specific package.</li>\n</ol>\n\n<p>Is there a way to make option 2 work? Or is there a better way to do this?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "is_accepted": false, "score": 0, "last_activity_date": 1516362667, "creation_date": 1516362667, "answer_id": 48340477, "question_id": 48338167, "link": "https://stackoverflow.com/questions/48338167/ghc-option-for-performance-related-files-out-directory/48340477#48340477", "title": "GHC option for performance related files out directory", "body": "<p>After reading of GHC source code (Profiling.c and RtsFlags.c) I found that it's possible with <code>-po</code> option:</p>\n\n<pre><code>ghc-options:     -Wall\n                 -O2\n                 -threaded\n                 -prof\n                 -fprof-auto\n                 -rtsopts\n                 -fprof-cafs\n                 \"-with-rtsopts=-N -s -h -i0.1 -p -po/My/Dir/MyApplication -M1G -S/My/Dir/MyApplication-S.log\"\n</code></pre>\n\n<p>So, will be created same 3 files but now in <code>/My/Dir</code> folder.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516362667, "creation_date": 1516355202, "last_edit_date": 1516358856, "question_id": 48338167, "link": "https://stackoverflow.com/questions/48338167/ghc-option-for-performance-related-files-out-directory", "title": "GHC option for performance related files out directory", "body": "<p>I made instrumental build which generates profiling information. I use <code>stack</code>. GHC options in <code>.cabal</code> file are:</p>\n\n<pre><code>ghc-options:     -Wall\n                 -O2\n                 -threaded\n                 -prof\n                 -fprof-auto\n                 -rtsopts\n                 -fprof-cafs\n                 \"-with-rtsopts=-N -s -h -i0.1 -p -M1G -SMyApplication-S.log\"\n</code></pre>\n\n<p>so running application generates files: <code>MyApplication-S.log, MyApplication.hp, MyApplication.prof</code>, but in current working directory - which is the problem, sure (also I need to run it on Windows and Linux). Is it possible to specify directory of those output files with some option? Because, without it I will get \"Can't open ... file...\" error due to permission error - Haskell Runtime tries to save all of them in current folder (on Linux and on Windows standard folders for binaries are not allowed for writing).</p>\n"}, {"tags": ["haskell", "io-monad", "wreq"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1516351956, "post_id": 48337174, "comment_id": 83659504, "body": "Well, what do you want the result to be if the condition is not fulfilled? How would your code look if written with <code>if\u2026then\u2026else</code>?"}, {"owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "edited": false, "score": 0, "creation_date": 1516352015, "post_id": 48337174, "comment_id": 83659539, "body": "<code>print</code> returns <code>()</code>, so it should fit. Where should the Response ByteString come from?"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1516352987, "post_id": 48337174, "comment_id": 83660098, "body": "Sounds like you want a return type of <code>Maybe (IO (Response ByteString))</code>, with something like <code>if hasRel then Just (post addr ...) else Nothing</code>."}], "answers": [{"comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1516376719, "post_id": 48344555, "comment_id": 83675017, "body": "Why do you need <code>unsafeLocalState</code> here? Don&#39;t you just want <code>(Just _) -&gt; post addr (&quot;dummy&quot; := details) &gt;&gt;= print</code>?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1516430184, "post_id": 48344555, "comment_id": 83693265, "body": "Yeah, <code>unsafeLocalState</code> (or <code>unsafePerformIO</code>) are unnecessary and inadvisable here. Just use a bind: <code>do { result &lt;- post addr (&quot;dummy&quot; := details); print result }</code>, or <code>&gt;&gt;=</code>/<code>=&lt;&lt;</code> as Lee mentions."}, {"owner": {"reputation": 13, "user_id": 8557858, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WVRUT.jpg?s=128&g=1", "display_name": "John Brown", "link": "https://stackoverflow.com/users/8557858/john-brown"}, "edited": false, "score": 0, "creation_date": 1516654643, "post_id": 48344555, "comment_id": 83768045, "body": "yea cant beleve I did&#39;nt see that. Thank you."}], "tags": [], "owner": {"reputation": 13, "user_id": 8557858, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WVRUT.jpg?s=128&g=1", "display_name": "John Brown", "link": "https://stackoverflow.com/users/8557858/john-brown"}, "is_accepted": true, "score": 0, "last_activity_date": 1516654758, "last_edit_date": 1516654758, "creation_date": 1516376218, "answer_id": 48344555, "question_id": 48337174, "link": "https://stackoverflow.com/questions/48337174/control-monad-when-or-the-likes-and-non-io-return-types/48344555#48344555", "title": "Control Monad (when or the likes) and non IO() return types", "body": "<p>I settled on a solution here. I ended up using unsafeLocalState after all seeing as I'm already checking if said value exists, originally with bool but eventually with the maybe monad.</p>\n\n<p>edit: please note I do not want to cast an error here; both cases should print something for logging purposes.</p>\n\n<p>edit2: changing my answer to be in line with what Lee Jan mentioned here, seeing as its a better solution.</p>\n\n<pre><code>mayNotifyDs :: String -&gt; Maybe ByteString -&gt; IO ()\nmayNotifyDs specName details = case details of\n  (Just _) -&gt; post addr (\"dummy\" := details) &gt;&gt;= print\n  Nothing  -&gt; putStrLn \"Message about fail\"\n  where addr = \"http://127.0.0.1:8082/dummydir/\" ++ specName\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8557858, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WVRUT.jpg?s=128&g=1", "display_name": "John Brown", "link": "https://stackoverflow.com/users/8557858/john-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 48344555, "answer_count": 1, "score": 0, "last_activity_date": 1516654758, "creation_date": 1516351778, "last_edit_date": 1516352296, "question_id": 48337174, "link": "https://stackoverflow.com/questions/48337174/control-monad-when-or-the-likes-and-non-io-return-types", "title": "Control Monad (when or the likes) and non IO() return types", "body": "<p>I am trying to use the \"when\" function in my program because I want to have an action preformed if something is true and not if its not true.\nI could also accomplish the same thing by using the Maybe monad but that will clutter the rest of my program up.</p>\n\n<p>The problem is that when expects the return type to be IO() but I want to make it (or my own version) work for IO(Response ByteString)</p>\n\n<p>This is my function code so far:</p>\n\n<pre><code>mayNotifyDs :: Bool -&gt; String -&gt; ByteString -&gt; IO (Response ByteString)\nmayNotifyDs hasRel specName details =\n  when hasRel (post addr (\"dummy\" := details))\n    where addr = \"http://127.0.0.1:8082/dummydir/\" ++ specName\n</code></pre>\n\n<p>edit:\nA \"print\" snuck into the code I originally posted, this was something I experimented with and I have since removed it. I can use print but then I need to also use unsafeLocalState from foreign.marshall, and that's not advisable is it? The code would in this case become the same but with\nwhen hasRel (print $ unsafeLocalState (post addr (\"dummy\" := details)))</p>\n"}, {"tags": ["haskell", "cryptography", "interpolation", "polynomials"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1516366339, "post_id": 48335056, "comment_id": 83668304, "body": "I don&#39;t see anything obviously wrong with your code. My best guess would be that this is some kind of numeric precision problem. Try dumping out intermediate values to see if they are what you expect."}], "answers": [{"tags": [], "owner": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "is_accepted": true, "score": 0, "last_activity_date": 1516521492, "creation_date": 1516521492, "answer_id": 48364806, "question_id": 48335056, "link": "https://stackoverflow.com/questions/48335056/lagrange-interpolation-for-a-schema-based-on-shamirs-secret-sharing/48364806#48364806", "title": "Lagrange Interpolation for a schema based on Shamir&#39;s Secret Sharing", "body": "<p>As MathematicalOrchid said it was a precision problem.</p>\n\n<p>Updated the code to:</p>\n\n<pre><code>f :: (Eq a, Integral a) =&gt; [a] -&gt; a -&gt; Ratio a\nf xs xj = product $ map (p xj) xs\n\np :: (Eq a, Integral a)=&gt; a -&gt; a -&gt; Ratio a\np xj xm = if xj == xm then (1 % 1) else (negate xm) % (xj - xm)\n</code></pre>\n\n<p>And it works as expected.</p>\n"}], "owner": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 48364806, "answer_count": 1, "score": 0, "last_activity_date": 1516521492, "creation_date": 1516341945, "question_id": 48335056, "link": "https://stackoverflow.com/questions/48335056/lagrange-interpolation-for-a-schema-based-on-shamirs-secret-sharing", "title": "Lagrange Interpolation for a schema based on Shamir&#39;s Secret Sharing", "body": "<p>I'm trying to debug an issue with an implementation of a threshold encryption scheme. I've posted <a href=\"https://crypto.stackexchange.com/questions/54790/baek-and-zheng-s-threshold-cryptosystem-limit-on-threshold\">this question</a> on crypto to get some help with the actual scheme but was hoping to get a sanity check on the simplified code I am using.</p>\n\n<p>Essentially the the crypto system uses Shamir's Secret Sharing to combine the shares of a key. The polynomial is each member of the list 'a' multiplied by a increasing power of the parameter of the polynomial. I've left out the mod by prime to simplify the code as the actual implementation uses PBC via a Haskell wrapper.</p>\n\n<p>I have for the polynomial</p>\n\n<pre><code>poly :: [Integer] -&gt; Integer -&gt; Integer\npoly as xi = (f 1 as)\n  where\n    f _ [] = 0\n    f 0 _ = 0\n    f s (a:as) = (a * s) + f (s * xi) as \n</code></pre>\n\n<p>The Lagrange interpolation is:</p>\n\n<pre><code>interp0 :: [(Integer, Integer)] -&gt; Integer\ninterp0 xys = round (sum $ zipWith (*) ys $ fmap (f xs) xs)\n  where\n    xs = map (fromIntegral .fst) xys\n    ys = map (fromIntegral .snd) xys\n\nf :: (Eq a, Fractional a) =&gt; [a] -&gt; a -&gt; a\nf xs xj = product $ map (p xj) xs\n\np :: (Eq a, Fractional a) =&gt; a -&gt; a -&gt; a\np xj xm = if xj == xm then 1 else negate (xm / (xj - xm))\n</code></pre>\n\n<p>and the split and combination code is</p>\n\n<pre><code>execPoly as@(a0:_) = do\n  let xs = zipWith (,) [0..] (fmap (poly as) [0..100])\n  let t = length as + 1\n  let offset = 1\n  let shares = take t (drop offset xs)\n  let sm2 = interp0 shares\n  putText (\"poly and interp over \" &lt;&gt; show as &lt;&gt; \" = \" &lt;&gt; show sm2 &lt;&gt; \". Should be \" &lt;&gt; show a0)\n\nmain :: IO ()\nmain = do\n  execPoly [10,20,30,40,50,60,70,80,90,100,110,120,130,140,150] --1\n  execPoly [10,20,30,40,50,60,70,80] -- 2\n</code></pre>\n\n<p>execPoly(1) fails to combine to 10 but execPoly(2) combines correctly. The magic threshold seems to be 8.</p>\n\n<p>Is my code correct? I am missing something in the implementation that limits the threshold size to 8?</p>\n"}, {"tags": ["json", "haskell", "aeson", "conduit"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516315247, "post_id": 48330690, "comment_id": 83648746, "body": "1) Almost certainly nothing. You need to make the parallelism explicit (Haskell just makes it easier to parallelize your code - it doesn&#39;t do it for you)."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516316348, "post_id": 48330690, "comment_id": 83649134, "body": "Hi @Alec. That&#39;s exactly what I thought as well, but when I look at the process in htop, there are as many child processes as CPUs and each of them seem to be doing something (mostly &quot;S&quot;). That&#39;s what prompted the question. Is it doing parallel GC only (is that a thing?)?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516319288, "post_id": 48330690, "comment_id": 83649950, "body": "Replace <code>.|</code> with <a href=\"https://hackage.haskell.org/package/stm-conduit-3.0.0/docs/Data-Conduit-Async.html#v:buffer-39-\" rel=\"nofollow noreferrer\"><code>buffer&#39;</code></a> and <code>runConduit</code> with <code>runCConduit</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1516366491, "post_id": 48330690, "comment_id": 83668391, "body": "@erewok Parallel GC is definitely a thing. (It even says it right there in your stats!) I&#39;m not 100% sure, but the RTS might be doing some threading for I/O management as well. I doubt much of your actual user code is parallel."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1516387331, "post_id": 48330690, "comment_id": 83681161, "body": "@MathematicalOrchid thanks for explaining that. That&#39;s kind of what I thought might be happening."}], "answers": [{"tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": false, "score": 1, "last_activity_date": 1516829989, "last_edit_date": 1516829989, "creation_date": 1516389768, "answer_id": 48348153, "question_id": 48330690, "link": "https://stackoverflow.com/questions/48330690/haskell-conduit-aeson-parsing-large-jsons-and-filter-matching-key-values/48348153#48348153", "title": "Haskell Conduit Aeson: Parsing Large JSONs and filter matching key/values", "body": "<p>Prompted by Michael Snoyman on Haskell Cafe, who pointed out that my first version was not truly taking advantage of Conduit's streaming capabilities, I rewrote my Conduit version of the application (without using stm-conduit). This was a large improvement: my first Conduit version was operating over all data and I didn't realize this. </p>\n\n<p>I also increased the nursery size and this increased my productivity by doing garbage collection less frequently.</p>\n\n<p>My revised function ended up looking like this:</p>\n\n<pre><code>module Search where\n\nimport           Conduit               ((.|))\nimport qualified Conduit               as C\nimport           Control.Monad\nimport           Control.Monad.IO.Class   (MonadIO, liftIO)\nimport           Control.Monad.Trans.Resource (MonadResource)\nimport qualified Data.ByteString       as B\nimport           Data.List             (isPrefixOf)\nimport           Data.Maybe            (fromJust, isJust)\nimport           System.Path.NameManip (guess_dotdot, absolute_path)\nimport           System.FilePath       (addTrailingPathSeparator, normalise)\nimport           System.Directory      (getHomeDirectory)\n\nimport           Filters\n\n\nsourceFilesFilter :: (MonadResource m, MonadIO m) =&gt; ProjectFilter -&gt; FilePath -&gt; C.ConduitM () String m ()\nsourceFilesFilter projFilter dirname' =\n    C.sourceDirectoryDeep False dirname'\n    .| parseProject projFilter\n\nparseProject :: (MonadResource m, MonadIO m) =&gt; ProjectFilter -&gt; C.ConduitM FilePath String m ()\nparseProject (ProjectFilter filterFunc) = do\n  C.awaitForever go\n  where\n    go path' = do\n      bytes &lt;- liftIO $ B.readFile path'\n      let isProj = validProject bytes\n      when (isJust isProj) $ do\n        let proj' = fromJust isProj\n        when (filterFunc proj') $ C.yield path'\n</code></pre>\n\n<p>My main just runs the conduit and prints those that pass the filter:</p>\n\n<pre><code>mainStreamingConduit :: IO ()\nmainStreamingConduit = do\n  options &lt;- getRecord \"Search JSON Files\"\n  let filterFunc = makeProjectFilter options\n  searchDir &lt;- absolutize (searchPath options)\n  itExists &lt;- doesDirectoryExist searchDir\n  case itExists of\n    False -&gt; putStrLn \"Search Directory does not exist\" &gt;&gt; exitWith (ExitFailure 1)\n    True -&gt; C.runConduitRes $ sourceFilesFilter filterFunc searchDir .| C.mapM_ (liftIO . putStrLn)\n</code></pre>\n\n<p>I run it like this (without the stats, typically):</p>\n\n<pre><code>stack exec search-json -- --searchPath $FILES --name NAME +RTS -s -A32m -n4m\n</code></pre>\n\n<p>Without increasing nursery size, I get a productivity around 30%. With the above, however, it looks like this:</p>\n\n<pre><code>  72,308,248,744 bytes allocated in the heap\n     733,911,752 bytes copied during GC\n       7,410,520 bytes maximum residency (8 sample(s))\n         863,480 bytes maximum slop\n             187 MB total memory in use (27 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       580 colls,   580 par    2.731s   0.772s     0.0013s    0.0105s\n  Gen  1         8 colls,     7 par    0.163s   0.044s     0.0055s    0.0109s\n\n  Parallel GC work balance: 35.12% (serial 0%, perfect 100%)\n\n  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.001s  (  0.006s elapsed)\n  MUT     time   26.155s  ( 31.602s elapsed)\n  GC      time    2.894s  (  0.816s elapsed)\n  EXIT    time   -0.003s  (  0.008s elapsed)\n  Total   time   29.048s  ( 32.432s elapsed)\n\n  Alloc rate    2,764,643,665 bytes per MUT second\n\n  Productivity  90.0% of total user, 97.5% of total elapsed\n\ngc_alloc_block_sync: 3494\nwhitehole_spin: 0\ngen[0].sync: 15527\ngen[1].sync: 177\n</code></pre>\n\n<p>I'd still like to figure out how to parallelize the <code>filterProj . parseJson . readFile</code> part, but for now I'm satisfied with this.</p>\n"}, {"tags": [], "owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "is_accepted": false, "score": 1, "last_activity_date": 1516598110, "creation_date": 1516598110, "answer_id": 48375041, "question_id": 48330690, "link": "https://stackoverflow.com/questions/48330690/haskell-conduit-aeson-parsing-large-jsons-and-filter-matching-key-values/48375041#48375041", "title": "Haskell Conduit Aeson: Parsing Large JSONs and filter matching key/values", "body": "<p>From your program description, there is no reason for it to have increasing memory usage. I think it was accidental memory leak from missed lazy computation. This can be easily detected by heap profiling: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#hp2ps-rendering-heap-profiles-to-postscript\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#hp2ps-rendering-heap-profiles-to-postscript</a>. Other possible reason is that runtime does not release all memory back to OS. Until some threshold, it will keep holding to memory proportional to the largest file processed. This may look as a memory leak if tracked through process RSS size.</p>\n\n<p><code>-A32m</code> option increases nursery size. It lets your program allocate more memory before garbage collection is triggered. Stats shows that very little memory is retained during GC, so less often it happens, more time program spends doing actual work.</p>\n"}, {"tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": true, "score": 1, "last_activity_date": 1519771377, "last_edit_date": 1519771377, "creation_date": 1519684289, "answer_id": 48998162, "question_id": 48330690, "link": "https://stackoverflow.com/questions/48330690/haskell-conduit-aeson-parsing-large-jsons-and-filter-matching-key-values/48998162#48998162", "title": "Haskell Conduit Aeson: Parsing Large JSONs and filter matching key/values", "body": "<p>I figured out how to run this application using <code>stm-conduit</code> with some help from the Haskell wiki on parallelism and a <a href=\"https://stackoverflow.com/questions/30340159/haskell-channels-stm-threaded-message-passing\">Stack Overflow answer</a> that talks about waiting for threads to end before <code>main</code> exits. </p>\n\n<p>The way it works is that I create a channel that holds all of the filenames to be operated on. Then, I fork a bunch of threads that each runs a <code>Conduit</code> with the filepath-channel as a <code>Source</code>. I track all of the child threads and wait for them to finish.</p>\n\n<p>Maybe this solution will be useful for someone else? </p>\n\n<p>Not all of my lower-level filter functions are present, but the gist of it is that I have a <code>Conduit</code> that tests some JSON. If it passes, then it <code>yield</code>s the <code>FilePath</code>. </p>\n\n<p>Here's my main in entirety:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE OverloadedStrings #-}\n\n\nmodule Main where\n\nimport           Conduit                      ((.|))\nimport qualified Conduit                      as C\nimport           Control.Concurrent\nimport           Control.Monad                (forM_)\nimport           Control.Monad.IO.Class       (liftIO)\nimport           Control.Concurrent.STM\nimport           Control.Monad.Trans.Resource (register)\n\nimport qualified Data.Conduit.TMChan          as STMChan\nimport           Data.Maybe                   (isJust, fromJust)\nimport qualified Data.Text                    as T\nimport           Options.Generic\nimport           System.Directory            (doesDirectoryExist)\nimport           System.Exit\n\nimport           Search\n\n\ndata Commands =\n  Commands { searchPath  :: String\n           , par         :: Maybe Int\n           , project     :: Maybe T.Text\n           , revision    :: Maybe T.Text\n           } deriving (Generic, Show)\n\ninstance ParseRecord Commands\n\nmakeProjectFilter :: Commands -&gt; ProjectFilter\nmakeProjectFilter options =\n  let stdFilts = StdProjectFilters\n        (ProjName &lt;$&gt; project options)\n        (Revision &lt;$&gt; revision options)\n  in makeProjectFilters stdFilts\n\nmain :: IO ()\nmain = do\n  options &lt;- getRecord \"Search JSON Files\"\n  -- Would user like to run in parallel?\n  let runner = if isJust $ par options\n        then mainSTMConduit (fromJust $ par options)\n        else mainStreamingConduit\n\n  -- necessary things to search files: search path, filters to use, search dir exists\n  let filterFunc = makeProjectFilter options\n  searchDir &lt;- absolutize (searchPath options)\n  itExists &lt;- doesDirectoryExist searchDir\n\n  -- Run it if it exists\n  case itExists of\n    False -&gt; putStrLn \"Search Directory does not exist\" &gt;&gt; exitWith (ExitFailure 1)\n    True -&gt; runner filterFunc searchDir\n\n-- Single-threaded version with bounded memory usage\nmainStreamingConduit :: ProjectFilter -&gt; FilePath -&gt; IO ()\nmainStreamingConduit filterFunc searchDir = do\n  C.runConduitRes $\n    sourceFilesFilter filterFunc searchDir .| C.mapM_C (liftIO . putStrLn)\n\n-- Multiple-threaded version of this program using channels from `stm-conduit`\nmainSTMConduit :: Int -&gt; ProjectFilter -&gt; FilePath -&gt; IO ()\nmainSTMConduit nrWorkers filterFunc searchDir = do\n  children &lt;- newMVar []\n  inChan &lt;- atomically $ STMChan.newTBMChan 16\n  _ &lt;- forkIO . C.runResourceT $ do\n         _ &lt;- register $ atomically $ STMChan.closeTBMChan inChan\n         C.runConduitRes $ C.sourceDirectoryDeep False searchDir .| STMChan.sinkTBMChan inChan True\n  forM_ [1..nrWorkers] (\\_ -&gt; forkChild children $ runConduitChan inChan filterFunc)\n  waitForChildren children\n  return ()\n\n\nrunConduitChan :: STMChan.TBMChan FilePath -&gt; ProjectFilter -&gt; IO ()\nrunConduitChan inChan filterFunc = do\n  C.runConduitRes $\n       STMChan.sourceTBMChan inChan\n       .| parseProject filterFunc\n       .| C.mapM_C (liftIO . putStrLn)\n\nwaitForChildren :: MVar [MVar ()] -&gt; IO ()\nwaitForChildren children = do\n  cs &lt;- takeMVar children\n  case cs of\n    []   -&gt; return ()\n    m:ms -&gt; do\n      putMVar children ms\n      takeMVar m\n      waitForChildren children\n\nforkChild :: MVar [MVar ()] -&gt; IO () -&gt; IO ThreadId\nforkChild children io = do\n  mvar &lt;- newEmptyMVar\n  childs &lt;- takeMVar children\n  putMVar children (mvar:childs)\n  forkFinally io (\\_ -&gt; putMVar mvar ())\n</code></pre>\n\n<p>Note: I'm using <code>stm-conduit 3.0.0</code> with <code>conduit 1.12.1</code>, which is why I needed to include the boolean argument:</p>\n\n<pre><code>STMChan.sinkTBMChan inChan True\n</code></pre>\n\n<p>In version <code>4.0.0</code> of <code>stm-conduit</code>, this function automatically closes the channel, so the boolean argument has been removed.</p>\n"}], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 1, "accepted_answer_id": 48998162, "answer_count": 3, "score": 3, "last_activity_date": 1519771377, "creation_date": 1516311316, "last_edit_date": 1519684690, "question_id": 48330690, "link": "https://stackoverflow.com/questions/48330690/haskell-conduit-aeson-parsing-large-jsons-and-filter-matching-key-values", "title": "Haskell Conduit Aeson: Parsing Large JSONs and filter matching key/values", "body": "<p>I have written an application in Haskell that does the following:</p>\n\n<ol>\n<li>Recursively list a directory,</li>\n<li>Parse the JSON files from the directory list,</li>\n<li>Look for matching key-value pairs, and</li>\n<li>Return filenames where matches have been found.</li>\n</ol>\n\n<p>My first version of this application was the simplest, naive version I could write, but I noticed that space usage seemed to increase monotonically.</p>\n\n<p>As a result, I switched to <code>conduit</code>, and now my primary functionality looks like this:</p>\n\n<pre><code>conduitFilesFilter :: ProjectFilter -&gt; Path Abs Dir -&gt; IO [Path Abs File]\nconduitFilesFilter projFilter dirname' = do\n  (_, allFiles) &lt;- listDirRecur dirname'\n  C.runConduit $\n    C.yieldMany allFiles\n    .| C.filterMC (filterMatchingFile projFilter)\n    .| C.sinkList\n</code></pre>\n\n<p>Now my application has bounded memory usage but it's still quite slow. Out of this, I have two questions.</p>\n\n<p><strong>1)</strong></p>\n\n<p>I used <code>stack new</code> to generate the skeleton to create this application and it by default uses the ghc options <code>-threaded -rtsopts -with-rtsopts=-N</code>.</p>\n\n<p>The surprising thing (to me) is that the application uses all processors available to it (about 40 in the target machine) when I actually go to run it. However, I didn't write any part of the application to be run in parallel (I considered it, actually). </p>\n\n<p>What's running in parallel?</p>\n\n<p><strong>2)</strong> </p>\n\n<p>Additionally, most of the JSON files are really large (10mb) and there are probably 500k of them to be traversed. This means my program is very slow as a result of all the Aeson-decoding. My idea was to run my <code>filterMatchingFile</code> part in parallel, but looking at the <code>stm-conduit</code> library, I can't see an obvious way to run this middle action in parallel across a handful of processors.</p>\n\n<p>Can anyone suggest a way to smartly parallelize my function above using <code>stm-conduit</code> or some other means?</p>\n\n<hr>\n\n<p><strong>Edit</strong></p>\n\n<p>I realized that I could break up my <code>readFile -&gt; decodeObject -&gt; runFilterFunction</code> into separate parts of the <code>conduit</code> and then I could use <code>stm-conduit</code> there with a bounded channel. Maybe I'll give it a shot...</p>\n\n<hr>\n\n<p>I ran my application with <code>+RTS -s</code> (I reconfigured it to <code>-N4</code>) and I see the following:</p>\n\n<pre><code> 115,961,554,600 bytes allocated in the heap\n  35,870,639,768 bytes copied during GC\n      56,467,720 bytes maximum residency (681 sample(s))\n       1,283,008 bytes maximum slop\n             145 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     108716 colls, 108716 par   76.915s  20.571s     0.0002s    0.0266s\n  Gen  1       681 colls,   680 par    0.530s   0.147s     0.0002s    0.0009s\n\n  Parallel GC work balance: 14.99% (serial 0%, perfect 100%)\n\n  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.001s  (  0.007s elapsed)\n  MUT     time   34.813s  ( 42.938s elapsed)\n  GC      time   77.445s  ( 20.718s elapsed)\n  EXIT    time    0.000s  (  0.010s elapsed)\n  Total   time  112.260s  ( 63.672s elapsed)\n\n  Alloc rate    3,330,960,996 bytes per MUT second\n\n  Productivity  31.0% of total user, 67.5% of total elapsed\n\ngc_alloc_block_sync: 188614\nwhitehole_spin: 0\ngen[0].sync: 33\ngen[1].sync: 811204\n</code></pre>\n"}, {"tags": ["haskell", "numbers"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1516293035, "post_id": 48325943, "comment_id": 83637454, "body": "What do you mean by \u201cfrom GHCi input one pair of numbers\u201d? From what <i>source</i>? If you&#39;re in GHCi, why don&#39;t you just <i>define</i> those variables with <code>let</code>? And, how is this problem specific to <i>numbers</i>?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9235957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f60e561deb82a87cd0d438dda43b1da?s=128&d=identicon&r=PG&f=1", "display_name": "Nikola Kranjcic", "link": "https://stackoverflow.com/users/9235957/nikola-kranjcic"}, "edited": false, "score": 0, "creation_date": 1516294696, "post_id": 48326298, "comment_id": 83638484, "body": "Hi, the task I&#39;m trying to do is to convert geodetic coordinates to plate coordinates. Equations are quite long, so the end user of script can&#39;t write them down so easily and directly in GHCI. The code should be written in file, which is then compiled. User is asked to write pair of geodetic coordinates and the result is pair of plate coordinates. Example of input in decimal degrees (46.0010, 15.2300) and output (480394.43, 5123454.21). Something as on [link] <a href=\"http://www.navipedia.net/index.php/Ellipsoidal_and_Cartesian_Coordinates_Conversion\" rel=\"nofollow noreferrer\">navipedia.net/index.php/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 9235957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f60e561deb82a87cd0d438dda43b1da?s=128&d=identicon&r=PG&f=1", "display_name": "Nikola Kranjcic", "link": "https://stackoverflow.com/users/9235957/nikola-kranjcic"}, "edited": false, "score": 1, "creation_date": 1516294919, "post_id": 48326298, "comment_id": 83638608, "body": "@NikolaKranjcic I encourage you to open a fresh question with that description of your goals, some details about what you have tried to make that work, and what went wrong with your attempt."}, {"owner": {"reputation": 1, "user_id": 9235957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f60e561deb82a87cd0d438dda43b1da?s=128&d=identicon&r=PG&f=1", "display_name": "Nikola Kranjcic", "link": "https://stackoverflow.com/users/9235957/nikola-kranjcic"}, "edited": false, "score": 0, "creation_date": 1516295011, "post_id": 48326298, "comment_id": 83638662, "body": "Thank you, I will open a new question. :)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1516293817, "creation_date": 1516293817, "answer_id": 48326298, "question_id": 48325943, "link": "https://stackoverflow.com/questions/48325943/haskell-number-input-and-output/48326298#48326298", "title": "Haskell number input and output", "body": "<p>Here is a sample ghci session:</p>\n\n<pre><code>&gt; a = 3\n&gt; b = 4\n&gt; (b**2 + a**3 - sin b, a - b)\n(43.75680249530793,-1)\n</code></pre>\n\n<p>If this does not meet your needs, you will need to be more specific about your needs (preferably in a fresh question that refers to this one and explains why the new question is different from this one).</p>\n"}], "owner": {"reputation": 1, "user_id": 9235957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f60e561deb82a87cd0d438dda43b1da?s=128&d=identicon&r=PG&f=1", "display_name": "Nikola Kranjcic", "link": "https://stackoverflow.com/users/9235957/nikola-kranjcic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1516296734, "answer_count": 1, "score": -1, "last_activity_date": 1516293817, "creation_date": 1516292757, "question_id": 48325943, "link": "https://stackoverflow.com/questions/48325943/haskell-number-input-and-output", "closed_reason": "Needs details or clarity", "title": "Haskell number input and output", "body": "<p>I am trying to code something in Haskell and can't find a breakthrough. What I'm trying to do, is from GHCi input one pair of numbers, do some equations with them and print out results. Let say the input is (a,b). Equations could be as simple as c = b **2 + a **3 - sin b and d = a - b \nThe output should be (c,d). Is it possible to do it and how. </p>\n"}, {"tags": ["sqlite", "haskell", "authentication", "yesod", "haskell-persistent"], "comments": [{"owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1516291997, "post_id": 48325208, "comment_id": 83636762, "body": "Seems the <code>do</code> block inside <code>lookupUser</code> is running inside of <code>Maybe</code> but <code>runSqlite</code> returns something in <code>IO</code>. Not sure <i>how</i>, but you&#39;ll need to deal with that IO somehow. You can see that your <code>do</code> is in <code>Maybe</code> because of the return type of that function."}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1516293095, "post_id": 48325208, "comment_id": 83637498, "body": "I am generally a bit confused about monads, I added the type signatures of runSqlite and selectFirst in my post. I don&#39;t understand where that IO is coming from and why the compiler tells me about a double Maybe."}, {"owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1516294887, "post_id": 48325208, "comment_id": 83638588, "body": "Would you mind adding the code where you call lookupUser? Like the function and it&#39;s type"}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1516295007, "post_id": 48325208, "comment_id": 83638658, "body": "You can see it here: <a href=\"https://ilikewhenit.works/blog/4\" rel=\"nofollow noreferrer\">ilikewhenit.works/blog/4</a> I didn&#39;t alter the code from this tutorial except naming."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516317185, "post_id": 48325208, "comment_id": 83649368, "body": "<code>runSqlite &quot;db.sqlite3&quot; ...</code> has type <code>IO X</code> for some <code>X</code> but you are claiming it has type <code>Maybe X</code> due to the type signature you&#39;ve given to <code>lookupUser</code>. This seems pretty clear to me (&quot;Couldn&#39;t match type \u2018Maybe\u2019 with \u2018IO\u2019&quot;). I&#39;m guessing you want <code>Text -&gt; IO (Maybe Owner)</code> or maybe even <code>Text -&gt; MaybeT IO Owner</code> (but if you don&#39;t understand this latter type, don&#39;t use it)."}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516317746, "post_id": 48325208, "comment_id": 83649545, "body": "@user2407038 but removing the type signature doesn&#39;t change anything about the error message. Can you tell me what to change to get <code>Text -&gt; Maybe Owner</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1516317888, "post_id": 48325208, "comment_id": 83649586, "body": "@Benjoyo You can&#39;t get this type. <code>runSqlite</code> performs IO (which is reflected in its type) but the type <code>Text -&gt; Maybe Owner</code> promises to be a pure function. Perhaps you should elaborate why you feel this function should have precisely the type <code>Text -&gt; Maybe Owner</code>."}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516318350, "post_id": 48325208, "comment_id": 83649701, "body": "@user2407038 because this is the way it is embedded in the auth code in the article I posted above. I need some way to replace this purely functional default behavior with a database access."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516318591, "post_id": 48325208, "comment_id": 83649761, "body": "@Benjoyo Your function is used in e.g. <a href=\"https://hackage.haskell.org/package/yesod-auth-1.4.21/docs/Yesod-Auth.html#t:YesodAuth\" rel=\"nofollow noreferrer\"><code>authenticate</code></a>. If you look at the type of <code>authenticate</code> you&#39;ll find you can do IO inside of it; therefore there is no barrier to calling a function of type <code>Text -&gt; IO (Maybe Owner)</code> from <code>authenticate</code>."}, {"owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516322859, "post_id": 48325208, "comment_id": 83650784, "body": "@user2407038 thank you very much, this got me on the right path!"}], "owner": {"reputation": 343, "user_id": 4260896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/30c818bacde77f942af6432861a53783?s=128&d=identicon&r=PG&f=1", "display_name": "Benjoyo", "link": "https://stackoverflow.com/users/4260896/benjoyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1516292956, "creation_date": 1516290515, "last_edit_date": 1516292956, "question_id": 48325208, "link": "https://stackoverflow.com/questions/48325208/yesod-hardcoded-auth-with-database-access", "title": "Yesod Hardcoded Auth with database access", "body": "<p>I implemented a Yesod auth system like described <a href=\"https://ilikewhenit.works/blog/4\" rel=\"nofollow noreferrer\">here</a>, which works fine by looking up username and passwords hardcoded in a list. </p>\n\n<p>I now try to modify this behavior to lookup usernames and passwords in the database by modifying the <em>lookupUser</em> and <em>validPassword</em> functions. For starters, only <em>lookupUser</em>:</p>\n\n<pre><code>lookupUser :: Text -&gt; Maybe Owner\nlookupUser username = do \n    x &lt;- runSqlite \"db.sqlite3\" . asSqlBackendReader $ selectFirst [ElementOwnerId ==. username] []\n    case x of\n        Nothing -&gt; Nothing\n        Just (Entity k v) -&gt; Just $ Owner username (elementOwnerPw v)\n\nasSqlBackendReader :: ReaderT SqlBackend m a -&gt; ReaderT SqlBackend m a\nasSqlBackendReader = id\n</code></pre>\n\n<p>But I get the following error which I do not understand:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Maybe\u2019 with \u2018IO\u2019\n        arising from a functional dependency between:\n          constraint \u2018MonadBaseControl IO Maybe\u2019\n            arising from a use of \u2018runSqlite\u2019\n          instance \u2018MonadBaseControl Maybe Maybe\u2019 at &lt;no location info&gt;\n    \u2022 In the first argument of \u2018(.)\u2019, namely \u2018runSqlite \"db.sqlite3\"\u2019\n      In the expression: runSqlite \"db.sqlite3\" . asSqlBackendReader\n      In a stmt of a 'do' block:\n        x &lt;- runSqlite \"db.sqlite3\" . asSqlBackendReader\n               $ selectFirst [ElementOwnerId ==. username] []\n    |\n238 |     x &lt;- runSqlite \"db.sqlite3\" . asSqlBackendReader $ selectFirst [ElementOwnerId ==. username] []\n    |          ^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Signatures of <em>runSqlite</em> and <em>selectFirst</em>:</p>\n\n<pre><code>runSqlite :: MonadCatchIO m =&gt; SqliteReader m a -&gt; Pool Connection -&gt; m a\n\nselectFirst :: (PersistEntity val, PersistEntityBackend val ~ b) =&gt; [Filter val] -&gt; [SelectOpt val] -&gt; b m (Maybe (Entity val))\n</code></pre>\n"}, {"tags": ["haskell", "records"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1516290222, "post_id": 48324939, "comment_id": 83635516, "body": "What would the resulting type be?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1516290557, "post_id": 48324939, "comment_id": 83635758, "body": "Do you just want the field names? Or the values from the record?"}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516290737, "post_id": 48324939, "comment_id": 83635902, "body": "@chi the resulting type would always be the same. So The resulting type is I guess a list of maps? [{field_name = Maybe [Int]} ...]. jkeuhlen I would need both the field name and the values."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 4, "creation_date": 1516290739, "post_id": 48324939, "comment_id": 83635903, "body": "I&#39;m not an expert on the subject, but this sounds like a job for <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"nofollow noreferrer\">Template Haskell</a>, provided you know the suffix at compile-time."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1516292267, "post_id": 48324939, "comment_id": 83636957, "body": "Definitely a template haskell or generic programming problem. Related question: <a href=\"https://stackoverflow.com/questions/36369414/how-to-generically-extract-field-names-and-values-in-haskell-records\" title=\"how to generically extract field names and values in haskell records\">stackoverflow.com/questions/36369414/&hellip;</a>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1516299355, "post_id": 48324939, "comment_id": 83641127, "body": "How is it possible that you don&#39;t know the field names, but you do know the type of the input record (i.e., Record)?"}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "edited": false, "score": 0, "creation_date": 1516301618, "post_id": 48324939, "comment_id": 83642348, "body": "I actually know the field names. This process is simply to be able to write less code or to be able to combine functionality for multiple fields. But instead of doing record syntax to lookup each field which takes more lines of code I could combine it by getting all fields that end with ids and iterate through them. Maybe it&#39;s a overkill I guess I will see. But the fields I&#39;m looking for are always a list of Maybe [Int]. These are id relations to other models in a database if it makes any sense"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1516315835, "post_id": 48324939, "comment_id": 83648959, "body": "@Donna Why do you want to do this? What is the actual problem you&#39;re trying to solve? I suspect this may be an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. You mentioned that the <code>Maybe [Int]</code>s are foreign key references: I can&#39;t think of any scenario in which you&#39;d want to treat different foreign keys in a uniform way. They may be represented in the same way but they don&#39;t mean the same thing."}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1516322319, "post_id": 48324939, "comment_id": 83650671, "body": "@BenjaminHodgson I updated the initial post since I was not very clear about what I was trying to achieve"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1516378911, "post_id": 48331899, "comment_id": 83676364, "body": "I agree, for a small number of field accessor, simple hard-coding is the most sensible approach. If it&#39;s more than a handful of these <code>_id</code> fields then I daresay the type was designed too monolithic in the first place and should better just have a single e.g. <code>all_ids :: Map String [Int]</code> field."}, {"owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516457137, "post_id": 48331899, "comment_id": 83700630, "body": "@leftaroundabout true. This is the approach I ended up with since I usually have under 10 fields with _ids. The thing is that this has to fit into the traditional HTML form approach, where you have a field for category_ids, a field for tag_ids etc. It would be possible to put them all together but I suspect it would require some work on the Javascript side which I&#39;m trying to avoid."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1516317745, "creation_date": 1516317745, "answer_id": 48331899, "question_id": 48324939, "link": "https://stackoverflow.com/questions/48324939/dynamic-field-lookup-with-records-in-haskell/48331899#48331899", "title": "Dynamic field lookup with records in Haskell", "body": "<p>Given that you actually do know all of the field names, and they are all of the same type, it should be quite a small amount of work to simply write each of the field names once, and much simpler than writing a big generic Template Haskell solution that would work for any data type.</p>\n\n<p>A simple example:</p>\n\n<pre><code>idGetters :: [(String, Record -&gt; Maybe [Int])]\nidGetters = [(\"field2_ids\", field2_ids), \n             (\"field3_ids\", field3_ids)]\n\nids :: Record -&gt; [(String, Maybe [Int])]\nids r = fmap (fmap ($ r)) idGetters\n</code></pre>\n\n<p>It looks a bit ugly, but that's simply the best way to work with the data structure you're presupposing.</p>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 6, "last_activity_date": 1516391132, "creation_date": 1516391132, "answer_id": 48348466, "question_id": 48324939, "link": "https://stackoverflow.com/questions/48324939/dynamic-field-lookup-with-records-in-haskell/48348466#48348466", "title": "Dynamic field lookup with records in Haskell", "body": "<p>I\u2019ve come up with a complicated solution using <code>GHC.Generics</code> that seems to work. I\u2019ve generalized the problem somewhat, writing a function with the following type signature:</p>\n\n<pre><code>fieldsDict :: (Generic a, GFieldsDict (Rep a) t) =&gt; a -&gt; M.Map String t\n</code></pre>\n\n<p>Specifically, this takes a value of type <code>a</code>, which much be a record, and it produces a mapping from field names to values of type <code>t</code>. Fields that have a type other than <code>t</code> are ignored.</p>\n\n<h2>Usage example</h2>\n\n<p>First, an example of what it <em>does</em>. Here\u2019s your <code>Record</code> type from your question, along with a sample value:</p>\n\n<pre><code>data Record = Record\n  { field :: String\n  , field2_ids :: Maybe [Int]\n  , field3_ids :: Maybe [Int]\n  } deriving (Generic, Show)\n\nexampleRecord :: Record\nexampleRecord = Record\n  { field = \"a\"\n  , field2_ids = Just [1, 2]\n  , field3_ids = Just [3, 4] }\n</code></pre>\n\n<p>Using <code>fieldsDict</code>, it\u2019s possible to get all the fields of type <code>Maybe [Int]</code>:</p>\n\n<pre><code>ghci&gt; fields exampleRecord :: M.Map String (Maybe [Int])\nfromList [(\"field2_ids\",Just [1,2]),(\"field3_ids\",Just [3,4])]\n</code></pre>\n\n<p>To restrict the result to fields that end in <code>_ids</code>, you can just filter the resulting map by its keys, which is left as an exercise to the reader.</p>\n\n<h2>Implementation</h2>\n\n<p>I\u2019ll be up-front: the implementation is not pretty. <code>GHC.Generics</code> is not my favorite API, but at least it\u2019s possible. Before we begin, we\u2019ll need some GHC extensions:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n</code></pre>\n\n<p>We\u2019ll also need some imports:</p>\n\n<pre><code>import qualified Data.Map as M\n\nimport Data.Proxy\nimport GHC.Generics\nimport GHC.TypeLits\n</code></pre>\n\n<p>The hardest part of making this work is being able to analyze which fields are of the desired type. To help with this, we need a way to \u201ccast\u201d <code>GHC.Generics</code> type representations, which we\u2019ll represent with a separate class:</p>\n\n<pre><code>class GCast f g where\n  gCast :: f p -&gt; Maybe (g p)\n</code></pre>\n\n<p>Unfortunately, implementing this is hard, since we need to perform case analysis on <code>f</code> to see if it\u2019s the same type as <code>g</code>, and if it isn\u2019t, product <code>Nothing</code>. If we perform a na\u00efve translation of that idea to typeclasses, we\u2019ll end up with overlapping instances. To mitigate this problem, we can use a trick using closed type families:</p>\n\n<pre><code>type family TyEq f g where\n  TyEq f f = 'True\n  TyEq f g = 'False\n\ninstance (TyEq f g ~ flag, GCast' flag f g) =&gt; GCast f g where\n  gCast = gCast' (Proxy :: Proxy flag)\n\nclass GCast' (flag :: Bool) f g where\n  gCast' :: Proxy flag -&gt; f p -&gt; Maybe (g p)\n\ninstance GCast' 'True f f where\n  gCast' _ = Just\n\ninstance GCast' 'False f g where\n  gCast' _ _ = Nothing\n</code></pre>\n\n<p>Note that this means the <code>GCast</code> class only has a single instance, but it\u2019s still useful to keep <code>gCast</code> as a class method instead of a free-floating function so that we can use <code>GCast</code> as a constraint later.</p>\n\n<p>Next, we\u2019ll write a class that will actually analyze the <code>GHC.Generics</code> representation of our record type:</p>\n\n<pre><code>class GFieldsDict f t where\n  gFieldsDict :: f p -&gt; M.Map String t\n</code></pre>\n\n<p>This allows us to define our <code>fieldsDict</code> function from earlier:</p>\n\n<pre><code>fieldsDict :: (Generic a, GFieldsDict (Rep a) t) =&gt; a -&gt; M.Map String t\nfieldsDict = gFieldsDict . from\n</code></pre>\n\n<p>Now we just need to implement the instances of <code>GFieldsDict</code>. To inform those instances, we can look at the expanded representation of <code>Rep Record</code>:</p>\n\n<pre><code>ghci&gt; :kind! Rep Record\nRep Record :: GHC.Types.* -&gt; *\n= D1\n    ('MetaData \"Record\" \"FieldsDict\" \"main\" 'False)\n    (C1\n       ('MetaCons \"Record\" 'PrefixI 'True)\n       (S1\n          ('MetaSel\n             ('Just \"field\")\n             'NoSourceUnpackedness\n             'NoSourceStrictness\n             'DecidedLazy)\n          (Rec0 String)\n        :*: (S1\n               ('MetaSel\n                  ('Just \"field2_ids\")\n                  'NoSourceUnpackedness\n                  'NoSourceStrictness\n                  'DecidedLazy)\n               (Rec0 (Maybe [Int]))\n             :*: S1\n                   ('MetaSel\n                      ('Just \"field3_ids\")\n                      'NoSourceUnpackedness\n                      'NoSourceStrictness\n                      'DecidedLazy)\n                   (Rec0 (Maybe [Int])))))\n</code></pre>\n\n<p>Looking at this, we\u2019ll need instances to drill down through <code>D1</code>, <code>C1</code>, and <code>:*:</code> before we get at the actual fields. These instances are fairly simple to write, since they just defer to more nested parts of the type representation:</p>\n\n<pre><code>instance GFieldsDict f t =&gt; GFieldsDict (D1 md (C1 mc f)) t where\n  gFieldsDict (M1 (M1 rep)) = gFieldsDict rep\n\ninstance (GFieldsDict f t, GFieldsDict g t) =&gt; GFieldsDict (f :*: g) t where\n  gFieldsDict (f :*: g) = M.union (gFieldsDict f) (gFieldsDict g)\n</code></pre>\n\n<p>The actual functionality will go in an instance on <code>S1</code>, since each <code>S1</code> type corresponds to the individual record fields. This instance will use our <code>GCast</code> class from earlier:</p>\n\n<pre><code>instance (KnownSymbol name, GCast f (Rec0 t)) =&gt; GFieldsDict (S1 ('MetaSel ('Just name) su ss ds) f) t where\n  gFieldsDict (M1 (rep :: f p)) = case gCast rep :: Maybe (Rec0 t p) of\n    Just (K1 v) -&gt; M.singleton (symbolVal (Proxy :: Proxy name)) v\n    Nothing -&gt; M.empty\n</code></pre>\n\n<p>\u2026and that\u2019s it. Is this complexity worth it? Probably not, unless you can hide it in a library somwehere, but this demonstrates that it\u2019s possible.</p>\n"}], "owner": {"reputation": 638, "user_id": 1282131, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04820c569f756ac67a090d713c3a83e9?s=128&d=identicon&r=PG", "display_name": "Donna", "link": "https://stackoverflow.com/users/1282131/donna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 2, "accepted_answer_id": 48331899, "answer_count": 2, "score": 6, "last_activity_date": 1516391132, "creation_date": 1516289653, "last_edit_date": 1516322279, "question_id": 48324939, "link": "https://stackoverflow.com/questions/48324939/dynamic-field-lookup-with-records-in-haskell", "title": "Dynamic field lookup with records in Haskell", "body": "<p>I'm wondering if it's possible to get all fields of a record in Haskell that end with a certain name. For example</p>\n\n<pre><code>data Record = Record {\n    field       :: String\n    field2_ids  :: Maybe [Int]\n    field3_ids  :: Maybe [Int]\n}\n</code></pre>\n\n<p>In this case I would like to get a list of fields ending with \"ids\". I don't know their names. I only know that they end with \"ids\"\nWhat I need is both the field name and the value it contains. So I guess this would be a list of maps</p>\n\n<pre><code>[{field2_ids = Maybe [Int]}, {fields3_ids = Maybe [Int]}...]\n</code></pre>\n\n<p>or even a list of tuples</p>\n\n<pre><code>[(\"field2_ids\", Maybe [Int])...]\n</code></pre>\n\n<p>By the way, in my case the fields I'm extracting will always have the type of <code>Maybe [Int]</code>.</p>\n\n<p>Is this possible? I suspect that it's not possibly with vanilla record syntax but is this maybe something that could be achieved with lenses?</p>\n\n<p>UPDATE</p>\n\n<p>I understand my question is causing some confusion in terms of what I'm actually trying to do. So I will explain</p>\n\n<p>I'm using a microservice pattern with Services. Each Service is tied to a single data model. For example a Blog Service would contain a single Blog model. But the Blog Service can have all kinds of relations. For example it can have a relation to a Category Service. It can also have a relation to a Tag Service. Since there is a possibility of having more than one relation with another Service I have the type of a <code>Maybe [Int]</code> since I could be posting a Blog with <code>Just [Int]</code> or <code>Nothing</code>, no relations at all. Each Service handles its relations by registering them in a Relation table.</p>\n\n<p>So to create a new Blog Post I need a data structure like this one in Servant</p>\n\n<pre><code>data BlogPostRequest = BlogPostRequest {\n    title :: String,\n    published :: DateTime,\n    public :: Bool,\n    category_ids :: Maybe [Int],\n    tag_ids :: Maybe [Int]\n}\n</code></pre>\n\n<p>The endpoint will take all the fields related to the Blog model and store it as a new Blog instance. It will then take all the relations if present in category_ids and tag_ids and store it in the Relation table.</p>\n\n<p>My only concern about this, using the traditional record syntax is that if I have multiple relations, the code will get very bloated. Services are generated from config files. So yes I do actually know all the names of the fields from start. I'm sorry my statement about this before was very confusing. My point was that if I could pull the fields out of the record just by knowing that their names end with _ids I could reduce a lot of the code.</p>\n\n<p>This would be the vanilla record syntax approach. Imagine that storeRelation is a method which takes a <code>String</code> and a <code>Maybe [Int]</code> and handles storing the relation accordingly</p>\n\n<pre><code>createNewBlogPost post = \n    storeRelation \"category\" (category_ids post)\n    storeRelation \"tag\"      (tag_ids post)\n    -- continue with rest of relations\n</code></pre>\n\n<p>This approach might not be so bad in the end. I would just add a new line for each relation. I was just wondering if there was a straight forward way to extract fields from records so that I could have the function like this</p>\n\n<pre><code>createNewBlogPost post = \n    storRelation $ extractRelations post\n</code></pre>\n\n<p>where storeRelation now takes a list of tuples and extractRelations is a function which extracts the fields ending with _ids</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1516271893, "post_id": 48319069, "comment_id": 83623821, "body": "I think you try to do too much in one function, and furthermore it is very imperatively written."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1516272627, "post_id": 48319069, "comment_id": 83624300, "body": "Date and time arithmetic is notoriously difficult to get right (in any language). Have you considered using Haskell&#39;s <a href=\"https://hackage.haskell.org/package/time\" rel=\"nofollow noreferrer\">built-in functions and data types</a> for this purpose?"}, {"owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516273023, "post_id": 48319069, "comment_id": 83624551, "body": "@WillemVanOnsem i&#39;m told to do like this only."}, {"owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516273044, "post_id": 48319069, "comment_id": 83624562, "body": "@MarkSeemann cant use those"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516273380, "post_id": 48319069, "comment_id": 83624781, "body": "Why not? It&#39;s part of GHC&#39;s base library."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516273493, "post_id": 48319069, "comment_id": 83624845, "body": "I honestly can not imagine that you should do it like that, since it is very <i>un</i>-Haskell to write functions like that."}, {"owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516273579, "post_id": 48319069, "comment_id": 83624888, "body": "@WillemVanOnsem how do u suggest i should go about?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516273695, "post_id": 48319069, "comment_id": 83624961, "body": "@AlexiaDesouza: well for instance you write the entire condition to check if a year is a leap year, you can separate that in a new function <code>isLeapYear</code>, then you can construct a function <code>getDaysOfMonth</code> that uses the <code>isLeapYear</code>, etc. and so build up the function based on other functions."}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1516285914, "post_id": 48319069, "comment_id": 83632554, "body": "@AlexiaDesouza - this may be horrible from a performance perspective, but you might simplify your problem (and the way you are thinking about it) if you figured out how to get the date of the next day, and then you could simply call this recursively until you get to n = 0."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1516309038, "post_id": 48319069, "comment_id": 83646084, "body": "Might be simpler just to convert the dates into a serial number, do your operations with simple addition/subtraction on the serial number and convert back to date."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 3, "last_activity_date": 1564085002, "last_edit_date": 1564085002, "creation_date": 1516287754, "answer_id": 48324278, "question_id": 48319069, "link": "https://stackoverflow.com/questions/48319069/date-arithmetic/48324278#48324278", "title": "Date Arithmetic", "body": "<p>Here\u2019s a sketch of how to solve the problem. We will stick to the Gregorian calendar (so things like when a leap year is and what the months are are fixed).</p>\n\n<p>We need a datatype for dates. </p>\n\n<pre><code>data Date = Date {year :: Int, month :: Int, day :: Int }\n</code></pre>\n\n<p>You could use smaller types for month and day but I don\u2019t see a good reason to limit years. You could also use a month type which has variants for January, February etc. We will number months from 1 to 12.</p>\n\n<p>How many days are in a year?</p>\n\n<pre><code>leapYear n = n `mod` 4 == 0 &amp;&amp; (n `mod` 100 /= 0 || n `mod` 400 == 0)\nyearLength n = if leapYear n then 366 else 365\n</code></pre>\n\n<p>How many days are in a month?</p>\n\n<pre><code>monthLength year month = months !! month where\n  months = if leapYear year then months2 else months1\n  months1 = [31,28,31,30,31,30,31,31,30,31,30,31]\n  months2 = [31,29,31,30,31,30,31,31,30,31,30,31]\n</code></pre>\n\n<p>Now how do we add some days to a date?\nFirst we work out how many years to move on. Then how many months. Then how many days. So we want to know how many days are left in a month or year.</p>\n\n<pre><code>leftInMonth (Date year month day) = monthLength year month - day + 1\ndaysSinceYearBegan (Date year month day) = previousMonths + day - 1 where\n previousMonths = sum [monthLength m | m &lt;- [1..month - 1]]\nleftInYear date = yearLength (year date) - daysSinceYearBegan date\n</code></pre>\n\n<p>Now to add days:</p>\n\n<pre><code>addDays date 0 = date\naddDays (Date year 1 1) days\n  | days &lt; 0 = undefined\n  | days &gt;= yearLength year = addDays (Date (year+1) 1 1) (days - yearLength year)\naddDays d@(Date year month day) days\n  | days &lt; 0 = undefined\n  | days &gt;= leftInYear d = addDays (Date (year+1) 1 1) (days - leftInYear d)\n  | days &gt;= leftInMonth year month = addDays (if month == 12 then Date (year+1) 1 1) else Date year (month+1) 1) (days - leftInMonth year month)\n  | otherwise = Date year month (day + days)\n</code></pre>\n\n<p>I\u2019m not sure that works perfectly but should give you something more reasonable to work from</p>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 48324278, "answer_count": 1, "score": 2, "last_activity_date": 1564085002, "creation_date": 1516271365, "last_edit_date": 1517857457, "question_id": 48319069, "link": "https://stackoverflow.com/questions/48319069/date-arithmetic", "title": "Date Arithmetic", "body": "<pre><code>addDays :: (Int,Int,Int) -&gt; Int -&gt; (Int,Int,Int)\naddDays (dd,mm,yy) daystoadd =\n    let yearType =  if((yy `mod` 4 ==0) &amp;&amp; ((yy `mod` 100 /=0)||(yy `mod` 400 ==0)))\n                        then [31,29,31,30,31,30,31,31,30,31,30,31]\n                    else [31,28,31,30,31,30,31,31,30,31,30,31]\n        sumYear = (sum yearType)\n        daysGone =sum ( (take (mm-1) ) yearType ) + dd\n        totalDays = daysGone   + daystoadd\n        yearsOverflow = totalDays `div` sumYear                                                  \n        totalDays1 = totalDays `mod` sumYear\n\n\n    year = yy+yearsOverflow\n    monthsGone =last ( takeWhile (\\x -&gt; sum x &lt;=totalDays1) ((inits(yearType) ) ) )\n\n\n    daysofMonth = if (totalDays1 - (sum monthsGone) == 0) \n                        then ( yearType!!(mm-1) ) \n                  else if (totalDays1 &lt;= (yearType!!(mm-1)) )                  \n                        then totalDays1 \n                  else (totalDays1 - (sum monthsGone) )\n\n    noofMonths = if (monthsGone/= [])\n                    then if ( ((length monthsGone) )&gt;12) \n                            then ((length monthsGone)+1-12 ) \n                        else if( (last monthsGone) == daysofMonth )\n                            then ( (length monthsGone) )                                                                                                                                                                                           --then ( (length monthsGone)+2 )\n                        else ( (length monthsGone)+1 )                               \n                 else  (length monthsGone) +1                                                 \n\nin (daysofMonth,noofMonths, year)\n</code></pre>\n\n<p>I have written this function to add number of days to a date. But if i want to add 400 days from 1st may 2000, whenever it crosses 31st dec it uses the same months of leap year. How to use the non leap year months again?</p>\n\n<p>Another problem I'm facing is the months with 30 days there month changes to next month on the last day of the month.</p>\n\n<p>Any suggestions?</p>\n\n<p>the way Dan Robertson explained \ni did this </p>\n\n<pre><code>import Data.List\n\n\n\nisLeapYear :: Int -&gt; Bool\nisLeapYear x = ((x `mod` 4 ==0) &amp;&amp; ((x `mod` 100 /=0)||(x `mod` 400 ==0)))\n\n\n\nyearLength :: Int -&gt; Int\nyearLength n = if (isLeapYear n) then 366 else 365\n\n\nmonthLength :: Int -&gt; Int -&gt; [Int]\nmonthLength mm yy =  \nlet months = if isLeapYear yy \n                then  [31,29,31,30,31,30,31,31,30,31,30,31]\n            else [31,28,31,30,31,30,31,31,30,31,30,31]\nin months\n\n\nleftInMonth :: (Int,Int,Int) -&gt; Int\nleftInMonth (dd,mm,yy) = ( (monthLength mm yy) !! (mm-1)  )  - dd     + 1     \n\n\ndaysSinceYearBegan :: (Int,Int,Int) -&gt; Int\ndaysSinceYearBegan (dd,mm,yy) =if(mm==1)\n                            then dd\n                           else\n                            dd + sum( take (mm-1)  (monthLength mm yy) ) \n\n\n\nleftInYear :: (Int,Int,Int) -&gt; Int\nleftInYear (dd,mm,yy) = yearLength (yy) - (daysSinceYearBegan (dd,mm,yy) ) +1\n\n\n\naddDays :: (Int,Int,Int) -&gt; Int -&gt; (Int,Int,Int)\naddDays (dd,mm,yy) days =  \n                        if ( days &gt;= leftInYear (dd,mm,yy))\n                            then addDays (1,1,(yy+1)) (days- (leftInYear (dd,mm,yy)) )                            \n                        else if ( days &gt;= leftInMonth (dd,mm,yy)  )\n                                then if((mm)&lt;=12 ) \n                                        then addDays (dd,mm+1,yy) (days- (leftInMonth (dd,mm,yy) ) )\n                                      else addDays (1,1,yy+1) (days- (leftInMonth (dd,mm,yy) ) )                                     \n                        else ( (dd + days),mm,yy)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1516264433, "post_id": 48314415, "comment_id": 83619078, "body": "You just say @5 :: Complex@.  But your definitions of abs, signum, and fromInteger are wrong."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516283363, "post_id": 48314415, "comment_id": 83630843, "body": "Note that <code>abs x * signum x == x</code> should hold for your instance."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516284255, "post_id": 48314415, "comment_id": 83631456, "body": "It&#39;s also reasonable that <code>fromInteger (x + y) == fromInteger x + fromInteger y</code> (and the same for <code>*</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1516295026, "post_id": 48314555, "comment_id": 83638671, "body": "This is the answer that I&#39;m looking for.  I&#39;m very confusing how to use &#39;fromInteger n = Complex(fromInteger n) 0&#39; in my actual code. Thanks for sharing."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 6, "last_activity_date": 1516295296, "last_edit_date": 1516295296, "creation_date": 1516254212, "answer_id": 48314555, "question_id": 48314415, "link": "https://stackoverflow.com/questions/48314415/implement-complex-from-num/48314555#48314555", "title": "Implement Complex from Num", "body": "<p>Here are two examples of using the <code>fromInteger</code> function in GHCi:</p>\n\n<pre><code>\u03bb&gt; fromInteger 5 :: Complex\nComplex {x = 5.0, y = 5.0}\n</code></pre>\n\n\n\n<pre><code>\u03bb&gt; :set -XTypeApplications\n\n\u03bb&gt; fromInteger @Complex 5\nComplex {x = 5.0, y = 5.0}\n</code></pre>\n\n<p>By the way, I believe you have that implemented incorrectly. Check out <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Complex.html#line-120\" rel=\"nofollow noreferrer\">the source</a> to see how it's done in <code>base</code>. It seems like it ought to be defined as:</p>\n\n<pre><code>fromInteger n = Complex (fromInteger n) 0\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 48314555, "answer_count": 1, "score": -5, "last_activity_date": 1516295296, "creation_date": 1516253401, "question_id": 48314415, "link": "https://stackoverflow.com/questions/48314415/implement-complex-from-num", "title": "Implement Complex from Num", "body": "<p>I'm new to Haskell and want to learn how to implement my Complex number from Num class.</p>\n\n<pre><code>data Complex = Complex{x::Float, y::Float} deriving (Show)\n\ninstance Num Complex where\n        (Complex x1 y1) + (Complex x2 y2) = Complex(x1 + x2) (y1 + y2)\n        (Complex x1 y1) - (Complex x2 y2) = Complex(x1 - x2) (y1 - y2)\n        (Complex x1 y1) * (Complex x2 y2) = Complex(x1*x2 - y1*y2) (x1*y2 + x2*y2)\n        fromInteger n                     = Complex(fromInteger n) (fromInteger n) \n        signum (Complex x y)              = Complex(signum x) (signum y) \n        abs (Complex x y)                 = Complex(abs x) (abs y) \n</code></pre>\n\n<p>My question is how to use </p>\n\n<pre><code>fromInteger n = Complex(fromInteger n) (fromInteger n)\n</code></pre>\n"}, {"tags": ["haskell", "nixos"], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1516251063, "creation_date": 1516251063, "answer_id": 48314040, "question_id": 48313962, "link": "https://stackoverflow.com/questions/48313962/in-nixos-how-to-run-a-haskell-executable-from-the-command-line/48314040#48314040", "title": "In NixOS, how to run a Haskell executable from the command line?", "body": "<p>Two things to know:</p>\n\n<ol>\n<li><p>You don't need GHC, you just need the executable from hscolour, which you can obtain as <code>haskell.lib.justStaticExecutables haskellPackages.hscolour</code>.</p></li>\n<li><p>The binary for hscolour is called <code>HsColour</code>, not <code>hscolour</code>.</p></li>\n</ol>\n\n<p>To demonstrate:</p>\n\n<pre><code>$ nix-shell -p 'haskell.lib.justStaticExecutables haskellPackages.hscolour' --run 'HsColour --version'\nHsColour 1.24\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": 2, "last_activity_date": 1516277454, "creation_date": 1516277454, "answer_id": 48321038, "question_id": 48313962, "link": "https://stackoverflow.com/questions/48313962/in-nixos-how-to-run-a-haskell-executable-from-the-command-line/48321038#48321038", "title": "In NixOS, how to run a Haskell executable from the command line?", "body": "<p>I'll share an other approach I discovered shortly by looking for <a href=\"https://stackoverflow.com/a/48222190/2789312\">an executable on NixOS</a>.</p>\n\n<pre><code>$ `nix-build --no-out-link \"&lt;nixpkgs&gt;\"   -A haskellPackages.hscolour`/bin/HsColour --version                         \nHsColour 1.24\n</code></pre>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "accepted_answer_id": 48314040, "answer_count": 2, "score": 3, "last_activity_date": 1516277454, "creation_date": 1516250476, "question_id": 48313962, "link": "https://stackoverflow.com/questions/48313962/in-nixos-how-to-run-a-haskell-executable-from-the-command-line", "title": "In NixOS, how to run a Haskell executable from the command line?", "body": "<p>I am attempting to run Haskell executables from the command line, following the example of <a href=\"https://passingcuriosity.com/2008/literate-haskell-with-markdown-syntax-hightlighting/\" rel=\"nofollow noreferrer\">this blog</a>. My machine runs NixOS.</p>\n\n<p>The blog is about compiling markdown literate haskell into html for publishing blog posts. One step in that process is to run the haskell program <code>hscolour</code> on the .lhs file to create a .mkd file with the code syntax-highlighted via html and css.</p>\n\n<pre><code>cat blah.lhs | hscolour -lit -css &gt; blah.mkd\n</code></pre>\n\n<p>When I try to run this command, however, I get the following <code>command not found</code> error.</p>\n\n<pre><code>$ cat blah.lhs | hscolour -lit -css &gt; blah.mkd                                                            \nhscolour: command not found\n</code></pre>\n\n<p>I'm not sure whether this issue I'm having is specific to NixOS, or with making haskell executables available to the command line more broadly. <strong>How do I make haskell executables such as <code>hscolour</code> available from the command line?</strong></p>\n\n<hr>\n\n<p>I have tried running this command from within a <code>nix-shell</code> in which <code>hscolour</code> has been built. The <code>hscolour</code> command still was not found.</p>\n\n<pre><code>$ nix-shell -p \"haskellPackages.ghcWithPackages (pkgs: with pkgs; [hscolour])\"\n$ cat functor-proofs.lhs | hscolour -li\nhscolour: command not found\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 5726, "user_id": 3548046, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oyTAQ.jpg?s=128&g=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/3548046/umair"}, "edited": false, "score": 0, "creation_date": 1516251792, "post_id": 48313642, "comment_id": 83613932, "body": "While this link may answer the question, it is better to include the essential parts of the answer here and provide the link for reference.  Link-only answers can become invalid if the linked page changes. - <a href=\"/review/low-quality-posts/18549599\">From Review</a>"}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "reply_to_user": {"reputation": 5726, "user_id": 3548046, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oyTAQ.jpg?s=128&g=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/3548046/umair"}, "edited": false, "score": 2, "creation_date": 1516251902, "post_id": 48313642, "comment_id": 83613962, "body": "Umair, I disagree.  This concisely answers the question in a way that is clearly generalizable.  Concision is not indicative of it not including essential parts of the answer.  It is just indicative that this problem is <i>super</i> trivial.  Also, the linked page is stable w.r.t. this question.  So yeah, please consider your answer policing more carefully in the future."}, {"owner": {"reputation": 5726, "user_id": 3548046, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oyTAQ.jpg?s=128&g=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/3548046/umair"}, "edited": false, "score": 0, "creation_date": 1516252202, "post_id": 48313642, "comment_id": 83614064, "body": "this link may answer OP&#39;s question but the reason I marked this answer is because there is no detail with the link. If you think that this link will answer the question then I believe you should have given up some details too even in your own words. From the first look at the answer it looks like it&#39;s just another answer with the link only. :)"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 3, "creation_date": 1516257514, "post_id": 48313642, "comment_id": 83615821, "body": "&quot;0.5.1 doesn&#39;t exist&quot; is in fact the entire answer. The link simply provides evidence of that fact. mgsloan is correct."}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 2, "last_activity_date": 1516248078, "creation_date": 1516248078, "answer_id": 48313642, "question_id": 48313442, "link": "https://stackoverflow.com/questions/48313442/haskell-stack-the-following-package-identifiers-were-not-found-in-your-indices/48313642#48313642", "title": "Haskell Stack: The following package identifiers were not found in your indices", "body": "<p>Take a look at the versions on hackage - <a href=\"https://hackage.haskell.org/package/language-c\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/language-c</a> - 0.5.1 doesn't exist.</p>\n"}], "owner": {"reputation": 85, "user_id": 8930059, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210486235700399/picture?type=large", "display_name": "Pond Premtoon", "link": "https://stackoverflow.com/users/8930059/pond-premtoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516248078, "creation_date": 1516246577, "question_id": 48313442, "link": "https://stackoverflow.com/questions/48313442/haskell-stack-the-following-package-identifiers-were-not-found-in-your-indices", "title": "Haskell Stack: The following package identifiers were not found in your indices", "body": "<p>I'm trying to build a haskell project using stack. After running <code>stack setup</code>, which seems to installs GHC fine, I ran <code>stack build</code> and encountered the following error:</p>\n\n<pre><code>Didn't see language-c-0.5.1 in your package indices.\nUpdating and trying again.\nSelected mirror https://s3.amazonaws.com/hackage.fpcomplete.com/\nDownloading timestamp\nNo updates to your package index were found\nUpdate complete\nThe following package identifiers were not found in your indices: language-c-0.5.1\nPossible candidates: language-c-0.5.0.\n</code></pre>\n\n<p>I'm not sure why that is. Running <code>stack ghci</code> also gives the exact same message. (But running <code>stack ghc</code> outputs <code>ghc: no input files</code> as expected). </p>\n\n<p>I have tried removing <code>~/.stack/indices</code>, but that didn't fix the problem. </p>\n\n<p>Here's my stack version information</p>\n\n<pre><code>\u21d2  stack --version\nVersion 1.6.3, Git revision b27e629b8c4ce369e3b8273f04db193b060000db (5454 commits) x86_64 hpack-0.20.0\n</code></pre>\n\n<p>The local GHC version is 7.10.3</p>\n\n<p>Here's my stack.yaml, excluding some commented sections</p>\n\n<pre><code># Specifies the GHC version and set of packages available (e.g., lts-3.5, nightly-2015-09-21, ghc-7.10.2)\nresolver: lts-6.12\n\n# Local packages, usually specified by relative directory name\npackages:\n- .\n- ./compdata\n- ./comptrans\n- ./compstrat\n- location:\n    git: git@github.com:jkoppel/language-java.git\n    commit: 68e71843294b233c36b3cbe52d9b1e35a5898997\n  extra-dep: true\n- location:\n    git: git@github.com:dvekeman/language-c.git\n    commit: caf4888d6c32d97f57d5107db3369e90b5d2649e\n  extra-dep: true\n- location:\n   git: git@github.com:bjpop/language-python.git\n   commit: 9269c77ca67c52280314a122cae1b3fa1a044168\n  extra-dep: true\n\n# Packages to be pulled from upstream that are not in the resolver (e.g., acme-missiles-0.3)\nextra-deps: [language-lua-0.10.0, language-python-0.5.4, language-java-0.2.8, language-javascript-0.6.0.9, language-c-0.5.1, language-dot-0.1.0, fgl-5.5.3.0]\n\n# Override default flag values for local packages and extra-deps\nflags: {}\n\n# Extra package databases containing global packages\nextra-package-dbs: []\n</code></pre>\n"}, {"tags": ["haskell", "gadt", "rank-n-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1516245766, "post_id": 48313174, "comment_id": 83612441, "body": "Move the constraint to the constructor. E.g. <code>data Symbol :: c a -&gt; * where { Terminal :: Character c =&gt; a -&gt; Symbol (b :: c a) }</code>"}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516282217, "post_id": 48313174, "comment_id": 83630109, "body": "@Alec that worked. I&#39;m not quite sure why it does"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1516317740, "creation_date": 1516317740, "answer_id": 48331898, "question_id": 48313174, "link": "https://stackoverflow.com/questions/48313174/generalizing-from-a-specific-type-to-a-class-in-a-gadt/48331898#48331898", "title": "Generalizing from a specific type to a class in a GADT", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#constraints-in-kinds\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>As kinds and types are the same, kinds can now (with -XTypeInType)\n  contain type constraints. <strong>Only equality constraints are currently\n  supported, however.</strong> We expect this to extend to other constraints in\n  the future.</p>\n</blockquote>\n\n<p>So in principle what you've written is sensible; it simply isn't supported yet (as of writing, most recent GHC is 8.2.2). </p>\n"}], "owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "accepted_answer_id": 48331898, "answer_count": 1, "score": 0, "last_activity_date": 1516317740, "creation_date": 1516244502, "question_id": 48313174, "link": "https://stackoverflow.com/questions/48313174/generalizing-from-a-specific-type-to-a-class-in-a-gadt", "title": "Generalizing from a specific type to a class in a GADT", "body": "<p>I have the following definitions</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, TypeInType, RankNTypes #-}\nimport Data.Kind\n\nclass Character (a :: * -&gt; *) where\n  showVal :: a b -&gt; b -&gt; String\n\ndata ExampleCharacter a where\n  Variable :: ExampleCharacter String\n  EqualSign :: ExampleCharacter ()\n  Deref :: ExampleCharacter ()\n\ninstance Character ExampleCharacter where\n  showVal Variable = id\n  showVal EqualSign = const \"=\"\n  showVal Deref = const \"*\"\n\ndata Symbol :: forall a. ExampleCharacter a -&gt; * where\n  Terminal :: a -&gt; Symbol (b :: ExampleCharacter a)\n</code></pre>\n\n<p>as you can see I have defined a Symbol class that uses ExampleCharacters in the type signature. Example usage would be <code>let sym = Terminal \"xyy\" :: Symbol Variable</code> creating a variable symbol with the name <code>\"xyy\"</code>.</p>\n\n<p>Now, the obvious next step would be to generalize <code>ExampleCharacter</code> to <code>Character c</code>. I tried the following:</p>\n\n<pre><code>data Symbol :: (forall c (a :: *). Character c) =&gt; c a -&gt; * where\n  Terminal :: a -&gt; Symbol (b :: c a)\n</code></pre>\n\n<p>But I get the following error:</p>\n\n<pre><code>main.hs:22:20: error:\n    \u2022 Illegal constraint in a type: forall (c :: * -&gt; *) a. Character c\n    \u2022 In the type \u2018Symbol (b :: c a)\u2019\n      In the definition of data constructor \u2018Terminal\u2019\n      In the data declaration for \u2018Symbol\u2019\n</code></pre>\n\n<p>I'm not quite sure what the error wants to tell me. Why is <code>forall (c :: * -&gt; *) a. Character c</code> an illegal constraint and how so? Is there any way around it?</p>\n"}, {"tags": ["haskell", "category-theory", "abstract-algebra"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1516243110, "post_id": 48312945, "comment_id": 83611829, "body": "That looks like half of a <a href=\"https://hackage.haskell.org/package/comonad-5.0.2/docs/Control-Comonad.html\" rel=\"nofollow noreferrer\">comonad</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 2, "creation_date": 1516313147, "post_id": 48313068, "comment_id": 83647948, "body": "You should mention <code>[]</code> as an obvious example of something which is <code>Extend</code> and not <code>Comonad</code>. In fact, the <code>duplicate</code> for list is very easy to understand!"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 9, "last_activity_date": 1516315876, "last_edit_date": 1516315876, "creation_date": 1516243716, "answer_id": 48313068, "question_id": 48312945, "link": "https://stackoverflow.com/questions/48312945/what-is-the-meaning-of-extend-type-class-in-haskell/48313068#48313068", "title": "What is the meaning of Extend type class in Haskell?", "body": "<p><code>Extend</code> is a <code>Comonad</code> without the ability to <code>extract</code>. It's an \"almost comonad\", if you want to think of it like that. It's probably more helpful to ask the question \"what is the meaning of comonads\". Then, when you find something that's almost a comonad, you know you can use <code>Extend</code> to represent it. I recommend <a href=\"http://blog.sigfpe.com/2006/12/evaluating-cellular-automata-is.html\" rel=\"noreferrer\">Neighborhood of Infinity</a> for an introduction to comonads by example.</p>\n\n<p>We have a similar thing for <code>Monad</code> and <code>Applicative</code>, by the way. <code>Bind</code> is <code>Monad</code> but without <code>return</code>, and <code>Apply</code> is <code>Applicative</code> but without <code>pure</code>. You can find both of these classes in the same <code>semigroupoids</code> package you linked.</p>\n\n<p>As an example, nonempty lists form a comonad, with <code>duplicate = tails</code> and <code>extract = head</code>. Then <code>extend f = fmap f . duplicate</code>. This is fine if we have <code>NonEmpty</code>, but if the list might be empty, <code>extract = head</code> is no longer a total function. We still have <code>duplicate</code> and <code>extend</code>, so <code>[]</code> can be <code>Extend</code> but it can't be <code>Comonad</code>. (Thanks @phadej for this example!)</p>\n"}], "owner": {"reputation": 858, "user_id": 1910822, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d3cbcd57f668d93aa65a1d637ee8a14c?s=128&d=identicon&r=PG", "display_name": "mtber75", "link": "https://stackoverflow.com/users/1910822/mtber75"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1516315876, "creation_date": 1516242729, "last_edit_date": 1516242969, "question_id": 48312945, "link": "https://stackoverflow.com/questions/48312945/what-is-the-meaning-of-extend-type-class-in-haskell", "title": "What is the meaning of Extend type class in Haskell?", "body": "<p>In Haskell, there is a type class called <a href=\"https://hackage.haskell.org/package/semigroupoids-5.2.1/docs/Data-Functor-Extend.html#v:extended\" rel=\"noreferrer\">Extend</a>.</p>\n\n<p>The class is defined as the following</p>\n\n<pre><code>class Functor w =&gt; Extend w where\n    extended :: (w a -&gt; b) -&gt; w a -&gt; w b\n</code></pre>\n\n<p>Every instance of the <code>Extend</code> class should have the following properties:</p>\n\n<pre><code>extended f . extended g = extended (f . extended g)\n</code></pre>\n\n<p>I can see its similarities to <code>Functor</code>. Particularly, <code>Functor</code>'s property  <code>fmap f . fmap g == fmap (f . g)</code> looks similar to <code>Extend</code>.</p>\n\n<p>How would you interpret <code>Extend</code>? What is the significance of it? Does it make any computations easier? What abstractions are made when using <code>Extend</code>?</p>\n"}]