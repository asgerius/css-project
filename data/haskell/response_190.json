[{"tags": ["haskell", "ghc", "micro-optimization"], "comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1535588533, "post_id": 52087284, "comment_id": 91125625, "body": "So you looked at the current machine code at the profiling hotspot, and found some missed optimizations?  Did you try modifying the compiler-generated asm to check that what you think would be faster actually does run faster?  Or at least have some static analysis to justify your conclusion?  (And HW performance counter data to confirm your conclusion about why it&#39;s slow in the first place?)  Yes it&#39;s often possible to beat the compiler <i>if</i> you know what you&#39;re doing (See my <a href=\"https://stackoverflow.com/q/40354978\">Collatz conjecture asm optimization answer</a>), but always measure."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1535588572, "post_id": 52087284, "comment_id": 91125630, "body": "(And no, I don&#39;t know how to use GHC.  I&#39;m here for the <code>[micro-optimization]</code> tag, not Haskell, sorry."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1535662772, "post_id": 52087284, "comment_id": 91161642, "body": "&quot;Did you try modifying the compiler-generated asm to check that what you think would be faster actually does run faster?&quot; =&gt; Roger that! This is about middle step towards this goal! I need to convince GHC to generate code that maps better to what I know it &quot;should&quot; be doing and with less noise."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1535751088, "post_id": 52106107, "comment_id": 91196922, "body": "That code sample looks very promising! Didn&#39;t know about pinned arrays! Many systems can live with <i>occasional</i> GC pauses when throughput is the primary measure or requests are idempotent and can be duplicated. I expect that keeping heap small can bring pauses down to acceptable levels."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 2, "last_activity_date": 1535668076, "last_edit_date": 1535668076, "creation_date": 1535667733, "answer_id": 52106107, "question_id": 52087284, "link": "https://stackoverflow.com/questions/52087284/how-to-reliably-influence-generated-code-at-near-machine-level-using-ghc/52106107#52106107", "title": "How to reliably influence generated code at near machine level using GHC?", "body": "<p>It sounds like you're looking for unboxed arrays. \"unboxed\" in haskell-land means \"has no runtime heap representation\". You can usually learn whether some part of your code is compiled to an unboxed loop (a loop that performs no allocation), say, by looking at the <em>core</em> representation (this is a very haskell-like language, that's the first stage in compilation). So e.g. you might see <code>Int#</code> in the core output which means an integer which has no heap representation (it's gonna be in a register). </p>\n\n<p>When optimizing haskell code we regularly look at core and expect to be able to manipulate or correct for performance regressions by changing the source code (e.g. adding a strictness annotation, or fiddling with a function such that it can be inlined). This isn't always fun, but will be fairly stable especially if you are pinning your compiler version.</p>\n\n<p>Back to unboxed arrays: GHC exposes a lot of low-level primops in GHC.Prim, in particular it sounds like you want mutable unboxed arrays (<a href=\"https://downloads.haskell.org/~ghc/8.2.1/docs/html/libraries/ghc-prim-0.5.1.0/GHC-Prim.html#g:10\" rel=\"nofollow noreferrer\"><code>MutableByteArray</code></a>). The <a href=\"http://hackage.haskell.org/package/primitive-0.6.3.0/docs/Data-Primitive-ByteArray.html\" rel=\"nofollow noreferrer\"><code>primitive</code></a> package exposes these primops behind a slightly safer, friendlier API and is what you should use (and depend on if writing your own library).</p>\n\n<p>There are many other libraries that implement unboxed arrays, such as <code>vector</code>, and which are built on <code>MutableByteArray</code>, but the point is that operations on that structure generate no garbage and likely compile down to pretty predictable machine instructions.</p>\n\n<p>You might also like to check out <a href=\"https://github.com/jberryman/almost-inline-asm-haskell-example\" rel=\"nofollow noreferrer\">this technique</a> if you're doing numeric work and want to use a particular instruction or implement some loop directly in assembly.</p>\n\n<p>GHC also has a very powerful FFI, and you can research about how to write portions of your program in C and interop; haskell supports pinned arrays among other structures for this purpose.</p>\n\n<p>If you need more control than those give you then haskell is likely the wrong language. It's impossible to tell from your description if this is the case for your problem (Your requirements seem contradictory: you need to be able to write a carefully cache-tuned algorithm, but arbitrary GC pauses are okay?).</p>\n\n<p>One last note: you can't rely on GHC's native code generator to perform any of the low-level strength reduction optimizations that e.g. GCC performs (GHC's NCG will probably never ever know about bit-twiddling hacks, autovectorization, etc. etc.). Instead you can try the LLVM backend, but whether you see a speedup in your program is by no means guaranteed.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 52106107, "answer_count": 1, "score": 2, "last_activity_date": 1535668076, "creation_date": 1535584646, "last_edit_date": 1535637602, "question_id": 52087284, "link": "https://stackoverflow.com/questions/52087284/how-to-reliably-influence-generated-code-at-near-machine-level-using-ghc", "title": "How to reliably influence generated code at near machine level using GHC?", "body": "<p>While this may sound as theoretical question, suppose I decide to invest and build a mission-critical application written in Haskell. A year later I find that I absolutely need to improve performance of some very thin bottleneck and this will require optimizing memory access close to raw machine capabilities.</p>\n\n<p>Some assumptions:</p>\n\n<ul>\n<li>It isn't realtime system - occasional latency spikes are tolerable (from interrupts, thread scheduling irregularities, occasional GC etc.)</li>\n<li>It isn't a numeric problem - data layout and cache-friendly access patterns are most important (avoiding pointer chasing, reducing conditional jumps etc.)</li>\n<li>Code may be tied to specific GHC release (but no forking)</li>\n<li>Performance goal requires inplace modification of pre-allocated offheap arrays taking alignment into account (C strings, bit-packed fields etc.)</li>\n<li>Data is statically bounded in arrays and allocations are rarely if ever needed</li>\n</ul>\n\n<p>What mechanisms does GHC offer to perfom this kind of optimization? By saying reliably I mean that if source change causes code to no longer perform, it is correctible in source code without rewriting it in assembly.</p>\n\n<ul>\n<li>Is it already possible using GHC-specific extensions and libraries?</li>\n<li>Would custom FFI help avoid C calling convention overhead?</li>\n<li>Could a special purpose compiler plugin do it through a restricted source DSL?</li>\n<li>Could source code generator from a \"high-level\" assembly (LLVM?) be solution?</li>\n</ul>\n"}, {"tags": ["haskell", "static-analysis", "hlint"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1535572934, "post_id": 52085005, "comment_id": 91120735, "body": "Your title and question content are different; please clarify your question and what you&#39;ve tried."}, {"owner": {"reputation": 900, "user_id": 1181479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e49ca995b6af7a396a5e8e47b0c603a9?s=128&d=identicon&r=PG", "display_name": "Roman M. Koss", "link": "https://stackoverflow.com/users/1181479/roman-m-koss"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1535670987, "post_id": 52085005, "comment_id": 91163979, "body": "I couldn&#39;t find any good alternative to hlint, so I specified better by sticking to that library"}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 3, "last_activity_date": 1535672213, "creation_date": 1535672213, "answer_id": 52106702, "question_id": 52085005, "link": "https://stackoverflow.com/questions/52085005/haskell-hlint-how-can-i-add-hint-for-wrong-indentation-trailing-spaces-and-e/52106702#52106702", "title": "Haskell `hlint`, how can I add hint for wrong indentation, trailing spaces and etc?", "body": "<p>From <a href=\"https://github.com/ndmitchell/hlint/issues/522\" rel=\"nofollow noreferrer\">https://github.com/ndmitchell/hlint/issues/522</a>:</p>\n\n<blockquote>\n  <p>There is currently no support in HLint for issues which are about spacing or indentation. There are a few tools that deal with such concerns, search Haskell style checker for a few. I think HLint is probably better remaining free from whitespace concerns and letting other tools deal with them - I should probably link in the README to whatever the consensus is (I'm not sure)</p>\n</blockquote>\n"}], "owner": {"reputation": 900, "user_id": 1181479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e49ca995b6af7a396a5e8e47b0c603a9?s=128&d=identicon&r=PG", "display_name": "Roman M. Koss", "link": "https://stackoverflow.com/users/1181479/roman-m-koss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 52106702, "answer_count": 1, "score": 1, "last_activity_date": 1535672213, "creation_date": 1535571710, "last_edit_date": 1535671584, "question_id": 52085005, "link": "https://stackoverflow.com/questions/52085005/haskell-hlint-how-can-i-add-hint-for-wrong-indentation-trailing-spaces-and-e", "title": "Haskell `hlint`, how can I add hint for wrong indentation, trailing spaces and etc?", "body": "<p>I tried to use <code>hlint</code> package, but it gives no warnings or configuration for:</p>\n\n<ul>\n<li>trailing spaces</li>\n<li>last empty line</li>\n<li>spaces between arguments</li>\n<li>restrict tab indentation</li>\n<li>redundant lines</li>\n</ul>\n\n<p>and other lint option stuff that relates to spaces/tabs and empty lines</p>\n\n<p>I don't see how \"Add new hint\" can help me with this</p>\n"}, {"tags": ["html", "haskell", "post", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 2, "last_activity_date": 1535564171, "creation_date": 1535564171, "answer_id": 52083271, "question_id": 52079870, "link": "https://stackoverflow.com/questions/52079870/how-to-upload-a-file-to-website-with-file-contents-in-post-body/52083271#52083271", "title": "How to upload a file to website with file contents in post body", "body": "<blockquote>\n<pre><code>-----------------------------172368540915173703481121109126--\n</code></pre>\n</blockquote>\n\n<p>That's a <code>multipart/form-data</code> field boundary. If this is all you get, it means the form didn't contain any data to post to the server. I expect you can get your file to show up by giving it a name:</p>\n\n<pre><code>&lt;input type=\"file\" name=\"myfile\"&gt;\n</code></pre>\n\n<p>Even if you do this, you'll still get boundaries and headers in your response body, alongside your actual file contents. What you need to do is parse the <code>multipart/form-data</code> and extract the file contents from there. I think Scotty will do this for you if you use the <a href=\"http://hackage.haskell.org/package/scotty-0.11.2/docs/Web-Scotty.html#v:files\" rel=\"nofollow noreferrer\"><code>files</code></a> function, rather than using <code>body</code>.</p>\n"}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 52083271, "answer_count": 1, "score": 1, "last_activity_date": 1535564171, "creation_date": 1535552770, "question_id": 52079870, "link": "https://stackoverflow.com/questions/52079870/how-to-upload-a-file-to-website-with-file-contents-in-post-body", "title": "How to upload a file to website with file contents in post body", "body": "<p>How do I upload a file to my web server from a browser? The server is written in Haskell, using Scotty. Here is what I have tried:</p>\n\n<p>Server:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Web.Scotty as Scot\nimport qualified Control.Monad.IO.Class as Cm\nimport qualified Data.Digest.Pure.SHA as Dps\n\ndir :: String\ndir = \"/home/t/fileUpload/\"\n\nmain :: IO ()\nmain =\n    Scot.scotty 3000 $ do\n        Scot.get \"/\" $ Scot.file $ dir ++ \"index.html\"\n        Scot.post \"/upload\" $ do\n            contents &lt;- Scot.body\n            let fileName = Dps.showDigest $ Dps.sha256 contents\n            Cm.liftIO $ BL.writeFile (dir ++ fileName) contents\n</code></pre>\n\n<p>index.html:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en-US\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form enctype=\"multipart/form-data\" action=\"/upload\" method=\"post\"&gt;\n&lt;input type=\"file\"&gt; &lt;input type=\"submit\" value=\"Submit\"&gt;&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>When I visit <a href=\"http://localhost:3000\" rel=\"nofollow noreferrer\">http://localhost:3000</a> in my browser, I click on the Browse button, choose a file, and click on Submit.  Then it takes me to a blank page called <a href=\"http://localhost:3000/upload\" rel=\"nofollow noreferrer\">http://localhost:3000/upload</a>, and a file gets saved to \"/home/t/fileUpload/somelonghash\".  That is fine, but the problem is that the saved file only contains something like this:</p>\n\n<pre><code>-----------------------------172368540915173703481121109126--\n</code></pre>\n\n<p>which is not the contents of the original file.</p>\n"}, {"tags": ["sqlite", "haskell", "hdbc"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1535533921, "post_id": 52073014, "comment_id": 91097093, "body": "The <a href=\"https://hackage.haskell.org/package/HDBC-2.4.0.1/docs/Database-HDBC-Types.html#v:fromSql\" rel=\"nofollow noreferrer\">HDBC documentation</a> suggests that you&#39;re looking for <code>fromSql</code>."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1535551347, "post_id": 52073014, "comment_id": 91108682, "body": "@Shawn: tried that. Can&#39;t find any example that works. To make matters worse: fetchRow (the one I actually need) wraps the list in a Maybe type, and returns eg. <code>Just [SqlInt64 3,SqlByteString &quot;Newco&quot;]</code>"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1535558450, "post_id": 52073014, "comment_id": 91113751, "body": "To add to that: drilling down to the value (let alone when wrapped in a Maybe) must be achievable simpler than this: <code>fetchData2 = do    conn &lt;- connectSqlite3 &quot;dBase.db&quot;   statement &lt;- prepare conn &quot;SELECT * FROM test WHERE id &gt; 0&quot;   execute statement []   results &lt;- fetchAllRows statement   let first = head (results)   let col1 = head (first)   let showInt = fromSql col1::Int   print (showInt)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1535606711, "post_id": 52084016, "comment_id": 91129372, "body": "Hi Fredefox, thanks for the input. Going to give that a try. Figured that a Haskell beginner only learns by doing after having read the odd 4 books or so..."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1535610037, "post_id": 52084016, "comment_id": 91130532, "body": "I can get it from the Maybe by using <code>fromJust</code>. That works like a charm. <code>fromSql</code> however expects a type constraint per parsed value like <code>fromSql VALUE::Int</code>. Is there a quick way parsing several columns having different types, while Haskell prefers list of a single type."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 1, "creation_date": 1535702811, "post_id": 52084016, "comment_id": 91172630, "body": "Ah yes, this is unfortunate. Perhaps this is why the authors of HDBC does not expose such a helper. Another library <code>sqlite-simple</code> solves this by defining the equivalent of your <code>Convertible</code> for tuples up to a certain length. Here&#39;s a quick-and-dirty solution for you:  <code>three = \\(a:b:c:[]) -&gt; (fromSql a, fromSql b, fromSql c)</code>  This unsafely converts a list to a triple with converted values. I&#39;m sure you can come up with something more elegant for your use case."}], "tags": [], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "is_accepted": true, "score": 2, "last_activity_date": 1535567420, "creation_date": 1535567420, "answer_id": 52084016, "question_id": 52073014, "link": "https://stackoverflow.com/questions/52073014/haskell-hdbc-sqlite3-fetchallrows/52084016#52084016", "title": "Haskell HDBC.Sqlite3 fetchAllRows", "body": "<p>You could define a helper:</p>\n\n<pre><code>fetchRowFromSql :: Convertible SqlValue a =&gt; Statement -&gt; IO (Maybe [a])\nfetchRowFromSql = fmap (fmap (fmap fromSql)) . fetchRow\n</code></pre>\n\n<p>The implementation looks a bit daunting, but this is just because we need to drill down under the layered functors as you already noted (first <code>IO</code>, then <code>Maybe</code> and lastly <code>[]</code>). This returns something that is convertible from a <code>SqlValue</code>. There are a bunch of these defined already. See e.g. <a href=\"http://hackage.haskell.org/package/HDBC-2.4.0.2/docs/Database-HDBC-SqlValue.html#t:SqlValue\" rel=\"nofollow noreferrer\">the docs</a>. An example (using <code>-XTypeApplications</code>):</p>\n\n<pre><code>fetchRowFromSql @String :: Statement -&gt; IO (Maybe [String])\n</code></pre>\n\n<p>I should perhaps add that the documentation mentions that <code>fromSql</code> is unsafe. Meaning that if you try to convert a sql value to an incompatible Haskell value the program will halt.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 52084016, "answer_count": 1, "score": 0, "last_activity_date": 1535567420, "creation_date": 1535531765, "question_id": 52073014, "link": "https://stackoverflow.com/questions/52073014/haskell-hdbc-sqlite3-fetchallrows", "title": "Haskell HDBC.Sqlite3 fetchAllRows", "body": "<p>Since I am an absolute Haskell beginner, but determined to conquer it, I am asking for help again. </p>\n\n<p>using:</p>\n\n<pre><code>fetchData2 = do\n  conn &lt;- connectSqlite3 \"dBase.db\"\n  statement &lt;- prepare conn \"SELECT * FROM test WHERE id &gt; 0\"\n  execute statement []\n  results &lt;- fetchAllRows statement\n  print results\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>[[SqlInt64 3,SqlByteString \"Newco\"],[SqlInt64 4,SqlByteString \"Oldco\"],[SqlInt64 5,SqlByteString \"Mycom\"],[SqlInt64 4,SqlByteString \"Oldco\"],[SqlInt64 5,SqlByteString \"Mycom\"]]\n</code></pre>\n\n<p>Is there a clever way to clean this data into <code>Int</code> and <code>[Char]</code>, in other words omitting types <code>SqlInt64</code> and <code>SqlByteString</code>.</p>\n"}, {"tags": ["multithreading", "haskell", "asynchronous", "race-condition", "stm"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1535555919, "post_id": 52071821, "comment_id": 91112039, "body": "Why do you think this isn&#39;t possible?  Consider the sequence of operations: <code>child1</code> writes to the TMVar, <code>main</code> takes from the TMVar, <code>child1</code> writes to the TMVar (it is once again full), <code>child1</code> and <code>child2</code> block in an STM transaction trying to <code>putTMVar</code> and <code>main</code> has no live reference to <code>output</code> by this point.  Both child threads and thus blocked in an STM transaction."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1535556510, "post_id": 52071821, "comment_id": 91112422, "body": "@ThomasM.DuBuisson I think the OP expects that <code>withAsync</code> will eventually kill (cancels) those threads, so there is no real deadlock here. However, the RTS does not keep &quot;thread kills&quot; into account, and triggers an arguably spurious &quot;deadlock&quot; exception. I&#39;m not arguing the RTS is wrong in its detection strategy, but here it copes with asyncs."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1535557122, "post_id": 52071821, "comment_id": 91112861, "body": "I&#39;ve run into similar issues in the past, and this is indeed expected RTS behavior. Relevant links: <a href=\"https://github.com/simonmar/async/issues/14\" rel=\"nofollow noreferrer\">github.com/simonmar/async/issues/14</a> <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9401\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9401</a> <a href=\"https://github.com/simonmar/async/pull/15\" rel=\"nofollow noreferrer\">github.com/simonmar/async/pull/15</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1535557462, "post_id": 52071821, "comment_id": 91113084, "body": "@chi Makes sense.  It just seems that this is a race even in the best case.  What wins between the killing of the child threads or the RTS recognizing there is no reader of <code>output</code> and throwing the exception for all blocked children.  This is particularly realistic if there is more than <code>takeTMVar</code> in that branch of <code>main</code>."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1549816704, "post_id": 52071821, "comment_id": 96029958, "body": "What&#39;s the right way to do this?"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1549817108, "post_id": 52071821, "comment_id": 96030100, "body": "(I edited the code so that the main thread is deciding whether or not to accept each solution either of the children produce)"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 327, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549817030, "creation_date": 1535527695, "last_edit_date": 1549817030, "question_id": 52071821, "link": "https://stackoverflow.com/questions/52071821/thread-blocked-indefinitely-in-an-stm-transaction-in-a-case-where-threads-are", "title": "&quot;thread blocked indefinitely in an STM transaction&quot; in a case where threads are never blocked", "body": "<p>I'm using the <code>async</code> library in conjunction with <code>stm</code> in my program.</p>\n\n<p>The main thread forks two threads which run until one of them (it could be either one) encounters a solution. The solution is returned via a TMVar. Neither of them ever waits on any <code>TMVar</code> except to call <code>putTMVar</code> when the solution is found and one of them is guaranteed to run forever unless killed. So how could I possibly be getting \"thread blocked indefinitely in an STM transaction\" (which seems to happen approximately one in every twenty times) given that at least one of the child threads doesn't execute any blocking STM transactions (or die) until storing a result.</p>\n\n<p>Note the two child threads communicate somewhat with <em>each other</em> using <code>TVar</code>s, but not with <code>TMVar</code>s.</p>\n\n<p>Simplified code:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  output &lt;- newEmptyTMVar\n  result &lt;- withAsync (child1 output) $ \\_ -&gt; withAsync (child2 output) $ \\_ -&gt;\n    let go = do\n          result &lt;- atomically $ takeTMVar output\n          if someCondition result\n            then return result\n            else go\n    in  go\n  print result\n\nchild1 :: TMVar Result -&gt; IO ()\nchild1 output = go 0\n  where\n    go i = do\n      case computation1 i of\n        Nothing -&gt; return ()\n        Just x -&gt; atomically $ putTMVar x\n      go (i + 1)\n\nchild2 :: TMVar Result -&gt; IO ()\n-- Does some other stuff, but also only interacts with its argument to\n-- give back a result, same as child1.\n</code></pre>\n"}, {"tags": ["haskell", "compilation", "llvm-ir", "lli"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1535517585, "post_id": 52068999, "comment_id": 91088956, "body": "Perhaps <a href=\"https://stackoverflow.com/a/46475029/7203016\">this old answer of mine</a> will help you."}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1535519246, "post_id": 52068999, "comment_id": 91089412, "body": "@K.A.Buhr thanks it works! I&#39;m still a little confused because the created *.ll file must contain some kind of entry point right? it&#39;s not called main evidently, but it has got to exist no?  this &quot;simple&quot; haskell quicksort is 1706 lines long in the *.ll file so I couldn&#39;t find anything there. Also, could you please post as answer for me to accept?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535526809, "post_id": 52068999, "comment_id": 91092738, "body": "There is an entry point but you need to be linked to the ghc runtime."}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535527314, "post_id": 52068999, "comment_id": 91093013, "body": "@DanRobertson how can I find it? I&#39;ve grepped the *.ll file for &quot;entry point&quot; which always appears when I compile standard C files to *.bc and then to *.ll ... but there&#39;s no such thing there ... also grepped for <code>Main</code> (instead of main) which did find some results but they all seemed irrelevant"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535527409, "post_id": 52068999, "comment_id": 91093075, "body": "@OrenIshShalom I\u2019m afraid I\u2019ve no idea. There must be some way to find the functions in a <code>.ll</code> file but I don\u2019t know what it is"}], "answers": [{"comments": [{"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 0, "creation_date": 1535603345, "post_id": 52086518, "comment_id": 91128532, "body": "Great detailed answer!! step-by-step commands really help a lot to understand. Thanks for taking the time to write it, it is definitely one of the top answers I&#39;ve read this year in SO."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1535579228, "creation_date": 1535579228, "answer_id": 52086518, "question_id": 52068999, "link": "https://stackoverflow.com/questions/52068999/compiled-haskell-program-to-llvm-ir-is-missing-main/52086518#52086518", "title": "Compiled Haskell program to LLVM IR is missing main", "body": "<p><strong>tl;dr.</strong>  The entry point is (probably) named <code>ZCMain_main_closure</code>, and it's a data structure that references a block of code, rather than a block of code itself.  Still, it's interpretable by the Haskell runtime, and it corresponds directly to the Haskell \"value\" of the function <code>main :: IO ()</code> in your <code>main.hs</code> program.</p>\n\n<p>The longer answer involves more than you ever wanted to know about linking programs, but here's the deal.  When you take a C program like:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n        printf(\"I like C!\\n\");\n}\n</code></pre>\n\n<p>compile it to an object file with <code>gcc</code>:</p>\n\n<pre><code>$ gcc -Wall -c hello.c\n</code></pre>\n\n<p>and inspect the object file's symbol table:</p>\n\n<pre><code>$ nm hello.o\n0000000000000000 T main\n                 U printf\n</code></pre>\n\n<p>you will see that it contains a definition of the symbol <code>main</code> and an (undefined) reference to an external symbol <code>printf</code>.</p>\n\n<p>Now, you might imagine that <code>main</code> is the \"entry point\" of this program.  Hah hah hah!  What a naive and silly thing for you to think!</p>\n\n<p>In fact, real Linux gurus know that the entry point to your program isn't in the object file <code>hello.o</code> at all.  Where is it?  Well, it's in the <a href=\"https://en.wikipedia.org/wiki/Crt0\" rel=\"nofollow noreferrer\">\"C runtime\"</a>, a little file that gets linked in by <code>gcc</code> when you actually create your executable:</p>\n\n<pre><code>$ nm /usr/lib/x86_64-linux-gnu/crt1.o\n0000000000000000 D __data_start\n0000000000000000 W data_start\n0000000000000000 R _IO_stdin_used\n                 U __libc_csu_fini\n                 U __libc_csu_init\n                 U __libc_start_main\n                 U main\n0000000000000000 T _start\n$\n</code></pre>\n\n<p>Note that this object file has an <strong>undefined</strong> reference to <code>main</code> which will be linked to your so-called entry point in <code>hello.o</code>.  It's this little stub defines the <em>real</em> entry point, namely <code>_start</code>.  You can tell this is the actual entry point because if you link the program into an executable, you'll see that the location of the <code>_start</code> symbol and the ELF entry point (which is the address to which the kernel actually first transfers control when you <code>execve()</code> your program) will coincide:</p>\n\n<pre><code>$ gcc -o hello hello.o\n$ nm hello | egrep 'T _start'\n0000000000400430 T _start\n$ readelf -h hello | egrep Entry\nEntry point address:               0x400430\n</code></pre>\n\n<p>All this is to say, the \"entry point\" of a program is actually a pretty complex concept.</p>\n\n<p>When you compile and run a C program with the LLVM toolchain instead of GCC, the situation is all pretty similar.  That's by design to keep everything compatible with GCC.  The so-called entry point in your <code>hello.ll</code> file is just the C function <code>main</code>, and it's not the <em>real</em> entry point of your program.  That's still provided by the <code>crt1.o</code> stub.</p>\n\n<p>Now, if we (finally) switch from talking about C to talking about Haskell, the Haskell runtime is, obviously, about a billion times more complicated than the C runtime, but it's been built on top of the C runtime.  So, when you compile a Haskell program the normal way:</p>\n\n<pre><code>$ ghc main.hs\nstack ghc -- main.hs\n[1 of 1] Compiling Main             ( main.hs, main.o )\nLinking main ...\n$\n</code></pre>\n\n<p>you can see that the executable has an entry point named <code>_start</code>:</p>\n\n<pre><code>$ nm main | egrep 'T _start'\n0000000000406560 T _start\n</code></pre>\n\n<p>which is actually the same C runtime stub as before that calls the C entry point:</p>\n\n<pre><code>$ nm main | egrep 'T main'\n0000000000406dc4 T main\n$ \n</code></pre>\n\n<p>but <em>this</em> <code>main</code> is not your Haskell <code>main</code>.  This <code>main</code> is a C <code>main</code> function in a program dynamically created by GHC at link time.  You can look at such a program by running:</p>\n\n<pre><code>$ ghc -v -keep-tmp-files -fforce-recomp main.hs\n</code></pre>\n\n<p>and rummaging around for a file named <code>ghc_4.c</code> somewhere in a <code>/tmp</code> subdirectory:</p>\n\n<pre><code>$ cat /tmp/ghc10915_0/ghc_4.c\n#include \"Rts.h\"\nextern StgClosure ZCMain_main_closure;\nint main(int argc, char *argv[])\n{\n RtsConfig __conf = defaultRtsConfig;\n __conf.rts_opts_enabled = RtsOptsSafeOnly;\n __conf.rts_opts_suggestions = true;\n __conf.rts_hs_main = true;\n return hs_main(argc,argv,&amp;ZCMain_main_closure,__conf);\n}\n</code></pre>\n\n<p>Now, do you see that external reference to <code>ZCMain_main_closure</code>?  That, believe it or not, is the Haskell entry point for your program, and you should find it in <code>main.o</code>, whether you compiled using the vanilla GHC pipeline or via the LLVM backend:</p>\n\n<pre><code>$ egrep ZCMain_main_closure main.ll\n%ZCMain_main_closure_struct = type &lt;{i64, i64, i64, i64}&gt;\n...\n</code></pre>\n\n<p>Now, it's not a \"function\".  It's a specially formatted data structure (a closure) that the Haskell runtime system understands.  The <code>hs_main()</code> function above (yet another entry point!) is the main entry point into the Haskell runtime:</p>\n\n<pre><code>$ nm ~/.stack/programs/x86_64-linux/ghc-8.4.3/lib/ghc-8.4.3/rts/libHSrts.a | egrep hs_main\n0000000000000000 T hs_main\n$\n</code></pre>\n\n<p>and it accepts a closure for a Haskell main function as the Haskell entry point to begin executing your program.</p>\n\n<p>So, if you went through all this trouble in the hopes of isolating a Haskell program in an <code>*.ll</code> file that you could somehow run directly by jumping to its entry point, then I've got some bad news for you...  ;)</p>\n"}], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 52086518, "answer_count": 1, "score": 1, "last_activity_date": 1535579228, "creation_date": 1535512884, "last_edit_date": 1535518945, "question_id": 52068999, "link": "https://stackoverflow.com/questions/52068999/compiled-haskell-program-to-llvm-ir-is-missing-main", "title": "Compiled Haskell program to LLVM IR is missing main", "body": "<p>following <a href=\"https://stackoverflow.com/questions/52040651/compile-haskell-programs-to-llvm-ir\">this SO post</a> regarding the compilation of Haskell programs\nto LLVM IR, I took the same Haskell program and tried to run its resulting LLVM IR code:</p>\n\n<pre><code>quicksort [] = []\nquicksort (p:xs) = (quicksort lesser) ++ [p] ++ (quicksort greater)\n  where\n    lesser  = filter (&lt;  p) xs\n    greater = filter (&gt;= p) xs\n\nmain = print(quicksort([5,2,1,0,8,3]))\n</code></pre>\n\n<p>I first compiled it to LLVM IR with</p>\n\n<pre><code>$ ghc -keep-llvm-files main.hs\n</code></pre>\n\n<p>Then I transformed it to bitcode with:</p>\n\n<pre><code>$ llvm-as main.ll\n</code></pre>\n\n<p>However, when I tried to run it with <code>lli</code> I get the following error regarding a missing main:</p>\n\n<pre><code>$ lli main.bc\n'main' function not found in module.\n</code></pre>\n\n<p>Am I doing something wrong? thanks.</p>\n\n<p>EDIT: (from answer by K. A. Buhr)</p>\n\n<pre><code>$ ls -l main*\nmain.hs\n$ ghc -keep-llvm-files main.hs\n[1 of 1] Compiling Main             ( main.hs, main.o )\nLinking main ...\n$ ls -l main*\nmain\nmain.hi\nmain.hs\nmain.ll\nmain.o\n$ rm main main.hi main.o\n$ llvm-as main.ll\n$ llc main.bc -filetype=obj -o main.o\n$ ghc -o main main.o\n$ ./main\n[0,1,2,3,5,8]\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "edited": false, "score": 0, "creation_date": 1535592021, "post_id": 52067201, "comment_id": 91126268, "body": "I have done this, and now I&#39;m getting an entirely <i>different</i> error:  src\\Graphics\\UI\\Grapefruit\\GTK.hs:182:67: error:         * Couldn&#39;t match expected type <code>Maybe model0&#39;                       with actual type </code>Gtk.ListStore el&#39;"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "edited": false, "score": 0, "creation_date": 1536456279, "post_id": 52067201, "comment_id": 91429907, "body": "Apparently the 8.4.3 compatible version has been released to Hackage - have you had any luck trying to install it again with that GHC version?"}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 2, "last_activity_date": 1535496684, "creation_date": 1535496684, "answer_id": 52067201, "question_id": 52066853, "link": "https://stackoverflow.com/questions/52066853/cant-install-grapefruit-on-windows-10/52067201#52067201", "title": "Can&#39;t install Grapefruit on Windows 10", "body": "<p>This is a <a href=\"https://github.com/conal/TypeCompose/issues/6\" rel=\"nofollow noreferrer\">known issue</a> with TypeCompose under 8.4, which <a href=\"https://github.com/conal/TypeCompose/pull/7\" rel=\"nofollow noreferrer\">has been fixed</a> but not put on Hackage yet.</p>\n\n<p>You might be able to configure your <code>cabal</code> commands with an older version of GHC (see <a href=\"https://stackoverflow.com/questions/7770100/using-cabal-with-multiple-ghc-versions\">this question</a>), such as 8.2.2, which shouldn't have this issue.</p>\n\n<p>Alternatively, use <code>stack</code>, which will let you switch ghc versions per-project, and which provides TypeCompose for 8.2.2 on the <a href=\"https://www.stackage.org/lts-11.22/package/TypeCompose-0.9.12\" rel=\"nofollow noreferrer\">LTS resolver</a>.</p>\n"}], "owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 52067201, "answer_count": 1, "score": 0, "last_activity_date": 1535498148, "creation_date": 1535494262, "last_edit_date": 1535498148, "question_id": 52066853, "link": "https://stackoverflow.com/questions/52066853/cant-install-grapefruit-on-windows-10", "title": "Can&#39;t install Grapefruit on Windows 10", "body": "<p>When running cabal install grapefruit-ui-gtk I get build errors on the dependency TypeCompose. The exact command I run is</p>\n\n<pre><code>cabal install grapefruit-ui-gtk\n</code></pre>\n\n<p>and get the following error output:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring TypeCompose-0.9.12...\nConfiguring hashtables-1.2.3.1...\nBuilding TypeCompose-0.9.12...\nBuilding hashtables-1.2.3.1...\nFailed to install TypeCompose-0.9.12\nBuild log ( C:\\Users\\me\\AppData\\Roaming\\cabal\\logs\\ghc-8.4.3\\TypeCompose-0.9.12-4FepCXFvbF94E2D2EggnNC.log ):\nPreprocessing library for TypeCompose-0.9.12..\nBuilding library for TypeCompose-0.9.12..\nsrc\\Data\\Title.hs:1:33: warning:\n    -XOverlappingInstances is deprecated: instead use per-instance pragmas OVERLAPPING/OVERLAPPABLE/OVERLAPS\n  |\n1 | {-# LANGUAGE FlexibleInstances, OverlappingInstances, TypeOperators, TypeSynonymInstances #-}\n  |                                 ^^^^^^^^^^^^^^^^^^^^\n[ 1 of 10] Compiling Control.Instances ( src\\Control\\Instances.hs, dist\\build\\Control\\Instances.o )\n[ 2 of 10] Compiling Data.Bijection   ( src\\Data\\Bijection.hs, dist\\build\\Data\\Bijection.o )\n[ 3 of 10] Compiling Control.Compose  ( src\\Control\\Compose.hs, dist\\build\\Control\\Compose.o )\nsrc\\Control\\Compose.hs:596:10: error:\n    * Could not deduce (Semigroup (Flip j o a))\n        arising from the superclasses of an instance declaration\n      from the context: (Applicative (j a), Monoid o)\n        bound by the instance declaration\n        at src\\Control\\Compose.hs:596:10-61\n    * In the instance declaration for `Monoid (Flip j o a)'\n    |\n596 | instance (Applicative (j a), Monoid o) =&gt; Monoid (Flip j o a) where\n    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nsrc\\Control\\Compose.hs:645:10: error:\n    * Could not deduce (Semigroup (App f m))\n        arising from the superclasses of an instance declaration\n      from the context: (Applicative f, Monoid m)\n        bound by the instance declaration\n        at src\\Control\\Compose.hs:645:10-54\n    * In the instance declaration for `Monoid (App f m)'\n    |\n645 | instance (Applicative f, Monoid m) =&gt; Monoid (App f m) where\n    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nsrc\\Control\\Compose.hs:851:1: error:\n    * Could not deduce (Semigroup (Arrw j f g a))\n        arising from the superclasses of an instance declaration\n      from the context: Monoid (j (f a) (g a))\n        bound by the instance declaration\n        at src\\Control\\Compose.hs:851:1-63\n    * In the instance declaration for `Monoid (Arrw j f g a)'\n    |\n851 | deriving instance Monoid (f a `j` g a) =&gt; Monoid (Arrw j f g a)\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncabal: Leaving directory 'C:\\Users\\me\\AppData\\Local\\Temp\\cabal-tmp-17748\\TypeCompose-0.9.12'\nInstalled hashtables-1.2.3.1\ncabal.exe: Error: some packages failed to install:\nTypeCompose-0.9.12-4FepCXFvbF94E2D2EggnNC failed during the building phase.\nThe exception was:\nExitFailure 1\ngrapefruit-frp-0.1.0.7-28vOfRvsiGH71mjsrgG35Q depends on\ngrapefruit-frp-0.1.0.7 which failed to install.\ngrapefruit-records-0.1.0.7-Ih2DxRIbFnG7TB7BHtPbwq depends on\ngrapefruit-records-0.1.0.7 which failed to install.\ngrapefruit-ui-0.1.0.7-DMol4wZpyyFEHFP2NRKthr depends on grapefruit-ui-0.1.0.7\nwhich failed to install.\ngrapefruit-ui-gtk-0.1.0.7-EsNz0f5KGlp47W2BX85WRG depends on\ngrapefruit-ui-gtk-0.1.0.7 which failed to install.\n</code></pre>\n\n<p>GHC Version:</p>\n\n<blockquote>\n  <p>The Glorious Glasgow Haskell Compilation System, version 8.4.3</p>\n</blockquote>\n\n<p>Cabal version:</p>\n\n<blockquote>\n  <p>cabal-install version 2.2.0.0 compiled using version 2.2.0.1 of the\n  Cabal library</p>\n</blockquote>\n\n<p>What could be causing this issue? I have tried installing it in a fresh directory with cabal init, and that didn't seem to have any effect.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1535477236, "post_id": 52063243, "comment_id": 91077155, "body": "Why not perform a <code>grep</code> over the source code? <code>undefined</code> would be a very strange variable name."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1535477800, "post_id": 52063243, "comment_id": 91077398, "body": "@WillemVanOnsem It\u2019s much easier to mechanically enforce zero warnings in CI (with <code>-Werror</code>), and a warning will integrate nicely with editor tooling that already handles compiler warnings. Manually <code>grep</code>ing is much more ad-hoc."}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1535484448, "post_id": 52063243, "comment_id": 91080464, "body": "@AlexisKing correct me if wrong, I don&#39;t think GHC has any option to warn the usage of <code>undefined</code>, and this is what @willem-van-onsem is trying to solve. Although I learned the typed holes is a better way than <code>undefined</code> to achieve what I wanted to do."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 22, "last_activity_date": 1535477305, "last_edit_date": 1535477305, "creation_date": 1535476914, "answer_id": 52063340, "question_id": 52063243, "link": "https://stackoverflow.com/questions/52063243/can-haskell-compiler-give-warning-on-functions-that-used-undefined/52063340#52063340", "title": "can Haskell compiler give warning on functions that used &quot;undefined&quot;", "body": "<p>A good solution is to use typed holes instead of <code>undefined</code> along with the <code>-fdefer-typed-holes</code> compiler flag to make them warnings instead of errors (which is generally more useful, anyway). With this flag enabled, you would write your example like this, instead:</p>\n\n<pre><code>add2 :: Int -&gt; Int -&gt; Int\nadd2 = _\n</code></pre>\n\n<p>\u2026which produces the following warning:</p>\n\n<pre><code>warning: [-Wtyped-holes]\n    \u2022 Found hole: _ :: Int -&gt; Int -&gt; Int\n    \u2022 In the expression: _\n      In an equation for \u2018add2\u2019: add2 = _\n    \u2022 Relevant bindings include\n        add2 :: Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>Modern GHCs will even include a list of possible substitutions for the hole in the warning:</p>\n\n<pre><code>      Valid substitutions include\n        add2 :: Int -&gt; Int -&gt; Int\n        (+) :: forall a. Num a =&gt; a -&gt; a -&gt; a\n          (imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Num\u2019))\n        (*) :: forall a. Num a =&gt; a -&gt; a -&gt; a\n          (imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Num\u2019))\n        (^) :: forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a\n          (imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Real\u2019))\n        (-) :: forall a. Num a =&gt; a -&gt; a -&gt; a\n          (imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Num\u2019))\n        seq :: forall a b. a -&gt; b -&gt; b\n          (imported from \u2018Prelude\u2019 (and originally defined in \u2018GHC.Prim\u2019))\n        (Some substitutions suppressed; use -fmax-valid-substitutions=N or -fno-max-valid-substitutions)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1535512436, "post_id": 52068449, "comment_id": 91087802, "body": "It&#39;s worth pointing out that if you look at the source you&#39;ll see that it&#39;s just <code>undefined = Prelude.undefined</code>; the new definition allows them to add a warning pragma, so you could easily make your own version of undefined that does this. The virtue of it being in a custom prelude is that you generally set up a whole project to use it, which makes it harder to accidentally use the standard version instead of the new one (which wouldn&#39;t trigger the warning)."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 4, "last_activity_date": 1535507697, "creation_date": 1535507697, "answer_id": 52068449, "question_id": 52063243, "link": "https://stackoverflow.com/questions/52063243/can-haskell-compiler-give-warning-on-functions-that-used-undefined/52068449#52068449", "title": "can Haskell compiler give warning on functions that used &quot;undefined&quot;", "body": "<p>Some alternative preludes export their own version of <code>undefined</code> with warning added so you will see warning during compilation if you left <code>undefined</code>.</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/relude-0.2.0/docs/Relude-Debug.html#v:undefined\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/relude-0.2.0/docs/Relude-Debug.html#v:undefined</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 2458, "user_id": 3335966, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gDVU2.png?s=128&g=1", "display_name": "user3335966", "link": "https://stackoverflow.com/users/3335966/user3335966"}, "is_accepted": false, "score": 3, "last_activity_date": 1551582317, "last_edit_date": 1551582317, "creation_date": 1551581162, "answer_id": 54965109, "question_id": 52063243, "link": "https://stackoverflow.com/questions/52063243/can-haskell-compiler-give-warning-on-functions-that-used-undefined/54965109#54965109", "title": "can Haskell compiler give warning on functions that used &quot;undefined&quot;", "body": "<p>If You are using <a href=\"https://github.com/ndmitchell/hlint\" rel=\"nofollow noreferrer\"><code>hlint</code></a>, You can add this rule to your <code>.hlint.yaml</code>:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>- warning: {lhs: \"undefined\", rhs: undefined}\n</code></pre>\n\n<p>for warnings like:</p>\n\n<blockquote>\n  <p>Use alternative. Replace with: undefined</p>\n</blockquote>\n\n<p>or You can add your own description with <code>name</code> attribute, for example:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>- warning: {lhs: \"undefined\", rhs: undefined, name: Realisation is required}\n</code></pre>\n\n<blockquote>\n  <p>Realisation is required. Replace with: undefined</p>\n</blockquote>\n\n<p>You can use <a href=\"https://github.com/ndmitchell/hlint#automatically-applying-hints\" rel=\"nofollow noreferrer\">automatic refactoring</a> safely, because of it just replace <code>undefined</code> to <code>undefined</code> and does not broke anything.</p>\n\n<p>Also You can ignore this rule (with <code>name</code> attribute) for specific function:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# ANN functionName \"HLint: ignore Realisation is required\" #-}\nfunctionName :: Int -&gt; Int\nfunctionName x = undefined\n</code></pre>\n\n<p>or for module: <code>{-# ANN module \"HLint: ignore Realisation is required\" #-}</code></p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 52063340, "answer_count": 3, "score": 12, "last_activity_date": 1551582317, "creation_date": 1535476532, "question_id": 52063243, "link": "https://stackoverflow.com/questions/52063243/can-haskell-compiler-give-warning-on-functions-that-used-undefined", "title": "can Haskell compiler give warning on functions that used &quot;undefined&quot;", "body": "<p>If I define a function using \"undefined\" like this, it type-checks.</p>\n\n<pre><code>add2 :: Int -&gt; Int -&gt; Int\nadd2 = undefined\n</code></pre>\n\n<p>Is it possible to detect if any function is using \"undefined\" in the function definition, and turn it into a warning?</p>\n\n<p>It would be useful that in development-phase, I can use \"undefined\" to check if the type signature is correct before I implement the function. And then on production I can have some way to catch the mistakes that I forgot to give implementation for functions that had \"undefined\".</p>\n"}, {"tags": ["haskell", "terminology"], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 10, "creation_date": 1535462392, "post_id": 52058810, "comment_id": 91068080, "body": "I would say it&#39;s the other way round: <code>f</code> (the function) is applied to <code>x</code> (the argument)."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1535462539, "post_id": 52058810, "comment_id": 91068178, "body": "@melpomene Ah, apologies I&#39;m not sure what interpretation makes more sense in english."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535469692, "post_id": 52058810, "comment_id": 91072894, "body": "For additional fun @Mr.Eivind might also want to know the term &quot;partial function application&quot;.  Consider a function that takes more than one argument <code>(+) :: Int -&gt; Int -&gt; Int</code>.  By providing fewer arguments than the function can take - partially applying the function - we can produce a new function <code>f = (42 +) :: Int -&gt; Int</code>.  This new function, defined by partially applying <code>+</code>, will increment any provided value by 42."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1535485646, "post_id": 52058810, "comment_id": 91080977, "body": "&quot;function application&quot; comes from math and &quot;x is applied to f&quot; is simply incorrect usage (in the same way you don&#39;t apply your skin to the lotion), so I&#39;d recommend just changing the answer. Another nice thing to add might be to point out clearly that when talking about &quot;function application&quot; we&#39;re speaking about a particular <i>syntactic construct</i> (i.e. <i>function application</i> is something GHC&#39;s parser understands) rather than e.g. a property of program evaluation."}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "edited": false, "score": 0, "creation_date": 1535502216, "post_id": 52058810, "comment_id": 91085815, "body": "Good source with examples: <a href=\"http://learnyouahaskell.com/higher-order-functions#function-application\" rel=\"nofollow noreferrer\">learnyouahaskell.com/&hellip;</a>"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1535511648, "post_id": 52058810, "comment_id": 91087650, "body": "It might not matter to this example whether we apply functions to arguments or apply arguments to functions, but the OP (and others who find this question in future) is trying to learn the terminology. Given functions are also values, there can be real confusion if I say &quot;apply f to g&quot; and one of us thinks that means <code>f g</code> and the other thinks it means <code>g f</code>. Staying consistent with the mathematical usage (which is also a more natural fit for the ordinary English meaning of apply in my opinion) will make this a better answer."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1535513574, "post_id": 52058810, "comment_id": 91088027, "body": "Yeah I like &quot;apply <code>f</code> to <code>x</code>&quot; and &quot;pass <code>x</code> to <code>f</code>&quot;"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 8, "last_activity_date": 1535462916, "last_edit_date": 1535462916, "creation_date": 1535461920, "answer_id": 52058810, "question_id": 52058692, "link": "https://stackoverflow.com/questions/52058692/the-term-function-application-in-haskell/52058810#52058810", "title": "The term &quot;function application&quot; in Haskell", "body": "<p>\"Function application\" here just means more or less the same thing as \"passing an argument to the function\". For example, if you have a function <code>f :: Int -&gt; Int</code> and an <code>x :: Int</code> then <code>f x :: Int</code> is an expression where the expression <code>x</code> is \"applied\" as an argument to <code>f</code> *.</p>\n\n<p>There is no real built-in operator for doing function application in Haskell (other than the whitespace that separates a function from its argument). <code>Prelude</code> exports the <code>($)</code> function though, which is (some unusual oddities aside) just function application: i.e. <code>($) f x</code> is the same as <code>f x</code> (this is mostly used for some syntactic tricks, although it occasionally has other uses as well)</p>\n\n<hr>\n\n<p>*: It's been pointed out to me that people usually think of this in terms of applying a function to an argument rather than an argument to a function, I don't think this makes much difference for understanding the meaning of application here though</p>\n"}, {"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 1, "creation_date": 1535470420, "post_id": 52058941, "comment_id": 91073395, "body": "I really like this answer, short and sweet, not a single char is wasted"}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 3, "last_activity_date": 1535462327, "creation_date": 1535462327, "answer_id": 52058941, "question_id": 52058692, "link": "https://stackoverflow.com/questions/52058692/the-term-function-application-in-haskell/52058941#52058941", "title": "The term &quot;function application&quot; in Haskell", "body": "<p>\"Applying\" a function is the same as calling it, by supplying an argument.</p>\n\n<pre><code>-- A function\nf :: a -&gt; a\nf x = x\n\n-- Application of f\nf 100\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535484055, "post_id": 52061583, "comment_id": 91080292, "body": "The last three require the <code>TupleSections</code> option to be enabled. <code>(,)</code> is a constructor, not a an ordinary function."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1535470377, "creation_date": 1535470377, "answer_id": 52061583, "question_id": 52058692, "link": "https://stackoverflow.com/questions/52058692/the-term-function-application-in-haskell/52061583#52061583", "title": "The term &quot;function application&quot; in Haskell", "body": "<p>Another examples:</p>\n\n<pre><code>data C = A Int Int | B String\n\nf1 :: Int -&gt; Int -&gt; C\nf1 = A\n\nf2 :: Int -&gt; C\nf2 = A 4\n\nf3 = (4,) \n\nf4 = (,5)\n\nf5 = (,)\n</code></pre>\n\n<p>I let you play with the types of the last ones.</p>\n\n<p>so, <code>A</code> and <code>B</code> are also functions, <code>B</code> is waiting for a <code>String</code>, and returns a new type, <code>C</code> . Same concept with <code>(,)</code> constructor of tuples.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 4, "last_activity_date": 1535516876, "last_edit_date": 1535516876, "creation_date": 1535514872, "answer_id": 52069222, "question_id": 52058692, "link": "https://stackoverflow.com/questions/52058692/the-term-function-application-in-haskell/52069222#52069222", "title": "The term &quot;function application&quot; in Haskell", "body": "<p>It's mostly just standard English usage.</p>\n\n<p>\"Function application\" is just application specifically of functions. \"Application\" in this context is just the noun corresponding to the verb \"apply\"; it means the act or process of applying something.</p>\n\n<p>To \"apply something\" means to use it. To \"apply A to B\" means to do something to B using A. So \"apply a function\" means to use/call the function on something. In Haskell when I write the expression <code>f x</code> I am applying <code>f</code> to <code>x</code>.</p>\n\n<p>Thus \"function application\" is just a term for the general concept of applying functions. In specific contexts it might be used to talk about:</p>\n\n<ol>\n<li>The broad notion of applying functions in general</li>\n<li>The syntax used to express \"apply this function to that argument\" in a programming language (e.g. \"function application is by adjacency in Haskell\", or \"function application in Python uses C-like syntax\")</li>\n<li>A specific bit of code that is applying a function</li>\n<li>In Haskell <code>$</code> is often explained as \"the function application operator\", since <code>f $ x = f x</code> is more-or-less its definition</li>\n</ol>\n\n<p>Or anything related.</p>\n"}], "owner": {"reputation": 199, "user_id": 10226775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QoLra.jpg?s=128&g=1", "display_name": "Mr. Eivind", "link": "https://stackoverflow.com/users/10226775/mr-eivind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 1, "accepted_answer_id": 52069222, "answer_count": 4, "score": 6, "last_activity_date": 1535516876, "creation_date": 1535461587, "last_edit_date": 1535463726, "question_id": 52058692, "link": "https://stackoverflow.com/questions/52058692/the-term-function-application-in-haskell", "title": "The term &quot;function application&quot; in Haskell", "body": "<p>I'm currently learning Haskell, and have encountered the term \"function application\" a couple of times, without really understanding what is meant by it.</p>\n\n<p>Could someone try to explain the meaning of the term in Haskell, or eventually in general?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 521, "user_id": 6487607, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/uxjSW.jpg?s=128&g=1", "display_name": "ozata", "link": "https://stackoverflow.com/users/6487607/ozata"}, "is_accepted": false, "score": 1, "last_activity_date": 1535438664, "creation_date": 1535438664, "answer_id": 52051642, "question_id": 52051435, "link": "https://stackoverflow.com/questions/52051435/haskell-multiply-index/52051642#52051642", "title": "Haskell multiply index", "body": "<pre><code>ML :: [Int] -&gt; Int -&gt; [Int]\nML [] _ = []\nML (x:xs) n = x * n : ML xs n+1\n</code></pre>\n\n<p>try this one instead. Pass the index of the elements as another parameter :)</p>\n"}, {"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 10, "last_activity_date": 1535447254, "last_edit_date": 1535447254, "creation_date": 1535438676, "answer_id": 52051643, "question_id": 52051435, "link": "https://stackoverflow.com/questions/52051435/haskell-multiply-index/52051643#52051643", "title": "Haskell multiply index", "body": "<p>Yes, <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:zipWith\" rel=\"noreferrer\">zipWith</a> function can help with it:</p>\n\n<pre><code>zipWith (*) [0..] [6, 3, 5, 1]\n</code></pre>\n\n<p>returns <code>[0, 3, 10, 3]</code></p>\n\n<p>The current code doesn't work, because it just calls <code>x * x - 1</code> on the current element, but <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:zipWith\" rel=\"noreferrer\">zipWith</a> is a function, which zips your list with a list of indexes (<code>zip [0..] [6, 3, 5, 1]</code> equals <code>[(0, 6), (1, 3), (2, 5), (3, 1)]</code>) and then evaluates the passed function, which takes 2 arguments on every element. It's something similar to:</p>\n\n<pre><code>map (uncurry (*)) $ zip [0..] [6, 3, 5, 1]\n</code></pre>\n\n<p>Thus, the function definition is:</p>\n\n<pre><code>ml :: Num c =&gt; [c] -&gt; [c]\nml = zipWith (*) [0..]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 31, "user_id": 6880337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23da12cfccda50beca37c48081536ce7?s=128&d=identicon&r=PG&f=1", "display_name": "stephan", "link": "https://stackoverflow.com/users/6880337/stephan"}, "edited": false, "score": 0, "creation_date": 1535439911, "post_id": 52051710, "comment_id": 91054046, "body": "@stephan The result <i>does</i> start with 0. <code>ml [6,5,3,1]</code> results in <code>[0,3,10,3]</code> (with the last definition I&#39;ve given). This fits exactly the result you&#39;ve wanted for this input. otherwise I&#39;m not sure what you mean by &quot;start from 0&quot;."}, {"owner": {"reputation": 31, "user_id": 6880337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23da12cfccda50beca37c48081536ce7?s=128&d=identicon&r=PG&f=1", "display_name": "stephan", "link": "https://stackoverflow.com/users/6880337/stephan"}, "edited": false, "score": 0, "creation_date": 1535439946, "post_id": 52051710, "comment_id": 91054061, "body": "got it !! I really appriated"}, {"owner": {"reputation": 1323, "user_id": 2415161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8192ef3e3b566c9357604da1b7e310b?s=128&d=identicon&r=PG", "display_name": "Hermann D&#246;ppes", "link": "https://stackoverflow.com/users/2415161/hermann-d%c3%b6ppes"}, "edited": false, "score": 3, "creation_date": 1535443032, "post_id": 52051710, "comment_id": 91055788, "body": "While this answer certainly works, it does not use the advantages functional languages have over imperative / iterative languages (on the contrary, it practically shows of the disadvantages). To see more haskellian approaches, I recommend the answers by <a href=\"https://stackoverflow.com/a/52051643/2415161\">Igor Drozdov</a> and <a href=\"https://stackoverflow.com/a/52052427/2415161\">amalloy</a>."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1535514435, "post_id": 52051710, "comment_id": 91088174, "body": "About some terminology: in the Haskell Report, \u201cfixity\u201d refers to <i>associativity</i> (left, right, none), although the <i>precedence</i> is part of a \u201cfixity declaration\u201d. Elsewhere, \u201cfixity\u201d usually refers to where an operator appears relative to its operands\u2014prefix, infix, postfix, mixfix, distfix, circumfix\u2026\u2014but Haskell only has infix operators. Postfix is <i>sort of</i> supported with the <code>PostfixOperators</code> language pragma, but parentheses are always required because it works by desugaring the operator section <code>(x \u25c7)</code> into <code>(\u25c7) x</code> instead of <code>\\y -&gt; x \u25c7 y</code> for some expression <code>x</code> and operator <code>\u25c7</code>."}], "tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 8, "last_activity_date": 1535439962, "last_edit_date": 1535439962, "creation_date": 1535438959, "answer_id": 52051710, "question_id": 52051435, "link": "https://stackoverflow.com/questions/52051435/haskell-multiply-index/52051710#52051710", "title": "Haskell multiply index", "body": "<p>Your code, as written (assuming the function name is actually a valid function name like <code>ml</code>) was parsed as:</p>\n\n<pre><code>ml :: [Int] -&gt; [Int]\nml [] = []\nml (x:xs) = ((x * x)-1) : (ml xs)\n</code></pre>\n\n<p>This is because <code>(*)</code> has higher fixity(precedence) than <code>(+)</code>, which again has higher fixity than <code>(:)</code>, and function application <code>ml xs</code> has the highest fixity.<br>\nThat is you are changing each element to its square, and subtracting 1.</p>\n\n<p>Now what you actually want is some way to know the index of the element.<br>\nThis can be achieved by using an extra argument in the recursion.  </p>\n\n<pre><code>ml :: Int -&gt; [Int] -&gt; [Int]\nml _ [] = []\nml i (x:xs) = x*i : ml (i+1) xs\n</code></pre>\n\n<p>But then notice that our function's signature changed, we are now accepting an extra <code>Int</code> parameter, and we are expecting the user to call as with <code>ml 0 someList</code>, but we don't want to rely on the user passing valid data, and we want the user to just pass the list. So we can rename this function to some other name, say <code>ml_internal</code> and have <code>ml</code> be the correct code</p>\n\n<pre><code>ml :: [Int] -&gt; [Int]\nml xs = ml_internal 0 xs\n\nml_internal :: Int -&gt; [Int] -&gt; [Int]\nml_internal _ [] = []\nml_internal i (x:xs) = x*i : ml_internal (i+1) xs\n</code></pre>\n\n<p>Now we don't want to expose <code>ml_internal</code>, we could do this by putting this code in a module and only exporting <code>ml</code>, but there's no reason to do that. We also might not want <code>ml_internal</code> to be available to other functions in the same module. So what we can do is put <code>ml_internal</code> in a <code>where</code> clause for <code>ml</code>:</p>\n\n<pre><code>ml :: [Int] -&gt; [Int]\nml xs = ml_internal 0 xs\n  where\n    ml_internal :: Int -&gt; [Int] -&gt; [Int]\n    ml_internal _ [] = []\n    ml_internal i (x:xs) = x*i : ml_internal (i+1) xs\n</code></pre>\n\n<p>Now we can also omit <code>ml_internal</code>'s type signature, since it can be inferred, and in some cases the compiler can't handle the explicit signature correctly without a language extension called <code>ScopedTypeVariables</code> enabled.<br>\nWe can also rename <code>ml_internal</code> to <code>go</code>, which is a widely used name for such constructs, to get to the following code for <code>ml</code>:</p>\n\n<pre><code>ml :: [Int] -&gt; [Int]\nml xs = go 0 xs\n  where\n    go _ [] = []\n    go i (x:xs) = x*i : go (i+1) xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1535441911, "last_edit_date": 1535441911, "creation_date": 1535441593, "answer_id": 52052427, "question_id": 52051435, "link": "https://stackoverflow.com/questions/52051435/haskell-multiply-index/52052427#52052427", "title": "Haskell multiply index", "body": "<p>You don't actually need to look at indexes at all to solve this problem! Try this implementation:</p>\n\n<pre><code>ml :: Num a =&gt; [a] -&gt; [a]\nml [] = []\nml (_:xs) = 0 : zipWith (+) xs (ml xs)\n</code></pre>\n\n<p>Rather than multiplying the nth element by n directly, we instead arrange to add together n copies of the nth element, one at a time. Surely slower than the iterative approach with explicit multiplication, but I think rather instructive for how it avoids mentioning indexes even once.</p>\n\n<p>In real code, I would just use the <code>zipWith (*)</code> implementation proposed in another answer.</p>\n"}], "owner": {"reputation": 31, "user_id": 6880337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23da12cfccda50beca37c48081536ce7?s=128&d=identicon&r=PG&f=1", "display_name": "stephan", "link": "https://stackoverflow.com/users/6880337/stephan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 1, "accepted_answer_id": 52051710, "answer_count": 4, "score": 0, "last_activity_date": 1535447254, "creation_date": 1535437770, "last_edit_date": 1535442435, "question_id": 52051435, "link": "https://stackoverflow.com/questions/52051435/haskell-multiply-index", "title": "Haskell multiply index", "body": "<p>If I wanted to returns a list whose elements are\nequal to the corresponding element of the input list multiplied by its location in the list, I could do something like the following:</p>\n\n<pre><code>ML :: [Int] -&gt; [Int]\nML [] = []\nML (x:xs) =  x * x-1 : ML xs \n</code></pre>\n\n<p>But the corresponding list I got when I entered <code>[6,3,5,1]</code> gives the result of <code>[35,8,24,0]</code><br>\nIs there a similar way I could get <code>[0,3,10,3]</code> </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1535436874, "post_id": 52051203, "comment_id": 91052584, "body": "There is no data constructor <code>M</code>, only <code>Raise</code> and <code>Return</code>, so you will need to implement those two cases."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 3, "creation_date": 1535438018, "post_id": 52051203, "comment_id": 91053100, "body": "Another reason to use the <code>deriving</code> mechanism - other than saving writing code - is that Haskell will generate an instance that properly handles precedence and nesting of data. So something like <code>show (Return (Con 4))</code> will properly result in the string <code>&quot;Return (Con 4)&quot;</code> rather than <code>&quot;Return Con 4&quot;</code> (assuming a proper <code>Show</code> instance for <code>Term</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1535437463, "creation_date": 1535437463, "answer_id": 52051362, "question_id": 52051203, "link": "https://stackoverflow.com/questions/52051203/monads-for-functional-programming-2-2-variation-one-exceptions/52051362#52051362", "title": "Monads for Functional Programming, 2.2 Variation one: Exceptions", "body": "<p>If you want to do it manually, you have to do something like</p>\n\n<pre><code>instance (Show a) =&gt; Show (M a) where\n    show (Raise e)  = \"Raise \" ++ show e\n    show (Return a) = \"Return \" ++ show a\n</code></pre>\n\n<p>Your type (<code>M a</code>) has two data constructors, <code>Raise</code> and <code>Return</code>.</p>\n\n<p>The easy solution is to just say</p>\n\n<pre><code>data M a = Raise Exception | Return a\n    deriving (Show)\n</code></pre>\n\n<p>Alternatively you can also manually deconstruct <code>M a</code> values every time you want to inspect them in ghci:</p>\n\n<pre><code>case eval answer of { Raise e -&gt; \"An error occurred: \" ++ e; Return x -&gt; show x }\n-- instead of 'eval answer'\n</code></pre>\n\n<p>But that gets annoying quickly.</p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 7613834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea8158e7d0ab6914cced8325d33174d?s=128&d=identicon&r=PG&f=1", "display_name": "Mitchell Turner", "link": "https://stackoverflow.com/users/7613834/mitchell-turner"}, "edited": false, "score": 0, "creation_date": 1535499563, "post_id": 52051373, "comment_id": 91085327, "body": "Thanks! That worked. The deriving tool is pretty slick, but I can see why you might want to have custom implementations. For example, it might make sense for the <code>show (Return a)</code> to just be just <code>show a</code>, and have the <code>show (Raise a)</code> case to be <code>&quot;Exception: &quot; ++ show a</code>, or something."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1535437501, "creation_date": 1535437501, "answer_id": 52051373, "question_id": 52051203, "link": "https://stackoverflow.com/questions/52051203/monads-for-functional-programming-2-2-variation-one-exceptions/52051373#52051373", "title": "Monads for Functional Programming, 2.2 Variation one: Exceptions", "body": "<p>The added <code>Show</code> instance will not work for two reasons:</p>\n\n<ol>\n<li>there is no constraint that says that the <code>a</code> of <code>M a</code> is an instance of <code>Show</code>; and</li>\n<li>the <code>M</code> data type has no data constructor <code>M</code>, it has a <code>Raise</code>, and a <code>Return</code>.</li>\n</ol>\n\n<p>So a straightforward implementation would look like:</p>\n\n<pre><code>instance Show a =&gt; Show (M a) where\n    show (Raise a) = \"Raise \" ++ show a\n    show (Return a) = \"Return \" ++ show a\n</code></pre>\n\n<p>But we can save us the trouble, and let Haskell automatically derive an instance for <code>Show</code> with:</p>\n\n<pre><code>data M a = Raise Exception | Return a <b>deriving Show</b></code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7613834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea8158e7d0ab6914cced8325d33174d?s=128&d=identicon&r=PG&f=1", "display_name": "Mitchell Turner", "link": "https://stackoverflow.com/users/7613834/mitchell-turner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 52051373, "answer_count": 2, "score": 1, "last_activity_date": 1535437501, "creation_date": 1535436682, "question_id": 52051203, "link": "https://stackoverflow.com/questions/52051203/monads-for-functional-programming-2-2-variation-one-exceptions", "title": "Monads for Functional Programming, 2.2 Variation one: Exceptions", "body": "<p>I've been working on understanding Monads in Haskell a bit better so I've started reading Philip Wadler's paper <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf\" rel=\"nofollow noreferrer\">Monads for functional programming</a>. In order to internalize the principles a bit better, and expose myself to as much Haskell code as possible, I decided I would code up and test all the examples as I go through the paper.</p>\n\n<p>Right off <strong>2.2 Variation one: Exceptions</strong> is giving me a little trouble. Here is my code.</p>\n\n<pre><code>data Term = Con Int | Div Term Term\ndata M a = Raise Exception | Return a\ntype Exception = String\n\nanswer, error_ :: Term\nanswer = (Div (Div (Con 1972) (Con 2)) (Con 23))\nerror_ = (Div (Con 1) (Con 0))\n\neval :: Term -&gt; M Int\neval (Con a) = Return a\neval (Div t u) = case eval t of \n                    Raise e -&gt; Raise e\n                    Return a -&gt;\n                        case eval u of \n                            Raise e -&gt; Raise e\n                            Return b -&gt;\n                                if  b == 0 \n                                    then Raise \"divide by zero\"\n                                    else Return (a `div` b)\n</code></pre>\n\n<p>I can load the code into GHCi, but when I try to run </p>\n\n<pre><code>eval answer\n</code></pre>\n\n<p>it throws the error</p>\n\n<pre><code>No instance for (Show (M Int)) arising from a use of \u2018print\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I read <a href=\"https://stackoverflow.com/a/37119750/7613834\">this</a> post which explains why \u2018print\u2019 is being called and concluded that maybe I needed to add an instance to Show for M a. But when I added </p>\n\n<pre><code>instance Show (M a) where\nshow (M a) = show a\n</code></pre>\n\n<p>to my code I tried to reload the file I got this error.</p>\n\n<pre><code>Not in scope: data constructor \u2018M\u2019\n</code></pre>\n\n<p>This confused me at first but <a href=\"https://stackoverflow.com/a/18205862/7613834\">this</a> post explains that I was defining a type constructor not a data constructor.</p>\n\n<p>Anyway, I feel like I am going down a rabbit hole that may or may not have the solution and I figured I'd post the question over here. My code looks to be line-for-line the same as his code. What changes do I need to make to make the code run in GHCi? </p>\n"}, {"tags": ["haskell", "hindley-milner", "category-abstractions"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1535410493, "post_id": 52047835, "comment_id": 91046684, "body": "There is no difference for functions. <code>&lt;&lt;&lt;</code> is just generalised, like what <code>fmap</code> is to <code>map</code>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1535410319, "post_id": 52047919, "comment_id": 91046644, "body": "Historical note: <code>(&lt;&lt;&lt;)</code> probably wouldn&#39;t exist if not for its heritage in <code>Control.Arrow</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1535430905, "post_id": 52047919, "comment_id": 91050643, "body": "You might want to mention the connection to <code>&gt;=&gt;</code>, <code>&lt;=&lt;</code>, and <code>Kleisli</code>, which indirectly bridge the gap between <code>&gt;&gt;&gt;</code> and <code>&gt;&gt;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535463747, "post_id": 52047919, "comment_id": 91068950, "body": "@dfeuer I&#39;d welcome an edit to that affect (or a separate answer). I don&#39;t think I could do that topic justice."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1535411039, "last_edit_date": 1535411039, "creation_date": 1535410256, "answer_id": 52047919, "question_id": 52047835, "link": "https://stackoverflow.com/questions/52047835/what-is-the-difference-between-and-when-performing-function-compositio/52047919#52047919", "title": "What is the difference between &#39;.&#39; and &#39;&lt;&lt;&lt;&#39; when performing function composition?", "body": "<p>First, you should recognize that <code>(.)</code> is defined in the Prelude in a function-specific form</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c \n</code></pre>\n\n<p>as well as a more generic function provided by the <code>Category</code> class:</p>\n\n<pre><code>class Category cat where\n    -- | the identity morphism\n    id :: cat a a\n\n    -- | morphism composition\n    (.) :: cat b c -&gt; cat a b -&gt; cat a c\n</code></pre>\n\n<p>The <code>(-&gt;)</code> instance of <code>Category</code> makes clear that the two are the same for functions:</p>\n\n<pre><code>instance Category (-&gt;) where\n    id = GHC.Base.id\n    (.) = (GHC.Base..)\n</code></pre>\n\n<p>The definition of <code>(&lt;&lt;&lt;)</code> makes clear that it is just a synonym of <code>(.)</code></p>\n\n<pre><code>-- | Right-to-left composition\n(&lt;&lt;&lt;) :: Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c\n(&lt;&lt;&lt;) = (.)\n</code></pre>\n\n<p>intended for symmetry with the <code>(&gt;&gt;&gt;)</code> operator. You can write either <code>f &gt;&gt;&gt; g</code> or <code>g &lt;&lt;&lt; f</code>, whichever makes more sense for your particular use.</p>\n\n<hr>\n\n<p><code>(&gt;&gt;)</code> is an entirely different operator (at least, as long as you aren't delving too much into the theory of monads). <code>(&gt;&gt;)</code> is a version of <code>(&gt;&gt;=)</code> that ignores the result of the first operand, using it only for its effect.</p>\n\n<pre><code>x &gt;&gt; y == x &gt;&gt;= (\\_ -&gt; y)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535484648, "post_id": 52057999, "comment_id": 91080559, "body": "Roughly speaking, <code>Category</code> is to Atkey-style indexed applicative functor as <code>Monoid</code> is to <code>Applicative</code>. <code>Category</code> comes up very naturally as the constraint on the result of a fold over a type-aligned structure, just as <code>Monoid</code> does for a fold over a uniform structure."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1535490827, "post_id": 52057999, "comment_id": 91082964, "body": "Just because if you do <i>X</i> then <i>Y</i> comes up naturally, doesn&#39;t mean that <i>X</i> is necessarily a good representation for why <i>Y</i> is interesting."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535495000, "post_id": 52057999, "comment_id": 91084278, "body": "That&#39;s definitely true."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1535459798, "last_edit_date": 1535459798, "creation_date": 1535459497, "answer_id": 52057999, "question_id": 52047835, "link": "https://stackoverflow.com/questions/52047835/what-is-the-difference-between-and-when-performing-function-compositio/52057999#52057999", "title": "What is the difference between &#39;.&#39; and &#39;&lt;&lt;&lt;&#39; when performing function composition?", "body": "<p>A purely syntactic difference, that despite being superficial may actually be the most common use case, is that <code>&lt;&lt;&lt;</code> has lower precedence than <code>.</code>:</p>\n\n<pre><code>infixr 9 Control.Category..\ninfixr 1 Control.Category.&lt;&lt;&lt;\n</code></pre>\n\n<p>This is similar to the difference between plain function application <code>f x</code> (which binds tighter than any infix, so it's basically <code>infixl 10</code>) and use of the <code>$</code> operator like <code>f $ x</code>, which has lowest precedence <code>infixr 0 $</code>. That means, you can opt for which one requires less parentheses in an expression. <code>&lt;&lt;&lt;</code> is handy when you want to compose functions that are themselves defined by some infix expression; this often happens when working with <a href=\"http://lens.github.io/\" rel=\"nofollow noreferrer\">lenses</a>.</p>\n\n<p>More theoretically interesting is that the <code>Category</code> version works not only with functions, but also with morphisms from other well, <em>categories</em>. A simple example is the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Type-Coercion.html#t:Coercion\" rel=\"nofollow noreferrer\">category of coercions</a>: if you have e.g. a list of <code>newtype</code>-wrapped values and you want to get at the underlying representations, it would be inefficient to <code>map</code> over the list \u2013 this would create a copy of the entire list, which however contains the exact same runtime information. A coercion allows you to use the original list all the time, but without bypassing the type system \u2013 the compiler will at each point keep track in which \u201cview\u201d of the list the elements have what type. Coercions aren't actually functions \u2013 they are always no-ops at runtime \u2013 but they can be composed just like functions (e.g. coerce from <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Monoid.html#t:Product\" rel=\"nofollow noreferrer\"><code>Product Int</code></a> to <code>Int</code>, then coerce from <code>Int</code> to <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Monoid.html#t:Sum\" rel=\"nofollow noreferrer\"><code>Sum Int</code></a>).</p>\n\n<p>For other examples, Haskellers will usually refer to <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Arrow.html#t:Kleisli\" rel=\"nofollow noreferrer\"><code>Kleisli</code></a> categories. These contain functions of the form <code>a -&gt; m b</code>, where <code>m</code> is a monad. Although you cannot directly compose e.g. <code>readFile :: FilePath -&gt; IO String</code> with <code>firstFileInDirectory :: FilePath -&gt; IO FilePath</code>, because there's a mismatch between <code>FilePath</code> and <code>IO FilePath</code>, you can <em>Kleisli compose</em> them:</p>\n\n<pre><code>import Control.Monad\nmain = writeFile \"firstfileContents.txt\" &lt;=&lt; readFile &lt;=&lt; firstFileInDirectory\n            $ \"src-directory/\"\n</code></pre>\n\n<p>and the same thing can be written</p>\n\n<pre><code>import Control.Arrow\nmain = runKleisli ( Kleisli (writeFile \"firstfileContents.txt\")\n                 &lt;&lt;&lt; Kleisli readFile\n                 &lt;&lt;&lt; Kleisli firstFileInDirectory\n            ) $ \"src-directory/\"\n</code></pre>\n\n<p><em>What's the point</em>? Well, it allows you to abstract over different categories and thus have code that will work both with pure functions and with <code>IO</code> functions. But frankly, I think <code>Kleisli</code> does a bad job at motivating the use of other categories: anything you can write with Kleisli arrows is typically more readable when written with standard monadic <code>do</code> notation, or else just with the <code>=&lt;&lt;</code> or <code>&lt;=&lt;</code> operators. That <em>still</em> allows you to abstract over computations that may be pure or impure, simply by choosing different monads (<code>IO</code>, <code>ST</code> or simply <code>Identity</code>).\n<br>There are apparently some specialist parsers that are <code>Arrows</code> but can't be written as monads, but they haven't really caught on \u2013 it seems the advantages do not balance the less intuitive style.</p>\n\n<p>In maths, there are many more interesting categories, but unfortunately these tend not to be expressible as <code>Category</code>es because <em>not every Haskell type can be an object</em>. An example I like to give is the <a href=\"http://hackage.haskell.org/package/linearmap-category\" rel=\"nofollow noreferrer\">category of linear mappings</a>, whose objects are only Haskell types that represent vector spaces, such as <code>Double</code> or <code>(Double, Double)</code> or <code>InfiniteSequence Double</code>. The linear mappings are essentially matrices, but with not only type-checked domain- and codomain dimension but also the option to represent different spaces with particular meaning, e.g. preventing adding a position vector to a gravity-field vector. And because the vectors don't need to be literally represented by arrays of numbers, you can have optimised representations for every application, e.g. for compressed image data on which you want to do machine learning.</p>\n\n<p>Linear mappings are not a <code>Category</code> instance, but they are an instance of <a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.0/docs/Control-Category-Constrained.html\" rel=\"nofollow noreferrer\">constrained category</a>.</p>\n"}], "owner": {"reputation": 2279, "user_id": 7028216, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/ggYcQ.jpg?s=128&g=1", "display_name": "tcelferact", "link": "https://stackoverflow.com/users/7028216/tcelferact"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1559483369, "creation_date": 1535409669, "last_edit_date": 1559483369, "question_id": 52047835, "link": "https://stackoverflow.com/questions/52047835/what-is-the-difference-between-and-when-performing-function-compositio", "title": "What is the difference between &#39;.&#39; and &#39;&lt;&lt;&lt;&#39; when performing function composition?", "body": "<p>I'm trying to perform function composition in Haskell, and I'm not sure which operator is the correct one to use. </p>\n\n<p>The docs contain these two type signatures:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c \n(&lt;&lt;&lt;) :: Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c \n</code></pre>\n\n<p>Clearly the difference between these two options is the presence/absence of <code>Category cat</code>, but what does this annotation signify, and how should I use the information to choose one operator over the other?</p>\n\n<p>I also noticed a third variant on the above two signatures when comparing two other operators:</p>\n\n<pre><code>(&gt;&gt;) :: forall a b. m a -&gt; m b -&gt; m b \n(&gt;&gt;&gt;) :: Category cat =&gt; cat a b -&gt; cat b c -&gt; cat a c\n</code></pre>\n\n<p>What does the <code>forall</code> annotation mean\u2014is <code>&gt;&gt;</code> for use in a third scenario?</p>\n"}, {"tags": ["xml", "haskell", "hxt"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 782130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6959b42080c140ab4bfb6e58c8de449c?s=128&d=identicon&r=PG", "display_name": "MetroWind", "link": "https://stackoverflow.com/users/782130/metrowind"}, "edited": false, "score": 0, "creation_date": 1535664110, "post_id": 52060394, "comment_id": 91162079, "body": "Wow, thank you for this detailed answer! However, (probably because I did something utterly stupid) when I ran the program, it got stuck and mem usage kept going higher\u2026 Here\u2019s my <a href=\"https://hastebin.com/inonahidiz.sql\" rel=\"nofollow noreferrer\">full program</a>.  I found that if I change <code>processTopDown</code> to <code>processBottomUp</code>, the program ran but the result was wrong. Every element would repeat itself once except for <code>mi</code> and <code>mrow</code> (for example <code>&lt;mo&gt;a&lt;&#47;mo&gt;</code> becomes <code>&lt;mo&gt;&lt;mo&gt;a&lt;&#47;mo&gt;&lt;&#47;mo&gt;</code>)."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "reply_to_user": {"reputation": 447, "user_id": 782130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6959b42080c140ab4bfb6e58c8de449c?s=128&d=identicon&r=PG", "display_name": "MetroWind", "link": "https://stackoverflow.com/users/782130/metrowind"}, "edited": false, "score": 0, "creation_date": 1535667990, "post_id": 52060394, "comment_id": 91163282, "body": "This looks like a mistake on my part - you want <code>processChildren</code> instead of <code>replaceChildren</code>. <code>processBottomUp</code> is also the way to go.  I&#39;m curious as to why you write <code>processChildren (processRootElement `when` isElem)</code> - <code>processRootElement</code> should be good enough for the transformation you want to apply."}, {"owner": {"reputation": 447, "user_id": 782130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6959b42080c140ab4bfb6e58c8de449c?s=128&d=identicon&r=PG", "display_name": "MetroWind", "link": "https://stackoverflow.com/users/782130/metrowind"}, "edited": false, "score": 0, "creation_date": 1535668091, "post_id": 52060394, "comment_id": 91163306, "body": "Indeed it works now! Thank you very much!  The <code>processChildren</code> was in an example in the documentation. I basically just copy-pasted it. But now that I have a working program, I\u2019ll see if I can simply it."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 3, "last_activity_date": 1535668245, "last_edit_date": 1535668245, "creation_date": 1535466769, "answer_id": 52060394, "question_id": 52045672, "link": "https://stackoverflow.com/questions/52045672/hxt-how-to-lift-children-of-certain-elements/52060394#52060394", "title": "HXT: how to \u201clift\u201d children of certain elements?", "body": "<h2>Quick type rundown</h2>\n\n<pre><code>XmlTree = NTree XNode\n</code></pre>\n\n<p>meaning that every <code>XmlTree</code> has the construction</p>\n\n<pre><code>NTree XNode [XMLTree]\n</code></pre>\n\n<p>Where the first argument is the current node, and the second argument is the list of children.</p>\n\n<h2>The creative process</h2>\n\n<p><code>processTopDown</code> will take the tree transformation you provide and produce a tree transformation which applies it recursively.</p>\n\n<p>First, let's define the tree transformation you want on a single node:</p>\n\n<ol>\n<li>Go through the children of the current node</li>\n<li>If any match the tags we specify, then\n\n<ol>\n<li>Take all the children of the tag, and</li>\n<li>Make them children of the current node instead</li>\n<li>Then remove the tag</li>\n</ol></li>\n</ol>\n\n<p>The transformation doesn't \"lift\" the children of current node, because that wouldn't be possible on the root.</p>\n\n<p>A good way to do this would be to use <code>processChildren</code>, which is an arrow which lets us specify new children for the current node based on the old children. To do this, we'll need to use <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.16/docs/Control-Arrow-ArrowIf.html\" rel=\"nofollow noreferrer\">conditional arrows</a></p>\n\n<p>We can then split the design into two parts, a predicate for matching the tags we want, and the transformation we want to perform</p>\n\n<h3>The predicate</h3>\n\n<p>Reminding ourselves of <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.16/docs/Text-XML-HXT-DOM-TypeDefs.html#t:XNode\" rel=\"nofollow noreferrer\">what forms</a> an <code>XNode</code> can take, the one we're interested in is</p>\n\n<pre><code>XTag QName XmlTrees\n</code></pre>\n\n<p>We want to match on nodes of this form, for our given tag names. For this, we write a helper function</p>\n\n<pre><code>filterOnQName :: QName -&gt; XNode -&gt; Bool\nfilterOnQName qname (XTag xqname _) \n  | qname == xqname = True\n  | otherwise       = False\nfilterOnQName _ _   = False\n</code></pre>\n\n<p>For ease of use, we want to write the tags as strings, so we'll use <code>mkName</code> to convert them into <code>QName</code>s. Then our more useful filter function is</p>\n\n<pre><code>filterTags :: [String] -&gt; XmlTree -&gt; Bool\nfilterTags tagNames (NTree xnode _) = any (\\qname -&gt; filterOnQName qname xnode) (map mkName tagNames)\n</code></pre>\n\n<p>But this isn't an arrow, which we need it to be for reasons we'll see later. We can simply turn it into one with <code>isA</code></p>\n\n<pre><code>childFilter tags = isA (filterTags tags)\n</code></pre>\n\n<h3>The transformation</h3>\n\n<p>We're going two need two arrows for the transformation body - one for when the filter matches, and one for when it doesn't.</p>\n\n<p>For when it doesn't, the transformation is easy - we want to keep the current node.</p>\n\n<pre><code>filterFailed = this\n</code></pre>\n\n<p>Here, <code>this</code> is the identity arrow - it does nothing.</p>\n\n<p>When the filter matches, we want to get the children - first, let's write a helper</p>\n\n<pre><code>getChildren :: XmlTree -&gt; [XmlTree]\ngetChildren (NTree _ children) = children\n</code></pre>\n\n<p>Handily, because we're working with list arrows, we can turn this straight into an arrow using <a href=\"https://hackage.haskell.org/package/hxt-9.3.1.16/docs/Control-Arrow-ArrowList.html#v:arrL\" rel=\"nofollow noreferrer\">arrL</a></p>\n\n<pre><code>liftChildren = arrL getChildren\n</code></pre>\n\n<h3>Combining them</h3>\n\n<p>We can now turn this into a single arrow, using <code>ifA</code>, the arrow version of <code>if</code></p>\n\n<pre><code>liftMatchedChildren tags = ifA (childFilter tags) liftChildren filterFailed\n</code></pre>\n\n<p>And finally, we can describe the transformation we wanted</p>\n\n<pre><code>processRootElement\n  = processTopDown (processChildren (liftMatchedChildren [\"mi\", \"mrow\"]))\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 782130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6959b42080c140ab4bfb6e58c8de449c?s=128&d=identicon&r=PG", "display_name": "MetroWind", "link": "https://stackoverflow.com/users/782130/metrowind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 52060394, "answer_count": 1, "score": 1, "last_activity_date": 1535668245, "creation_date": 1535397248, "question_id": 52045672, "link": "https://stackoverflow.com/questions/52045672/hxt-how-to-lift-children-of-certain-elements", "title": "HXT: how to \u201clift\u201d children of certain elements?", "body": "<p>Suppose I have this MathML document</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\u201d?&gt;\n&lt;math xmlns=\"http://www.w3.org/1998/Math/MathML\"&gt;\n    &lt;mi&gt; f &lt;/mi&gt; \n    &lt;mo&gt; &amp;ApplyFunction; &lt;/mo&gt; \n    &lt;mrow&gt; \n      &lt;mo&gt; ( &lt;/mo&gt; \n      &lt;mi&gt; x &lt;/mi&gt; \n      &lt;mo&gt; ) &lt;/mo&gt; \n    &lt;/mrow&gt; \n&lt;/math&gt;\n</code></pre>\n\n<p>Suppose I want to \u201clift\u201d the children of <code>mi</code> and <code>mrow</code>, I should get (let\u2019s ignore the whitespace change here)</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;math xmlns=\"http://www.w3.org/1998/Math/MathML\"&gt;\n    f\n    &lt;mo&gt; &amp;ApplyFunction; &lt;/mo&gt; \n    &lt;mo&gt; ( &lt;/mo&gt; \n    x\n    &lt;mo&gt; ) &lt;/mo&gt; \n&lt;/math&gt;\n</code></pre>\n\n<p>How should I write that with HXT?</p>\n\n<p>I\u2019m a Haskell newbie... so all I have right now is</p>\n\n<pre><code>-- Dealing with command line arguments and stuff\u2026\nprocessRootElement :: IOSArrow XmlTree XmlTree\nprocessRootElement\n    = processTopDown -- What goes here?\n</code></pre>\n"}, {"tags": ["haskell", "sqlite"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 4, "creation_date": 1535393370, "post_id": 52044624, "comment_id": 91040487, "body": "From the documentation, you need to use <code>:id</code> and <code>:desc</code> to name your parameters in the string: <code>r &lt;- queryNamed c &quot;SELECT id,text FROM posts WHERE id = :id AND date &gt;= :date&quot; [&quot;:id&quot; := postId, &quot;:date&quot; := afterDate]</code>"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1535396505, "post_id": 52044624, "comment_id": 91041889, "body": "If you want to specify which columns to bind the values to, <code>&quot;INSERT INTO test(id,desc) VALUES (?,?)&quot;</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1535427757, "post_id": 52044624, "comment_id": 91049989, "body": "Use <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">yesodweb.com/book/persistent</a> for sqlite interaction."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1535434400, "post_id": 52044624, "comment_id": 91051657, "body": "@Shawn: that addresses naming the columns, thanks for that, but do I still need to add &#39;?&#39; for representing each VALUE in column? The example below has only 2 columns, but what if I have 10? Will it look like (?,?,?,?,?,?,?,?,?,?)? Seems very awkward to me.  <code>run conn &quot;INSERT INTO test (id,desc) VALUES (?,?)&quot;                              [ toSql (3 :: Int)                              , toSql (&quot;Newco&quot; :: String)                              ]</code>"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1535465642, "post_id": 52044624, "comment_id": 91070236, "body": "Per the documentation, <code>run conn &quot;INSERT INTO test (id,desc) VALUES (:id,:desc)&quot; [&quot;:id&quot; := toSql (3 :: Int), &quot;:desc&quot; := toSql (&quot;Newco&quot; :: String) ]</code>"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535392467, "creation_date": 1535392467, "question_id": 52044624, "link": "https://stackoverflow.com/questions/52044624/haskell-sqlite3-challenge", "title": "Haskell Sqlite3 challenge", "body": "<p>In Real World Haskell this is an example of the dbase module HDBC:</p>\n\n<pre><code>run conn \"INSERT INTO test VALUES (?, ?)\" [toSql 0, toSql \"zero\"]\n</code></pre>\n\n<p>Question is: VALUES (?,?) seem bad practice to me, but if I name the columns:</p>\n\n<pre><code>run conn \"INSERT INTO test VALUES (id, desc)\" [toSql 0, toSql \"zero\"]\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>*** Exception: SqlError {seState = \"\", seNativeError = 1, seErrorMsg = \"prepare 34: INSERT INTO test VALUES (id,desc): no such column: id\"}\n</code></pre>\n\n<p>Strange, since the columns are actually named 'id' and 'desc'. Apostrophs maybe? </p>\n\n<pre><code>run conn \"INSERT INTO test VALUES ('id', 'desc')\" [toSql 0, toSql \"zero\"]\n</code></pre>\n\n<p>But results in following: </p>\n\n<pre><code>*** Exception: SqlError {seState = \"\", seNativeError = -1, seErrorMsg = \"In HDBC execute, received [SqlInt64 3,SqlString \\\"Newco\\\"] but expected 0 args.\"}\n</code></pre>\n\n<p>But I really hate having to put 20 question marks. Can you please help me out?</p>\n"}, {"tags": ["haskell", "functional-programming", "fold", "binary-operators", "associativity"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1535390743, "post_id": 52044046, "comment_id": 91039226, "body": "<code>foldr (%) d [a,b,c] = a % (b % (c % d))</code>, whereas <code>foldl (%) d [a,b,c] = ((a % b) % c) % d</code>."}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 2, "creation_date": 1535397389, "post_id": 52044046, "comment_id": 91042234, "body": "Just read <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foldr_Foldl_Foldl%27</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1535447830, "post_id": 52044242, "comment_id": 91058674, "body": "<code>0-1-2-3-4-5</code> is defined; it&#39;s <code>sum [0, -1, -2, -3, -4, -5]</code>, which means the binary <code>-</code> is left associative  (<code>:i (-)</code> says <code>infixl 6 -</code>). Thus it matches the <code>foldl</code> case here."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 1, "creation_date": 1535451429, "post_id": 52044242, "comment_id": 91060935, "body": "of course, there&#39;s no question about it. What I meant was that with the <code>-</code> seen symbolically, as the stand-in for any possible operator, it is not fully defined without specifying the associativity (as the fixity declaration in Haskell does)."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1535452794, "last_edit_date": 1535452794, "creation_date": 1535390786, "answer_id": 52044242, "question_id": 52044046, "link": "https://stackoverflow.com/questions/52044046/understanding-folds-in-haskell/52044242#52044242", "title": "Understanding Folds in Haskell", "body": "<p>Seen symbolically as a \"translation\" of the fold, <code>0-1-2-3-4-5</code> by itself is ill-defined. The order of operations <em>must</em> be specified. </p>\n\n<p>In fact, whatever the operator, the order is</p>\n\n<pre><code>foldl (-) 0 [1..5] = ((((0 - 1) - 2) - 3) - 4) - 5    -- = -15\n\nfoldr (-) 0 [1..5] = 1 - (2 - (3 - (4 - (5 - 0))))    -- = 3\n</code></pre>\n\n<p>For the <code>(++)</code> though, both orderings result in the same result, when <code>\"\"</code> is used in place of <code>0</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1535448678, "post_id": 52044244, "comment_id": 91059221, "body": "Very important point about the argument order. They are ordered such that the expanded expression has its arguments in the same order as the list, and the accumulator need not be the same type as the list entries. For instance, <code>any (&gt;5) xs</code> can be expressed as <code>foldr False (\\v a -&gt; if v&gt;5 then True else a) xs</code>."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 7, "last_activity_date": 1535390799, "creation_date": 1535390799, "answer_id": 52044244, "question_id": 52044046, "link": "https://stackoverflow.com/questions/52044046/understanding-folds-in-haskell/52044244#52044244", "title": "Understanding Folds in Haskell", "body": "<p>Actually <code>foldr (-) 0 [1..5]</code> equals <code>3</code>, because it's:</p>\n\n<pre><code>(1 - (2 - (3 - (4 - (5 - 0))))\n</code></pre>\n\n<p>The answer to this question is in the type of <code>foldr</code> function:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>As we see, <code>(a -&gt; b -&gt; b)</code> function has iterated element as the first argument and accumulator as the second one. That's why with <code>foldr (++) \"\" [\"a\", \"b\", \"c\"]</code> we have:</p>\n\n<pre><code>(\"a\" ++ (\"b\" ++ (\"c\" ++ \"\")))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 12, "last_activity_date": 1535419531, "last_edit_date": 1592644375, "creation_date": 1535390988, "answer_id": 52044289, "question_id": 52044046, "link": "https://stackoverflow.com/questions/52044046/understanding-folds-in-haskell/52044289#52044289", "title": "Understanding Folds in Haskell", "body": "<p>I think <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldr\" rel=\"noreferrer\">this part from the docs</a> makes it clearer:</p>\n<hr />\n<blockquote>\n<p>In the case of lists, foldr, when applied to a binary operator, a starting value (typically the right-identity of the operator), and a list, reduces the list using the binary operator, from right to left:</p>\n<pre><code>foldr f z [x1, x2, ..., xn] == x1 `f` (x2 `f` ... (xn `f` z)...)\n</code></pre>\n<p>. . .</p>\n<p>In the case of lists, foldl, when applied to a binary operator, a starting value (typically the left-identity of the operator), and a list, reduces the list using the binary operator, from left to right:</p>\n<pre><code>foldl f z [x1, x2, ..., xn] == (...((z `f` x1) `f` x2) `f`...) `f` xn\n</code></pre>\n</blockquote>\n<hr />\n<p>If you look at the example breakdown, the concatenation <code>foldr</code> is equivalent to:</p>\n<pre><code>&quot;a&quot; ++ (&quot;b&quot; ++ (&quot;c&quot; ++ &quot;&quot;))\n</code></pre>\n<p>And for <code>foldl</code>, it would be equivalent to:</p>\n<pre><code>((&quot;&quot; ++ &quot;a&quot;) ++ &quot;b&quot;) ++ &quot;c&quot;\n</code></pre>\n<p>For string concatenation, these are the same.</p>\n<hr />\n<p>For subtraction however,</p>\n<pre><code>1 - (2 - (3 - 0))\n</code></pre>\n<p>Gives a different result than:</p>\n<pre><code>((0 - 1) - 2) - 3\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 52044289, "answer_count": 3, "score": 2, "last_activity_date": 1535452794, "creation_date": 1535389954, "question_id": 52044046, "link": "https://stackoverflow.com/questions/52044046/understanding-folds-in-haskell", "title": "Understanding Folds in Haskell", "body": "<p>From what I understand about folds in Haskell, <code>foldl (-) 0 [1..5]</code> gives a result of <code>-15</code> by calculating <code>0-1-2-3-4-5</code>, and <code>foldr (-) 0 [1..5]</code> gives a result of <code>-5</code> by calculating <code>5-4-3-2-1-0</code>. Why is it then that both <code>foldl (++) \"\" [\"a\", \"b\", \"c\"]</code> and <code>foldr (++) \"\" [\"a\", \"b\", \"c\"]</code> give a result of <code>\"abc\"</code>, and the result of <code>foldr</code> is not, instead, <code>\"cba\"</code>?</p>\n\n<p>Is there something I'm missing in understanding the differences between <code>foldl</code> and <code>foldr</code>?  </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1535379197, "post_id": 52041190, "comment_id": 91033141, "body": "Define instance for many existing types, IMHO. Or just... don&#39;t want this."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1535437646, "post_id": 52041190, "comment_id": 91052922, "body": "It&#39;s possible with Haskell to encode <i>or</i> constraint. Check my answer to another question where I gave an example or how to use function based on whether it has <code>Ord</code> or only <code>Eq</code> constraint. I think you can do the same for your use case if needed, though I&#39;d still prefer solution with separate <code>newtype</code>s: <a href=\"https://stackoverflow.com/questions/44250854/use-specialized-implementation-if-a-class-instance-is-available/44832444#44832444\" title=\"use specialized implementation if a class instance is available\">stackoverflow.com/questions/44250854/&hellip;</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1535485913, "post_id": 52041190, "comment_id": 91081110, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44250854/use-specialized-implementation-if-a-class-instance-is-available\">Use specialized implementation if a class instance is available</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1535380351, "post_id": 52041366, "comment_id": 91033826, "body": "My API expects at the minimum some <code>Typeable</code> values. But it would be nice to display more information if the value also has a <code>Show</code> instance. Having to  manually newtype input values based on their available instances would the API harder to use."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1535382214, "post_id": 52041366, "comment_id": 91034954, "body": "@Eric In that case, you had better insert and remove the newtype wrappers at your API boundaries, so the user need not see them."}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1535382450, "post_id": 52041366, "comment_id": 91035105, "body": "I could do this but this would require me to provide 2 operation names just with different constraints: <code>register :: (Typeable a) =&gt; a -&gt; Registry as -&gt; Registry (a &#39;: as)</code> and <code>registerWhenShow :: (Typeable a, Show a) =&gt; a -&gt; Registry as -&gt; Registry (a &#39;: as)</code>. It feels like the compiler should be able to know which is which"}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1535382713, "post_id": 52041366, "comment_id": 91035279, "body": "I also tried this library: <a href=\"https://github.com/mikeizbicki/ifcxt\" rel=\"nofollow noreferrer\">github.com/mikeizbicki/ifcxt</a>, but I don&#39;t get the expected output in GHCi for <code>ctxShow</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 4, "creation_date": 1535383890, "post_id": 52041366, "comment_id": 91035980, "body": "@Eric &quot;It feels like the compiler should be able to know which is which&quot; -- your feelings are incorrect. The open-world assumption is a basic premise of the Haskell typeclass system, and says that any code may add an instance for any class/type pair if it wants to -- or, said another way, no code can know a fact of the form &quot;type <code>T</code> does not have an instance for class <code>C</code>&quot;. This makes operations of the form &quot;do X if <code>T</code> does not have an instance of <code>Show</code>&quot; impossible. <code>IfCxt</code> looks clever, but fragile -- I bet I could break it without too much trouble."}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1535441814, "post_id": 52041366, "comment_id": 91055137, "body": "Thanks Daniel, I gave all of this more thinking and it makes sense. I realize that I should not try to fight the type system too hard. I eventually changed my API for the better I think"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 0, "last_activity_date": 1535379522, "creation_date": 1535379522, "answer_id": 52041366, "question_id": 52041190, "link": "https://stackoverflow.com/questions/52041190/return-show-a-if-show-a-exists-otherwise-its-type-representation-if-typeab/52041366#52041366", "title": "Return `show a` if (Show a) exists, otherwise its type representation if (Typeable a)", "body": "<p>The standard trick for guiding instance selection is to make a new type. So:</p>\n\n<pre><code>newtype DescribeViaTypeable a = DVT a\nnewtype DescribeViaShow     a = DVS a\n\ninstance Show     a =&gt; Described (DescribeViaShow     a) where describe (DVS x) = show x\ninstance Typeable a =&gt; Described (DescribeViaTypeable a) where describe (DVT x) = show (typeOf x)\n</code></pre>\n\n<p>Now callers may choose which kind of description they like if both are available, and data types can be explicit about which kind of description they expect to be available for their fields, eliminating any magic.</p>\n"}], "owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 52041366, "answer_count": 1, "score": 2, "last_activity_date": 1535379522, "creation_date": 1535378905, "question_id": 52041190, "link": "https://stackoverflow.com/questions/52041190/return-show-a-if-show-a-exists-otherwise-its-type-representation-if-typeab", "title": "Return `show a` if (Show a) exists, otherwise its type representation if (Typeable a)", "body": "<p>I would like to write</p>\n\n<pre><code>class Described a where\n  describe :: a -&gt; String\n\ninstance {-# OVERLAPPING #-} (Show a) =&gt; Described a where\n  describe = show\n\ninstance {-# OVERLAPPABLE #-} (Typeable a) =&gt; Described a where\n  describe = show . typeOf\n</code></pre>\n\n<p>This won't work because the right hand side of each instance is the same. I thought would be solved by having a look at <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/GHC/AdvancedOverlap</a> but it seems that I need to define instances for many existing types to make any of these solutions work. What would be the best solution here?</p>\n"}, {"tags": ["haskell", "llvm-ir"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1535377907, "post_id": 52040651, "comment_id": 91032284, "body": "Here GHC 8.4.3 requires LLVM 5.0. I guess each GHC version wants its own LLVM, but I&#39;m unsure about it."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1535378024, "post_id": 52040651, "comment_id": 91032371, "body": "Yes The LLVM IR is notoriously unstable with no formal spec (but a reasonable english reference).  When patching a parser for the bitcode I&#39;ve had to look at the source code to LLVM quite a bit to get clarity on issues.  Similarly with the seemingly meaningless twiddles of human readable LLVM IR syntax between versions."}], "answers": [{"comments": [{"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 0, "creation_date": 1535382416, "post_id": 52040994, "comment_id": 91035087, "body": "I&#39;ve edited my question after installing llvm-3.7.0 which now compiles without errors ... but I can&#39;t find the generated llvm IR file if one was indeed created ..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 0, "creation_date": 1535383471, "post_id": 52040994, "comment_id": 91035740, "body": "@OrenIshShalom See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/flags.html#keeping-intermediate-files\" rel=\"nofollow noreferrer\">the fine manual</a>."}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 0, "creation_date": 1535384714, "post_id": 52040994, "comment_id": 91036406, "body": "great it works! one last question I promise: I edited the question again to try to run the generated *.bc file (with llvm-as from *.ll) but it misses the main function which was there in the original Haskell version ... any idea where it went?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 1, "creation_date": 1535389033, "post_id": 52040994, "comment_id": 91038503, "body": "@OrenIshShalom Dunno, I&#39;ve never played with LLVM before, believe it or not. Might want to open a fresh question with the details. As an aside, what you&#39;ve done here twice now (editing your question to change what you&#39;re asking) is generally frowned upon on SO: edits to clarify your question are fine, but if you come up with new questions as a result of what you learn, those should go in a fresh question instead."}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "edited": false, "score": 0, "creation_date": 1535513416, "post_id": 52040994, "comment_id": 91087987, "body": "Removed second EDIT altogether, and kept the first one indicating the exact command line that did work."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1535378224, "creation_date": 1535378224, "answer_id": 52040994, "question_id": 52040651, "link": "https://stackoverflow.com/questions/52040651/compile-haskell-programs-to-llvm-ir/52040994#52040994", "title": "Compile Haskell programs to LLVM IR", "body": "<p>Yes, GHC expects an exact version of LLVM. The LLVM internals change very quickly, and so GHC (like many other tools which target or use LLVM) takes a very conservative approach to versioning of those tools.</p>\n"}], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 977, "favorite_count": 0, "accepted_answer_id": 52040994, "answer_count": 1, "score": 3, "last_activity_date": 1535512379, "creation_date": 1535376934, "last_edit_date": 1535512379, "question_id": 52040651, "link": "https://stackoverflow.com/questions/52040651/compile-haskell-programs-to-llvm-ir", "title": "Compile Haskell programs to LLVM IR", "body": "<p>According to <a href=\"https://stackoverflow.com/questions/52037888/compile-haskell-programs-to-c\">this SO post</a> compilation of Haskell programs to C is no longer (officially) supported. So I wanted to explore the option of compiling Haskell programs to LLVM IR. I chose the same program of the mentioned post:</p>\n\n<pre><code>quicksort [] = []\nquicksort (p:xs) = (quicksort lesser) ++ [p] ++ (quicksort greater)\n  where\n    lesser  = filter (&lt;  p) xs\n    greater = filter (&gt;= p) xs\n\nmain = print(quicksort([5,2,1,0,8,3]))\n</code></pre>\n\n<p>and then tried to compile it to LLVM IR with:</p>\n\n<pre><code>$ ghc -fllvm main.hs\n</code></pre>\n\n<p>Then I get this error regarding the LLVM version:</p>\n\n<pre><code>&lt;no location info&gt;: error:\n    Warning: Couldn't figure out LLVM version!\n             Make sure you have installed LLVM 3.7\nghc: could not execute: opt-3.7\n</code></pre>\n\n<p>When I check my opt version it's 3.8.0, which is bigger:</p>\n\n<pre><code>$ opt --version\nLLVM (http://llvm.org/):\n  LLVM version 3.8.0\n  DEBUG build with assertions.\n  Built Jun 20 2018 (14:59:34).\n  Default target: x86_64-unknown-linux-gnu\n  Host CPU: broadwell\n</code></pre>\n\n<p>So what's going on? <strong>could ghc expect exactly version 3.7.0 and only that?!</strong></p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>After installing llvm 3.7.0 and copying <code>opt</code> and <code>llc</code> to have 3.7 suffixes:</p>\n\n<pre><code>$ cp opt opt-3.7\n$ cp llc llc-3.7\n</code></pre>\n\n<p>compilation to llvm goes without errors, using this line:</p>\n\n<pre><code>$ ghc -keep-llvm-files main.hs\n</code></pre>\n\n<p>and a file called main.ll is created.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1535371408, "post_id": 52038907, "comment_id": 91028066, "body": "Are you sure you installed the <i>correct</i> package (same name, same version)? Unfortunately every now and then <i>different</i> packages offer the <i>same module names</i> (but frequently with <i>different</i> functions)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535371503, "post_id": 52038907, "comment_id": 91028140, "body": "Here <code>directory</code> and <code>system-fileio</code> both have a <code>System.Directory</code> module."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1535371991, "creation_date": 1535371991, "answer_id": 52039130, "question_id": 52038907, "link": "https://stackoverflow.com/questions/52038907/haskell-why-getsymboliclinktarget-is-not-in-scope/52039130#52039130", "title": "Haskell - why getSymbolicLinkTarget is not in scope?", "body": "<p><code>getSymbolicLinkTarget</code>'s documentation says, in part:</p>\n\n<blockquote>\n  <p>Since: directory-1.3.1.0</p>\n</blockquote>\n\n<p>You probably have an older version of the directory package than that. Consider adding a constraint like <code>directory&gt;=1.3.1</code> to your cabal file.</p>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 52039130, "answer_count": 1, "score": -1, "last_activity_date": 1535371991, "creation_date": 1535371289, "question_id": 52038907, "link": "https://stackoverflow.com/questions/52038907/haskell-why-getsymboliclinktarget-is-not-in-scope", "title": "Haskell - why getSymbolicLinkTarget is not in scope?", "body": "<p>I get this error:</p>\n\n<pre><code>/home/jacek/hasktemp/src/Main.hs:40:31: error:\n    Variable not in scope: getSymbolicLinkTarget :: [Char] -&gt; IO a0\n   |\n40 |                 symlTarget &lt;- getSymbolicLinkTarget emacsdf\n   |                               ^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>when I try to find the target of a symlink.</p>\n\n<p>The gist of my code is here:\n<a href=\"https://gist.github.com/bigos/9da53d11c53fe642bfe90444be76cb7c\" rel=\"nofollow noreferrer\">https://gist.github.com/bigos/9da53d11c53fe642bfe90444be76cb7c</a></p>\n\n<p>and my imports have</p>\n\n<pre><code>import System.Directory\n</code></pre>\n\n<p>The documentation\n<a href=\"http://hackage.haskell.org/package/directory-1.3.3.1/docs/System-Directory.html#g:6\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/directory-1.3.3.1/docs/System-Directory.html#g:6</a>\nhas getSymbolicLinkTarget, yet I get the error. what I am doing wrong?</p>\n"}, {"tags": ["c", "haskell", "compilation"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1535369508, "post_id": 52037888, "comment_id": 91026928, "body": "Note that you can compile Haskell to object files and C <i>header</i> files using the Foreign Function Interface. These can then just be <i>linked</i> into a C program. This is much better than literally trans-compiling to C source code."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1535369260, "creation_date": 1535369260, "answer_id": 52038285, "question_id": 52037888, "link": "https://stackoverflow.com/questions/52037888/compile-haskell-programs-to-c/52038285#52038285", "title": "Compile Haskell programs to C", "body": "<p>Compiling to C is now a special-purpose trick, used primarily for bootstrapping on new architectures. Consequently by default it is not supported. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building/Unregisterised\" rel=\"noreferrer\">The GHC wiki</a> has some instructions for building GHC yourself with this support enabled; the chief difference between a standard build and a build that enables compiling to C is to configure with the <code>--enable-unregisterised</code> flag. See also the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building\" rel=\"noreferrer\">full list of pages on building GHC</a> -- it is quite complicated, so you'll want to keep this handy if you decide to do so.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 8, "last_activity_date": 1535369290, "creation_date": 1535369290, "answer_id": 52038291, "question_id": 52037888, "link": "https://stackoverflow.com/questions/52037888/compile-haskell-programs-to-c/52038291#52038291", "title": "Compile Haskell programs to C", "body": "<p>That option is ancient.</p>\n\n<p>Serveral years ago, GHC used to compile via C, but no longer does that in normal scenarios. Instead of generating C code and compiling that with <code>gcc</code>, nowadays GHC uses its own native code generator (or LLVM).</p>\n\n<p>Technically, it is possible to compile GHC itself as \"unregistered\" to re-enable that option. This requires a custom build of GHC from its source code. This will however produce a rather inefficient C code. Pragmatically, this is only done when cross-compiling or when porting GHC to a new architecture.</p>\n"}], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2435, "favorite_count": 1, "accepted_answer_id": 52038285, "answer_count": 2, "score": 9, "last_activity_date": 1535369290, "creation_date": 1535367879, "question_id": 52037888, "link": "https://stackoverflow.com/questions/52037888/compile-haskell-programs-to-c", "title": "Compile Haskell programs to C", "body": "<p>I have to following Haskell program I'm trying to compile to C.\nI've looked at <a href=\"https://stackoverflow.com/questions/1994190/distributing-a-haskell-program-as-c-source\">this SO post</a>, but could not get an answer there.</p>\n\n<pre><code>quicksort [] = []\nquicksort (p:xs) = (quicksort lesser) ++ [p] ++ (quicksort greater)\n  where\n    lesser  = filter (&lt;  p) xs\n    greater = filter (&gt;= p) xs\n\nmain = print(quicksort([5,2,1,0,8,3]))\n</code></pre>\n\n<p>Here's what I tried:</p>\n\n<pre><code>$ ghc -C main.hs\n</code></pre>\n\n<p>And what I get is:</p>\n\n<pre><code>ghc: the option -C is only available with an unregisterised GHC\nUsage: For basic information, try the `--help' option.\n</code></pre>\n\n<p>This is a bit weird because when I look at the help I see this:</p>\n\n<blockquote>\n  <p>-C        stop after generating C (.hc output)</p>\n</blockquote>\n"}, {"tags": ["list", "function", "haskell", "recursion", "composition"], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 3, "last_activity_date": 1535353345, "creation_date": 1535353345, "answer_id": 52034114, "question_id": 52034032, "link": "https://stackoverflow.com/questions/52034032/using-a-filtered-list-in-a-new-function-in-haskell/52034114#52034114", "title": "Using a filtered list in a new function in haskell", "body": "<p>In the following are three equivalent ways to write the function <code>oddSum :: [Integer] -&gt; Integer</code>:</p>\n\n<pre><code>oddSum xs = sumList (getOddNumbers xs)\n\noddSum xs = sumList $ getOddNumbers xs\n\noddSum = sumList . getOddNumbers\n</code></pre>\n\n<p>Btw, have a look at the <code>filter</code> and <code>sum</code> functions in the <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html\" rel=\"nofollow noreferrer\">Prelude</a> with which you could replace <code>getOddNumbers</code> and <code>sumList</code> respectively.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1535353442, "creation_date": 1535353442, "answer_id": 52034134, "question_id": 52034032, "link": "https://stackoverflow.com/questions/52034032/using-a-filtered-list-in-a-new-function-in-haskell/52034134#52034134", "title": "Using a filtered list in a new function in haskell", "body": "<h1>Passing output as input to (another) function</h1>\n\n<p>Well what you basically want to do is <em>use</em> the <em>output</em> of the <code>getOddNumbers</code> as <em>input</em> for the <code>sumList</code> function, so we can define a <code>sumOddList</code> function as:</p>\n\n<pre><code>sumOddList :: [Integer] -&gt; Integer\nsumOddList l = sumList (getOddNumbers l)\n</code></pre>\n\n<p>Here <code>l</code> is the list we want to process, and the result is thus a function application on the result of <code>getOddNumbers l</code> (with <code>sumList</code> the function).</p>\n\n<h1>Chaining functions: the <code>(.)</code> function</h1>\n\n<p>The above pattern is quite common: frequently we want to pass data first through a function <code>g</code>, and the result through a function <code>f</code>. Haskell has the <a href=\"https://www.haskell.org/hoogle/?hoogle=(.)\" rel=\"noreferrer\"><strong><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></strong></a> function to \"chain\" functions. We can thus chain <code>sumList</code> and <code>getOddNumbers</code> together like:</p>\n\n<pre><code>sumOddList :: [Integer] -&gt; Integer\nsumOddList = (.) sumList getOddNumbers\n</code></pre>\n\n<p>Notice that we no longer use an <code>l</code> parameter here. <code>sumOddList</code> is here defined as a \"pipeline\" where data is first passed to the <code>getOddNumbers</code>, and then is \"post-processed\" by the <code>sumList</code> function.</p>\n\n<p>The <code>(.)</code> function can also be used as an infix operator:</p>\n\n<pre><code>sumOddList :: [Integer] -&gt; Integer\nsumOddList = sumList . getOddNumbers\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1536220172, "last_edit_date": 1536220172, "creation_date": 1535355299, "answer_id": 52034637, "question_id": 52034032, "link": "https://stackoverflow.com/questions/52034032/using-a-filtered-list-in-a-new-function-in-haskell/52034637#52034637", "title": "Using a filtered list in a new function in haskell", "body": "<blockquote>\n  <p>or is there a way to put these two together in a single function ... <code>sumOddList</code>?</p>\n</blockquote>\n\n<p>Yes there is.</p>\n\n<p>Chaining functions by using one's output as the other's input works, under lazy evaluation especially, but leaves us reliant on the <em>fusion</em> to be performed by a compiler. Which after all is not guaranteed to happen (and often doesn't).</p>\n\n<p>Instead, <em>what you said</em>&hairsp;:</p>\n\n<pre><code>mapping f cons x xs = cons (f x) xs\n\nfiltering p cons x xs = if (p x) then (cons x xs) else xs\n\ntransduce xf cons z xs = foldr (xf cons) z xs\n\nsumOddList xs = transduce (filtering odd) (+) 0 xs\n</code></pre>\n\n<p>Thus,</p>\n\n<pre><code>&gt; sumOddList [1..10]\n25\n&gt; sum [1,3..10]\n25\n&gt; transduce (mapping (+1) . filtering odd) (+) 0 [1..10]\n35\n&gt; sum . filter odd . map (+1) $ [1..10]\n35\n&gt; sum . map (+1) . filter odd $ [1..10]\n30\n&gt; transduce (filtering odd . mapping (+1)) (+) 0 [1..10]\n30\n</code></pre>\n\n<p>This works because folds fuse by composing their reducer functions' transformers (like the <code>mapping</code> and the <code>filtering</code> above which are transforming their reducer argument <code>cons</code>):</p>\n\n<pre><code>foldr (+) 0\n   . foldr (\\x r -&gt; x+1 : r) []\n       . foldr (\\x r -&gt; if odd x then x : r else r) [] \n         $ [1..10]\n=\nfoldr (+) 0\n   . foldr ((\\cons x r -&gt; cons (x+1) r) (:)) []\n       . foldr ((\\cons x r -&gt; if odd x then cons x r else r) (:)) [] \n         $ [1..10]\n=\n     foldr ((\\cons x r -&gt; cons (x+1) r) (+)) 0\n       . foldr ((\\cons x r -&gt; if odd x then cons x r else r) (:)) [] \n         $ [1..10]\n=\n         foldr ((\\cons x r -&gt; if odd x then cons x r else r) \n                  ((\\cons x r -&gt; cons (x+1) r)   (+))) 0 \n         $ [1..10]\n=\n         foldr ( ( (\\cons x r -&gt; if odd x then cons x r else r) \n                 . (\\cons x r -&gt; cons (x+1) r) ) (+))  0 \n         $ [1..10]\n=\n         foldr ( (filtering odd . mapping (+1))  (+))  0 \n         $ [1..10]\n=\n         foldr (  filtering odd ( mapping (+1)   (+))) 0 \n         $ [1..10]\n=\n         30\n</code></pre>\n\n<p>One <code>foldr</code> doing the work of the three. Fusion <em>explicitly</em> achieved, by composing the reducer functions after the <code>cons</code> operation has been abstracted from them, each such changed function becoming a <code>cons</code> transformer, thus, liable to be <em>composed</em> with other such <code>cons</code>-transforming functions.</p>\n"}], "owner": {"reputation": 69, "user_id": 10248239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88a2ab69a05db6b09e16db5e3ff42dd2?s=128&d=identicon&r=PG&f=1", "display_name": "CB010101", "link": "https://stackoverflow.com/users/10248239/cb010101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 52034134, "answer_count": 3, "score": 4, "last_activity_date": 1536220172, "creation_date": 1535353027, "last_edit_date": 1535366886, "question_id": 52034032, "link": "https://stackoverflow.com/questions/52034032/using-a-filtered-list-in-a-new-function-in-haskell", "title": "Using a filtered list in a new function in haskell", "body": "<p>So i'm not too sure how to phrase this properly, but say I wanted to get the sum of all odd numbers in a list, do I have two functions (sumList and getOddNumbers) and combine them into sumOddList or is there a way to put these two together in a single function? If there isnt a better function, how exactly would I combine them into sumOddList?</p>\n\n<pre><code>getOddNumbers :: [Integer] -&gt; [Integer]\ngetOddNumbers [] = []\ngetOddNumbers (x:xs)\n    |odd x = x:getOddNumbers xs\n    |otherwise = getOddNumbers xs\n\nsumList :: [Integer] -&gt; Integer\nsumList list = case list of\n   [] -&gt; 0\n   (x:xs) -&gt; x + (sumList xs)\n</code></pre>\n\n<p>I also ask mainly because putting two diff functions together is something I struggled with before, when putting a colour and a shape using CodeWorld to output a shape of that colour. </p>\n\n<p>Thank you</p>\n\n<p>(Note: I've been using Haskell for just over 5 weeks now and I'm a total noob clearly)</p>\n"}, {"tags": ["c", "performance", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1535350848, "post_id": 52033533, "comment_id": 91017134, "body": "This is a consequence of using a <i>wrong</i> algorithm: this <code>fib</code> will scale <i>exponentially</i>. Furthermore part of the problem is the laziness of the parameters. By writing <code>fib !x</code> in the head, instead of <code>fib x</code>, this should probably result in an efficiencyboost."}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 3, "creation_date": 1535351087, "post_id": 52033533, "comment_id": 91017219, "body": "The problem here is that without the exact algorithms the benchmarking might be useless. So just calculating simple things might be fine and doing something what\u2019s actually wanted might suddenly be very slow, or very fast, compared to that. If you\u2019re not doing this kind of exponential calculation then the benchmark won\u2019t show much."}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535351482, "post_id": 52033533, "comment_id": 91017353, "body": "@WillemVanOnsem I hope you have seen the first &quot;P.S.&quot; - or you mean something different. How &quot;wrong algorithm&quot; can affect performance in one language but not the other?"}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1535351598, "post_id": 52033533, "comment_id": 91017399, "body": "@SamiKuhmonen - you are right, but we anyway need some considerations to be approved by customer&#39;s technicians. It would be very painful to quarrel half a year later about &quot;why have you chose the technology knowing it will hurt our finances&quot; etc... We need to have some agreement with them on how and what we choose, you see..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535351759, "post_id": 52033533, "comment_id": 91017464, "body": "@RodionGorkovenko: well see it like this, languages are optimized towards a certain &quot;code style&quot;. For example C, etc. definitely aim to optimize the &quot;process&quot; of a function call. In Python for example function calls are very expensive, but the &quot;scope&quot; of Python is different: providing a convenient way to make function calls, and a nice interface to certain libraries that thus can perform operations in bulk (ex. with numpy). Haskell on the other hand has laziness, and thus works good if you for example generate a list, and later never want to read more than 10 elements of it."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535351984, "post_id": 52033533, "comment_id": 91017536, "body": "What I mean is that there is a &quot;Haskell-ish&quot; style as well as a &quot;Pythonic&quot; solution. In (online) programming contests, I&#39;ve managed to implement algorithms that usually ended (in terms of runtime) in the top 10% (sometimes no noticable difference versus the &quot;fastest&quot; C++ equivalent), Not because the algorithm was faster, but because you can use the &quot;language tools&quot; in a better way."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1535352319, "post_id": 52033533, "comment_id": 91017655, "body": "For example one thing that might here have impact is setting the type of <code>fib</code> to <code>fib :: Int -&gt; Int</code>. Right now it is any <code>Num</code> type. If it uses <code>Integer</code>, then this will easily get slow, because you now use arbitrary sized integers, not fixed-length integers."}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535352546, "post_id": 52033533, "comment_id": 91017739, "body": "@WillemVanOnsem thanks for hint, I&#39;ll check it soon!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1535352568, "post_id": 52033533, "comment_id": 91017745, "body": "Did you compare the results of these two algorithms, and notice that the C version is wrong for large input, but the Haskell version is correct?  That might give you a hint."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1535356272, "post_id": 52033533, "comment_id": 91019649, "body": "Adding <code>fib :: Int -&gt; Int</code> here improves the performance to 2.2x slower than C."}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535357849, "post_id": 52033533, "comment_id": 91020379, "body": "@WillemVanOnsem - I&#39;ve just tested your suggestion. Really that was the root of the problem. So if you make your comment to proper answer, I will readily mark it as accepted. The running time is reduced to 3 seconds. I&#39;m happy that I spent efforts asking question here instead of angrily dismissing Haskell as an option :)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1535358359, "post_id": 52033533, "comment_id": 91020624, "body": "Plus a non tail recursive function is maybe not the best thing to do with Haskell to compare it to other language."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1535360065, "post_id": 52033533, "comment_id": 91021435, "body": "Please, consider that developing in a new language (where everybody of your team is an entry level programmer though an enthusiastic) will definitely push your costs to an indefinite but significant amount. How many run-time microseconds do you need to safe for the customer to amortize this? IMHO, developers are often enthusiastic with new toys but don&#39;t consider the economical effects too much... ;-) (I must admit that I&#39;m developer myself.)"}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1535363866, "post_id": 52033533, "comment_id": 91023739, "body": "@Scheff developers are always enthusiastic :) and we know that using unknown or rare language increases costs. However currently large parts of solution are written in Erlang and proceeding in this way will increase costs too much (with given amounts of data) compared to switching to Java, Scala, Haskell or anything similar (as Erlang is executed from specific byte-code and not specially optimized for great performance... it has slightly different goals)..."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1535365761, "post_id": 52033533, "comment_id": 91024773, "body": "This is what I found just recently (accidentally): <a href=\"https://codahale.com/the-rest-of-the-story/\" rel=\"nofollow noreferrer\">The Rest Of The Story</a>. I was reminded to it as you mentioned Scala. May be, having read this motivated me to write my above comment although that reflects my own opinion. (I must admit I&#39;m not sure if it is in any way helpful to solve your problem/dilemma...)"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1535366070, "post_id": 52033533, "comment_id": 91024941, "body": "May be, a more helpful hint: For a decision concerning future usage of a language, you may also consider the quantity of available docs, code base, and problem solutions in the internet. (IMHO, this point goes to C/C++.) ;-)"}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 1, "creation_date": 1535370186, "post_id": 52033533, "comment_id": 91027347, "body": "@Scheff this is more and more off-topic, but yes, this is a very important point. Though for most of these languages things are less or more similar. Another point is the amount of libraries (and library repos!) and tools (as enterprise solutions usually are not written from scratch)."}], "owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 170, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535357997, "creation_date": 1535350761, "last_edit_date": 1535357997, "question_id": 52033533, "link": "https://stackoverflow.com/questions/52033533/assessing-haskell-speed", "title": "Assessing Haskell speed", "body": "<p>In short: I need to check Haskell speed on simple operations, and currently have poor results, but I'm not sure if I doing compilation/optimization right.</p>\n\n<p><em>UPD: The problem is <strong>answered</strong>, see comments - the trouble was in different integer type...</em></p>\n\n<p>In details:</p>\n\n<p>I work in a project where a number of services are doing bulk-processing on data, so that at least certain part of these services simply need to be fast. They are doing some heavy calculations and manipulations on data, not only extract-load. In other words it is a matter of how many instances and hours are going to be spent on say on each <code>1e15</code> records of data.</p>\n\n<p>Currently we are considering adding a few more services to project and some of colleagues are curious to try writing them in different language from those already used. I'm less or more ok with it, but I insist we check the \"core performance\" of the proposed languages first. Surely speed testing is hard and controversial, so I propose we use very simple test, with simple operations and without complex data structures etc. We agreed for \"poor recursive\" fibonacci function:</p>\n\n<pre><code>fib x\n  | x &lt; 2 = x\n  | otherwise = fib (x - 2) + fib (x - 1)\n\nmain = print (fib 43)\n</code></pre>\n\n<p>I wrote it in several languages for comparison. The C version looks like:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint fib(int x) {\n    return (x &lt; 2) ? x : (fib(x - 2) + fib (x - 1));\n}\n\nint main(void) {\n    printf(\"%d\\n\", fib(43));\n}\n</code></pre>\n\n<p>I compile the first with <code>ghc -O2 test.hs</code> and the latter with <code>gcc -O2 test.c</code>. GHC version is 8.4.3. Right now I see results differing about 12 times (2.2 seconds on C version, 3 seconds on Java version and 30 seconds on Haskell in the same machine).</p>\n\n<p><strong>I wonder if I did everything about compiler and compiler options right. For I thought as Haskell compiles to native-code (?) it should be comparable to C and similar languages. And I need hints on this.</strong></p>\n\n<p><em>P.S. Please, don't say that fibonacci function could be written without \"exponential\" recursion - I know - but as I said we need some test with a lot of simple calculations.</em></p>\n\n<p><em>P.P.S. I don't mean if we can't make Haskell faster we won't use it. But probably we'll reserve it for some other service where time is spent mainly on input-output, so it won't matter. For current bunch of \"speed-critical\" services it's just the matter of whether the customer will pay $10000 or $120000 for these instances monthly.</em></p>\n"}, {"tags": ["haskell", "enums", "polymorphism"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535350707, "post_id": 52033502, "comment_id": 91017088, "body": "By using <code>mempty</code>, you add an extra argument: <code>Monoid</code>."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1535353394, "post_id": 52033502, "comment_id": 91018131, "body": "<code>Integer</code> is not <code>Bounded</code> and not a <code>Monoid</code>. In ghci types tend to default to <code>()</code> when not numeric."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1535370003, "post_id": 52034372, "comment_id": 91027232, "body": "The &quot;default <code>default</code>&quot; is <code>(Integer, Double)</code>, then <code>ExtendedDefaultRules</code> expands that to <code>((), [], Integer, Double)</code>. This doesn&#39;t include <code>Int</code> -- which explains why GHCi won&#39;t default <code>(Num a, Bounded a, Enum a) =&gt; a</code> to <code>Int</code>. If you explicitly write a <code>default</code> declaration that includes <code>Int</code>, it will; e.g. try <code>default (Int)</code> and then <code>succ minBound + 1</code> in ghci."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1535451199, "post_id": 52034372, "comment_id": 91060800, "body": "Why is <code>()</code> in <code>Enum</code>, for that matter?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1535451496, "post_id": 52034372, "comment_id": 91060971, "body": "@MarkNeu because it is enumerable."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535451499, "post_id": 52034372, "comment_id": 91060979, "body": "...duh!... \u2014 ...seriously \u2013 the <code>Enum</code> class is a bit of a mess, so there&#39;s not too much I&#39;d say about this. But, <code>()</code> is a trivial instance of a great many classes, and trivial instances are a good thing. Generally, instances are good if it&#39;s unambiguous how they behave, and for <code>()</code> it&#39;s completely clear that <code>minBound \u2261 maxBound \u2261 ()</code>. What&#39;s of course not nice is <code>succ _ = \u22a5</code>, but this is a design problem of the <code>Enum</code> class itself and has little to do with the <code>()</code> instance in particular."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1535354727, "last_edit_date": 1535354727, "creation_date": 1535354279, "answer_id": 52034372, "question_id": 52033502, "link": "https://stackoverflow.com/questions/52033502/why-do-enum-operations-fail-when-no-type-is-given-in-ghci/52034372#52034372", "title": "Why do Enum operations fail when no type is given in GHCi?", "body": "<p>It does \u201csimply use a default type\u201d, that's precisely the reason you get this behaviour!</p>\n\n<p>Namely, defaulting tends to always use <em>the simple<strong>st</strong> type that matches the constraint</em>.</p>\n\n<ul>\n<li>When you're doing fractional arithmetic, you need <code>Double</code><sup>\u2020</sup>.</li>\n<li>When you're doing any other arithmetic, an integral type also does the trick; <code>Integer</code> is chosen which is simple in the sense of also having no bounds.</li>\n<li>Where there's no arithmetic, you don't need a <code>Num</code> type. Often, <code>()</code> is sufficient for fulfilling the constraints. Of course it may not be sufficient for fulfilling the <em>semantics</em> you intend, but that basically just means the inferred signature is more general then the one you would have wanted.</li>\n</ul>\n\n<p>What I find slightly surprising is that GHCi won't default <code>(Num a, Bounded a, Enum a) =&gt; a</code> to <code>Int</code>, but gives up finding a default for <code>a</code>.</p>\n\n<p>I generally avoid relying on defaulting at all. A good rule of thumb is to not make a function's arguments more polymorphic than the result<sup>\u2021</sup> (so the argument types can always be inferred from the context), and then if needed just add a single type annotation to the end of the expression at the REPL. This also works here, of course:</p>\n\n<pre><code>Prelude&gt; succ minBound :: Int\n-9223372036854775807\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Arguably, it would be more in line with the philosophy if the default <code>Fractional</code> type were <code>Rational</code>.</sub></p>\n\n<p><sup>\u2021</sup><sub>Unless, of course, you have a particular reason. Conversion functions may need to be independently polymorphic in the argument and result, but they are usually only needed when there's <em>too much</em> type information around already which causes contradiction.</sub></p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 52034372, "answer_count": 1, "score": 0, "last_activity_date": 1535451254, "creation_date": 1535350602, "last_edit_date": 1535451254, "question_id": 52033502, "link": "https://stackoverflow.com/questions/52033502/why-do-enum-operations-fail-when-no-type-is-given-in-ghci", "title": "Why do Enum operations fail when no type is given in GHCi?", "body": "<p>For example, I'd expect the following to simply use a default type, however:</p>\n\n<pre><code> succ mempty\n*** Exception: Prelude.Enum.().succ: bad argument\n succ minBound\n*** Exception: Prelude.Enum.().succ: bad argument\n :t succ mempty\nsucc mempty :: (Monoid a, Enum a) =&gt; a\n :t succ minBound\nsucc minBound :: (Bounded a, Enum a) =&gt; a\n</code></pre>\n\n<p>I'd expect <code>(Bounded a, Enum a) =&gt; a</code> to at least match <code>Int</code>.</p>\n"}, {"tags": ["haskell", "zlib", "yesod", "template-haskell", "haskell-wai"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1535839474, "post_id": 52031292, "comment_id": 91215475, "body": ":s/revieved/received/"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1536366807, "post_id": 52031292, "comment_id": 91411563, "body": "This turns out to be a NIX issue.  It&#39;s version of gcc does not provide the ghci with the correct path to libraries.  At the command line this can be fixed with -L/usr/lib/ but there is no way (that I have found) to thread this all the way through to the Template Haskell invocation.  I&#39;m starting from scratch without NIX which seems to me to have created far more problems than it solved."}], "answers": [{"comments": [{"owner": {"reputation": 512, "user_id": 6101126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2be7f7a86ee63ee179d839c721f2d64?s=128&d=identicon&r=PG&f=1", "display_name": "binky", "link": "https://stackoverflow.com/users/6101126/binky"}, "edited": false, "score": 0, "creation_date": 1536267823, "post_id": 52175888, "comment_id": 91373590, "body": "And just for fun, try adding a symlink in /usr/lib (i.e. <code>ln -s &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libz.so &#47;usr&#47;lib&#47;libz.so</code>)"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1536361309, "post_id": 52175888, "comment_id": 91410622, "body": "Well since we are talking about GHC (and with template Haskell GHCi) as run through cabal, I cannot post a gcc command line. I&#39;ll try to extract the linker command from cabal, but no promises.  I did add the link you suggested in the comment. Waiting on the build process...."}], "tags": [], "owner": {"reputation": 512, "user_id": 6101126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2be7f7a86ee63ee179d839c721f2d64?s=128&d=identicon&r=PG&f=1", "display_name": "binky", "link": "https://stackoverflow.com/users/6101126/binky"}, "is_accepted": true, "score": 1, "last_activity_date": 1536111086, "creation_date": 1536111086, "answer_id": 52175888, "question_id": 52031292, "link": "https://stackoverflow.com/questions/52031292/wai-template-functions-cannot-find-libz-so/52175888#52175888", "title": "Wai template functions cannot find Libz.so", "body": "<p>I feel your pain.<br>\nYou've probably already tried these, but here are some random ideas:  </p>\n\n<ul>\n<li>Make sure the symlink /usr/lib/x86_64-linux-gnu/libz.so still has a valid target.</li>\n<li>Add \"-L /usr/lib/x86_64-linux-gnu\" to the command line.</li>\n<li>Try using -rpath in the linker command line (<a href=\"ftp://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html\" rel=\"nofollow noreferrer\">ftp://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html</a>) although it probably won't help.</li>\n<li>Make sure that the compiler architecture is really x86_64-linux-gnu (gcc -print-multiarch).</li>\n</ul>\n\n<p>If I think of any more, I'll be back. :-)</p>\n\n<p>It might (or might not) help if you could post the verbatim gcc command line.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 52175888, "answer_count": 1, "score": 5, "last_activity_date": 1546955530, "creation_date": 1535330082, "last_edit_date": 1546955530, "question_id": 52031292, "link": "https://stackoverflow.com/questions/52031292/wai-template-functions-cannot-find-libz-so", "title": "Wai template functions cannot find Libz.so", "body": "<p><code>&lt;command line&gt;: can't load .so/.DLL for: libz.so (libz.so: cannot open shared object file: no such file or directory)</code></p>\n\n<p>This is the error I'm getting while trying to install some of the WAI libraries:</p>\n\n<ul>\n<li>wai-app-static-3.1.6.2</li>\n<li>wai-websockets-3.0.1.2</li>\n</ul>\n\n<p>This seems to be related to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11042\" rel=\"nofollow noreferrer\">Template Haskell having problems with dynamic linking</a>. Other packages that link to zlib (or libz or z or libz1g or whatever the flavor of the month package manager has chosen to call the standard compression library) work fine, it is only the ones that are trying to link to it at dynamically at compile time.</p>\n\n<p>I've used <code>nix-env -i zlib &amp;&amp; nix-shell -p zlib</code></p>\n\n<p>I've done <code>apt-get install</code> on  <code>zlib1g</code>, <code>zlib1g-dev</code>, <code>lib32z1</code>, <code>zlib1g:i386</code>, libc6-i386, <code>lib32stdc++6</code>, <code>lib32gcc1</code>, <code>lib32ncurses5</code> (?!) as suggested by other zlib question.</p>\n\n<p><code>whereis libz.so</code> gives <code>/usr/lib/x86_64-linux-gnu/libz.a /usr/lib/x86_64-linux-gnu/libz.so</code> so I think the library is actually installed.</p>\n\n<p>I got a stripped down version of wai-app-static working by stripping out all the TH code, but I cannot extract it from wai-websockets without breaking the whole package.</p>\n\n<p>Has anyone found a way to get these libraries to install, preferably with Nix, but at this point however I can make it happen. I've been trying for three days to get a working build and have blown my entire weeks side project time without getting to write a single line of my own code.  I'll take any hack that will work at this point.</p>\n\n<hr>\n\n<p>Someone asked for the command line used.  Here is is as generated by cabal:</p>\n\n<pre><code>/home/jfmiller28/.nix-profile/bin/ghc --make -fbuilding-cabal-package -O -static -dynamic-too -dynosuf dyn_o -dynhisuf dyn_hi -outputdir dist/build -odir dist/build -hidir dist/build -stubdir dist/build -i -idist/build -i. -idist/build/autogen -idist/build/global-autogen -Idist/build/autogen -Idist/build/global-autogen -Idist/build -optP-include -optPdist/build/autogen/cabal_macros.h -this-unit-id wai-app-static-3.1.6.2-LkSB3kK5rpLKV2jrN2AtNR -hide-all-packages -Wmissing-home-modules -package-db dist/package.conf.inplace -package-id base-4.10.0.0 -package-id wai-3.2.1.2-i068T7XVUlLxs3fKcREfc -package-id bytestring-0.10.8.2 -package-id http-types-0.12.1-2xWgExX0qOl7yKh7LxUBE2 -package-id transformers-0.5.2.0 -package-id unix-compat-0.5.1-1iiashTJMVo4Z2Bo2H1Lus -package-id directory-1.3.0.2 -package-id containers-0.5.10.2 -package-id time-1.8.0.2 -package-id old-locale-1.0.0.7-7dfSJrRIye3EgzsPnyvNPA -package-id file-embed-0.0.11-8MbWlMh1peh6Y3L9VmTvZW -package-id text-1.2.3.0-1kNDH38DjPO1AsUcP35BNj -package-id cryptonite-0.25-GXzdjgRkEVOKY7fpyz8xaf -package-id memory-0.14.16-5MukHHE9BjI5qglqVrRBGo -package-id http-date-0.0.8-CG5y9eYkeUn6wOfbHom4pU -package-id blaze-html-0.9.1.1-CsJ11WXjlLxBrTMbayeoQA -package-id blaze-markup-0.8.2.1-I4KSuVAN6lL9BOh5kJrkji -package-id mime-types-0.1.0.8-2EwGkNBk8W7Io9sTyOvZ5e -package-id unordered-containers-0.2.9.0-EAgi4LFNl39D8BgT0rhlvy -package-id template-haskell-2.12.0.0 -package-id zlib-0.6.2-KD4SSz9PUL57YfOUBW0y3t -package-id filepath-1.4.1.2 -package-id wai-extra-3.0.24.2-18RlcgWRZiDEaepZgYOTPU -package-id optparse-applicative-0.12.1.0-9EJm9hUjsSHG4weMNInJgv -package-id warp-3.2.23-590EqUmbUTP1AQ3mjwuKbZ -XHaskell98 -XCPP Network.Wai.Application.Static WaiAppStatic.Storage.Filesystem WaiAppStatic.Storage.Embedded WaiAppStatic.Listing WaiAppStatic.Types WaiAppStatic.CmdLine Util WaiAppStatic.Storage.Embedded.Runtime WaiAppStatic.Storage.Embedded.TH -Wall\n</code></pre>\n"}, {"tags": ["haskell", "syntax", "do-notation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1535328687, "post_id": 52031091, "comment_id": 91012820, "body": "Haskell has <i>no</i> <code>return</code> statement, it has a <code>return</code> function, and it does <i>not</i> work like the return statement in imperative languages."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1535334907, "post_id": 52031091, "comment_id": 91013741, "body": "If you remove all of the curly braces from that code, without changing the indentation, it should fix the parse error. Also, curly braces are rarely explicitly used in Haskell."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1535397636, "post_id": 52031091, "comment_id": 91042354, "body": "critique or improvement suggestions for working code belong on CodeReview, not on SO. :)"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1535351376, "last_edit_date": 1535351376, "creation_date": 1535350879, "answer_id": 52033556, "question_id": 52031091, "link": "https://stackoverflow.com/questions/52031091/haskell-how-do-i-nest-multiple-if-statements-containing-multiple-putstrln-sata/52033556#52033556", "title": "Haskell - How do I nest multiple if statements containing multiple putStrLn satatements", "body": "<p>You are missing <em>one</em> semicolon, on <a href=\"https://ideone.com/2v9QBx\" rel=\"nofollow noreferrer\">line 31</a>, between the <code>putStrLn</code> and an <code>if</code>:</p>\n\n<pre><code>    ....\n    else do\n    {\n      putStrLn (\"no \" ++ emacsdf ++ \"found in your home folder\")\n    ;                                                            -- HERE\n      if confemp\n      then do\n        {\n          putStrLn (\"nor folders with the alternative emacs config\\n\" ++\n                    \"exiting...\" )\n\n        }\n    ....\n</code></pre>\n\n<p>The template to follow is </p>\n\n<pre><code>    do { ... ; ... ; ... }\n</code></pre>\n\n<p>Explicit braces <em>and</em> semicolons will prevent any parsing errors due to mis-indentation (possibly due to tabs/spaces issues) in your code. </p>\n\n<p>The <em>fully explicit</em> notation always uses <code>;</code> between each of the <code>do</code> block statements. <code>if ... then ... else ...</code> makes up for <em>one</em> expression / <code>do</code> statement, even if spread across several lines of code.</p>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1535370836, "accepted_answer_id": 52033556, "answer_count": 1, "score": -3, "last_activity_date": 1535398599, "creation_date": 1535327619, "last_edit_date": 1535398599, "question_id": 52031091, "link": "https://stackoverflow.com/questions/52031091/haskell-how-do-i-nest-multiple-if-statements-containing-multiple-putstrln-sata", "closed_reason": "Not suitable for this site", "title": "Haskell - How do I nest multiple if statements containing multiple putStrLn satatements", "body": "<p>This is the gist of <a href=\"https://gist.github.com/bigos/9794fbe50c96f13b1ad45fe6f609763f\" rel=\"nofollow noreferrer\">the problem</a>:</p>\n\n<pre><code>check_if_proceed configFolders = do\n  let emacsdf = \"/home/jacek/.emacs.d\"\n  traceM (\"calling check_if_proceed \" ++ show (\"ccc\",configFolders))\n  exists &lt;- doesDirectoryExist emacsdf\n  symlink &lt;- pathIsSymbolicLink emacsdf\n  let confemp = configFolders == []\n  let result = False\n  if exists\n    then do\n    {\n      if symlink\n      then do\n        {\n          putStrLn (\"This action will overwrite the existing symlink\\n\"++\n                    \"poinitng to \" ++ \"SOMEWHERE-FINISH ME\\n\\n\" )\n        }\n      else do\n        {\n          putStrLn (emacsdf ++ \" is not a symlink\\n\"++\n                    \"to use this utility, in your terminal do soemthing like:\\n\"++\n                    \"$ mv \" ++ emacsdf ++ \" \" ++ emacsdf ++ \"-alternative-config\\n\" ++\n                    \"exiting...\" )\n        }\n    }\n    else do\n    {\n      putStrLn (\"no \" ++ emacsdf ++ \"found in your home folder\")\n      if confemp\n      then do\n        {\n          putStrLn (\"nor folders with the alternative emacs config\\n\" ++\n                    \"exiting...\" )\n\n        }\n      else\n        do {\n          putStrLn \"will try to symlink one of the found folders\"\n          }\n    }\n</code></pre>\n\n<p>bonus points for the indication how to add the return statements to that.</p>\n\n<h2>working code</h2>\n\n<p>This link shows a somewhat working code that allows me to explore problem space using imperative style.</p>\n"}, {"tags": ["haskell", "testing", "dependency-injection", "haskell-spock", "wreq"], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1535318833, "post_id": 52030379, "comment_id": 91011150, "body": "Here is an example of abstracting a dependency on wreq using a module signatures <a href=\"https://github.com/danidiaz/thrifty-sailor/blob/master/library/ThriftySailor/Network.hsig\" rel=\"nofollow noreferrer\">github.com/danidiaz/thrifty-sailor/blob/master/library/&hellip;</a> and here is a tutorial on &quot;Backpack&quot;, the extension to the Haskell module system that enables signatures: <a href=\"https://github.com/danidiaz/really-small-backpack-example\" rel=\"nofollow noreferrer\">github.com/danidiaz/really-small-backpack-example</a>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1535389086, "last_edit_date": 1535389086, "creation_date": 1535318712, "answer_id": 52030379, "question_id": 52029956, "link": "https://stackoverflow.com/questions/52029956/haskell-how-to-test-a-spock-app-that-uses-wreq/52030379#52030379", "title": "Haskell: How to test a Spock app that uses wreq?", "body": "<p>If we want to support different methods of making request, we must abstract over them. You could make your handlers accept as argument a function that performs HTTP requests, and then pass different functions for testing and production. If you have more than one related function, put them in a record (the <a href=\"https://jaspervdj.be/posts/2018-03-08-handle-pattern.html\" rel=\"nofollow noreferrer\">handle pattern</a>).</p>\n\n<hr>\n\n<p>If we are using <a href=\"https://www.haskell.org/cabal/download.html\" rel=\"nofollow noreferrer\">cabal-install</a> > 2.0 (with the <a href=\"https://cabal.readthedocs.io/en/latest/nix-local-build-overview.html?highlight=nix%20style%20local\" rel=\"nofollow noreferrer\">new-* commands</a>) another possible option is to use a <a href=\"https://wiki.haskell.org/Module_signature\" rel=\"nofollow noreferrer\">module signature</a> to switch implementations between the test suite and the final executable app. This solution also makes heavy use of the <a href=\"https://cabal.readthedocs.io/en/latest/developing-packages.html#sublibs\" rel=\"nofollow noreferrer\">internal convenience libraries</a> feature of Cabal.</p>\n\n<p>The basic idea is this: we put our Spock application in its own library, but do not make it depend on <a href=\"http://hackage.haskell.org/package/wreq\" rel=\"nofollow noreferrer\">wreq</a> directly. Instead, we declare in the same library a signature <code>Requests.hsig</code> like this:</p>\n\n<pre><code>signature SomeSpockApp.Requests where\n\nimport           Data.Aeson (FromJSON)\n\ndata Token\n\ndoGET :: FromJSON a =&gt; String -&gt; Token -&gt; IO a \n</code></pre>\n\n<p>It defines a high-level interface for performing HTTP requests. The code in the library will import this signature. For the rest of the code in the library, <code>SomeSpockApp.Requests</code> is just another module.</p>\n\n<p>Next, we define a convenience library that will provide an actual module <code>SomeSpockApp.Requests</code> (same name as the signature, except that now it is a <code>hs</code> file). It will contain the \"mock\" code. Of course the definition of <code>doGET</code> must be compatible with the signature.</p>\n\n<p>We also define another convenience library with another <code>SomeSpockApp.Requests</code> module. This one should depend on wreq and fulfill the methods of our signature using wreq's functions.</p>\n\n<p><em>In the test suite</em>, we should depend on both our Spock app library and the mock library. The names of the signature and of the mock implementation module line up perfectly, so nothing more needs to be done. (If the names dont' match, we can use a <a href=\"https://cabal.readthedocs.io/en/latest/developing-packages.html?highlight=mixins#pkg-field-mixins\" rel=\"nofollow noreferrer\">mixins</a> stanza in the cabal file to rename the module).</p>\n\n<p><em>In the app executable,</em> we should depend on both our Spock app library and the wreq-using library. </p>\n"}], "owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1535389086, "creation_date": 1535314814, "last_edit_date": 1535317050, "question_id": 52029956, "link": "https://stackoverflow.com/questions/52029956/haskell-how-to-test-a-spock-app-that-uses-wreq", "title": "Haskell: How to test a Spock app that uses wreq?", "body": "<p>I've written a very simple app in Haskell using <a href=\"https://www.spock.li/\" rel=\"nofollow noreferrer\">Spock</a> and <a href=\"http://hackage.haskell.org/package/wreq\" rel=\"nofollow noreferrer\">wreq</a>. I want to write some tests, but I'm not sure how to do it. </p>\n\n<p>All the app does is make an HTTP request to another server and translate the JSON response into a human-friendly message. Here is <a href=\"https://github.com/gigalixir/gigalixir-default-backend/blob/master/app/Main.hs\" rel=\"nofollow noreferrer\">the code</a> if it helps. I want to write a test that asserts the human-friendly message is correct given a certain JSON response.</p>\n\n<p>In Ruby, I would mock out the HTTP client, in this case <code>wreq</code>, to control the JSON response I get, but I'm not sure how, or even if, to do that in Haskell. </p>\n\n<p>From what I've gathered out of my research, it sounds like <a href=\"https://stackoverflow.com/a/7374754/365377\">type-class-constrained type variables</a> are the way to go, which looks like dependency injection to me, but I'm unsure how to do this within the context of Spock and wreq. </p>\n\n<p>The <a href=\"https://www.spock.li/tutorials/testing\" rel=\"nofollow noreferrer\">Spock testing tutorial</a> describes how to test Spock at the <code>IO Application</code> level which sounds great. The part I'm unsure about is how to \"inject\" a mock HTTP client to control the JSON response.</p>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["haskell", "haskell-diagrams"], "answers": [{"comments": [{"owner": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "edited": false, "score": 0, "creation_date": 1535312291, "post_id": 52029632, "comment_id": 91009626, "body": "For my immediate problem they are two-dimensional rectangles and circles, and I guess I could live with approximating circles as many-sided polygons if I needed to. For the future I had hoped that I could use this for both 2d and 3d things, but for now 2d is enough."}, {"owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "reply_to_user": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "edited": false, "score": 0, "creation_date": 1535313550, "post_id": 52029632, "comment_id": 91009983, "body": "I don&#39;t think approximating circles as many-sided polygons would make anything easier.  Computing normal vectors to circles is much easier than for general polygons."}, {"owner": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "edited": false, "score": 0, "creation_date": 1535313792, "post_id": 52029632, "comment_id": 91010048, "body": "Okay. If I have a special-case version for circles, and another special-case one for line segments I could do that. For circles I can take the vector from the center to the contact point, and for lone line segments, if I know it hits that particular line segment I can get the normal vector of that."}, {"owner": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "edited": false, "score": 0, "creation_date": 1535318856, "post_id": 52029632, "comment_id": 91011154, "body": "That assumes I can &quot;know&quot; which specific circle or line segment the rey hit. I might be able to do that if I make sure to keep those circles and line segments separate; avoid combining them into a single diagram until the last minute. The <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/doc/manual.html#delayed-composition\" rel=\"nofollow noreferrer\">delayed composition</a> section of the guide looks like it might be helpful for that."}], "tags": [], "owner": {"reputation": 1943, "user_id": 305559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc113924265dbeb535c8b2fefe4e33ee?s=128&d=identicon&r=PG", "display_name": "Brent Yorgey", "link": "https://stackoverflow.com/users/305559/brent-yorgey"}, "is_accepted": false, "score": 2, "last_activity_date": 1535312051, "creation_date": 1535312051, "answer_id": 52029632, "question_id": 52028449, "link": "https://stackoverflow.com/questions/52028449/ray-tracing-and-finding-the-normal-vector-to-the-surface-at-the-intersection-poi/52029632#52029632", "title": "ray tracing and finding the normal vector to the surface at the intersection point", "body": "<p>There is no way to do this in general; it depends on what exactly you hit.  There is a module <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Tangent.html\" rel=\"nofollow noreferrer\">Diagrams.Tangent</a> for computing tangents of trails, but to compute the tangent at a given point you have to know its parameter with respect to the trail; and one thing we are missing at the moment is a way to convert from a given point to the parameter of the closest point on a given segment/trail/path (it's been on the to-do list for a while).  </p>\n\n<p>Dreaming even bigger, perhaps traces themselves ought to return something more informative---not just parameters telling you how far along the ray the hit are, but also information about what you hit (from which one could more easily do things like compute a normal vector).</p>\n\n<p>What kinds of things are you computing traces of?  There might be a way to take advantage of the particular details of your use case to get the normals you want in a not-too-terrible way.</p>\n"}, {"tags": [], "owner": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "is_accepted": false, "score": 0, "last_activity_date": 1535346702, "last_edit_date": 1535346702, "creation_date": 1535343533, "answer_id": 52032511, "question_id": 52028449, "link": "https://stackoverflow.com/questions/52028449/ray-tracing-and-finding-the-normal-vector-to-the-surface-at-the-intersection-poi/52032511#52032511", "title": "ray tracing and finding the normal vector to the surface at the intersection point", "body": "<p>Brent Yorgey's answer points out the <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Tangent.html\" rel=\"nofollow noreferrer\">Diagrams.Tangent</a> module, and in particular <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Tangent.html#v:normalAtParam\" rel=\"nofollow noreferrer\"><code>normalAtParam</code></a>, which works on <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Parametric.html#t:Parametric\" rel=\"nofollow noreferrer\"><code>Parameteric</code></a> functions, including trails, but not all Diagrams.</p>\n\n<p>Fortunately, many 2D diagram functions, like <code>circle</code>, <code>square</code>, <code>rect</code>, <code>~~</code>, etc. can actually return any <code>TrailLike</code> type, including <code>Trail V2 n</code>. So a function with the type</p>\n\n<pre><code>rayTraceTrailC :: forall n . (RealFloat n, Epsilon n)\n                  =&gt; \n                  Point V2 n \n                  -&gt; V2 n\n                  -&gt; Located (Trail V2 n)\n                  -&gt; Maybe (Collision V2 n)\n</code></pre>\n\n<p>Would actually work on the values returned by <code>circle</code>, <code>square</code>, <code>rect</code>, <code>~~</code>, etc. if it could be defined:</p>\n\n<pre><code>&gt; rayTraceTrailC \n    (p2 (0, 0))\n    (r2 (1, 0))\n    (circle 1 # moveTo (p2 (2,0)))\nJust (Collision 1 (p2 (1, 0)) (r2 (-1, 0)))\n</code></pre>\n\n<p>And this function can be defined by breaking the trail up into a list of fixed segments which are either linear or bezier curves, using the <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Trail.html#v:fixTrail\" rel=\"nofollow noreferrer\"><code>fixTrail</code></a> function. That reduces the problem to the simpler <code>rayTraceFixedSegmentC</code>.</p>\n\n<pre><code>rayTraceTrailC start vel trail =\n  combine (mapMaybe (rayTraceFixedSegmentC start vel) (fixTrail trail))\n  where\n    combine [] = Nothing\n    combine cs = Just (minimumBy (\\(Collision a _ _) (Collision b _ _) -&gt; compare a b) cs)\n</code></pre>\n\n<p>The <code>rayTraceFixedSegmentC</code> can use <code>rayTraceP</code> to calculate the contact point, but we can't find the normal vector right away because we don't know what the parameter is at that contact point. So punt further and add <code>fixedSegmentNormalV</code> helper function to the wish list:</p>\n\n<pre><code>rayTraceFixedSegmentC :: forall n . (RealFloat n, Epsilon n)\n                         =&gt;\n                         Point V2 n\n                         -&gt; V2 n\n                         -&gt; FixedSegment V2 n\n                         -&gt; Maybe (Collision V2 n)\nrayTraceFixedSegmentC start vel seg =\n  do\n    end &lt;- rayTraceP start vel (unfixTrail [seg])\n    let time = distance start end / norm vel\n    let normalV = normalize (project (fixedSegmentNormalV seg end) (negated vel))\n    return (Collision time end normalV)\n</code></pre>\n\n<p>This <code>fixedSegmentNormalV</code> function just has to return a normal vector for a single segment going through a single point, without worrying about the <code>vel</code> direction. It can destruct the <code>FixedSegment</code> type, and if it's linear, that's easy:</p>\n\n<pre><code>fixedSegmentNormalV :: forall n . (OrderedField n)\n                       =&gt; \n                       FixedSegment V2 n -&gt; Point V2 n -&gt; V2 n\nfixedSegmentNormalV seg pt =\n  case seg of\n    FLinear a b -&gt; perp (b .-. a)\n    FCubic a b c d -&gt;\n      ???\n</code></pre>\n\n<p>In the <code>FCubic</code> case, to calculate the parameter where the curve goes through <code>pt</code>, I'm not sure what to do, but if you don't mind approximations here we can just take a bunch of points along it and find the one closest to <code>pt</code>. After that we can call <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Tangent.html#v:normalAtParam\" rel=\"nofollow noreferrer\"><code>normalAtParam</code></a> as Brent Yorgey suggested.</p>\n\n<pre><code>fixedSegmentNormalV seg pt =\n  case seg of\n    FLinear a b -&gt; perp (b .-. a)\n    FCubic a b c d -&gt;\n      -- APPROXIMATION: find the closest parameter value t\n      let ts = map ((/100) . fromIntegral) [0..100]\n          dist t = distance (seg `atParam` t) pt\n          t = minimumBy (\\a b -&gt; compare (dist a) (dist b)) ts\n      -- once we have that parameter value we can call a built-in function\n      in normalAtParam seg t\n</code></pre>\n\n<p>With this, the <code>rayTraceTrailC</code> function is working with this approximation. However, it doesn't work for <code>Diagram</code>s, only <code>Located Trail</code>s.</p>\n\n<p>It can work on the values returned by functions like <code>circle</code> and <code>rect</code>, but not on combined diagrams. So you have to keep those building blocks of diagrams separate, as trails, for as long as you need this collision ray tracing.</p>\n\n<p>Using the normal vectors to reflect the rays (the outgoing ray has an equal angle from the normal vector) looks like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/yWx0C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yWx0C.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 7455, "user_id": 5432501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8MGE3.png?s=128&g=1", "display_name": "Alex Knauth", "link": "https://stackoverflow.com/users/5432501/alex-knauth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1535346702, "creation_date": 1535302917, "question_id": 52028449, "link": "https://stackoverflow.com/questions/52028449/ray-tracing-and-finding-the-normal-vector-to-the-surface-at-the-intersection-poi", "title": "ray tracing and finding the normal vector to the surface at the intersection point", "body": "<p>When doing a ray trace with <a href=\"https://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Trace.html#v:rayTraceP\" rel=\"nofollow noreferrer\"><code>rayTraceP</code></a>, I can find the point where a ray intersects with a diagram.</p>\n\n<pre><code>&gt; rayTraceP (p2 (0, 0)) (r2 (1, 0)) ((p2 (1,-1) ~~ p2 (1,1))\nJust (p2 (1.0, 0.0))\n</code></pre>\n\n<p>I want to use this to find not only the \"collision point\", but also the collision time and the normal vector to the surface at that point.</p>\n\n<pre><code>-- A Collision has a time, a contact point, and a normal vector.\n-- The normal vector is perpendicular to the surface at the contact\n-- point.\ndata Collision v n = Collision n (Point v n) (v n)\n  deriving (Show)\n</code></pre>\n\n<p>Given a start point for the ray and a velocity vector along the ray, I can find the contact point <code>end</code> using <a href=\"https://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Trace.html#v:rayTraceP\" rel=\"nofollow noreferrer\"><code>rayTraceP</code></a>:</p>\n\n<pre><code>end &lt;- rayTraceP start vel dia\n</code></pre>\n\n<p>And I can find the collision time using the distance between <code>start</code> and <code>end</code>:</p>\n\n<pre><code>time = distance start end / norm vel\n</code></pre>\n\n<p>But I'm stuck on finding the normal vector. I'm working within this function:</p>\n\n<pre><code>rayTraceC :: (Metric v, OrderedField n)\n             =&gt; Point v n -&gt; v n -&gt; QDiagram B v n Any -&gt; Maybe (Collision v n)\n-- Takes a starting position for the ray, a velocity vector for the\n-- ray, and a diagram to trace the ray to. If the ray intersects with\n-- the diagram, it returns a Collision containing:\n--  * The amount of time it takes for a point along the ray going at\n--    the given velocity to intersect with the diagram.\n--  * The point at which it intersects with the diagram.\n--  * The normal vector to the surface at that point (which will be\n--    perpendicular to the surface there).\n-- If the ray does not intersect with the diagram, it returns Nothing.\nrayTraceC start vel dia =\n  do\n    end &lt;- rayTraceP start vel dia\n    let time = distance start end / norm vel\n    -- This is where I'm getting stuck. \n    -- How do I find the normal vector?\n    let normalV = ???\n    return (Collision time end normalV)\n</code></pre>\n\n<p>Some examples of what I want it to do:</p>\n\n<pre><code>&gt; -- colliding straight on:\n&gt; rayTraceC (p2 (0, 0)) (r2 (1, 0)) (p2 (1,-1) ~~ p2 (1,1))\nJust (Collision 1 (p2 (1, 0)) (r2 (-1, 0)))\n&gt; -- colliding from a diagonal:\n&gt; rayTraceC (p2 (0, 0)) (r2 (1, 1)) (p2 (1,0) ~~ p2 (1,2))\nJust (Collision 1 (p2 (1, 1)) (r2 (-1, 0))\n&gt; -- colliding onto a diagonal:\n&gt; rayTraceC (p2 (0, 0)) (r2 (1, 0)) (p2 (0,-1) ~~ p2 (2,1))\nJust (Collision 1 (p2 (1, 0)) (r2 (-\u221a2/2, \u221a2/2)))\n&gt; -- no collision\n&gt; rayTraceC (p2 (0, 0)) (r2 (1, 0)) (p2 (1,1) ~~ p2 (1,2))\nNothing\n</code></pre>\n\n<p>It is correct on everything in these examples except for the normal vector.</p>\n\n<p>I have looked in the documentation for both <a href=\"https://hackage.haskell.org/package/diagrams-lib-1.4.2.3/docs/Diagrams-Trace.html\" rel=\"nofollow noreferrer\">Diagrams.Trace</a> and <a href=\"https://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Trace.html\" rel=\"nofollow noreferrer\">Diagrams.Core.Trace</a>, but maybe I'm looking in the wrong places.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1535513445, "post_id": 52026042, "comment_id": 91087996, "body": "I don&#39;t get the downvotes."}, {"owner": {"reputation": 51440, "user_id": 387194, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dc10501a6e08f9efcb42bf7b434bf1b1?s=128&d=identicon&r=PG", "display_name": "jcubic", "link": "https://stackoverflow.com/users/387194/jcubic"}, "edited": false, "score": 0, "creation_date": 1559556443, "post_id": 52026042, "comment_id": 99444984, "body": "You&#39;ve probably got downvote and close because you didn&#39;t included code inside the question only link to gist."}], "answers": [{"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1535289387, "post_id": 52026532, "comment_id": 91003368, "body": "My mistake was trying to pass the second argument to mapM_  like this: mapM_ printFirstHalfOfSingleString (listDirectory &quot;.&quot;)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 2, "creation_date": 1535289966, "post_id": 52026532, "comment_id": 91003534, "body": "@ruby_object Why not just say that in your question? If you&#39;d posted that code, you&#39;d&#39;ve probably gotten an answer much quicker."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1535290307, "post_id": 52026532, "comment_id": 91003636, "body": "In Haskell part of the problem is knowing what question to ask. After failure after failure and not knowing how to read the error messages I just fell back to a standard imperative question I would ask in that situation."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1535290356, "post_id": 52026532, "comment_id": 91003650, "body": "my version using =&lt;&lt; operator.  mapM_ (\\l -&gt; putStrLn l) =&lt;&lt; listDirectory &quot;.&quot;"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1535288771, "creation_date": 1535288771, "answer_id": 52026532, "question_id": 52026042, "link": "https://stackoverflow.com/questions/52026042/how-do-i-get-a-list-of-strings-containing-file-names-in-the-current-directory/52026532#52026532", "title": "How do I get a list of Strings containing file names in the current directory?", "body": "<p>You can use <code>(=&lt;&lt;) :: ([String] -&gt; IO b) -&gt; (IO [String] -&gt; IO b)</code> to teach a function which expects lists of strings how to handle a value like <code>listDirectory \".\"</code> that produces IO-wrapped lists of strings instead. In idiomatic Haskell, its <code>flip</code>ped form, <code>(&gt;&gt;=) :: IO [String] -&gt; ([String] -&gt; IO b) -&gt; IO b</code>, is more common, because its arguments appear in the order that IO is executed. So, for example:</p>\n\n<pre><code>import System.Directory\n\nprintFirstHalfOfSingleString :: String -&gt; IO ()\nprintFirstHalfOfSingleString s = putStrLn (take (length s `div` 2) s)\n\nprintFirstHalfOfEachString :: [String] -&gt; IO ()\nprintFirstHalfOfEachString = mapM_ printFirstHalfOfSingleString\n\nmain = listDirectory \".\" &gt;&gt;= printFirstHalfOfEachString\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1535305499, "post_id": 52027877, "comment_id": 91007892, "body": "trying to write own ls would be a step towards achieving what I want. I guess part of the problem is that I do not understand how function arguments work in Haskell."}], "tags": [], "owner": {"reputation": 131, "user_id": 10137587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5f9f63901fdc167407385f38202f04d?s=128&d=identicon&r=PG&f=1", "display_name": "Suricat", "link": "https://stackoverflow.com/users/10137587/suricat"}, "is_accepted": false, "score": 1, "last_activity_date": 1535298606, "creation_date": 1535298606, "answer_id": 52027877, "question_id": 52026042, "link": "https://stackoverflow.com/questions/52026042/how-do-i-get-a-list-of-strings-containing-file-names-in-the-current-directory/52027877#52027877", "title": "How do I get a list of Strings containing file names in the current directory?", "body": "<p>Are you asking for \n<a href=\"https://hackage.haskell.org/package/directory-1.3.3.1/docs/System-Directory.html#v:getDirectoryContents\" rel=\"nofollow noreferrer\">getDirectoryContents</a>, the equivalent of <code>ls</code> in shell ?</p>\n\n<p>Here is a program that lists the file names below the current working directory, printing half of each :</p>\n\n<pre><code>import System.Directory\n\nfirstHalf :: String -&gt; String\nfirstHalf s = take (length s `div` 2) s\n\nmain = do\n    -- Get the current working directory\n    current &lt;- getCurrentDirectory\n    -- Lists the file in current\n    children &lt;- getDirectoryContents current\n    mapM putStrLn (map firstHalf children)\n</code></pre>\n\n<p>In your <a href=\"https://gist.github.com/bigos/0067a62e15dbed264ce6ef92e0eca58c\" rel=\"nofollow noreferrer\">gist</a> code, try <code>listDirectory = getDirectoryContents</code> and\ntake care, <code>getDirectoryContents</code> result also contains <code>\".\"</code> and <code>\"..\"</code> </p>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 0, "closed_date": 1535349926, "accepted_answer_id": 52026532, "answer_count": 2, "score": -4, "last_activity_date": 1535313314, "creation_date": 1535284881, "last_edit_date": 1535313314, "question_id": 52026042, "link": "https://stackoverflow.com/questions/52026042/how-do-i-get-a-list-of-strings-containing-file-names-in-the-current-directory", "closed_reason": "Not suitable for this site", "title": "How do I get a list of Strings containing file names in the current directory?", "body": "<p>I need the list for further operations on strings. I do not want just print the list of strings!</p>\n\n<h2>my code so far</h2>\n\n<p><a href=\"https://gist.github.com/bigos/0067a62e15dbed264ce6ef92e0eca58c\" rel=\"nofollow noreferrer\">https://gist.github.com/bigos/0067a62e15dbed264ce6ef92e0eca58c</a></p>\n\n<h2>clarification of my goal</h2>\n\n<p>I would consider the question answered if somebody provided an example where code traverses through the list of filenames and prints the first half of each filename.</p>\n\n<h2>explanation why I could not do it</h2>\n\n<p>This question\n<a href=\"https://stackoverflow.com/questions/11467066/how-to-get-normal-value-from-io-action-in-haskell\">How to get normal value from IO action in Haskell</a>\nhas the answer submitted by Riccardo T.</p>\n\n<p>has nice pseudocode example.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1535280381, "creation_date": 1535280381, "answer_id": 52025472, "question_id": 52025471, "link": "https://stackoverflow.com/questions/52025471/passing-ghc-options-to-stack-script-interpreter/52025472#52025472", "title": "Passing ghc-options to Stack script interpreter", "body": "<p>Recent version of Stack supports <code>ghc-options</code> directly:</p>\n\n<pre><code>#!/usr/bin/env stack \n-- stack script --resolver lts-12.7 --package yesod --ghc-options -Wall\n\nmain = print \"hello\"\n</code></pre>\n\n<p>And on executing:</p>\n\n<pre><code>$ stack jest.hs\n\n/home/sibi/github/subsite/jest.hs:4:1: warning: [-Wmissing-signatures]\n    Top-level binding with no type signature: main :: IO ()\n  |\n4 | main = print \"hello\"\n  | ^^^^\n\"hello\"\n</code></pre>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 52025472, "answer_count": 1, "score": 4, "last_activity_date": 1535280381, "creation_date": 1535280381, "question_id": 52025471, "link": "https://stackoverflow.com/questions/52025471/passing-ghc-options-to-stack-script-interpreter", "title": "Passing ghc-options to Stack script interpreter", "body": "<p>I'm using Stack interpreter feature and having a code like this:</p>\n\n<pre><code>#!/usr/bin/env stack \n-- stack script --resolver lts-12.7 --package yesod \n\nmain = print \"hello\"\n</code></pre>\n\n<p>I want to pass the <code>ghc-options</code> option to the stack interpreter to it. Is it possible ?</p>\n"}, {"tags": ["haskell", "cassandra"], "answers": [{"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 0, "last_activity_date": 1535559827, "creation_date": 1535559827, "answer_id": 52082097, "question_id": 52025356, "link": "https://stackoverflow.com/questions/52025356/request-response-cassandra/52082097#52082097", "title": "Request/Response Cassandra", "body": "<p>I have not used the library and not tried it, but:</p>\n\n<p>Given that <code>query</code> has the following signature:</p>\n\n<pre><code>query :: (MonadClient m, Tuple a, Tuple b, RunQ q) =&gt; q R a b -&gt; QueryParams a -&gt; m [b]\n</code></pre>\n\n<p>Your signature should be (assuming both columns are strings)</p>\n\n<pre><code>selectAllUser :: IO [Identity (Text,Text)]\n</code></pre>\n\n<p>Explanation: currently you assign it the type</p>\n\n<pre><code>selectAllUser :: IO [Identity Text]\n</code></pre>\n\n<p>which also sets the <code>b</code> from <code>query</code> to <code>Text</code> and therefore it tries to behave as if the row had only a single column.</p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535559827, "creation_date": 1535279413, "last_edit_date": 1535280561, "question_id": 52025356, "link": "https://stackoverflow.com/questions/52025356/request-response-cassandra", "title": "Request/Response Cassandra", "body": "<p>I'm working with a Cassandra connector using cql and cql-io libraries, following the API documentation is making me feel dumb, I cannot understand how to make a request to obtain a response.</p>\n\n<p>For now I'm able to connect to the cassandra backend but when I try to make a query using this code</p>\n\n<pre><code>selectAllUser :: IO [Identity Text]\nselectAllUser = do\n                  logger &lt;- Logger.new Logger.defSettings\n                  conn &lt;- Client.init logger createConnectionSettings\n                  let selectAllQuery = \"SELECT * from haskell_cassandra.haskell_users\" :: QueryString R () (Identity Text)\n                  let queryParam = defQueryParams One ()\n                  runClient conn (query selectAllQuery queryParam)\n</code></pre>\n\n<p>I'm receiving this error</p>\n\n<pre><code> internal error: \"response body reading: Failed reading: column count: 2 =/= 1\\nEmpty call stack\\n\"\n</code></pre>\n\n<p>I understand with the error, that the response has 2 columns, and that's correct my table has 2 columns. But I dont know how to specify the response row.</p>\n\n<p>Any help or code example it would be great!.</p>\n\n<p>Regards.</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1535269278, "post_id": 52023132, "comment_id": 90998630, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+Gen+a\" rel=\"nofollow noreferrer\"><code>elements :: [a] -&gt; Gen a</code></a>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535271103, "post_id": 52023132, "comment_id": 90999033, "body": "I find it rather strange that a ticket is a <code>String</code>. The idea of having a (static) type system is that it guarantees certain contracts. By thus introducing a <code>Ticket</code> data type, you make a contract that the result is a <code>Ticket</code>, not just a <i>random</i> string."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1535297804, "post_id": 52023132, "comment_id": 91005695, "body": "It&#39;s not clear to me what those generators are supposed to do. AFAICT, <code>genWinner</code> and <code>genTicket</code> have the same behaviour. Can you elaborate on the goal?"}, {"owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "edited": false, "score": 0, "creation_date": 1535309451, "post_id": 52023132, "comment_id": 91008908, "body": "genWinner generates three of the same animal, genTicket picks three random ones which could be the same or not."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1535315813, "creation_date": 1535315813, "answer_id": 52030082, "question_id": 52023132, "link": "https://stackoverflow.com/questions/52023132/quickcheck-haskell-generating-random-lottery-tickets/52030082#52030082", "title": "QuickCheck Haskell - generating random lottery tickets", "body": "<p>As @AJFarmar noted, you can use the <code>elements</code> combinator to pick a random element from a list, instead of taking the head of a shuffled version:</p>\n\n<pre><code>genAnimal :: Gen String\ngenAnimal = elements [\"tiger\",\"rabbit\",\"dragon\",\"snake\",\"rat\",\"ox\",\n                      \"pig\",\"sheep\",\"horse\",\"monkey\",\"dog\"]\n</code></pre>\n\n<p>Also, an applicative style can generally be more succinct, particularly if you introduce helper functions for the pure computations that combine the results:</p>\n\n<pre><code>genPrize :: Gen Int\ngenPrize = choose (10,1000)\n\ngenTicket :: Gen String\ngenTicket = ticket &lt;$&gt; replicateM 3 genAnimal &lt;*&gt; genPrize\n  where ticket animals prize = unwords animals ++ \" \" ++ show prize\n</code></pre>\n\n<p>A few other miscellaneous improvements might come from:</p>\n\n<ul>\n<li>shifting your perspective on your generators to generate words that you combine at the end, instead of strings that have to be <code>unword</code>ed and glued together with blanks;</li>\n<li>or better yet, introducing some datatypes to better model your problem and providing a utility function to print it in the appropriate <code>String</code> form only when needed;</li>\n<li>getting rid of the <code>gen</code> prefixes that clutter everything up</li>\n<li>using the <code>vectorOf</code> alias for <code>replicateM</code> which is a little more readable in this context.</li>\n</ul>\n\n<p>This might lead to something like:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n\nmodule Lottery where\n\nimport Test.QuickCheck\n\ntype Animal = String\ndata Ticket = Ticket [Animal] Int\n\npticket :: Ticket -&gt; String\npticket (Ticket ts prz) = unwords ts ++ ' ':show prz\n\ntickets :: Gen [Ticket]\ntickets = vectorOf 6 (oneof [winner, loser])\n  where winner = Ticket &lt;$&gt; (replicate 3 &lt;$&gt; animal) &lt;*&gt; prize\n        loser  = Ticket &lt;$&gt; (vectorOf 3 animal)      &lt;*&gt; prize\n        animal = elements [\"tiger\",\"rabbit\",\"dragon\",\"snake\",\"rat\",\"ox\",\n                           \"pig\",\"sheep\",\"horse\",\"monkey\",\"dog\"]\n        prize  = choose (10,1000)\n\nmain :: IO ()\nmain = print . map pticket =&lt;&lt; generate tickets\n</code></pre>\n\n<p>which I think looks pretty good.</p>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535315813, "creation_date": 1535256922, "question_id": 52023132, "link": "https://stackoverflow.com/questions/52023132/quickcheck-haskell-generating-random-lottery-tickets", "title": "QuickCheck Haskell - generating random lottery tickets", "body": "<p>This works :</p>\n\n<pre><code>genAnimal :: Gen String\ngenAnimal = do\n  animals &lt;- shuffle [\"tiger\",\"rabbit\",\"dragon\",\"snake\",\"rat\",\"ox\",\"pig\",\"sheep\",\"horse\",\"monkey\",\"dog\"]\n  return (head animals)\n\ngenWinner :: Gen String\ngenWinner = do \n  animal &lt;- genAnimal\n  prize &lt;- choose (10::Int,1000::Int)\n  return (unwords (replicate 3 animal) ++ \" \" ++ show prize)\n\ngenTicket :: Gen String\ngenTicket = do \n  animals &lt;- replicateM 3 genAnimal\n  prize &lt;- choose (10::Int,1000::Int)\n  return (unwords animals ++ \" \" ++ show prize)\n\ngenTickets :: Gen [String]\ngenTickets = do\n  tickets &lt;- replicateM 6 (oneof [genWinner, genTicket])\n  return tickets\n</code></pre>\n\n<p>But it looks just ungainly, is there a more sensible way to combine these generators? It basically picks three random animals and then a random prize and then makes six tickets.</p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1535238042, "post_id": 52021770, "comment_id": 90994134, "body": "It\u2019s the same relationship as value level constructors have to value level functions, i.e., it\u2019s a canonical form.  So like <code>Just 5</code> cannot be evaluated further, neither can <code>Maybe Bool</code>, whereas <code>succ 5</code> evaluates <code>6</code> and <code>String</code> evaluates to <code>[Char]</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1535274855, "post_id": 52021770, "comment_id": 90999908, "body": "See also the explanation of &quot;generativity&quot;, &quot;injectivity&quot; and &quot;matchability&quot;  in section 4.2.4 of Richard A. Eisenberg&#39;s thesis <a href=\"http://www.cis.upenn.edu/~sweirich/papers/eisenberg-thesis.pdf\" rel=\"nofollow noreferrer\">cis.upenn.edu/~sweirich/papers/eisenberg-thesis.pdf</a>"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1546986689, "post_id": 52021770, "comment_id": 95034242, "body": "Yup, &quot;matchability&quot; seems to be the concept behind this! Except that I barely understand what is being discussed there! May I ask for a simple (ideally, common) counter-example for non-phd folk?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1535369633, "post_id": 52021935, "comment_id": 91026994, "body": "@WillNess Okay, I&#39;ve included a link to the manual. It turns out there&#39;s several papers involved (it really is a big feature!) so I&#39;ve left that as-is; no sense duplicating that information, I think. If it stops being available in the GHC manual, well, then GHC itself has probably stopped being available."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 12, "last_activity_date": 1535369538, "last_edit_date": 1535369538, "creation_date": 1535238518, "answer_id": 52021935, "question_id": 52021770, "link": "https://stackoverflow.com/questions/52021770/example-of-a-type-level-function-that-is-not-a-type-constructor/52021935#52021935", "title": "Example of a type level function that is not a type constructor", "body": "<p>There are two common usages of the phrase \"type constructor\". Some people use them for any type with an arrow kind; but the Haskell report uses it pretty consistently in a different way, so I'll talk about that definition.</p>\n\n<p>Constructors are created by <code>data</code> and <code>newtype</code> declarations, and are the single new name introduced at the type level by these declarations. Here are some examples of type constructors:</p>\n\n<pre><code>Either\nMaybe\n[]\nBool\n</code></pre>\n\n<p>Whoops, did you notice that last one? That's right, there's nothing about the phrase \"type constructor\" that implies it must be able to take arguments. <code>Bool</code> is a type-level name introduced by a data declaration -- hence is a type constructor. Here are some examples of types which are not constructors:</p>\n\n<pre><code>Maybe Int\na -&gt; b\nEither ()\nm -- even if we know, say, Monad m holds\n</code></pre>\n\n<p>Whoops, did you notice those last two? That's right, going in the other direction, there's nothing about being able to take further type arguments that makes you be a type constructor. Each of <code>Either</code> and <code>()</code> are constructors, but the application of <code>Either</code> to <code>()</code> isn't, because it's not a single type-level name created by a <code>data</code> or <code>newtype</code> declaration. Similarly, <code>m</code> is a type variable, not a constructor -- its meaning isn't fixed by any <code>data</code> or <code>newtype</code> declaration.</p>\n\n<p>Besides constructors and variables, there is one other kind of type-level name in standard Haskell: type aliases. There are two main differences between type aliases and constructors:</p>\n\n<ol>\n<li><p>Constructors are injective, aliases may not be. If <code>FooC a b c</code> and <code>FooC a' b' c'</code> are the same type, and <code>FooC</code> is a constructor, then <code>a</code> and <code>a'</code> are the same type, <code>b</code> and <code>b'</code> are the same type, and <code>c</code> and <code>c'</code> are the same type. Contrast</p>\n\n<pre><code>type FooA a = String\n</code></pre>\n\n<p>in which <code>FooA ()</code> and <code>FooA Bool</code> are the same type, even though <code>()</code> and <code>Bool</code> are not the same type.</p></li>\n<li><p>Constructors may be partially applied, type aliases cannot be. For example, if you write</p>\n\n<pre><code>type BarA a = Maybe a\n</code></pre>\n\n<p>then <code>StateT Int BarA ()</code> is not valid -- <code>BarA</code> must always be given its type argument immediately -- even though <code>StateT Int Maybe ()</code> is. Of course, with</p>\n\n<pre><code>type BarEtaA = Maybe\n</code></pre>\n\n<p>then <code>StateT Int BarEtaA ()</code> is valid again, because the alias <code>BarEtaA</code> doesn't need any arguments before it expands to its defined value of <code>Maybe</code>.</p></li>\n</ol>\n\n<p>There are some other small differences between aliases and constructors, but they are not fundamental (and are relaxed by suitable GHC extensions).</p>\n\n<p>There's just one difference between constructors and variables that I can think of in standard Haskell, namely their interaction with the typeclass mechanism. Specifically, instances must be of the form <code>instance &lt;class&gt; (&lt;constructor&gt; &lt;variable&gt; &lt;variable&gt; &lt;variable&gt; ...) where ...</code> and constraints/contexts must be of the form <code>&lt;class&gt; (&lt;constructor&gt; &lt;variable&gt; &lt;variable&gt; ...) =&gt; ...</code>. These restrictions are relaxed by suitable GHC extensions.</p>\n\n<p>Extended Haskell as implemented by GHC also includes two other forms of defined type-level names, type families and data families, that mix some of the above properties. The names defined by data families are very similar to constructors (they are injective and they can be partially applied) while the names defined by type families are very similar to aliases (they are not guaranteed to be injective and they cannot be partially applied). The chief difference is that they can do \"type-level pattern matching\" in which there are multiple definitions that apply in different cases. A full description probably won't fit in a StackOverflow answer, but <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-TypeFamilies\" rel=\"nofollow noreferrer\">the manual describes them</a> and links to several lengthy papers discussing them.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1535369538, "creation_date": 1535236719, "question_id": 52021770, "link": "https://stackoverflow.com/questions/52021770/example-of-a-type-level-function-that-is-not-a-type-constructor", "title": "Example of a type level function that is not a type constructor", "body": "<p>What is unique to a \"type constructor\" concept in Haskell compared to other type-level functions?</p>\n\n<p>As far as I know they:</p>\n\n<ul>\n<li>allow user to apply arguments to them during compilation</li>\n<li>result in a simple type (not a constraint for example) after supplying finite number of arguments</li>\n</ul>\n"}, {"tags": ["bash", "haskell"], "comments": [{"owner": {"reputation": 37256, "user_id": 736308, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/o5EqQ.jpg?s=128&g=1", "display_name": "cdarke", "link": "https://stackoverflow.com/users/736308/cdarke"}, "edited": false, "score": 5, "creation_date": 1535235274, "post_id": 52021610, "comment_id": 90993680, "body": "If the Haskell prints to <code>stdout</code> then <code>bashVar=$(.&#47;exe arg1 arg2)</code> note no spaces around the <code>=</code>."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1535235769, "post_id": 52021610, "comment_id": 90993787, "body": "Your question is unclear. What do you mean by &quot;return a value&quot;? Bash doesn&#39;t have a concept of &quot;return values&quot; for commands, so no, you cannot &quot;return a value&quot; because the whole concept of &quot;returning&quot; doesn&#39;t exist. There are two ways that a command can communicate with the outside world: writing to a file (and that includes stdout, stderr, pipes, sockets, etc.) and specifically for communicating success or failure to the calling command (usually the shell): exit codes. So, printing to stdout would be the correct way, but you explicitly exclude that, so there is no way."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1535238264, "post_id": 52021610, "comment_id": 90994162, "body": "@J&#246;rgWMittag, there are at least two other ways, which are quite irrelevant: it can send a signal to another process and it can write to shared memory."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1535244163, "post_id": 52021610, "comment_id": 90994934, "body": "Point being, the asker seems unclear about the basic mechanisms of processes and how shell scripts can (and can not) orchestrate processes.  If the asker can clarify, even if that clarification is asking for OS concept details, then it would help."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1535452897, "post_id": 52021610, "comment_id": 91061891, "body": "<code>bash</code> does have a concept of return value for commands, but it&#39;s an integer (possibly quite small). From the manual: <a href=\"https://www.gnu.org/software/bash/manual/html_node/Simple-Commands.html#Simple-Commands\" rel=\"nofollow noreferrer\">&quot;The return value of a simple command is its exit status, or 128+n if the command is terminated by signal n.&quot;</a> This is exit status is the <code>exitWith</code> argument. That said, it&#39;s not read as in this question. Consider <a href=\"https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html#Command-Substitution\" rel=\"nofollow noreferrer\"><code>bashStr=&quot;$(command)&quot;</code></a> or <code>command ; bashInt=$?</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1535239045, "last_edit_date": 1535239045, "creation_date": 1535236820, "answer_id": 52021782, "question_id": 52021610, "link": "https://stackoverflow.com/questions/52021610/is-it-possible-to-get-a-haskell-executable-to-return-a-value-to-a-bash-script-th/52021782#52021782", "title": "Is it possible to get a Haskell executable to return a value to a bash script that calls it?", "body": "<p>Programs can send information to a shell through these channels:</p>\n\n<ol>\n<li>The exit code, a number from 0-255. See <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/System-Exit.html#v:exitWith\" rel=\"nofollow noreferrer\"><code>exitWith</code></a>.</li>\n<li>File descriptors, a collection of independent sequences of bytes. The most commonly used are stdout and stderr. (Under normal circumstances, fd 0 (stdin) is read-only, and so is not usually a way for programs to send information to the shell.) Use e.g. <code>putStr</code>/<code>putStrLn</code>/<code>print</code> to send information to stdout, and <code>hPutStr</code>/<code>hPutStrLn</code>/<code>hPrint</code> with <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/System-IO.html#v:stderr\" rel=\"nofollow noreferrer\"><code>stderr</code></a> to send information to stderr. Communicating on other fds is more involved; if you're interested, say so and I can write a bit more about this.</li>\n<li>The file system. (I assume you know the basics of communicating with this medium.)</li>\n</ol>\n\n<p>These channels can always be used to send information shell-ward (though of course whatever shell script you're writing is free to ignore any information communicated that way!). Additionally, other channels can be set up by the shell before invoking the program; e.g. named pipes, sockets, dbus, shared memory, ...</p>\n"}], "owner": {"reputation": 1369, "user_id": 7016101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/630a6b17b61965fcd815c69a2f3e0824?s=128&d=identicon&r=PG&f=1", "display_name": "kebab-case", "link": "https://stackoverflow.com/users/7016101/kebab-case"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1535239045, "creation_date": 1535235052, "question_id": 52021610, "link": "https://stackoverflow.com/questions/52021610/is-it-possible-to-get-a-haskell-executable-to-return-a-value-to-a-bash-script-th", "title": "Is it possible to get a Haskell executable to return a value to a bash script that calls it?", "body": "<p><strong>I have a bash script that calls a Haskell executable, is it possible to get that Haskell exe to return a value such that it can be stored as a bash variable?</strong></p>\n\n<p>For example, say I have the two files: <code>haskellFile.hs</code> and <code>BashScript</code>. </p>\n\n<p>(1) I compile the haskell file like so <code>ghc -o exe haskellFile.hs</code></p>\n\n<p>(2) In my <code>BashScript</code> it calls the exe like so <code>./exe arg1 arg2</code></p>\n\n<p>Currently I have my haskell file print to output, but I'd like it to return a value so I could do  something like <code>bashVar = ./exe arg1 arg2</code></p>\n\n<p>This is basically what my haskell file looks like at the moment:</p>\n\n<pre><code>main :: IO()\nmain = do (arg1:arg2:_) &lt;- getArgs\n    let returnValue = someFunction arg1 arg2\n    print $ returnValue -- But I want it to return a value \n</code></pre>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1535329649, "post_id": 52021594, "comment_id": 91012963, "body": "Can you include the <code>stack.yaml</code> ?"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1535362205, "post_id": 52021594, "comment_id": 91022698, "body": "@epsilonhalbe Updated the question with the <code>stack.yam</code>"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1535364267, "post_id": 52021594, "comment_id": 91023964, "body": "I don&#39;t think you should have anything in <code>extra-deps</code> in the <code>stack.yaml</code>. That field is only for packages that are not on stackage."}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1535371677, "post_id": 52021594, "comment_id": 91028244, "body": "I agree, but I\u2019m new to this. Stack recommended adding those to extra-deps in response to the initial build failure."}], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1535362185, "creation_date": 1535234897, "last_edit_date": 1535362185, "question_id": 52021594, "link": "https://stackoverflow.com/questions/52021594/stack-install-ghc-mod-fails-to-construct-build-plan", "title": "stack install ghc-mod fails to construct build plan", "body": "<p>I've been trying to install ghc-mod locally within a Stack project. </p>\n\n<p>However, whenever I try to <code>stack build ghc-mod</code>, I get a build plan failure like the following:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.8.0.0:\n    cabal-helper must match &lt;0.8 &amp;&amp; &gt;=0.7.3.0, but the stack configuration has no specified\n                 version  (latest matching version is 0.7.3.0)\n    djinn-ghc must match &lt;0.1 &amp;&amp; &gt;=0.0.2.2, but the stack configuration has no specified version\n              (latest matching version is 0.0.2.3)\n    extra must match &lt;1.6 &amp;&amp; &gt;=1.4, but the stack configuration has no specified version  (latest\n          matching version is 1.5.3)\n    fclabels must match ==2.0.*, but the stack configuration has no specified version  (latest\n             matching version is 2.0.3.3)\n    ghc-paths must match &lt;0.2 &amp;&amp; &gt;=0.1.0.9, but the stack configuration has no specified version\n              (latest matching version is 0.1.0.9)\n    ghc-syb-utils must match &lt;0.3 &amp;&amp; &gt;=0.2.3, but the stack configuration has no specified\n                  version  (latest matching version is 0.2.3.3)\n    haskell-src-exts must match &lt;1.20 &amp;&amp; &gt;=1.18, but the stack configuration has no specified\n                     version  (latest matching version is 1.19.1)\n    hlint must match &lt;2.1 &amp;&amp; &gt;=2.0.8, but the stack configuration has no specified version\n          (latest matching version is 2.0.15)\n    monad-control must match &gt;=1 &amp;&amp; &lt;1.1, but the stack configuration has no specified version\n                  (latest matching version is 1.0.2.3)\n    monad-journal must match &lt;0.8 &amp;&amp; &gt;=0.4, but the stack configuration has no specified version\n                  (latest matching version is 0.7.2)\n    mtl needed, but the stack configuration has no specified version  (latest matching version\n        is 2.2.2)\n    old-time needed, but the stack configuration has no specified version  (latest matching\n             version is 1.1.0.3)\n    optparse-applicative must match &gt;=0.13.0.0 &amp;&amp; &lt;0.14, but the stack configuration has no\n                         specified version  (latest matching version is 0.13.2.0)\n    pipes must match &lt;4.4 &amp;&amp; &gt;=4.1, but the stack configuration has no specified version  (latest\n          matching version is 4.3.9)\n    safe must match &lt;0.4 &amp;&amp; &gt;=0.3.9, but the stack configuration has no specified version\n         (latest matching version is 0.3.17)\n    semigroups must match &gt;=0.10.0 &amp;&amp; &lt;0.19, but the stack configuration has no specified\n               version  (latest matching version is 0.18.5)\n    split must match &gt;=0.2.2 &amp;&amp; &lt;0.3, but the stack configuration has no specified version\n          (latest matching version is 0.2.3.3)\n    syb must match &lt;0.8 &amp;&amp; &gt;=0.5.1, but the stack configuration has no specified version  (latest\n        matching version is 0.7)\n    temporary must match &lt;1.3 &amp;&amp; &gt;=1.2.0.3, but the stack configuration has no specified version\n              (latest matching version is 1.2.1.1)\n    text must match &lt;1.3 &amp;&amp; &gt;=1.2.1.3, but the stack configuration has no specified version\n         (latest matching version is 1.2.3.0)\n    transformers-base must match &lt;0.5 &amp;&amp; &gt;=0.4.4, but the stack configuration has no specified\n                      version  (latest matching version is 0.4.5.2)\nneeded since ghc-mod is a build target.\n</code></pre>\n\n<p>If I follow the warning's advice to add the missing dependencies to my stack.yaml's <code>extra-deps</code> key, I just get more recursive errors and eventually a build plan that has a build conflict somewhere that's not obvious to me at least and no helpful clues to resolve it.  </p>\n\n<p>Here's the stack.yaml:</p>\n\n<pre><code>flags: {}\npackages:\n- .\nextra-deps:\n- cabal-helper-0.7.3.0\n- djinn-ghc-0.0.2.3\n- extra-1.5.3\n- fclabels-2.0.3.3\n- ghc-paths-0.1.0.9\n- ghc-syb-utils-0.2.3.3\n- hlint-2.0.15\n- base-4.7.0.2\n- StateVar-1.1.1.1\n- deepseq-1.3.0.2\n- vector-algorithms-0.7.0.4\n- monad-control-1.0.2.3\n- monad-journal-0.7.2\n- mtl-2.2.2\n- old-time-1.1.0.3\n- optparse-applicative-0.13.2.0\n- pipes-4.3.9\n- safe-0.3.17\n- semigroups-0.18.5\n- split-0.2.3.3\n- syb-0.7\n- temporary-1.2.1.1\n- text-1.2.3.0\n- transformers-base-0.4.5.2\n- aeson-1.4.0.0\n- ansi-terminal-0.8.0.4\n- ansi-wl-pprint-0.6.8.2\n- async-2.2.1\n- base-orphans-0.8\n- clock-0.7.2\n- cmdargs-0.10.20\n- cpphs-1.20.8\n- data-default-0.7.1.1\n- djinn-lib-0.0.1.3\n- either-4.4.1.1\n- exceptions-0.10.0\n- haskell-src-exts-util-0.2.3\n- hscolour-1.24.4\n- mmorph-1.1.2\n- old-locale-1.0.0.7\n- refact-0.3.0.2\n- stm-2.4.5.0\n- transformers-compat-0.6.2\n- uniplate-1.6.12\n- unordered-containers-0.2.9.0\n- utf8-string-1.0.1.1\n- vector-0.12.0.1\n- void-0.7.2\n- yaml-0.10.0\n- cabal-doctest-1.0.6\n- comonad-5.0.4\n- contravariant-1.5\n- distributive-0.6\n- haskell-src-exts-1.20.2\n- integer-logarithms-1.0.2.1\n- mono-traversable-1.0.9.0\n- prelude-extras-0.4.0.3\n- random-1.1\n- time-1.4.2\n- unliftio-core-0.1.1.0\n- MonadRandom-0.5.1.1\n- attoparsec-0.13.2.2\n- base-compat-0.10.4\n- bifunctors-5.5.3\n- colour-2.3.4\n- conduit-1.3.0.3\n- data-default-class-0.1.2.0\n- data-default-instances-containers-0.0.1\n- data-default-instances-dlist-0.0.1\n- data-default-instances-old-locale-0.0.1\n- dlist-0.8.0.4\n- free-4.12.4\n- hashable-1.2.7.0\n- polyparse-1.12\n- primitive-0.6.4.0\n- profunctors-5.3\n- resourcet-1.2.1\n- scientific-0.3.6.2\n- semigroupoids-5.3.1\n- tagged-0.8.6\n- th-abstraction-0.2.8.0\n- time-locale-compat-0.1.1.4\n- uuid-types-1.0.3\nresolver: ghc-8.0.2\n</code></pre>\n\n<p>Am I missing something here? Surely this should be easier. I gather ghc-mod isn't supported past GHC 8.2 so I deliberately set up the project with GHC 8.0.2 as verified by running GHCI (not without its own long list of warnings). </p>\n\n<p>I also tried with a 7.x version of GHC and that had the same issues, though with slightly different dependencies. </p>\n"}, {"tags": ["haskell", "monads", "z3"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1535225561, "post_id": 52019993, "comment_id": 90991588, "body": "I just pasted your file and then ran <code>print =&lt;&lt; computeTwo</code> in both ghci and compiled and they both produced <code>Just 2</code>.  So there is something going on with your environment."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1535226016, "post_id": 52019993, "comment_id": 90991699, "body": "Thanks @luqui - very good to know."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1535229234, "post_id": 52019993, "comment_id": 90992434, "body": "I too have no problem running this code.  Using Z3 4.8, GHC 8.4.3, OS-X. EDIT: and the Haskell z3 bindings version 4.3.1"}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535235933, "post_id": 52019993, "comment_id": 90993822, "body": "@ThomasM.DuBuisson - would you be able to elaborate how you installed Z3 on OS X and linked it (in stack?)? I tried installing from source and from homebrew and neither version works for me."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535237099, "post_id": 52019993, "comment_id": 90994009, "body": "Z3 is a separate program and library, written in C++.  The Haskell package is simply a binding to the library - or perhaps it calls out to the executabe but I don&#39;t think so.  You can download Z3 from github and build it locally for best results (i.e. in the past the latest released Z3 was still a bit old) or you can download a released binary."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1535237201, "post_id": 52019993, "comment_id": 90994024, "body": "That is to say, I installed <a href=\"https://github.com/Z3Prover/z3\" rel=\"nofollow noreferrer\">z3 from source</a>, performed <code>cabal update ; cabal install z3</code> to get the Haskell bindings, pasted your code into a new <code>foo.hs</code> file, fixed it by adding <code>import Data.Maybe</code>, then loaded it in GHCi and ran <code>computeTwo</code> to obtain the result."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535237209, "post_id": 52019993, "comment_id": 90994026, "body": "@ThomasM.DuBuisson that&#39;s exactly what I&#39;ve done. I&#39;ve both installed it from brew via <code>brew install z3</code> in <code>usr&#47;local&#47;Cellar&#47;z3&#47;4.7.1</code> and also installed it from GitHub into <code>usr&#47;local&#47;bin</code>. Which approach did you follow and how did you point the z3 bindings? I used a <code>stack.yaml</code> file for that."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535237245, "post_id": 52019993, "comment_id": 90994029, "body": "@ThomasM.DuBuisson thank you!"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1535271796, "post_id": 52019993, "comment_id": 90999196, "body": "You might be also interested in <code>sbv</code> package - a more high level interface to different solvers, including Z3."}, {"owner": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "edited": false, "score": 0, "creation_date": 1535403338, "post_id": 52019993, "comment_id": 91044635, "body": "The package provides several small examples, see <a href=\"https://github.com/IagoAbal/haskell-z3/tree/master/examples\" rel=\"nofollow noreferrer\">github.com/IagoAbal/haskell-z3/tree/master/examples</a>. If you read the package description, or the README, both link to these examples. You are welcome to contribute other examples."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "edited": false, "score": 0, "creation_date": 1535458728, "post_id": 52019993, "comment_id": 91065585, "body": "@iago - yeah I was using these but they ran successfully for me so I was looking for an absolute minimal example."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 277, "user_id": 1064567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6d70982e8f87fe26ec767ca1c7ad43?s=128&d=identicon&r=PG", "display_name": "iago", "link": "https://stackoverflow.com/users/1064567/iago"}, "edited": false, "score": 0, "creation_date": 1535458742, "post_id": 52019993, "comment_id": 91065603, "body": "@iago I&#39;d love to add my super simple example if it makes sense as a starting point :)."}], "answers": [{"tags": [], "owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "is_accepted": true, "score": 1, "last_activity_date": 1535282001, "creation_date": 1535282001, "answer_id": 52025674, "question_id": 52019993, "link": "https://stackoverflow.com/questions/52019993/solving-for-x-2-fails-when-using-z3-monad-in-haskell/52025674#52025674", "title": "Solving for x=2 fails when using Z3.Monad in Haskell", "body": "<p>Fixed by:</p>\n\n<p><strong>1) Updating XCode</strong></p>\n\n<p>Using the App Store.</p>\n\n<p><strong>2) Reinstalling z3</strong></p>\n\n<pre><code> brew uninstall z3\n brew install z3\n echo 'export PATH=\"/usr/local/opt/openssl/bin:$PATH\"' &gt;&gt; ~/.bash_profile\n echo 'export LDFLAGS=\"-L/usr/local/opt/openssl/lib\"' &gt;&gt; ~/.bash_profile\n echo 'export CPPFLAGS=\"-I/usr/local/opt/openssl/include\"' &gt;&gt; ~/.bash_profile\n</code></pre>\n\n<p>Last three were specific instructions from the <code>brew install</code> process.</p>\n\n<p>Thanks all for your help.</p>\n"}], "owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 52025674, "answer_count": 1, "score": 0, "last_activity_date": 1535282001, "creation_date": 1535220717, "question_id": 52019993, "link": "https://stackoverflow.com/questions/52019993/solving-for-x-2-fails-when-using-z3-monad-in-haskell", "title": "Solving for x=2 fails when using Z3.Monad in Haskell", "body": "<p>I'm trying to do a really basic example using Z3.Monad interface in Haskell. Unfortunately the package doesn't list a simple, working example so I'm starting from scratch. I have also checked and the examples listed in the package work for me, so there should be no underlying issue with my Z3 installation.</p>\n\n<p><strong>What am I doing</strong></p>\n\n<p>This is the function that fails when run it:</p>\n\n<pre><code>import Z3.Monad\n\ncomputeTwo = evalZ3 $ do\n    x &lt;- mkFreshIntVar \"x\"\n    _2 &lt;- mkInteger 2\n    assert =&lt;&lt; mkEq x _2\n    fmap snd $ withModel $ \\m -&gt; fromJust &lt;$&gt; evalInt m x\n</code></pre>\n\n<p>The error I'm getting is as follows:</p>\n\n<pre><code>uncaught exception: ErrorCall\nZ3.Base.toBool: illegal `Z3_bool' value\nCallStack (from HasCallStack):\n  error, called at src/Z3/Base.hs:3197:23 in z3-4.3.1- \nJxhFvE2Tmnm1VKrfgyob6s:Z3.Base\n</code></pre>\n\n<p><strong>What answer was expected</strong></p>\n\n<p>The model should check with x=2.</p>\n\n<p><strong>What other things I've tried</strong></p>\n\n<p>The equivalent example works in the <a href=\"https://rise4fun.com/z3/tutorial\" rel=\"nofollow noreferrer\">Z3 online checker</a></p>\n\n<pre><code>(declare-const x Int)\n(assert (= x 2))\n(check-sat)\n(get-model)\n</code></pre>\n\n<p>Producing the answer:</p>\n\n<pre><code>sat\n(model \n  (define-fun x () Int\n    2)\n)\n</code></pre>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1535219790, "post_id": 52019797, "comment_id": 90990033, "body": "What are your error messages? Focusing on those is a good way to arrive at a solution."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1535220030, "post_id": 52019797, "comment_id": 90990101, "body": "Also, when you say, &quot;What does the types actually mean?&quot;, which types do you want explained? I&#39;ve identified several."}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1535220274, "post_id": 52019797, "comment_id": 90990171, "body": "@MichaelLitchard Hi Michael, I have updated with the error messages. I mean the types for <code>param</code> and <code>ActionM</code>. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 2, "last_activity_date": 1558701369, "last_edit_date": 1558701369, "creation_date": 1535230518, "answer_id": 52021149, "question_id": 52019797, "link": "https://stackoverflow.com/questions/52019797/how-to-convert-scotty-parameter-as-string/52021149#52021149", "title": "How to convert Scotty parameter as String", "body": "<p>First, some working code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Data.Text.Lazy (Text)\nimport Web.Scotty\n\nmain :: IO ()\nmain = scotty 3000 $\n  get \"/\" $ do\n    name &lt;- param \"name\" `rescue` (\\_ -&gt; return \"haskell\")\n    let greeting = hello name\n    html $ mconcat [\"&lt;h1&gt;hello \", greeting, \"&lt;/h1&gt;\"]\n\nhello :: Text -&gt; Text\nhello s = \"hello \" &lt;&gt; s\n</code></pre>\n\n<p>Since <code>hello</code> is not in the <code>ActionM</code> monad, <code>let</code> binding can be used instead of the <code>&lt;-</code> syntax. </p>\n\n<p><code>param</code> can be used to parse any query parameter that is of the <code>Parseable</code> type class. </p>\n\n<p><code>param :: Parsable a =&gt; Text -&gt; ActionM a</code> means that given the text name of a parameter, <code>param</code> can give back any type you need as long as it is <code>Parseable</code>. Check <a href=\"https://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html#t:Parsable\" rel=\"nofollow noreferrer\">the docs</a> for a list of types that are available. Note that <code>String</code> is not in that list, however <code>Text</code> is. That is why in the above code I changed the <code>hello</code> function to work with <code>Text</code> instead of <code>String</code>. If you prefer to use <code>String</code>, you could unpack the parsed param like:</p>\n\n<pre><code>name &lt;- T.unpack &lt;$&gt; param \"name\" `rescue` (\\_ -&gt; return \"haskell\")\nlet greeting = hello name -- where `hello :: String -&gt; String`\n</code></pre>\n\n<p>(But then you will need to repack the result into text before using the <code>html</code> function)</p>\n\n<p>The other changes that were required were replacing <code>concat</code> with <code>mconcat</code> and <code>++</code> with <code>&lt;&gt;</code>. These functions are accomplishing the same thing as <code>concat</code> and <code>++</code>, however are more general and work with all monoids instead of just lists.</p>\n\n<p>Your last question about what the type of <code>ActionM</code> means.</p>\n\n<p>Under the hood, <code>ActionM</code> is a specialized form of <code>ActionT</code>: <code>ActionM = ActionT Text IO</code></p>\n\n<p><code>ActionT</code> represents a computation which takes place in an environment (the http request), can modify an internal state (the http response), and can result in an error. It's made using a stack of monad transformers which looks like this:</p>\n\n<pre><code>newtype ActionT e m a = ActionT \n  { runAM :: ExceptT (ActionError e) (ReaderT ActionEnv (StateT ScottyResponse m)) a }\n</code></pre>\n"}], "owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 52021149, "answer_count": 1, "score": 1, "last_activity_date": 1558701369, "creation_date": 1535219311, "last_edit_date": 1535220210, "question_id": 52019797, "link": "https://stackoverflow.com/questions/52019797/how-to-convert-scotty-parameter-as-string", "title": "How to convert Scotty parameter as String", "body": "<p>I am new to Haskell and testing some concepts with Scotty web library.</p>\n\n<p>However, I can't get a simple hello world page working.\nI am stuck at converting the parameter as String and apply to another function.</p>\n\n<p>Here is the high-level code that is not working yet.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Web.Scotty\n\nmain :: IO ()\nmain = scotty 3000 $\n  get \"/\" $ do\n    name &lt;- param \"name\" `rescue` (\\_ -&gt; return \"haskell\")\n    greeting &lt;- hello name\n    html $ concat [\"&lt;h1&gt;hello \", greeting, \"&lt;/h1&gt;\"]\n\nhello :: String -&gt; String\nhello s = \"hello \" ++ s\n</code></pre>\n\n<h2>Error Messages</h2>\n\n<pre><code>app/Main.hs:11:17: error:\n    \u2022 Couldn't match type \u2018[]\u2019\n                     with \u2018Web.Scotty.Internal.Types.ActionT\n                             Data.Text.Internal.Lazy.Text IO\u2019\n      Expected type: Web.Scotty.Internal.Types.ActionT\n                       Data.Text.Internal.Lazy.Text IO Char\n        Actual type: String\n&lt;Omitted&gt;\n   |\n11 |     greeting &lt;- hello name\n   |                 ^^^^^^^^^^\n\napp/Main.hs:12:12: error:\n    \u2022 Couldn't match expected type \u2018Data.Text.Internal.Lazy.Text\u2019\n                  with actual type \u2018[Char]\u2019\n&lt;Omitted&gt;\n   |\n12 |     html $ concat [\"&lt;h1&gt;hello \", greeting, \"&lt;/h1&gt;\"]\n   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\napp/Main.hs:12:34: error:\n    \u2022 Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Char\u2019\n&lt;Omitted&gt;\n   |\n12 |     html $ concat [\"&lt;h1&gt;hello \", greeting, \"&lt;/h1&gt;\"]\n   |                                  ^^^^^^^^\n</code></pre>\n\n<h2>Goal</h2>\n\n<p>The <code>hello</code> function is a stub. I would like to proof that the following mechanism work.</p>\n\n<ol>\n<li><p>extract a parameter as String</p></li>\n<li><p>apply to a <code>String -&gt; String</code> function</p></li>\n<li><p>return the result as response</p></li>\n</ol>\n\n<h2>What have I read and tried</h2>\n\n<p>I have read the Scotty <a href=\"https://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html\" rel=\"nofollow noreferrer\">doc</a> and some <a href=\"https://github.com/dbushenko/scotty-blog/blob/master/src/Main.hs\" rel=\"nofollow noreferrer\">code examples</a>.</p>\n\n<p>I read that the <code>param</code> is of type <code>Parsable a =&gt; Text -&gt; ActionM a</code> and <code>ActionM</code> is of type <code>ActionT Text IO</code>.</p>\n\n<p>I have tried <code>name :: T.Text &lt;- param \"name\"</code>, <code>T.unpack</code>, <code>liftIO</code>, etc. but no luck. I think I don't understand the types fully.</p>\n\n<h2>Questions</h2>\n\n<p>What do the types for <code>param</code> and <code>ActionM</code> actually mean?</p>\n\n<p>How can I extract the parameter as String to use with another functions?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "types", "polymorphism", "function-composition", "hoogle"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535218208, "post_id": 52019322, "comment_id": 90989661, "body": "At a guess, hoogle does not allow <code>f</code> to specialise to <code>-&gt;</code>. What if you had a type family <code>X</code> such that <code>X a b c</code> was the type of <code>(.)</code>. Then you can\u2019t really expect hoogle to match <code>f a b c</code> with <code>(.)</code> merely because <code>X</code> could be so defined."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535232553, "post_id": 52019322, "comment_id": 90993137, "body": "@DanRobertson Well, I&#39;d say the reason that wouldn&#39;t work is because you aren&#39;t allowed to say <code>f ~ X</code> anyway. You <i>are</i> allowed to say <code>f ~ (-&gt;)</code>. Indeed, if I look up <a href=\"https://www.haskell.org/hoogle/?hoogle=%3A%3A+a+-&gt;+f+a\" rel=\"nofollow noreferrer\"><code>:: a -&gt; f a</code></a>, I get the usual suspects, plus a ton of results for various specializations of <code>f</code>, like <code>f ~ Identity</code> or <code>f ~ parsec:Consumed</code>. You are probably correct in saying that Hoogle doesn&#39;t like to specialize type constructors to <code>(-&gt;)</code>, but the rationale given doesn&#39;t seem right."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1535232965, "post_id": 52019322, "comment_id": 90993223, "body": "Why is <code>f ~ X</code> not allowed? Do you mean that in <code>f ~ (-&gt;)</code>, <code>(-&gt;)</code> is a type constructor but <code>X</code> being a type family does not count? I think the real answer anyway is that hoogle treats functions in a special way so that searches can reorder arguments. Note that <code>f b c -&gt; f a b -&gt; f a c</code> will find <code>(.)</code> for categories, but still not specialised to functions."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535302553, "post_id": 52025466, "comment_id": 91007085, "body": "Why should that return <code>lookup</code>?"}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535305087, "post_id": 52025466, "comment_id": 91007783, "body": "That type is &quot;search through an associative list&quot;. Lookup is the function that does it. Therefore one should find the other, ideally."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 3, "last_activity_date": 1539346426, "last_edit_date": 1539346426, "creation_date": 1535280359, "answer_id": 52025466, "question_id": 52019322, "link": "https://stackoverflow.com/questions/52019322/why-doesnt-the-type-f-f-b-c-f-f-a-b-f-a-c-match/52025466#52025466", "title": "Why doesn&#39;t the type f (f b c) (f (f a b) (f a c)) match (.)?", "body": "<p>The technical answer is that Hoogle splits the search into arguments and return types on the outer <code>(-&gt;)</code> parts, and then searches for each part individually, before combining the results. The outer <code>(-&gt;)</code> is treated very specially, in particular it's happy to reorder arguments.</p>\n\n<p>The more fundamental reason why Hoogle works this way is that it's a search engine, not a unification engine. If you were searching for the above, and got back <code>(.)</code>, would that have answered your question? My guess is probably not. My favourite example is that searching for <code>\"a -&gt; [(a,b)] -&gt; b\"</code> should return <code>lookup</code>, even though it doesn't unify.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 2, "accepted_answer_id": 52025466, "answer_count": 1, "score": 2, "last_activity_date": 1539346426, "creation_date": 1535215489, "question_id": 52019322, "link": "https://stackoverflow.com/questions/52019322/why-doesnt-the-type-f-f-b-c-f-f-a-b-f-a-c-match", "title": "Why doesn&#39;t the type f (f b c) (f (f a b) (f a c)) match (.)?", "body": "<p>I have just formulated the type of <code>(.)</code>, generalized, as far as I can tell, however, upon typing it into <a href=\"https://www.haskell.org/hoogle/?hoogle=f%20(f%20b%20c)%20(f%20(f%20a%20b)%20(f%20a%20c))&amp;start=21\" rel=\"nofollow noreferrer\">Hoogle</a>, I received no results.</p>\n\n<p>I'd have expected</p>\n\n<pre><code>(.) :: (-&gt;) ((-&gt;) b c) ((-&gt;) ((-&gt;) a b) ((-&gt;) a c))\n     ~ (b -&gt; c) -&gt; ((a -&gt; b) -&gt; (a -&gt; c))\n     ~ (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>to match</p>\n\n<pre><code>thistype ~ f (f b c) (f (f a b) (f a c))\n</code></pre>\n"}, {"tags": ["haskell", "haskell-thyme"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1535216038, "last_edit_date": 1535216038, "creation_date": 1535215646, "answer_id": 52019341, "question_id": 52018616, "link": "https://stackoverflow.com/questions/52018616/how-can-i-get-a-binary-instance-of-the-thyme-packages-utctime-data-type/52019341#52019341", "title": "How can I get a Binary instance of the thyme package&#39;s UTCTime data type?", "body": "<p>Ah yes, the trivial-but-missing instance problem. What I would do:</p>\n\n<ol>\n<li>Add <code>instance Binary Thyme</code> as an orphan instance to yourmodule. Confirm that it works.</li>\n<li>Wrap the instance in an <code>#if !MIN_VERSION_thyme(0,3,6)</code> switch. The reason is, if a new version of <code>thyme</code> appears that already includes the instance too, you don't want the duplicate instance to break your build.<br>Also make sure you have the dependency bound <code>thyme&lt;=0.3.5</code> in your <code>.cabal</code> file, so a new version <em>without</em> the instance won't be tried. (This may seem to make the switch on the instance useless. The point is, you can edit the dependency bounds on Hackage after the fact, and should do so when a <code>thyme</code> version with the instance appears.)</li>\n<li>File a pull request to the <code>thyme</code> maintainers that adds the instance. This should be uncontroversial, since <code>thyme</code> indirectly depends on <code>Binary</code> anyway.</li>\n</ol>\n\n<p>This is only advisable if what you're writing is an executable or small specialists library, though. If it's a library that lots of other projects might use, there's a risk of conflicting with somebody else's orphan instance. In that case, you should instead use a workaround until <code>thyme</code> adds the instance:</p>\n\n<pre><code>data CommandRecord = CommandRecord {\n    command :: Text\n  , timedate :: UTCTime'\n  , path :: Text\n  } deriving Generic\n\nnewtype UTCTime' = UTCTime' {stdUTCThyme :: UTCTime}\ninstance Binary UTCTime' where\n  put = gput . from . stdUTCThyme\n  get = UTCTime' . to &lt;$&gt; gget\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1535230471, "creation_date": 1535230471, "answer_id": 52021144, "question_id": 52018616, "link": "https://stackoverflow.com/questions/52018616/how-can-i-get-a-binary-instance-of-the-thyme-packages-utctime-data-type/52021144#52021144", "title": "How can I get a Binary instance of the thyme package&#39;s UTCTime data type?", "body": "<p>Following with the 1. point from @leftaroundabout I ended up with the following module:</p>\n\n<pre><code>{-# OPTIONS -Wno-orphans #-}\nmodule ThymeBinaryInstances where\n\nimport Data.Binary\nimport Data.Thyme.Internal.Micro\nimport Data.Thyme.Clock\n\ninstance Binary UTCTime\ninstance Binary NominalDiffTime\ninstance Binary Micro\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 52019341, "answer_count": 2, "score": 0, "last_activity_date": 1535230471, "creation_date": 1535210337, "question_id": 52018616, "link": "https://stackoverflow.com/questions/52018616/how-can-i-get-a-binary-instance-of-the-thyme-packages-utctime-data-type", "title": "How can I get a Binary instance of the thyme package&#39;s UTCTime data type?", "body": "<p>I'd like to be able to serialize <code>CommandRecord</code> into binary to be able to save it to a file. However my naive approach of just doing:\n<code>instance Binary CommandRecord</code> does not work due the below error*.</p>\n\n<p>What approach can I use to achieve the above? Right now my thinking would be to work around this issue by, abandoning the idea of using the <code>thyme</code> library and it's <code>UTCTime</code> and instead use <code>time</code> library and it's <code>UTCTime</code> (which has a Binary instance already defined).</p>\n\n<hr>\n\n<p>I have the follow data type:</p>\n\n<pre><code>data CommandRecord = CommandRecord {\n    command :: Text\n  , timedate :: UTCTime\n  , path :: Text\n  } deriving Generic\n</code></pre>\n\n<p>I have the following imports:</p>\n\n<pre><code>import Data.Thyme.Clock\nimport Data.Binary\nimport Data.Binary.Orphans\n</code></pre>\n\n<p>I'm using the following packages:</p>\n\n<ul>\n<li>binary</li>\n<li>binary-orphans</li>\n<li>thyme</li>\n</ul>\n\n<p>Error*:</p>\n\n<pre><code>/home/chris/Projects/Haskell/MoscoviumOrange/src/Main.hs:28:10-\n29: error:\n    \u2022 No instance for (Binary UTCTime)\n        arising from a use of \u2018binary-0.8.5.1:Data.Binary.Class\n.$dmput\u2019\n      There are instances for similar types:\n        instance Binary\n                   time-1.8.0.2:Data.Time.Clock.Internal.UTCTim\ne.UTCTime\n          -- Defined in \u2018Data.Binary.Orphans\u2019\n    \u2022 In the expression:\n        binary-0.8.5.1:Data.Binary.Class.$dmput @CommandRecord\n      In an equation for \u2018put\u2019:\n          put = binary-0.8.5.1:Data.Binary.Class.$dmput \n@CommandRecord\n      In the instance declaration for \u2018Binary CommandRecord\u2019\n   |\n28 | instance Binary CommandRecord\n   |          ^^^^^^^^^^^^^^^^^^^^\n/home/chris/Projects/Haskell/MoscoviumOrange/src/Main.hs:28:10-\n29: error:\n    \u2022 No instance for (Binary UTCTime)\n        arising from a use of \u2018binary-0.8.5.1:Data.Binary.Class\n.$dmget\u2019\n      There are instances for similar types:\n        instance Binary\n                   time-1.8.0.2:Data.Time.Clock.Internal.UTCTim\ne.UTCTime\n          -- Defined in \u2018Data.Binary.Orphans\u2019\n    \u2022 In the expression:\n        binary-0.8.5.1:Data.Binary.Class.$dmget @CommandRecord\n      In an equation for \u2018get\u2019:\n          get = binary-0.8.5.1:Data.Binary.Class.$dmget \n@CommandRecord\n      In the instance declaration for \u2018Binary CommandRecord\u2019\n   |\n28 | instance Binary CommandRecord\n   |          ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "free-monad"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1535196008, "post_id": 52016576, "comment_id": 90983565, "body": "As for (2), perhaps you could use <code>subsume</code> to merge two <code>Writer</code> layers."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1535196281, "post_id": 52016576, "comment_id": 90983640, "body": "As for (1), does writing the interpreters like <code>fileSystemDocInterpreter :: FileSystem ~&gt; Eff ((Writer [String]) &#39;: effs)</code> help things? The idea is that <code>effs</code> is a list of effects which might or might not be empty."}, {"owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1535201529, "post_id": 52016576, "comment_id": 90985018, "body": "@danidiaz your suggestion for 1 works perfectly: <code>AppError ~&gt; Eff (Writer [String] &#39;: effs)</code> and <code>FileSystem ~&gt; Eff (Writer [String] &#39;: effs)</code>. Will have a look at <code>susume</code> tomorrow"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1535231830, "post_id": 52016576, "comment_id": 90992979, "body": "Come to think of it, using <code>Member</code> constraints is even more flexible because that way the writer can be anywhere in the type-level list. Also, <code>subsume</code> might not be necessary after all in this case."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1535233086, "last_edit_date": 1535233086, "creation_date": 1535231607, "answer_id": 52021263, "question_id": 52016576, "link": "https://stackoverflow.com/questions/52016576/how-can-i-merge-effect-interpreters-when-using-a-library-like-freer-simple/52021263#52021263", "title": "How can I merge effect interpreters when using a library like freer-simple?", "body": "<p>The documentation for the <a href=\"http://hackage.haskell.org/package/freer-simple-1.1.0.0/docs/Control-Monad-Freer.html#t:Eff\" rel=\"nofollow noreferrer\"><code>Eff</code></a> type states that</p>\n\n<blockquote>\n  <p>Normally, a concrete list of effects is not used to parameterize Eff. Instead, the Member or Members constraints are used to express constraints on the list of effects without coupling a computation to a concrete list of effects. </p>\n</blockquote>\n\n<p>Therefore, in order to maximize flexibility we could change the signatures of <code>fileSystemDocInterpreter</code> and <code>errorDocInterpreter</code> to:</p>\n\n<pre><code>fileSystemDocInterpreter :: Member (Writer [String]) effs =&gt; FileSystem ~&gt; Eff effs\n\nerrorDocInterpreter :: Member (Writer [String]) effs =&gt; AppError ~&gt; Eff effs\n</code></pre>\n\n<p>We don't really care <em>where</em> the <code>Writer [String]</code> is on the type-level list, of if there are any more effects on the list. We just need  <code>Writer [String]</code> to be there. This change takes care of (1).</p>\n\n<p>As for (2), we could define <code>executeDocumented</code> as follows:</p>\n\n<pre><code>executeDocumented :: forall a. Eff '[FileSystem, AppError, Writer [String]] a \n                  -&gt; (a, [String])\nexecuteDocumented app = run $ runWriter\n                            $ interpret errorDocInterpreter\n                            $ interpret fileSystemDocInterpreter\n                            $ app\n</code></pre>\n\n<p>Here we are making use in the interpreter of the flexibility we gained when defining the computations. We put a <code>Writer [String]</code> at the end of the list, and the two <code>interpret</code>s send <code>FileSystem</code> and <code>AppError</code>s effects to the writer. No need to have separate <code>Writer [String]</code> layers! (That said, if at other occasion we have two effects of the same type at the front of the list, we can use <a href=\"http://hackage.haskell.org/package/freer-simple-1.1.0.0/docs/Control-Monad-Freer.html#v:subsume\" rel=\"nofollow noreferrer\"><code>subsume</code></a> to remove the duplication.)</p>\n"}, {"comments": [{"owner": {"reputation": 1133, "user_id": 7841468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/q41nV.jpg?s=128&g=1", "display_name": "mishsx", "link": "https://stackoverflow.com/users/7841468/mishsx"}, "edited": false, "score": 0, "creation_date": 1594374466, "post_id": 62830963, "comment_id": 111109942, "body": "This does not answer OPs question"}], "tags": [], "owner": {"reputation": 21, "user_id": 1798586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b1c9008ee67a450ada765469e3b8d66?s=128&d=identicon&r=PG", "display_name": "Sergey  Stretovich", "link": "https://stackoverflow.com/users/1798586/sergey-stretovich"}, "is_accepted": false, "score": 1, "last_activity_date": 1594372218, "creation_date": 1594372218, "answer_id": 62830963, "question_id": 52016576, "link": "https://stackoverflow.com/questions/52016576/how-can-i-merge-effect-interpreters-when-using-a-library-like-freer-simple/62830963#62830963", "title": "How can I merge effect interpreters when using a library like freer-simple?", "body": "<p>I've tried to restore a source code to watch how it works</p>\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE MonoLocalBinds #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE Rank2Types #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Main where\n\nimport Data.Monoid\nimport Data.Functor\nimport Data.List\nimport Data.String\nimport Control.Natural (type (~&gt;))\nimport Control.Monad.Freer.Writer (Writer, tell,runWriter)\nimport Control.Monad.Freer\n  (\n    Eff\n  , LastMember\n  , Member\n  , interpret\n  , interpretM\n  , send\n  , run\n  , runM\n  )\n\ndata FileSystem r where\n  ReadFile :: FilePath  -&gt; FileSystem String\n  WriteFile :: FilePath -&gt; String -&gt; FileSystem ()\n\nreadFile :: Member FileSystem effs =&gt; FilePath -&gt; Eff effs String\nreadFile = send . ReadFile\n\nwriteFile :: Member FileSystem effs =&gt; FilePath -&gt; String -&gt; Eff effs ()\nwriteFile pth = send . WriteFile pth\n\ndata AppError r where\n  Ensure :: Bool -&gt; String -&gt; AppError ()\n  Fail :: String -&gt; AppError ()\n\nensure :: Member AppError effs =&gt; Bool -&gt; String -&gt; Eff effs ()\nensure condition message = send $ Ensure condition message\n\nfail :: Member AppError effs =&gt;  String -&gt; Eff effs ()\nfail = send . Fail\n\ndata ApState = ApState {filePath::String,fileText::String} deriving Show\n\ndata TestItem = Item {\n  pre :: String,\n  post :: String,\n  pathTI :: FilePath\n}\n\ndata RunConfig = RunConfig {\n  environment :: String,\n  depth :: Integer,\n  pathRC :: FilePath\n}\n\ntype FileSys r = (Member FileSystem r)\ntype AppFailure r = (Member AppError r)\n\ninteractor :: TestItem -&gt; RunConfig -&gt; (AppFailure r, FileSys r) =&gt; Eff r ApState\ninteractor item runConfig = do\n                              let fullFilePath = pathRC (runConfig :: RunConfig)\n                              Main.writeFile fullFilePath $ pre item  &lt;&gt; post item\n                              Main.fail &quot;random error ~ its a glitch&quot;\n                              txt &lt;- Main.readFile &quot;C:\\\\Vids\\\\SystemDesign\\\\Wrong.txt&quot;\n                              pure $ ApState fullFilePath txt\n\nfileSystemDocInterpreter :: Member (Writer [String]) effs =&gt; FileSystem ~&gt; Eff effs\nfileSystemDocInterpreter =\n     let\n        mockContents::String = &quot;Mock File Contents&quot;\n      in\n        \\case\n          ReadFile path -&gt; tell [&quot;readFile: &quot; &lt;&gt; show path] $&gt; mockContents\n          WriteFile path str -&gt; tell [&quot;write file: &quot; &lt;&gt;\n                                        show path &lt;&gt;\n                                        &quot;\\nContents:\\n&quot; &lt;&gt;\n                                        str]\n\nerrorDocInterpreter :: Member (Writer [String]) effs =&gt; AppError ~&gt; Eff effs\nerrorDocInterpreter = \\case\n       Ensure condition errMsg -&gt; tell [if condition then &quot;Ensure Check Passed&quot; else (&quot;Ensure Check Failed ~ &quot; &lt;&gt;  errMsg) ]\n       Fail errMsg -&gt; tell [&quot;Failure ~ &quot; &lt;&gt;  errMsg]\n\nexecuteDocumented :: forall a. Eff '[FileSystem, AppError, Writer [String]] a\n                  -&gt; (a, [String])\nexecuteDocumented app = run $ runWriter\n                            $ interpret errorDocInterpreter\n                            $ interpret fileSystemDocInterpreter\n                            $ app\n\nmain :: IO ()\nmain = do\n   let ti = Item {pre=&quot;&quot;, post =&quot;&quot;, pathTI =&quot;&quot;}\n   let rc = RunConfig {environment =&quot;&quot;, depth =1, pathRC =&quot;C:\\\\Vids\\\\SystemDesign\\\\VidList.txt&quot;}\n   let (apst,messages) = executeDocumented $ interactor ti rc\n   putStrLn $ show apst\n   mapM_ (\\x-&gt;putStrLn x) messages\n   putStrLn &quot;_&quot;\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 1, "accepted_answer_id": 52021263, "answer_count": 2, "score": 3, "last_activity_date": 1594372218, "creation_date": 1535194482, "last_edit_date": 1535196374, "question_id": 52016576, "link": "https://stackoverflow.com/questions/52016576/how-can-i-merge-effect-interpreters-when-using-a-library-like-freer-simple", "title": "How can I merge effect interpreters when using a library like freer-simple?", "body": "<p>I am playing around with <a href=\"http://hackage.haskell.org/package/freer-simple-1.1.0.0\" rel=\"nofollow noreferrer\">freer-simple</a> and trying to work out how to combine effects.</p>\n\n<p>I have an algebra to represent a simple file system and user invoked failure as follows:</p>\n\n<pre><code>data FileSystem r where\n  ReadFile :: Path a File -&gt; FileSystem String\n  WriteFile :: Path a File -&gt; String -&gt; FileSystem ()\n\nreadFile :: Member FileSystem effs =&gt; Path a File -&gt; Eff effs String\nreadFile = send . ReadFile\n\nwriteFile :: Member FileSystem effs =&gt; Path a File -&gt; String -&gt; Eff effs ()\nwriteFile pth = send . WriteFile pth\n\ndata AppError r where\n  Ensure :: Bool -&gt; String -&gt; AppError ()\n  Fail :: String -&gt; AppError ()\n\nensure :: Member AppError effs =&gt; Bool -&gt; String -&gt; Eff effs ()\nensure condition message = send $ Ensure condition message\n\nfail :: Member AppError effs =&gt;  String -&gt; Eff effs ()\nfail = send . Fail\n</code></pre>\n\n<p>And an \"application\" in a function called interactor as follows:</p>\n\n<pre><code>data TestItem = Item {\n  pre :: String,\n  post :: String,\n  path :: Path Abs File\n}\n\ndata RunConfig = RunConfig {\n  environment :: String,\n  depth :: Integer,\n  path :: Path Abs File\n}\n\ntype FileSys r = (Member FileSystem r)\ntype AppFailure r = (Member AppError r)\n\ninteractor :: TestItem -&gt; RunConfig -&gt; (AppFailure r, FileSys r) =&gt; Eff r ApState\ninteractor item runConfig = do\n                              let fullFilePath = path (runConfig :: RunConfig)\n                              writeFile fullFilePath $ pre item  &lt;&gt; post item\n                              fail \"random error ~ its a glitch\"\n                              txt &lt;- readFile [absfile|C:\\Vids\\SystemDesign\\Wrong.txt|]\n                              pure $ ApState fullFilePath txt\n</code></pre>\n\n<p>At this stage I am only interested in dumb \"documentation\" interpreters that log the steps, I don't even care\nwhat failing would do in terms of control flow:</p>\n\n<pre><code>fileSystemDocInterpreter :: FileSystem ~&gt; Eff '[Writer [String], effs]\nfileSystemDocInterpreter = \n     let\n        mockContents = \"Mock File Contents\"\n      in\n        \\case\n          ReadFile path -&gt; tell [\"readFile: \" &lt;&gt; show path] $&gt; mockContents\n          WriteFile path str -&gt; tell [\"write file: \" &lt;&gt;\n                                        show path &lt;&gt;\n                                        \"\\nContents:\\n\" &lt;&gt;\n                                        str]\n\nerrorDocInterpreter :: AppError ~&gt; Eff '[Writer [String]]\nerrorDocInterpreter = \\case\n                    Ensure condition errMsg -&gt; tell [condition ? \"Ensure Check Passed\" $\n                      \"Ensure Check Failed ~ \" &lt;&gt;  errMsg]\n                    Fail errMsg -&gt; tell [\"Failure ~ \" &lt;&gt;  errMsg]\n</code></pre>\n\n<p>The combined interpreter is as follows:</p>\n\n<pre><code>type FileSys r = (Member FileSystem r)\ntype AppFailure r = (Member AppError r)\n\nexecuteDocumented :: forall a. Eff '[FileSystem, AppError] a -&gt; ((a, [String]), [String])\nexecuteDocumented app = run $ runWriter \n                            $ reinterpret errorDocInterpreter \n                            $ runWriter \n                            $ reinterpret fileSystemDocInterpreter app\n</code></pre>\n\n<p>When I run this with sample configs I get something like the following:</p>\n\n<pre><code>((ApState {\n            filePath = \"C:\\\\Vids\\\\SystemDesign\\\\VidList.txt\", \n            fileText = \"Mock File Contents\"\n          },\n          [\"write file: \\\"C:\\\\\\\\Vids\\\\\\\\SystemDesign\\\\\\\\VidList.txt\\\n                        \"\\nContents: I do a test the test runs\",\n          \"readFile: \\\"C:\\\\\\\\Vids\\\\\\\\SystemDesign\\\\\\\\Wrong.txt\\\"\"]\n         ),\n         [\"Failure ~ random error ~ its a glitch\"]\n )\n</code></pre>\n\n<p>I have a couple of questions about the interpreters above:</p>\n\n<ol>\n<li><p>The order this to compile I had to make the types as follows:</p>\n\n<pre><code>fileSystemDocInterpreter :: FileSystem ~&gt; Eff '[Writer [String], effs] \n\nerrorDocInterpreter :: AppError ~&gt; Eff '[Writer [String]]\n</code></pre>\n\n<p>and call <code>errorDocInterpreter</code> after <code>fileSystemDocInterpreter</code> because the \n<code>fileSystemDocInterpreter</code> has trailing effs and <code>errorDocInterpreter</code> doesn't.</p>\n\n<p>Is there a way to change the type signatures or invoke these so it wouldn't matter \nwhich was needed first by the parent interpreter? </p></li>\n<li><p>Both fileSystemDocInterpreter and errorDocInterpreter use the Writer [String] effect.\nIs there a way to combine these so runWriter is only called once so the failure and file system\nmessages appear in one log?</p></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1535440662, "post_id": 52016512, "comment_id": 91054450, "body": "if you want a value to be shared between different function invocations, name that value and give it a monomorphic type."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535210530, "post_id": 52018076, "comment_id": 90987469, "body": "What do you mean by spine-strict ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535244493, "post_id": 52018076, "comment_id": 90994984, "body": "Under certain circumstances (lots of sorted runs), <code>fromAscList . sort</code> could be faster than <code>fromList</code>. I tried to fix that a while back but didn&#39;t quite get it. Maybe you&#39;d like to give it a go!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535244618, "post_id": 52018076, "comment_id": 90995002, "body": "@mb14 I believe I clarified what I meant by &quot;spine-strict&quot; immediately after introducing the term (&quot;<code>Map</code> is spine-strict -- which means ...&quot;). Perhaps you could clarify which part of the &quot;...&quot; is unclear so I can help further expand on its meaning."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535266048, "post_id": 52018076, "comment_id": 90997924, "body": "I read the &quot;which means&quot; bit as a consequence of being spine-strict not it&#39;s definition. Now I understand. I thought naively that Lazy Map where lazy and strict Map where (fully strict). Am I wrong ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535278487, "post_id": 52018076, "comment_id": 91000704, "body": "@mb14 Lazy maps are as lazy as they can be -- values are not forced, and <code>seq</code> is not called, so any forcing that happens happens as a natural consequence of the data dependencies inherent to maintaining the data structure invariants -- but &quot;as lazy as they can be&quot; is still spine-strict. Strict maps, in addition to forcing the spine naturally as a consequence of the implementation needs, also force the values to WHNF during insertion and update operations."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535281531, "post_id": 52018076, "comment_id": 91001359, "body": "@DanielWagner. I didn&#39;t know that. In that case a lookup is O(log(n)) (not (O(n . log(n)) as the spine has been already built and it answers my question about concatenating singletons (which then is spine-lazy and not sortable ....)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535281790, "post_id": 52018076, "comment_id": 91001432, "body": "@mb14 Concatenating singletons is no lazier than <code>fromList</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1535289386, "post_id": 52018076, "comment_id": 91003366, "body": "@DanielWagner I&#39;m all confused now (which is why I think it was worth posting this question). AFAIU <code>fromList</code> is lazy, as well as the list itself, but calling <code>lookup</code> should build the full spine (is that what spine-strict means?). Concatenating singletons : the list is lazy and and the concatenation should be only be made on demand, so doing a <code>lookup</code> should stop building the spine when an element is found. Am I wrong ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1535289898, "post_id": 52018076, "comment_id": 91003515, "body": "@mb14 Yes, you are wrong: as soon as the top-most constructor of a <code>Map</code> is demanded, the entire spine is evaluated. It would be very difficult, maybe impossible, to create a balanced binary (or other-ary) tree implementation which did otherwise. (It <i>might</i> be possible to make the map lazier in the spine when using <code>fromDistinctAscList</code>; I don&#39;t know off-hand whether <code>Map</code> attempts to do this or not.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1535206022, "creation_date": 1535206022, "answer_id": 52018076, "question_id": 52016512, "link": "https://stackoverflow.com/questions/52016512/effective-way-to-build-a-lazy-map-in-haskell/52018076#52018076", "title": "Effective way to build a (Lazy) Map in Haskell", "body": "<p>I'm not sure I understood the entire motivation behind this question, but I'll make a few comments:</p>\n\n<ol>\n<li><code>Map</code> is spine-strict -- which means the tree structure of a <code>Map</code> and the keys themselves are forced (at least far enough to do all the requisite comparisons) on every <code>Map</code> operation. So I would expect <code>Data.Map.lookup k (fromList xs)</code> to take O(n*log(n)) comparisons (n the length of <code>xs</code>) whereas I would expect <code>Prelude.lookup k xs</code> to take O(n) comparisons (actually just equality checks, but usually that's pretty much the same complexity as a comparison).</li>\n<li>If <code>fromAscList . sort</code> is reliably faster than <code>fromList</code>, this is a performance bug in <code>Data.Map</code> and the library should just be changed to define <code>fromList = fromAscList . sort</code>. I would be very surprised if this were the case. People have spent a fair bit of time optimizing <code>containers</code>, so I wouldn't expect to see any fruit hanging as low as that.</li>\n<li>Yes, inlining breaks sharing.</li>\n</ol>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1535210257, "creation_date": 1535193971, "last_edit_date": 1592644375, "question_id": 52016512, "link": "https://stackoverflow.com/questions/52016512/effective-way-to-build-a-lazy-map-in-haskell", "title": "Effective way to build a (Lazy) Map in Haskell", "body": "<p>I know a few different a way to build a <code>Map</code> in Haskell :</p>\n<ol>\n<li>build it from a list using <code>fromList</code></li>\n<li>build it from a sorted list using <code>fromAscList</code></li>\n<li>Use the fact that <code>Map</code> is a <code>Monoid</code> (or a <code>Semigroup</code>) and concat <code>singletons</code>.</li>\n</ol>\n<p>I understand that the <em>amortized</em> complexity of  #1 is O(n*log(n)) where as #2 is  O(n).\nI Guess #3 should be roughly equivalent to #1 and might be subject to fusion.</p>\n<p>The <em>amortized</em> is important, because Haskell being lazy by default, even though the lookup from a Map is O(log(n)), it can be in practice interleaved with the construction of the Map itself which is O(n * log(n)), which can make in practice the lookup being O(n * log(n)) (especially if you are building the map each time you need it). This also might append if you use hardcoded Map</p>\n<p>For example, am I right to think that <code>lookup 'b' (fromList [('a', 1), ('b', 2)])</code> is actually equivalent to just to d lookup in the list without using a intermediate Map ?</p>\n<p>So is there a difference between #1 and #3 , or sorting the list and the calling <code>fromList</code> ?</p>\n<h2>Update</h2>\n<p>Also, If I need a map to be only computed once, do I need to make sure GHC doesn't inline it, so it is shared between functions ?</p>\n<h2>Use case</h2>\n<p>I realized that the question might be a bit blur and in fact correspond to different use cased I encountered recently.</p>\n<p>The first one correspond to a &quot;static join&quot;. I have an app which manages items and each item code can be split in style and variation (For example 'T-Shirt-Red' =&gt; ('T-Shirt', 'Red'). The split is based on rules (and regexp) and is quite slow. To not recompute the rules all the times, this is done once and stored in a db table. I have a few pure function which need to be able to split an item code so I pass them a function <code>Text -&gt; (Text, Text)</code>. The function is actually a lookup partially applied on a Map. The code is similar to this</p>\n<pre><code>getSplitter :: Handler (Text -&gt; (Text, Text))\ngetSplitter = do\n      sku'style'vars &lt;- runDB $ rawSQL &quot;SELECT sku, style, var FROM style_cache &quot; [] -- load the split table\n      let sku'map = fromList [ (sku, (style,var)) \n                             | (sku, style, var) &lt;- sku'style'vars\n                             ]\n      return $ flip lookup sku'map\n</code></pre>\n<p>This one can be easily speed up by sorting the item by <code>sku</code> and using <code>fromDistinctAscList</code> (which is actually faster than <code>fromAscList</code>). However I still have some issue about how to cache it between different request.</p>\n<p>The second case is to do a manual join between two tables, I usually do something along</p>\n<pre><code>do\n   sku'infos &lt;- selectList [] [] -- load item info\n   let skuInfo = fromList sku'infos\n\n   orderLines &lt;- selectList [] [] -- load orders\n   -- find infos corresponding to order items\n   mapM (\\o -&gt; (o, lookup (orderSku o) skuInfo) orderLines\n</code></pre>\n<p>There again I can sort sku'infos in SQL and use fromDistinctAscList.</p>\n<p>A third case is when fetching miscellaneous info related to an category item in different table.</p>\n<p>For example I want to be able to compare the sales (sales table) and the purchase (purchases table) by category.</p>\n<p>In pure SQL I would do something along</p>\n<pre><code>SELECT style, sum(sales.amount), sum(purchase.amount)\nFROM style_cache\nLEFT JOIN sales USING(sku)\nLEFT JOIN purchases USING(sku)\nGROUP by style\n</code></pre>\n<p>However, this is a simplified example and in practice, the aggregation is much more complicated and have to be done in Haskell as well as the join. To do so I'm loading each table separately (grouping what I can in sql) and return a <code>Map Style SalesInfo</code>, <code>Map Style PurchaseInfo</code> etc ... and merge them. The table are quite big and I realize I end up loading everything in memory whereas I could probably by &quot;zipping&quot; things  manually be much more efficient but I'm not sure how.</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535211555, "post_id": 52016583, "comment_id": 90987730, "body": "<code>IO (Either String ())</code> is also <code>ExceptT String IO ()</code>, right?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535212174, "post_id": 52016583, "comment_id": 90987896, "body": "@chepner They&#39;re two different types, but they&#39;re isomorphic. <code>ExceptT</code> goes the one way, and <code>runExceptT</code> goes the other way."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535212295, "post_id": 52016583, "comment_id": 90987939, "body": "@chepner <code>ExceptT</code>is a <code>newtype</code>, so in a sense you&#39;re right."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535212607, "post_id": 52016583, "comment_id": 90988043, "body": "Ah, yes, I see."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1535196079, "last_edit_date": 1535196079, "creation_date": 1535194548, "answer_id": 52016583, "question_id": 52016330, "link": "https://stackoverflow.com/questions/52016330/haskell-common-pattern-to-deal-with-failure-inside-io-io-either-string-int/52016583#52016583", "title": "Haskell: Common pattern to deal with Failure inside IO :: IO (Either String Int)", "body": "<p>I understand that you're new to Haskell, and that monad transformers aren't the first concept you'd want to grapple with. In a situation like this, it <em>is</em>, however, the pattern to use.</p>\n\n<p>Monads in general enable you to 'weave in and out of functors', so to speak. Had you only had <code>Either</code>, you could have used the <code>Either</code> values with <code>do</code> notation to pull the <code>Right</code> values out of the values, while short-circuiting the <code>Left</code> cases.</p>\n\n<p>In this case, however, you have a 'stack' of monads: <code>Either</code> inside of <code>IO</code>. Thus, when you attempt to use <code>do</code> notation, you're in the <code>IO</code> context, and that means that, as the OP illustrates, the values that you 'pull out of' the functions, using the <code>&lt;-</code> arrow, are still <code>Either</code> values.</p>\n\n<p>Monad transformers enable you to treat stacks of monads (like, in this case <code>Either</code> values inside of <code>IO</code>) as <code>Monad</code> instances, so that you can, e.g., use <code>do</code> notation on the stack.</p>\n\n<p>While you'd expect the <code>Either</code> monad transformer to be called <code>EitherT</code>, it is, for various reasons, called <code>ExceptT</code>. You could simplify the OP code slightly like this:</p>\n\n<pre><code>import Control.Monad (void)\nimport Control.Monad.IO.Class (liftIO)\nimport Control.Monad.Trans.Except\n\nfunctionUse :: IO (Either String ())\nfunctionUse = runExceptT $ do\n  created &lt;- ExceptT $ functionCreate 10\n  liftIO $ void $ functionDoSomething created\n</code></pre>\n\n<p>Here, <code>created</code> is an <code>Int</code> value, which can then be passed to <code>functionDoSomething</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 10272804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a432fce4a233a8daab6d9cc174dff6b?s=128&d=identicon&r=PG&f=1", "display_name": "queue", "link": "https://stackoverflow.com/users/10272804/queue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 1, "closed_date": 1535210301, "accepted_answer_id": 52016583, "answer_count": 1, "score": 3, "last_activity_date": 1535196137, "creation_date": 1535192757, "last_edit_date": 1535196137, "question_id": 52016330, "link": "https://stackoverflow.com/questions/52016330/haskell-common-pattern-to-deal-with-failure-inside-io-io-either-string-int", "closed_reason": "Duplicate", "title": "Haskell: Common pattern to deal with Failure inside IO :: IO (Either String Int)", "body": "<p>Trying to understand the pattern used to deal with possible failures inside <code>IO</code>. If its just one <code>case</code>s like below, its probably acceptable, but if the nesting goes on for a bunch of nested <code>IO (Either String Int)</code>s is there a common pattern to handle such types. For instance, if <code>b</code> in <code>functionDoSomething</code> is again a <code>(Either a b)</code> and fetching value on success and doing something with it again will be another such <code>case</code>. Is there a higher order function that I can use? I'm not comfortable with monad transformers yet, not sure if they can be used to deal with this specific monad stack. If they can be used here, is there a way to do it without using them.</p>\n\n<pre><code>import Control.Monad\n\nfunctionCreate :: Int -&gt; IO (Either String Int)\nfunctionDoSomething :: Int -&gt; IO b\n\nfunctionUse :: IO ()\nfunctionUse = do\n   created &lt;- functionCreate 10\n   case created of\n      (Right v)        -&gt; void $ functionDoSomething v\n      _                -&gt; return ()\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "haskell-platform"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 4, "creation_date": 1535183460, "post_id": 52014878, "comment_id": 90980543, "body": "Use <code>stack --system-ghc</code>, or put that into stack&#39;s global config."}, {"owner": {"reputation": 31, "user_id": 8803285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dauS8.jpg?s=128&g=1", "display_name": "suraj Mandal", "link": "https://stackoverflow.com/users/8803285/suraj-mandal"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1535185345, "post_id": 52014878, "comment_id": 90980963, "body": "how to change stack&#39;s global config! Please do not mind since I am pretty new to Haskell"}, {"owner": {"reputation": 31, "user_id": 8803285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dauS8.jpg?s=128&g=1", "display_name": "suraj Mandal", "link": "https://stackoverflow.com/users/8803285/suraj-mandal"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1535187091, "post_id": 52014878, "comment_id": 90981348, "body": "I have changed the ghc to system-ghc. Now, it works. However, it automatically starts downloading msys2 which is already bundled with the haskell bundle. How to resolve this issue?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1541005143, "post_id": 52014878, "comment_id": 93074036, "body": "@arrowd you should submit your comment as an answer since it resolves the question"}], "answers": [{"tags": [], "owner": {"reputation": 2409, "user_id": 1232110, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/673c347007e8491a529e6514f81683d3?s=128&d=identicon&r=PG", "display_name": "Kevin Zhu", "link": "https://stackoverflow.com/users/1232110/kevin-zhu"}, "is_accepted": false, "score": 0, "last_activity_date": 1580631318, "last_edit_date": 1580631318, "creation_date": 1580631003, "answer_id": 60024283, "question_id": 52014878, "link": "https://stackoverflow.com/questions/52014878/stack-always-downloads-ghc-even-though-it-is-in-path/60024283#60024283", "title": "Stack always downloads ghc even though it is in path", "body": "<p>You can try adding a mirror to speed it up, take a look at  <a href=\"https://mirror.tuna.tsinghua.edu.cn/help/stackage/\" rel=\"nofollow noreferrer\">TsingHua stackage mirror.</a></p>\n\n<p>Reference:</p>\n\n<p><a href=\"https://github.com/commercialhaskell/stack/issues/3870\" rel=\"nofollow noreferrer\">A set of useful alternative package index mirrors?</a></p>\n\n<p><a href=\"https://github.com/commercialhaskell/stack/issues/4870\" rel=\"nofollow noreferrer\">use alternative mirror with stack 2.1.1</a></p>\n"}], "owner": {"reputation": 31, "user_id": 8803285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dauS8.jpg?s=128&g=1", "display_name": "suraj Mandal", "link": "https://stackoverflow.com/users/8803285/suraj-mandal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 736, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1580631318, "creation_date": 1535180866, "last_edit_date": 1538723041, "question_id": 52014878, "link": "https://stackoverflow.com/questions/52014878/stack-always-downloads-ghc-even-though-it-is-in-path", "title": "Stack always downloads ghc even though it is in path", "body": "<p>I want to use Haskell on my computer currently running Windows 10 build 1803, and I am using a broadband connection of 25 Mbps. As of 2018, the Haskell compiler version known as ghc is 8.4.3. </p>\n\n<p>First I download the stack from www.haskellstack.org/ The download is pretty fast since the file is small.</p>\n\n<p>Upon installing stack and updating the stack to its path, I download ghc. The download is extremely slow. After downloading a mere 2.40 or 1.32 MB's it becomes still and after 30 minutes or so, it shows a socket connection error. I copied the error and searched for it in Stack Overflow, but it seemed futile.</p>\n\n<p>As a solution to this, I uninstalled the sole version of stack and installed the Haskell platform which came bundled with ghc and other features along with Cabal and Stack. However upon starting a project using stack, it does not detect the ghc compiler and automatically tries to download the ghc version 8.4.3. Please note that I have added ghc to the path because whenever I type ghc in command line, it gives me the Haskell terminal, and also I have checked the environment variables.</p>\n\n<p>No matter what I do I cannot let stack detect the ghc already coming from Haskell platform and prevent it from automatically downloading its own version of ghc, prior to which it gets stuck at 0.66% forever.</p>\n\n<p>I am from India. Is the server providing the ghc through stack have no support in my country? Or is there any way out! I seemingly cannot install any Haskell packages, for my Haskell project!</p>\n\n<p><a href=\"https://i.stack.imgur.com/vbmxZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vbmxZ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "types", "ghc"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 4, "creation_date": 1535181250, "post_id": 52014387, "comment_id": 90980112, "body": "What makes you think you can avoid making three type queries?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1535222106, "post_id": 52014387, "comment_id": 90990663, "body": "@BasileStarynkevitch I think it&#39;s a reasonable question at least (even though I predict a negative answer), since the compiler already needs to know all these types during typechecking."}, {"owner": {"reputation": 21, "user_id": 4243326, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kzqQY.jpg?s=128&g=1", "display_name": "Nithin", "link": "https://stackoverflow.com/users/4243326/nithin"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535225820, "post_id": 52014387, "comment_id": 90991652, "body": "@BasileStarynkevitch For 2 reasons:  One:  The typechecking has already been performed and &#39;some&#39; parts of the program tree annotated with the types.   Two: Since I am looking for all possible subexpressions,  there is going to be considerable overlap.  For eg.  since fac is of type Int -&gt; Int,  n is of type Int and fac (n-1) is of type Int etc.  I think this overlap can be minimized/eliminated by using some form of Inference?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535264001, "post_id": 52014387, "comment_id": 90997572, "body": "Please don&#39;t comment your own question, but edit it."}], "owner": {"reputation": 21, "user_id": 4243326, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kzqQY.jpg?s=128&g=1", "display_name": "Nithin", "link": "https://stackoverflow.com/users/4243326/nithin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1535393966, "creation_date": 1535175846, "last_edit_date": 1535393966, "question_id": 52014387, "link": "https://stackoverflow.com/questions/52014387/how-to-determine-the-types-of-all-subexpressions-in-a-haskell-program", "title": "How to determine the types of all subexpressions in a Haskell program?", "body": "<p>I am working on a Haskell project that requires me to convert a Haskell program to its GHC Core form and annotate each sub-expression with its type.  For example, given the factorial function:</p>\n\n<pre><code>fac 0 = 1\nfac n = n * fac (n - 1)\n</code></pre>\n\n<p>In this example, I would like to get the types  of (n==0), 1, ( n * fac (n-1) ),  n,  fac(n-1)  and (n-1).  i.e types for all subexpressions in the program.  How do I proceed with this?</p>\n\n<p>One possibility is to use exprType from CoreUtils.  But then, I will have to query the types of  ( n * fac (n-1) ),  n and fac (n-1)  separately in 3 calls?  Is there a better way to do this?</p>\n\n<p>I think the number of queries can be reduced for 2 reasons: One: The type checking has already been performed and 'some' parts of the program tree annotated with the types. Two: Since I am looking for all possible subexpressions, there is going to be considerable overlap. For eg., since fac is of type Int -> Int, n is of type Int and fac (n-1) is of type Int etc. I think this overlap can be minimized/eliminated by using some form of Inference? </p>\n\n<p>TLDR:  Is there an efficient way to annotate each subexpression in Haskell Core with the corresponding type?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1535153206, "creation_date": 1535153206, "answer_id": 52012804, "question_id": 52012763, "link": "https://stackoverflow.com/questions/52012763/how-to-run-ghci-in-command-line-like-a-regular-shell-command/52012804#52012804", "title": "How to run GHCi in command line like a regular shell command", "body": "<p>The easiest way is to pipe in the commands via standard input. In Bash this can be done nicely with a \u201chere-string\u201d:</p>\n\n<pre><code>$ ghci &lt;&lt;&lt; ':t reverse'\nGHCi, version 8.2.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/sagemuej/.ghci\nLoaded GHCi configuration from /home/sagemuej/.ghc/ghci.conf\nPrelude&gt; reverse :: [a] -&gt; [a]\nPrelude&gt; Leaving GHCi.\n</code></pre>\n\n<p>Use verbosity 0 to avoid all the greeting stuff:</p>\n\n<pre><code>$ ghci -v0 &lt;&lt;&lt; ':t reverse'\nreverse :: [a] -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "accepted_answer_id": 52012804, "answer_count": 1, "score": 1, "last_activity_date": 1535153206, "creation_date": 1535152754, "last_edit_date": 1535152956, "question_id": 52012763, "link": "https://stackoverflow.com/questions/52012763/how-to-run-ghci-in-command-line-like-a-regular-shell-command", "title": "How to run GHCi in command line like a regular shell command", "body": "<p>Is there any way I can run GHCi on command line like a regular command in shell?</p>\n\n<p>For example: :browse in GHCi - list all the function for specific module.</p>\n\n<p>but I want to run it on shell, e.g.:  <code>ghci --browse \"MyModule\"</code>\nwhich lists all the functions for the module</p>\n\n<p>I know hoogle can run it on shell, e.g: hoogle Monad </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535128185, "post_id": 52008379, "comment_id": 90967395, "body": "The code you posted alone doesn&#39;t produce this error. More specifically, if <code>type DivType Int Int = Integer</code> is really on line 67, what&#39;s the context for <code>DivType a a = a</code> on line 71? My guess is that you have a more generic instance of <code>Dnum</code> that <code>Int</code>/<code>Int</code> also matches, and the compiler can&#39;t figure out which one to use."}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535128433, "post_id": 52008379, "comment_id": 90967522, "body": "Sorry, I just add my main"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535129669, "post_id": 52008379, "comment_id": 90968120, "body": "That&#39;s still not enough to reproduce your problem; what you have here runs fine and outputs 1."}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535130811, "post_id": 52008379, "comment_id": 90968637, "body": "Sorry, I miss the instance for the code, now it should product the error"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535131022, "post_id": 52008379, "comment_id": 90968735, "body": "I forget the technical reasons for this, but the compiler simply can&#39;t (or doesn&#39;t) try to figure out that <code>Dnum Int Int</code> is more specific than <code>Num a =&gt; Dnum a a</code> and should be preferred."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535131387, "post_id": 52008379, "comment_id": 90968905, "body": "I hesitate to provide an answer, because the best I can do is suggest removing the generic instance to avoid the conflict. (By the way, <code>Dnum Int Integer</code> doesn&#39;t cause a problem because <code>Int</code> and <code>Integer</code>, being two separate types, doesn&#39;t also match <code>Dnum a a</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "is_accepted": true, "score": 3, "last_activity_date": 1535135800, "creation_date": 1535135800, "answer_id": 52010041, "question_id": 52008379, "link": "https://stackoverflow.com/questions/52008379/haskell-conflicting-family-instance-declarations/52010041#52010041", "title": "Haskell Conflicting family instance declarations", "body": "<p>The issue is that instances the type family instances on lines 67 and 71 overlap, since on line 67 you assert that <code>DivType Int Int = Integer</code>, but on line 71 you say that for any <code>Num a</code>, <code>DivType a a = a</code>, which means in particular that <code>DivType Int Int = Int</code>, so it's unclear how to resolve <code>DivType Int Int</code>. </p>\n\n<p>In contrast, <code>DivType Int Integer</code> does not overlap with anything, since <code>DivType a a</code> requires the two types to match.</p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 52010041, "answer_count": 1, "score": 0, "last_activity_date": 1535135800, "creation_date": 1535127763, "last_edit_date": 1535130760, "question_id": 52008379, "link": "https://stackoverflow.com/questions/52008379/haskell-conflicting-family-instance-declarations", "title": "Haskell Conflicting family instance declarations", "body": "<p>I try to define a division function for two Int types</p>\n\n<pre><code>class Dnum a b where\n    type DivType a b\n    _div::a-&gt;b-&gt; DivType a b\n\ninstance Dnum Int Integer where\n    type DivType Int Integer = Integer\n    _div a b = div (fromIntegral a)  b \n\ninstance Dnum Int Int where\n    type DivType Int Int = Integer\n    _div x y = div (fromIntegral x) (fromIntegral y)\n\ninstance (Num a) =&gt; Dnum a a where\n    type DivType a a = a \n    _div x y = div x y \n</code></pre>\n\n<p>Here is my main:</p>\n\n<pre><code>main = do \n        let n = 3::Int\n        print $ _div n n  \n</code></pre>\n\n<p>Got Error:</p>\n\n<pre><code>Conflicting family instance declarations:\n      DivType Int Int = Integer -- Defined at MyLib.hs:67:10\n      DivType a a = a -- Defined at MyLib.hs:71:10\n   |\n67 |     type DivType Int Int = Integer\n</code></pre>\n\n<p>It seems to me the function\n<code>_div Int Int</code> has some issue, I'm not sure why it said \"conflicting family instance\",\nbut <code>_div Int Integer</code> has no issue at all.</p>\n\n<p>Anyone know how to resolve it?</p>\n"}, {"tags": ["haskell", "z3", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535125579, "post_id": 52007796, "comment_id": 90966005, "body": "Does the <code>z3</code> module also installs <i>header</i> files, etc.?"}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535125621, "post_id": 52007796, "comment_id": 90966034, "body": "@WillemVanOnsem - not sure, should I try compiling from source instead?"}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535125662, "post_id": 52007796, "comment_id": 90966060, "body": "@WillemVanOnsem Trying <a href=\"https://stackoverflow.com/questions/14130739/building-z3-on-mac-os-x\">this</a> now."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535126369, "post_id": 52007796, "comment_id": 90966458, "body": "In Debian/Ubuntu, the header-containing packages are generally called <code>lib\ud835\udc39\ud835\udc42\ud835\udc42-dev</code>, i.e. in this case <code>libz3-dev</code>. Don&#39;t know about homebrew, but might be similar."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535127422, "post_id": 52007796, "comment_id": 90966998, "body": "@leftaroundabout didn&#39;t find <code>libz3-dev</code> or <code>z3-dev</code> to work unfortunately."}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535127433, "post_id": 52007796, "comment_id": 90967001, "body": "@WillemVanOnsem tried installing from source and that didn&#39;t help either."}], "answers": [{"comments": [{"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "edited": false, "score": 0, "creation_date": 1535128764, "post_id": 52008412, "comment_id": 90967666, "body": "Thanks, the following <code>stack.yaml</code> config worked:  extra-include-dirs:   - /usr/local/include extra-lib-dirs:   - /usr/local/lib extra-deps: - z3-4.3.1"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1535127898, "creation_date": 1535127898, "answer_id": 52008412, "question_id": 52007796, "link": "https://stackoverflow.com/questions/52007796/cannot-install-z3-package-for-haskell-on-os-x/52008412#52008412", "title": "Cannot install z3 package for Haskell on OS X", "body": "<p>You are probably need to pass <code>--extra-lib-dirs=/usr/local/lib --extra-include-dirs=/usr/local/include</code>.</p>\n"}], "owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 52008412, "answer_count": 1, "score": 1, "last_activity_date": 1535127898, "creation_date": 1535125400, "question_id": 52007796, "link": "https://stackoverflow.com/questions/52007796/cannot-install-z3-package-for-haskell-on-os-x", "title": "Cannot install z3 package for Haskell on OS X", "body": "<p>I'm trying to install the <a href=\"http://hackage.haskell.org/package/z3\" rel=\"nofollow noreferrer\">z3</a> package as follows:</p>\n\n<pre><code>stack install z3 --extra-lib-dirs=/usr/local/bin --extra-include-dirs=/usr/local/bin\n</code></pre>\n\n<p>Which brings up the following errors:</p>\n\n<pre><code>Configuring z3-4.3.1...\nCabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3: Missing dependency on a foreign\nlibrary:\n* Missing (or bad) header file: z3.h\n* Missing (or bad) C library: z3\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.If the\nlibrary file does exist, it may contain errors that are caught by the C\ncompiler at the preprocessing stage. In this case you can re-run configure\nwith the verbosity flag -v3 to see the error messages.\nIf the header file does exist, it may contain errors that are caught by the C\ncompiler at the preprocessing stage. In this case you can re-run configure\nwith the verbosity flag -v3 to see the error messages.\n</code></pre>\n\n<p>I originally installed z3 as so:</p>\n\n<pre><code>brew install z3\n</code></pre>\n\n<p>and verified the installation location by running</p>\n\n<pre><code>which z3 #=&gt; /usr/local/bin/z3\n</code></pre>\n\n<p>Let me know what I could try!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "monoids"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1535121551, "post_id": 52006666, "comment_id": 90963570, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/10365\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/10365</a>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1535193622, "post_id": 52006666, "comment_id": 90982974, "body": "<code>Env</code> just looks like Data.Monoid.Sum."}, {"owner": {"reputation": 704, "user_id": 962242, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9d9a6af953fc82d6eda347af3296f4a3?s=128&d=identicon&r=PG", "display_name": "DBS", "link": "https://stackoverflow.com/users/962242/dbs"}, "edited": false, "score": 0, "creation_date": 1535254254, "post_id": 52006666, "comment_id": 90996195, "body": "Yes it is. But I wanted to write a custom monoid."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1535122354, "post_id": 52006945, "comment_id": 90964076, "body": "Yes, but better is to define <code>Env x  &lt;&gt; Env y = Env (x + y)</code> and never talk about <code>mappend</code> (<a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Monoid.html#v:mappend\" rel=\"nofollow noreferrer\">\u201cThis method is redundant and has the default implementation <code>mappend = &#39;(&lt;&gt;)&#39;</code> since base-4.11.0.0\u201d</a>)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1535122092, "creation_date": 1535122092, "answer_id": 52006945, "question_id": 52006666, "link": "https://stackoverflow.com/questions/52006666/custom-monoid-with-writert/52006945#52006945", "title": "Custom monoid with WriterT", "body": "<p>In recent GHCs, <code>Semigroup</code> is a superclass of <code>Monoid</code>, so to create an instance of <code>Monoid</code> correctly, you must also create an instance of <code>Semigroup</code>. Luckily it's generally quite short:</p>\n\n<pre><code>instance Num a =&gt; Semigroup (Env a) where (&lt;&gt;) = mappend\n</code></pre>\n"}], "owner": {"reputation": 704, "user_id": 962242, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9d9a6af953fc82d6eda347af3296f4a3?s=128&d=identicon&r=PG", "display_name": "DBS", "link": "https://stackoverflow.com/users/962242/dbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 52006945, "answer_count": 1, "score": 1, "last_activity_date": 1535122092, "creation_date": 1535121070, "question_id": 52006666, "link": "https://stackoverflow.com/questions/52006666/custom-monoid-with-writert", "title": "Custom monoid with WriterT", "body": "<p>I am trying to implement WriterT with custom data type. I have implemented the monoid as the required by runWriterT. But I am unable to compile the code. I get an error  </p>\n\n<p><em>Could not deduce (Semigroup (Env a))\n        arising from the superclasses of an instance declaration\n      from the context: Num a</em></p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Reader\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Writer\nimport Control.Monad.Trans\nimport Data.Monoid\n\nnewtype Env a = Env { getEnv :: a  }  deriving (Eq, Ord, Read, Show)\n\n\ninstance Num a =&gt; Monoid (Env a) where\n  mempty = Env 0\n  Env x  `mappend` Env y = Env (x + y)\n\n\nwriteSomething :: (Num a) =&gt; WriterT (Env a) IO ()\nwriteSomething = do\n  tell $ Env 1\n  tell $ Env 3\n</code></pre>\n"}, {"tags": ["haskell", "dll", "memory-leaks", "ghc", "ffi"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535120408, "post_id": 52005399, "comment_id": 90962795, "body": "Interesting, but I wonder: why do you need to load a dynamic library over and over again?"}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1535138476, "post_id": 52005399, "comment_id": 90971949, "body": "Isn&#39;t it necessary to do a call to <code>hs_init</code> to initialise the runtime system?"}, {"owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "reply_to_user": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1535193822, "post_id": 52005399, "comment_id": 90983036, "body": "@mschmidt Yeah, it is necessary if you are going to use the library. But I tried to make the most minimal example: it means that whether you call <code>hs_init</code> or not, the consuming memory behavior is the same."}, {"owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535193893, "post_id": 52005399, "comment_id": 90983055, "body": "@leftaroundabout In the project I work on it is needed due to some architectural reasons."}], "answers": [{"tags": [], "owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "is_accepted": true, "score": 1, "last_activity_date": 1535457990, "creation_date": 1535457990, "answer_id": 52057493, "question_id": 52005399, "link": "https://stackoverflow.com/questions/52005399/haskell-dll-causes-memory-leak/52057493#52057493", "title": "Haskell DLL causes memory leak", "body": "<p>I decided to send an e-mail to ghc-devs mailing list. (To read all correspondence, see <a href=\"https://mail.haskell.org/pipermail/ghc-devs/2018-August/016170.html\" rel=\"nofollow noreferrer\">the question</a> and further messages, the answer can be found <a href=\"https://mail.haskell.org/pipermail/ghc-devs/2018-August/016173.html\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>The brief explanation. The memory leak is caused due to the following: for each foreign export RTS creates a static C wrapper, which is initialized on <code>DLL_PROCESS_ATTACH</code>, but it has no finalizer/destructor to be called during <code>DLL_PROCESS_DETACH</code>. So it will stay alive till the program termination.</p>\n"}], "owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 2, "accepted_answer_id": 52057493, "answer_count": 1, "score": 4, "last_activity_date": 1535457990, "creation_date": 1535116787, "last_edit_date": 1535132810, "question_id": 52005399, "link": "https://stackoverflow.com/questions/52005399/haskell-dll-causes-memory-leak", "title": "Haskell DLL causes memory leak", "body": "<p>I am working on a C++ project that uses a Haskell DLL (GHC version is 8.0.1 x64). I've noticed, that the executing program consumes much memory. I investigated into the matter and that's what I've found out. Let's consider the following minimal example. Here is a little project that consists of three files.</p>\n\n<p><strong>HaskellExports.hs</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule HaskellExports where\n\nimport Foreign.C.Types\nimport Foreign.StablePtr\n\nforeign export ccall foo :: CInt -&gt; IO (StablePtr Int)\n\nfoo :: CInt -&gt; IO (StablePtr Int)\nfoo (CInt n) = newStablePtr (fromIntegral n)\n</code></pre>\n\n<p>Contains a function that is supposed to be called from a C/C++ code.</p>\n\n<p><strong>CWrapper.cpp</strong></p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#define DLLExport extern \"C\" __declspec(dllexport) \n\nDLLExport void* c_smth (const int num)\n{\n    return 0;\n}\n</code></pre>\n\n<p>I intentionally didn't include the real exports of the Haskell functions, because they make no difference to this example.</p>\n\n<p><strong>main.cpp</strong></p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;Windows.h&gt;\n\nint main()\n{\n    for (;;)\n    {\n        HINSTANCE module = ::LoadLibrary(L\"HaskellExports.dll\");\n        ::FreeLibrary(module);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Here, in an endless loop, I load the library and free it at once. Let's try to build the DLL in two different ways. First, let's not include the Haskell object file:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ghc -c HaskellExports.hs\nghc -c CWrapper.cpp \nghc -shared -no-hs-main -o HaskellExports.dll CWrapper.o\n</code></pre>\n\n<p>I've run the program and noticed (with the help of Windows process monitor), that the memory resources are captured and released properly.</p>\n\n<p>Now let's also add the Haskell object file:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ghc -c HaskellExports.hs\nghc -c CWrapper.cpp \nghc -shared -no-hs-main -o HaskellExports.dll CWrapper.o HaskellExports.o\n</code></pre>\n\n<p>I've run the program again and noticed, that it consumes more and more memory in length of time with no intention to release it. This situation leads to a crash.</p>\n\n<p>What am I doing wrong?</p>\n\n<p><strong>P.S.</strong> Further investigation showed that memory leak is caused only when <code>HaskellExport.hs</code> contains at least one <code>foreign export</code> function.</p>\n"}, {"tags": ["haskell", "types", "happstack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1535112174, "post_id": 52004028, "comment_id": 90957353, "body": "Well <code>CtrlV&#39;</code> is <i>not a constructor. In fact it is a type synonym, so you are *not</i> wrapping any values. You have to use the same way as if you extract it out of a <code>RouteT Sitemap (ServerPartT IO)  Response</code>."}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1535131710, "post_id": 52004028, "comment_id": 90969057, "body": "If my reply is helpful to you, please accept it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1535160187, "post_id": 52004028, "comment_id": 90977396, "body": "I keep saying that new users shouldn&#39;t use type synonyms. Does anyone listen? No, because new users never hear me say that. I&#39;m preaching to the choir and screaming into the void. I wish there were some more efficient way to communicate."}], "answers": [{"comments": [{"owner": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "edited": false, "score": 0, "creation_date": 1535278161, "post_id": 52006915, "comment_id": 91000631, "body": "Thanks for you answer. Is there a generic way to get values out of types? <code>RouteT</code> has the function <code>unRouteT :: (url -&gt; [(Text, Maybe Text)] -&gt; Text) -&gt; m a</code> which seems to do what I want, but I don&#39;t understand how it works"}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "reply_to_user": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "edited": false, "score": 0, "creation_date": 1535305504, "post_id": 52006915, "comment_id": 91007896, "body": "When you make a type synonym (which is what the type keyword does), you\u2019re not creating a different type, you\u2019re just creating a different way to refer to that type. So at the value level of the program, referring to the type using the actual name or a synonym makes no difference."}], "tags": [], "owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "is_accepted": true, "score": 2, "last_activity_date": 1535121968, "creation_date": 1535121968, "answer_id": 52006915, "question_id": 52004028, "link": "https://stackoverflow.com/questions/52004028/how-to-get-value-out-of-nested-synonym-type/52006915#52006915", "title": "How to get value out of nested synonym type", "body": "<p>To step back from the specifics of the libraries your using, here is how <code>type</code> works:</p>\n\n<p>I can declare a type synonym</p>\n\n<pre><code>type ListOfInts = [Int]\n</code></pre>\n\n<p>I know I can use ListOfInts anywhere I would use [Int]:</p>\n\n<pre><code>f :: ListOfInts -&gt; Int\nf xs = sum xs\n\ng :: [Int] -&gt; Int\ng xs = product xs\n\nlist1 :: [Int]\nlist1 = [1,2,3]\n\nlist2 :: ListOfInts\nlist2 = [4,5,6]\n\nf list1\n&gt; 6\nf list2\n&gt; 15\n\ng list1\n&gt; 6\ng list2\n&gt; 120\n</code></pre>\n\n<p>And now I can use <code>f</code> and <code>g</code> on both list1 and list2, despite the fact that they are declared with \"different\" types. Type just declares a synonym for a type, not a new type (which would use the <code>newtype</code> keyword). </p>\n\n<p>In summary, You can use <code>CtrlV</code> the same way you would use <code>Ctrlv' Response</code>, which you can use the same way you would use <code>RouteT SiteMap App Response</code>, which you can use the same way you would use <code>RouteT SiteMap (ServerPartT IO) Response</code>, because <code>Ctrlv</code> <em>is</em> <code>RouteT SiteMap (ServerPartT IO) Response</code>.</p>\n"}], "owner": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 52006915, "answer_count": 1, "score": 0, "last_activity_date": 1535121968, "creation_date": 1535111990, "question_id": 52004028, "link": "https://stackoverflow.com/questions/52004028/how-to-get-value-out-of-nested-synonym-type", "title": "How to get value out of nested synonym type", "body": "<p>I have defined my own type called <code>CtrlV</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Data.Data (Data, Typeable)\nimport Happstack.Server (Response, ServerPartT)\nimport Web.Routes (RouteT)\nimport Web.Routes.TH (derivePathInfo)\n\ntype App = ServerPartT IO\ntype CtrlV'   = RouteT Sitemap App\ntype CtrlV    = CtrlV' Response\n\ndata Sitemap   = Home | User\n    deriving (Eq, Ord, Read, Show, Typeable, Data)\n$(derivePathInfo ''Sitemap)\n</code></pre>\n\n<p>I have this function for example:</p>\n\n<pre><code>import Happstack.Foundation\nimport Happstack.Server (ok, toResponse)\nimport Web.Routes (showURL)\ncreateResponse :: CtrlV\ncreateResponse = do\n     url &lt;- showURL Home\n     ok $ toResponse (show url)\n</code></pre>\n\n<p>I want to write a test for this function and i want to check <code>Response</code> has the correct result. But i can get <code>Response</code> out of my type <code>CtrlV</code>.\nIs there an easy way to achieve this?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1535064872, "post_id": 51993746, "comment_id": 90940129, "body": "Can you show an example where this gives more info than <code>:i</code>? e.g. if I just start <code>ghci -XTemplateHaskell</code>, import <code>Language.Haskell.TH</code>, and run this, I get 6 instances from <code>putStrLn $(...)</code> and 7 from <code>:i</code> (the TH one is missing the <code>Either a</code> instance for some reason)."}], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 4, "last_activity_date": 1535065978, "last_edit_date": 1592644375, "creation_date": 1535065978, "answer_id": 51995441, "question_id": 51993746, "link": "https://stackoverflow.com/questions/51993746/discovering-more-typeclass-instances/51995441#51995441", "title": "Discovering more typeclass instances", "body": "<blockquote>\n<p>it seems that that we can discover more instances than usual <code>:info</code> can provide</p>\n</blockquote>\n<p><code>:info</code> is selective by design. From the <a href=\"https://downloads.haskell.org/%7Eghc/7.8.1/docs/html/users_guide/ghci-commands.html#idp7438240\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n<blockquote>\n<p>To avoid showing irrelevant information, an instance is shown only if (a) its head mentions <em>name</em>, and (b) all the other things mentioned in the instance are in scope (either qualified or otherwise) as a result of a <code>:load</code> or <code>:module</code> commands.</p>\n<p>The command <code>:info!</code> works in a similar fashion but it removes restriction (b), showing all instances that are in scope and mention <em>name</em> in their head.</p>\n</blockquote>\n<p>So, by default it only shows instances for types that are already in scope, but it can also show other instances if you'd like (by using <code>:info!</code> instead of <code>:info</code>).</p>\n<hr>\n<blockquote>\n<p>Does TH intentionally have &quot;relaxed&quot; access to the environment? What is the proper usage of reifyInstances and how it's different from the other form?</p>\n</blockquote>\n<p>As far as I know, TH has access to everything in the code that the compiler has access to, otherwise it wouldn't be as effective at extending the language.</p>\n<p>The proper usage of <code>reifyInstances</code> is, indeed, in extending the language. The &quot;other form&quot; (by which I assume you mean <code>:info</code>) is meant for easy interactive use in GHCi. The TH package, on the other hand, is for writing metaprogramming libraries. Say, for example, you're writing a library to generate instances for arbitrary types automatically. Maybe you want your library to generate generic code in the general case, but if the data type implements certain typeclasses already, you can instead automatically generate special &quot;performance&quot; code. <code>reifyInstances</code> might be useful here.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 51995441, "answer_count": 1, "score": 0, "last_activity_date": 1535065978, "creation_date": 1535055857, "question_id": 51993746, "link": "https://stackoverflow.com/questions/51993746/discovering-more-typeclass-instances", "title": "Discovering more typeclass instances", "body": "<p>When I was new to Haskell I had very hard time finding instances for various types. </p>\n\n<p>Motivated by this, much later I noticed <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/src/Language.Haskell.TH.Syntax.html#reifyInstances\" rel=\"nofollow noreferrer\">reifyInstances</a>. While I know little about Template Haskell, it seems that that we can discover more instances than usual <code>:info</code> can provide using this trick:</p>\n\n<pre><code>putStrLn $(stringE . pprint =&lt;&lt; reify ''Functor)\n</code></pre>\n\n<p>Does TH intentionally have \"relaxed\" access to the environment? What is the proper usage of <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/src/Language.Haskell.TH.Syntax.html#reifyInstances\" rel=\"nofollow noreferrer\">reifyInstances</a> and how it's different from the other form?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535039931, "post_id": 51989707, "comment_id": 90929301, "body": "I&#39;m realizing that I could do this within a module, with &quot;import qualified Prelude&quot; at the start, and then &quot;instance Foo Prelude.Integer where  (+) x y = x  Prelude.+  y&quot; or something... right? and then if I import my newly created module, does it all work? how does Haskell understand &quot;2+3&quot; ?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 6, "creation_date": 1535040455, "post_id": 51989707, "comment_id": 90929630, "body": "Right, I think you&#39;re barking up the wrong tree. As you mentioned -- you could &#236;mport qualified Prelude` and write every addition symbol as <code>Prelude.+</code>, but that seems...wildly unnecessary. Why does <code>Foo</code> have to use the <code>+</code> operator? If you simply change it to something unique, all this craziness goes away :)"}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1535041402, "post_id": 51989707, "comment_id": 90930180, "body": "@Adam: to take a very mathematical example (but i am, after all, a working mathematician...), you could imagine that Foo is really called AbelianGroup, so that the elements of a type of this class can be added, but NOT multiplied, so they don&#39;t belong to Num. Yet it is very natural to use + and not some other symbol... while elements of type &quot;Integer&quot; are certainly examples, among others."}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1535041501, "post_id": 51989707, "comment_id": 90930249, "body": "PS you could rephrase my question as: how do you define a weaker version of Num, or of any typeclass, where some functions are not defined?"}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1535042481, "post_id": 51989707, "comment_id": 90930784, "body": "What would you need a &quot;weaker&quot; version for? (fyi, Idris&#39; (and I think purescript&#39;s) version of Num is weaker than Haskell&#39;s, only requiring (*), (+), and fromInteger)"}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "reply_to_user": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1535042884, "post_id": 51989707, "comment_id": 90930966, "body": "@Samuel: having a version of Num that does not require the type to belong to Eq and Show would be very useful, I can think of many examples (eg all functions Integer -&gt; Integer...) And having a model for abelian groups, just having +, is a natural thing for a mathematician."}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 3, "creation_date": 1535043647, "post_id": 51989707, "comment_id": 90931388, "body": "There is <a href=\"http://hackage.haskell.org/package/groups-0.4.1.0/docs/Data-Group.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/groups-0.4.1.0/docs/Data-Group.h&zwnj;&#8203;tml</a>, which builds groups and abelian groups on top of monoid, using the &lt;&gt; operator. Also- Num has no superclasses (it doesn&#39;t require Show or Eq)"}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 1, "creation_date": 1535051232, "post_id": 51989707, "comment_id": 90935020, "body": "From figure 6 in <a href=\"https://www.haskell.org/onlinereport/basic.html#numbers\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/basic.html#numbers</a> I had deduced that Num required Eq and Show...?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535051238, "post_id": 51989707, "comment_id": 90935025, "body": "It sounds like you are looking for a &quot;higher-order&quot; typeclass that would define <code>(+)</code>,   an instance of which would be a &quot;regular&quot; typeclass that provides a particular set of laws for <code>(+)</code> to obey in <i>its</i> instances . To the best of my knowledge, there is no such thing :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535051466, "post_id": 51989707, "comment_id": 90935120, "body": "Interesting; the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Num.html#Num\" rel=\"nofollow noreferrer\">definition of <code>Num</code> in GHC</a> doesn&#39;t make it a subclass of <code>Eq</code> or <code>Show</code>."}], "answers": [{"comments": [{"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535041873, "post_id": 51990258, "comment_id": 90930467, "body": "&quot;parsed the same way as (+)&quot;, in what sense is it the same way? (do you just mean &quot;with the same associativity properties&quot; ?) Anyway, I really need (want...) to use +..."}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "reply_to_user": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 1, "creation_date": 1535042152, "post_id": 51990258, "comment_id": 90930618, "body": "&quot;infixl 6&quot; means that (&lt;+&gt;) is left associative with a precedence of 6 (in haskell, operators can have a precedence from 0-9, with 0 being lowest and 9 being highest). Left associative means that if you have an expression   1 &lt;+&gt; 2 &lt;+&gt; 3 &lt;+&gt; 4  it will be parsed as (((1 &lt;+&gt; 2) &lt;+&gt; 3) &lt;+&gt; 4); the operations will be performed from left to right. This is the same way (+) behaves."}], "tags": [], "owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "is_accepted": false, "score": 9, "last_activity_date": 1535041273, "creation_date": 1535041273, "answer_id": 51990258, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/51990258#51990258", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>To give a specific solution, something like this would work without having to deal with clashing with (+):</p>\n\n<pre><code>class Foo a where\n  (&lt;+&gt;) :: a -&gt; a -&gt; a\n\ninfixl 6 &lt;+&gt;\n\ninstance Foo Integer where\n  (&lt;+&gt;) = (+)\n</code></pre>\n\n<p>Now your class Foo has its own operator, and the fixity declaration means that (&lt;+>) will be parsed the same way as (+).</p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 3, "last_activity_date": 1535043817, "creation_date": 1535043817, "answer_id": 51990922, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/51990922#51990922", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>I don't think you'd do this the same way in Haskell as in a pure math setting. You're trying to implement an Abelian group (it seems from your comments), which I understand (as someone who hasn't taken a mathematics course since High School) to be a group of type <code>a</code> where there exists a function <code>f :: a -&gt; a -&gt; a</code> such that <code>f x y = f y x</code>.</p>\n\n<p>Contrast that with Haskells built-in (and oft-used) Monoid class and you'll see why I say Haskellers may approach this differently. Monoids are a group of type <code>a</code> where there exists a function <code>f :: a -&gt; a -&gt; a</code> such that <code>f x (f y z) = f (f x y) z</code> (and additionally, but unrelated, a value <code>k</code> such that <code>f x k = x</code>). It's representing associativity rather than commutativity, but is otherwise identical.</p>\n\n<p>Monoids are represented as such:</p>\n\n<pre><code>class Monoid a where\n  mempty :: a\n  mappend :: a -&gt; a -&gt; a\n  mconcat :: [a] -&gt; a\n</code></pre>\n\n<p>and several are defined, like <code>Sum</code></p>\n\n<pre><code>newtype Sum a = Sum { getSum :: a }\ninstance Num a =&gt; Monoid (Sum a) where\n  mempty = 0\n  mappend (Sum x) (Sum y) = Sum (x+y)\n  -- mconcat is defined as `foldr mappend mempty`\n</code></pre>\n\n<p>Note that it doesn't try to redefine <code>(+)</code> here. In fact it defines its own operator as a synonym for <code>mappend</code>: <code>(&lt;&gt;)</code>. I recommend using a similar syntax with your Abelian group.</p>\n\n<pre><code>class Abelian a where\n  (|&lt;&gt;|) :: a -&gt; a -&gt; a  -- or similar\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1535044491, "creation_date": 1535044491, "answer_id": 51991084, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/51991084#51991084", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>As others have answered, the easiest option is to pick a new name for the operator.  This is the approach that most existing packages take, so that users of the library can continue using <code>Num</code> as usual.</p>\n\n<p>As the OP notes in the comments, it is also possible to import <code>Prelude</code> qualified, and define <code>+</code> however you want.  Any other modules that want to use your new <code>+</code> will need to do the same.  They can either not import Prelude (via <code>import Prelude ()</code> or <code>NoImplicitPrelude</code>), or import it qualified.  This is pretty reasonable in a large codebase, where everyone knows the local convention and you can provide instances for all the types you use.</p>\n"}, {"comments": [{"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 1, "creation_date": 1535095823, "post_id": 51993197, "comment_id": 90948015, "body": "absolutely! NumericPrelude seems great. But I was wondering if you could achieve some of its functionality in an elementary way (re-writing the Prelude is far beyond what I can personally do, and at the same time, I&#39;d like to understand what I use, in this case)."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1535053251, "creation_date": 1535053251, "answer_id": 51993197, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/51993197#51993197", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>In Haskell, you can use your own <code>Prelude</code> instead of the standard one, and there are multiple existing <a href=\"https://guide.aelve.com/haskell/alternative-preludes-zr69k1hc\" rel=\"nofollow noreferrer\">alternative preludes</a>. E.g. <a href=\"http://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow noreferrer\">numeric-prelude</a> defines <a href=\"http://hackage.haskell.org/package/numeric-prelude-0.4.3/docs/Algebra-Additive.html\" rel=\"nofollow noreferrer\"><code>(+)</code> in <code>Algebra.Additive.C</code></a>. </p>\n"}, {"comments": [{"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535095918, "post_id": 51994636, "comment_id": 90948052, "body": "As you can see from the comments, this is what I had eventually in mind. Because this is definitely the right answer to my specific question, I&#39;ll accept it."}], "tags": [], "owner": {"reputation": 2565, "user_id": 1108505, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a7e091fdb18efecace362189bc5f0bf5?s=128&d=identicon&r=PG", "display_name": "Tanner Swett", "link": "https://stackoverflow.com/users/1108505/tanner-swett"}, "is_accepted": true, "score": 6, "last_activity_date": 1535060325, "creation_date": 1535060325, "answer_id": 51994636, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/51994636#51994636", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>If you really want to call your operation <code>+</code>, and you want to define it in terms of the <code>+</code> from Prelude, you can do it like this:</p>\n\n<pre><code>import Prelude (Integer, print)\nimport qualified Prelude ((+))\n\nclass Foo a where\n  (+) :: a -&gt; a -&gt; a\n\ninstance Foo Integer where\n  (+) x y = x Prelude.+ y\n\nmain = print (2 + 3 :: Integer)\n</code></pre>\n\n<p>This will output 5.</p>\n\n<p>To prove that the definition of <code>main</code> is really using our new <code>+</code> operator and not the original one, we can change our definition of <code>+</code>:</p>\n\n<pre><code>import Prelude (Integer, print)\nimport qualified Prelude ((+))\n\nclass Foo a where\n  (+) :: a -&gt; a -&gt; a\n\ninstance Foo Integer where\n  (+) x y = x Prelude.+ y Prelude.+ 1\n\nmain = print (2 + 3 :: Integer)\n</code></pre>\n\n<p>This will output 6.</p>\n"}, {"comments": [{"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535446630, "post_id": 52000618, "comment_id": 91057895, "body": "Thanks, very interesting. By the way, ultimately my solution will be to use -XRebindableSyntax. Not only does this NOT load the prelude, so I&#39;ll get rid of Num entirely; but also, one can now redefine fromInteger (to be of type Integer -&gt; Integer and equal to Prelude.id), so that literals are interpreted as &quot;Integer&quot; and not Num a =&gt; a. So Num is entirely gone from my life, and there are now plenty of available solutions."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535469420, "post_id": 52000618, "comment_id": 91072717, "body": "@Pierre Would the source code be available? I am keen on taking a look."}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "edited": false, "score": 0, "creation_date": 1535582003, "post_id": 52000618, "comment_id": 91124151, "body": "just use <code>{-# LANGUAGE RebindableSyntax #-}</code>followed by <code>import qualified Prelude</code> and then <code>fromInteger :: Integer -&gt; Integer</code> with finally <code>fromInteger = Prelude.id</code>. Then as in the accepted answer, for example (or whatever else you want to do without Num!). I found the trick as an answer to a question on this site :-)"}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 2, "last_activity_date": 1535105844, "last_edit_date": 1535105844, "creation_date": 1535100154, "answer_id": 52000618, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass/52000618#52000618", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p><strong>a programmer's approach</strong> &nbsp; As others have said, it is probably best if you forfeit the convenient notation for additive and multiplicative monoids that is widely used in the mathematics community, and rather think of monoid in a more abstract fashion \u2014 as a distinct algebraic structure with a distinct operation that, generally, has nothing to do with addition and multiplication in number rings, of which the <code>Num</code> typeclass may be considered an approximate formalization. The Haskell type system is relying on you to make sure that same names refer to same things, and distinct names refer to distinct ones \u2014 this simple and logical rule helps it avoid confusion. This is why the monoidal operation of any monoid is usually referred to with a lozenge <code>&lt;&gt;</code> sign. <em>(Actually, the operation on</em> initial <em>monoids is sometimes denoted <code>++</code>, because of tradition.)</em></p>\n\n<p>It is also somewhat illogical, but considered practical, that <code>Num</code> for usual numbers is defined first <em>(and even on the hardware level)</em>, and the constituting monoids are extracted afterwards:</p>\n\n<p><code>base-4.11.1.0:Data.Semigroup.Internal</code></p>\n\n<pre><code>...\n198 instance Num a =&gt; Semigroup (Sum a) where                                                            \n199         (&lt;&gt;) = coerce ((+) :: a -&gt; a -&gt; a)                                                           \n...\n227 instance Num a =&gt; Semigroup (Product a) where\n228         (&lt;&gt;) = coerce ((*) :: a -&gt; a -&gt; a)\n...\n</code></pre>\n\n<p>\u2014 So it happens that <code>+</code> gets occupied long before any abstract algebra comes into play.</p>\n\n<p>&nbsp;</p>\n\n<p><strong>an algebraist's approach</strong> &nbsp; Nevertheless, it is very much possible to define a ring out of a type with two monoids:</p>\n\n<pre><code>{-# language FlexibleInstances #-}\n{-# language FlexibleContexts #-}\n{-# language UndecidableInstances #-}\n{-# language TypeApplications #-}\n\nmodule MonoidsField where\n\nimport Prelude (Integer, Semigroup, (&lt;&gt;), Monoid, mempty, Show, show)\nimport Data.Coerce\n\nnewtype Sum a = Sum { getSum :: a }\n\nnewtype Product a = Product { getProduct :: a }\n\ndata N = Z | S { predecessor :: N}\n\n-- | Substract one; decrease.\ndec :: Coercible a (N -&gt; N) =&gt; a\ndec = coerce predecessor\n\ninstance Show N\n  where\n    show Z = \"\"\n    show x = '|' : show (predecessor x)\n\ninstance Semigroup (Sum N)\n  where\n    u &lt;&gt; (Sum Z) = u\n    u &lt;&gt; v = coerce S (u &lt;&gt; dec v)\n\ninstance Monoid (Sum N)\n  where\n    mempty = Sum Z\n\ninstance Semigroup (Product N)\n  where\n    u &lt;&gt; (Product Z) = coerce (mempty @(Sum N))\n    u &lt;&gt; v = let (*) =         (&lt;&gt;) @(Product N)\n                 (+) = coerce ((&lt;&gt;) @(Sum N))\n             in u + (u * dec v)\n\ninstance Monoid (Product N)\n  where\n    mempty = Product (S Z)\n\n(+) :: Monoid (Sum a) =&gt; a -&gt; a -&gt; a\nx + y = getSum (Sum x &lt;&gt; Sum y)\n\n(*) :: Monoid (Product a) =&gt; a -&gt; a -&gt; a\nx * y = getProduct (Product x &lt;&gt; Product y)\n\nclass PseudoRing a\n\ninstance (Monoid (Sum a), Monoid (Product a)) =&gt; PseudoRing a\n  where\n    -- You may add some functions that make use of distributivity between the additive and\n    -- multiplicative monoid.\n\n-- ^\n-- \u03bb (S (S (S Z))) + (S (S Z))\n-- |||||\n-- \u03bb (S (S (S Z))) * (S (S Z))\n-- ||||||\n</code></pre>\n\n<p>\u2014 As you see, the <code>PseudoRing</code> class does not add any operations by itself, but it does make sure that the two monoids it requires are defined. If you instantiate it, it is implied that you have ensured that the axiom of distribution holds.</p>\n\n<p>As this example suggests, a subclass may be thought of as including in itself all the operations defined for its superclasses. So, it is a possibility that you proclaim <code>instance Num a =&gt; Foo a</code> and get to re-use the definition of <code>+</code>. You may then go as far as to define <em>\"partial\"</em> instances of <code>Num</code> for your own types that a priory will not have a definition for all the required methods. This approach is obviously unsafe, confusing and overall not advisable, but it may be just what you need, especially if decorated with an appropriate <a href=\"http://matt.might.net/articles/crapl/\" rel=\"nofollow noreferrer\">scientific license</a>. So, your example becomes:</p>\n\n<pre><code>class Foo a\n\ninstance Num a =&gt; Foo a\n</code></pre>\n\n<p>&nbsp;</p>\n\n<hr>\n\n<p>Let me know if any of the above requires clarification!</p>\n"}], "owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 2, "accepted_answer_id": 51994636, "answer_count": 6, "score": 8, "last_activity_date": 1535105844, "creation_date": 1535039360, "last_edit_date": 1535059538, "question_id": 51989707, "link": "https://stackoverflow.com/questions/51989707/making-a-basic-haskell-type-an-instance-of-a-new-typeclass", "title": "Making a basic Haskell type an instance of a new typeclass", "body": "<p>Say I'm trying to define a new typeclass in Haskell, and among other things, it must have a + operation:</p>\n\n<pre><code>class Foo a where\n    (+) :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>(In practice the typeclass Foo would have more stuff, but let me stop here to keep this minimal.)</p>\n\n<p>Now, I want to make the basic \"Integer\" type an instance of Foo; and as far as the + operation goes, I just want to keep the usual addition, which is already defined. How do I do that?</p>\n\n<p>Needless to say, the following makes no sense:</p>\n\n<pre><code>instance Foo Integer where\n    (+) x y = x+y\n</code></pre>\n\n<p>It loops forever when I ask Haskell to compute 2+3, but I suppose that's to be expected! I also tried putting nothing at all:</p>\n\n<pre><code>instance Foo Integer\n</code></pre>\n\n<p>This compiles, but then when I ask for 2+3 I get \"No instance nor default method for class operation +\". Again, it makes sense...</p>\n\n<p>But how do we do that then?</p>\n\n<p>I guess it's a general question \"about the namespace\", I mean, when two typeclasses use the same names, what happens? In my case, I get issues when trying to make a type (Integer) an instance of two typeclasses with such a name clash (Num and Foo).</p>\n\n<p>From reading <a href=\"https://stackoverflow.com/questions/34757498/haskell-why-is-part-of-num-typeclass\">this question</a>, I'm now afraid that what I'm asking for is just prohibited...</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1535036508, "post_id": 51988753, "comment_id": 90927145, "body": "<code>PsrOf</code> expects a function, not a string. You are conflating parser construction with parser <i>application</i>. Assuming <code>f :: String -&gt; Maybe (String, a)</code>, you would want something like <code>dePsr (PsrOf f) &quot;hello&quot;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535036776, "post_id": 51988753, "comment_id": 90927333, "body": "The record syntax you are using only applies to modifying an <i>existing</i> parser. Something like <code>let oldParser = PsrOf someFunc in oldParser { dPsr = newFunc }</code>. (It doesn&#39;t really make sense for a type that wraps a single value. It&#39;s more for making a copy of a more complex object while changing one piece of it.)"}], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1535051060, "post_id": 51989010, "comment_id": 90934952, "body": "Your next job is to make a Monad instance for this type. You might find this useful: <a href=\"https://stackoverflow.com/questions/51987691/how-does-p-f-works-in-parser-instance/51989244#51989244\" title=\"how does p f works in parser instance\">stackoverflow.com/questions/51987691/&hellip;</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1535109839, "post_id": 51989010, "comment_id": 90955949, "body": "@PaulJohnson is it? A monad instance is useful, but not really necessary."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1535113846, "post_id": 51989010, "comment_id": 90958386, "body": "@Cubic How else are you going to code a sequence of sub-clauses like &quot;assignment ::= identifier &#39;=&#39; expression&quot;? Yes, you could create your own sequencing operator from scratch, but it would be a really dumb thing to do."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1535038323, "last_edit_date": 1535038323, "creation_date": 1535037159, "answer_id": 51989010, "question_id": 51988753, "link": "https://stackoverflow.com/questions/51988753/how-to-create-a-newtype-of-parser/51989010#51989010", "title": "How to create a newtype of parser?", "body": "<p>You've already created the type. Now you want to create a <em>value</em> of that type. To do that, you need to call <code>PsrOf</code> with a value of type <code>String -&gt; Maybe (String, a)</code>. For example:</p>\n\n<pre><code>newtype Parser a = PsrOf { dePsr :: String -&gt; Maybe (String, a) }\n\nget3 :: String -&gt; Maybe (String, Int)\nget3 ('3':xs) = Just (xs, 3)\nget3 _ = Nothing  -- Any string, including the empty string, that doesn't start with '3'\n\nget3P :: Parser Int\nget3P = PsrOf get3\n</code></pre>\n\n<p>To actually use the parser, you need to extract the function before applying it to a string:</p>\n\n<pre><code>dePsr get3P \"38\" -- Just (\"8\", 3)\ndePsr get3P \"\"   -- Nothing\ndePsr get3P \"hello\" -- Nothing\n</code></pre>\n\n<p>Record syntax here is just used to simplify the definition of the type, instead of writing</p>\n\n<pre><code>newtype Parser a = PsrOf (String -&gt; Maybe (String, a))\ndePsr :: Parser a -&gt; String -&gt; Maybe (String, a)\ndPsr (PsrOf f) = f\n</code></pre>\n\n<p>The rest of the uses for record syntax (pattern matching or making slightly modified copies of a value) don't really apply usefully to types that wrap a single value.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 51989010, "answer_count": 1, "score": 0, "last_activity_date": 1535038323, "creation_date": 1535036315, "question_id": 51988753, "link": "https://stackoverflow.com/questions/51988753/how-to-create-a-newtype-of-parser", "title": "How to create a newtype of parser?", "body": "<pre><code>newtype Parser a = PsrOf{\n    -- | Function from input string to:\n    --\n    --   * Nothing, if failure (syntax error);\n    --   * Just (unconsumed input, answer), if success.\n    dePsr :: String -&gt; Maybe (String, a)}\n</code></pre>\n\n<p>I want to create a newtype of Parser to see how it looks like.</p>\n\n<p>I tried </p>\n\n<pre><code>*ParserLib&gt; PsrOf{\"hello\"}\n</code></pre>\n\n<p>But it comes up with an error</p>\n\n<pre><code>&lt;interactive&gt;:5:7: error: parse error on input \u2018\"\u2019\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535033203, "post_id": 51987691, "comment_id": 90924933, "body": "Perhaps before studying the <code>&gt;&gt;=</code> operator itself, do you understand the idea behind a parser wrapping a function of type <code>ByteString -&gt; [(a, ByteString)]</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535033240, "post_id": 51987691, "comment_id": 90924955, "body": "The idea of <code>&gt;&gt;=</code> is to enable <i>exhaustive</i> searching a valid way to parse a string into an object. It is a bit related to the <code>&gt;&gt;=</code> of a list <code>[]</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1535033318, "post_id": 51987691, "comment_id": 90925008, "body": "What is not clear?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1535033389, "post_id": 51987691, "comment_id": 90925065, "body": "@ Willem Van Onsem  Yup, it is mentioned on the paper"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1535033488, "post_id": 51987691, "comment_id": 90925137, "body": "@ Cubic Like how does p&gt;&gt;f first applies the parser p to the argument string cs? It skips all the things before the bar |."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535034259, "post_id": 51987691, "comment_id": 90925654, "body": "@user8314628: The thing with the bar is <i>list comprehension</i>: <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">wiki.haskell.org/List_comprehension</a> It does not &quot;skip&quot; the parts before the bar, the bar denotes the separation between the &quot;yield&quot; part, and the &quot;generator&quot; part."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1535034320, "post_id": 51987691, "comment_id": 90925702, "body": "ahhh, I thought it is an &quot;or&quot; symbol"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535035418, "post_id": 51987691, "comment_id": 90926443, "body": "@user8314628: in Haskell the &quot;or&quot; symbol is <code>||</code>: <a href=\"https://www.haskell.org/hoogle/?hoogle=(%7C)\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=(%7C)</a> :)"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 1, "last_activity_date": 1535037925, "creation_date": 1535037925, "answer_id": 51989244, "question_id": 51987691, "link": "https://stackoverflow.com/questions/51987691/how-does-p-f-works-in-parser-instance/51989244#51989244", "title": "How does p &gt;&gt;= f works in Parser instance?", "body": "<p>In Haskell a parser is an example of a <code>Monad</code>. Monads are actually a much broader topic than just parsers, but they actually make a good introduction to the concept. Here is how it works here.</p>\n\n<p>In a parser you want to be able to recognise rules like (in BNF)</p>\n\n<pre><code>assignment ::= identifier \"=\" expression\n</code></pre>\n\n<p>In Haskell you would write it like this:</p>\n\n<pre><code>data Statement = \n    Assignment Identifier Expression\n    | Block [Statement]  -- A block is a list of statements.\n    | Conditional Expression Statement Statement\n    | -- etc. \n\nidentifier :: Parser Identifier  -- Implementation omitted.\n\nliteral :: String -&gt; Parser ()   -- Implementation omitted.\n\nexpression :: Parser Expression   -- Implementation omitted.\n\nassignment :: Parser Statement\nassignment = do          -- Note the \"do\" here.\n   ident &lt;- identifier   \n   literal \"=\"          \n   expr &lt;- expression\n   return (Assignment ident expr)   -- \"return\" doesn't mean what you think.\n</code></pre>\n\n<p>This captures the idea of a parser for assignments being a sequence of sub-parsers: first you parse the identifier, then you recognise the \"=\", then you parse the expression on the right hand side. Hopefully you can see how the BNF maps into the Haskell code.</p>\n\n<p>The \"do\" syntax in Haskell is syntactic sugar for expressions that use the <code>&gt;&gt;=</code> operator (which is called \"bind\"). The <code>assignment</code> example above de-sugars into the following (approximately: there is stuff about pattern match failures that I am skipping over here)</p>\n\n<pre><code>assignment = \n    identifier &gt;&gt;= (\\ident -&gt;\n        operator \"=\" &gt;&gt;= (\\dummy -&gt;\n           expression &gt;&gt;= (\\expression -&gt; return (Assignment ident expr))))\n</code></pre>\n\n<p>Each <code>\\</code> (called \"lambda\") introduces an anonymous function. The <code>&gt;&gt;=</code> operator takes two arguments. On the left hand side is some value wrapped up in the Parser monad. On the right hand side is a function that takes this value and returns a new wrapped value. The job of the bind operator is to unwrap the value on the left (which may involve doing some magic side effects) and pass it to the function on the right. In this case the magic side effects include consuming the input text.</p>\n\n<p>Note how the binds and anonymous functions are nested in the de-sugared version. Each successive line in the \"do\" syntax translates into a new function inside the one for the previous line. That means that the last function has access to all the variables in all of the functions so far. Its a way of modelling a block of assignments in a pure functional language like Haskell.</p>\n\n<p>I said in the comments that \"return\" doesn't mean what you think it means. In Haskell it is nothing to do with flow of control, it just wraps up a value in a monad (in this case <code>Parser</code>) without causing any side effects itself.</p>\n\n<p>This particular parser generates lists of results. That is, rather than deciding on the One True Parse at every step, when it encounters something ambiguous it generates a list of results. The bind operator takes each of the results so far and passes it to the function on its right, which in turn may generate multiple results again. Or a parser may generate no results in which case that branch is abandoned. Hence each step starts with a list of results, and the next step gives a list of lists of results, which is then folded back into a flat list of results by the \"concat\" function.</p>\n\n<p>The <code>Monad</code> class given in your question is part of the standard library. It happens that there are lots of useful functions that apply to all monads, so giving them a common interface works well. In the case of <code>Parser</code> the bind operator has the type</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n</code></pre>\n\n<p>and <code>return</code> has the type</p>\n\n<pre><code>return :: a -&gt; Parser a\n</code></pre>\n\n<p>Meditate on these types and the description I gave of what bind and return do, and you may achieve monadic enlightenment.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 51989244, "answer_count": 1, "score": 0, "last_activity_date": 1535037925, "creation_date": 1535032960, "last_edit_date": 1535032991, "question_id": 51987691, "link": "https://stackoverflow.com/questions/51987691/how-does-p-f-works-in-parser-instance", "title": "How does p &gt;&gt;= f works in Parser instance?", "body": "<pre><code>class Monad m where\n    return :: a -&gt; m a\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n\ninstance Monad Parser where\n    return a = Parser (\\cs -&gt; [(a,cs)])\n    p &gt;&gt;= f = Parser (\\cs -&gt; concat [parse (f a) cs\u2019 | (a,cs\u2019) &lt;- parse p cs])\n</code></pre>\n\n<p>There is an explanation on the <a href=\"http://www.cs.nott.ac.uk/~pszgmh/pearl.pdf\" rel=\"nofollow noreferrer\">paper</a></p>\n\n<blockquote>\n  <p>The (>>=) operator is a sequencing operator for parsers. Using a\n  deconstructor function for parsers defined by parse (Parser p) = p,\n  the parser p >>= f first applies the parser p to the argument string\n  cs to give a list of results of the form (a,cs\u2019), where a is a value\n  and cs\u2019 is a string. For each such pair, f a is a parser which is\n  applied to the string cs\u2019. The result is a list of lists, which is\n  then concatenated to give the final list of results.</p>\n</blockquote>\n\n<p>But this is still not clear. Can anyone explain it with some examples? Thanks a lot.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1535028963, "last_edit_date": 1535028963, "creation_date": 1535028460, "answer_id": 51986214, "question_id": 51985706, "link": "https://stackoverflow.com/questions/51985706/how-to-lens-onto-field-of-a-record-which-is-a-polymorphic-function/51986214#51986214", "title": "How to lens onto field of a record which is a polymorphic function?", "body": "<p><code>lens</code> is pulling a hack here \u2013 it wouldn't be possible to use <code>func</code> as a lens (or other write-capable optic) with type</p>\n\n<pre><code>func :: Lens' MyRecord (a -&gt; a)\n</code></pre>\n\n<p>because that would mean you can put any concrete-type endofunction in, like</p>\n\n<pre><code>changeMyRecord :: MyRecord -&gt; MyRecord\nchangeMyRecord r = r &amp; func .~ ((+1) :: Int -&gt; Int)\n</code></pre>\n\n<p>So instead, it makes <code>func</code> only a getter</p>\n\n<pre><code>func :: Getter' MyRecord (a -&gt; a)\n</code></pre>\n\n<p>...which is ok, because a universal-polymorphic function <em>can</em> be used on any type, so the following works:</p>\n\n<pre><code>useMyRecord :: MyRecord -&gt; String\nuseMyRecord r = show (r^.func $ 1 :: Int)\n</code></pre>\n\n<p>And seeing that</p>\n\n<pre><code>type Getter s a = \u2200 f. (Contravariant f, Functor f) =&gt; (a -&gt; f a) -&gt; s -&gt; f s\n</code></pre>\n\n<p>that's where that <code>Contravariant</code> constraint comes from. The <code>No Instance for Contravariant</code> error message is just VanLaarhoven-Kmett-ish for <code>Can't use a \u2018Getter\u2019 as a \u2018Setter\u2019</code>.</p>\n\n<p><strong>What you'd actually <em>want</em></strong> to have is of course</p>\n\n<pre><code>func :: Lens' MyRecord (\u2200 a . a -&gt; a)\n</code></pre>\n\n<p>but that's unfortunately an <a href=\"https://en.wikipedia.org/wiki/Parametric_polymorphism#Impredicative_polymorphism\" rel=\"noreferrer\">impredicative type</a>, which Haskell <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\" rel=\"noreferrer\">doesn't support</a>. Namely, it would expand to</p>\n\n<pre><code>func :: \u2200 f . Functor f =&gt; ((\u2200 a . a -&gt; a) -&gt; f (\u2200 a . a -&gt; a)) -&gt; MyRecord -&gt; f MyRecord\n</code></pre>\n\n<p>Note that there's a <code>\u2200</code> inside the <code>f</code>.</p>\n\n<p>To get the semantics of such a polymorphic-field lens, you'll need to wrap that in a Rank-0 type:</p>\n\n<pre><code>newtype PolyEndo = PolyEndo { getPolyEndo :: \u2200 a . a -&gt; a }\n\ndata MyRecord = MyRecord \n  { _func :: PolyEndo\n  }\n\nmakeLenses ''MyRecord\n-- func :: Lens' MyRecord PolyEndo\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 6549493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2535754e54dc7fae66a4bfa9ff2372e?s=128&d=identicon&r=PG&f=1", "display_name": "ocstat", "link": "https://stackoverflow.com/users/6549493/ocstat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 51986214, "answer_count": 1, "score": 3, "last_activity_date": 1535028963, "creation_date": 1535026873, "question_id": 51985706, "link": "https://stackoverflow.com/questions/51985706/how-to-lens-onto-field-of-a-record-which-is-a-polymorphic-function", "title": "How to lens onto field of a record which is a polymorphic function?", "body": "<p>I just installed the <code>lens</code> library so I can easily <code>set</code> in a nested data structure. However, i ran into a problem. Here is a minimal example to demonstrate my problem</p>\n\n<p>The following code doesn't compile:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TemplateHaskell #-}\nimport Control.Lens    \n\ndata MyRecord = MyRecord \n  { _func :: forall . a -&gt; a\n  }\n\nmakeLenses ''MyRecord\n\nchangeMyRecord :: MyRecord -&gt; MyRecord\nchangeMyRecord r = r &amp; func .~ id\n</code></pre>\n\n<p>The error is <code>No Instance for (Contravariant Identity) arising from use of 'func'</code>.</p>\n\n<p>I had a look at <code>Contravariant</code>, and I'm pretty sure that it is impossible for me to make this instance since</p>\n\n<pre><code>class Contravariant f where\n  contramap :: (a -&gt; b) -&gt; f b -&gt; f a\n</code></pre>\n\n<p>i.e. If <code>f = \\x -&gt; x</code> I don't see where i'm going to find something of type <code>a</code> to apply to the function argument <code>(a-&gt; b)</code></p>\n\n<p>Is there a different way to modify a <code>MyRecord</code> using lenses? Or could I perhaps avoid <code>RankNTypes</code> somehow, but still pass around a polymorphic <code>_func</code> in my record? Or something else?</p>\n\n<p>Record update syntax is off the cards - imagine that <code>MyRecord</code> is deeply nested.</p>\n\n<p>Please assume very little haskell knowledge when answering, in particular I only started looking at the lens library today</p>\n"}, {"tags": ["haskell", "io", "retry-logic"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1535016675, "post_id": 51982526, "comment_id": 90914665, "body": "Please re-insert the code with proper indentation. Note you can just paste the code from your <code>.hs</code> file, select it, and press <code>ctrl</code>-<code>k</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535020042, "post_id": 51982526, "comment_id": 90916663, "body": "I reformatted it and made some parameter simplifications."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535020305, "post_id": 51982526, "comment_id": 90916810, "body": "Erm, the indentation is still wrong. Imports and top-level definitions must not be indented."}, {"owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "edited": false, "score": 1, "creation_date": 1535020841, "post_id": 51982526, "comment_id": 90917117, "body": "<a href=\"http://hackage.haskell.org/package/retry-0.7.6.3/docs/Control-Retry.html#v:retrying\" rel=\"nofollow noreferrer\">retry</a> package provides retry logic implementation if you want to avoid writing it by hand. There is also <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/System-Timeout.html\" rel=\"nofollow noreferrer\">timeout</a> combinator in <code>base</code> if you just want to limit <code>IO</code> action with timeout"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1535024109, "creation_date": 1535024109, "answer_id": 51984891, "question_id": 51982526, "link": "https://stackoverflow.com/questions/51982526/how-to-retry-blocking-io-action-when-timeout/51984891#51984891", "title": "How to retry blocking IO Action when timeout?", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/System-Timeout.html#v:timeout\" rel=\"nofollow noreferrer\">timeout</a> to add a timeout to any blocking call, and simple recursion for retries:</p>\n\n<pre><code>retry :: Int -&gt; Int -&gt; IO a -&gt; IO (Maybe a)\nretry 0 _ _ = return Nothing\nretry numRetries microseconds action = do\n    result &lt;- timeout microseconds action\n    case result of\n        Nothing -&gt; retry (numRetries-1) microseconds action\n        Just a  -&gt; return (Just a)\n</code></pre>\n\n<p>Do read the documentation for caveats about FFI stuff, though.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 51984891, "answer_count": 1, "score": 3, "last_activity_date": 1535024109, "creation_date": 1535016507, "last_edit_date": 1535022642, "question_id": 51982526, "link": "https://stackoverflow.com/questions/51982526/how-to-retry-blocking-io-action-when-timeout", "title": "How to retry blocking IO Action when timeout?", "body": "<p>How does one deal with a blocking <code>IO</code> action in Haskell? How can I put this <code>IO</code> action inside a scope and manage this scope from another method? If the timeout is reached, I would just reinvoke this method. Normally in other languages, I would probably put this in a separate thread and <code>abort</code> it if I do not get the result in a configurable time. (The timer being external.)</p>\n\n<p>In my case: I have a number of <code>retries</code> and let's say I want to perform an <code>IO</code> action with a timeout. How can I place the <code>IO</code> action in a timeout-ed scope so that it gets recalled  after the timeout expires, if and only if the number of <code>retries</code> is greater 0.</p>\n\n<p>Basically: given our <code>IO</code> action like <code>ioMethod::IO String</code> (I have not looked yet in the socket library for Haskell), we'll assume its a black box,</p>\n\n<pre><code>module Retry where\n\nimport IOExternal(ioMethod)\n\nretryFunc :: Int -&gt; IO String\nretryFunc retries=do\n            msg&lt;-retry 5 100 IOExternal \n            return msg\n\nretry :: Int -&gt; Int -&gt; IOExternal -&gt; IO String\nretry retries timeout ioMethod = go retries timeout \"\" where\n        go 0       timeout ioMethod  msg =\n                    if msg==\"\" then return \"Max Retries reached\" \n                               else return msg\n\n        go retries timeout ioMethod  msg counter\n               = gogo retries timeout counter msg  where\n                     gogo retries timeout 0 msg = return \"\"\n                     gogo retries timeout counter msg\n                        = ioMethod&gt;&gt;=gogo retries timeout counter-1 \n</code></pre>\n\n<p>I do not know how to model this last condition/line.</p>\n\n<p><strong>P.S</strong> I am not yet familiar with threading in Haskell (beginner here) and I do think that the timeout-ed scope should perform in different thread,and somehow I need to check it from my main program, and either recall it (if retries>0) or end the main method.</p>\n"}, {"tags": ["haskell", "frp", "purescript", "category-theory"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 4, "creation_date": 1535016699, "post_id": 51979438, "comment_id": 90914681, "body": "This doesn&#39;t sound like a pure function if the result depends upon the time of the call"}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1535018596, "post_id": 51979438, "comment_id": 90915840, "body": "Very good point! :D"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1535038917, "post_id": 51979438, "comment_id": 90928726, "body": "It is pure in the sense that the time is a pure value. While <code>now</code> is in the <code>IO</code> monad, a particular time in the past or future is a pure value."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1535096859, "post_id": 51979438, "comment_id": 90948547, "body": "@BobDalgleish But we don&#39;t pass in the time as an argument"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1535106380, "post_id": 51979438, "comment_id": 90953948, "body": "@Bergi Have a read of section 2 of <a href=\"http://conal.net/papers/push-pull-frp/push-pull-frp.pdf\" rel=\"nofollow noreferrer\"><i>Push-Pull FRP</i></a>. <code>Behaviour a</code> denotes <code>Time -&gt; a</code>, in the sense that a <code>Behaviour</code> can be sampled at any time and sampling a <code>Behaviour</code> has no side-effects. <code>Time -&gt; a</code> is a model, not the actual implementation, but it tells you a lot about how <code>Behaviour</code>s compose. The fact that the <code>Time</code> is handled implicitly by the framework doesn&#39;t change the model, much as using a parser combinator library to handle leftovers and backtracking doesn&#39;t change the <code>String -&gt; [(a, String)]</code> model."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1535118977, "post_id": 51979438, "comment_id": 90961857, "body": "@BenjaminHodgson I know Push-Pull FRP, but I don&#39;t see how you can write a function <code>extract :: (Time -&gt; a) -&gt; a</code> without an impure (or useless?) construction of a Time value"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1535119145, "post_id": 51979438, "comment_id": 90961944, "body": "@Bergi -\u221e (ie the behaviour&#39;s initial value) would seem like a natural choice. No idea whether that can be efficiently implemented"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1535119860, "post_id": 51979438, "comment_id": 90962427, "body": "@BenjaminHodgson yeah, that might work (with <code>duplicate</code> mapping the behaviour to a behaviour of itself with all past values forgotten)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1535167972, "post_id": 51979438, "comment_id": 90978161, "body": "Not in the standard semantics, but there was some exploration of <i>relative-time</i> FRP for a bit, in which <code>Behavior</code> is a comonad (&amp; <code>extract</code> samples at time 0)."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 3, "last_activity_date": 1535043837, "creation_date": 1535043837, "answer_id": 51990927, "question_id": 51979438, "link": "https://stackoverflow.com/questions/51979438/is-behavior-a-comonad/51990927#51990927", "title": "Is Behavior a Comonad?", "body": "<p><code>Behavior a</code> is isomorphic to <code>(Time -&gt; a)</code>.  The definitions Conal gives in the section of that post \"Adding continuity\" match those in the <a href=\"https://hackage.haskell.org/package/comonad-5.0.4/docs/src/Control.Comonad.html#line-170\" rel=\"nofollow noreferrer\">comonad package</a>.</p>\n\n<p>It is not obvious to me how to make time a Monoid.  Several Monoid instances are possible, but are any useful?  Conal's post on <a href=\"http://conal.net/blog/posts/future-values\" rel=\"nofollow noreferrer\">future values</a> suggests that the <code>Max</code> is a useful Monoid for working with time.</p>\n\n<p>This works out that <code>extract @Behavior</code> gives the value at the earliest possible time, and <code>duplicate @Behavior</code> gives the value at the later of the two times.  I can see both of those being useful.  Perhaps there are other useful Monoids also?</p>\n"}], "owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1535043837, "creation_date": 1535005260, "question_id": 51979438, "link": "https://stackoverflow.com/questions/51979438/is-behavior-a-comonad", "title": "Is Behavior a Comonad?", "body": "<p>Conal Elliott talks about Streams and Comonads here: <a href=\"http://conal.net/blog/posts/sequences-streams-and-segments\" rel=\"noreferrer\">http://conal.net/blog/posts/sequences-streams-and-segments</a></p>\n\n<p>However, he doesn't mention Behavior directly. So.. is Behavior a Comonad, and if so - what does that mean practically?</p>\n\n<p>For starters - I suppose Behavior can provide the <code>extend</code> and <code>extract</code> functions. The only way I see that working is if it samples the value at a specific moment in time. </p>\n\n<p>Is that what Comonad would mean for Behavior? That it allows one to \"fork and freeze\" a Behavior?</p>\n\n<p>In other words - if we have a Behavior that has these values over time: <code>A,B,C,D,...</code> we could <code>extend</code> it at the time where it's <code>B</code>, and get a new Behavior which contains <code>B</code> indefinitely (which is useful - since we could then <code>lift</code> or <code>map</code> it etc.) </p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3096202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7274637f4a1c23b0897724e8b3757a2b?s=128&d=identicon&r=PG&f=1", "display_name": "cdr", "link": "https://stackoverflow.com/users/3096202/cdr"}, "edited": false, "score": 0, "creation_date": 1535031750, "post_id": 51979933, "comment_id": 90923958, "body": "Thank you so much for the explanation and I will give this a try soon. About your comment on returning the <code>User</code>, I stripped as much code as I could. I will be adding all the necessary claims verification once I get past this typing error."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13, "user_id": 3096202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7274637f4a1c23b0897724e8b3757a2b?s=128&d=identicon&r=PG&f=1", "display_name": "cdr", "link": "https://stackoverflow.com/users/3096202/cdr"}, "edited": false, "score": 0, "creation_date": 1535035386, "post_id": 51979933, "comment_id": 90926422, "body": "@cdr Depending on what you do with <code>create</code>, you may not even end up needing a type annotation for it. :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1535007234, "creation_date": 1535007234, "answer_id": 51979933, "question_id": 51979260, "link": "https://stackoverflow.com/questions/51979260/how-do-i-parse-this-ghc-type-check-error-message/51979933#51979933", "title": "How do I parse this GHC type check error message?", "body": "<p>When you call <code>verifyJwt :: forall e s. ...</code>, GHC figures out that you want to instantiate the <code>s</code> type variable to <code>String</code> but it has no way of figuring out what to instantiate the <code>e</code> type variable to.</p>\n\n<p>You can fix this by giving an explicit type signature to <code>claims</code>, although you'll have to enable the <code>ScopedTypeVariables</code> extension. You can take your pick for which <a href=\"https://www.stackage.org/haddock/lts-12.7/jose-0.7.0.0/Crypto-JOSE-Error.html#t:AsError\" rel=\"nofollow noreferrer\">instance of <code>AsError</code></a> you want.</p>\n\n<p>For instance, picking <code>e ~ Error</code>:</p>\n\n<pre><code>authF2 :: (MonadIO m,\n       MonadError ServantErr m) =&gt;\n      Request -&gt; m User\nauthF2 req = do\n  case lookup \"Authorization\" (requestHeaders req) of\n    Nothing -&gt; throwError err401\n    Just authH -&gt; do\n      let (b, rest) = BS.break isSpace authH\n\n    if T.toLower (decodeUtf8 b) == \"bearer\"\n      then do\n        (claims :: Either Error Crypto.JWT.ClaimsSet) &lt;- liftIO $ verifyJwt \"\"  (L.fromStrict rest) (\"audience\"::String)\n        return $ User\n      else throwError err401\n</code></pre>\n\n<p>Unrelated to type errors, but don't you also want to check that <code>claims</code> isn't a <code>Left</code> before returning the <code>User</code>?</p>\n"}], "owner": {"reputation": 13, "user_id": 3096202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7274637f4a1c23b0897724e8b3757a2b?s=128&d=identicon&r=PG&f=1", "display_name": "cdr", "link": "https://stackoverflow.com/users/3096202/cdr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 51979933, "answer_count": 1, "score": 1, "last_activity_date": 1535032984, "creation_date": 1535004344, "last_edit_date": 1535032984, "question_id": 51979260, "link": "https://stackoverflow.com/questions/51979260/how-do-i-parse-this-ghc-type-check-error-message", "title": "How do I parse this GHC type check error message?", "body": "<p>I have been stumped by this GHC (version 8.4.3) type check error. This is an extract from a Haskell Servant code base I am working on. If somebody can explain the reason for this message, I would be very grateful. Apologies for the length of the code, but I was unable to reduce it any further.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule Api2 where\n\nimport Control.Lens (preview)\nimport Control.Lens.Cons\nimport Control.Monad.Error.Class\nimport Control.Monad.Except (runExceptT)\nimport Control.Monad.IO.Class (liftIO, MonadIO)\nimport Control.Monad.Trans.Maybe (MaybeT, runMaybeT)\nimport Crypto.JOSE.Compact\nimport Crypto.JOSE.Error\nimport Crypto.JWT (JWT, JWK, JWTError, verifyClaims, decodeCompact,\n               defaultJWTValidationSettings, stringOrUri, ClaimsSet, \n               AsJWTError)\nimport Data.Aeson (decode, encode)\nimport Data.Aeson.Types\nimport Data.Maybe (fromJust)\nimport Data.Text as T\nimport Data.Text.Encoding (decodeUtf8, encodeUtf8)\nimport Data.Word8(isSpace)\nimport Network.Wai (Request, requestHeaders)\nimport Servant.API.Experimental.Auth (AuthProtect)\nimport Servant.Auth.Server (FromJWT, ToJWT)\nimport Servant.Server.Experimental.Auth (AuthHandler, AuthServerData, \n         mkAuthHandler)\nimport Servant.Server.Internal.ServantErr\nimport qualified Data.ByteString as BS\nimport qualified Data.ByteString.Lazy as L\n\ndata User = User\n\nauthHandler :: AuthHandler Request User\nauthHandler = mkAuthHandler authF2\n\nauthF2 :: (MonadIO m,\n       MonadError ServantErr m) =&gt;\n      Request -&gt; m User\nauthF2 req = do\n  case lookup \"Authorization\" (requestHeaders req) of\n    Nothing -&gt; throwError err401\n    Just authH -&gt; do\n      let (b, rest) = BS.break isSpace authH\n\n    if T.toLower (decodeUtf8 b) == \"bearer\"\n      then do\n        claims &lt;- liftIO $ verifyJwt \"\" (L.fromStrict rest) \n                   (\"audience\"::String)\n        return $ User\n      else throwError err401\n\nverifyJwt\n  :: forall e s. (Crypto.JWT.AsJWTError JWTError, (AsError e), \n                 AsJWTError e,\n              Control.Lens.Cons.Cons s s Char Char, Monoid s) =&gt;\n     FilePath\n     -&gt; L.ByteString\n     -&gt; s\n     -&gt; IO (Either e Crypto.JWT.ClaimsSet)\nverifyJwt jwkFilename jwtData aud = do\n  let\n    aud' = fromJust $ preview stringOrUri aud\n    conf = defaultJWTValidationSettings (== aud')\n\n  Just k &lt;-  decode &lt;$&gt; L.readFile jwkFilename\n  result &lt;- runExceptT\n    (decodeCompact jwtData &gt;&gt;= verifyClaims conf (k :: JWK))\n  return result\n</code></pre>\n\n<p>When I load this file in GHC, I get the following error.</p>\n\n<pre><code>\u2022 Could not deduce (AsError e0) arising from a use of \u2018verifyJwt\u2019\n  from the context: (MonadIO m, MonadError ServantErr m)\n    bound by the type signature for:\n               authF2 :: forall (m :: * -&gt; *).\n                         (MonadIO m, MonadError ServantErr m) =&gt;\n                         Request -&gt; m User\n    at servant-api-server/src/Api2.hs:(37,1)-(39,27)\n  The type variable \u2018e0\u2019 is ambiguous\n  These potential instances exist:\n    instance AsError Crypto.JOSE.Error.Error\n      -- Defined in \u2018Crypto.JOSE.Error\u2019\n    instance AsError JWTError -- Defined in \u2018Crypto.JWT\u2019\n\u2022 In the second argument of \u2018($)\u2019, namely\n    \u2018verifyJwt \"\" (L.fromStrict rest) (\"audience\" :: String)\u2019\n  In a stmt of a 'do' block:\n    claims &lt;- liftIO\n                $ verifyJwt \"\" (L.fromStrict rest) (\"audience\" :: String)\n  In the expression:\n    do claims &lt;- liftIO\n                   $ verifyJwt \"\" (L.fromStrict rest) (\"audience\" :: String)\n       return $ User\n   |\n48 |           claims &lt;- liftIO $ verifyJwt \"\" (L.fromStrict rest) (\"audience\"::String)\n\n|                              \n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 11, "creation_date": 1535002184, "post_id": 51978845, "comment_id": 90907393, "body": "But it is part of <code>case</code>. Why do you think it isn&#39;t?"}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 0, "creation_date": 1535002240, "post_id": 51978845, "comment_id": 90907418, "body": "Here is the list of all keywords: <a href=\"https://wiki.haskell.org/Keywords#case.2C_of\" rel=\"nofollow noreferrer\">wiki.haskell.org/Keywords#case.2C_of</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1535015226, "post_id": 51978845, "comment_id": 90913783, "body": "fully parenthesized, it&#39;s <code>case (stf s0) of { (s1, a) -&gt; (s1, f a) }</code>. Might be a bit clearer."}, {"owner": {"reputation": 10237, "user_id": 2464597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/12eaebfe8c9ae6c3a29aefe69ebcb4bd?s=128&d=identicon&r=PG", "display_name": "Engineero", "link": "https://stackoverflow.com/users/2464597/engineero"}, "edited": false, "score": 3, "creation_date": 1535032967, "post_id": 51978845, "comment_id": 90924805, "body": "I&#39;m voting to close this question as off-topic because it has to do with basic language syntax. Reading the docs would likely be a good place to start."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1535081932, "post_id": 51978845, "comment_id": 90943439, "body": "By the way, you can use record syntax for newtypes: <code>newtype State s a = StateOf {deState:: s -&gt; (s, a)}</code>. Then you don&#39;t need to define <code>deState</code> separately."}], "answers": [{"tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": true, "score": 3, "last_activity_date": 1535008366, "last_edit_date": 1535008366, "creation_date": 1535002751, "answer_id": 51978970, "question_id": 51978845, "link": "https://stackoverflow.com/questions/51978845/is-there-an-of-syntax-in-haskell/51978970#51978970", "title": "Is there an &quot;of&quot; syntax in Haskell?", "body": "<p>As @melpomene commented, the \"of\" is part of the case expression. See <a href=\"http://learnyouahaskell.com/syntax-in-functions#case-expressions\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/syntax-in-functions#case-expressions</a> for further reference. Also the case expression is contained in a lambda expression which I would point you to <a href=\"http://learnyouahaskell.com/higher-order-functions#lambdas\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/higher-order-functions#lambdas</a> for reference. LYAH was and continues to be a great source (at least for me).</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 51978970, "answer_count": 1, "score": -1, "last_activity_date": 1535015328, "creation_date": 1535001824, "last_edit_date": 1535015328, "question_id": 51978845, "link": "https://stackoverflow.com/questions/51978845/is-there-an-of-syntax-in-haskell", "title": "Is there an &quot;of&quot; syntax in Haskell?", "body": "<pre><code>newtype State s a = StateOf (s -&gt; (s, a))\n\ndeState :: State s a -&gt; (s -&gt; (s, a))\ndeState (StateOf stf) = stf\n\ninstance Functor (State s) where\n    -- fmap :: (a -&gt; b) -&gt; State s a -&gt; State s b\n    fmap f (StateOf stf) = StateOf (\\s0 -&gt; case stf s0 of (s1, a) -&gt; (s1, f a))\n</code></pre>\n\n<p>In the last line</p>\n\n<pre><code>fmap f (StateOf stf) = StateOf (\\s0 -&gt; case stf s0 of (s1, a) -&gt; (s1, f a))\n</code></pre>\n\n<p>The <code>of</code> syntax makes me confused. It seems not part of the <code>case</code> syntax.</p>\n"}]