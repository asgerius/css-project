[{"tags": ["haskell", "functor", "category-theory"], "comments": [{"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 2, "creation_date": 1471472502, "post_id": 39007078, "comment_id": 65366016, "body": "You want <code>n</code> to use the environment, but, since you have only the Reader, there is no environment and you have to provide it yourself. I feel that <code>Just (f True)</code>, <code>Just (f False)</code> and <code>Nothing</code> are all natural transformations between these functors."}], "answers": [{"comments": [{"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1471474505, "post_id": 39007205, "comment_id": 65366618, "body": "That makes sense! So, there are only 3 possible nat. transformations between <code>Reader Bool</code> and <code>Maybe</code>, right? Then on question #2 he asks for natural transformations from <code>Reader ()</code> to <code>List</code>. I came up with: <code>n (Reader f) = [f ()]</code> and infinite of <code>n (Reader f) = [() ... ()]</code>. Is this accurate?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1471494481, "post_id": 39007205, "comment_id": 65371632, "body": "@Josh.F, <code>Reader ()</code> is morally isomorphic to <code>Identity</code>. So you get one element and need to make a list. There is thus one such natural transformation for each natural number (don&#39;t forget 0), plus the infinite one. I think."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1471505206, "post_id": 39007205, "comment_id": 65375559, "body": "@dfeuer Exactly! And Yoneda gives the same: natural transformations <code>Reader () -&gt; List</code> correspond to <code>List ()</code>."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 19, "last_activity_date": 1471472836, "creation_date": 1471472836, "answer_id": 39007205, "question_id": 39007078, "link": "https://stackoverflow.com/questions/39007078/natural-transformations-from-reader-bool-to-maybe/39007205#39007205", "title": "Natural Transformations From Reader Bool To Maybe", "body": "<p>As I've already said in a comment, you want n to use the environment, but, since you have only the Reader, there is no environment and you have to provide it yourself.</p>\n\n<p>Evidently, these are in fact three <em>distinct</em> natural transformations <code>Reader Bool a -&gt; Maybe a</code>:</p>\n\n<pre><code>n (Reader f) = Just (f True)\n\nn (Reader f) = Just (f False)\n\nn (Reader f) = Nothing\n</code></pre>\n\n<p>Let's prove there are no more. In category-theoretic terms, the functor <code>Reader Bool a</code> is just <code>Hom(Bool,_)</code>. Now, <a href=\"https://en.wikipedia.org/wiki/Yoneda_lemma\" rel=\"noreferrer\">Yoneda lemma</a> tells us that</p>\n\n<pre><code>Nat(Hom(X,_), F) = F(X)\n</code></pre>\n\n<p>That is, natural transformations from the functor <code>Hom(X,_)</code> to a functor <code>F</code> are in one-to-one correspondence with elements of the set <code>F(X)</code>.</p>\n\n<p>In our case, <code>X = Bool</code> and <code>F = Maybe</code>, so we obtain</p>\n\n<pre><code>Nat(Hom(Bool,_),Maybe) = Maybe Bool\n</code></pre>\n\n<p><code>Maybe Bool</code> contains exactly three elements: <code>Just True</code>, <code>Just False</code> and <code>Nothing</code>, which correspond to the implementations in the beginning of the answer.</p>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 2, "accepted_answer_id": 39007205, "answer_count": 1, "score": 13, "last_activity_date": 1471472836, "creation_date": 1471472036, "question_id": 39007078, "link": "https://stackoverflow.com/questions/39007078/natural-transformations-from-reader-bool-to-maybe", "title": "Natural Transformations From Reader Bool To Maybe", "body": "<p>I'm reading Bartosz's awesome blog, and following along on challenge question 3, I'm a bit stumped:</p>\n\n<p><a href=\"https://bartoszmilewski.com/2015/04/07/natural-transformations/\">https://bartoszmilewski.com/2015/04/07/natural-transformations/</a></p>\n\n<p><em>Q3: define some natural transformations from <code>Reader Bool</code> to <code>Maybe</code></em></p>\n\n<p>I have defined the Reader functor as: </p>\n\n<pre><code>newtype Reader e a = Reader (e-&gt;a)\n\nrunReader :: Reader e a -&gt; e -&gt; a\nrunReader (Reader f) env = f env\n\ninstance Functor (Reader e) where\n    fmap f (Reader g) = Reader (\\x -&gt; f (g x))\n</code></pre>\n\n<p>and I want to find a natural transformation</p>\n\n<pre><code>n :: Reader Bool a -&gt; Maybe a\n</code></pre>\n\n<p>My intuition is that if <code>Reader</code>'s environment is <code>True</code>, I can have a <code>Just a</code>, and if <code>False</code>, then the natural transformation projects to <code>Nothing</code>. But that feels slightly monadic, or like a <code>Maybe</code> nested inside a <code>Reader</code>, like <code>Reader Bool (Maybe Int)</code>, so I'm not sure.</p>\n\n<p>I can't concieve of how to do that. The best I have is:</p>\n\n<pre><code>n :: Reader Bool a -&gt; Maybe a\nn (Reader f) = Just (f True)\n</code></pre>\n\n<p>But this cannot take into account the environment, nor return <code>Nothing</code>.</p>\n\n<p>I want to build a structure that commutes, building a square out of <code>fmap</code>, and natural transformations.</p>\n\n<p>For ex:</p>\n\n<pre><code>                          nat\nReader Bool Int +---------------------------&gt; Maybe Int\n     +                                            +\n     |                                            |\n     |                                            |\n     |                                            |\n     |    fmap show                               |  fmap show\n     |                                            |\n     |                                            |\n     |                                            |\n     |                                            |\n     v                  nat                       v\nReader Bool String  +--------------------------&gt; Maybe String                         \n</code></pre>\n\n<p>can you help me fill in the gaps?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1471469221, "post_id": 39006416, "comment_id": 65364736, "body": "Maybe another map?"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1495823541, "post_id": 39006629, "comment_id": 75428702, "body": "Another possibility that extends more easily to working with more than two lists of choices: <code>concat &lt;$&gt; sequence [[&quot;1&quot;, &quot;2&quot;], [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]]</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1471469616, "creation_date": 1471469616, "answer_id": 39006629, "question_id": 39006416, "link": "https://stackoverflow.com/questions/39006416/prepending-lists-to-lists/39006629#39006629", "title": "Prepending lists to lists", "body": "<p>If you do not need the list boundaries (a very common case):</p>\n\n<pre><code>Control.Applicative&gt; liftA2 (++) [\"1\", \"2\"] [\"a\", \"b\", \"c\"]\n[\"1a\",\"1b\",\"1c\",\"2a\",\"2b\",\"2c\"]\n</code></pre>\n\n<p>Otherwise, just nest your call to <code>map</code>:</p>\n\n<pre><code>&gt; map (\\prefix -&gt; map (prefix++) [\"a\", \"b\", \"c\"]) [\"1\", \"2\"]\n[[\"1a\",\"1b\",\"1c\"],[\"2a\",\"2b\",\"2c\"]]\n</code></pre>\n"}], "owner": {"reputation": 346, "user_id": 3991367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/733f070f5b5477eb23023272167640c3?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Ambrogio", "link": "https://stackoverflow.com/users/3991367/dan-ambrogio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 39006629, "answer_count": 1, "score": 0, "last_activity_date": 1471469616, "creation_date": 1471468597, "last_edit_date": 1471469019, "question_id": 39006416, "link": "https://stackoverflow.com/questions/39006416/prepending-lists-to-lists", "title": "Prepending lists to lists", "body": "<p>This is probably a very simple question.</p>\n\n<p>Given two lists of strings, xs and ys, I need a list of lists where the two have been prepended.</p>\n\n<p>For instance,</p>\n\n<p><code>body = [\"1\", \"2\"]\n suffixes = [\"a\", \"b\", \"c\"]\n</code></p>\n\n<p>would give the output</p>\n\n<p><code>[[\"1a\", \"1b\", \"1c\"], [\"2a\", \"2b\", \"2c\"]]</code></p>\n\n<p>From what I understand, haskell uses <code>map</code> where other languages would use <code>for each</code>, so I tried mapping the append function to the list,\n<code>map (++\"1\") suffixes</code>\nbut I can't figure out how to apply this dynamically to <code>[\"1\", \"2\"]</code> instead of hardcoding it.</p>\n"}, {"tags": ["haskell", "ghc", "quickcheck"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1471527396, "post_id": 39002928, "comment_id": 65389721, "body": "Did you try to <i>Use `-v&#39; to see a list of the files searched for</i> to try and see what ghci is doing instead of importing that module? Also: it is a <b>terrible</b> idea to post <i>pictures</i> of <i>text</i> (e.g. code and error messages). blind people cannot see those, and also you are making the question un-searchable. Always prefer to copy &amp;paste the error message and code into the question."}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 2, "last_activity_date": 1471459682, "creation_date": 1471459682, "answer_id": 39004171, "question_id": 39002928, "link": "https://stackoverflow.com/questions/39002928/haskell-ghc-failed-to-load-interface-for-test-quickcheck/39004171#39004171", "title": "Haskell GHC: Failed to load interface for &#39;Test.QuickCheck&#39;", "body": "<p>I'd recommend using <code>stack</code>.</p>\n\n<pre><code>stack install QuickCheck\n</code></pre>\n\n<p>That will add it to the global config in <code>~/.stack/global-project/stack.yaml</code></p>\n\n<p>Better yet, set up a new project with <code>stack new</code> and add <code>QuickCheck</code> in the build-depends section of your <code>[projectname].cabal</code> file.</p>\n"}], "owner": {"reputation": 105, "user_id": 4809575, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/c72329f445630e8fae179221608685fe?s=128&d=identicon&r=PG", "display_name": "fant0me", "link": "https://stackoverflow.com/users/4809575/fant0me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3431, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1471459682, "creation_date": 1471455024, "question_id": 39002928, "link": "https://stackoverflow.com/questions/39002928/haskell-ghc-failed-to-load-interface-for-test-quickcheck", "title": "Haskell GHC: Failed to load interface for &#39;Test.QuickCheck&#39;", "body": "<p><a href=\"https://i.stack.imgur.com/83Kam.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/83Kam.png\" alt=\"a ghci error\"></a></p>\n\n<p>So I have to include the <strong>'Test.QuickCheck'</strong> library for some testings for a subject. Although I've use it the whole year, I reinstalled <strong>GHC/GHCi</strong> recently and <strong>it doesn't load this library</strong>. The other functions work as planned. Currently using Xubuntu 16.04.</p>\n\n<p>Do you have any idea of what might be the error?</p>\n"}, {"tags": ["haskell", "dependent-type", "template-haskell", "singleton-type"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1471454557, "post_id": 39002342, "comment_id": 65357166, "body": "I think there might be a bug (or I&#39;m missing some known caveats) since even <code>[d| data Nat = Z | S Nat deriving (Eq,Ord) ]</code> fails. That said, I get a different error message than you. What version of GHC are you using?"}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471455174, "post_id": 39002342, "comment_id": 65357502, "body": "Indeed, <code>deriving Ord</code> fails for me too. I am using 7.10.3."}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471455654, "post_id": 39003001, "comment_id": 65357752, "body": "Bizarre. Confirming your solution works on 7.10.3 too. I am not even going to ask how you came up with this (I am pretty new to Haskell let alone this black magic stuff), but congratulations that you did! Should I file a bug report? Anyway thank you."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 1, "creation_date": 1471456147, "post_id": 39003001, "comment_id": 65358003, "body": "@denormal The error in both cases (implementing <code>(&lt;=)</code> or <code>compare</code>) came from the recursive call, and the recursive call is always tougher in a typeclass (because you need the to assume the constraint for the duration of the constraint definition). I thought defining the recursion elsewhere would make this easier. I&#39;m going to dive into this after work today - I&#39;m not sure yet if this is even a bug or I&#39;m missing something else."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 1, "creation_date": 1471456794, "post_id": 39003001, "comment_id": 65358365, "body": "@denormal Rereading my comment, I realize it doesn&#39;t make much sense. Directly: when I use <code>(&lt;=)</code> on the right hand side of an equation in <code>instance Ord Nat where ..</code>, I need to have assumed the constraint <code>Ord Nat</code>. I think that might be related to what is tripping up <code>singleton</code>."}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471459893, "post_id": 39003001, "comment_id": 65360079, "body": "This makes sense. I tried writing <code>(&lt;=)</code> as a non-recursive call <code>(&lt;=) = le</code> and it worked. I also tried writing a manual instance of <code>Eq</code> with <code>(==)</code> defined recursively and I got the same error message. So, are we to assume that the derived version of <code>(==)</code> is defined in the former manner and the derived version of <code>(&lt;=)</code> in the latter? Obviously GHC has no problem deducing <code>Ord Nat</code> for value-level <code>Nat</code>s."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471462778, "post_id": 39003001, "comment_id": 65361540, "body": "@denormal Yeah, I noticed that too. I wonder what the generated <code>Eq</code> instance looks like."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1471554566, "last_edit_date": 1471554566, "creation_date": 1471455281, "answer_id": 39003001, "question_id": 39002342, "link": "https://stackoverflow.com/questions/39002342/adding-an-ord-instance-to-singleton-package-generated-naturals/39003001#39003001", "title": "Adding an Ord instance to &#39;singleton&#39; package generated naturals", "body": "<p>I'm not sure why this is failing. I am equally puzzled by a similar failure I get when implementing <code>compare</code> instead, and even more puzzled by the failure I get when trying the (seemingly simple)</p>\n\n<pre><code>singletons [d| data Nat = Z | S Nat deriving (Eq,Ord) |]\n</code></pre>\n\n<p>My guess is that something in <code>Ord</code> is off... However, this works. I'm gonna try to take a look at the guts of <code>singleton</code> later.</p>\n\n<pre><code>singletons [d|\n              data Nat = Z | S Nat\n                 deriving (Eq)\n\n              instance Ord Nat where\n                compare = compare'\n\n              compare' :: Nat -&gt; Nat -&gt; Ordering\n              compare' Z Z  = EQ\n              compare' (S _) Z = GT\n              compare' Z (S _) = LT\n              compare' (S n) (S m) = compare' n m\n             |] \n</code></pre>\n\n<p>By the way, I'm using GHC 8.0 here.</p>\n\n<h1>EDIT</h1>\n\n<p>After poking around in <code>singletons</code>, I've found the real source of problems (and been blown away with how much type-level hackery is possible). Using <code>-ddump-splices</code> from GHC I was able to get the actual Haskell code generated (for the initial code in your question). The offending parts were</p>\n\n<pre><code>instance PEq (Proxy :: Proxy Nat_a7Vb) where\n  type (:==) (a_a8Rs :: Nat_a7Vb) (b_a8Rt :: Nat_a7Vb) = Equals_1627424016_a8Rr a_a8Rs b_a8Rt\n</code></pre>\n\n<p>and</p>\n\n<pre><code>instance POrd (Proxy :: Proxy Nat_a7Vb) where\n  type (:&lt;=) (a_aa9e :: Nat_a7Vb) (a_aa9f :: Nat_a7Vb) = Apply (Apply TFHelper_1627428966Sym0 a_aa9e) a_aa9f\n</code></pre>\n\n<p>Compiling the code generated, I received the slightly more useful error message for both of these</p>\n\n<pre><code>Expecting one more argument to \u2018Proxy\u2019\nExpected kind \u2018Proxy Nat_a7Vb\u2019, but \u2018Proxy\u2019 has kind \u2018k0 -&gt; *\u2019\n</code></pre>\n\n<p>pertaining to the <code>(Proxy :: Proxy Nat_a7Vb)</code> in the <code>PEq</code> and <code>POrd</code> classes. That won't compile without <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/kind-polymorphism.html\" rel=\"nofollow\"><code>-XPolyKinds</code></a>. Checked the repo for <code>singletons</code> and indeed it tells you that you need <code>-XTypeInType</code> enabled, which in turn enables <code>-XPolyKinds</code>.</p>\n\n<p>So, there is no bug, you just need to add either <code>PolyKinds</code> or <code>TypeInType</code> (I recommend the latter, since that is what the package recommends...) to your <code>LANGUAGE</code> pragmas to get everything to work.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471457222, "post_id": 39003151, "comment_id": 65358590, "body": "The confounding thing here is that the same applies to <code>Eq</code>, yet that problem never arises with <code>singleton</code>!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471457474, "post_id": 39003151, "comment_id": 65358736, "body": "@Alec It does. You can&#39;t write <code>Sy Zy == Zy</code>, even with the help of <code>singletons</code>. It&#39;s a perfectly reasonable question, but <code>==</code> doesn&#39;t know how to answer it."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471457724, "post_id": 39003151, "comment_id": 65358878, "body": "I meant my comment as a reply to your comment about <code>Ord</code> being difficult - yet <code>singletons [d| data Nat = Z | S Nat deriving (Eq) ]</code> doesn&#39;t choke up like <code>singletons [d| data Nat = Z | S Nat deriving (Eq,Ord) ]</code> does. Although checking it now, it appears that I can&#39;t write the <code>Eq</code> instance I&#39;d like to manually (I have to use the same trick from my answer)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471457783, "post_id": 39003151, "comment_id": 65358915, "body": "@Alec You can write the instance for <code>Nat</code> (and indeed for <code>Natty n</code>) but my point is that it&#39;s not useful."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471457938, "post_id": 39003151, "comment_id": 65359005, "body": "Oh sure, it may not be useful. That concerns me less at the moment, but you are right! :)"}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471504127, "post_id": 39003151, "comment_id": 65375020, "body": "@BenjaminHodgson Thanks, this is a good answer and I have a lot to learn. I am actually trying to use the type-level <code>(&lt;=)</code> or perhaps <code>Max</code> as a constraint (resp. type function) in the definition of a data type (e.g. I&#39;d like to define an integer list that keeps track of its maximum element). It&#39;s not apparent how <code>data LE</code> or <code>le</code> could be used like that? Anyway, while yours is a good anwer, I think I have to have accept Alec&#39;s since it specifically addresses the problem in the question."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 2, "creation_date": 1471513506, "post_id": 39003151, "comment_id": 65380433, "body": "@denormal One of the valuable pieces of advice in <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Pivotal.pdf\" rel=\"nofollow noreferrer\"><i>How to Keep Your Neighbours in Order</i></a> is to avoid using types to <i>measure</i> values from the inside out and instead see them as <i>constraints</i> pushed in from the outside. What are you using your bounded list for? Rather than &quot;a list whose maximum value is precisely <code>n</code>&quot; would the slightly looser type <code>[Fin n]</code> (a list of numbers bounded by <code>n</code>) do the job?"}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471513882, "post_id": 39003151, "comment_id": 65380660, "body": "Actually, that&#39;s exactly what I am after. :)"}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1471514885, "post_id": 39003151, "comment_id": 65381303, "body": "Thank you very much, I didn&#39;t know there was a standard way to define this."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1471466514, "last_edit_date": 1495540849, "creation_date": 1471455871, "answer_id": 39003151, "question_id": 39002342, "link": "https://stackoverflow.com/questions/39002342/adding-an-ord-instance-to-singleton-package-generated-naturals/39003151#39003151", "title": "Adding an Ord instance to &#39;singleton&#39; package generated naturals", "body": "<p>Working with lifted Boolean relations <a href=\"https://stackoverflow.com/questions/33270639/so-whats-the-point\">is</a> <a href=\"https://stackoverflow.com/questions/37923470/is-there-any-connection-between-a-b-and-a-b-true/37925725#37925725\">never</a> <a href=\"https://stackoverflow.com/questions/38290067/idiomatic-boolean-equality-usage-singletons/38293546#38293546\">comfortable</a>. Booleans erase the very information you're interested in learning, leaving you in the lurch when you want to do anything with the result of your test. Just say no, kids.</p>\n\n<p>There's a better way. \"<code>n</code> is less-than-or-equal to <code>m</code>\" is a <em>proposition</em> which can be <em>proved</em> with information-rich <em>evidence</em>. One way of proving that one number is less than another is by giving (a singleton representation of) their difference:</p>\n\n<pre><code>data LE n m where\n    LE :: Natty z -&gt; LE n (n :+ z)\n</code></pre>\n\n<p>We can come up with a procedure for testing whether a given number is less than another. <code>le</code> attempts to subtract <code>n</code> from <code>m</code>, and either fails and returns <code>Nothing</code> or produces their difference, as a <code>Natty</code>, and a proof that the subtraction is correct, packed up in the <code>LE</code> constructor.</p>\n\n<pre><code>le :: Natty n -&gt; Natty m -&gt; Maybe (LE n m)\nle Zy m = Just (LE m)\nle (Sy n) (Sy m) = fmap (\\(LE z) -&gt; LE z) (le n m)\nle _ _ = Nothing\n</code></pre>\n\n<p>This idea can be generalised to give us a \"strongly-typed <code>compare</code>\". When comparing two numbers, you'll either learn that they're equal, or that one is less than the other. (<code>Either (LE n m) (LE m n)</code> also does the job, but this version is slightly more precise.)</p>\n\n<pre><code>data Compare n m where\n    LT :: Natty z -&gt; Compare n (n :+ S z)\n    EQ :: Compare n n\n    GT :: Natty z -&gt; Compare (m :+ S z) m\n\ncompare :: Natty n -&gt; Natty m -&gt; Compare n m\ncompare Zy Zy = EQ\ncompare Zy (Sy m) = LT m\ncompare (Sy n) Zy = GT n\ncompare (Sy n) (Sy m) = case compare n m of\n    LT z -&gt; LT z\n    EQ -&gt; EQ\n    GT z -&gt; GT z\n</code></pre>\n\n<p>(I lifted this from <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\"><em>Hasochism</em></a>.)</p>\n\n<p>Note that, unlike <code>le</code>, <code>compare</code> is total. It'll <em>always</em> give you a result: every number is either less than, equal to, or greater than every other number. Our goal was to write a procedure to test which of two numbers was smaller, but we also found ourselves proving that numbers are <a href=\"https://en.wikipedia.org/wiki/Total_order\" rel=\"nofollow noreferrer\">totally ordered</a>, and writing a type-safe subtraction routine, all in the same function.</p>\n\n<p>Another way of looking at <code>compare</code> is as a <em>view</em> over pairs of natural numbers. When you compare two numbers, you learn which one was less and by how much, refining your knowledge of the numbers themselves. Agda's dot-patterns have good support for this notion of refinement:</p>\n\n<pre><code>compare : (n m : Nat) -&gt; Compare n m\ncompare zero zero = eq\ncompare zero (suc m) = lt m\ncompare (suc n) zero = gt n\ncompare (suc n)            (suc m)           with compare n m\n                        -- see how matching on `lt` refines `m` to `n + suc z`\ncompare (suc n)            (suc .(n + suc z)) | lt z = lt z\ncompare (suc m)            (suc .m)           | eq = eq\n     -- likewise matching on `gt` refines `n` to `m + suc z`\ncompare (suc .(m + suc z)) (suc m)            | gt z = gt z\n</code></pre>\n\n<hr>\n\n<p>Anyway, I can't speak to the source of your <code>singletons</code> bug directly, but one reason <code>Ord</code> is kinda difficult to work with for singleton values is that it assumes you're comparing values of the same type:</p>\n\n<pre><code>class Ord a where\n    compare :: a -&gt; a -&gt; Ordering\n</code></pre>\n\n<p>When you're comparing two singletons, they generally won't have the same type! That's the whole point of singletons: their type reflects their value directly. If you have two <code>Natty n</code> values (whose <code>n</code>s match) there's not much point in comparing them, since you already know they're equal; and if they're not equal you can't compare them!</p>\n\n<p>It's eminently reasonable that classes like <code>Ord</code>, which were designed in the simply-typed world, won't necessarily be all that useful in dependently-typed programs. If you're using dependent types, the right way to do it is not to abuse the old tools. Usher in this new world of safe, information-rich programming with open arms!</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 39003001, "answer_count": 2, "score": 3, "last_activity_date": 1471554566, "creation_date": 1471452936, "question_id": 39002342, "link": "https://stackoverflow.com/questions/39002342/adding-an-ord-instance-to-singleton-package-generated-naturals", "title": "Adding an Ord instance to &#39;singleton&#39; package generated naturals", "body": "<p>I am using very simple type-level naturals generated with the singletons package. I am now trying to add an Ord instance to them.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TemplateHaskell, KindSignatures, DataKinds, ScopedTypeVariables, GADTs, TypeFamilies, FlexibleInstances, TypeOperators, UndecidableInstances, InstanceSigs #-}\n\nmodule Functions where\n\nimport Data.Singletons\nimport Data.Singletons.TH\nimport Data.Singletons.Prelude\nimport Data.Promotion.Prelude\n\nsingletons [d|\n             data Nat = Z | S Nat\n               deriving Eq\n\n             instance Ord Nat where\n               (&lt;=)    Z     _  = True\n               (&lt;=) (S _)    Z  = False\n               (&lt;=) (S n) (S m) = n &lt;= m\n             |]\n</code></pre>\n\n<p>I have been hitting one error after the other. The latest one is:</p>\n\n<pre><code>src/Functions.hs:10:1:\n    Couldn't match kind \u2018Nat\u2019 with \u2018*\u2019\n    When matching types\n      n0 :: Nat\n      t1 :: *\n    Expected type: Sing t1\n      Actual type: Sing n0\n    Relevant bindings include\n      n_a9na :: Sing n0 (bound at src/Functions.hs:10:1)\n      lambda :: Sing n0 -&gt; Sing m0 -&gt; Sing (Apply (Apply (:&lt;=$) t00) t10)\n        (bound at src/Functions.hs:10:1)\n    In the second argument of \u2018applySing\u2019, namely \u2018n_a9na\u2019\n    In the first argument of \u2018applySing\u2019, namely\n      \u2018applySing (singFun2 (Proxy :: Proxy (:&lt;=$)) (%:&lt;=)) n_a9na\u2019\n\nsrc/Functions.hs:10:1:\n    Could not deduce (SOrd 'KProxy) arising from a use of \u2018%:&lt;=\u2019\n    from the context (t00 ~ 'S n)\n      bound by a pattern with constructor\n                 SS :: forall (z_a9mg :: Nat) (n_a9mh :: Nat).\n                       (z_a9mg ~ 'S n_a9mh) =&gt;\n                       Sing n_a9mh -&gt; Sing z_a9mg,\n               in an equation for \u2018%:&lt;=\u2019\n      at src/Functions.hs:(10,1)-(18,15)\n    or from (t10 ~ 'S n1)\n      bound by a pattern with constructor\n                 SS :: forall (z_a9mg :: Nat) (n_a9mh :: Nat).\n                       (z_a9mg ~ 'S n_a9mh) =&gt;\n                       Sing n_a9mh -&gt; Sing z_a9mg,\n               in an equation for \u2018%:&lt;=\u2019\n      at src/Functions.hs:(10,1)-(18,15)\n    or from (t00 ~ Apply SSym0 n0, t10 ~ Apply SSym0 m0)\n      bound by the type signature for\n                 lambda_a9n9 :: (t00 ~ Apply SSym0 n0, t10 ~ Apply SSym0 m0) =&gt;\n                                Sing n0 -&gt; Sing m0 -&gt; Sing (Apply (Apply (:&lt;=$) t00) t10)\n      at src/Functions.hs:(10,1)-(18,15)\n    In the second argument of \u2018singFun2\u2019, namely \u2018(%:&lt;=)\u2019\n    In the first argument of \u2018applySing\u2019, namely\n      \u2018singFun2 (Proxy :: Proxy (:&lt;=$)) (%:&lt;=)\u2019\n    In the first argument of \u2018applySing\u2019, namely\n      \u2018applySing (singFun2 (Proxy :: Proxy (:&lt;=$)) (%:&lt;=)) n_a9na\u2019\n</code></pre>\n\n<p>Does anyone have an idea what the correct way to do this is?</p>\n"}, {"tags": ["haskell", "esqueleto", "haskell-persistent"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471457041, "post_id": 38999557, "comment_id": 65358492, "body": "Oddly enough, persistent&#39;s <code>deleteCascade</code> is re-exported via Database.Esqueleto but <code>deleteCascadeWhere</code> is not. Can you just use persistent&#39;s deleteCascade / deleteCascadeWith?"}, {"owner": {"reputation": 293, "user_id": 1685973, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/962f0817c36a6dab53fb76c6a9fa78df?s=128&d=identicon&r=PG", "display_name": "gueux", "link": "https://stackoverflow.com/users/1685973/gueux"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471543533, "post_id": 38999557, "comment_id": 65400358, "body": "I asked the question on esqueleto&#39;s bugtracker: <a href=\"https://github.com/prowdsponsor/esqueleto/issues/147\" rel=\"nofollow noreferrer\">github.com/prowdsponsor/esqueleto/issues/147</a>"}], "owner": {"reputation": 293, "user_id": 1685973, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/962f0817c36a6dab53fb76c6a9fa78df?s=128&d=identicon&r=PG", "display_name": "gueux", "link": "https://stackoverflow.com/users/1685973/gueux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471444388, "creation_date": 1471444388, "question_id": 38999557, "link": "https://stackoverflow.com/questions/38999557/is-it-possible-to-use-deletecascade-with-esqueleto", "title": "Is it possible to use deleteCascade with esqueleto?", "body": "<p>I did not found any mentions of deleteCascade and deleteCascadeWhere in esqueleto... Is there an esqueleto equivalent to these functions?</p>\n"}, {"tags": ["list", "haskell", "evaluation"], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1471439946, "post_id": 38995393, "comment_id": 65347261, "body": "It might be worth adding that the first problem goes away if you do <code>:set -XMonomorphismRestriction</code>. Some examples of the use of <code>:sprint</code>, e.g. in the <i>Parallel and Concurrent Haskell</i> book, predate the default use <code>-XNoMonomorphismRestriction</code> inside ghci, and so give rise to this trouble. You should probably always turn it off, or be unrelenting with signatures, before fiddling with <code>:sprint</code>"}, {"owner": {"reputation": 514, "user_id": 1375259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yuWQ9.jpg?s=128&g=1", "display_name": "Chakravarthy Raghunandan", "link": "https://stackoverflow.com/users/1375259/chakravarthy-raghunandan"}, "edited": false, "score": 0, "creation_date": 1471441506, "post_id": 38995393, "comment_id": 65348488, "body": "duly noted. Thanks for the tip."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 6, "last_activity_date": 1471433341, "creation_date": 1471433341, "answer_id": 38995393, "question_id": 38994718, "link": "https://stackoverflow.com/questions/38994718/understanding-how-sprint-and-list-evaluation-works-in-haskell/38995393#38995393", "title": "Understanding how :sprint and list evaluation works in haskell", "body": "<p>The behavior of <code>:sprint</code> can be a little tricky. In this case, look at the type of <code>x</code>:</p>\n\n<pre><code>&gt; :t x\nx :: Num t =&gt; [t]\n</code></pre>\n\n<p>Because it's polymorphic, the actual values that get produced depend on the specific instance of <code>Num</code> that you require. Thus, <code>x</code> behaves more like a function that will produce the list <code>[1,2,3,4,5]</code> when it can figure out just what type you want the elements to have.</p>\n\n<p>Now you might think, \"ok, I'll make a list that isn't polymorphic\", so you try this:</p>\n\n<pre><code>&gt; let x = [1,2,3,4,5 :: Int]\n&gt; :t x\nx :: [Int]\n&gt; :sprint x\nx = [1,2,3,4,5]\n</code></pre>\n\n<p>What the heck? If you think about it, this makes sense. We've told ghci explicitly what the list is. It's not like it can unevaluate it and then reevaluate it later. (This would be wasteful anyway.) But let's see what happens when we try to map a function over x:</p>\n\n<pre><code>&gt; let y = map (+1) x\n&gt; :sprint y\ny = _\n&gt; take 1 y\n[2]\n&gt; :sprint y\ny = 2 : _\n</code></pre>\n\n<p>Just as expected!</p>\n\n<p>Hope that helps. Lazy evaluation is one of the trickier things about Haskell (when it becomes important).</p>\n"}], "owner": {"reputation": 514, "user_id": 1375259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yuWQ9.jpg?s=128&g=1", "display_name": "Chakravarthy Raghunandan", "link": "https://stackoverflow.com/users/1375259/chakravarthy-raghunandan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 2, "accepted_answer_id": 38995393, "answer_count": 1, "score": 3, "last_activity_date": 1471433341, "creation_date": 1471431460, "last_edit_date": 1471433241, "question_id": 38994718, "link": "https://stackoverflow.com/questions/38994718/understanding-how-sprint-and-list-evaluation-works-in-haskell", "title": "Understanding how :sprint and list evaluation works in haskell", "body": "<p>I'm working through <a href=\"http://haskellbook.com/\" rel=\"nofollow\">haskell book</a> and I understood that <code>:sprint x</code> is used to print the elements of x has been evaluated and the elements has been not(the ones which aren't are expressed by an '_'). </p>\n\n<p>One of the examples provided in the book, </p>\n\n<pre><code>Prelude&gt; let blah = enumFromTo 'a' 'z' \nPrelude&gt; :sprint blah \nblah = _\n\nPrelude&gt; take 1 blah \n\"a\" \nPrelude&gt; :sprint blah \nblah = 'a' : _\n</code></pre>\n\n<p>To test out with different input i did this in GHCi:-</p>\n\n<pre><code>prelude&gt; let b = [1,2,3,4,5]\nprelude&gt; :sprint b\nb = _\nprelude&gt; take 1 b\n[1]\nprelude&gt; :sprint b\nb = _\n</code></pre>\n\n<p>Shouldn't the output of <code>:sprint b</code> in the last command be <code>b = 1 : _</code> since we are only evaluating a single list item and a cons operator when using the command <code>take 1 b</code> ?? But it's showing the output above. How and why is this happening ? Shouldn't the output be similar to the output of String type? </p>\n\n<p>Edit: I've been experimenting more and got this result :-</p>\n\n<pre><code>prelude&gt; let b = [1..10] :: [Int]\nprelude&gt; :sprint b\nb = _\nprelude&gt; take 3 b\n[1,2,3]\nprelude&gt; :sprint b\nb = 1 : 2 : 3 : _\n</code></pre>\n\n<p>Okay, my initial guess is, it's because of the way I'm constructing the two lists ? One is using ranges and the other by explicitly stating its elements (which in turns creates the list by using the cons ':' constructor recursively on its elements)</p>\n"}, {"tags": ["haskell", "effect-systems"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471454482, "post_id": 38999214, "comment_id": 65357128, "body": "Your answer to 3 is not actually the reason this particular example fails (although this is a very complete explanation of another common pitfall) - in this case, e.g. <code>\\x -&gt; fromJust &lt;$&gt; findMacro x</code> type checks without any additional annotations, while e.g. <code>\\x -&gt; const True &lt;$&gt; findMacro x</code> does not - the issue is that in the OPs example, the return value (<code>Bool</code>) does not mention the type variables, making them (by definition) amgiuous. In MTL, there is a fundep, so the tyvars are not ambiguous even then (i.e. <code>const True &lt;$&gt; get</code> is fine) but this is not possible with freer."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471456532, "post_id": 38999214, "comment_id": 65358231, "body": "@user2407038 I don&#39;t think so. <code>macroexpand2</code> fails before the ambiguity check, and we have <code>Eff r Bool</code> return type, and all the constraints can be potentially computed from <code>r</code>, so there&#39;s no immediate ambiguity."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471457796, "post_id": 38999214, "comment_id": 65358924, "body": "@user2407038  here&#39;s a <a href=\"http://lpaste.net/177990\" rel=\"nofollow noreferrer\">small example</a> with a similar error message as in the OP."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1471459556, "post_id": 38999214, "comment_id": 65359917, "body": "Your example requires <code>AllowAmbiguousTypes</code>, because the type <code>a</code> is indeed ambiguous. This extension also fixes the OPs example - but of course <code>foo</code> is never usable without a monomorphic inferred type, or a type application or type signature indicating the polymorphic type. And the error in the OP properly states that the issue is ambiguous type variables (&quot;The type variables <code>v0&#39;, </code>w0&#39; are ambiguous&quot;) although this is buried deep in a bunch of incomprehensible type signatures."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471460720, "post_id": 38999214, "comment_id": 65360524, "body": "You&#39;re right about <code>AllowAmbiguousTypes</code>; my ghci.conf has it and <code>TypeApplications</code> enabled by default, so it seems I have forgot about it. I&#39;ll note this in the answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471468913, "post_id": 38999214, "comment_id": 65364612, "body": "What GHC 8 features allow repair? Couldn&#39;t we always use <code>Proxy</code> to work around ambiguity problems?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1471471140, "post_id": 38999214, "comment_id": 65365523, "body": "@dfeuer <code>TypeInType</code> gives us full access to type structure so we can implement our own structural (dis)unification that works generically on all types. See <a href=\"https://github.com/AndrasKovacs/misc-stuff/blob/master/haskell/EffInference.hs#L58\" rel=\"nofollow noreferrer\">this part</a>. <code>Proxy</code> isn&#39;t relevant; the issue is not ambiguity but plain lack of unification. Before GHC 8 it wasn&#39;t possible by any means to generally and boilerplate-freely solve the issue I explain in my answer."}, {"owner": {"reputation": 173, "user_id": 828125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f357466ed335948a574ddc01da869cdd?s=128&d=identicon&r=PG", "display_name": "jjl", "link": "https://stackoverflow.com/users/828125/jjl"}, "edited": false, "score": 1, "creation_date": 1471611310, "post_id": 38999214, "comment_id": 65428665, "body": "I&#39;ve read over this a few times and I think it&#39;s starting to make sense. Thanks for just an outright amazing answer!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471806164, "post_id": 38999214, "comment_id": 65483846, "body": "I need to read more of this. If you decide to package it up for real, I suggest you separate the effect stuff from the free monad stuff. Your <code>Eff</code> could be written <code>newtype Eff fs a = Eff (Free (NS fs) a)</code>. This works for any free monad implementation, so I think you could probably even write <code>newtype Eff free fs a = Eff (free (NS fs) a)</code> with <code>instance Monad (free (NS fs)) =&gt; Monad (Eff free fs)</code> and <code>instance MonadFree (NS fs) (free (NS fs)) =&gt; MonadFree (NS fs) (Eff free fs)</code>. This separates the free monad implementation concerns (with, e.g., type-aligned sequences) from the effect system."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471806217, "post_id": 38999214, "comment_id": 65483863, "body": "The strong connection between free monad and effect system in the <code>extensible-effects</code> package is one of its biggest warts, IMO."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471827342, "post_id": 38999214, "comment_id": 65488663, "body": "Er... Sorry, I meant <code>freer</code>. <code>extensible-effects</code> annoys me by using a type-aligned sequence prematurely specialized to Kleisli categories."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 18, "last_activity_date": 1471827524, "last_edit_date": 1471827524, "creation_date": 1471443404, "answer_id": 38999214, "question_id": 38993017, "link": "https://stackoverflow.com/questions/38993017/how-do-i-compose-freer-effects-in-haskell/38999214#38999214", "title": "How do I compose &#39;freer&#39; effects in haskell?", "body": "<p>Type inference for extensible effects has been historically bad. Let's see some examples:</p>\n\n<pre><code>{-# language TypeApplications #-}\n\n-- mtl\nimport qualified Control.Monad.State as M\n\n-- freer\nimport qualified Control.Monad.Freer as F\nimport qualified Control.Monad.Freer.State as F\n\n-- mtl works as usual\ntest1 = M.runState M.get 0\n\n-- this doesn't check\ntest2 = F.run $ F.runState F.get 0  \n\n-- this doesn't check either, although we have a known\n-- monomorphic state type\ntest3 = F.run $ F.runState F.get True\n\n-- this finally checks\ntest4 = F.run $ F.runState (F.get @Bool) True\n\n-- (the same without TypeApplication)\ntest5 = F.run $ F.runState (F.get :: F.Eff '[F.State Bool] Bool) True\n</code></pre>\n\n<p>I'll try to explain the general issue and provide minimal code illustration. A self-contained version of the code can be <a href=\"http://lpaste.net/177930\" rel=\"noreferrer\">found here</a>.</p>\n\n<p>On the most basic level (disregarding optimized representations), <code>Eff</code> is defined the following way:</p>\n\n<pre><code>{-# language\n  GADTs, DataKinds, TypeOperators, RankNTypes, ScopedTypeVariables,\n  TypeFamilies, DeriveFunctor, EmptyCase, TypeApplications,\n  UndecidableInstances, StandaloneDeriving, ConstraintKinds,\n  MultiParamTypeClasses, FlexibleInstances, FlexibleContexts,\n  AllowAmbiguousTypes, PolyKinds\n  #-}\n\nimport Control.Monad\n\ndata Union (fs :: [* -&gt; *]) (a :: *) where\n  Here  :: f a -&gt; Union (f ': fs) a\n  There :: Union fs a -&gt; Union (f ': fs) a\n\ndata Eff (fs :: [* -&gt; *]) (a :: *) =\n  Pure a | Free (Union fs (Eff fs a))\n\nderiving instance Functor (Union fs) =&gt; Functor (Eff fs)  \n</code></pre>\n\n<p>In other words, <code>Eff</code> is a free monad from an union of a list of functors. <code>Union fs a</code> behaves like an n-ary <code>Coproduct</code>. The binary <code>Coproduct</code> is like <code>Either</code> for two functors:</p>\n\n<pre><code>data Coproduct f g a = InL (f a) | InR (g a)\n</code></pre>\n\n<p>In contrast, <code>Union fs a</code> lets us choose a functor from a list of functors:</p>\n\n<pre><code>type MyUnion = Union [[], Maybe, (,) Bool] Int\n\n-- choose the first functor, which is []\nmyUnion1 :: MyUnion\nmyUnion1 = Here [0..10]\n\n-- choose the second one, which is Maybe\nmyUnion2 :: MyUnion\nmyUnion2 = There (Here (Just 0))\n\n-- choose the third one\nmyUnion3 :: MyUnion\nmyUnion3 = There (There (Here (False, 0)))\n</code></pre>\n\n<p>Let's implement the <code>State</code> effect as an example. First, we need to have a <code>Functor</code> instance for <code>Union fs</code>, since <code>Eff</code> only has a <code>Monad</code> instance if <code>Functor (Union fs)</code>. </p>\n\n<p><code>Functor (Union '[])</code> is trivial, since the empty union doesn't have values:</p>\n\n<pre><code>instance Functor (Union '[]) where\n  fmap f fs = case fs of {} -- using EmptyCase\n</code></pre>\n\n<p>Otherwise we prepend a functor to the union:</p>\n\n<pre><code>instance (Functor f, Functor (Union fs)) =&gt; Functor (Union (f ': fs)) where\n  fmap f (Here fa) = Here (fmap f fa)\n  fmap f (There u) = There (fmap f u)\n</code></pre>\n\n<p>Now the <code>State</code> definition and the runners:</p>\n\n<pre><code>run :: Eff '[] a -&gt; a\nrun (Pure a) = a\n\ndata State s k = Get (s -&gt; k) | Put s k deriving Functor\n\nrunState :: forall s fs a. Functor (Union fs) =&gt; Eff (State s ': fs) a -&gt; s -&gt; Eff fs (a, s)\nrunState (Pure a)                 s = Pure (a, s)\nrunState (Free (Here (Get k)))    s = runState (k s) s\nrunState (Free (Here (Put s' k))) s = runState k s'\nrunState (Free (There u))         s = Free (fmap (`runState` s) u)\n</code></pre>\n\n<p>We can already start writing and running our <code>Eff</code> programs, although we lack all the sugar and convenience:</p>\n\n<pre><code>action1 :: Eff '[State Int] Int\naction1 =\n  Free $ Here $ Get $ \\s -&gt;\n  Free $ Here $ Put (s + 10) $\n  Pure s\n\n-- multiple state\naction2 :: Eff '[State Int, State Bool] ()\naction2 =\n  Free $ Here $ Get $ \\n -&gt;            -- pick the first effect\n  Free $ There $ Here $ Get $ \\b -&gt;    -- pick the second effect\n  Free $ There $ Here $ Put (n &lt; 10) $ -- the second again\n  Pure ()\n</code></pre>\n\n<p>Now:</p>\n\n<pre><code>&gt; run $ runState action1 0\n(0,10)\n&gt; run $ (`runState` False) $ (`runState` 0) action2\n(((),0),True)\n</code></pre>\n\n<p>There are only two essential missing things here. </p>\n\n<p>The first one is the monad instance for <code>Eff</code> which lets us use <code>do</code>-notation instead of <code>Free</code> and <code>Pure</code>, and also lets us use the many polymorphic monadic functions. We shall skip it here because it's straightforward to write.</p>\n\n<p>The second one is inference/overloading for choosing effects from lists of effects. Previously we needed to write <code>Here x</code> in order to choose the first effect, <code>There (Here x)</code> to choose the second one, and so on. Instead, we'd like to write code that's polymorphic in effect lists, so all we have to specify is that some effect is an element of a list, and some hidden typeclass magic will insert the appropriate number of <code>There</code>-s.</p>\n\n<p>We need a <code>Member f fs</code> class that can inject <code>f a</code>-s into <code>Union fs a</code>-s when <code>f</code> is an element of <code>fs</code>. Historically, people have implemented it in two ways. </p>\n\n<p>First, directly with <code>OverlappingInstances</code>:</p>\n\n<pre><code>class Member (f :: * -&gt;  *) (fs :: [* -&gt; *]) where\n  inj :: f a -&gt; Union fs a\n\ninstance Member f (f ': fs) where\n  inj = Here\n\ninstance {-# overlaps #-} Member f fs =&gt; Member f (g ': fs) where\n  inj = There . inj\n\n-- it works\ninjTest1 :: Union [[], Maybe, (,) Bool] Int\ninjTest1 = inj [0]\n\ninjTest2 :: Union [[], Maybe, (,) Bool] Int\ninjTest2 = inj (Just 0)\n</code></pre>\n\n<p>Second, indirectly, by first computing the index of <code>f</code> in <code>fs</code> with a type family, then implementing <code>inj</code> with a non-overlapping class, guided by <code>f</code>-s computed index. This is generally viewed as better because people tend to dislike overlapping instances.</p>\n\n<pre><code>data Nat = Z | S Nat\n\ntype family Lookup f fs where\n  Lookup f (f ': fs) = Z\n  Lookup f (g ': fs) = S (Lookup f fs)\n\nclass Member' (n :: Nat) (f :: * -&gt; *) (fs :: [* -&gt; *]) where\n  inj' :: f a -&gt; Union fs a\n\ninstance fs ~ (f ': gs) =&gt; Member' Z f fs where\n  inj' = Here\n\ninstance (Member' n f gs, fs ~ (g ': gs)) =&gt; Member' (S n) f fs where\n  inj' = There . inj' @n\n\ntype Member f fs = Member' (Lookup f fs) f fs\n\ninj :: forall fs f a. Member f fs =&gt; f a -&gt; Union fs a\ninj = inj' @(Lookup f fs)\n\n-- yay\ninjTest1 :: Union [[], Maybe, (,) Bool] Int\ninjTest1 = inj [0]\n</code></pre>\n\n<p>The <code>freer</code> library uses the second solution, while <code>extensible-effects</code> uses the first one for GHC versions older than 7.8, and the second for newer GHC-s.</p>\n\n<p>Anyway, both solutions have the same inference limitation, namely that we can almost always <code>Lookup</code> only concrete monomorphic types, not types that contain type variables. Examples in ghci:</p>\n\n<pre><code>&gt; :kind! Lookup Maybe [Maybe, []]\nLookup Maybe [Maybe, []] :: Nat\n= 'Z\n</code></pre>\n\n<p>This works because there are no type variables in either <code>Maybe</code> or <code>[Maybe, []]</code>.</p>\n\n<pre><code>&gt; :kind! forall a. Lookup (Either a) [Either Int, Maybe]\nforall a. Lookup (Either a) [Either Int, Maybe] :: Nat\n= Lookup (Either a) '[Either Int, Maybe]\n</code></pre>\n\n<p>This one gets stuck because the <code>a</code> type variable blocks reduction.</p>\n\n<pre><code>&gt; :kind! forall a. Lookup (Maybe a) '[Maybe a]\nforall a. Lookup (Maybe a) '[Maybe a] :: Nat\n= Z\n</code></pre>\n\n<p>This works, because the only thing we know about arbitrary type variables is that they are equal to themselves, and <code>a</code> is equal to <code>a</code>.</p>\n\n<p>In general, type family reduction gets stuck on variables, because constraint solving can potentially refine them later to different types, so GHC can't make any assumptions about them (aside from being equal to themselves). Essentially the same issue arises with the <code>OverlappingInstances</code> implementation (although there aren't any type families).</p>\n\n<p>Let's revisit <code>freer</code> in the light of this. </p>\n\n<pre><code>import Control.Monad.Freer\nimport Control.Monad.Freer.State\n\ntest1 = run $ runState get 0 -- error\n</code></pre>\n\n<p>GHC knows that we have a stack with a single effect, since <code>run</code> works on <code>Eff '[] a</code>. It also knows that that effect must be <code>State s</code>. But when we write <code>get</code>, GHC only knows that it has a <code>State t</code> effect for some fresh <code>t</code> variable, and that <code>Num t</code> must hold, so when it tries to compute the <code>freer</code> equivalent of <code>Lookup (State t) '[State s]</code>, it gets stuck on the type variables, and any further instance resolution trips up on the stuck type family expression. Another example:</p>\n\n<pre><code>foo = run $ runState get False -- error\n</code></pre>\n\n<p>This also fails because GHC needs to compute <code>Lookup (State s) '[State Bool]</code>, and although we know that the state must be <code>Bool</code>, this still gets stuck because of the <code>s</code> variable. </p>\n\n<pre><code>foo = run $ runState (modify not) False -- this works\n</code></pre>\n\n<p>This works because the state type of <code>modify not</code> can be resolved to <code>Bool</code>, and <code>Lookup (State Bool) '[State Bool]</code> reduces. </p>\n\n<p>Now, after this large detour, I shall address your questions at the end of your post.</p>\n\n<ol>\n<li><p><code>Overlapping instances</code> is not indicative of any possible solution, just a type error artifact. I would need more code context to pinpoint how exactly it arises, but I'm sure it's not relevant, since as soon as <code>Lookup</code> gets stuck the case becomes hopeless.</p></li>\n<li><p><code>IncoherentInstances</code> is also irrelevant and doesn't help. We need a concrete effect position index to be able to generate code for the program, and we can't pull an index out of thin air if <code>Lookup</code> gets stuck.</p></li>\n<li><p>The problem with <code>findMacro</code> is that it has <code>State</code> effects with type variables inside the states. Whenever you want to use <code>findMacro</code> you have to make sure that the <code>v</code> and <code>w</code> parameters for <code>Scope</code> and <code>Global</code> are known concrete types. You can do this by type annotations, or more conveniently you can use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#visible-type-application\" rel=\"noreferrer\"><code>TypeApplications</code></a>, and write <code>findMacro @Int @Int</code> for specifying <code>v = Int</code> and <code>w = Int</code>. If you have <code>findMacro</code> inside a polymorphic function, you need to enable <code>ScopedTypeVariables</code>, bind <code>v</code> and <code>w</code> using a <code>forall v w.</code> annotation for that function, and write <code>findMacro @v @w</code> when you use it. You also need to enable <code>{-# language AllowAmbiguousTypes #-}</code> for polymorphic <code>v</code> or <code>w</code> (as pointed out in the comments). I think though that in GHC 8 it's a reasonable extension to enable, together with <code>TypeApplications</code>. </p></li>\n</ol>\n\n<hr>\n\n<p>Addendum:</p>\n\n<p>However, fortunately new GHC 8 features let us repair type inference for extensible effects, and we can infer everything <code>mtl</code> can, and also some things <code>mtl</code> can't handle. The new type inference is also invariant with respect to the ordering of effects.</p>\n\n<p>I have a <a href=\"https://github.com/AndrasKovacs/misc-stuff/blob/master/haskell/Eff/EffInference.hs\" rel=\"noreferrer\">minimal implementation here</a> along with a number of examples. However, it's not yet used in any effect library that I know of. I'll probably do a write-up on it, and do a pull request in order to add it to <code>freer</code>.  </p>\n"}], "owner": {"reputation": 173, "user_id": 828125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f357466ed335948a574ddc01da869cdd?s=128&d=identicon&r=PG", "display_name": "jjl", "link": "https://stackoverflow.com/users/828125/jjl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 7, "accepted_answer_id": 38999214, "answer_count": 1, "score": 15, "last_activity_date": 1499051914, "creation_date": 1471426728, "last_edit_date": 1499051914, "question_id": 38993017, "link": "https://stackoverflow.com/questions/38993017/how-do-i-compose-freer-effects-in-haskell", "title": "How do I compose &#39;freer&#39; effects in haskell?", "body": "<p>I'm attempting to rewrite a simple interpreter from a transformers-based monad stack to effects based on freer, but I'm running up against a difficulty communicating my intent to GHC's type system.</p>\n\n<p>I am only using the <code>State</code> and <code>Fresh</code> effects at present. I'm using two states and my effect runner looks like this:</p>\n\n<pre><code>runErlish g ls = run . runGlobal g . runGensym 0 . runLexicals ls\n  where runGlobal    = flip runState\n        runGensym    = flip runFresh'\n        runLexicals  = flip runState\n</code></pre>\n\n<p>On top of this, I have defined a function FindMacro with this type:</p>\n\n<pre><code>findMacro :: Members [State (Global v w), State [Scope v w]] r\n             =&gt; Arr r Text (Maybe (Macro (Term v w) v w))\n</code></pre>\n\n<p>All of this so far works perfectly fine. The problem comes when I try to write <code>macroexpand2</code> (well, macroexpand1, but i'm simplifying it so the question is easier to follow):</p>\n\n<pre><code>macroexpand2 s =\n  do m &lt;- findMacro s\n     return $ case m of\n       Just j -&gt; True\n       Nothing -&gt; False\n</code></pre>\n\n<p>This produces the following error:</p>\n\n<pre><code>Could not deduce (Data.Open.Union.Member'\n                    (State [Scope v0 w0])\n                    r\n                    (Data.Open.Union.FindElem (State [Scope v0 w0]) r))\nfrom the context (Data.Open.Union.Member'\n                    (State [Scope v w])\n                    r\n                    (Data.Open.Union.FindElem (State [Scope v w]) r),\n                  Data.Open.Union.Member'\n                    (State (Global v w))\n                    r\n                    (Data.Open.Union.FindElem (State (Global v w)) r))\n  bound by the inferred type for `macroexpand2':\n             (Data.Open.Union.Member'\n                (State [Scope v w])\n                r\n                (Data.Open.Union.FindElem (State [Scope v w]) r),\n              Data.Open.Union.Member'\n                (State (Global v w))\n                r\n                (Data.Open.Union.FindElem (State (Global v w)) r)) =&gt;\n             Text -&gt; Eff r Bool\n  at /tmp/flycheck408QZt/Erlish.hs:(79,1)-(83,23)\nThe type variables `v0', `w0' are ambiguous\nWhen checking that `macroexpand2' has the inferred type\n  macroexpand2 :: forall (r :: [* -&gt; *]) v (w :: [* -&gt; *]).\n                  (Data.Open.Union.Member'\n                     (State [Scope v w])\n                     r\n                     (Data.Open.Union.FindElem (State [Scope v w]) r),\n                   Data.Open.Union.Member'\n                     (State (Global v w))\n                     r\n                     (Data.Open.Union.FindElem (State (Global v w)) r)) =&gt;\n                  Text -&gt; Eff r Bool\nProbable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>Okay, I can add a <code>Members</code> annotation to the type:</p>\n\n<pre><code>macroexpand2 :: Members [State (Global v w), State [Scope  v w]] r\n                =&gt; Text -&gt; Eff r Bool\n</code></pre>\n\n<p>And now I get this:</p>\n\n<pre><code>Overlapping instances for Member (State [Scope v0 w0]) r\n  arising from a use of `findMacro'\nMatching instances:\n  instance Data.Open.Union.Member'\n             t r (Data.Open.Union.FindElem t r) =&gt;\n           Member t r\n    -- Defined in `Data.Open.Union'\nThere exists a (perhaps superclass) match:\n  from the context (Members\n                      '[State (Global v w), State [Scope v w]] r)\n    bound by the type signature for\n               macroexpand2 :: Members\n                                 '[State (Global v w), State [Scope v w]] r =&gt;\n                               Text -&gt; Eff r Bool\n    at /tmp/flycheck408QnV/Erlish.hs:(79,17)-(80,37)\n(The choice depends on the instantiation of `r, v0, w0'\n To pick the first instance above, use IncoherentInstances\n when compiling the other instance declarations)\nIn a stmt of a 'do' block: m &lt;- findMacro s\nIn the expression:\n  do { m &lt;- findMacro s;\n       return\n       $ case m of {\n           Just j -&gt; True\n           Nothing -&gt; False } }\nIn an equation for `macroexpand2':\n    macroexpand2 s\n      = do { m &lt;- findMacro s;\n             return\n             $ case m of {\n                 Just j -&gt; True\n             Nothing -&gt; False } }\n</code></pre>\n\n<p>I was advised on irc to try <code>forall r v w.</code> which made no difference. Out of curiosity i tried using <code>IncoherentInstances</code> when compiling <em>this</em> code (I did not fancy checking out a fork of freer and playing) to see if perhaps it would give me a clue as to what was going on. It did not:</p>\n\n<pre><code>Could not deduce (Data.Open.Union.Member'\n                    (State [Scope v0 w0])\n                    r\n                    (Data.Open.Union.FindElem (State [Scope v0 w0]) r))\n  arising from a use of `findMacro'\nfrom the context (Members\n                    '[State (Global v w), State [Scope v w]] r)\n  bound by the type signature for\n             macroexpand2 :: Members\n                               '[State (Global v w), State [Scope v w]] r =&gt;\n                             Text -&gt; Eff r Bool\n  at /tmp/flycheck408eru/Erlish.hs:(79,17)-(80,37)\nThe type variables `v0', `w0' are ambiguous\nRelevant bindings include\n  macroexpand2 :: Text -&gt; Eff r Bool\n    (bound at /tmp/flycheck408eru/Erlish.hs:81:1)\nNote: there are several potential instances:\n  instance (r ~ (t' : r'), Data.Open.Union.Member' t r' n) =&gt;\n           Data.Open.Union.Member' t r ('Data.Open.Union.S n)\n    -- Defined in `Data.Open.Union'\n  instance (r ~ (t : r')) =&gt;\n           Data.Open.Union.Member' t r 'Data.Open.Union.Z\n    -- Defined in `Data.Open.Union'\nIn a stmt of a 'do' block: m &lt;- findMacro s\nIn the expression:\n  do { m &lt;- findMacro s;\n       return\n       $ case m of {\n           Just j -&gt; True\n           Nothing -&gt; False } }\nIn an equation for `macroexpand2':\n    macroexpand2 s\n      = do { m &lt;- findMacro s;\n             return\n             $ case m of {\n                 Just j -&gt; True\n                 Nothing -&gt; False } }\n</code></pre>\n\n<p>So, this is where my understanding of freer's internals runs out and I have questions:</p>\n\n<ol>\n<li>Why is there an overlapping instance? I don't understand where that's coming from.</li>\n<li>What does IncoherentInstances <em>actually</em> do? Autoselection sounds pretty likely to cause hard-to-debug errors.</li>\n<li>How do I actually make use of findMacro within another function?</li>\n</ol>\n\n<p>Cheers!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "quickcheck", "state-monad"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1471418168, "post_id": 38990261, "comment_id": 65332655, "body": "I would do it the other way - to store the created <code>Strings</code> - or at least the seeds and compare each seed/generated string for membership in a <code>Set</code> of seeds/<code>String</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1471418234, "post_id": 38990261, "comment_id": 65332695, "body": "another choice could be using uuid&#39;s to generate &quot;most probably&quot; unique strings, if you only have a finite set of strings - you eventually run out of strings, you could work around by making combinations of big base sets - but still you will run into duplicate strings - if you need &quot;real uniqueness&quot; I&#39;d go with a base set + an infinite set like the natural numbers and combine that."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1471418517, "post_id": 38990261, "comment_id": 65332859, "body": "It is important that the strings come from the resource pool. This can be used to generate tests using data existing in some database."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1471421317, "post_id": 38990261, "comment_id": 65334473, "body": "(1) Why must be the generated strings unique? This doesn&#39;t sound like a standard testing use-case. (2) Why do you want to use the <code>Gen</code> monad? Perhaps the <a href=\"https://hackage.haskell.org/package/MonadRandom-0.1.3/docs/Control-Monad-Random.html\" rel=\"nofollow noreferrer\">random monad</a> would work better."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471421730, "post_id": 38990261, "comment_id": 65334731, "body": "Forget about the uniqueness requirement. I just edited my answer. Then we can focus on generating random objects from a resource pool.  About (2). I haven&#39;t consider this yet. But I&#39;m curious on how to combine <code>Gen</code> with <code>StateT</code>.  Besides using <code>Gen</code>,  I can make use of its functions like <code>elements</code>, <code>listOf</code>, etc."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1471460649, "post_id": 38990261, "comment_id": 65360490, "body": "Is <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck.html#v:shuffle\" rel=\"nofollow noreferrer\"><code>shuffle :: [a] -&gt; Gen [a]</code></a> not exactly what you want? What exactly is the purpose of the <code>State</code>? You can get away with just <code>Reader</code> here."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471502708, "post_id": 38990261, "comment_id": 65374295, "body": "This problem arises in a more complex context, where I need to generate random data for objects that have hierarchical dependencies. For instance, if I need to generate an object containing an artist and an album, once I chose the artist, I can only generate albums from that artist."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471503208, "post_id": 39004964, "comment_id": 65374542, "body": "Thanks. The use of <code>lift</code> is definitely more elegant. Regarding the State, as I mentioned in my previous comment, since I need to generate data that has a hierarchical relationship, the choice of one element limits my future choices, and that is the reason why I want to pass the state from one generator to the other. The generation of strings was just illustrative."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471518554, "post_id": 39004964, "comment_id": 65383595, "body": "Beware that <code>Gen</code> doesn&#39;t give you any particular distribution. As it&#39;s used for reading, it tries to catch various corner cases, rather than being uniform in any way."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471520019, "post_id": 39004964, "comment_id": 65384564, "body": "Good point. I definitely need to consider this in the future. It might be that I&#39;ll end up using a <code>Random</code> monad. However I hope I can use the same technique of composing monad transformers."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1471520590, "post_id": 39004964, "comment_id": 65384919, "body": "MonadRandom is actually better, because unlike Gen it also provides a transformer, RandT. So you can compose also the other way around."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 1, "last_activity_date": 1471462754, "creation_date": 1471462754, "answer_id": 39004964, "question_id": 38990261, "link": "https://stackoverflow.com/questions/38990261/generating-random-strings-from-a-string-pool-using-quickcheck/39004964#39004964", "title": "Generating random strings from a string-pool using QuickCheck", "body": "<p>The combination of <code>StateT</code> and <code>Gen</code> could look like this:</p>\n\n<pre><code>import Control.Monad.State\nimport Data.List (delete)\nimport Test.QuickCheck\n\n-- A more efficient solution would be to use Data.Set.\n-- Even better, Data.Trie and ByteStrings:\n-- https://hackage.haskell.org/package/bytestring-trie-0.2.4.1/docs/Data-Trie.html\nnewtype GenState = St { getStrings :: [String] }\n  deriving (Show)\n\nremoveString :: String -&gt; GenState -&gt; GenState\nremoveString str (St xs) = St $ delete str xs\n\nstringGenS :: StateT GenState Gen String\nstringGenS = do\n  s &lt;- get\n  str &lt;- lift $ elements (getStrings s)\n  modify $ removeString str\n  return str\n</code></pre>\n\n<p>The problem is that as you need the state, you can't run multiple such computations in <code>Gen</code> while sharing the state. The only reasonable thing to do would be to generate multiple random unique strings together (using the same state) as</p>\n\n<pre><code>evalStateT (replicateM 10 stringGenS)\n</code></pre>\n\n<p>which is of type <code>GenState -&gt; Gen [String]</code>.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 39004964, "answer_count": 1, "score": 0, "last_activity_date": 1471462754, "creation_date": 1471417910, "last_edit_date": 1471421490, "question_id": 38990261, "link": "https://stackoverflow.com/questions/38990261/generating-random-strings-from-a-string-pool-using-quickcheck", "title": "Generating random strings from a string-pool using QuickCheck", "body": "<p>Consider the problem of generating strings out our a set of possible strings, in such a way that once a string is chosen, it cannot be repeated again. For this task I would like to use <code>QuickCheck</code>'s <code>Gen</code> functions.</p>\n\n<p>If I look at the type of the function I'm trying to write, it looks pretty much like a state monad. Since I'm using another monad, namely <code>Gen</code> , inside the state monad. I wrote my first attempt using <code>StateT</code>.</p>\n\n<pre><code>arbitraryStringS :: StateT GenState Gen String\narbitraryStringS =\n  mapStateT stringGenS get\n</code></pre>\n\n<p>where:</p>\n\n<pre><code>newtype GenState = St {getStrings :: [String]}\n  deriving (Show)\n\nremoveString :: String -&gt; GenState -&gt; GenState\nremoveString str (St xs) = St $ delete str xs\n\nstringGenS ::  Gen (a, GenState) -&gt; Gen (String, GenState)\nstringGenS genStSt =\n  genStSt &gt;&gt;= \\(_, st) -&gt;\n  elements (getStrings st) &gt;&gt;= \\str -&gt;\n  return (str, removeString str st)\n</code></pre>\n\n<p>Something that troubles me about this implementation is the fact that I'm  not using the first element of <code>stringGenS</code>. Secondly, my end goal is to define a random generator for JSON values, that make use of a resource pool (which contains not only strings). Using <code>StateT</code> led me to implement \"stateful\" variants of <code>QuickCheck</code>'s <code>elements</code>, <code>listOf</code>, etc.</p>\n\n<p>I was wondering whether there's a better way of achieving this, or such a complexity is inherent to defining stateful variants of existing monads. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1471415135, "post_id": 38989133, "comment_id": 65331046, "body": "This may help you: <a href=\"https://stackoverflow.com/questions/3254758/memory-footprint-of-haskell-data-types\" title=\"memory footprint of haskell data types\">stackoverflow.com/questions/3254758/&hellip;</a>"}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1471415886, "post_id": 38989133, "comment_id": 65331411, "body": "Thank, I saw that before posting. It makes the interesting point about object sharing when it comes to zero-field constructors, but it doesn&#39;t address what happens when there are more constructors (even zero-field constructors) than can be addressed with 8 bits. This is assuming that&#39;s what the 8-bit header is being used for."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 6, "creation_date": 1471418684, "post_id": 38989133, "comment_id": 65332944, "body": "Ah, but in that answer, a header &quot;word&quot; is definitely at least 32 bits. Of course, the question still stands in principle (e.g., one approach might be to use the first 32 bits merely to narrow the choice down), but if your datatype has 2^32 constructors, you may face other engineering difficulties."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471436948, "post_id": 38989133, "comment_id": 65344820, "body": "The distinction between the various kinds of <code>ManyValues</code> is erased during compilation; you only need the information for as long as it takes to type-check the code. At runtime, each value is just a single word that basically indicates the value exists."}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 1, "creation_date": 1471441358, "post_id": 38989133, "comment_id": 65348375, "body": "Looks as if my question came about by being confused about what a &quot;word&quot; is. Here I was thinking about 8-bit words and wondering &quot;How&#39;s it going to address all those memory locations?&quot;. But yeah, on a 32-bit and 64-bit machine, that &quot;word&quot; would be 32-bit and 64-bit, which was also mentioned in the SO question linked above. So my concern would only be a legit concern once I was also hitting upon pretty fundamental limitations of virtual memory as pigworker said. I should of gotten a good nights sleep before posting this question. :)"}], "answers": [{"comments": [{"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 0, "creation_date": 1471441950, "post_id": 38991492, "comment_id": 65348820, "body": "That makes a lot of sense, so I&#39;m marking this question answered. It turns out the core confusion I had was about what &quot;1 machine word&quot; actually means. But I&#39;ve educated myself on that matter now. Though this does opened up a further question however about memory fragmentation."}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 0, "creation_date": 1471442231, "post_id": 38991492, "comment_id": 65349002, "body": "If nullary constructors are just pointers to shared objects, wouldn&#39;t that mean I could be referencing an object that is very far away in memory from the actual call site (up until GC moves it closer)? And in such a case it would be more efficient to just represent low-level data as just smart-constructed <code>Word32</code> or <code>Word64</code> values in an unboxed linear data structure, giving up space efficiency for lower allocations and better memory locality?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 1, "creation_date": 1471442342, "post_id": 38991492, "comment_id": 65349099, "body": "Why would &quot;being very far away in memory&quot; be a problem? That&#39;s not how memory locality works. All the nullary constructors in the program are in a single contiguous block of memory that never moves. That should be quite cache-friendly."}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 0, "creation_date": 1471442497, "post_id": 38991492, "comment_id": 65349234, "body": "I was not aware they were kept contiguous like that either, great to know."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1471487750, "post_id": 38991492, "comment_id": 65369950, "body": "Worth noting is that the first few (3 or 7 for 32 resp 64 bits) constructors get special treatment.  For those the constructor number is stored in the pointer to the node, saving a memory load."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1471421989, "creation_date": 1471421989, "answer_id": 38991492, "question_id": 38989133, "link": "https://stackoverflow.com/questions/38989133/memory-footprint-of-large-algebraic-data-types/38991492#38991492", "title": "Memory Footprint of Large Algebraic Data Types", "body": "<p>As I understand it, a nullary constructor takes 1 machine word of storage (i.e., it's a pointer to statically allocated data). So whether your data structure has 1 such constructor or 1,000,000, it's still 1 machine word.</p>\n\n<p>Constructors with fields take more space, but GHC special-cases nullary constructors to share a single static singleton between all instances of that value. (E.g., there is only ever one <code>True</code> in the entire program.)</p>\n\n<p>Of course, when a thunk evaluates to an already-existing value (<em>any</em> value), GHC overwrites the thunk with a \"redirection\" node, which takes up some space. Periodically the garbage collector removes the redirections.</p>\n"}], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 38991492, "answer_count": 1, "score": 4, "last_activity_date": 1471421989, "creation_date": 1471413814, "question_id": 38989133, "link": "https://stackoverflow.com/questions/38989133/memory-footprint-of-large-algebraic-data-types", "title": "Memory Footprint of Large Algebraic Data Types", "body": "<p>Say I have an  data type with a <em>lot</em> of constructors.</p>\n\n<pre><code>data ManyValues\n  = Value0\n  | Value1\n  | Value2\n  ...\n  | Value255\n  | Value256\n  deriving (Show,Eq)\n</code></pre>\n\n<p>What's the memory footprint of any one value of this data type? My original understanding was that each constructor is a 8-bit word in memory, but what if there are more constructors in the data type than there are possible values in 8 bits. Does the constructor get bumped up to 16 bits and so on until it can address the full range of constructors present in the data type? Or do I have this all mixed up?</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1471429579, "post_id": 38988536, "comment_id": 65339871, "body": "FWIW, I consider <code>::</code> to actually read more nicely in a top-level signature, as it brings a bit more space between the value level and the type level. <code>not : Bool -&gt; Bool</code> looks a bit like it should be parsed <code>(not : Bool) -&gt; Bool</code>. But many existing infix operators have much the same issue; I suppose it basically just matters what you&#39;re used to."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471439870, "post_id": 38988536, "comment_id": 65347198, "body": "If you pretend that a type annotation is an actual value, <code>::</code> makes a kind of sense. It starts with a <code>:</code> like any other infix constructor, it precedes the &quot;real&quot; symbol for type annotations, and given a name and a type as arguments it returns a type annotation."}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1471488082, "post_id": 38988655, "comment_id": 65370039, "body": "I don&#39;t think it was SPJ and John Hughes who decided this.  Initially it was Phil Wadler&#39;s design (mimicking Miranda and Orwell), and then the Haskell committee kept it.  It was an unfortunate choice."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1471505349, "post_id": 38988655, "comment_id": 65375623, "body": "Yeah, I think it was between SPJ and Wadler. I will probably try to link the video by the weekend."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 9, "last_activity_date": 1471411373, "creation_date": 1471411373, "answer_id": 38988655, "question_id": 38988536, "link": "https://stackoverflow.com/questions/38988536/type-declarations-syntax-difference-between-haskell-and-haskell-like-language/38988655#38988655", "title": "Type declarations syntax difference between haskell and haskell-like language", "body": "<p>I heard SPJ say somewhere that it was a debated issue to choose\nbetween <code>:</code> and <code>::</code>. He and John Hughes finally settled on <code>::</code>. From\nthe <a href=\"http://haskell.cs.yale.edu/wp-content/uploads/2011/02/history.pdf\">A History of Haskell: Being Lazy With\nClass</a> paper:</p>\n\n<blockquote>\n  <p>We adopted from Miranda the convention that data constructors are\n  capitalised while variables are not, and added a similar convention\n  for infix constructors, which in Haskell must start with a colon. The\n  latter convention was chosen for consistency with our use (adopted\n  from SASL, KRC, and Miranda) of a single colon : for the list \u201ccons\u201d\n  operator.  (The choice of \u201c : \u201d for cons and \u201c :: \u201d for type\n  signatures, by the way, was a hotly contested issue (ML does the\n  opposite) and remains controversial to this day.)</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1471431625, "post_id": 38988656, "comment_id": 65341227, "body": "I wouldn&#39;t call it <i>that</i> unfortunate. Reversing them would&#39;ve probably been better, but it&#39;s hardly the end of the world that the haskell notation is slightly different from the common math notation (this is the case in many other places than types as well)."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1471487898, "post_id": 38988656, "comment_id": 65369989, "body": "Your footnote is not entirely accurate."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 12, "last_activity_date": 1471472733, "last_edit_date": 1471472733, "creation_date": 1471411376, "answer_id": 38988656, "question_id": 38988536, "link": "https://stackoverflow.com/questions/38988536/type-declarations-syntax-difference-between-haskell-and-haskell-like-language/38988656#38988656", "title": "Type declarations syntax difference between haskell and haskell-like language", "body": "<p>IIRC the Haskell choice of using <code>::</code> is a bit of an (unfortunate) historical accident. Haskell was based largely off of Miranda, which also uses <code>::</code> for types<sup>1</sup>. The authors of Miranda really wanted the cons operator to be <code>:</code> since they thought it would used much more ubiquitously, so the typing operator had to be delegated to <code>::</code>.</p>\n\n<p>It really hasn't proved to be a good idea since otherwise all the literature (even that which talks about Haskell) on types uses <code>:</code>. As the nearest <a href=\"https://www.seas.upenn.edu/~sweirich/papers/type-app-extended.pdf\" rel=\"nofollow\">paper at hand</a>, the double colon is used for all sample (Haskell) code, yet the mathematical judgements (like on page 10) all follow the traditional single colon.</p>\n\n<hr>\n\n<p><sup>1</sup> I think I remember hearing somewhere (EDIT: it was <a href=\"https://www.youtube.com/watch?v=hIZxTQP1ifo\" rel=\"nofollow\">here</a>, but I'm too lazy to listen to the whole thing to get the right time) that, at the time, a lot of FP research people just wanted to define Miranda very clearly so that research papers talking about lazy-functional-pure languages could have a common language to talk about their ideas. The designers of Miranda didn't want this, but instead said they'd be fine if this was done with another language which could be quite similar to Miranda (provided, for the benefit of both parties, that the two languages still be distinguishable). That was the starting point for the Haskell committee.</p>\n"}], "owner": {"reputation": 43, "user_id": 6020939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/epbvw.jpg?s=128&g=1", "display_name": "Xdminsy", "link": "https://stackoverflow.com/users/6020939/xdminsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 1, "accepted_answer_id": 38988655, "answer_count": 2, "score": 3, "last_activity_date": 1471472733, "creation_date": 1471410690, "question_id": 38988536, "link": "https://stackoverflow.com/questions/38988536/type-declarations-syntax-difference-between-haskell-and-haskell-like-language", "title": "Type declarations syntax difference between haskell and haskell-like language", "body": "<p>In Haskell, type declarations using double colon i.e. (::), like <code>not :: Bool -&gt; Bool</code>.</p>\n\n<p>But in many languages whose syntax is similar to Haskell, e.g. elm, agda,\nthey use single colon (:) to declare type. like <code>not : Bool -&gt; Bool</code>.</p>\n\n<p>Why these languages abandoned the haskell style type declaration syntax.</p>\n\n<ul>\n<li>is (:) better than (::) to declare a type?</li>\n<li>Or is (::) more suitable for other uses ?</li>\n<li>Or just because (:) is one char less than (::) ?</li>\n</ul>\n"}, {"tags": ["haskell", "parser-combinators", "do-notation"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1471390618, "post_id": 38986004, "comment_id": 65324775, "body": "Look at the type for <code>chainl</code>. The second argument, <code>op</code>, is a <code>Parser (a -&gt; a -&gt; a)</code>, which <i>is</i> a parser that produces a function."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471403127, "post_id": 38986004, "comment_id": 65327488, "body": "You do not &#39;extract&#39; the function, the <code>do</code> notation is sugar for uses of <code>&gt;&gt;=</code> in which you can access the result of a <code>Parser</code> within another <code>Parser</code>. The only way to actually get something of type <code>a</code> out of <code>Parser a</code> is to apply the function to a string (and hope the list is non-empty), but you do not need to do this (and should not) to manipulate parsers."}], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1471433389, "post_id": 38987722, "comment_id": 65342462, "body": "&quot;that assigns the name f to the values parsed by op&quot;, what do you mean by this, is this not the list of tuples? I am slightly confused"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "reply_to_user": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1471443377, "post_id": 38987722, "comment_id": 65349911, "body": "No it&#39;s not the list of tuples. Since <code>op</code> is of type <code>Parser (a  -&gt; a -&gt; a)</code>, <code>f</code> is a fn (recognized by the parser) of type <code>a -&gt; a -&gt; a</code>.  If a parser <code>p</code> is of type <code>Parser Int</code>, then whenever I write <code>x &lt;- p</code>, <code>x</code> will refer to some integer recognized by <code>p</code>. This is what we want it to refer to, right? This way we can easy combine multiple parsers into new parsers in arbitary ways that depend on the <code>x</code> value recognized by <code>p</code>. <code>bind</code> is hiding some complexity so that you don&#39;t have to deal with it / think about it."}], "tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 1, "last_activity_date": 1471405989, "last_edit_date": 1471405989, "creation_date": 1471405068, "answer_id": 38987722, "question_id": 38986004, "link": "https://stackoverflow.com/questions/38986004/haskell-parser-combinator-do-notation/38987722#38987722", "title": "Haskell parser combinator - do notation", "body": "<p>Start by looking at the definition of <code>Parser</code>: </p>\n\n<pre><code>newtype Parser a = Parser {parse :: String -&gt; [(a,String)]}`\n</code></pre>\n\n<p>A <code>Parser a</code> is really just a wrapper around a function (that we can run later with <code>parse</code>) that takes a <code>String</code> and returns a list of pairs, where each pair contains an <code>a</code> encountered when processing the string, along with the rest of the string that remains to be processed.</p>\n\n<p>Now look at the part of the code in <code>chainl1</code> that's confusing you: the part where you extract <code>f</code> from <code>op</code>:</p>\n\n<pre><code>f &lt;- op\n</code></pre>\n\n<p>You remarked: \"I do not get how you extract a function from the parser when it should return a list of tuples.\"</p>\n\n<p>It's true that when we <em>run</em> a <code>Parser a</code> with a string (using <code>parse</code>), we get a list of type <code>[(a,String)]</code> as a result. But this code does not say <code>parse op s</code>. Rather, we are using <code>bind</code> here (with the do-notation syntactic sugar). The problem is that you're thinking about the definition of the <code>Parser</code> datatype, but you're not thinking much about what <code>bind</code> specifically does.</p>\n\n<p>Let's look at what <code>bind</code> is doing in the <code>Parser</code> monad a bit more carefully. </p>\n\n<pre><code>bind :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\nbind p f = Parser $ \\s -&gt; concatMap (\\(a, s') -&gt; parse (f a) s') $ parse p s\n</code></pre>\n\n<p>What does <code>p &gt;&gt;= f</code> do? It returns a <code>Parser</code> that, when given a string <code>s</code>, does the following: First, it <em>runs</em> parser <code>p</code> with the string to be parsed, <code>s</code>. This, as you correctly noted, returns a list of type <code>[(a, String)]</code>: i.e. a list of the values of type <code>a</code> encountered, along with the string that remained after each value was encountered. Then it takes this list of pairs and applies a function to each pair. Specifically, each <code>(a, s')</code> pair in this list is transformed by (1) applying <code>f</code> to the parsed value <code>a</code> (<code>f a</code> returns a new parser), and then (2) <em>running</em> this new parser with the remaining string <code>s'</code>. This is a function from a tuple to a list of tuples: <code>(a, s') -&gt; [(b, s'')]</code>... and since we're mapping this function over every tuple in the original list returned by <code>parse p s</code>, this ends up giving us a list of lists of tuples: <code>[[(b, s'')]]</code>. So we concatenate (or join) this list into a single list <code>[(b, s'')]</code>. All in all then, we have a function from <code>s</code> to <code>[(b, s'')]</code>, which we then wrap in a <code>Parser</code> newtype.</p>\n\n<p>The crucial point is that when we say <code>f &lt;- op</code>, or <code>op &gt;&gt;= \\f -&gt; ...</code> that assigns the name <code>f</code> to the values parsed by <code>op</code>, but <code>f</code> is not a list of tuples, b/c it is not the result of running <code>parse op s</code>. </p>\n\n<p>In general, you'll see a lot of Haskell code that defines some datatype <code>SomeMonad a</code>, along with a <code>bind</code> method that hides a lot of the dirty details for you, and lets you get access to the <code>a</code> values you care about using do-notation like so: <code>a &lt;- ma</code>. It may be instructive to look at the <code>State a</code> monad to see how <code>bind</code> passes around state behind the scenes for you. Similarly, here, when combining parsers, you care most about the values the parser is supposed to recognize... <code>bind</code> is hiding all the dirty work that involves the strings that remain upon recognizing a value of type <code>a</code>.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1471405989, "creation_date": 1471390254, "last_edit_date": 1471392761, "question_id": 38986004, "link": "https://stackoverflow.com/questions/38986004/haskell-parser-combinator-do-notation", "title": "Haskell parser combinator - do notation", "body": "<p>I was reading a tutorial regarding building a parser combinator library and i came across a method which i don't quite understand.</p>\n\n<pre><code>newtype Parser a = Parser {parse :: String -&gt; [(a,String)]}\n\nchainl :: Parser a -&gt; Parser (a -&gt; a -&gt; a) -&gt; a -&gt; Parser a\nchainl p op a = (p `chainl1` op) &lt;|&gt; return a\n\nchainl1 :: Parser a -&gt; Parser (a -&gt; a -&gt; a) -&gt; Parser a\np `chainl1` op = do {a &lt;- p; rest a}\n  where rest a = (do f &lt;- op\n                     b &lt;- p\n                     rest (f a b))\n                 &lt;|&gt; return a\n\nbind :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\nbind p f = Parser $ \\s -&gt; concatMap (\\(a, s') -&gt; parse (f a) s') $ parse p s\n</code></pre>\n\n<p>the <code>bind</code> is the implementation of the <code>(&gt;&gt;=)</code> operator.  I don't quite get how the <code>chainl1</code> function works. From what I can see you extract <code>f</code> from <code>op</code> and then you apply it to <code>f a b</code> and you recurse, however I do not get how you extract a function from the parser when it should return a list of tuples?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471384226, "post_id": 38985012, "comment_id": 65322790, "body": "Have a look at the <a href=\"https://hackage.haskell.org/package/mime\" rel=\"nofollow noreferrer\">mime</a> package."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471385025, "post_id": 38985012, "comment_id": 65323119, "body": "@ErikR Unless there is something I&#39;m missing there, it doesn&#39;t handle this type of encoding. Codec.MIME.Decode explicitly states &quot;Currently, base64 and quoted-printable are the only two encodings supported.&quot;. So it would turn my example into &quot;=?iso-8859-1?q?this is some text?=&quot; instead of &quot;this is some text&quot;. That&#39;s definitely workable, but then you have to strip extra characters. Also it leaves &quot;_&quot; alone, which is a valid encoded-word representation for &quot; &quot;"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471386985, "post_id": 38985012, "comment_id": 65323772, "body": "Have a look at code for <a href=\"https://hackage.haskell.org/package/mime-0.4.0.2/docs/src/Codec-MIME-Decode.html#decodeWord\" rel=\"nofollow noreferrer\">decodeWord</a>. Despite the lack of docs, it appears there is support for iso-8859-1."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471442820, "post_id": 38985012, "comment_id": 65349518, "body": "@ErikR Oh great that is exactly what I needed thank you! If you want to write up a brief answer, I&#39;m happy to accept it."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1471444646, "last_edit_date": 1471444646, "creation_date": 1471443680, "answer_id": 38999303, "question_id": 38985012, "link": "https://stackoverflow.com/questions/38985012/how-can-i-decode-an-encoded-word-string/38999303#38999303", "title": "How can I decode an encoded-word String?", "body": "<p>In the <a href=\"https://hackage.haskell.org/package/mime\" rel=\"nofollow\"><code>mime</code></a> package have  look at <a href=\"https://hackage.haskell.org/package/mime-0.4.0.2/docs/src/Codec-MIME-Decode.html#decodeWord\" rel=\"nofollow\"><code>decodeWord</code></a> in the module <a href=\"https://hackage.haskell.org/package/mime-0.4.0.2/docs/Codec-MIME-Decode.html\" rel=\"nofollow\"><code>Codec.MIME.Decode</code></a>:</p>\n\n<pre><code>ghci&gt; import Codec.MIME.Decode\nghci&gt; decodeWord \"=?iso-8859-1?q?this=20is=20some=20text?=\"\nJust (\"this is some text\",\"\")\n</code></pre>\n\n<p>From reading the source code both <code>iso-8859-1</code> and <code>us-ascii</code> are supported.</p>\n\n<p>There is also the <code>decodeWords</code> which uses the <code>decodeWord</code> function to translate a entire String:</p>\n\n<pre><code>ghci&gt; decodeWords \"Foo=?iso-8859-1?q?this=20is=20some=20text?=Bar\"\n\"Foothis is some textBar\"\n</code></pre>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 38999303, "answer_count": 1, "score": 2, "last_activity_date": 1471444646, "creation_date": 1471384086, "last_edit_date": 1495542787, "question_id": 38985012, "link": "https://stackoverflow.com/questions/38985012/how-can-i-decode-an-encoded-word-string", "title": "How can I decode an encoded-word String?", "body": "<p>Note that this question is the same as <a href=\"https://stackoverflow.com/questions/15098452/how-can-i-decode-a-quotedprintable-encoded-string\">this</a> previously unanswered question.<br>\nIt is also the same as <a href=\"https://stackoverflow.com/questions/3468849/iso-8859-1-in-mail-subject\">this PHP question</a>, but I'm looking for the haskell equivalent. </p>\n\n<p><a href=\"https://tools.ietf.org/html/rfc2047\" rel=\"nofollow noreferrer\">RFC 2047</a> defines the standard for \"encoded-word\" encodings and provides an example of:</p>\n\n<pre><code>=?iso-8859-1?q?this=20is=20some=20text?=\n</code></pre>\n\n<p>Is there a standard haskell library for dealing with decoding this into it's correct <code>Text</code> representation? </p>\n\n<p>This shouldn't be too hard to write a custom parser using parsec and the RFC Spec, but this seems like a common, solved problem in other languages that I cannot find a Haskell equivalent for, and I'd rather not re-invent the wheel here. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1471383933, "post_id": 38984869, "comment_id": 65322675, "body": "<code>asum</code> is in base, in <code>Data.Foldable</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1471384142, "post_id": 38984869, "comment_id": 65322751, "body": "Using <a href=\"https://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor.html#t:Star\" rel=\"nofollow noreferrer\"><code>Star</code></a> from the profunctors package, you can also write <code>runStar . asum . fmap Star</code>, thanks to the <code>Alternative f =&gt; Alternative (Star f a)</code> instance."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1471384252, "post_id": 38984869, "comment_id": 65322804, "body": "@danidiaz Yeah, I realized that a couple of minutes ago - I was thrown off because I was looking for <code>asum</code> in <code>Control.Applicative</code> where <code>Alternative</code> is defined. And that is a neat trick with <code>Star</code>! I&#39;ve been looking for something like <code>Star</code>..."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1471385788, "post_id": 38984869, "comment_id": 65323383, "body": "Rather than that list comprehension, I think <code>map ($ x) fns</code> is nicer."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1471386122, "post_id": 38984869, "comment_id": 65323496, "body": "@amalloy Or, ahem, <code>sequenceA fns x</code> thanks to the function (&quot;Reader&quot;) applicative."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1471386297, "post_id": 38984869, "comment_id": 65323549, "body": "@amalloy I see no point in using <code>map</code>. If you want to make it clear that you are working on a list, a list comprehension does that better. If you want to write polymorphic code, use <code>fmap</code> instead. Also, why not <code>($ x) &lt;$&gt; fns</code> while we are at it... ;)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1471386864, "post_id": 38984869, "comment_id": 65323733, "body": "I did consider <code>($ x) &lt;$&gt; fns</code> but I think the use of <code>$</code>-based operators to do two different things will look more confusing to someone who&#39;s not familiar with what&#39;s going on."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 12, "last_activity_date": 1471383964, "last_edit_date": 1471383964, "creation_date": 1471383443, "answer_id": 38984869, "question_id": 38984781, "link": "https://stackoverflow.com/questions/38984781/how-do-i-apply-the-first-partial-function-that-works-in-haskell/38984869#38984869", "title": "How do I apply the first partial function that works in Haskell?", "body": "<p>This is what <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:Alternative\"><code>Alternative</code></a> is for. It represents choice and here you are choosing between <code>Maybe</code> values. You can do something like</p>\n\n<pre><code>foldr (&lt;|&gt;) empty [f x | f &lt;- fns]\n</code></pre>\n\n<p>In <code>Data.Foldable</code> you also have <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:asum\"><code>asum :: (Foldable t, Alternative f) =&gt; t (f a) -&gt; f a</code></a> which does what you want even more directly:</p>\n\n<pre><code>asum [f x | f &lt;- fns]\n</code></pre>\n\n<hr>\n\n<p>As a side remark, I should note that <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#t:MonadPlus\"><code>MonadPlus</code></a> also does what you want for its <code>Maybe</code> instance. As in the above, you can have</p>\n\n<pre><code>foldr mplus mempty [f x | f &lt;- fns]\n</code></pre>\n\n<p>And</p>\n\n<pre><code>msum [f x | f &lt;- fns]\n</code></pre>\n\n<p>But IMO you should use <code>Alternative</code> here since that more accurately conveys your meaning of \"choice\".</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1471388481, "post_id": 38985472, "comment_id": 65324221, "body": "Do you know whether there are plans to get <code>Semigroup</code> into <code>base</code>, so that we can relax <code>Monoid (Maybe a)</code>&#39;s superclass constraint and have an instance which doesn&#39;t reduce grown men to tears?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471388914, "post_id": 38985472, "comment_id": 65324350, "body": "@BenjaminHodgson You might like <a href=\"https://prime.haskell.org/wiki/Libraries/Proposals/SemigroupMonoid\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1471404786, "post_id": 38985472, "comment_id": 65327877, "body": "@BenjaminHodgson, it&#39;s in <code>base</code>, and will be a superclass of <code>Monoid</code>, but that&#39;s not what so disturbs pigworker. He wants <code>First</code> semantics for <code>Foldable Maybe</code> and can&#39;t get them."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1471417463, "post_id": 38985472, "comment_id": 65332258, "body": "dfeuer is correct about what I want in this case. Making &quot;lifted <code>Semigroup</code>&quot; the <code>Monoid</code> for <code>Maybe</code> would not fix the above problem. I think there should be a whole other type for lifting a <code>Semigroup</code>: its raw data representation might be the same as for <code>Maybe</code>, but the type class mechanism&#39;s way of grabbing useful apparatus for us means that in Haskell, when we name a type, we are not only naming the data representation but also the implicitly associated structure. <code>Maybe</code> is for failure propagation and recovery. Something else should lift <code>Semigroup</code>, and have that <code>Monoid</code> instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471541578, "post_id": 38985472, "comment_id": 65399287, "body": "I meant the <code>Monoid</code> instance, of course. Sorry if I confused anyone."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 9, "last_activity_date": 1471386487, "creation_date": 1471386487, "answer_id": 38985472, "question_id": 38984781, "link": "https://stackoverflow.com/questions/38984781/how-do-i-apply-the-first-partial-function-that-works-in-haskell/38985472#38985472", "title": "How do I apply the first partial function that works in Haskell?", "body": "<p>In <code>Data.Monoid</code>, a <code>newtype</code> copy of <code>Maybe</code>, called <code>First</code>, has the \"take the first <code>Just</code>\" behaviour.</p>\n\n<p>If you were looking for a function of type</p>\n\n<pre><code>[a -&gt; First b] -&gt; a -&gt; First b\n</code></pre>\n\n<p>with the behaviour you describe, it would simply be</p>\n\n<pre><code>fold\n</code></pre>\n\n<p>from <code>Data.Foldable</code>, because the monoid behaviour for <code>a -&gt;</code> does the pointwise lifting needed: the <code>Monoid</code> for <code>a -&gt; First b</code> is exactly picking the first application outcome whic works. Sadly (for my tears over this have been many), to get <code>Maybe</code> instead of <code>First</code> takes a little more work.</p>\n\n<p>Note that the pointwise lifting, yanking <code>a -&gt;</code> out through <code>[]</code>, is just the sort of job for <code>sequenceA</code>, so</p>\n\n<pre><code>(asum .) . sequenceA\n</code></pre>\n\n<p>will do the job.</p>\n\n<p>It's good to get the monoid structure you need cued from the type: in this case, accessing the <code>Alternative</code> behaviour with <code>asum</code> will have to do.</p>\n"}, {"tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 4, "last_activity_date": 1471418395, "last_edit_date": 1471418395, "creation_date": 1471417795, "answer_id": 38990227, "question_id": 38984781, "link": "https://stackoverflow.com/questions/38984781/how-do-i-apply-the-first-partial-function-that-works-in-haskell/38990227#38990227", "title": "How do I apply the first partial function that works in Haskell?", "body": "<p><em>Warning:</em> This is a really non-standard solution. But I personally really like it for its elegance - and the underlying mind-bending.</p>\n\n<p>On <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow\">https://wiki.haskell.org/Pointfree</a> you can find a function named <code>swing</code>. Its implementation and type are confusing at first:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>swing :: (((a -&gt; b) -&gt; b) -&gt; c -&gt; d) -&gt; c -&gt; a -&gt; d\nswing = flip . (. flip id)\n</code></pre>\n\n<p>You can get a first idea of what it does when you see its fully applied form:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>swing f c a = f ($ a) c\n</code></pre>\n\n<p>In conjunction with other higher-order functions it does things that almost look like magic. Examples from the link:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>swing map       :: [a -&gt; b] -&gt; a -&gt; [b]\nswing any       :: [a -&gt; Bool] -&gt; a -&gt; Bool\nswing foldr     :: b -&gt; a -&gt; [a -&gt; b -&gt; b] -&gt; b\nswing zipWith   :: [a -&gt; b -&gt; c] -&gt; a -&gt; [b] -&gt; [c]\nswing find      :: [a -&gt; Bool] -&gt; a -&gt; Maybe (a -&gt; Bool)\nswing partition :: [a -&gt; Bool] -&gt; a -&gt; ([a -&gt; Bool], [a -&gt; Bool])\n</code></pre>\n\n<p>All these functions do exactly what you would assume from the types. (But note that the wiki is a little out of date. By now, most of these functions automatically work for any <code>Foldable</code> type.)</p>\n\n<p>The function that you search could start from </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>swing mapMaybe :: [a -&gt; Maybe b] -&gt; a -&gt; [b]\n</code></pre>\n\n<p>and then apply <code>listToMaybe</code>. (Both functions are from <code>Data.Maybe</code>)</p>\n\n<p>A more general form would be</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>swing mapM :: (Monad m, Traversable t) =&gt; t (a -&gt; m b) -&gt; a -&gt; m (t b)\n</code></pre>\n\n<p>so for example (using the <code>ClassyPrelude</code> for full generality at the cost of some constraint noise, with <code>headMay</code> as a more general form of <code>listToMaybe</code>):</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>f :: (Traversable t, MonoFoldable (t b), Element (t b) ~ b)\n  =&gt; t (a -&gt; Maybe b) -&gt; a -&gt; Maybe b\nf functions x = join $ headMay &lt;$&gt; swing mapM functions x\n</code></pre>\n\n<p>Yes, it might turn your head into mush - but it's like bending your head to see a smiley, only with your whole mind.</p>\n"}], "owner": {"reputation": 301, "user_id": 3693916, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f8706dbcfa808acea950da9427b3379d?s=128&d=identicon&r=PG", "display_name": "user15553", "link": "https://stackoverflow.com/users/3693916/user15553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "answer_count": 3, "score": 9, "last_activity_date": 1471418395, "creation_date": 1471382954, "question_id": 38984781, "link": "https://stackoverflow.com/questions/38984781/how-do-i-apply-the-first-partial-function-that-works-in-haskell", "title": "How do I apply the first partial function that works in Haskell?", "body": "<p>Suppose I have a list <code>fns</code> of partial functions from <code>a</code> to <code>b</code>, which I represent as functions from <code>a</code> to <code>Maybe b</code>, and I have an object <code>x</code> of type <code>a</code>. Suppose now that I want to define another function from <code>a</code> to <code>Maybe b</code> which takes the value of the first <code>f x</code> that is not <code>Nothing</code>, if such an <code>f</code> exists in <code>fns</code>, or the value <code>Nothing</code> if no such <code>f</code> exists. So basically it outputs <code>f x</code> for the first <code>f</code> that works, or <code>Nothing</code> if no <code>f</code> works. </p>\n\n<p>It isn't hard to come up with some code that does the job. For example, one can create a list <code>[f x| f &lt;- fns]</code> remove all the <code>Nothing</code>s from it, and then take the head of the resulting list, or <code>Nothing</code> if that list is empty. But that feels clumsy, and this seems like the kind of general situation for which there is a much more stylish implementation using some built-in function in Haskell. If so, then I'd be interested to know what it is.</p>\n"}, {"tags": ["html", "parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471383298, "post_id": 38982992, "comment_id": 65322408, "body": "btw - for parsing HTML I find that <a href=\"https://hackage.haskell.org/package/tagsoup\" rel=\"nofollow noreferrer\">tagsoup</a> works well."}, {"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471414987, "post_id": 38982992, "comment_id": 65330978, "body": "I know, but I&#39;m exploring parsec at the moment :D"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1471388235, "last_edit_date": 1471388235, "creation_date": 1471383161, "answer_id": 38984827, "question_id": 38982992, "link": "https://stackoverflow.com/questions/38982992/how-to-stop-haskell-parsec-parser-at-eof/38984827#38984827", "title": "How to stop Haskell Parsec parser at EOF", "body": "<p>I created a combinator <code>skipTill p end</code> which applies <code>p</code> until <code>end</code> matches and then returns what <code>end</code> returns.</p>\n\n<p>By contrast, <code>manyTill p end</code> applies <code>p</code> until <code>end</code> matches and then\nreturns what the <code>p</code> parsers matched.</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nskipTill :: (Stream s m t) =&gt; ParsecT s u m a -&gt; ParsecT s u m end -&gt; ParsecT s u m end\nskipTill p end = scan\n    where\n      scan  = end  &lt;|&gt; do { p; scan }\n\ntd :: Parser String\ntd = do\n  string \"(\"\n  manyTill anyChar (try (string \")\"))\n\ntds = do r &lt;- many (try (skipTill anyChar (try td)))\n         many anyChar -- discard stuff at end\n         return r\n\ntest1 = parse tds \"\" \"111(abc)222(def)333\" -- Right [\"abc\", \"def\"]\n\ntest2 = parse tds \"\" \"111\"                 -- Right []\n\ntest3 = parse tds \"\" \"111(abc\"             -- Right []\n\ntest4 = parse tds \"\" \"111(abc)222(de\"      -- Right [\"abc\"]\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>This also appears to work:</p>\n\n<pre><code>tds' = scan\n  where scan = (eof &gt;&gt; return [])\n               &lt;|&gt; do { r &lt;- try td; rs &lt;- scan; return (r:rs) }\n               &lt;|&gt; do { anyChar; scan }\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 1, "accepted_answer_id": 38984827, "answer_count": 1, "score": 2, "last_activity_date": 1471388235, "creation_date": 1471375745, "last_edit_date": 1471378606, "question_id": 38982992, "link": "https://stackoverflow.com/questions/38982992/how-to-stop-haskell-parsec-parser-at-eof", "title": "How to stop Haskell Parsec parser at EOF", "body": "<p>So, I'm writing a small parser that will extract all <code>&lt;td&gt;</code> tag content with specific class, like this one <code>&lt;td class=\"liste\"&gt;some content&lt;/td&gt; --&gt; Right \"some content\"</code></p>\n\n<p>I will be parsing large <code>html</code> file but I don't really care about all the noise, so idea was to consume all characters until I reach <code>&lt;td class=\"liste\"&gt;</code> than I'd consume all characters (content) until <code>&lt;/td&gt;</code> and return content string.</p>\n\n<p>This works fine if last element in a file is my <code>td.liste</code> tag, but if I have some text after it or <code>eof</code> than my parser consumes it and throws <code>unexpected end of input</code> if you execute <code>parseMyTest test3</code>.</p>\n\n<p>-- EDIT<br>\nSee end of <code>test3</code> to understand what is the edge case.</p>\n\n<p>Here is my code so far :</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nimport Data.ByteString.Lazy (ByteString)\nimport Data.ByteString.Char8 (pack)\n\ncolOP :: Parser String\ncolOP = string \"&lt;td class=\\\"liste\\\"&gt;\"\n\ncolCL :: Parser String\ncolCL = string \"&lt;/td&gt;\"\n\ncol :: Parser String\ncol = do\n  manyTill anyChar (try colOP)\n  content &lt;- manyTill anyChar $ try colCL\n  return content\n\ncols :: Parser [String]\ncols = many col\n\ntest1 :: String\ntest1 = \"&lt;td class=\\\"liste\\\"&gt;Hello world!&lt;/td&gt;\"\n\ntest2 :: String\ntest2 = read $ show $ pack test1\n\ntest3 :: String\ntest3 = \"\\n\\r&lt;html&gt;asdfasd\\n\\r&lt;td class=\\\"liste\\\"&gt;Hello world 1!&lt;/td&gt;\\n&lt;td class=\\\"liste\\\"&gt;Hello world 2!&lt;/td&gt;\\n\\rasldjfasldjf&lt;td class=\\\"liste\\\"&gt;Hello world 3!&lt;/td&gt;&lt;td class=\\\"liste\\\"&gt;Hello world 4!&lt;/td&gt;adsafasd\"\n\nparseMyTest :: String -&gt; Either ParseError [String]\nparseMyTest test = parse cols \"test\" test\n\nbtos :: ByteString -&gt; String\nbtos = read . show\n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471418963, "post_id": 38977803, "comment_id": 65333100, "body": "Interesting side note: The last version of the comprehension (<code>[i | ... | ... ]</code>) can actually be used to <code>zipWithN</code> several lists via the <code>ParallelListComprehension</code> extension. Doesn&#39;t help here, but it has its uses."}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471418804, "post_id": 38977950, "comment_id": 65333005, "body": "The first answer manages to make the code half as efficient and a third as readable for the sake of ... ummm..."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 1, "last_activity_date": 1471358706, "creation_date": 1471358706, "answer_id": 38977950, "question_id": 38977803, "link": "https://stackoverflow.com/questions/38977803/use-list-comprehension-to-build-a-function/38977950#38977950", "title": "Use list comprehension to build a function", "body": "<pre><code>[x | l &lt;- ls, x &lt;- [i | ResuValIdx v (Just i) &lt;- [l]] ++ [i | ResuValCpt v i &lt;- [l]]]\n</code></pre>\n\n<p>Alternatively, consider:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\ncatIdxCpt :: [Result] -&gt; [Int]\ncatIdxCpt = mapMaybe $ \\case\n  ResuValIdx v (Just i) -&gt; Just i\n  ResuValCpt v c -&gt; Just c\n  _ -&gt; Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1471359542, "creation_date": 1471359542, "answer_id": 38978264, "question_id": 38977803, "link": "https://stackoverflow.com/questions/38977803/use-list-comprehension-to-build-a-function/38978264#38978264", "title": "Use list comprehension to build a function", "body": "<p>Your function involves both mapping and filtering, so consider this technique:</p>\n\n<pre><code>foo xs = [ y | Just y &lt;- map go xs ]\n  where go (ResuValIdx _ (Just i)) = Just i\n        go (ResuValCpt v c)        = Just c\n        go _                       = Nothing\n</code></pre>\n\n<p>The helper function <code>go</code> returns <code>Nothing</code> for elements you want to remove.</p>\n\n<p>The pattern <code>Just y &lt;- zs</code> will select only those elements from the list <code>zs</code> which match the pattern <code>Just y</code>.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 38977950, "answer_count": 2, "score": 3, "last_activity_date": 1471359542, "creation_date": 1471358260, "question_id": 38977803, "link": "https://stackoverflow.com/questions/38977803/use-list-comprehension-to-build-a-function", "title": "Use list comprehension to build a function", "body": "<p>I wrote a function with Haskell to extract some values from this data type : </p>\n\n<pre><code>data Result = ResuVal Double     \n              | ResuValIdx Double (Maybe Int)   \n              | ResuValCpt Double Int           \n              | NoResu                  \n              deriving (Show)\n</code></pre>\n\n<p>This function extract the <code>Int</code> values in the <code>Result</code> data type and concatenate them in a list.</p>\n\n<pre><code>catIdxCpt :: [Result] -&gt; [Int]\ncatIdxCpt [] = []\ncatIdxCpt (x:xs) = case x of\n                ResuValIdx v (Just i) -&gt; i:catIdxCpt xs\n                ResuValCpt v c -&gt; c:catIdxCpt xs      \n                _ -&gt; catIdxCpt xs  \n</code></pre>\n\n<p>This function is working well but I first tried to wrote it with a comprehension list such as : </p>\n\n<pre><code>catIdxCpt ls = [i | ResuValIdx v (Just i)  &lt;- ls  ]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>catIdxCpt ls = [i | ResuValIdx v (Just i)  &lt;- ls | ResuValCpt v i  &lt;- ls ]\n</code></pre>\n\n<p>and other combinations. But I didn't managed to have the expected result.</p>\n\n<p><strong>Do you know how to built (if it is possible) the <code>catIdxCpt</code> function with a list comprehension ?</strong></p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1471353642, "post_id": 38975932, "comment_id": 65305238, "body": "I suspect <code>char c</code> doesn&#39;t &quot;return an empty list&quot;, rather it <i>fails</i> on end of input. The bind operator then propagates that failure."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1471355367, "post_id": 38975932, "comment_id": 65306411, "body": "You meant <code>let while_parser = string &quot;while&quot;</code>, right?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1471356595, "post_id": 38975932, "comment_id": 65307245, "body": "@MathematicalOrchid From the definition of satisfy when char fails it will return a function which generates an empty list. What do you mean by propagate failure?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1471356623, "post_id": 38975932, "comment_id": 65307271, "body": "@sepp2k ah yes thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471362622, "post_id": 38978178, "comment_id": 65311316, "body": "Technically, it desugars to <code>char c &gt;&gt; string cs &gt;&gt; return (c:cs)</code>, since the desugaring is independent of whatever monad is in use. <code>m &gt;&gt; f</code> is usually, but isn&#39;t required to be, implemented as <code>m &gt;&gt;= \\_ -&gt; f</code>."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471366727, "post_id": 38978178, "comment_id": 65313748, "body": "@chepner Yep. I was too lazy to explain a tangential detail."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1471377380, "post_id": 38978178, "comment_id": 65319632, "body": "thank you, i think i kind of get it, but where does the recursive call to string fit in to all of this?"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1471381128, "post_id": 38978178, "comment_id": 65321431, "body": "Note that in the definition of <code>&gt;&gt;=</code>, the call to <code>f</code> (which is <code>\\_ -&gt; string cs</code> in this example) is inside the function passed to <code>concatMap</code>.  But since <code>(runParser p input)</code> is an empty list, that function is never actually used. Thus, the recursion doesn&#39;t happen."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 1, "last_activity_date": 1471359316, "creation_date": 1471359316, "answer_id": 38978178, "question_id": 38975932, "link": "https://stackoverflow.com/questions/38975932/haskell-parser-combinators-string-function/38978178#38978178", "title": "Haskell Parser Combinators - String function", "body": "<p>Let's say your <code>Parser</code> is defined like this:</p>\n\n<pre><code>newtype Parser a = Parser { runParser :: String -&gt; [(a,String)] }\n</code></pre>\n\n<p>Then your <code>Monad</code> instance would be defined something like this:</p>\n\n<pre><code>instance Monad Parser where\n  return x = Parser $ \\input -&gt; [(x, input)]\n  p &gt;&gt;= f = Parser $ \\input -&gt; concatMap (\\(x,s) -&gt; runParser (f x) s) (runParser p input)\n</code></pre>\n\n<p>You're wondering what happens when <code>char c</code> fails in this line of code:</p>\n\n<pre><code>string (c:cs) = do { char c; string cs; return (c:cs) }\n</code></pre>\n\n<p>First, let's desugar it:</p>\n\n<pre><code>string (c:cs) = char c &gt;&gt;= \\_ -&gt; string cs &gt;&gt;= \\_ -&gt; return (c:cs)\n</code></pre>\n\n<p>Now the part of interest is <code>char c &gt;&gt;= \\_ -&gt; string cs</code>. From the definition of <code>char</code> and subsequently the definition of <code>satisfy</code> we see that ultimately <code>runParser (char c) input</code> will evaluate to <code>[]</code> when <code>char c</code> fails. Look at the definition of <code>&gt;&gt;=</code> when <code>p</code> is <code>char c</code>. <code>concatMap</code> won't have any work to do because the list will be empty! Thus any calls to <code>&gt;&gt;=</code> from then on will just encounter an empty list and pass it along.</p>\n\n<p>One of the wonderful things about referential transparency is that you can write down your expression and evaluate it by substituting definitions and doing the function applications by hand.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 705, "favorite_count": 0, "accepted_answer_id": 38978178, "answer_count": 1, "score": 0, "last_activity_date": 1471359316, "creation_date": 1471353121, "last_edit_date": 1471356484, "question_id": 38975932, "link": "https://stackoverflow.com/questions/38975932/haskell-parser-combinators-string-function", "title": "Haskell Parser Combinators - String function", "body": "<p>I have been reading a tutorial about parser combinators and I came across a function which I would like a bit of help in trying to understand.</p>\n\n<pre><code>satisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy p = item `bind` \\c -&gt;\n  if p c\n  then unit c\n  else (Parser (\\cs -&gt; []))\n\nchar :: Char -&gt; Parser Char\nchar c = satisfy (c ==)\n\nnatural :: Parser Integer\nnatural = read &lt;$&gt; some (satisfy isDigit)\n\nstring :: String -&gt; Parser String\nstring [] = return []\nstring (c:cs) = do { char c; string cs; return (c:cs)}\n</code></pre>\n\n<p>My question is how does the string function work or  rather how does it terminate, say i did something like:</p>\n\n<p><code>let while_parser = string \"while\"</code></p>\n\n<p>and then i used it to parse a string say for example\n<code>parse while_parser \"while if\"</code> , it will correctly parse me the \"while\".</p>\n\n<p>however if i try something like <code>parse while_parser \"test</code> it will return [].</p>\n\n<p>My question is how does it fail? what happens when char c returns an empty list?</p>\n"}, {"tags": ["haskell", "type-level-computation", "servant"], "comments": [{"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1471355778, "post_id": 38975376, "comment_id": 65306673, "body": "Is <code>BaseUrl</code> something you know in advance? If it is, you don&#39;t need to parse it; just supply the fixed, known BaseUrl value when calling the client fn. If not, why can&#39;t you parse it too from the text file? It&#39;s just composed of a scheme, host, port, and path. It should be decently easy to write up a <code>Parser BaseUrl</code> using <code>parsec</code> or <code>megaparsec</code>.   Finally, don&#39;t you typically create a new Manager with <code>newManager :: ManagerSettings -&gt; IO Manager</code>, and share the created manager instance between requests?"}, {"owner": {"reputation": 795, "user_id": 465074, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/fb0cf57253253921af4daafdd99a788e?s=128&d=identicon&r=PG", "display_name": "voidlizard", "link": "https://stackoverflow.com/users/465074/voidlizard"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1471356319, "post_id": 38975376, "comment_id": 65307047, "body": "Let&#39;s assume it fixed and there is no task to parse it. And yes, Manager is created by it&#39;s typical way.  The question is how to generate a parser for request&#39;s arguments that may be used in call of <code>client</code> function."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1471357639, "post_id": 38975376, "comment_id": 65307973, "body": "Oh I misunderstood. Let me see if I have this right: you&#39;re not asking how to parse values from a text file and pass these arguments to a client fn (straightforward); rather, you&#39;re asking how to <i>infer</i> which client fn to call in the first place based on the (inferred) types of the values parsed from the text file. Is this right?"}, {"owner": {"reputation": 795, "user_id": 465074, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/fb0cf57253253921af4daafdd99a788e?s=128&d=identicon&r=PG", "display_name": "voidlizard", "link": "https://stackoverflow.com/users/465074/voidlizard"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1471358679, "post_id": 38975376, "comment_id": 65308690, "body": "I guess that&#39;s right.This task may be reduced to intering  tuple types  of arity infered from API type."}], "owner": {"reputation": 795, "user_id": 465074, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/fb0cf57253253921af4daafdd99a788e?s=128&d=identicon&r=PG", "display_name": "voidlizard", "link": "https://stackoverflow.com/users/465074/voidlizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472036397, "creation_date": 1471351693, "last_edit_date": 1472036397, "question_id": 38975376, "link": "https://stackoverflow.com/questions/38975376/generate-a-dynamic-request-with-servant-client", "title": "Generate a dynamic request with servant-client", "body": "<p>If I have some Servant's API described in servant DSL, like:</p>\n\n<p><code>\ntype API = \"some\" :&gt; QueryParam \"a\" Int :&gt; QueryParam \"b\" Double:&gt; Get '[JSON] Int\n</code></p>\n\n<p>It has HasClient instance, so I have a client:</p>\n\n<pre><code>\u03bb&gt; let theClient = client (Proxy :: Proxy API)\n\u03bb&gt; :t theClient \ntheClient\n  :: Maybe Int\n     -&gt; Maybe Double\n     -&gt; http-client-0.4.31:Network.HTTP.Client.Types.Manager\n     -&gt; BaseUrl\n     -&gt; ClientM Int\n\u03bb&gt; \n</code></pre>\n\n<p>It's good if I'm going to call all that API manually. But what if I need to generate HTTP requests from, say, a text file?</p>\n\n<p>I can generate simple parser from the <code>API</code> using (my own) typeclass\n<code>HasParser</code> which parses all query arguments from text file like this:</p>\n\n<pre><code>get some a=1234 b=0.1234\n...\n</code></pre>\n\n<p>but how to connect the result of parsing with the client's type? </p>\n\n<p>Of course I can write all that parsers on value level for each <code>API</code> method, but I want to generate all thar parsers from the <code>API</code> on type level,  so for particular <code>API</code> the parser should generate a function:</p>\n\n<p><code>Manager -&gt; BaseUrl -&gt; ClientM Int</code></p>\n\n<p>Is it even possible?</p>\n\n<p>UPD.</p>\n\n<p>Ok, the question actually constist of two:</p>\n\n<p>1) How to generate generate universal client</p>\n\n<p>2) How to generate parser, actually what type use to keep parsing result.</p>\n\n<p>(1) is quite simple although it's quite clunky:</p>\n\n<pre><code>type API = QueryParam \"a\" Int :&gt; Get '[JSON] Int\n\ntype family FinalType k where\n  FinalType (a :&gt; b) = FinalType b\n  FinalType (Verb a b c d) =  Client (Verb a b c d)\n\nclass ConvertAPI api input where\n  convert :: Proxy api -&gt; input -&gt; FinalType api\n\ninstance ( HasClient api\n         , Client api ~ (Maybe a -&gt; FinalType api) \n         , Read a \n         )\n         =&gt; ConvertAPI api String where\n  convert (Proxy :: Proxy api) i = (client (Proxy :: Proxy api)) (Just (read i))\n\ninstance ( HasClient api\n         , Client api ~ (Maybe a -&gt; Maybe b -&gt; FinalType api) \n         , Read a \n         , Read b \n         )\n         =&gt; ConvertAPI api (String,String) where\n  convert (Proxy :: Proxy api) (i,ii) = (client (Proxy :: Proxy api)) (Just (read i)) (Just (read i))\n</code></pre>\n\n<p>there are two instances for singleton and tuple of two, but it's easy to extend for tuples of all possible dimensions.</p>\n\n<p>The 2nd question is still unclear, I can't figure out yet how to generate parsers that will produce tuples of different dimensions.</p>\n\n<p>UPD2.</p>\n\n<p>Minimal implementation using nested tuples is here: \n<a href=\"https://gist.github.com/voidlizard/ef67a7ae486834d591d7b45c493bec1d\" rel=\"nofollow\">https://gist.github.com/voidlizard/ef67a7ae486834d591d7b45c493bec1d</a></p>\n\n<pre><code>it gives:\n\u03bb&gt; parse (Proxy :: Proxy API) [\"42\"]\nJust (\"42\",())\n\u03bb&gt; parse (Proxy :: Proxy API2) [\"some\",\"42\"]\nJust (\"42\",())\n\u03bb&gt; parse (Proxy :: Proxy API2) [\"42\"]\nNothing\n</code></pre>\n\n<p>So basically it's what I'd like to have, but the implementation is\nquite ugly. Is it possible to make it better - using some HLists or Vinyl or something else to walk away from that nested tuples ?</p>\n\n<p>UPD3 and conclusion.</p>\n\n<p>Well, the good news that all of is is pretty possible. We may define and implement HasParser type class that defines all parse function and type or data family for parsing results, and ConvertAPI typeclass that will translate Servant's client functions and parsing results into the something that has type <code>[Token] -&gt; Manager -&gt; BaseUrl -&gt; ClientM a</code> . There are some complexities with type of that <strong>a</strong> that should be wrapped into an existential type, but it is still possible. Implementation of this is still not perfect, but this is an another issue, how to implement API's with modern features like type-level programming.</p>\n\n<p>The another way of doing this is just construct HTTP request up on Servant.Common.Req on values level, using parser generated from servant's API definition. Is way easier but requires lot of code and somehow duplicates Servant's HasClient instances.</p>\n\n<p>Frankly, we all need some kind of manual how to design API'es using modern type-level features.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1471347500, "post_id": 38973342, "comment_id": 65300943, "body": "From the paper you linked (section 3): &quot;The synthesis algorithm takes a generate-and-test approach: it generates an infinite stream of all the expressions having the same type as f ; then, they are tested against the given predicate.&quot;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1471348177, "post_id": 38973342, "comment_id": 65301395, "body": "Just a suggestion: if you are learning Haskell, perhaps starting with reproducing a research-level task from 2013 is a bit too much. I would start with some tutorial and some basic exercises, first."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1471359962, "post_id": 38973342, "comment_id": 65309516, "body": "I disagree. You may also be interested in <a href=\"https://github.com/lspitzner/exference/\" rel=\"nofollow noreferrer\">github.com/lspitzner/exference</a>"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 247, "favorite_count": 3, "answer_count": 0, "score": 3, "last_activity_date": 1471345741, "creation_date": 1471345741, "question_id": 38973342, "link": "https://stackoverflow.com/questions/38973342/understanding-how-magichaskeller-generates-functions", "title": "Understanding how MagicHaskeller generates functions", "body": "<p>I stumbled upon this product : <a href=\"http://nautilus.cs.miyazaki-u.ac.jp/~skata/MagicHaskeller.html\" rel=\"nofollow\">http://nautilus.cs.miyazaki-u.ac.jp/~skata/MagicHaskeller.html</a> and am very impressed that it can generate a function by providing a specification.</p>\n\n<p>Reading a paper about MagicHaskeller : <a href=\"https://www.haskell.org/haskell-symposium/2013/magichaskeller.pdf\" rel=\"nofollow\">https://www.haskell.org/haskell-symposium/2013/magichaskeller.pdf</a> provides a clue to how this works : </p>\n\n<pre><code>The backend server does the actual program synthesis. The synthesis\nalgorithm takes a generate-and-test approach: it generates an\ninfinite stream of all the expressions having the same type as f;\nthen, they are tested against the given predicate. The implementation\nis based on [2] which discusses how to efficiently generate a\nstream of expressions with the given type using memoization, and\n[3] which discusses how to remove semantically equivalent expressions.\nThere are also new devices to reduce heap usage further.\n</code></pre>\n\n<p>I'm currently learning Haskell and I think learning to implment a basic similar MagicHaskeller would be a very interesting way to learn the language.</p>\n\n<p>Is there a particular concept behind MagicHaskeller that I can utilize to perform something similar ?</p>\n"}, {"tags": ["haskell", "animation", "web-based"], "comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1471341167, "post_id": 38971111, "comment_id": 65297040, "body": "I would love to know a great answer for this..."}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1471341330, "post_id": 38971111, "comment_id": 65297143, "body": "@Libby then how about up-voting the question? :) it may then attract more attention."}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1471344472, "post_id": 38971111, "comment_id": 65299067, "body": "done :) Thinking more about this question, the answer is probably Elm -- even though Elm isn&#39;t Haskell, it&#39;s close enough that you can learn a lot from it and it&#39;s basically made to be used the way you&#39;re talking about."}], "answers": [{"comments": [{"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1471400406, "post_id": 38978002, "comment_id": 65326849, "body": "Thanks. Again, the problem with Reflex is that I would need to get into Functional Reactive Programming, learning concepts like arrowizing, etc. It is something I will want to do, but right now I feel it would be a distraction from practicing and learning Haskell itself."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 1, "creation_date": 1471403101, "post_id": 38978002, "comment_id": 65327484, "body": "I see.  It almost seems like, by definition, a functional program that reacts to the passage of time (animation) and reacts to user input (mouse clicks, etc) would be functional reactive programming.  Even if a package is not explicitly labeled as &quot;FRP&quot;, if it enables the things you want, it would come pretty close to being FRP in principle, if not in name."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 0, "creation_date": 1471403530, "post_id": 38978002, "comment_id": 65327582, "body": "Would it be possible to give a more specific example of a web animation that you want to implement?"}, {"owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "edited": false, "score": 2, "creation_date": 1471403807, "post_id": 38978002, "comment_id": 65327651, "body": "Maybe a baby project to play with Haskell types and functions: clicking on the screen creates either circles or pegs (depending on whether we held down the control key.) Then we could connect the pegs and the balls with &quot;rubber bands&quot;. Once we clicked on a &quot;go!&quot; button the rubber bands would contract the balls and accelerate them. When the rubber bands stretched enough in the opposite direction they would contract again. So the whole System starts moving until it reaches a resting state.   I think that&#39;s a very simple yet useful tutorial that can then be used for more realistic applications."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": false, "score": 3, "last_activity_date": 1471358853, "creation_date": 1471358853, "answer_id": 38978002, "question_id": 38971111, "link": "https://stackoverflow.com/questions/38971111/simplest-package-for-web-animation-with-haskell/38978002#38978002", "title": "Simplest package for web animation with Haskell", "body": "<p>The approach that has worked for me is to use <a href=\"https://hackage.haskell.org/package/reflex\" rel=\"nofollow\">Reflex</a> to render SVG .  Reflex makes it fairly easy to render DOM objects to a web page and respond to mouse clicks on those objects.  Using SVG ( instead of canvas ) allows for access to the rendered objects after the initial display, both for selection and for editing (resizing, moving, changing color, deletion).</p>\n\n<p>Here are three \"getting started\" examples that use reflex/svg.  Each of these includes a working demo ( linked to in the readme file ).</p>\n\n<p><a href=\"https://github.com/dc25/circlePackingReflex\" rel=\"nofollow\">Render circles in locations determined by the circle-packing package</a></p>\n\n<p><a href=\"https://github.com/dc25/knightsTourReflex\" rel=\"nofollow\">Interactive knight's tour animation.</a></p>\n\n<p><a href=\"https://github.com/dc25/drawRotatingCubeHaskell\" rel=\"nofollow\">Rotating 3D cube</a></p>\n\n<p>Given that these examples are reflex based, they all are written using an FRP coding style but I tried to minimize the portion of each of these programs that specifically uses FRP techniques.</p>\n\n<p>For example, the knight's tour and rotating cube both have a recursive-do block of code containing only calls to view, and update.  In both cases, this block of code enables the feedback from view to accumulation of state changes ( foldDyn update )</p>\n\n<p>From rotating cube example:</p>\n\n<pre><code>rec\n    view modelOrientation\n    modelOrientation &lt;- foldDyn update initialOrientation tick\n</code></pre>\n\n<p>From knight's tour example:</p>\n\n<pre><code>rec\n    startEvent &lt;- view width height rowCount colCount board tour\n    tour &lt;- foldDyn (update board) [] $ leftmost [startEvent, advanceEvent]\n</code></pre>\n\n<p>The easiest way that I have found to get started with reflex is by cloning the <a href=\"https://github.com/reflex-frp/reflex-platform\" rel=\"nofollow\">reflex-platform github repository</a> and running the try-reflex script contained in that repository - exactly as specified on the readme for reflex-platform</p>\n\n<p>The circle-packing example requires the <a href=\"https://hackage.haskell.org/package/circle-packing\" rel=\"nofollow\">circle-packing package</a> .  The rotating 3d cube example requires the <a href=\"https://hackage.haskell.org/package/matrix\" rel=\"nofollow\">matrix package</a>.  To enable the use of these packages, include them in packages.nix in reflex-platform before running try-reflex - again, as specified on the reflex-platform readme.</p>\n"}], "owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1471358853, "creation_date": 1471339385, "question_id": 38971111, "link": "https://stackoverflow.com/questions/38971111/simplest-package-for-web-animation-with-haskell", "title": "Simplest package for web animation with Haskell", "body": "<p>I'm learning Haskell and would like to develop a baby project to play with it. I'm progressing with the model and controller components but am having a hard time with the view. I'd like to render web-based animations (which recognize mouse clicks, moves objects, etc.) Have looked at various packages (Spock, Reflex, etc.) There seems to be [too?] many of them, but I found that they either require more effort (because they are RFP, which would require me to first learn those concepts) or seem simple (such as Spock) but then I can't find  a simple web animation tutorial (just a \"Hello World\".)</p>\n\n<p>Can anybody recommend a simple approach? Again, I would just like a quick and easy way to render stuff. My focus is on learning the Haskell basics, not web programming.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471336188, "post_id": 38969956, "comment_id": 65293879, "body": "I was merely wondering if there was a better way. What happens if you wanted to open a file, transform the content a few times using <code>&gt;&gt;=</code>, and then write back the text? Do you need to pass the <code>handle</code> to each <code>&gt;&gt;=</code> or is it preferred to use the <code>do</code> notation or <code>where</code> clause?"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1471336911, "post_id": 38969956, "comment_id": 65294321, "body": "do notation was exactly invented as syntactic sugar for <code>&gt;&gt;=</code>, to make your life easier :)"}, {"owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471337155, "post_id": 38969956, "comment_id": 65294479, "body": "That&#39;s cool, I just want to understand the <code>&gt;&gt;=</code> syntax a little better, as it feels like <code>do</code> is hiding things from me. Please see my updated question with a simple, contrived code example."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471337904, "post_id": 38969956, "comment_id": 65294901, "body": "Only one <code>&gt;&gt;=</code> will provide the handle, the one mentioned in this answer. You will use it in other file operations e.g. <code>... &gt;&gt;= \\(tempName, tempHandle) -&gt; readTheFile tempHandle &gt;&gt;= \\content -&gt; writeTheFile tempHandle (frob content) &gt;&gt; hClose tempHandle</code>. It is easier to read in do notation, but not too bad in bind-notation either."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1471338039, "post_id": 38969956, "comment_id": 65294981, "body": "Note that the lambda <code>\\(tempName, tempHandle) -&gt;...</code> ends at the very end of the function, <b>not</b> at the next <code>&gt;&gt;=</code>. I guess this is the source of your misunderstanding. In do notation it is the same: every <code>x &lt;- ...</code> is in scope until the do block ends."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": true, "score": 3, "last_activity_date": 1471337633, "last_edit_date": 1471337633, "creation_date": 1471335944, "answer_id": 38969956, "question_id": 38969578, "link": "https://stackoverflow.com/questions/38969578/preferred-approach-for-storing-a-reference-to-a-file-handle-db-handle-etc/38969956#38969956", "title": "Preferred approach for storing a reference to a file handle/DB handle, etc...?", "body": "<pre><code>do\n  (tempName, tempHandle) &lt;- openTempFile \".\" \"temp\"\n  ...\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>openTempFile \".\" \"temp\" &gt;&gt;= \\(tempName, tempHandle) -&gt;\n...\n</code></pre>\n\n<p>The second one is much harder to read, why would you want to use it ?</p>\n\n<p>To complete your example :</p>\n\n<pre><code>main =\n    openFile \"name.txt\" WriteMode &gt;&gt;= \\handle -&gt;\n    putStrLn \"Enter your name: \" &gt;&gt;\n    getLine &gt;&gt;=\n    (\\name -&gt; hPutStr handle name) &gt;&gt;\n    hClose handle\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471339389, "post_id": 38970571, "comment_id": 65295848, "body": "Is it common practice in Haskell to indent the <code>putStrLn</code> line and onwards to make it clearer that the last 4 lines are part of the anonymous function? As the way you&#39;ve written it doesn&#39;t make it clear that there&#39;s an anonymous function, aside from the <code>-&gt;</code> at the end of the 2nd line."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471339698, "post_id": 38970571, "comment_id": 65296080, "body": "In bind-blocks it is fairly common to indent the code as above since otherwise we need to indent more and more. Of course, do blocks are more common. Also common: <code>forM_ [1..n] $ \\i -&gt; do</code> followed a newline and indented do-block. So, yes, <code>\\x -&gt;</code> at the very end of the line is quite common. It looked weird the very first time I saw it, but now no longer so. Further, keep in mind that there&#39;s no standard indentation in Haskell (like e.g. in Java or Scala)."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 3, "last_activity_date": 1471337809, "creation_date": 1471337809, "answer_id": 38970571, "question_id": 38969578, "link": "https://stackoverflow.com/questions/38969578/preferred-approach-for-storing-a-reference-to-a-file-handle-db-handle-etc/38970571#38970571", "title": "Preferred approach for storing a reference to a file handle/DB handle, etc...?", "body": "<p>The direct way to de-sugar the do-notation would be:</p>\n\n<pre><code>main =\n    openFile \"name.txt\" (WriteMode) &gt;&gt;= \\handle -&gt;\n    putStrLn \"Enter your name: \" &gt;&gt;\n    getLine &gt;&gt;= \\name -&gt;\n    hPutStr handle name &gt;&gt;\n    hClose handle\n</code></pre>\n\n<p>Note that the whole thing after <code>\\handle -&gt;</code> is part of the same function body so <code>handle</code> is in scope for all the following expressions.</p>\n"}], "owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 38969956, "answer_count": 2, "score": 0, "last_activity_date": 1471338368, "creation_date": 1471334636, "last_edit_date": 1471338368, "question_id": 38969578, "link": "https://stackoverflow.com/questions/38969578/preferred-approach-for-storing-a-reference-to-a-file-handle-db-handle-etc", "title": "Preferred approach for storing a reference to a file handle/DB handle, etc...?", "body": "<p>In the Learn You A Haskell book, there is <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow\">a todo example</a> that uses the <code>do</code> notation to assign the <code>tempName</code> and <code>tempHandle</code>:</p>\n\n<pre><code>do\n    ...\n    (tempName, tempHandle) &lt;- openTempFile \".\" \"temp\"\n</code></pre>\n\n<p>Which means that <code>tempName</code> and <code>tempHandle</code> are accessible throughout the function, that means you can do whatever you like in between the <code>openTempFile</code> and having to <code>hClose</code> at the end. However, as <code>do</code> notation is apparently syntactic sugar for <code>&gt;&gt;=</code> I'm trying to transform the <code>do</code> into bind, and finding it difficult to maintain a reference to <code>tempHandle</code>.</p>\n\n<p>With my limited understanding of Haskell, I see a couple of options:</p>\n\n<ul>\n<li>Store the <code>tempHandle</code> in the <code>where</code> clause so that it's accessible from the function;</li>\n<li>Pass the <code>tempHandle</code> reference in the <code>&gt;&gt;=</code> alongside other data that I need in each step of the bind: (<code>return (\"Transformed Data\", tempHandle)</code>!?).</li>\n</ul>\n\n<p>How would you do this? Am I approaching this from the wrong angle?</p>\n\n<hr>\n\n<p><strong>Edit:</strong> How would I keep a reference to <code>handle</code> if you transformed the <code>do</code> notation to <code>&gt;&gt;=</code> in the following example:</p>\n\n<pre><code>main = do\n    handle &lt;- openFile \"name.txt\" (WriteMode)\n    putStrLn \"Enter your name: \"\n    name &lt;- getLine\n    hPutStr handle name\n    hClose handle\n</code></pre>\n\n<p>When transformed to <code>&gt;&gt;=</code> how would I reference <code>handle</code>?</p>\n\n<pre><code>main =\n    openFile \"name.txt\" WriteMode &gt;&gt;\n    putStrLn \"Enter your name: \" &gt;&gt;\n    getLine &gt;&gt;=\n    (\\name -&gt; hPutStr handle?? name) &gt;&gt;\n    hClose handle??\n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1471330797, "post_id": 38968279, "comment_id": 65290939, "body": "The key question is that can you write <code>f</code> with a type signature?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1471331275, "post_id": 38968279, "comment_id": 65291188, "body": "@Clinton Still not a great signature, but a bit better. At least it can be used elegantly with visible type application"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1471333366, "last_edit_date": 1471333366, "creation_date": 1471330158, "answer_id": 38968279, "question_id": 38967704, "link": "https://stackoverflow.com/questions/38967704/constraining-instances/38968279#38968279", "title": "Constraining instances", "body": "<p>Hmmm... I'm not sure this is the best approach, but here is a direct improvement of what you have. In particular, I think using associated types makes things cleaner...</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, \n             ConstraintKinds,\n             FlexibleInstances,\n             TypeFamilyDependencies #-}\n\nimport GHC.Exts (Constraint)\n\nclass CategoryLike p where\n  type CategoryLikeT p a b = t | t -&gt; p a b\n  type CategoryConstraints p a b :: Constraint\n  type CategoryConstraints p a b = ()\n  (&gt;&gt;&gt;) :: (CategoryConstraints p a b, CategoryConstraints p b c, CategoryConstraints p a c) \n    =&gt; CategoryLikeT p a b -&gt; CategoryLikeT p b c -&gt; CategoryLikeT p a c\n\ndata BasicFunction\ninstance CategoryLike BasicFunction where\n  type CategoryLikeT BasicFunction a b = a -&gt; b\n  (&gt;&gt;&gt;) = flip (.)\n\ndata BasicInt\ninstance CategoryLike BasicInt where\n  type CategoryLikeT BasicInt Int Int = Int\n  type CategoryConstraints BasicInt a b = (a ~ Int, b ~ Int)\n  (&gt;&gt;&gt;) = (+)\n</code></pre>\n\n<p>So, this is what <code>f</code> looks like now: (I'm writing it with an explicit forall because that makes it a candidate for using <code>TypeApplications</code>)</p>\n\n<pre><code>f :: forall p a b c d. (\n    CategoryLike p,\n    CategoryConstraints p a b,\n    CategoryConstraints p b c,\n    CategoryConstraints p a c,\n    CategoryConstraints p a d,\n    CategoryConstraints p d b\n  ) =&gt; CategoryLikeT p a d -&gt; \n       CategoryLikeT p d b -&gt;\n       CategoryLikeT p b c -&gt;\n       CategoryLikeT p a c\nf x y z = x &gt;&gt;&gt; y &gt;&gt;&gt; z\n</code></pre>\n\n<p>To use it, I can do something like this (which looks surprisingly nice):</p>\n\n<pre><code>ghci&gt; :set -XTypeApplications\nghci&gt; :t f @BasicFunction (+1) id show\nf @BasicFunction (+1) id show :: (Show a, Num a) =&gt; a -&gt; [Char]\nghci&gt; :t f @BasicInt 1 2 3\nf @BasicInt 1 2 3 :: Int\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 2, "accepted_answer_id": 38968279, "answer_count": 1, "score": 1, "last_activity_date": 1471333366, "creation_date": 1471327859, "question_id": 38967704, "link": "https://stackoverflow.com/questions/38967704/constraining-instances", "title": "Constraining instances", "body": "<p>Lets say we've got the following:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n\ntype family CategoryLikeT p_a_b = t | t -&gt; p_a_b\n\ntype IsCategoryLike p t a b = (t ~ CategoryLikeT (p, a, b))\n\nclass CategoryLike p where\n  (&gt;&gt;&gt;) :: \n    (\n      IsCategoryLike p t1 a b, \n      IsCategoryLike p t2 b c, \n      IsCategoryLike p t3 a c\n    ) =&gt; t1 -&gt; t2 -&gt; t3\n</code></pre>\n\n<p>We then find that this compiles fine:</p>\n\n<pre><code>f :: \n  (\n    CategoryLike p, \n    IsCategoryLike p t1 a b, \n    IsCategoryLike p t2 b c, \n    IsCategoryLike p t3 c d, \n    IsCategoryLike p t4 a d\n  ) =&gt; t1 -&gt; t2 -&gt; t3 -&gt; t4\nf x y z = x &gt;&gt;&gt; y &gt;&gt;&gt; z\n</code></pre>\n\n<p>But we haven't defined any instances yet. Lets do that:</p>\n\n<pre><code>data BasicFunction\ntype instance CategoryLikeT (BasicFunction, a, b) = a -&gt; b\n\ninstance CategoryLike BasicFunction where\n  (&gt;&gt;&gt;) = flip (.)\n</code></pre>\n\n<p>But also \"Ints\" under addition are kind of category like, if we just assume \"a\" and \"b\" are both <code>Void</code>, for example:\n    data BasicInt\n    type instance CategoryLikeT (BasicInt, Void, Void) = Int</p>\n\n<pre><code>instance CategoryLike BasicFunction where\n  (&gt;&gt;&gt;) = (+)\n</code></pre>\n\n<p>Of course the above doesn't work, because there's no constraints on \"a\" or \"b\" in the instance definition, so there's no guarentee <code>&gt;&gt;&gt;</code> gets all the same type, hence <code>(+)</code> is not general enough. So what I considered is doing the following:</p>\n\n<p>Firstly, adding a constraint type:</p>\n\n<pre><code>type family CategoryConstraints p t a b\n</code></pre>\n\n<p>And then adding to the definition of <code>IsCategoryLike</code> like the following:</p>\n\n<pre><code>type IsCategoryLike p t a b = \n  (t ~ CategoryLikeT (p, a, b), CategoryConstraints p t)\n</code></pre>\n\n<p>We can then add the following constraint:</p>\n\n<pre><code>type instance CategoryConstraints BasicInt t = (t ~ Int)\n</code></pre>\n\n<p>But now we have a problem. <code>f</code> no longer works, giving this error:</p>\n\n<pre><code>Could not deduce: CategoryConstraints p (CategoryLikeT (p, a, c)))\n</code></pre>\n\n<p>We can fix this in two ways:</p>\n\n<p>Firstly, by adding <code>IsCategoryLike p t5 a c</code> to the constraints in <code>f</code>. But this could get very messy quickly for more complex functions, you'd have to add a constraint for each operation. Also trivial changes, like changing <code>(x &gt;&gt;&gt; y) &gt;&gt;&gt; z</code> to <code>x &gt;&gt;&gt; (y &gt;&gt;&gt; z)</code> require a change in the signature, which wasn't required when one did not have the constraints.</p>\n\n<p>Alternatively, the type signature could be omitted entirely, or partial type signatures could be used.</p>\n\n<p>However, I'd like to retain full type signatures without then growing and being hard to maintain. Can people suggest alternate approaches?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1471311236, "post_id": 38965291, "comment_id": 65285349, "body": "I have answered the question in your title. However, much of the rest of your question is difficult to understand. I&#39;m not sure what &quot;I am intending to get the index of parameter and use it to deprecate list such that parameter is the last element, then reverse it and take the second element of reversed list.&quot; means. I suggest that you break this down into small pieces and write code for each piece separately. As you build up your code, you will eventually get a complete solution."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471310884, "post_id": 38965337, "comment_id": 65285284, "body": "Small nit: this crashes and burns for one element lists. :)"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471310924, "post_id": 38965337, "comment_id": 65285294, "body": "@Alec Oops. Thanks for the catch. Added another case."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1471327437, "post_id": 38965337, "comment_id": 65289333, "body": "Consider <code>precedingElement elt xs = lookup elt (zip (drop 1 xs) xs)</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1471354208, "post_id": 38965337, "comment_id": 65305610, "body": "If you put the <code>(x:y:rest)</code> case first, the second (and last) case can simply be <code>precedingElement _ _ = Nothing</code>."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 5, "last_activity_date": 1471310911, "last_edit_date": 1471310911, "creation_date": 1471310840, "answer_id": 38965337, "question_id": 38965291, "link": "https://stackoverflow.com/questions/38965291/find-the-preceding-element-of-an-element-in-list-haskell/38965337#38965337", "title": "Find the preceding element of an element in list (Haskell)", "body": "<p>In order to return the preceding element of the given element, you can use some pattern matching and recursion:</p>\n\n<pre><code>precedingElement _ [] = Nothing\nprecedingElement _ [x] = Nothing\nprecedingElement elt (x:y:rest)\n    | y == elt = Just x\n    | otherwise = precedingElement elt (y:rest)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1471319311, "post_id": 38966323, "comment_id": 65287125, "body": "This looks slick. I&#39;m really starting to like these. One question though: why <code>(`seq` Nothing)</code> and not <code>(const Nothing)</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471328934, "post_id": 38966323, "comment_id": 65289981, "body": "Note that <code>lastBefore (==0) [0,1,0,2,3]</code> will return <code>Just 1</code>  unlike the answer by Code-apprentice. Changing either answer to behave as the other one is trivial, though. (Still, I&#39;m not yet a fan of the foldr-with-four-arguments pattern -- even if I do use it sometimes.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471363126, "post_id": 38966323, "comment_id": 65311642, "body": "@Alec, it may not matter, but I&#39;ve learned that making strictness very consistent can help the optimizer. Using <code>seq</code> there ensures that the <code>Maybe</code> produced will always be demanded. That may or may not ever matter, but it makes me feel better."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1471319041, "creation_date": 1471319041, "answer_id": 38966323, "question_id": 38965291, "link": "https://stackoverflow.com/questions/38965291/find-the-preceding-element-of-an-element-in-list-haskell/38966323#38966323", "title": "Find the preceding element of an element in list (Haskell)", "body": "<p>As I'm a big fold fan, I might write something like</p>\n\n<pre><code>lastBefore :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\nlastBefore p xs = foldr go (`seq` Nothing) xs Nothing\n  where\n    go x r (Just prev) | p x = Just prev\n    go x r _ = r (Just x)\n</code></pre>\n\n<p>But I'd have to check that GHC optimizes it as I wish.</p>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 9, "last_activity_date": 1471352898, "last_edit_date": 1495535627, "creation_date": 1471336689, "answer_id": 38970195, "question_id": 38965291, "link": "https://stackoverflow.com/questions/38965291/find-the-preceding-element-of-an-element-in-list-haskell/38970195#38970195", "title": "Find the preceding element of an element in list (Haskell)", "body": "<p>One of my favourite underappreciated utilities is rather handy for problems like this. Let me have backward lists, so I don't need to reverse my brain.</p>\n\n<pre><code>data Bwd x = B0 | Bwd x :&lt; x  -- rightmost is nearest\n</code></pre>\n\n<p>Think of list elements as the beads on an abacus wire. Flick a few to the left and leave your finger resting on the next one. What have you? A list of beads to the left of your finger (with the rightmost nearest), a list of beads to the right of your finger (with the leftmost nearest), and the bead with your finger on it.</p>\n\n<p>That is, a <em>one-hole element context</em> for lists is given by the pair of backward and forward lists either side of the hole.</p>\n\n<pre><code>type ListContext x = (Bwd x, [x])\n</code></pre>\n\n<p>Those who know my old songs recognize <code>ListContext</code> as the <em>derivative</em> of <code>[]</code>.</p>\n\n<p>An element in focus (your finger on a bead) is</p>\n\n<pre><code>type ListFocus x = (ListContext x, x)\n</code></pre>\n\n<p>And there is a useful operation which decorates every list element with its context, putting it in focus.</p>\n\n<pre><code>focus :: [x] -&gt; [ListFocus x]\nfocus = go B0 where\n  go xz [] = []\n  go xz (x : xs) = ((xz, xs), x) : go (xz :&lt; x) xs\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>focus [1,2,3] = [((B0,[2,3]),1), ((B0 :&lt; 1,[3]),2), ((B0 :&lt; 1 :&lt; 2,[]),3)]\n</code></pre>\n\n<p>and now it is very easy to answer all sorts of questions that concern an element and its immediate surroundings. You mightn't construct <code>focus</code> just to solve this problem, but it's the sort of thing I keep around because it solves lots of problems.</p>\n\n<pre><code>[p | ((_ :&lt; p,_),q) &lt;- focus xs, q == x]\n</code></pre>\n\n<p>computes all the values <code>p</code> which sit to the left of an <code>x</code> in <code>xs</code>. <em>As you can see.</em></p>\n\n<p>(By the way, this <code>focus</code> operation didn't come from nowhere. It arises from the differential structure of the datatype of lists. <a href=\"https://stackoverflow.com/a/12872133/828361\">This answer</a> (where it is called <code>picks</code>) tells the list story in more detail, and <a href=\"https://stackoverflow.com/a/25572148/828361\">this answer</a> develops the datatype generic story.)</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6722421, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/536ea0e65e5491dbcb9480f9bb180838?s=128&d=identicon&r=PG", "display_name": "user6722421", "link": "https://stackoverflow.com/users/6722421/user6722421"}, "is_accepted": false, "score": 1, "last_activity_date": 1471357742, "creation_date": 1471357742, "answer_id": 38977598, "question_id": 38965291, "link": "https://stackoverflow.com/questions/38965291/find-the-preceding-element-of-an-element-in-list-haskell/38977598#38977598", "title": "Find the preceding element of an element in list (Haskell)", "body": "<p>Sort-of standard solution for this is to use zipping:</p>\n\n<pre><code>import Data.List (find)\n\npreceding :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\npreceding f xs = fmap snd . find (f . fst) $ zip (drop 1 xs) xs\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 1, "accepted_answer_id": 38965337, "answer_count": 4, "score": 2, "last_activity_date": 1471357742, "creation_date": 1471310484, "question_id": 38965291, "link": "https://stackoverflow.com/questions/38965291/find-the-preceding-element-of-an-element-in-list-haskell", "title": "Find the preceding element of an element in list (Haskell)", "body": "<p>I want to return the preceding element of an element in list. I am intending to get the index of parameter and use it to deprecate list such that parameter is the last element, then reverse it and take the second element of reversed list.\nI get error: type <code>elemIndex</code> is <code>Maybe Int</code> while <code>take</code> function require <code>Int</code>. I want to fix it or write code using simple recursion\nAre there a shorter code using recursion?</p>\n\n<pre><code>precedingElement :: Eq a =&gt; a -&gt; [a] -&gt; Maybe a\nprecedingElement elt lst    | lst == [] = error \"List is empty\"\n                            | elt `notElem` lst = Nothing\n                            | otherwise = Just x where x = snd (reverse (take (elt `elemIndex` lst) lst))\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 2, "creation_date": 1471310617, "post_id": 38964994, "comment_id": 65285244, "body": "&quot;do&quot; is syntactic sugar for <i>Monads</i>. The &quot;real&quot;, underlying version is <code>main = getLine &gt;&gt;= \\number -&gt; case ...</code>. But you should first learn about <i>Functors</i> and <i>Applicative</i>. These are the search terms to get you started. Teaser: <code>main = (maybe &quot;False&quot; useTheValue . readMaybe) &lt;$&gt; getLine</code>"}, {"owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471334834, "post_id": 38964994, "comment_id": 65293153, "body": "Thank it is definitely on the road map."}], "answers": [{"comments": [{"owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "edited": false, "score": 0, "creation_date": 1471308714, "post_id": 38965041, "comment_id": 65284864, "body": "This is very nice. however, this will still not work with the bind operator am i right?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "edited": false, "score": 0, "creation_date": 1471309048, "post_id": 38965041, "comment_id": 65284926, "body": "Why do you want to use the bind operator? But if you feel you must, I&#39;ve updated the answer."}, {"owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "edited": false, "score": 0, "creation_date": 1471309113, "post_id": 38965041, "comment_id": 65284936, "body": "I just didn&#39;t know how and what to use and when. Thank you very much for  your time!"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1471310568, "post_id": 38965041, "comment_id": 65285239, "body": "IMO this is better without the <code>res &lt;- return ...</code> section. If someone really really wants to use <code>&lt;-</code> instead of <code>let</code>, it&#39;s better to explain why that&#39;s silly than it is to show how to do it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471316247, "post_id": 38965041, "comment_id": 65286439, "body": "I agree it&#39;s not the way I would prefer to write it, and I&#39;ve updated that section a bit. I think a discussion of <code>let</code> vs. <code>... &lt;- return ...</code> deserves it&#39;s own SO question. Out of curiosity I did a code search on Hackage and found a surprisingly large number of instances of  immediately binding a return value: <a href=\"http://lpaste.net/177514\" rel=\"nofollow noreferrer\">lpaste.net/177514</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471316943, "post_id": 38965041, "comment_id": 65286590, "body": "Well - lpaste truncated that pastebin, so here&#39;s the full version: <a href=\"https://gist.github.com/erantapaa/cbf816c28d4b8fe5da93deb4988300ec\" rel=\"nofollow noreferrer\"><b>(link)</b></a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1471315528, "last_edit_date": 1471315528, "creation_date": 1471308357, "answer_id": 38965041, "question_id": 38964994, "link": "https://stackoverflow.com/questions/38964994/pattern-match-on-function-result/38965041#38965041", "title": "Pattern match on function result", "body": "<p>In Haskell <code>read</code> throws an exception if there is a parse error.</p>\n\n<p>But there is <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-Read.html#v:readMaybe\" rel=\"nofollow\"><code>readMaybe</code></a> which will return a Maybe value.</p>\n\n<pre><code>import Text.Read\n\nmain = do\n  number &lt;- getLine\n  let res = case (readMaybe number :: Maybe Int) of\n              Just x -&gt; \"True\"\n              Nothing -&gt; \"False\"\n  putStrLn res\n</code></pre>\n\n<p>Note the use of <code>let</code> instead of monadic bind operator <code>&lt;-</code> since <code>readMaybe</code> is a pure function.</p>\n\n<p>You might even be able to avoid the type hint if you use the parsed\nvalue in a way which allows the compiler to infer its type, e.g.:</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n  -- any list will do\n\nmain = do\n  number &lt;- getLine\n  case readMaybe number of\n    Nothing -&gt; putStrLn \"bad number\"\n    Just n  -&gt; print (fibs !! n)\n</code></pre>\n\n<p>No type annotation is needed here because <code>!!</code> take an <code>Int</code> argument,\nand so <code>n</code> must have type <code>Int</code>\nwhich means <code>readMaybe number</code> must have type <code>Maybe Int</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Stylistically I would recommend that you use <code>let</code> here - using\nbind is completely unnecessary as you are computing a pure value.</p>\n\n<p>However, you can write this with the bind operator by using <code>return</code>:</p>\n\n<pre><code>main = do\n  number &lt;- getLine\n  res &lt;- return $ case (readMaybe number :: Maybe Int) of\n                    Just _ -&gt; \"True\"\n                    Nothing -&gt; \"False\"\n  putStrLn res\n</code></pre>\n"}], "owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 38965041, "answer_count": 1, "score": 0, "last_activity_date": 1471315528, "creation_date": 1471307982, "last_edit_date": 1471308653, "question_id": 38964994, "link": "https://stackoverflow.com/questions/38964994/pattern-match-on-function-result", "title": "Pattern match on function result", "body": "<p>I am trying to do match on function result \non scala it will look like this </p>\n\n<pre><code>validate(number) match {\ncase true =&gt; \"true\"\ncase false =&gt; \"false\"\n}\n</code></pre>\n\n<p>I am trying to do something similar in haskell</p>\n\n<pre><code>main = do    \n    number &lt;- getLine  \n    res &lt;- case (validate (read number::Int)) of \n        (True) -&gt; \"True\"\n        (False) -&gt; \"False\"\n    putStrLn res\n</code></pre>\n\n<p>Also I understand I can do with out the <code>do</code> notation, but not sure where to start.</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471318401, "post_id": 38962964, "comment_id": 65286924, "body": "A parser is <i>not</i> the right tool for &quot;find the first occurrence of x in a sequence of y&quot;. You should parse the entire string into a data structure which stores (key,value) pairs along with the position at which they occured. Your current problem is <code>t6</code> contains two key/value pairs (one in the entire string, one in a suffix) so naturally a backtracking parser finds both. Parsing each key unconditionally fixes this. With attoparsec, you are limited to getting the position as a byte index, but this should be sufficient for your purposes."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1471298167, "creation_date": 1471298167, "answer_id": 38963667, "question_id": 38962964, "link": "https://stackoverflow.com/questions/38962964/parsing-the-first-occurrence-of-a-word-that-is-not-precded-by-white-space/38963667#38963667", "title": "Parsing the first occurrence of a word that is not precded by white space", "body": "<p>Here's an approach to consider:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\n\nimport Data.Attoparsec.Text.Lazy\nimport Data.Attoparsec.Combinator\nimport Data.Text hiding (foldr)\nimport qualified Data.Text.Lazy as L (Text, pack)\nimport Data.Monoid\n\nnatural = many1' digit\n\n-- manyTill anyChar (try $ char c &lt;* eof)\n\npair0 w = do\n  string (w &lt;&gt; \"\\t\")\n  n &lt;- natural\n  string \"\\n\"\n  return n\n\npair1 w = do\n  manyTill anyChar (try $ string (\"\\n\" &lt;&gt; w &lt;&gt; \"\\t\"))\n  n &lt;- natural\n  string \"\\n\"\n  return n\n\npair w = pair0 w &lt;|&gt; pair1 w\n\nt1 = \"hello\\t999\\nworld\\t\\900\"\nt2 = \"world\\t\\900\\nhello\\t999\\n\"\nt3 = \"world world\\t\\900\\nhello\\t999\\n\"\n\n-- * should fail\nt4 = \"world\\t\\900\\nhello world\\t999\\n\"\nt5 = \"hello world\\t999\\nworld\\t\\900\"\nt6 = \"world hello\\t999\\nworld\\t\\900\"\n\ntest t = parseTest (pair \"hello\") (L.pack t)\n\nmain = do\n  test t1; test t2; test t3\n  test t4; test t5; test t6\n</code></pre>\n\n<p>The idea is that <code>pair0</code> matches a pair with the given key at the beginning of the input and <code>pair1</code> matches the pair just after a newline.</p>\n\n<p>The key is the use of <code>manyTill anyChar (try p)</code> which will keep skipping\ncharacters until the parser <code>p</code> succeeds.</p>\n\n<p>(btw - I learned about this use of <code>manyTill</code> and <code>try</code> by reading an answer written by @Cactus.)</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 38963667, "answer_count": 1, "score": 0, "last_activity_date": 1471298167, "creation_date": 1471294710, "question_id": 38962964, "link": "https://stackoverflow.com/questions/38962964/parsing-the-first-occurrence-of-a-word-that-is-not-precded-by-white-space", "title": "Parsing the first occurrence of a word that is not precded by white space", "body": "<p><strong>Setting</strong></p>\n\n<p>I need to find the first occurrence of a word in some .txt file that is not preceded by white space. Here are the possible cases:</p>\n\n<pre><code>-- * should succed\nt1 = \"hello\\t999\\nworld\\t\\900\"\nt2 = \"world\\t\\900\\nhello\\t999\\n\"\nt3 = \"world world\\t\\900\\nhello\\t999\\n\"\n\n-- * should fail\nt4 = \"world\\t\\900\\nhello world\\t999\\n\"\nt5 = \"hello world\\t999\\nworld\\t\\900\"\nt6 = \"world hello\\t999\\nworld\\t\\900\"\n</code></pre>\n\n<p>Right now t6 is succeeding even though it should fail, because my parser will consume any character until it reaches hello. Here is my parser:</p>\n\n<p><strong>My Solution</strong></p>\n\n<pre><code>import Control.Applicative\n\nimport Data.Attoparsec.Text.Lazy\nimport Data.Attoparsec.Combinator\nimport Data.Text hiding (foldr)\nimport qualified Data.Text.Lazy as L (Text, pack)\n\n\n\n-- * should succed\nt1 = L.pack \"hello\\t999\\nworld\\t\\900\"\nt2 = L.pack \"world\\t\\900\\nhello\\t999\\n\"\n\n-- * should fail\nt3 = L.pack \"world\\t\\900\\nhello world\\t999\\n\"\nt4 = L.pack \"hello world\\t999\\nworld\\t\\900\"\nt5 = L.pack \"world hello\\t999\\nworld\\t\\900\"\n\np = occur \"hello\"    \n\n---- * discard all text until word `w` occurs, and find its only field `n`\noccur :: String -&gt; Parser (String, Int)\noccur w = do\n    pUntil w\n    string . pack $ w\n    string \"\\t\"\n    n &lt;- natural \n    string \"\\n\"\n    return (w, read n)\n\n\n-- * Parse a natural number\nnatural :: Parser String\nnatural = many1' digit\n\n-- * skip over all words in Text stream until the word we want\npUntil :: String -&gt; Parser String \npUntil = manyTill anyChar . lookAhead . string . pack \n</code></pre>\n"}, {"tags": ["haskell", "nested", "parsec", "either"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1471286299, "post_id": 38960671, "comment_id": 65276415, "body": "You probably want to use <code>hPutStrLn stderr</code> in place of <code>putStrLn</code> in the <code>Left</code> case, so that the error message goes to standard error instead of standard output."}, {"owner": {"reputation": 96, "user_id": 5532658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7ecad777531a7b7da0c234468e336d?s=128&d=identicon&r=PG&f=1", "display_name": "sham1", "link": "https://stackoverflow.com/users/5532658/sham1"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471286944, "post_id": 38960671, "comment_id": 65276737, "body": "@chepner, probably. I am just doing what the OP is doing. But yeah, better to use <code>hPutStrLn stderr</code> in case of error messages."}, {"owner": {"reputation": 255, "user_id": 1788453, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f438272f4e0a03a70f300301da669e62?s=128&d=identicon&r=PG", "display_name": "Patrik", "link": "https://stackoverflow.com/users/1788453/patrik"}, "edited": false, "score": 1, "creation_date": 1471287146, "post_id": 38960671, "comment_id": 65276845, "body": "Cannot use <code>&gt;&gt;=</code> in this case since the types of <code>lparse</code> and <code>intrp</code> are different. i.e <code>lparse   :: SourceName -&gt; String -&gt; Either ParseError [([Char], Stmt)]</code> and <code>intrp :: [([Char], Stmt)] -&gt; Either IntrpError Stmt</code>"}, {"owner": {"reputation": 96, "user_id": 5532658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7ecad777531a7b7da0c234468e336d?s=128&d=identicon&r=PG&f=1", "display_name": "sham1", "link": "https://stackoverflow.com/users/5532658/sham1"}, "reply_to_user": {"reputation": 255, "user_id": 1788453, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f438272f4e0a03a70f300301da669e62?s=128&d=identicon&r=PG", "display_name": "Patrik", "link": "https://stackoverflow.com/users/1788453/patrik"}, "edited": false, "score": 0, "creation_date": 1471287276, "post_id": 38960671, "comment_id": 65276931, "body": "@Patrik, care to provide the types in the opening message?"}, {"owner": {"reputation": 255, "user_id": 1788453, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f438272f4e0a03a70f300301da669e62?s=128&d=identicon&r=PG", "display_name": "Patrik", "link": "https://stackoverflow.com/users/1788453/patrik"}, "edited": false, "score": 0, "creation_date": 1471287471, "post_id": 38960671, "comment_id": 65277035, "body": "@sham1, added it in the comment above and edited the original post."}], "tags": [], "owner": {"reputation": 96, "user_id": 5532658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7ecad777531a7b7da0c234468e336d?s=128&d=identicon&r=PG&f=1", "display_name": "sham1", "link": "https://stackoverflow.com/users/5532658/sham1"}, "is_accepted": false, "score": 2, "last_activity_date": 1471285206, "creation_date": 1471285206, "answer_id": 38960671, "question_id": 38960583, "link": "https://stackoverflow.com/questions/38960583/haskell-handling-resulting-either-from-computations/38960671#38960671", "title": "Haskell: Handling resulting Either from computations", "body": "<p>Well, if you want to chain successful computations, you can always use <code>&gt;&gt;=</code> to do that. For instance in your case:</p>\n\n<pre><code>lparse (head fname) input &gt;&gt;= intrp\n</code></pre>\n\n<p>And if you want to print out either your error message you can use the <code>either</code> class that takes two handler functions, one for the case when you have <code>Left a</code> (error in your case) and another for <code>Right b</code> (in your case a successful thing). An example:</p>\n\n<pre><code>either (putStrLn . show) (putStrLn . show) (lparse (head fname) input &gt;&gt;= intrp)\n</code></pre>\n\n<p>And if anything fails in your chain (any step of your monadic chain becomes <code>Left a</code>) it stops and can for instance print out the error message in the above case.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 4, "last_activity_date": 1471293299, "creation_date": 1471293299, "answer_id": 38962627, "question_id": 38960583, "link": "https://stackoverflow.com/questions/38960583/haskell-handling-resulting-either-from-computations/38962627#38962627", "title": "Haskell: Handling resulting Either from computations", "body": "<p>While not perfect, I'd create a helper function for embedding any <code>Show</code>able error from <code>Either</code> into <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Except.html\" rel=\"nofollow\"><code>MonadError</code></a>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Monad.Except\n\nstrErr :: (MonadError String m, Show e) =&gt; Either e a -&gt; m a\nstrErr = either (throwError . show) return\n</code></pre>\n\n<p>Then if you have a computation that can fail with errors, like</p>\n\n<pre><code>someFn :: ExceptT String IO ()\nsomeFn = strErr (Left 42)\n</code></pre>\n\n<p>you can run it (printing errors to <em>stdout</em>) as</p>\n\n<pre><code>main :: IO ()\nmain = runExceptT someFn &gt;&gt;= either putStrLn return\n</code></pre>\n\n<p>In your case it'd be something like</p>\n\n<pre><code>main = either putStrLn return &lt;=&lt; runExceptT $ do\n  fname &lt;- liftIO getArgs\n  input &lt;- liftIO $ readFile (head fname)\n  prog &lt;- strErr $ lparse (head fname) input\n  r &lt;- strErr $ interp prog\n  print r\n</code></pre>\n"}], "owner": {"reputation": 255, "user_id": 1788453, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f438272f4e0a03a70f300301da669e62?s=128&d=identicon&r=PG", "display_name": "Patrik", "link": "https://stackoverflow.com/users/1788453/patrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 1, "accepted_answer_id": 38962627, "answer_count": 2, "score": 2, "last_activity_date": 1471293299, "creation_date": 1471284851, "last_edit_date": 1471287404, "question_id": 38960583, "link": "https://stackoverflow.com/questions/38960583/haskell-handling-resulting-either-from-computations", "title": "Haskell: Handling resulting Either from computations", "body": "<p>I have revisited Haskell lateley and constructed a toy programming language parser/interpreter. Using Parsec for lexing and parsing and a separate interpreter. I'm running in to some issues with feeding the result from the parser to my interpreter and handle the potential error from both the interpreter and parser. I end up with something like this:</p>\n\n<pre><code>main = do\n  fname &lt;- getArgs\n  input &lt;- readFile (head fname)\n  case lparse (head fname) input of\n    Left msg -&gt; putStrLn $ show msg\n    Right p -&gt; case intrp p of\n      Left msg -&gt; putStrLn $ show msg\n      Right r -&gt; putStrLn $ show r\n</code></pre>\n\n<p>This dosn't look pretty at all. My problem is that <code>lparse</code> returns <code>Either ParseError [(String, Stmt)]</code> and <code>itrp</code> returns the type <code>Either ItrpError Stmt</code> so I'm having a real hard time feeding the <code>Right</code> result from the parser to the interpreter and at the same time bail and print the possible <code>ParseError</code> or <code>IntrpError</code>.</p>\n\n<p>The closest to what i want is something like this</p>\n\n<pre><code>main = do\n  fname &lt;- getArgs\n  input &lt;- readFile (head fname)\n  let prog = lparse (head fname) input\n  (putStrLn . show) (intrp &lt;$&gt; prog)\n</code></pre>\n\n<p>But this will not surprisingly yield a nested Either and not print pretty either.</p>\n\n<p>So are there any nice Haskell ideomatic way of doing this threading results from one computation to another and handling errors (<code>Lefts</code>) in a nice way without nesting cases?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>adding types of <code>lparse</code> and <code>itrp</code></p>\n\n<pre><code>lparse :: Text.Parsec.Pos.SourceName -&gt; String -&gt; Either Text.Parsec.Error.ParseError [([Char], Stmt)]\n\nintrp :: [([Char], Stmt)] -&gt; Either IntrpError Stmt\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1471280432, "post_id": 38959402, "comment_id": 65273365, "body": "I guess, &quot;*.txt&quot; is getting expanded by the shell in first case?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471281191, "post_id": 38959402, "comment_id": 65273743, "body": "You should be able to use: <code>readProcess... &quot;grep&quot; [&quot;-r&quot;, &quot;-e&quot;, &quot;answer&quot;]</code>. Also see my updated answer."}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1471282470, "post_id": 38959551, "comment_id": 65274381, "body": "Yes ! It works with <code>&quot;--include&quot;, &quot;*.txt&quot;</code> instead of <code>&quot;--include=\\\\*.txt&quot;</code>. That was the problem, there&#39;s no problem with <code>.</code> (for me)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1471283198, "post_id": 38959551, "comment_id": 65274765, "body": "It turns out I have an older version of <code>grep</code> - newer ones automatically assume <code>.</code> if you use <code>-r</code> with no directories."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1471281136, "last_edit_date": 1471281136, "creation_date": 1471280573, "answer_id": 38959551, "question_id": 38959402, "link": "https://stackoverflow.com/questions/38959402/how-to-use-readprocesswithexitcode/38959551#38959551", "title": "How to use readProcessWithExitCode?", "body": "<p>Are you sure that this command work in your terminal:</p>\n\n<pre><code>grep --include=\\\\*.txt --recursive --regexp='answer'\n</code></pre>\n\n<p>On my system I get the warning:</p>\n\n<pre><code>grep: warning: recursive search of stdin\n</code></pre>\n\n<p>Try adding <code>.</code> as an additional argument:</p>\n\n<pre><code>readProcessWithExitCode \"grep\" [\"--include=\\\\*.txt\", \"--recursive\", \"--regexp='answer'\", \".\"] \"\"\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>This simpler way of passing arguments to <code>grep</code> works for me:</p>\n\n<pre><code>readProcessWithExitCode \"grep\" [\"--include\", \"*.hs\", \"--recursive\", \"--regexp\", \"answer\", \".\"] \"\"\n</code></pre>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 38959551, "answer_count": 1, "score": 0, "last_activity_date": 1471281136, "creation_date": 1471279980, "last_edit_date": 1471280807, "question_id": 38959402, "link": "https://stackoverflow.com/questions/38959402/how-to-use-readprocesswithexitcode", "title": "How to use readProcessWithExitCode?", "body": "<p>This command runs fine in my terminal:</p>\n\n<pre><code>grep --include=\\\\*.txt --recursive --regexp='answer'\n</code></pre>\n\n<p>This one runs fine in ghci:</p>\n\n<pre><code>import System.Process\nr &lt;- readCreateProcessWithExitCode (shell \"grep --include=\\\\*.txt --recursive --regexp='answer'\") \"\"\n</code></pre>\n\n<p>But this one fails in ghci:</p>\n\n<pre><code>import System.Process\nr &lt;- readProcessWithExitCode \"grep\" [\"--include=\\\\*.txt\", \"--recursive\", \"--regexp='answer'\"] \"\"\n</code></pre>\n\n<p>It returns <code>(ExitFailure 1,\"\",\"\")</code>.</p>\n\n<p>Am I doing something bad?</p>\n\n<h2>Update</h2>\n\n<p>This one works:</p>\n\n<pre><code>readProcessWithExitCode \"grep\" [\"-r\", \"-e 'answer'\"]\n</code></pre>\n\n<p>It looks like one cannot set options starting with <code>--</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 220, "user_id": 2059388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tlv20.jpg?s=128&g=1", "display_name": "cody", "link": "https://stackoverflow.com/users/2059388/cody"}, "edited": false, "score": 0, "creation_date": 1471280332, "post_id": 38958895, "comment_id": 65273300, "body": "Possible typo: the definition of <code>Term</code>, does not refer to <code>Tree</code> in any way."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1471281190, "post_id": 38958895, "comment_id": 65273741, "body": "Try writing the instance manually and I think you will understand the problem."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 220, "user_id": 2059388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tlv20.jpg?s=128&g=1", "display_name": "cody", "link": "https://stackoverflow.com/users/2059388/cody"}, "edited": false, "score": 0, "creation_date": 1471282622, "post_id": 38958895, "comment_id": 65274470, "body": "@cody That was purposeful."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1471282671, "post_id": 38958895, "comment_id": 65274488, "body": "@ReidBarton Thanks, that was helpful."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1471284525, "post_id": 38959747, "comment_id": 65275459, "body": "<i>Caveat lector</i>: While <code>Eq1</code> (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Classes.html\" rel=\"nofollow noreferrer\">and friends</a>) is probably the right way to go about this, in present GHC you have to write out the instances by hand, which is rather tedious. I&#39;m hopeful that now <code>Data.Functor.Classes</code> is in <code>base</code> we&#39;ll get <code>deriving Eq1</code> in a forthcoming version of GHC."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1471284696, "post_id": 38959747, "comment_id": 65275555, "body": "<code>deriving-compat</code> has that functionality atm: <a href=\"http://hackage.haskell.org/package/deriving-compat-0.3.1/docs/Data-Eq-Deriving.html#v:makeLiftEq\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/deriving-compat-0.3.1/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1471284723, "last_edit_date": 1471284723, "creation_date": 1471281384, "answer_id": 38959747, "question_id": 38958895, "link": "https://stackoverflow.com/questions/38958895/how-to-derive-instances-in-recursion-schemes/38959747#38959747", "title": "How to derive instances in recursion schemes", "body": "<p>There are two solutions:</p>\n\n<p>Using some GHC extensions <code>StandaloneDeriving</code>, <code>UndecidableInstances</code> and some others you can write:</p>\n\n<pre><code>deriving instance (Eq (f (Term f))) =&gt; Eq (Term f)\n</code></pre>\n\n<p>This is what <a href=\"http://hackage.haskell.org/package/recursion-schemes-4.1.2/docs/Data-Functor-Foldable.html\" rel=\"noreferrer\"><code>recursion-schemes</code></a> does at the moment</p>\n\n<p>--</p>\n\n<p>Alternatively, you can use <code>Eq1</code> from <a href=\"http://hackage.haskell.org/package/transformers-0.5.1.0/docs/Data-Functor-Classes.html#t:Eq1\" rel=\"noreferrer\"><code>transformers</code></a> or <code>base-4.9.0.0</code></p>\n\n<pre><code>class Eq1 f where\n    liftEq :: (a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool\n\neq1 :: (Eq1 f, Eq a) -&gt; f a -&gt; f a -&gt; Bool\neq1 = liftEq (==)\n\ninstance Eq1 f =&gt; Eq (Term f) where\n    Term a == Term b = eq1 a b\n</code></pre>\n\n<p>Reference: <a href=\"https://github.com/ekmett/recursion-schemes/blob/ffada24f92efd5bcfe71f7f0af3b4af057f50bd0/Data/Functor/Foldable.hs#L392\" rel=\"noreferrer\">https://github.com/ekmett/recursion-schemes/blob/ffada24f92efd5bcfe71f7f0af3b4af057f50bd0/Data/Functor/Foldable.hs#L392</a></p>\n"}], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 1, "accepted_answer_id": 38959747, "answer_count": 1, "score": 5, "last_activity_date": 1471284723, "creation_date": 1471277963, "question_id": 38958895, "link": "https://stackoverflow.com/questions/38958895/how-to-derive-instances-in-recursion-schemes", "title": "How to derive instances in recursion schemes", "body": "<p>I am testing out some of the ideas in <a href=\"http://blog.sumtypeofway.com/an-introduction-to-recursion-schemes/\" rel=\"noreferrer\">this article</a>.</p>\n\n<p>I want to derive an instance of Eq for the type Term:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\ndata Tree a = Branch Int [a] | Leaf Int deriving (Eq, Functor, Show)\ndata Term f = Term (f (Term f)) deriving (Eq)\n</code></pre>\n\n<p>But get this error:</p>\n\n<pre><code>No instance for (Eq (f (Term f)))\n      arising from the first field of \u2018Term\u2019 (type \u2018f (Term f)\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (Eq (Term f))\n</code></pre>\n\n<p>I tried adding a standalone deriving instance:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE StandaloneDeriving #-}\ndata Tree a = Branch Int [a] | Leaf Int deriving (Eq, Functor, Show)\ndata Term f = Term (f (Term f))\nderiving instance (Eq f) =&gt; Eq (Term f)\n</code></pre>\n\n<p>But get this error:</p>\n\n<pre><code>The first argument of \u2018Term\u2019 should have kind \u2018* -&gt; *\u2019,\n  but \u2018f\u2019 has kind \u2018*\u2019\nIn the stand-alone deriving instance for \u2018(Eq f) =&gt; Eq (Term f)\u2019\n</code></pre>\n\n<p>Now I'm stuck. How do I show that f has a kind <code>* -&gt; *</code>? And why do I need a standalone deriving instance for <code>Term</code> but not <code>Tree</code>? Both have type variables that are not necessarily going to be instances of Eq? (<code>a</code> and <code>f</code>)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1471277437, "post_id": 38958700, "comment_id": 65271731, "body": "10 parameters?! that seems a bit excessive, you should definitely refactor... regarding your question: can you provide the type of the function you&#39;re looking for?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1471277586, "post_id": 38958700, "comment_id": 65271807, "body": "It seems excessive but it&#39;s a server and dealing with JSON parameters so it&#39;s most likely only going to grow unfortunately. I can&#39;t find a better way to manage that portion of the code. I can definitely provide type signatures, which function did you mean though?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1471278010, "post_id": 38958700, "comment_id": 65272010, "body": "If you change your code to use <code>Text</code> in one place but leave <code>String</code> everywhere else, then you 1. get the problem you&#39;ve run into, and 2. lose all hope of performance improvements. This is not a Haskell issue - this is a design issue. Use Text or String uniformly, or have an overloaded version of your function which operators on both types (this kills type inference), or don&#39;t use 10 string parameters so you don&#39;t incur the cost of adding <code>T.unpack</code> 10 times over."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471278180, "post_id": 38958700, "comment_id": 65272094, "body": "@user2407038 I&#39;m not using <code>Text</code> for the performance, this section of code interfaces between two systems. One needs <code>String</code>, one needs <code>Text</code> for various reasons. I&#39;m just asking about the generic here about applying a function to another functions arguments."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1471303911, "post_id": 38958700, "comment_id": 65283839, "body": "What about using <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-String.html\" rel=\"nofollow noreferrer\">Data.String</a> wouldn&#39;t that be useful, to abstract the &quot;stringyness&quot; oft the parameters."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1471316342, "post_id": 38958700, "comment_id": 65286461, "body": "@jkeuhlen If you really must, you can write a function like <code>Data.Function.on</code>, but for 10 parameters - however, this is little improvement over simply defining a new function as @Daniel Wagner suggested. If you make your ten parameters into a record (i.e. fix the design issues in your program) then write a function e.g. <code>mapOpts :: (a -&gt; b) -&gt; Opts a -&gt; Opts b</code> then the solution to your problem is simply function composition - <code>fxn . mapOpts T.unpack</code>. Writing a polyvariadic <code>on</code> function is fairly easy, but your problem has a <i>trivial</i> solution if you just fix the design issues."}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1471279792, "post_id": 38958949, "comment_id": 65272978, "body": "Thanks for the link, that&#39;s pretty helpful. This looks slightly cleaner but I was hoping to avoid defining new functions just for this transformation. Either way, thanks for the input!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1471278179, "creation_date": 1471278179, "answer_id": 38958949, "question_id": 38958700, "link": "https://stackoverflow.com/questions/38958700/how-can-i-apply-a-function-to-every-argument-of-another-function/38958949#38958949", "title": "How can I apply a function to every argument of another function?", "body": "<p>For dealing with the parameter proliferation, you may like the <a href=\"https://byorgey.wordpress.com/2010/04/03/haskell-anti-pattern-incremental-ad-hoc-parameter-abstraction/\" rel=\"noreferrer\">record parameter</a> pattern. This also makes it convenient to expose a new API with the same name while maintaining backwards compatibility.</p>\n\n<p>For the question as asked, it's usually simplest to define a short adapter like this:</p>\n\n<pre><code>fxnNew :: Text -&gt; ... -&gt; IO (Int, Text)\nfxnNew = ...\n\nfxn :: String -&gt; ... -&gt; IO (Int, String)\nfxn a ... i = fmap (fmap T.unpack) (fxnNew (T.pack a) ... (T.pack i))\n</code></pre>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 38958949, "answer_count": 1, "score": 0, "last_activity_date": 1471278179, "creation_date": 1471277267, "last_edit_date": 1471277764, "question_id": 38958700, "link": "https://stackoverflow.com/questions/38958700/how-can-i-apply-a-function-to-every-argument-of-another-function", "title": "How can I apply a function to every argument of another function?", "body": "<p>I have a function that takes 10 <code>String</code> parameters and during some refactoring, portions of the code have changed so now these parameters end up as <code>Text</code> when the function is called:</p>\n\n<pre><code>fxn :: String -&gt; ... -&gt; IO (Int, String)\nfxn a b c d e f g h i j = do something \n\n...\n\n-- Get parameters for fxn\nlet a = \"blah\" :: Text\n...\nfxn a b c ...\n</code></pre>\n\n<p>Ideally, I could refactor all of the code to use <code>Text</code>, but that is tedious and non ideal currently. I could also easily add a <code>T.unpack</code> to where I get the parameters for my function:</p>\n\n<pre><code>let a = T.unpack (\"blah\" :: Text)\n</code></pre>\n\n<p>But again, this is non ideal since this happens in several different places for large numbers of arguments and I'd prefer to keep the code cleaner than having dozens of <code>T.unpack</code> statements everywhere. </p>\n\n<p>Is there a way in haskell to either compose the functions so that the arguments are morphed, something like <code>(fxn . T.unpack) a b c ...</code>, or to apply the unpack function to every argument of the f function? This seems like a simple composition problem but I haven't been able to find a solution. </p>\n"}, {"tags": ["haskell", "agda", "gadt", "type-theory", "observational-type-theory"], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1471280606, "post_id": 38958859, "comment_id": 65273461, "body": "Thanks. I think I now understand the source of my confusion: I wrote a small <a href=\"https://github.com/effectfully/OTT\" rel=\"nofollow noreferrer\">library</a> for writing OTT in Agda and the problem I have is that Agda&#39;s unification is nailed to definitional equality and cannot handle fancy propositional equality, so I&#39;m trying to do some kind of &quot;intensionalization&quot; which is verbose and <a href=\"https://github.com/effectfully/OTT/blob/4b3966d9cce2324bce132243ce167ed932fccfa7/Property/Eq.agda#L107\" rel=\"nofollow noreferrer\">simpler</a> when a data type has decidable equality. But still cannot be done fully, of course. That&#39;s sad."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 15, "last_activity_date": 1471277815, "creation_date": 1471277815, "answer_id": 38958859, "question_id": 38957229, "link": "https://stackoverflow.com/questions/38957229/pattern-matching-in-observational-type-theory/38958859#38958859", "title": "Pattern matching in Observational Type Theory", "body": "<p>I guess I'll field this one. I find it a strange question, but that's because of my own particular journey. The short answer is: don't do pattern matching in OTT, or in any kernel type theory. Which is not the same thing as to not do pattern matching ever.</p>\n\n<p>The long answer is basically my PhD thesis.</p>\n\n<p>In my PhD thesis, I show how to elaborate high-level programs written in a pattern matching style into a kernel type theory which has only the induction principles for inductive datatypes and a suitable treatment of propositional equality. The elaboration of pattern matching introduces propositional equations on datatype indices, then solves them by unification. Back then, I was using an intensional equality, but observational equality gives you at least the same power. That is: my technology for elaborating pattern matching (and thus keeping it out of the kernel theory), hiding all the equational piggery-jokery, predates the upgrade to observational equality. The ghastly vlookup you've used to illustrate your point might correspond to the output of the elaboration process, but the input need not be that bad. The nice definition</p>\n\n<pre><code>vlookup : Fin n -&gt; Vec X n -&gt; X\nvlookup fz     (vcons x xs) = x\nvlookup (fs i) (vcons x xs) = vlookup i xs\n</code></pre>\n\n<p>elaborates just fine. The equation-solving that happens along the way is just the same equation-solving that Agda does at the meta-level when checking a definition by pattern matching, or that Haskell does. Don't be fooled by programs like</p>\n\n<pre><code>f :: a ~ b =&gt; a -&gt; b\nf x = x\n</code></pre>\n\n<p>In <em>kernel</em> Haskell, that elaborates to some sort of</p>\n\n<pre><code>f {q} x = coerce q x\n</code></pre>\n\n<p>but it's not in your face. And it's not in compiled code, either. OTT equality proofs, like Haskell equality proofs, can be erased before computing with <em>closed</em> terms.</p>\n\n<p><em>Digression.</em> To be clear about the status of equality data in Haskell, the GADT</p>\n\n<pre><code>data Eq :: k -&gt; k -&gt; * where\n  Refl :: Eq x x\n</code></pre>\n\n<p>really gives you</p>\n\n<pre><code>Refl :: x ~ y -&gt; Eq x y\n</code></pre>\n\n<p>but because the type system is not logically sound, type safety relies on strict pattern matching on that type: you can't erase <code>Refl</code> and you really must compute it and match it at run time, but you <em>can</em> erase the data corresponding to the proof of <code>x~y</code>. In OTT, the entire propositional fragment is proof-irrelevant for open terms and erasable for closed computation. <em>End of digression.</em></p>\n\n<p>The decidability of equality on this or that datatype is not especially relevant (at least, not if you have uniqueness of identity proofs; if you don't always have UIP, decidability is one way to get it sometimes). The equational problems which show up in pattern matching are on arbitrary <em>open</em> expressions. That's a lot of rope. But a machine can certainly decide the fragment which consists of first-order expressions built from variables and fully applied constructors (and that's what Agda does when you split cases: if the constraints are too weird, the thing just barfs). OTT should allow us to push a bit further into the decidable fragments of higher-order unification. If you know <code>(forall x. f x = t[x])</code> for unknown <code>f</code>, that's equivalent to <code>f = \\ x -&gt; t[x]</code>.</p>\n\n<p>So, \"no pattern matching in OTT\" has always been a deliberate design choice, as we always intended it to be an elaboration target for a translation we already knew how to do. Rather, it's a strict upgrade in kernel theory power.</p>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 739, "favorite_count": 3, "accepted_answer_id": 38958859, "answer_count": 1, "score": 15, "last_activity_date": 1471277815, "creation_date": 1471271915, "last_edit_date": 1471272472, "question_id": 38957229, "link": "https://stackoverflow.com/questions/38957229/pattern-matching-in-observational-type-theory", "title": "Pattern matching in Observational Type Theory", "body": "<p>In the end of the \"5. Full OTT\" section of <a href=\"http://strictlypositive.org/ott.pdf\">Towards Observational Type Theory</a> the authors show how to define coercible-under-constructors indexed data types in OTT. The idea is basically to turn indexed data types into parameterized like this:</p>\n\n<pre><code>data IFin : \u2115 -&gt; Set where\n  zero : \u2200 {n} -&gt; IFin (suc n)\n  suc  : \u2200 {n} -&gt; IFin n -&gt; IFin (suc n)\n\ndata PFin (m : \u2115) : Set where\n  zero : \u2200 {n} -&gt; suc n \u2261 m -&gt; PFin m\n  suc  : \u2200 {n} -&gt; suc n \u2261 m -&gt; PFin n -&gt; PFin m\n</code></pre>\n\n<p>Conor also mentions this technique at the bottom of <a href=\"https://pigworker.wordpress.com/2015/01/08/observational-type-theory-delivery/\">observational type theory (delivery)</a>:</p>\n\n<blockquote>\n  <p>The fix, of course, is to do what the GADT people did, and define\n  inductive families explicitly upto propositional equality. And then of\n  course you can transport them, by transisitivity.</p>\n</blockquote>\n\n<p>However a type checker in Haskell is aware of equality constraints in scope and actually uses them during type checking. E.g. we can write</p>\n\n<pre><code>f :: a ~ b =&gt; a -&gt; b\nf x = x\n</code></pre>\n\n<p>It doesn't work so in type theory, since it's not enough to have a proof of <code>a ~ b</code> in scope to be able to rewrite by this equation: that proof also must be <code>refl</code>, because in the presense of a false hypothesis type checking becomes undecidable due to termination issues (something like <a href=\"https://www.reddit.com/r/agda/comments/4veb5a/irrelevance_rewriting_extensionality/d5zfdbs\">this</a>). So when you pattern match on <code>Fin m</code> in Haskell <code>m</code> gets rewritten to <code>suc n</code> in each branch, but that can't happen in type theory, instead you're left with an explicit proof of <code>suc n ~ m</code>. In OTT it's not possible to pattern match on proofs at all, hence you can neither pretend the proof is <code>refl</code> nor actually require that. It's only possible to supply the proof to <code>coerce</code> or just ignore it.</p>\n\n<p>This makes it very hard to write anything that involves indexed data types. E.g. the usual three-lines (including the type signature) <code>lookup</code> for vectors becomes this beast:</p>\n\n<pre><code>vlookup\u2091 : \u2200 {n m a} {\u03b1 : Level a} {A : Univ \u03b1} -&gt; \u27e6 n \u2245 m \u21d2 fin n \u21d2 vec A m \u21d2 A \u27e7\nvlookup\u2091         p (fzero\u2091 q)       (vcons\u2091 r x xs)      = x\nvlookup\u2091 {n} {m} p (fsuc\u2091 {n\u2032} q i) (vcons\u2091 {m\u2032} r x xs) =\n  vlookup\u2091 (left (suc n\u2032) {m} {suc m\u2032} (trans (suc n\u2032) {n} {m} q p) r) i xs\nvlookup\u2091 {n} {m} p (fzero\u2091 {n\u2032} q)  (vnil\u2091 r)            =\n  \u22a5-elim $ left (suc n\u2032) {m} {0} (trans (suc n\u2032) {n} {m} q p) r\nvlookup\u2091 {n} {m} p (fsuc\u2091 {n\u2032} q i) (vnil\u2091 r)            =\n  \u22a5-elim $ left (suc n\u2032) {m} {0} (trans (suc n\u2032) {n} {m} q p) r\n\nvlookup : \u2200 {n a} {\u03b1 : Level a} {A : Univ \u03b1} -&gt; Fin n -&gt; Vec A n -&gt; \u27e6 A \u27e7\nvlookup {n} = vlookup\u2091 (refl n)\n</code></pre>\n\n<p>It could be a bit simplified, since if two elements of a data type that has decidable equality are observably equal, then they are also equal in the usual intensional sense, and natural numbers do have decidable equality, so we can coerce all the equations to their intensional counterparts and pattern match on them, but that would break some computational properties of <code>vlookup</code> and is verbose anyway. It's nearly impossible to deal in more complicated cases with indices which equality cannot be decided.</p>\n\n<p>Is my reasoning correct? How is pattern matching in OTT meant to work? If this is a problem indeed, are there any ways to mitigate it?</p>\n"}, {"tags": ["haskell", "clash"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471285727, "post_id": 38958946, "comment_id": 65276128, "body": "How would I define a type of data in a way that lets me use a value? The end goal is to get an unsigned value of size f(x) I.e. 5 :: Unsigned f(x)    if I understand you answer there would be no way of doing that because types and values are different."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471285781, "post_id": 38958946, "comment_id": 65276150, "body": "is <code>x</code> known at compiletime? types only exist at compiletime and then, when your program is run, are erased and gone and poof were never there all along"}, {"owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471286211, "post_id": 38958946, "comment_id": 65276370, "body": "It would not be known at compile time. The value f(x) would be determined during runtime."}, {"owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471291008, "post_id": 38958946, "comment_id": 65278868, "body": "I managed to redesign and restructure the code to know the values at run time. However I still have one value  f(x) I&#39;d like to compute. I can set the x to a type but I&#39;d like to compute f(x) automatically instead of by hand. This is ensure that we can make changes in the source code quickly."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471299486, "post_id": 38958946, "comment_id": 65282600, "body": "it is impossible, in general, to have types depend on runtime values"}, {"owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "edited": false, "score": 0, "creation_date": 1471375060, "post_id": 38958946, "comment_id": 65318463, "body": "I was able to do what I needed at compile time thanks to template Haskell."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1471278169, "creation_date": 1471278169, "answer_id": 38958946, "question_id": 38957113, "link": "https://stackoverflow.com/questions/38957113/removing-the-type-constraint-on-a-type-to-a-value-that-satisfies-the-constraints/38958946#38958946", "title": "Removing the type constraint on a type to a value that satisfies the constraints. I.e. Num a =&gt; a to just Int", "body": "<p>If I understand you correctly, you want to be able to reference variables as type-level naturals in your type signatures. For this you have to declare <code>x</code> as a type (<code>type</code> or <code>data</code>) rather than a value. It is this distinction between values and types that separates Haskell from the older stock of dependently-typed languages, where you would be able to freely reference declarations in types without worrying about the differences between values and types. So, try making your code look something like this:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\nmodule Lib where\n\nimport Data.Proxy\nimport GHC.TypeLits\n\ndata Unsigned (a :: Nat)\ntype X = 2\n\nmain :: IO ()\nmain =\n  print (Proxy :: Proxy (Unsigned X))\n</code></pre>\n\n\n\n<p>I fear that I do not know anything about Clash, however, so perhaps I do not have the whole picture.</p>\n"}], "owner": {"reputation": 329, "user_id": 968117, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8b8eb69f0ce6c574c6c913d2a33e3fe5?s=128&d=identicon&r=PG", "display_name": "error_null_pointer", "link": "https://stackoverflow.com/users/968117/error-null-pointer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 38958946, "answer_count": 1, "score": 3, "last_activity_date": 1471375007, "creation_date": 1471271516, "last_edit_date": 1471375007, "question_id": 38957113, "link": "https://stackoverflow.com/questions/38957113/removing-the-type-constraint-on-a-type-to-a-value-that-satisfies-the-constraints", "title": "Removing the type constraint on a type to a value that satisfies the constraints. I.e. Num a =&gt; a to just Int", "body": "<p>I am using a system called CLaSH. For those who are not familiar it is designed in a way that allows you to develop for FPGAs using Haskell.</p>\n\n<p>I am trying to create an Unsigned value.\u00a0</p>\n\n<p>Defined\u00a0at:\u00a0<a href=\"https://hackage.haskell.org/package/clash-prelude-0.10.11/docs/src/CLaSH-Sized-Internal-Unsigned.html#Unsigned\" rel=\"nofollow\">https://hackage.haskell.org/package/clash-prelude-0.10.11/docs/src/CLaSH-Sized-Internal-Unsigned.html#Unsigned</a></p>\n\n<p>Something like:\u00a0</p>\n\n<pre><code>2 :: Unsigned 3\n</code></pre>\n\n<p>works. I want to be able to do something like:</p>\n\n<pre><code>x = 3\n\n2::Unsigned x\n</code></pre>\n\n<p>But I get the error:</p>\n\n<p>No instance for (KnownNat x1) arising from the literal `2'</p>\n\n<p>\u00a0</p>\n\n<blockquote>\n  <p>Possible fix:</p>\n  \n  <p>\u00a0add (KnownNat x1) to the context of</p>\n  \n  <p>\u00a0an expression type signature: Unsigned x1</p>\n  \n  <p>\u00a0In the expression: 2 :: Unsigned x</p>\n  \n  <p>\u00a0In an equation for `it': it = 2 :: Unsigned x</p>\n</blockquote>\n\n<p>I then tried \"fromInteger#\" defined in the same file.\u00a0</p>\n\n<pre><code>let y=fromInteger# x\n</code></pre>\n\n<p>which returns the type</p>\n\n<pre><code>y :: KnownNat n =&gt; Unsigned n\n</code></pre>\n\n<p>With that 'y' I can give it a size by adding an unsigned with a specified size.\u00a0</p>\n\n<pre><code>y + (2 :: Unsigned 3)\n</code></pre>\n\n<p>which gives a\u00a0\n    5</p>\n\n<pre><code>it :: Unsigned 3\n</code></pre>\n\n<p>How do I get a something like\u00a0</p>\n\n<pre><code>2::Unsigned x\n</code></pre>\n\n<p>If I can't do this, why can't I?</p>\n\n<p><strong>EDIT</strong>: It is possible to do what I needed using template Haskell. See code below and link to CLaSH group explanation</p>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/clash-language/uPjt8i0lF0M\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/clash-language/uPjt8i0lF0M</a>\u00a0.\u00a0</p>\n\n<p>What I wanted I could accomplish at compile time. Runtime would be impossible.</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1471272518, "post_id": 38957050, "comment_id": 65268874, "body": "I can read GlobalState with <code>get</code> but how can I read LocalState?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471275167, "post_id": 38957050, "comment_id": 65270495, "body": "I&#39;ve created an example using this approach here: <a href=\"http://lpaste.net/177413\" rel=\"nofollow noreferrer\">lpaste.net/177413</a>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1471278174, "post_id": 38957050, "comment_id": 65272088, "body": "@ais Use <code>lift</code> to perform actions in the inner monad."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1471272094, "last_edit_date": 1471272094, "creation_date": 1471271273, "answer_id": 38957050, "question_id": 38956930, "link": "https://stackoverflow.com/questions/38956930/what-is-the-best-way-to-combine-local-and-global-state/38957050#38957050", "title": "What is the best way to combine local and global state", "body": "<p>You may use a <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-State.html\" rel=\"nofollow\">monad stack</a> of two <code>State</code>s:</p>\n\n<pre><code>type LocalState a = [String]\ntype GlobalState a = [String]\nnewtype MyState a = StateT GlobalState (State LocalState) a\n</code></pre>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 38957050, "answer_count": 1, "score": 1, "last_activity_date": 1471272094, "creation_date": 1471270912, "question_id": 38956930, "link": "https://stackoverflow.com/questions/38956930/what-is-the-best-way-to-combine-local-and-global-state", "title": "What is the best way to combine local and global state", "body": "<p>I have this global State</p>\n\n<pre><code>type GlobalState a = State Int a\n</code></pre>\n\n<p>but one function needs its own local state and access to the GlobalState</p>\n\n<pre><code>type LocalState a = State [String] a\n</code></pre>\n\n<p>But I'm not sure now to combine them.</p>\n\n<p>Right now I just add local state to the global</p>\n\n<pre><code>type GlobalState a = State (Int, [String]) a\n</code></pre>\n\n<p>It works fine, but I don't think it's right because I only need local state in one function.\nIs there a better way?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "conduit"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1471268049, "post_id": 38955432, "comment_id": 65266096, "body": "What are you streaming ? And to which process ? And overall what are you trying to do ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471272339, "post_id": 38955432, "comment_id": 65268739, "body": "I fixed up my answer."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1471308384, "post_id": 38955432, "comment_id": 65284792, "body": "Nothing that you&#39;ll be able to cook up will be nearly as simple as using <code>sourceHandle</code> and closing the handle yourself. <code>ResourceT</code> is nice, but it really is just a convenience."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6667042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29937ac068a9ffc4d372505480b47a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/6667042/tristan"}, "edited": false, "score": 0, "creation_date": 1471297369, "post_id": 38956179, "comment_id": 65281799, "body": "Hi, thanks for your response. Concerning the original answer, I guess didn&#39;t mention it explicitly (I supposed it was implicit in the heading), but I need a whole conduit line because I need to process the data between input and output. The file and process are merely the beginning and end. Concerning your update, I already said I would prefer not to us sourceHandle if possible because I would prefer not to handle my own file opens and closes if possible."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 33, "user_id": 6667042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29937ac068a9ffc4d372505480b47a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/6667042/tristan"}, "edited": false, "score": 0, "creation_date": 1471299115, "post_id": 38956179, "comment_id": 65282449, "body": "Do you mean that you want to send the contents of the input file through another conduit stage before piping it to the process?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1471278932, "last_edit_date": 1471278932, "creation_date": 1471268354, "answer_id": 38956179, "question_id": 38955432, "link": "https://stackoverflow.com/questions/38955432/haskell-conduits-from-file-to-process/38956179#38956179", "title": "haskell conduits from file to process", "body": "<p>Since you are able to supply a <code>CreateProcess</code> you can redirect stdin from a known file name either using the redirection capabilities of <code>CreateProcess</code> or even the shell.</p>\n\n<p>Here are some examples. Note that in each case <code>wc</code> reports the\nstats for the file <code>input</code> and not the supplied Producer (which\nis the empty Producer.)</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack runghc --resolver lts-6.0\n    --package conduit-extra\n    --package conduit-combinators\n -}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Conduit\nimport Data.Conduit\nimport Data.Conduit.Process\nimport qualified Data.ByteString.Char8 as BS\n\nex1 = do x &lt;- sourceCmdWithConsumer \"date\" lengthC\n         print x\n\nemit prefix = mapM_C (\\x -&gt; BS.putStr prefix &gt;&gt; BS.putStr \": \" &gt;&gt; BS.putStrLn x)\n\nex2 = do let cp = shell \"wc &lt; input\"\n         x &lt;- sourceProcessWithConsumer cp (emit \"stdout\")\n         print x\n\nex3 = sourceCmdWithStreams \"wc &lt; input\" (return ())  (emit \"stdout\") (emit \"stderr\")\n\nex4 = do let cp = shell \"wc &lt; input\"\n         sourceProcessWithStreams cp (return ()) (emit \"stdout\") (emit \"stderr\" )\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>If you want to avoid spawning a shell, I've created an alternate version\nof sourceProcessWithStreams which takes stdin from the CreateProcess:</p>\n\n<p><a href=\"https://gist.github.com/erantapaa/944b690ec0a5dedc988a9be54e958712\" rel=\"nofollow\">Using UseProvidedHandle with streamingProcess</a></p>\n\n<p>Alternatively, you can use <code>withFile</code> and <code>sourceHandle</code>:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack runghc --resolver lts-6.0\n    --package streaming-commons\n    --package conduit\n    --package conduit-extra\n -}\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport System.IO\nimport qualified Data.ByteString.Char8 as BS\nimport Conduit\nimport System.Process\nimport Data.Conduit.Process\n\nemit prefix = mapM_C $ \\x -&gt; BS.putStr prefix &gt;&gt; BS.putStr \": \" &gt;&gt; BS.putStrLn x\n\nex3 = do let cp = (proc \"wc\" [])\n         withFile \"input\" ReadMode $ \\h -&gt; do\n           sourceProcessWithStreams cp (sourceHandle h) (emit \"stdout\") (emit \"stderr\")\n\nmain = ex3 &gt;&gt;= print\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6667042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29937ac068a9ffc4d372505480b47a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/6667042/tristan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 247, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1471278932, "creation_date": 1471265398, "question_id": 38955432, "link": "https://stackoverflow.com/questions/38955432/haskell-conduits-from-file-to-process", "title": "haskell conduits from file to process", "body": "<p>How can I stream from a file into process?</p>\n\n<pre><code>Data.Conduit.Binary.sourceFile :: MonadResource m =&gt; FilePath -&gt; Producer m ByteString\nData.Conduit.Process.sourceProcessWithStreams :: CreateProcess -&gt; Producer IO ByteString -&gt; Consumer ByteString IO a -&gt; Consumer ByteString IO b -&gt; IO (ExitCode, a, b)\n</code></pre>\n\n<p>The only thing that is a <code>MonadResource</code> is a <code>ResourceT</code>, in particular <code>IO</code> is not a <code>MonadResource</code>.</p>\n\n<p>I can see that there's <code>sourceHandle</code> which is <code>IO</code>, but I would rather not handle my own file opens and closes if possible. Also, I want to understand this problem in case I understand it in another space.</p>\n\n<p>There's also <code>Data.Conduit.Lift.distribute</code>:</p>\n\n<pre><code>distribute :: (Monad (t (ConduitM b o m)), Monad m, Monad (t m), MonadTrans t, MFunctor t) =&gt; ConduitM b o (t m) () -&gt; t (ConduitM b o m) () \n</code></pre>\n\n<p>so I'd get something like </p>\n\n<pre><code>distribute $ sourceFile \"foo\" :: ResourceT (ConduitM i ByteString IO) ()\n</code></pre>\n\n<p>but I don't know how to use that.</p>\n"}, {"tags": ["haskell", "fixed-point-iteration"], "comments": [{"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 0, "creation_date": 1471265389, "post_id": 38955348, "comment_id": 65264586, "body": "<code>ghci</code> says that the type of that function is <code>Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a</code>. Hoogle doesn&#39;t seem to return useful results for that signature."}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 2, "creation_date": 1471265513, "post_id": 38955348, "comment_id": 65264661, "body": "The closest thing is <code>until :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a</code> <code>until p f yields the result of applying f until p holds.</code> - it seems like you could write your function using it but you still need the <code>Eq</code> constraint"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 1, "creation_date": 1471265945, "post_id": 38955348, "comment_id": 65264906, "body": "@Daenyth Thanks, I didn&#39;t know you could use hoogle that way=) If you add it as an answer I&#39;d accept that."}], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1471278463, "post_id": 38955570, "comment_id": 65272270, "body": "I know there are many ways to do it, but I&#39;m explicitly looking for a built in, as I&#39;m assuming it is a quite commonly funciton."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1471281476, "post_id": 38955570, "comment_id": 65273855, "body": "@flawr, I don&#39;t think it&#39;s particularly common, actually. <code>until</code> seems closest, but actually using it for this purpose is more trouble than it&#39;s worth."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1471265965, "creation_date": 1471265965, "answer_id": 38955570, "question_id": 38955348, "link": "https://stackoverflow.com/questions/38955348/is-there-a-fixed-point-operator-in-haskell/38955570#38955570", "title": "Is there a fixed point operator in Haskell?", "body": "<p>Just write it yourself. A direct version will be faster than one using <code>dropWhile</code>.</p>\n\n<pre><code>hammer :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nhammer f x\n  | x' == x = x'\n  | otherwise = hammer f x'\n  where x' = f x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471266222, "post_id": 38955602, "comment_id": 65265075, "body": "You could use <code>until</code> with pairs, but I think it&#39;s simpler to just do the whole thing by hand."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1471281682, "post_id": 38955602, "comment_id": 65273957, "body": "or <code>last . takeWhileDifferent . iterate f</code>, or similar write own <code>last . takeWhileDifferent</code> variant... takeWhileDifferent = <a href=\"https://github.com/ekmett/ad/blob/ac5e0c7091430d0c569ba893f78385ead70b918e/src/Numeric/AD/Internal/Combinators.hs#L51\" rel=\"nofollow noreferrer\">github.com/ekmett/ad/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "is_accepted": true, "score": 1, "last_activity_date": 1471266091, "last_edit_date": 1592644375, "creation_date": 1471266091, "answer_id": 38955602, "question_id": 38955348, "link": "https://stackoverflow.com/questions/38955348/is-there-a-fixed-point-operator-in-haskell/38955602#38955602", "title": "Is there a fixed point operator in Haskell?", "body": "<p>Your function has the signature <code>Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a</code>.</p>\n<p><a href=\"https://www.haskell.org/hoogle/?hoogle=Eq+a+%3D%3E+%28a+-%3E+a%29+-%3E+a+-%3E+a\" rel=\"nofollow noreferrer\">Using hoogle to search for that</a>, I don't see any exact matches. The closest match is <code>until</code></p>\n<blockquote>\n<p><code>until :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a</code></p>\n<p>base Prelude</p>\n<p><code>until p f</code> yields the result of applying <code>f</code> until <code>p</code> holds.</p>\n</blockquote>\n<p>You could likely use that to write your function but because you need <code>/=</code> you need the <code>Eq</code> constraint.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 6620204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G7LUI.jpg?s=128&g=1", "display_name": "Laikoni", "link": "https://stackoverflow.com/users/6620204/laikoni"}, "is_accepted": false, "score": 1, "last_activity_date": 1507456470, "creation_date": 1507456470, "answer_id": 46629803, "question_id": 38955348, "link": "https://stackoverflow.com/questions/38955348/is-there-a-fixed-point-operator-in-haskell/46629803#46629803", "title": "Is there a fixed point operator in Haskell?", "body": "\n\n<p>In case you are looking for a build-in because you want a short expression  without any auxiliary functions, I can recommend </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>until=&lt;&lt;((==)=&lt;&lt;) :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>Arguably this looks a bit strange, but in fact it is just the point-free equivalent to <code>until (\\x -&gt; f x == x) f</code>, using the fact that <code>f (g x) x</code> can be expressed by <code>(f=&lt;&lt;g) x</code> twice.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 621, "favorite_count": 2, "accepted_answer_id": 38955602, "answer_count": 3, "score": 5, "last_activity_date": 1563169106, "creation_date": 1471265109, "last_edit_date": 1563169106, "question_id": 38955348, "link": "https://stackoverflow.com/questions/38955348/is-there-a-fixed-point-operator-in-haskell", "title": "Is there a fixed point operator in Haskell?", "body": "<p>I recently noticed that I quite often write functions which just iterates another function <code>f</code> until it reaches a fixed point (such that <code>f x == x</code>)</p>\n\n<p>I thought this is a pretty general concept, so I think there might be a built in.</p>\n\n<p>So I was wondering whether there is a built in for this, or something more general?</p>\n\n<p>So I'm basically looking for this:</p>\n\n<pre><code>fixedpoint f x= head . dropWhile(\\y-&gt;y /= f y) $ iterate f x\n</code></pre>\n\n<p>I just had trouble googling this, because I only found references to the <code>fix</code> function whenever my search term contained <code>fixed point</code> or something similar. </p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1471255898, "post_id": 38952759, "comment_id": 65260284, "body": "Thanks! Yes, I just wanted to suppress the warning."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 1, "creation_date": 1471256426, "post_id": 38952759, "comment_id": 65260555, "body": "I updated your answer to the code I used, using <code>error &quot;&lt;msg&gt;&quot;</code> rather than simply <code>undefined</code>. I hope that means that if I use <code>str</code> incorrectly, it wouldn&#39;t be so hard to track down."}], "tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 1, "last_activity_date": 1471254222, "creation_date": 1471254222, "answer_id": 38952759, "question_id": 38952122, "link": "https://stackoverflow.com/questions/38952122/how-to-fix-quasiquoter-warning/38952759#38952759", "title": "How to fix QuasiQuoter warning?", "body": "<p>from <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Quote.html#t:QuasiQuoter\" rel=\"nofollow\">https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Quote.html#t:QuasiQuoter</a></p>\n\n<blockquote>\n  <p>if you are only interested in defining a quasiquoter to be used for expressions, you would define a QuasiQuoter with only quoteExp, and leave the other fields stubbed out with errors.</p>\n</blockquote>\n\n<p>So using undefined fields QQ seems to be fine. If you want to just supress warring you can try:</p>\n\n<pre><code>qqUndef = QuasiQuoter {quoteExp = undefined , \n                       quotePat = undefined , \n                       quoteType = undefined,\n                       quoteDec = undefined }\n\n-- replace only quoteExp\nstr = qqUndef { quoteExp = stringE }\n</code></pre>\n"}], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1471254222, "creation_date": 1471251395, "question_id": 38952122, "link": "https://stackoverflow.com/questions/38952122/how-to-fix-quasiquoter-warning", "title": "How to fix QuasiQuoter warning?", "body": "<p>I'm using the <a href=\"https://wiki.haskell.org/Poor_man&#39;s_here_document#Quasiquoting\" rel=\"nofollow\">simple quasiquoter from the Haskell Wiki</a> for multiline strings.</p>\n\n<pre><code>import Language.Haskell.TH\nimport Language.Haskell.TH.Quote\n\nstr = QuasiQuoter { quoteExp = stringE }\n</code></pre>\n\n<p>I get the following warning:</p>\n\n<pre><code>    Fields of \u2018QuasiQuoter\u2019 not initialised: quotePat, quoteType,\n                                             quoteDec\n    In the expression: QuasiQuoter {quoteExp = stringE}\n    In an equation for \u2018str\u2019: str = QuasiQuoter {quoteExp = stringE}\n</code></pre>\n\n<p>What is the proper way to squelch this warning? Should I be initialising quotePat etc, perhaps to undefined or something else?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23557, "user_id": 12266, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6a2a454191fa75d4114ed05836a0b924?s=128&d=identicon&r=PG", "display_name": "Andrew Jaffe", "link": "https://stackoverflow.com/users/12266/andrew-jaffe"}, "edited": false, "score": 1, "creation_date": 1471249176, "post_id": 38951387, "comment_id": 65257413, "body": "Just to check my understanding: is it legal to have the inner countLines function have the same name as the outer one?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 23557, "user_id": 12266, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6a2a454191fa75d4114ed05836a0b924?s=128&d=identicon&r=PG", "display_name": "Andrew Jaffe", "link": "https://stackoverflow.com/users/12266/andrew-jaffe"}, "edited": false, "score": 0, "creation_date": 1471270769, "post_id": 38951387, "comment_id": 65267748, "body": "@AndrewJaffe I didn&#39;t notice that at first. It is legal, but a bad practice for readability issues, IMHO."}], "answers": [{"comments": [{"owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471251741, "post_id": 38951459, "comment_id": 65258516, "body": "I&#39;m inclined to avoid the <code>do</code> notation, as it looks too much like an imperative style of programming. Is this a valid sentiment? As well, it seems as though <code>do</code> is syntactic sugar for <code>&gt;&gt;=</code> anyway, and so unless it significantly improves readability (which I remain open-minded to in certain cases) I&#39;d rather avoid it until I understand Haskell better."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 3, "creation_date": 1471262806, "post_id": 38951459, "comment_id": 65263234, "body": "<code>do</code> notation actually is just syntactic sugar for <code>&gt;&gt;=</code>. In my opinion, there is no reason to avoid imperative style in Haskell when it makes the code easier to read. Sequential computations are most naturally stated in a sequential manner. Doing sequential computation in a referentially transparent way is monad&#39;s raison d&#39;etre."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 1, "creation_date": 1471271229, "post_id": 38951459, "comment_id": 65268032, "body": "@Wildhoney It can be beneficial at the beginning to avoid do notation so to have a solid grasp on what&#39;s underneath. But I believe that when one gets familiar with Haskell no longer associates do with imperative style, unless the monad at hand is an IO-related or a stateful one. Even if applicative style has become more common now, do notation is still quite idiomatic."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1471270947, "last_edit_date": 1471270947, "creation_date": 1471248502, "answer_id": 38951459, "question_id": 38951387, "link": "https://stackoverflow.com/questions/38951387/how-to-write-bind-functions-in-point-free-style/38951459#38951459", "title": "How to write bind functions in point-free style?", "body": "<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= countLines\n     where countLines = (\\d -&gt; return $ (length . lines) d)\n</code></pre>\n\n<p>By the way, it is not a good practice to use the same name of the function in a <code>where</code> clause: the function looks recursive even if it is not.</p>\n\n<p>Back to the question, the code above means</p>\n\n<pre><code>countLines file = readFile file &gt;&gt;= (\\d -&gt; return $ (length . lines) d)\n</code></pre>\n\n<p>which means</p>\n\n<pre><code>countLines file = readFile file &gt;&gt;= (return . (length . lines))\n</code></pre>\n\n<p>which can be written as</p>\n\n<pre><code>countLines file = length . lines &lt;$&gt; readFile file\n-- or\ncountLines file = fmap (length . lines) $ readFile file\n</code></pre>\n\n<p>One can go further and also remove the <code>file</code> point, but readability would be slightly harmed.</p>\n\n<pre><code>countLines = fmap (length . lines) . readFile\n</code></pre>\n\n<blockquote>\n  <p>Is there a way to achieve a point-free style for the countLines\n  function? Writing lambdas for each step of the >>= is tiresome.</p>\n</blockquote>\n\n<p>Well, pointfree style is hardly more readable in the general case. Why don't you use do notation instead?</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = do\n   d &lt;- readFile file\n   return . length . lines $ d\n</code></pre>\n\n<p>This is not as elegant as the pointfree-ish variant in this case, but is much more general. Even when chaining many <code>&gt;&gt;=</code>s sometimes the following style is used:</p>\n\n<pre><code>foo =\n  m1 &gt;&gt;= \\x1 -&gt;\n  m2 &gt;&gt;= \\x2 -&gt;\n  m3 &gt;&gt;= \\x3 -&gt;\n  ...\n  mN &gt;&gt;= \\xN -&gt;\n  return (...)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471270544, "post_id": 38951592, "comment_id": 65267617, "body": "Is it not common practice in Haskell to define named functions in the <code>where</code> clause to impart a clearer intent upon the function you&#39;re defining? For example, you&#39;ve refactored my code to inline the lambda, which for this simple example is both understandable and readable. However, when you have multiple <code>&gt;&gt;=</code> operators, would the <code>where</code> clause be a better approach? For instance: <code>chargeAccount &gt;&gt;= reserveProduct =&gt;&gt; finaliseTransaction</code> where each function is defined in the <code>where</code> clause."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "edited": false, "score": 0, "creation_date": 1471270906, "post_id": 38951592, "comment_id": 65267828, "body": "In general, yes, I think that&#39;s a good idea. However, in this case I don&#39;t think that a where clause defining <code>numLines = length . lines</code> is any clearer than inlining <code>length . lines</code> which is already a succinct description of what this function does."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 2, "last_activity_date": 1471249040, "creation_date": 1471249040, "answer_id": 38951592, "question_id": 38951387, "link": "https://stackoverflow.com/questions/38951387/how-to-write-bind-functions-in-point-free-style/38951592#38951592", "title": "How to write bind functions in point-free style?", "body": "<p>Your code</p>\n\n<pre><code>countLines file = readFile file &gt;&gt;= countLines\n  where countLines = (\\d -&gt; return $ (length . lines) d)\n</code></pre>\n\n<p>contains the anonymous function</p>\n\n<pre><code>\\d -&gt; return $ (length . lines) d\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>\\d -&gt; return ((length . lines) d)\n</code></pre>\n\n<p>and the point <code>d</code> can be removed using function composition to give</p>\n\n<pre><code>return . (length . lines)\n</code></pre>\n\n<p>This allows you to write</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= return . (length . lines)\n</code></pre>\n\n<p>The pattern <code>a &gt;&gt;= return . f</code> is equivalent to <code>fmap f a</code>, so you can also write</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = fmap (length . lines) (readFile file)\n</code></pre>\n\n<p>and you can now remove the point <code>file</code> using function composition as well,</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines = fmap (length . lines) . readFile\n</code></pre>\n\n<p>Personally I find this more readable than the original, but opinions may differ.</p>\n"}, {"comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1471250996, "post_id": 38951774, "comment_id": 65258210, "body": "You could flip the final form to <code>return .  length . lines &lt;=&lt; readFile</code>."}, {"owner": {"reputation": 96, "user_id": 5532658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7ecad777531a7b7da0c234468e336d?s=128&d=identicon&r=PG&f=1", "display_name": "sham1", "link": "https://stackoverflow.com/users/5532658/sham1"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1471251134, "post_id": 38951774, "comment_id": 65258259, "body": "Yeah, that could work as the flow of the code would be to the same direction. Added a note."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471270599, "post_id": 38951774, "comment_id": 65267645, "body": "<code>countLines = (return $ (length . lines))</code> is not equivalent to <code>countLines = (\\d -&gt; return $ (length . lines) d)</code>."}], "tags": [], "owner": {"reputation": 96, "user_id": 5532658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7ecad777531a7b7da0c234468e336d?s=128&d=identicon&r=PG&f=1", "display_name": "sham1", "link": "https://stackoverflow.com/users/5532658/sham1"}, "is_accepted": false, "score": 6, "last_activity_date": 1471271376, "last_edit_date": 1471271376, "creation_date": 1471249869, "answer_id": 38951774, "question_id": 38951387, "link": "https://stackoverflow.com/questions/38951387/how-to-write-bind-functions-in-point-free-style/38951774#38951774", "title": "How to write bind functions in point-free style?", "body": "<p>To make your function here</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= countLines\n where countLines = (\\d -&gt; return $ (length . lines) d)\n</code></pre>\n\n<p>pointfree, we need to first refactor it to this:</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= countLines\n where countLines = (\\d -&gt; return $ (length . lines) $ d)\n</code></pre>\n\n<p>Now, we can compose the return with the other functions, like so (we can remove the parenthesis):</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= countLines\n where countLines = (\\d -&gt; return . length . lines $ d)\n</code></pre>\n\n<p>Now we can take out the point (again, remove parenthesis):</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= countLines\n where countLines = return . length . lines\n</code></pre>\n\n<p>Now the function can be inlined:</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines file = readFile file &gt;&gt;= return . length . lines\n</code></pre>\n\n<p>As an added bonus, if you want to make countLines totally pointfree, you can use the Kleisi composition operator (found in <code>Control.Monad</code>) instead of bind, like so:</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines = readFile &gt;=&gt; return . length . lines\n</code></pre>\n\n<p>although it is arguable that the other version is more readable.</p>\n\n<p>The last one can also be written like:</p>\n\n<pre><code>countLines :: FilePath -&gt; IO Int\ncountLines = return . length . lines &lt;=&lt; readLine\n</code></pre>\n\n<p>which has the advantage that you can read the function from right to left and see exactly how the function \"flows\".</p>\n"}], "owner": {"reputation": 4919, "user_id": 1463681, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/82a85370ac6830d7858e785db168576f?s=128&d=identicon&r=PG", "display_name": "Wildhoney", "link": "https://stackoverflow.com/users/1463681/wildhoney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "accepted_answer_id": 38951459, "answer_count": 3, "score": 1, "last_activity_date": 1471271376, "creation_date": 1471248149, "question_id": 38951387, "link": "https://stackoverflow.com/questions/38951387/how-to-write-bind-functions-in-point-free-style", "title": "How to write bind functions in point-free style?", "body": "<p>I often find myself having to explicitly specify <code>return</code> to wrap an expression in <code>IO/Maybe/Either</code>, etc... but I'm sure there must be a better way to make it point-free.</p>\n\n<p>For example:</p>\n\n<p><code>countLines :: FilePath -&gt; IO Int\n countLines file = readFile file &gt;&gt;= countLines\n     where countLines = (\\d -&gt; return $ (length . lines) d)\n</code></p>\n\n<p>Is there a way to achieve a point-free style for the <code>countLines</code> function? Writing lambdas for each step of the <code>&gt;&gt;=</code> is tiresome.</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1471217004, "post_id": 38947384, "comment_id": 65250172, "body": "Another error you will get after fixing the current one is that <code>data Sentence = (Word, Word, Word)</code> is invalid. You need to provide a data constructor, such as <code>data Sentence = Sentence (Word, Word, Word)</code>, or use a type alias as you did for <code>type Letter = Char</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1471220175, "post_id": 38947384, "comment_id": 65250728, "body": "@amalloy Wait, are you the amalloy from DCSS?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1471226016, "post_id": 38947384, "comment_id": 65251730, "body": "@ReinHenrichs Indeed. DCSS developer and YouTuber extraordinaire. Why?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1471232892, "post_id": 38947384, "comment_id": 65253050, "body": "@amalloy I&#39;m a fan. :)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1538051923, "post_id": 38947384, "comment_id": 92013724, "body": "@amalloy and Rein - finally I got the rune of Zot - you started it! (took me a while)"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 6, "last_activity_date": 1471216080, "creation_date": 1471216080, "answer_id": 38947410, "question_id": 38947384, "link": "https://stackoverflow.com/questions/38947384/haskell-why-is-this-incorrect-i-put-a-datatype-as-a-type-constructor-in-anoth/38947410#38947410", "title": "Haskell : Why is this incorrect? I put a datatype as a type constructor in another data declaration", "body": "<p>As the error indicates, your type called <code>Word</code> clashes with a type called <code>Word</code> that is already in scope, part of the <code>Prelude</code> module which is implicitly included. To use your type, you either need to fully qualify it as <code>Chp10.Word</code> or hide the other conflicting type:</p>\n\n<pre><code>import Prelude hiding (Word)\n</code></pre>\n"}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 38947410, "answer_count": 1, "score": 0, "last_activity_date": 1471216080, "creation_date": 1471215816, "question_id": 38947384, "link": "https://stackoverflow.com/questions/38947384/haskell-why-is-this-incorrect-i-put-a-datatype-as-a-type-constructor-in-anoth", "title": "Haskell : Why is this incorrect? I put a datatype as a type constructor in another data declaration", "body": "<h1>Problem:</h1>\n\n<p>Make all combinations of 3-tuple representing noun-verb-noun sentences. To do this I decided to try and make the problem easier to read, because verbComb's future wasn't looking \"clean\", by playing with data types and encountered this problem. Please help!</p>\n\n<h1>My Code:</h1>\n\n<pre><code>type Letter = Char\n\ndata Word = Noun (Letter, Letter, Letter)| Verb (Letter, Letter,    Letter)\n  deriving (Ord, Eq, Show)\n\ndata Sentence = (Word, Word, Word)\n  deriving (Show)\n\nstops = \"pbtdkg\"\nvowels = \"aeiou\"\n\nvowelComb :: String -&gt; String -&gt; [(Char, Char, Char)]\nvowelComb s v  = combine s v s ++ combine (reverse s) v s ++ combine s v (reverse s)\n  where combine f s t = [ (x,y,z) | x &lt;- f, y &lt;- s, z &lt;- t, x == 'p']\n\nverbComb :: Word -&gt; Word -&gt; Sentence\nverbComb = undefined\n</code></pre>\n\n<p><br></p>\n\n<h1>Error:</h1>\n\n<p><code>chp10.hs:88:21:\n    Ambiguous occurrence \u2018Word\u2019\n    It could refer to either \u2018Chp10.Word\u2019, defined at chp10.hs:75:1\n                          or \u2018Prelude.Word\u2019,\n                             imported from \u2018Prelude\u2019 at chp10.hs:28:8-12\n                             (and originally defined in \u2018GHC.Types\u2019)\nFailed, modules loaded: none.</code> </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1471233246, "post_id": 38947181, "comment_id": 65253098, "body": "And what should happen if <code>Filter1</code> is applied to an String, or <code>Filter2</code> to an Integer? It doesn&#39;t make sense to have a heterogeneous list of filters."}], "answers": [{"comments": [{"owner": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "edited": false, "score": 0, "creation_date": 1471222178, "post_id": 38947336, "comment_id": 65251065, "body": "Ok, but in the MRF can I have RFs with diferent filters?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "edited": false, "score": 0, "creation_date": 1471222530, "post_id": 38947336, "comment_id": 65251138, "body": "The real question is what do you want to do with an MRF? What do you expect to happen if you try to apply a Filter for Integers to a String? Can you show what you are trying to accomplish in another language?"}, {"owner": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "edited": false, "score": 0, "creation_date": 1471223064, "post_id": 38947336, "comment_id": 65251236, "body": "I want to have a list of filters for Strings in a RF, then have another RF with a list of Integer, then other RF with a list of Floats, and so on. And I want all those RF in a list (MRF). This will give to the MRF data flexibility in the input, am I clear? If I do what you suggest then I&#39;ll have a MRF with a list of ONLY one type :/ Have you another idea?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "edited": false, "score": 0, "creation_date": 1471224289, "post_id": 38947336, "comment_id": 65251452, "body": "But why do you want to have an MRF Integer and an MRF String in the same list? Write some code (even pseudo code) which makes use of such a list so we can see what you are trying to accomplish, and we might be able to offer some alternatives."}, {"owner": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "edited": false, "score": 0, "creation_date": 1471266202, "post_id": 38947336, "comment_id": 65265063, "body": "Today I&#39;ll check your solution @ErikR and I&#39;ll let you know. Thanks a lot!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1471227598, "last_edit_date": 1471227598, "creation_date": 1471215359, "answer_id": 38947336, "question_id": 38947181, "link": "https://stackoverflow.com/questions/38947181/generic-type-in-a-list-of-functions/38947336#38947336", "title": "Generic type in a list of functions", "body": "<p>Does this work for you?</p>\n\n<pre><code>data Filter a = Filter { operation :: a -&gt; Bool, value :: a }\n\ndata RF a = RF { event :: String; filters :: [ Filter a ] }\n\ndata MRF a = MRF { lastValue :: a, requestedFilters :: [RF a] }\n</code></pre>\n\n<p>In an <code>RF a</code>, all of the filters have to be of type <code>Filter a</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<blockquote>\n  <p>I want to have a list of filters for Strings in a RF, then have another RF with a list of Integer, then other RF with a list of Floats, and so on. And I want all those RF in a list (MRF).</p>\n</blockquote>\n\n<p>How about this:</p>\n\n<pre><code>data MFRList = MRFList\n             { integerMRFs    :: [ MRF Integer ]\n             , stringMRFs     :: [ MRF String ]\n             , floatMRFs      :: [ MRF Float ]\n             }\n</code></pre>\n\n<p>Add as many fields as you need.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1471248237, "last_edit_date": 1471248237, "creation_date": 1471247822, "answer_id": 38951317, "question_id": 38947181, "link": "https://stackoverflow.com/questions/38947181/generic-type-in-a-list-of-functions/38951317#38951317", "title": "Generic type in a list of functions", "body": "<p>The basic solution to this is to use two constructors for <code>Filter</code>:</p>\n\n<pre><code>data Filter \n    = FilterI {\n    operationI :: Int -&gt; Bool,\n    valueI :: Int\n    } \n    | FilterS {\n    operationS :: String -&gt; Bool,\n    valueS :: String\n    }\n</code></pre>\n\n<p>A more advanced alternative, using GADTs:</p>\n\n<pre><code>-- singleton\ndata BasicType t where\n   BasicI :: BasicType Int\n   BasicS :: BasicType String\n\ndata Filter where\n   Filter ::\n      { ty :: BasicType t\n      , operation :: t -&gt; Bool\n      , value :: t\n      } -&gt; Filter\n</code></pre>\n\n<p>Note that above it is important that the field <code>ty</code> can be tested at runtime so that we can discover which type <code>t</code> actually is. Example:</p>\n\n<pre><code>useFilter :: Filter -&gt; Int\nuseFilter (Filter BasicI op v) = v         -- we know it's Int\nuseFilter (Filter BasicS op v) = length v  -- we know it's String\n</code></pre>\n\n<p>We could also avoid GADTs and use plain existential types, only:</p>\n\n<pre><code>data Filter where\n   Filter ::\n      { operation :: t -&gt; Bool\n      , value :: t\n      } -&gt; Filter\n</code></pre>\n\n<p>but in this way, <code>Filter</code> is actually isomorphic to <code>Bool</code>: there's nothing we can do with <code>value</code> except to use it as an argument to <code>Filter</code>. Hence here a list of filters is simply a list of booleans, which is uninteresting.</p>\n\n<p>In general, if you are using a list of existential types, you might be using a known <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow\">antipattern</a>.</p>\n"}], "owner": {"reputation": 1346, "user_id": 2774342, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a44003ae0b1ac699630fa5c54f1f0966?s=128&d=identicon&r=PG&f=1", "display_name": "dani24", "link": "https://stackoverflow.com/users/2774342/dani24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "accepted_answer_id": 38947336, "answer_count": 2, "score": 2, "last_activity_date": 1471248237, "creation_date": 1471213762, "last_edit_date": 1471214338, "question_id": 38947181, "link": "https://stackoverflow.com/questions/38947181/generic-type-in-a-list-of-functions", "title": "Generic type in a list of functions", "body": "<p>I have the next structures:</p>\n\n<pre><code>data BasicTypes = TypeS String \n                | TypeI Integer\n                deriving (Show, Ord, Eq)\n\ndata MRF = MRF {\n    lastValue :: BasicTypes,\n    requestedFilters :: [RF]\n} deriving (Show)\n\ndata RF = RF {\n    event :: String,\n    filters :: [Filter]\n} deriving (Show)\n\ntype BooleanFunction  a = a -&gt; Bool\ndata Filter = Filter {\n    operation :: BooleanFunction BasicTypes,\n    value :: BasicTypes\n} deriving (Show)\n</code></pre>\n\n<p>I want to have a MRF data, that contains a list of requestedFilters (RF). Each RF have filters, and those filters can be of a String or an Integer type. </p>\n\n<p>The thing is that the filters are created dynamically and could be either about a String or an Integer value, so we could have:</p>\n\n<pre><code>Filter1 = Filter {operation = (==) 5, value = 3} \nFilter2 = Filter {operation = (==) \"hello\", value = \"hello\"}\n</code></pre>\n\n<p>And both filters been included in the same MRF!</p>\n\n<p>I want to avoid the BasicTypes data, and put a generic type, but If a put <code>operation :: a -&gt; Bool</code> then all the Filter should be of the same type (so I can't have things like <code>Integer -&gt; Bool</code> and <code>String -&gt; Bool</code> together in the same list).</p>\n\n<p>What do you suggest to do so? Thanks!</p>\n\n<p>PS: I already tried with the TypeRep type, but I couldn't find a solution for this</p>\n"}, {"tags": ["haskell", "monad-transformers", "io-monad"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 5, "creation_date": 1471204308, "post_id": 38945886, "comment_id": 65246939, "body": "<code>do xs &lt;- stuff; mapM_ doThings xs</code>? What exactly are you trying to do. Also: <code>[()]</code> is a pretty useless type. Isn&#39;t an <code>Int</code> enough? Or can&#39;t you just have the type <code>String -&gt; IO ()</code>?"}, {"owner": {"reputation": 1012, "user_id": 286650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2068ecb35d78f7ea67c6624fba147870?s=128&d=identicon&r=PG", "display_name": "Sandy Vanderbleek", "link": "https://stackoverflow.com/users/286650/sandy-vanderbleek"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1471206317, "post_id": 38945886, "comment_id": 65247511, "body": "Thanks! I changed <code>[()]</code> to <code>()</code> and used <code>mapM_</code>, it worked great!"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1471207665, "post_id": 38945886, "comment_id": 65247900, "body": "You could keep <code>[()]</code> (assuming you have some reason to want that) by using <code>mapM</code>.  Notice the trailing <code>_</code> in Haskell typically means &quot;ignore the result(s)&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 1, "last_activity_date": 1471233637, "creation_date": 1471233637, "answer_id": 38949142, "question_id": 38945886, "link": "https://stackoverflow.com/questions/38945886/haskell-monad-stack-bind-with-io-and/38949142#38949142", "title": "Haskell: monad stack bind with IO and []", "body": "<p>With your original types, you can do:</p>\n\n<pre><code>stuff &gt;&gt;= mapM_ doThings\n</code></pre>\n\n<p>This also works if you change doThings to have type <code>doThings :: String -&gt; IO ()</code></p>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1471261858, "creation_date": 1471261858, "answer_id": 38954547, "question_id": 38945886, "link": "https://stackoverflow.com/questions/38945886/haskell-monad-stack-bind-with-io-and/38954547#38954547", "title": "Haskell: monad stack bind with IO and []", "body": "<p>If you've got lots of such functions, this is the textbook usecase of <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-List.html#t:ListT\" rel=\"nofollow\"><code>ListT</code></a>:</p>\n\n<pre><code>main = runListT $ do\n  string &lt;- ListT stuff\n  ListT $ doThings string\n</code></pre>\n"}], "owner": {"reputation": 1012, "user_id": 286650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2068ecb35d78f7ea67c6624fba147870?s=128&d=identicon&r=PG", "display_name": "Sandy Vanderbleek", "link": "https://stackoverflow.com/users/286650/sandy-vanderbleek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 38949142, "answer_count": 2, "score": 0, "last_activity_date": 1471261858, "creation_date": 1471203454, "question_id": 38945886, "link": "https://stackoverflow.com/questions/38945886/haskell-monad-stack-bind-with-io-and", "title": "Haskell: monad stack bind with IO and []", "body": "<p>I have:</p>\n\n<pre><code>stuff :: IO [String]\ndoThings :: String -&gt; IO [()]\n</code></pre>\n\n<p>and I want to</p>\n\n<pre><code>stuff &gt;&gt;= doThings\n</code></pre>\n\n<p>but my types are off. I want to do a lifted bind essentially but everything I try is subtly wrong.</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 2, "creation_date": 1471206593, "post_id": 38945660, "comment_id": 65247591, "body": "What is the exact error you are getting?"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1471211751, "post_id": 38945660, "comment_id": 65248992, "body": "It has probably nothing to do with your problem, but I would not name a record field <code>id</code>, because then you would have an ambiguity with the prelude."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1471212739, "post_id": 38945660, "comment_id": 65249260, "body": "By the way, naming a field <code>type</code> is a syntax error"}, {"owner": {"reputation": 234, "user_id": 6475907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-xQd4dCvGOmg/AAAAAAAAAAI/AAAAAAAAABo/WuJS4WB_RNg/photo.jpg?sz=128", "display_name": "WellTyped", "link": "https://stackoverflow.com/users/6475907/welltyped"}, "edited": false, "score": 0, "creation_date": 1471213891, "post_id": 38945660, "comment_id": 65249532, "body": "There is no error, i just get a nothing as return"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1471214922, "post_id": 38945660, "comment_id": 65249740, "body": "It works here, modulo the errors I already mentioned, plus the type mismatch for wordcount, parsed as an <code>Int</code> when it is a string in json. I wish aeson could provide Either instead of Maybe."}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 2, "last_activity_date": 1471247629, "creation_date": 1471247629, "answer_id": 38951278, "question_id": 38945660, "link": "https://stackoverflow.com/questions/38945660/haskell-aeson-nested-array-json/38951278#38951278", "title": "Haskell Aeson nested array JSON", "body": "<p><code>Nothing</code> isn't a very useful for debugging is it?</p>\n\n<p>I managed to get your example JSON parsing the <code>tags</code> as a <code>[Tag]</code>. I wonder if your error could be related to the <code>wordcount</code> field being a <code>String</code> in the JSON rather than a <code>Number</code>.</p>\n\n<p>Here is a more-or-less self-contained example where I changed the example JSON wordcount to a number:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n\nmodule Main where\n\nimport Lib (str)\n\nimport Control.Monad (mzero)\nimport Data.Aeson\nimport qualified Data.ByteString.Lazy.Char8 as LBSC\nimport Data.Text\n\ndata Field = Field {\n  wordcount :: Int\n} deriving (Show)\n\ninstance FromJSON Field where\n  parseJSON (Object o) = Field &lt;$&gt; o .: \"wordcount\"\n  parseJSON _ = mzero\n\ndata Tag = Tag {\n  id :: Text\n} deriving (Show)\n\ninstance FromJSON Tag where\n  parseJSON (Object o) = Tag &lt;$&gt; (o .: \"id\")\n  parseJSON _ = mzero\n\ndata SearchResult = SearchResult {\n  typ :: Text,\n  fields :: Field,\n  tags :: [Tag]\n} deriving (Show)\n\ninstance FromJSON SearchResult where\n  parseJSON (Object v) = SearchResult &lt;$&gt; v .: \"type\" &lt;*&gt; v .: \"fields\" &lt;*&gt; v .: \"tags\"\n  parseJSON _ = mzero\n\ndata ContentrResult = ContentrResult {\n  results :: [SearchResult],\n  status :: Text\n} deriving (Show)\n\ninstance FromJSON ContentrResult where\n  parseJSON (Object v) = ContentrResult &lt;$&gt; v.: \"results\" &lt;*&gt; v .: \"status\"\n  parseJSON _ = mzero\n\ndata Response = Response {\n  response :: ContentrResult\n} deriving (Show)\n\ninstance FromJSON Response where\n  parseJSON (Object v) = Response &lt;$&gt; v .: \"response\"\n  parseJSON _ = mzero\n\nresponseJson :: String\nresponseJson = [str|\n  {\n    \"response\": {\n      \"status\": \"ok\",\n      \"results\": [\n        {\n          \"type\": \"article\",\n          \"fields\": {\n            \"wordcount\": 497\n          },\n          \"tags\": [\n            {\n              \"id\": \"profile/barryglendenning\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n|]\n\nmain :: IO ()\nmain = do\n  print r\n  putStrLn \"\"\n    where\n      r :: Maybe Response\n      r = decode (LBSC.pack responseJson)\n</code></pre>\n"}], "owner": {"reputation": 234, "user_id": 6475907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-xQd4dCvGOmg/AAAAAAAAAAI/AAAAAAAAABo/WuJS4WB_RNg/photo.jpg?sz=128", "display_name": "WellTyped", "link": "https://stackoverflow.com/users/6475907/welltyped"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 38951278, "answer_count": 1, "score": 0, "last_activity_date": 1471247629, "creation_date": 1471201572, "question_id": 38945660, "link": "https://stackoverflow.com/questions/38945660/haskell-aeson-nested-array-json", "title": "Haskell Aeson nested array JSON", "body": "<p>I have trouble parsing the Tag in the following JSON structure. The parser works only when i declare it to be <code>tags  :: !Array</code> It fails when i declare it as <code>tags :: [Tag]</code></p>\n\n<p>Why?</p>\n\n<pre><code>{\n  \"response\": {\n    \"status\": \"ok\",\n    \"results\": [\n      {\n        \"type\": \"article\",\n        \"fields\": {\n          \"wordcount\": \"497\"\n        },\n        \"tags\": [\n          {\n            \"id\": \"profile/barryglendenning\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\n\n\ndata Field = Field{\n    wordcount :: Int\n} deriving (Show)\n\ninstance FromJSON Field where\n    parseJSON (Object o) = Field &lt;$&gt; (o .: \"wordcount\")\n    parseJSON _ = mzero\n\n\ndata Tag = Tag{\n    id :: Text\n} deriving (Show)\n\ninstance FromJSON Tag where\n    parseJSON (Object o) = Tag &lt;$&gt; (o .: \"id\")\n    parseJSON _ = mzero\n\ndata SearchResult = SearchResult {\n    type:: Text,\n    field :: Field,\n    tags  :: !Array\n} deriving (Show)\n\ninstance FromJSON SearchResult where\n    parseJSON (Object o) = do\n        let t1 = o .: \"type\"\n        let t2 = o .: \"fields\"\n        let t3 = o .: \"tags\"\n        SearchResult &lt;$&gt; t1 &lt;*&gt; t2 &lt;*&gt; t3\n    parseJSON _ = mzero\n\n\ndata ContentrResult = ContentrResult {\n    results :: [SearchResult],\n    status  :: Text\n} deriving (Show)\n\ninstance FromJSON ContentrResult where\n    parseJSON (Object o) = do\n        r &lt;- o .: \"response\"\n        ContentrResult &lt;$&gt; r .: \"results\"\n                       &lt;*&gt; r .: \"status\"\n    parseJSON _ = mzero\n</code></pre>\n"}, {"tags": ["haskell", "equality", "type-families"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1471213908, "post_id": 38945644, "comment_id": 65249536, "body": "Are you looking for this to be a constraint of a larger type or do you want the value to actually be that equality? It might help to provide more information about what you&#39;re trying to do."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1471242356, "post_id": 38945644, "comment_id": 65255076, "body": "If you are looking for the value to represent the equality itself, would <code>equalityVal :: G (F x y) :~: (x, y); equalityVal = ... Refl ...</code> with <code>:~:</code> from <code>Data.Type.Equality</code> work? If, on the other hand, it is a constraint on a larger type, can&#39;t you just have <code>G (F x y) ~ (x, y) =&gt; ...</code>? I believe <code>Forall</code> from the constraints package is from universally quantifying over constraints (like <code>(Forall p, p a) =&gt; a</code>) where <code>p</code> is can then be a constraint like <code>Num</code>, which doesn&#39;t seem to be what you&#39;re looking for (if I&#39;m understanding correctly)."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1472058762, "last_edit_date": 1472058762, "creation_date": 1471231168, "answer_id": 38948861, "question_id": 38945644, "link": "https://stackoverflow.com/questions/38945644/forall-constraints/38948861#38948861", "title": "Forall constraints", "body": "<p>Yes, this is possible using <code>constraints</code>. Be careful, however! The equality you claim is unlikely to hold with enough generality for <code>constraints</code> if the type families are non-trivial. Consider, in particular, whether the type families successfully reduce when <code>x</code> and <code>y</code> are stuck type families</p>\n\n<pre><code>type family X where {}\ntype family Y where {}\n</code></pre>\n\n<p>Also, I see that your particular desired constraint has no free variables whatsoever. Hopefully, it's just an example; an actual closed constraint like that is unlikely to be useful.</p>\n\n<hr>\n\n<p>The fundamental type family in <code>Data.Constraint.Forall</code> is <code>Forall</code>. This particular example might be handled a bit more conveniently using <code>ForallT</code>, but it's most important to understand how to use <code>Forall</code>.</p>\n\n<p>Generally, <code>Forall p</code> means <code>forall x . p x</code>. That doesn't sound very general, but it actually is, if you build up your <code>p</code> step by step. You seek</p>\n\n<pre><code>forall x y. G (F x y) ~ (x, y)\n</code></pre>\n\n<p>Start by defining a class expressing the relationship you seek.</p>\n\n<pre><code>class G (F x y) ~ (x, y) =&gt; C x y\ninstance G (F x y) ~ (x, y) =&gt; C x y\n</code></pre>\n\n<p>Now you can go step by step, defining</p>\n\n<pre><code>class Forall (C x) =&gt; D x\ninstance Forall (C x) =&gt; D x\n</code></pre>\n\n<p>(which you can read as <code>D x = forall y . C x y</code>)</p>\n\n<p>and then using <code>Forall D</code> (i.e., <code>forall x . D x</code>) to express your constraint. You'll need to use <code>inst</code> to get the <code>Dict (D x)</code> and again to get the <code>Dict (C x y)</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1472058762, "creation_date": 1471201437, "last_edit_date": 1471226402, "question_id": 38945644, "link": "https://stackoverflow.com/questions/38945644/forall-constraints", "title": "Forall constraints", "body": "<p>How do I write a <code>forall</code> constraint, for example for some type families <code>F</code> and <code>G</code>:</p>\n\n<pre><code>forall x y. G (F x y) ~ (x, y) \n</code></pre>\n\n<p>Is it possible using Edward A. Kmett <a href=\"https://hackage.haskell.org/package/constraints-0.8\" rel=\"nofollow\"><code>Constraints</code></a> package? And if so could a small example be provided? I presume I need to use <code>Forall</code>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471199086, "post_id": 38945186, "comment_id": 65245467, "body": "<code>func i str = unlines $ map (\\j -&gt; str ++ &quot;hi&quot; ++ show j) [1..i]</code>"}, {"owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471199555, "post_id": 38945186, "comment_id": 65245639, "body": "thank you Alec, works :)"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1471200803, "post_id": 38945335, "comment_id": 65246003, "body": "There is no need for any <code>do</code> notation in the implementation of <code>func</code>."}, {"owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "edited": false, "score": 0, "creation_date": 1471202280, "post_id": 38945335, "comment_id": 65246403, "body": "Thank you kapol :)"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1471204857, "post_id": 38945335, "comment_id": 65247084, "body": "using <code>if-else</code> here is pretty bad style"}], "tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 1, "last_activity_date": 1471202393, "last_edit_date": 1471202393, "creation_date": 1471199469, "answer_id": 38945335, "question_id": 38945186, "link": "https://stackoverflow.com/questions/38945186/return-a-concatenated-string-in-haskell-recursive-function/38945335#38945335", "title": "Return a concatenated string in Haskell recursive function", "body": "<p>The easiest way to make your code \"work\" (I'll explain the double quotes later) is to call <code>func</code> with the concatenated string as a parameter directly, without intermediate steps:</p>\n\n<pre><code>func :: Int -&gt; String -&gt; String\nfunc i str = do\n        if i &gt; (-1)\n            then func (i-1) (str ++ \"hi\" ++ (show i) ++ \"\\n\")       \n            else str\n</code></pre>\n\n<p>I also added the newline character to the output, which means that the last character of the result will be a new line. Therefore it is better to write</p>\n\n<pre><code>let str = func 2 \"\"\nputStr str\n</code></pre>\n\n<p>That way you'll avoid an extra new line at the end.</p>\n\n<p>I wrote \"works\" in double quotes in the first sentence, because my code prints</p>\n\n<pre><code>hi2\nhi1\nhi0\n</code></pre>\n\n<p>You need to modify <code>func</code> so that the lines are printed in reverse order. Hint: you can store the lines in a list and reverse the list at the end.</p>\n\n<p>P.S. I'm not sure whether zero should be a valid suffix. If not, then you have to change the condition in your <code>if</code> statement.</p>\n"}, {"tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 3, "last_activity_date": 1471204839, "creation_date": 1471204839, "answer_id": 38946085, "question_id": 38945186, "link": "https://stackoverflow.com/questions/38945186/return-a-concatenated-string-in-haskell-recursive-function/38946085#38946085", "title": "Return a concatenated string in Haskell recursive function", "body": "<p>This is a much more idiomatic solution than using <code>if-else</code></p>\n\n<blockquote>\n  <p>a function that would take an integer and return a concatenated (number of times the input) string</p>\n</blockquote>\n\n<pre><code>func :: Int -&gt; String -&gt; String\nfunc 0 s = \"\"\nfunc n s = s ++ func (n - 1) s\n\nmain = putStrLn (func 3 \"hi\")\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>hihihi\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1471210157, "post_id": 38946226, "comment_id": 65248612, "body": "This performs fewer recursive calls, but the cost of <code>s&#39; ++ s&#39;</code> is O(n), which should negate the advantage. I would expect this to use a double amount of memory, if not worse. In the general case, calling <code>++</code> with a large left list argument is not a good idea, since that list must be duplicated to produce the result."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1471404404, "post_id": 38946226, "comment_id": 65327798, "body": "There is a much better way to concatenate lists: pack them into functions, combine them with the <code>.</code> operator, and apply <code>[]</code> when done. You can use <code>id</code> to represent empty strings and pack the string <code>s</code> into a function like this: <code>(s ++)</code>. It helps because it makes sure only one call to <code>++</code> is on the call stack at any given time."}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 2, "last_activity_date": 1471205794, "creation_date": 1471205794, "answer_id": 38946226, "question_id": 38945186, "link": "https://stackoverflow.com/questions/38945186/return-a-concatenated-string-in-haskell-recursive-function/38946226#38946226", "title": "Return a concatenated string in Haskell recursive function", "body": "<p>I wonder if 'logarithmic' solution is faster:</p>\n\n<pre><code>main = putStrLn $mul 7 \"Hi\"\n\nmul :: Int -&gt; String -&gt; String\nmul 0 _ = \"\"\nmul 1 s = s\nmul _ \"\" = \"\"\nmul n s = let\n            (q, r) = n `quotRem` 2\n            s' = mul q s\n    in (if r == 1 then s else \"\") ++ s' ++ s'\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 2931588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93a9499a898bce63dd78f23826dfe02f?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2931588/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1209, "favorite_count": 0, "accepted_answer_id": 38945335, "answer_count": 3, "score": 1, "last_activity_date": 1471205794, "creation_date": 1471198610, "question_id": 38945186, "link": "https://stackoverflow.com/questions/38945186/return-a-concatenated-string-in-haskell-recursive-function", "title": "Return a concatenated string in Haskell recursive function", "body": "<p>I am trying to write a function in haskell that would take an integer and return a concatenated (number of times the input) string</p>\n\n<p>For Instance,</p>\n\n<p>Input: 3</p>\n\n<p>Output: hi1\\nhi2\\nhi3</p>\n\n<pre><code>main = do \n\n    let str = func 2 \"\"\n    putStrLn str\n\nfunc :: Int -&gt; String -&gt; String\nfunc i str = do\n        if i&gt;(-1)\n            then do\n                str ++ \"hi\" ++ (show i)\n                func (i-1) str\n\n        else str\n</code></pre>\n\n<p>Thanking you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471196874, "post_id": 38944845, "comment_id": 65244801, "body": "@Alec: good point. thanks! I&#39;ve edited it to make it less confusing, but I don&#39;t think that fully resolves my confusion."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1471197386, "post_id": 38944845, "comment_id": 65244948, "body": "It looks like they meant the definition to be <code>munge f g v = fst (g (f v))</code>"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1471197778, "post_id": 38944845, "comment_id": 65245067, "body": "@Lee: ah, ok. I&#39;m starting to get it. So in essence the order of the arguments on the left hand side specifies the order of application of the arguments, correct? Which is why when the <code>v</code> appears after <code>g</code> in the function definition, the <code>x</code> type also appears after the <code>(y -&gt; (w,x))</code> in the type declaration. Is this on the right track?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1471198322, "post_id": 38944845, "comment_id": 65245225, "body": "Yes, there are three parameters in the type declaration, and three parameters in the definition, so <code>f</code> has type <code>x -&gt; y</code>, <code>g</code> is <code>y -&gt; (w, z)</code> and <code>x</code> has type <code>x</code>. Then <code>f v</code> has type <code>y</code> and <code>g (f v)</code> has type <code>(w, z)</code>. <code>fst</code> has type <code>(w, z) -&gt; w</code> so <code>fst (g (f v))</code> has type <code>w</code> as required."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1471198529, "post_id": 38944845, "comment_id": 65245291, "body": "@Lee: right. but just to be clear, what I&#39;m saying is that the type signature would be incorrect if it were written <code>(x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; w</code>, because the application of <code>v</code> (of type <code>x</code>, which happens after <code>f</code> and <code>g</code> are composed), is omitted. is that correct?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1471200476, "post_id": 38944845, "comment_id": 65245911, "body": "The last edit makes it impossible; there&#39;s no argument of type <code>x</code> which the first argument can be applied to, which means there is no way to get a value of <code>y</code> which the second function can be applied to."}], "answers": [{"comments": [{"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471197620, "post_id": 38945012, "comment_id": 65245021, "body": "Wait. I agree that something is swapped but shouldn&#39;t it be <code>munge f g v = fst (g (f v))</code> instead?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 1, "creation_date": 1471197685, "post_id": 38945012, "comment_id": 65245040, "body": "@gogurt that is equivalent. Can you see why?"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471198310, "post_id": 38945012, "comment_id": 65245219, "body": "ahhhhh. wait a second. I get the right-association and I can vaguely sense that this has to do with alpha equivalence. but my mind is being blown by the fact that the type declarations for <code>f</code> and <code>g</code> above seem completely irrelevant?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 1, "creation_date": 1471198590, "post_id": 38945012, "comment_id": 65245310, "body": "@gogurt I&#39;m having trouble seeing what you&#39;re seeing. The typechecker understands the type of <code>g</code>, in the first definition of <code>munge</code> I gave, to be <code>(x -&gt; y)</code> because the type signature states that the first argument is of that type. It doesn&#39;t matter if we name the first argument <code>f</code>, <code>g</code>, or <code>ploRTTCxx7</code>"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471198762, "post_id": 38945012, "comment_id": 65245359, "body": "OK, I see. Sorry, I was getting confused because in my original question, the answer I typed out involved explicit type declarations for <code>f</code> and <code>g</code> <i>outside of/before</i> the type declaration for <code>munge</code>. I was referring to that in my comment above. I realize now is that those separate type declarations are irrelevant, because the type declaration for <code>munge</code> contains all that information already. Apologies for the confusion."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471199020, "post_id": 38945012, "comment_id": 65245443, "body": "No need to appologize, I see what you mean now. You&#39;re exactly right that <code>f</code> and <code>g</code> in <code>munge f g ...</code> are said to <i>shadow</i> the <code>f</code> and <code>g</code> you declared elsewhere, i.e. they create new bindings that have nothing to do with bindings of the same name which are in scope. If you compile with <code>-Wall</code> or do <code>:set -Wall</code> in ghci you will get a warning for this and lots of other good things"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471199455, "post_id": 38945012, "comment_id": 65245609, "body": "ahhh ok. much thanks. last comment: do you have any thoughts on the edit I just made re: the second part of this question?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 1, "creation_date": 1471201039, "post_id": 38945012, "comment_id": 65246078, "body": "@gogurt: the type <code>munge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; w</code> reads &quot;a function taking (a function from some <code>x</code> to some <code>y</code>) and (a function from that <code>y</code> to a tuple of some <code>w</code> and <code>z</code>) which yields some type <code>w</code>&quot;. Can you figure out how to get a <code>w</code> from the two function inputs to <code>munge</code>. What if the type of <code>munge</code> was <code>(x -&gt; y) -&gt; (y -&gt; (Int, z)) -&gt; x -&gt; Int</code> (is there a (perhaps silly) implementation for this latter type possible). Some advanced reading: <a href=\"https://www.well-typed.com/blog/2015/05/parametricity/\" rel=\"nofollow noreferrer\">well-typed.com/blog/2015/05/parametricity</a>"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 4, "last_activity_date": 1471198855, "last_edit_date": 1471198855, "creation_date": 1471197323, "answer_id": 38945012, "question_id": 38944845, "link": "https://stackoverflow.com/questions/38944845/notational-confusion-in-a-basic-type-declaration-exercise/38945012#38945012", "title": "Notational confusion in a basic type declaration exercise", "body": "<p>The answer is incorrect and ill-typed. <code>f</code> and <code>g</code> should be swapped:</p>\n\n<pre><code>munge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; x -&gt; w\nmunge g f v = fst (f (g v))\n</code></pre>\n\n<p>I'm not sure if that clears up your confusion.</p>\n\n<p><strong>EDIT</strong> In case it's interesting, here are more equivalent ways of writing this function and its type:</p>\n\n<pre><code>-- notice parens in type signature; `-&gt;` associates right\nmunge :: (x -&gt; y) -&gt; ((y -&gt; (w, z)) -&gt; (x -&gt; w))\nmunge g f v = -- omitted\n\n-- type signature omitted\nmunge boop _plort zOWY = fst (_plort (boop zOWY))\n\nmunge g f = fst . f . g\n\nmunge g = \\f v -&gt; fst . f . g $ v\n\n-- don't do this please\nmunge = ((fst .) .) . (.)\n</code></pre>\n\n<p><strong>EDIT2</strong> It might be helpful to play around with this in GHCi, asking the inferred type of different expressions:</p>\n\n<pre><code>Prelude&gt; let munge g f v = fst (f (g v))\nPrelude&gt; :t munge\nmunge :: (t1 -&gt; t) -&gt; (t -&gt; (a, b)) -&gt; t1 -&gt; a\nPrelude&gt; :t munge head\nmunge head :: (t -&gt; (a, b)) -&gt; [t] -&gt; a\nPrelude&gt; :t munge head (\\x-&gt; (x, not x))\nmunge head (\\x-&gt; (x, not x)) :: [Bool] -&gt; Bool\nPrelude&gt; :t munge ((+1) . fst . snd . head)\nmunge ((+1) . fst . snd . head)\n  :: Num t =&gt; (t -&gt; (a, b)) -&gt; [(a1, (t, b1))] -&gt; a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1471201279, "post_id": 38945548, "comment_id": 65246154, "body": "Thanks for this. But the part I don&#39;t get is: if <code>f</code> is first applied to <code>someArgumentForF</code>, then how come the first step of the reduction is <code>(x -&gt; y) -&gt; ((y -&gt; (w, z)) -&gt; x -&gt; w)</code>? Shouldn&#39;t the <code>x</code> typed variable come earlier in the reduction then?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 1, "creation_date": 1471201762, "post_id": 38945548, "comment_id": 65246275, "body": "The three arguments to <code>munge</code> could be given in any order, but this order lets you partially apply <code>munge</code> to the two function arguments in order to return a function of type <code>x -&gt; w</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1471200771, "creation_date": 1471200771, "answer_id": 38945548, "question_id": 38944845, "link": "https://stackoverflow.com/questions/38944845/notational-confusion-in-a-basic-type-declaration-exercise/38945548#38945548", "title": "Notational confusion in a basic type declaration exercise", "body": "<p>The solution, confusingly, is using the same variables <code>f</code> and <code>g</code> for two different things: as global names for two functions, and as parameter names in defining <code>munge</code>. Making a change of variable should make it clearer:</p>\n\n<pre><code>g :: y -&gt; (w, z)\ng = undefined\n\nf :: x -&gt; y\nf = undefined\n\nmunge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; x -&gt; w\nmunge f1 f2 v = fst (f2 (f1 v)) -- fst . f2 . f1 $ v\n</code></pre>\n\n<p>Then you would call <code>munge</code> on <code>f</code> and <code>g</code> will thing like</p>\n\n<pre><code>munge f g someArgumentForF\n</code></pre>\n\n<p>Inside <code>munge</code>, <code>f</code> (called <code>f1</code>) is first applied to <code>someArgumentForF</code> (called <code>v</code>) to get a value that can be passed to <code>g</code> (called <code>f2</code>). This produces a tuple, and applying <code>fst</code> to the tuple returns the value of type <code>w</code> needed as the final result.</p>\n"}], "owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 38945012, "answer_count": 2, "score": 0, "last_activity_date": 1471200771, "creation_date": 1471196365, "last_edit_date": 1471199073, "question_id": 38944845, "link": "https://stackoverflow.com/questions/38944845/notational-confusion-in-a-basic-type-declaration-exercise", "title": "Notational confusion in a basic type declaration exercise", "body": "<p>I'm going through the new book <em>Haskell Programming from First Principles</em>. It seems decent, but I feel that there are some confusing holes in the explanations. I apologize if I'm missing something basic.</p>\n\n<p>The last problem in chapter 5 is to fill in the ??? below so that things make sense:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>munge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; x -&gt; w\nmunge = ???\n</code></pre>\n\n<p>The solution which was explained to me (after much head-scratching) goes:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>g :: y -&gt; (w, z)\ng = undefined\n\nf :: x -&gt; y\nf = undefined\n\nmunge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; x -&gt; w\nmunge g f v = fst (g (f v))\n</code></pre>\n\n<p>I'm getting hung up on this example in two ways.</p>\n\n<p>First, it seems like the <code>munge</code> function ought to take a <em>function</em> as input which takes <code>x -&gt; y</code>. But the way <code>munge</code> is defined, it seems like we supply an additional argument <code>v</code> to the function <code>f</code> first. But if <code>f :: x -&gt; y</code>, then won't the expression <code>f v</code> be of type just <code>y</code> instead of <code>x -&gt; y</code>?</p>\n\n<p>Second, I'm struggling to understand why the <code>x</code> appears in the second-to-last position in the type declaration. At that point I feel like the logical next piece after the <code>(y -&gt; (w,x))</code> step should just be <code>w</code>, since at that stage the function <code>g</code> is being applied to <code>fst</code> and <code>w</code> ought to be the type of what <code>fst</code> returns. I can feel that I'm close, but can't quite close the gap.</p>\n\n<p>Clearly I'm not understanding the notation correctly. Can anyone set me straight?</p>\n\n<p><strong>EDIT</strong>: Ok, here is a clarifying question to the second part. Is it possible to revise the <code>munge</code> function so that it has the following type (i.e. original type with second-to-last <code>x</code> application omitted)? If so what would it look like?</p>\n\n<pre><code>munge :: (x -&gt; y) -&gt; (y -&gt; (w, z)) -&gt; w\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "data-structures", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1471195756, "post_id": 38944695, "comment_id": 65244429, "body": "So the origin is always the same?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1471213421, "post_id": 38944695, "comment_id": 65249435, "body": "The <a href=\"http://hackage.haskell.org/package/manifolds-0.2.2.0/docs/Data-Manifold-TreeCover.html#g:6\" rel=\"nofollow noreferrer\"><code>ShadeTree</code></a> structure from my <code>manifolds</code> package is intended for precisely this sort of task. You would <i>not</i> work with 3D-points then though, but with actual points of the <a href=\"http://hackage.haskell.org/package/manifolds-0.2.2.0/docs/Data-Manifold-Types.html#t:S-178-\" rel=\"nofollow noreferrer\">sphere surface type</a>. Which I frankly haven&#39;t tested yet with <code>ShadeTree</code>, but it should work just as well on the sphere as it does on real vector spaces."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1471214045, "post_id": 38944695, "comment_id": 65249567, "body": "Actually, <code>SphereMap</code> would rather be represented by <a href=\"http://hackage.haskell.org/package/manifolds-0.2.2.0/docs/Data-Manifold-Web.html\" rel=\"nofollow noreferrer\"><code>PointsWeb</code></a>, which uses <code>ShadeTree</code> as its underlying spatial lookup structure but has extra topological info which you could use to perform the within-distance lookup. \u2014 <b>Neither</b> of these types support <code>insert</code> and <code>remove</code>, though \u2013 it&#39;s only build-once and keep as it is; the only way to change points is to dissolve the structure and build it from scratch (because the tree nodes are based on centroids, so the entire structure changes if you move a leaf)."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1471202605, "post_id": 38944842, "comment_id": 65246499, "body": "I understand how quad-trees work, the issue is how do I translate 3D points on the surface of a sphere to meaningful 2D points on the quad-tree range."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1471214801, "post_id": 38944842, "comment_id": 65249719, "body": "@Viclib for an Octree approach, you&#39;d just embed the sphere as a unit sphere in \u211d&#179; and perform the lookups there (just normalise the vector of any point you want to insert). This would probably work just fine, though it&#39;s arguably less elegant than working in the actual <i>S&#178;</i> manifold. If you use that, I wouldn&#39;t rely on a quad / <i>k</i>-d tree though \u2013 you could theoretically span a quadtree in the polar coordinate representation, but it would get you in trouble because the \u211d&#178;-metric in that system doesn&#39;t agree with the natural one on the sphere surface."}, {"owner": {"reputation": 1548, "user_id": 980270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da2801be4550a5a50de5c0ced2592093?s=128&d=identicon&r=PG", "display_name": "TilmannZ", "link": "https://stackoverflow.com/users/980270/tilmannz"}, "edited": false, "score": 0, "creation_date": 1471519645, "post_id": 38944842, "comment_id": 65384336, "body": "Putting it more simply, you can ignore the fact that your nearest neighbours should be on the surface on a sphere. Whichever points are the nearest neighbours in normal 3D space are automatically also the closest point on the surface on the sphere. So you can simply use a octree, kd-tree or R-Tree (R*Tree, ...). For a lot of data (10e5 points or more) or with frequent updates, I would suggest the PH-Tree (a &#39;trie&#39;  variant of the quadtree)."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1471196343, "creation_date": 1471196343, "answer_id": 38944842, "question_id": 38944695, "link": "https://stackoverflow.com/questions/38944695/what-are-fast-algorithms-data-structures-for-querying-near-points-on-the-surface/38944842#38944842", "title": "What are fast algorithms/data structures for querying near points on the surface of a sphere?", "body": "<p>The usual approach is to use either quad-trees for 2d data or octrees for 3d data. A quad-tree splits the area of concern into 4 quadrants based on X and Y thresholds. For each quadrant, if it contains zero or 1 points then end, otherwise subdivide the quadrant into sub-quadrants and repeat. This gives you a tree of points in which the tree geometry reflects neigbouring geometry. You can then write an algorithm to traverse the tree finding all the quadrants that intersect the radius of your search.\nOct-trees are the same in 3 dimensions,splitting by X, Y and Z.\nSee <a href=\"http://gamedevelopment.tutsplus.com/tutorials/quick-tip-use-quadtrees-to-detect-likely-collisions-in-2d-space--gamedev-374\" rel=\"nofollow\">http://gamedevelopment.tutsplus.com/tutorials/quick-tip-use-quadtrees-to-detect-likely-collisions-in-2d-space--gamedev-374</a> for details.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1471196343, "creation_date": 1471195426, "question_id": 38944695, "link": "https://stackoverflow.com/questions/38944695/what-are-fast-algorithms-data-structures-for-querying-near-points-on-the-surface", "title": "What are fast algorithms/data structures for querying near points on the surface of a sphere?", "body": "<p>I want data structure with the following methods:</p>\n\n<pre><code>insert :: Point3D -&gt; a -&gt; SphereMap a -&gt; SphereMap a\nremove :: Point3D -&gt; a -&gt; SphereMap a -&gt; SphereMap a\nquery :: Float -&gt; Point3D -&gt; SphereMap a -&gt; [a]\n</code></pre>\n\n<p>Where <code>insert</code> and <code>remove</code> add 3D-indexed values to the data structure, <code>query</code> receives an angle and a point, and returns a list of all values that are within that angular distance of the point with respect to origin (0,0,0).</p>\n\n<p>What kinds of data-structures exist for such requirements?</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "stack"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 3, "creation_date": 1471194076, "post_id": 38944494, "comment_id": 65243876, "body": "Note that using the call stack isn&#39;t really &quot;without using extra space&quot;..."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1471194270, "post_id": 38944494, "comment_id": 65243925, "body": "What is &quot;extra space&quot;?  Lists in Haskell are immutable.  If you reverse one, you have to create a new one.  Unless you write the super-naive O(n^2) reverse, you&#39;re already in good shape. The standard O(n) solution already minimizes allocations."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1471194483, "post_id": 38944494, "comment_id": 65244000, "body": "You cannot reverse a stack in O(1) space FP-style. In FP things are immutable. Your imperative solution uses O(n) space too because recursion requires space."}, {"owner": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "edited": false, "score": 0, "creation_date": 1471194695, "post_id": 38944494, "comment_id": 65244074, "body": "OK, the &quot;no extra space&quot; makes it a trick question, that&#39;s why it&#39;s often an exam/interview question. Can we get past that now?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1471194881, "post_id": 38944494, "comment_id": 65244142, "body": "I think what you are looking for is <code>reverse = foldl (flip (:)) []</code>..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1471194923, "post_id": 38944494, "comment_id": 65244158, "body": "Remove all mention of &quot;no extra space&quot; from the question. What&#39;s left? How to reverse a stack?"}, {"owner": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1471195011, "post_id": 38944494, "comment_id": 65244197, "body": "@n.m. yes, but using double recursion, like you&#39;d do in the imperative case."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471195882, "post_id": 38944494, "comment_id": 65244472, "body": "@Morpheu5 Since there are no imperative loops in haskell, you&#39;d use recursion anyway. Just try it."}, {"owner": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471197399, "post_id": 38944494, "comment_id": 65244956, "body": "@Bergi I&#39;m well aware of that, my question was more like &quot;how do I express this (doubly-)recursive algorithm in Haskell to reverse a stack \u2013 aka a list that can&#39;t be built back to front?&quot; rather than &quot;how do I do imperative loops in Haskell?&quot;"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471199420, "post_id": 38944494, "comment_id": 65245597, "body": "@Morpheu5: The hard part in Haskell is to get an under-the-hood stack implementation that you can only <code>push</code> to/<code>pop</code> from. See <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#state\" rel=\"nofollow noreferrer\">here</a> for an example how it could be done by representing it in the <code>State</code> monad. Then you can just use the same &quot;double recursion&quot; solution as presented elsewhere."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471199803, "post_id": 38944494, "comment_id": 65245711, "body": "@Bergi please, no. A list in Haskell is a stack. There&#39;s no need to ever touch the State monad in this discussion."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1471200302, "post_id": 38944494, "comment_id": 65245851, "body": "@n.m.: Yeah, the answer to &quot;<i>a classic problem in imperative programming is stack reversal  [\u2026]. I&#39;ve been trying to solve the same problem in Haskell</i>&quot; should be &quot;in Haskell there is no problem&quot;. You could use the state monad to make it a problem though :-)"}], "answers": [{"comments": [{"owner": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "edited": false, "score": 0, "creation_date": 1471197333, "post_id": 38944833, "comment_id": 65244936, "body": "So, what if you imposed the extra constraint of not being able to build the list back to front \u2013 which is what happens in a stack?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "edited": false, "score": 2, "creation_date": 1471199440, "post_id": 38944833, "comment_id": 65245603, "body": "@Morpheu5 There is only one way to build a list in Haskell: by prepending an element to a smaller list. &quot;Back to front&quot; refers to the order of elements in the original list."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "reply_to_user": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "edited": false, "score": 1, "creation_date": 1471199517, "post_id": 38944833, "comment_id": 65245626, "body": "@Morpheu5 Look again. The code posted in this answer takes a stack, and while it is non-empty, it recursively pops an element off the top of the stack (the <code>(x:xs)</code> bit), and pushes it onto a new stack (the <code>(x:acc)</code> bit). It uses precisely the same methods exposed by any stack ADT."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "edited": false, "score": 0, "creation_date": 1471224229, "post_id": 38944833, "comment_id": 65251439, "body": "@Morpheu5, see the update. I don&#39;t think this is going to go anywhere useful, though."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1471224189, "last_edit_date": 1471224189, "creation_date": 1471196270, "answer_id": 38944833, "question_id": 38944494, "link": "https://stackoverflow.com/questions/38944494/how-to-reverse-a-stack-without-using-extra-space-fp-style/38944833#38944833", "title": "How to reverse a stack without using extra space\u2026 fp-style", "body": "<p>The only efficient way to reverse a list is</p>\n\n<pre><code>reverse = revApp []\n\nrevApp acc [] = acc\nrevApp acc (x:xs) = revApp (x:acc) xs\n</code></pre>\n\n<p>There are various ways to express this idea, but they all lead to basically the same code. The idea is to deconstruct the list from front to back (in stack language, from top to bottom) and builds the new one from back to front.</p>\n\n<hr>\n\n<p>There is no way to work entirely from front to back, because you don't know what the first element of the reversed list will be until you've seen the last element of the argument list. If you want, you <em>can</em> build the structure of the result list from front to back. This will be somewhat slower.</p>\n\n<pre><code>lazyReverse xs = zipWith' (flip const) xs (reverse xs)\n\nzipWith' _ [] _ = []\nzipWith' f (x:xs) ~(y:ys) = f x y : zipWith' f xs ys\n</code></pre>\n\n<p>The idea is to form the structure of the result list by copying the structure of the argument list (front to back) but to get its values from a reversed copy. I don't think there's any way to avoid the heap allocation this involves; the thunk intermediately representing each tail captures references to things that must, therefore, be on the heap and not the stack.</p>\n"}], "owner": {"reputation": 2720, "user_id": 554491, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/4b99817e71264d9531f08de3c8f601f1?s=128&d=identicon&r=PG", "display_name": "Morpheu5", "link": "https://stackoverflow.com/users/554491/morpheu5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "accepted_answer_id": 38944833, "answer_count": 1, "score": -2, "last_activity_date": 1471224189, "creation_date": 1471194007, "last_edit_date": 1471194941, "question_id": 38944494, "link": "https://stackoverflow.com/questions/38944494/how-to-reverse-a-stack-without-using-extra-space-fp-style", "title": "How to reverse a stack without using extra space\u2026 fp-style", "body": "<p>I'm attempting to dive deeper into FP, a little further down the surface of map-reduce stuff I've been doing for the most part lately \u2014 yes, I know there's much more, hence...</p>\n\n<p>Anyway, a classic problem in imperative programming is stack reversal \"without using extra space\". The solution is typically using the call stack in double recursion, to get to the bottom of the stack, take the bottom element, and bring it back up to the outer recursion which re-builds the stack in reverse order. I've been trying to solve the same problem in Haskell, but I can't quite figure out how to express it in that language. Hints?</p>\n\n<p><strong>EDIT</strong> Yes, using the stack <strong>is</strong> using extra space, the question is a trick one often used in exams and interviews to see how people think about stuff. Also, yes, I know stuff is immutable, so creating a duplicate stack that is the reverse of the one given is obviously acceptable.</p>\n\n<p>(btw, y'all have failed the interview\u2026, jk)</p>\n"}, {"tags": ["haskell", "reflection"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1471185295, "post_id": 38943189, "comment_id": 65241452, "body": "<a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#template-haskell\" rel=\"nofollow noreferrer\">Template Haskell</a> can do this, but it&#39;s an advanced topic. Why do you want to define such a function? There&#39;s probably a simpler way of achieving your actual goal."}, {"owner": {"reputation": 1710, "user_id": 5278004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/OruJk.jpg?s=128&g=1", "display_name": "Wes Doyle", "link": "https://stackoverflow.com/users/5278004/wes-doyle"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471185846, "post_id": 38943189, "comment_id": 65241602, "body": "Thanks; just curious about how complex such a task would be, more or less, and looking for a quick way see a list of the functions I&#39;ve defined in this practice file."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1471186071, "post_id": 38943189, "comment_id": 65241662, "body": "Would using <code>:browse ModuleName</code> be enough for your purpose? Reflection is not commonly used in FP. Do you really need it?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471186176, "post_id": 38943189, "comment_id": 65241681, "body": "<a href=\"https://www.haskell.org/haddock/#Overview\" rel=\"nofollow noreferrer\">Haddock</a> is probably the simplest way to get a nice HTML list of all the functions in a module. There&#39;s also <code>ghci</code>&#39;s <code>:bro</code> command. The language itself doesn&#39;t provide built-in reflection capabilities - what you want isn&#39;t <i>easy</i> - because thanks to Haskell&#39;s unique powers of abstraction there are usually better ways of writing code which in other languages would require reflection."}, {"owner": {"reputation": 1710, "user_id": 5278004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/OruJk.jpg?s=128&g=1", "display_name": "Wes Doyle", "link": "https://stackoverflow.com/users/5278004/wes-doyle"}, "edited": false, "score": 0, "creation_date": 1471186638, "post_id": 38943189, "comment_id": 65241791, "body": "Thanks guys. Using <code>:browse</code> in ghci works great as a solution."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1471188405, "post_id": 38943468, "comment_id": 65242294, "body": "You may want to note that <code>:browse</code> can take a module name as an argument."}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 3, "last_activity_date": 1471186961, "creation_date": 1471186961, "answer_id": 38943468, "question_id": 38943189, "link": "https://stackoverflow.com/questions/38943189/view-all-functions-defined-in-a-haskell-file/38943468#38943468", "title": "View all functions defined in a Haskell file", "body": "<p>Let's say you don't want to define and execute a function but you simply want to see what functions you have defined in a file. Say your definitions above are in <code>foo.hs</code>. This is how you can see what functions you have defined:</p>\n\n<pre><code>$ ghci foo.hs\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( foo.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; :browse\nremoveOdd :: Integral a =&gt; [a] -&gt; [a]\nremoveOddGuards :: Integral a =&gt; [a] -&gt; [a]\ndouble :: Num t =&gt; [t] -&gt; [t]\n*Main&gt;\n</code></pre>\n"}], "owner": {"reputation": 1710, "user_id": 5278004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/OruJk.jpg?s=128&g=1", "display_name": "Wes Doyle", "link": "https://stackoverflow.com/users/5278004/wes-doyle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 38943468, "answer_count": 1, "score": 0, "last_activity_date": 1593712559, "creation_date": 1471184809, "last_edit_date": 1593712559, "question_id": 38943189, "link": "https://stackoverflow.com/questions/38943189/view-all-functions-defined-in-a-haskell-file", "title": "View all functions defined in a Haskell file", "body": "<p>I'm learning functional programming by learning Haskell. For practicing the syntax and structuring very simple functions, I've created a small file; let's say it looks something like this:</p>\n\n<pre><code>removeOdd nums =\n  if null nums\n    then []\n    else\n      if (mod (head nums) 2) == 0 --is even?\n        then (head nums) : (removeOdd (tail nums))\n        else removeOdd (tail nums)\n\nremoveOddGuards [] = []\nremoveOddGuards (x : xs)\n  | mod x 2 == 0 = x : (removeOdd xs)\n  | otherwise    = removeOdd xs\n\ndouble nums = case nums of\n  []       -&gt; []\n  (x : xs) -&gt; (2 * x) : (double xs)\n</code></pre>\n\n<p>I would like to define a function which returns a list of all of the names of functions defined in the file, like:</p>\n\n<pre><code>[\"removeOdd\", \"removeOddGuards\", \"double\"]\n</code></pre>\n\n<p>I suppose I would implement reflection in an object-oriented language, but am as of yet too na\u00efve to understand if this is even a valid concept in functional programming.</p>\n\n<p>For practical purposes, I'd like to be able to call such a function to see a basic index of the functions I've created in this practice file.</p>\n"}, {"tags": ["haskell", "domain-modelling"], "answers": [{"comments": [{"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471174195, "post_id": 38941757, "comment_id": 65238582, "body": "and what will be the case for <i>|</i> : ( <i>|</i> : <i>|</i> ). 3rd row, first element from right?"}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471174451, "post_id": 38941757, "comment_id": 65238644, "body": "so you mean, there are 2 elements in list and both are undefined and [] is also undefined?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1471175148, "last_edit_date": 1471175148, "creation_date": 1471174018, "answer_id": 38941757, "question_id": 38941670, "link": "https://stackoverflow.com/questions/38941670/domain-construction-haskell/38941757#38941757", "title": "Domain construction Haskell", "body": "<p>Yes, <code>_|_ : _|_</code> is the constructor for lists <code>:</code>, applies to an undefined list element and undefined list tail. This is the value, for instance, associated to the Haskell program</p>\n\n<pre><code>let list = list\n    elem = elem\nin elem : list\n</code></pre>\n\n<p>Similarly, <code>Empty : _|_</code> is the value associated to</p>\n\n<pre><code>let list = list\nin Empty : list\n</code></pre>\n\n<p>There's no <code>[]</code> here because the tail of the list fails to terminate (converge) because of the infinite recursion, so its value is undefined (<code>_|_</code>).</p>\n\n<p>In the domain ordering, we have the increasing sequence</p>\n\n<pre><code>_|_\nEmpty : _|_\nEmpty : Empty : _|_\nEmpty : Empty : Empty : _|_\n...\n</code></pre>\n\n<p>having limit (AKA lub or supremum) the infinite list repeating <code>Empty</code> forever.</p>\n\n<p>The value</p>\n\n<pre><code>_|_ : _|_ : _|_\n</code></pre>\n\n<p>is the one associated to</p>\n\n<pre><code>let list = list\n    elem = elem\nin elem : elem : list\n</code></pre>\n\n<p>By comparison,</p>\n\n<pre><code>_|_ : _|_ : []\n</code></pre>\n\n<p>is the value of</p>\n\n<pre><code>let elem = elem\nin elem : elem : []\n</code></pre>\n\n<p>Note that the above allows the length to be computed, since the list has a definite end. Taking its <code>length</code> will produce 2, since there's no need to evaluate the list elements, so no bottom is forced.</p>\n"}], "owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 38941757, "answer_count": 1, "score": -1, "last_activity_date": 1471175148, "creation_date": 1471173408, "last_edit_date": 1471174087, "question_id": 38941670, "link": "https://stackoverflow.com/questions/38941670/domain-construction-haskell", "title": "Domain construction Haskell", "body": "<p>I have a data type :</p>\n\n<pre><code>data Tree e = Node e (Tree e) (Tree e) | Empty deriving (Show)\n\ntype Forest e = [Tree e]\n\ndata Animal = Squirrel | None deriving (Show)\n</code></pre>\n\n<p>and the graphical representation of <strong>Forest Int</strong> is :</p>\n\n<p><a href=\"https://i.stack.imgur.com/ztVMV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ztVMV.png\" alt=\"enter image description here\"></a></p>\n\n<p>The last element is bottom. Then in second last row, it can be empty. But i didn't understand what <code>\u22a5:\u22a5</code> mean. Is it the constructor for list? like this <code>5:[]</code>? Then in 3rd row, why <code>[]</code> is missing in <code>Empty:\u22a5</code>. </p>\n\n<p>Can anyone please explain me what I am understanding wrong here.\nThank you.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471173567, "post_id": 38941628, "comment_id": 65238432, "body": "Just use <code>[ (x, bmiTell x 185) | x &lt;- [68..70] ]</code>"}, {"owner": {"reputation": 5, "user_id": 3774908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IhZjH.jpg?s=128&g=1", "display_name": "justice", "link": "https://stackoverflow.com/users/3774908/justice"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471173825, "post_id": 38941628, "comment_id": 65238499, "body": "Indeed, thank you, may I have your answer please? <i>so embarassed</i>"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1520646645, "post_id": 38941628, "comment_id": 85414441, "body": "Put bmiTell X 185 in a list [bmiTell X 185] and your&#39;s should work. Remember, strings are lists. The comprehension was pull}ng from the only list it found. Also, two generators in a comprehension are aXb or Cartesian"}], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 3, "last_activity_date": 1471174412, "last_edit_date": 1471174412, "creation_date": 1471173855, "answer_id": 38941733, "question_id": 38941628, "link": "https://stackoverflow.com/questions/38941628/haskell-getting-a-string-from-list-comprehension/38941733#38941733", "title": "Haskell getting a string from list comprehension", "body": "<p>You can simply use the <code>map</code> function:</p>\n\n<pre><code>map (\\w -&gt; (w, bmiTell w 185)) [68..70]\n</code></pre>\n\n<p>Or as @ErikR mentioned, using list comprehension:</p>\n\n<pre><code>[ (x, bmiTell x 185) | x &lt;- [68..70] ]\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 3774908, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IhZjH.jpg?s=128&g=1", "display_name": "justice", "link": "https://stackoverflow.com/users/3774908/justice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 0, "accepted_answer_id": 38941733, "answer_count": 1, "score": 0, "last_activity_date": 1471174412, "creation_date": 1471173143, "question_id": 38941628, "link": "https://stackoverflow.com/questions/38941628/haskell-getting-a-string-from-list-comprehension", "title": "Haskell getting a string from list comprehension", "body": "<p>I'm going through Learn You A Haskell. I have a following function:</p>\n\n<pre><code>bmiTell :: (RealFloat a) =&gt; a -&gt; a-&gt; String\nbmiTell weight height\n  | bmi &lt;= skinny =\"underweight\"\n  | bmi &lt;= normal = \"ok\"\n  | bmi &lt;= fat = \"fat\"\n  | otherwise = \"whale\"\n  where\n    bmi = weight/height^2\n    (skinny,normal,fat)=(18.5, 25.0,30.0)\n</code></pre>\n\n<p>which works perfectly fine. I'm now making a list comprehension, where\na desired result is something like this:</p>\n\n<blockquote>\n  <p>[(68, \"underweight\"),(69,\"ok\"),(70,\"ok\")]</p>\n</blockquote>\n\n<p>this is my ghci input:</p>\n\n<pre><code>[(x,y)| x &lt;-[68..70], y &lt;- bmiTell x 185]\n</code></pre>\n\n<p>and the output is </p>\n\n<blockquote>\n  <p>[(68.0,'u'),(68.0,'n'),(68.0,'d'),(68.0,'e'),(68.0,'r'),(68.0,'w'),(68.0,'e'),(68.0,'i'),(68.0,'g'),(68.0,'h'),(68.0,'t'),(69.0,'u'),(69.0,'n'),(69.0,'d'),(69.0,'e'),(69.0,'r'),(69.0,'w'),(69.0,'e'),(69.0,'i'),(69.0,'g'),(69.0,'h'),(69.0,'t'),(70.0,'u'),(70.0,'n'),(70.0,'d'),(70.0,'e'),(70.0,'r'),(70.0,'w'),(70.0,'e'),(70.0,'i'),(70.0,'g'),(70.0,'h'),(70.0,'t')]</p>\n</blockquote>\n\n<p>I tried making it a (x,[y]), but I get the same result with Chars in \"\"s instead of single quotes</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1471167457, "post_id": 38940352, "comment_id": 65237012, "body": "Wouldn&#39;t <code>a ~ T b</code> work ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471168632, "post_id": 38940352, "comment_id": 65237289, "body": "Apparently <code>type Tinv b = a</code> is rejected because the tyvar <code>a</code> must be mentioned in the arguments of <code>Tinv</code>, which looks too restrictive when it is determined by them thanks to the fundeps in scope."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1471183414, "post_id": 38940352, "comment_id": 65240900, "body": "It is impossible to convert the fundep to an explicit type family application, but as @mb14 said, using an equality constraint in a type signature you can compute the inverse - e.g. <code>(a ~ T b) =&gt; Proxy a -&gt; Proxy b</code> or equivalently <code>Proxy (T b) -&gt; Proxy b</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1471187758, "post_id": 38940352, "comment_id": 65242100, "body": "Injective type families smell like a language feature in progress. Their restrictions (such as not allowing any type family applications in the RHS) are extremely unnatural."}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1617431084, "post_id": 48471327, "comment_id": 118305566, "body": "Is there any way to write the inverse function of <code>f</code>: <code>g :: Int -&gt; T&#39; Bool</code>? My guess is no?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1617433958, "post_id": 48471327, "comment_id": 118306045, "body": "@Hjulle Huh. Seems like a bug. You should report it to the GHC issue tracker and see what they say."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1517012121, "creation_date": 1517012121, "answer_id": 48471327, "question_id": 38940352, "link": "https://stackoverflow.com/questions/38940352/inverse-injective-type-families/48471327#48471327", "title": "Inverse injective type families", "body": "<p>With suitable extensions, one can write:</p>\n\n<pre><code>type T' b = forall a. T a ~ b =&gt; a\n</code></pre>\n\n<p>For example, here's an example showing that you get at least basic type compatibility with this type synonym:</p>\n\n<pre><code>type family T a = b | b -&gt; a\ntype instance T Int = Bool\n\nf :: T' Bool -&gt; Int\nf x = x\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 48471327, "answer_count": 1, "score": 11, "last_activity_date": 1517012121, "creation_date": 1471162068, "last_edit_date": 1516847201, "question_id": 38940352, "link": "https://stackoverflow.com/questions/38940352/inverse-injective-type-families", "title": "Inverse injective type families", "body": "<p>Lets say I have an injective type family <code>T</code></p>\n\n<pre><code>type family T a = b | b -&gt; a\n</code></pre>\n\n<p>My first question is there an way to write:</p>\n\n<pre><code>type family T' = the inverse of T\n</code></pre>\n\n<p>Without having to repeat all the instances of <code>T</code> but in reverse.</p>\n\n<p>Such that: <code>T (X1 a (T' a)) = a</code></p>\n\n<p>It seems like this should work, as both <code>T</code> and <code>T'</code> are injective, given one side it is mechanical to work out the other. </p>\n\n<p>Anyway to write <code>T'</code>?</p>\n"}, {"tags": ["haskell", "semantics", "discrete-mathematics", "equational-reasoning"], "comments": [{"owner": {"reputation": 23808, "user_id": 2382734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d80069e46785505b443aa9d1dd9eb3a3?s=128&d=identicon&r=PG", "display_name": "Renzo", "link": "https://stackoverflow.com/users/2382734/renzo"}, "edited": false, "score": 6, "creation_date": 1471160152, "post_id": 38940114, "comment_id": 65235462, "body": "I&#39;m voting to close this question as off-topic because it is not a programming question."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 23808, "user_id": 2382734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d80069e46785505b443aa9d1dd9eb3a3?s=128&d=identicon&r=PG", "display_name": "Renzo", "link": "https://stackoverflow.com/users/2382734/renzo"}, "edited": false, "score": 0, "creation_date": 1471160394, "post_id": 38940114, "comment_id": 65235504, "body": "@Renzo can you please tell me then where to ask this kind of question? Thank you"}, {"owner": {"reputation": 23808, "user_id": 2382734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d80069e46785505b443aa9d1dd9eb3a3?s=128&d=identicon&r=PG", "display_name": "Renzo", "link": "https://stackoverflow.com/users/2382734/renzo"}, "edited": false, "score": 0, "creation_date": 1471160591, "post_id": 38940114, "comment_id": 65235536, "body": "You can try <a href=\"http://cs.stackexchange.com\">cs.stackexchange.com</a> or maybe <a href=\"http://math.stackexchange.com\">math.stackexchange.com</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1471165403, "post_id": 38940114, "comment_id": 65236529, "body": "This kind of questions are bettre suited to ComputerScience StackExchange. In any case: you should start from the definition <code>&lt;=</code> is transitive if given <code>s &lt;= s&#39;</code> and <code>s&#39; &lt;= s&#39;&#39;</code> it holds that <code>s &lt;= s&#39;&#39;</code>. Then you take the definition of <code>&lt;=</code> and check which cases are possible. <code>s &lt;= s&#39;</code> may hold because <code>s == s&#39;</code>, or because there is an <code>n</code> such that ... same for <code>s&#39; &lt;= s&#39;&#39;</code>, you just prove case by case."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1471166021, "post_id": 38940114, "comment_id": 65236648, "body": "@Bakuriu.. i have posted question there as well, and thank you again for helping me out. I try to solve it now, and can you explain the 2nd question. How to find the chain of this series."}], "answers": [{"comments": [{"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471161909, "post_id": 38940293, "comment_id": 65235775, "body": "Can you please explain a bit, how you find the chain."}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471163721, "post_id": 38940293, "comment_id": 65236166, "body": "pn([x,0,0 .. ])  == x for any n. If chain x-es satisfy transitivity, chain of sets X-es also."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471164077, "post_id": 38940293, "comment_id": 65236239, "body": "thank you for this, but i didn&#39;t get it, how pn(x,0,0,0..) ? , how do you derive this.  can you explain this, as Im still struggling with this question."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471169810, "post_id": 38940293, "comment_id": 65237558, "body": "can this be the chain : [0,0,1,1,2,2...] ?"}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471184442, "post_id": 38940293, "comment_id": 65241218, "body": "Chan is chan of elements. One element is sequence of integers, so to build chain it is needed  chain of sequences of integers. This chan has to ordered (transitivity rule). Comparison of two elements (two sequences of integers) is defined as mapping trough function pn to get integer from sequence of integers and then comparing. So [0,0,1,1,2,2, ..] is just single element, what you need is chain of such elements."}], "tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 1, "last_activity_date": 1471161568, "creation_date": 1471161568, "answer_id": 38940293, "question_id": 38940114, "link": "https://stackoverflow.com/questions/38940114/prove-transitivity-in-haskell-semantics/38940293#38940293", "title": "Prove Transitivity in Haskell semantics", "body": "<ol>\n<li><p>Just a sketch -> Since pn(s) for fixed n is morphism  Ninf -> N , that is <em>set of Integers</em>  into <em>Integer</em>, this proof can be simplified using this relation into proof of transitivity over integers</p></li>\n<li><p>[1,0,0 .. ] ->  [2,0,0 ..] -> [3,0,0 ..] -> ...<br>\nI am sure you can find even more interesting one</p></li>\n</ol>\n"}], "owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "closed_date": 1471165383, "answer_count": 1, "score": 0, "last_activity_date": 1471161568, "creation_date": 1471159941, "last_edit_date": 1592644375, "question_id": 38940114, "link": "https://stackoverflow.com/questions/38940114/prove-transitivity-in-haskell-semantics", "closed_reason": "Not suitable for this site", "title": "Prove Transitivity in Haskell semantics", "body": "<p>I am learning semantics of Haskell and there I came across this question:</p>\n<p><a href=\"https://i.stack.imgur.com/Gpnqi.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Gpnqi.png\" alt=\"enter image description here\" /></a></p>\n<p>I have tried it but still unable to conclude the answer. It will be great if someone explains me how to prove this one. Thank you.</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1471157486, "post_id": 38939860, "comment_id": 65235025, "body": "I did but the compiler gave me <code>illegal instance declaration for &#39;Show (Parser a)&#39;</code>"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1471157760, "post_id": 38939860, "comment_id": 65235065, "body": "@Threex , I tried it without that piece of code and then run in ghci <code>succeed &quot;test&quot;</code> and I got an error that  Parser a is not an instance of show"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1471169802, "post_id": 38939860, "comment_id": 65237557, "body": "it worked for me to encapsulate it in a new type as the following : <code>new type Parser a = Parser {parse :: String -&gt; [(a,String)]}</code> but I got an error on the function succeed so how could I fix the <code>succeed</code> function to work with the new type"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1471174399, "post_id": 38939860, "comment_id": 65238637, "body": "@khaledomar You have to construct the parser by using <code>\\inp -&gt; Parser [(v, inp)]</code>."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 3, "last_activity_date": 1471158099, "last_edit_date": 1495541803, "creation_date": 1471157223, "answer_id": 38939860, "question_id": 38939672, "link": "https://stackoverflow.com/questions/38939672/haskell-error-while-using-custom-type-in-ghci/38939860#38939860", "title": "Haskell: error while using custom type in GHCi", "body": "<p>Alright, the short answer is: you cannot do this.</p>\n\n<p>The long answer involves using a <code>newtype</code>:</p>\n\n<pre><code>newtype Parser a = Parser [(a, String)]\n\ninstance Show (Parser a) where\n  ...\n</code></pre>\n\n<p>For an explanation, see <a href=\"https://stackoverflow.com/questions/8633470/illegal-instance-declaration-when-declaring-instance-of-isstring\">this</a> question.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471158244, "post_id": 38939940, "comment_id": 65235142, "body": "@khaled-omar  I hope this helps"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1471168750, "post_id": 38939940, "comment_id": 65237310, "body": "it helps in GHCI but what  I wanted is to create the whole in an editor then  test my code in GHCI  since I have many other parser functions"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1471158651, "last_edit_date": 1471158651, "creation_date": 1471158086, "answer_id": 38939940, "question_id": 38939672, "link": "https://stackoverflow.com/questions/38939672/haskell-error-while-using-custom-type-in-ghci/38939940#38939940", "title": "Haskell: error while using custom type in GHCi", "body": "<p>Just Enter this in <code>GHCi</code>: </p>\n\n<pre><code>let succeed :: a -&gt; String -&gt; [(a, String)]; succeed v = \\inp -&gt; [(v, inp)]\n</code></pre>\n\n<p>test:  </p>\n\n<pre><code>succeed 12 \"str\"\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[(12,\"str\")]\n</code></pre>\n\n<p>test:</p>\n\n<pre><code>Prelude&gt; :t succeed\nsucceed :: a -&gt; String -&gt; [(a, String)]\n</code></pre>\n\n<hr>\n\n<p>Also this works in <code>GHCi</code>: </p>\n\n<pre><code>type Parser a = String -&gt; [(a,String)]\nlet succeed :: a -&gt; Parser a; succeed v = \\inp -&gt; [(v, inp)]\n</code></pre>\n\n<p>test:  </p>\n\n<pre><code>succeed 12 \"str\"\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[(12,\"str\")]\n</code></pre>\n\n<p>test:</p>\n\n<pre><code>Prelude&gt; :t succeed\nsucceed :: a -&gt; Parser a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1471193643, "creation_date": 1471193643, "answer_id": 38944444, "question_id": 38939672, "link": "https://stackoverflow.com/questions/38939672/haskell-error-while-using-custom-type-in-ghci/38944444#38944444", "title": "Haskell: error while using custom type in GHCi", "body": "<p>This is really not what you want, I don't think. The usual way to define a parser of this type is</p>\n\n<pre><code>newtype Parser a = Parser {runParser :: String -&gt; [(a, String)]}\n</code></pre>\n\n<p>The parser itself is a <em>function</em> whose result is a list. You can't really show one very meaningfully. One option the other answers get at is to write a custom type for the parser result:</p>\n\n<pre><code>newtype Parser a = Parser {runParser :: String -&gt; Result a}\n\nnewtype Result a = Result {getResult :: [(a, String)]}\n\ninstance Show a =&gt; Show (Result a) where\n  show (Result xs) = case xs of\n    [] -&gt;  \"No results\"\n    [x] -&gt; \"One result: \" ++ show x\n    _ -&gt; \"Multiple results\"\n</code></pre>\n"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 38939860, "answer_count": 3, "score": 0, "last_activity_date": 1471193643, "creation_date": 1471155074, "last_edit_date": 1471159335, "question_id": 38939672, "link": "https://stackoverflow.com/questions/38939672/haskell-error-while-using-custom-type-in-ghci", "title": "Haskell: error while using custom type in GHCi", "body": "<p>I have declared the following type </p>\n\n<pre><code>type Parser a = String -&gt; [(a,String)]\n</code></pre>\n\n<p>and some function to operate on the parser as the bellow </p>\n\n<pre><code>succeed :: a -&gt; Parser a\nsucceed v = \\inp -&gt; [(v,inp)]\n</code></pre>\n\n<p>when trying to run <code>stack ghci</code> in order to test the above function <code>succeed</code> I got an error that Parser is not an instance of <code>show</code> so I've tried to update the code and add the following </p>\n\n<pre><code>instance Show Parser where\n  show [(v,inp)] = show (v,inp)\n</code></pre>\n\n<p>but I got an error that <code>Show</code> is expecting the argument to be <code>*</code> but it is <code>* -&gt; *</code></p>\n\n<p>How could I solve that so I can test my function in <code>GHCi</code>?</p>\n"}, {"tags": ["haskell", "liquid-haskell"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 4857565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/384fdc3e09f04f5f6f94d215b55dde34?s=128&d=identicon&r=PG&f=1", "display_name": "ulbrec", "link": "https://stackoverflow.com/users/4857565/ulbrec"}, "edited": false, "score": 0, "creation_date": 1471200628, "post_id": 38943118, "comment_id": 65245951, "body": "Thanks for the great answer and the links to the working demos. This is exactly what I needed."}], "tags": [], "owner": {"reputation": 2381, "user_id": 586750, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/16b87da510d278999c892cdbdd55c1b6?s=128&d=identicon&r=PG", "display_name": "Eric Seidel", "link": "https://stackoverflow.com/users/586750/eric-seidel"}, "is_accepted": true, "score": 1, "last_activity_date": 1471184304, "creation_date": 1471184304, "answer_id": 38943118, "question_id": 38938431, "link": "https://stackoverflow.com/questions/38938431/using-liquid-haskell-to-check-for-valid-tokens/38943118#38943118", "title": "Using Liquid Haskell to Check for Valid Tokens", "body": "<p>There are a couple problems here.</p>\n\n<ol>\n<li><p>You're trying to define <code>currTime</code> as a measure but measures are supposed to be functions. This should be flagged as an error by LiquidHaskell.</p></li>\n<li><p>You may have noticed this before you made <code>currTime</code> a measure, but you can't currently refer to top-level definitions in a type signature. We can fix your example by passing <code>currTime</code> as a parameter to <code>isExpired</code>, and by adding a parameter to the <code>ValidToken</code> type (which is probably what you want to do anyway since the validity of the token is with respect to some timestamp). Here's a <a href=\"http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1471182482_14729.hs\" rel=\"nofollow\">link</a> to the working version on our demo page.</p></li>\n</ol>\n\n<p>Finally, you certainly can rewrite the code to use <code>getCurrentTime</code> inside <code>isValid</code>, though you'll probably need to change the definition of <code>ValidToken</code> since the current time never escapes <code>isValid</code>. <a href=\"http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1471183846_14737.hs\" rel=\"nofollow\">Here's</a> how I would do it. </p>\n\n<p>I define an \"uninterpreted\" measure (no body) called <code>valid</code> and change <code>isExpired</code>'s type to return <code>IO {v:Bool | ((Prop v) &lt;=&gt; (not (valid t)))}</code>. Unfortunately, LiquidHaskell can't verify the definition of <code>isExpired</code> because we haven't told it what <code>valid</code> means. So we have to <code>assume</code> the type for <code>isExpired</code>, making it part of our trusted computing base. I'm ok with this because it's a small function, and it's the only thing that needs to be assumed.</p>\n"}], "owner": {"reputation": 55, "user_id": 4857565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/384fdc3e09f04f5f6f94d215b55dde34?s=128&d=identicon&r=PG&f=1", "display_name": "ulbrec", "link": "https://stackoverflow.com/users/4857565/ulbrec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 38943118, "answer_count": 1, "score": 3, "last_activity_date": 1471184304, "creation_date": 1471138363, "question_id": 38938431, "link": "https://stackoverflow.com/questions/38938431/using-liquid-haskell-to-check-for-valid-tokens", "title": "Using Liquid Haskell to Check for Valid Tokens", "body": "<p>I am doing some experimentation using liquid-haskell to see what kinds of neat things I can do with it and I have hit a bit of a wall. The basic idea is that I have some functions that require an access token that expires after a certain amount of time has passed. I am trying to see how I might use liquid-haskell to ensure that the token is checked for validity before passing it into one of my functions. I have created a minimal working version below that demonstrates my problem. When I run liquid on this file I get the following error:</p>\n\n<pre><code>/tmp/liquidTest.hs:18:17-42: Error: Liquid Type Mismatch\n\n 18 | isExpired tok = currTime &gt;= expiration tok\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   Inferred type\n     VV : {VV : GHC.Types.Bool | Prop VV &lt;=&gt; Main.currTime &gt;= ?a}\n\n   not a subtype of Required type\n     VV : {VV : GHC.Types.Bool | Prop VV &lt;=&gt; currTime &gt;= expiration tok}\n\n   In Context\n     Main.currTime := Data.Time.Clock.UTC.UTCTime\n\n     tok := Main.Token\n\n     ?a := {?a : Data.Time.Clock.UTC.UTCTime | ?a == expiration tok}\n</code></pre>\n\n<p>I cannot seem to figure out why this error is showing up and everything I have tried has failed. Could someone please help me?</p>\n\n<p>Also, I would like to have the currTime function replaced with the getCurrentTime function in the time package. That way I can compare the timestamp on the token with the current time. That would mean that my isExpired function would be of type Token -> IO Bool. Would that even be possible using liquid haskell?</p>\n\n<pre><code>import Data.Time\nimport Language.Haskell.Liquid.Prelude\n\n{-@ data Token = Token\n         (expiration :: UTCTime)\n@-}\n\ndata Token = Token\n    { expiration :: UTCTime\n    } deriving Show\n\n{-@ measure currTime :: UTCTime @-}\ncurrTime :: UTCTime\ncurrTime = UTCTime (ModifiedJulianDay 57614) 83924.978297\n\n{-@ isExpired :: t:Token -&gt; {v:Bool | ((Prop v) &lt;=&gt; (currTime &gt;= expiration t))} @-}\nisExpired :: Token -&gt; Bool\nisExpired tok = currTime &gt;= expiration tok\n\n{-@ type ValidToken = {t:Token | currTime &lt; expiration t} @-}\n\n{-@ showToken :: ValidToken -&gt; String @-}\nshowToken :: Token -&gt; String\nshowToken tok = show tok\n\nmain :: IO ()\nmain = do\n  ct &lt;- getCurrentTime\n  let tok = Token ct\n\n  print currTime\n\n  case isExpired tok of\n    True -&gt; putStrLn \"The token has expired!\"\n    False -&gt; putStrLn $ showToken tok\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "trace", "stderr", "frege"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1471135423, "creation_date": 1471135423, "answer_id": 38938211, "question_id": 38937947, "link": "https://stackoverflow.com/questions/38937947/frege-trace-not-printing/38938211#38938211", "title": "Frege trace not printing", "body": "<p>I changed <code>debug</code> to:</p>\n\n<pre><code>debug :: String -&gt; \u03b1 -&gt; \u03b1\ndebug msg f = if trace msg then f else f\n</code></pre>\n\n<p>and got output emitted onto stderr.</p>\n"}, {"comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1471167633, "post_id": 38938212, "comment_id": 65237069, "body": "One could also use <code>traceLn</code> to make it print in &quot;real time&quot;"}], "tags": [], "owner": {"reputation": 12143, "user_id": 367649, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/HNrje.jpg?s=128&g=1", "display_name": "Marimuthu Madasamy", "link": "https://stackoverflow.com/users/367649/marimuthu-madasamy"}, "is_accepted": true, "score": 2, "last_activity_date": 1471201100, "last_edit_date": 1471201100, "creation_date": 1471135443, "answer_id": 38938212, "question_id": 38937947, "link": "https://stackoverflow.com/questions/38937947/frege-trace-not-printing/38938212#38938212", "title": "Frege trace not printing", "body": "<p>As <code>const</code> doesn't use the second argument, <code>trace</code> doesn't get invoked. You could use <code>seq</code> or pattern match.</p>\n\n<p>If you change the <code>debug</code> function to this:</p>\n\n<pre><code>debug msg f = trace msg `seq` f\n</code></pre>\n\n<p>or to this:</p>\n\n<pre><code>debug msg f | trace msg = undefined\n            | otherwise = f\n</code></pre>\n\n<p>It still won't print anything due to flushing so if you change the <code>main</code> to flush <code>stderr</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do println (polyB :: Int    )\n          println (polyB :: Int    )\n          println (polyB :: Integer)\n          stderr.flush\n</code></pre>\n\n<p>It would work and it prints all the debug messages at the end:</p>\n\n<pre><code>frege&gt; main\n0\n0\n0\npolyA\npolyB\npolyA\npolyB\npolyA\npolyB\n()\n</code></pre>\n\n<p>As Ingo mentioned, we could also use <code>traceLn</code> to have it flushed automatically when the function is called.</p>\n"}], "owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 38938212, "answer_count": 2, "score": 1, "last_activity_date": 1471201100, "creation_date": 1471131982, "question_id": 38937947, "link": "https://stackoverflow.com/questions/38937947/frege-trace-not-printing", "title": "Frege trace not printing", "body": "<p>As the title says, for some reason, messages passed to the <code>trace</code> (well, a variant of which) function don't show up properly when debugging functions. Simply flushing stdout/stderr doesn't seem to do anything, either.</p>\n\n<pre><code>-- Makes it more like Haskell's trace\ndebug :: String -&gt; \u03b1 -&gt; \u03b1\ndebug msg f = const f $ trace msg\n\n-- dummy function\npolyA :: (Num \u03b1) =&gt; \u03b1\npolyA = debug \"polyA\\n\" 0\n\n-- another dummy function\npolyB :: (Num \u03b1) =&gt; \u03b1\npolyB = debug \"polyB\\n\" polyA\n\nmain :: IO ()\nmain = do println (polyB :: Int    )\n          println (polyB :: Int    )\n          println (polyB :: Integer)\n</code></pre>\n\n<p>Output is just</p>\n\n<pre><code>0\n0\n</code></pre>\n\n<p>with nothing visible in stderr (normally represented by red text in Eclipse's console).</p>\n"}, {"tags": ["mongodb", "haskell", "scotty"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471126563, "post_id": 38937264, "comment_id": 65230852, "body": "This commentary on the design of the drive API might help:   <a href=\"https://github.com/mongodb-haskell/mongodb/blob/master/doc/Article1.md#pipelining\" rel=\"nofollow noreferrer\">github.com/mongodb-haskell/mongodb/blob/master/doc/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471191074, "post_id": 38943567, "comment_id": 65243026, "body": "Hi, thanks. But I don&#39;t really think this answers my 3 questions. In fact, it made me add a new 4th question to the mix :)"}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471218004, "post_id": 38943567, "comment_id": 65250376, "body": "You should only ask one question per question here. However, I&#39;ve answered questions 1 and 2. I&#39;ll update with an answer to 3."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471218151, "post_id": 38943567, "comment_id": 65250409, "body": "See this for the policy on multiple questions <a href=\"http://meta.stackexchange.com/questions/39223/one-post-with-multiple-questions-or-multiple-posts\" title=\"one post with multiple questions or multiple posts\">meta.stackexchange.com/questions/39223/&hellip;</a>"}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471297463, "post_id": 38943567, "comment_id": 65281835, "body": "But <code>withMongoDBPool</code> is from <code>Database.Persist.MongoDB</code>, a different way of doing MongoDB. The question is about functions in <code>Database.MongoDB</code>. I&#39;m mostly interested in those at this point."}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 1, "last_activity_date": 1471218046, "last_edit_date": 1495542399, "creation_date": 1471187615, "answer_id": 38943567, "question_id": 38937264, "link": "https://stackoverflow.com/questions/38937264/haskell-database-connections/38943567#38943567", "title": "Haskell database connections", "body": "<p>What you really want is a database connection pool. Take a look at the code from <a href=\"https://stackoverflow.com/a/23190718/482382\">this other answer</a>.</p>\n\n<p>Instead of <code>auth</code>, you can use <code>withMongoDBPool</code> to if your MongoDB server is in secure mode.</p>\n"}, {"comments": [{"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471378327, "post_id": 38981948, "comment_id": 65320076, "body": "Two follow-up questions: 1. Does everything you said also hold for the Snap framework? (Just wondering in case Snap doesn&#39;t use Warp but something else.) 2. Regarding the connection error, are you basically saying that I shouldn&#39;t really worry about it because if a connection error happens on one pool instance, that pool instance will soon disappear anyway and soon a new one with a new connection will be created anyway? Is that the idea?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471386178, "post_id": 38981948, "comment_id": 65323520, "body": "1. Snap uses warp by default I think // 2. You should worry: a production system should at least log database errors and monitor them. It might be that the database is corrupted or out of disk or there is a partition in your network \u2013 all scenarios a new connection would not fix."}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471456476, "post_id": 38981948, "comment_id": 65358196, "body": "Hey, one more question if you have the time. The doc for <code>withResource</code> says &quot;If the action throws an exception of any type, the resource is destroyed, and not returned to the pool.&quot; In light of this, what do you think about the following idea: When a database operation fails, I log the failure into a file and manually throw an exception. This will make sure the pool resource will get destroyed."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471459875, "post_id": 38981948, "comment_id": 65360068, "body": "i can&#39;t say i have all the information to make an informed decision. you should post it as another stack overflow question!"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1471371738, "creation_date": 1471371738, "answer_id": 38981948, "question_id": 38937264, "link": "https://stackoverflow.com/questions/38937264/haskell-database-connections/38981948#38981948", "title": "Haskell database connections", "body": "<blockquote>\n  <p>Is this the proper way of setting things up? As opposed to creating a database connection for every visit to \"/\". In this latter case, we could have millions of connections at once. Is that discouraged? What are the advantages and drawbacks of such an approach?</p>\n</blockquote>\n\n<p>You do not want to open one connection and then use it. The HTTP server you are using, which underpins Scotty, is called Warp. Warp has a <a href=\"http://www.aosabook.org/en/posa/warp.html\" rel=\"nofollow noreferrer\">multi-core, multi-green-thread design</a>. You are <em>allowed</em> to share the same connection across all threads, since <code>Database.MongoDB</code> says outright that connections are thread-safe, but what will happen is that when one thread is blocked waiting for a response (<a href=\"https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/\" rel=\"nofollow noreferrer\">the MongoDB protocol follows a simple request-response design</a>) <em>all</em> threads in your web service will block. This is unfortunate.</p>\n\n<p>We can instead create a connection on <em>every</em> request. This trivially solves the problem of one thread's blocking another but leads to its own share of problems. The overhead of setting up a TCP connection, while not substantial, is also not zero. Recall that every time we want to open or close a socket we have to jump from the user to the kernel, wait for the kernel to update its internal data structures, and then jump back (a context switch). We also have to deal with the TCP handshake and goodbyes. We would also, under high load, run out file descriptors or memory.</p>\n\n<p>It would be nice if we had a solution somewhere in between. The solution should be</p>\n\n<ul>\n<li>Thread-safe</li>\n<li>Let us max-bound the number of connections so we don't exhaust the finite resources of the operating system</li>\n<li>Quick</li>\n<li>Share connections across threads under normal load</li>\n<li>Create new connections as we experience increased load</li>\n<li>Allow us to clean up resources (like closing a handle) as connections are deleted under reduced load</li>\n<li>Hopefully already written and battle-tested by other production systems</li>\n</ul>\n\n<p>It is this exactly problem that <a href=\"https://github.com/bos/pool\" rel=\"nofollow noreferrer\">resource-pool</a> tackles.</p>\n\n<blockquote>\n  <p>Some say that I'm supposed to use a pool (Data.Pool). It looks like that would only help limit the number of visitors using the same database connection simultaneously. But why would I want to do that? Doesn't the MongoDB connection have a built-in support for simultaneous usages?</p>\n</blockquote>\n\n<p>It is unclear what you mean by simultaneous usages. There is one interpretation I can guess at: you mean something like HTTP/2, which has pipelining built into the protocol.</p>\n\n<p><a href=\"http://research.worksap.com/wp-content/uploads/2015/08/pipeline.png\" rel=\"nofollow noreferrer\">standard picture of pipelining http://research.worksap.com/wp-content/uploads/2015/08/pipeline.png</a></p>\n\n<p>Above we see the client making multiple requests to the server, without waiting for a response, and then the client can receive responses back in some order. (Time flows from the top to the bottom.) This MongoDB does not have. This is a fairly complicated protocol design that is not that much better than just asking your clients to use connection pools. And MongoDB is not alone here: the simple request-and-response design is something that Postgres, MySQL, SQL Server, and most other databases have settled on.</p>\n\n<p>And: it is true that connection pool limits the load you can take as a web service before all threads are blocked and your user just sees a loading bar. But this problem would exist in any of the three scenarios (connection pooling, one shared connection, one connection per request)! The computer has finite resources, and at some point something will collapse under sufficient load. Connection pooling's advantages are that it scales gracefully right up until the point it cannot. The correct solution to handling more traffic is to increase the number of computers; we should not avoid pooling simply due to this problem.\u00a0</p>\n\n<blockquote>\n  <p>In the app above, what happens if the database connection is lost for some reason and needs to be created again? How would you recover from that?</p>\n</blockquote>\n\n<p>I believe these kinds of what-if's are outside the scope of Stack Overflow and deserve no better answer than \"try it and see.\" Buuuuuuut given that the server terminates the connection, I can take a stab at what might happen: assuming Warp forks a green thread for each request (which I think it does), each thread will experience an unchecked <code>IOException</code> as it tries to write to the closed TCP connection. Warp would catch this exception and serve it as an HTTP 500, hopefully writing something useful to the logs also. Assuming a single-connection model like you have now, you could either do something clever (but high in lines of code) where you \"reboot\" your <code>main</code> function and set up a second connection. Something I do for hobby projects: should anything odd occur, like a dropped connection, I ask my supervisor process (like systemd) to watch the logs and restart the web service. Though clearly not a great solution for a production, money-makin' website, it works well enough for small apps.</p>\n\n<blockquote>\n  <p>What about authentication with the <code>auth</code> function? Should the <code>auth</code> function only be called once after creating the pipe, or should it be called on every hit to \"/\"?</p>\n</blockquote>\n\n<p>It should be called once after creating the connection. MongoDB authentication is per-connection. You can see <a href=\"https://github.com/mongodb/mongo/blob/045a53f469fbede582cdbbd8ba532244d86d488e/src/mongo/db/commands/authentication_commands.cpp#L293\" rel=\"nofollow noreferrer\">an example here of how the <code>db.auth()</code> command mutates the MongoDB server's data structures corresponding to the current client connection</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1471459113, "post_id": 39002921, "comment_id": 65359669, "body": "Thanks, that&#39;s useful. I do have a question about 2. The doc for <code>withResource</code> says &quot;If the action throws an exception of any type, the resource is destroyed, and not returned to the pool.&quot; Does this mean that I should throw an exception upon receiving IO error from the MongoDB library? It sounds like this would destroy the pool resource, making sure the connection is not reused and a new connection obtained the next time."}, {"owner": {"reputation": 677, "user_id": 662716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e09655fd68e038c553fd501c69a6161?s=128&d=identicon&r=PG", "display_name": "Victor Denisov", "link": "https://stackoverflow.com/users/662716/victor-denisov"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 1, "creation_date": 1471460382, "post_id": 39002921, "comment_id": 65360342, "body": "You are correct. If you are using withResource then you just need to throw an exception at the end in order to make sure that the resource doesn&#39;t go back to the pool. Pool is designed to ditch broken connection. And the only way to determine it is to receive an exception from the action that is using this connection. Pool doesn&#39;t check connection health by itself."}], "tags": [], "owner": {"reputation": 677, "user_id": 662716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e09655fd68e038c553fd501c69a6161?s=128&d=identicon&r=PG", "display_name": "Victor Denisov", "link": "https://stackoverflow.com/users/662716/victor-denisov"}, "is_accepted": true, "score": 2, "last_activity_date": 1471454991, "creation_date": 1471454991, "answer_id": 39002921, "question_id": 38937264, "link": "https://stackoverflow.com/questions/38937264/haskell-database-connections/39002921#39002921", "title": "Haskell database connections", "body": "<ol>\n<li>Even if you create connection per client you won't be able to create too many of them. You will hit ulimit. Once you hit that ulimit the client that hit this ulimit will get a runtime error.\nThe reason it doesn't make sense is because mongodb server will be spending too much time polling all those connections and it will have only as many meaningful workers as many CPUs your db server has.\nOne connection is not a bad idea, because mongodb is designed to send several requests and wait for responses. So, it will utilize as much resources as your mongodb can have with only one limitation - you have only one pipe for writing, and if it closes accidentally you will need to recreate this pipe yourself.\nSo, it makes more sense to have a pool of connections. It doesn't need to be big. I had an app which authenticates users and gives them tokens. With 2500 concurrent users per second it only had 3-4 concurrent connections to the database.</li>\n</ol>\n\n<p>Here are the benefits connection pool gives you:</p>\n\n<ul>\n<li><p>If you hit pool connection limit you will be waiting for the next available connection and will not get runtime error. So, you app will wait a little bit instead of rejecting your client.</p></li>\n<li><p>Pool will be recreating connections for you. You can configure pool to close excess of connections and create more up until certain limit as you need them. If you connection breaks while you read from it or write to it, then you just take another connection from the pool. If you don't return that broken connection to the pool pool will create another connection for you.</p>\n\n<ol start=\"2\">\n<li><p>If the database connection is closed then: mongodb listener on this connection will exit printing a error message on your terminal, your app will receive an IO error. In order to handle this error you will need to create another connection and try again. When it comes to handling this situation you understand that it's easier to use a db pool. Because eventually you solution to this will resemble connection pool very much.</p></li>\n<li><p>I do auth once as part of opening a connection. If you need to auth another user later you can always do it.</p></li>\n<li><p>Yes, mongodb handles simultaneous usage, but like I said it gives only one pipe to write and it soon becomes a bottle neck. If you create at least as many connections as your mongodb server can afford threads for handling them(CPU count), then they will be going at full speed.</p></li>\n</ol></li>\n</ul>\n\n<p>If I missed something feel free to ask for clarifications.\nThank you for your question.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "accepted_answer_id": 39002921, "answer_count": 3, "score": 2, "last_activity_date": 1471454991, "creation_date": 1471124619, "last_edit_date": 1495535630, "question_id": 38937264, "link": "https://stackoverflow.com/questions/38937264/haskell-database-connections", "title": "Haskell database connections", "body": "<p>Please look at this scotty app (it's taken directly from <a href=\"https://stackoverflow.com/a/26335309\">this old answer from 2014</a>):</p>\n\n<pre><code>import Web.Scotty\nimport Database.MongoDB\nimport qualified Data.Text.Lazy as T\nimport Control.Monad.IO.Class\n\nrunQuery :: Pipe -&gt; Query -&gt; IO [Document]\nrunQuery pipe query = access pipe master \"nutrition\" (find query &gt;&gt;= rest) \n\nmain = do\n  pipe &lt;- connect $ host \"127.0.0.1\"\n  scotty 3000 $ do\n    get \"/\" $ do\n      res &lt;- liftIO $ runQuery pipe (select [] \"stock_foods\")\n      text $ T.pack $ show res\n</code></pre>\n\n<p>You see how the the database connection (<code>pipe</code>) is created only once when the web app launches. Subsequently, thousands if not millions of visitors will hit the \"/\" route simultaneously and read from the database using the same connection (<code>pipe</code>).</p>\n\n<p>I have questions about how to properly use <code>Database.MongoDB</code>:</p>\n\n<ol>\n<li>Is this the proper way of setting things up? As opposed to creating a database connection for every visit to \"/\". In this latter case, we could have millions of connections at once. Is that discouraged? What are the advantages and drawbacks of such an approach?</li>\n<li>In the app above, what happens if the database connection is lost for some reason and needs to be created again? How would you recover from that?</li>\n<li>What about authentication with the <a href=\"https://hackage.haskell.org/package/mongoDB-2.1.1/docs/Database-MongoDB-Query.html#g:3\" rel=\"nofollow noreferrer\"><code>auth</code> function</a>? Should the <code>auth</code> function only be called once after creating the <code>pipe</code>, or should it be called on every hit to \"/\"?</li>\n<li>Some say that I'm supposed to use a pool (<code>Data.Pool</code>). It looks like that would only help limit the number of visitors using the same database connection simultaneously. But why would I want to do that? Doesn't the MongoDB connection have a built-in support for simultaneous usages?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1471124799, "post_id": 38937224, "comment_id": 65230450, "body": "If a function performs IO, it <i>has</i> to return an IO type. Otherwise, the type is promising that the function is side-effect free, and if this is a lie, you compiler will spot it. There&#39;s no reasonable way around this but to add IO to the type of any IO-performing function."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471125890, "post_id": 38937224, "comment_id": 65230707, "body": "Perhaps you should explain why you need to use IO in your evaluation routine. There might be alternatives..."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471128074, "post_id": 38937224, "comment_id": 65231175, "body": "Can you give examples of what your language looks like? Is it just a conventional Python / Javascript-like imperative language?"}, {"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471130684, "post_id": 38937224, "comment_id": 65231661, "body": "@ErikR: <code>x := 2</code> Assign value 2 to &quot;x&quot; in the environment; <code>if x &gt; 1 then y := 3 else z := 4; n := 22</code> Basic if. Else branch is forced, but there is a skip statement included. Multiple statements in a row need to seperated by <code>;</code>. <code>While x do y done</code> where x is a boolean expression and Y are a sequence of statements. And then various <code>read X</code> or <code>set Y</code> commands to set and grab data from / on the robot. Have been working some more now, but as it&#39;s getting late. Gonna go to bed and test things in the morning."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471134091, "post_id": 38937224, "comment_id": 65232139, "body": "See this pastebin for a way to segregate your interpreter into pure and monadic components. Not necessarily recommending this approach, but perhaps it gives you some ideas: <a href=\"http://lpaste.net/176816\" rel=\"nofollow noreferrer\">lpaste.net/176816</a>"}], "answers": [{"comments": [{"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "edited": false, "score": 0, "creation_date": 1471124841, "post_id": 38937268, "comment_id": 65230460, "body": "But how do I plug that IO int back into my function that gives back a normal int?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "edited": false, "score": 0, "creation_date": 1471124949, "post_id": 38937268, "comment_id": 65230485, "body": "Show us some code that calls <code>evalAExpr</code> and we can tell you have to change it."}, {"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "edited": false, "score": 0, "creation_date": 1471125486, "post_id": 38937268, "comment_id": 65230609, "body": "See original post. Added more code that uses EvalAExpr at the bottom. I&#39;m pretty sure i&#39;m just supposed to write do return everywhere in order to make the types match?"}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 1, "creation_date": 1471130296, "post_id": 38937268, "comment_id": 65231594, "body": "While I agree with the general approach, I would encourage the use of <code>Applicative</code>. Example: <code>evalBExpr (...) env = (&gt;) &lt;$&gt; evalAExpr a env &lt;*&gt; evalAExpr b env</code>. Easier to adapt, easier to read, and a great tool to know. And/or create a helper function: <code>evalBExpr (...) = evalWith2 (&gt;) a b</code>"}, {"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471131200, "post_id": 38937268, "comment_id": 65231739, "body": "@MarLinn , will definetely try and do that tomorrow morning (late night already). Your suggestion would make the code so much more compact and readable."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1471125813, "last_edit_date": 1471125813, "creation_date": 1471124647, "answer_id": 38937268, "question_id": 38937224, "link": "https://stackoverflow.com/questions/38937224/perform-an-io-action-in-a-non-io-environment/38937268#38937268", "title": "Perform an IO action in a non IO environment", "body": "<p>You have to write a monadic version of <code>evalAExpr</code></p>\n\n<p>We'll call the new version <code>evalAExprIO</code>:</p>\n\n<pre><code>evalAExprIO :: AExpr -&gt; Env -&gt; IO Int\n evalAExpr (Var x) env = actAccordingly (getValueOfBinding env x)\n  where\n    actAccordingly (Left int) = return int\n    actAccordingly (Right stmt) = eval stmt env\n</code></pre>\n\n<p>There is really only one significant change -- in the <code>Left</code> case the\nfunction <code>actAccordingly</code> uses <code>return int</code> instead of just <code>int</code>.</p>\n\n<p>The type signature for <code>evalAExprIO</code> has changed, but this is something\nthat GHC can infer so it's not something you have to know how to change.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Change:</p>\n\n<pre><code>evalBExpr (RBinary Greater a b) env = evalAExpr a env &gt; evalAExpr b env\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>evalBexpr (RBinary Greater a b) env = liftM2 (&gt;) (evalAExpr a env) (evalExpr b env)\n</code></pre>\n\n<p>(import Control.Monad for liftM2.)</p>\n"}, {"comments": [{"owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "edited": false, "score": 0, "creation_date": 1471125670, "post_id": 38937328, "comment_id": 65230654, "body": "The fact that  this is an actual assignment and not just a project on my own means I won&#39;t even consider your little intervention with the nuclear missiles :P"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471126626, "post_id": 38937328, "comment_id": 65230866, "body": "I thoroughly agree with most of this, but not the type synonym advice. I have never seen anything good come from attempts to use type synonyms to maintain flexibility or enforce abstractions. That is what newtypes and type classes are for. Type synonyms are most useful as shorthand for complicated but concrete types, as are common in <code>lens</code>."}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1471129806, "post_id": 38937328, "comment_id": 65231516, "body": "@dfeuer Then we must have very different development styles because I use them all the time and feel like I benefit greatly. Among the benefits are: Improved documentation in the type signatures; Placeholder for the &quot;real&quot; type of, say, an <code>OtherPlayerID</code>, a <code>Store</code> or a <code>Name</code> (<code>String</code> or <code>Text</code>?); improved readability if the type has many variables; Faster mental connection between a <code>Result a</code>, a <code>ResultM a</code> and a <code>ResultIO a</code>..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471187230, "post_id": 38937328, "comment_id": 65241922, "body": "@MarLinn, I generally prefer to use newtypes for all such purposes. That makes it much easier to see just where I&#39;m relying on relationships between the differently-named types. It also lets me know if I&#39;m mixing up two types with the same representation. It guarantees that GHC will show the conceptual type name in its error messages and at the GHCi prompt. I don&#39;t think I&#39;ve ever seen a Haskell beginner use a type synonym I approved of, and I&#39;ve seen a great many advanced users write ones I disagree with. Even where I see their utility (as in <code>lens</code>), they also have serious downsides."}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471199033, "post_id": 38937328, "comment_id": 65245448, "body": "@dfeuer, interesting points. I think I&#39;ll experiment a bit more with both in the future. So thank you. I&#39;m still not sure what I&#39;d tell a &quot;newcomer&quot; about it, but, well, it&#39;s leftaroundabout&#39;s answer."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471202315, "post_id": 38937328, "comment_id": 65246418, "body": "@MarLinn: yeah, I also do this type-synonym stuff quite a bit, hence my original suggestion. However, David is right that this can lead to several problems if you then actually refactor the types. Nothing to bad though \u2013 the Haskell adage mostly holds \u201c<a href=\"https://github.com/Gabriel439/post-rfc/blob/master/sotu.md#maintenance\" rel=\"nofollow noreferrer\">if you&#39;ve refactored it and got it to type check again, then it&#39;ll work correctly</a>\u201d."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471204259, "post_id": 38937328, "comment_id": 65246928, "body": "One problem with type synonyms is that they can give a false sense of security. When I write a type signature that looks like <code>f :: A -&gt; B -&gt; ...</code>, I generally just assume that if I mix up the <code>A</code> argument with the <code>B</code> one then I&#39;ll get a type error in almost all cases. But if either is a type synonym, then this assumption is totally wrong."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1471127217, "last_edit_date": 1471127217, "creation_date": 1471125224, "answer_id": 38937328, "question_id": 38937224, "link": "https://stackoverflow.com/questions/38937224/perform-an-io-action-in-a-non-io-environment/38937328#38937328", "title": "Perform an IO action in a non IO environment", "body": "<blockquote>\n  <p>from my limited knowledge of Haskell I can't ever get out of an IO</p>\n</blockquote>\n\n<p>Correct<sup>\u2020</sup>! And for good reasons: with the current signature, anybody using your function knows that this really is just a pure, referentially transparent calculation, so they can be accordingly careless with it (lazyness etc.). If you were allowed to just put in some <code>IO</code> without making this explicit through the signature, you might easily break everybody's code!</p>\n\n<p>Of course, if you've only just noticed that you need to do IO, then you are indeed in a bit of a dilemma. There's no good way for you to get around changing all the signatures now.</p>\n\n<p>However, you could have prevented this by using a type synonym<sup>\u2021</sup> in the first place: if you'd had originally</p>\n\n<pre><code>type Evaluation a = Identity a\n\n-- ... lots of functions with an `Evaluation` result ...\n\nevalAExpr :: AExpr -&gt; Env -&gt; Evaluation Int\nevalAExpr (Var x) env = actAccordingly (getValueOfBinding env x)\n  where\n    actAccordingly (Left int) = return int\n    actAccordingly (Right stmt) = someThingThatDidn'tYetRequireIO\n</code></pre>\n\n<p>then, upon noticing that you need <code>IO</code> after all, you could have just changed it to</p>\n\n<pre><code>type Evaluation a = IO a\n\n{- same as before:\nevalAExpr :: AExpr -&gt; Env -&gt; Evaluation Int\nevalAExpr (Var x) env = actAccordingly (getValueOfBinding env x)\n  where\n    actAccordingly (Left int) = return int -}\n    actAccordingly (Right stmt) = eval stmt env\n</code></pre>\n\n<p>In a big project, the <code>Evaluation</code> monad would then typically be a monad transformer stack, to which you'd just add an extra layer for the IO underneath.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>If anybody reminds me about the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"nofollow\">function that shall not be named</a>, I shall whack them about the head <a href=\"http://hackage.haskell.org/package/acme-missiles-0.3/docs/Acme-Missiles.html#v:launchMissiles\" rel=\"nofollow\">with a nuclear missile</a>.</sub></p>\n\n<p><sup>\u2021</sup><sub>As dfeuer remarks, a <code>newtype</code> may be better.</sub></p>\n"}], "owner": {"reputation": 466, "user_id": 4416951, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/643bc59a7a04024d9f6e5fadc8a00b74?s=128&d=identicon&r=PG", "display_name": "MrKickkiller", "link": "https://stackoverflow.com/users/4416951/mrkickkiller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 38937268, "answer_count": 2, "score": 1, "last_activity_date": 1600775226, "creation_date": 1471124250, "last_edit_date": 1600775226, "question_id": 38937224, "link": "https://stackoverflow.com/questions/38937224/perform-an-io-action-in-a-non-io-environment", "title": "Perform an IO action in a non IO environment", "body": "<p>I've gotten stuck on the following predicament.</p>\n<pre><code>evalAExpr :: AExpr -&gt; Env -&gt; Int\nevalAExpr (Var x) env = actAccordingly (getValueOfBinding env x)\n  where\n    actAccordingly (Left int) = int\n    actAccordingly (Right stmt) = eval stmt env\n\neval :: Stmt -&gt; Env -&gt;  IO Env`\n\ngetValueOfBinding :: Env -&gt; String -&gt; Either Integer Stmt\n</code></pre>\n<p>So what needs to happen is that with the Stmt <code>x</code> gotten from the Either Monad, it should evaluate <code>x</code> (which needs to happen in an <code>IO</code>, because of other processes) into a new Environment, after which I can return the correct value from the environment. However, from my limited knowledge of Haskell I can't ever get out of an <code>IO</code>.</p>\n<p>Eg: <code>givetheCorrectThing nameOfTheValueInTheEnv (eval stmt env)</code> would never work with the current code, since all <code>evalAExpr</code> functions (yes there are more than just 1) return an Env atm. If I would have to change that, it would result in adding in ALL of the evaluation do and return statements. &gt; 50-60 occurences. For sure. That would make code so messy to look at. The reason I need IO is because this evaluation will have to go (at some point) and collect data from an mBot (<a href=\"http://makeblock.com/mbot-stem-educational-robot-kit-for-kids/\" rel=\"nofollow noreferrer\">http://makeblock.com/mbot-stem-educational-robot-kit-for-kids/</a>), aswell as collect data from the keyboard (done via getLine)</p>\n<p>Would any of you have a way to rework this code so that I can keep it neat and organised?</p>\n<p>If more code is needed: Feel free to ping / mention me. I will provide the requested lines of code.</p>\n<p>More code as requested:</p>\n<pre><code>-- Code that shows how EvalAExpr is used.\n\n-- Relational operators\nevalBExpr (RBinary Greater a b) env = evalAExpr a env &gt; evalAExpr b env\nevalBExpr (RBinary Less a b)    env = evalAExpr a env &lt; evalAExpr b env\nevalBExpr (RBinary Equal a b)   env = evalAExpr a env == evalAExpr b env\n</code></pre>\n"}, {"tags": ["haskell", "conduit", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1471127198, "post_id": 38937097, "comment_id": 65231007, "body": "Unless the directory has a truly tremendous number of files, a fancy machine sounds like overkill. How about just reading the directory, then using <code>foldM</code> to process each, combining results along the way?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471127618, "post_id": 38937097, "comment_id": 65231104, "body": "Don&#39;t know if the OP needs it, but <code>sourceDirectoryDeep</code> does a recursive traversal. But yes, the larger efficiency will come from processing the contents of each file in a chunked fashion."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1471142043, "post_id": 38937097, "comment_id": 65233109, "body": "@dfeuer conduit (or pipes) <code>foldM</code> is <i>not even slightly</i> more complicated than <code>Control.Monad.foldM</code>. The amazing number of catastrophes that can occur by working with a list of Filepaths lazily developed from a directory traversal was one of the original poster children for streaming io. It <i>just isn&#39;t simpler</i> and shouldn&#39;t be recommended. <code>import Conduit</code> is shorter than <code>import Control.Monad</code>, and once you type it, you have both the directory tree and the correct fold function to apply to it."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1547568893, "post_id": 38937097, "comment_id": 95232468, "body": "tip for Haskell newbies: if you are basically using <code>readFile</code> as <code>processFile</code> in the above example, be careful which <code>readFile</code> you are using as there are many possible output types for different <code>readFile</code>s, e.g.: <code>String</code>, <code>Text</code>, <code>ByteString</code> which might cause slightly confusing type errors if you use the wrong one."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1471123150, "creation_date": 1471123150, "answer_id": 38937097, "question_id": 38935950, "link": "https://stackoverflow.com/questions/38935950/how-would-you-traverse-a-directory-and-do-some-function-on-all-files-and-combine/38937097#38937097", "title": "How would you traverse a directory and do some function on all files and combine the output in a memory efficient manner?", "body": "<p>You can nest conduit execution like this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Conduit\nimport qualified Data.ByteString as BS\n\n-- Process a single file\nprocessFile :: FilePath -&gt; IO ()\nprocessFile path = runResourceT (sourceFile path =$= mapC BS.length $$ sumC) &gt;&gt;= print\n\n-- Run processFile for directory in a tree    \ndoit :: FilePath -&gt; IO ()\ndoit top = runResourceT $ sourceDirectoryDeep False top $$ mapM_C (liftIO . processFile)\n</code></pre>\n\n<p>Replace <code>processFile</code> with whatever you want to do -- including\nignoring the file. My understanding is that the <code>sourceFile</code> Producer will efficiently chunk\nthe contents of a file.</p>\n\n<p>And, according to <a href=\"http://www.yesodweb.com/blog/2014/03/efficient-directory-traversals\" rel=\"nofollow\">this Yesod article</a>, <code>sourceDirectoryDeep</code> should\nefficiently traverse a directory structure.</p>\n\n<p>The thing you apparently can't do with <code>sourceDirectoryDeep</code> is prune\ndirectories.</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 1, "accepted_answer_id": 38937097, "answer_count": 1, "score": 6, "last_activity_date": 1471123150, "creation_date": 1471114482, "question_id": 38935950, "link": "https://stackoverflow.com/questions/38935950/how-would-you-traverse-a-directory-and-do-some-function-on-all-files-and-combine", "title": "How would you traverse a directory and do some function on all files and combine the output in a memory efficient manner?", "body": "<p><strong>Setting</strong> </p>\n\n<p>I need to traverse a directory over 100+ .txt files, open every one and do some function on each, then combine the results. These files are huge, on the order of 10GB. Some common operation in psuedocode might be:</p>\n\n<pre><code>foldr concatFile mempty $ openFile &lt;$&gt; [filePath1, ..., filePathn]\nfoldr countStuff 0      $ openFile &lt;$&gt; [filePath1, ..., filePathn]\n</code></pre>\n\n<p>The trick is to make sure all the files never exist in memory at the same time, my previous naive solution created all kinds of swap files on my mac. \nIn addition, if one of the filePath is invalid, I'd like to just skip over\nit and go on with the program. </p>\n\n<p><strong>My Solution</strong></p>\n\n<p>Currently I'm using conduit and would like to find a solution using conduit if possible. But if it's not the right tool I'm fine with using something else. </p>\n"}, {"tags": ["haskell", "semantics", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1471107446, "post_id": 38934920, "comment_id": 65225845, "body": "As posted, it&#39;s bottom since the function is strict. But I guess you might actually want the least fixed point of the related functional <code>\\f n -&gt; case n of 0-&gt;1 ; x-&gt;x*x*f(x-1)</code> which has type <code>(Int -&gt; Int) -&gt; (Int -&gt; Int)</code>, and has a non trivial least fixed point."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471107619, "post_id": 38934920, "comment_id": 65225897, "body": "@chi then what will be the least fixpoint?, like i understand how to define the type, but how to write LFP in closed form."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 3, "creation_date": 1471109084, "post_id": 38934920, "comment_id": 65226348, "body": "Isn&#39;t it 1 ? f 1 = 1 * 1 * f(0) = 1. On all other integers f x is different from x, so 1 is the only fixpoint."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1471111384, "post_id": 38934920, "comment_id": 65226991, "body": "@WaqarAhmed Assuming you are working in a semantic domain that is a CPO you know that to find the least fixed point you can start from the bottom element and go upwards. So in chi&#39;s code put <code>f=undefined</code> and you end up with <code>\\n -&gt; case n of 0-&gt; 1; x -&gt; x*x*undefined (x-1)</code> which is the function that is <code>1</code> when <code>n=0</code> and undefined otherwise. Now put this function as <code>f</code> and you end up with a function that is <code>1</code> in both the <code>0</code> and <code>1</code> case etc. in the end the least fixed point is the limit: which is just the constant function <code>1</code> as noted by V. Semeria."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1471111877, "post_id": 38934920, "comment_id": 65227129, "body": "@Bakuriu. Thank you for explaining it. I got this one, but the answer to this one is a little different notation that i am unable to grab. I have edited my question and added answer there, can you have a look please. Thank you."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1471112341, "post_id": 38934920, "comment_id": 65227247, "body": "@WaqarAhmed Indeed I was wrong. Consider the case when we have <code>f 0 = 1</code> and <code>f 1 = 1</code> while <code>f x = undefined</code>. Now we end up with <code>case n of 0 -&gt; 1; x -&gt; x*x*f(x-1)</code> which is <code>1</code> for <code>n=0, 1</code> but is <code>4</code> for <code>n=2</code> (because <code>2*2*f(1) = 2*2*1=4</code>) and undefined for <code>n&gt;2</code>. In the next step you end up with <code>3*3*f(2) = 3*3*4 = 36</code> etc. Every iteration defines <code>f</code> for the next value of <code>n</code> as <code>n**2 * f(n-1)</code>. The <code>!</code> denotes <i>factorial</i> <code>5! = 5*4*3*2*1</code> and since we always multiply squares we end up with <code>(n!)**2 = (n*(n-1)*(n-2)*...*1) *(n*(n-1)*(n-2)*...*1) = n**2*(n-1)**2 * (n-2)**2*...*1**2</code>"}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1471113224, "post_id": 38934920, "comment_id": 65227489, "body": "@Bakuriu Thank you again for this one. I have aquestion. The square is on n (n**2) but not on (f(n-1)), then why the factorial is getting squared? also how the answer is represented using this result(The one that i have added in the question)"}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1471113305, "post_id": 38934920, "comment_id": 65227514, "body": "@V.Semeria I have edited my question with the provided answer"}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471113325, "post_id": 38934920, "comment_id": 65227520, "body": "@chi I have edited my question with the provided answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 2, "creation_date": 1471113924, "post_id": 38934920, "comment_id": 65227686, "body": "@V.Semeria It&#39;s true that <code>1</code> is a fixed-point; but it&#39;s not the <i>least</i> fixed point in the standard ordering that puts bottom under <code>1</code> (and under all other fully-defined <code>Int</code>s, which are incomparable with each other)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1471115823, "post_id": 38934920, "comment_id": 65228274, "body": "@WaqarAhmed A rough but intuitive explanation is that by unfolding the recursion many times we get <code>f n = n * n * (n-1) * (n-1) * (n-2) * (n-2) * .... * 1</code> This is like the factorial except that every factor appears twice, hence the factorial squared. If n is negative instead we diverge since we never reach the base case. In general, there&#39;s no simple recipe that can provide the closed form of a recursive function -- one has to &quot;guess&quot; it by observing some pattern, and then possibly prove it by induction."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471115960, "post_id": 38934920, "comment_id": 65228309, "body": "@chi I have a confusion that, if we see only question, n is applied twice but function is applied only once, then how come the factorial get squared"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471124265, "post_id": 38934920, "comment_id": 65230333, "body": "Because otherwise you square each factor more than once. You would get something like ` (((1^2 * 2)^2 * 3)^2 * 4)^2 ...` Note how e.g. 2 was squared each time we recurse. We don&#39;t want to square the recursive call since it is &quot;already squared&quot;, roughly put."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1471149954, "creation_date": 1471149954, "answer_id": 38939208, "question_id": 38934920, "link": "https://stackoverflow.com/questions/38934920/find-least-fixpoint-of-a-function/38939208#38939208", "title": "Find least fixpoint of a function", "body": "<p>It is easy to see that</p>\n\n<pre><code>f x = x * x * f (x-1)\n    = x * x * ((x-1) * (x-1) * f (x-2))\n    = x * x * ((x-1) * (x-1) * ((x-2) * (x-2) * f (x-3)))\n    = ...\n    = x * x * ((x-1) * (x-1) * ((x-2) * (x-2) * ... * 1)))\n</code></pre>\n\n<p>Now to answer your question in the comments about how this is equivalent to the given formula <code>(x!)^2</code> when the recursive result <code>f (x-1)</code> is not squared, just rearrange the factors above, using associativity and commutativity of <code>(*)</code> over <code>Int</code> :</p>\n\n<pre><code>      x * x * ((x-1) * (x-1) * ((x-2) * (x-2) * ... * 1)))\n    = x * x * (x-1) * (x-1) * (x-2) * (x-2) * ... * 1\n    = (x * (x-1) * (x-2) * ... * 1) * (x * (x-1) * (x-2) * .. * 1)\n    = x!                            * x!\n    = (x!)^2\n</code></pre>\n"}], "owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562458105, "creation_date": 1471106870, "last_edit_date": 1592644375, "question_id": 38934920, "link": "https://stackoverflow.com/questions/38934920/find-least-fixpoint-of-a-function", "title": "Find least fixpoint of a function", "body": "<p>If I have this Haskell function:</p>\n<blockquote>\n<p>Consider the following Haskell function <em>f</em> :</p>\n<pre><code>f :: Int -&gt; Int\nf 0 = 1\nf x = x * x * f (x - 1)\n</code></pre>\n</blockquote>\n<p>Then how can I calculate its <strong>fixpoint</strong> and the <strong>least fixpoint</strong> (in closed form)?</p>\n<p>The answer to this question is :</p>\n<p><a href=\"https://i.stack.imgur.com/R4AJn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/R4AJn.png\" alt=\"enter image description here\" /></a></p>\n<p>How is this <strong>least fixpoint</strong> calculated? I am trying to understand this, but still no luck. It will be great if someone could explain this to me.</p>\n"}, {"tags": ["haskell", "atom-editor", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471099701, "post_id": 38933426, "comment_id": 65223582, "body": "I&#39;m not particularly familiar with <code>ghc-mod</code> but I&#39;m certain it provides some way to configure the <code>ghc</code> command which it uses - change this to <code>stack ghc --</code> or <code>stack ghc --stack-yaml &lt;something&gt; --</code> if you want to use a particular environment (not the global)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471102178, "post_id": 38933426, "comment_id": 65224324, "body": "Are you working with a stack project (i.e. with both a .cabal and stack.yaml file)?"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471106481, "post_id": 38933426, "comment_id": 65225535, "body": "@ErikR I am working on my personal project that won&#39;t be distributed anywhere. I am new to haskell and I don&#39;t fully understand what&#39;s the difference between stack and cabal, so I am not sure what are you asking for..."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471106670, "post_id": 38933426, "comment_id": 65225595, "body": "Two questions: Do you have a <code>(project-name).cabal</code> file in your project directory? Do you have a <code>stack.yaml</code> file in your project directory?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471106972, "post_id": 38933426, "comment_id": 65225698, "body": "It&#39;s possible that you don&#39;t have either of those files in your project directory - maybe you are just editing a single file - I just need to know what your directory looks like in order to determine what&#39;s wrong with ghc-mod."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471107074, "post_id": 38933426, "comment_id": 65225728, "body": "Also - which platform are you using Atom on? OSX, Linux, Windows?"}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471107918, "post_id": 38933426, "comment_id": 65226018, "body": "@ErikR I have none of them in my directory. I use Ubuntu."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471109729, "post_id": 38933426, "comment_id": 65226533, "body": "Ok - so apparently you are not working with a stack / cabal project. There may be a way to get ghc-mod to work with just a single file and specify a resolver (so that you can use all of the packages in a resolver set), but I&#39;m not aware of it."}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1471110080, "post_id": 38933426, "comment_id": 65226635, "body": "<code>stack install</code> is really for installing executables into your environment, not making packages available to the compiler. You should consult the <a href=\"https://docs.haskellstack.org/en/stable/README/#quick-start-guide\" rel=\"nofollow noreferrer\">stack manual</a> for how to start a new project using stack."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1471111494, "post_id": 38933426, "comment_id": 65227020, "body": "So I should install the package again trough cabal ?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1471112060, "post_id": 38933426, "comment_id": 65227161, "body": "Maybe, but what you should really do is read a manual and start a project the usual way so as to take advantage of the features your build tool provides you."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1471115558, "post_id": 38933426, "comment_id": 65228199, "body": "This is a pretty good tutorial on using stack to build a project: <a href=\"http://seanhess.github.io/2015/08/04/practical-haskell-getting-started.html\" rel=\"nofollow noreferrer\">seanhess.github.io/2015/08/04/&hellip;</a> However, instead of <code>lts-3.1</code> substitute a more recent resolver - like the one you are currently using."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1471115705, "post_id": 38933426, "comment_id": 65228234, "body": "Thanks, diving into Haskell is pretty hard on its own, so any help in form of tutorial is welcomed!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471123820, "post_id": 38933426, "comment_id": 65230232, "body": "I would say get comfortable with using <code>stack</code> from the command line - e.g. <code>stack new ...</code>, <code>stack build</code>, <code>stack repl</code>. The main difference when using a cabal / stack project is having to declare your dependencies in the <code>.cabal</code> file."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471124247, "post_id": 38933426, "comment_id": 65230326, "body": "Then to get ghc-mod working with Atom have a look at <a href=\"https://github.com/erantapaa/atom-haskell-scripts\" rel=\"nofollow noreferrer\">github.com/erantapaa/atom-haskell-scripts</a> and let me know if you have any problems."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1471189976, "post_id": 38942374, "comment_id": 65242718, "body": "A bit off topic: What is the easiest way to profile with stack? Until now I have compiled everything with plain ghc. So I wanted to try it now the stack way - but when I use <code>stack build --profile</code> and <code>stack exec example +RTS -p</code> I get an error complaining I didn&#39;t compile with profiling enabled."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 1, "creation_date": 1471217081, "post_id": 38942374, "comment_id": 65250183, "body": "You need <code>stack exec -- example +RTS -p</code> <a href=\"http://stackoverflow.com/a/34678897/482382\">stackoverflow.com/a/34678897/482382</a>"}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1471258716, "post_id": 38942374, "comment_id": 65261462, "body": "I&#39;d be happy to look into if you ask a (top-level) question :)"}, {"owner": {"reputation": 103, "user_id": 7907202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eae919e524a3a99f832ea35cb2ff77fc?s=128&d=identicon&r=PG&f=1", "display_name": "Noam", "link": "https://stackoverflow.com/users/7907202/noam"}, "edited": false, "score": 0, "creation_date": 1507674555, "post_id": 38942374, "comment_id": 80302345, "body": "Hi, what if I do not have an example.cabal? I opened a file with atom that is not a part of a stack project and I have experienced trouble with System.Random. What should I do?"}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 1, "last_activity_date": 1471178621, "creation_date": 1471178621, "answer_id": 38942374, "question_id": 38933426, "link": "https://stackoverflow.com/questions/38933426/haskell-stack-installed-packages-are-not-visible/38942374#38942374", "title": "Haskell Stack: installed packages are not visible", "body": "<p>You'll want to ensure that you have a <code>ghc-mod</code> that is both recent and built by the same version of ghc as the one your project is using. Do this by installing with stack (using the same resolver as your project). e.g.</p>\n\n<pre><code>$ stack install --resolver lts-6.11 ghc-mod\n$ which ghc-mod\n/Users/steshaw/.local/bin/ghc-mod\n$ ghc-mod --version\nghc-mod version 5.5.0.0 compiled by GHC 7.10.3\n</code></pre>\n\n<p>To test this, perhaps set up an example project with <code>stack new</code>.</p>\n\n<pre><code>$ stack new example\n$ cd example\n</code></pre>\n\n<p>Change <code>example.cabal</code> to include, say, the <code>HTTP</code> package for the <code>example-exe</code>.</p>\n\n<p>e.g.</p>\n\n<pre><code>executable example-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , example\n                     , HTTP\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Build with <code>stack</code> to install the HTTP package.</p>\n\n<pre><code>$ stack build\n</code></pre>\n\n<p>Now start Atom.</p>\n\n<pre><code>$ atom .\n</code></pre>\n\n<p>You should find that the imports from HTTP are visible within Atom.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ndMNP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ndMNP.png\" alt=\"HTTP imports\"></a></p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 892, "favorite_count": 0, "accepted_answer_id": 38942374, "answer_count": 1, "score": 2, "last_activity_date": 1471178621, "creation_date": 1471096382, "last_edit_date": 1471107093, "question_id": 38933426, "link": "https://stackoverflow.com/questions/38933426/haskell-stack-installed-packages-are-not-visible", "title": "Haskell Stack: installed packages are not visible", "body": "<p>I installed package with <code>stack install</code> but I cannot import the package unless I use <code>stack ghc</code> or <code>stack ghci</code> ...</p>\n\n<p>The problem is I have installed <code>atom haskell ide</code>, that uses <code>ghc-mod</code> backend, which also doesn't see packages installed by stack!</p>\n"}, {"tags": ["list", "haskell", "syntax", "lambda", "monads"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1471121157, "post_id": 38933216, "comment_id": 65229688, "body": "<b><i>Omitting explicit parentheses in learning material is Evil.</i></b> Too harsh? Ask countless newbies who loose countless hours because of this."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1471126868, "post_id": 38933274, "comment_id": 65230916, "body": "You might want to mention that this is because lambda expressions always go as far to the right as possible."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": true, "score": 7, "last_activity_date": 1471121259, "last_edit_date": 1471121259, "creation_date": 1471095243, "answer_id": 38933274, "question_id": 38933216, "link": "https://stackoverflow.com/questions/38933216/haskell-monads-implementation/38933274#38933274", "title": "Haskell Monads implementation", "body": "<p>The first half is not what you think, the parentheses are like this :</p>\n\n<pre><code>[1,2] &gt;&gt;= ( \\n -&gt; ['a', 'b'] &gt;&gt;= ( \\ch -&gt; return (n, ch) ) )\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 38933274, "answer_count": 1, "score": 1, "last_activity_date": 1471121407, "creation_date": 1471094943, "last_edit_date": 1471121407, "question_id": 38933216, "link": "https://stackoverflow.com/questions/38933216/haskell-monads-implementation", "title": "Haskell Monads implementation", "body": "<p>I was recently reading learn you a haskell and I came across the expression:</p>\n\n<pre><code>[1,2] &gt;&gt;= \\n -&gt; ['a', 'b'] &gt;&gt;= \\ch -&gt; return (n, ch)\n</code></pre>\n\n<p>This expressions returns the result</p>\n\n<pre><code>[(1,'a'),(1,'b'),(2,'a'),(2,'b')]\n</code></pre>\n\n<p>so i understand that the monadic bind for lists is implemented as follows</p>\n\n<pre><code>xs &gt;&gt;= f = concatMap f xs\n</code></pre>\n\n<p>Taking the first half of the expression namely the:</p>\n\n<pre><code>[1,2] &gt;&gt;= \\n -&gt; ['a', 'b']\n</code></pre>\n\n<p>it evaluates to <code>['a','b','a','b']</code>, from what I understand this is then fed in to the function: <code>(\\ch -&gt; return (n , ch))</code>.</p>\n\n<p>What I don't understand is how the values 1,2 from the list are assigned to n and then how the compiler keeps a record of it to then assign it to n in the last function?</p>\n"}, {"tags": ["haskell", "continuations", "continuation-passing"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1471108268, "post_id": 38933183, "comment_id": 65226130, "body": "Just wondering, does this turn out to be any faster than collecting a list and using <code>Vector.fromList</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471135688, "post_id": 38933183, "comment_id": 65232349, "body": "I think you should be able to find a way to do this in <code>ST</code>. The challenge will be dealing efficiently with partial results, but I suspect there is no entirely efficient way to handle those. In particular, remember that a partial result may be resumed multiple times with different inputs, so too much <code>unsafePerformIO</code> could break your code."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1471165999, "post_id": 38933183, "comment_id": 65236643, "body": "@Michael Yeah, quite a bit. For parsing 10M integers, it makes a difference what data structure you use. Using <a href=\"https://github.com/mrakgr/futhark/blob/parser_attempts/cps_parser_v5.hs\" rel=\"nofollow noreferrer\">the completed parser</a> with boxed vectors it deals with 10M ints in 7.6s. With the unboxed parser it does it in 4s. Just using an extended functional unfoldr with a boxed Vector does it in 2s. <code>ResizeArray</code> in F# does it in 1.2s. The <a href=\"https://hackage.haskell.org/package/persistent-vector\" rel=\"nofollow noreferrer\">persistent vector</a> does it in 9.8. Apart from the F# solution, they all blow the heap on 100M. Lists do that long before 10M."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471166325, "post_id": 38933183, "comment_id": 65236723, "body": "@dfeuer To be honest, I&#39;ve completely lost interest in this now. Literally nothing I&#39;ve tried in Haskell lets me parse 100M ints without blowing the heap and I&#39;ve been trying various approaches for 10 days now. I see it as a failure of the language. I ended up figuring out CPS and monads, but not how to do a task that would take me 10m in an imperative language."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1471173472, "post_id": 38933183, "comment_id": 65238408, "body": "If you are really just parsing whitespace separated <code>Int</code>s, I think a parsing library might be too fancy. <code>Data.ByteString.Char8.readInt</code> is very fast."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471177309, "post_id": 38933183, "comment_id": 65239368, "body": "It would be very helpful to see your ultimate goal and benchmark code. As Michael suggests, you may be attacking from the wrong angle. Attoparsec is designed to support streaming input and to be pure; these features may make it inappropriate for your purpose."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1471177714, "post_id": 38933183, "comment_id": 65239483, "body": "@Michael I was making the parser for a parsing library. If you take a look you will see that Attoparsec which is supposed to be fast has no array based parsers, so I thought I might do something about that. The speed is not so much an issue, but rather the fact that in the 100M case the memory gets eaten away way beyond the reasonable level. And even that is not the true problem - the real problem is the absence of control over memory in Haskell."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471178171, "post_id": 38933183, "comment_id": 65239602, "body": "@dfeuer My most <a href=\"https://github.com/mrakgr/futhark/blob/parser_attempts/unfoldr_v6.hs\" rel=\"nofollow noreferrer\">successful attempt</a> was here, so play with it if you want. It might be interesting if you can get it to perform on par with the <a href=\"https://github.com/mrakgr/futhark/blob/parser_attempts/sum.fsx\" rel=\"nofollow noreferrer\">imperative F# solution</a>. Here is the <a href=\"https://github.com/mrakgr/futhark/blob/parser_attempts/generate.fsx\" rel=\"nofollow noreferrer\">random integer generator</a>. When bechmarking the parser don&#39;t do something stupid like creating the data inside the program like the guy on Reddit whose name won&#39;t be mentioned, but do load it from file instead."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471178362, "post_id": 38933183, "comment_id": 65239651, "body": "@dfeuer My goal was to figure out how to parse a large number of values efficiently into an array and as a side goal preferably integrate that parser into some parser library. Now that I think about it, due to it using the CPS style maybe a nominally slower library that uses <code>Either</code> for control flow might have been a better fit for extension. I am not interested in this anymore. If you want to, take it on as a challenge to see if you can succeed where I failed."}], "answers": [{"tags": [], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "is_accepted": false, "score": 0, "last_activity_date": 1471095191, "creation_date": 1471095191, "answer_id": 38933260, "question_id": 38933183, "link": "https://stackoverflow.com/questions/38933183/how-to-mutate-a-vector-passed-around-in-cps-style-functions/38933260#38933260", "title": "How to mutate a Vector passed around in CPS style functions?", "body": "<p>A few minutes after I made this post, it occurred to me that I made a syntactic error.</p>\n\n<pre><code>manyCPSVec :: Parser Text.Text Char -&gt; Parser Text.Text (Vec.Vector Char)\nmanyCPSVec parser = T.Parser $ \\t pos more lose_fin win_fin -&gt;\n      let arr = Unsafe.unsafePerformIO (MVec.new 1024) in\n      loop 0 arr t pos more lose_fin win_fin where\n          loop i (arr :: MVec.MVector RealWorld Char) t pos more lose_fin win_fin =\n              T.runParser parser t pos more lose win where\n                  win t !pos more (a :: Char) =\n                    Unsafe.unsafePerformIO $ do\n                      MVec.write arr i a\n                      return $ loop (i+1) arr t pos more lose_fin win_fin\n                  lose t pos more _ _ =\n                    Unsafe.unsafePerformIO $ do\n                      x &lt;- Vec.freeze arr\n                      return $ win_fin t pos more x\n</code></pre>\n\n<p>The above type checks ok. I forgot that I can't sequence statements outside the do blocks in Haskell.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1471095191, "creation_date": 1471094653, "question_id": 38933183, "link": "https://stackoverflow.com/questions/38933183/how-to-mutate-a-vector-passed-around-in-cps-style-functions", "title": "How to mutate a Vector passed around in CPS style functions?", "body": "<pre><code>{-# LANGUAGE ScopedTypeVariables,BangPatterns #-}\n\nimport qualified Data.Attoparsec.Internal as I\nimport qualified Data.Attoparsec.Internal.Types as T\nimport qualified Data.Vector.Unboxed as UVec\nimport qualified Data.Vector.Unboxed.Mutable as UMVec\nimport qualified Data.Vector as Vec\nimport qualified Data.Vector.Mutable as MVec\nimport qualified Data.Text as Text\nimport qualified System.IO.Unsafe as Unsafe\n\nimport Control.Monad.ST\nimport Control.Monad.Primitive\n\ntype Parser = T.Parser\n\nmanyCPSVec :: Parser Text.Text Char -&gt; Parser Text.Text (Vec.Vector Char)\nmanyCPSVec parser = T.Parser $ \\t pos more lose_fin win_fin -&gt;\n      let arr = Unsafe.unsafePerformIO (MVec.new 1024) in\n      loop 0 arr t pos more lose_fin win_fin where\n          loop i (arr :: MVec.MVector RealWorld Char) t pos more lose_fin win_fin =\n              T.runParser parser t pos more lose win where\n                  win t !pos more (a :: Char) =\n                    Unsafe.unsafePerformIO (MVec.write arr i a) -- Here is the problem\n                    loop (i+1) arr t pos more lose_fin win_fin\n                  lose t pos more _ _ =\n                      --x &lt;- Vec.freeze arr\n                      win_fin t pos more (Vec.empty)\n\nmain = print \"Hello\"\n</code></pre>\n\n<p>I am trying to put in some <code>Vector</code> functionality in Attoparsec for efficiency, but I've run into a wall.</p>\n\n<p>If Attoparsec was not written using CPS, I could have used a <a href=\"http://lpaste.net/175350\" rel=\"nofollow\">functional unfoldr</a>, but that is not an option here. The problem is that all calls have to be in the tail position here and no function returns in the standard sense of the thing therefore arrays have to be passed along as accumulators.</p>\n\n<p>I tried to do this using the ST monad, but when that did not work I tried the above, but even so it fails to work. Haskell's type system is really killing me here. Is it in anyway possible to edit mutable arrays when programming with CPS?</p>\n\n<p>If it is possible to do this within the ST monad I would doubly appreciate this.</p>\n\n<p>Posts telling me to use data structures other than arrays though, will be downvoted.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2488, "user_id": 6600109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d018ddca1b281e434c1ae6696a0195?s=128&d=identicon&r=PG&f=1", "display_name": "Markus Laire", "link": "https://stackoverflow.com/users/6600109/markus-laire"}, "edited": false, "score": 2, "creation_date": 1471087001, "post_id": 38931994, "comment_id": 65220034, "body": "Found answer, see <a href=\"http://stackoverflow.com/questions/2500459/wrong-io-actions-order-using-putstr-and-getline\" title=\"wrong io actions order using putstr and getline\">stackoverflow.com/questions/2500459/&hellip;</a> (I don&#39;t have any flags left to mark this as duplicate)"}, {"owner": {"reputation": 232, "user_id": 6712145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7aiWA.jpg?s=128&g=1", "display_name": "Gallifreyan", "link": "https://stackoverflow.com/users/6712145/gallifreyan"}, "reply_to_user": {"reputation": 2488, "user_id": 6600109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d018ddca1b281e434c1ae6696a0195?s=128&d=identicon&r=PG&f=1", "display_name": "Markus Laire", "link": "https://stackoverflow.com/users/6600109/markus-laire"}, "edited": false, "score": 0, "creation_date": 1487528142, "post_id": 38931994, "comment_id": 71814436, "body": "Related: <a href=\"https://stackoverflow.com/questions/13190314/haskell-do-monad-io-happens-out-of-order\" title=\"haskell do monad io happens out of order\">stackoverflow.com/questions/13190314/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4516, "user_id": 1937198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b97a3ec92aed1c16e35c1bf532465d6b?s=128&d=identicon&r=PG", "display_name": "user1937198", "link": "https://stackoverflow.com/users/1937198/user1937198"}, "is_accepted": true, "score": 1, "last_activity_date": 1471087089, "creation_date": 1471087089, "answer_id": 38932123, "question_id": 38931994, "link": "https://stackoverflow.com/questions/38931994/haskell-console-program-outputs-in-wrong-order/38932123#38932123", "title": "Haskell console program outputs in wrong order", "body": "<p>It looks like stdout has line buffering on, which means that the calls to putStr are only storing the output in a buffer, which is not being output until putStrLn is called. You can fix your output by using putStrLn for your prompt, or disabling buffering on stdout.</p>\n"}], "owner": {"reputation": 232, "user_id": 6712145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7aiWA.jpg?s=128&g=1", "display_name": "Gallifreyan", "link": "https://stackoverflow.com/users/6712145/gallifreyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "closed_date": 1471088178, "accepted_answer_id": 38932123, "answer_count": 1, "score": 2, "last_activity_date": 1471088165, "creation_date": 1471086043, "last_edit_date": 1471086406, "question_id": 38931994, "link": "https://stackoverflow.com/questions/38931994/haskell-console-program-outputs-in-wrong-order", "closed_reason": "Duplicate", "title": "Haskell console program outputs in wrong order", "body": "<p>So I just made a program that asks for a number <em>n</em> and displays <em>n</em> th term of the Fibonacci sequence:</p>\n\n<pre><code>import Control.Monad (forever)\n\nmain = forever $ do\n    putStrLn \"\"\n    putStr \"Which Fibonacci sequence number do you need? \"\n    number &lt;- readLn :: IO Int\n    putStrLn $ \"The Fibonacci number you wanted is \" ++ (show $ fib number) ++ \".\"\n    putStrLn \"\"\n    where  fib :: Int -&gt; Integer\n           fib number = fibs !! number\n           fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>When I run the program in GHCi or through runhaskell, it executes fine; that is, asks me for a number, allows me to enter it on the same line and returns a number on another line:</p>\n\n<pre><code>Gallifreian@Gallifrey:~/Haskell$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :l Fib.hs\n[1 of 1] Compiling Main             ( Fib.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; main\n\nWhich Fibonacci sequence number do you need? 4\nThe Fibonacci number you wanted is 3.\n</code></pre>\n\n<p>However, when I run the compiled program, it returns this:</p>\n\n<pre><code>Gallifreian@Gallifrey:~/Haskell$ ./Fib\n\n4\nWhich Fibonacci sequence number do you need? The Fibonacci number you wanted is 3.\n</code></pre>\n\n<p>I. e. waits for me to enter a number and then returns all prompts on one line.\nWhat have I done wrong? Is there a way around this?</p>\n"}, {"tags": ["haskell", "types", "type-inference"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1471111038, "post_id": 38931180, "comment_id": 65226908, "body": "Is the body of <code>f</code> given?"}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1471111597, "post_id": 38931180, "comment_id": 65227054, "body": "@DavidYoung No. I have just this expression and it asks me to find its type."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1471124522, "post_id": 38931180, "comment_id": 65230396, "body": "@DavidYoung I have edited my question. It is the exact question in that paper."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1471122091, "post_id": 38931268, "comment_id": 65229894, "body": "for <code>&gt; :t f</code> to work, you&#39;d have to have <code>f</code> defined first. But the OP states they aren&#39;t given the definition, only the expression."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 0, "last_activity_date": 1471158067, "last_edit_date": 1471158067, "creation_date": 1471080394, "answer_id": 38931268, "question_id": 38931180, "link": "https://stackoverflow.com/questions/38931180/check-and-find-type-in-haskell/38931268#38931268", "title": "Check and find type in Haskell", "body": "<p>If you have the body of f, you can type \":t f\" in GHCI (the haskell interpreter) to get its type.</p>\n\n<p>If all you know about f is that (f True) (f 1) compiles, then f could be any constant function of 2 variables, like <code>\\x y -&gt; 2  :: a -&gt; b -&gt; Int</code>, or <code>\\x y = \"foo\" :: a -&gt; b -&gt; String</code> or even <code>\\x y -&gt; readFile \"any.txt\" :: a -&gt; b -&gt; IO (String)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471084487, "post_id": 38931740, "comment_id": 65219450, "body": "Actually the answer is f :: a -&gt; b -&gt; Bool and says it is well typed but i don&#39;t understand how they conclude this result."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471084676, "post_id": 38931740, "comment_id": 65219496, "body": "also there are brackets on both, so what i understand is (f Bool) result is applied to (f 1) result, and I don&#39;t understand how it is well typed."}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471085758, "post_id": 38931740, "comment_id": 65219755, "body": "Ok this looks like some sort of constant function, I&#39;ll edit my answer to explain the case where <code>f</code> is <code>const</code> or some function that discards its result."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471089527, "post_id": 38931740, "comment_id": 65220667, "body": "Thank you for this one. But im still confused how to know the type of this expression. Here I have type so i can conclude how it comes, but what to do when I have only expression."}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471091986, "post_id": 38931740, "comment_id": 65221315, "body": "Well you can&#39;t really say much more than what I said at first with just the expression. If you had the result of it then it would have been possible to infer the right type and the definition."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471105210, "post_id": 38931740, "comment_id": 65225190, "body": "actually it is a question in one of my past paper exams and im preparing for that. Im still confused if this kind of question appears again in exam, how i gonna answer that."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 1, "creation_date": 1471115549, "post_id": 38931740, "comment_id": 65228191, "body": "@WaqarAhmed I think something is wrong with the question. It doesn&#39;t make sense that they would give <code>f :: a -&gt; b -&gt; Bool</code> as an answer because there is no reason the result type is required to be <code>Bool</code>. It could be <i>any</i> type (consider <code>f :: a -&gt; b -&gt; Char; f _ _ = &#39;a&#39;</code>. That allows the expression to type check as well). You might consider asking your teacher about this one. There might have been a mistake."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471124548, "post_id": 38931740, "comment_id": 65230400, "body": "@villou24 I have edited my question. It is the exact question in that paper."}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471125451, "post_id": 38931740, "comment_id": 65230599, "body": "@WaqarAhmed Then yes, as suggested by David Young it looks like a mistake in the question, or at least a lack of information."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471126337, "post_id": 38931740, "comment_id": 65230801, "body": "@villou24 I hope that I won&#39;t come around questions like this during exam."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471130488, "post_id": 38931740, "comment_id": 65231628, "body": "@WaqarAhmed My best advice is to bring this to the teacher&#39;s attention and see what they say."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1471508233, "post_id": 38931740, "comment_id": 65377210, "body": "the more general definition is <code>f :: a-&gt;b-&gt;c ; f _ _ = undefined</code>."}], "tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": false, "score": 4, "last_activity_date": 1471086702, "last_edit_date": 1471086702, "creation_date": 1471083951, "answer_id": 38931740, "question_id": 38931180, "link": "https://stackoverflow.com/questions/38931180/check-and-find-type-in-haskell/38931740#38931740", "title": "Check and find type in Haskell", "body": "<p>Here is how I would infer the type of <code>f</code> from your expression. Note that I'm not presenting how GHC works but how my \"brain type checker\" works.</p>\n\n<p><code>f True</code> is applied to a value, which means that the <code>f</code> on the left has type <code>f True :: a -&gt; b</code>, so <code>f :: Bool -&gt; a -&gt; b</code>.</p>\n\n<p>On the right, we have <code>f 1</code>, which means that on the right <code>f :: (Num a) =&gt; a -&gt; b</code>, this is when my internal type checker starts to complain, because from the application of <code>f</code> on the left, I see that <code>f</code> can be applied to <code>Bool</code>, and on the right that it can be applied to a number, but <code>Bool</code> is not an instance of the <code>Num</code> class.</p>\n\n<p>However this still type checks if there is no constraint on the first argument, so we have <code>f :: a -&gt; b</code> and\u2026 we can't really say anything else I think. (Because <code>b</code> can be any type, it is perfectly possible that <code>b</code> is actually a <code>c -&gt; d</code>, so we can obtain a new function from applying <code>f</code> partially.)</p>\n\n<p>Note though that even if this type checks (you can check it in GHCi), it is very unlikely that <code>f</code> as a meaningful definition, in fact the only function it can represent that is not <code>undefined</code> is <code>const</code> I think (but correct if I'm wrong). You can say that because there is no constraint on the type of the first argument which is rather strange\u2026</p>\n\n<hr>\n\n<p>According to your comment <code>f :: a -&gt; b -&gt; Bool</code> (I was trying to have the most general type possible from the information given by the expression you typed, this is my result is a bit more general.)</p>\n\n<p>There is only one way to define such a function without using <code>undefined</code>, it has to be a function that discards both its argument and give a constant. Because there is no way <code>f</code> can be defined for any type immaginable. So the definition of <code>f</code> is something like:</p>\n\n<pre><code>f _ _ = True\n</code></pre>\n\n<p>When you apply <code>f True</code> to <code>f 1</code>, you apply <code>f True :: b -&gt; Bool</code> to a function <code>f 1 :: b -&gt; Bool</code>, this is well typed because <code>b</code> is a type variable, it can be anything, in particular it is perfectly fine for <code>b</code> to be a <code>c -&gt; Bool</code>, and in that case, the type of <code>f True</code> is in fact <code>f True :: (c -&gt; Bool) -&gt; Bool</code>. Is it clearer?</p>\n"}], "owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 938, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1471158067, "creation_date": 1471079688, "last_edit_date": 1471124410, "question_id": 38931180, "link": "https://stackoverflow.com/questions/38931180/check-and-find-type-in-haskell", "title": "Check and find type in Haskell", "body": "<p>The question is: </p>\n\n<blockquote>\n  <p>Give a type declaration of  <code>(f True) (f 1)</code> such that it is\n  well-typed or explain why it cannot exist.</p>\n</blockquote>\n\n<p>Kindly please help me as I am unable to understand how to define type declaration. Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1471073388, "post_id": 38930302, "comment_id": 65217019, "body": "That sounds like a parser. What exactly do you mean by &quot;<i>etc</i>&quot;, i.e. what&#39;s the syntax you&#39;re trying to parse?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1471073585, "post_id": 38930302, "comment_id": 65217066, "body": "@melpomene An elementary expression whose result is an integer, such as a+b, a*b, a^b, a+b+c."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1471074104, "post_id": 38930302, "comment_id": 65217186, "body": "You are looking for this: <a href=\"https://hackage.haskell.org/package/plugins-1.5.5.0/docs/System-Eval-Haskell.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/plugins-1.5.5.0/docs/&hellip;</a>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1471074368, "post_id": 38930302, "comment_id": 65217246, "body": "@Sibi Looks good! I&#39;ll try."}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1471073522, "post_id": 38930373, "comment_id": 65217051, "body": "Nice, but the input is not given as a String."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1471073753, "post_id": 38930373, "comment_id": 65217116, "body": "You can do the same without TH: <code>let a = 1 + 1</code>"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": -2, "last_activity_date": 1471073457, "creation_date": 1471073457, "answer_id": 38930373, "question_id": 38930302, "link": "https://stackoverflow.com/questions/38930302/power-given-in-a-string-to-integer/38930373#38930373", "title": "Power given in a String to Integer", "body": "<p>Hum, you could try to use <a href=\"https://wiki.haskell.org/Quasiquotation\" rel=\"nofollow\">QuasiQuotes</a> for this:</p>\n\n<pre><code>ghci&gt; :set -XQuasiQuotes\nghci&gt; :set -XTemplateHaskell\nghci&gt; let a = [|1 + 1|]\nghci&gt; $a\n2\nghci&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1471075670, "post_id": 38930483, "comment_id": 65217552, "body": "Is it better than <a href=\"https://hackage.haskell.org/package/plugins-1.5.5.0/docs/System-Eval-Haskell.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/plugins-1.5.5.0/docs/&hellip;</a> ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1471075849, "post_id": 38930483, "comment_id": 65217577, "body": "It&#39;s simpler, doesn&#39;t require installation of any extra libraries, but it&#39;s not as capable. It all depends on your requirements."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1471074360, "creation_date": 1471074360, "answer_id": 38930483, "question_id": 38930302, "link": "https://stackoverflow.com/questions/38930302/power-given-in-a-string-to-integer/38930483#38930483", "title": "Power given in a String to Integer", "body": "<p>As far as I know there is no expression evaluator available in the\nbasic Haskell libraries.</p>\n\n<p>Will this work for you?</p>\n\n<pre><code>import System.Process\n\neval :: String -&gt; IO Integer\neval expr = do\n  r &lt;- readProcess \"ghc\" [\"-e\", expr] \"\"\n  return (read r)\n\nmain = eval \"2^3\" &gt;&gt;= print\n</code></pre>\n\n<p>But it runs in the IO monad and it's not very robust.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1471105638, "answer_count": 2, "score": 0, "last_activity_date": 1471074421, "creation_date": 1471073005, "last_edit_date": 1495542776, "question_id": 38930302, "link": "https://stackoverflow.com/questions/38930302/power-given-in-a-string-to-integer", "closed_reason": "Duplicate", "title": "Power given in a String to Integer", "body": "<p>We know <a href=\"https://stackoverflow.com/questions/2468410/convert-string-to-integer-float-in-haskell\">how to convert a String to an Integer</a> for a String such as <code>\"50\"</code>. Assume the String is <code>\"2^3\"</code>, how to get <code>8</code> from it ? Is there something which works when it is not known in advance that the operation is a power, something which would also work for <code>\"2+3\"</code>, etc ?</p>\n"}, {"tags": ["haskell", "testing", "monads", "quickcheck"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471095459, "post_id": 38930234, "comment_id": 65222329, "body": "I think you&#39;re looking for Conal Elliott&#39;s <code>checkers</code> package. <a href=\"https://hackage.haskell.org/package/checkers-0.4.5/docs/Test-QuickCheck-Classes.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/checkers-0.4.5/docs/&hellip;</a> includes a <code>monad</code> test."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471095678, "post_id": 38930234, "comment_id": 65222393, "body": "Is there any real need for <code>Arbitrary1</code>, etc? You can just have the constraint <code>( Eq (m Integer), Show (m Integer), Arbitrary (m Integer), Monad m )</code>, or <code>Eq (m A), Eq (m B) ... </code>, etc. Unless you need to store quantified constraints in containers, <code>Arbitrary1</code> is probably not useful."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471102657, "post_id": 38930234, "comment_id": 65224467, "body": "@dfeuer Thanks, that looks exactly like what I&#39;m looking for. Perhaps make in into an answer that I could accept?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1471102701, "post_id": 38930234, "comment_id": 65224477, "body": "@user2407038 True, I mainly wanted to keep compatibility with standard Haskell."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471110262, "post_id": 38930234, "comment_id": 65226687, "body": "@PetrPudl&#225;k @dfeuer FWIW I picked up <code>checkers</code> a couple of years ago and it didn&#39;t want to compile. That was GHC 7.8, I think, so I doubt the situation has improved since then. So, beware, you might have to fork it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471124932, "post_id": 38930234, "comment_id": 65230482, "body": "@BenjaminHodgson, since the package was last updated by Conal this July, I imagine the situation <i>has</i> improved."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471126223, "post_id": 38930234, "comment_id": 65230776, "body": "By the way, I would not be surprised if <code>FlexibleContexts</code> made it into the next Haskell standard. It&#39;s one of the very least invasive extensions--much less than even <code>FlexibleInstances</code>--and it&#39;s extremely useful."}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 552, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1471072423, "creation_date": 1471072423, "question_id": 38930234, "link": "https://stackoverflow.com/questions/38930234/testing-monadic-laws-using-quickcheck", "title": "Testing monadic laws using QuickCheck", "body": "<p>Is there a library or tools for testing the <a href=\"https://wiki.haskell.org/Monad_laws\" rel=\"nofollow\">laws</a> of a custom monad? My current hacked attempt goes something like this:</p>\n\n<ul>\n<li>Define <code>Arbitrary1</code>, similar to <code>Eq1</code>, <code>Show1</code> etc.</li>\n<li>Define a helper type that wraps <code>Arbitrary1</code> as <code>Arbitrary</code>.</li>\n<li>Define a test (for example) for monadic laws.</li>\n</ul>\n\n<p>Is any of this already implemented somewhere?</p>\n\n<hr>\n\n<pre><code>{-# LANGUAGE RankNTypes, ScopedTypeVariables #-}\nimport Data.Functor.Classes\nimport Data.Proxy\nimport Test.QuickCheck\nimport Test.QuickCheck.Function\nimport Test.QuickCheck.Poly\n</code></pre>\n\n<p>Define <code>Arbitrary1</code> for <code>* -&gt; *</code> types:</p>\n\n<pre><code>class Arbitrary1 m where\n    arbitrary1 :: (Arbitrary a) =&gt; Gen (m a)\n    shrink1 :: (Arbitrary a) =&gt; m a -&gt; [m a]\n    shrink1 _ = []\n</code></pre>\n\n<p>And a helper wrapper so that we can use functions that work with <code>Arbitrary</code>:</p>\n\n<pre><code>newtype Action m a = Action { getAction :: m a }\n\ninstance (Arbitrary a, Arbitrary1 m) =&gt; Arbitrary (Action m a) where\n    arbitrary = Action &lt;$&gt; arbitrary1\n    shrink = map Action . shrink1 . getAction\n\ninstance (Show a, Show1 m) =&gt; Show (Action m a) where\n    showsPrec p = showsPrec1 p . getAction\n</code></pre>\n\n<p>Now we can write a test like this:</p>\n\n<pre><code>-- (m &gt;&gt;= f) &gt;&gt;= g  \u2261   m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\ntestBindAssoc :: forall m . (Monad m, Arbitrary1 m, Show1 m, Eq1 m) =&gt; Proxy m -&gt; Property\ntestBindAssoc _ =\n    forAllShrink (arbitrary :: Gen (Action m A)) shrink $ \\m' -&gt;\n    forAllShrink (arbitrary :: Gen (Fun A (Action m B))) shrink $ \\f' -&gt;\n    forAllShrink (arbitrary :: Gen (Fun B (Action m C))) shrink $ \\g' -&gt;\n    let m = getAction m'\n        f = getAction &lt;$&gt; apply f'\n        g = getAction &lt;$&gt; apply g'\n        k = (m &gt;&gt;= f) &gt;&gt;= g\n        l = m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\n    in counterexample (showsPrec1 0 k . showString \" != \" . showsPrec1 0 l $ \"\")\n        $ k `eq1` l\n</code></pre>\n\n<p>And let's write a broken <code>Writer</code> monad:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nimport Control.Monad.Writer\n\nnewtype MyMonad w a = MyMonad { runMyMonad :: Writer w a }\n  deriving (Functor, Applicative)\n\ninstance (Monoid w) =&gt; Monad (MyMonad w) where\n    return = pure\n    k &gt;&gt;= f = let (a, w) = runWriter . runMyMonad $ k\n              in MyMonad $ writer (a, w &lt;&gt; w) &gt;&gt;= (runMyMonad . f)\n--                                    ^ broken here\n\ngetMyMonad :: MyMonad w a -&gt; (a, w)\ngetMyMonad = runWriter . runMyMonad\n\ninstance (Eq w) =&gt; Eq1 (MyMonad w) where\n    eq1 k l = getMyMonad k == getMyMonad l\n\ninstance (Show w) =&gt; Show1 (MyMonad w) where\n    showsPrec1 p k = showsPrec p (getMyMonad k)\n\ninstance (Monoid w, Arbitrary w) =&gt; Arbitrary1 (MyMonad w) where\n    arbitrary1 = MyMonad . writer &lt;$&gt; arbitrary\n    shrink1 = map (MyMonad . writer) . shrink . getMyMonad\n\nmain :: IO ()\nmain = quickCheck (testBindAssoc (Proxy :: Proxy (MyMonad (Sum Int))))\n</code></pre>\n\n<p>Fails with:</p>\n\n<blockquote>\n<pre><code>*** Failed! Falsifiable (after 2 tests and 13 shrinks):   \n(1,Sum {getSum = 1})\n{_-&gt;(1,Sum {getSum = 0})}\n{_-&gt;(1,Sum {getSum = 0})}\n(1,Sum {getSum = 4}) != (1,Sum {getSum = 2})\n</code></pre>\n</blockquote>\n\n<p>Any ideas for improvements?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "edited": false, "score": 0, "creation_date": 1471058368, "post_id": 38928802, "comment_id": 65214381, "body": "Please include all relevant information in the question itself. The github link is not guaranteed to still work in the future."}, {"owner": {"reputation": 594, "user_id": 1443481, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4dd92d46e793967128399d3af5357589?s=128&d=identicon&r=PG", "display_name": "Stuart", "link": "https://stackoverflow.com/users/1443481/stuart"}, "reply_to_user": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "edited": false, "score": 0, "creation_date": 1471058693, "post_id": 38928802, "comment_id": 65214429, "body": "@hugomg extra information added"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471064351, "post_id": 38928802, "comment_id": 65215214, "body": "Added a diff of all changes to my answer."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1471069159, "post_id": 38928802, "comment_id": 65216083, "body": "Have you considering using Stack as your build system?"}], "answers": [{"tags": [], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "is_accepted": false, "score": 0, "last_activity_date": 1471060386, "creation_date": 1471060386, "answer_id": 38929013, "question_id": 38928802, "link": "https://stackoverflow.com/questions/38928802/set-up-haskell-project-and-run-tests/38929013#38929013", "title": "Set up Haskell Project and run tests", "body": "<p><a href=\"https://www.haskell.org/cabal/\" rel=\"nofollow\">Cabal</a> has \n<a href=\"https://www.haskell.org/cabal/release/cabal-1.24.0.0/doc/users-guide/developing-packages.html\" rel=\"nofollow\">developing packages link</a> and cabal file content structure is described there.</p>\n\n<p>By looking the error message, it seems that your haskell <strong>library</strong> source file Chapter1 starts with <code>module Main where</code>. It should contain <code>module Chapter1 where</code>, as the error message says. </p>\n\n<p>Libraries should not contain <code>main</code> while the test-executables should, which is why you state in the cabal file the test executables with <code>main-is</code>. </p>\n\n<p>Hope this helps! (I didn't look at the github sources, just the error message.)</p>\n"}, {"comments": [{"owner": {"reputation": 594, "user_id": 1443481, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4dd92d46e793967128399d3af5357589?s=128&d=identicon&r=PG", "display_name": "Stuart", "link": "https://stackoverflow.com/users/1443481/stuart"}, "edited": false, "score": 0, "creation_date": 1471088922, "post_id": 38929174, "comment_id": 65220504, "body": "Thanks for the detailed response! I also had to remove the <code>test-framework</code> lines in cabal, but it&#39;s building and testing now."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1471064206, "last_edit_date": 1495535320, "creation_date": 1471062352, "answer_id": 38929174, "question_id": 38928802, "link": "https://stackoverflow.com/questions/38928802/set-up-haskell-project-and-run-tests/38929174#38929174", "title": "Set up Haskell Project and run tests", "body": "<p>Diff of all changes:</p>\n\n<p><a href=\"http://lpaste.net/5997592404872396800\" rel=\"nofollow noreferrer\">http://lpaste.net/5997592404872396800</a></p>\n\n<p>Specific changes you need to make:</p>\n\n<ol>\n<li><p>In Chapter1.hs make sure <code>module Chapter1</code> appears before the import statement:</p>\n\n<pre><code>module Chapter1 where\nimport ...\n</code></pre></li>\n<li><p>In each of the Book modules you need to add the prefix <code>Book.</code> to\neach of the module statements, e.g. in <code>Book/COR.hs</code>:</p>\n\n<pre><code>change:  module COR\n    to:  module Book.COR\n</code></pre>\n\n<p>Also, any import statement will also need the <code>Book.</code> prefix, i.e. in <code>Book/STAL.hs</code>:</p>\n\n<pre><code>change:  import DB\n    to:  import Book.DB\n</code></pre>\n\n<p>(It might easier just to leave the book's modules at the top-level of the module name space.)</p></li>\n<li><p>To fix this compilation error:</p>\n\n<pre><code>src/Book/IAR.hs:131:7:\n    No instance for (Foldable t3) arising from a use of \u2018foldr\u2019\n</code></pre></li>\n</ol>\n\n<p>just add <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> to the top of <code>Book/IAR.hs</code> (it should be the very first line.)</p>\n\n<ol start=\"4\">\n<li><p>To fix this compilation error:</p>\n\n<pre><code>src/Book/FAIS.hs:14:4: Parse error in pattern: n + 1\n</code></pre>\n\n<p>change: <code>f (n+1) = True : f n</code> to <code>f n = True : f (n-1)</code>.</p>\n\n<p>This is called an <code>n+k pattern</code> and more info about it (and why it has been deprecated) is available here: <a href=\"https://stackoverflow.com/questions/3748592/what-are-nk-patterns-and-why-are-they-banned-from-haskell-2010\">What are &quot;n+k patterns&quot; and why are they banned from Haskell 2010?</a></p></li>\n<li><p>In the <code>test-suite</code> section you have:</p>\n\n<pre><code>hs-source-dirs: tests, src\n</code></pre>\n\n<p>To use the code in the <code>src</code> directory you tests should depend on the <code>haskell-road</code> library instead of compiling the source code. That is, use these lines in the <code>test-suite</code> section:</p>\n\n<pre><code>hs-source-dirs: tests\nbuild-depends: base, haskell-road, HUnit, ...\n</code></pre></li>\n<li><p>File <code>test/Chapter1Test.hs</code> needs a module statement:</p>\n\n<pre><code>module Chapter1Test where\n</code></pre>\n\n<p>and also fix this <code>import</code> statement:</p>\n\n<pre><code>-import TestHelper.testCase\n+import TestHelper (testCase)\n</code></pre></li>\n<li><p>File <code>test/MainTestSuite.hs</code> needs these import statements:</p>\n\n<pre><code>import System.Exit\nimport Test.HUnit\n</code></pre></li>\n<li><p>File <code>test/testHelper.hs</code> needs to be renamed to <code>test/TestHelper.hs</code>\nand also needs this import statement:</p>\n\n<pre><code>import Test.HUnit\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 594, "user_id": 1443481, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4dd92d46e793967128399d3af5357589?s=128&d=identicon&r=PG", "display_name": "Stuart", "link": "https://stackoverflow.com/users/1443481/stuart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 1, "accepted_answer_id": 38929174, "answer_count": 2, "score": 1, "last_activity_date": 1471064206, "creation_date": 1471057618, "last_edit_date": 1471058673, "question_id": 38928802, "link": "https://stackoverflow.com/questions/38928802/set-up-haskell-project-and-run-tests", "title": "Set up Haskell Project and run tests", "body": "<p>I'm trying to set up a Haskell project (library) with tests that I can use to work through <a href=\"http://homepages.cwi.nl/~jve/HR/\" rel=\"nofollow\">The Haskell Road to Logic, Maths, and Programming</a>. There are three parts that I'd like to have:</p>\n\n<ul>\n<li>The code that comes with the book, in a subdirectory</li>\n<li>The code I write for exercises in the book; one file per chapter</li>\n<li>The code I write for tests; one file per chapter</li>\n</ul>\n\n<p>I have attempted a project setup <a href=\"https://github.com/shterrett/haskell-road/tree/configure-tests\" rel=\"nofollow\">here</a>, but am getting the following cabal error:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring haskell-road-0.1.0.0...\nBuilding haskell-road-0.1.0.0...\nFailed to install haskell-road-0.1.0.0\nBuild log ( /Users/stuart/.cabal/logs/haskell-road-0.1.0.0.log ):\ncabal: Entering directory '.'\nConfiguring haskell-road-0.1.0.0...\nBuilding haskell-road-0.1.0.0...\nPreprocessing library haskell-road-0.1.0.0...\n\nsrc/Chapter1.hs:1:1:\n    File name does not match module name:\n    Saw: \u2018Main\u2019\n    Expected: \u2018Chapter1\u2019\ncabal: Leaving directory '.'\ncabal: Error: some packages failed to install:\nhaskell-road-0.1.0.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I'd like to be able to run <code>$ cabal test</code> and have all of the tests run, and have the import paths work. Any help is appreciated. I think there are probably issues with the test structure, but I've had trouble finding definitive guides on the actual setup.</p>\n\n<p>EDIT: More details</p>\n\n<pre><code>src/\n  Chapter1.hs\n  Book/\n    GS.hs\n    etc....\ntest/\n  Chapter1Test.hs\n  MainTestSuite.hs\n  TestHelper.hs\n</code></pre>\n\n<p>haskell-book.hs:</p>\n\n<pre><code>-- Initial haskell-road.cabal generated by cabal init.  For further\n-- documentation, see http://haskell.org/cabal/users-guide/\n\n-- The name of the package.\nname:                haskell-road\n\n-- The package version.  See the Haskell package versioning policy (PVP)\n-- for standards guiding when and how versions should be incremented.\n-- https://wiki.haskell.org/Package_versioning_policy\n-- PVP summary:      +-+------- breaking API changes\n--                   | | +----- non-breaking API additions\n--                   | | | +--- code changes with no API change\nversion:             0.1.0.0\n\n-- A short (one-line) description of the package.\n-- synopsis:\n\n-- A longer description of the package.\n-- description:\n\n-- The license under which the package is released.\nlicense:             MIT\n\n-- The file containing the license text.\nlicense-file:        LICENSE\n\n-- The package author(s).\nauthor:              Stuart Terrett\n\n-- An email address to which users can send suggestions, bug reports, and\n-- patches.\nmaintainer:          shterrett@gmail.com\n\n-- A copyright notice.\n-- copyright:\n\n-- category:\n\nbuild-type:          Simple\n\n-- Extra files to be distributed with the package, such as examples or a\n-- README.\nextra-source-files:  ChangeLog.md\n\n-- Constraint on the version of Cabal needed to build this package.\ncabal-version:       &gt;=1.10\n\n\nlibrary\n  -- Modules exported by the library.\n  exposed-modules:     Chapter1, Book.COR, Book.DB, Book.FAIS, Book.FCT, Book.GS, Book.Hierarchy, Book.IAR, Book.Nats, Book.POL, Book.Polynomials, Book.PowerSeries, Book.Query, Book.REL, Book.SetEq, Book.SetOrd, Book.STAL, Book.TAMO, Book.TUOLP, Book.WWN\n\n  -- Modules included in this library but not exported.\n  -- other-modules:\n\n  -- LANGUAGE extensions used by modules in this package.\n  other-extensions:    FlexibleInstances\n\n  -- Other library packages from which modules are imported.\n  build-depends:       base, random &gt;=1.1 &amp;&amp; &lt;1.2, HUnit &gt;=1.3 &amp;&amp; &lt;1.4\n\n  -- Directories containing source files.\n  hs-source-dirs:      src\n\n  -- Base language which the package is written in.\n  default-language:    Haskell2010\n\n\ntest-suite haskell-road-tests\n  type:              exitcode-stdio-1.0\n  hs-source-dirs:    tests, src\n  main-is:           MainTestSuite.hs\n  build-depends:     base,\n                     HUnit,\n                     QuickCheck,\n                     test-framework,\n                     test-framework-hunit,\n                     test-framework-quickcheck2\n</code></pre>\n\n<p>MainTestSuite.hs</p>\n\n<pre><code>import Chapter1Test\n\nexitProperly :: IO Counts -&gt; IO ()\nexitProperly m = do\n  counts &lt;- m\n  exitWith $ if failures counts /= 0 || errors counts /= 0 then ExitFailure 1 else ExitSuccess\n\nallTests::[Test]\nallTests = [Chapter1Test.itRuns]\n\nmain :: IO ()\nmain = exitProperly (runTestTT (TestList allTests))\n</code></pre>\n"}, {"tags": ["windows", "haskell"], "comments": [{"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1471038423, "post_id": 38926895, "comment_id": 65210728, "body": "you can&#39;t remove a directory that&#39;s not empty..."}, {"owner": {"reputation": 2891, "user_id": 135889, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6660983655e40c381d6c93a2fffd42dd?s=128&d=identicon&r=PG", "display_name": "Ruud", "link": "https://stackoverflow.com/users/135889/ruud"}, "reply_to_user": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 1, "creation_date": 1471039129, "post_id": 38926895, "comment_id": 65210957, "body": "@MarcB: That is why <code>removeDirectoryRecursive</code> is <i>recursive</i>: it recursively deletes all contents before deleting the directory. I know what the issue is, and I shared the solution here <a href=\"https://stackoverflow.com/help/self-answer\">Q&amp;A style</a> to help other people who might encounter the same problem."}], "answers": [{"tags": [], "owner": {"reputation": 2891, "user_id": 135889, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6660983655e40c381d6c93a2fffd42dd?s=128&d=identicon&r=PG", "display_name": "Ruud", "link": "https://stackoverflow.com/users/135889/ruud"}, "is_accepted": true, "score": 4, "last_activity_date": 1471039836, "last_edit_date": 1471039836, "creation_date": 1471038367, "answer_id": 38926896, "question_id": 38926895, "link": "https://stackoverflow.com/questions/38926895/haskell-removedirectoryrecursive-permission-denied-on-windows/38926896#38926896", "title": "Haskell removeDirectoryRecursive: permission denied on Windows", "body": "<p>If the directory to be removed contains files that are read-only, removing those will fail on Windows but not on Linux.</p>\n\n<p>There exists <a href=\"https://hackage.haskell.org/package/directory-1.2.7.0/docs/System-Directory.html#v:removePathForcibly\" rel=\"nofollow\"><code>removePathForcibly</code></a>, but it was only introduced <a href=\"https://github.com/haskell/directory/issues/59#issuecomment-237458410\" rel=\"nofollow\">very recently</a>.</p>\n\n<p>So here\u2019s a little helper function to recursively make files writable. It can be used before calling <code>removeDirectoryRecursive</code>.</p>\n\n<pre><code>import Control.Monad (forM_, when)\nimport System.FilePath ((&lt;/&gt;))\nimport qualified System.Directory as FileSystem\n\n-- Recursively makes all files and directories in a directory writable.\n-- On Windows this is required to be able to recursively delete the directory.\nmakeWritableRecursive :: FilePath -&gt; IO ()\nmakeWritableRecursive path = do\n  permissions &lt;- FileSystem.getPermissions path\n  FileSystem.setPermissions path (FileSystem.setOwnerWritable True permissions)\n  isDirectory &lt;- FileSystem.doesDirectoryExist path\n  when isDirectory $ do\n    contents &lt;- FileSystem.listDirectory path\n    forM_ [path &lt;/&gt; item | item &lt;- contents] makeWritableRecursive\n</code></pre>\n"}], "owner": {"reputation": 2891, "user_id": 135889, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6660983655e40c381d6c93a2fffd42dd?s=128&d=identicon&r=PG", "display_name": "Ruud", "link": "https://stackoverflow.com/users/135889/ruud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 38926896, "answer_count": 1, "score": 4, "last_activity_date": 1471039836, "creation_date": 1471038367, "question_id": 38926895, "link": "https://stackoverflow.com/questions/38926895/haskell-removedirectoryrecursive-permission-denied-on-windows", "title": "Haskell removeDirectoryRecursive: permission denied on Windows", "body": "<p>When I use <a href=\"https://hackage.haskell.org/package/directory-1.2.7.0/docs/System-Directory.html#v:removeDirectoryRecursive\" rel=\"nofollow\"><code>removeDirectoryRecursive</code></a> on Windows, an <code>IOException</code> of type <code>PermissionDenied</code> is thrown with the message \u201cremoveDirectoryRecursive: permission denied\u201d. I do have the required permissions to remove the directory. This issue does not occur on Linux for a directory with identical contents.</p>\n"}, {"tags": ["haskell", "metaprogramming", "rpc"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1471086588, "post_id": 38926502, "comment_id": 65219944, "body": "If you&#39;re talking about, eg, <a href=\"http://www.castleproject.org/projects/dynamicproxy/\" rel=\"nofollow noreferrer\"><code>DynamicProxy</code></a> then no, Haskell doesn&#39;t have anything as ugly as that horrible hack. Ideas that you learned in Language X often won&#39;t be applicable to Language Y because Language Y has a different way of doing things. So, what are you really trying to achieve?"}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471087015, "post_id": 38926502, "comment_id": 65220041, "body": "I certainly know about paradigm difference between languages since I have seriously worked with a half-dozen languages. I do the same with Python using <b>getattr</b> and <b>call</b> magic methods and in C# using IoC Proxy object. I know there is no similar way in Haskell to do that but I mean is there any alternative to implement client transparency in Haskell? (Other than full code generation)"}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1471091268, "post_id": 38926502, "comment_id": 65221130, "body": "Some initial workaround can be defining a typeclass for the service and then an operator for flipping first argument of function so that the resulting invokation seems prettier:      <code>x .&gt; f = f x      class MyService where          myFunc :: MyService -&gt; a  -&gt; b -&gt; Int      result &lt;- myServiceInstance .&gt; myFunc arg1 arg2</code>"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1471101655, "post_id": 38926502, "comment_id": 65224182, "body": "If you&#39;re somewhat familiar with Haskell, you&#39;ll know that it always makes side-effects explicit. So you&#39;ll never call a web-service or db outside <code>IO</code>..."}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1471203201, "post_id": 38926502, "comment_id": 65246653, "body": "@mb21 I know that and that is why I have called the service using a monad notaion &lt;- plz get  more accurate before complain"}], "answers": [{"comments": [{"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 0, "creation_date": 1471418223, "post_id": 38987897, "comment_id": 65332688, "body": "It may not simplify, but at least beautifies the code! Thanks anyway!"}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1471406403, "creation_date": 1471406403, "answer_id": 38987897, "question_id": 38926502, "link": "https://stackoverflow.com/questions/38926502/transparent-proxy-in-haskell/38987897#38987897", "title": "Transparent proxy in Haskell", "body": "<p>The simplest way is to just pass the proxy as an argument instead of the other way round (most of the time I just do that, and the proxy is just a handle for a database connection)\nYou could also define something like this:</p>\n\n<pre><code>newtype Proxy = Proxy {withProxy :: (forall a . Proxiable a -&gt; IO a)}\n</code></pre>\n\n<p>But I don't think it would really simplify anything.</p>\n"}], "owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1471406403, "creation_date": 1471036186, "question_id": 38926502, "link": "https://stackoverflow.com/questions/38926502/transparent-proxy-in-haskell", "title": "Transparent proxy in Haskell", "body": "<p>In many languages there are ways to create something called transparent proxy (or transproxy) for doing RPC or even calling SQL functions. In C# for example we can both use meta-programming (using IOC) or DLR for doing so. Is there any way in Haskell for creating a transparent proxy? Suppose we have some service and after creating the proxy variable we must be able to call 'myFunc' as below:</p>\n\n<pre><code>proxy myFunc arg1 arg2\n</code></pre>\n\n<p>or whatever similar. Do I have to use Template Haskell for this?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1471090119, "post_id": 38926389, "comment_id": 65220801, "body": "The reproduction steps are a bit confusing: I suspect there&#39;s a typo (<code>3rdpary</code> / <code>3rdparty</code>) and a missing <code>cd mytest</code> as the second step. Also your error messages report <code>stack-test</code> as the parent directory of <code>3rdparty</code>."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1471090446, "post_id": 38926389, "comment_id": 65220892, "body": "When calling <code>stack test</code> from the project root, stack uses <code>rdf4h-2.0.0</code> as specified in the <code>stack.yaml</code>. That version of <code>rdf4h</code> doesn&#39;t include <code>Data.RDF.TriplesGraph</code>, thus the error message. When running <code>stack test</code> from the <code>hsparql</code> directory, stack uses a different <code>stack.yaml</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "is_accepted": true, "score": 2, "last_activity_date": 1471038278, "creation_date": 1471038278, "answer_id": 38926885, "question_id": 38926389, "link": "https://stackoverflow.com/questions/38926389/how-to-deal-with-dependencies-of-subprojects-in-stack/38926885#38926885", "title": "How to deal with dependencies of subprojects in stack", "body": "<p>hsparql author here. Thanks for the report. I've pushed a <a href=\"https://github.com/robstewart57/hsparql/commit/496ad8dbed4e5ffccbc45c5b3b94df2fc7a08d21\" rel=\"nofollow\">commit</a> that fixes compatibility with rdf4h >= 2.0.0 . I've pushed a hsparql version bump to 0.2.8 to hackage. The <code>stack test</code> command now works as you'd expect:</p>\n\n<pre><code>Progress: 1/2Database.HSparql.Connection tests:\n  selectQuery: [OK]\n  askQuery: [OK]\n  constructQuery: [OK]\n  describeQuery: [OK]\n\n         Test Cases  Total      \n Passed  4           4          \n Failed  0           0          \n Total   4           4\n</code></pre>\n"}], "owner": {"reputation": 4525, "user_id": 38483, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1c15318427dd61dfbe1327d54bb807ce?s=128&d=identicon&r=PG", "display_name": "tonicebrian", "link": "https://stackoverflow.com/users/38483/tonicebrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 38926885, "answer_count": 1, "score": 1, "last_activity_date": 1471038278, "creation_date": 1471035619, "question_id": 38926389, "link": "https://stackoverflow.com/questions/38926389/how-to-deal-with-dependencies-of-subprojects-in-stack", "title": "How to deal with dependencies of subprojects in stack", "body": "<p>I have problems figuring out what is wrong with having a source code dependency in my stack project. Say that I want to test a modified version of the <a href=\"https://hackage.haskell.org/package/hsparql\" rel=\"nofollow\">hsparql</a> library in my project. A minimal setup would be:</p>\n\n<pre><code>stack new mytest simple\nmkdir 3rdpary\ncd 3rdpary\ngit clone https://github.com/robstewart57/hsparql\n</code></pre>\n\n<p>Modify <code>stack.yml</code> to include the local and modified version of hsparql in my project:</p>\n\n<pre><code>packages:\n- '.'\n- 3rdparty/hsparql\n\n# Dependency packages to be pulled from upstream that are not in the resolver\n# (e.g., acme-missiles-0.3)\nextra-deps: \n- rdf4h-2.0.0\n- hgal-2.0.0.2\n</code></pre>\n\n<p>If I go to the 3rdparty/hsparql folder I can <code>stack test</code> without any problem, but from the root of my project I get </p>\n\n<pre><code>$ stack test\nhsparql-0.2.7: build (lib + test)\nProgress: 1/2\n--  While building package hsparql-0.2.7 using:\n      /home/cebrian/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.5.0 build lib:hsparql test:test-hsparql --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/cebrian/borralodedentro/stack-test/.stack-work/logs/hsparql-0.2.7.log\n\n    Preprocessing library hsparql-0.2.7...\n    In-place registering hsparql-0.2.7...\n    Preprocessing test suite 'test-hsparql' for hsparql-0.2.7...\n\n    /home/cebrian/borralodedentro/stack-test/3rdparty/hsparql/tests/Database/HSparql/ConnectionTest.hs:10:18:\n        Could not find module \u2018Data.RDF.TriplesGraph\u2019\n        Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>For some reason, the test action is not able to find the library <code>rdf4h</code> that's been specified both in the original library and my own <code>stack.yml</code>.</p>\n\n<p>I have no idea of what I'm doing wrong so any help will be appreciated. </p>\n"}, {"tags": ["haskell", "types", "ghc"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 3, "creation_date": 1471035021, "post_id": 38926169, "comment_id": 65209483, "body": "This is a great example of where dependent types would make life easier! The best I can think of with current Haskell is something like the <code>ST s</code> trick which forces you to keep track of which call created a <code>Collection</code>\u2014but that&#39;s a lot less flexible."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471038078, "post_id": 38926169, "comment_id": 65210622, "body": "It would be help to see examples of code that you want the compiler to be able to verify."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471038987, "post_id": 38926169, "comment_id": 65210912, "body": "What about merging collections with the same seed value (equal <code>Int</code>s) derived from different sources? If that&#39;s considered okay, some more options open up."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1471039982, "post_id": 38926169, "comment_id": 65211176, "body": "@dfeuer if I understand you, yes, that&#39;s exactly what I want to do (as long as the <code>Int</code>s are equal we can merge the collections)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471043191, "post_id": 38926169, "comment_id": 65212035, "body": "@ErikR I see what you mean. I started to add a couple examples of how users might want to get their seeds."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471094909, "post_id": 38926169, "comment_id": 65222172, "body": "One fun thing is to expose <code>Coercible</code> after an equality test."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471105619, "post_id": 38926169, "comment_id": 65225303, "body": "@dfeuer that sounds interesting, could you elaborate on what you mean or point me to an article?"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1471035480, "creation_date": 1471035480, "answer_id": 38926362, "question_id": 38926169, "link": "https://stackoverflow.com/questions/38926169/statically-enforcing-that-two-objects-were-created-from-the-same-int-seed/38926362#38926362", "title": "Statically enforcing that two objects were created from the same (Int) &quot;seed&quot;", "body": "<p>I believe this is impossible with the constraint that the seeds come from runtime values, like user input. The typechecker as a tool can only reject invalid programs if we can determine the program is invalid at compiletime. Supposing there is a type such that the typechecker is able to reject programs based on user input, we could deduce that the typechecker is doing some sort of time travel or is able to wholly simulate our deterministic universe. The best you can do as a library author is to smuggle your types into something like <code>ExceptT</code>, which documents the seed precondition and exports awareness for it.</p>\n"}, {"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1471035788, "post_id": 38926412, "comment_id": 65209804, "body": "Yep, this is exactly what I was thinking. It&#39;s a bit awkward, but I think it&#39;s more or less the best you can do as of now."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1471043474, "post_id": 38926412, "comment_id": 65212094, "body": "Thanks a lot. I had already thought of creating an <code>ST</code> interface for my library, so it&#39;s nice to notice that that will also solve the problem of combining collections (although I&#39;m not sure if that operation would actually be useful in <code>ST</code>)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1471036170, "last_edit_date": 1471036170, "creation_date": 1471035695, "answer_id": 38926412, "question_id": 38926169, "link": "https://stackoverflow.com/questions/38926169/statically-enforcing-that-two-objects-were-created-from-the-same-int-seed/38926412#38926412", "title": "Statically enforcing that two objects were created from the same (Int) &quot;seed&quot;", "body": "<p>Probably not in a convenient way. For handling seeds that are known only at runtime, you can use existential types; but then you cannot statically check that two of these existentially wrapped collections match up. The much simpler solution is simply this:</p>\n\n<pre><code>merge :: Collection a -&gt; Collection a -&gt; IO (Maybe (Collection a))\n</code></pre>\n\n<p>On the other hand, if it is okay to force all operations to be done \"together\", in a sense, then you can do something like what the <code>ST</code> monad does: group all the operations together, then supply an operation for \"running\" all the operations that only works if the operations don't leak collections by demanding they be perfectly polymorphic over a phantom variable, hence that the return type doesn't mention the phantom variable. (Tikhon Jelvis also suggests this in his comments.) Here's how that might look:</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nmodule Collection (Collection, COp, newCollection, merge, inspect, runCOp) where\n\nimport Control.Monad.Reader\n\ntype Seed = Int\ndata Collection s a = Collection Seed\nnewtype COp s a = COp (Seed -&gt; a) deriving (Functor, Applicative, Monad, MonadReader Seed)\n\nnewCollection :: COp s (Collection s a)\nnewCollection = Collection &lt;$&gt; ask\n\nmerge :: Collection s a -&gt; Collection s a -&gt; COp s (Collection s a)\nmerge l r = return (whatever l r) where\n  whatever = const\n\n-- just an example; substitute whatever functions you want to have for\n-- consuming Collections\ninspect :: Collection s a -&gt; COp s Int\ninspect (Collection seed) = return seed\n\nrunCOp :: (forall s. COp s a) -&gt; Seed -&gt; a\nrunCOp (COp f) = f\n</code></pre>\n\n<p>Note in particular that the <code>COp</code> and <code>Collection</code> constructors are not exported. Consequently we need never fear that a <code>Collection</code> will escape its <code>COp</code>; <code>runCOp newCollection</code> is not well-typed (and any other operation that tries to \"leak\" the collection to the outside world will have the same property). Therefore it will not be possible to pass a <code>Collection</code> constructed with one seed to a <code>merge</code> operating in the context of another seed.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 38926412, "answer_count": 2, "score": 4, "last_activity_date": 1471043059, "creation_date": 1471034530, "last_edit_date": 1471043059, "question_id": 38926169, "link": "https://stackoverflow.com/questions/38926169/statically-enforcing-that-two-objects-were-created-from-the-same-int-seed", "title": "Statically enforcing that two objects were created from the same (Int) &quot;seed&quot;", "body": "<p>In a library I'm working on, I have an API similar to the following:</p>\n\n<pre><code>data Collection a = Collection Seed {-etc...-}\ntype Seed = Int\n\nnewCollection :: Seed -&gt; IO (Collection a)\nnewCollection = undefined\n\ninsert :: a -&gt; Collection a -&gt; IO () -- ...and other mutable set-like functions\ninsert = undefined\n\nmergeCollections :: Collection a -&gt; Collection a -&gt; IO (Collection a)\nmergeCollections (Collection s0 {-etc...-}) (Collection s1 {-etc...-}) \n  | s0 /= s1  = error \"This is invalid; how can we make it statically unreachable?\"\n  | otherwise = undefined\n</code></pre>\n\n<p>I'd like to be able to enforce that the user cannot call <code>mergeCollections</code> on <code>Collection</code>s created with different <code>Seed</code> values.</p>\n\n<p>I thought of trying to tag <code>Collection</code> with a type-level natural: I think this would mean that the <code>Seed</code> would have to be statically known at compile time, but my users might be getting it from an environment variable or user input, so I don't think that would work.</p>\n\n<p>I also hoped I might be able to do something like:</p>\n\n<pre><code>newtype Seed u = Seed Int\nnewSeed :: Int -&gt; Seed u\nnewCollection :: Seed u -&gt; IO (Collection u a)\nmergeCollections :: Collection u a -&gt; Collection u a -&gt; IO (Collection u a)\n</code></pre>\n\n<p>Where somehow a <code>Seed</code> is tagged with a unique type in some way, such that the type system could track that both arguments to <code>merge</code> were created from the seed returned by the same invocation of <code>newSeed</code>. To be clear in this (hand-wavy) scheme <code>a</code> and <code>b</code> here would somehow not unify: <code>let a = newSeed 1; b = newSeed 1;</code>.</p>\n\n<p>Is something like this possible?</p>\n\n<h3>Examples</h3>\n\n<p>Here are some examples of ways I can imagine users creating <code>Seed</code>s and <code>Collection</code>s. Users would like to use the other operations (inserting, merging, etc) as freely as they could with any other <code>IO</code> mutable collection:</p>\n\n<ol>\n<li><p>We only need one seed for <em>all</em> <code>Collection</code>s (dynamically) created during the program, but the user must be able to specify in some way how the seed should be determined from the environment at runtime.</p></li>\n<li><p>One or more static keys gathered from environment vars (or command line args):</p>\n\n<pre><code>main = do\n   s1 &lt;- getEnv \"SEED1\"\n   s2 &lt;- getEnv \"SEED2\"\n   -- ... many Collections may be created dynamically from these seeds\n   -- and dynamically merged later\n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell", "filepath", "shakespeare-text"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1471070427, "post_id": 38925549, "comment_id": 65216336, "body": "AFAIR, it is relative to the working dir of the building tool process. That is, if you run <code>cabal build</code> or <code>stack build</code> in your project dir, all templates paths will be relative to that."}], "answers": [{"tags": [], "owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "is_accepted": true, "score": 1, "last_activity_date": 1472059826, "creation_date": 1472059826, "answer_id": 39129612, "question_id": 38925549, "link": "https://stackoverflow.com/questions/38925549/where-do-shakespeare-splices-look-for-their-files/39129612#39129612", "title": "Where do shakespeare splices look for their files", "body": "<p><code>shamletFile</code> takes a standard <code>FilePath</code> as an argument, and therefore is evaluated against \"current local directory\". \"Current\" during Template Haskell evaluation - i.e. compilation phase. As @arrowd pointed out, this is usually main project directory. </p>\n\n<p>Note that if you were using Yesod this would no longer be true, as during the build <code>yesod-bin</code> adds <code>templates/</code> prefix to each Shakespearean file (and it's hardcoded there).</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39129612, "answer_count": 1, "score": 2, "last_activity_date": 1472059826, "creation_date": 1471031549, "last_edit_date": 1471032220, "question_id": 38925549, "link": "https://stackoverflow.com/questions/38925549/where-do-shakespeare-splices-look-for-their-files", "title": "Where do shakespeare splices look for their files", "body": "<p>I'm trying to get Shakespeare templates up and running; in particular Text.Hamlet.  I have <code>$(shamletFile \"HTML/index.hamlet\")</code> (See notes) and when I compile the file I get an error telling me the file does not exist. So I have tried various combinations of file paths trying to guess at what working directory is being used by the splice, but without success.</p>\n\n<p>Where do shakespeare splices look for their files?  Is this documented somewhere?</p>\n\n<hr>\n\n<p><strong>NOTES</strong></p>\n\n<ol>\n<li>This path is relative to the source file using the template.</li>\n<li>I am not using the full Yesod framework, just the template engine.</li>\n</ol>\n"}, {"tags": ["haskell", "lambda", "semantics", "lambda-calculus"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1471026724, "post_id": 38924246, "comment_id": 65205599, "body": "Check out  the <a href=\"https://en.wikipedia.org/wiki/Church_encoding#Church_Booleans\" rel=\"nofollow noreferrer\">Church boolean</a> Wikipedia article."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471027227, "post_id": 38924246, "comment_id": 65205853, "body": "@Alec I checked it, but I don&#39;t understand how they are deriving those expression."}], "answers": [{"comments": [{"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471027731, "post_id": 38924547, "comment_id": 65206091, "body": "Thanks for this answer, but still the question is how they come up to this definition from the question."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471027779, "post_id": 38924547, "comment_id": 65206115, "body": "I mean how they drive this part for eq : \u03bbab.a b (b (\u03bbxy.y) (\u03bbxy.x))"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471027837, "post_id": 38924547, "comment_id": 65206135, "body": "@WaqarAhmed Does it make sense how to get from the question to <code>eq a b = a b (not b)</code>? If so, I&#39;ll be happy to connect the dots from <code>eq a b = a b (not b)</code> to <code>eq = \\a b -&gt; a b (b (\\x y -&gt; y) (\\x y -&gt; x))</code>. In short: inline the definitions of <code>not</code>, <code>false</code>, and <code>true</code>, and move the arguments from one side of the equals sign to the other."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471036363, "post_id": 38924547, "comment_id": 65210024, "body": "@WaqarAhmed Recall that in pure lambda calculus, <code>if x then y else z</code> is expressed as the simple application <code>x y z</code> -- this works because a boolean is encoded as a function taking two arguments and returning one of them (the first if true, the second if false)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471037140, "post_id": 38924547, "comment_id": 65210320, "body": "@WaqarAhmed Or, if it doesn&#39;t make sense how to get from the question to <code>eq a b = a b (not b)</code>, then please let me know which of the three steps I outlined above for doing this is giving you trouble and I&#39;ll be happy to expand on that step."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471038819, "post_id": 38924547, "comment_id": 65210848, "body": "@chi I understand how if works, but I am confuse how the first equation of eq derives."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471038948, "post_id": 38924547, "comment_id": 65210899, "body": "@DanielWagner Thank you for your help. I actually understand the process how it comes from first equation to the last but I am confused in how the first equation derives from the lambda representation of True and False only. I mean do I need to memorize those equations? or is there a way to derive these equations, like in the first step of yours"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 1, "creation_date": 1471040824, "post_id": 38924547, "comment_id": 65211425, "body": "@WaqarAhmed I am not sure I understood you. When you say &quot;first equation&quot; and &quot;last equation&quot;, do you mean <code>eq = \\ab. a b (b (\\xy. y) (\\xy. x))</code> and <code>eq = \\ab. a b (not b)</code>, resp.? If so, then the answers to your question are: 1) of <i>course</i> you do not need to memorize those equations, and 2) those equations <i>are</i> the derivation -- it&#39;s just that they&#39;re listed in backwards order compared to how you invent them. That is, first you invent the last equation as in my answer; then you get the second-to-last equation by inlining <code>not</code>; then you get the first equation by inlining <code>false</code> and <code>true</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1471027748, "last_edit_date": 1471027748, "creation_date": 1471027372, "answer_id": 38924547, "question_id": 38924246, "link": "https://stackoverflow.com/questions/38924246/how-to-encode-in-lambda-calculus/38924547#38924547", "title": "How to encode in lambda calculus", "body": "<p>Let us first write the functions in question with actual data types (but no pattern-matching: only <code>if</code>/<code>then</code>/<code>else</code>):</p>\n\n<pre><code>data Bool = False | True -- recall this definition\nnot  a   = if a then False else True\neq   a b = if a then (if b then True  else False)\n                else (if b then False else True )\nnand a b = if a then (if b then False else True )\n                else (if b then True  else True )\n</code></pre>\n\n<p>If you buy these definitions -- which are quite straightforward, just listing the truth tables of the functions -- then we can start doing some reasoning. First, we can simplify the outer branches of the <code>eq</code> and <code>nand</code> functions a little bit:</p>\n\n<pre><code>eq   a b = if a then b else not b\nnand a b = if a then not b else True\n</code></pre>\n\n<p>And now we're basically done. We just replace every <code>False</code> and <code>True</code> with their <code>if</code>/<code>then</code>/<code>else</code> behavior, and replace every <code>if</code>/<code>then</code>/<code>else</code> with function application:</p>\n\n<pre><code>type Bool a = a -&gt; a -&gt; a\nfalse a b = a -- `if False then a else b` becomes `false a b`\ntrue  a b = b -- `if True  then a else b` becomes `true  a b`\n\nnot  a   = a false true   -- from `if a then False else True`\neq   a b = a b (not b)    -- from `if a then b else not b`\nnand a b = a (not b) true -- from `if a then not b else True`\n</code></pre>\n\n<p>These are the definitions given in your solutions, though admittedly in Haskell syntax rather than lambda calculus syntax.</p>\n"}, {"comments": [{"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471073577, "post_id": 38930298, "comment_id": 65217064, "body": "Thank you for this explanation. This makes sense to me now. I just have a problem to understand on how b False True is inverting b. I mean the case you gave is for when b is false. How it works for b when b is true.  Except this everything is clear now."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471073709, "post_id": 38930298, "comment_id": 65217103, "body": "By our encoding, <code>b X Y</code> will be <code>X</code> when <code>b</code> is <code>True</code>, and <code>Y</code> when <code>b</code> is <code>False</code>.  So <code>b False True</code> means: <code>False</code> when <code>b</code> is <code>True</code>; <code>True</code> when <code>b</code> is <code>False</code>."}, {"owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "edited": false, "score": 0, "creation_date": 1471073798, "post_id": 38930298, "comment_id": 65217121, "body": "got it. Thank you. let me try this logic on nand now, and after that I am accepting it in case if i have no questions. Thank you very much...:)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1471073595, "last_edit_date": 1471073595, "creation_date": 1471072983, "answer_id": 38930298, "question_id": 38924246, "link": "https://stackoverflow.com/questions/38924246/how-to-encode-in-lambda-calculus/38930298#38930298", "title": "How to encode in lambda calculus", "body": "<p>I'm using the Haskell convention of writing &lambda; as <code>\\</code>.</p>\n\n<p>From the comments it looks like you are having trouble with this part specifically:</p>\n\n<pre><code>eq = \\a b. a b (b (\\x y. y) (\\x y. x))\n</code></pre>\n\n<p>So I'll just focus on this.</p>\n\n<p>Our encoding of booleans is as functions which take two arguments.  <code>True</code> returns the first argument, <code>False</code> returns the second argument. The first paragraph gives the encoding directly:</p>\n\n<pre><code>True = \\x y. x\nFalse = \\x y. y\n</code></pre>\n\n<p>We'll use the names instead of the lambda expressions until the very end.</p>\n\n<p>We know that <code>eq</code> should take two arguments, the two booleans to be compared.  (The encoding of booleans itself takes two arguments, but this is different -- <code>eq</code> should take two arguments no matter how booleans are encoded)  So we know it should look like:</p>\n\n<pre><code>eq = \\a b. _________________\n</code></pre>\n\n<p>At this point pretty much the only thing we can do is check one of the arguments to find out whether it's <code>True</code> or <code>False</code>.  <code>eq</code> is symmetrical so it doesn't really matter which one we ask about; let's pick <code>a</code> for no reason. The way we ask, according to the encoding, is to pass two arguments to the thing we want to find out about.</p>\n\n<pre><code>eq = \\a b. a ____ ____\n</code></pre>\n\n<p>Where we haven't figured out what goes in the \"holes\" yet.  The first hole is what will be returned if <code>a</code> turns out to be <code>True</code>, the second one is what will be returned if it turns out to be <code>False</code>.</p>\n\n<p>To figure out how to fill these holes, let's write the truth table for what we're trying to define:</p>\n\n<pre><code>a     |   b   |  eq a b\n------+-------+---------\nTrue  | True  |  True\nTrue  | False |  False\nFalse | True  |  False\nFalse | False |  True\n</code></pre>\n\n<p>Notice that on the two rows where <code>a</code> is <code>True</code>, the <code>a == b</code> column is the exact same as the <code>b</code> column.  So when <code>a</code> is <code>True</code>, we just return <code>b</code>.  So we can fill in one of the holes:</p>\n\n<pre><code>eq = \\a b. a b ____\n</code></pre>\n\n<p>Now notice in the table that when <code>a</code> is <code>False</code>, <code>a == b</code> is the opposite of the <code>b</code> column, so in that case we should invert <code>b</code> and return it.</p>\n\n<p>To invert <code>b</code>, we want it to be <code>False</code> when <code>b</code> is <code>True</code> and vice versa.  In the encoding, that is:</p>\n\n<pre><code>b False True\n</code></pre>\n\n<p>And that's what we should return when <code>a</code> is <code>False</code>, so we fill in the other hole:</p>\n\n<pre><code>eq = \\a b. a b (b False True)\n</code></pre>\n\n<p>Now we just unroll the definitions of <code>False</code> and <code>True</code></p>\n\n<pre><code>eq = \\a b. a b (b (\\x y. y) (\\x y. x))\n</code></pre>\n\n<p>And there you have it.</p>\n"}], "owner": {"reputation": 4662, "user_id": 3118364, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/7db3f31fc4a855a3cf3299932f386f97?s=128&d=identicon&r=PG&f=1", "display_name": "Waqar Ahmed", "link": "https://stackoverflow.com/users/3118364/waqar-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1101, "favorite_count": 0, "accepted_answer_id": 38930298, "answer_count": 2, "score": 2, "last_activity_date": 1471073595, "creation_date": 1471026059, "last_edit_date": 1592644375, "question_id": 38924246, "link": "https://stackoverflow.com/questions/38924246/how-to-encode-in-lambda-calculus", "title": "How to encode in lambda calculus", "body": "<p>I am learning lambda calculus in Haskell and during that, i come across to this question.</p>\n<p><a href=\"https://i.stack.imgur.com/32r4b.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/32r4b.png\" alt=\"enter image description here\" /></a></p>\n<p>And the solution of these question is this :</p>\n<p><a href=\"https://i.stack.imgur.com/bIPo4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bIPo4.png\" alt=\"enter image description here\" /></a></p>\n<p>But I am unable to understand how they conclude the answer.\nLike for eq, I don't understand how they come to this :  <code>\u03bbab.a b (b (\u03bbxy.y) (\u03bbxy.x))</code>\nand same for nand. It will be really great if someone explains it and help me to understand this question.</p>\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "contravariance"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1471024835, "post_id": 38923880, "comment_id": 65204626, "body": "What is the <code>Contravariant ((-&gt;) a)</code> instance?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1471025773, "post_id": 38923880, "comment_id": 65205085, "body": "@Alec: There is none, because the parameter is used in positive position."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1471027445, "post_id": 38923880, "comment_id": 65205963, "body": "@Alec Ah. Welp.  :)"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1471025282, "post_id": 38923974, "comment_id": 65204838, "body": "Which is of course <code>(.)</code>: <code>fmap (&gt; 0) length = (&gt; 0) . length</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1471026484, "last_edit_date": 1471026484, "creation_date": 1471024919, "answer_id": 38923974, "question_id": 38923880, "link": "https://stackoverflow.com/questions/38923880/how-to-contramap-over-functions/38923974#38923974", "title": "How to contramap over functions?", "body": "<p>Actually, you're looking for the boring old covariant <code>Functor</code> instance.</p>\n\n<pre><code>&gt; fmap (&gt;0) length \"Hello\"\nTrue\n</code></pre>\n\n<p>At an even higher level, you may be looking for the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:null\"><code>null</code></a> function. For many types, <code>length</code> will traverse the entire data structure you pass to it, whereas <code>null</code> generally will not.</p>\n\n<p>Here is a short explanation of the error message, as well. First:</p>\n\n<pre><code>contramap length :: (Contravariant f, Foldable t) =&gt; f      Int  -&gt; f (t a)\n(&gt;0)             :: (Num a, Ord a) =&gt;                (-&gt;) a Bool\n</code></pre>\n\n<p>I have aligned things in what I hope is a suggestive way. In order to apply <code>contramap length</code> to <code>(&gt;0)</code>, we would need to set <code>f ~ (-&gt;) a</code> and <code>Int ~ Bool</code>. The second is clearly impossible, so the compiler complains. (N.B. The first equation is only subtly impossible; even if you supplied a function which returned an <code>Int</code> you'd have a problem, but the compiler doesn't notice yet because the obvious problem with the second equation trumps it. Namely: there is no <code>Contravariant</code> instance for <code>(-&gt;) a</code>, and can't be!)</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1471026815, "post_id": 38924298, "comment_id": 65205655, "body": "After some reflection, I think I like this answer better than mine! It emphasizes the same intuition that the person asking the question probably had, and addresses the issue of first type argument/second type argument for <code>Contravariant</code> which is probably the actual misunderstanding that happened in the asker&#39;s mind."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1471029306, "post_id": 38924298, "comment_id": 65206840, "body": "Oh. I thought that a concrete <code>Bool</code> would be inferred by GHC somehow. But it remained as a &quot;free variable&quot; on the type level. In other words I thought I was working with <code>newtype Predicate a = a -&gt; Bool</code> which I believe actually is contravariant. My <code>contramap length (Predicate (&gt;0))</code> now type checks."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1471034321, "post_id": 38924298, "comment_id": 65209219, "body": "@sevo It&#39;s about (type) argument position, not about variable vs. non-variable. The concrete <code>Bool</code>ness is indeed inferred by GHC. Consider also <code>newtype Predicate b a = Predicate (a -&gt; b)</code>, which will still happily be a <code>Contravariant</code> instance."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 9, "last_activity_date": 1471053143, "last_edit_date": 1471053143, "creation_date": 1471026259, "answer_id": 38924298, "question_id": 38923880, "link": "https://stackoverflow.com/questions/38923880/how-to-contramap-over-functions/38924298#38924298", "title": "How to contramap over functions?", "body": "<p>Contravariant only works on the last argument of a type constructor. You might want <code>Profunctor</code>, which denotes type constructors that are contravariant in the second to last argument and covariant (like a regular Functor) in the last one.</p>\n\n<pre><code>&lt;Gurkenglas&gt; &gt; lmap length (&gt;0) \"hello\"\n&lt;lambdabot&gt;  True\n</code></pre>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 38924298, "answer_count": 2, "score": 4, "last_activity_date": 1471053143, "creation_date": 1471024562, "question_id": 38923880, "link": "https://stackoverflow.com/questions/38923880/how-to-contramap-over-functions", "title": "How to contramap over functions?", "body": "<p>Given:</p>\n\n<pre><code>class Contravariant (f :: * -&gt; *) where\n  contramap :: (a -&gt; b) -&gt; f b -&gt; f a\n</code></pre>\n\n<p>The following code is rejected. I'm expecting to get <code>String -&gt; Bool</code> (a predicate) as a result of contra-mapping <code>Int -&gt; Bool</code> over <code>String -&gt; Int</code>. I feel stupid as I must be making some wrong assumptions. Please help me in understanding the error message. Why is the second argument expected to be different than the one I think I need?</p>\n\n<pre><code>Prelude Control.Lens&gt; contramap length (&gt;0) \"Hello\"\n\n&lt;interactive&gt;:25:19: error:\n    \u2022 Couldn't match type \u2018Bool\u2019 with \u2018Int\u2019\n      Expected type: [Char] -&gt; Int\n        Actual type: [Char] -&gt; Bool\n    \u2022 In the second argument of \u2018contramap\u2019, namely \u2018(&gt; 0)\u2019\n      In the expression: contramap length (&gt; 0) \"Hello\"\n      In an equation for \u2018it\u2019: it = contramap length (&gt; 0) \"Hello\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 10, "last_activity_date": 1471004441, "creation_date": 1471004441, "answer_id": 38917852, "question_id": 38917713, "link": "https://stackoverflow.com/questions/38917713/haskellcould-not-deduce-floating-t-arising-from-a-use-of-cos/38917852#38917852", "title": "Haskell:Could not deduce (Floating t) arising from a use of `cos&#39;", "body": "<p><code>cos</code> and <code>sin</code> can only take a <code>Floating</code> argument, yet the type signature for <code>gateR</code> says that <code>t</code> is an <code>Integral</code> type, and not all <code>Integral</code>s are <code>Floating</code>.  Either change the type signature for <code>gateR</code> or convert <code>t</code> within <code>gateR</code> using <code>fromIntegral</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 4, "last_activity_date": 1471005094, "last_edit_date": 1471005094, "creation_date": 1471004513, "answer_id": 38917883, "question_id": 38917713, "link": "https://stackoverflow.com/questions/38917713/haskellcould-not-deduce-floating-t-arising-from-a-use-of-cos/38917883#38917883", "title": "Haskell:Could not deduce (Floating t) arising from a use of `cos&#39;", "body": "<p>Your functions only demand the constraint of <code>Integral t</code> thus you need to convert your <code>t</code> with <code>fromIntegral</code> and possibly an explicit type signature so you can apply sine and cosine. E.g.</p>\n\n<pre><code>cos (fromIntegral t :: Double)\n</code></pre>\n"}], "owner": {"reputation": 645, "user_id": 1462225, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0afb9a47eb6654437c6986283cff151c?s=128&d=identicon&r=PG", "display_name": "23ars", "link": "https://stackoverflow.com/users/1462225/23ars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 1, "accepted_answer_id": 38917852, "answer_count": 2, "score": 1, "last_activity_date": 1471005094, "creation_date": 1471004001, "last_edit_date": 1471004253, "question_id": 38917713, "link": "https://stackoverflow.com/questions/38917713/haskellcould-not-deduce-floating-t-arising-from-a-use-of-cos", "title": "Haskell:Could not deduce (Floating t) arising from a use of `cos&#39;", "body": "<p>I'm learning Haskell and I tried to implement some quantum gates based on resources that I found on Internet.\nFor now, I successfully implemented Z-gate,X-gate,H-gate but I have a problem implementing the rotation gate.</p>\n\n<pre><code>U = [[cos t  -sin t] \n     [sin t  cos t ]]\n</code></pre>\n\n<p>The code that I wrote:</p>\n\n<pre><code>type Vector a = [a]\ntype Matrix a = [Vector a]\nvectorToComplex :: Integral a =&gt; Vector a -&gt; Vector (Complex Double)\nvectorToComplex = map (\\i -&gt; fromIntegral i:+0.0)\n\nmatrixToComplex :: Integral a =&gt; Matrix a -&gt; Matrix (Complex Double)\nmatrixToComplex = map vectorToComplex\n--Z Gate\ngateZ :: Matrix (Complex Double)\ngateZ = matrixToComplex [[1,0],[0,-1]]\n</code></pre>\n\n<p>I tried to implement the gateR ( rotation gate) in the same way I implemented the Z-gate:</p>\n\n<pre><code>gateR :: Integral t =&gt; t -&gt; Matrix (Complex Double)\ngateR t = matrixToComplex [[cos t,-sin t],[sin t,cos t]]\n</code></pre>\n\n<p>but I have the next error and I don't really understand it ( I'm still learning the language).</p>\n\n<pre><code>Could not deduce (Floating t) arising from a use of `cos'\n    from the context (Integral t)\n      bound by the type signature for\n                 gateR :: Integral t =&gt; t -&gt; Matrix (Complex Double)\n      at quantum.hs:66:8-44\n    Possible fix:\n      add (Floating t) to the context of\n        the type signature for\n          gateR :: Integral t =&gt; t -&gt; Matrix (Complex Double)\n    In the expression: cos t\n    In the expression: [cos t, - sin t]\n    In the first argument of `matrixToComplex', namely\n      `[[cos t, - sin t], [sin t, cos t]]'\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1471003764, "post_id": 38917336, "comment_id": 65192165, "body": "Does your class have any laws regarding how <code>m2</code> and <code>m3</code> must behave? Consider <code>mconcat</code>, which has a default that can be overridden, but is expected to be equivalent to repeated application of <code>mappend</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471004070, "post_id": 38917336, "comment_id": 65192356, "body": "For that matter, is it possible to override the default if it is just an externally defined function?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471004398, "post_id": 38917336, "comment_id": 65192543, "body": "In my case, yes they do: I&#39;m playing with &quot;parameterized equality&quot; and the question in a way applies to Eq- and Ord-classes, too. I think it is convenient if you can choose, which method to write, when making instances. But how about min &amp; max?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471004633, "post_id": 38917336, "comment_id": 65192687, "body": "@chepner, first thought to overriding externally defined function is to not import the function and write your own."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471005237, "post_id": 38917336, "comment_id": 65193024, "body": "If nothing else, keeping the function in the class provides documentation that an instance must support the function. Also, consider if someone were to define <code>class A a =&gt; B a</code>; does <code>B</code> require <code>m2</code> to be defined?"}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471007820, "post_id": 38917336, "comment_id": 65194697, "body": "Good question. But I think it can be way more harmful to get this wrong if the functions can <i>not</i> be implemented in terms of each other. Consider <i>Monoid</i> vs. <i>Semigroup</i>, monadic <i>fail</i>, or the <i>pure*/*return</i> duplication that happened partly because a <i>Pointed</i> typeclass wasn&#39;t created way back when. Not that I blame anyone, but it&#39;s a tale worth thinking about."}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471009557, "post_id": 38917336, "comment_id": 65195797, "body": "@MarLinn: Do you think that I should reword the question to have two cases: one where functions can be implemented in terms of each other and one, where it is not possible? Your consern sound like one I&#39;d like to be told more."}, {"owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "edited": false, "score": 0, "creation_date": 1471011081, "post_id": 38917336, "comment_id": 65196856, "body": "@Gspia: I personally consider both questions to be completely different beasts. The one you asked is mostly about convenience and performance, while my variation is much more about underlying mathematical structures. So if at all I would ask a separate question. But honestly, I wouldn&#39;t expect many good answers because even or lib commitees seem to be struggling with that one."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471013110, "post_id": 38917336, "comment_id": 65198165, "body": "One thing to consider: a class with no superclasses and exactly one method gets special treatment by GHC. If you expect that the class might not always specialize away, that can be a substantial optimization."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1471016226, "post_id": 38918633, "comment_id": 65200091, "body": "&quot;superfluous&quot;, perhaps :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471024322, "post_id": 38918633, "comment_id": 65204390, "body": "Other good examples: <code>&lt;$</code> in <code>Functor</code> and <code>&lt;*</code> and <code>*&gt;</code> in <code>Applicative</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1471024665, "post_id": 38918633, "comment_id": 65204546, "body": "Interesting, I didn&#39;t know <code>&lt;$</code> was in <code>Functor</code>. (Indeed the Prelude doesn&#39;t export it, so the method doesn&#39;t show up in Haddocks.)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1471026466, "post_id": 38918633, "comment_id": 65205454, "body": "Also: <code>join</code> should be in <code>Monad</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1471031422, "post_id": 38918633, "comment_id": 65207893, "body": "@ReinHenrichs, so should <code>=&lt;&lt;</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1471035658, "post_id": 38918633, "comment_id": 65209741, "body": "How could you ever want anything but <code>(=&lt;&lt;) = flip (&gt;&gt;=)</code>? Perhaps you mean <code>&lt;=&lt;</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471098481, "post_id": 38918633, "comment_id": 65223252, "body": "@leftaroundabout, I&#39;d much rather have <code>(&gt;&gt;=) = flip (=&lt;&lt;)</code>. Consider <code>instance Monad Identity where { (=&lt;&lt;) = coerce }</code>. That would be much nicer, I think."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1471023682, "last_edit_date": 1471023682, "creation_date": 1471006863, "answer_id": 38918633, "question_id": 38917336, "link": "https://stackoverflow.com/questions/38917336/haskell-style-typeclass-design-should-typeclasses-be-minimized/38918633#38918633", "title": "Haskell style &amp; typeclass design (should typeclasses be minimized?)", "body": "<p>Keep them in the class if</p>\n\n<ul>\n<li>There are multiple different sets of minimal complete definitions for that class, and you can't a priori tell which is more simple/elegant for a given instance.</li>\n<li>It can reasonably be expected that particular types (e.g. unboxed vectors) will allow more efficient implementations of <code>m2</code> and <code>m3</code> than the default one. If these aren't overridable as methods, you'd need to resort to rewrite rules for this kind of optimisation.</li>\n</ul>\n\n<p>An example of a standard class with a great many \u201csuperfluous\u201d methods is (in more recent versions) <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a>. This is in part due to historical reasons, but also because different containers can have very different stricness etc. properties, so the default implementations of some methods might be really bad for performance of some instances.</p>\n\n<p>If neither of these considerations applies to your class, keep <code>m2</code> and <code>m3</code> out of the class. (You can always put them in later: if you provide a default implementation, it won't break anybody's code.)</p>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 38918633, "answer_count": 1, "score": 7, "last_activity_date": 1471023682, "creation_date": 1471002854, "last_edit_date": 1495540862, "question_id": 38917336, "link": "https://stackoverflow.com/questions/38917336/haskell-style-typeclass-design-should-typeclasses-be-minimized", "title": "Haskell style &amp; typeclass design (should typeclasses be minimized?)", "body": "<p>Suppose that</p>\n\n<pre><code>class A a where\n   m1 :: a -&gt; a \n   m2 :: a -&gt; a\n   m3 :: a -&gt; a\n   ...\n</code></pre>\n\n<p>where it is possible to write default implementation for m2 and m3 by using m1. </p>\n\n<p>Is it better to leave <code>m2</code> and <code>m3</code> into A or write them as extra functions <code>m2 :: A a =&gt; a -&gt; a</code> outside A? Or in other words, is worth to minimize the class API or does it matter?</p>\n\n<p>I checked (quickly) some style guides, like <a href=\"https://wiki.haskell.org/Programming_guidelines\" rel=\"nofollow noreferrer\">programmin guidelines</a> and some of the links in <a href=\"https://stackoverflow.com/questions/3077866/large-scale-design-in-haskell/3077912#3077912\">large-scale design</a>-question, and some books (craft &amp; rwh), but couldn't find a recommendation to this one. If there are presentations, blogs or books covering this kind of issues, please, could you share some pointers?</p>\n\n<p>Email-list thread <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2010-October/085643.html\" rel=\"nofollow noreferrer\">type class design</a> discusses this and might emphasize minimizing.</p>\n"}, {"tags": ["macos", "haskell", "gcc", "gtk2hs"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1471003876, "post_id": 38915534, "comment_id": 65192238, "body": "What versions of cabal/ghc are you using"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471006170, "post_id": 38915534, "comment_id": 65193585, "body": "Which of the recipes to install gtk on that page did you follow - 1, 2, 3, 4, 5 or 6? Were you able to run <code>gtk-demo</code>? And what version of OS X are you running?"}, {"owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "edited": false, "score": 0, "creation_date": 1471007552, "post_id": 38915534, "comment_id": 65194499, "body": "cabal version 1.24.0.0 and ghc version 7.10.3, i tried recipe 2 . and os x version 10.11.6. yes, i was able to start the demo"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471012401, "post_id": 38915534, "comment_id": 65197759, "body": "Now that pkg-config is finding gtk+-2.0, now what happens when you try <code>cabal install gtk</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471017671, "post_id": 38915534, "comment_id": 65201050, "body": "There is something amiss with your set of libraries. I would try using <code>stack</code> to build and use gtk.  If that doesn&#39;t work I would create a new issue here: <a href=\"https://github.com/gtk2hs/gtk2hs/issues\" rel=\"nofollow noreferrer\">github.com/gtk2hs/gtk2hs/issues</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471017898, "post_id": 38915534, "comment_id": 65201170, "body": "Link to stack: <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1471027331, "post_id": 38915534, "comment_id": 65205902, "body": "btw - what version of the gtk libraries fo you have installed? I was able to build with cabal and I have version 2.24.25 installed in /usr/local/Cellar/gtk+/2.24.25."}, {"owner": {"reputation": 462, "user_id": 2068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/845g4.jpg?s=128&g=1", "display_name": "eugenk", "link": "https://stackoverflow.com/users/2068056/eugenk"}, "edited": false, "score": 2, "creation_date": 1471382500, "post_id": 38915534, "comment_id": 65322074, "body": "I had exactly the same problem today and I managed to install gtk using the have-quartz-gtk flag: <code>cabal install gtk -f have-quartz-gtk</code> (of course with the environment variable PKG_CONFIG_PATH set as suggested by ErikR)"}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "edited": false, "score": 0, "creation_date": 1471010922, "post_id": 38919482, "comment_id": 65196736, "body": "thank you for your fast solution, but it does not work for me. I changed the variable of PKG_CONFIG_PATH and got the answer &quot;Found the library&quot; in the next step. After another failed try in installing, I checked the error message (2nd part of 3) and it gave me a lot of flags like &quot;-L/usr/local/Cellar/gtk+/2.24.29/lib&quot;. How can I link these flags?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "edited": false, "score": 0, "creation_date": 1471011489, "post_id": 38919482, "comment_id": 65197102, "body": "Just saying &quot;it does not work&quot; is not very helpful. Please update your question with what you tried and what the error message is."}, {"owner": {"reputation": 287228, "user_id": 1240268, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/RN9Mw.jpg?s=128&g=1", "display_name": "Andy Hayden", "link": "https://stackoverflow.com/users/1240268/andy-hayden"}, "edited": false, "score": 0, "creation_date": 1474179394, "post_id": 38919482, "comment_id": 66420626, "body": "As per @eugenk&#39;s comment above: <code>cabal install gtk -f have-quartz-gtk</code> fixed this for me."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1471009381, "creation_date": 1471009381, "answer_id": 38919482, "question_id": 38915534, "link": "https://stackoverflow.com/questions/38915534/try-to-install-gtk-on-mac-missing-dependencies/38919482#38919482", "title": "Try to install gtk on mac missing dependencies", "body": "<p>The problem is that <code>pkg-config</code> cannot find the file <code>gtk+-2.0.pc</code>:</p>\n\n<blockquote>\n  <p>requires pkg-config package gtk+-2.0-any,\n  not found in the pkg-config database</p>\n</blockquote>\n\n<p>Steps to troublshoot:</p>\n\n<ol>\n<li><p>Check which directories <code>pkg-config</code> is configured to look for <code>.pc</code> files with:</p>\n\n<pre><code>$  pkg-config --variable pc_path pkg-config\n</code></pre></li>\n<li><p>On my system, <code>gtk+-2.0.pc</code> resides in <code>/usr/local/lib/pkgconfig</code>. I extended the search path by setting the <code>PKG_CONFIG_PATH</code> environment variable:</p>\n\n<pre><code>export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:\n</code></pre></li>\n<li><p>Test that <code>pkg-config</code> can find gtk+-2.0:</p>\n\n<pre><code>pkg-config gtk+-2.0 --exists &amp;&amp; echo Found the library\n</code></pre>\n\n<p>No output means the .pc file was not found. Another command you can use\nfor checking is:</p>\n\n<pre><code>pkg-config gtk+-2.0 --libs --print-errors\n</code></pre>\n\n<p>You'll either see an error message or a long list of flags for the C compiler which tells it how to link with the gtk libraries.</p></li>\n<li><p>Another tip for finding the .pc file is to use the <code>locate</code> command (assuming the locate database has been updated):</p>\n\n<pre><code>locate '*.pc' | grep gtk\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 11601006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38d7fcc5787704084b726db354f2084d?s=128&d=identicon&r=PG&f=1", "display_name": "AChorostian", "link": "https://stackoverflow.com/users/11601006/achorostian"}, "is_accepted": false, "score": 1, "last_activity_date": 1559678643, "creation_date": 1559678643, "answer_id": 56450609, "question_id": 38915534, "link": "https://stackoverflow.com/questions/38915534/try-to-install-gtk-on-mac-missing-dependencies/56450609#56450609", "title": "Try to install gtk on mac missing dependencies", "body": "<p>If you are using Homebrew, you can install gtk+3 by typing:</p>\n\n<pre><code>brew install gtk+3\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1358, "favorite_count": 0, "accepted_answer_id": 38919482, "answer_count": 2, "score": 3, "last_activity_date": 1559678643, "creation_date": 1470997064, "last_edit_date": 1471014675, "question_id": 38915534, "link": "https://stackoverflow.com/questions/38915534/try-to-install-gtk-on-mac-missing-dependencies", "title": "Try to install gtk on mac missing dependencies", "body": "<p>I tried to install the gtk haskell on my mac. I used <a href=\"https://wiki.haskell.org/Gtk2Hs/Mac\" rel=\"nofollow\">this</a> site to install it. However I failed at the last step with the command: <code>sudo cabal install --with-gcc=gcc-4.8 gtk</code> </p>\n\n<p>the terminal answer is:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\nnext goal: gtk (user goal)\nrejecting: gtk-0.14.5, gtk-0.14.4, gtk-0.14.3, gtk-0.14.2, gtk-0.13.9,\ngtk-0.13.8.1, gtk-0.13.8, gtk-0.13.7, gtk-0.13.6, gtk-0.13.4, gtk-0.13.3,\ngtk-0.13.2, gtk-0.13.1, gtk-0.13.0.3, gtk-0.13.0.2, gtk-0.13.0.1,\ngtk-0.13.0.0, gtk-0.12.5.7, gtk-0.12.5.6, gtk-0.12.5.5, gtk-0.12.5.4,\ngtk-0.12.5.3, gtk-0.12.5.2, gtk-0.12.5.1, gtk-0.12.5.0, gtk-0.12.4,\ngtk-0.12.3.1, gtk-0.12.3, gtk-0.12.2, gtk-0.12.1, gtk-0.12.0, gtk-0.11.2,\ngtk-0.11.1, gtk-0.11.0 (conflict: requires pkg-config package gtk+-2.0-any,\nnot found in the pkg-config database)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Cabal should be up-to-date. </p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT:</strong> After doing ErikR recipe, it started to install with the command <code>cabal install gtk</code>. This is the error message, I got:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring glib-0.13.4.0...\nBuilding glib-0.13.4.0...\nInstalled glib-0.13.4.0\nDownloading gio-0.13.3.0...\nDownloading pango-0.13.3.0...\nConfiguring gio-0.13.3.0...\nConfiguring pango-0.13.3.0...\nBuilding gio-0.13.3.0...\nBuilding pango-0.13.3.0...\nInstalled pango-0.13.3.0\nInstalled gio-0.13.3.0\nDownloading gtk-0.14.5...\nConfiguring gtk-0.14.5...\nBuilding gtk-0.14.5...\nFailed to install gtk-0.14.5\nBuild log ( /Users/Max/.cabal/logs/gtk-0.14.5.log ):\ncabal: Entering directory '/var/folders/kr/2w9n7xxd6816d0rmgb05cfm00000gn/T/cabal-tmp-31721/gtk-0.14.5'\n[1 of 1] Compiling Main             ( /var/folders/kr/2w9n7xxd6816d0rmgb05cfm00000gn/T/cabal-tmp-31721/gtk-0.14.5/dist/setup/setup.hs, /var/folders/kr/2w9n7xxd6816d0rmgb05cfm00000gn/T/cabal-tmp-31721/gtk-0.14.5/dist/setup/Main.o )\nLinking /var/folders/kr/2w9n7xxd6816d0rmgb05cfm00000gn/T/cabal-tmp-31721/gtk-0.14.5/dist/setup/setup ...\nConfiguring gtk-0.14.5...\nBuilding gtk-0.14.5...\nPreprocessing library gtk-0.14.5...\n[  1 of 209] Compiling Graphics.UI.Gtk.ModelView.Sequence ( Graphics/UI/Gtk/ModelView/Sequence.hs, dist/build/Graphics/UI/Gtk/ModelView/Sequence.o )\n[  2 of 209] Compiling Graphics.UI.Gtk.Gdk.Enums ( dist/build/Graphics/UI/Gtk/Gdk/Enums.hs, dist/build/Graphics/UI/Gtk/Gdk/Enums.o )\n[  3 of 209] Compiling Graphics.UI.Gtk.General.Enums ( dist/build/Graphics/UI/Gtk/General/Enums.hs, dist/build/Graphics/UI/Gtk/General/Enums.o )\n[  4 of 209] Compiling Graphics.UI.Gtk.General.Threading ( Graphics/UI/Gtk/General/Threading.hs, dist/build/Graphics/UI/Gtk/General/Threading.o )\n[  5 of 209] Compiling Graphics.UI.Gtk.Signals ( dist/build/Graphics/UI/Gtk/Signals.hs, dist/build/Graphics/UI/Gtk/Signals.o )\n[  6 of 209] Compiling Graphics.UI.Gtk.Types ( dist/build/Graphics/UI/Gtk/Types.hs, dist/build/Graphics/UI/Gtk/Types.o )\n[  7 of 209] Compiling Graphics.UI.Gtk.General.DNDTypes ( dist/build/Graphics/UI/Gtk/General/DNDTypes.hs, dist/build/Graphics/UI/Gtk/General/DNDTypes.o )\n[  8 of 209] Compiling Graphics.UI.Gtk.Abstract.ContainerChildProperties ( dist/build/Graphics/UI/Gtk/Abstract/ContainerChildProperties.hs, dist/build/Graphics/UI/Gtk/Abstract/ContainerChildProperties.o )\n[  9 of 209] Compiling Graphics.UI.Gtk.Embedding.Types ( dist/build/Graphics/UI/Gtk/Embedding/Types.hs, dist/build/Graphics/UI/Gtk/Embedding/Types.o )\n[ 10 of 209] Compiling Graphics.UI.Gtk.Embedding.Embedding ( dist/build/Graphics/UI/Gtk/Embedding/Embedding.hs, dist/build/Graphics/UI/Gtk/Embedding/Embedding.o )\n[ 11 of 209] Compiling Graphics.UI.Gtk.ModelView.Types ( dist/build/Graphics/UI/Gtk/ModelView/Types.hs, dist/build/Graphics/UI/Gtk/ModelView/Types.o )\n[ 12 of 209] Compiling Graphics.UI.Gtk.Gdk.PixbufData ( Graphics/UI/Gtk/Gdk/PixbufData.hs, dist/build/Graphics/UI/Gtk/Gdk/PixbufData.o )\n[ 13 of 209] Compiling Graphics.UI.Gtk.Gdk.PixbufAnimation ( dist/build/Graphics/UI/Gtk/Gdk/PixbufAnimation.hs, dist/build/Graphics/UI/Gtk/Gdk/PixbufAnimation.o )\n[ 14 of 209] Compiling Graphics.UI.Gtk.Builder ( dist/build/Graphics/UI/Gtk/Builder.hs, dist/build/Graphics/UI/Gtk/Builder.o )\n[ 15 of 209] Compiling Graphics.UI.Gtk.Abstract.Separator ( Graphics/UI/Gtk/Abstract/Separator.hs, dist/build/Graphics/UI/Gtk/Abstract/Separator.o )\n[ 16 of 209] Compiling Graphics.UI.Gtk.Abstract.Scrollbar ( Graphics/UI/Gtk/Abstract/Scrollbar.hs, dist/build/Graphics/UI/Gtk/Abstract/Scrollbar.o )\n[ 17 of 209] Compiling Graphics.UI.Gtk.Abstract.Scale ( dist/build/Graphics/UI/Gtk/Abstract/Scale.hs, dist/build/Graphics/UI/Gtk/Abstract/Scale.o )\n[ 18 of 209] Compiling Graphics.UI.Gtk.Abstract.Object ( dist/build/Graphics/UI/Gtk/Abstract/Object.hs, dist/build/Graphics/UI/Gtk/Abstract/Object.o )\n[ 19 of 209] Compiling Graphics.UI.Gtk.Abstract.Paned ( dist/build/Graphics/UI/Gtk/Abstract/Paned.hs, dist/build/Graphics/UI/Gtk/Abstract/Paned.o )\n[ 20 of 209] Compiling Graphics.UI.Gtk.General.Structs ( dist/build/Graphics/UI/Gtk/General/Structs.hs, dist/build/Graphics/UI/Gtk/General/Structs.o )\n[ 21 of 209] Compiling Graphics.UI.Gtk.Abstract.Range ( dist/build/Graphics/UI/Gtk/Abstract/Range.hs, dist/build/Graphics/UI/Gtk/Abstract/Range.o )\n[ 22 of 209] Compiling Graphics.UI.Gtk.Embedding.Plug ( dist/build/Graphics/UI/Gtk/Embedding/Plug.hs, dist/build/Graphics/UI/Gtk/Embedding/Plug.o )\n\nGraphics/UI/Gtk/Embedding/Plug.chs:120:6:\n    Couldn't match expected type \u2018Ptr ()\u2019\n                with actual type \u2018Maybe DrawWindow\u2019\n    In the first argument of \u2018gtk_plug_new\u2019, namely\n      \u2018(fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018gtk_plug_new\n         (fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n\nGraphics/UI/Gtk/Embedding/Plug.chs:137:6:\n    Couldn't match expected type \u2018Ptr ()\u2019\n                with actual type \u2018Maybe DrawWindow\u2019\n    In the second argument of \u2018\\ (Display arg1) arg2\n                                 -&gt; withForeignPtr arg1\n                                    $ \\ argPtr1 -&gt; gtk_plug_new_for_display argPtr1 arg2\u2019, namely\n      \u2018(fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018(\\ (Display arg1) arg2\n          -&gt; withForeignPtr arg1\n             $ \\ argPtr1 -&gt; gtk_plug_new_for_display argPtr1 arg2)\n         display\n         (fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n\nGraphics/UI/Gtk/Embedding/Plug.chs:151:3:\n    Couldn't match type \u2018Ptr ()\u2019 with \u2018Maybe DrawWindow\u2019\n    Expected type: IO (Maybe DrawWindow)\n      Actual type: IO (Ptr ())\n    In the second argument of \u2018($)\u2019, namely\n      \u2018(\\ (Plug arg1)\n          -&gt; withForeignPtr arg1 $ \\ argPtr1 -&gt; gtk_plug_get_id argPtr1)\n         (toPlug self)\u2019\n    In the expression:\n      liftM toNativeWindowId\n      $ (\\ (Plug arg1)\n           -&gt; withForeignPtr arg1 $ \\ argPtr1 -&gt; gtk_plug_get_id argPtr1)\n          (toPlug self)\ncabal: Leaving directory '/var/folders/kr/2w9n7xxd6816d0rmgb05cfm00000gn/T/cabal-tmp-31721/gtk-0.14.5'\ncabal: Error: some packages failed to install:\ngtk-0.14.5 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1470998873, "post_id": 38916070, "comment_id": 65189242, "body": "Thanks for you reply. I think you missed a crucial part of the question. I want the lenses to work on the wrapped/extended records, i.e. <code>DownloadObject</code>, <code>FileObject</code>, and <code>UrlObject</code>, NOT <code>Download</code>, <code>File</code>, and <code>Url</code>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1471017286, "post_id": 38916070, "comment_id": 65200802, "body": "Is there any other way to write this without having to write all the lens-related boiler-plate myself (the <code>HasName</code> <code>HasAge</code> etc instances)?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1471017531, "post_id": 38916070, "comment_id": 65200958, "body": "A terrible answer: You could use Template Haskell to automate much of this. The API and documentation for it are hairy, but it is doable. There is no provided way of doing this, by the lens library, as far as I know."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1471017846, "post_id": 38916070, "comment_id": 65201147, "body": "ah... how I miss Ruby meta-programming and Lisp macros!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 2, "last_activity_date": 1471016462, "last_edit_date": 1471016462, "creation_date": 1470998657, "answer_id": 38916070, "question_id": 38914782, "link": "https://stackoverflow.com/questions/38914782/how-to-get-classy-lenses-with-overloaded-field-names/38916070#38916070", "title": "How to get classy lenses with overloaded field names?", "body": "<p>Use <code>makeFields</code> from <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-TH.html\" rel=\"nofollow\"><code>Control.Lens.TH</code></a>:</p>\n\n<pre><code>{-# language\n  TemplateHaskell, MultiParamTypeClasses, FunctionalDependencies, FlexibleInstances #-}\n\nimport Control.Lens\n\ndata Bar a n = Bar {\n  _barAge :: a,\n  _barName :: n\n} deriving Show\n\ndata Foo = Foo {\n  _fooAge  :: Int,\n  _fooName :: String\n} deriving Show\n\nmakeFields ''Bar\nmakeFields ''Foo\n</code></pre>\n\n<p>Now you have the following classes:</p>\n\n<pre><code>class HasName s a | s -&gt; a where\n  name :: Lens' s a\n\nclass HasAge s a | s -&gt; a where\n  age :: Lens' s a\n</code></pre>\n\n<p>and the appropriate instances for <code>Foo</code> and <code>Bar</code>. Example:</p>\n\n<pre><code>&gt; Foo 10 \"foo\" ^. age\n10\n&gt; Bar 10 \"bar\" ^. age\n10\n</code></pre>\n\n\n\n<p>You can then implement the classes for wrapper objects. Example:</p>\n\n<pre><code>data FooWrapper = FooWrapper {\n  _fooWrapperKey :: Int,\n  _fooWrapperFoo :: Foo\n} deriving Show\n\nmakeFields ''FooWrapper\n\ninstance HasName FooWrapper String where\n  name = foo . name\n\ninstance HasAge FooWrapper Int where\n  age = foo . age\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1471016462, "creation_date": 1470994876, "question_id": 38914782, "link": "https://stackoverflow.com/questions/38914782/how-to-get-classy-lenses-with-overloaded-field-names", "title": "How to get classy lenses with overloaded field names?", "body": "<p>I'm trying to build lenses for records which have the same field names. Along with that, I'm trying to \"wrap/extend\" these base records and want the same field names to work for the wrapped/extended records (which, I believe, classy lenses do). How do I get the following to work:</p>\n\n<pre><code>-- Data types for context of the code snippet below\n\ndata Download = Download {\n  userId :: UserId\n  ,gid :: Gid\n  ,logId :: LogId\n  ,parentId :: Maybe DownloadId\n  ,createdAt :: UTCTime\n  ,updatedAt :: UTCTime\n}\n\ndata File = File {\n  downloadId :: DownloadId\n  ,fpath :: String\n  ,len :: Int\n  ,createdAt :: UTCTime\n  ,updatedAt :: UTCTime\n}\n\ndata Url = Url {\n  downloadId :: DownloadId\n  ,fileId :: FileId\n  ,url :: URL\n  ,createdAt :: UTCTime\n  ,updatedAt :: UTCTime\n}\n\ndata DownloadObject = DownloadObject {\n  _key :: DownloadId\n  ,_dbDownload :: Download\n  ,_dbFiles :: [FileObjects]\n}\n\ndata FileObject = FileObject {\n  _key :: FileId\n  ,_dbFile :: File,\n  ,_dbUrls :: [UrlObjects]\n}\n\ndata UrlObject = UrlObject {\n  _key :: UrlId\n  ,_dbUrl :: Url\n}\n\nfetchDownload :: DownloadId -&gt; DownloadObject\n</code></pre>\n\n<p>Given these data types, how do I get the following lenses to work:</p>\n\n<pre><code>dload &lt;- fetchDownload dloadId\ndload ^. key -- of type DownloadId\ndload ^. createdAt -- of type UTCTime\n((dload ^. files) !! 1) ^. key -- of type FileId \n((dload ^. files) !! 1) ^. createdAt -- of type UTCTime\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1471028675, "post_id": 38914535, "comment_id": 65206565, "body": "Wrapping <code>StateT</code> inside <code>StateT</code> will require an awkward combination of lifts to access the correct state. It would be better imo to just use <code>StateT (AppState, EditorState)</code> (or your own data type) so you can use <code>MonadState</code>&#39;s <code>get</code> and such without lifting."}], "answers": [{"comments": [{"owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "edited": false, "score": 0, "creation_date": 1471002581, "post_id": 38915761, "comment_id": 65191471, "body": "It&#39;s you again :) Thanks, I was able to get everything working with your help. I have already used lenses before once but I never actually grasped the concept and I want to take it slower the next time I take a stab at the topic."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 2, "last_activity_date": 1470998298, "last_edit_date": 1470998298, "creation_date": 1470997768, "answer_id": 38915761, "question_id": 38914535, "link": "https://stackoverflow.com/questions/38914535/how-to-kickstart-monad-transformer-stack-from-main/38915761#38915761", "title": "How to kickstart monad transformer stack from main?", "body": "<blockquote>\n  <p>how I can actually kick-start my transformer stack from my main function?</p>\n</blockquote>\n\n<pre><code>main =\n  flip evalStateT initialAppState $\n  flip evalStateT initialEditorState $\n  eventLoop\n  where\n    initialAppState =\n      error \"Define me\"\n    initialEditorState =\n      error \"Define me\"\n</code></pre>\n\n<blockquote>\n  <p>Shouldn't Editor still be part of AppState because modifying it means modifying the overall state?</p>\n</blockquote>\n\n<p>It depends.</p>\n\n<p>Remember that the purpose of Monad Transformer is to extend the functionality in an ad-hoc way? By ad-hoc I mean, without rewriting the existing codebase, but by adding to it. So, if you already have isolated APIs of Editor and AppState, it's easier to just combine them in another \"dome\" module using the transformer stack.</p>\n\n<p>OTOH, from the initial architecture point of view, it totally makes sense that AppState is a data-structure that encompasses Editor (I'd name it EditorState) among other things. In such a cas the API of AppState should encapsulate the API of Editor. The \"lens\" library will help you a lot to work with such composite data-structures (although I must mention that it has a steep learning curve).</p>\n"}], "owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 38915761, "answer_count": 1, "score": 1, "last_activity_date": 1470998298, "creation_date": 1470994061, "last_edit_date": 1495541687, "question_id": 38914535, "link": "https://stackoverflow.com/questions/38914535/how-to-kickstart-monad-transformer-stack-from-main", "title": "How to kickstart monad transformer stack from main?", "body": "<p>this sort of a follow-up question to my previous one: <a href=\"https://stackoverflow.com/questions/38890218/state-and-io-monads/38893468\">State and IO Monads</a></p>\n\n<p>My goal is to create a simple text-editor for files. I already have an <code>Editor</code> component that nicely encapsulates all editing actions on an underlying data structure.</p>\n\n<p>Thanks to the answers to my previous question, I was able to refactor my program so that I now have a nice monad transformer stack:</p>\n\n<pre><code>type Session = StateT AppState (StateT Editor IO)\n</code></pre>\n\n<p><code>AppState</code> holds the global state of the application (currently open file, etc...), while <code>Editor</code> represents the inner state of the editing-component of the app (where the caret is at, etc...). I have a function that is the main driver of the application:</p>\n\n<pre><code>eventLoop :: Session ()\n</code></pre>\n\n<p>So far so good, however now I don't know how I can actually kick-start my transformer stack from my <code>main</code> function? Main has to return something in the <code>IO</code> monad which is at the very base of my stack. My guess is that I have to initialize my <code>AppState</code> and then do something like: </p>\n\n<pre><code>main = do\n  let initialAppState = ...\n  return $ runStateT eventLoop initialAppState\n</code></pre>\n\n<p>But where do I initialize my <code>Editor</code> now?</p>\n\n<p>The main thing confusing me is that before the refactoring, <code>Editor</code> was simply a member of <code>AppState</code>:</p>\n\n<pre><code>data AppState = { editor :: Editor , ... }\n</code></pre>\n\n<p>but now it has moved out of <code>AppState</code> and become somewhat of a sibling on the transformer stack. Shouldn't <code>Editor</code> still be part of <code>AppState</code> because modifying it means modifying the overall state?</p>\n\n<p>How do I properly initialize my <code>Session</code> with both <code>AppState</code> and <code>Editor</code> and then run it from my <code>main</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1470984452, "post_id": 38911523, "comment_id": 65180633, "body": "You need to enable <code>ScopedTypeVariables</code> (and add an explicit forall to the type signature) - otherwise the two type signatures refer to distinct type variables which both happen to be named <code>a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1470984458, "creation_date": 1470984458, "answer_id": 38911597, "question_id": 38911523, "link": "https://stackoverflow.com/questions/38911523/mismatch-of-rigid-type-variables/38911597#38911597", "title": "Mismatch of rigid type variables", "body": "<p>The <code>a</code> in the signature for <code>fn</code> isn't recognized as the same <code>a</code> in the signature for <code>bar</code>. The only way to get this thing to work is with <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow\"><code>ScopedTypeVariables</code></a>.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nbar :: forall a. [Int] -&gt; (a -&gt; Int -&gt; a) -&gt; a -&gt; a\nbar ns fp ap = snd $ foldl fn (fp, ap) ns\n  where fn :: ((a -&gt; Int -&gt; a), a) -&gt; Int -&gt; ((a -&gt; Int -&gt; a), a)\n        fn (f, x) i = (fp, (f x (i + length(ns))))\n</code></pre>\n\n<p>Alternately, you can just not have a type annotation for <code>fn</code> and let the compiler infer it.</p>\n"}], "owner": {"reputation": 73, "user_id": 6689702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cccfb6e2eb8831839e4df09238841223?s=128&d=identicon&r=PG&f=1", "display_name": "Ying YIN", "link": "https://stackoverflow.com/users/6689702/ying-yin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 38911597, "answer_count": 1, "score": 2, "last_activity_date": 1470984458, "creation_date": 1470984178, "question_id": 38911523, "link": "https://stackoverflow.com/questions/38911523/mismatch-of-rigid-type-variables", "title": "Mismatch of rigid type variables", "body": "<p>I have following Haskell code that failed on <code>Couldn't match type \u2018a\u2019 with \u2018a1\u2019</code> error:</p>\n\n<pre><code>bar :: [Int] -&gt; (a -&gt; Int -&gt; a) -&gt; a -&gt; a\nbar ns fp ap = snd $ foldl fn (fp, ap) ns\n  where fn :: ((a -&gt; Int -&gt; a), a) -&gt; Int -&gt; ((a -&gt; Int -&gt; a), a)\n        fn (f, x) i = (fp, (f x (i + length(ns))))\n</code></pre>\n\n<p>Here's the detailed error message:</p>\n\n<pre><code>t.hs:4:24: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018a1\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          bar :: forall a. [Int] -&gt; (a -&gt; Int -&gt; a) -&gt; a -&gt; a\n        at t.hs:1:8\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          fn :: forall a1.\n                (a1 -&gt; Int -&gt; a1, a1) -&gt; Int -&gt; (a1 -&gt; Int -&gt; a1, a1)\n        at t.hs:3:15\n      Expected type: a1 -&gt; Int -&gt; a1\n        Actual type: a -&gt; Int -&gt; a\n    \u2022 In the expression: fp\n      In the expression: (fp, (f x (i + length (ns))))\n      In an equation for \u2018fn\u2019:\n          fn (f, x) i = (fp, (f x (i + length (ns))))\n    \u2022 Relevant bindings include\n        x :: a1 (bound at t.hs:4:16)\n        f :: a1 -&gt; Int -&gt; a1 (bound at t.hs:4:13)\n        fn :: (a1 -&gt; Int -&gt; a1, a1) -&gt; Int -&gt; (a1 -&gt; Int -&gt; a1, a1)\n          (bound at t.hs:4:9)\n        ap :: a (bound at t.hs:2:11)\n        fp :: a -&gt; Int -&gt; a (bound at t.hs:2:8)\n        bar :: [Int] -&gt; (a -&gt; Int -&gt; a) -&gt; a -&gt; a (bound at t.hs:2:1)\n</code></pre>\n\n<p>I was thinking that <strong><code>fp</code></strong> parameter of function <strong><code>bar</code></strong> has the same type of <strong><code>f</code></strong> parameter of function <strong><code>fn</code></strong> in <code>where</code> clause of function <strong><code>bar</code></strong> (they all have type <code>(a -&gt; Int -&gt; a)</code>), however <code>ghci</code> treated them as different  types (<code>a</code> and <code>a1</code>).</p>\n\n<p>I tried to remove type signature of function <strong><code>fn</code></strong> then the code could be compiled successfully.</p>\n\n<pre><code>bar :: [Int] -&gt; (a -&gt; Int -&gt; a) -&gt; a -&gt; a\nbar ns fp ap = snd $ foldl fn (fp, ap) ns\n  where fn (f, x) i = (fp, (f x (i + length(ns))))\n</code></pre>\n\n<p>My question is: Why the extra type signature of <strong><code>fn</code></strong> doesn't work? isn't the type system intelligent enough to infer that both <strong><code>fp</code></strong> and <strong><code>f</code></strong> could have same types? (especially when <strong><code>fn</code></strong> is inside scope of <strong><code>bar</code></strong>).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470952530, "post_id": 38906519, "comment_id": 65171977, "body": "Two things: (1) you aren&#39;t using <code>x</code> in your function (2) Haskell division is a bit different from other languages. If you want an <code>Int</code> output, you&#39;ll  need to use <code>div</code>"}, {"owner": {"reputation": 69, "user_id": 4454161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4534a188f3bfd736909f688c58dc1fe9?s=128&d=identicon&r=PG&f=1", "display_name": "Fergus2k8", "link": "https://stackoverflow.com/users/4454161/fergus2k8"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470953545, "post_id": 38906519, "comment_id": 65172327, "body": "I have this as now as a change   average = sum filNeg div length filNeg - sum filPos div length filPos   Getting this as an error, sorry I&#39;m new to haskell so wrapping my head around this.  PosNeg.hs:10:1:     Equations for \u2018average\u2019 have different numbers of arguments       PosNeg.hs:10:1-15       PosNeg.hs:11:1-69"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1470955860, "post_id": 38906519, "comment_id": 65173046, "body": "@Fergus2k8 The issue isn&#39;t to get rid of the <code>x</code> from the function, it is to use it. It is the argument to your function (the list of <code>Int</code>s), so you should use it."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1470960599, "creation_date": 1470960599, "answer_id": 38907951, "question_id": 38906519, "link": "https://stackoverflow.com/questions/38906519/getting-the-average-of-filtered-positive-negative-numbers-in-haskell/38907951#38907951", "title": "Getting the average of filtered Positive + Negative numbers in Haskell", "body": "<p>For the first error, <code>average</code> cannot return <code>[]</code> on an empty input; it has to return an <code>Int</code>.</p>\n\n<p>The other two errors occur because you are treating <code>filNeg</code> and <code>filPos</code> as lists, not functions that return lists.</p>\n\n<pre><code>average :: [Int] -&gt; Int\naverage [] = 0\naverage x = sum (filNeg x) `div` length (filNeg x) - sum (filPos x) `div` length (filPos x)\n</code></pre>\n\n<p>To use <code>div</code> as an infix operator, you need to enclose it in backquotes.</p>\n"}], "owner": {"reputation": 69, "user_id": 4454161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4534a188f3bfd736909f688c58dc1fe9?s=128&d=identicon&r=PG&f=1", "display_name": "Fergus2k8", "link": "https://stackoverflow.com/users/4454161/fergus2k8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "accepted_answer_id": 38907951, "answer_count": 1, "score": 0, "last_activity_date": 1470960599, "creation_date": 1470951363, "question_id": 38906519, "link": "https://stackoverflow.com/questions/38906519/getting-the-average-of-filtered-positive-negative-numbers-in-haskell", "title": "Getting the average of filtered Positive + Negative numbers in Haskell", "body": "<p>So I'm trying to take in a list of numbers and return the average of the non-negative numbers minus the average of the negative numbers.</p>\n\n<p>This is my attempt at it and I'm not sure if I'm going about this the completely wrong way. If anyone can point me in the right direction, that'd be appreciated.</p>\n\n<pre><code>filNeg :: [Int] -&gt; [Int]\nfilNeg [] = []\nfilNeg xs = filter (&lt;=0) xs\n\nfilPos :: [Int] -&gt; [Int]\nfilPos [] = []\nfilPos xs = filter (&gt;0) xs\n\naverage :: [Int] -&gt; Int\naverage [] = []\naverage x = sum filNeg/length filNeg - sum filPos/length filPos\n</code></pre>\n\n<p>And the errors</p>\n\n<pre><code>PosNeg.hs:10:14:\n    Couldn't match expected type \u2018Int\u2019 with actual type \u2018[t0]\u2019\n    In the expression: []\n    In an equation for \u2018average\u2019: average [] = []\n\nPosNeg.hs:11:17:\n    Couldn't match type \u2018[Int]\u2019 with \u2018Int\u2019\n    Expected type: [Int] -&gt; Int\n\n      Actual type: [Int] -&gt; [Int]\n    In the first argument of \u2018sum\u2019, namely \u2018filNeg\u2019\n    In the first argument of \u2018(/)\u2019, namely \u2018sum filNeg\u2019\n\nPosNeg.hs:11:44:\n    Couldn't match type \u2018[Int]\u2019 with \u2018Int\u2019\n    Expected type: [Int] -&gt; Int\n      Actual type: [Int] -&gt; [Int]\n    In the first argument of \u2018sum\u2019, namely \u2018filPos\u2019\n    In the first argument of \u2018(/)\u2019, namely \u2018sum filPos\u2019\n</code></pre>\n"}, {"tags": ["haskell", "syntax", "operator-precedence", "function-composition"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 8, "creation_date": 1470950805, "post_id": 38905782, "comment_id": 65171276, "body": "Even stronger, function application has a higher priority than <i>anything else</i>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1471007664, "post_id": 38905782, "comment_id": 65194587, "body": "This precedence allows e.g. <code>filter even . map (+5)</code>. Composing partially applied functions is rather idiomatic. Also note that the order of arguments for <code>map,filter,...</code> was picked so to make this convenient."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 12, "last_activity_date": 1470948206, "creation_date": 1470948206, "answer_id": 38905782, "question_id": 38905737, "link": "https://stackoverflow.com/questions/38905737/why-does-function-composition-require-parentheses/38905782#38905782", "title": "Why does function composition require parentheses?", "body": "<p>Function application has a higher priority than composition. </p>\n\n<p><code>strip.pack \"    example     \"</code> is equivalent to <code>strip.(pack \"    example    \")</code>. This is one reason why people use <code>$</code> to \"suppress\" application until after all the functions have been composed:</p>\n\n<pre><code>strip . pack $ \"    example     \"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 2, "last_activity_date": 1470948222, "creation_date": 1470948222, "answer_id": 38905787, "question_id": 38905737, "link": "https://stackoverflow.com/questions/38905737/why-does-function-composition-require-parentheses/38905787#38905787", "title": "Why does function composition require parentheses?", "body": "<p>Function application has an higher precedence over the function composition operator.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 38905782, "answer_count": 2, "score": 9, "last_activity_date": 1470966208, "creation_date": 1470948043, "last_edit_date": 1470966208, "question_id": 38905737, "link": "https://stackoverflow.com/questions/38905737/why-does-function-composition-require-parentheses", "title": "Why does function composition require parentheses?", "body": "<p>Let's say I want to compose <code>Text.pack</code> with <code>Text.strip</code>.</p>\n\n<p><code>:t (.)</code> produces: <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></p>\n\n<p><code>:t (Text.pack)</code> produces: <code>String -&gt; Text</code></p>\n\n<p><code>:t (Text.strip)</code> produces: <code>Text -&gt; Text</code></p>\n\n<p>So substituting <code>strip</code> for <code>(b -&gt; c)</code> gives:\n<code>b = Text</code>\n<code>c = Text</code></p>\n\n<p>Substituting <code>pack</code> for <code>(a -&gt; b)</code> gives:\n<code>a = String</code>\n<code>b = Text</code></p>\n\n<p>Lets verify: <code>:t strip . pack</code> produces:\n<code>strip . pack :: String -&gt; Text</code></p>\n\n<p>ok, great lets try it:</p>\n\n<p><code>strip.pack \"    example     \"</code></p>\n\n<p>Produces:</p>\n\n<pre><code>Couldn't match expected type \u2018a -&gt; Text\u2019 with actual type \u2018Text\u2019\nRelevant bindings include\n  it :: a -&gt; Text (bound at &lt;interactive&gt;:31:1)\nPossible cause: \u2018pack\u2019 is applied to too many arguments\nIn the second argument of \u2018(.)\u2019, namely \u2018pack \"    example     \"\u2019\nIn the expression: strip . pack \"    example     \"\n</code></pre>\n\n<p><code>(strip . pack) \"     example     \"</code> works as expected.... why?</p>\n"}, {"tags": ["haskell", "hunit"], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1470954467, "post_id": 38905713, "comment_id": 65172603, "body": "Thank you, i was wondering what purpose does the bool argument serve?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 1, "creation_date": 1470957165, "post_id": 38905713, "comment_id": 65173432, "body": "It indicates whether or not the message is a &quot;progress&quot; message - I presume like reporting the number of tests currently completed."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1470957923, "post_id": 38905713, "comment_id": 65173645, "body": "Whenever i try to use it, it always turns out to be false. Im not sure why, any ideas?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1470947950, "creation_date": 1470947950, "answer_id": 38905713, "question_id": 38905460, "link": "https://stackoverflow.com/questions/38905460/puttext-in-haskell-hunit/38905713#38905713", "title": "PutText in haskell HUnit", "body": "<p>A PutText value allows you to customize the way to messages generated from running a test are reported.</p>\n\n<p>A simple way to create one is use <code>putTextToHandle stdout True</code> to output messages to standard out. The <code>True</code> parameter means to also emit progress messages.</p>\n\n<p>The PutText protocol allows you to maintain state. This is an example of one that keeps track of the number of messages emitted. The final value\nof this state is also returned by <code>runTestText</code> as the second component\nof the returned tuple.</p>\n\n<pre><code>reportMsg :: String -&gt; Bool -&gt; Int -&gt; IO Int\nreportMsg message isProgress count = do\n  putStrLn $ \"#\" ++ show (count+1) ++ \": \" ++ message\n  return (count+1)\n\nmyPutText = PutText reportMsg 0  :: PutText Int\n</code></pre>\n\n<p>And then you can use it like this:</p>\n\n<pre><code>(testCounts, msgCount) &lt;- runTestText myPutText tests\nputStrLn $ \"Messages emitted: \" ++ show msgCount\n</code></pre>\n\n<p>Here <code>testCounts</code> is a tally of the number of tests which were run / passed / failed / etc. The <code>msgCount</code> is the value returned by the last call to the PutText function.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 38905713, "answer_count": 1, "score": 2, "last_activity_date": 1470947950, "creation_date": 1470946939, "question_id": 38905460, "link": "https://stackoverflow.com/questions/38905460/puttext-in-haskell-hunit", "title": "PutText in haskell HUnit", "body": "<p>I have recently been using the HUnit testing framework to run unit\ntests in haskell.</p>\n\n<p>I came across this function PutText and runTestText which takes\nPutText st as its first argument.</p>\n\n<p>However i am not sure how to use this and would like some help in understanding how to use this?</p>\n"}, {"tags": ["haskell", "optimization", "ghc", "stream-fusion"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 5, "creation_date": 1470948890, "post_id": 38905369, "comment_id": 65170348, "body": "The accepted answer to <a href=\"http://stackoverflow.com/questions/578063/what-is-haskells-stream-fusion\" title=\"what is haskells stream fusion\">stackoverflow.com/questions/578063/&hellip;</a> is about the <code>stream-fusion</code> library, which has not compiled for years. It predates the general use of the <code>text</code> and <code>vector</code> libraries, which do use stream fusion, and do compile, and are fundamental to modern Haskell. The author of the accepted answer seems to be completely ignorant of the existence of these libraries. Read today, the accepted answer is basically disinformation, and anyway does not give the advice asked for above when genuine worthwhile advice really does exist."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470991146, "post_id": 38905369, "comment_id": 65184265, "body": "@Michael I completely disagree with your point of view. The answer is just <b>old</b>. If you think that it would be more useful to have an updated answer to that question just <i>answer it yourself</i> instead of blaming a 7 years old answer."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1470992369, "post_id": 38905369, "comment_id": 65185010, "body": "@Bukuriu I wasn&#39;t objecting to that answer to that question, which was posed then, but to closing this one as a duplicate. Or are you suggesting that  I should add a new answer to a question that was asked seven years ago?"}], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1470991280, "post_id": 38910170, "comment_id": 65184345, "body": "Nitpicking: referential transparecy does <b>not</b> work in <i>any</i> context. Only in contexts where the types of the names are preserved."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1470993237, "post_id": 38910170, "comment_id": 65185559, "body": "Related: <a href=\"https://en.wikipedia.org/wiki/Deforestation_(computer_science)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Deforestation_(computer_science)</a>"}, {"owner": {"reputation": 11941, "user_id": 213323, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5a87311ea4c9950793397f01eb208830?s=128&d=identicon&r=PG", "display_name": "Alxandr", "link": "https://stackoverflow.com/users/213323/alxandr"}, "edited": false, "score": 3, "creation_date": 1510783705, "post_id": 38910170, "comment_id": 81587365, "body": "The fact that this gold star of an answer only has 12 upvotes is sad. This was really informative. Thank you."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11941, "user_id": 213323, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5a87311ea4c9950793397f01eb208830?s=128&d=identicon&r=PG", "display_name": "Alxandr", "link": "https://stackoverflow.com/users/213323/alxandr"}, "edited": false, "score": 4, "creation_date": 1510815518, "post_id": 38910170, "comment_id": 81597501, "body": "@Alxandr that sort of comment is worth much more than upvotes. Glad to know I helped!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 76, "last_activity_date": 1572967092, "last_edit_date": 1572967092, "creation_date": 1470977452, "answer_id": 38910170, "question_id": 38905369, "link": "https://stackoverflow.com/questions/38905369/what-is-fusion-in-haskell/38910170#38910170", "title": "What is fusion in Haskell?", "body": "<p>In general, fusion refers to transformations whose purpose is to get rid of   intermediate data structures. You <em>fuse</em> function calls that result in wasteful memory allocations into something more efficient. This is actually IMO one of the biggest applications of Haskell being pure. And you pretty much don't need to do anything to get it, it comes for free through the GHC compiler.</p>\n\n<h3>Haskell is pure</h3>\n\n<p>Because Haskell is pure, we get this thing called <a href=\"https://wiki.haskell.org/Referential_transparency\" rel=\"noreferrer\">referential transparency</a>, which (from the link), means that \"expression always evaluates to the same result in any context\"<sup>1</sup>. That means that I can do very general program level manipulations without changing what the program will actually output. For example, even without knowing what <code>x</code>, <code>y</code>, <code>z</code> and <code>w</code> are I always know that </p>\n\n<pre><code> ((x ++ y) ++ z) ++ w\n</code></pre>\n\n<p>will evaluate to the same thing as</p>\n\n<pre><code> x ++ (y ++ (z ++ w))\n</code></pre>\n\n<p>yet the second one will in practice involve less memory allocations (since <code>x ++ y</code> requires reallocating whole prefix of the output list). </p>\n\n<h3>Rewrite rules</h3>\n\n<p>In fact, there are a whole lot of this sort of optimization we can do, and, because Haskell is pure, we can basically just move whole expressions around (replacing <code>x</code>, <code>y</code>, <code>z</code>, or <code>w</code> for actual lists or expressions that evaluate to lists in the example above changes nothing). This becomes a pretty mechanical process. </p>\n\n<p>Furthermore, it turns out that you can come up with a lot of equivalences for higher order functions (<a href=\"https://www.mpi-sws.org/~dreyer/tor/papers/wadler.pdf\" rel=\"noreferrer\">Theorems for free!</a>). For example,</p>\n\n<pre><code>map f (map g xs) = map (f . g) xs\n</code></pre>\n\n<p>no matter what <code>f</code>, <code>g</code>, and <code>xs</code> are (the two sides are semantically equal). Yet while the two sides of this equation produce the same value output, the left hand side is always worse in efficiency: it ends up allocating space for an intermediate list <code>map g xs</code>, that is immediately thrown away. We'd like to tell the compiler to, whenever it encounters something like <code>map f (map g xs)</code>, replace it with <code>map (f . g) xs</code>. And, for GHC, that is through <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#rewrite-rules\" rel=\"noreferrer\">rewrite rules</a>:</p>\n\n<pre><code>{-# RULES     \"map/map\"    forall f g xs.  map f (map g xs) = map (f.g) xs #-}\n</code></pre>\n\n<p>The <code>f</code>, <code>g</code>, and <code>xs</code> can be matched against any expressions, not just variables (so something like <code>map (+1) (map (*2) ([1,2] ++ [3,4]))</code> gets transformed into <code>map ((+1) . (*2)) ([1,2] ++ [3,4])</code>. (<a href=\"https://stackoverflow.com/questions/38651602/searching-for-rewrite-rules\">There doesn't appear to be a good way to search for rewrite rules</a>, so I compiled a <a href=\"https://gist.github.com/harpocrates/e95ce275a2220dfbd50b102e1e533556\" rel=\"noreferrer\">list</a>). <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.89.3092&amp;rep=rep1&amp;type=pdf\" rel=\"noreferrer\">This paper</a> explains the motivation and workings of GHC rewrite rules.</p>\n\n<h3>So that's how GHC optimizes <code>map</code>?</h3>\n\n<p>Actually, not quite. The thing above is <a href=\"https://wiki.haskell.org/Short_cut_fusion\" rel=\"noreferrer\">short-cut fusion</a>. The name sort of implies the drawback: it doesn't scale too well and is annoying to debug. You end up having to write a ton of ad-hoc rules for all arrangements of the same common functions. Then, you hope that repeated application of rewrite rules will simplify your expressions nicely.</p>\n\n<p>It turns out that we can do even better in some cases by organizing our re-write rules so that we build up some intermediate normal form and then have  rules targeting that intermediate form. This way, we start getting \"hot\" paths of rewrite rules.</p>\n\n<p>Probably the most advanced of these systems is <a href=\"http://citeseer.ist.psu.edu/viewdoc/download?doi=10.1.1.104.7401&amp;rep=rep1&amp;type=pdf\" rel=\"noreferrer\">stream fusion</a> targeting coinductive sequences (basically lazy sequences like lists). Check out <a href=\"http://community.haskell.org/~duncan/thesis.pdf\" rel=\"noreferrer\">this thesis</a> and <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/ndp/haskell-beats-C.pdf\" rel=\"noreferrer\">this paper</a> (which is actually pretty much how the <a href=\"http://hackage.haskell.org/package/vector\" rel=\"noreferrer\"><code>vector</code></a> package is implemented). For example, in <code>vector</code>, your code gets first transformed into an intermediate form involving <code>Stream</code>s and <code>Bundle</code>s, is optimized in that form, then gets transformed back into vectors.</p>\n\n<h3>And... <code>Data.Text</code>?</h3>\n\n<p><code>Data.Text</code> uses stream fusion to minimize the number of memory allocations that occur (I think this is especially important for the strict variant). If you check out the <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/src/Data-Text.html#pack\" rel=\"noreferrer\">source</a>, you'll see that the functions \"subject to fusion\" actually manipulate <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-Internal-Fusion.html\" rel=\"noreferrer\"><code>Stream</code>s</a> for the most part (they are of the general form <code>unstream . (stuff manipulating stream) . stream</code>) and there are a bunch of <code>RULES</code> pragmas for transforming <code>Stream</code>s. In the end, any combination of these functions is supposed to get fused so that only one allocation needs to occur.</p>\n\n<h3>So, what do I need to take away for my everyday coding?</h3>\n\n<p>The only real way to know when your code is subject to fusion is to have a good understanding of the rewrite rules involved and understand well how GHC works. That said, there is one thing that you <em>should</em> do: try to use non-recursive higher order functions when possible, since these can be (at least for now, but in general will always be more) easily fused.</p>\n\n<h3>Complications</h3>\n\n<p>Because fusion in Haskell occurs through repeated application of rewrite rules, it suffices to convince yourself of each rewrite rule's correctness to know that the whole \"fused\" program does the same thing as your original program does. Except there are edge cases relating to programs terminating. For example, one might think that</p>\n\n<pre><code> reverse (reverse xs) = xs\n</code></pre>\n\n<p>yet that is clearly not true, since <code>head $ reverse (reverse [1..])</code> will not terminate yet <code>head [1..]</code> will. <a href=\"https://wiki.haskell.org/Correctness_of_short_cut_fusion\" rel=\"noreferrer\">More information from the Haskell Wiki</a>.</p>\n\n<hr>\n\n<p><sup>1</sup> This is actually true only provided that in these contexts the expression maintains the same type.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4012, "favorite_count": 11, "accepted_answer_id": 38910170, "answer_count": 1, "score": 37, "last_activity_date": 1572967092, "creation_date": 1470946625, "last_edit_date": 1470965819, "question_id": 38905369, "link": "https://stackoverflow.com/questions/38905369/what-is-fusion-in-haskell", "title": "What is fusion in Haskell?", "body": "<p>Every now and again I have been noticing the following in Haskell documentation:\n(for example in <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html\" rel=\"noreferrer\"><code>Data.Text</code></a>):</p>\n\n<blockquote>\n  <p>Subject to fusion</p>\n</blockquote>\n\n<p>What is <em>fusion</em> and how do I use it?</p>\n"}, {"tags": ["haskell", "monadfix"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1471024209, "post_id": 38904378, "comment_id": 65204344, "body": "What is the purpose of <code>_codeHistory</code>? Because of it <code>Assembler</code> isn&#39;t a monad, because the way <code>_codeHistory</code> is constructed fails the monad laws. Try <code>end &gt;&gt; (end &gt;&gt; end)</code> vs <code>(end &gt;&gt; end) &gt;&gt; end</code>. It probably doesn&#39;t matter for code generation, but still worth fixing."}, {"owner": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1471026911, "post_id": 38904378, "comment_id": 65205702, "body": "I added <code>_codeHistory</code> in order to trace out execution of the bind (<code>&gt;&gt;=</code>) operator. That&#39;s how I discovered the point where the code gets duplicated."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471099633, "post_id": 38924717, "comment_id": 65223565, "body": "I think you actually want <code>[]</code> for <code>Writer</code> or <code>RWS</code>. Its laziness is necessary there. But you may be better off using <code>State</code> to implement the accumulator and <code>Seq</code> for said accumulator."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1471102882, "post_id": 38924717, "comment_id": 65224543, "body": "@dfeuer Why is its laziness needed? The example worked for me with <code>Seq</code> as well."}, {"owner": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "edited": false, "score": 0, "creation_date": 1471117472, "post_id": 38924717, "comment_id": 65228821, "body": "@PetrPudl&#225;k Thanks for the answer, it works now. Is there a way to see the compiler generated code for <code>deriving (Functor, Applicative, Monad, MonadFix)</code>? I&#39;m really curious to see what is the difference that makes it work now and to get better understanding of monadic code."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "edited": false, "score": 0, "creation_date": 1471163213, "post_id": 38924717, "comment_id": 65236071, "body": "@Glaukon It&#39;s <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/deriving.html#newtype-deriving\" rel=\"nofollow noreferrer\">GeneralizedNewtypeDeriving</a>, which just (un)wraps the underlying instance. So just look at the implementation of <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-RWS-Lazy.html\" rel=\"nofollow noreferrer\"><code>RWS</code></a>."}, {"owner": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "edited": false, "score": 0, "creation_date": 1471242308, "post_id": 38924717, "comment_id": 65255057, "body": "@PetrPudl&#225;k Is there a compiler (ghc) switch that would give me compiler generated code for this <code>deriving...</code> construct in human readable form (possibly pretty printed)? Unfortunately, I find Haskell documentation difficult to follow and to understand and the library source code is not much better in that respect."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "edited": false, "score": 0, "creation_date": 1471252274, "post_id": 38924717, "comment_id": 65258704, "body": "@Glaukon I&#39;m not aware of such thing. But as I said, it wouldn&#39;t help you much. For example, the <code>Functor</code> instance will be defined as <code>fmap f (Assembler x) = Assembler (fmap f x)</code> - it just calls the underlying function, adding (un)wrapping the constructor as needed. There is no functionality in it, everything happens in the underlying data type, here <code>RWS</code>. My suggestion would be to start inspecting the three monads separately - <code>Reader</code>, <code>Writer</code> and <code>State</code>, and perhaps as an exercise try to implement them from scratch."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 1, "last_activity_date": 1471028012, "creation_date": 1471028012, "answer_id": 38924717, "question_id": 38904378, "link": "https://stackoverflow.com/questions/38904378/duplicate-edsl-code-generated-with-recursivedo-in-haskell/38924717#38924717", "title": "Duplicate EDSL code generated with RecursiveDo in Haskell", "body": "<p>I believe the problem is that your monad instance is flawed. It looks as if it's supposed to be a <code>State</code> monad, but then the definition of <code>&gt;&gt;=</code> does some manipulations that look more like the <code>Writer</code> monad (using the <code>[]</code> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#t:Last\" rel=\"nofollow\"><code>Last</code></a> monoids). I'm quite sure that at least <code>mfix</code> is incompatible with <code>&gt;&gt;=</code>, but my guess is that even <code>&gt;&gt;=</code> itself might fail monad laws.</p>\n\n<p>I haven't looked for a good counter-example, but instead I can offer you a version that I believe works and that's based on the standard tools available. I'll post only the changed parts, my whole testing code is available <a href=\"https://gist.github.com/ppetr/50e7f3b810d59bbdcf3bef28720d1be0\" rel=\"nofollow\">here</a>:</p>\n\n<pre><code>import Control.Monad.RWS\nimport Control.Monad.Fix (MonadFix(..))\nimport qualified Data.Foldable as F\nimport qualified Data.Sequence as S\nimport Text.Printf (printf)\n\n-- ...\n</code></pre>\n\n<p>The state is the current location and the writer monoid is a sequence of instructions (I used <code>Seq</code> rather than <code>[]</code>, because of the possibly bad performance of <code>++</code> for long lists; you could also use <a href=\"https://hackage.haskell.org/package/dlist-0.8.0.1/docs/Data-DList.html\" rel=\"nofollow\"><code>DList</code></a> if desired):</p>\n\n<pre><code>newtype Assembler a = Assembler (RWS () (S.Seq Instruction) Word16 a)\n    deriving (Functor, Applicative, Monad, MonadFix)\n\n{- Append the list of instructions to the code stream. -}\nappend :: [Instruction] -&gt; Assembler ()\nappend xs = Assembler . rws $ \\_ loc -&gt; ((), loc + (i# . length $ xs), S.fromList xs)\n\nasm :: Assembler () -&gt; AsmState\nasm (Assembler proc) =\n    let (location, code) = execRWS proc () 0\n    in AsmState { _code = F.toList code\n                , _location = A location\n                , _codeHistory = [] -- I just ignored this field ...\n                }\n\ninstance Instructions Assembler where \n    -- all same as before, except\n    label = A &lt;$&gt; Assembler get\n</code></pre>\n\n<p>Now it'd probably make more sense to rename <code>AsmState</code> to something like <code>AsmResult</code>.</p>\n\n<p>Also instead of using <code>Location</code> with partial functions, I'd suggest to use just <code>Word16</code> as I did, or define a newtype that captures just location and then use it in <code>Operand</code>. This makes the code safer and cleaner.</p>\n\n<p>(In any case it'd be good to have a test suite that'd test for issues like this.)</p>\n"}], "owner": {"reputation": 181, "user_id": 4194142, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4caa70e31bd77d2e91d0f819abe682f9?s=128&d=identicon&r=PG&f=1", "display_name": "Glaukon", "link": "https://stackoverflow.com/users/4194142/glaukon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 38924717, "answer_count": 1, "score": 1, "last_activity_date": 1471028012, "creation_date": 1470942737, "last_edit_date": 1470995720, "question_id": 38904378, "link": "https://stackoverflow.com/questions/38904378/duplicate-edsl-code-generated-with-recursivedo-in-haskell", "title": "Duplicate EDSL code generated with RecursiveDo in Haskell", "body": "<p><em>Using ghc v8.0.1, compiled with -O2 flag.</em></p>\n\n<p>I'm having a problem with RecursiveDo (mdo). There are two slightly different functions that should produce the same output, but they don't.</p>\n\n<p>The following function produces the <em>correct</em> output:</p>\n\n<pre><code>proc2 :: Assembler ()\nproc2 = mdo\n    set (R 0) (I 0x5a5a)\n    let r = (R 0)\n    let bits = (I 2)\n    let count = (R 70)\n    set count bits\n    _loop &lt;- label\n    cmp count (I 0)\n    je _end\n    add r r\n    sub count (I 1)\n    jmp _loop\n    _end &lt;- label\n    end\n</code></pre>\n\n<p>The correct output is</p>\n\n<pre><code>0000:&gt; SET (R 0) (I 23130)\n0001:  SET (R 70) (I 2)\n0002:  CMP (R 70) (I 0)\n0003:  JE (A 7)\n0004:  ADD (R 0) (R 0)\n0005:  SUB (R 70) (I 1)\n0006:  JMP (A 2)\n0007:  END\n</code></pre>\n\n<p>The following function produces the <em>incorrect</em> output:</p>\n\n<pre><code>proc1 :: Assembler ()\nproc1 = mdo\n    set (R 0) (I 0x5a5a)\n    shl (R 0) (I 1)\n    end\n\nshl :: (MonadFix m, Instructions m) =&gt; Operand -&gt; Operand -&gt; m ()\nshl r@(R _) bits = mdo\n    let count = (R 70)\n    set count bits\n    repeatN count $ mdo\n        add r r     -- shift left by one\nshl _ _ = undefined\n\nrepeatN :: (MonadFix m, Instructions m) =&gt; Operand -&gt; m a -&gt; m a\nrepeatN n@(R _) body = mdo\n    _loop &lt;- label\n    cmp n (I 0)\n    je _end\n    retval &lt;- body\n    sub n (I 1)\n    jmp _loop\n    _end &lt;- label\n    return retval\nrepeatN _ _ = undefined\n</code></pre>\n\n<p>The incorrect output is</p>\n\n<pre><code>0000:&gt; SET (R 0) (I 23130)\n0001:  SET (R 70) (I 1)\n0002:  CMP (R 70) (I 0)\n\n0003:  JE (A 7)\n0004:  ADD (R 0) (R 0)\n0005:  SUB (R 70) (I 1)\n0006:  JMP (A 2)\n\n0007:  JE (A 7)\n0008:  ADD (R 0) (R 0)\n0009:  SUB (R 70) (I 1)\n000A:  JMP (A 2)\n\n000B:  END\n</code></pre>\n\n<p>The lines from 0007 to 000A are the duplicates of the lines from 0003 to 0006 and (in this particular case) the end result is an infinite loop at 0007.</p>\n\n<p>The code in question implements an EDSL (assembler for the Ting Pen) in Haskell. The output of the program is a machine code for Ting Pen.</p>\n\n<p>I'm using MonadFix to be able to capture forward labels in the assembly language and it is when I use some code combinators that I'm getting incorrect output (some generated code gets duplicated). I have included some tracing code and am able to trace the code generation. There is a point when RecursiveDo mechanism does something that generates duplicate code (see also the output of the program provided below).  </p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE NamedFieldPuns #-}\n{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE MagicHash #-}\n\nmodule TingBugChase1 where\n\nimport Data.Word (Word16)\n\nimport Control.Applicative (Applicative(..))\nimport Control.Monad (liftM, ap, return)\nimport Control.Monad.Fix (MonadFix(..))\nimport Text.Printf (printf)\n\n\ni# :: (Integral a, Num b) =&gt; a -&gt; b\ni# = fromIntegral\n\n-- ================================================================= Assembler\n\ndata Instruction = END\n    | CLEARVER\n    | SET Operand Operand\n    | CMP Operand Operand\n    | AND Operand Operand\n    | OR Operand Operand\n    | NOT Operand\n    | JMP Operand\n    | JE Operand\n    | JNE Operand\n    | JG Operand\n    | JGE Operand\n    | JB Operand\n    | JBE Operand\n    | ADD Operand Operand\n    | SUB Operand Operand\n    | RETURN\n    | CALLID Operand\n    | PLAYOID Operand\n    | PAUSE Operand\n    {- \u2026 -}\n    deriving Show\n\n\ndata AsmState = AsmState\n    { _code :: [Instruction]\n    , _location :: Location\n    , _codeHistory :: [([Instruction],[Instruction])]\n    }\n\ndisasmCode :: [Instruction] -&gt; Int -&gt; [String]\ndisasmCode [] _ = [\"[]\"]\ndisasmCode code pc = map disasm1 $ zip [0..] code\n    where\n        disasm1 :: (Int, Instruction) -&gt; String\n        disasm1 (addr, instr) = printf \"%04X:%s %s\" addr (pointer addr) (show instr)\n        pointer :: Int -&gt; String\n        pointer addr = if addr == i# pc then \"&gt;\" else \" \"\n\ninstance Show AsmState where\n    show (AsmState {..}) = \"AsmState {\" ++\n        unlines\n        [ \"Code:\\n\" ++ unlines (disasmCode _code 0)\n        , \"Location: \" ++ (show _location)\n        , \"History:\\n\" ++ unlines (map disasmHistory _codeHistory)\n        ] ++ \"}\"\n        where\n            disasmHistory (a,b) = \n                unlines $\n                    disasmCode a 0\n                    ++ [\"++\"] ++\n                    disasmCode b 0\n\n\ndata Assembler a = Assembler { runAsm :: AsmState -&gt; (a, AsmState) }\n\n-- https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\n-- Monad (Assembler w)\ninstance Functor Assembler where\n    fmap = liftM\n\ninstance Applicative Assembler where\n    {- move the definition of `return` from the `Monad` instance here -}\n    pure a = Assembler $ \\s -&gt; (a,s)\n    (&lt;*&gt;) = ap\n\ninstance Monad Assembler where\n    return = pure -- redundant since GHC 7.10 due to default impl\n    x &gt;&gt;= fy = Assembler $ \\s -&gt; \n            let \n                (a, sA) = runAsm x s\n                (b, sB) = runAsm (fy a) sA\n            in (b, \n                sB \n                { _code = _code sA ++ _code sB\n                , _location = _location sB\n                , _codeHistory = _codeHistory sB ++ [(_code sA, _code sB)]\n                })\n\ninstance MonadFix Assembler where\n    mfix f = Assembler $ \\s -&gt; \n        let (a, sA) = runAsm (f a) s \n        in (a, sA)\n\n{- Append the list of instructions to the code stream. -}\nappend :: [Instruction] -&gt; Assembler ()\nappend xs = Assembler $ \\s -&gt; \n    ((), s { _code = xs, _location = newLoc $ _location s })\n    where\n        newLoc (A loc) = A $ loc + (i# . length $ xs)\n        newLoc _ = undefined\n\n-- ========================================================= Instructions\n\ndata Operand = \n    R Word16    -- registers\n    | I Word16  -- immediate value (integer)\n    | A Word16  -- address (location)\n    deriving (Eq, Show)\n\ntype Location = Operand\n\n-- Instructions\nclass Instructions m where\n    end :: m ()\n    clearver :: m ()\n    set :: Operand -&gt; Operand -&gt; m ()\n    cmp :: Operand -&gt; Operand -&gt; m ()\n    and :: Operand -&gt; Operand -&gt; m ()\n    or :: Operand -&gt; Operand -&gt; m ()\n    not :: Operand -&gt; m ()\n    jmp :: Location -&gt; m ()\n    je :: Location -&gt; m ()\n    jne :: Location -&gt; m ()\n    jg :: Location -&gt; m ()\n    jge :: Location -&gt; m ()\n    jb :: Location -&gt; m ()\n    jbe :: Location -&gt; m ()\n    add :: Operand -&gt; Operand -&gt; m ()\n    sub :: Operand -&gt; Operand -&gt; m ()\n    ret :: m ()\n    callid :: Operand -&gt; m ()\n    playoid :: Operand -&gt; m ()\n    pause :: Operand -&gt; m ()\n\n    label :: m Location\n\n\n{- Code combinators -}\nrepeatN :: (MonadFix m, Instructions m) =&gt; Operand -&gt; m a -&gt; m a\nrepeatN n@(R _) body = mdo\n    _loop &lt;- label\n    cmp n (I 0)\n    je _end\n    retval &lt;- body\n    sub n (I 1)\n    jmp _loop\n    _end &lt;- label\n    return retval\nrepeatN _ _ = undefined\n\n{- \n    Derived (non-native) instructions, aka macros \n    Scratch registers r70..r79\n-}\nshl :: (MonadFix m, Instructions m) =&gt; Operand -&gt; Operand -&gt; m ()\nshl r@(R _) bits = mdo\n    -- allocate registers\n    let count = (R 70)\n\n    set count bits\n    repeatN count $ mdo\n        add r r     -- shift left by one\nshl _ _ = undefined\n\n\ninstance Instructions Assembler where \n    end = append [END]\n    clearver = append [CLEARVER]\n    set op1 op2 = append [SET op1 op2]\n    cmp op1 op2 = append [CMP op1 op2]\n    and op1 op2 = append [AND op1 op2]\n    or op1 op2 = append [OR op1 op2]\n    not op1 = append [NOT op1]\n\n    jmp op1 = append [JMP op1]\n    je op1 = append [JE op1]\n    jne op1 = append [JNE op1]\n    jg op1 = append [JG op1]\n    jge op1 = append [JGE op1]\n    jb op1 = append [JB op1]\n    jbe op1 = append [JBE op1]\n\n    add op1 op2 = append [ADD op1 op2]\n    sub op1 op2 = append [SUB op1 op2]\n\n    ret = append [RETURN]\n    callid op1 = append [CALLID op1]\n    playoid op1 = append [PLAYOID op1]\n    pause op1 = append [PAUSE op1]\n\n    {- The label function returns the current index of the output stream. -}\n    label = Assembler $ \\s -&gt; (_location s, s { _code = [] })\n\n-- ========================================================= Tests\n\nasm :: Assembler () -&gt; AsmState\nasm proc = snd . runAsm proc $ AsmState \n            { _code = []\n            , _location = A 0\n            , _codeHistory = [] \n            }\n\ndoTest :: Assembler () -&gt; String -&gt; IO ()\ndoTest proc testName = do\n    let ass = asm proc\n    putStrLn testName\n    putStrLn $ show ass\n\nproc1 :: Assembler ()\nproc1 = mdo\n    set (R 0) (I 0x5a5a)\n    shl (R 0) (I 1)\n    end\n\nproc2 :: Assembler ()\nproc2 = mdo\n    set (R 0) (I 0x5a5a)\n    -- allocate registers\n    let r = (R 0)\n    let bits = (I 2)\n    let count = (R 70)\n\n    set count bits\n    _loop &lt;- label\n    cmp count (I 0)\n    je _end\n    add r r\n    sub count (I 1)\n    jmp _loop\n    _end &lt;- label\n    end\n\n-- ========================================================= Main\n\nmain :: IO ()\nmain = do\n    doTest proc1 \"Incorrect Output\"\n    doTest proc2 \"Correct Output\"\n</code></pre>\n\n<p>The output of the program follows.</p>\n\n<p>The Incorrect Output from proc1:</p>\n\n<pre><code>AsmState {Code:\n0000:&gt; SET (R 0) (I 23130)\n0001:  SET (R 70) (I 1)\n0002:  CMP (R 70) (I 0)\n0003:  JE (A 7)\n\n0004:  ADD (R 0) (R 0)\n0005:  SUB (R 70) (I 1)\n0006:  JMP (A 2)\n0007:  JE (A 7)\n0008:  ADD (R 0) (R 0)\n0009:  SUB (R 70) (I 1)\n000A:  JMP (A 2)\n000B:  END\n\nLocation: A 8\nHistory:\n[]\n++\n[]\n\n0000:&gt; JMP (A 2)\n++\n[]\n\n0000:&gt; SUB (R 70) (I 1)\n++\n0000:&gt; JMP (A 2)\n\n0000:&gt; ADD (R 0) (R 0)\n++\n0000:&gt; SUB (R 70) (I 1)\n0001:  JMP (A 2)\n\n0000:&gt; JE (A 7)\n++\n0000:&gt; ADD (R 0) (R 0)\n0001:  SUB (R 70) (I 1)\n0002:  JMP (A 2)\n</code></pre>\n\n<p>This is where the code duplication happens:</p>\n\n<pre><code>0000:&gt; JE (A 7)\n0001:  ADD (R 0) (R 0)\n0002:  SUB (R 70) (I 1)\n0003:  JMP (A 2)\n++\n0000:&gt; JE (A 7)\n0001:  ADD (R 0) (R 0)\n0002:  SUB (R 70) (I 1)\n0003:  JMP (A 2)\n\n0000:&gt; CMP (R 70) (I 0)\n++\n0000:&gt; JE (A 7)\n0001:  ADD (R 0) (R 0)\n0002:  SUB (R 70) (I 1)\n0003:  JMP (A 2)\n0004:  JE (A 7)\n0005:  ADD (R 0) (R 0)\n0006:  SUB (R 70) (I 1)\n0007:  JMP (A 2)\n\n[]\n++\n0000:&gt; CMP (R 70) (I 0)\n0001:  JE (A 7)\n0002:  ADD (R 0) (R 0)\n0003:  SUB (R 70) (I 1)\n0004:  JMP (A 2)\n0005:  JE (A 7)\n0006:  ADD (R 0) (R 0)\n0007:  SUB (R 70) (I 1)\n0008:  JMP (A 2)\n\n0000:&gt; SET (R 70) (I 1)\n++\n0000:&gt; CMP (R 70) (I 0)\n0001:  JE (A 7)\n0002:  ADD (R 0) (R 0)\n0003:  SUB (R 70) (I 1)\n0004:  JMP (A 2)\n0005:  JE (A 7)\n0006:  ADD (R 0) (R 0)\n0007:  SUB (R 70) (I 1)\n0008:  JMP (A 2)\n\n0000:&gt; SET (R 70) (I 1)\n0001:  CMP (R 70) (I 0)\n0002:  JE (A 7)\n0003:  ADD (R 0) (R 0)\n0004:  SUB (R 70) (I 1)\n0005:  JMP (A 2)\n0006:  JE (A 7)\n0007:  ADD (R 0) (R 0)\n0008:  SUB (R 70) (I 1)\n0009:  JMP (A 2)\n++\n0000:&gt; END\n\n0000:&gt; SET (R 0) (I 23130)\n++\n0000:&gt; SET (R 70) (I 1)\n0001:  CMP (R 70) (I 0)\n0002:  JE (A 7)\n0003:  ADD (R 0) (R 0)\n0004:  SUB (R 70) (I 1)\n0005:  JMP (A 2)\n0006:  JE (A 7)\n0007:  ADD (R 0) (R 0)\n0008:  SUB (R 70) (I 1)\n0009:  JMP (A 2)\n000A:  END\n}\n</code></pre>\n\n<p>The Correct Output from proc2:</p>\n\n<pre><code>AsmState {Code:\n0000:&gt; SET (R 0) (I 23130)\n0001:  SET (R 70) (I 2)\n0002:  CMP (R 70) (I 0)\n0003:  JE (A 7)\n0004:  ADD (R 0) (R 0)\n0005:  SUB (R 70) (I 1)\n0006:  JMP (A 2)\n0007:  END\n\nLocation: A 8\nHistory:\n[]\n++\n[]\n\n0000:&gt; JMP (A 2)\n++\n[]\n\n0000:&gt; SUB (R 70) (I 1)\n++\n0000:&gt; JMP (A 2)\n\n0000:&gt; ADD (R 0) (R 0)\n++\n0000:&gt; SUB (R 70) (I 1)\n0001:  JMP (A 2)\n\n0000:&gt; JE (A 7)\n++\n0000:&gt; ADD (R 0) (R 0)\n0001:  SUB (R 70) (I 1)\n0002:  JMP (A 2)\n\n0000:&gt; JE (A 7)\n0001:  ADD (R 0) (R 0)\n0002:  SUB (R 70) (I 1)\n0003:  JMP (A 2)\n++\n0000:&gt; END\n\n0000:&gt; CMP (R 70) (I 0)\n++\n0000:&gt; JE (A 7)\n0001:  ADD (R 0) (R 0)\n0002:  SUB (R 70) (I 1)\n0003:  JMP (A 2)\n0004:  END\n\n[]\n++\n0000:&gt; CMP (R 70) (I 0)\n0001:  JE (A 7)\n0002:  ADD (R 0) (R 0)\n0003:  SUB (R 70) (I 1)\n0004:  JMP (A 2)\n0005:  END\n\n0000:&gt; SET (R 70) (I 2)\n++\n0000:&gt; CMP (R 70) (I 0)\n0001:  JE (A 7)\n0002:  ADD (R 0) (R 0)\n0003:  SUB (R 70) (I 1)\n0004:  JMP (A 2)\n0005:  END\n\n0000:&gt; SET (R 0) (I 23130)\n++\n0000:&gt; SET (R 70) (I 2)\n0001:  CMP (R 70) (I 0)\n0002:  JE (A 7)\n0003:  ADD (R 0) (R 0)\n0004:  SUB (R 70) (I 1)\n0005:  JMP (A 2)\n0006:  END\n}\n</code></pre>\n"}, {"tags": ["haskell", "continuous-integration", "travis-ci", "hunit"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1470941802, "post_id": 38904002, "comment_id": 65166833, "body": "StackOverflow questions should be mostly self-contained; please reduce <code>.travis.yml</code> to something that can actually be posted here."}, {"owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "edited": false, "score": 0, "creation_date": 1470979645, "post_id": 38904002, "comment_id": 65178733, "body": "Can you give the relevant section of the file where you are trying to call Stack in the Travis CI file and the error message you get from that call?"}], "answers": [{"comments": [{"owner": {"reputation": 715, "user_id": 1851450, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9520eeee32f7a52640049266dfc5cf4b?s=128&d=identicon&r=PG", "display_name": "mfaerevaag", "link": "https://stackoverflow.com/users/1851450/mfaerevaag"}, "edited": false, "score": 0, "creation_date": 1525645051, "post_id": 38943257, "comment_id": 87427110, "body": "Thanks for the <code>.travis.yml</code>! If I may ask, why the <code>language: c</code>?"}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 715, "user_id": 1851450, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9520eeee32f7a52640049266dfc5cf4b?s=128&d=identicon&r=PG", "display_name": "mfaerevaag", "link": "https://stackoverflow.com/users/1851450/mfaerevaag"}, "edited": false, "score": 0, "creation_date": 1525657289, "post_id": 38943257, "comment_id": 87429274, "body": "It&#39;s just some kind of lowest common denominator on Travis CI. i.e. minimal dependencies"}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 5, "last_activity_date": 1471185460, "creation_date": 1471185460, "answer_id": 38943257, "question_id": 38904002, "link": "https://stackoverflow.com/questions/38904002/stack-with-travis-ci/38943257#38943257", "title": "Stack with Travis CI", "body": "<p>I've seen this too.</p>\n\n<pre><code>[0K$ travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | \\ tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'\n/home/travis/build.sh: line 45:  tar: command not found\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n\n  0     0    0   607    0     0   7527      0 --:--:-- --:--:-- --:--:--  7527\n\n  0 9223k    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n[31;1mThe command \"curl -L https://www.stackage.org/stack/linux-x86_64\" failed. Retrying, 2 of 3.[0m\n\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n\n  0     0    0   607    0     0   9491      0 --:--:-- --:--:-- --:--:--  9491\n\n[31;1mThe command \"curl -L https://www.stackage.org/stack/linux-x86_64\" failed. Retrying, 3 of 3.[0m\n\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n\n  0     0    0   607    0     0  11999      0 --:--:-- --:--:-- --:--:-- 11999\n\n[31;1mThe command \"curl -L https://www.stackage.org/stack/linux-x86_64\" failed 3 times.\n</code></pre>\n\n<p>It's when <code>curl</code> fails due to some kind of network problem. Restart your build and hope for better luck next time.</p>\n\n<p>In case folks are interested, here is my complete but minimal <code>.travis.yml</code>:</p>\n\n<pre><code>sudo: false\n\nlanguage: c\n\ncache:\n  directories:\n    - ~/.stack\n\naddons:\n  apt:\n    packages:\n      - libgmp-dev\n\nbefore_install:\n  # Download and unpack the stack executable\n  - mkdir -p ~/.local/bin\n  - export PATH=$HOME/.local/bin:$PATH\n  - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'\n\ninstall:\n  - stack --no-terminal --install-ghc test --only-dependencies\n\nscript:\n  - stack --no-terminal test --haddock --no-haddock-deps\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1471185460, "creation_date": 1470941138, "last_edit_date": 1470942069, "question_id": 38904002, "link": "https://stackoverflow.com/questions/38904002/stack-with-travis-ci", "title": "Stack with Travis CI", "body": "<p>I have recently been trying to use travis CI with stack and i have\nbeen running in to some issues.</p>\n\n<p>my .travis.yml file is located in my repo which is here:\n(I used the guide on the stack website)\nA snapshot of my config file is as follows:</p>\n\n<pre><code>sudo: false\n\n# Caching so the next build will be fast too.\ncache:\n  directories:\n  - $HOME/.stack\n\nbefore_install:\n# Download and unpack the stack executable\n- mkdir -p ~/.local/bin\n- export PATH=$HOME/.local/bin:$PATH\n- travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'\n</code></pre>\n\n<p>The tests fail to run when i push them to git, travis CI tries to build my repo, but when i examine the log it says that it cannot find the stack command.</p>\n\n<p>However in my config file I specified for it to install stack.</p>\n\n<p>I am not to sure why this is happening, any help will be appreciated?</p>\n"}, {"tags": ["haskell", "functional-programming", "y-combinator", "fixpoint-combinators"], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1470936901, "last_edit_date": 1495540462, "creation_date": 1470936901, "answer_id": 38902757, "question_id": 38902504, "link": "https://stackoverflow.com/questions/38902504/how-to-use-y-combinator-why-does-this-infinite-recursion-return-9/38902757#38902757", "title": "How to use Y- Combinator; why does this infinite recursion return 9?", "body": "<p>First of all: the <code>fix</code> function you have is a fixed-point combinator <em>implemented with direct recursion</em>. The Y combinator is a <em>particular</em> fixed-point combinator that <em>does not need syntactic recursion</em> so it accomplished the same thing as <code>fix</code> but in a different way.</p>\n\n<p>If you're curious, you can look at <a href=\"https://stackoverflow.com/questions/4273413/y-combinator-in-haskell\">how to implement the Y combinator in Haskell</a> here on SO. It's a bit tricky with static types\u2014it needs a recursive type to work.</p>\n\n<p>As for your second question, the code works thanks to laziness. If you apply <code>(\\ x -&gt; 9)</code> to <em>anything</em>, that thing will never get evaluated. Try this:</p>\n\n<pre><code>\u03bb&gt; (\\ x -&gt; 9) (error \"fail\")\n9\n</code></pre>\n\n<p>This includes the recursive call in the definition of <code>fix</code>. Look at what happens when you replace the outer-most <code>f</code> with <code>(\\ x -&gt; 9)</code> in the definition of <code>fix</code>:</p>\n\n<pre><code>(\\ x -&gt; 9) (fix f)\n</code></pre>\n\n<p>Following exactly the same logic as the version with <code>error</code>, the recursive call <em>never gets evaluated</em> and you just get a <code>9</code> out.</p>\n"}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 38902757, "answer_count": 1, "score": 6, "last_activity_date": 1563167668, "creation_date": 1470935921, "last_edit_date": 1563167668, "question_id": 38902504, "link": "https://stackoverflow.com/questions/38902504/how-to-use-y-combinator-why-does-this-infinite-recursion-return-9", "title": "How to use Y- Combinator; why does this infinite recursion return 9?", "body": "<h1> Y - Combinator </h1>\n\n<p>\nI've been trying to learn about Y - Combinators <em>(an explanation on that would be lovely as well)</em> and came across an example from this <a href=\"https://en.wikipedia.org/wiki/Fixed-point_combinator#Derivation_of_the_Y_combinator\">wiki</a>. An in depth explanation on the subject would be much appreciated in either Haskell or Python. Pleaaase! \n</p>\n\n<h1> Code </h1>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = f (fix f)\n</code></pre>\n\n<h1> Problem </h1>\n\n<p>The function called<code>fix</code> returns <code>9</code> when <code>fix</code> is applied to <code>(\\x -&gt; 9)</code> and I have no clue why; when I follow the stack I visualize <code>f(f ... (fix f) ...)</code>.</p>\n\n<pre><code>&gt;&gt; fix (\\x -&gt; 9)\n&gt;&gt; 9\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1470936947, "post_id": 38898836, "comment_id": 65164144, "body": "It&#39;s impossible to do in a nice way. In your second example, how would map&#39; know that you don&#39;t want a result that is a three element list of functions?  That said, if all types are known some overloading magic can do it."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1470947412, "post_id": 38898836, "comment_id": 65169615, "body": "@augustss I&#39;m trying this out (see my answer below) and I&#39;m running into some problems making my solution work for polymorphic types. Would you care to expand on the &quot;if all types are known&quot; part of your answer?"}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470932634, "post_id": 38901600, "comment_id": 65161941, "body": "Ye, I am doing that right now, but map3 won&#39;t be subject to fusion. Or will it?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470933475, "post_id": 38901600, "comment_id": 65162416, "body": "That would be a good, separate SO question. And perhaps someone will answer with a way to determine if fusion has taken place or not."}, {"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470933837, "post_id": 38901600, "comment_id": 65162597, "body": "Well, if it doesn&#39;t, there is no point to write your own list manipulation functions."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1470934289, "post_id": 38901600, "comment_id": 65162824, "body": "@FordO. That is a bit of a broad statement... Also, what exactly do you mean by fusion? What transformations/rewrites would you like to be seeing? And you could always write Erik&#39;s function using list functions that <i>are</i> subject to fusion. For example, <code>map3 f = snd . foldr (\\a (as,bs) -&gt; case as of { [a2,a1] -&gt; ([],f a1 a2 a : bs); _ -&gt; (a:as,bs) }) ([],[])</code>..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470934292, "post_id": 38901600, "comment_id": 65162826, "body": "Fusion doesn&#39;t happen by default in functions that pattern match on lists directly. The fusion laws are expressed as <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-822\" rel=\"nofollow noreferrer\">rewrite rules</a> which talk about specific GHC functions. You could try to prove your own fusion law (and express it as a rewrite rule yourself), but I somewhat doubt this function can be made to fuse because it looks at more than one element at a time."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470934442, "post_id": 38901600, "comment_id": 65162895, "body": "@BenjaminHodgson Interestingly, the &quot;Stream Fusion&quot; paper mentions towards the end (9.2 Fusing general recursive definitions) the possibility of trying to &quot;fuse general recursive definitions over lists&quot;. I don&#39;t think anything like that ever got implemented though."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470936902, "post_id": 38901600, "comment_id": 65164123, "body": "@Alec Re-reading the paper it seems like the authors are leaving the question open: &quot;It would be interesting to investigate the precise restrictions on the form which can be translated in this way and whether it can be automated&quot;. It seems reasonable to me that not <i>every</i> general-recursive function can be fused"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1470932486, "creation_date": 1470932486, "answer_id": 38901600, "question_id": 38898836, "link": "https://stackoverflow.com/questions/38898836/reduction-of-list-through-partial-application-in-haskell/38901600#38901600", "title": "Reduction of list through partial application in Haskell", "body": "<p>The simplest solution is to just generate a helper function\nfor each arity that you need, e.g. for arity 3 functions:</p>\n\n<pre><code>map3 :: (a -&gt; a -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nmap3 f (x : y : z : rest) = f x y z : map3 f rest\nmap3 f _ = []\n</code></pre>\n\n<p>Put these in a utility module so you can import them as needed.\nIf you want to get sophisticated you can generate them using\nTemplateHaskell, CPP macros, or even type-classes, but be careful\nabout turning this simple exercise into a yak shaving party.</p>\n\n<p>Your example:</p>\n\n<pre><code>interact $ unlines . fmap foo . tuple . lines\n</code></pre>\n\n<p>could then be expressed as:</p>\n\n<pre><code>interact $ unlines . map2 foo . lines\n</code></pre>\n\n<p>assuming that <code>foo</code> has the signature <code>foo :: String -&gt; String -&gt; String</code></p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1471292079, "last_edit_date": 1471292079, "creation_date": 1470945087, "answer_id": 38904989, "question_id": 38898836, "link": "https://stackoverflow.com/questions/38898836/reduction-of-list-through-partial-application-in-haskell/38904989#38904989", "title": "Reduction of list through partial application in Haskell", "body": "<p>I disagree with the spirit of defining something like this, but just for the hasochism of it, I'm trying my hand at it. Here is a solution that works, but only for monomorphic types. I'm working on seeing if I can convert it to something involving type families that also doesn't need to be littered with type annotations.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\n\nclass Consumer f a b where\n  consume :: f -&gt; [a] -&gt; Maybe (b,[a])\n\ninstance {-# OVERLAPPABLE #-} Consumer b a b where\n  consume b xs = Just (b,xs)\n\ninstance {-# OVERLAPPING #-} Consumer f a b =&gt; Consumer (a -&gt; f) a b where\n  consume f [] = Nothing\n  consume f (x:xs) = consume (f x) xs\n\nmap' :: Consumer f a b =&gt; f -&gt; [a] -&gt; [b] \nmap' f xs = case consume f xs of\n                Nothing -&gt; []\n                Just (b,xs') -&gt; b : map' f xs'\n</code></pre>\n\n<p>And testing it out</p>\n\n<pre><code>&gt; map' ((+) :: Int -&gt; Int -&gt; Int) ([1,2,3,4] :: [Int]) :: [Int]\n[3,7]\n&gt; map' (id :: Int -&gt; Int) ([1,2,3,4] :: [Int]) :: [Int]\n[1,2,3,4]\n</code></pre>\n\n<h2>EDIT</h2>\n\n<p>After some thought, I don't think that a better solution is possible (without dependent types). The reason I have to add type annotations everywhere is that I have no way of informing GHC that the two consumer instances I've provided are actually the <em>only</em> instances I will ever want (are closed type classes even a thing?) and I can't etch out functional dependencies. This second problem is also why I can't rewrite this as a type family. On a side note though, annotating the function arguments can look a lot nicer now that we have <code>TypeApplications</code>: <code>map' ((+) @Int) ([1..9] :: [Int])</code>.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1471292079, "creation_date": 1470924831, "last_edit_date": 1470930871, "question_id": 38898836, "link": "https://stackoverflow.com/questions/38898836/reduction-of-list-through-partial-application-in-haskell", "title": "Reduction of list through partial application in Haskell", "body": "<p>Is there some more powerful version of map for functions with multiple arguments? Thus the length of the reduced list would be <code>length of original / number of arguments</code>...</p>\n\n<pre><code>tuple a b = (a, b)\nmap' tuple [1, 2, 3, 4]\n&gt; [(1, 2), (3, 4)]\n\nmul a b c = a * b * c\nmap' mul [1, 2, 3, 4, 5, 6]\n&gt; [3, 120]\n</code></pre>\n\n<p>I tried to write myself one, but it seems impossible to accept function of any number of arguments.</p>\n\n<p>I would like to have generic version for variable number of arguments, because writing one myself every time takes some time and it won't use loop fusion.</p>\n"}, {"tags": ["haskell", "types", "instance", "type-inference"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470917458, "post_id": 38892757, "comment_id": 65150917, "body": "As a general suggestion, in Haskell you should prefer pattern matching to any use of <code>length,head,tail</code>. Especially <code>head,tail</code> should be avoided as much as possible, since they are partial -- they will crash your program on a wrong input. (Exhaustive) pattern matching has no such issue. I&#39;d also recommend using <code>-Wall</code> to report warnings."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 1554530, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b24b0c2f7de4c106a370cb32c28c069a?s=128&d=identicon&r=PG", "display_name": "Phillip", "link": "https://stackoverflow.com/users/1554530/phillip"}, "edited": false, "score": 0, "creation_date": 1470918137, "post_id": 38893850, "comment_id": 65151416, "body": "That&#39;s a comprehensive answer. I will read more about filters. I also understand that I must use the null function to check whether the list is empty. I&#39;ll remember that, I have tried out ` null xs  = []` and its working."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 77, "user_id": 1554530, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b24b0c2f7de4c106a370cb32c28c069a?s=128&d=identicon&r=PG", "display_name": "Phillip", "link": "https://stackoverflow.com/users/1554530/phillip"}, "edited": false, "score": 0, "creation_date": 1470918600, "post_id": 38893850, "comment_id": 65151749, "body": "Yes, except as I said it&#39;s better not to use a separate length-check at all: with a pattern match you combine length-checking and element-extraction to one operation."}, {"owner": {"reputation": 77, "user_id": 1554530, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b24b0c2f7de4c106a370cb32c28c069a?s=128&d=identicon&r=PG", "display_name": "Phillip", "link": "https://stackoverflow.com/users/1554530/phillip"}, "edited": false, "score": 0, "creation_date": 1470919212, "post_id": 38893850, "comment_id": 65152233, "body": "Ok, I&#39;ll remember that too. By the way, Haskell is only part of my study (master Computer Science) so sometimes it&#39;s more interesting to study all kind of constructions."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1470916883, "last_edit_date": 1470916883, "creation_date": 1470911514, "answer_id": 38893850, "question_id": 38892757, "link": "https://stackoverflow.com/questions/38892757/error-cannot-infer-instance/38893850#38893850", "title": "ERROR - Cannot infer instance", "body": "<h2>Always use type signatures</h2>\n\n<p>Evidently, <code>f</code> is a kind of predicate: you apply it to values in the list, and it yields a boolean value. So the type of <code>test</code> is</p>\n\n<pre><code>test :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>BTW the standard name for this is <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:filter\" rel=\"nofollow\"><code>filter</code></a>.</p>\n\n<p>If you're not sure about the signature yourself, you can actually ask GHCi</p>\n\n<pre><code>&gt; :t test\ntest :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>...but I strongly recommend to instead <em>start</em> with the signature: first think about what you want your function to accomplish, then worry about the implementation.</p>\n\n<p>Anyway, so to test the <code>test</code> function, you need to give it an <code>(a -&gt; Bool)</code> function and a list. Is <code>1</code> a function? I daresay not<sup>\u2020</sup>, therefore <code>test 1 [1,2]</code> can't make sense. You probably mean something like <code>test (\\x -&gt; x==1) [1,2]</code>, which can also be written simply <code>test (==1) [1,2]</code>.</p>\n\n<p>A couple of remarks on your code:</p>\n\n<ul>\n<li>You're using guards to check if a list is empty. First of all, to just check if a list is empty, <em>never</em> evaluate its <code>length</code> \u2013 this needs to traverse the entire list. You <em>could</em> use the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:null\" rel=\"nofollow\"><code>null</code></a> function, which does just that \u2013 check if a container is empty ...</li>\n<li><p>... but that still leaves the problem of actually taking a value out of the list. You can indeed take the first value of a nonempty list with <code>head</code>, but this is only safe in a branch where you've first <em>checked</em> that it's nonempty. This is easy to get wrong. A much better solution is to just <em>pattern match</em> on the list head: instead of</p>\n\n<pre><code>test f xs \n  | length xs == 0  = []\n  | f (head xs)     = ...\n</code></pre>\n\n<p>write</p>\n\n<pre><code>test f [] = []\ntest f (x:xs)\n  | f x   = ...\n</code></pre>\n\n<p>This way, you <em>can't</em> mistakenly evaluate the head of an empty list, because the compiler ensures that <code>x</code> is only in scope in a clause that has been checked to be nonempty.</p></li>\n</ul>\n\n<p>Look at <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.List.html#filter\" rel=\"nofollow\">the source code</a> of the standard <code>filter</code> function for final reference.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Actually, <code>1</code> <em>can</em> be a function... number literals are overloaded in Haskell; you could theoretically write</sub></p>\n\n<pre><code>instance Num (Integer -&gt; Bool) where\n  fromInteger n x = x == n\n</code></pre>\n\n<p><sub>and then you can define <code>f = 1 :: Integer -&gt; Bool</code>, and use it for <code>test</code> too. But... this would be a really bad idea; such instances make for very confusing code.</sub></p>\n"}], "owner": {"reputation": 77, "user_id": 1554530, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b24b0c2f7de4c106a370cb32c28c069a?s=128&d=identicon&r=PG", "display_name": "Phillip", "link": "https://stackoverflow.com/users/1554530/phillip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1149, "favorite_count": 0, "accepted_answer_id": 38893850, "answer_count": 1, "score": 1, "last_activity_date": 1470916883, "creation_date": 1470908643, "last_edit_date": 1470908998, "question_id": 38892757, "link": "https://stackoverflow.com/questions/38892757/error-cannot-infer-instance", "title": "ERROR - Cannot infer instance", "body": "<p>I am a beginner in Haskell. I have this function</p>\n\n<pre><code>test f xs \n  | length xs == 0  = []\n  | f (head xs)     = head xs : test f (tail xs)\n  | otherwise       = test f (tail xs)\n</code></pre>\n\n<p>This function should make a list from every element of the list xs which is matching the f value but it gives back an error:</p>\n\n<pre><code>test 1 [1,2]\nERROR - Cannot infer instance\n*** Instance   : Num (a -&gt; Bool)\n*** Expression : test 1 [1,2]\n</code></pre>\n\n<p>This part: </p>\n\n<pre><code>| f (head xs)\n</code></pre>\n\n<p>should be a Bool but is it? Is it working as a filter? How can I make this function work? \nThanks in advance.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 240, "user_id": 1940358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/756366f85834404637bad7c627e0ac9c?s=128&d=identicon&r=PG", "display_name": "thumphries", "link": "https://stackoverflow.com/users/1940358/thumphries"}, "edited": false, "score": 0, "creation_date": 1470902828, "post_id": 38890218, "comment_id": 65141299, "body": "&quot;All of these functions act on an Editor, and many of them return a new Editor (where the caret has been moved or some text has been changed)&quot; --  This is a good thing! It is very unlikely that a plain IO loop applying your original pure functions would produce a new Editor in memory. GHC will copy the structure only when it needs to, and will update in-place if the old reference is not used. You don&#39;t necessarily need to use transformers here, and your code will be clearer without them."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1470909429, "post_id": 38890218, "comment_id": 65145666, "body": "@DeX3 FYI, submitting a <i>self-contained</i> post makes it a lot easier for people to write code to answer your question."}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 0, "last_activity_date": 1470910843, "last_edit_date": 1470910843, "creation_date": 1470910122, "answer_id": 38893354, "question_id": 38890218, "link": "https://stackoverflow.com/questions/38890218/state-and-io-monads/38893354#38893354", "title": "State and IO Monads", "body": "<p>Using <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow\">mtl</a> you won't need to commit to any monad stack in particular until the point of your program where you actually run the effects. This means that you can easily change the stack to add extra layers, pick a different error-reporting strategy, etc., etc.</p>\n\n<p>All you need to do is enable the <code>-XFlexibleContexts</code> language extension by adding the following line at the top of your file:</p>\n\n<pre><code> {-# LANGUAGE FlexibleContexts #-}\n</code></pre>\n\n<p>Import the module defining the <code>MonadState</code> class:</p>\n\n<pre><code>import Control.Monad.State\n</code></pre>\n\n<p>Change the type annotation of your programs to reflect the fact that you are now using this approach. The <code>MonadState Editor m =&gt;</code> constraints says that <code>m</code> is a monad which has a state of type <code>Editor</code> somewhere in it.</p>\n\n<pre><code>lineAt'      :: MonadState Editor m =&gt; Int -&gt; m Line\ncurrentY'    :: MonadState Editor m =&gt; m Int\ncurrentLine' :: MonadState Editor m =&gt; m Line\n</code></pre>\n\n<p>Let's say that you now want to read a line from <code>stdin</code> and push it onto the list of lines (in practice you'd probably want to insert the characters after the current carret and move it accordingly but the general idea is the same). You can simply use the <code>MonadIO</code> constraint to indicate that you need some <code>IO</code> capability for this function:</p>\n\n<pre><code>newLine :: (MonadIO m, MonadState Editor m) =&gt; m ()\nnewLine = do\n  nl &lt;- liftIO getLine\n  modify $ \\ ed -&gt; ed { lines = nl : lines ed }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "edited": false, "score": 0, "creation_date": 1470912837, "post_id": 38893468, "comment_id": 65147870, "body": "Alright, that helped a great deal. I understood steps 1 &amp; 2 and cleaned up my code accordingly. However I&#39;m still a little confused by how it all comes together at the end. As a starting point, what exactly does the type signature <code>moveHorizontally :: Monad m =&gt; Int -&gt; StateT A.Editor m ()</code> convey?   <code>moveHorizontally</code> is a function taking an <code>Int</code> and returning a StateTransformer where the state is an <code>A.Editor</code> and the immediate return value is some <code>Monad</code> holding the empty type (because <code>moveHorizontally</code> just modifies state but doesn&#39;t have any immediate result)? Is that right?"}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "edited": false, "score": 0, "creation_date": 1470914703, "post_id": 38893468, "comment_id": 65149050, "body": "You are confusing <code>StateT a m b</code> with <code>State a (m b)</code>. They are different things. <code>State a b</code> is equivalent to the <code>a -&gt; (b, a)</code> function. So, <code>State a (m b)</code> is equivalent this function: <code>a -&gt; (m b, a)</code>. <code>StateT a m b</code>, on the other hand, is equivalent to <code>a -&gt; m (b, a)</code>. <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-State-Strict.html#t:StateT\" rel=\"nofollow noreferrer\">The Hackage documentation</a> should help you clear things out a bit. Also I have <a href=\"https://nikita-volkov.github.io/a-taste-of-state-parsers-are-easy/\" rel=\"nofollow noreferrer\">an article training the intuition into <code>State</code></a> using parsers."}, {"owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "edited": false, "score": 0, "creation_date": 1470921172, "post_id": 38893468, "comment_id": 65153649, "body": "yep, you&#39;re right - I confused <code>State</code> with <code>StateT</code> there. Thanks for your explanation."}, {"owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "edited": false, "score": 0, "creation_date": 1470921425, "post_id": 38893468, "comment_id": 65153851, "body": "If I understand correctly, <code>Session</code> is basically a &quot;bigger&quot; Application State, right? What if I wanted to add more stateful properties to it that are not really suitable for putting them into the <code>Editor</code> (for example, some counter that keeps track of how many times the user has pressed a key or something similar)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470940339, "post_id": 38893468, "comment_id": 65165985, "body": "<code>mtl</code>&#39;s <code>MonadIO</code> class has relatively little ambiguity potential, since <code>IO</code> is <i>always</i> at the bottom. It&#39;s a very convenient class as well."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470941222, "post_id": 38893468, "comment_id": 65166484, "body": "@dfeuer It&#39;s not from &quot;mtl&quot;, though, but from &quot;transformers&quot;. Also, AFAIK it made it to the &quot;base&quot; package recently. &quot;mtl&quot; does export a class, which I find very useful - <code>MonadError</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470941726, "post_id": 38893468, "comment_id": 65166782, "body": "Oh, you&#39;re right! It felt so <code>mtl</code>-ish that I figured it was. Sorry &#39;bout that."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 5, "last_activity_date": 1470925851, "last_edit_date": 1470925851, "creation_date": 1470910444, "answer_id": 38893468, "question_id": 38890218, "link": "https://stackoverflow.com/questions/38890218/state-and-io-monads/38893468#38893468", "title": "State and IO Monads", "body": "<p>First, let's back up a bit. It's always best to have problems isolated. Let pure functions be grouped with pure functions, State - with State and IO - with IO. Intertwining multiple concepts is a certain recipe for cooking code-spaghetti. You don't want that meal.</p>\n\n<p>Having said that, let's restore the pure functions that you had and group them in a module. However we'll apply small modifications to make them conform to the Haskell conventions - namely, we'll change the parameter order:</p>\n\n<pre><code>-- |\n-- In this module we provide all the essential functions for \n-- manipulation of the Editor type.\nmodule MyLib.Editor where\n\ndata Editor = ...\n\nlineAt :: Int -&gt; Editor -&gt; Line\n\nmoveHorizontally :: Int -&gt; Editor -&gt; Editor\n</code></pre>\n\n<p>Now, if you really want to get your <code>State</code> API back, it's trivial to implement in another module:</p>\n\n<pre><code>-- |\n-- In this module we address the State monad.\nmodule MyLib.State where\n\nimport qualified MyLib.Editor as A\n\nlineAt :: Int -&gt; State A.Editor Line\nlineAt at = gets (A.lineAt at)\n\nmoveHorizontally :: Int -&gt; State A.Editor ()\nmoveHorizontally by = modify (A.moveHorizontally by)\n</code></pre>\n\n<p>As you see now, following the standard conventions allows us to use the standard <code>State</code> utilities like <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-State-Strict.html#v:gets\" rel=\"nofollow\"><code>gets</code></a> and <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-State-Strict.html#v:modify\" rel=\"nofollow\"><code>modify</code></a> to trivially lift the already implemented functions to the <code>State</code> monad.</p>\n\n<p>However, actually the mentioned utilities work for the <code>StateT</code> monad-transformer as well, of which <code>State</code> is actually just a special case. So we can just as well implement the same thing in a more general way:</p>\n\n<pre><code>-- |\n-- In this module we address the StateT monad-transformer.\nmodule MyLib.StateT where\n\nimport qualified MyLib.Editor as A\n\nlineAt :: Monad m =&gt; Int -&gt; StateT A.Editor m Line\nlineAt at = gets (A.lineAt at)\n\nmoveHorizontally :: Monad m =&gt; Int -&gt; StateT A.Editor m ()\nmoveHorizontally by = modify (A.moveHorizontally by)\n</code></pre>\n\n<p>As you see, all that's changed are the type signatures.</p>\n\n<p>Now you can use those general functions in your transformer stack. E.g.,</p>\n\n<pre><code>-- |\n-- In this module we address the problems of the transformer stack.\nmodule MyLib.Session where\n\nimport qualified MyLib.Editor as A\nimport qualified MyLib.StateT as B\n\n-- | Your trasformer stack\ntype Session = StateT A.Editor IO\n\nrunSession :: Session a -&gt; A.Editor -&gt; IO (a, A.Editor)\nrunSession = runStateT\n\nlineAt :: Int -&gt; Session Line\nlineAt = B.lineAt\n\nmoveHorizontally :: Int -&gt; Session ()\nmoveHorizontally = B.moveHorizontally\n\n-- |\n-- A function to lift the IO computation into our stack.\n-- Luckily for us it is already presented by the MonadIO type-class.\n-- liftIO :: IO a -&gt; Session a\n</code></pre>\n\n<p>Thus we've just achieved a granular isolation of concerns and a great flexibility of our codebase.</p>\n\n<p>Now, of course, this makes a quite primitive example so far. Usually the final monad-transformer stack has more levels. E.g.,</p>\n\n<pre><code>type Session = ExceptT Text (ReaderT Database (StateT A.Editor IO))\n</code></pre>\n\n<p>To jump between all those levels the typical tool-set is <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow\">the <code>lift</code> function</a> or <a href=\"http://hackage.haskell.org/package/mtl\" rel=\"nofollow\">the \"mtl\" library</a>, which provides type-classes to reduce the usage of <code>lift</code>. I have to mention though, that not everyone (myself including) is a fan of \"mtl\", because, while reducing the amount of code it introduces a certain ambiguity and reasoning complexity. I prefer to use <code>lift</code> explicitly.</p>\n\n<p>The point of transformers is to allow you to extend an existing monad (transformer stack is a monad as well) with some new functionality in an ad-hoc way. </p>\n\n<p>As for your question about extending the app's state, you can simply add another StateT layer to your stack:</p>\n\n<pre><code>-- |\n-- In this module we address the problems of the transformer stack.\nmodule MyLib.Session where\n\nimport qualified MyLib.Editor as A\n-- In presence of competing modules,\n-- it's best to rename StateT to the more specific EditorStateT\nimport qualified MyLib.EditorStateT as B\nimport qualified MyLib.CounterStateT as C\n\n-- | Your trasformer stack\ntype Session = StateT Int (StateT A.Editor IO)\n\nlineAt :: Int -&gt; Session Line\nlineAt = lift B.lineAt\n\nmoveHorizontally :: Int -&gt; Session ()\nmoveHorizontally = lift B.moveHorizontally\n\n-- | An example of addressing a different level of the stack.\nincCounter :: Session ()\nincCounter = C.inc\n\n-- | An example of how you can dive deeply into your stack.\nliftIO :: IO a -&gt; Session a\nliftIO io = lift (lift io)\n</code></pre>\n"}], "owner": {"reputation": 4287, "user_id": 337591, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4fc8d7b5d4a1670849dda629266e3997?s=128&d=identicon&r=PG", "display_name": "DeX3", "link": "https://stackoverflow.com/users/337591/dex3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 0, "accepted_answer_id": 38893468, "answer_count": 2, "score": 8, "last_activity_date": 1470925851, "creation_date": 1470901315, "question_id": 38890218, "link": "https://stackoverflow.com/questions/38890218/state-and-io-monads", "title": "State and IO Monads", "body": "<p>I've been trying to wrap my head around the concept of monads and I've been experimenting with the following example:</p>\n\n<p>I have an <code>Editor</code> data-type that represents the state of a text document and some functions that work on it.</p>\n\n<pre><code>data Editor = Editor {\n  lines :: [Line],    -- editor contents are kept line by line      \n  lineCount :: Int,   -- holds length lines at all times\n  caret :: Caret      -- the current caret position\n  -- ... some more definitions\n} deriving (Show)\n\n-- get the line at the given position (first line is at 0)\nlineAt :: Editor -&gt; Int -&gt; Line\nlineAt ed n = ls !! n\n  where\n    ls = lines ed\n\n-- get the line that the caret is currently on\ncurrentLine :: Editor -&gt; Line\ncurrentLine ed = lineAt ed $ currentY ed\n\n-- move the caret horizontally by the specified amount of characters (can not\n-- go beyond the current line)\nmoveHorizontally :: Editor -&gt; Int -&gt; Editor\nmoveHorizontally ed n = ed { caret = newPos }\n  where\n    Caret x y = caret ed\n    l = currentLine ed\n    mx = fromIntegral (L.length l - 1)\n    newX = clamp 0 mx (x+n)\n    newPos = Caret newX y\n\n\n-- ... and lots more functions to work with an Editor\n</code></pre>\n\n<p>All of these functions act on an <code>Editor</code>, and many of them return a new <code>Editor</code> (where the caret has been moved or some text has been changed) so I thought this might be a good application of the <code>State</code> monad and I have re-written most <code>Editor</code>-functions to now look like this:</p>\n\n<pre><code>lineAt' :: Int -&gt; State Editor Line\nlineAt' n = state $ \\ed -&gt; (lines ed !! n, ed)\n\ncurrentLine' :: State Editor Line\ncurrentLine' = do\n  y &lt;- currentY'\n  lineAt' y\n\nmoveHorizontally' :: Int -&gt; State Editor ()\nmoveHorizontally' n = do\n  (Caret x y) &lt;- gets caret\n  l &lt;- currentLine'\n  let mx = fromIntegral (L.length l - 1)\n  let newX = clamp 0 mx (x+n)\n  modify (\\ed -&gt; ed { caret = Caret newX y })\n\nmoveHorizontally' :: Int -&gt; State Editor ()\nmoveHorizontally' n = do\n  (Caret x y) &lt;- gets caret\n  l &lt;- currentLine'\n  let mx = fromIntegral (L.length l - 1)\n  let newX = clamp 0 mx (x+n)\n  modify (\\ed -&gt; ed { caret = Caret newX y })\n</code></pre>\n\n<p>This is pretty awesome, because it allows me to compose editing actions very easily within <code>do</code>-notation.</p>\n\n<p>However, now I'm struggling to put this to use within an actual application. Say I want to use this <code>Editor</code> within an application that performs some IO. Say I want to manipulate an instance of <code>Editor</code> everytime the user presses the <code>l</code> key on the keyboard.</p>\n\n<p>I would need to have another <code>State</code> monad representing the overall application state that holds an <code>Editor</code> instance and a sort-of event-loop that uses the <code>IO</code> monad to read from the keyboard and calls <code>moveHorizontally'</code> to modify the current AppState by modifying its <code>Editor</code>.</p>\n\n<p>I've read up a bit on this topic and it seems like I need to use <strong>Monad Transformers</strong> to build a stack of monads with IO at the bottom. I've never used Monad Transformers before and I don't know what to do from here? I've also found out that the <code>State</code> monad already implements some functionality (it seems to be a special case of a Monad Transformer?) but I'm confused on how to use that?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1470888479, "post_id": 38887053, "comment_id": 65134727, "body": "The second <code>let</code> is overriding the first one."}], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 7, "last_activity_date": 1470892057, "creation_date": 1470892057, "answer_id": 38887659, "question_id": 38887053, "link": "https://stackoverflow.com/questions/38887053/haskell-patterns-code-failing-with-error-non-exhaustive-patterns-in-function/38887659#38887659", "title": "Haskell patterns code failing with error &quot;Non-exhaustive patterns in function&quot;", "body": "<p>Your second <code>let</code> is defining a new <code>double</code>. You can define multi-line functions in GHCi like this.</p>\n\n<pre><code>\u03bb :{\n| let\n| double :: Num a =&gt; [a] -&gt; [a]\n| double [] = []\n| double (x:xs) = 2 * x : double xs\n| :}\n\u03bb double [1,2,3]\n[2,4,6]\n</code></pre>\n\n<p>Note, this is equivalent to <code>map (2*)</code> though.</p>\n"}], "owner": {"reputation": 11333, "user_id": 819742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39e2199f9782b9b9abab588071c20e68?s=128&d=identicon&r=PG", "display_name": "randominstanceOfLivingThing", "link": "https://stackoverflow.com/users/819742/randominstanceoflivingthing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 38887659, "answer_count": 1, "score": 1, "last_activity_date": 1470892057, "creation_date": 1470888047, "question_id": 38887053, "link": "https://stackoverflow.com/questions/38887053/haskell-patterns-code-failing-with-error-non-exhaustive-patterns-in-function", "title": "Haskell patterns code failing with error &quot;Non-exhaustive patterns in function&quot;", "body": "<p>I am using ghci. I have a simple function that double's every element in a list. When I tried pattern matching it double's the elements in list but eventually fails with error below:</p>\n\n<pre><code>*Main&gt; let double [] = []\n*Main&gt; let double (x:xs) = (2*x) : double xs\n*Main&gt; double [10,2,0,5]\n[20,4,0,10*** Exception: &lt;interactive&gt;:52:5-37: Non-exhaustive patterns in function double\n</code></pre>\n\n<p>I got the same function working with guards and patterns. Not sure what I am doing wrong when using patterns alone. Please advise.</p>\n\n<pre><code>*Main&gt; let double (x:xs) | null xs  = [2* x] | otherwise = (2*x) : (double xs)\n*Main&gt; double [10,2,0,5]\n[20,4,0,10]\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470881836, "post_id": 38886002, "comment_id": 65133040, "body": "Btw - entering in multi-line statements in ghci is a pain. I usually use an editor window side-by-side to the console window running ghci. Invoke ghci with <code>ghci program.hs</code>. Use <code>:r</code> to reload <code>program.hs</code>  after you change it in the editor. Also have a look at the <code>:e</code>  and the <code>:set editor</code> commands. Also see the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#loading-source-files\" rel=\"nofollow noreferrer\"><b>Loading source files</b></a> in the GHCi manual."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1470882174, "post_id": 38886002, "comment_id": 65133111, "body": "A common source of multiline functions is reinventing the wheel: <code>let removeOdds = filter even</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11333, "user_id": 819742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39e2199f9782b9b9abab588071c20e68?s=128&d=identicon&r=PG", "display_name": "randominstanceOfLivingThing", "link": "https://stackoverflow.com/users/819742/randominstanceoflivingthing"}, "edited": false, "score": 0, "creation_date": 1470882120, "post_id": 38886100, "comment_id": 65133102, "body": "Prelude&gt; mod (head [10,20,30])/2  &lt;interactive&gt;:153:1:     Non type-variable argument in the constraint: Fractional (a -&gt; a)     (Use FlexibleContexts to permit this)     When checking that \u2018it\u2019 has the inferred type       it :: forall a. (Fractional (a -&gt; a), Integral a) =&gt; a -&gt; a"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1470882242, "last_edit_date": 1470882242, "creation_date": 1470880429, "answer_id": 38886100, "question_id": 38886002, "link": "https://stackoverflow.com/questions/38886002/getting-multiline-haskell-function-to-work-in-ghci/38886100#38886100", "title": "Getting Multiline haskell function to work in ghci", "body": "<p>Your <code>if</code> statement needs to be indented at least one more space:</p>\n\n<pre><code>Prelude&gt; let removeOdds nums =\nPrelude|      if null nums\n\nComplete example:\n\nPrelude&gt; let removeOdds nums =\nPrelude|      if null nums\nPrelude|      then []\nPrelude|      else\nPrelude|          if (mod (head nums) 2) == 0\nPrelude|          then (head nums) : (removeOdds(tail nums))\nPrelude|          else removeOdds(tail nums)\nPrelude|\nPrelude&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 1, "last_activity_date": 1470881380, "creation_date": 1470881380, "answer_id": 38886221, "question_id": 38886002, "link": "https://stackoverflow.com/questions/38886002/getting-multiline-haskell-function-to-work-in-ghci/38886221#38886221", "title": "Getting Multiline haskell function to work in ghci", "body": "<p>It may also be good to note that when you aren't in the REPL and therefore don't require <code>let</code>, then you don't need so much indentation:</p>\n\n<pre><code>removeOdds nums =\n  if null nums\n  then []\n  else\n    if (mod (head nums) 2) == 0\n    then (head nums) : (removeOdds(tail nums))\n    else removeOdds(tail nums)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 2, "last_activity_date": 1470892512, "creation_date": 1470892512, "answer_id": 38887740, "question_id": 38886002, "link": "https://stackoverflow.com/questions/38886002/getting-multiline-haskell-function-to-work-in-ghci/38887740#38887740", "title": "Getting Multiline haskell function to work in ghci", "body": "<p>I use curly braces in GHCi when defining multiline functions. They allow you to just paste in a big block of Haskell code like you would usually write.</p>\n\n<pre><code>\u03bb :{\n| let\n| -- type or paste here, e.g.,\n| removeOdds :: Integral a =&gt; [a] -&gt; [a]\n| removeOdds nums =\n|   if null nums\n|   then []\n|   else -- ...\n| :}\n\u03bb removeOdds [1,2,3,4]\n[2,4]\n</code></pre>\n"}], "owner": {"reputation": 11333, "user_id": 819742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39e2199f9782b9b9abab588071c20e68?s=128&d=identicon&r=PG", "display_name": "randominstanceOfLivingThing", "link": "https://stackoverflow.com/users/819742/randominstanceoflivingthing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 619, "favorite_count": 2, "accepted_answer_id": 38886100, "answer_count": 3, "score": 2, "last_activity_date": 1470892512, "creation_date": 1470879544, "question_id": 38886002, "link": "https://stackoverflow.com/questions/38886002/getting-multiline-haskell-function-to-work-in-ghci", "title": "Getting Multiline haskell function to work in ghci", "body": "<p>I created this haskell function to remove odd numbers from a list and was trying in ghci. I keep getting the error below though I have enabled the multiline mode and used 4 spaces for indentation. </p>\n\n<pre><code>Prelude&gt; :set +m\nPrelude&gt; let removeOdds nums =\nPrelude|     if null nums\nPrelude|     then []\nPrelude|     else\nPrelude|         if (mod (head nums)/2) == 0\nPrelude|         then (head nums) : (removeOdds(tail nums))\nPrelude|         else removeOdds(tail nums)\nPrelude| \n</code></pre>\n\n<p>:11:5:\n    parse error (possibly incorrect indentation or mismatched brackets)</p>\n\n<p>I read <a href=\"https://wiki.haskell.org/Common_Misunderstandings#Guards\" rel=\"nofollow\">this</a> page about the common mistable newbie's will make and I changed my code as below</p>\n\n<pre><code>Prelude&gt; let removeOdds nums =\nPrelude|     do if null nums\nPrelude|         then []    \nPrelude|         else \nPrelude|           do if mod((head nums)/2) == 0\nPrelude|               then head nums: removeOdds(tail nums)   \nPrelude|               else removeOdds(tail nums)\nPrelude| \n\n&lt;interactive&gt;:47:5:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Now I ended with a new error. It appears the indentation is a tough thing to get around in haskell. </p>\n"}]