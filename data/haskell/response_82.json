[{"tags": ["haskell", "types", "ghc", "forall"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1470266210, "post_id": 38754779, "comment_id": 64883993, "body": "Maybe relevant: <a href=\"http://stackoverflow.com/a/38653526/3234959\">stackoverflow.com/a/38653526/3234959</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470280899, "post_id": 38754779, "comment_id": 64888386, "body": "By the way, have you looked at the <code>reflection</code> package? This smells like something it might be good for."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470295716, "post_id": 38755202, "comment_id": 64893960, "body": "IIRC, this makes <code>convert</code> monomorphic: you can&#39;t use it on both GBP and USD at the same time. To get the full polytype one needs to something like <code>do c &lt;- getConvert ; let { convert :: forall ... ; convert = getEr c } ; print (convert ...)</code>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470304874, "post_id": 38755202, "comment_id": 64900074, "body": "@chi With <code>NoMonomorphismRestriction</code> you can just do <code>let convert = getER c</code>"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1470266833, "creation_date": 1470266833, "answer_id": 38755202, "question_id": 38754779, "link": "https://stackoverflow.com/questions/38754779/scopedtypevariables-and-rankntypes-with-ghc-typelits/38755202#38755202", "title": "ScopedTypeVariables and RankNTypes with GHC.TypeLits", "body": "<p><code>ImpredicativeTypes</code> <s>don't</s> <em>can't</em> really work right; avoid them. Instead of using <code>IO (forall a. b. ...)</code> you can wrap the exchange rate conversion table in a <code>data</code> type that preserves its polymorphic type.</p>\n\n<pre><code>data ExchangeRates = ExchangeRates {\n    getER :: forall a b. (KnownSymbol a, KnownSymbol b) =&gt; Currency a -&gt; Currency b\n}\n</code></pre>\n\n<p>and return an <code>IO ExchangeRates</code> instead</p>\n\n<pre><code>-- getConvert :: IO (forall a b. (KnownSymbol a, KnownSymbol b) =&gt; Currency a -&gt; Currency b)\ngetConvert    :: IO ExchangeRates\ngetConvert = return (ExchangeRates convert)\n</code></pre>\n\n<p>And use it almost as you expected. Notice the parenthesis to group the <code>:: USD</code> type signature with the converted value.</p>\n\n<pre><code>main = do\n    convert &lt;- getER &lt;$&gt; getConvert\n    print $ (convert (gbp 10) :: USD)\n</code></pre>\n"}], "owner": {"reputation": 1200, "user_id": 2501758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85bc622278325facbdf1e8b7cb1e7250?s=128&d=identicon&r=PG", "display_name": "Tuomas Laakkonen", "link": "https://stackoverflow.com/users/2501758/tuomas-laakkonen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 38755202, "answer_count": 1, "score": 1, "last_activity_date": 1470266833, "creation_date": 1470263920, "question_id": 38754779, "link": "https://stackoverflow.com/questions/38754779/scopedtypevariables-and-rankntypes-with-ghc-typelits", "title": "ScopedTypeVariables and RankNTypes with GHC.TypeLits", "body": "<p>I'm trying to use <code>DataKinds</code> along with type-level literals to make a type safe currency conversion library. So far I have defined these data types:</p>\n\n<pre><code>data Currency (s :: Symbol) = Currency Double\n    deriving Show\n\ntype USD = Currency \"usd\"\ntype GBP = Currency \"gbp\"\n\nusd :: Double -&gt; USD\nusd = Currency\n\ngbp :: Double -&gt; GBP\ngbp = Currency\n\ndata SProxy (s :: Symbol) = SProxy\n</code></pre>\n\n<p>Along with a function that allows me to convert between them:</p>\n\n<pre><code>convert :: forall a b. (KnownSymbol a, KnownSymbol b) =&gt; Currency a -&gt; Currency b\nconvert (Currency a) = case (symbolVal (SProxy :: SProxy a), \n                             symbolVal (SProxy :: SProxy b)) of\n          (\"usd\", \"gbp\") -&gt; Currency (a * 0.75)\n          (\"gbp\", \"usd\") -&gt; Currency (a * 1.33)\n</code></pre>\n\n<p>Here, I have used <code>ScopedTypeVariables</code> to supply the constraint <code>KnownSymbol a</code> to <code>symbolVal SProxy</code>. This works fine, however, I would like to be able to make the conversion rates update from an external source, perhaps a text file or an API such as <a href=\"http://fixer.io/\" rel=\"nofollow\">fixer</a>. </p>\n\n<p>Obviously, I could just wrap the return type in <code>IO</code>, forming</p>\n\n<pre><code>convert :: forall a b. (KnownSymbol a, KnownSymbol b) =&gt; Currency a -&gt; IO (Currency b)\n</code></pre>\n\n<p>but I would like to be able to keep a pure API. My first thought was to have the conversion rate map be obtained using <code>unsafePerformIO</code>, but this is unsafe so I instead thought I could use another function <code>getConvert</code> with a type to the effect of</p>\n\n<pre><code>getConvert :: IO (forall a b. (KnownSymbol a, KnownSymbol b) =&gt; Currency a -&gt; Currency b)\n</code></pre>\n\n<p>(i.e an IO action returning a <code>convert</code> type function) so that it could be used like this:</p>\n\n<pre><code>do\n    convert &lt;- getConvert\n    print $ convert (gbp 10) :: USD\n</code></pre>\n\n<p>However, I have been unable to get this to type check - GHC complains that it:</p>\n\n<pre><code>Couldn't match expected type \u2018forall (a :: Symbol) (b :: Symbol). \n                              (KnownSymbol a, KnownSymbol b) =&gt; \n                              Currency a -&gt; Currency b\u2019 \nwith actual type \u2018Currency a0 -&gt; Currency b0\u2019\n</code></pre>\n\n<p>When I had GHC infer the type of <code>return convert</code>, it did not infer the type I wanted but instead moved the <code>forall a b</code> to the prenex position, which type checks, until I try to use <code>convert' &lt;- getConvert</code>, at which point it fails saying that there is <code>No instance for (KnownSymbol n0)</code></p>\n\n<p><strong>My question is why does this not type check, and what would be the correct type for the function <code>getConvert</code>?</strong> </p>\n\n<p>First I thought that it may be the fact both <code>ScopedTypeVariables</code> and <code>RankNTypes</code> use the <code>forall</code> quantifier in different ways, but toggling <code>RankNTypes</code> has had no effect. I also tried moving the quantifier to the front as GHC suggested but this does not give me the rank-2 type that I need.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470251246, "post_id": 38750967, "comment_id": 64877342, "body": "The question is not very clear. My understanding is: you are writing an application, using cabal. Said application has a config file, and you would like that, when cabal installs the application, it also installs the config file for it somewhere, so that the user can modify it."}, {"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470256362, "post_id": 38750967, "comment_id": 64880062, "body": "Yes, This is exactly what I want."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1470256532, "creation_date": 1470256532, "answer_id": 38753153, "question_id": 38750967, "link": "https://stackoverflow.com/questions/38750967/default-file-to-the-home-directory/38753153#38753153", "title": "Default file to the Home directory", "body": "<p>cabal supports the notion of data files which will be installed with your application, and it also provides an API you can use to determine where the data files actually reside.</p>\n\n<p>In your cabal file add a <code>data-files</code> stanza, e.g.:</p>\n\n<pre><code>data-files: file1.txt, img2.jpg\n</code></pre>\n\n<p>The paths are relative to your project directory.</p>\n\n<p>Then in your application use this code:</p>\n\n<pre><code>import Paths_project_name\n...\n\nfoo = do path &lt;- getDataFileName \"file1.txt\"\n         ...\n         img &lt;- getDataFileName \"img2.jpg\"\n         ...\n</code></pre>\n\n<p>Here _project_name_ is the name of the cabal project. E.g., if you cabal file is named <strong>Blather.cabal</strong>, then you would import <strong>Paths_Blather</strong>.</p>\n\n<p>More info is available in this blog post:</p>\n\n<p><a href=\"http://neilmitchell.blogspot.com/2008/02/adding-data-files-using-cabal.html\" rel=\"nofollow\">http://neilmitchell.blogspot.com/2008/02/adding-data-files-using-cabal.html</a></p>\n"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 38753153, "answer_count": 1, "score": 0, "last_activity_date": 1470256532, "creation_date": 1470248365, "question_id": 38750967, "link": "https://stackoverflow.com/questions/38750967/default-file-to-the-home-directory", "title": "Default file to the Home directory", "body": "<p>How do I create a file with my defaults, maybe to the home directory, after installing my cabal package? I save my default file in the source directory. I mean, is any way to say to cabal that after finish or in the beginning, to create that file. Because I would like to have it, later on, when I execute my application.</p>\n"}, {"tags": ["haskell", "bytestring", "memory-profiling"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1470237217, "post_id": 38745937, "comment_id": 64868740, "body": "Please clarify &quot;couldn&#39;t get heap profiling data&quot;. What went wrong exactly?"}, {"owner": {"reputation": 147, "user_id": 716278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10cff05392b8e3d54b67ae431e839cff?s=128&d=identicon&r=PG", "display_name": "6bb79df9", "link": "https://stackoverflow.com/users/716278/6bb79df9"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1470313235, "post_id": 38745937, "comment_id": 64905449, "body": "The problem is that there&#39;s no profile sample in a &#39;*.hp&#39; file, all I got looked like a simple file header:      JOB &quot;t in/data out/data +RTS -p -h&quot;     DATE &quot;Thu Aug  4 20:19 2016&quot;     SAMPLE_UNIT &quot;seconds&quot;     VALUE_UNIT &quot;bytes&quot;     BEGIN_SAMPLE 0.000000     END_SAMPLE 0.000000     BEGIN_SAMPLE 0.943188     END_SAMPLE 0.943188"}, {"owner": {"reputation": 238, "user_id": 4095104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b0868543591a528f3c39136447fc94d?s=128&d=identicon&r=PG", "display_name": "L29Ah", "link": "https://stackoverflow.com/users/4095104/l29ah"}, "edited": false, "score": 0, "creation_date": 1598983329, "post_id": 38745937, "comment_id": 112633398, "body": "ByteStrings can&#39;t be meaningfully profiled yet, see <a href=\"https://gitlab.haskell.org/ghc/ghc/-/issues/7275\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/-/issues/7275</a> for a discussion."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 4, "last_activity_date": 1470251203, "last_edit_date": 1470251203, "creation_date": 1470246944, "answer_id": 38750597, "question_id": 38745937, "link": "https://stackoverflow.com/questions/38745937/no-heap-profiling-data-for-module-data-bytestring/38750597#38750597", "title": "No heap profiling data for module Data.ByteString", "body": "<p>It appears as though the runtime isn't \"getting the chance to measure\" the heap. If you add <code>-s</code> to your <code>RTS</code> options, it should print some time and allocation information. When I run this, I see the bytes allocated and total memory use is very high (size of the file), but the maximum residency (and the number of samples) is very low, and while the elapsed time is high the actual \"work\" time is practically 0.</p>\n\n<p>Adding the RTS option <code>-i0</code> allowed me to reproducibly visualize the bytestring allocation as <code>PINNED</code> (this is the classification because the byte arrays that bytestring uses internally are allocated in an area in which the GC can't move things). You could experiment with different <code>-h</code> options which associate allocations to different cost centers (for example, <code>-hy</code> should show <code>ARR_WORDS</code>) but it probably wouldn't have much value in this case as the bytestrings are really just \"big chunks of raw memory\".</p>\n\n<p>The references I used to find the RTS options were (clearly I wasn't particular about the GHC version - I can't imagine these flags change frequently):</p>\n\n<ol>\n<li><a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/runtime-control.html\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/runtime-control.html</a></li>\n<li><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html</a></li>\n</ol>\n"}], "owner": {"reputation": 147, "user_id": 716278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10cff05392b8e3d54b67ae431e839cff?s=128&d=identicon&r=PG", "display_name": "6bb79df9", "link": "https://stackoverflow.com/users/716278/6bb79df9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 38750597, "answer_count": 1, "score": 5, "last_activity_date": 1598983329, "creation_date": 1470233195, "last_edit_date": 1495541700, "question_id": 38745937, "link": "https://stackoverflow.com/questions/38745937/no-heap-profiling-data-for-module-data-bytestring", "title": "No heap profiling data for module Data.ByteString", "body": "<p>I was trying to generate heap memory profile for following naive Haskell code that copies a file:</p>\n\n<pre><code>import System.Environment\nimport System.IO\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Lazy as LB\n\nnaiveCopy :: String -&gt; String -&gt; IO ()\nnaiveCopy from to = do\n  putStrLn $ \"From: \" ++ from\n  putStrLn $ \"To: \" ++ to\n  s &lt;- B.readFile from\n  B.writeFile to s\n\nmain = do\n  args &lt;- getArgs\n  mapM (\\ x-&gt; putStrLn x) args\n  naiveCopy (head args) ((head.tail) args)\n</code></pre>\n\n<p>Command that build the code with ghc 8.0.1:</p>\n\n<pre><code>ghc -o t -rtsopts -prof -fprof-auto t.hs\n</code></pre>\n\n<p>Command that collect the profiling data:</p>\n\n<pre><code>./t +RTS -p -h -RTS in/data out/data &amp;&amp; hp2ps -e8in -c t.hp\n</code></pre>\n\n<p>where <code>in/data</code> is a quite big file (approx 500MB) which will take the program about 2 seconds to copy.</p>\n\n<p>The problem is that I <strong>couldn't</strong> get heap profiling data if I use the strict <strong><code>Data.ByteString</code></strong>, there's only an small t.hp file without any sample data, it looks like this:</p>\n\n<pre><code>JOB \"t in/data out/data +RTS -p -h\"\nDATE \"Thu Aug  4 20:19 2016\"\nSAMPLE_UNIT \"seconds\"\nVALUE_UNIT \"bytes\"\nBEGIN_SAMPLE 0.000000\nEND_SAMPLE 0.000000\nBEGIN_SAMPLE 0.943188\nEND_SAMPLE 0.943188\n</code></pre>\n\n<p>and corresponding profile chart like this:\n<a href=\"https://i.stack.imgur.com/vNWKF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vNWKF.png\" alt=\"Strict ByteString without profiling data\"></a></p>\n\n<p>However I <strong>could</strong> get heap profiling data if I switch to the lazy version <strong><code>Data.ByteString.Lazy</code></strong>, profile chart like this:\n<a href=\"https://i.stack.imgur.com/teTtB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/teTtB.png\" alt=\"Lazy ByteString with profiling data\"></a></p>\n\n<p>Update: Thanks <a href=\"https://stackoverflow.com/users/1424121/ryachza\">@ryachza</a>, I added a <code>-i0</code> parameter to set sampling interval and tried again, this time I got sample data for strict <code>ByteString</code> and it looked reasonable (I was copying a 500M file and the memory allocation peak in following profiling chart is about 500M)</p>\n\n<pre><code>./t +RTS -p -h -RTS in/data out/data &amp;&amp; hp2ps -e8in -c t.hp\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/oIRFc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oIRFc.png\" alt=\"Strict ByteString with profiling data\"></a></p>\n"}, {"tags": ["haskell", "gtk", "gtk2hs"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470240543, "post_id": 38745720, "comment_id": 64871145, "body": "I am not an expert of gtk2hs, but perhaps you should not use its functions after <code>mainGUI</code> returned?"}, {"owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470244079, "post_id": 38745720, "comment_id": 64873345, "body": "Yes that seems logical, but then the question are why can I get the value of a <code>spinButton</code> reliably, and is there a way to prevent a call to this function inside a callback for instance after <code>mainGUI</code> as returned?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1470245783, "post_id": 38745720, "comment_id": 64874310, "body": "This might be a &quot;feature&quot; coming from the C side of GTK: just because we free&#39;d an object and we access the free&#39;d memory this does not mean that we realiably get a segfault. It might work just fine, e.g. because noone reused that free memory so far... One might expect a better memory safety from Haskell (via garbage collection), but the gtk2hs can not guarantee much after <code>mainGUI</code> returns. Keep in mind that I am speculating here -- again, I am not familiar with gtk2hs."}], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1470232627, "creation_date": 1470232627, "question_id": 38745720, "link": "https://stackoverflow.com/questions/38745720/rangegetvalue-causes-a-segfault-after-mainquit-in-gtk2hs", "title": "rangeGetValue causes a segfault after mainQuit in gtk2hs", "body": "<p>I'm working on a Haskell project with a graphical user interface written with <code>gtk2hs</code>. When I quit my program, 90% of the time I get a segfault. (I noticed that quite recently, because I usually kill my program with a <code>Ctrl-C</code> on the terminal when developing which doesn't cause a segfault.)</p>\n\n<p>Anyway, I've tracked the source of the segfault with <code>gdb</code> and it's always due to a call to <code>gtk_range_get_value ()</code>. Having some scales I guessed what happened was that some part of my program queried the value of a scale when the scale had already been destroyed, hence the segfault.</p>\n\n<p>My intuition was confirmed after making the following code which creates a scale and after destroying the main window demands the value it carries:</p>\n\n<pre><code>import Graphics.UI.Gtk\n\nmain :: IO ()\nmain = do\n  initGUI\n  window &lt;- windowNew\n  set window [containerBorderWidth := 10, windowDefaultWidth := 250]\n  adj &lt;- adjustmentNew 1 0 100 1 1 0\n  scale &lt;- vScaleNew adj\n  containerAdd window scale\n  widgetShowAll window\n  onDestroy window mainQuit\n  mainGUI\n  rangeGetValue scale &gt;&gt;= print\n</code></pre>\n\n<p>However there is something I found strange, when I try and do the same with a spin button, the code doesn't segfaults and gives me a value:</p>\n\n<pre><code>import Graphics.UI.Gtk\n\nmain :: IO ()\nmain = do\n  initGUI\n  window &lt;- windowNew\n  set window [containerBorderWidth := 10, windowDefaultWidth := 250]\n  adj &lt;- adjustmentNew 1 0 100 1 1 0\n  spin &lt;- spinButtonNew adj 1 0\n  containerAdd window spin\n  widgetShowAll window\n  onDestroy window mainQuit\n  mainGUI\n  spinButtonGetValue spin &gt;&gt;= print\n</code></pre>\n\n<p>So here is my question: is it normal that I get a segfault with <code>rangeGetValue</code> and not with <code>spinButtonGetValue</code>? If it is, is there a way to prevent a segfault when demanding a value of something that doesn't exist anymore?</p>\n"}, {"tags": ["haskell", "pointfree"], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1470228180, "post_id": 38743731, "comment_id": 64861643, "body": "How did you/it go from <code>f&#39; x y = f (g x) (h y)</code> to <code>f&#39; = id (fix (const (flip ((.) . f . g) h)))</code>?"}, {"owner": {"reputation": 3969, "user_id": 187261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/994de0373c6a35a5f7108b274d0b1cb9?s=128&d=identicon&r=PG", "display_name": "Nazarii Bardiuk", "link": "https://stackoverflow.com/users/187261/nazarii-bardiuk"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1470228878, "post_id": 38743731, "comment_id": 64862244, "body": "I am not expert in this. Looks like library has a set predefined transformations and performs search in the space of possible transformations. And by following simplifications looks like it has some redundant functions. For example first step could be <code>flip ((.) . f . g) h</code> without chain of <code>id(fix(const</code>"}], "tags": [], "owner": {"reputation": 3969, "user_id": 187261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/994de0373c6a35a5f7108b274d0b1cb9?s=128&d=identicon&r=PG", "display_name": "Nazarii Bardiuk", "link": "https://stackoverflow.com/users/187261/nazarii-bardiuk"}, "is_accepted": false, "score": 5, "last_activity_date": 1470227413, "creation_date": 1470227413, "answer_id": 38743731, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style/38743731#38743731", "title": "Write f in pointfree-style?", "body": "<p>Take a look at <a href=\"https://blunt.herokuapp.com/#input=f%27%20x%20y%20%3D%20f%20(g%20x)%20(h%20y)\">online converter</a> </p>\n\n<p>It converted</p>\n\n<pre><code>f' x y = f (g x) (h y) \n</code></pre>\n\n<p>into </p>\n\n<pre><code>f' = (. h) . f . g\n</code></pre>\n\n<p>with the flow of transformations</p>\n\n<pre><code>f' = id (fix (const (flip ((.) . f . g) h))) \nf' = fix (const (flip ((.) . f . g) h)) \nf' = fix (const ((. h) . f . g)) \nf' = (. h) . f . g\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1470240351, "post_id": 38744882, "comment_id": 64871005, "body": "This is very different from the procedure I tend to follow myself. It&#39;s always refreshing to see a new way."}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": true, "score": 24, "last_activity_date": 1470655478, "last_edit_date": 1470655478, "creation_date": 1470230503, "answer_id": 38744882, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style/38744882#38744882", "title": "Write f in pointfree-style?", "body": "<p>We have:</p>\n\n<pre><code>k x y = (f (g x)) (h y)\n</code></pre>\n\n<p>and we wish to write <code>k</code> in point-free style.</p>\n\n<p>The first argument passed to <code>k</code> is <code>x</code>. What do we need to do with <code>x</code>? Well, first we need to call <code>g</code> on it, and then <code>f</code>, and then do something fancy to apply this to <code>(h y)</code>.</p>\n\n<pre><code>k = fancy . f . g\n</code></pre>\n\n<p>What is this <code>fancy</code>? Well:</p>\n\n<pre><code>k x y = (fancy . f . g) x y\n      = fancy (f (g x)) y\n      = f (g x) (h y)\n</code></pre>\n\n<p>So we desire <code>fancy z y = z (h y)</code>. Eta-reducing, we get <code>fancy z = z . h</code>, or <code>fancy = (. h)</code>.</p>\n\n<pre><code>k = (. h) . f . g\n</code></pre>\n\n<hr>\n\n<p>A more natural way to think about it might be</p>\n\n<pre><code>                             \u250c\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2510\n                        x \u2500\u2500\u2500\u2502 g \u2502\u2500\u2500\u2500 g x \u2500\u2500\u2500\u2502   \u2502\n                      /      \u2514\u2500\u2500\u2500\u2518           \u2502   \u2502\n               (x, y)                        \u2502 f \u2502\u2500\u2500\u2500 f (g x) (h y)\n                      \\      \u250c\u2500\u2500\u2500\u2510           \u2502   \u2502\n                        y \u2500\u2500\u2500\u2502 h \u2502\u2500\u2500\u2500 h y \u2500\u2500\u2500\u2502   \u2502\n                             \u2514\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2518\n\n                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                      k\n</code></pre>\n\n<p>Enter <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html\" rel=\"noreferrer\"><code>Control.Arrow</code></a>:</p>\n\n<pre><code>k = curry ((g *** h) &gt;&gt;&gt; uncurry f)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1470238903, "post_id": 38745362, "comment_id": 64869999, "body": "Easier to follow that <code>(. h) . f . g</code>? Er... I don&#39;t think so. Using the <code>Applicative (a-&gt;)</code> instance with tuples is giving you the <i>worst of both worlds</i>: cryptic dataflow semantics and awkward currying."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1470239852, "post_id": 38745362, "comment_id": 64870666, "body": "I find partial application of <code>(.)</code> to be even less understandable than <code>Applicative (a -&gt;)</code>. The user already indicated an understanding (or at least awareness) of <code>Applicative</code>, so I built off that. The question was how to write a point-free version of the function; myself, I wouldn&#39;t bother and stick with the perfectly understandable <code>f x y = f (g x) (h y)</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1470231702, "creation_date": 1470231702, "answer_id": 38745362, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style/38745362#38745362", "title": "Write f in pointfree-style?", "body": "<p>This is slightly longer, but a little easier to follow, than <code>(. h) . f. g</code>.</p>\n\n<p>First, rewrite <code>f'</code> slightly to take a tuple instead of two arguments. (In otherwords, we're uncurrying your original <code>f'</code>.)</p>\n\n<pre><code>f' (x, y) = f (g x) (h y)\n</code></pre>\n\n<p>You can pull a tuple apart with <code>fst</code> and <code>snd</code> instead of pattern matching on it:</p>\n\n<pre><code>f' t = f (g (fst t)) (h (snd t))\n</code></pre>\n\n<p>Using function composition, the above becomes</p>\n\n<pre><code>f' t = f ((g . fst) t) ((h . snd) t)\n</code></pre>\n\n<p>which, hey, looks a lot like the version you could make point-free using applicative style:</p>\n\n<pre><code>f' = let g' = g . fst\n         h' = h . snd\n     in (f &lt;$&gt; g') &lt;*&gt; h'\n</code></pre>\n\n<p>The only problem left is that <code>f' :: (a, a) -&gt; d</code>. You can fix this by explicitly currying it:</p>\n\n<pre><code>f' :: a -&gt; a -&gt; d\nf' = let g' = g . fst\n         h' = h . snd\n     in curry $ (f &lt;$&gt; g') &lt;*&gt; h'\n</code></pre>\n\n<p>(This is very similar, by the way, to the <code>Control.Arrow</code> solution added by Lynn.)</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1470475648, "last_edit_date": 1495541209, "creation_date": 1470242001, "answer_id": 38749169, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style/38749169#38749169", "title": "Write f in pointfree-style?", "body": "<p>Using the \"three rules of operator sections\" as applied to the <code>(.)</code> function composition operator,</p>\n\n<pre><code>(.) f g  =  (f . g)  =  (f .) g  =  (. g) f   -- the argument goes into the free slot\n--       1           2           3\n</code></pre>\n\n<p>this is derivable by a few straightforward mechanical steps:</p>\n\n<pre><code>k x y =  (f (g x)) (h y)                      -- a (b c) === (a . b) c\n      =  (f (g x) . h) y\n      =  (. h)  (f (g x)) y\n      =  (. h)  ((f . g)  x) y\n      = ((. h) . (f . g)) x  y\n</code></pre>\n\n<p>Lastly, <code>(.)</code> is associative, so the inner parens may be dropped.</p>\n\n<p>The general procedure is to strive to reach the situation where eta-reduction can be performed, i.e. we can get rid of the arguments if they are in same order and are outside any parentheses:</p>\n\n<pre><code>k x y = (......) y\n=&gt;\nk x   = (......)\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/8681512/what-is-a-general-scheme-for-writing-a-function-in-pointfree-style/18174604#18174604\">Lather</a>, <a href=\"https://stackoverflow.com/questions/9169046/writing-in-pointfree-style-f-x-g-x-x/11050971#11050971\">rinse</a>, repeat.</p>\n\n<hr>\n\n<p>Another trick  is to turn two arguments into one, or vice versa, with the equation</p>\n\n<pre><code>curry f x y = f (x,y)     \n</code></pre>\n\n<p>so, your</p>\n\n<pre><code>f (g x) (h y) = (f.g) x (h y)                      -- by B-combinator rule\n              = (f.g.fst) (x,y) ((h.snd) (x,y))\n              = (f.g.fst &lt;*&gt; h.snd) (x,y)          -- by S-combinator rule\n              = curry (f.g.fst &lt;*&gt; h.snd) x y\n</code></pre>\n\n<p>This is the same as the <a href=\"https://stackoverflow.com/a/38745362/849891\">answer by @chepner</a>, but presented more concisely.</p>\n\n<p>So, you see, your <code>(f.g &lt;*&gt; h) x</code><sup>1</sup> just becomes <code>(f.g.fst &lt;*&gt; h.snd) (x,y)</code>. Same difference.</p>\n\n<hr>\n\n<p><sup>1</sup>(because, for functions, <code>(&lt;$&gt;) = (.)</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 1, "last_activity_date": 1470324822, "creation_date": 1470324822, "answer_id": 38771680, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style/38771680#38771680", "title": "Write f in pointfree-style?", "body": "<p><a href=\"http://hackage.haskell.org/package/TypeCompose-0.9.12\" rel=\"nofollow\">Control.Compose</a></p>\n\n<pre><code>(g ~&gt; h ~&gt; id) f\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/data-function-meld\" rel=\"nofollow\">Data.Function.Meld</a></p>\n\n<pre><code>f $* g $$ h *$ id\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/data-function-tacit\" rel=\"nofollow\">Data.Function.Tacit</a></p>\n\n<pre><code>lurryA @N2 (f &lt;$&gt; (g &lt;$&gt; _1) &lt;*&gt; (h &lt;$&gt; _2))\nlurryA @N5 (_1 &lt;*&gt; (_2 &lt;*&gt; _4) &lt;*&gt; (_3 &lt;*&gt; _5)) f g h\n</code></pre>\n\n<hr>\n\n<h1>Related articles</h1>\n\n<ul>\n<li><a href=\"http://conal.net/blog/posts/semantic-editor-combinators\" rel=\"nofollow\">Semantic Editor Combinators</a>, Conal Elliott, 2008/11/24</li>\n<li><a href=\"http://matt.immute.net/content/pointless-fun\" rel=\"nofollow\">Pointless fun</a>, Matt Hellige, 2008/12/03</li>\n</ul>\n"}], "owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 1, "accepted_answer_id": 38744882, "answer_count": 5, "score": 4, "last_activity_date": 1470655478, "creation_date": 1470227035, "last_edit_date": 1470242080, "question_id": 38743576, "link": "https://stackoverflow.com/questions/38743576/write-f-in-pointfree-style", "title": "Write f in pointfree-style?", "body": "<p>Say I have functions </p>\n\n<pre><code>g :: a -&gt; b, h :: a -&gt; c \n</code></pre>\n\n<p>and </p>\n\n<pre><code>f :: b -&gt; c -&gt; d. \n</code></pre>\n\n<p>Is it possible to write the function </p>\n\n<pre><code> f' :: a -&gt; a -&gt; d \n</code></pre>\n\n<p>given by </p>\n\n<pre><code>f' x y = f (g x) (h y) \n</code></pre>\n\n<p>in point free style?.</p>\n\n<p>One can write the function </p>\n\n<pre><code>f' a -&gt; d, f' x = f (g x) (h x) \n</code></pre>\n\n<p>in point free style by setting </p>\n\n<pre><code>f' = (f &lt;$&gt; g) &lt;*&gt; h  \n</code></pre>\n\n<p>but I couldn't figure out how to do the more general case.</p>\n"}, {"tags": ["haskell", "dsl", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 7560, "user_id": 6600, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/61898938b055cdc0a8efbf87ec19a610?s=128&d=identicon&r=PG", "display_name": "Brownie", "link": "https://stackoverflow.com/users/6600/brownie"}, "edited": false, "score": 0, "creation_date": 1470229754, "post_id": 38736590, "comment_id": 64862942, "body": "Thank you Cirdec that is exactly what I was looking for. Nice tip about parameterising the queue type."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 11, "last_activity_date": 1470208154, "last_edit_date": 1470208154, "creation_date": 1470207760, "answer_id": 38736590, "question_id": 38735893, "link": "https://stackoverflow.com/questions/38735893/is-it-possible-to-implement-polymorphic-functions-in-a-dsl-using-free/38736590#38736590", "title": "Is it possible to implement polymorphic functions in a DSL using Free", "body": "<p>You can represent your DSL with a GADT</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE DeriveFunctor #-}\n\ndata Queue a = Queue a\n\ndata MyDsl next where\n  NewQueue :: (Queue a -&gt; next) -&gt; MyDsl next\n  WriteToQueue :: (Queue a) -&gt; a -&gt; next -&gt; MyDsl next\n\nderiving instance Functor MyDsl\n</code></pre>\n\n<p>Neither <code>makeFree</code> nor <a href=\"https://hackage.haskell.org/package/free/docs/Control-Monad-Free-TH.html#v:makeFreeCon\" rel=\"noreferrer\"><code>makeFreeCon</code></a> can generate free polymorphic monadic actions for <code>MyDsl</code>. You will need to write them yourself.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Monad.Free.Class\n\nnewQueue :: (MonadFree MyDsl m) =&gt; m (Queue a)\nnewQueue = wrap $ NewQueue return\n\nwriteToQueue :: (MonadFree MyDsl m) =&gt; Queue a -&gt; a -&gt; m ()\nwriteToQueue q v = liftF $ WriteToQueue q v ()\n</code></pre>\n\n<p>Now you can write your test program.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Monad.Free.Church\n\n-- testProgram can have a more general type\n-- testProgram :: (MonadFree MyDsl m) =&gt; m ()\ntestProgram :: F MyDsl ()\ntestProgram = do\n  (intQueue :: Queue Int) &lt;- newQueue\n  (charQueue :: Queue Char) &lt;- newQueue\n  writeToQueue intQueue 1\n  writeToQueue charQueue 'c'\n</code></pre>\n\n<hr>\n\n<p>You may find your DSL is easier to write multiple interpreters for if you parameterize the type of a queue. If you do, you'll need a type family or functional dependency to determine the type of the queue from the type of the monad.</p>\n\n<pre><code>data MyDsl q next where\n  NewQueue :: (q a -&gt; next) -&gt; MyDsl next\n  WriteToQueue :: (q a) -&gt; a -&gt; next -&gt; MyDsl next\n</code></pre>\n"}], "owner": {"reputation": 7560, "user_id": 6600, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/61898938b055cdc0a8efbf87ec19a610?s=128&d=identicon&r=PG", "display_name": "Brownie", "link": "https://stackoverflow.com/users/6600/brownie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 4, "accepted_answer_id": 38736590, "answer_count": 1, "score": 6, "last_activity_date": 1470208154, "creation_date": 1470205491, "question_id": 38735893, "link": "https://stackoverflow.com/questions/38735893/is-it-possible-to-implement-polymorphic-functions-in-a-dsl-using-free", "title": "Is it possible to implement polymorphic functions in a DSL using Free", "body": "<p>I am building a small DSL using Free Monads.</p>\n\n<p>I would like to be able to have polymorphic functions in my DSL.</p>\n\n<p>An example of something I would like to build is this:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport           Control.Monad.Free.Church\n\ndata Queue a = Queue a\n\ndata MyDsl next =\n  NewQueue (Queue a -&gt; next) |\n  WriteToQueue (Queue a) a next\n\nmakeFree ''MyDsl\n\ntestProgram :: F MyDsl\ntestProgram = do\n  (intQueue :: Queue Int) &lt;- newQueue\n  (charQueue :: Queue Char) &lt;- newQueue\n  writeToQueue intQueue 1\n  writeToQueue charQueue 'c'\n</code></pre>\n\n<p>The way I have encoded it above I get <code>Not in scope: type variable \u2018a\u2019</code>\nerrors which makes sense. Is there a way to have polymorphic functions in a DSL using Free?</p>\n\n<p>For background the reason I would like to do this is so I can have a production interpreter that uses TQueue behind the scenes and a test interpreter that uses an in memory data structure for testing.</p>\n"}, {"tags": ["postgresql", "haskell", "ghc", "postgresql-simple"], "comments": [{"owner": {"reputation": 13, "user_id": 4143668, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UhwhVtXwLGs/AAAAAAAAAAI/AAAAAAAAABc/0LQJznWnHjw/photo.jpg?sz=128", "display_name": "Mike Thomas", "link": "https://stackoverflow.com/users/4143668/mike-thomas"}, "edited": false, "score": 0, "creation_date": 1470354613, "post_id": 38735008, "comment_id": 64929402, "body": "From the author of the PostgreSQL-simple library - LP Smith : &quot;Sure, the underscore in _int8 means it&#39;s an array of 8-byte integers. So you need to change the return type to [Only (Vector Int64)]&quot;  This change to the return type of the query resolved the issue.  Thanks Leon."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 4143668, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UhwhVtXwLGs/AAAAAAAAAAI/AAAAAAAAABc/0LQJznWnHjw/photo.jpg?sz=128", "display_name": "Mike Thomas", "link": "https://stackoverflow.com/users/4143668/mike-thomas"}, "is_accepted": true, "score": 0, "last_activity_date": 1470355297, "creation_date": 1470355297, "answer_id": 38779189, "question_id": 38735008, "link": "https://stackoverflow.com/questions/38735008/haskell-postgresql-simple-incompatible-type-int8-and-int64-and-integer/38779189#38779189", "title": "haskell postgresql-simple incompatible type _int8 and Int64 (and Integer)", "body": "<p>See the above comment relayed from LP Smith, who I contacted when no answers were forthcoming here.   It resolves my issue.</p>\n\n<p>The key was to recognize that _int8 represents an array of 8 byte integers, rather than thinking, as I had done, that it was an internal representation for a single 8 byte integer. Leon's suggested change was to substitute \"[Only (Vector Int64)]\" for \"[Only Int64]\" in the line marked above as the point of the runtime error.</p>\n\n<p>Thank you Leon.</p>\n"}], "owner": {"reputation": 13, "user_id": 4143668, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UhwhVtXwLGs/AAAAAAAAAAI/AAAAAAAAABc/0LQJznWnHjw/photo.jpg?sz=128", "display_name": "Mike Thomas", "link": "https://stackoverflow.com/users/4143668/mike-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 38779189, "answer_count": 1, "score": 1, "last_activity_date": 1470355297, "creation_date": 1470201735, "question_id": 38735008, "link": "https://stackoverflow.com/questions/38735008/haskell-postgresql-simple-incompatible-type-int8-and-int64-and-integer", "title": "haskell postgresql-simple incompatible type _int8 and Int64 (and Integer)", "body": "<p>The erroneous function below is part of a program called subdivide working with Postgis geospatial intersections on the server side and processing the returned array of Int64 on the client side.</p>\n\n<p>It is built and run under Stack, resolving to Nightly 2016-08-02 and explicitly specifying architecture x86_64.</p>\n\n<p>I get the following runtime error executing the Postgres query defined as \"intersectionsSql\" (see the comment RUNTIME ERROR HERE):</p>\n\n<pre><code>\"Created table:  server : [Only {fromOnly = \\\"PostgreSQL 9.6beta2 on x86_64-pc-linux-gnu, compiled by gcc (Debian 4.9.2-10) 4.9.2, 64-bit\\\"}] quadrant: BOX3D(-180.0 90.0, -90.0 45.0)\"\nsubdivide: Incompatible {errSQLType = \"_int8\", errSQLTableOid = Nothing, errSQLField = \"object_ids\", errHaskellType = \"Int64\", errMessage = \"types incompatible\"}\n</code></pre>\n\n<p>I have tried Integer, Int64 and Int, all with the same result, which is counter-intuitive as those Haskell types should all be compatible with _int8 according to the PostgreSQL-simple instance documentation:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.0.0/candidate/docs/Database-PostgreSQL-Simple-FromField.html\" rel=\"nofollow\">https://hackage.haskell.org/package/postgresql-simple-0.5.0.0/candidate/docs/Database-PostgreSQL-Simple-FromField.html</a></p>\n\n<p>The SQL query should return a single row of postgres bigint[], which I have confirmed via PGAdmin.</p>\n\n<p>Any ideas?</p>\n\n<p>Also any comments around how I have written the code - its over a decade since last I worked with GHC and times have changed.</p>\n\n<p>Thanks for your consideration.</p>\n\n<p>Mike Thomas    </p>\n\n<pre><code>accumulateIntersections :: Identifier -&gt; Identifier -&gt; ConnectInfo -&gt; ((Double,Double),(Double,Double)) -&gt; IO ()\naccumulateIntersections sourceTable accumulationTable connectionInfo q =\nlet\n    theBox = makeBox3D (fst (fst q)) (snd (fst q)) (fst (snd q)) (snd (snd q))\n    theValue = (Only theBox)\n    dropTable = [sql| DROP TABLE IF EXISTS ? CASCADE |]\n    createTable = [sql| CREATE TABLE ? ( quadrant_id BIGSERIAL, area_metres_squared FLOAT8, shape GEOMETRY, object_ids BIGINT[] ) |]\n    aggregateSql = [sql| DROP AGGREGATE IF EXISTS _array_agg (anyarray);\n                         CREATE AGGREGATE _array_agg(anyarray) (SFUNC = array_cat, STYPE = anyarray);\n                        |]\n    intersectionsSql = [sql| SELECT _array_agg (object_ids) object_ids\n                             FROM ?\n                             WHERE ST_Intersects(ST_SetSRID ( ?::box3d, 4326 ), shape)\n                          |]\n    insertIntersections = [sql| INSERT INTO ? (shape, object_ids)\n                                VALUES ( ST_SetSRID ( ?::box3d, 4326 )\n                                        , ? ) |]\nin\ndo\n  connection &lt;- connect connectionInfo\n  execute_ connection aggregateSql\n  postgresVersion &lt;- (query_ connection \"SELECT version()\" :: IO [Only String])\n  i0 &lt;- execute connection dropTable (Only accumulationTable)\n  i1 &lt;- execute connection createTable (Only accumulationTable)\n  print (\"Created table:  server : \" ++ (show postgresVersion) ++ \" quadrant: \" ++ theBox)\n  is :: [Only Int64] &lt;- query connection intersectionsSql (sourceTable, theBox) -- RUNTIME ERROR HERE\n  print (\"Intersections done.\")\n  ids::[Int64] &lt;- forM is (\\(Only id) -&gt; return id)\n  print (\"Ids done.\")\n  close connection\n  return ()\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470181629, "post_id": 38732181, "comment_id": 64840515, "body": "Search stack overflow for other problems with ambiguous types.  Long story short: that&#39;s a pretty bad API you&#39;re using."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470182051, "post_id": 38732181, "comment_id": 64840608, "body": "@ThomasM.DuBuisson any better DOM parsers that have innerText, querySelectorAll, and getComputedStyle?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470182557, "post_id": 38732181, "comment_id": 64840701, "body": "I don&#39;t know any DOM parsers at all!  But any API that has a Maybe parameter that can&#39;t be inferred from other types is bound to cause ambiguous types, as with the literal <code>Nothing</code>.    For now you&#39;ll just have to suffer through giving it an explicit type <code>(Nothing :: Maybe SOMETHING)</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470182666, "post_id": 38732181, "comment_id": 64840733, "body": "@ThomasM.DuBuisson ok thanks"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 5, "creation_date": 1470182796, "post_id": 38732181, "comment_id": 64840758, "body": "<code>instance Foo (Maybe Int) where foo _ = &quot;Int&quot;; instance Foo (Maybe Char) where foo _ = &quot;Char&quot;</code>. What is <code>foo Nothing</code>?"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "closed_date": 1470189546, "answer_count": 0, "score": 0, "last_activity_date": 1470181508, "creation_date": 1470181508, "question_id": 38732181, "link": "https://stackoverflow.com/questions/38732181/compiler-complains-about-not-being-able-to-deduce-type-of-maybe-when-i-pass-noth", "closed_reason": "Duplicate", "title": "Compiler complains about not being able to deduce type of Maybe when I pass Nothing", "body": "<p>I am getting an error that I don't understand. The library I am using has this function:</p>\n\n<pre><code>getComputedStyle ::\n             (MonadIO m, IsElement element, ToJSString pseudoElement) =&gt;\n               Window -&gt;\n                 Maybe element -&gt;\n                   Maybe pseudoElement -&gt; m (Maybe CSSStyleDeclaration)\n</code></pre>\n\n<p>When I call it like this:</p>\n\n<pre><code>Window.getComputedStyle window (Just element) Nothing\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>Could not deduce (GHCJS.DOM.Types.ToJSString pseudoElement0)\n  arising from a use of \u2018getComputedStyle\u2019\nfrom the context (Control.Monad.IO.Class.MonadIO m,\n                  IsElement element)\n  bound by the inferred type of\n           isBold :: (Control.Monad.IO.Class.MonadIO m, IsElement element) =&gt;\n                     Window -&gt; element -&gt; m (Maybe CSSStyleDeclaration)\n  at src/Main.hs:(39,1)-(40,61)\nThe type variable \u2018pseudoElement0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance GHCJS.DOM.Types.ToJSString\n             ghcjs-base-0.2.0.0:Data.JSString.Internal.Type.JSString\n\n    -- Defined in \u2018GHCJS.DOM.Types\u2019\n  instance GHCJS.DOM.Types.ToJSString\n      ghcjs-base-0.2.0.0:Data.JSString.Internal.Type.JSString\n    -- Defined in \u2018GHCJS.DOM.Types\u2019\n  instance GHCJS.DOM.Types.ToJSString\n             text-1.2.1.1:Data.Text.Internal.Text\n    -- Defined in \u2018GHCJS.DOM.Types\u2019\n  instance GHCJS.DOM.Types.ToJSString [Char]\n\n    -- Defined in \u2018GHCJS.DOM.Types\u2019\n ...\n</code></pre>\n\n<p>Why does the compiler care about the type? I passed it a Nothing value so the type of the Just value is not really relevant.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470170151, "post_id": 38728371, "comment_id": 64836201, "body": "Can the list associated with a node in the trie ever have more than one number - i.e. what would it mean if displaying the trie showed ` (c,(1,[2,3,4]))` ? Could it ever show ` (c,(1,[2,2,2,3]))` ? Isn&#39;t the number in the list simply the depth of the node in the trie?"}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470188555, "post_id": 38728371, "comment_id": 64842075, "body": "It could be. But the addTrieWithCounter will be placed in a special &quot;loop&quot; such &quot;all   alliances&quot; became: addTrieWithCounter ... &quot;all&quot; 0 -&gt; &quot;drop the spaces&quot; -&gt;  addTrieWithCounter ... &quot;alliances&quot; 3. So the occurrences will be aligned with the initial string."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1470212813, "post_id": 38733491, "comment_id": 64851114, "body": "you answer is nice and elegant and rich of good suggestions, but is not a direct answer to my question. I found the solution:  addTrieWithCounter tc f xs = aTwC tc f xs (length xs) .... aTwC (Trie m,st) f (x:xs) ln =   case M.lookup (Right x) m of     Nothing     -&gt; let (t&#39;,st&#39;) = addTrieWithCounter (Nil, st + ln - length xs ) f xs                    in (Trie $ M.insert (Right x) (f (0,[]) st,t&#39;) m, st&#39;)     Just (c,t)  -&gt; let (t&#39;,st&#39;) = addTrieWithCounter (t,st + ln - length xs) f xs                    in (Trie $ M.insert (Right x) (f c st,t&#39;) m,st&#39;)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470191980, "creation_date": 1470191980, "answer_id": 38733491, "question_id": 38728371, "link": "https://stackoverflow.com/questions/38728371/how-to-parametrize-a-constant-in-this-particular-recursive-function/38733491#38733491", "title": "How to parametrize a constant (in this particular recursive function)?", "body": "<p>This will get you most of the way there. It doesn't solve your\nexact problem, but shows how to remove the hard-coded length value.</p>\n\n<pre><code>import qualified Data.Map.Strict as M\nimport qualified Data.IntSet as S\nimport Data.Monoid\nimport Text.PrettyPrint hiding ((&lt;&gt;))\n\ndata GenTrie a b = Trie (M.Map a (b, GenTrie a b))\n  deriving (Show)\n\nemptyTrie = Trie M.empty\n\ndata Info = Info { _count :: Int, _positions :: S.IntSet }\n  deriving (Show)\n\ntype Trie = GenTrie Char Info\n\naddString :: Int -&gt; String -&gt; Trie -&gt; Trie\naddString i cs t = go t i cs\n  where\n    go :: Trie -&gt; Int -&gt; String -&gt; Trie\n    go t i []     = t\n    go t i (c:cs) = \n       let Trie m = t\n           pair =\n             case M.lookup c m of\n               Nothing        -&gt;\n                 let t2 = go emptyTrie (i+1) cs\n                     val = Info 1 (S.singleton i)\n                 in (val, t2)\n               Just (info,t1) -&gt;\n                 let t2 = go t1 (i+1) cs\n                     val = info { _count = _count info+1\n                                , _positions = S.insert i (_positions info)\n                                }\n                 in (val, t2)\n       in Trie (M.insert c pair m)\n\nprintTrie = putStrLn . showTrie\nshowTrie = render . trieToDoc\n\ntrieToDoc :: Trie -&gt; Doc\ntrieToDoc (Trie m)\n  | M.null m  = empty\n  | otherwise = \n      vcat $\n        do (ch, (info,t)) &lt;- M.assocs m\n           let count = show (_count info)\n               pos = show (S.toList (_positions info))\n           return $\n             vcat [ text [ch]  &lt;&gt; space &lt;&gt; text count &lt;&gt; space &lt;&gt; text pos\n                  , nest 4 (trieToDoc t)\n                  ]\n\ntest1 = printTrie $ addString 0 \"abc\" emptyTrie\ntest2 = printTrie $ addString 4 \"alts\" $ addString 0 \"all\" emptyTrie\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470214221, "post_id": 38738596, "comment_id": 64852010, "body": "You should find a way to remove the calls the <code>length xs</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470214716, "post_id": 38738596, "comment_id": 64852340, "body": "Note that <code>ln</code> is always equal to <code>length (x:xs)</code>, so you can replace <code>st+ln-length xs</code> with <code>st+1</code>. This is analogous to the <code>i+1</code> in my solution."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470221915, "post_id": 38738596, "comment_id": 64857104, "body": "Thank you. I&#39;ll make changes soon in my question. I&#39;ll improve my code in future thanks to your advices."}], "tags": [], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "is_accepted": true, "score": 0, "last_activity_date": 1470233381, "last_edit_date": 1470233381, "creation_date": 1470213641, "answer_id": 38738596, "question_id": 38728371, "link": "https://stackoverflow.com/questions/38728371/how-to-parametrize-a-constant-in-this-particular-recursive-function/38738596#38738596", "title": "How to parametrize a constant (in this particular recursive function)?", "body": "<pre><code>addTrieWithCounter (Trie m,st) f (x:xs) =\n  case M.lookup (Right x) m of\n    Nothing     -&gt; let (t',st') = addTrieWithCounter (Nil, st + 1 ) f xs\n                   in (Trie $ M.insert (Right x) (f (0,[]) st,t') m, st')\n    Just (c,t)  -&gt; let (t',st') = addTrieWithCounter (t,st + 1) f xs\n                   in (Trie $ M.insert (Right x) (f c st,t') m,st')\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 38738596, "answer_count": 2, "score": 0, "last_activity_date": 1470233381, "creation_date": 1470164036, "last_edit_date": 1470191493, "question_id": 38728371, "link": "https://stackoverflow.com/questions/38728371/how-to-parametrize-a-constant-in-this-particular-recursive-function", "title": "How to parametrize a constant (in this particular recursive function)?", "body": "<p>test1 correctly produces the following structure from the string \"abcdef\":</p>\n\n<pre><code>(a,(1,[0])) -- type 'a' occur 1 time in position 0\n    (b,(1,[1])) -- type 'b' occur 1 time in position 1\n        (c,(1,[2]))\n            (d,(1,[3]))\n                (e,(1,[4]))\n                    (f*,(1,[5])) -- type 'f' is the last of the list\n</code></pre>\n\n<p>But this result <strong>depends on the number 6</strong>, that is the length of a very particular class of string, <strong>invalid for general case</strong>.</p>\n\n<p>So if the string in test1 is instead \"abc\" the result is wrong:</p>\n\n<pre><code>(a,(1,[0]))\n    (b,(1,[7]))\n        (c*,(1,[8]))\n</code></pre>\n\n<p>If the string in test1 is instead \"abcdefgh\" the result is also wrong:</p>\n\n<pre><code>(a,(1,[0]))\n    (b,(1,[2])) -- Should be [1]\n        (c,(1,[3])) -- Should be [2]\n            (d,(1,[4])) -- ...\n                (e,(1,[5]))\n                    (f,(1,[6]))\n                        (g,(1,[7]))\n                            (h*,(1,[8]))\n</code></pre>\n\n<p>In addTrieWithCounter I'm not able to substitue this constant <strong>(6)</strong> with a <code>parameterized function on the length of the word</code>.</p>\n\n<p><strong>The CONTEXT of this function.</strong> The addTrieWithCounter will be placed in a special \"loop\" such \"al alts\" becames: addTrieWithCounter ... \"al\" 0 -> \"drop the space\" -> addTrieWithCounter ... \"alts\" 3. So the occurrences will be aligned with the initial string.</p>\n\n<pre><code>-- analyzing \"all alts\" should be obtained this result.\n(a,(2,[4,0])) --  type 'a' occur 2 times in positions 3 and 0 (reversed order)\n    (l,(2,[5,1])) --  type 'l' (of seq \"al\") occur 2 times in positions 4 and 1 (reversed order)\n        (l*,(1,[2]))  --  type 'l' (of seq \"all\") occur 1 time in positions 2\n        (t,(1,[6])) -- type 't' (of seq \"alt\") occur 1 time in positions 6\n            (s*,(1,[7])) -- type 's' (of seq \"alts\") occur 1 time in positions 7\n</code></pre>\n\n<p>It will be a trivial thing, but I have no idea.</p>\n\n<p>Thanks in advance for your suggestions.</p>\n\n<pre><code>import qualified Data.Map as M\nimport Text.PrettyPrint as TP\nimport Data.Either (either)\n\ndata Trie a b = Nil | Trie (M.Map (Either a a) (b, Trie a b)) deriving Show\n-- (Just a note: Trie will be a Monoid's instance. So with \"Either\" it is possible to distinguish the following cases: \"all\" and \"alliance\")\n\n-- add an element to a Trie\naddTrieWithCounter\n  :: Ord a =&gt;\n     (Trie a (Int, [t1]), Int)\n     -&gt; ((Int, [t1]) -&gt; Int -&gt; (Int, [t1]))\n     -&gt; [a]\n     -&gt; (Trie a (Int, [t1]), Int)\naddTrieWithCounter (t,st) f [] = (t,st)\naddTrieWithCounter (Nil,st) f xs = addTrieWithCounter (Trie M.empty, st) f xs\naddTrieWithCounter (Trie m,st) f [x] =\n  (Trie $ M.insertWith (\\(c,_) _ -&gt; (f c st,Nil)) (Left x) (f (0,[]) st,Nil) m,st + 1)\naddTrieWithCounter (Trie m, st) f (x:xs) =\n  case M.lookup (Right x) m of -- !!!!! PROBLEM IN THE FOLLOWING LINE !!!!!\n    Nothing     -&gt; let (t',st') = addTrieWithCounter (Nil, 6 - length xs ) f xs \n                   in (Trie $ M.insert (Right x) (f (0,[]) st,t') m,st + 1)\n    Just (c,t)  -&gt; let (t',st') = addTrieWithCounter (t,st) f xs -- TO CHANGE\n                   in (Trie $ M.insert (Right x) (f c st',t') m,st')\n\nshowTrieS f (t,_) = showTrie f t\n\nshowTrie :: Show a =&gt; (Either t t -&gt; String) -&gt; Trie t a -&gt; Doc\nshowTrie _ Nil = empty\nshowTrie f (Trie m)\n  | M.null m = empty\n  | otherwise =\n    vcat $\n      do (k,(count,t)) &lt;- M.assocs m\n         return $\n           vcat [ lparen TP.&lt;&gt; text (f k) TP.&lt;&gt; comma TP.&lt;&gt; (text . show $ count) TP.&lt;&gt; rparen\n                , nest 4 (showTrie f t)\n                ]\n\ntest1 = showTrieS f1  t \n  where\n  f1 = (either (:\"*\") (:\"\"))\n  t = addTrieWithCounter (Trie M.empty,0) f2 \"abcdef\"\n  f2 (cr,poss) st = ((cr + 1),(st : poss))\n</code></pre>\n"}, {"tags": ["haskell", "composition", "monad-transformers"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1470162765, "post_id": 38727850, "comment_id": 64831970, "body": "What is <code>IO Maybe T</code>?  That looks like a kind error."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1470165429, "post_id": 38727850, "comment_id": 64833614, "body": "@augustss IO (Maybe anyRandomType)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1470165638, "post_id": 38727850, "comment_id": 64833725, "body": "Well, edit the question post then. At the moment it&#39;s pretty unreadable."}], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1470163493, "post_id": 38727984, "comment_id": 64832418, "body": "How does MaybeT know wether the operation succeeded or not if it has not been run?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1470164273, "post_id": 38727984, "comment_id": 64832918, "body": "Answer updated for the operator. Both <code>MaybeT</code> and <code>runMaybeT</code> really don&#39;t change anything about the IO-action except for its type. <code>MaybeT</code> sets things up so that <code>&gt;&gt;=</code> will add the glue logic to handle the Nothing case and to wrap return values with Just. <code>runMaybeT</code> casts it back to an IO-action so that it can be run in <code>main</code>. Nothing really happens until the IO-action is executed when it is part of <code>main</code>."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1470164398, "post_id": 38727984, "comment_id": 64832986, "body": "Thank you. Unfortunately, the functions are from ghcjs-dom so I can&#39;t easily change them."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1470176187, "post_id": 38727984, "comment_id": 64838990, "body": "@2426021684 You could make a wrapper package <code>ghcjs-dom-maybeT</code> and the internet will rejoice."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 11, "last_activity_date": 1470177031, "last_edit_date": 1470177031, "creation_date": 1470162637, "answer_id": 38727984, "question_id": 38727850, "link": "https://stackoverflow.com/questions/38727850/how-to-deal-with-an-io-maybe-io-maybe-t-type/38727984#38727984", "title": "How to deal with an IO (Maybe (IO (Maybe t))) type?", "body": "<p>From what I understand, you have:</p>\n\n<pre><code>a :: IO (Maybe X)\nb :: X -&gt; IO (Maybe Y)\n</code></pre>\n\n<p>There is a close relationship between <code>IO (Maybe a)</code> and <code>MaybeT IO a</code>, namely <code>MaybeT</code> converts one to the other:</p>\n\n<pre><code>MaybeT :: IO (Maybe a) -&gt; MaybeT IO a\n</code></pre>\n\n<p>and the inverse operation is just <code>runMaybeT</code>:</p>\n\n<pre><code>runMaybeT :: MaybeT IO a -&gt; IO (MaybeT a)\n</code></pre>\n\n<p>In the MaybeT monad the composition you want to perform is just\nthe bind operation:</p>\n\n<pre><code>MaybeT a &gt;&gt;= (\\x -&gt; MaybeT (b x)) :: MaybeT IO Y\n</code></pre>\n\n<p>This results in a value of type <code>MaybeT IO Y</code>. To convert it back to a <code>IO (Maybe Y)</code> just use <code>runMaybeT</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is an operator to \"compose\" <em>a</em> and <em>b</em>:</p>\n\n<pre><code>andThen :: IO (Maybe a) -&gt; (a -&gt; IO (Maybe b)) -&gt; IO (Maybe b)\nandThen a b = runMaybeT $  MaybeT a &gt;&gt;= (\\x -&gt;  MaybeT (b x) )\n</code></pre>\n\n<p>However, if you find yourself using this operator a lot, perhaps you\nshould rework your functions so you work primarily in the <code>MaybeT IO</code>\nmonad, and then you can just use <code>&gt;&gt;=</code> with a single <code>runMaybeT</code>\non the outside.</p>\n"}, {"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1470164774, "post_id": 38728527, "comment_id": 64833202, "body": "So your answer works the same as ErikR&#39;s but works for all monads? Which answer should I use?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1470167186, "post_id": 38728527, "comment_id": 64834603, "body": "Mine doesn&#39;t work on any monad, one needs to be traversable which is the case form Maybe, List etc ... Use whichever suit you. If you have lots of case like that, you probably should go with MaybeT."}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 4, "last_activity_date": 1470164548, "creation_date": 1470164548, "answer_id": 38728527, "question_id": 38727850, "link": "https://stackoverflow.com/questions/38727850/how-to-deal-with-an-io-maybe-io-maybe-t-type/38728527#38728527", "title": "How to deal with an IO (Maybe (IO (Maybe t))) type?", "body": "<p>If you don't want to use <code>MaybeT</code> what you need is <code>sequenceA</code> or <code>traverse</code> from <code>Data.Traversable</code>.</p>\n\n<pre><code>Prelude Data.Traversable Control.Monad&gt; :t fmap join . join . fmap sequenceA \n\nfmap join . join . fmap sequenceA\n  :: (Traversable m, Control.Applicative.Applicative f, Monad m,\n      Monad f) =&gt;\n      f (m (f (m a))) -&gt; f (m a)\n</code></pre>\n\n<p>In your case f is IO and m Maybe.</p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 2, "accepted_answer_id": 38727984, "answer_count": 2, "score": 5, "last_activity_date": 1470196398, "creation_date": 1470162146, "last_edit_date": 1470196398, "question_id": 38727850, "link": "https://stackoverflow.com/questions/38727850/how-to-deal-with-an-io-maybe-io-maybe-t-type", "title": "How to deal with an IO (Maybe (IO (Maybe t))) type?", "body": "<p>I am dealing with a library (<code>ghcjs-dom</code>) in which every function returns an <code>IO (Maybe T)</code>.</p>\n\n<p>I have a function <code>a</code> with returns an <code>IO (Maybe x)</code> and function <code>b</code> which takes <code>x</code> as an argument and returns an <code>IO (Maybe y)</code>.</p>\n\n<p>Is an operator that lets me do <code>a ??? b</code> and get an <code>IO (Maybe y)</code>. My Hoogle search turned up nothing.</p>\n\n<p>I am looking something like <code>join</code> that works for <code>IO (Maybe (IO (Maybe t)))</code> instead of <code>IO (IO t)</code> or <code>Maybe (Maybe t)</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1470161979, "post_id": 38727738, "comment_id": 64831488, "body": "I don\u2019t think this is currently possible without the <code>ImpredicativeTypes</code> extension, which currently <a href=\"http://stackoverflow.com/q/33741334/465378\">doesn\u2019t really work</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1470163398, "post_id": 38727738, "comment_id": 64832355, "body": "@AlexisKing <code>ImpredicativeTypes</code> won&#39;t help you here. Impredicativity allows you to parameterise types by <code>forall</code>-quantified types, eg to make a <i>homogeneous</i> list of polymorphic functions. OP wants to build a <i>heterogeneous</i> list of monomorphic tuples."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1470163496, "post_id": 38727738, "comment_id": 64832422, "body": "@jonaprieto What are you trying to achieve? The simplest way is to build a sum type and do runtime case analysis on the values: <code>a :: [(Int, Either Bool String)]</code>"}, {"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470163741, "post_id": 38727738, "comment_id": 64832578, "body": "@BenjaminHodgson after here the comments, I decide to use a sum type, because actually, I have six types. Then, yes, I&#39;ll do the case analysis."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470167051, "post_id": 38727738, "comment_id": 64834524, "body": "@BenjaminHodgson Sure, but I wasn\u2019t thinking directly. OP specified \u201ca function depending on the type of the second value\u201d, which could become a typeclass with a method, which could then be used in a <code>forall</code> quantification using <code>ImpredicativeTypes</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1470161980, "creation_date": 1470161980, "answer_id": 38727813, "question_id": 38727738, "link": "https://stackoverflow.com/questions/38727738/tuples-with-different-types/38727813#38727813", "title": "Tuples with different types", "body": "<p><a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"noreferrer\">To a first approximation</a>, no, this is not possible. Normalize the values first, e.g. by applying some class-polymorphic function to each of the second arguments, before putting them in the tuples.</p>\n"}, {"tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 5, "last_activity_date": 1470226941, "last_edit_date": 1470226941, "creation_date": 1470172279, "answer_id": 38730528, "question_id": 38727738, "link": "https://stackoverflow.com/questions/38727738/tuples-with-different-types/38730528#38730528", "title": "Tuples with different types", "body": "<p>Just wrap the values in a sum-type. E.g.,</p>\n\n<pre><code>data StringOrBoolOrInt =\n  StringOrBoolOrInt_String String |\n  StringOrBoolOrInt_Bool Bool |\n  StringOrBoolOrInt_Int Int\n\na :: [(Int, StringOrBoolOrInt)]\na =\n  [\n    (1, StringOrBoolOrInt_String \"uno\"),\n    (2, StringOrBoolOrInt_Bool True),\n    (3, StringOrBoolOrInt_Int 5)\n  ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1470180808, "creation_date": 1470180808, "answer_id": 38732071, "question_id": 38727738, "link": "https://stackoverflow.com/questions/38727738/tuples-with-different-types/38732071#38732071", "title": "Tuples with different types", "body": "<p>As others have stated, as given, this problem has no solution. But your real problem is that your data is not described by a list of tuples - by definition, a list is homogenous (all elements contain the same type) while your data is heterogenous. </p>\n\n<p>If you want write a function depending on the type, you must store the type on the type level somehow.</p>\n\n<p>Your example data is actually described by the type <code>Prod ((,) Integer) '[String, Bool, Integer]</code>, where <code>Prod</code> is the following type:</p>\n\n<pre><code>data Prod f (xs :: [a]) where \n  P0 :: Prod f '[] \n  (:&gt;) :: f x -&gt; Prod f xs -&gt; Prod f (x ': xs) \n\ninfixr 5 :&gt;\n</code></pre>\n\n<p>or more generally <code>Prod ((,) Integer) xs</code> for some list of types <code>xs</code>. </p>\n\n<p>Your example value is then</p>\n\n<pre><code>a = (1, \"uno\") :&gt; (2, True) :&gt; (3, 5) :&gt; P0 \n</code></pre>\n\n<p>You can branch on these types using the normal methods - i.e. a type class. Supposing one has such a class:</p>\n\n<pre><code>class HasFoo x where \n  foo :: x -&gt; Integer \n\ninstance HasFoo String where foo = fromIntegral . length \ninstance HasFoo Bool where foo = fromIntegral . fromEnum \ninstance HasFoo Integer where foo = id \n</code></pre>\n\n<p>you can apply such a <code>foo</code> function to every element of your product</p>\n\n<pre><code>type family All (c :: k -&gt; Constraint) (xs :: [k]) :: Constraint where \n  All c '[] = () \n  All c (x ': xs) = (c x, All c xs) \n\n-- example operation: add everything \nfooProd :: All HasFoo xs \n        =&gt; Prod ((,) Integer) xs \n        -&gt; Integer \nfooProd P0 = 0 \nfooProd ((i, x) :&gt; ps) = i + foo x + fooProd ps \n</code></pre>\n\n<p>This requires some GHC extensions, at least <code>TypeFamilies</code>, <code>GADTs</code>, <code>ConstraintKinds</code>, <code>DataKinds</code>, <code>PolyKinds</code>. </p>\n"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 38730528, "answer_count": 3, "score": 1, "last_activity_date": 1470226941, "creation_date": 1470161758, "question_id": 38727738, "link": "https://stackoverflow.com/questions/38727738/tuples-with-different-types", "title": "Tuples with different types", "body": "<p>Is any way to have a list of pairs without the same types in Haskell and make a function traverse it. For example:</p>\n\n<pre><code>a = [(1, \"uno\"), (2, True), (3, 5)]\n</code></pre>\n\n<p>A want to apply a function depending on the type of the second value, something like a function that evaluates the combination of the pair <code>f :: [(Int, #)] -&gt; [a].</code> </p>\n"}, {"tags": ["haskell", "editor", "sublimetext3", "sublime-text-plugin"], "comments": [{"owner": {"reputation": 16941, "user_id": 814803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LUo4b.png?s=128&g=1", "display_name": "OdatNurd", "link": "https://stackoverflow.com/users/814803/odatnurd"}, "edited": false, "score": 0, "creation_date": 1470164926, "post_id": 38727118, "comment_id": 64833301, "body": "I don&#39;t think there&#39;s any way to make a plugin only active sometimes. The best you can accomplish in that vein is to have the plugin do as little as possible when it&#39;s not needed (i.e. it is up the SublimeHaskell to notice that there is no appropriate file open and do nothing). That said, if you use Windows you could have a couple of almost-identically configured portable versions installed side by side, but that&#39;s klunky and heavy weight."}, {"owner": {"reputation": 351, "user_id": 3341305, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/bafd74bb93e6da9be1e30131620159e4?s=128&d=identicon&r=PG", "display_name": "jaxuru", "link": "https://stackoverflow.com/users/3341305/jaxuru"}, "reply_to_user": {"reputation": 16941, "user_id": 814803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LUo4b.png?s=128&g=1", "display_name": "OdatNurd", "link": "https://stackoverflow.com/users/814803/odatnurd"}, "edited": false, "score": 0, "creation_date": 1470170516, "post_id": 38727118, "comment_id": 64836419, "body": "Thanks, I may just try to submit a pull request to SublimeHaskell, it should be straightforward given that I have other plugins a lot like SublimeHaskell that only activate when their relevant filetype is open (e.g. Omnisharp)"}], "owner": {"reputation": 351, "user_id": 3341305, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/bafd74bb93e6da9be1e30131620159e4?s=128&d=identicon&r=PG", "display_name": "jaxuru", "link": "https://stackoverflow.com/users/3341305/jaxuru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1470159640, "creation_date": 1470159640, "question_id": 38727118, "link": "https://stackoverflow.com/questions/38727118/sublime-text-only-enable-plugin-for-certain-filetypes", "title": "Sublime Text: Only enable plugin for certain filetypes", "body": "<p>I'm using Sublime Test 3 and the SublimeHaskell plugin, and I'm looking for a way to only enable SublimeHaskell for certain filetypes or when certain files are present in the project.</p>\n\n<p>One of the reasons SublimeText is so nice to use is how lightweight it is, supplying only what you need. Because of this, it feels a bit clunky to open sublime for something simple and non-haskell-related, like throwing together a script or something, and seeing that huge multi-core usage spike as Sublime Haskell inspects the database. It would be nice to have a preference option for ensuring Sublime Haskell only runs when a .hs file, or a folder/project with a .cabal file, is opened. I find myself disabling Sublime Haskell and only turning it on when I need it, which is really awkward.</p>\n\n<p>Does anybody know of any plugins or ways to configure Sublime Text to work in this way?</p>\n"}, {"tags": ["haskell", "graph-theory"], "comments": [{"owner": {"reputation": 18975, "user_id": 1539655, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/epO1x.jpg?s=128&g=1", "display_name": "levi", "link": "https://stackoverflow.com/users/1539655/levi"}, "edited": false, "score": 6, "creation_date": 1470152463, "post_id": 38724911, "comment_id": 64825790, "body": "what did you try."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "reply_to_user": {"reputation": 18975, "user_id": 1539655, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/epO1x.jpg?s=128&g=1", "display_name": "levi", "link": "https://stackoverflow.com/users/1539655/levi"}, "edited": false, "score": 0, "creation_date": 1470152510, "post_id": 38724911, "comment_id": 64825829, "body": "I have no idea how to do it"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1470152574, "post_id": 38724911, "comment_id": 64825877, "body": "why do you want to do it"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1470152733, "post_id": 38724911, "comment_id": 64826007, "body": "If you have literally no idea how to do this then first read a couple of Haskell tutorials / books."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1470152825, "post_id": 38724911, "comment_id": 64826073, "body": "leftaroundabout, i think there was another example and you didnt translate it into readable"}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": false, "score": 1, "last_activity_date": 1470289521, "creation_date": 1470289521, "answer_id": 38759290, "question_id": 38724911, "link": "https://stackoverflow.com/questions/38724911/representing-a-graph-as-two-lists-in-haskell/38759290#38759290", "title": "Representing a graph as two lists in Haskell", "body": "<p>I second the comment above that you should try to read more, but in case an example of how this problem might be solved would still be useful:</p>\n\n<p>This isn't directly related to your problem, but in general I would start by suggesting that you use a newtype for your node IDs and positions:</p>\n\n<pre><code>newtype Id = ID Int deriving (Eq, Ord)\ndata Point = Point Int Int\n</code></pre>\n\n<p>I would also suggest using a <code>Data.Map</code> to store this data, instead of an association list:</p>\n\n<pre><code>neighbors :: Map Id [Id]\npoints :: Map Id Point\n</code></pre>\n\n<p>Then this is a simple solution that decomposes this into (1) get the neighboring points and (2) adding this point to all of them.  This uses the <code>Maybe</code> monad to make composing things that might fail very nice and clean:    </p>\n\n<pre><code>neighborPoints :: Id -&gt; Maybe [Point]\nneighborPoints id = lookup id neighbors &gt;&gt;= sequence . map (flip lookup points)\n\nneighborPointsWithThisPoint :: Id -&gt; Maybe [(Point, Point)]\nneighborPointsWithThisPoint id = do\n  p &lt;- lookup points id\n  ps &lt;- neighborPoints id\n  pure $ zip (repeat p) ps\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": -7, "last_activity_date": 1470289521, "creation_date": 1470152303, "last_edit_date": 1470167788, "question_id": 38724911, "link": "https://stackoverflow.com/questions/38724911/representing-a-graph-as-two-lists-in-haskell", "title": "Representing a graph as two lists in Haskell", "body": "<p>I have a list like this:</p>\n\n<pre><code>[(1,1.0,0.0),(2,2.0,0.0),(3,2.0,1.0),(4,3.0,0.0),(5,3.0,1.0),(14,3.0,2.0),(6,4.0,0.0),(7,4.0,1.0),(13,4.0,2.0),(8,5.0,0.0),(9,5.0,1.0),(10,6.0,0.0),(11,6.0,1.0),(12,7.0,0.0)]\n</code></pre>\n\n<p>where the first element is a node ID, second is an <em>x</em>- and third a <em>y</em>-coordinate. </p>\n\n<p>A second list represents</p>\n\n<pre><code>[(1,[2,3]),(2,[4,5]),(3,[14]),(4,[6]),(5,[7]),(14,[6,7,13]),(6,[8]),(7,[9]),(13,[]),(8,[10]),(9,[11]),(10,[12]),(11,[12]),(12,[13])]`\n</code></pre>\n\n<p>where first element is the ID of this node, and the associated list contains successors of each node.</p>\n\n<p>I want to write a function which takes a node ID, returns the corresponding <em>x</em>, <em>y</em> of both the node itself and its successors.  for example: Node 1 yields</p>\n\n<blockquote>\n  <p>[(1.0,0.0,2.0,0.0),(1.0,0.0,2.0,1.0)]</p>\n</blockquote>\n\n<p>because Node 1 has successors 2(2.0,0.0) and 3(2.0,1.0)</p>\n\n<p>EDIT: </p>\n\n<p>I wrote functions :</p>\n\n<pre><code>pairs [] = []\npairs ((nodeId,nodesucc):xs) =  map (nodeId,) nodesucc : pairs xs\n\npairsConcat = concat $ pairs $ edg graph2\n</code></pre>\n\n<p>so now second list looks like:</p>\n\n<pre><code>[(1,2),(1,3),(2,4),(2,5),(3,14),(4,6),(5,7),(14,6),(14,7),(14,13),(6,8),(7,9),(8,10),(9,11),(10,12),(11,12),(12,13)]\n</code></pre>\n\n<p>how to create tuple with 4 elements? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1470136444, "post_id": 38718465, "comment_id": 64813783, "body": "Thank you! I was reading <code>forever</code> as a transformation of sorts, so it would return a <code>IO Int</code> (in this case) which I can then pull a value from. I&#39;ve moved that call to the output stream line and it works as intended! :)"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1470149075, "post_id": 38718465, "comment_id": 64823217, "body": "I&#39;ve been saying they should change it to <code>forever :: Monad m =&gt; m () -&gt; m Void</code>!"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1470152465, "post_id": 38718465, "comment_id": 64825793, "body": "&quot;You can talk till you&#39;re blue in the face...&quot;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1470155898, "post_id": 38718465, "comment_id": 64828055, "body": "@Gurkenglas, aside from the fact that doing so would break everyone&#39;s code, it would also have efficiency implications. <code>&lt;$</code> isn&#39;t always free. There are definitely times when requiring <code>()</code> would prevent mistakes (I ran face-first into that once), but it costs. Using <code>Void</code> instead of a polymorphic return type has no benefit that I can see."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470157686, "post_id": 38718465, "comment_id": 64829016, "body": "@dfeuer, in this case, <code>S.makeInputStream</code> would return a stream of Void, and the compiler would have told him he&#39;s trying to Show Void. () prevents the mistake of throwing away information unless you explicitly do fmap (const ()), and Void prevents its dual mistake of pulling information out of infinity unless you explicitly do fmap absurd."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1470174372, "post_id": 38718465, "comment_id": 64838285, "body": "If <code>forever</code> and similar devices didn&#39;t have a polymorphic return type, things like the pipes library would become impenetrable, since every application of <code>&gt;-&gt;</code> presupposes that the linked pipes or coroutines have the same return type. Thus typically in <code>p &gt;-&gt; q &gt;-&gt; r</code> all but one will be infinite; the result of the finite pipe is the result of the composed pipe, which is also finite. This arises by specialization."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1470174483, "post_id": 38718465, "comment_id": 64838348, "body": "Similarly wherever you can think of an <code>Alternative</code> instance having the character of &#39;racing&#39; the things given to <code>&lt;|&gt;</code>, <code>empty</code> will be like this, as will many natural terms. Thus in <code>async</code> we can write something like  <code>stillWorking = Concurrently (forever (threadDelay 100000 &gt;&gt; putStrLn &quot;Still working ...&quot;))</code> and <code>conc &lt;|&gt; stillWorking</code> will tell us that conc is working as long as it is. This again arises by simple specialization."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 6, "last_activity_date": 1470135247, "creation_date": 1470135247, "answer_id": 38718465, "question_id": 38718110, "link": "https://stackoverflow.com/questions/38718110/haskell-io-streams-and-forever-produces-no-output-to-stdout/38718465#38718465", "title": "Haskell io-streams and `forever` produces no output to stdout", "body": "<p>The meaning of the <code>forever</code> in your code is that it takes for ever to choose <em>each</em> value in the stream. Its type</p>\n\n<pre><code>forever :: Monad m =&gt; m a -&gt; m b\n</code></pre>\n\n<p>is a big clue that a computation built with <code>forever</code> never returns a value: the caller of <code>forever</code> gets to pick the type <code>b</code> arbitrarily, so no program can actually promise to deliver a value of that type. That's also why your program typechecks. The computation you pass to <code>forever</code> is repeatedly executed for its effect (in this case, choosing a random number), but no value is ever delivered, hence the stream never gets going.</p>\n\n<p>You shouldn't need a <code>forever</code> to make a stream that keeps going. The behaviour of <code>makeInputStream</code> is to run its argument computation each time a value is demanded from the stream, so you've got your repetition there already.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 38718465, "answer_count": 1, "score": 2, "last_activity_date": 1470135247, "creation_date": 1470134156, "question_id": 38718110, "link": "https://stackoverflow.com/questions/38718110/haskell-io-streams-and-forever-produces-no-output-to-stdout", "title": "Haskell io-streams and `forever` produces no output to stdout", "body": "<p>If I run this program, I get no output to <code>stdout</code>:</p>\n\n<pre><code>import Control.Monad (forever)\nimport qualified System.IO.Streams as S\nimport System.Random (randomRIO)\n\nmain :: IO ()\nmain = do\n  is &lt;- S.makeInputStream $ forever $ (randomRIO (1, 100) :: IO Int)\n  os &lt;- printStream =&lt;&lt; S.read is\n  return ()\n\nprintStream :: Maybe Int -&gt; IO ()\nprintStream Nothing  = putStrLn \"Nada!\"\nprintStream (Just a) = putStrLn $ show a\n</code></pre>\n\n<p>I have tried setting buffering using <code>System.IO.hSetBuffering</code> to <code>LineBuffering</code> and <code>NoBuffering</code> but still no output. I've tried <code>cat | ~/local/bin/program | cat</code> but again, nothing in stdout.</p>\n"}, {"tags": ["json", "haskell", "scotty"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1470138466, "post_id": 38717276, "comment_id": 64815189, "body": "<code>move</code> is just a regular function producing a <code>Rectange</code>, but you use it in a do block where an <code>ActionT Text IO</code> is required. I&#39;m guess you wanted a let statment: <code>let newRectanlge = move ...</code>"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470143972, "post_id": 38717276, "comment_id": 64819251, "body": "yes this fixed the problem, thank you"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 655, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1470133706, "creation_date": 1470131816, "last_edit_date": 1470133706, "question_id": 38717276, "link": "https://stackoverflow.com/questions/38717276/haskell-rest-service-with-scotty-convert-json-back-to-to-data", "title": "Haskell REST Service with Scotty: Convert JSON back to to Data", "body": "<p>I built a REST Service with Haskell and Scotty and have the following code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Main where\n\nimport Data.Monoid ((&lt;&gt;))\nimport Data.Aeson (FromJSON, ToJSON)\nimport Data.Text.Lazy\nimport GHC.Generics\nimport Web.Scotty\n\ndata Point = Point { x :: Int, y :: Int } deriving (Generic, Show)\ninstance ToJSON Point\ninstance FromJSON Point\nmovePoint :: Point -&gt; Int -&gt; Int -&gt; Point\nmovePoint (Point x y) dx dy = Point (x + dx) (y + dy)\n\ndata Rectangle = Rectangle { width :: Int, height :: Int, point :: Point } deriving (Generic, Show)\ninstance ToJSON Rectangle\ninstance FromJSON Rectangle\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {point = p}) dx dy = r { point = movePoint p dx dy }\n\nmain = do\n  putStrLn \"Starting Server...\"\n  scotty 3000 $ do\n    get \"/rectangle/:id\" $ do\n      id &lt;- param \"id\"      \n      text id\n\n    post \"/rectangle\" $ do\n      rectangle &lt;- jsonData :: ActionM Rectangle\n      json rectangle    \n\n    post \"rectangle/move/:dx/:dy\" $ do      \n      dx &lt;- param \"dx\"\n      dy &lt;- param \"dy\"\n      rectangle &lt;- jsonData :: ActionM Rectangle\n      move rectangle dx dy\n      json rectangle\n</code></pre>\n\n<p>When compiling i get this error:</p>\n\n<pre><code>Couldn't match expected type `Web.Scotty.Internal.Types.ActionT\n                                    Text IO a0'\n                with actual type `Rectangle'\n    In a stmt of a 'do' block: move rectangle dx dy\n    In the second argument of `($)', namely\n      `do { dx &lt;- param \"dx\";\n            dy &lt;- param \"dy\";\n            rectangle &lt;- jsonData :: ActionM Rectangle;\n            move rectangle dx dy;\n            .... }'\n</code></pre>\n\n<p>What am i missing? I would like to call the \"move\" function and then send the moved rectangle back...</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470132316, "post_id": 38716977, "comment_id": 64811051, "body": "Your given regular expression does not quite fit your specification. Remember that <code>*</code> consumes characters greedily. You want <code>.*?!</code>, which consumes the fewest possible characters until it encounters a <code>!</code>, or (my preference) <code>[^!]*!</code>, which consumes any character except <code>!</code> followed by <code>!</code>"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470143951, "post_id": 38716977, "comment_id": 64819226, "body": "What is the correct syntax to write <code>only accept some character at the end of this string</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470159255, "post_id": 38716977, "comment_id": 64829811, "body": "If you want the string to be <i>ended</i> by the <code>!</code> you need to use <code>$</code>, which matches EOL. <code>[^!]*!$</code>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470180293, "post_id": 38716977, "comment_id": 64840189, "body": "Are you looking for <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec.html#v:eof\" rel=\"nofollow noreferrer\"><b>eof</b></a>? e.g. <code>endWith x = many anyChar &gt;&gt; char x &gt;&gt; eof</code> ?"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1470180469, "post_id": 38716977, "comment_id": 64840231, "body": "It should not consume characters if the end character does not match. I suppose <code>many anyChar</code> would consume characters anyway."}], "answers": [{"comments": [{"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1470143376, "post_id": 38717395, "comment_id": 64818764, "body": "Would it parse <code>ab!cd!</code> as <code>(&quot;ab!&quot;, &quot;cd!&quot;)</code> or <code>(&quot;ab!cd!&quot;, &quot;&quot;)</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1470159209, "post_id": 38717395, "comment_id": 64829792, "body": "The former, I should think. Why don&#39;t you test it?"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 1, "creation_date": 1470178493, "post_id": 38717395, "comment_id": 64839733, "body": "As my haskell envirnoment was not available at that time. it is the former one, which is not my expected one. :("}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1470132159, "creation_date": 1470132159, "answer_id": 38717395, "question_id": 38716977, "link": "https://stackoverflow.com/questions/38716977/is-there-any-way-to-express-end-with-in-parsec/38717395#38717395", "title": "Is there any way to express end with in Parsec?", "body": "<p><a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Combinator.html#v:manyTill\" rel=\"nofollow\"><code>manyTill</code></a> does this.</p>\n\n<pre><code>endWith :: Char -&gt; Parser String\nendWith x = anyChar `manyTill` char x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1470186923, "post_id": 38732153, "comment_id": 64841731, "body": "What is the difference between <code>fail &quot;expecting&quot;</code> and <code>return ()</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 1, "creation_date": 1470187871, "post_id": 38732153, "comment_id": 64841924, "body": "<code>return ()</code> succeeds with the value <code>()</code>; <code>fail ...</code> fails the parse with the given error message. if there are alternatives (i.e. created with <code>&lt;|&gt;</code>) then Parsec will backtrack and explore those possibilities. If there are no alternatives parsing fails with the specified message."}, {"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 0, "creation_date": 1502413320, "post_id": 38732153, "comment_id": 78210563, "body": "The manyTill solution below is more general (the last expression can be longer than a single character), simpler, and faster. Building a list and then traversing to the end of it to run a test is slow."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1470181320, "creation_date": 1470181320, "answer_id": 38732153, "question_id": 38716977, "link": "https://stackoverflow.com/questions/38716977/is-there-any-way-to-express-end-with-in-parsec/38732153#38732153", "title": "Is there any way to express end with in Parsec?", "body": "<p>Is this what you are looking for?</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nendWith :: Char -&gt; Parser String\nendWith x = do cs &lt;- many anyChar -- consume rest of input\n               case cs of\n                 [] -&gt; fail \"expecting !\"\n                 _  -&gt; if last cs == '!' then return cs\n                                         else fail \"did not end in !\"\n\ntest1 = parseTest (endWith '!') \"This is a test!\"\ntest2 = parseTest (endWith '!') \"ab!cd!\"\ntest3 = parseTest (endWith '!') \"ab!cd\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1470199842, "creation_date": 1470199842, "answer_id": 38734638, "question_id": 38716977, "link": "https://stackoverflow.com/questions/38716977/is-there-any-way-to-express-end-with-in-parsec/38734638#38734638", "title": "Is there any way to express end with in Parsec?", "body": "<p>Here's one that successfully parses both <code>\"ab!\"</code> and <code>\"ab!cd!\"</code>, but rejects <code>\"ab\"</code> and <code>\"ab!cd\"</code>:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\nendWith :: Char -&gt; Parser String\nendWith c = manyTill anyChar (try $ char c &lt;* eof)\n</code></pre>\n\n<p>(note that the result returned doesn't include the trailing <code>c</code>):</p>\n\n<pre><code>\"ab!\"      Succeeds with \"ab\"\n\"ab!cd!\"   Succeeds with \"ab!cd\"\n\"ab\"       Fails\n\"ab!cd\"    Fails\n</code></pre>\n"}], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 38732153, "answer_count": 3, "score": 0, "last_activity_date": 1470199842, "creation_date": 1470131020, "last_edit_date": 1470179573, "question_id": 38716977, "link": "https://stackoverflow.com/questions/38716977/is-there-any-way-to-express-end-with-in-parsec", "title": "Is there any way to express end with in Parsec?", "body": "<p>I am trying to implement some parse function which only accept some specific character at the end of this string which would be <code>.*!$</code> if the give character is <code>!</code> using regular expression.</p>\n\n<p>I have tried to use the following function, but it does not work, as it will consume characters before matching the end.</p>\n\n<pre><code>endWith :: Char -&gt; Parser ()\nendWith x = many anyChar &gt;&gt; char x &gt;&gt; return ()\n</code></pre>\n\n<p>One thing to note is: the expected output for <code>\"ab!cd!\"</code> is <code>(\"ab!cd!\", \"\")</code> and <code>\"ab!cd\"</code> should not be consumed by this parser at all, as it is not end with <code>!</code>. The all or northing is very important when using <code>&lt;|&gt;</code></p>\n\n<p>Is it possible using Parsec? I suppose some advanced combination is in need.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1470140680, "post_id": 38714454, "comment_id": 64816851, "body": "FYI, <code>zipWith ($) (cycle [(2*), id])</code> works too and is probably more efficient (no need to compute <code>mod</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 0, "creation_date": 1470124574, "post_id": 38714539, "comment_id": 64806140, "body": "Thanks. Does the type (Integer) have to be specified?"}, {"owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "reply_to_user": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "edited": false, "score": 0, "creation_date": 1470125396, "post_id": 38714539, "comment_id": 64806597, "body": "@user245954 No, it does not. The <code>mod</code> function helps the compiler with inferring the type here: <code>mod :: (Integral a) =&gt; a -&gt; a -&gt; a</code>. In other words, it doesn&#39;t matter what kind of type you put there, as long as it is integral, but this constraint is already enforces by the function passed by <code>zipWith</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "edited": false, "score": 0, "creation_date": 1470129785, "post_id": 38714539, "comment_id": 64809372, "body": "@Undreren I disagree. The type of <code>mod</code> does not unambiguously define the type of <code>1</code>, so without an annotation GHC has to apply a default which might be different from <code>Integer</code>."}, {"owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470130554, "post_id": 38714539, "comment_id": 64809886, "body": "@chi It might, but it won&#39;t matter. It runs fine in GHCi without it. I tested it before writing the comment."}], "tags": [], "owner": {"reputation": 63078, "user_id": 220147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3881a28fe402dd2d1de44717486cae8?s=128&d=identicon&r=PG", "display_name": "Michael Kohl", "link": "https://stackoverflow.com/users/220147/michael-kohl"}, "is_accepted": true, "score": 5, "last_activity_date": 1470123759, "creation_date": 1470123759, "answer_id": 38714539, "question_id": 38714454, "link": "https://stackoverflow.com/questions/38714454/indexing-list-elements-in-haskell/38714539#38714539", "title": "Indexing list elements in Haskell", "body": "<p><code>[(1::Integer)..]</code> is the list of all integers, starting from 1. The <code>::Integer</code> specifies the type.</p>\n\n<p>For the rest of your question: The elements from <code>[(1::Integer)..]</code> will become the values of <code>x</code>. The list that the function <code>doubleEveryOther</code> will be called with will provide the values for <code>y</code>. So the first list is basically just used as a 1-based index.</p>\n"}], "owner": {"reputation": 1085, "user_id": 5007499, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/100000055026531/picture?type=large", "display_name": "Liumx31", "link": "https://stackoverflow.com/users/5007499/liumx31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 38714539, "answer_count": 1, "score": 0, "last_activity_date": 1470123759, "creation_date": 1470123476, "question_id": 38714454, "link": "https://stackoverflow.com/questions/38714454/indexing-list-elements-in-haskell", "title": "Indexing list elements in Haskell", "body": "<p>I was looking at <a href=\"https://github.com/evansb\" rel=\"nofollow\">@evansb</a>'s solution to a homework problem in <a href=\"http://www.seas.upenn.edu/~cis194\" rel=\"nofollow\">CIS 194</a>. Basically, the problem asks to double every other element in a list and Evan's solution is this:</p>\n\n\n\n<pre><code>-- Exercise 3 -----------------------------------------\n\n-- Double every second number in a list starting on the left.\ndoubleEveryOther :: [Integer] -&gt; [Integer]\ndoubleEveryOther = zipWith\n  (\\x y -&gt; if x `mod` 2 == 0 then y * 2 else y) [(1::Integer)..]\n</code></pre>\n\n<p>I am kind of confused about <code>(1::Integer)</code>, does <code>1</code>reference the first index? So in the lambda function <code>x</code> corresponds to the index and <code>y</code> corresponds to the actual element at that index?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "category-theory"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470099729, "post_id": 38710154, "comment_id": 64797990, "body": "What do you mean by &quot;using two separate monads&quot;? Can you give an example?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1470099844, "post_id": 38710154, "comment_id": 64798011, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/2769487/mtl-transformers-monads-fd-monadlib-and-the-paradox-of-choice\">mtl, transformers, monads-fd, monadLib, and the paradox of choice</a>"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1470099917, "post_id": 38710154, "comment_id": 64798032, "body": "I&#39;ve voted to close because it really does sound like you&#39;re asking for the difference between different monad transformer libraries, and that question already has an excellent answer.  If you think that your question is different, perhaps you could elaborate."}, {"owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "edited": false, "score": 0, "creation_date": 1470100357, "post_id": 38710154, "comment_id": 64798124, "body": "My question is really a theoretical one: what do monad transformers do, regardless of library choice, that stacking monads doesn&#39;t. By stacking monads, I mean having a type like (Writer w ([a])), where you have two monadic type constructors. I&#39;m more interested in a category-theoretic answer than anything that pertains particularly to Haskell."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1470101164, "post_id": 38710154, "comment_id": 64798290, "body": "Well - the List monad is kind of special because any expression which is a list is also a value in the List monad. Try to &quot;stack&quot; Writer and IO - <code>Writer w (IO a)</code> is a value in the <code>Writer</code> monad returning an <code>IO a</code> - and that&#39;s different from <code>WriterT w IO a</code> - which is a value in the <code>WriterT w IO</code> monad returning an <code>a</code>."}, {"owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "edited": false, "score": 1, "creation_date": 1470101706, "post_id": 38710154, "comment_id": 64798387, "body": "hmm, IO is also maybe not the best example. What about (Writer w (Maybe a)) vs (MaybeT (Writer w) a)? These are, I think, the same type, mutatis mutandis, and act the same too."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1470106897, "post_id": 38710154, "comment_id": 64799460, "body": "A monad transformer is simply a type <code>t</code> for which <code>t m</code> is a <code>Monad</code> for any <code>Monad</code> m. However, it is not true, in general, that the composition of two monads is a monad - because of this, there aren&#39;t many abstract operations (if any at all) that can be defined in terms of the composition of two monads (and without abstraction, programming in Haskell with monads would be very tedious). It is simply a coincidence that most of the transformers commonly encountered compositions of monads (i.e. <code>WriterT x m</code> is <code>Compose m (x,)</code>)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470107891, "post_id": 38710154, "comment_id": 64799630, "body": "@user2407038 I&#39;m not sure it&#39;s a coincidence that most of the transformers end up looking like composition. The easiest way to make one is roughly to see that <b>for some particular monad</b> its composition with any other monad will be a monad. The idea that we can do that with particular monads (with implementation specific to that monad) but not for all is basically where transformers came from. You&#39;re right that it&#39;s not <i>necessary</i>, but it&#39;s not a coincidence."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1470110371, "post_id": 38710154, "comment_id": 64800132, "body": "@user2407038, there are also laws relating to <code>lift</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470136277, "post_id": 38710154, "comment_id": 64813659, "body": "Related: <a href=\"http://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\" title=\"applicatives compose monads dont\">stackoverflow.com/questions/7040844/&hellip;</a>"}, {"owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 1, "creation_date": 1472900336, "post_id": 38710154, "comment_id": 65945157, "body": "&quot;To give a little context...&quot; Reuben, you may be interested in this: <a href=\"http://nasslli.jimpryor.net/\" rel=\"nofollow noreferrer\">nasslli.jimpryor.net</a>. Sorry, I know this isn&#39;t a message board but I didn&#39;t see any way to privately contact you. I&#39;ll delete this comment after I know (or can reasonably expect) that you&#39;ve seen it."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1470119923, "post_id": 38711118, "comment_id": 64803407, "body": "Might be interesting to note that it&#39;s still almost the composition, you just have to move the composition under the fixed point: <code>List a = Fix (1 + a * x)</code> and <code>ListT m a = Fix (m \u2218 (1 + a * x))</code>"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1525891743, "post_id": 38711118, "comment_id": 87538303, "body": "I don&#39;t think anyone knows an explicit example of a monad that has no transformer. IO and ST monads are opaque - they are not given as explicit type expressions, they are implemented somehow at low level by the library. All known explicit monads have transformers, but I don&#39;t think anyone knows why."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1551748332, "post_id": 38711118, "comment_id": 96744847, "body": "Actually I might have two examples of monads that appear to have no transformers (but I don&#39;t know how to prove that they don&#39;t have transformers, so I might be wrong here).  My examples are <code>type C r a = Either a ((a -&gt; r) -&gt; r)</code> and <code>type D r a = Either a ((a -&gt; Bool) -&gt; Maybe a)</code>."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1551748654, "post_id": 38711118, "comment_id": 96744929, "body": "Generally, monad transformers can be classified in 5 different families. 1) functor composition in one or another order (EitherT, WriterT, ReaderT and <code>Q a = (h a) -&gt; a</code> where <code>h</code> is an arbitrary contrafunctor), 2) adjunction recipe (StateT, ContT), 3) recursive recipe (ListT, FreeT), 4) Cartesian product of monads, 5) free pointed monad <code>P a = Either a (m a)</code> where <code>m</code> is another monad. Among these, <code>ContT</code> do not admit the lifting of the base monad <code>Cont r a -&gt; ContT r a</code>, and so can&#39;t really be considered a fully featured monad transformer, and so are other monads constructed out of <code>Cont</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1470106882, "creation_date": 1470106882, "answer_id": 38711118, "question_id": 38710154, "link": "https://stackoverflow.com/questions/38710154/why-are-monad-transformers-different-to-stacking-monads/38711118#38711118", "title": "Why are monad transformers different to stacking monads?", "body": "<blockquote>\n  <p>What is an actual example of a monad with no corresponding transformer (this would help illustrate what transformers can do that just stacking monads can't).</p>\n</blockquote>\n\n<p><code>IO</code> and <code>ST</code> are the canonical examples here.</p>\n\n<blockquote>\n  <p>Are StateT and ContT the only transformers that give a type not equivalent to the composition of them with m, for an underlying monad m (regardless of which order they're composed.)</p>\n</blockquote>\n\n<p>No, <a href=\"http://hackage.haskell.org/package/list-t-0.4.7/docs/ListT.html\"><code>ListT m a</code></a> is not (isomorphic to) <code>[m a]</code>:</p>\n\n<pre><code>newtype ListT m a =\n  ListT { unListT :: m (Maybe (a, ListT m a)) }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "edited": false, "score": 0, "creation_date": 1470163939, "post_id": 38711192, "comment_id": 64832695, "body": "Thanks, this is helpful. But I think my question still stands. Suppose for add1_W, you wrote the following: add1_W e = do   x &lt;- e   return $ do     y &lt;- x     return $ y + 1  This is still more of a hassle than add1_M, but doesn&#39;t require any case statements, and uses both the maybe and writer monads."}, {"owner": {"reputation": 436, "user_id": 373801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90df2000e13ae46ac1b5aa23833120c5?s=128&d=identicon&r=PG", "display_name": "Ryan", "link": "https://stackoverflow.com/users/373801/ryan"}, "edited": false, "score": 0, "creation_date": 1488385913, "post_id": 38711192, "comment_id": 72209850, "body": "One small correction: in add1_M I believe you mean <code>return (x+1)</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 22, "last_activity_date": 1514604842, "last_edit_date": 1514604842, "creation_date": 1470107497, "answer_id": 38711192, "question_id": 38710154, "link": "https://stackoverflow.com/questions/38710154/why-are-monad-transformers-different-to-stacking-monads/38711192#38711192", "title": "Why are monad transformers different to stacking monads?", "body": "<p>To answer you question about the difference between <code>Writer w (Maybe a)</code> vs <code>MaybeT (Writer w) a</code>, let's start by taking a look at the definitions:</p>\n\n<pre><code>newtype WriterT w m a = WriterT { runWriterT :: m (a, w) }\ntype Writer w = WriterT w Identity\n\nnewtype MaybeT m a = MaybeT { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>Using <code>~~</code> to mean \"structurally similar to\" we have:</p>\n\n<pre><code>Writer w (Maybe a)  == WriterT w Identity (Maybe a)\n                    ~~ Identity (Maybe a, w)\n                    ~~ (Maybe a, w)\n\nMaybeT (Writer w) a ~~ (Writer w) (Maybe a)\n                    == Writer w (Maybe a)\n                    ... same derivation as above ...\n                    ~~ (Maybe a, w)\n</code></pre>\n\n<p>So in a sense you are correct -- structurally both <code>Writer w (Maybe a)</code> and <code>MaybeT (Writer w) a</code>\nare the same - both are essentially just a pair of a Maybe value and a <code>w</code>.</p>\n\n<p>The difference is how we treat them as monadic values.\nThe <code>return</code> and <code>&gt;&gt;=</code> class functions do very different things depending \non which monad they are part of.</p>\n\n<p>Let's consider the pair <code>(Just 3, []::[String])</code>. Using the association\nwe have derived above here's how that pair would be expressed in both monads: </p>\n\n<pre><code>three_W :: Writer String (Maybe Int)\nthree_W = return (Just 3)\n\nthree_M :: MaybeT (Writer String) Int\nthree_M = return 3\n</code></pre>\n\n<p>And here is how we would construct a the pair <code>(Nothing, [])</code>:</p>\n\n<pre><code>nutin_W :: Writer String (Maybe Int)\nnutin_W = return Nothing\n\nnutin_M :: MaybeT (Writer String) Int\nnutin_M = MaybeT (return Nothing)   -- could also use mzero\n</code></pre>\n\n<p>Now consider this function on pairs:</p>\n\n<pre><code>add1 :: (Maybe Int, String) -&gt; (Maybe Int, String)\nadd1 (Nothing, w) = (Nothing w)\nadd1 (Just x, w)  = (Just (x+1), w)\n</code></pre>\n\n<p>and let's see how we would implement it in the two different monads:</p>\n\n<pre><code>add1_W :: Writer String (Maybe Int) -&gt; Writer String (Maybe Int)\nadd1_W e = do x &lt;- e\n             case x of\n               Nothing -&gt; return Nothing\n               Just y  -&gt; return (Just (y+1))\n\nadd1_M :: MaybeT (Writer String) Int -&gt; MaybeT (Writer String) Int\nadd1_M e = do x &lt;- e; return (e+1)\n  -- also could use: fmap (+1) e\n</code></pre>\n\n<p>In general you'll see that the code in the MaybeT monad is more concise.</p>\n\n<p>Moreover, semantically the two monads are very different...</p>\n\n<p><code>MaybeT (Writer w) a</code> is a Writer-action which can fail, and the failure is\nautomatically handled for you. <code>Writer w (Maybe a)</code> is just a Writer\naction which returns a Maybe. Nothing special happens if that Maybe value\nturns out to be Nothing. This is exemplified in the <code>add1_W</code> function where\nwe had to perform a case analysis on <code>x</code>.</p>\n\n<p>Another reason to prefer the <code>MaybeT</code> approach is that we can write code\nwhich is generic over any monad stack. For instance, the function:</p>\n\n<pre><code>square x = do tell (\"computing the square of \" ++ show x)\n              return (x*x)\n</code></pre>\n\n<p>can be used unchanged in any monad stack which has a Writer String, e.g.:</p>\n\n<pre><code>WriterT String IO\nReaderT (WriterT String Maybe)\nMaybeT (Writer String)\nStateT (WriterT String (ReaderT Char IO))\n...\n</code></pre>\n\n<p>But the return value of <code>square</code> does not type check against <code>Writer String (Maybe Int)</code> because <code>square</code> does not return a <code>Maybe</code>.</p>\n\n<p>When you code in <code>Writer String (Maybe Int)</code>, you code explicitly reveals\nthe structure of monad making it less generic. This definition of <code>add1_W</code>:</p>\n\n<pre><code>add1_W e = do x &lt;- e \n              return $ do \n                y &lt;- x \n                return $ y + 1\n</code></pre>\n\n<p>only works in a two-layer monad stack whereas a function like <code>square</code>\nworks in a much more general setting.</p>\n"}], "owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1268, "favorite_count": 3, "accepted_answer_id": 38711192, "answer_count": 2, "score": 21, "last_activity_date": 1514604842, "creation_date": 1470098705, "last_edit_date": 1470100725, "question_id": 38710154, "link": "https://stackoverflow.com/questions/38710154/why-are-monad-transformers-different-to-stacking-monads", "title": "Why are monad transformers different to stacking monads?", "body": "<p>In many cases, it isn't clear to me what is to be gained by combining two monads with a transformer rather than using two separate monads. Obviously, using two separate monads is a hassle and can involve do notation inside do notation, but are there cases where it just isn't expressive enough?</p>\n\n<p>One case seems to be StateT on List: combining monads doesn't get you the right type, and if you do obtain the right type via a stack of monads like Bar (where Bar a = (Reader r (List (Writer w (Identity a))), it doesn't do the right thing.</p>\n\n<p>But I'd like a more general and technical understanding of exactly what monad transformers are bringing to the table, when they are and aren't necessary, and why.</p>\n\n<p>To make this question a little more focused:</p>\n\n<ol>\n<li>What is an actual example of a monad with no corresponding transformer (this would help illustrate what transformers can do that just stacking monads can't).</li>\n<li>Are StateT and ContT the only transformers that give a type not equivalent to the composition of them with m, for an underlying monad m (regardless of which order they're composed.)</li>\n</ol>\n\n<p>(I'm not interested in particular implementation details as regards different choices of libraries, but rather the general (and probably Haskell independent) question of what monad transformers/morphisms are adding as an alternative to combining effects by stacking a bunch of monadic type constructors.)</p>\n\n<p>(To give a little context, I'm a linguist who's doing a project to enrich Montague grammar - simply typed lambda calculus for composing word meanings into sentences - with a monad transformer stack. It would be really helpful to understand whether transformers are actually doing anything useful for me.)</p>\n\n<p>Thanks,</p>\n\n<p>Reuben</p>\n"}, {"tags": ["haskell", "dom", "ghcjs", "ghcjs-dom"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470110239, "post_id": 38709212, "comment_id": 64800105, "body": "Where are these types documented?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470138803, "post_id": 38709212, "comment_id": 64815455, "body": "@dfeuer there is no documentation that I can find. I found some examples by googling &quot;ghcjs-dom&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "is_accepted": true, "score": 1, "last_activity_date": 1470120223, "last_edit_date": 1470120223, "creation_date": 1470102881, "answer_id": 38710656, "question_id": 38709212, "link": "https://stackoverflow.com/questions/38709212/filter-node-to-element-with-ghcjs-dom/38710656#38710656", "title": "Filter [Node] to [Element] with ghcjs-dom", "body": "<pre><code>import GHCJS.DOM.Types\nimport Data.Maybe (mapMaybe)\n\nnodeToElement :: Node -&gt; Maybe Element\nnodeToElement node = if node `isA` gTypeElement\n                     then Just $ castToElement node\n                     else Nothing\n\nnodesToElements :: [Node] -&gt; [Element]\nnodesToElements = mapMaybe nodeToElement\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "accepted_answer_id": 38710656, "answer_count": 1, "score": 0, "last_activity_date": 1470708726, "creation_date": 1470091477, "last_edit_date": 1470708726, "question_id": 38709212, "link": "https://stackoverflow.com/questions/38709212/filter-node-to-element-with-ghcjs-dom", "title": "Filter [Node] to [Element] with ghcjs-dom", "body": "<p>I am using ghcjs-dom. How can I filter the elements out of an array of nodes?</p>\n\n<pre><code>import GHCJS.DOM.Types\n\nnodesToElements :: [Node] -&gt; [Element]\nnodesToElements = ??\n</code></pre>\n\n<p>or</p>\n\n<pre><code>nodesToElements :: [Node] -&gt; IO [Element]\nnodesToElements = ??\n</code></pre>\n"}, {"tags": ["haskell", "io", "ghci"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1470087010, "post_id": 38708386, "comment_id": 64794417, "body": "The REPL prints results of expressions and <code>IO</code> actions, but when you run something normally and don\u2019t use its result, it\u2019s just\u2026 unused. It doesn\u2019t get printed or anything."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1470087411, "post_id": 38708386, "comment_id": 64794565, "body": "Expanding upon @AlexisKing, the REPL more or less does <code>do { line &lt;- getLine ; print line}</code>. So since in your code you neither save nor print the result of <code>mapM</code> then you will not ever see the <code>[(),()]</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1470087444, "post_id": 38708386, "comment_id": 64794572, "body": "Consider using <code>mapM_</code>."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1470088157, "post_id": 38708386, "comment_id": 64794874, "body": "ahh i see, than you! In any case using mapM_ is better since I do not need to build the list."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1470120483, "last_edit_date": 1470120483, "creation_date": 1470092559, "answer_id": 38709368, "question_id": 38708386, "link": "https://stackoverflow.com/questions/38708386/result-of-mapm-in-haskell/38709368#38709368", "title": "result of MapM in haskell?", "body": "<blockquote>\n  <p>I thought <code>mapM</code> does not disregard the result</p>\n</blockquote>\n\n<p>You thought correctly. It is your code, and not <code>mapM</code>, that disregards the result; in particular,</p>\n\n<pre><code>do\n    mapM putStrLn numberedTasks\n    postamble\n</code></pre>\n\n<p>gets desugared to <code>mapM putStrLn numberedTasks &gt;&gt; postamble</code>, and <code>(&gt;&gt;)</code> disregards the result of its left argument.</p>\n\n<blockquote>\n  <p>I do not quite understand why i don't see <code>[()..()]</code></p>\n</blockquote>\n\n<p>Actually, I suspect that what you don't understand is why you <em>do</em> see <code>[(),()]</code> in GHCi. This is because, although GHCi behaves a little bit like being in a giant <code>do</code> block, it is not quite. In particular it tries to show you partial results along the way. So GHCi is doing something special here: it is taking your action, running it, and <em>additionally</em> adding a <code>print</code> statement for the result of the action.</p>\n\n<p>If you would prefer not to see this printed out, there are several options; probably the best one is to replace <code>mapM</code> with <code>mapM_</code>; ghci has special code that avoids adding the <code>print</code> statement when the result of the <code>IO</code> action is <code>()</code>.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 1, "accepted_answer_id": 38709368, "answer_count": 1, "score": 1, "last_activity_date": 1470120483, "creation_date": 1470086758, "last_edit_date": 1470120370, "question_id": 38708386, "link": "https://stackoverflow.com/questions/38708386/result-of-mapm-in-haskell", "title": "result of MapM in haskell?", "body": "<p>When using mapM in interactive mode:\ncalling <code>mapM putStrLn [\"random\",\"Text\"]</code>\nthe output is</p>\n\n<blockquote>\n<pre><code>random\ntext\n[(),()]\n</code></pre>\n</blockquote>\n\n<p>however when i call the same function from a script and then run the script:</p>\n\n<pre><code>main = do        \n    handle &lt;- openFile \"todo.txt\" ReadMode  \n    (tempName, tempHandle) &lt;- openTempFile \".\" \"temp\"  \n    contents &lt;- hGetContents handle\n    let todoTasks = lines contents\n        numberedTasks = zipWith (\\n line -&gt; show n ++ \"-\" ++ line) [0..] todoTasks      \n    putStrLn \"These are your TO-DO items:\"  \n    mapM putStrLn numberedTasks -- &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HERE &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n    putStrLn \"Which one do you want to delete?\"     \n    numberString &lt;- getLine     \n    let number = read numberString     \n        newTodoItems = delete (todoTasks !! number) todoTasks     \n    hPutStr tempHandle $ unlines newTodoItems  \n    hClose handle  \n    hClose tempHandle  \n    removeFile \"todo.txt\"  \n    renameFile tempName \"todo.txt\" \n</code></pre>\n\n<p>with the line indicated I do not quite understand why I don't see\n<code>[()..()]</code> as the output when i run this script; I thought <code>mapM</code> does not disregard the result</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1470085095, "post_id": 38707813, "comment_id": 64793525, "body": "My recommendation is to learn how to use parsec using monadic do-notation. Then as you learn about applicatives you can start using them in place of your monadic code where you can. Applicatives are strictly less powerful than monads, so there may be some things you cannot do with only applicatives. There is less of a distinction now that you use do-notation to write applicative expressions with the ApplicativeDo pragma."}], "answers": [{"comments": [{"owner": {"reputation": 270, "user_id": 6664995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79dba6948a90cf82eeb254de984877ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jos&#233; Miguel", "link": "https://stackoverflow.com/users/6664995/jos%c3%a9-miguel"}, "edited": false, "score": 0, "creation_date": 1470086068, "post_id": 38708084, "comment_id": 64794012, "body": "Thanks! I&#39;ll check megaparsec, seems good (Unicode and indentation support look great!)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1470151353, "post_id": 38708084, "comment_id": 64824987, "body": "It&#39;s not mostly about <i>compiler</i> optimizations; it&#39;s much more about <i>library</i> optimizations. Some types support extra-efficient <code>&lt;$</code>, <code>fmap</code>, <code>*&gt;</code>, <code>&lt;*</code>, and/or <code>&lt;*&gt;</code> based on their structures; others do not. <code>Data.Sequence</code> gets a major speed boost for every step down (although <code>&lt;*</code> is currently missing; I&#39;ll have to fix that). Lists, on the other hand, get only tiny ones (except for the special case of map/coerce)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470153870, "post_id": 38708084, "comment_id": 64826839, "body": "@dfeuer Hmmm, that was what I meant with &quot;these instances since they can be simpler than <code>Monad</code>&quot;. But if you are commenting, then my answer is not obvious. :)  I didn&#39;t want to over-emphasize this here because when I looked at <code>(&lt;*&gt;)</code> for <code>ParsecT</code>, it didn&#39;t seem to be extra efficient compared to <code>(&gt;&gt;=)</code>..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470154622, "post_id": 38708084, "comment_id": 64827283, "body": "It may not be! I think most traditional parser combinator libraries are based around parser types that <i>don&#39;t</i> support especially fast applicative operations. I don&#39;t know if there are any that support a monadic interface and that optimize the applicative one."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 12, "last_activity_date": 1470154640, "last_edit_date": 1470154640, "creation_date": 1470085456, "answer_id": 38708084, "question_id": 38707813, "link": "https://stackoverflow.com/questions/38707813/parsec-applicatives-vs-monads/38708084#38708084", "title": "Parsec: Applicatives vs Monads", "body": "<p>In general, start with whatever makes the most sense to you. Afterwards consider the following.</p>\n\n<p>It is good practice to use <code>Applicative</code> (or even <code>Functor</code>) when possible. It is in general easier for a compiler like GHC to optimize these instances since they can be simpler than <code>Monad</code>. I think the general community advice post-<a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"noreferrer\">AMP</a> has been to make as general as possible your constraints. I would recommend the use of the GHC extension <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ApplicativeDo\" rel=\"noreferrer\"><code>ApplicativeDo</code></a> since you can uniformly use <code>do</code> notation while only getting an <code>Applicative</code> constraint when that is all that is needed.</p>\n\n<p>Since the <code>ParsecT</code> parser type is an instance of both <code>Applicative</code> and <code>Monad</code>, you can mix and match the two. There are situations where doing this is more readable - this all depends on the situation. </p>\n\n<p>Also, consider using <a href=\"https://hackage.haskell.org/package/megaparsec-5.0.1\" rel=\"noreferrer\"><code>megaparsec</code></a>. <code>megaparsec</code> is a more actively maintained just generally cleaner more recent fork of <code>parsec</code>.</p>\n\n<h1>EDIT</h1>\n\n<p>Two things that, rereading my answer and the comments, I really didn't do a good job of clarifying:</p>\n\n<ul>\n<li><p>the main benefit of using <code>Applicative</code> is that for many types it admits much more efficient implementations (eg. <code>(&lt;*&gt;)</code> is more performant than <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:ap\" rel=\"noreferrer\"><code>ap</code></a>).</p></li>\n<li><p>If you just want to write something like <code>(+) &lt;$&gt; parseNumber &lt;*&gt; parseNumber</code>, there is no need to drop into <code>ApplicativeDo</code> - it would be just more verbose. I'd use <code>ApplicativeDo</code> only when you start finding yourself writing very long or nested applicative expressions.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 3550, "user_id": 261393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/334a587ef1901e2d48dfd15f90522496?s=128&d=identicon&r=PG", "display_name": "Sam Elliott", "link": "https://stackoverflow.com/users/261393/sam-elliott"}, "edited": false, "score": 0, "creation_date": 1470158450, "post_id": 38719766, "comment_id": 64829426, "body": "It&#39;s also worth pointing out that the parsers you can make with <code>&lt;*&gt;</code> are strictly less expressive than those you can make with <code>&gt;&gt;=</code> -- though the extra expressivity is not always needed. This answer alludes to the differences further <a href=\"http://stackoverflow.com/a/7863380/261393\">stackoverflow.com/a/7863380/261393</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1470184332, "post_id": 38719766, "comment_id": 64841140, "body": "Does your preference for programming in an applicative style (by which I mean what you&#39;re referring to as &quot;a direct style&quot;, as distinct from &quot;an <code>Applicative</code> style&quot;) extend to preferring <code>&gt;&gt;=</code> over <code>do</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1470198279, "post_id": 38719766, "comment_id": 64844328, "body": "@BenjaminHodgson: I thought the &quot;direct style&quot;, at the extreme, would be one where you use function application syntax (reserved for the <code>-&gt;</code> function space in Haskell). For an example of an implementation in a modern setting, <a href=\"http://docs.idris-lang.org/en/latest/tutorial/interfaces.html?highlight=idiom#idiom-brackets\" rel=\"nofollow noreferrer\">in Idris</a> you can write <code>[| f x y + z |]</code> to mean <code>(+) &lt;$&gt; (f &lt;$&gt; x &lt;*&gt; y) &lt;*&gt; z</code>"}, {"owner": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 1, "creation_date": 1470234145, "post_id": 38719766, "comment_id": 64866296, "body": "An example of where I&#39;ve seen parallelisation of applicatives is in the Haxl ICFP&#39;14 paper, e.g. <code>length &lt;$&gt; intersect\u2019 (friendsOf x) (friendsOf y)</code> <a href=\"http://community.haskell.org/~simonmar/papers/haxl-icfp14.pdf\" rel=\"nofollow noreferrer\">community.haskell.org/~simonmar/papers/haxl-icfp14.pdf</a> . Apart from Haxl, are there other Applicative instance examples that have parallelism built in to their implementations?"}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 0, "creation_date": 1470248167, "post_id": 38719766, "comment_id": 64875577, "body": "@RobStewart <code>Concurrently</code> from <a href=\"https://hackage.haskell.org/package/async-2.1.0/docs/Control-Concurrent-Async.html#t:Concurrently\" rel=\"nofollow noreferrer\"><code>async</code></a> is parallel."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 1722, "user_id": 1526266, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/1HT7M.jpg?s=128&g=1", "display_name": "Rob Stewart", "link": "https://stackoverflow.com/users/1526266/rob-stewart"}, "edited": false, "score": 2, "creation_date": 1470250197, "post_id": 38719766, "comment_id": 64876778, "body": "@RobStewart Simon M&#39;s work is what I had in mind when I wrote that answer. Meanwhile, infinite streams form a monad, where <code>repeat</code> is <code>return</code> and <code>join</code> takes the diagonal of an infinite square matrix. Of course, if you want only the diagonal, it&#39;s silly to compute even the matrix of thunks: <code>&gt;&gt;=</code> generates at least a triangle. The sensible way to combine streams in that sense is by <i>zipping</i>, which is exactly the applicative behaviour. It may not exactly be parallelism, but it&#39;s another example where the default implementation of <code>&lt;*&gt;</code> from <code>&gt;&gt;=</code> is inefficiently over-seqential."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 70, "last_activity_date": 1470138929, "creation_date": 1470138929, "answer_id": 38719766, "question_id": 38707813, "link": "https://stackoverflow.com/questions/38707813/parsec-applicatives-vs-monads/38719766#38719766", "title": "Parsec: Applicatives vs Monads", "body": "<p>It might be worth paying attention to the key semantic difference between <code>Applicative</code> and <code>Monad</code>, in order to determine when each is appropriate. Compare types:</p>\n\n<pre><code>(&lt;*&gt;) :: m (s -&gt; t) -&gt; m s -&gt; m t\n(&gt;&gt;=) :: m s -&gt; (s -&gt; m t) -&gt; m t\n</code></pre>\n\n<p>To deploy <code>&lt;*&gt;</code>, you choose two computations, one of a function, the other of an argument, then their values are combined by application. To deploy <code>&gt;&gt;=</code>, you choose one computation, and you explain how you will make use of its resulting values to choose the next computation. It is the difference between \"batch mode\" and \"interactive\" operation.</p>\n\n<p>When it comes to parsing, <code>Applicative</code> (extended with failure and choice to give <code>Alternative</code>) captures the <em>context-free</em> aspects of your grammar. You will need the extra power that <code>Monad</code> gives you only if you need to inspect the parse tree from part of your input in order to decide what grammar you should use for another part of your input. E.g., you might read a format descriptor, then an input in that format. Minimizing your usage of the extra power of monads tells you which value-dependencies are essential.</p>\n\n<p>Shifting from parsing to parallelism, this idea of using <code>&gt;&gt;=</code> only for essential value-dependency buys you clarity about opportunities to spread load. When two computations are combined with <code>&lt;*&gt;</code>, neither need wait for the other. Applicative-when-you-can-but-monadic-when-you-must is the formula for speed. The point of <code>ApplicativeDo</code> is to automate the dependency analysis of code which has been written in monadic style and thus accidentally oversequentialised.</p>\n\n<p>Your question also relates to coding style, about which opinions are free to differ. But let me tell you a story. I came to Haskell from Standard ML, where I was used to writing programs in direct style even if they did naughty things like throw exceptions or mutate references. What was I doing in ML? Working on an implementation of an ultra-pure type theory (which may not be named, for legal reasons). When working <em>in</em> that type theory, I couldn't write direct-style programs which used exceptions, but I cooked up the applicative combinators as a way of getting as close to direct style as possible.</p>\n\n<p>When I moved to Haskell, I was horrified to discover the extent to which people seemed to think that programming in pseudo-imperative do-notation was just punishment for the slightest semantic impurity (apart, of course, from non-termination). I adopted the applicative combinators as a style choice (and went even closer to direct style with \"idiom brackets\") long before I had a grasp of the semantic distinction, i.e., that they represented a useful weakening of the monad interface. I just didn't (and still don't) like the way do-notation requires fragmentation of expression structure and the gratuitous naming of things.</p>\n\n<p>That's to say, the same things that make functional code more compact and readable than imperative code also make applicative style more compact and readable than do-notation. I appreciate that <code>ApplicativeDo</code> is a great way to make more applicative (and in some cases that means <em>faster</em>) programs that were written in monadic style that you haven't the time to refactor. But otherwise, I'd argue applicative-when-you-can-but-monadic-when-you-must is also the better way to see what's going on.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1470208902, "post_id": 38735766, "comment_id": 64848814, "body": "Could you expand this to clarify? The first paragraph is rather vague; the second could use some examples."}], "tags": [], "owner": {"reputation": 71, "user_id": 6670773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQNxx.png?s=128&g=1", "display_name": "Philippa Cowderoy", "link": "https://stackoverflow.com/users/6670773/philippa-cowderoy"}, "is_accepted": false, "score": 7, "last_activity_date": 1470217020, "last_edit_date": 1470217020, "creation_date": 1470204914, "answer_id": 38735766, "question_id": 38707813, "link": "https://stackoverflow.com/questions/38707813/parsec-applicatives-vs-monads/38735766#38735766", "title": "Parsec: Applicatives vs Monads", "body": "<p>Following on from @pigworker (I'm too new on here to comment alas) it's worth noting <code>join $ fM &lt;*&gt; ... &lt;*&gt; ... &lt;*&gt; ...</code> as a pattern as well. It nets you a \"bind1, bind2, bind3...\" family the same way <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> get you an \"fmap1,fmap2,fmap3\" one.</p>\n\n<p>As a stylistic thing, when you're used enough to the combinators it's possible to use <code>do</code> much the same as you would use <code>let</code>: as a way to highlight when you wanted to name something. I tend to want to name things more often in parsers for example, because that probably corresponds to names in the spec!</p>\n"}], "owner": {"reputation": 270, "user_id": 6664995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79dba6948a90cf82eeb254de984877ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jos&#233; Miguel", "link": "https://stackoverflow.com/users/6664995/jos%c3%a9-miguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3936, "favorite_count": 14, "accepted_answer_id": 38708084, "answer_count": 3, "score": 22, "last_activity_date": 1470217020, "creation_date": 1470084281, "question_id": 38707813, "link": "https://stackoverflow.com/questions/38707813/parsec-applicatives-vs-monads", "title": "Parsec: Applicatives vs Monads", "body": "<p>I'm just starting with Parsec (having little experience in Haskell), and I'm a little confused about using monads or applicatives. The overall feel I had after reading \"Real World Haskell\", \"Write You a Haskell\" and a question here is that applicatives are preferred, but really I have no idea.</p>\n\n<p>So my questions are:</p>\n\n<ul>\n<li>What approach is preferred?</li>\n<li>Can monads and applicatives be mixed (use them when they are more useful than the other)</li>\n<li>If the last answer is yes, should I do it?</li>\n</ul>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1470083201, "post_id": 38707495, "comment_id": 64792637, "body": "This is just an example of (extended?) defaulting rules in GHCi."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1470083856, "post_id": 38707495, "comment_id": 64792950, "body": "A perhaps confusing point here: although <code>3</code> and <code>3.0</code> have different polymorphic types, in the expression <code>3 == 3.0</code>, they are both given the same monomorphic type before the equality is computed. The type of <code>(==)</code> says it must accept two arguments with the same type: <code>Eq a =&gt; a -&gt; a -&gt; Bool</code>. I suspect misunderstanding this subtlety is what lead to the question."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1470084399, "post_id": 38707495, "comment_id": 64793204, "body": "&quot;allows different numeric types to be compared&quot;. Try this: <code>length &quot;abc&quot; == 3.0</code>. Does it work?"}, {"owner": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1470084665, "post_id": 38707495, "comment_id": 64793329, "body": "@n.m. It does work in GHCi."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1470085579, "post_id": 38707495, "comment_id": 64793742, "body": "What version of GHCi?"}], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "edited": false, "score": 0, "creation_date": 1470084888, "post_id": 38707731, "comment_id": 64793435, "body": "Thank you. So I wouldn&#39;t be able to test equality to elements of a new type that I created?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1470086558, "post_id": 38707731, "comment_id": 64794236, "body": "Not from preexisting types, no.  And not even to other types you also created.  You can only compare type <code>a</code> to type <code>a</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "edited": false, "score": 1, "creation_date": 1470087662, "post_id": 38707731, "comment_id": 64794669, "body": "@espertus: you <i>can</i> easily compare two values that are <i>both</i> of a new type you&#39;ve created yourself. Just write an <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Eq\" rel=\"nofollow noreferrer\"><code>Eq</code></a> instance for that type."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1470083999, "creation_date": 1470083999, "answer_id": 38707731, "question_id": 38707495, "link": "https://stackoverflow.com/questions/38707495/how-does-equality-work-for-numeric-types/38707731#38707731", "title": "How does equality work for numeric types?", "body": "<p>\u201cHaskell allows different numeric types to be compared\u201d no it doesn't. What Haskell actually allows is different types to be defined by the same <em>literals</em>. In particular, you can do</p>\n\n<pre><code>Prelude&gt; let a = 3.7 :: Double\nPrelude&gt; let b = 1   :: Double\nPrelude&gt; a + b\n4.7\n</code></pre>\n\n<p>OTOH, if I declared these explicitly with conflicting types, the addition would fail:</p>\n\n<pre><code>Prelude&gt; let a = 3.7 :: Double\nPrelude&gt; let b = 1   :: Int\nPrelude&gt; a + b\n\n&lt;interactive&gt;:31:5:\n    Couldn't match expected type \u2018Double\u2019 with actual type \u2018Int\u2019\n    In the second argument of \u2018(+)\u2019, namely \u2018b\u2019\n    In the expression: a + b\n</code></pre>\n\n<p>Now, <code>Double</code> is not the most general possible type for either <code>a</code> or <code>b</code>. In fact all number literals are polymorphic, but before any operation (like equality comparison) happens, such a polymorphic type needs to be pinned down to a concrete monomorphic one. Like,</p>\n\n<pre><code>Prelude&gt; (3.0 :: Double) == (3 :: Double)\nTrue\n</code></pre>\n\n<p>Because <code>==</code>, contrary to your premise, actually requires both sides to have the same type, you can omit the signature on either side without changing anything:</p>\n\n<pre><code>Prelude&gt; 3.0 == (3 :: Double)\nTrue\n</code></pre>\n\n<p>In fact, even without any type annotation, GHCi will still treat both sides as <code>Double</code>. This is because of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"noreferrer\">type defaulting</a> \u2013 in this particular case, <code>Fractional</code> is the strongest constraint on the shared number type, and for <code>Fractional</code>, the default type is <code>Double</code>. OTOH, if both sides had been integral literals, then GHCi would have chosen <code>Integer</code>. This can sometimes make a difference, for instance</p>\n\n<pre><code>Prelude&gt; 10000000000000000 == 10000000000000001\nFalse\n</code></pre>\n\n<p>but</p>\n\n<pre><code>Prelude&gt; 10000000000000000 ==(10000000000000001 :: Double)\nTrue\n</code></pre>\n\n<p>because in the latter case, the final 1 is lost in the floating-point error.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470089898, "post_id": 38707907, "comment_id": 64795530, "body": "Nope. It can be done. Check this out: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a> Now, if this defaulting mechanism was more general I would be happier..."}], "tags": [], "owner": {"reputation": 2662, "user_id": 377248, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2ff67f64a05a15eceb6de6a9421b15d8?s=128&d=identicon&r=PG", "display_name": "clinux", "link": "https://stackoverflow.com/users/377248/clinux"}, "is_accepted": false, "score": 2, "last_activity_date": 1470091918, "last_edit_date": 1470091918, "creation_date": 1470084744, "answer_id": 38707907, "question_id": 38707495, "link": "https://stackoverflow.com/questions/38707495/how-does-equality-work-for-numeric-types/38707907#38707907", "title": "How does equality work for numeric types?", "body": "<p>There is nothing magical going on here. <code>3</code> can be of either a real number or an integer, but its type gets unified with a real number when compared to <code>3.0</code>.</p>\n\n<p>Note the type class:</p>\n\n<pre><code>class Eq a where\n  eq :: a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>So <code>eq</code> really does only compare things of same type. And your example <code>3 == 3.0</code> gets its types unified and becomes <code>3.0 == 3.0</code> internally.</p>\n\n<p>I'm unsure of any type tricks to make it unify with a user defined complex number type. My gut tells me it can not be done.</p>\n"}], "owner": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 2, "accepted_answer_id": 38707731, "answer_count": 2, "score": 3, "last_activity_date": 1470091918, "creation_date": 1470083088, "question_id": 38707495, "link": "https://stackoverflow.com/questions/38707495/how-does-equality-work-for-numeric-types", "title": "How does equality work for numeric types?", "body": "<p>I see that Haskell allows different numeric types to be compared:</p>\n\n<pre><code>*Main&gt; :t 3\n3 :: Num t =&gt; t\n*Main&gt; :t 3.0\n3.0 :: Fractional t =&gt; t\n*Main&gt; 3 == 3.0\nTrue\n</code></pre>\n\n<p>Where is the source code for the <code>Eq</code> instance for numeric types? If I create a new type, such as ComplexNumber, can I extend <code>==</code> to work for it? (I might want complex numbers with no imaginary parts to be potentially equal to real numbers.)</p>\n"}, {"tags": ["multithreading", "haskell", "io"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1470077070, "post_id": 38705886, "comment_id": 64789493, "body": "Voted to close. You should try to find the smallest possible program that produces this behavior. It&#39;s a good practice both for you and for us: for you, there&#39;s a good chance that minimization will make it obvious even to you what&#39;s wrong; and for us, a little bit of your time spent will be the same amount of time saved for each one of us -- a net savings if there are at least two people who try to help you at all."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470077740, "post_id": 38705886, "comment_id": 64789851, "body": "<a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470088023, "post_id": 38705886, "comment_id": 64794803, "body": "I&#39;m voting to reopen this question. I&#39;ve found that it works if run interpreted or not compiled with -O2, but it seems to hang when compiled with -O2. I&#39;ve also modified the parameters (min/max iterations) to make it complete in less than a minute."}, {"owner": {"reputation": 1304, "user_id": 231299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66dff0c4f2df2394109a0b09fa59dce1?s=128&d=identicon&r=PG", "display_name": "beerboy", "link": "https://stackoverflow.com/users/231299/beerboy"}, "edited": false, "score": 0, "creation_date": 1470088203, "post_id": 38705886, "comment_id": 64794891, "body": "Are you including the <code>-threaded</code> option?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470088866, "post_id": 38705886, "comment_id": 64795171, "body": "Initially no, but I&#39;ve since retested with -threaded, and the results are the same. -O2 seems to hang, but no -O option works."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470101908, "post_id": 38705886, "comment_id": 64798430, "body": "The problem is that worker thread can deprive the manager thread from removing elements from the TQueue. I&#39;ve written up the details (along with code examples) here: <a href=\"https://github.com/erantapaa/mandel\" rel=\"nofollow noreferrer\">github.com/erantapaa/mandel</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470114522, "post_id": 38705886, "comment_id": 64801243, "body": "Good point ErikR.  Yes, starvation is possible using STM.  A simpler example is here  <a href=\"http://stackoverflow.com/questions/3031878/stm-monad-problem/3034057#3034057\" title=\"stm monad problem\">stackoverflow.com/questions/3031878/stm-monad-problem/&hellip;</a>"}, {"owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1470123606, "post_id": 38705886, "comment_id": 64805572, "body": "@DanielWagner: I actually tried to first make a smaller example, but then the problem went away. So this is as small as I could get it."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1470125574, "post_id": 38712558, "comment_id": 64806711, "body": "Sorry - have a look now"}, {"owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "edited": false, "score": 0, "creation_date": 1470248586, "post_id": 38712558, "comment_id": 64875809, "body": "I finally realized why the program doesn&#39;t work, and added the explanation to the question."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1470117453, "last_edit_date": 1470117453, "creation_date": 1470116643, "answer_id": 38712558, "question_id": 38705886, "link": "https://stackoverflow.com/questions/38705886/why-does-this-haskell-program-hang-when-writing-to-file/38712558#38712558", "title": "Why does this Haskell program hang when writing to file?", "body": "<p>The problem is two-fold:</p>\n\n<p>(1) The manager thread doesn't process any\nTraces until it has exhausted the queue.</p>\n\n<p>(2) The worker thread can add elements to the queue very, very quickly.</p>\n\n<p>This results in a race that the manager thread rarely wins. [ This also explains the observed behavior with <code>-O2</code> - the optimization just made the worker thread faster. ]</p>\n\n<p>Adding some debugging code shows that the worker can add\nitems to the queue in excess of 100K Traces per second.\nMoreover, even though the manager is only interested in\nwriting out the first 1000 Traces, the worker doesn't\nstop at this limit. So, under certain circumstances,\nthe manager is never able to exit this loop:</p>\n\n<p><code>\npurgeTQueue q =\n  whileJust (atomically $ tryReadTQueue q)\n            (return . id)\n</code></p>\n\n<p>The simplest way to fix the code is to have the\nmanager thread use <code>readTQueue</code> to read and process just one\nitem off the queue at a time. This will also block\nthe manager thread when the queue us empty obviating\nthe need to the manager thread to periodically sleep.</p>\n\n<p>Changing <code>purgeTQueue</code> to:</p>\n\n<pre><code>purgeTQueue = do item &lt;- atomically $ readTQueue (mdTraceQueue m_data)\n                 return [item]\n</code></pre>\n\n<p>and removing the <code>threadDelay</code> from <code>runManager</code> fixes the problem.</p>\n\n<p>Example code available in the <code>Lib4.hs</code> module at: <a href=\"https://github.com/erantapaa/mandel\" rel=\"nofollow\">https://github.com/erantapaa/mandel</a></p>\n"}], "owner": {"reputation": 4410, "user_id": 426092, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/15383a2ddb7a418875a0f3bb14f1e621?s=128&d=identicon&r=PG&f=1", "display_name": "gablin", "link": "https://stackoverflow.com/users/426092/gablin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 38712558, "answer_count": 1, "score": 1, "last_activity_date": 1470248554, "creation_date": 1470076822, "last_edit_date": 1470248554, "question_id": 38705886, "link": "https://stackoverflow.com/questions/38705886/why-does-this-haskell-program-hang-when-writing-to-file", "title": "Why does this Haskell program hang when writing to file?", "body": "<p>The program below works if run with <code>runhaskell</code> or if compiled but not with <code>-O2</code>. If compiled with <code>-O2</code> it seems to hang.</p>\n\n<p>I'm using GHC 7.10.2.</p>\n\n<p>I've changed the min/max iterations to 10 and 20 respectively. It will\ngenerate anywhere from 20 to 100 MB of output into the file <code>test.out</code>.\nRun time is about 15 - 60 secs.</p>\n\n<h3>Program Explanation</h3>\n\n<p>Below is a multi-threaded program that has a pool of workers and a manager. The workers generate traces to be used in plotting a Buddhabrot, put it in a queue, and a manager periodically empties the queue and writes the data to disk. When a certain amount of data has been generated, the program stops.</p>\n\n<p>But when the program runs the manager thread only does one check, and then it gets stuck (the worker threads are still running). However, if I remove the part where the manager thread writes to file, then everything seems to work. I just don't understand why...</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Concurrent.Async\nimport Control.Concurrent.STM\nimport Control.Monad\n  ( forever\n  , unless\n  )\nimport Control.Monad.Loops\nimport System.IO\nimport System.Random\n\nimport qualified Data.Binary as B\nimport qualified Data.ByteString.Lazy as BS\n\ntype Coord = (Double, Double)\n\ntype Trace = [Coord]\n\n-- | Represents a rectangle in the complex plane, bounded by a lower left\n-- coordinate and an upper right coordinate.\ndata Plane\n  = Plane { ll :: Coord, ur :: Coord }\n  deriving (Show)\n\n-- | Adds two coordinates.\n(+.) :: Coord -&gt; Coord -&gt; Coord\n(r1, i1) +. (r2, i2) = (r1 + r2, i1 + i2)\n\n-- | Multiplies two coordinates.\n(*.) :: Coord -&gt; Coord -&gt; Coord\n(r1, i1) *. (r2, i2) = (r1*r2 - i1*i2, r1*i2 + r2*i1)\n\n-- | Computes the square of a coordinate.\nsquare :: Coord -&gt; Coord\nsquare (r, i) = (r*r - i*i, 2*r*i)\n\n-- | Distance from origin to a given coordinate.\ndistFromOrigin :: Coord -&gt; Double\ndistFromOrigin (r, i) = r*r + i*i\n\n-- | A structure for passing data to the worker threads.\ndata WorkerData\n  = WorkerData { wdMinIt :: Int\n               , wdMaxIt :: Int\n               , wdTraceQueue :: TQueue Trace\n                 -- ^ A queue of traces to be written to disk.\n               }\n\n-- | A structure for passing data to the manager thread.\ndata ManagerData\n  = ManagerData { mdOutHandle :: Handle\n                   -- ^ Handle to the output file.\n                , mdNumTraces :: Integer\n                  -- ^ Number of traces to gather.\n                , mdTraceQueue :: TQueue Trace\n                  -- ^ A queue of traces to be written to disk.\n                }\n\n-- | Encodes an entity to binary bytestring.\nencode :: B.Binary a =&gt; a -&gt; BS.ByteString\nencode = B.encode\n\n-- | Writes a lazy bytestring to file.\nwriteToFile :: Handle -&gt; BS.ByteString -&gt; IO ()\nwriteToFile = BS.hPut\n\nmkManagerData :: TQueue Trace -&gt; IO ManagerData\nmkManagerData t_queue =\n  do let out_f = \"test.out\"\n     out_h &lt;- openBinaryFile out_f WriteMode\n     let num_t = 1000\n     return $ ManagerData { mdOutHandle = out_h\n                          , mdNumTraces = num_t\n                          , mdTraceQueue = t_queue\n                          }\n\nmkWorkerData :: TQueue Trace -&gt; IO WorkerData\nmkWorkerData t_queue =\n  do let min_it =  10 -- 1000\n         max_it =  20 -- 10000\n     return $ WorkerData { wdMinIt = min_it\n                         , wdMaxIt = max_it\n                         , wdTraceQueue = t_queue\n                         }\n\n-- | The actions to be performed by the manager thread.\nrunManager :: ManagerData -&gt; IO ()\nrunManager m_data =\n  do execute 0\n     return ()\n  where execute count =\n          do new_traces &lt;- purgeTQueue $ mdTraceQueue m_data\n             let new_count = count + (toInteger $ length new_traces)\n             putStrLn $ \"Found \" ++ (show $ new_count) ++ \" traces so far. \"\n             if length new_traces &gt; 0\n             then do putStrLn $ \"Writing new traces to file...\"\n                     _ &lt;- mapM (writeToFile (mdOutHandle m_data))\n                               (map encode new_traces)\n                     putStr \"Done\"\n             else return ()\n             putStrLn \"\"\n             unless (new_count &gt;= mdNumTraces m_data) $\n               do threadDelay (1000 * 1000) -- Sleep 1s\n                  execute new_count\n\n-- | The actions to be performed by a worker thread.\nrunWorker :: WorkerData -&gt; IO ()\nrunWorker w_data =\n  forever $\n    do c &lt;- randomCoord\n       case computeTrace c (wdMinIt w_data) (wdMaxIt w_data) of\n         Just t  -&gt; atomically $ writeTQueue (wdTraceQueue w_data) t\n         Nothing -&gt; return ()\n\n-- | Reads all values from a given 'TQueue'. If any other thread reads from the\n-- same 'TQueue' during the execution of this function, then this function may\n-- deadlock.\npurgeTQueue :: Show a =&gt; TQueue a -&gt; IO [a]\npurgeTQueue q =\n  whileJust (atomically $ tryReadTQueue q)\n            (return . id)\n\n-- | Generates a random coordinate to trace.\nrandomCoord :: IO Coord\nrandomCoord =\n  do x &lt;- randomRIO (-2.102613, 1.200613)\n     y &lt;- randomRIO (-1.237710, 1.239710)\n     return (x, y)\n\n-- | Computes a trace, using the classical Mandelbrot function, for a given\n-- coordinate and minimum and maximum iteration count. If the length of the\n-- trace is less than the minimum iteration count, or exceeds the maximum\n-- iteration count, 'Nothing' is returned.\ncomputeTrace\n  :: Coord\n  -&gt; Int\n     -- ^ Minimum iteration count.\n  -&gt; Int\n     -- ^ Maximum iteration count.\n  -&gt; Maybe Trace\ncomputeTrace c0 min_it max_it =\n  if isUsefulCoord c0\n  then let step c = square c +. c0\n           computeIt c it = if it &lt; max_it\n                            then computeIt (step c) (it + 1)\n                            else it\n           computeTr [] = error \"computeTr: empty list\"\n           computeTr (c:cs) = if length cs &lt; max_it\n                              then computeTr (step c:(c:cs))\n                              else (c:cs)\n           num_it = computeIt c0 0\n       in if num_it &gt;= min_it &amp;&amp; num_it &lt;= max_it\n          then Just $ reverse $ computeTr [c0]\n          else Nothing\n  else Nothing\n\n-- | Checks if a given coordinate is useful by checking if it belongs in the\n-- cardioid or period-2 bulb of the Mandelbrot.\nisUsefulCoord :: Coord -&gt; Bool\nisUsefulCoord (x, y) =\n  let t1 = x - 1/4\n      p = sqrt (t1*t1 + y*y)\n      is_in_cardioid = x &lt; p - 2*p*p + 1/4\n      t2 = x + 1\n      is_in_bulb = t2*t2 + y*y &lt; 1/16\n  in not is_in_cardioid &amp;&amp; not is_in_bulb\n\nmain :: IO ()\nmain =\n  do t_queue &lt;- newTQueueIO\n     m_data &lt;- mkManagerData  t_queue\n     w_data &lt;- mkWorkerData t_queue\n     let num_workers = 1\n     workers &lt;- mapM async (replicate num_workers (runWorker w_data))\n     runManager m_data\n     _ &lt;- mapM cancel workers\n     _ &lt;- mapM waitCatch workers\n     putStrLn \"Tracing finished\"\n</code></pre>\n\n<h3>Why It Fails</h3>\n\n<p>After reviewing the answers below, I finally realized why it doesn't work as intended. The program <em>does not</em> hang, but the time it takes for the manager thread to encode a single trace is in the order of tens of seconds (and when encoded it consumes several megabytes)! This means that even if there are some tens of traces in the queue when exhausted -- on my machine the workers manage to produce about 250 traces before the queue is exhausted by the manger thread -- it will take forever before the next exhaust.</p>\n\n<p>Hence it matters little what solution I choose unless the work of the manager thread is greatly reduced. For that, I will have to abandon my idea of dumping each individual trace to file and instead process it once generated.</p>\n"}, {"tags": ["haskell", "dom", "ghcjs", "ghcjs-dom"], "answers": [{"tags": [], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "is_accepted": true, "score": 0, "last_activity_date": 1470093270, "last_edit_date": 1470093270, "creation_date": 1470088094, "answer_id": 38708667, "question_id": 38704115, "link": "https://stackoverflow.com/questions/38704115/is-there-a-built-in-function-to-convert-a-nodelist-to-a-real-list-ghcjs-dom/38708667#38708667", "title": "Is there a built in function to convert a NodeList to a real list (ghcjs-dom)?", "body": "<p>My implementation:</p>\n\n<pre><code>nodeListToList nl = nl\n       &amp; NodeList.getLength\n     &lt;&amp;&gt; (\\x -&gt; [0..x - 1])\n     &gt;&gt;= mapM (item nl)\n     &lt;&amp;&gt; catMaybes\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 38708667, "answer_count": 1, "score": 0, "last_activity_date": 1470708791, "creation_date": 1470070228, "last_edit_date": 1470708791, "question_id": 38704115, "link": "https://stackoverflow.com/questions/38704115/is-there-a-built-in-function-to-convert-a-nodelist-to-a-real-list-ghcjs-dom", "title": "Is there a built in function to convert a NodeList to a real list (ghcjs-dom)?", "body": "<p>How can I convert the result of <code>Element.querySelectorAll body \"h1\"</code> which is <code>IO NodeList</code> to <code>IO (List Node)</code>. I know I could write a function myself. Is there a builtin function?</p>\n"}, {"tags": ["haskell", "io", "functional-programming", "getline"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470067947, "post_id": 38703424, "comment_id": 64784717, "body": "Remember that strings are just lists of characters, so <code>&quot;&quot;</code> is the same as <code>[] :: [Char]</code>, so cons&#39;ing a character onto that empty list makes sense. Also, you don&#39;t directly cons it onto <code>return &quot;&quot;</code>. Notice the difference between <code>c : getLine</code> (which makes no sense) and <code>do { s &lt;- getLine; return (c:s) }</code>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470067951, "post_id": 38703424, "comment_id": 64784719, "body": "Note that the &quot;&quot; isn&#39;t being cons&#39;ed to anything."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1470067987, "post_id": 38703424, "comment_id": 64784749, "body": "Where do you think that <code>return &quot;&quot;</code> is consed to anything?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1470069813, "post_id": 38703424, "comment_id": 64785731, "body": "@Alec ah thank you that makes a lot more sense!, i completely forgot that the &lt;- binds the &quot;&quot; to the s. Just started learning I/O in haskell"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1470068338, "creation_date": 1470068338, "answer_id": 38703584, "question_id": 38703424, "link": "https://stackoverflow.com/questions/38703424/how-does-getline-work-in-haskell/38703584#38703584", "title": "How does getLine work in haskell?", "body": "<p><code>return</code> isn't a control structure like in most languages. It's a constructor for monadic values. Let's take a look at its type:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p>In this case, given a <code>String</code> value, it produces a <code>IO String</code> value.</p>\n\n<p>The fact that <code>return</code> is the last expression evaluated in each branch of the <code>if</code> doesn't mean <code>return</code> ends execution; other expressions <em>could</em> occur after <code>return</code>. Consider this simple example from the list monad:</p>\n\n<pre><code>foo :: Int -&gt; Int -&gt; [Int]\nfoo x y = return x ++ return y\n</code></pre>\n\n<p>In the list monad, <code>return</code> simply creates a new single-item list containing its argument. Those two lists are then concatenated into the final result list returned by the function.</p>\n\n<pre><code>$ return 3 :: [Int]\n[3]\n$ foo 3 4\n[3,4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "is_accepted": false, "score": 0, "last_activity_date": 1470080505, "creation_date": 1470080505, "answer_id": 38706876, "question_id": 38703424, "link": "https://stackoverflow.com/questions/38703424/how-does-getline-work-in-haskell/38706876#38706876", "title": "How does getLine work in haskell?", "body": "<p><code>do</code>-notation is a syntax sugar.</p>\n\n<pre><code>do x &lt;- e\n   rest\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>e &gt;&gt;= \\x -&gt; rest\n</code></pre>\n\n<p>where <code>&gt;&gt;=</code> is a <code>flatMap</code> or <code>bind</code> operation (it attaches a callback to <code>IO</code> container).</p>\n\n<p><code>flatMap :: IO a -&gt; (a -&gt; IO b) -&gt; IO b</code> meaning is: given container of type <code>IO a</code> attach a callback of type <code>a -&gt; IO b</code>, fired when container succeeds in its operation, and this produces a new container of type <code>IO b</code></p>\n\n<p>So</p>\n\n<pre><code>getLine =\n    getChar &gt;&gt;= \\c -&gt;\n        if c == '\\n'\n        then (return [])\n        else getLine &gt;&gt;= \\rest -&gt;\n             return (c : rest)\n</code></pre>\n\n<p>What is means? <code>getLine</code> immediately delegates execution to <code>getChar</code> <code>IO</code>-container, with a callback, which analyses the character passed to it. If its a newline, it does \"<code>return \"\"</code>\", which is a construction of <code>IO</code>-container, returning empty <code>String</code> immediately.\nOtherwise, we call ourselves, grab the <code>rest</code> and <code>return</code> current <code>c</code>haracter attached to <code>rest</code>.</p>\n\n<p>P.S.: <code>return</code> is used to turn a pure value into container, since <code>Monad</code> interface doesn't allow us to bind non-container-producing callbacks (there are very good reasons for this).</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1393, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1470207189, "creation_date": 1470067717, "last_edit_date": 1470207189, "question_id": 38703424, "link": "https://stackoverflow.com/questions/38703424/how-does-getline-work-in-haskell", "title": "How does getLine work in haskell?", "body": "<p>Looking at the <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html\" rel=\"nofollow\">definition of <code>getLine</code> in the Haskell Prelude</a>,\nI get how the recursion works, where you keep asking for a character until you hit a newline and you buildup a list which you then return wrapped in an IO.</p>\n\n<p>However my question is how do the <code>return</code> statements work in this case, specifically how does <code>return (c:....:return \"\")</code> work when you hit the base case. How do you cons a <code>return \"\"</code> on to a list?</p>\n"}, {"tags": ["haskell", "red-black-tree"], "comments": [{"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "edited": false, "score": 0, "creation_date": 1470061476, "post_id": 38701201, "comment_id": 64780361, "body": "&quot;the &quot;merge&quot; method might be the key &quot; : I meant, the results from the paper seem to suggest &quot;instead of the standard replace the node to be deleted with the inorder successor merge the trees together&quot; might be the reason for the speed."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1470822360, "creation_date": 1470822360, "answer_id": 38869791, "question_id": 38701201, "link": "https://stackoverflow.com/questions/38701201/red-black-trees-kahrs-version/38869791#38869791", "title": "Red Black Trees: Kahrs version", "body": "<p>Given that there is a lot that can be said on this topic, I'll try to stick as closely as possible to your questions, but let me know if I missed something important.</p>\n\n<h3>What the hell is <code>app</code> doing?</h3>\n\n<p>You are correct in that <code>app</code> breaks the red invariant rather than the black one on the way down and fixes this on the way back up.</p>\n\n<p>It <em>app</em>ends or merges two subtrees that obey the order property, black invariant, red invariant, and have the same black-depth into a new tree that also obeys the order property, black invariant, and red invariant. The one notable exception is that the root or <code>app rb1 rb2</code> sometimes is red and has two red subtrees. Such trees are said to be \"infrared\". This is dealt with in <code>delete</code> by just setting the root to be black in this line.</p>\n\n<pre><code> case del t of {T _ a y b -&gt; T B a y b; _ -&gt; E}\n</code></pre>\n\n<p><strong>Claim 1 (Order property)</strong> if the inputs <code>rb1</code> and <code>rb2</code> obey the order property individually (left subtree &lt; node value &lt; right subtree) and the max value in <code>rb1</code> is less than the min value in <code>rb2</code>, then <code>app rb1 rb2</code> also obeys the order property.</p>\n\n<p>This one is easy to prove. In fact, you can even sort of see it when looking at the code - the <code>a</code>s always stays to the left of the <code>b</code>s or <code>b'</code>s, which always stay to the left of the <code>c</code>s or <code>c'</code>s, which always stay to the left of the <code>d</code>s. And the <code>b'</code>s and <code>c'</code>s also obey this property since they are the result of recursive calls to <code>app</code> with subtrees <code>b</code> and <code>c</code> satisfying the claim.</p>\n\n<p><strong>Claim 2 (Red invariant)</strong> if the inputs <code>rb1</code> and <code>rb2</code> obey the red invariant (if a node is red, then both its children are black), then so do all the nodes in <code>app rb1 rb2</code>, except for possibly the root. However, the root can be \"infrared\" only when one of its arguments has a red root.</p>\n\n<p><em>Proof</em> The proof is by branching on the patterns.</p>\n\n<ul>\n<li>For cases <code>app E x = x</code> and <code>app x E = x</code> the claim is trivial</li>\n<li>For <code>app (T R a x b) (T R c y d)</code>, the claim hypothesis tells us all of <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> are black. It follows that <code>app b c</code> obeys the red invariant fully (it is not infrared).\n\n<ul>\n<li>If <code>app b c</code> matches <code>T R b' z c'</code> then its subtrees <code>b'</code> and <code>c'</code> must be black (and obey the red invariant), so <code>T R (T R a x b') z (T R c' y d)</code> obeys the red-invariant with an infrared root.</li>\n<li>Otherwise, <code>app b c</code> produced a black node <code>bc</code>, so <code>T R a x (T R bc y d)</code> obeys the red invariant.</li>\n</ul></li>\n<li><p>For <code>app (T B a x b) (T B c y d)</code> we only care that <code>app b c</code> will itself obey the red-invariant</p>\n\n<ul>\n<li>If <code>app b c</code> is a red node, it can be infrared but its subtrees <code>b'</code> and <code>c'</code>, on the other hand, must obey the red invariant completely. That means <code>T R (T B a x b') z (T B c' y d)</code> also obeys the red invariant.</li>\n<li><p>Now, if <code>bc</code> turns out to be black, we call <code>balleft a x (T B bc y d)</code>. The neat thing here is that we already know which two cases of <code>balleft</code> can be triggered: depending on whether <code>a</code> is red or black</p>\n\n<pre><code>balleft (T R a x b) y c = T R (T B a x b) y c\nballeft bl x (T B a y b) = balance bl x (T R a y b)\n</code></pre>\n\n<ul>\n<li><p>In the first case, what ends up happening is that we swap the color of the left subtree from red to black (and doing so never breaks the red-invariant) and put everything in a red subtree. Then <code>balleft a x (T B bc y d)</code> actually looks like <code>T R (T B .. ..) (T B bc y d)</code>, and that obeys the red invariant.</p></li>\n<li><p>Otherwise, the call to <code>balleft</code> turns into <code>balance a x (T R bc y d)</code> and the whole point of <code>balance</code> is that it fixes root level red violations.</p></li>\n</ul></li>\n</ul></li>\n<li><p>For <code>app a (T R b x c)</code> we know that <code>a</code> and <code>b</code> must be black, so <code>app a b</code> is not infrared, so <code>T R (app a b) x c</code> obeys the red invariant. The same holds for <code>app a (T R b x c)</code> but with letters <code>a</code>, <code>b</code>, and <code>c</code> permuted.</p></li>\n</ul>\n\n<p><strong>Claim 3 (Black invariant)</strong> if the inputs <code>rb1</code> and <code>rb2</code> obey the black invariant (any path from the root to the leaves has the same number of black nodes on the way) and have the same black-depth, <code>app rb1 rb2</code> also obeys the black invariant and has the same black-depth.</p>\n\n<p><em>Proof</em> The proof is by branching on the patterns.</p>\n\n<ul>\n<li>For cases <code>app E x = x</code> and <code>app x E = x</code> the claim is trivial</li>\n<li>For <code>app (T R a x b) (T R c y d)</code> we know that since <code>T R a x b</code> and <code>T R c y d</code> have the same black depth, so do their subtrees <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>. By the claim (remember, this is induction!) <code>app b c</code> will also obey the black invariant and have the same black depth. Now, we branch our proof on <code>case app b c of ...</code>\n\n<ul>\n<li>If <code>app b c</code> matches <code>T R b' z c'</code> it is red and its subtrees <code>b'</code> and <code>c'</code> will have the same black depth as <code>app b c</code> (itself), which in turn has the same black depth as <code>a</code> and <code>d</code>, so <code>T R (T R a x b') z (T R c' y d)</code> obeys the black invariant and has the same black depth as its inputs.</li>\n<li>Otherwise, <code>app b c</code> produced a black node <code>bc</code>, but again that node has the same black depth as <code>a</code> and <code>d</code>, so <code>T R a x (T R bc y d)</code> as a whole still obeys the black invariant and has the same black depth as its inputs.</li>\n</ul></li>\n<li>For <code>app (T B a x b) (T B c y d)</code> we again know immediately that subtrees <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> all have the same black depth as <code>app b c</code>. As before, we branch our proof on <code>case app b c of ...</code>\n\n<ul>\n<li>If <code>app b c</code> is a red node of the form <code>T R b' z c'</code>, we again get that <code>b'</code>, <code>c'</code>, <code>a</code>, and <code>d</code> have the same black-depth, so <code>T R (T B a x b') z (T B c' y d)</code> also has this same black depth</li>\n<li>Now, if <code>bc</code> turns out to be black, we apply the same reasoning as in our previous claim to figure out that the output <code>balleft a x (T B bc y d)</code> actually has the form either\n\n<ul>\n<li><code>T R (T B .. ..) (T B bc y d)</code> where <code>(T B .. ..)</code> is just <code>a</code> recolored as black so the overall tree will satisfy the black invariant and will have black-depth one more than any of <code>a</code>, <code>b</code>, <code>c</code>, or <code>d</code>, which is to say the same black-depth as the inputs <code>T B a x b</code> and <code>T B c y d)</code>.</li>\n</ul></li>\n<li><code>balance a x (T R bc y d)</code> and <code>balance</code> maintains the black invariant.</li>\n</ul></li>\n<li>For <code>app a (T R b x c)</code> or <code>app (T R a x b) c</code>, we know that <code>a</code>, <code>b</code>, and <code>c</code> all have the same black-depth and consequently, which means <code>app a b</code> and <code>app b c</code> have this same black-depth, which means <code>T R (app a b) x c</code> and <code>T R (app a b) x c</code> also have this same black-depth</li>\n</ul>\n\n<h3>Why is it fast?</h3>\n\n<p>My Racket is a bit rusty so I don't have a great answer to this. In general, <code>app</code> makes delete fast by allowing you to do everything in two steps: you go down to the target site, then you continue downwards to merge the subtrees, then you come back up fixing the invariants as you go, all the way to the root.</p>\n\n<p>In the <a href=\"http://matt.might.net/papers/germane2014deletion.pdf\" rel=\"noreferrer\">paper</a> you reference, once you get down to the target site, you call <code>min/delete</code> (I think this is the key difference - the rotations otherwise look pretty similar) which will recursively call itself to find the element in the subtree that you can plop into the target site and the state of the subtree after that element has been taken out. I believe that last part is what hurts the performance of that implementation.</p>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 38869791, "answer_count": 1, "score": 8, "last_activity_date": 1470822360, "creation_date": 1470061077, "question_id": 38701201, "link": "https://stackoverflow.com/questions/38701201/red-black-trees-kahrs-version", "title": "Red Black Trees: Kahrs version", "body": "<p>I'm currently trying to understand the Red-Black tree implementation as given by Okasaki and delete methods by Kahrs (<a href=\"https://www.cs.kent.ac.uk/people/staff/smk/redblack/Untyped.hs\">the untyped version</a>). </p>\n\n<p>In the delete implementation a function <code>app</code> is used, which seems to \"merging\" the children of the node being deleted. And again, the algorithm seems to use the same \"break\" the Red-Red property rather than black height (please correct me if I'm wrong).. We are always creating Red Nodes (even if we break the Red-Red property). walk down the subtree rooted at the node being deleted, correct the red-red violations, once we reach the leafs, we start going up the path (starting at the \"new tree\" merge created) fixing the red-red violation up the path.</p>\n\n<pre><code>app :: RB a -&gt; RB a -&gt; RB a\napp E x = x\napp x E = x\napp (T R a x b) (T R c y d) =\n    case app b c of\n        T R b' z c' -&gt; T R(T R a x b') z (T R c' y d)\n        bc -&gt; T R a x (T R bc y d)\napp (T B a x b) (T B c y d) = \n    case app b c of\n        T R b' z c' -&gt; T R(T B a x b') z (T B c' y d)\n        bc -&gt; balleft a x (T B bc y d)\napp a (T R b x c) = T R (app a b) x c\napp (T R a x b) c = T R a x (app b c)\n</code></pre>\n\n<ol>\n<li>I'm not able to see how we are \"not creating\" / \"fixing\" the black height violation? deleting a black node would create <code>bh-1</code> and <code>bh</code> subtrees at some node up the path. </li>\n<li>Results from <a href=\"http://matt.might.net/papers/germane2014deletion.pdf\">this paper</a>, looks like this implementation is really fast and that the \"merge\" method might be the key to answering the increase in speed.</li>\n</ol>\n\n<p>any pointers to an explanation for this \"merge\" operation would be great. </p>\n\n<p>please note this is not a homework problem or anything else. I'm studying independently the implementations given in Okasaki and fill in the \"messy\" deletes too.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["html", "haskell", "html-parsing", "content-type", "non-ascii-characters"], "comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470060855, "post_id": 38701016, "comment_id": 64779961, "body": "Is this question inappropriate on this site? Or have I made any mistakes? If so, thanks in advance for pointing it to me. I would like to know the reason for the quick down-votes. And sorry for the inconvenience caused."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1470061039, "post_id": 38701016, "comment_id": 64780077, "body": "IMO this seems to be a perfectly good question; don&#39;t know why people downvote this. It would perhaps be useful to also give the working Python example, for comparison."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1470061641, "post_id": 38701016, "comment_id": 64780476, "body": "FWIW, the problem also happens with the <a href=\"http://hackage.haskell.org/package/download-curl-0.1.4/docs/Network-Curl-Download.html\" rel=\"nofollow noreferrer\">download-curl</a> library instead of HTTP. It seems like Haskell just doesn&#39;t support the GBK character encoding... I suppose if you write your own html, you do it in UTF-8?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1470061905, "post_id": 38701016, "comment_id": 64780650, "body": "The problem also happens with just the <code>curl</code> command"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1470062131, "post_id": 38701016, "comment_id": 64780808, "body": "@leftaroundabout I added a minimal python code, and also added the code using <code>writeFile</code>. Thanks for the opinion. :) In addition, yes, when I wrote the html file, I used UTF-8. Thanks for the information!"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1470062445, "post_id": 38701016, "comment_id": 64781008, "body": "The browser understands <code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text&#47;html; charset=gbk&quot; &#47;&gt;</code> so it will decode the page using the GBK character encoding. ghci&#39;s <code>putStrLn</code> doesn&#39;t understand that obviously, so it tried to use your system encoding instead."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1470062496, "post_id": 38701016, "comment_id": 64781044, "body": "@pdexter <code>curl</code> doesn&#39;t do any character decoding, so what you see on a terminal will depend on your terminal&#39;s locale settings, i.e. the <code>LANG</code> env variable for Unix-like systems. And, of course, your terminal will need the right fonts as well."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470062781, "post_id": 38701016, "comment_id": 64781235, "body": "@ErikR ah okay, good to know. Guess it&#39;s not unicode then."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470062969, "post_id": 38701016, "comment_id": 64781351, "body": "@awllower - what kind of system are you using? Windows, OS X, Linux?"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470063280, "post_id": 38701016, "comment_id": 64781570, "body": "@ErikR I am using a mac el capitan. I also added this information to the question body. Thanks for the reminder. :)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470066686, "post_id": 38701016, "comment_id": 64783873, "body": "The file is encoded in GBK. I&#39;ve looked, and I cannot find any Haskell libraries which can convert GBK to Unicode. You should say what else you want to do with the file besides downloading it. Count words? Extract links? Just determine if the contents have changed?"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470067036, "post_id": 38701016, "comment_id": 64784113, "body": "The site seems to change the contents sometimes even though there are no updates, so I want to determine if there are updates by checking the number of <code>a</code> links inside a <code>li</code> list which I think is close to the number of chapters now available. Previously, when using <code>tagsoup</code> to parse the html file, I got errors about utf-8 encoding, and failed to produce anything. Maybe I shall just let python do its job and then use haskell for the rest? But, in my humble opinion, there is not much left for haskell to do. Thanks for the effort. :-)"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470069602, "post_id": 38701016, "comment_id": 64785609, "body": "@Michael Why delete your answer? I was about to say that it worked! Thanks a lot for telling me about this package! But unfortunately I failed to convert it to <code>String</code> type, but only to <code>[GHC.Word.Word8]</code> with <code>BL.unpack</code>. Still thanks though. :-)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470070014, "post_id": 38701016, "comment_id": 64785843, "body": "@awllower You can use tagsoup with bytestring since GBK doesn&#39;t change the encoding for ASCII characters."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1470071134, "post_id": 38701016, "comment_id": 64786426, "body": "@ErikR Ok, let me try this approach. Thanks very much!"}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470062308, "post_id": 38701450, "comment_id": 64780918, "body": "Thanks for the advise; I shall give other libraries or Bytestring a try."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470203565, "post_id": 38701450, "comment_id": 64846164, "body": "It turns out that <code>wreq</code> solves the problem. Thanks a lot!"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 8, "last_activity_date": 1470061829, "creation_date": 1470061829, "answer_id": 38701450, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website/38701450#38701450", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>I'm pretty sure that if you use <code>Network.HTTP</code> with the <code>String</code> type, it converts bytes to characters using your system encoding, which is, in general, wrong.</p>\n\n<p>This is only one of several reasons I don't like <code>Network.HTTP</code>.</p>\n\n<p>Your options: </p>\n\n<ol>\n<li><p>Use the <code>Bytestring</code> interface.  It's more awkward for some reason.  It'll also require you to decode the bytes to characters manually.  Most sites give you an encoding in the response headers, but sometimes they lie.  It's a giant mess, really.</p></li>\n<li><p>Use a different http fetching library.  I don't think any remove the messiness of dealing with lying encodings, but they at least don't make it more awkward to not use the system encoding incorrectly.  I'd look into <a href=\"https://hackage.haskell.org/package/wreq\">wreq</a> or <a href=\"https://hackage.haskell.org/package/http-client\">http-client</a> instead.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470064642, "post_id": 38702207, "comment_id": 64782426, "body": "I am installing the packages. And the curl command does not do it right. :("}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 1, "creation_date": 1470065286, "post_id": 38702207, "comment_id": 64782850, "body": "I tested the curl command by saving the output to a file and using <code>open</code> to view it in a browser. Is that how you tested it?"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470065808, "post_id": 38702207, "comment_id": 64783220, "body": "Oh, I tested it wrongly. Indeed the <code>curl</code> command gives the correct output. But <code>runhaskell</code> plus the <code>wreq</code> and <code>lens</code> still cannot display the output correctly. It sounds that the problem is terminal cannot handle the gbk encoding. Also, <code>readFile</code> cannot read the file saved by the <code>curl</code> command properly. So I am wondering now is there a way to parse the file after <code>curl</code> does the job? Or maybe we can change the encoding to utf-8 or big-5 or something? Thanks again for this."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470070055, "post_id": 38702207, "comment_id": 64785868, "body": "awllower you can change from gbk bytes to Text with <code>text-icu</code> and then from Text to utf8 bytes via <code>Data.Text.Encoding</code> - or else by doing something more sophisticated with <code>text-icu</code> again."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470071092, "post_id": 38702207, "comment_id": 64786404, "body": "@Michael: Sorry, I am not very familiar with working with encodings, and I don&#39;t really understand how to change from Text to utf8 bytes via <code>Data.Text.Encoding</code>: I see no particular function for doing this task in the module?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1470071393, "post_id": 38702207, "comment_id": 64786571, "body": "<code>T.encodeUtf8</code> turns a <code>Text</code> into (utf8 encoded) bytes; <code>T.decodeUtf8</code> turns a  (utf8 encoded) bytestring into a <code>Text</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1470071600, "post_id": 38702207, "comment_id": 64786694, "body": "I undeleted my answer for what its worth."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1470064292, "last_edit_date": 1470064292, "creation_date": 1470063901, "answer_id": 38702207, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website/38702207#38702207", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>This program produces the same output as the curl command:</p>\n\n<pre><code>curl \"http://www.piaotian.net/html/7/7430/\"\n</code></pre>\n\n<p>Test with:</p>\n\n<pre><code>stack program &gt; out.html\nopen out.html\n</code></pre>\n\n<p>(If not using <code>stack</code>, just install the <code>wreq</code> and <code>lens</code> packages and execute with <code>runhaskell</code>.)</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-6.0 --install-ghc runghc --package wreq --package lens --package bytestring\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wreq\nimport qualified Data.ByteString.Lazy.Char8 as LBS\nimport Control.Lens\n\nmain = do\n  r &lt;- get \"http://www.piaotian.net/html/7/7430/\"\n  LBS.putStr (r ^. responseBody)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470072698, "post_id": 38703597, "comment_id": 64787270, "body": "Yes, this looks right. But T.encodeUtf8 maps to ByteString, how should I transform that to a regular string? Or, is this possible? Thanks. :)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470072761, "post_id": 38703597, "comment_id": 64787296, "body": "If you want to go from a <code>Text</code> to a <code>String</code>, you use <code>T.unpack</code>; then bytestring is not involved."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470072966, "post_id": 38703597, "comment_id": 64787393, "body": "Note that if you save this String with <code>Prelude.writeFile</code> it will still look wrong in the browser, since <code>writeFile</code> will use your system encoding which seems to be <code>utf8</code>. The file itself says it is <code>gbk</code> which is how the browser will view it."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470073173, "post_id": 38703597, "comment_id": 64787530, "body": "I get it! Thanks a lot!"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 2, "creation_date": 1470073185, "post_id": 38703597, "comment_id": 64787538, "body": "To write a file that is <code>gbk</code> encoded using the above snippet, you would need to write <code>B.writeFile &quot;this.html&quot; $ ICU.fromUnicode gbk $ T.pack str</code>"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 6, "last_activity_date": 1470107514, "last_edit_date": 1470107514, "creation_date": 1470068395, "answer_id": 38703597, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website/38703597#38703597", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>If you just want to download the file, e.g. to look at later, you just need to use the ByteString interface. It would be better to use <code>http-client</code> for this (or <code>wreq</code> if you have some lens knowledge). Then you can open it in your browser, which will see that it is a gbk file. So far, you would just be transferring the raw bytes as lazy bytestring.  If I understand it, that's all the python is doing. Encodings are not an issue here; the browser is handling them.</p>\n\n<p>But if you want to view the characters inside ghci, for example, the main problem is that nothing will handle the gbk encoding by default the way the browser can. For that you need something like <code>text-icu</code> and the underlying C libraries. The program below uses the <code>http-client</code> library together with <code>text-icu</code> - these are I think pretty much standard for this problem, though you could use the less powerful <code>encoding</code> library for as much of the problem as we have seen it so far. It seems to work okay:</p>\n\n<pre><code>import Network.HTTP.Client                     -- http-client\nimport Network.HTTP.Types.Status (statusCode)\nimport qualified Data.Text.Encoding as T       -- text\nimport qualified Data.Text.IO as T\nimport qualified Data.Text as T\nimport qualified Data.Text.ICU.Convert as ICU  -- text-icu\nimport qualified Data.Text.ICU as ICU\nimport qualified Data.ByteString.Lazy as BL\n\nmain :: IO ()\nmain = do\n  manager &lt;- newManager defaultManagerSettings\n  request &lt;- parseRequest \"http://www.piaotian.net/html/7/7430/\"\n  response &lt;- httpLbs request manager\n  gbk &lt;- ICU.open \"gbk\" Nothing\n  let txt :: T.Text\n      txt = ICU.toUnicode gbk $ BL.toStrict $ responseBody response\n  T.putStrLn txt\n</code></pre>\n\n<p>Here <code>txt</code> is a <code>Text</code> value, i.e. basically just the 'code points'. The last bit <code>T.putStrLn txt</code> will use the system encoding to present the text to you. You can also explicitly handle the encoding with the functions in <code>Data.Text.Encoding</code> or the more sophisticate material in <code>text-icu</code> For example, if you want to save the text in the utf8 encoding, you would use <code>T.encodeUtf8</code> </p>\n\n<p>So in my ghci the output looks like so</p>\n\n<pre><code>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \" http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;\u8d70\u8fdb\u4fee\u4ed9\u6700\u65b0\u7ae0\u8282,\u8d70\u8fdb\u4fee\u4ed9\u65e0\u5f39\u7a97\u5168\u6587\u9605\u8bfb_\u98d8\u5929\u6587\u5b66&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=gbk\" /&gt;\n\n...\n</code></pre>\n\n<p>Does that look right? In my ghci, what I am seeing goes via utf8, since that's my system encoding, but note that the file is saying it is a gbk file, of course. If, then, you wanted to do some <code>Text</code> transformation and then save it as an html file -- then of course you would need to make sure the charset mentioned inside the file matched the encoding you used to make the bytestring you write to a file. </p>\n\n<p>You could also of course get this into the shape of a Haskell <code>String</code> by replacing the last three lines with </p>\n\n<pre><code>let str :: String\n    str = T.unpack $ ICU.toUnicode gbk $ BL.toStrict $ responseBody response\nputStrLn str\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 6, "last_activity_date": 1470069871, "creation_date": 1470069871, "answer_id": 38704019, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website/38704019#38704019", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>Here is an updated answer which uses the <code>encoding</code> package\nto convert the GBK encoded contents to Unicode.</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n  --resolver lts-6.0 --install-ghc runghc\n  --package wreq --package lens --package encoding --package binary\n-}\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wreq\nimport qualified Data.ByteString.Lazy.Char8 as LBS\nimport Control.Lens\nimport qualified Data.Encoding as E\nimport qualified Data.Encoding.GB18030 as E\nimport Data.Binary.Get\n\nmain = do\n  r &lt;- get \"http://www.piaotian.net/html/7/7430/\"\n  let body = r ^. responseBody :: LBS.ByteString\n      foo = runGet (E.decode E.GB18030) body \n  putStrLn foo\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470072547, "post_id": 38704375, "comment_id": 64787190, "body": "Really thanks for ending a day of turmoil. I shall get to know how this works later. After that, I will accept this answer. Thanks again!"}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1470203704, "post_id": 38704375, "comment_id": 64846224, "body": "So I guess we just don&#39;t use <code>putStrLn</code> and there is no problem then. ;P"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1470071122, "creation_date": 1470071122, "answer_id": 38704375, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website/38704375#38704375", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>Since you said you are interested in just the links, there is no need to convert the GBK encoding to Unicode.</p>\n\n<p>Here is a version which prints out all links like \"123456.html\" in the document:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n  --resolver lts-6.0 --install-ghc runghc\n  --package wreq --package lens\n  --package tagsoup\n-}\n\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wreq\nimport qualified Data.ByteString.Lazy.Char8 as LBS\nimport Control.Lens\nimport Text.HTML.TagSoup\nimport Data.Char\nimport Control.Monad\n\n-- match \\d+\\.html\nisNumberHtml lbs = (LBS.dropWhile isDigit lbs) == \".html\"\n\nwanted t = isTagOpenName \"a\" t &amp;&amp; isNumberHtml (fromAttrib \"href\" t)\n\nmain = do\n  r &lt;- get \"http://www.piaotian.net/html/7/7430/\"\n  let body = r ^. responseBody :: LBS.ByteString\n      tags = parseTags body\n      links = filter wanted tags\n      hrefs = map (fromAttrib \"href\") links\n  forM_ hrefs LBS.putStrLn\n</code></pre>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1045, "favorite_count": 1, "accepted_answer_id": 38704375, "answer_count": 5, "score": 15, "last_activity_date": 1470107514, "creation_date": 1470060527, "last_edit_date": 1470078717, "question_id": 38701016, "link": "https://stackoverflow.com/questions/38701016/why-can-haskell-not-handle-characters-from-a-specific-website", "title": "Why can Haskell not handle characters from a specific website?", "body": "<p>I was wondering if I can write a Haskell program to check updates of some novels on demand, and the website I am using as an example is <a href=\"http://www.piaotian.net/html/7/7430/\" rel=\"nofollow noreferrer\">this</a>. And I got a problem when displaying the contents of it (on a mac el capitan). The simple codes follow:</p>\n\n<pre><code>import Network.HTTP\n\nopenURL :: String -&gt; IO String\nopenURL = (&gt;&gt;= getResponseBody) . simpleHTTP . getRequest\n\ndisplay :: String -&gt; IO ()\ndisplay = (&gt;&gt;= putStrLn) . openURL\n</code></pre>\n\n<p>Then, when I run <code>display \"http://www.piaotian.net/html/7/7430/\"</code> on ghci, some strange characters appear; the first lines look like this:</p>\n\n<pre><code>&lt;title&gt;\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00d7\u00ee\u00d0\u00c2\u00d5\u00c2\u00bd\u00da,\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00ce\u00de\u00b5\u00af\u00b4\u00b0\u00c8\u00ab\u00ce\u00c4\u00d4\u00c4\u00b6\u00c1_\u00c6\u00ae\u00cc\u00ec\u00ce\u00c4\u00d1\u00a7&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=gbk\" /&gt;\n&lt;meta name=\"keywords\" content=\"\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9,\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00d7\u00ee\u00d0\u00c2\u00d5\u00c2\u00bd\u00da,\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00ce\u00de\u00b5\u00af\u00b4\u00b0 \u00c6\u00ae\u00cc\u00ec\u00ce\u00c4\u00d1\u00a7\" /&gt;\n&lt;meta name=\"description\" content=\"\u00c6\u00ae\u00cc\u00ec\u00ce\u00c4\u00d1\u00a7\u00cd\u00f8\u00cc\u00e1\u00b9\u00a9\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00d7\u00ee\u00d0\u00c2\u00d5\u00c2\u00bd\u00da\u00c3\u00e2\u00b7\u00d1\u00d4\u00c4\u00b6\u00c1\u00a3\u00ac\u00c7\u00eb\u00bd\u00ab\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00d5\u00c2\u00bd\u00da\u00c4\u00bf\u00c2\u00bc\u00bc\u00d3\u00c8\u00eb\u00ca\u00d5\u00b2\u00d8\u00b7\u00bd\u00b1\u00e3\u00cf\u00c2\u00b4\u00ce\u00d4\u00c4\u00b6\u00c1,\u00c6\u00ae\u00cc\u00ec\u00ce\u00c4\u00d1\u00a7\u00d0\u00a1\u00cb\u00b5\u00d4\u00c4\u00b6\u00c1\u00cd\u00f8\u00be\u00a1\u00c1\u00a6\u00d4\u00da\u00b5\u00da\u00d2\u00bb\u00ca\u00b1\u00bc\u00e4\u00b8\u00fc\u00d0\u00c2\u00d0\u00a1\u00cb\u00b5\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00a3\u00ac\u00c8\u00e7\u00b7\u00a2\u00cf\u00d6\u00ce\u00b4\u00bc\u00b0\u00ca\u00b1\u00b8\u00fc\u00d0\u00c2\u00a3\u00ac\u00c7\u00eb\u00c1\u00aa\u00cf\u00b5\u00ce\u00d2\u00c3\u00c7\u00a1\u00a3\" /&gt;\n&lt;meta name=\"copyright\" content=\"\u00d7\u00df\u00bd\u00f8\u00d0\u00de\u00cf\u00c9\u00b0\u00e6\u00c8\u00a8\u00ca\u00f4\u00d3\u00da\u00d7\u00f7\u00d5\u00df\u00ce\u00e1\u00b5\u00c0\u00b3\u00a4\u00b2\u00bb\u00b9\u00c2\" /&gt;\n&lt;meta name=\"author\" content=\"\u00ce\u00e1\u00b5\u00c0\u00b3\u00a4\u00b2\u00bb\u00b9\u00c2\" /&gt;\n&lt;link rel=\"stylesheet\" href=\"/scripts/read/list.css\" type=\"text/css\" media=\"all\" /&gt;\n&lt;script type=\"text/javascript\"&gt;\n</code></pre>\n\n<p>I also tried to download as a file as follows:</p>\n\n<pre><code>import Network.HTTP\n\nopenURL :: String -&gt; IO String\nopenURL = (&gt;&gt;= getResponseBody) . simpleHTTP . getRequest\n\ndownloading :: String -&gt; IO ()\ndownloading = (&gt;&gt;= writeFile fileName) . openURL\n</code></pre>\n\n<p>But after downloading the file, it is like in the photo:\n<a href=\"https://i.stack.imgur.com/bExTt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bExTt.png\" alt=\"enter image description here\"></a></p>\n\n<p>If I download the page by python (using urllib for example) the characters are displayed normally. Also, if I write a Chinese html and parse it, then there seems to be no problem. Thus it seems that the problem is on the website. However, I don't see any difference between the characters of the site and those I write.</p>\n\n<p>Any help on the reason behind this is well appreciated.</p>\n\n<p><strong>P.S.</strong><br>\nThe python code is as follows:</p>\n\n<pre><code>import urllib\n\nurllib.urlretrieve('http://www.piaotian.net/html/7/7430/', theFic)\n\ntheFic = file_path\n</code></pre>\n\n<p>And the file is all fine and good.</p>\n"}, {"tags": ["haskell", "binary", "network-programming", "packet", "bytestring"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1470071285, "post_id": 38698357, "comment_id": 64786505, "body": "Haskell does not give you any guarantees about memory layout so you can not simply cast a set of bytes as a struct - you must parse it using <code>binary</code> or something rather like it (<code>cereal</code>, <code>avro</code>, <code>attoparsec</code>, etc)."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1470080453, "post_id": 38698357, "comment_id": 64791233, "body": "Since <a href=\"https://tools.ietf.org/html/rfc6733#page-41\" rel=\"nofollow noreferrer\">AVP header layout depends on the flags</a> you can&#39;t really do it with <code>StructLayout</code> either."}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 0, "creation_date": 1470125257, "post_id": 38698357, "comment_id": 64806534, "body": "You are right Cirdec, but I want to know the solution anyway for other uses."}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 0, "creation_date": 1470129378, "post_id": 38698357, "comment_id": 64809097, "body": "Let me clarify my requirement more: In Python we can create a class with initialization constructor, and then use Struct package and * operator to map class fields to bytes format:  <code>class MyTest:     def __init__(x:int, y:int):         self.x=x         self.y=y  m=MyTest(*struct.unpack(&#39;il&#39;), b&#39;\\x00\\x01\\x00\\x02\\x00\\x00\\x00\\x03&#39;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 0, "creation_date": 1470125132, "post_id": 38709741, "comment_id": 64806464, "body": "I do not mean under the hood layout necessarily, I mean something simulating it, like in Python: struct package helps very much to convert bytestring (bytes in Python 3) to a standard Python class/tuple."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "edited": false, "score": 1, "creation_date": 1470153965, "post_id": 38709741, "comment_id": 64826894, "body": "@Kamyar Binary instances provide exactly that though, so I still don&#39;t understand the problem."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1470154125, "last_edit_date": 1470154125, "creation_date": 1470095422, "answer_id": 38709741, "question_id": 38698357, "link": "https://stackoverflow.com/questions/38698357/how-can-i-map-a-binary-network-packet-structure-to-haskell-standard-data-types/38709741#38709741", "title": "How can I map a binary network packet structure to Haskell standard data types (records)?", "body": "<p>Haskell does not give you any guarantees about memory layout so you can not simply cast a set of bytes as a struct - you must parse it using binary or something rather like it (cereal, attoparsec, etc).</p>\n\n<p>EDIT: For an example use of binary, consider:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Binary\nimport GHC.Generics (Generic)\n\ndata Foo = Foo Int | Bar String deriving (Eq, Ord, Show, Read, Generic)\n\ninstance Binary Foo\n</code></pre>\n\n<p>Now you can <code>encode</code> and <code>decode</code> the <code>Foo</code> type to and from bytes.</p>\n"}], "owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 1, "accepted_answer_id": 38709741, "answer_count": 1, "score": 3, "last_activity_date": 1470154125, "creation_date": 1470052883, "question_id": 38698357, "link": "https://stackoverflow.com/questions/38698357/how-can-i-map-a-binary-network-packet-structure-to-haskell-standard-data-types", "title": "How can I map a binary network packet structure to Haskell standard data types (records)?", "body": "<p>I want to implement a binary protocol (RFC3588, Diameter) with pure Haskell. I need to know is there any better way (Than e.g. Data.Binary...) to read/write data from/to ByteStrings. I like mapping a Haskell record to ByteString, as like what is usual in C# using StructLayout attribute (decorator).</p>\n"}, {"tags": ["haskell", "switch-statement"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 1, "creation_date": 1470043394, "post_id": 38695145, "comment_id": 64769053, "body": "It&#39;s the pattern of the alternative. You could also have written <code>a</code> instead in this particular example, except that <code>_</code> does not bind the matched value to any variable."}], "answers": [{"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1470047047, "post_id": 38695527, "comment_id": 64771214, "body": "Thank you so much for your detailed answer! Everything is very clear now :)"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 12, "last_activity_date": 1470044687, "last_edit_date": 1470044687, "creation_date": 1470044251, "answer_id": 38695527, "question_id": 38695145, "link": "https://stackoverflow.com/questions/38695145/meaning-of-underscore-in-case/38695527#38695527", "title": "Meaning of underscore in case ()", "body": "<p>As @Rhymoid said in the comment, it is just a pattern match with nothing being bound and it could be replaced by a name (which would be bound). It might be more clear to write it like this:</p>\n\n<pre><code>case () of\n  _ | someBool -&gt; ...\n    | somOtherBool -&gt; ...\n</code></pre>\n\n<p>This could also be written (more or less equivalently) as</p>\n\n<pre><code>case () of\n  () | someBool -&gt; ...\n     | someOtherBool -&gt; ...\n</code></pre>\n\n<p>These are guards. You can also have guards in a more complex <code>case</code> match:</p>\n\n<pre><code>case m of\n  Just x\n    | someBool -&gt; ...\n    | someOtherBool -&gt; ...\n  Nothing\n    | someThirdBool -&gt; ...\n    | someFourthBool -&gt; ...\n</code></pre>\n\n<p>with as many guards as you want in each match.</p>\n\n<p>The reason to write the code you have given is a trick to get a succinct if-then-else style thing with several possibilities. The original code can be better written with the <code>MultiWayIf</code> extension enabled:</p>\n\n<pre><code>{-# LANGUAGE MultiWayIf #-}\n...\n  if | someBool -&gt; ...\n     | someOtherBool -&gt; ...\n</code></pre>\n\n<p><code>MultiWayIf</code> can also be used with any number of Boolean \"cases,\" like the original code.</p>\n\n<p>An underscore can be used in any pattern match for any pattern where you don't need the value later. For example:</p>\n\n<pre><code>andBool True True = True\nandBool _    _    = False\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f (Just _) = 'J'\nf _        = 'N'\n</code></pre>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 1, "accepted_answer_id": 38695527, "answer_count": 1, "score": 6, "last_activity_date": 1470044687, "creation_date": 1470043179, "question_id": 38695145, "link": "https://stackoverflow.com/questions/38695145/meaning-of-underscore-in-case", "title": "Meaning of underscore in case ()", "body": "<p>So I've seen the syntax around for </p>\n\n<pre><code>case () of _\n   | someBool -&gt;\n   | someOtherBool -&gt;\n</code></pre>\n\n<p>I understand what it does, e.g. toggle a case completely independently of the thing being evaluated by case (which makes sense, as in this case that would be unit, and it will always be unit).</p>\n\n<p>I also understand that this can and (should) work independently of the thing being checked with case (eg (1 == 1) (someComplexFunction)), but that obviously unit is the fastest.</p>\n\n<p>What I don't quite understand, is how the underscore works. It clearly informs the case to completely ignore the contents of the operand and just check for booleans. But where does this operator come from? And in what other contexts can I use it?</p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types", "data-kinds"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470040605, "post_id": 38694235, "comment_id": 64767308, "body": "I&#39;m kind of confused with the terminology. You show your error while using datatypes but then ask how to make Fleet into a typeclass? Anyways, you&#39;re getting the error because <code>Fleet</code> is not a type, it is a constructor of the type <code>Unit</code>. I think you should rethink your design a little bit. Also, <code>DataKinds</code> are definitely not what you want. They&#39;re an advanced feature which does not apply here."}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470042648, "post_id": 38694235, "comment_id": 64768618, "body": "Oh, I...kind of forgot I said that. Thanks for that. Update now fixed this."}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1470041214, "post_id": 38694416, "comment_id": 64767675, "body": "I just edited my post to clarify a little bit more on that. Judging by that, I think I&#39;ll just go the validation function route (read the edit). Also, I didn&#39;t know that typeclasses and DataKinds were advanced (granted I don&#39;t even know what&#39;s advanced anymore with this language...it took me a couple full days to try to understand what the whole Peano arithmetic thing with (+) being defined in terms of Succ...oy vey), I&#39;ve seen them all over the place in error screens."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 1, "creation_date": 1470041645, "post_id": 38694416, "comment_id": 64767971, "body": "I guess the main question is: do <code>Fleet</code> and <code>Army</code> have any fields? As written above, they carry no information with them. If such, what would be the gain in passing a <code>Fleet</code> argument to <code>Convoy</code>, if you already know that that is the only value that argument can have?"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1470042014, "post_id": 38694416, "comment_id": 64768248, "body": "Right now, they don&#39;t have any fields, but I may change that. I can&#39;t decide whether or not I want a given Territory (basically a location, so English Channel would be a Territory) to Maybe have a Unit associated with it or if I want a Unit to have a Territory associated with it. I was hoping to be able to do something like being able to write  <code>Convoy (eliminate $ unit someTerritory) someTerritory otherTerritory</code> or something of the sort (where eliminate just removes the Just from a Maybe or throws an error"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1470044707, "post_id": 38694416, "comment_id": 64769842, "body": "See the edit. If you want to add fields you can use more types to do what you want."}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1470084625, "post_id": 38694416, "comment_id": 64793317, "body": "Is there any way to do something like one would in OOP, deriving a data type? Basically saying Fleet and Army are both Units, without having to rebuild them?"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1470088416, "post_id": 38694416, "comment_id": 64794989, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/118854/discussion-between-jack-brandt-and-chi\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1470044551, "last_edit_date": 1470044551, "creation_date": 1470040832, "answer_id": 38694416, "question_id": 38694235, "link": "https://stackoverflow.com/questions/38694235/types-kinds-confusion-in-haskell-maybe-in-algebraic-data-types/38694416#38694416", "title": "Types/Kinds Confusion in Haskell (Maybe) in Algebraic Data Types", "body": "<pre><code>data Unit = Fleet | Army \n</code></pre>\n\n<p><code>Unit</code> is a type. Its values can be either <code>Fleet</code> or <code>Army</code> -- these are not types.</p>\n\n<pre><code>data Order = Hold Unit Territory\n           | Move Unit Territory Territory\n           | Support Unit Territory Unit Territory Territory\n                     ^^^^           ^^^^\n</code></pre>\n\n<p>These are types -- OK.</p>\n\n<pre><code>           | Convoy Fleet Territory Army Territory Territory\n                    ^^^^^           ^^^^\n</code></pre>\n\n<p>These are values -- not OK. The line above is quite similar to</p>\n\n<pre><code>           | Convoy \"hello\" Territory 42 Territory Territory\n</code></pre>\n\n<p>which makes no sense.</p>\n\n<p>You might simply want to use</p>\n\n<pre><code>           | Convoy Territory Territory Territory\n</code></pre>\n\n<p>but I'm not familiar with the game, so I don't know what you actually need there.</p>\n\n<p>Also, forget with typeclasses and the <code>DataKinds</code> extension -- don't use advanced stuff unless you really need it.</p>\n\n<hr>\n\n<p>As another option, if you do plan to add fields to <code>Fleet</code> and <code>Army</code>, is to turn them into types</p>\n\n<pre><code>data Fleet = F String Int -- dummy fields, you can put none\ndata Army = A\ndata Unit = FleetUnit Fleet | ArmyUnit Army    -- added the types here\ndata Order = Hold Unit Territory\n           | Move Unit Territory Territory\n           | Support Unit Territory Unit Territory Territory\n           | Convoy Fleet Territory Army Territory Territory\n</code></pre>\n\n<p>Now the last line is ok. The price for this is that you need to use more \"wrapping\" constructors to build an order, e.g.</p>\n\n<pre><code>orderExample1 :: Order\norderExample1 = Convoy (F \"test\" 33) terr1 A terr2 terr3\n\norderExample2 :: Order\norderExample2 = Support (FleetUnit (F \"test2\" 55)) terr1 (ArmyUnit A) terr2 terr3\n</code></pre>\n\n<p>Above, <code>F ...</code> builds a <code>Fleet</code>, then <code>FleetUnit ...</code> turns it into a <code>Unit</code>, and finally <code>Support ...</code> turns that into an <code>Order</code>.</p>\n"}], "owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1470044551, "creation_date": 1470040267, "last_edit_date": 1470040914, "question_id": 38694235, "link": "https://stackoverflow.com/questions/38694235/types-kinds-confusion-in-haskell-maybe-in-algebraic-data-types", "title": "Types/Kinds Confusion in Haskell (Maybe) in Algebraic Data Types", "body": "<p>I've been working on building my own <a href=\"https://en.wikipedia.org/wiki/Diplomacy_(game)\" rel=\"nofollow\">Diplomacy</a> simulator in Haskell to get my feet wet.</p>\n\n<p>I believe I've come up with a decent definition for what an order is: </p>\n\n<pre><code>data Order = Hold Unit Territory\n           | Move Unit Territory Territory\n           | Support Unit Territory Unit Territory Territory\n           | Convoy Fleet Territory Army Territory Territory\n  deriving (Eq, Show)\n</code></pre>\n\n<p>For those not familiar with the game, the orders are written in the form of \"Hold Fleet London\", \"Move Fleet London English Channel\", \"Support Fleet English Channel Fleet North Atlantic Ocean Mid Atlantic Ocean\" or \"Convoy Fleet English Channel Army London Brest\", etc.</p>\n\n<p>Now, with the definition of Unit as <code>data Unit = Fleet | Army (deriving Eq, Show)</code>, I'm getting the error <code>Not in scope: type constructor or class 'Fleet'</code> with regard to my definition of Order.</p>\n\n<p>Why is this?</p>\n\n<p>How can should I write my definitions for Units or Orders (or should I do something different) that allows me to require that the first argument to Convoy be a Fleet and the third argument be an Army? </p>\n\n<p>Am I just \"not even wrong\" with my approach to this problem?</p>\n\n<p>Should I approach this in my validation function (because there's no WAY to specify only valid orders via Haskell, so far as I know. It's expressive but not THAT expressive)?</p>\n\n<p>I already tried using \"DataKinds\", but that didn't help me at all (despite the error postscript suggesting to do so, then again, Haskell error postscripts suggest a lot of things, so I doubt I need to pay too much heed to it).  </p>\n"}, {"tags": ["haskell", "typeclass", "newtype"], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 7, "last_activity_date": 1470015147, "creation_date": 1470015147, "answer_id": 38689892, "question_id": 38689816, "link": "https://stackoverflow.com/questions/38689816/creating-ord-instances-with-newtype-wrapping/38689892#38689892", "title": "Creating Ord instances with newtype wrapping", "body": "<p>This is absolutely reasonable. In fact, you can use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Ord.html#v:comparing\">the <code>comparing</code> function from <code>Data.Ord</code></a> to make this even more direct:</p>\n\n<pre><code>instance Ord FooPriorityA where\n  compare (FooPriorityA x) (FooPriorityA y) = comparing f x y\n    where f :: Foo -&gt; Int\n          f Baz = 1\n          f Bar = 2\n          f Qux = 3\n</code></pre>\n\n<p>Though depending on your preferences, the version with <code>compare</code> might be more to your liking.</p>\n"}, {"comments": [{"owner": {"reputation": 804, "user_id": 97667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ff1dfbac2ed4e82090da21567de4e73?s=128&d=identicon&r=PG", "display_name": "SimonF", "link": "https://stackoverflow.com/users/97667/simonf"}, "edited": false, "score": 0, "creation_date": 1470018228, "post_id": 38689960, "comment_id": 64759858, "body": "I think I prefer the pattern match internally to the instance, mainly because while your <code>fooOrdering</code> saves some characters, it makes it possible to provide some pretty non-sensical values, e.g., [Bar, Bar, Bar, Bar]. Whereas pattern matching will give warnings for such things. You could totally stuff up the Ints, though, I guess."}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "reply_to_user": {"reputation": 804, "user_id": 97667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ff1dfbac2ed4e82090da21567de4e73?s=128&d=identicon&r=PG", "display_name": "SimonF", "link": "https://stackoverflow.com/users/97667/simonf"}, "edited": false, "score": 0, "creation_date": 1470027662, "post_id": 38689960, "comment_id": 64761620, "body": "@SimonF: I was thinking you&#39;d prevent non-sensical values by adding an assertion to make sure that all elements occur exactly once in the list. But you are right, the compiler will already do that for pattern matching."}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "reply_to_user": {"reputation": 804, "user_id": 97667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ff1dfbac2ed4e82090da21567de4e73?s=128&d=identicon&r=PG", "display_name": "SimonF", "link": "https://stackoverflow.com/users/97667/simonf"}, "edited": false, "score": 0, "creation_date": 1470027737, "post_id": 38689960, "comment_id": 64761637, "body": "The other thing I don&#39;t like about my solution is that it has to iterate the list at runtime for every comparison. Would be nice to have a static map constructed at compile-time (or at least memoized after first use)."}], "tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": false, "score": 0, "last_activity_date": 1470015961, "creation_date": 1470015961, "answer_id": 38689960, "question_id": 38689816, "link": "https://stackoverflow.com/questions/38689816/creating-ord-instances-with-newtype-wrapping/38689960#38689960", "title": "Creating Ord instances with newtype wrapping", "body": "<p>How about making a function to generate the mapping from <code>Foo</code> to <code>Int</code> based on a list that represents the ordering you want:</p>\n\n<pre><code>import Data.List\n\ndata Foo = Bar | Baz | Qux deriving Eq\n\nnewtype FooPriorityA = FooPriorityA { unFooPriorityA :: Foo } deriving Eq\n\nfooOrdering :: [Foo] -&gt; Foo -&gt; Foo -&gt; Ordering\nfooOrdering orderedList a b = f a `compare` f b\n    where f x = elemIndex x orderedList\n\ninstance Ord FooPriorityA where\n    compare (FooPriorityA x) (FooPriorityA y) = fooOrdering [Baz, Bar, Qux] x y\n</code></pre>\n\n<p>You could even add an assertion to make sure that all elements occur exactly once in the list.</p>\n"}, {"comments": [{"owner": {"reputation": 804, "user_id": 97667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ff1dfbac2ed4e82090da21567de4e73?s=128&d=identicon&r=PG", "display_name": "SimonF", "link": "https://stackoverflow.com/users/97667/simonf"}, "edited": false, "score": 0, "creation_date": 1470024408, "post_id": 38690188, "comment_id": 64760893, "body": "That&#39;s some fantastic information, thanks. The observation about the relationship between my <code>f</code> and the <code>Enum</code> typeclass is fascinating."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1470024335, "last_edit_date": 1470024335, "creation_date": 1470018169, "answer_id": 38690188, "question_id": 38689816, "link": "https://stackoverflow.com/questions/38689816/creating-ord-instances-with-newtype-wrapping/38690188#38690188", "title": "Creating Ord instances with newtype wrapping", "body": "<p>You only need O(<em>n</em>) (2&#8203;<em>n</em> - 1, to be precise) definitions to specify a total order, as long as you specify the cases in increasing order of priority:</p>\n\n<pre><code>instance Ord FooPriorityA where\n    compare (FooPriorityA x) (FooPriorityA y) | x == y = EQ   -- Use the Eq instance\n                                              -- Bar is the smallest\n                                              | x == Bar = LT\n                                              | y == Bar = GT\n                                              -- Baz is the next smallest\n                                              | x == Baz = LT\n                                              | y == Baz = GT\n                                              -- Proceed in the desired order.\n                                              -- You don't need to say anything\n                                              -- explicit about the largest value\n</code></pre>\n\n<p>The first case (<code>x == y</code>) covers O(n) possibilities. Each case that follows may look incomplete, but it carries the implied information that each preceding case is false. For example, <code>x == Bar = LT</code> does not mean that <em>every</em> case where <code>x == Bar</code> evaluates to <code>LT</code>; the case where <code>x == Bar &amp;&amp; y == Bar</code> is already handled, so the second case is really implicitly <code>x == Bar &amp;&amp; y /= Bar</code>. </p>\n\n<p>Likewise, case 4 (<code>x == Baz</code>) carries the assumption that <code>y /= Baz</code> (implied by the failure of case 1 to match) and <code>y /= Bar</code> (implied by the failure of case 3 to match). Therefore, any remaining possible value for <code>y</code> is, in fact, greater than <code>Baz</code>.</p>\n\n<p>The further down the list you go, the fewer unhandled cases remain. By the end, you don't need to say anything explicit about the largest item; all the information about how it compares to the other <em>n</em> - 1 items has already been captured by the preceding cases.</p>\n\n<hr>\n\n<p>Also, keep in mind that your definition of <code>f</code> is one half (<code>fromEnum</code>) of the minimum implementation of an instance of the <code>Enum</code> class, which you could then use to define your <code>Ord</code> instance.</p>\n\n<pre><code>instance Enum FooPriorityA where\n     fromEnum Bar = 1\n     fromEnum Baz = 2\n     fromEnum Qux = 3\n     toEnum 1 = Bar\n     toEnum 2 = Baz\n     toEnum 3 = Qux\n\ninstance Ord FooPriorityA where\n    compare x y = compare (fromEnum x) (fromEnum y)\n    -- compare = compare `on` Data.Function.fromEnum\n</code></pre>\n"}], "owner": {"reputation": 804, "user_id": 97667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ff1dfbac2ed4e82090da21567de4e73?s=128&d=identicon&r=PG", "display_name": "SimonF", "link": "https://stackoverflow.com/users/97667/simonf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 38690188, "answer_count": 3, "score": 3, "last_activity_date": 1470024335, "creation_date": 1470014472, "question_id": 38689816, "link": "https://stackoverflow.com/questions/38689816/creating-ord-instances-with-newtype-wrapping", "title": "Creating Ord instances with newtype wrapping", "body": "<p>Given a datatype such as</p>\n\n<pre><code>data Foo = Bar | Baz | Qux\n</code></pre>\n\n<p>and I wish to have multiple different orderings for this type, is the following the most common/standard way to achieve this?</p>\n\n<pre><code>newtype FooPriorityA = FooPriorityA { unFooPriorityA :: Foo }\n\ninstance Ord FooPriorityA where\n    compare (FooPriorityA x) (FooPriorityA y) = f x `compare` f y\n        where f :: Foo -&gt; Int\n              f Baz = 1\n              f Bar = 2\n              f Qux = 3\n\nnewtype FooPriorityB = FooPriorityB ... and so on\n</code></pre>\n\n<p>Is delegating to Int's Ord instance like that crazy? It feels safer and a whole lot less work than writing out the n^2 comparisons for <code>compare</code>.</p>\n\n<p>Any obvious flaws I might have overlooked with this \"hack\"? Is it even a \"hack\"?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1470005840, "post_id": 38688891, "comment_id": 64757723, "body": "Do not conform to the rules: relax them by enabling <code>-XTypeSynonymInstances</code> as the compiler suggests. <code>-XFlexiblesInstances</code> may also be required."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1470010434, "post_id": 38689007, "comment_id": 64758446, "body": "I think the extensions can be avoided by dealing with <code>WriterT</code> more generally."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1470005287, "creation_date": 1470005287, "answer_id": 38689007, "question_id": 38688891, "link": "https://stackoverflow.com/questions/38688891/make-monoid-instance-of-writer-haskell/38689007#38689007", "title": "Make Monoid instance of Writer (Haskell)", "body": "<p><code>Writer</code> is a type alias <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Writer-Lazy.html#t:Writer\" rel=\"nofollow\">(link)</a></p>\n\n<pre><code>type Writer w = WriterT w Identity\n</code></pre>\n\n<p>so use <code>WriterT ... Identity</code> instead. You'll still need to enable FlexibleInstances.</p>\n\n<p>Perhaps this is what you are after:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Monad.Trans.Writer\nimport Data.Monoid\nimport Data.Functor.Identity\n\ninstance (Monoid w, Monoid a) =&gt; Monoid (WriterT w Identity a) where\n  mempty = return mempty\n  m1 `mappend` m2 = writer (a1 &lt;&gt; a2, w1 &lt;&gt; w2)\n    where\n      (a1,w1) = runWriter m1\n      (a2,w2) = runWriter m2\n</code></pre>\n\n<p>Of course, this could be generalized to an arbitrary Monad instead of Identity.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1470015759, "post_id": 38689488, "comment_id": 64759382, "body": "Surely there&#39;s an extension to do that, isn&#39;t there?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1470087008, "post_id": 38689488, "comment_id": 64794415, "body": "How embarrassing! After all, I&#39;m the one who proposed adding <code>Ap</code> to <code>Data.Monoid</code>, with <code>newtype Ap f a = Ap (f a)</code>, <code>instance (Applicative f, Monoid a) =&gt; Monoid (Ap f a)</code>. Note that <code>Monad</code> is overkill."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1470087106, "post_id": 38689488, "comment_id": 64794453, "body": "@Bergi, there are overlapping instances, but they&#39;re evil."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1470010931, "last_edit_date": 1470010931, "creation_date": 1470010505, "answer_id": 38689488, "question_id": 38688891, "link": "https://stackoverflow.com/questions/38688891/make-monoid-instance-of-writer-haskell/38689488#38689488", "title": "Make Monoid instance of Writer (Haskell)", "body": "<p>Everybody is doing so much work.  The bind operator on a writer monad already appends the <code>w</code>s. This also means it will work for an arbitrary base monad.</p>\n\n<pre><code>instance (Monoid w, Monoid a, Monad m) =&gt; Monoid (WriterT w m a) where\n    mempty = return mempty\n    mappend = liftA2 mappend\n</code></pre>\n\n<p>At this point it's clear that even <code>WriterT</code> is superfluous, and this is actually an \"instance\" of this general <code>instance</code></p>\n\n<pre><code>instance (Monoid a, Monad m) =&gt; Monoid (m a) where\n    -- same\n</code></pre>\n\n<p>but Haskell's class system doesn't really permit instances like this -- it would match every monoid built from a type constructor. For example this instance would match <code>Sum Int</code>, and then fail because <code>Sum</code> isn't a monad. So you have to specifify it seperately for each monad you're interested in.</p>\n"}], "owner": {"reputation": 253, "user_id": 6275672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0ad96f53097266499d51f0ff80a00e0?s=128&d=identicon&r=PG&f=1", "display_name": "Mercury Bench", "link": "https://stackoverflow.com/users/6275672/mercury-bench"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 38689488, "answer_count": 2, "score": 1, "last_activity_date": 1470010931, "creation_date": 1470004076, "question_id": 38688891, "link": "https://stackoverflow.com/questions/38688891/make-monoid-instance-of-writer-haskell", "title": "Make Monoid instance of Writer (Haskell)", "body": "<p>in Haskell, I would like to make a Writer monad an instance of a monoid: </p>\n\n<pre><code>instance (Monoid a) =&gt; Monoid (Writer (Sum Int) a) where\n  mempty = return mempty\n  w1 `mappend` w2 = writer((s++t, s'++t'), Sum (m+n)) where\n    ((s,s'), Sum m) = runWriter w1\n    ((t,t'), Sum n) = runWriter w2\n</code></pre>\n\n<p>So, intuitively, if the \"data\" type of the Writer monad is a monoid, I want to be able to consider the whole Writer thing as a monoid as well (as implemented by mempty and mappend.</p>\n\n<p>This doesn't work, though: The GHCI compiler says</p>\n\n<pre><code>Illegal instance declaration for `Monoid (Writer (Sum Int) a)'\n  (All instance types must be of the form (T t1 ... tn)\n   where T is not a synonym.\n   Use -XTypeSynonymInstances if you want to disable this.)\nIn the instance declaration for `Monoid (Writer (Sum Int) a)'\n</code></pre>\n\n<p>and I really don't know what type is supposed to be a synonym here and how I can conform to the compiler's rules.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": true, "score": 7, "last_activity_date": 1469998930, "creation_date": 1469998930, "answer_id": 38688368, "question_id": 38688331, "link": "https://stackoverflow.com/questions/38688331/join-with-as-parameter-to-create-square-function/38688368#38688368", "title": "&quot;join&quot; with (*) as parameter to create square function ?", "body": "<p>The <code>((-&gt;)r)</code> type forms a monad with the following instance <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645\">definition</a></p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n  f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<p>And <code>join</code> has the following <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#join\">definition</a></p>\n\n<pre><code>join x =  x &gt;&gt;= id\n</code></pre>\n\n<p>So let's start filling stuff in.</p>\n\n<pre><code>join (*)\n= (*) &gt;&gt;= id\n= \\r -&gt; id ((*) r) r\n= \\r -&gt; r * r\n</code></pre>\n"}], "owner": {"reputation": 525, "user_id": 5869301, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86a49e0145a284ba5a05873250323f4d?s=128&d=identicon&r=PG&f=1", "display_name": "bisthebis", "link": "https://stackoverflow.com/users/5869301/bisthebis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 1, "accepted_answer_id": 38688368, "answer_count": 1, "score": 3, "last_activity_date": 1469998930, "creation_date": 1469998475, "question_id": 38688331, "link": "https://stackoverflow.com/questions/38688331/join-with-as-parameter-to-create-square-function", "title": "&quot;join&quot; with (*) as parameter to create square function ?", "body": "<p>I was playing a bit with <a href=\"http://pointfree.io\" rel=\"nofollow\">pointfree.io</a> and when I entered \"\\x -> x*x\" (aka square function), it did output this</p>\n\n<pre><code>join (*)\n</code></pre>\n\n<p>I didn't know this, and I checked it on Hoogle:</p>\n\n<pre><code>-- | The 'join' function is the conventional monad join operator. It\n-- is used to remove one level of monadic structure, projecting its\n-- bound argument into the outer level.\njoin              :: (Monad m) =&gt; m (m a) -&gt; m a\njoin x            =  x &gt;&gt;= id\n</code></pre>\n\n<p>I have no idea about how this works to create a function that returns the square of its param. Any idea ?</p>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 6, "creation_date": 1469996879, "post_id": 38688037, "comment_id": 64755605, "body": "I don\u2019t think that <code>Data.Array.IArray</code> provides any way to do this built-in, but with the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#pattern-synonyms\" rel=\"nofollow noreferrer\"><code>PatternSynonyms</code></a> and <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#view-patterns\" rel=\"nofollow noreferrer\"><code>ViewPatterns</code></a> extensions, you could probably implement something like this yourself. You could also just use guards instead of patterns for this."}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 4673683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/106a6b52825462b10ef0904466351c00?s=128&d=identicon&r=PG", "display_name": "user19018", "link": "https://stackoverflow.com/users/4673683/user19018"}, "edited": false, "score": 0, "creation_date": 1469999113, "post_id": 38688212, "comment_id": 64756228, "body": "In fact, I think the <code>Ix</code> type class specifies how the indices of an array are mapped into contiguous integers."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1469997611, "creation_date": 1469997611, "answer_id": 38688212, "question_id": 38688037, "link": "https://stackoverflow.com/questions/38688037/pattern-matching-of-arrays/38688212#38688212", "title": "Pattern matching of Arrays", "body": "<p>First, note that Haskell arrays may be multi-dimensional.</p>\n\n<p>You could write your example function like this:</p>\n\n<pre><code>import Data.Array.IArray\nimport Data.Ix\n\nfoo arr\n  | first == last = print x      -- single element case\n  | otherwise     = print (x,y)  -- more than one element case\n  where (first,last) = bounds arr\n        x = arr ! first\n        y = arr ! last\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1470091624, "creation_date": 1470091624, "answer_id": 38709235, "question_id": 38688037, "link": "https://stackoverflow.com/questions/38688037/pattern-matching-of-arrays/38709235#38709235", "title": "Pattern matching of Arrays", "body": "<p>I'm going to answer this for <code>Data.Vector</code> or <code>Data.Vector.Unboxed</code> because I don't think the question really makes sense in terms of the multidimensional <code>Data.Array.IArray</code>...</p>\n\n<p>You can do something sort of like <code>ViewL</code> and <code>ViewR</code> in <code>Data.Sequence</code>. Adapting that, you could have</p>\n\n<pre><code>data ViewL a\n    = EmptyL        -- ^ empty vector\n    | a :&lt; Vector a -- ^ leftmost element and the rest of the vector\n\ndata ViewR a\n    = EmptyR        -- ^ empty vector\n    | Vector a :&gt; a -- ^ rest of the vector and the rightmost element\n</code></pre>\n\n<p>Then, you could define functions</p>\n\n<pre><code>viewl :: Vector a -&gt; ViewL a\nviewl v | null v = EmptyL\n        | otherwise = head v :&lt; tail v \n\nviewr :: Vector a -&gt; ViewR a\nviewr v | null v = EmptyR\n        | otherwise = init v :&gt; last v \n\nviewlr :: Vector a -&gt; (ViewL a, ViewR a)\nviewlr v = (viewl v, viewr v) -- or `viewl &amp;&amp;&amp; viewr` if you like Control.Arrows\n</code></pre>\n\n<p>And use these with the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#view-patterns\" rel=\"nofollow\">ViewPatterns</a> extension:</p>\n\n<pre><code>function :: Vector a -&gt; ...\nfunction (viewl -&gt; x :&lt; EmptyL)      = ... -- matches if arg has one element\nfunction (viewl -&gt; x :&lt; y:&lt; EmptyL)  = ... -- matches if arg has two elements\nfunction (viewlr -&gt; (x :&lt; _, _ :&gt; y) = ... -- matches `x` and `y` to the first and\n                                           -- last elements\nfunction (viewlr -&gt; (x :&lt; _ :&lt; _ :&lt; _, _ :&gt; y) = ... -- matches if arg has more\n                                                     -- than 3 elements and binds \n                                                     -- the first and last element\n                                                     -- with x and y\n</code></pre>\n\n<p>Since <code>tail</code> and <code>init</code> are O(1) slices for <code>Data.Vector</code>, this lazily looks at only as many elements of the vector as needed.</p>\n"}], "owner": {"reputation": 1479, "user_id": 4673683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/106a6b52825462b10ef0904466351c00?s=128&d=identicon&r=PG", "display_name": "user19018", "link": "https://stackoverflow.com/users/4673683/user19018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1164, "favorite_count": 0, "accepted_answer_id": 38709235, "answer_count": 2, "score": 4, "last_activity_date": 1470091624, "creation_date": 1469996089, "question_id": 38688037, "link": "https://stackoverflow.com/questions/38688037/pattern-matching-of-arrays", "title": "Pattern matching of Arrays", "body": "<p>Haskell provides in <code>Data.Array.IArray</code> a type <code>Array</code> of immutable arrays. This allows to use arrays inside functional code. Is it possible to match <code>Array</code>s with patterns, the same way it is possible for lists?</p>\n\n<p>I would like the following code to work...</p>\n\n<pre><code>function :: Ix a =&gt; Array a b -&gt; ...\n\nfunction [| x |]         = ... -- matches if arg has one element\nfunction [| x, y |]      = ... -- matches if arg has two elements\nfunction [| x, ..., y |] = ... -- matches if arg has more than 3 elements and\n                               -- binds the first and last element with x and y\n</code></pre>\n\n<p>Note : this feature exists in the Rust language, see <a href=\"https://doc.rust-lang.org/book/slice-patterns.html\" rel=\"nofollow\">https://doc.rust-lang.org/book/slice-patterns.html</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 2, "creation_date": 1469986384, "post_id": 38686604, "comment_id": 64752492, "body": "<code>mueval</code> exists as a command line tool when installed, so the docs are referring to that (<code>mueval --help</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 1, "last_activity_date": 1469986517, "creation_date": 1469986517, "answer_id": 38686692, "question_id": 38686604, "link": "https://stackoverflow.com/questions/38686604/what-is-muevals-help-parameter/38686692#38686692", "title": "What is mueval&#39;s --help parameter?", "body": "<p>This is what I get when I run <code>nix-shell -p haskellPackages.mueval --run 'mueval --help'</code> (I'm using <a href=\"https://nixos.org/nix/\" rel=\"nofollow\">nix</a> to run mueval):</p>\n\n<pre><code>Usage: mueval [OPTION...] --expression EXPRESSION...\n  -p PASSWORD    --password=PASSWORD      The password for the mubot account. If this is set, mueval will attempt to setuid to the mubot user. This is optional, as it requires the mubot user to be set up properly. (Currently a null-op.)\n  -t TIME        --time-limit=TIME        Time limit for compilation and evaluation\n  -l FILE        --load-file=FILE         A local file for Mueval to load, providing definitions. Contents are trusted! Do not put anything dubious in it!\n  -m MODULE      --module=MODULE          A module we should import functions from for evaluation. (Can be given multiple times.)\n  -n             --no-imports             Whether to import any default modules, such as Prelude; this is useful if you are loading a file which, say, redefines Prelude operators. This can be subverted by using --load-file.\n  -E             --Extensions             Whether to enable the Glasgow extensions to Haskell '98. Defaults to false, but enabling is useful for QuickCheck.\n  -X EXTENSION   --extension=EXTENSION    Pass additional flags enabling extensions just like you would to ghc. Example: -XViewPatterns\n  -e EXPRESSION  --expression=EXPRESSION  The expression to be evaluated.\n  -i             --inferred-type          Whether to enable printing of inferred type and the expression (as Mueval sees it). Defaults to false.\n  -T             --type-only              Only print the expression and type, don't evaluate the expression. Defaults to false.\n  -r             --resource-limits        Enable resource limits (using POSIX rlimits). Mueval does not by default since rlimits are broken on many systems.\n  -S             --package-trust          Enable Safe-Haskell package trust system\n  -s PACKAGE     --trust=PACKAGE          Specify a package to be trusted by Safe Haskell (ignored unless -S also present)\n  -h             --help                   Prints out usage info.\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 5677970, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b5a841ee9dc5580c22731c5269424a4?s=128&d=identicon&r=PG&f=1", "display_name": "Arne", "link": "https://stackoverflow.com/users/5677970/arne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 38686692, "answer_count": 1, "score": -6, "last_activity_date": 1469986589, "creation_date": 1469985849, "last_edit_date": 1469986589, "question_id": 38686604, "link": "https://stackoverflow.com/questions/38686604/what-is-muevals-help-parameter", "title": "What is mueval&#39;s --help parameter?", "body": "<p>Reading the mueval documentation I encountered the following description:</p>\n\n<p>'See the results of --help for information on what each option means.'</p>\n\n<p>What is --help and how do I use it?</p>\n\n<p>Found it here: \n<a href=\"https://hackage.haskell.org/package/mueval-0.9.1.1.2/docs/Mueval-ArgsParse.html#t:Options\" rel=\"nofollow\">https://hackage.haskell.org/package/mueval-0.9.1.1.2/docs/Mueval-ArgsParse.html#t:Options</a></p>\n"}, {"tags": ["list", "haskell", "integer", "stdin"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469974558, "post_id": 38684460, "comment_id": 64748906, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/20755395/reading-input-from-stdin-in-haskell-and-converting-to-list-of-integers\">Reading input from stdin in haskell and converting to list of integers</a>"}, {"owner": {"reputation": 442, "user_id": 2120194, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/WeTpl.jpg?s=128&g=1", "display_name": "superlinux", "link": "https://stackoverflow.com/users/2120194/superlinux"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1470221443, "post_id": 38684460, "comment_id": 64856793, "body": "This is not a possible duplicate at all, because the essay you are suggesting DOES NOT read the input while communicating with the user who submits the list members. there is a big difference between waiting for input with a printed prompt and reading the data in one push. Both solutions between this essay and yours are different."}], "answers": [{"comments": [{"owner": {"reputation": 442, "user_id": 2120194, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/WeTpl.jpg?s=128&g=1", "display_name": "superlinux", "link": "https://stackoverflow.com/users/2120194/superlinux"}, "edited": false, "score": 0, "creation_date": 1470218388, "post_id": 38685062, "comment_id": 64854832, "body": "Thanks mate for your time. What I think about Haskell is that there should be some lessons about reading input in different ways. I rarely find them online."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 442, "user_id": 2120194, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/WeTpl.jpg?s=128&g=1", "display_name": "superlinux", "link": "https://stackoverflow.com/users/2120194/superlinux"}, "edited": false, "score": 0, "creation_date": 1470249540, "post_id": 38685062, "comment_id": 64876387, "body": "@superlinux Hopefully the Documentation site will help with that."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 13, "last_activity_date": 1506553914, "last_edit_date": 1506553914, "creation_date": 1469975862, "answer_id": 38685062, "question_id": 38684460, "link": "https://stackoverflow.com/questions/38684460/how-to-initialize-a-list-of-integers-from-stdin-reading-each-integer-on-a-separa/38685062#38685062", "title": "How to initialize a list of integers from stdin reading each integer on a separate line in haskell?", "body": "<p>The answers given in the linked question use lazy IO (through <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:getContents\" rel=\"nofollow noreferrer\"><code>getContents</code></a>). </p>\n\n<p>Personally, I don't like lazy IO, and I think trying to understand how it works in combination with do-notation is a recipe for confusion. So here's an answer that doesn't use lazy IO:</p>\n\n<pre><code>import Control.Monad(replicateM)\n\nmain :: IO ()\nmain = do\n    putStrLn \"Please enter the size of your list\"\n    times &lt;- readLn\n    ns &lt;- replicateM times \n                     (do putStrLn \"please enter the next number: \"\n                         readLn :: IO Int) -- type annotation to remove ambiguity\n    print ns\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:replicateM\" rel=\"nofollow noreferrer\"><code>replicateM</code></a> takes a number <em>n</em> and an effectful action, and returns a new action that executes the original <em>n</em> times and returns a list with the results.</p>\n\n<h2>What if I want to display a different prompt message for each number?</h2>\n\n<p>That can be understood as an effectful transformation on the list of prompt messages, one that substitutes each message by the value entered. A kind of \"effectful map\".</p>\n\n<p>The function <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:traverse\" rel=\"nofollow noreferrer\"><code>traverse</code></a> can be used here. Or perhaps <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:for\" rel=\"nofollow noreferrer\"><code>for</code></a>, which is the flipped version of <code>traverse</code>:</p>\n\n<pre><code>{-# language ScopedTypeVariables #-}\n\nimport Data.Traversable (for)\n\nmain :: IO ()\nmain = do\n    putStrLn \"Please enter the size of your list\"\n    times :: Int &lt;- readLn\n    ns &lt;- for [1..times]\n              (\\prompt -&gt; do putStrLn (\"enter \" ++ show prompt)\n                             readLn :: IO Int) -- type annotation to remove ambiguity\n    print ns\n</code></pre>\n\n<p>The <code>:: IO Int</code> annotation is required in the example because <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:readLn\" rel=\"nofollow noreferrer\"><code>readLn</code></a> can read any type that has a <code>Read</code> instance, but we aren't doing anything Int-specific with the results, so we need to inform the compiler about the type somehow.</p>\n"}], "owner": {"reputation": 442, "user_id": 2120194, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/WeTpl.jpg?s=128&g=1", "display_name": "superlinux", "link": "https://stackoverflow.com/users/2120194/superlinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 38685062, "answer_count": 1, "score": 2, "last_activity_date": 1506553914, "creation_date": 1469971769, "question_id": 38684460, "link": "https://stackoverflow.com/questions/38684460/how-to-initialize-a-list-of-integers-from-stdin-reading-each-integer-on-a-separa", "title": "How to initialize a list of integers from stdin reading each integer on a separate line in haskell?", "body": "<p>I am a newbie in Haskell but I know C++ and Java. now I wonder how can I read a list of integers similar to this psuedocode?</p>\n\n<pre><code>   cout &lt;&lt; \"Please enter the size of your list\";\n   cin &gt;&gt; list_size;\n   int mylist[listsize];\n   for (int i = 0 ; i&lt;list_size; i++) {\n      cout&lt;&lt; \"please enter the next number:\";\n      cin&gt;&gt; number;\n     mylist[i]=number;\n    }\n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469975663, "post_id": 38684184, "comment_id": 64749270, "body": "What were <code>T1</code> and T2` by the way?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469979641, "post_id": 38684184, "comment_id": 64750440, "body": "Please add a complete example of what you&#39;re trying to do. This question is not answerable as it stands."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469982998, "post_id": 38684184, "comment_id": 64751402, "body": "&quot;following equality is true&quot; -- how do you know that it is true? Is the question about proving to GHC it is such so that you can omit the type equality constraint in your type signatures?"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1470089918, "creation_date": 1470089918, "answer_id": 38708981, "question_id": 38684184, "link": "https://stackoverflow.com/questions/38684184/asserting-type-family-forall-equalities/38708981#38708981", "title": "Asserting type family forall equalities", "body": "<p>The most likely cause of your difficulty is that your statement</p>\n\n<blockquote>\n  <p>[The] equality is true for all <code>p</code>, <code>a</code>, and <code>b</code>.</p>\n</blockquote>\n\n<p>is not quite true. Your claimed equality is</p>\n\n<pre><code>T1 p (T2 p a b) ~ (a, b)\n</code></pre>\n\n<p>Suppose I give you</p>\n\n<pre><code>type family P :: k\ntype family A :: k\ntype family B :: k\n</code></pre>\n\n<p>where none of the familIes have any instances. Will <code>T1 P (T2 P A B)</code> still reduce to <code>(A, B)</code>? If so, I believe GHC should accept your function with no context. If not, you'll have to pass in some evidence. For example, you could pass evidence that each type is or isn't of a certain form. Under a pattern match, and maybe with some extra help, the family should reduce.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1470090026, "creation_date": 1469969705, "last_edit_date": 1470090026, "question_id": 38684184, "link": "https://stackoverflow.com/questions/38684184/asserting-type-family-forall-equalities", "title": "Asserting type family forall equalities", "body": "<p>I'm getting errors roughly like this:</p>\n\n<pre><code>Could not deduce T1 p (T2 p a b) ~ (a, b)\n</code></pre>\n\n<p>from a function declaration, where <code>T1</code> and <code>T2</code> are type families.</p>\n\n<p>However, the equality is true for all <code>p</code>, <code>a</code> and <code>b</code>.</p>\n\n<p>I can fix it by adding: </p>\n\n<pre><code>T1 p (T2 p a b) ~ (a, b)\n</code></pre>\n\n<p>But then I get something like the following:</p>\n\n<pre><code>Could not deduce T1 p (T2 p a c) ~ (a, c)\n</code></pre>\n\n<p>Eventually I can add enough equality constraints to the function to kill the error.</p>\n\n<p>The alternative is to not define a function signature, the compiler derives something horrific, but it works fine.</p>\n\n<p>But is there a way I can say something like</p>\n\n<pre><code>forall p a b. T1 p (T2 p a b) ~ (a, b)\n</code></pre>\n\n<p>So I can just cover these all in one go?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 10, "creation_date": 1469969160, "post_id": 38684022, "comment_id": 64747284, "body": "What type would you have expected?"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1469968806, "creation_date": 1469968806, "answer_id": 38684052, "question_id": 38684022, "link": "https://stackoverflow.com/questions/38684022/why-is-the-type-of-the-following-function-t-t-t1-t1/38684052#38684052", "title": "Why is the type of the following function t -&gt; (t -&gt; t1) -&gt; t1", "body": "<p>start with the right side: you apply <code>a</code> to <code>b</code> - so <code>b</code> needs to be a function (it <strong>has</strong> to have some type <code>a -&gt; b</code>) type (let's call it <code>b :: t -&gt; t1</code>) and <code>a</code> has to be compatible with this - meaning <code>a :: t</code></p>\n\n<p>no the resulting type if obviously <code>b</code>'s codomain (<code>t1</code> here)</p>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 5, "last_activity_date": 1469968846, "creation_date": 1469968846, "answer_id": 38684058, "question_id": 38684022, "link": "https://stackoverflow.com/questions/38684022/why-is-the-type-of-the-following-function-t-t-t1-t1/38684058#38684058", "title": "Why is the type of the following function t -&gt; (t -&gt; t1) -&gt; t1", "body": "<p><code>b a</code> is the application of the function <code>b</code> to the argument <code>a</code>. That is all the compiler can deduce about what <code>a</code> and <code>b</code> are, so it assigns names <code>t</code> and <code>t1</code> to the type of the argument of that function and to the return type of that function and says that <code>rev</code> takes an argument and a function that takes that argument and returns the result of the application.</p>\n"}], "owner": {"reputation": 63, "user_id": 4331802, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d3e9a35a19596b04d2001ad6537a24bb?s=128&d=identicon&r=PG&f=1", "display_name": "Snappy", "link": "https://stackoverflow.com/users/4331802/snappy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 38684058, "answer_count": 2, "score": -2, "last_activity_date": 1469982508, "creation_date": 1469968515, "last_edit_date": 1469982508, "question_id": 38684022, "link": "https://stackoverflow.com/questions/38684022/why-is-the-type-of-the-following-function-t-t-t1-t1", "title": "Why is the type of the following function t -&gt; (t -&gt; t1) -&gt; t1", "body": "<pre><code>rev a b = b a\n</code></pre>\n\n<p>I just don't get it, why does this function have the <code>t -&gt; (t -&gt; t1) -&gt; t1</code> type?</p>\n"}, {"tags": ["multithreading", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "edited": false, "score": 0, "creation_date": 1469961268, "post_id": 38683067, "comment_id": 64745354, "body": "I mean why the OS structure can&#39;t be reused, and could you elaborate with some extra materials?"}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "reply_to_user": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "edited": false, "score": 1, "creation_date": 1469961371, "post_id": 38683067, "comment_id": 64745384, "body": "what do you mean by &quot;reused&quot;? The Haskell process itself is running on a (low) number of &quot;real&quot; threads. In each of them, the Haskell runtime schedules execution of a (potentially large) number of green threads."}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "reply_to_user": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "edited": false, "score": 0, "creation_date": 1469961487, "post_id": 38683067, "comment_id": 64745409, "body": "A Haskell green thread does not get an OS-managed stack. Instead, the Haskell runtime assigns some memory area for its use (and it can grow and relocate). The OS is not aware of these threads at all (i.e. it does not schedule them)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "reply_to_user": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "edited": false, "score": 1, "creation_date": 1469961509, "post_id": 38683067, "comment_id": 64745417, "body": "@zinking GHC&#39;s runtime implements its own scheduling in user space. That&#39;s what &#39;green threads&#39; implies. Why would it ever need the &quot;OS structure&quot; for that?"}, {"owner": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "edited": false, "score": 0, "creation_date": 1469961761, "post_id": 38683067, "comment_id": 64745481, "body": "I mean like the <code>stack</code> mentioned, probably not OS structure. why GHC need to maintain stack for thread since OS is actually scheduling it. or it doesn&#39;t ?"}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 1, "creation_date": 1469961872, "post_id": 38683067, "comment_id": 64745512, "body": "No. The OS is <i>not</i> scheduling Haskell&#39;s green user-space threads. It does not even know about them. All it does is assign and schedule a low number of threads for the whole Haskell runtime as a unit."}], "tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": true, "score": 7, "last_activity_date": 1469961592, "last_edit_date": 1469961592, "creation_date": 1469961156, "answer_id": 38683067, "question_id": 38683029, "link": "https://stackoverflow.com/questions/38683029/why-is-ghc-thread-extremely-light-weight/38683067#38683067", "title": "why is GHC thread extremely light weight?", "body": "<p>Haskell is using \"green threads\" (managed by the Haskell runtime) in addition / on top of operating system threads (you still need those to make use of multiple CPU cores).</p>\n\n<blockquote>\n  <p>if OS has already maintained stack for thread why would GHC need to do that again?</p>\n</blockquote>\n\n<p>Precisely for the reason you mention: An OS thread is heavy. A green thread can be very lightweight.</p>\n\n<p>If you are familar with Java, this is roughly equivalent to using <code>Thread</code> versus submitting a task to an <code>ExecutorService</code> backed by a threadpool.</p>\n"}], "owner": {"reputation": 4988, "user_id": 161289, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KUaQL.jpg?s=128&g=1", "display_name": "zinking", "link": "https://stackoverflow.com/users/161289/zinking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 38683067, "answer_count": 1, "score": 2, "last_activity_date": 1469961592, "creation_date": 1469960960, "question_id": 38683029, "link": "https://stackoverflow.com/questions/38683029/why-is-ghc-thread-extremely-light-weight", "title": "why is GHC thread extremely light weight?", "body": "<p>reading Simon Marlow's tutorial on <code>parallel programming in haskell</code>. </p>\n\n<blockquote>\n  <p>a thread typically costs less than a hundred bytes plus the space for the stack, so the runtime supports literally millions of them, limited only by the available memory, unlike OS threads ....</p>\n</blockquote>\n\n<p>I had different impression on thread costs. kernel structure used for a single thread exceeds 4MB (thread stack). 32bit process space can spawn no more than 1000 threads, not <code>literally millions</code></p>\n\n<p>I think he is referring to the part that GHC controlled, but if OS has already maintained stack for thread why would GHC need to do that again?</p>\n"}, {"tags": ["haskell", "arguments", "currying", "lambda-calculus"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1469923615, "post_id": 38679589, "comment_id": 64738805, "body": "I think it&#39;s more historical influence. All(?) the other lazy functional languages at the time had single argument functions."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1469924872, "post_id": 38679589, "comment_id": 64739002, "body": "One interesting effect of this choice is how it makes it very easy to define typeclasses on function types, and it also makes the Applicative pattern quite a bit more elegant."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1469926189, "creation_date": 1469926189, "answer_id": 38679816, "question_id": 38679589, "link": "https://stackoverflow.com/questions/38679589/was-the-reason-that-haskell-had-single-argument-functions-to-be-like-lambda-calc/38679816#38679816", "title": "Was the reason that Haskell had single-argument functions to be like lambda calculus?", "body": "<p>Haskell was indeed strongly intended to be like and even based on lambda calculus. A choice quote from <a href=\"http://research.microsoft.com/~simonpj/papers/history-of-haskell/index.htm\" rel=\"nofollow\">A History of Haskell: Being Lazy with Class</a>:</p>\n\n<blockquote>\n  <p>The simplicity\n  and elegance of functional programming captivated the present\n  authors, and many other researchers with them. Lazy evaluation\u2014\n  with its direct connection to the pure, call-by-name lambda calculus,\n  the remarkable possibility of representing and manipulating\n  infinite data structures, and addictively simple and beautiful implementation\n  techniques\u2014was like a drug.</p>\n</blockquote>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 1, "accepted_answer_id": 38679816, "answer_count": 1, "score": 2, "last_activity_date": 1469926189, "creation_date": 1469923144, "question_id": 38679589, "link": "https://stackoverflow.com/questions/38679589/was-the-reason-that-haskell-had-single-argument-functions-to-be-like-lambda-calc", "title": "Was the reason that Haskell had single-argument functions to be like lambda calculus?", "body": "<p>In <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow\">LYAHFGG we read</a>:</p>\n\n<blockquote>\n  <p>Every function in Haskell officially only takes one parameter. </p>\n</blockquote>\n\n<p>In this description of <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#Motivation\" rel=\"nofollow\">Lambda Calculus we read</a>:</p>\n\n<blockquote>\n  <p>The second simplification is that the \u03bb-calculus only uses functions of a single input. </p>\n</blockquote>\n\n<p>My question is: <strong>Was the reason that Haskell had single-argument functions to be like lambda calculus?</strong></p>\n\n<p>(Or is it just a combined focus on simplicity with currying?)</p>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1469903208, "post_id": 38676767, "comment_id": 64733940, "body": "Are you using <code>heist-0.14.*</code>? Some stuff moved around, cf. <a href=\"https://github.com/snapframework/heist/blob/master/CHANGELOG.md#0140\" rel=\"nofollow noreferrer\">CHANGELOG.md</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1469903815, "post_id": 38677264, "comment_id": 64734099, "body": "Thanks!! Can you explain the <code>h:</code> part though? Why did you have to do that? Do I always have to do that now?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1469904425, "post_id": 38677264, "comment_id": 64734309, "body": "I did it because that&#39;s what the error message said. Try running with just the <code>&lt;foo&gt;</code> tag, and you&#39;ll see the full error message. Undoubtably the prefix is configurable."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1469905603, "post_id": 38677264, "comment_id": 64734684, "body": "Really? Because I just see <code>oops</code>."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1469907239, "post_id": 38677264, "comment_id": 64735161, "body": "Oh, additionally, namespaces are a new feature in 0.14 and can be disabled by setting <code>hcNamespace .~ &quot;&quot;</code>  <a href=\"http://snapframework.com/blog/2014/09/24/heist-0.14-released\" rel=\"nofollow noreferrer\">snapframework.com/blog/2014/09/24/heist-0.14-released</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1469903610, "creation_date": 1469903610, "answer_id": 38677264, "question_id": 38676767, "link": "https://stackoverflow.com/questions/38676767/heist-example-not-working-hccompiledsplices-is-not-a-record-selector/38677264#38677264", "title": "Heist example not working: \u2018hcCompiledSplices\u2019 is not a record selector", "body": "<p>Using lenses seems to be the way to do things now.</p>\n\n<p>Also, I change the template <code>simple.tpl</code> to use the tag <code>&lt;h:foo&gt;...&lt;/h:foo&gt;</code> instead of just <code>&lt;foo&gt;...&lt;/foo&gt;</code>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings  #-}\n\nmodule Lib2 where\n\n-- import Data.Monoid\nimport qualified Data.Text as T\nimport qualified Data.ByteString as B\nimport Blaze.ByteString.Builder\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Control.Applicative\nimport Control.Monad.Trans.Either\nimport Heist\nimport Heist.Compiled as C\nimport Control.Lens\n\nruntime :: RuntimeSplice IO T.Text\nruntime = liftIO $ do\n    putStrLn \"Write something:\"\n    T.pack &lt;$&gt; getLine\n\nsplice :: Splice IO\nsplice = return $ C.yieldRuntimeText $ runtime\n\nmain = do\n    let heistConfig = emptyHeistConfig\n          &amp; hcTemplateLocations .~ [ loadTemplates \".\" ]\n          &amp; hcCompiledSplices .~  ( \"foo\" ## splice )\n        reportErrors errs = error (\"errors: \" ++ unlines errs)\n    heistState &lt;- either reportErrors id &lt;$&gt; \n         (runEitherT $ initHeist heistConfig)\n    builder &lt;- maybe (error \"oops\") fst $\n         renderTemplate heistState \"simple\"\n    toByteStringIO B.putStr builder\n</code></pre>\n"}], "owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 38677264, "answer_count": 1, "score": 1, "last_activity_date": 1469904254, "creation_date": 1469900567, "last_edit_date": 1469904254, "question_id": 38676767, "link": "https://stackoverflow.com/questions/38676767/heist-example-not-working-hccompiledsplices-is-not-a-record-selector", "title": "Heist example not working: \u2018hcCompiledSplices\u2019 is not a record selector", "body": "<p>I'm trying to understand how to use Heist, but none of the examples I find seem to be working and I can't seem to find anyone else that's having the same issue that I am. I found some example code here: </p>\n\n<p><a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/older-but-still-interesting/compiled-heist-insight-with-no-snap-in-sight\" rel=\"nofollow\">https://www.schoolofhaskell.com/school/to-infinity-and-beyond/older-but-still-interesting/compiled-heist-insight-with-no-snap-in-sight</a></p>\n\n<p>However, when I try to run the first example, I get the following error:</p>\n\n<pre><code>Main.hs:20:15:\n    \u2018hcCompiledSplices\u2019 is not a record selector\n    In the expression:\n    mempty\n        {hcCompiledSplices = \"foo\" ## splice,\n        hcTemplateLocations = [loadTemplates \".\"]}\n    In an equation for \u2018heistConfig\u2019:\n        heistConfig\n        = mempty\n            {hcCompiledSplices = \"foo\" ## splice,\n            hcTemplateLocations = [loadTemplates \".\"]}\n    In the expression:\n    do { let heistConfig = ...;\n        heistState &lt;- either (error \"oops\") id\n                        &lt;$&gt; (runEitherT $ initHeist heistConfig);\n        builder &lt;- maybe (error \"oops\") fst\n                    $ renderTemplate heistState \"simple\";\n        toByteStringIO B.putStr builder }\n\nMain.hs:22:15:\n    \u2018hcTemplateLocations\u2019 is not a record selector\n    In the expression:\n    mempty\n        {hcCompiledSplices = \"foo\" ## splice,\n        hcTemplateLocations = [loadTemplates \".\"]}\n    In an equation for \u2018heistConfig\u2019:\n        heistConfig\n        = mempty\n            {hcCompiledSplices = \"foo\" ## splice,\n            hcTemplateLocations = [loadTemplates \".\"]}\n    In the expression:\n    do { let heistConfig = ...;\n        heistState &lt;- either (error \"oops\") id\n                        &lt;$&gt; (runEitherT $ initHeist heistConfig);\n        builder &lt;- maybe (error \"oops\") fst\n                    $ renderTemplate heistState \"simple\";\n        toByteStringIO B.putStr builder }\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "types", "church-encoding"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 4, "creation_date": 1469895688, "post_id": 38675945, "comment_id": 64731814, "body": "Why don&#39;t you want to use <code>newtype</code> ?"}, {"owner": {"reputation": 43, "user_id": 6658012, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dPpJCghG2xY/AAAAAAAAAAI/AAAAAAAAABA/El7GqPd_vnQ/photo.jpg?sz=128", "display_name": "CheeseLollipop", "link": "https://stackoverflow.com/users/6658012/cheeselollipop"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469896117, "post_id": 38675945, "comment_id": 64731918, "body": "if I use newtype or data I need to write something like: <code>newtype N = N (n -&gt; n) -&gt; n -&gt; n)</code> and then rewrite functions like <code>(+) (N a) (N b) = stuff</code> instead of <code>(+) = \\a b -&gt; stuff</code> without unboxing a or b."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469896123, "post_id": 38675945, "comment_id": 64731921, "body": "Impredicativity is best to be avoided in current GHC. No way around that but to use <code>newtype</code> or <code>data</code>. (Also look up safe coercions, which make <code>newtype</code>s much simpler to handle in some cases)."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6658012, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dPpJCghG2xY/AAAAAAAAAAI/AAAAAAAAABA/El7GqPd_vnQ/photo.jpg?sz=128", "display_name": "CheeseLollipop", "link": "https://stackoverflow.com/users/6658012/cheeselollipop"}, "edited": false, "score": 1, "creation_date": 1469902755, "post_id": 38676084, "comment_id": 64733784, "body": "Sorry I explained badly my question but you still answered it correctly, thanks a lot!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1469896526, "last_edit_date": 1469896526, "creation_date": 1469896075, "answer_id": 38676084, "question_id": 38675945, "link": "https://stackoverflow.com/questions/38675945/how-to-create-a-type-instance-of-class-in-haskell/38676084#38676084", "title": "How to create a type instance of class in haskell?", "body": "<p>What you've written there looks a lot like a <em>class declaration</em>, not an instance. Perhaps you meant this?</p>\n\n<pre><code>class Printable n where\n  print :: n -&gt; IO ()\n  read  :: String -&gt; n\n</code></pre>\n\n<p>Note that the <code>n</code> has to be lowercase, because that's the <em>type variable</em> you're quantising the class over. If you actually want to define an instance, then you, well, <em>instantiate</em> <code>n</code> with <code>N</code>:</p>\n\n<pre><code>instance Printable N where\n  print n = ...\n  read str = ...\n</code></pre>\n\n<p>At this point the <em>type signatures</em> are all fixed (from the class definition) and what you need to write are the actual bindings of these functions, hence it must be <code>=</code>, not <code>::</code>.</p>\n\n<p>Question is: why do you need your own class anyway? It's only going to cause name clashes with the standard functions <code>print</code> and <code>read</code> that are already in the prelude. What you actually should be doing is instantiate <em>those standard classes</em> with your <code>N</code> type, i.e.</p>\n\n<pre><code>instance Show N where\n  show n = ...\ninstance Read N where\n  readsPrec _ str = ...\n</code></pre>\n\n<p>That said, to get to the actual question you've asked: <em>no</em>, it is not possible to define <em>any</em> instances sensibly for a polymorphic type like <code>\u2200 n . (n-&gt;n) -&gt; n-&gt;n</code>. How is the compiler supposed to distinguish this from more specific types like <code>(Int-&gt;Int) -&gt; Int-&gt;Int</code>, or more general ones like <code>\u2200 n m . (n-&gt;m) -&gt; n-&gt;m</code>? It's pretty hopeless. The <em>correct</em> thing to do is to just wrap it in a newtype; that hides the universal quantification and allows the compiler to properly distinguish <code>N</code> from other types.</p>\n\n<p>Alternatively, you can just write <em>monomorphic functions</em> that accept/yield <code>N</code> directly:</p>\n\n<pre><code>showChurch :: N -&gt; String\nshowChurch n = ...\nreadsPrecChurch :: Int -&gt; ReadS N\nreadsPrecChurch _ str = ...\n</code></pre>\n\n<p>Actually the latter one is already too much for the type system: the <code>ReadS N</code> is short for</p>\n\n<pre><code>readsPrecChurch :: Int -&gt; String -&gt; [(\u2200 n . (n-&gt;n) -&gt; n-&gt;n, String)]\n</code></pre>\n\n<p>universal quantification within a list? Uh oh. That's an impredicative type. GHC does have an <code>-XImpredicativeTypes</code> extension, but it doesn't really work.</p>\n\n<p>Again, just avoid these problems by not openly using polymorphic types. There are a few great uses for Rank-N types (notably lenses), but most of the time they're completely overkill and unnecessary. There's certainly never a good reason to actually use church numerals like that.</p>\n\n<pre><code>newtype N = Church { getChurch :: \u2200 n . (n-&gt;n) -&gt; n-&gt;n }\n</code></pre>\n\n<p>will allow you to define arbitrary instances or functions without problem. And, practically speaking, simply doing</p>\n\n<pre><code>type N = Int\n</code></pre>\n\n<p>with all the standard instances that come for integers is of course just as good...</p>\n"}], "owner": {"reputation": 43, "user_id": 6658012, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dPpJCghG2xY/AAAAAAAAAAI/AAAAAAAAABA/El7GqPd_vnQ/photo.jpg?sz=128", "display_name": "CheeseLollipop", "link": "https://stackoverflow.com/users/6658012/cheeselollipop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2843, "favorite_count": 1, "accepted_answer_id": 38676084, "answer_count": 1, "score": 4, "last_activity_date": 1469896526, "creation_date": 1469895069, "question_id": 38675945, "link": "https://stackoverflow.com/questions/38675945/how-to-create-a-type-instance-of-class-in-haskell", "title": "How to create a type instance of class in haskell?", "body": "<p>I'm a newbie in Haskell. </p>\n\n<p>I'm looking if there's any way to create an instance of type of a class.</p>\n\n<p>Is there any way to get this code working without using data or newtype?</p>\n\n<pre><code>type N = \u2200n. (n -&gt; n) -&gt; n -&gt; n\n\ninstance Printable N where\n        print :: N -&gt; IO ()\n        read  :: String -&gt; N \n</code></pre>\n\n<p>When I try to load the module in GHCi it tells me:</p>\n\n<pre><code>Illegal polymorphic or qualified type: N\nIn the instance declaration for \u2018Printable N\u2019\n</code></pre>\n"}, {"tags": ["regex", "haskell", "grep"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 7, "creation_date": 1469894164, "post_id": 38675732, "comment_id": 64731336, "body": "Use <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html\" rel=\"nofollow noreferrer\">Text</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1469896021, "post_id": 38675732, "comment_id": 64731902, "body": "Just wanted to point out that getting C-like speeds is possible, but it might take some effort. Have a look at  <b>cgrep</b> - <a href=\"http://awgn.github.io/cgrep/\" rel=\"nofollow noreferrer\">awgn.github.io/cgrep</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1469896022, "post_id": 38675732, "comment_id": 64731903, "body": "<code>String</code> is a low-performance, lazy string, which is &quot;fine&quot; for basic short strings but unsuitable for serious text manipulation. <code>Text</code> is the high-performance type for Unicode text manipulation. (There&#39;s also <code>ByteString</code> which is <i>not</i> for text but for byte sequences.)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1469896344, "post_id": 38675732, "comment_id": 64731973, "body": "Are you compiling with optimizations?"}, {"owner": {"reputation": 598, "user_id": 1826241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2aaac949383a1f98d77696b8e80b9fe4?s=128&d=identicon&r=PG", "display_name": "dlukes", "link": "https://stackoverflow.com/users/1826241/dlukes"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1469909467, "post_id": 38675732, "comment_id": 64735734, "body": "@amalloy: I wasn&#39;t aware of optimizations, thanks for pointing them out to me! Unfortunately, in this particular case, the difference seems to be negligible..."}, {"owner": {"reputation": 598, "user_id": 1826241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2aaac949383a1f98d77696b8e80b9fe4?s=128&d=identicon&r=PG", "display_name": "dlukes", "link": "https://stackoverflow.com/users/1826241/dlukes"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469909769, "post_id": 38675732, "comment_id": 64735800, "body": "@ErikR, @chi: Thanks for the breakdown and the pointers, cgrep looks well worth investigating! Would either of you perhaps take a shot at modifying my example code to work with <code>Text</code>? I&#39;d be happy to accept that as an answer. I&#39;m trying to do so myself but I can&#39;t get my program to typecheck, so I must be missing something :("}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469967868, "post_id": 38675732, "comment_id": 64746965, "body": "i think you should try this at <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a>"}], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 1826241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2aaac949383a1f98d77696b8e80b9fe4?s=128&d=identicon&r=PG", "display_name": "dlukes", "link": "https://stackoverflow.com/users/1826241/dlukes"}, "edited": false, "score": 0, "creation_date": 1469970514, "post_id": 38683334, "comment_id": 64747675, "body": "Thanks for the tip, I didn&#39;t know haskell had such nice profiling support out of the box! Looks like I&#39;m spending about two thirds of the time in <code>io</code> and one third in <code>regexBool</code> (see above), so no real surprises here -- I just need to make those calls faster... Which should by doable by using <code>Text</code> instead of <code>String</code> as pointed out by other commenters above; only trouble is, I haven&#39;t been able to get my program to typecheck with this modification so far."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 598, "user_id": 1826241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2aaac949383a1f98d77696b8e80b9fe4?s=128&d=identicon&r=PG", "display_name": "dlukes", "link": "https://stackoverflow.com/users/1826241/dlukes"}, "edited": false, "score": 0, "creation_date": 1469971284, "post_id": 38683334, "comment_id": 64747934, "body": "@dlukes - depends on which regex-library you are using - I think regex-heavy has <code>Text</code> support the others seem to be <code>String</code>/<code>ByteString</code> only but maybe with inlining this is good enough for your needs."}], "tags": [], "owner": {"reputation": 1476, "user_id": 700597, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/rWtor.jpg?s=128&g=1", "display_name": "runeks", "link": "https://stackoverflow.com/users/700597/runeks"}, "is_accepted": false, "score": 1, "last_activity_date": 1469963366, "last_edit_date": 1495541692, "creation_date": 1469963366, "answer_id": 38683334, "question_id": 38675732, "link": "https://stackoverflow.com/questions/38675732/primitive-but-efficient-grep-clone-in-haskell/38683334#38683334", "title": "Primitive but efficient grep clone in haskell?", "body": "<p>It's possible that the slow speed is caused by using the standard library's list type. I've often run into performance problems with it in the past.</p>\n\n<p>It would be a good idea to profile your executable, to see where it spends its time: <a href=\"https://stackoverflow.com/questions/3276240/tools-for-analyzing-performance-of-a-haskell-program\">Tools for analyzing performance of a Haskell program</a>. Profiling Haskell programs is really easy (compile with a switch and execute your program with an added argument, and the report is written to a text file in the current working directory).</p>\n\n<p>As a side note, I use exactly the same approach as you when learning a new language: create something that works. My experience doing this with Haskell is that I can easily gain an order of magnitude or two in performance by profiling and making relatively simple changes (usually a couple of lines). </p>\n"}], "owner": {"reputation": 598, "user_id": 1826241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2aaac949383a1f98d77696b8e80b9fe4?s=128&d=identicon&r=PG", "display_name": "dlukes", "link": "https://stackoverflow.com/users/1826241/dlukes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1469963366, "creation_date": 1469893707, "question_id": 38675732, "link": "https://stackoverflow.com/questions/38675732/primitive-but-efficient-grep-clone-in-haskell", "title": "Primitive but efficient grep clone in haskell?", "body": "<p>Whenever I consider learning a new language -- haskell in this case -- I try to hack together a primitive grep clone to see how good the language implementation and/or its libraries are at text processing, because that's a major use case for me.</p>\n\n<p>Inspired by <a href=\"https://wiki.haskell.org/Simple_Unix_tools\">code on the haskell wiki</a>, I came up with the following naive attempt:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, ExistentialQuantification #-}\n\nimport Text.Regex.PCRE\nimport System.Environment\n\nio :: ([String] -&gt; [String]) -&gt; IO ()\nio f = interact (unlines . f . lines)\n\nregexBool :: forall r l .\n  (RegexMaker Regex CompOption ExecOption r,\n   RegexLike Regex l) =&gt;\n  r -&gt; l -&gt; Bool\nregexBool r l = l =~ r :: Bool\n\ngrep :: forall r l .\n  (RegexMaker Regex CompOption ExecOption r, RegexLike Regex l) =&gt;\n  r -&gt; [l] -&gt; [l]\ngrep r = filter (regexBool r)\n\nmain :: IO ()\nmain = do\n  argv &lt;- getArgs\n  io $ grep $ argv !! 0\n</code></pre>\n\n<p>This appears to be doing what I want it to, but unfortunately, it's <em>really</em> slow -- about 10 times slower than a python script doing the same thing. I assume it's not the regex library that's at fault here, because it's calling into PCRE which should be plenty fast (switching to <code>Text.Regex.Posix</code> slows things down quite a bit further). So it must be the <code>String</code> implementation, which is instructive from a theoretical point of view but inefficient according to what I've read.</p>\n\n<p>Is there an alternative to <code>String</code>s in haskell that's both efficient and convenient (i.e. there's little or no friction when switching to using that instead of <code>String</code>s) and that fully and correctly handles UTF-8-encoded Unicode, as well as other encodings without too much hassle if possible? Something that everybody uses when doing text processing in haskell but that I just don't know about because I'm a complete beginner?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1469895626, "post_id": 38675727, "comment_id": 64731791, "body": "I can&#39;t think of anything off the top of my head, and this is definitely not a &#39;normal&#39; thing to want to do in Haskell. There might be a solution but it would definitely require tricks. Why not just add the <code>Show</code> constraint?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469895781, "post_id": 38675727, "comment_id": 64731844, "body": "This will need to rely on overlapping instances. It also somewhat copes with conditional compilation, which makes it tricky. What would happen if I <code>show&#39;</code> a non-Show type and yet in another module I do add a <code>Show</code> instance for it? Also <code>show&#39;</code> will need a type constraint in its type (which will be always satisfied by a default instance, at worst), since otherwise parametricity is broken."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1469895880, "post_id": 38675727, "comment_id": 64731870, "body": "Because I can&#39;t add a show constraint when instanciating a typeclass if the type to constrain doesn&#39;t appears in type class definition. Try to add a show constraint to a Monad <code>Show a =&gt; Monad m</code>. There is no <code>a</code> in <code>Monad m</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1469895960, "post_id": 38675727, "comment_id": 64731889, "body": "It is impossible to test if an arbitrary type has an instance of some class, which is what this essentially boils down to."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1469896629, "post_id": 38675727, "comment_id": 64732049, "body": "see <a href=\"http://stackoverflow.com/a/35790024/625914\">stackoverflow.com/a/35790024/625914</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1469898238, "post_id": 38675727, "comment_id": 64732523, "body": "<a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">This HaskellWiki page is exactly about this</a>"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1469899960, "post_id": 38675727, "comment_id": 64732975, "body": "@alex it&#39;s interesting however my problem is slightly different. I dont want to instanciate every class to show because I don&#39;t want any typeclass at all. A typeclass which works for everything is still seen as a constraint and can&#39;t be added on a monad definition for example."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469934066, "post_id": 38675727, "comment_id": 64740412, "body": "@mb14 What you are asking for would violate parametricity completely - it&#39;s  really not possible. Given your comment about a monad definition: on the off-chance you are trying to force a monad/arrow definition just to afterwards use the syntactic sugar, <a href=\"http://stackoverflow.com/questions/38572799/using-a-monad-to-implicitly-check-refinement-type-well-formedness/38574157#38574157\">check this out</a>."}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "closed_date": 1470017244, "answer_count": 0, "score": 0, "last_activity_date": 1469893592, "creation_date": 1469893592, "question_id": 38675727, "link": "https://stackoverflow.com/questions/38675727/is-there-a-way-to-show-showable-stuff", "closed_reason": "Duplicate", "title": "Is there a way to show &quot;showable&quot; stuff", "body": "<p>I was playing with arrows and for that, I tried to write a function which traces its input and output. It didn't work because I ended up needing a Show constraint on the parameter of my type when instanciating the Arrow class. Anyway, my question is the following, is there a way to create a <code>showlike</code> function, which uses <code>show</code> if possible and a default string if not.</p>\n\n<p>I tried the following (using type families) but it doesn't work</p>\n\n<pre><code>{-# TypeFamilies #-}\ntype family ToShow where\n    Show a =&gt; ToShow a = a -- doesn't compile\n    ToShow a = () \n\ntoShow :: a -&gt; ToShow a\ntoShow x = ???\n\nshow' :: a -&gt; String\nshow' = show . toShow\n</code></pre>\n\n<p>Any idea if this is possible ?</p>\n"}, {"tags": ["haskell", "lambda", "multiline", "parse-error"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 8, "creation_date": 1469878784, "post_id": 38673518, "comment_id": 64727086, "body": "You are allowed multi line lambdas. However you&#39;re splitting the line at the worst possible place. The <code>-&gt;</code> is important! keep that and it should work."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1469878789, "post_id": 38673518, "comment_id": 64727089, "body": "just don&#39;t break your arrow - keep it together <code>\\acc x -&gt;</code> and indent the next line"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1469878913, "post_id": 38673518, "comment_id": 64727117, "body": "You can&#39;t insert a linebreak in the middle of words or operators."}, {"owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "edited": false, "score": 1, "creation_date": 1469879345, "post_id": 38673518, "comment_id": 64727243, "body": "Keeping together the <code>-&gt;</code> operator and indenting the next line solved the problem. Thanks for help!"}, {"owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "edited": false, "score": 0, "creation_date": 1469880410, "post_id": 38673518, "comment_id": 64727500, "body": "Could someone post an answer so I mark it as answered, please?"}], "answers": [{"tags": [], "owner": {"reputation": 427, "user_id": 3014979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5cbd2de10afc1281c76c9f24d6bb906?s=128&d=identicon&r=PG", "display_name": "Cir0X", "link": "https://stackoverflow.com/users/3014979/cir0x"}, "is_accepted": true, "score": 4, "last_activity_date": 1469882250, "creation_date": 1469882250, "answer_id": 38674052, "question_id": 38673518, "link": "https://stackoverflow.com/questions/38673518/haskell-multi-line-lambdas/38674052#38674052", "title": "Haskell Multi-line Lambdas", "body": "<p>Don't break the <code>-&gt;</code></p>\n\n<p>Just do:</p>\n\n<pre><code>search :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool  \nsearch needle haystack =   \n   let nlen = length needle  \n   in  foldl (\\acc x -&gt;\nif take nlen x == needle then True else acc) False (tails haystack) \n</code></pre>\n\n<p>or</p>\n\n<pre><code>search :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool  \nsearch needle haystack =   \n   let nlen = length needle  \n   in  foldl (\\acc x \n-&gt; if take nlen x == needle then True else acc) False (tails haystack) \n</code></pre>\n"}], "owner": {"reputation": 394, "user_id": 5555395, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f3e26c9d237262a91576f3bfbfd194?s=128&d=identicon&r=PG&f=1", "display_name": "D. Jones", "link": "https://stackoverflow.com/users/5555395/d-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 0, "accepted_answer_id": 38674052, "answer_count": 1, "score": 2, "last_activity_date": 1469882250, "creation_date": 1469878688, "question_id": 38673518, "link": "https://stackoverflow.com/questions/38673518/haskell-multi-line-lambdas", "title": "Haskell Multi-line Lambdas", "body": "<p>I am learning Haskell from learnyouahaskell.com and there is an example such that:</p>\n\n<pre><code>search :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool  \nsearch needle haystack =   \n    let nlen = length needle  \n    in  foldl (\\acc x -\n&gt; if take nlen x == needle then True else acc) False (tails haystack) \n</code></pre>\n\n<p>But when tried this code with GHC, it gives me </p>\n\n<pre><code>error: parse error on input \u2018-\u2019\n</code></pre>\n\n<p>But it works when it is like this:</p>\n\n<pre><code>search :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool  \nsearch needle haystack =   \n    let nlen = length needle  \n    in  foldl (\\acc x -&gt; if take nlen x == needle then True else acc) False (tails haystack) \n</code></pre>\n\n<p>Is there a feature of Haskell that allows multi-line lambdas or is that something I am missing?</p>\n"}, {"tags": ["haskell", "ghc", "criterion"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469900108, "post_id": 38671397, "comment_id": 64733008, "body": "You&#39;re using <code>criterion</code> pretty much correctly, but you should ideally use <code>env</code> to create the randomized list and pass it to the benchmarks, or at least be sure to force that list fully before benchmarking."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469900170, "post_id": 38671397, "comment_id": 64733025, "body": "Also, since this is a question about performance, you should tell us what version of GHC you&#39;re using."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469901869, "post_id": 38671397, "comment_id": 64733510, "body": "Thanks. I edited my question. I am using <code>ghc-7.10.3</code>.  Do you know if there&#39;s any reason why the two traversals are faster in this case? I tested this also using a local implementation of lists since I thought it might something to do with ghc&#39;s implementation, but the results don&#39;t change!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1469911064, "post_id": 38671397, "comment_id": 64736134, "body": "In the stdlib <code>partition</code>, the computation of the first element causes the entire list to be retained in memory (and likewise for 2nd elem.) - in <code>mypartition</code>, the two can be computed independently, at the cost of computing the predicate at most twice as often. If you profile the memory usage of the two, <code>mypartition</code> allocates more memory than <code>partition</code>, but has a much lower maximum residency. In the case of one <code>Integer</code> comparison, the overhead of duplicated work in <code>mypartition</code> is <i>much</i> less than the overhead of retaining the list (and a 10m length list is not insignificant!)"}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "edited": false, "score": 0, "creation_date": 1469911670, "post_id": 38671397, "comment_id": 64736276, "body": "Thanks! This makes a lot of sense. I had already seen the difference in memory usage but hadn&#39;t notice the maximum residency part. Indeed, I ran a few more benchmarks using more complex predicates and I start seeing now the expected behaviour of one traversal being better than two."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1469921255, "post_id": 38671397, "comment_id": 64738358, "body": "why not use <code>-O2</code>, which is what any performance critical code should be compiled with."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1469927520, "post_id": 38671397, "comment_id": 64739429, "body": "Yes, this is what I expect, and what I&#39;ve observed in the past.  Writing a good partition in Haskell is not possible, as far as I know.  I could write one in assembly. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1469931406, "post_id": 38671397, "comment_id": 64740063, "body": "@augustss, that&#39;s quite a teaser. Can you explain why? Does Wadler&#39;s GC trick fail to collect the pairs, or is something else going wrong? Is it something that can be fixed?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1469932354, "post_id": 38671397, "comment_id": 64740202, "body": "By Wadler&#39;s GC trick you mean my GC trick.  I&#39;m the one who described it to Phil, but he&#39;s the one who thought it was worth a paper.  I also think David A Turner invented it before me.  But anyway, there should only ever be one pair allocated (the result) and one traversal.  As either of the results are forced it will walk down the list and tack the unwanted elements to the end of the other result list. This can&#39;t be expressed in Haskell."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1469932485, "post_id": 38671397, "comment_id": 64740217, "body": "The hbc/lml version of accumArray used the same trick to get good complexity.  The trick was invented by Thomas Johnsson ca 1983.  The partition function can be easily expressed in terms of accumArray."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1469933401, "post_id": 38671397, "comment_id": 64740337, "body": "@augustss, yes, that one. I had no idea of the history there. Good to know. Do you have any thoughts about what would need to be added to the language (or even what absurdly dangerous primop could be added) to make these kinds of things work well? I envision some thread safety complications, as well as general &quot;what do we really want?&quot; issues."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1469934870, "post_id": 38671397, "comment_id": 64740500, "body": "You need a thunk update primitive and some updatable references in closures. It could probably be done in some suitable monad.  But it requires care, since you want to avoid write barriers where possible.  I&#39;ve not even thought of how to do it multi-threaded, but it might be possible with just a spin-lock in the main closure that does all the work.  Maybe I should write a blog post.  It&#39;s sad when old tricks like this one are forgotten."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1469936761, "post_id": 38671397, "comment_id": 64740725, "body": "@augustss, if you could magic up something like that for GHC (and get it fast), we&#39;ll all be grateful. The next release of <code>Data.Sequence</code> will have a rather horribly complicated <code>fromList</code> by Lennart Spitzner designed to work around similar lazy pair inefficiency (although that one hurts even more because the GC trick doesn&#39;t even work for whatever reason)."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "edited": false, "score": 0, "creation_date": 1469956098, "post_id": 38671397, "comment_id": 64744206, "body": "Thanks for the explanations! Wouldn&#39;t using a strict pair help?  I ran the same experiments but with a map from <code>Data.Map</code> instead of lists and I always see the single traversal over the map being better than the two traversals, unlike what we see in the lists case."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1469960949, "post_id": 38671397, "comment_id": 64745282, "body": "A strict pair has the wrong semantics for lists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1469981231, "post_id": 38671397, "comment_id": 64750894, "body": "@aesadde, aside from the semantic issue, a strict pair will lead to poor performance when the lists are sufficiently long. <code>Data.Map</code> is entirely strict in its structure, so it can&#39;t take advantage of laziness even for operations like <code>fmap</code> which would be happier with a lazy structure."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470076411, "post_id": 38671397, "comment_id": 64789133, "body": "@dfeuer thanks for the explanation!  There&#39;s one thing that puzzles me still though. I&#39;ve implemented a partition function using CPS but I don&#39;t see any improvements, it actually ends up being very inefficient but I thought that by avoiding tupling I&#39;d get better results. Is this something expected as well? Also is there a paper or somewhere I can find more about the &quot;GC Trick&quot; ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470080857, "post_id": 38671397, "comment_id": 64791423, "body": "aesadde, <a href=\"http://homepages.inf.ed.ac.uk/wadler/topics/garbage-collection.html\" rel=\"nofollow noreferrer\">here&#39;s the paper</a> about the GC trick. CPS isn&#39;t particularly efficient in general; there are cases where it&#39;s great (or necessary), but other times you just end up allocating closures instead of data."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470081922, "post_id": 38671397, "comment_id": 64791987, "body": "@dfeuer Many thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 6678581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uMmf9.jpg?s=128&g=1", "display_name": "Toni Dietze", "link": "https://stackoverflow.com/users/6678581/toni-dietze"}, "is_accepted": true, "score": 5, "last_activity_date": 1470330544, "creation_date": 1470330544, "answer_id": 38773519, "question_id": 38671397, "link": "https://stackoverflow.com/questions/38671397/benchmarking-filter-and-partition/38773519#38773519", "title": "Benchmarking Filter and Partition", "body": "<p>There is no black or white answer to the question. To dissect the problem consider the following code:</p>\n\n<pre><code>import Control.DeepSeq\nimport Data.List (partition)\nimport System.Environment (getArgs)\n\n\nmypartition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a])\nmypartition p l = (filter p l, filter (not . p) l)\n\n\nmain :: IO ()\nmain = do\n  let cnt = 10000000\n      xs = take cnt $ concat $ repeat [1 .. 100 :: Int]\n  args &lt;- getArgs\n  putStrLn $ unwords $ \"Args:\" : args\n  case args of\n    [percent, fun]\n      -&gt; let p = (read percent &gt;=)\n         in case fun of\n           \"partition\"      -&gt;              print $ rnf $ partition   p xs\n           \"mypartition\"    -&gt;              print $ rnf $ mypartition p xs\n           \"partition-ds\"   -&gt; deepseq xs $ print $ rnf $ partition   p xs\n           \"mypartition-ds\" -&gt; deepseq xs $ print $ rnf $ mypartition p xs\n           _ -&gt; err\n    _ -&gt; err\n  where\n    err = putStrLn \"Sorry, I do not understand.\"\n</code></pre>\n\n<p>I do not use Criterion to have a better control about the order of evaluation. To get timings, I use the <code>+RTS -s</code> runtime option. The different test case are executed using different command line options. The first command line option defines for which percentage of the data the predicate holds. The second command line option chooses between different tests.</p>\n\n<p>The tests distinguish two cases:</p>\n\n<ol>\n<li>The data is generated lazily (2nd argument <code>partition</code> or <code>mypartition</code>).</li>\n<li>The data is already fully evaluated in memory (2nd argument <code>partition-ds</code> or <code>mypartition-ds</code>).</li>\n</ol>\n\n<p>The result of the partitioning is always evaluated from left to right, i.e. starting with the list that contains all the elements for which the predicate holds.</p>\n\n<p>In case 1 <code>partition</code> has the advantage that elements of the first resulting list get discarded before all elements of the input list were even produced. Case 1 is especially good, if the predicate matches many elements, i.e. the first command line argument is large.</p>\n\n<p>In case 2, <code>partition</code> cannot play out this advantage, since all elements are already in memory.</p>\n\n<p>For <code>mypartition</code>, in any case all elements are held in memory after the first resulting list is evaluated, because they are needed again to compute the second resulting list. Therefore there is not much of a difference between the two cases.</p>\n\n<p>It seems, the more memory is used, the harder garbage collection gets. Therefore <code>partition</code> is well suited, if the predicate matches many elements and the lazy variant is used.</p>\n\n<p>Conversely, if the predicate does not match many elements or all elements are already in memory, <code>mypartition</code> performs better, since its recursion does not deal with pairs in contrast to <code>partition</code>.</p>\n\n<p>The Stackoverflow question \u201c<a href=\"https://stackoverflow.com/questions/11625840/irrefutable-pattern-does-not-leak-memory-in-recursion-but-why\">Irrefutable pattern does not leak memory in recursion, but why?</a>\u201d might give some more insights about the handling of pairs in the recursion of <code>partition</code>.</p>\n"}], "owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 2, "accepted_answer_id": 38773519, "answer_count": 1, "score": 18, "last_activity_date": 1470330544, "creation_date": 1469862981, "last_edit_date": 1469901288, "question_id": 38671397, "link": "https://stackoverflow.com/questions/38671397/benchmarking-filter-and-partition", "title": "Benchmarking Filter and Partition", "body": "<p>I was testing the performance of the <code>partition</code> function for lists and got some strange results, I think.</p>\n\n<p>We have that <code>partition p xs == (filter p xs, filter (not . p) xs)</code> but we chose the first implementation because it only performs a single traversal over the list. Yet, the results I got say that it maybe be better to use the implementation that uses two traversals.</p>\n\n<p>Here is the minimal code that shows what I'm seeing</p>\n\n<pre><code>import Criterion.Main\nimport System.Random\nimport Data.List (partition)\n\nmypartition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a])\nmypartition p l = (filter p l, filter (not . p) l)\n\n\n\nrandList :: RandomGen g =&gt; g -&gt; Integer -&gt; [Integer]\nrandList gen 0 = []\nrandList gen n = x:xs\n  where\n    (x, gen') = random gen\n    xs = randList gen' (n - 1)\n\nmain = do\n  gen &lt;- getStdGen\n  let arg10000000 = randList gen 10000000\n  defaultMain [\n      bgroup \"filters -- split list in half \" [\n        bench \"partition100\"         $ nf (partition (&gt;= 50)) arg10000000\n      , bench \"mypartition100\"       $ nf (mypartition (&gt;= 50)) arg10000000\n      ]\n      ]\n</code></pre>\n\n<p>I ran the tests both with <code>-O</code> and without it and both times I get that the double traversals is better.</p>\n\n<p>I am using <code>ghc-7.10.3</code> with <code>criterion-1.1.1.0</code></p>\n\n<p>My questions are:</p>\n\n<ul>\n<li><p>Is this expected? </p></li>\n<li><p>Am I using Criterion correctly? I know that laziness can be tricky and <code>(filter p xs, filter (not . p) xs)</code> will only do two traversals if both elements of the tuple are used.</p></li>\n<li><p>Does this has to do something with the way lists are handled in Haskell?</p></li>\n</ul>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["list", "haskell", "coffeescript"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1469820027, "post_id": 38666044, "comment_id": 64713153, "body": "JavaScript has unshift, maybe CoffeeScript has too?"}, {"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1469823902, "post_id": 38666044, "comment_id": 64714803, "body": "No but I have two suggestions (in addition to unshift) to achieve the same end: 1. chain calls to <code>.concat</code> like so <code>[2].concat([3]).concat([4]) =&gt; [2,3,4]</code> <b>or</b> if using in an enviroment that supports it you can inject something like the following raw JavaScript with backticks into your coffeescript (ES 6 only) <code>var list = [2,3,4]; var ints = [1, ...list];</code>. I don&#39;t think coffeescript&#39;s spread operator will work like this though."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1469827465, "post_id": 38666044, "comment_id": 64716315, "body": "if you just need a language that compiles to javascript and is quite lightweight there is always <a href=\"http://www.purescript.org\" rel=\"nofollow noreferrer\">purescript</a>, which has <a href=\"https://github.com/purescript/purescript-lists\" rel=\"nofollow noreferrer\">Lists</a>, note that other than haskell it has strict semantics"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469820626, "last_edit_date": 1469820626, "creation_date": 1469820234, "answer_id": 38666146, "question_id": 38666044, "link": "https://stackoverflow.com/questions/38666044/cons-in-coffeescript/38666146#38666146", "title": "Cons (:) in CoffeeScript?", "body": "<p>As far as I can tell, CoffeeScript does not implement Haskell-like lists.\nThe closest method/function is the <a href=\"http://www.w3schools.com/jsref/jsref_unshift.asp\" rel=\"nofollow\">Array unshift method</a></p>\n\n<p>However, the Haskell cons function creates a <em>new</em> list while preserving the original list, whereas <code>Array.unshift</code> modifies an existing array, so they really aren't the same\nthing.</p>\n\n<p>There are a number implementations of linked-lists in CoffeeScript, e.g.:</p>\n\n<ul>\n<li><a href=\"https://gist.github.com/aeharding/9846467\" rel=\"nofollow\">example 1</a></li>\n<li><a href=\"https://github.com/jashkenas/coffeescript/blob/133fadd36ac36b3eaca44041502bcb88881b30aa/examples/computer_science/linked_list.coffee\" rel=\"nofollow\">example 2</a></li>\n</ul>\n\n<p>but I don't see anything natively supported by CoffeeScript.</p>\n"}, {"tags": [], "owner": {"reputation": 4621, "user_id": 39979, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/538579015/picture?type=large", "display_name": "Jamie Rumbelow", "link": "https://stackoverflow.com/users/39979/jamie-rumbelow"}, "is_accepted": false, "score": 1, "last_activity_date": 1469823517, "creation_date": 1469823517, "answer_id": 38666863, "question_id": 38666044, "link": "https://stackoverflow.com/questions/38666044/cons-in-coffeescript/38666863#38666863", "title": "Cons (:) in CoffeeScript?", "body": "<p>I'd second the native <code>unshift</code> method \u2013 although it will return the length of the resulting array, <em>not the array itself</em>, so you can't chain calls, like your example suggests.</p>\n\n<p>As a fun alternative, <a href=\"http://coffeescript.org/#slices\" rel=\"nofollow\">CoffeeScript's ranges feature allows splicing</a>, which could be used to prepend a value to an existing array:</p>\n\n<pre><code>array = [ 1, 2, 3 ]\n\narray[..0] = [ 4, array[0] ]\n\nconsole.log array # [ 4, 1, 2, 3 ]\n</code></pre>\n\n<p>More precisely, it removes the first element of the array and adds the two elements on the right-hand side of the assignment (your desired prependand and the original 0-value).</p>\n\n<p>We can even chain it, by wrapping it in parentheses and bringing in the array's referencing variable:</p>\n\n<pre><code>array = [ 1, 2, 3 ]\n\n(( array[..0] = [ 4, array[0] ] ) and array).unshift(5)\n\nconsole.log array # [ 5, 4, 1, 2, 3 ]\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1469823517, "creation_date": 1469819718, "question_id": 38666044, "link": "https://stackoverflow.com/questions/38666044/cons-in-coffeescript", "title": "Cons (:) in CoffeeScript?", "body": "<p>Haskell provides the <code>:</code> function to prepend an item to a list:</p>\n\n<pre><code>*Main&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>*Main&gt; 1 : 2 : 3 : []\n[1,2,3]\n</code></pre>\n\n<p>Does such a function/operator exist for CoffeeScript?</p>\n"}, {"tags": ["haskell", "dynamic-programming"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1469816874, "post_id": 38665083, "comment_id": 64711484, "body": "Can you provide a more realistic example? This one is too simplified (the argument <code>a</code> is not used anywhere) and it&#39;s unclear what you actually want to do."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6653296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bad799aa3cced5e7abbf0df0ba9f1c8?s=128&d=identicon&r=PG&f=1", "display_name": "user6653296", "link": "https://stackoverflow.com/users/6653296/user6653296"}, "edited": false, "score": 0, "creation_date": 1469845780, "post_id": 38665317, "comment_id": 64720425, "body": "Thank you so much! Let&#39;s assume I&#39;ll need to change the extra parameter, so I can&#39;t bring it out of scope. I modified the line to be <code>brokenFib = Memo.memoSecond Memo.integral brokenFib</code> (and modified <code>brokenfib&#39;</code> to have an extra _ before the actual parameter), but it has the same issue, any advice?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 33, "user_id": 6653296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bad799aa3cced5e7abbf0df0ba9f1c8?s=128&d=identicon&r=PG&f=1", "display_name": "user6653296", "link": "https://stackoverflow.com/users/6653296/user6653296"}, "edited": false, "score": 0, "creation_date": 1469847067, "post_id": 38665317, "comment_id": 64720627, "body": "@user6653296 - Please just show us what you are doing in your question. Also, if this is an answer to your original question, just accept it and ask a follow-up in a new question."}, {"owner": {"reputation": 31, "user_id": 6655594, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/536ea0e65e5491dbcb9480f9bb180838?s=128&d=identicon&r=PG", "display_name": "user6655594", "link": "https://stackoverflow.com/users/6655594/user6655594"}, "reply_to_user": {"reputation": 33, "user_id": 6653296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bad799aa3cced5e7abbf0df0ba9f1c8?s=128&d=identicon&r=PG&f=1", "display_name": "user6653296", "link": "https://stackoverflow.com/users/6653296/user6653296"}, "edited": false, "score": 0, "creation_date": 1469903794, "post_id": 38665317, "comment_id": 64734095, "body": "@user6653296 Let&#39;s look at this from the perspective of implementing such memoization function: If you know nothing about <code>a</code>, you even can&#39;t compare such values, how would you memoize a function of typr <code>a -&gt; Int -&gt; b</code>? There is no way. So I believe the solution is what also the other answer suggests: Memoize both arguments. What is the type of the first argument? I&#39;m sure it&#39;s not just completely polymorphic, unknown type <code>a</code>."}], "tags": [], "owner": {"reputation": 31, "user_id": 6655594, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/536ea0e65e5491dbcb9480f9bb180838?s=128&d=identicon&r=PG", "display_name": "user6655594", "link": "https://stackoverflow.com/users/6655594/user6655594"}, "is_accepted": false, "score": 3, "last_activity_date": 1469816787, "creation_date": 1469816787, "answer_id": 38665317, "question_id": 38665083, "link": "https://stackoverflow.com/questions/38665083/data-memocombinators-not-catching-cases-in-presence-of-extra-variable/38665317#38665317", "title": "Data.Memocombinators not catching cases in presence of extra variable", "body": "<p>The difference is that <code>fib</code> is a value that doesn't change - it's a memoized function and the memoized values are shared between invocations.</p>\n\n<p>On the other hand <code>brokenFib</code> is a function that for each invocation with a value of type <code>a</code> creates a new memoized function, which doesn't share memoized values with the others.</p>\n\n<p>You have several options (I didn't test any of them and I'm not that familiar with the package):</p>\n\n<ul>\n<li><p>Use <code>memoSecond</code> to memoize the second argument, something like</p>\n\n<pre><code>brokenFib = memoizeSecond integral brokenFib'\n  ...\n</code></pre>\n\n<p>although the docs don't seem to describe how is the first argument handled.</p></li>\n<li><p>Memoize both arguments with <code>memo2</code>, if possible.</p></li>\n<li><p>If the first argument of type <code>a</code> is the same throughout the whole invocation, you can use</p>\n\n<pre><code>brokenFib a = go\n  where\n    go = integral go'\n    go' = ... -- and calls 'go', not 'brokenFib' for recursive calls!\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1469996840, "last_edit_date": 1469996840, "creation_date": 1469860997, "answer_id": 38671142, "question_id": 38665083, "link": "https://stackoverflow.com/questions/38665083/data-memocombinators-not-catching-cases-in-presence-of-extra-variable/38671142#38671142", "title": "Data.Memocombinators not catching cases in presence of extra variable", "body": "<p>Well, it turns out this very question was discussed on #haskell three years ago.\nHave a look at these chat events:</p>\n\n<ul>\n<li>efie: <a href=\"http://ircbrowse.net/browse/haskell?id=15695230&amp;timestamp=1368546348#t1368546348\" rel=\"nofollow\">15695230</a> (references lpaste <a href=\"http://lpaste.net/87973\" rel=\"nofollow\">http://lpaste.net/87973</a> )</li>\n<li>int-e: <a href=\"http://ircbrowse.net/browse/haskell?id=15695262&amp;timestamp=1368546806#t1368546806\" rel=\"nofollow\">15695262</a></li>\n<li>efie: <a href=\"http://ircbrowse.net/browse/haskell?id=15695288&amp;timestamp=1368547255#t1368547255\" rel=\"nofollow\">15695288</a> </li>\n<li>int-e: <a href=\"http://ircbrowse.net/browse/haskell?id=15695302&amp;timestamp=1368547433#t1368547433\" rel=\"nofollow\">15695302</a></li>\n</ul>\n\n<p>Based on int-e's remarks, it appears that <code>memoSecond integral f</code> by itself is not\nthat useful. I think that it is meant to be used so you can specify how the\nsecond argument should be memoized. In other words, you should always memoize\non both function arguments, and <code>memoSecond</code> is provided so you can specify a\nstrategy for memoizing on the second argument. Thus, int-e suggests something\nlike:</p>\n\n<pre><code>integral (memoSecond integral f)\n</code></pre>\n\n<p>Of course, each <code>integral</code> may be replaced with a different memoization\nstrategy.</p>\n\n<p>Moreover, what actually happens can depend on how you write the function\nand whenter you run it using ghci or compile it with ghc and what\noptimization level you use.</p>\n\n<p>Consider this program:</p>\n\n<pre><code>import qualified\n  Data.MemoCombinators as Memo\nimport Debug.Trace\n\nafib :: Char -&gt; Int -&gt; Int\nafib _ = bfib\n  where\n    bfib = Memo.integral cfib\n    cfib n | trace msg False = undefined\n      where msg = \"cfib at \" ++ show n\n    cfib 1 = 1\n    cfib 2 = 2\n    cfib n = bfib (n-1) + bfib (n-2)\n\nmain = do print (afib 'x' 5); print (afib 'x' 6)\n</code></pre>\n\n<p>and a second version where the line <code>afib _ = bfib</code> is changed to <code>afib = \\_ -&gt; bfib</code> (all other lines are the same.)</p>\n\n<p>Whether afib is memoized can depend on how you execute / compile it:</p>\n\n<pre><code>            afib _ = bfib | afib = \\_ -&gt; bfib \n           ---------------|-------------------\nghci        NOT MEMOIZED  | MEMOIZED\nrunhaskell  NOT MEMOIZED  | MEMOIZED\nghc         NOT MEMOIZED  | MEMOIZED\nghc -O2     MEMOIZED      | MEMOIZED\n</code></pre>\n\n<p>So, in this case it appears you should use the second form to guarantee\nmemoization.</p>\n"}], "owner": {"reputation": 33, "user_id": 6653296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bad799aa3cced5e7abbf0df0ba9f1c8?s=128&d=identicon&r=PG&f=1", "display_name": "user6653296", "link": "https://stackoverflow.com/users/6653296/user6653296"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 38671142, "answer_count": 2, "score": 3, "last_activity_date": 1469996840, "creation_date": 1469815878, "last_edit_date": 1469853543, "question_id": 38665083, "link": "https://stackoverflow.com/questions/38665083/data-memocombinators-not-catching-cases-in-presence-of-extra-variable", "title": "Data.Memocombinators not catching cases in presence of extra variable", "body": "<p>Consider the two functions below. <code>traceShow</code> has been included to show DP cache hits or misses. The first one has been poached from the <a href=\"https://www.google.com/search?client=safari&amp;rls=en&amp;q=data.memocombinators&amp;ie=UTF-8&amp;oe=UTF-8#q=data.memocombinators+memo2\" rel=\"nofollow\">MemoCombinators documentation</a>. The second I constructed myself.</p>\n\n<pre><code>import Data.MemoCombinators as Memo\nimport Debug.Trace\n\nfib :: Int -&gt; Int\nfib = Memo.integral fib'\n    where\n        fib' :: Int -&gt; Int\n        fib' 0 = traceShow 0 $ 0\n        fib' 1 = traceShow 1 $ 1\n        fib' n = traceShow n $ fib (n-1) + fib (n-2)    \n\nbrokenFib :: a -&gt; Int -&gt; Int\nbrokenFib a = Memo.integral brokenFib'\n    where\n        brokenFib' :: Int -&gt; Int\n        brokenFib' 0 = traceShow 0 $ 0\n        brokenFib' 1 = traceShow 1 $ 1\n        brokenFib' n = traceShow n $ brokenFib [] (n-1) + brokenFib [] (n-2)\n</code></pre>\n\n<p><code>fib</code> takes advantage of the DP, but <code>brokenFib</code> doesn't, meaning the extra variable must be messing it up somehow. It's not hard to construct an scenario where you'd want to DP only one of the arguments of a two argument function, but that can't be done without finding out how the extra variable is messing with <code>brokenFib</code>. Any advice?</p>\n\n<p>edit:</p>\n\n<p>Implementation of the second solution given by @user6655594:</p>\n\n<pre><code>brokenFib :: a -&gt; Int -&gt; Int\nbrokenFib = Memo.memoSecond Memo.integral brokenFib'\n    where\n        brokenFib' :: a -&gt; Int -&gt; Int\n        brokenFib' _ 1 = traceShow 1 $ 1\n        brokenFib' _ 2 = traceShow 1 $ 1\n        brokenFib' _ n = traceShow n $ (brokenFib [] (n-1)) + brokenFib [] (n-2)\n</code></pre>\n\n<p>It doesn't catch DP either, although the documentation (\"Memoize the second argument of a function\") suggests that it should.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1469812272, "last_edit_date": 1469812272, "creation_date": 1469806433, "answer_id": 38662555, "question_id": 38661831, "link": "https://stackoverflow.com/questions/38661831/zipping-traversals/38662555#38662555", "title": "Zipping Traversals", "body": "<p>Here's a version which returns a <code>Left</code> if there are not enough elements.</p>\n\n<p>You can fill the holes using <code>Traversable</code>'s <code>mapM</code> in the <code>State</code> monad:</p>\n\n<pre><code> import qualified Data.Traversable as T\n import Control.Monad.State.Strict\n import Control.Error\n\n import qualified Data.Tree as Tree\n import Data.Tree (Tree(..))\n\n visit :: Maybe a -&gt; ExceptT String (State [a]) a\n visit (Just x) = return x\n visit Nothing = do xs &lt;- lift get\n                    case xs of\n                      (a:as) -&gt; do lift (put as); return a\n                      []     -&gt; throwE \"out of elements\"\n\n fill :: T.Traversable t =&gt; t (Maybe a) -&gt; [a] -&gt; Either String (t a)\n fill t vals  = evalState (runExceptT (T.mapM visit t) ) vals\n\n tree = Node Nothing [ Node (Just \"2\") [], Node Nothing [] ]\n\n ex1 =  print $ fill tree [\"a\", \"b\", \"c\", \"d\" ] -- Right ...\n ex2 =  print $ fill tree [\"a\" ]                -- Left \"out of elements\"\n</code></pre>\n\n<p>If you want to make sure all the elements are used, change <code>fill</code> to:</p>\n\n<pre><code>fill :: T.Traversable t =&gt; t (Maybe a) -&gt; [a] -&gt; Either String (t a)\nfill t vals = evalState (runExceptT doit) vals\n  where doit = do t' &lt;- T.mapM visit t\n                  xs &lt;- lift get\n                  case xs of\n                    [] -&gt; return t'\n                    _  -&gt; throwE \"not all elements were used\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1469812193, "last_edit_date": 1469812193, "creation_date": 1469811004, "answer_id": 38663833, "question_id": 38661831, "link": "https://stackoverflow.com/questions/38661831/zipping-traversals/38663833#38663833", "title": "Zipping Traversals", "body": "<p>A simple (but partial) solution exploiting <code>mapAccumL</code>:</p>\n\n<pre><code>import qualified Data.Traversable as T\n\nfill :: forall a t. T.Traversable t =&gt; t (Maybe a) -&gt; [a] -&gt; t a\nfill t fillers = snd $ T.mapAccumL go fillers t\n    where\n      go :: [a] -&gt; Maybe a -&gt; ([a], a)\n      go fs     (Just x) = (fs, x)\n      go (f:fs) Nothing  = (fs, f)\n      go []     Nothing  = error \"not enough fillers!\"\n</code></pre>\n\n<p>A total alternative:</p>\n\n<pre><code>fill2 :: forall a t. T.Traversable t =&gt; \n        t (Maybe a) -&gt; [a] -&gt; Maybe (t a)\nfill2 t fillers  = sequenceA . snd $ T.mapAccumL go fillers t\n    where\n      go :: [a] -&gt; Maybe a -&gt; ([a], Maybe a)\n      go (f:fs) Nothing  = (fs, Just f)\n      go fs     x        = (fs, x)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 3, "last_activity_date": 1469898568, "last_edit_date": 1469898568, "creation_date": 1469841694, "answer_id": 38669495, "question_id": 38661831, "link": "https://stackoverflow.com/questions/38661831/zipping-traversals/38669495#38669495", "title": "Zipping Traversals", "body": "<p>Here's a compact one:</p>\n\n<pre><code>fill :: Traversable t =&gt; t (Maybe a) -&gt; [a] -&gt; Maybe (t a)\nfill = evalStateT . traverse foo where\n  foo x = maybe empty pure x &lt;|&gt; StateT uncons\n</code></pre>\n"}], "owner": {"reputation": 1329, "user_id": 383958, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/JjIgB.jpg?s=128&g=1", "display_name": "Joel Burget", "link": "https://stackoverflow.com/users/383958/joel-burget"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 3, "score": 9, "last_activity_date": 1469898568, "creation_date": 1469804116, "question_id": 38661831, "link": "https://stackoverflow.com/questions/38661831/zipping-traversals", "title": "Zipping Traversals", "body": "<p>I have a <code>Traversable</code> with holes in it -- imagine this binary tree:</p>\n\n<pre><code>         /       \\\n       /    \\     Nothing\n Just 1    /  \\  \n    Nothing   Just 3\n</code></pre>\n\n<p>I also have a list of values to fill the holes with -- <code>[2, 4]</code> -- resulting in:</p>\n\n<pre><code>         /       \\\n       /    \\     Just 4\n Just 1    /  \\  \n     Just 2   Just 3\n</code></pre>\n\n<p>I think it's possible to use a <code>lens</code> indexed traversal to traverse to the <code>Nothing</code>s and replace them with the value at the corresponding index from the list.</p>\n\n<p>But it must be possible to do more directly without using indices?</p>\n\n<p>Bonus points -- a few variations on this theme:</p>\n\n<ol>\n<li>(my use case) The list of values must have <em>exactly</em> the same number of elements as holes in the traversal. Failure indicated with a <code>Maybe</code>.</li>\n<li>The list must have <em>at least</em> as many elements, so we could have also passed in <code>[2, 4, 6]</code>, <code>[2, 4, ..]</code>, etc.</li>\n<li>The list can have any number of elements, and we fill as many holes as we can with the elements we're given. This operation can't fail, it can just fill any number of holes.</li>\n</ol>\n"}, {"tags": ["haskell", "yesod", "elm", "ghcjs"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 2, "creation_date": 1469797011, "post_id": 38659189, "comment_id": 64699612, "body": "There&#39;s the <a href=\"https://github.com/krisajenkins/elm-export\" rel=\"nofollow noreferrer\">elm-export</a> project which creates types and decoders based on a Haskell types. That looks like the most recently maintained of the bunch."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1469815887, "post_id": 38659189, "comment_id": 64710953, "body": "There&#39;s also <a href=\"https://hackage.haskell.org/package/haste-compiler-0.4/docs/Haste-App.html\" rel=\"nofollow noreferrer\">haste.app</a>, a &quot;type-safe client-server communication framework&quot;.  I don&#39;t know if it would integrate well with Yesod."}], "answers": [{"tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": true, "score": 1, "last_activity_date": 1469984092, "creation_date": 1469984092, "answer_id": 38686341, "question_id": 38659189, "link": "https://stackoverflow.com/questions/38659189/yesod-shared-types-between-server-and-client/38686341#38686341", "title": "Yesod - shared types between server and client", "body": "<p>To achieve this with <code>GHCJS</code> you can just build your project out of three core packages in this fashion:</p>\n\n<ul>\n<li>frontend - something based on ghcjs-dom, I like <a href=\"https://github.com/reflex-frp/reflex-dom\" rel=\"nofollow\">Reflex-dom</a></li>\n<li>backend - use your favorite framework, I like <a href=\"http://snapframework.com/\" rel=\"nofollow\">Snap</a>, Yesod should work just the same</li>\n<li>shared - code shared between frontend and backend</li>\n</ul>\n\n<p>Where frontend and backend both depend on shared of course. Frontend is compiled with <code>GHCJS</code>, backend with <code>GHC</code>.</p>\n\n<p>If you would like to see a complete example I would highly recommend studying <a href=\"https://github.com/mightybyte/hsnippet\" rel=\"nofollow\">hsnippet</a>. Take a look at <a href=\"https://github.com/mightybyte/hsnippet/blob/6e901fea210a2717ec7800b8d3bcd60740fdc232/shared/src/HSnippet/Shared/WsApi.hs\" rel=\"nofollow\"><code>WsApi.hs</code></a> where a set of up and downstream messages is being defined. All the JSON instances are derived in one place and imported in both frontend and backend.</p>\n\n<p>Hsnippet uses websockets. This is not a requirement of course. You could use regular XHR in your own app. The principle stays the same. You define your API and serialization instances (usually JSON) in the shared package and import the relevant modules in both frontend and backend.</p>\n\n<p>Personally I also share validation code, database entity definitions generated with persistent etc. Once you set it up sharing additional stuff is mostly a copy paste to one of the shared modules and then import wherever.</p>\n"}], "owner": {"reputation": 585, "user_id": 660319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b641f0c06026cb243028537fe94a6b7d?s=128&d=identicon&r=PG", "display_name": "Thomas L&#248;cke", "link": "https://stackoverflow.com/users/660319/thomas-l%c3%b8cke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 38686341, "answer_count": 1, "score": 0, "last_activity_date": 1469984092, "creation_date": 1469796175, "question_id": 38659189, "link": "https://stackoverflow.com/questions/38659189/yesod-shared-types-between-server-and-client", "title": "Yesod - shared types between server and client", "body": "<p>I'm used to working with Dart, where sharing types between server and client is as simple as importing the relevant packages into your project.</p>\n\n<p>Can something similar be accomplished with Yesod/Haskell? Should I use GHCJS for the client? Maybe Elm? The goal is not having to worry about the data getting mangled in transit between server and client - and also not having to write a single line of JS.  :o)</p>\n\n<p>I haven't been able to find any good, beginner friendly docs on how to best tackle this challenge using Haskell. I suspect I just haven't looked in the right places. Any and all help is more than welcome.</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1469789777, "post_id": 38656912, "comment_id": 64695190, "body": "The <code>fromJSON</code> function does not parse JSON, it just converts parsed JSON into some other Haskell data structure. You want <code>decode</code> instead. However, <code>returnData</code> is not a <code>ByteString</code>, it is a <code>Maybe ByteString</code>, so you will have to pattern match, use <code>&gt;&gt;=</code>, or some other tool to handle the possibility of <code>returnData</code> being <code>Nothing</code>. In this example, <code>print (decode =&lt;&lt; returnData)</code> should do what you want."}], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469791247, "post_id": 38657250, "comment_id": 64696072, "body": "I tried your solution and now i&#39;m getting another error, please see my Edit 1 above"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469794738, "post_id": 38657250, "comment_id": 64698134, "body": "i changed it and get now: <code>Couldn&#39;t match expected type </code>ByteString&#39;                 with actual type <code>Maybe ByteString&#39;     In the first argument of </code>decode&#39;, namely <code>returnData&#39;     In the expression: (decode returnData)</code>"}, {"owner": {"reputation": 162, "user_id": 4359476, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005731934252/picture?type=large", "display_name": "Janos Potecki", "link": "https://stackoverflow.com/users/4359476/janos-potecki"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469795089, "post_id": 38657250, "comment_id": 64698379, "body": "oh, that means that returnData is of type <code>Maybe</code>"}, {"owner": {"reputation": 162, "user_id": 4359476, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005731934252/picture?type=large", "display_name": "Janos Potecki", "link": "https://stackoverflow.com/users/4359476/janos-potecki"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469795728, "post_id": 38657250, "comment_id": 64698810, "body": "That means that <code>r ^? responseBody</code> returns something of type maybe hence you can combine those with <code>&gt;&gt;=</code>"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469795802, "post_id": 38657250, "comment_id": 64698848, "body": "i changed it and now i get: No instance for (FromJSON ByteString)       arising from a use of <code>decode&#39;     In the second argument of </code>(&gt;&gt;=)&#39;, namely <code>decode&#39;     In the expression: (r ^? responseBody) &gt;&gt;= decode     In an equation for </code>returnData&#39;:         returnData = (r ^? responseBody) &gt;&gt;= decode"}, {"owner": {"reputation": 162, "user_id": 4359476, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005731934252/picture?type=large", "display_name": "Janos Potecki", "link": "https://stackoverflow.com/users/4359476/janos-potecki"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469796003, "post_id": 38657250, "comment_id": 64698958, "body": "wait, why are you doing <code>r &lt;- ...</code> ??? You have already bound <code>r</code> in <code>let r = Rectangle...</code> Change <code>r</code> into <code>r&#39;</code>"}, {"owner": {"reputation": 162, "user_id": 4359476, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005731934252/picture?type=large", "display_name": "Janos Potecki", "link": "https://stackoverflow.com/users/4359476/janos-potecki"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469796398, "post_id": 38657250, "comment_id": 64699208, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/118633/discussion-between-janos-potecki-and-manzmoody\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 162, "user_id": 4359476, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005731934252/picture?type=large", "display_name": "Janos Potecki", "link": "https://stackoverflow.com/users/4359476/janos-potecki"}, "is_accepted": true, "score": 3, "last_activity_date": 1506553937, "last_edit_date": 1506553937, "creation_date": 1469790288, "answer_id": 38657250, "question_id": 38656912, "link": "https://stackoverflow.com/questions/38656912/convert-json-back-to-data-in-haskell/38657250#38657250", "title": "Convert JSON back to Data in Haskell", "body": "<p>working solution</p>\n\n<pre><code>r' &lt;- asJSON =&lt;&lt; postWith opts url (encode rectangle) :: IO Res\ncase r' of\n     Nothing        -&gt; print \"Error decoding JSON\"\n     Just x         -&gt; print x\n</code></pre>\n\n<p>For performance I'd suggest you add the following to your <code>instance ToJSON</code>:</p>\n\n<pre><code>instance ToJSON Point where\n       toEncoding = genericToEncoding defaultOptions\n</code></pre>\n\n<p>and the same for <code>Rectangle</code></p>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 38657250, "answer_count": 1, "score": 1, "last_activity_date": 1506553937, "creation_date": 1469789266, "last_edit_date": 1469796376, "question_id": 38656912, "link": "https://stackoverflow.com/questions/38656912/convert-json-back-to-data-in-haskell", "title": "Convert JSON back to Data in Haskell", "body": "<p>I have the following Haskell to call my WCF Service:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Main where\n\nimport Data.Aeson\nimport Data.Dynamic\nimport Data.Aeson.Lens\nimport Data.ByteString.Lazy as BS\nimport GHC.Generics\nimport Network.Wreq\nimport Control.Lens\n\ndata Point = Point { x :: Int, y :: Int } deriving (Generic, Show)\ninstance ToJSON Point\ninstance FromJSON Point\n\ndata Rectangle = Rectangle { width :: Int, height :: Int, point :: Point } deriving (Generic, Show)\ninstance ToJSON Rectangle\ninstance FromJSON Rectangle\n\nmain = do        \n    let p = Point 1 2\n    let r = Rectangle 10 20 p \n    let url = \"http://localhost:8000/Rectangle\"   \n    let opts = defaults &amp; header \"Content-Type\" .~ [\"application/json\"]\n    r &lt;- postWith opts url (encode r)    \n    let returnData = r ^? responseBody\n    case (decode returnData) of\n        Nothing       -&gt; BS.putStrLn \"Error decoding JSON\"\n        Just json     -&gt; BS.putStrLn $ show $ decode json\n</code></pre>\n\n<p>The output in this case is:</p>\n\n<pre><code>Just \"{\\\"height\\\":20,\\\"point\\\":{\\\"x\\\":1,\\\"y\\\":2},\\\"width\\\":10}\"\n</code></pre>\n\n<p>I already tried it with fromJSON:</p>\n\n<pre><code>print $ fromJSON returnData\n</code></pre>\n\n<p>and got this error:</p>\n\n<pre><code>Couldn't match expected type `Value'\n                with actual type `Maybe\n                                    bytestring-0.10.6.0:Data.ByteString.Lazy.Internal.ByteString'\n    In the first argument of `fromJSON', namely `returnData'\n    In the second argument of `($)', namely `fromJSON returnData'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>My question is now how to convert this JSON string back to an object of type \"Rectangle\"? </p>\n\n<p><strong>EDIT 1:</strong> I changed my code due to Janos Potecki's answer and get now the following error:</p>\n\n<pre><code>Couldn't match type `[Char]' with `ByteString'\n    Expected type: ByteString\n      Actual type: String\n    In the second argument of `($)', namely `show $ decode json'\n    In the expression: BS.putStrLn $ show $ decode json\n    In a case alternative:\n        Just json -&gt; BS.putStrLn $ show $ decode json\nFailed, modules loaded: none.\n</code></pre>\n\n<p><strong>EDIT 2:</strong> i changed it to:</p>\n\n<pre><code>main = do        \n    let point = Point 1 2\n    let rectangle = Rectangle 10 20 point\n    let url = \"http://localhost:8000/Rectangle/Move/100,200\"   \n    let opts = defaults &amp; header \"Content-Type\" .~ [\"application/json\"]\n    r &lt;- postWith opts url (encode rectangle)    \n    let returnData = (r ^? responseBody) &gt;&gt;= decode\n    case returnData of\n     Nothing       -&gt; BS.putStrLn \"Error decoding JSON\"\n     Just json     -&gt; BS.putStrLn json\n</code></pre>\n\n<p>and now i get:</p>\n\n<pre><code>No instance for (FromJSON ByteString)\n      arising from a use of `decode'\n    In the second argument of `(&gt;&gt;=)', namely `decode'\n    In the expression: (r ^? responseBody) &gt;&gt;= decode\n    In an equation for `returnData':\n        returnData = (r ^? responseBody) &gt;&gt;= decode\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469776766, "post_id": 38651602, "comment_id": 64687176, "body": "I would just grep for them. They start with <code>{-# RULES</code>. Unfortunately they&#39;re not first class citizens."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469777034, "post_id": 38651602, "comment_id": 64687337, "body": "@pdexter This is exactly the answer I was hoping NOT to get. xD"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469777173, "post_id": 38651602, "comment_id": 64687427, "body": ":D Take a read of this <a href=\"http://www.yesodweb.com/blog/2016/02/first-class-stream-fusion\" rel=\"nofollow noreferrer\">http://www.yesodweb.com/blog/2016/02/first-class-stream-fusi&zwnj;&#8203;on</a>"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1469783663, "post_id": 38651602, "comment_id": 64691218, "body": "This is a valid request. And it should at least be simple to query GHCi for all rules with a certain constant as the outmost symbol on the LHS (as rules are tacked to them). I recommend you open a feature request for it. This would be a nice task for a beginner contributor to GHC!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1469800444, "post_id": 38651602, "comment_id": 64702066, "body": "@JoachimBreitner If no one has a good answer to this, I will go ahead and do that - might even try implementing it if it gets accepted (I&#39;ve been looking for a good place to start hacking on GHC for ages)!"}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "edited": false, "score": 1, "creation_date": 1469963185, "post_id": 38651602, "comment_id": 64745803, "body": "I don&#39;t think there&#39;s any other at the moment. You could use <code>haskell-src-exts</code> to parse all the <code>RULE</code> pragmas but it just might be an overkill for what you want now."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1469779649, "creation_date": 1469779649, "answer_id": 38653674, "question_id": 38651602, "link": "https://stackoverflow.com/questions/38651602/searching-for-rewrite-rules/38653674#38653674", "title": "Searching for rewrite rules", "body": "<p>Alright, still hoping for a good answer to this, but if there isn't, I went ahead and did what pdexter suggested and grep'd <code>base</code> for rules. <a href=\"https://gist.github.com/harpocrates/e95ce275a2220dfbd50b102e1e533556\" rel=\"nofollow\">Here are the rules in base 4.9.</a></p>\n\n<hr>\n\n<p>For anyone interested in replicating this:</p>\n\n<ul>\n<li>clone <code>http://git.haskell.org/ghc.git</code></li>\n<li>navigate to <code>ghc/libraries/base</code></li>\n<li>grep recursively <code>pcregrep -Mr '\\{-# RULES(.|\\n)*?#-\\}' .</code></li>\n</ul>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 2, "accepted_answer_id": 38653674, "answer_count": 1, "score": 5, "last_activity_date": 1469779649, "creation_date": 1469772459, "question_id": 38651602, "link": "https://stackoverflow.com/questions/38651602/searching-for-rewrite-rules", "title": "Searching for rewrite rules", "body": "<p>Is there any way to browse or search rewrite rules? When I use flags like  <code>-ddump-rule-firings</code> or <code>-ddump-rule-rewrites</code> I just get the name of the rule that fired and the rewrite that it caused, but not the actual rule itself...</p>\n\n<p>Ideally I'd like to see what rewrite rules are in scope via GHCi, but realistically I'd be willing to settle for just an exhaustive list of the rewrite rules present in base.</p>\n"}, {"tags": ["haskell", "type-constraints", "gadt"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1469772631, "post_id": 38651569, "comment_id": 64685054, "body": "You could do <code>myFunction t@Thing{} = ...</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1469793549, "post_id": 38651569, "comment_id": 64697391, "body": "<code>myfunction Thing{need=x}</code> This provides the <code>Ord</code> dict and you also have the value of the <code>need</code> field already unpacked into <code>x</code>.  There&#39;s also an extension that let you write <code>myFunction Thing{need}</code> and in the body you can use the name <code>need</code> to refer to the value of the <code>need</code> field of the argument."}, {"owner": {"reputation": 2245, "user_id": 48998, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/913f01c6fafa9eeda8e4b2d443e3309f?s=128&d=identicon&r=PG", "display_name": "cemulate", "link": "https://stackoverflow.com/users/48998/cemulate"}, "edited": false, "score": 0, "creation_date": 1469808893, "post_id": 38651569, "comment_id": 64707439, "body": "Thanks guys, didn&#39;t know about that syntax!"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1469805082, "last_edit_date": 1469805082, "creation_date": 1469804664, "answer_id": 38662001, "question_id": 38651569, "link": "https://stackoverflow.com/questions/38651569/get-constraint-in-gadt-style-declaration-without-specifically-using-constructor/38662001#38662001", "title": "Get constraint in GADT-style declaration without specifically using constructor?", "body": "<p>You can define a function which extracts all of the constraints from the constructor:</p>\n\n<pre><code>data Test a where\n    Test :: Ord a =&gt; { first :: a, second :: a } -&gt; Test a\n\nopenTest :: Test a -&gt; (Ord a =&gt; r) -&gt; r \nopenTest Test{} x = x \n</code></pre>\n\n<p>You can then write</p>\n\n<pre><code>comp :: Test a -&gt; Bool\ncomp x = openTest x $ first x &lt; second x \n</code></pre>\n\n<p>but note that the implementation of <code>openTest</code> is completely trivial - and it is less typing to just inline the pattern matching:</p>\n\n<pre><code>comp' :: Test a -&gt; Bool\ncomp' x@Test{} = first x &lt; second x \n</code></pre>\n\n<p>Note also this (i.e. the <code>Test{}</code> syntax) will work with any constructor, even if it is not a record constructor. Your actual function can simply be expressed as</p>\n\n<pre><code>myFunction t@Thing{} = ... (need t) ...\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>openThing :: Thing a -&gt; (ThingConstraints a =&gt; r) -&gt; r \nopenThing Thing{} x = x \n\nmyFunction t = ... (openThing $ need t) ...\n</code></pre>\n\n<p>Finally, you can also define a function to extract a specific field as well as the constraints which apply to this field, which can be very useful for large constructors with many constraints:</p>\n\n<pre><code>first' :: Test a -&gt; (Ord a =&gt; a -&gt; r) -&gt; r \nfirst' t@Test{} x = x (first t) \n</code></pre>\n"}], "owner": {"reputation": 2245, "user_id": 48998, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/913f01c6fafa9eeda8e4b2d443e3309f?s=128&d=identicon&r=PG", "display_name": "cemulate", "link": "https://stackoverflow.com/users/48998/cemulate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469805082, "creation_date": 1469772302, "question_id": 38651569, "link": "https://stackoverflow.com/questions/38651569/get-constraint-in-gadt-style-declaration-without-specifically-using-constructor", "title": "Get constraint in GADT-style declaration without specifically using constructor?", "body": "<p>Consider the following:</p>\n\n<pre><code>{-# LANGUAGE GADTs, GADTSyntax #-}\n\ndata Test a where\n    Test :: Ord a =&gt; { first :: a, second :: a } -&gt; Test a\n\ncomp :: Test a -&gt; Bool\ncomp (Test fst snd) = fst &lt; snd\n</code></pre>\n\n<p>The constructor <code>Test</code> is declared with an <code>Ord</code> constraint. In <code>comp</code>, I've specifically taken a parameter constructed with <code>Test</code>, which gives the <code>Ord</code> constraint allowing me to use <code>&lt;</code></p>\n\n<p>Now, suppose I wanted to write:</p>\n\n<pre><code>comp' :: Test a -&gt; Bool\ncomp' x = (first x) &lt; (second x)\n</code></pre>\n\n<p>Using the projection functions to get the first and second element. This is <em>not</em> okay because my parameter <code>x</code> was not (necessarily) constructed with <code>Test</code>, so there is no <code>Ord</code> constraint.</p>\n\n<p>So, for my question, is there a way to take the parameter as just <code>x</code> but still somehow have the <code>Ord</code> constraint from the <code>Test</code> constructor, without having to \"unpack\" or pattern match on the <code>Test</code> constructor or add the constraint to my function?</p>\n\n<p>As for why I would want this, I have a data type with a constructor taking many values, one of which I only need in this particular function, so unpacking it makes my function unnecessarily verbose:</p>\n\n<pre><code>myFunction :: Thing -&gt; ...\nmyFunction (Thing _ _ _ _ need _ _) ...\n</code></pre>\n\n<p>As opposed to </p>\n\n<pre><code>myFunction t = ... (need t)\n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "ghc", "ghci"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 2, "creation_date": 1469759655, "post_id": 38649638, "comment_id": 64681651, "body": "I&#39;m pretty sure this is weird <code>ghci</code> behavior. Something like <code>\u03bb&gt; do a &lt;- return map; return (a (+ 1) [1,2,3])</code> works as you&#39;d expect."}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1469761684, "post_id": 38649881, "comment_id": 64682093, "body": "It also should be pointed out that <code>a</code> can&#39;t just be given a polymorphic type because function arguments can&#39;t be polymorphic (unless the function is a higher rank function, but <code>&gt;&gt;=</code> takes a rank-1 function)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1469761784, "post_id": 38649881, "comment_id": 64682114, "body": "@sepp2k Good point! Let me add that in."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1469771159, "post_id": 38649881, "comment_id": 64684471, "body": "<code>a &lt;- return  map</code> was simply the minimum viable example.  I am actually trying to build a polymorphic function from command line options and store that function in a StateT based monad for later use. I keep getting <code>a</code> is not <code>a0</code> type errors, and I thought this might shed some light on why. See also <a href=\"http://stackoverflow.com/questions/38648935\">stackoverflow.com/questions/38648935</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1469771575, "post_id": 38649881, "comment_id": 64684640, "body": "@JohnF.Miller I am fully aware of this - I&#39;ve also been trying to help you on that question, but you will need to post more information. But this really is a completely separate problem. Key takeaway is write <code>let a = ...</code> instead of <code>a &lt;- return ...</code> when debugging in GHCi (for reasons just related to GHCi)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1469762582, "last_edit_date": 1469762582, "creation_date": 1469761302, "answer_id": 38649881, "question_id": 38649638, "link": "https://stackoverflow.com/questions/38649638/why-does-the-type-of-a-function-change-when-it-comes-out-of-a-monad-in-ghci/38649881#38649881", "title": "Why does the type of a function change when it comes out of a monad in GHCi", "body": "<p>First of all, there is no point in doing anything like <code>a &lt;- return map</code> - its the same as <code>let a = map</code>, which works just fine. That said, I don't think that is your question...</p>\n\n<hr>\n\n<p>Checking out the documentation of <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/candidate/docs/GHC-Prim.html\"><code>GHC.Prim.Any</code></a> which gives us a big hint as to the role of <code>Any</code>. </p>\n\n<blockquote>\n  <p>It's also used to instantiate un-constrained type variables after type\n  checking. For example, <code>length</code> has type</p>\n\n<pre><code>length :: forall a. [a] -&gt; Int \n</code></pre>\n  \n  <p>and the list datacon for the empty list has type</p>\n\n<pre><code>[] :: forall a. [a]\n</code></pre>\n  \n  <p>In order to compose these two terms as <code>length []</code> a\n  type application is required, but there is no constraint on the\n  choice. In this situation GHC uses <code>Any</code></p>\n</blockquote>\n\n<p>(In terms of type application syntax, that looks like <code>length @Any ([] @Any *)</code>)</p>\n\n<p>The problem is that when GHCi sees <code>x &lt;- return map</code> it tries to desugar it to <code>return map &gt;&gt;= \\x -&gt; ...</code> but the <code>...</code> part is whatever you enter next into GHCi. Normally it would figure out what the type variables of <code>map</code> are going to be instantiated to (or whether they even should be instantiated to anything) based the <code>...</code>, but since it has nothing there. </p>\n\n<p>Another key point that @sepp2k points out is that <code>x</code> <em>can't be given a polymorphic type</em> because <code>(&gt;&gt;=)</code> expects (on its RHS) a rank-1 function, and that means its argument can't be polymorphic. (Loosening this condition pushes you straight into <code>RankNTypes</code> at which point you lose the ability to infer types reliably.)</p>\n\n<p>Therefore, needing <code>x</code> to be monomorphic and having no information to help it instantiate the type variables that prevent <code>x</code> from being monomorphic, it defaults to using <code>Any</code>. That means that instead of <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> you get <code>(Any -&gt; Any) -&gt; [Any] -&gt; [Any]</code>.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "closed_date": 1469771275, "answer_count": 1, "score": 3, "last_activity_date": 1469764354, "creation_date": 1469759387, "last_edit_date": 1469764354, "question_id": 38649638, "link": "https://stackoverflow.com/questions/38649638/why-does-the-type-of-a-function-change-when-it-comes-out-of-a-monad-in-ghci", "closed_reason": "Duplicate", "title": "Why does the type of a function change when it comes out of a monad in GHCi", "body": "<p>Something changes about the type of a function when it comes out of a monad.</p>\n\n<p>In GHCI:</p>\n\n<pre><code>&gt; :t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n&gt; a &lt;- return map\n&gt; :t a\na :: (GHC.Prim.Any -&gt; GHC.Prim.Any)\n -&gt; [GHC.Prim.Any] -&gt; [GHC.Prim.Any]\n</code></pre>\n\n<p>This change makes it hard to store the function in a higher rank type.</p>\n\n<p>What is happening here and can I make it not happen? </p>\n\n<p>(Also doesn't this violate one of the monad laws?)</p>\n"}, {"tags": ["haskell", "free-monad", "higher-rank-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469754000, "post_id": 38648935, "comment_id": 64680416, "body": "Maybe I&#39;m missing something obvious, but why don&#39;t you just do <code>data ProgramState a = PS { ... , storageInterface :: DataStore a -&gt; IO a }</code>? I don&#39;t think that breaks any of the code you&#39;ve pasted here..."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469755898, "post_id": 38648935, "comment_id": 64680834, "body": "Can&#39;t replicate the issue."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469757282, "post_id": 38648935, "comment_id": 64681142, "body": "Alec ` Not in scope: type variable &#39;a&#39; `"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469757333, "post_id": 38648935, "comment_id": 64681149, "body": "Did you include the type variable <code>data ProgramState **a** = ..</code>?"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469758317, "post_id": 38648935, "comment_id": 64681350, "body": "No, I use RankNTypes.  If I didn&#39;t I would need to existentially quantify the StateT monad it goes into so and I just kick the can down the road."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469759607, "post_id": 38648935, "comment_id": 64681640, "body": "I&#39;m really confused now. <code>evalState</code> expects a <code>StateT</code> as its first argument not a <code>ProgramState</code>. Did you mean <code>evalState restOfProgram programState </code>? There really isn&#39;t enough information to help you at the moment."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469760316, "post_id": 38648935, "comment_id": 64681819, "body": "Yep I got the args backwards.  fixed"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1469761407, "post_id": 38648935, "comment_id": 64682030, "body": "Could you post <code>restOfProgram</code> then? That will almost certainly expose the problem."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1469779241, "creation_date": 1469779241, "answer_id": 38653526, "question_id": 38648935, "link": "https://stackoverflow.com/questions/38648935/how-to-asign-a-value-from-the-io-monad-to-a-rankntype-qualified-constructor/38653526#38653526", "title": "How to asign a value from the IO monad to a RankNType qualified constructor", "body": "<p>The issue here is that</p>\n\n<pre><code>pickStorageInterface :: forall a. IO (DataStore a -&gt; IO a)\n</code></pre>\n\n<p>while we would need the (impredicative) type </p>\n\n<pre><code>pickStorageInterface :: IO (forall a. DataStore a -&gt; IO a)\n</code></pre>\n\n<p>for the code above to work. Alas, the impredicative types are in a sad state now in GHC, and are best to be avoided.</p>\n\n<p>You can work around that using a <code>newtype</code> wrapper around the universally quantified type:</p>\n\n<pre><code>newtype SI = SI { runSI :: forall a. DataStore a -&gt; IO a }\n\npickStorageInterface :: IO SI\npickStorageInterface = do\n  opts &lt;- parseOptions\n  case (storage opts) of\n     MemoryStorage -&gt; \n       ms &lt;- readAssetsFromDisk \n       return $ SI $ runMemory ms\n     ...\n\nmain = do\n  si &lt;- pickStorageInterface\n  let programState = PS { storageInterface = runSI si}\n  ...\n</code></pre>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 38653526, "answer_count": 1, "score": 1, "last_activity_date": 1469779241, "creation_date": 1469753818, "last_edit_date": 1495541690, "question_id": 38648935, "link": "https://stackoverflow.com/questions/38648935/how-to-asign-a-value-from-the-io-monad-to-a-rankntype-qualified-constructor", "title": "How to asign a value from the IO monad to a RankNType qualified constructor", "body": "<p><strong>(UPDATED)</strong></p>\n\n<p>I have made an interface using a <a href=\"https://stackoverflow.com/a/23767740/163177\">Free Monad</a> to a generic data store. I want to place the specific interpreter (:: DataStore a -> IO a) chosen by the user at run time into a state monad along with some other information.  I cannot seem to put anything into this field in the data structure.</p>\n\n<p>How do I put a value into a field defined as a higher rank type?</p>\n\n<p>Below is a minimum example:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, DeriveFunctor #-}\n\ndata ProgramState = PS { -- line 3\n    [...]\n  , storageInterface :: (forall a. DataStore a -&gt; IO a)\n  }\n\ndata DataStoreF next = \n     Create    Asset                           ( String -&gt; next)\n  |  Read      String                          ( Asset  -&gt; next)\n  |  Update    Asset                           ( Bool   -&gt; next)\n  |  UpdateAll [Asset]                         ( Bool   -&gt; next)\n  |  [...]\n  deriving Functor\n\ntype DataStore = Free DataStoreF\n\nrunMemory :: (IORef (Map String Asset)) -&gt; DataStore a -&gt; IO a\nrunMemory ms (Pure a) = return a\nrunMemory ms (Free Create asset next) = [...]\nrunMemory ms (Free Read   str   next) = [...]\n[...]\n\npickStorageInterface :: IO (DataStore a -&gt; IO a)\npickStorageInterface = do\n  opts &lt;- parseOptions\n  case (storage opts) of\n     MemoryStorage -&gt; \n       ms &lt;- readAssetsFromDisk \n       return $ runMemory ms\n     SomeOtherStorage -&gt; [...]\n\nrestOfProgram :: StateT ProgramState IO\nrestOfProgram = [...]\n\nmain = do\n  si &lt;- pickStorageInterface\n  let programState = PS { storageInterface = si} -- line 21\n  evalState restOfProgram programState\n</code></pre>\n\n<p>When I try to do this GHC complains that:</p>\n\n<pre><code>Main.hs: &lt;&lt; Line 21 &gt;&gt;\nCouldn't match type `a0' with `a'\n  because type variable `a' would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a type expected by the context: DataStore a -&gt; IO a\n  at Main.hs &lt;&lt;line 3&gt;&gt;\nExpected type: DataStore a -&gt; IO a\n  Actual type: DataStore a0 -&gt; IO a0\nIn the `storageInterface' field of a record\n  [...]\n</code></pre>\n\n<hr>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My original minimal example was to minimal.  Some further experimentation shows that the problem arises when I need to load the interface in an the IO monad so I can read the command line options.  I've updated the example to include that issue.  Knowing this I may be able to code around it.</p>\n\n<p>Interesting GHCI tells me that the results of a function of type <code>IO (DataStore a -&gt; IO a)</code> is <code>DataStore GHC.Prim.Any -&gt; IO GHC.Prim.Any</code> which is not what I expected.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469742171, "post_id": 38647199, "comment_id": 64677041, "body": "You could use <code>zipWith</code> for this, which would eliminate the need to convert to tuples first."}, {"owner": {"reputation": 21, "user_id": 4390575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e59b7d4b092462954c2b967e606ee5ec?s=128&d=identicon&r=PG&f=1", "display_name": "pscheid", "link": "https://stackoverflow.com/users/4390575/pscheid"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1469742722, "post_id": 38647199, "comment_id": 64677304, "body": "Thanks, thats what I needed.  <code>zipWith (&#47;) (tail a) a</code>"}], "owner": {"reputation": 21, "user_id": 4390575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e59b7d4b092462954c2b967e606ee5ec?s=128&d=identicon&r=PG&f=1", "display_name": "pscheid", "link": "https://stackoverflow.com/users/4390575/pscheid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "closed_date": 1469764157, "answer_count": 0, "score": 2, "last_activity_date": 1469742075, "creation_date": 1469742075, "question_id": 38647199, "link": "https://stackoverflow.com/questions/38647199/how-to-divide-adjacent-items-in-a-list-in-haskell", "closed_reason": "Duplicate", "title": "How to divide adjacent items in a list in Haskell?", "body": "<p>I have a list of integers, and I would like to divide the i+1 element by the i element, creating a new list. How can I do this?</p>\n\n<p>The only way I could think of doing it is to zip together adjacent elements into tuples, and then divide them.</p>\n\n<pre><code>adj xs = zip xs $ tail xs\n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 438, "user_id": 1454504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bb016958c00fc855280e1f7b5339553?s=128&d=identicon&r=PG&f=1", "display_name": "Josselin Poiret", "link": "https://stackoverflow.com/users/1454504/josselin-poiret"}, "edited": false, "score": 0, "creation_date": 1469735374, "post_id": 38645449, "comment_id": 64673803, "body": "You want to be able to restrict class instances to types themselves an instance of Eq?"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 438, "user_id": 1454504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bb016958c00fc855280e1f7b5339553?s=128&d=identicon&r=PG&f=1", "display_name": "Josselin Poiret", "link": "https://stackoverflow.com/users/1454504/josselin-poiret"}, "edited": false, "score": 0, "creation_date": 1469735463, "post_id": 38645449, "comment_id": 64673851, "body": "Yes, to be able to restrict B a -type instances to types that are themselves an instances of Eq."}], "answers": [{"comments": [{"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1469735902, "post_id": 38645543, "comment_id": 64674085, "body": "Kudos, now it seems so clear (I&#39;m taking my first steps with type families)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1469735501, "creation_date": 1469735501, "answer_id": 38645543, "question_id": 38645449, "link": "https://stackoverflow.com/questions/38645449/type-families-and-deriving-instances-eq/38645543#38645543", "title": "type families and deriving instances (Eq)", "body": "<p>I think this does the trick...</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\n\nclass Eq (B a) =&gt; A a where\n  type B a \n  somef :: a -&gt; B a -&gt; B a -&gt; Bool\n</code></pre>\n\n<hr>\n\n<p>As verification that it works, the following instance is accepted</p>\n\n<pre><code>data HasEqInstance = HasEqInstance deriving Eq\ninstance A () where\n  type B () = HasEqInstance\n  somef = undefined\n</code></pre>\n\n<p>But this one is rejected with <code>No instance for (Eq NoEqInstance)</code></p>\n\n<pre><code>data NoEqInstance = NoEqInstance\ninstance A () where\n  type B () = NoEqInstance\n  somef = undefined\n</code></pre>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 38645543, "answer_count": 1, "score": 1, "last_activity_date": 1469736159, "creation_date": 1469735224, "last_edit_date": 1495535325, "question_id": 38645449, "link": "https://stackoverflow.com/questions/38645449/type-families-and-deriving-instances-eq", "title": "type families and deriving instances (Eq)", "body": "<p>Is it possible to derive Eq instance for the <code>B a</code>, if given additional help, e.g. <code>Eq a</code> somewhere?</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass A a where\n  type B a \n  somef :: a -&gt; B a -&gt; B a -&gt; Bool\n</code></pre>\n\n<p>Question <a href=\"https://stackoverflow.com/questions/13144740/deriving-instances-with-typefamilies\">deriving instances with type families</a> and <a href=\"https://stackoverflow.com/questions/10491521/haskell-instance-definitions-for-type-families?rq=1\">instance definitions for type families</a> are close. \nThe following don't work nor similar modifications on <code>type B a</code> -line (or just tried the wrong ones). </p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving #-}\n-- deriving instance Eq (B a) -- illegal application\n-- deriving instance Eq a =&gt; Eq (B a) -- illegal application\n</code></pre>\n\n<p>Constraining <code>Eq a =&gt; A a</code> didn't help. Adding constraint to <code>somef</code> compiles (<code>somef :: Eq a =&gt; ...</code>) and works for this method. However, in this case it would be nice to be able to tell that the <code>type B a</code> is equatable in general (such that non-equatable B a's would not be allowed) and not method-by-method.</p>\n"}, {"tags": ["haskell", "persistent", "quickcheck"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469733040, "post_id": 38644779, "comment_id": 64672659, "body": "Can you give an example of one of your quickcheck properties?"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1469733533, "post_id": 38644779, "comment_id": 64672913, "body": "Don&#39;t you just want to use <code>withSqlitePool</code> outside of the call to <code>monadicIO</code>? E.g., <code>tests = withSqlitePool $ \\pool -&gt; do monadicIO (test1 pool); monadicIO (test2 pool)</code>."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1469735088, "post_id": 38644779, "comment_id": 64673666, "body": "We use a SQLite connection to <code>:memory:</code> (I think that&#39;s more or less just an in-memory SQLite database). It seems to work well enough, certainly enough to never be a bottleneck, but perhaps you are moving more data around than we are. The slow arduous thing you <i>could</i> do is create your own instance of <code>PersistStore</code> and implement it with (for example) a bunch of <code>Data.Map</code>s. But that absolutely prevents you from using anything in <code>Database.Persist.Sql</code>, in which case you would need to spend an arm and a leg to construct a <code>SqlBackend</code> value."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1469760001, "post_id": 38644779, "comment_id": 64681737, "body": "Added the pseuso code for a test. On the mobile right now, will add the actual code from my laptop."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 1, "creation_date": 1469760164, "post_id": 38644779, "comment_id": 64681777, "body": "Basically what I&#39;m looking for is an efficient boilerplate that sets up the DB once, maintains a single connection pool, and clears out the DB between tests/properties."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1469968708, "post_id": 38644779, "comment_id": 64747173, "body": "@RowanBlush I am unable to make it compose even if I pass around the <code>ConnectionPool</code> manually. Can you help me with some PoC code? I&#39;m fine even if it type-checks (I&#39;ll tackle the elegance later)."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469968780, "post_id": 38644779, "comment_id": 64747195, "body": "What test framework do you use to run your QuickCheck tests?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469969019, "post_id": 38644779, "comment_id": 64747257, "body": "@bennofs nothing, right now. I don&#39;t even know if a batteries-included testing framework is available. I&#39;m stuck at a very basic level right now -- trying to get the QuickCheck and Persistent types to compose."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469972468, "post_id": 38644779, "comment_id": 64748318, "body": "How do you even clear out the DB with persistent?"}], "answers": [{"comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1469976620, "post_id": 38684717, "comment_id": 64749562, "body": "<a href=\"http://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck-Property.html#v:ioProperty\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/QuickCheck-2.9.1/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 4, "last_activity_date": 1469981238, "last_edit_date": 1469981238, "creation_date": 1469973645, "answer_id": 38684717, "question_id": 38644779, "link": "https://stackoverflow.com/questions/38644779/how-to-use-quickcheck-to-test-database-related-functions/38684717#38684717", "title": "How to use QuickCheck to test database related functions?", "body": "<p>To avoid creating and destroying the DB pool and only set up the DB once, you need to use <code>withSqliteConn</code> in your <code>main</code> function on the outside and then transform each property to use that connection, like in this code:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    deriving Show Eq\n|]\n\ntype SqlT m = SqlPersistT (NoLoggingT (ResourceT m))\n\nprop_insert_person :: PropertyM (SqlT IO) ()\nprop_insert_person = do\n  personName &lt;- pick arbitrary\n  personAge  &lt;- pick arbitrary\n  let person = Person personName personAge\n\n  -- This assertion will fail right now on the second iteration\n  -- since I have not implemented the cleanup code\n  numEntries &lt;- run $ count ([] :: [Filter Person])\n  assert (numEntries == 0)\n\n  personId &lt;- run $ insert person\n  result &lt;- run $ get personId\n  assert (result == Just person)\n\nmain :: IO ()\nmain = runNoLoggingT $ withSqliteConn \":memory:\" $ \\connection -&gt; lift $ do\n  let \n    -- Run a SqlT action using our connection\n    runSql :: SqlT IO a -&gt; IO a\n    runSql =  flip runSqlPersistM connection\n\n    runSqlProperty :: SqlT IO Property -&gt; Property\n    runSqlProperty action = ioProperty . runSql $ do\n        prop &lt;- action\n        liftIO $ putStrLn \"\\nDB reset code (per test) goes here\\n\"\n        return prop\n\n    quickCheckSql :: PropertyM (SqlT IO) () -&gt; IO ()\n    quickCheckSql = quickCheck . monadic runSqlProperty\n\n  -- Initial DB setup code\n  runSql $ runMigration migrateAll\n\n  -- Test as many quickcheck properties as you like\n  quickCheckSql prop_insert_person\n</code></pre>\n\n<p>The full code including imports and extensions can be found <a href=\"https://gist.github.com/bdf989980452569f9098feeb6751ba83\" rel=\"nofollow\">in this gist</a>.</p>\n\n<p>Note that I did not implement the functionality to clean the database between tests, as I do not know how to do that in general with persistent, you will have to implement that yourself (replace the placeholder cleanup action that just prints a message right now). </p>\n\n<hr>\n\n<p>You should also not need instances for <code>MonadCatch</code> / <code>MonadThrow</code> for <code>PropertyM</code>. Instead, you should catch in the <code>NwApp</code> monad. So instead of this:</p>\n\n<pre><code>let test = do\n  run a\n  ...\n  run b\ntest `catch` \\exc -&gt; ...\n</code></pre>\n\n<p>you should use the following code instead:</p>\n\n<pre><code>let test = do\n  a\n  b\n  return ...whether or not the test was successfull...\nlet testCaught = test `catch` \\exc -&gt; ..handler code...\nok &lt;- test\nassert ok\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469977779, "post_id": 38684891, "comment_id": 64749877, "body": "I don&#39;t think this answer is correct, there are multiple mistakes here:  1) <code>runSqlite</code> will be executed on every test (perhaps even every <code>run</code>?), so the requirement &quot;set up the DB only once&quot; from the question is not satisfied 2) by throwing away the <code>Property</code> in <code>IO Property</code>, you are essentially throwing away test case itself"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469978411, "post_id": 38684891, "comment_id": 64750055, "body": "&quot;Important: Forget about efficiency or elegance. I haven&#39;t been able to make the QuickCheck and Persistent types to even compose.&quot; made it sound like making it typecheck is okay as a first step. But yes, after seeing and inserting commentary about the insufficiencies I thought Id just run with it and see if its instructional. But then I thought this&#39;d remain the only answer for a while."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1469974620, "creation_date": 1469974620, "answer_id": 38684891, "question_id": 38644779, "link": "https://stackoverflow.com/questions/38644779/how-to-use-quickcheck-to-test-database-related-functions/38684891#38684891", "title": "How to use QuickCheck to test database related functions?", "body": "<pre><code>monadicIO :: PropertyM IO a -&gt; Property\nrunSqlite \":memory:\" :: SqlPersistT (NoLoggingT (ResourceT m)) a -&gt; m a\nprop_childCreation :: PropertyM NwApp Bool\n</code></pre>\n\n<p>These won't compose. One of these doesn't belong.</p>\n\n<pre><code>monadic :: Monad m =&gt; (m Property -&gt; Property) -&gt; PropertyM m a -&gt; Property\n</code></pre>\n\n<p>This looks better than <code>monadicIO</code>: We can combine this and our requirement to use prop_childCreation into a requirement to produce (m Property -> Property).</p>\n\n<pre><code>runSqlite \":memory:\" :: SqlPersistT (NoLoggingT (ResourceT m)) a -&gt; m a\n\\f -&gt; monadic f prop_childCreation :: (NwApp Property -&gt; Property) -&gt; Property\n</code></pre>\n\n<p>Rewrite NwApp to ease the looking up:</p>\n\n<pre><code>runSqlite \":memory:\" :: SqlPersistT (NoLoggingT (ResourceT m)) a -&gt; m a\n\\f -&gt; monadic f prop_childCreation :: (SqlPersistT IO Property -&gt; Property) -&gt; Property\n</code></pre>\n\n<p>I'll just trust that everything with <code>T</code> at the end is a <code>MonadTrans</code>, meaning we have <code>lift :: Monad m =&gt; m a -&gt; T m a</code>. Then we can see that this is our chance to get rid of SqlPersistT:</p>\n\n<pre><code>\\f g -&gt; monadic (f . runSqlite \":memory:\" . g) prop_childCreation :: (IO Property -&gt; Property) -&gt; (SqlPersistT IO Property -&gt; SqlPersistT (NoLoggingT (ResourceT m)) Property) -&gt; Property\n</code></pre>\n\n<p>We'll need to get rid of the IO somewhere again, so monadicIO might help us:</p>\n\n<pre><code>\\f g -&gt; monadic (monadicIO . f . runSqlite \":memory:\" . g) prop_childCreation :: (IO Property -&gt; PropertyT IO a) -&gt; (SqlPersistT IO Property -&gt; SqlPersistT (NoLoggingT (ResourceT m)) Property) -&gt; Property\n</code></pre>\n\n<p>Time for lift to shine! Except that in f we apparently throw the <code>Property</code> in <code>IO Property</code> away, and on the right we need to \"fmap\" into the monad argument part of SqlPersistT somehow. Well, we can ignore the first problem and defer the other to the next step:</p>\n\n<pre><code>\\f -&gt; monadic (monadicIO . lift . runSqlite \":memory:\" . f (lift . lift)) prop_childCreation :: ((m a -&gt; n a) -&gt; SqlPersistT m a -&gt; SqlPersist n a) -&gt; Property\n</code></pre>\n\n<p>Turns out this looks just like what <code>Control.Monad.Morph</code>'s <code>MFunctor</code> provides. I'll just pretend SqlPersistT had an instance of that:</p>\n\n<pre><code>monadic (monadicIO . lift . runSqlite \":memory:\" . mmorph (lift . lift)) prop_childCreation :: Property\n</code></pre>\n\n<p><a href=\"https://www.youtube.com/watch?v=XCPj4JPbKtA\" rel=\"nofollow\">Tada!</a> Good luck in your quest, maybe this'll help a little.</p>\n\n<p>The <a href=\"https://github.com/lspitzner/exference\" rel=\"nofollow\">exference</a> project attempts to automate the process I just walked through. I've heard that putting _ whereever I put arguments like f and g will make ghc tell you what type should go there.</p>\n"}, {"comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469978318, "post_id": 38685064, "comment_id": 64750032, "body": "You can use <code>PropertyM m</code> even if <code>m</code> is not <code>IO</code>, by providing a function <code>m a -&gt; IO a</code>. See my answer"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1469978940, "post_id": 38685064, "comment_id": 64750218, "body": "Yes - <code>ioProperty</code> was the function I was missing."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1469986290, "last_edit_date": 1469986290, "creation_date": 1469975886, "answer_id": 38685064, "question_id": 38644779, "link": "https://stackoverflow.com/questions/38644779/how-to-use-quickcheck-to-test-database-related-functions/38685064#38685064", "title": "How to use QuickCheck to test database related functions?", "body": "<p>( .lhs available at: <a href=\"http://lpaste.net/173182\" rel=\"nofollow\">http://lpaste.net/173182</a> )</p>\n\n<p>Packages used:</p>\n\n<pre><code>build-depends: base &gt;= 4.7 &amp;&amp; &lt; 5, QuickCheck, persistent, persistent-sqlite, monad-logger, transformers\n</code></pre>\n\n<p>First, some imports:</p>\n\n<pre><code> {-# LANGUAGE OverloadedStrings #-}\n\n module Lib2 where\n\n import Database.Persist.Sql\n import Database.Persist.Sqlite\n import Test.QuickCheck\n import Test.QuickCheck.Monadic\n import Control.Monad.Logger\n import Control.Monad.Trans.Class\n</code></pre>\n\n<p>Here is the query we want to test:</p>\n\n<pre><code> aQuery :: SqlPersistM Int\n aQuery = undefined\n</code></pre>\n\n<p>Of course, <code>aQuery</code> may take arguments. The important thing is that\nit returns a <code>SqlPersistM</code> action.</p>\n\n<p>Here is how you can run a <code>SqlPersistM</code> action:</p>\n\n<pre><code> runQuery = runSqlite \":memory:\" $ do aQuery\n</code></pre>\n\n<p>Even though <code>PropertyM</code> is a monad transformer, it appears that the only\nuseful way to use it is with <code>PropertyM IO</code>.</p>\n\n<p>In order to get an IO-action out of a SqlPersistM-action, we need the\nbackend.</p>\n\n<p>With these in mind, here is an example database test:</p>\n\n<pre><code> prop_test :: SqlBackend -&gt; PropertyM IO Bool\n prop_test backend = do\n   a &lt;- run $ runSqlPersistM aQuery backend\n   b &lt;- run $ runSqlPersistM aQuery backend\n   return (a == b)\n</code></pre>\n\n<p>Here <code>run</code> is the same as <code>lift</code>.</p>\n\n<p>To run an SqlPersistM action with a specific backend, we need\nto perform some lifting:</p>\n\n<pre><code> runQuery2 = withSqliteConn \":memory:\" $ \\backend -&gt; do\n               liftNoLogging (runSqlPersistM aQuery backend)\n\n liftNoLogging :: Monad m =&gt; m a -&gt; NoLoggingT m a\n liftNoLogging = lift\n</code></pre>\n\n<p>Explanation:</p>\n\n<ul>\n<li><code>runSqlPersistM aQuery backend</code> is an IO-action</li>\n<li>but <code>withSqliteConn ...</code> requires a monadic action that has logging</li>\n<li>so we lift the IO-action to a NoLoggingT IO-action with the <code>liftNoLogging</code> function</li>\n</ul>\n\n<p>Finally, to run prop_test via quickCheck:</p>\n\n<pre><code> runTest = withSqliteConn \":memory:\" $ \\backend -&gt; do\n             liftNoLogging $ quickCheck (monadicIO (prop_test backend))\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 2, "accepted_answer_id": 38684717, "answer_count": 3, "score": 6, "last_activity_date": 1469986290, "creation_date": 1469732720, "last_edit_date": 1469969128, "question_id": 38644779, "link": "https://stackoverflow.com/questions/38644779/how-to-use-quickcheck-to-test-database-related-functions", "title": "How to use QuickCheck to test database related functions?", "body": "<p>I need to test a lot of functions that access the database (via Persistent). While I can do this using <code>monadicIO</code> and <code>withSqlitePool</code> it will result in inefficient tests. Each test, not property, but test, will create and destroy the DB pool. How do I prevent this?</p>\n\n<p><strong>Important:</strong> Forget about efficiency or elegance. I haven't been able to make the <code>QuickCheck</code> and <code>Persistent</code> types to even compose. </p>\n\n<pre><code>instance (Monad a) =&gt; MonadThrow (PropertyM a)\n\ninstance (MonadThrow a) =&gt; MonadCatch (PropertyM a)\n\ntype NwApp = SqlPersistT IO\n\nprop_childCreation :: PropertyM NwApp Bool\nprop_childCreation = do\n  uid &lt;- pick $ UserKey &lt;$&gt; arbitrary\n  lid &lt;- pick $ LogKey &lt;$&gt; arbitrary\n  gid &lt;- pick $ Aria2Gid &lt;$&gt; arbitrary\n  let createDownload_  = createDownload gid lid uid []\n  (Entity pid _) &lt;- run $ createDownload_ Nothing\n  dstatus &lt;- pick arbitrary\n  parent &lt;- run $ updateGet pid [DownloadStatus =. dstatus]\n\n  let test = do \n        (Entity cid child) &lt;- run $ createDownload_ (Just pid)\n        case (parent ^. status, child ^. status) of\n          (DownloadComplete ChildrenComplete, DownloadComplete ChildrenNone) -&gt; return True\n          (DownloadComplete ChildrenIncomplete, DownloadIncomplete) -&gt; return True\n          _ -&gt; return False\n\n  test `catches` [\n    Handler (\\ (e :: SanityException) -&gt; return True),\n    Handler (\\ (e :: SomeException) -&gt; return False)\n    ]\n\n-- How do I write this function?\nrunTests = monadicIO $ runSqlite \":memory:\" $ do \n -- whatever I do, this function fails to typecheck\n</code></pre>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469741675, "post_id": 38643890, "comment_id": 64676838, "body": "FYI, that&#39;s a <i>terribly inefficient</i> definition of <code>tails</code>. It would make at least somewhat more sense to define <code>inits</code> in terms of <code>tails</code>, although that wouldn&#39;t be great either. <code>tails</code>, implemented properly, is inherently much more efficient than <code>inits</code>: <code>O(n)</code> rather than <code>O(n^2)</code>."}, {"owner": {"reputation": 518, "user_id": 3605831, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/5928Q.png?s=128&g=1", "display_name": "markvdlaan93", "link": "https://stackoverflow.com/users/3605831/markvdlaan93"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1469741750, "post_id": 38643890, "comment_id": 64676869, "body": "I already noted that it was from some lecture slides so the point was to illustrate some new concept. Efficiency doesn&#39;t play any role here."}], "answers": [{"comments": [{"owner": {"reputation": 518, "user_id": 3605831, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/5928Q.png?s=128&g=1", "display_name": "markvdlaan93", "link": "https://stackoverflow.com/users/3605831/markvdlaan93"}, "edited": false, "score": 0, "creation_date": 1469730382, "post_id": 38643928, "comment_id": 64671195, "body": "I&#39;m starting to understand it a little bit. I&#39;m trying to determine why tails will result in [a] -&gt; [[a]]. Starting with reverse (at the end because of .), it needs [a] -&gt; [a], after that inits need [a] -&gt; [[a]] which is valid because the output of reverse is [a]. After that I&#39;m stuck since map needs a function (reverse again) but also [a] while [[a]] is given as output by inits. How does that work?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1469732836, "post_id": 38643928, "comment_id": 64672571, "body": "<code>map</code> doesn&#39;t <i>require</i> an <code>[a]</code>; because of currying, <code>map</code> is a function that takes an <code>a -&gt; b</code> and returns a function of type <code>[a] -&gt; [b]</code>. <code>map f list</code> is really two function applications; <code>map f</code> produces a function, and that function is applied to <code>list</code>. (Function application is left-associative, so <code>map f list</code> is equivalent to <code>(map f) list</code>.)"}], "tags": [], "owner": {"reputation": 205730, "user_id": 15055, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7f71287b47b7189d11fe6d3fbc7ed2fe?s=128&d=identicon&r=PG", "display_name": "Claudiu", "link": "https://stackoverflow.com/users/15055/claudiu"}, "is_accepted": true, "score": 3, "last_activity_date": 1469729764, "creation_date": 1469729764, "answer_id": 38643928, "question_id": 38643890, "link": "https://stackoverflow.com/questions/38643890/why-isnt-it-necessary-to-provide-a-parameter-in-this-function/38643928#38643928", "title": "Why isn&#39;t it necessary to provide a parameter in this function?", "body": "<p>The parameter is implicit. Or to put it differently, <code>reverse . map reverse . inits . reverse</code> evaluates to a function of type <code>[a] -&gt; [[a]]</code>.</p>\n\n<p>Consider a simpler example:</p>\n\n<pre><code>double_impl x = x * 2\ndouble = double_impl\n</code></pre>\n\n<p>The type of <code>double</code> here is the same type as <code>double_impl</code>, i.e. it takes one parameter of typeclass <code>Num</code>:</p>\n\n<pre><code>main = do \n  print $ double_impl 5\n  print $ double 5\n\n-- Out: 10\n-- Out: 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 698, "user_id": 981405, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7de874a683e805c5c45bfce7c985522d?s=128&d=identicon&r=PG", "display_name": "jgon", "link": "https://stackoverflow.com/users/981405/jgon"}, "is_accepted": false, "score": 2, "last_activity_date": 1469732532, "creation_date": 1469732532, "answer_id": 38644719, "question_id": 38643890, "link": "https://stackoverflow.com/questions/38643890/why-isnt-it-necessary-to-provide-a-parameter-in-this-function/38644719#38644719", "title": "Why isn&#39;t it necessary to provide a parameter in this function?", "body": "<p>We can see that <code>tails</code> is a function, by checking it's type. </p>\n\n<p>To compute its type, we begin by writing down the types of all the intermediate functions in the composition. Note that we use new type variables for each ocurrence of a function.</p>\n\n<pre><code>reverse :: [a] -&gt; [a]\ninits :: [b] -&gt; [[b]]\nmap :: (c -&gt; d) -&gt; [c] -&gt; [d]\n</code></pre>\n\n<p>Now we have <code>map reverse</code> has type <code>[[e]] -&gt; [[e]]</code> since we get <code>c=d=[e]</code> for some type <code>e</code> from comparing the expressions</p>\n\n<pre><code>reverse :: c -&gt; d  -- for some c and d\nreverse :: [e] -&gt; [e] -- for some e\n</code></pre>\n\n<p>Hence the last two intermediates have types</p>\n\n<pre><code>map reverse :: [[e]] -&gt; [[e]]\nreverse :: [f] -&gt; [f]\n</code></pre>\n\n<p>Now we start trying to match up types. Let me emphasize first that obviously THESE ARE NOT REAL TYPES! (sorry for the all caps, but I don't want anyone to miss that.)</p>\n\n<pre><code>inits . reverse :: [a] -*- [a] = [b] -*&gt; [[b]]\n-- I'm using a -*- b -*&gt; c to denote the type a -&gt; c obtained by\n-- composing a function of type a -&gt; b with one of type b -&gt; c.\n-- The *s are to break the double dashes up,\n-- so they aren't parsed as a comment.\n-- Anyway, looking at this type, we see\n-- we must have [a] = [b], so a = b\n-- we can rewrite the type of inits . reverse as\ninits . reverse :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>Then for the next composition:</p>\n\n<pre><code>map reverse . inits . reverse :: [a] -*- [[a]] = [[e]] -*&gt; [[e]]\n-- again, we have [[a]] = [[e]], so e = a, and we have\nmap reverse . inits . reverse :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>Finally, we have</p>\n\n<pre><code>reverse . map reverse . inits . reverse :: [a] -*- [[a]] = [f] -*&gt; [f]\n-- This time we have [[a]] = [f], so we must have f = [a], so the type\n-- of the final composition is\ntails = reverse . map reverse . inits . reverse :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>Since <code>tails</code> has the type <code>[a] -&gt; [[a]]</code>, it must be a function that accepts a list of <code>a</code>s as it's argument and returns a list of lists of <code>a</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1469734118, "last_edit_date": 1469734118, "creation_date": 1469733636, "answer_id": 38645036, "question_id": 38643890, "link": "https://stackoverflow.com/questions/38643890/why-isnt-it-necessary-to-provide-a-parameter-in-this-function/38645036#38645036", "title": "Why isn&#39;t it necessary to provide a parameter in this function?", "body": "<p>This is called point-free style (where \"point\" is a mathematical term that basically means \"argument\" here).</p>\n\n<p>Even <code>tails xs = ...</code> is just syntactic sugar for <code>tails = \\xs -&gt; ...</code>, so all you need to do to convince yourself that <code>tails</code> is a function is to recognize that </p>\n\n<ol>\n<li><p><code>reverse</code>, <code>map reverse</code>, and <code>inits</code> are all functions:</p>\n\n<ul>\n<li><p><code>map</code> is a higher-order function; it takes one function as an argument and returns another function.</p></li>\n<li><p><code>map reverse</code> is a function because <code>map</code> is applied to the function <code>reverse</code>.</p></li>\n</ul></li>\n<li>The composition of two functions is another function (assume that the types match up so that we can focus on the result of each composition, instead of verify that each composition type-checks.)</li>\n</ol>\n\n<p>Thus </p>\n\n<ul>\n<li><code>reverse . map reverse</code> is a function,</li>\n<li>so <code>reverse . map reverse . inits</code> is a function,</li>\n<li>and <code>reverse . map reverse . inits . reverse</code> is a function.</li>\n</ul>\n\n<p>Since <code>tails</code> is assigned the value of <code>reverse . map reverse . inits . reverse</code>, <code>tails</code> itself is also a function.</p>\n"}], "owner": {"reputation": 518, "user_id": 3605831, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/5928Q.png?s=128&g=1", "display_name": "markvdlaan93", "link": "https://stackoverflow.com/users/3605831/markvdlaan93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 38643928, "answer_count": 3, "score": 1, "last_activity_date": 1469759783, "creation_date": 1469729631, "last_edit_date": 1469759783, "question_id": 38643890, "link": "https://stackoverflow.com/questions/38643890/why-isnt-it-necessary-to-provide-a-parameter-in-this-function", "title": "Why isn&#39;t it necessary to provide a parameter in this function?", "body": "<p>I'm fairly new to Haskell and this week I found this particular function in a couple of lecture slides. I'm trying to understand why the following function doesn't need to include a parameter:</p>\n\n<pre><code>-- Return all final segments of the argument, longest first \n-- (horrible runtime complexity, used here for illustration purposes only)\ntails :: [a] -&gt; [[a]]\ntails = reverse . map reverse . inits . reverse\n</code></pre>\n\n<p>If I would call it like <code>tails \"thisisastring\"</code> then this would be a valid argument. Isn't it necessary to provide a parameter, for example <code>tails xs = ...</code>. All the other functions I seen before were in that fashion.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1469741140, "post_id": 38643561, "comment_id": 64676628, "body": "Completely sidestepping the syntax issues: since <code>(lcm, 1)</code> forms a monoid over the natural numbers, you should consider <code>multLCM = foldr lcm 1</code>."}, {"owner": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1552794705, "post_id": 38643561, "comment_id": 97144207, "body": "@DanielWagner wow! that is just beautiful (sorry i&#39;m reacting to this 3 years late)"}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "edited": false, "score": 0, "creation_date": 1469730552, "post_id": 38643811, "comment_id": 64671276, "body": "I&#39;m not sure how to complete your answer. I don&#39;t want my <code>multiLCM</code> to be defined for single element lists and want it to be just the usual <code>lcm</code> for two element lists. Can pattern matching be done in this case? Something like <code>x:y:xs</code> maybe?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "edited": false, "score": 1, "creation_date": 1469730892, "post_id": 38643811, "comment_id": 64671465, "body": "Why? I can&#39;t think of any good reason not to define multiLCM for a single element list."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1469729353, "creation_date": 1469729353, "answer_id": 38643811, "question_id": 38643561, "link": "https://stackoverflow.com/questions/38643561/recursive-implementation-of-lcm-in-haskell/38643811#38643811", "title": "Recursive implementation of LCM in Haskell", "body": "<p>You should use pattern matching to deconstruct the list:</p>\n\n<pre><code>multiLCM (x:xs) = lcm x (multiLCM xs)\nmultiLCM [x]    = ???\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "edited": false, "score": 0, "creation_date": 1469730387, "post_id": 38644042, "comment_id": 64671199, "body": "Can you please let me know when I can use <code>$</code> and <code>.</code> in place of parentheses? I always found that confusing"}, {"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "edited": false, "score": 0, "creation_date": 1469731410, "post_id": 38644042, "comment_id": 64671767, "body": "@KoundinyaVajjha Have you seen <a href=\"http://stackoverflow.com/questions/940382/haskell-difference-between-dot-and-dollar-sign#1290727\">this answer</a>?"}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": true, "score": 2, "last_activity_date": 1469731562, "last_edit_date": 1469731562, "creation_date": 1469730176, "answer_id": 38644042, "question_id": 38643561, "link": "https://stackoverflow.com/questions/38643561/recursive-implementation-of-lcm-in-haskell/38644042#38644042", "title": "Recursive implementation of LCM in Haskell", "body": "<p>Parentheses do not denote function application in Haskell. E.g., these are equivalent.</p>\n\n<pre><code>lcm head(xs) last(xs)\nlcm head xs  last xs\n</code></pre>\n\n<p>That is, the function <code>lcm</code> provided the arguments <code>head</code>, <code>xs</code>, <code>last</code>, and <code>xs</code>.</p>\n\n<p>Parentheses <em>do</em> allow you to specify function application <em>by grouping a function with its arguments</em>.</p>\n\n<pre><code>lcm (head xs) (last xs)\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 6191593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IeoyQ.jpg?s=128&g=1", "display_name": "Koundinya Vajjha", "link": "https://stackoverflow.com/users/6191593/koundinya-vajjha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 38644042, "answer_count": 2, "score": 0, "last_activity_date": 1469731562, "creation_date": 1469728586, "last_edit_date": 1469729250, "question_id": 38643561, "link": "https://stackoverflow.com/questions/38643561/recursive-implementation-of-lcm-in-haskell", "title": "Recursive implementation of LCM in Haskell", "body": "<p>I'm trying to write my own multiple LCM function in Haskell, one that computes the LCM of all the elements in a given list. I'm trying to use the property lcm(a,b,c) = lcm(a,lcm(b,c)) to make it recursive. Here is what I could come up with so far, but it is giving me errors which I'm not able to understand. </p>\n\n<pre><code> multLCM xs \n    | length(xs) == 2 = lcm head(xs) last(xs)\n    | length(xs) &gt; 2 = lcm head(xs) multLCM(drop 1 xs)\n</code></pre>\n\n<p>Can someone help me improve this function so that it works? </p>\n\n<p>Thanks a lot! </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1469734117, "post_id": 38643650, "comment_id": 64673187, "body": "Excellent question! The answer doesn&#39;t immediately occur to me. I&#39;ll have to sit and have a think, maybe work it out with a pencil."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1469747181, "post_id": 38643650, "comment_id": 64678725, "body": "@phadej <code>Zip</code> looks <a href=\"http://stackoverflow.com/questions/36474647/haskell-depth-for-each-node-in-binary-tree-using-reader-monad/36480067#36480067\">a lot like <code>Applicative</code></a> to me"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475159356, "post_id": 38643650, "comment_id": 66840460, "body": "@BenjaminHodgson the <code>Zip</code> and <code>Applicative</code> for list do extremely different things. I proposed a laws to narrow done <code>Zip</code> implementatons: <a href=\"https://github.com/ekmett/keys/pull/15\" rel=\"nofollow noreferrer\">github.com/ekmett/keys/pull/15</a>"}], "tags": [], "owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "is_accepted": false, "score": 2, "last_activity_date": 1469728843, "creation_date": 1469728843, "answer_id": 38643650, "question_id": 38643494, "link": "https://stackoverflow.com/questions/38643494/the-relationship-between-data-key-and-control-lens-indexed/38643650#38643650", "title": "The relationship between Data.Key and Control.Lens.Indexed", "body": "<p>From the <code>keys</code> package readme\u2014</p>\n\n<blockquote>\n  <p>In practice this package is largely subsumed by the <code>lens</code> package, but it is maintained for now as it has much simpler dependencies.</p>\n</blockquote>\n"}], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469728843, "creation_date": 1469728367, "question_id": 38643494, "link": "https://stackoverflow.com/questions/38643494/the-relationship-between-data-key-and-control-lens-indexed", "title": "The relationship between Data.Key and Control.Lens.Indexed", "body": "<p>There are <a href=\"http://hackage.haskell.org/package/keys-3.11/docs/Data-Key.html#t:Keyed\" rel=\"nofollow\"><code>Keyed</code></a> and <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Indexed.html#t:FunctorWithIndex\" rel=\"nofollow\"><code>FunctorWithIndexed</code>  </a> classes in <code>keys</code> and lens` libraries respectively.</p>\n\n<p>Their member functions <code>mapWithKey</code> and <code>imap</code> seems to be similar, except that <code>keys</code> is formulated using type families, and <code>lens</code> uses functional dependencies.</p>\n\n<p>When one should prefer one or another? Why <code>lens</code> doesn't use <code>keys</code>, is it because of type-inference? Are there some interesting history of development? As a library writer, should I write variants for both <code>Keyed f</code> and <code>FunctorWithIndex i f</code> containers?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7335, "user_id": 232943, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1de6337421c1eac0227c88502b275952?s=128&d=identicon&r=PG", "display_name": "Delapouite", "link": "https://stackoverflow.com/users/232943/delapouite"}, "edited": false, "score": 0, "creation_date": 1469785988, "post_id": 38641568, "comment_id": 64692733, "body": "For pepole looking for the elm translation, this can be achieved with <code>List.filterMap identity</code>"}], "answers": [{"tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": false, "score": 3, "last_activity_date": 1469722216, "creation_date": 1469722216, "answer_id": 38641607, "question_id": 38641568, "link": "https://stackoverflow.com/questions/38641568/extracting-a-list-of-values-from-a-list-of-maybes-without-fromjust/38641607#38641607", "title": "Extracting a list of values from a list of maybes without fromJust", "body": "<pre><code>\u039b: :m + Data.Maybe\n\u039b: concatMap maybeToList [Just \"foo\", Just \"bar\", Nothing, Just \"quux\"]\n[\"foo\",\"bar\",\"quux\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 16, "last_activity_date": 1469722483, "creation_date": 1469722483, "answer_id": 38641701, "question_id": 38641568, "link": "https://stackoverflow.com/questions/38641568/extracting-a-list-of-values-from-a-list-of-maybes-without-fromjust/38641701#38641701", "title": "Extracting a list of values from a list of maybes without fromJust", "body": "<p>You can use <code>catMaybes</code>:</p>\n\n<pre><code>import Data.Maybe\ncatMaybes list\n</code></pre>\n"}], "owner": {"reputation": 7335, "user_id": 232943, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1de6337421c1eac0227c88502b275952?s=128&d=identicon&r=PG", "display_name": "Delapouite", "link": "https://stackoverflow.com/users/232943/delapouite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1175, "favorite_count": 0, "accepted_answer_id": 38641701, "answer_count": 2, "score": 7, "last_activity_date": 1469722483, "creation_date": 1469722088, "question_id": 38641568, "link": "https://stackoverflow.com/questions/38641568/extracting-a-list-of-values-from-a-list-of-maybes-without-fromjust", "title": "Extracting a list of values from a list of maybes without fromJust", "body": "<p>Input: <code>[Just \"foo\", Just \"bar\", Nothing, Just \"quux\"]</code></p>\n\n<p>Output: <code>[\"foo\", \"bar\", \"quux\"]</code></p>\n\n<p>I'm not satisfied with the following solution using <code>fromJust</code> because it's not very portable to <em>elm</em> which doesn't like unsafe functions:</p>\n\n<p><code>extract list = map fromJust $ filter isJust list</code></p>\n\n<p>Is there another concise / idiomatic way to achieve this?</p>\n"}, {"tags": ["haskell", "typeclass", "functional-dependencies", "type-families"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1469718498, "post_id": 38640052, "comment_id": 64663553, "body": "Type families generally perform much better than fundeps - especially when implementing type functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469718931, "post_id": 38640052, "comment_id": 64663866, "body": "There&#39;s also a matter of readability. The equivalent of <code>type F a = G (H (G a) (G a))</code> expressed through FunDeps requires several constraints, involving a few auxiliary type variables. When I read such constraints, I found myself to try to express them in a functional form. Perhaps this is because I&#39;m more used to read functional code than prolog."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469720706, "post_id": 38640052, "comment_id": 64665194, "body": "@ErikR Why is that? That seems incredibly strange because the examples where both options are viable look completely identical in terms of type resolution and what not to me. Is it just a flaw in the current implementation of either <code>FunctionalDependencies</code> or <code>MultiParamTypeClasses</code> or their interaction? Or is it something more fundamental? I am really hoping for the former as it would be nice to not have to use a different and seemingly more verbose syntax half the time for the same thing just for performance reasons."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469720888, "post_id": 38640052, "comment_id": 64665337, "body": "@chi would you mind going a little more in depth with what you mean there? I am a little confused because usually I see either <code>type F a</code> or <code>type F a :: *</code> with no <code>=</code> or I see <code>type F G = ...</code> with a concrete type immediately after <code>F</code>, why do you have a type variable after <code>F</code> AND an <code>=</code>. I am somewhat new to this stuff."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469722260, "post_id": 38640052, "comment_id": 64666333, "body": "@chi if you are talking about using <code>type</code> outside of <code>TypeFamilies</code> which seems like the only way to make your example work, then I don&#39;t see how anything is different between <code>TypeFamilies</code> and <code>FunctionalDependencies</code>, if there is any difference would it be alleviated by <code>TypeSynonymInstances</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469722973, "post_id": 38640052, "comment_id": 64666807, "body": "My example is indeed short, but assume you have type families <code>G,H</code> suitably defined. Then you can define <code>type family F a :: * ; type instance F a = G (H (G a) (G Bool))</code> -- or you could even do that through a type synonym (in this simple setting). Now, assume that <code>G,H</code> are instead typeclasses with fundeps: <code>class G a b | a -&gt; b ; instance ...</code>. How to achieve the same composition <code>F</code> does? You indeed can, but it is not very convienient nor readable, at least to me."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469726116, "post_id": 38640052, "comment_id": 64668681, "body": "@chi What would be the point of such an instance / family? Because the family cannot have any additional instances added to it, as <code>forall a. a</code> is the most polymorphic type possible, and you have already given an install for <code>forall a. a</code>. At that point why not just use <code>type F a = G (H (G a) (G Bool))</code> and use it directly whenever needed?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469736309, "post_id": 38640052, "comment_id": 64674287, "body": "My point is that I can use <code>type F a = G (H (G a) (G Bool))</code> if <code>G,H</code> are families, but not if they are classes with fundeps."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1469755075, "post_id": 38640052, "comment_id": 64680671, "body": "@chi Oohhh, ok thank you that makes a lot more sense. I&#39;m starting to see why <code>TypeFamilies</code> are more &quot;functional&quot; and thus more nestable / composable / flexible etc."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1470281885, "post_id": 38640052, "comment_id": 64888601, "body": "A challenge from #haskell yesterday: write a function to convert a list to an <code>HList</code> (existentially quantified). Addendum to the challenge: make sure you can convert it back. Now it may be possible to do this without type families, but I found <code>type family Replicate (n :: Nat) a :: [*]</code> very helpful."}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1469808072, "post_id": 38642039, "comment_id": 64707026, "body": "Ok I think I finally more or less get it. Am I correct in thinking that if all you are doing is specifying type relations like I did in the original post AND you don&#39;t use them in any particularly non-standard way then <code>FunctionalDependencies</code> and <code>MultiParamTypeClasses</code> work quite well. But if you try to go beyond that and do true type level programming, then you are much better off with <code>TypeFamilies</code>. In terms of both flexibility and general elegance. And thus because of that you should just stick to <code>TypeFamilies</code> in general to maintain that elegance and flexibility."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1469808299, "post_id": 38642039, "comment_id": 64707168, "body": "@semicolon Yep, that&#39;s a good summary. <code>TypeFamilies </code> is newer than <code>MultiParamTypeClasses</code> and was, IFRC, meant to make type level programming much more like value type programming (instead of logical equivalences)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1470250763, "last_edit_date": 1470250763, "creation_date": 1469723532, "answer_id": 38642039, "question_id": 38640052, "link": "https://stackoverflow.com/questions/38640052/what-can-type-families-do-that-multi-param-type-classes-and-functional-dependenc/38642039#38642039", "title": "What can type families do that multi param type classes and functional dependencies cannot", "body": "<p>Here's an example of where <code>TypeFamilies</code> really shines compared to <code>MultiParamClasses</code> with <code>FunctionalDependencies</code>. In fact, I challenge you to come up with an equivalent <code>MultiParamClasses</code> solution, even one that uses <code>FlexibleInstances</code>, <code>OverlappingInstance</code>, etc.</p>\n\n<p>Consider the problem of type level substitution (I ran across a specific variant of this in <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/\" rel=\"nofollow\">Quipper</a> in <code>QData.hs</code>). Essentially what you want to do is recursively substitute one type for another. For example, I want to be able to </p>\n\n<ul>\n<li>substitute <code>Int</code> for <code>Bool</code> in <code>Either [Int] String</code> and get <code>Either [Bool] String</code>,</li>\n<li>substitute <code>[Int]</code> for <code>Bool</code> in <code>Either [Int] String</code> and get <code>Either Bool String</code>,</li>\n<li>substitute <code>[Int]</code> for <code>[Bool]</code> in <code>Either [Int] String</code> and get <code>Either [Bool] String</code>.</li>\n</ul>\n\n<p>All in all, I want the usual notion of type level substitution. With a closed type family, I can do this for any types (albeit I need an extra line for each higher-kinded type constructor - I stopped at <code>* -&gt; * -&gt; * -&gt; * -&gt; *</code>).</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\n-- Subsitute type `x` for type `y` in type `a`\ntype family Substitute x y a where\n  Substitute x y x = y\n  Substitute x y (k a b c d) = k (Substitute x y a) (Substitute x y b) (Substitute x y c) (Substitute x y d)\n  Substitute x y (k a b c) = k (Substitute x y a) (Substitute x y b) (Substitute x y c)  \n  Substitute x y (k a b) = k (Substitute x y a) (Substitute x y b)\n  Substitute x y (k a) = k (Substitute x y a)\n  Substitute x y a = a\n</code></pre>\n\n<p>And trying at <code>ghci</code> I get the desired output:</p>\n\n<pre><code>&gt; :t undefined :: Substitute Int Bool (Either [Int] String)\nundefined :: Either [Bool] [Char]\n&gt; :t undefined :: Substitute [Int] Bool (Either [Int] String)\nundefined :: Either Bool [Char]\n&gt; :t undefined :: Substitute [Int] [Bool] (Either [Int] String)\nundefined :: Either [Bool] [Char]\n</code></pre>\n\n<hr>\n\n<p>With that said, maybe you should be asking yourself <em>why am I using <code>MultiParamClasses</code> and not <code>TypeFamilies</code></em>. Of the examples you gave above, all except <code>Convert</code> translate to type families (albeit you will need an extra line per instance for the <code>type</code> declaration).</p>\n\n<p>Then again, for <code>Convert</code>, I am not convinced it is a good idea to define such a thing. The natural extension to <code>Convert</code> would be instances such as</p>\n\n<pre><code>instance (Convert a b, Convert b c) =&gt; Convert a c where\n  convert = convert . convert\n\ninstance Convert a a where\n  convert = id\n</code></pre>\n\n<p>which are as unresolvable for GHC as they are elegant to write...</p>\n\n<p>To be clear, I am not saying there are no uses of <code>MultiParamClasses</code>, just that when possible you should be using <code>TypeFamilies</code> - they let you think about type-level functions instead of just relations.</p>\n\n<p><a href=\"https://wiki.haskell.org/Functional_dependencies_vs._type_families\" rel=\"nofollow\">This old HaskellWiki page does an OK job of comparing the two</a>.</p>\n\n<h1>EDIT</h1>\n\n<p>Some more contrasting and history I stumbled upon from augustss <a href=\"http://augustss.blogspot.com/2014/12/a-commentary-on-24-days-of-ghc_19.html\" rel=\"nofollow\">blog</a></p>\n\n<blockquote>\n  <p>Type families grew out of the need to have type classes with\n  associated types. The latter is not strictly necessary since it can be\n  emulated with multi-parameter type classes, but it gives a much nicer\n  notation in many cases. The same is true for type families; they can\n  also be emulated by multi-parameter type classes. But MPTC gives a\n  very logic programming style of doing type computation; whereas type\n  families (which are just type functions that can pattern match on the\n  arguments) is like functional programming.</p>\n  \n  <p>Using closed type families\n  adds some extra strength that cannot be achieved by type classes. To\n  get the same power from type classes we would need to add closed type\n  classes. Which would be quite useful; this is what instance chains\n  gives you.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1469727352, "last_edit_date": 1495541237, "creation_date": 1469727352, "answer_id": 38643177, "question_id": 38640052, "link": "https://stackoverflow.com/questions/38640052/what-can-type-families-do-that-multi-param-type-classes-and-functional-dependenc/38643177#38643177", "title": "What can type families do that multi param type classes and functional dependencies cannot", "body": "<p>Functional dependencies only affect the process of constraint solving, while type families introduced the notion of non-syntactic type equality, represented in GHC's intermediate form by coercions. This means type families interact better with GADTs. See <a href=\"https://stackoverflow.com/questions/34645745/can-i-magic-up-type-equality-from-a-functional-dependency\">this question</a> for the canonical example of how functional dependencies fail here.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 0, "accepted_answer_id": 38642039, "answer_count": 2, "score": 6, "last_activity_date": 1470250763, "creation_date": 1469717992, "question_id": 38640052, "link": "https://stackoverflow.com/questions/38640052/what-can-type-families-do-that-multi-param-type-classes-and-functional-dependenc", "title": "What can type families do that multi param type classes and functional dependencies cannot", "body": "<p>I have played around with <code>TypeFamilies</code>, <code>FunctionalDependencies</code>, and <code>MultiParamTypeClasses</code>. And it seems to me as though <code>TypeFamilies</code> doesn't add any concrete functionality over the other two. (But not vice versa). But I know type families are pretty well liked so I feel like I am missing something:</p>\n\n<p>\"open\" relation between types, such as a conversion function, which does not seem possible with <code>TypeFamilies</code>. Done with <code>MultiParamTypeClasses</code>:</p>\n\n<pre><code>class Convert a b where\n    convert :: a -&gt; b\n\ninstance Convert Foo Bar where\n    convert = foo2Bar\n\ninstance Convert Foo Baz where\n    convert = foo2Baz\n\ninstance Convert Bar Baz where\n    convert = bar2Baz\n</code></pre>\n\n<p>Surjective relation between types, such as a sort of type safe pseudo-duck typing mechanism, that would normally be done with a standard type family. Done with <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code>:</p>\n\n<pre><code>class HasLength a b | a -&gt; b where\n    getLength :: a -&gt; b\n\ninstance HasLength [a] Int where\n    getLength = length\n\ninstance HasLength (Set a) Int where\n    getLength = S.size\n\ninstance HasLength Event DateDiff where\n    getLength = dateDiff (start event) (end event)\n</code></pre>\n\n<p>Bijective relation between types, such as for an unboxed container, which could be done through <code>TypeFamilies</code> with a data family, although then you have to declare a new data type for every contained type, such as with a <code>newtype</code>. Either that or with an injective type family, which I think is not available prior to GHC 8. Done with <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code>:</p>\n\n<pre><code>class Unboxed a b | a -&gt; b, b -&gt; a where\n    toList :: a -&gt; [b]\n    fromList :: [b] -&gt; a\n\ninstance Unboxed FooVector Foo where\n    toList = fooVector2List\n    fromList = list2FooVector\n\ninstance Unboxed BarVector Bar where\n    toList = barVector2List\n    fromList = list2BarVector\n</code></pre>\n\n<p>And lastly a surjective relations between two types and a third type, such as python2 or java style division function, which can be done with <code>TypeFamilies</code> by also using <code>MultiParamTypeClasses</code>. Done with <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code>:</p>\n\n<pre><code>class Divide a b c | a b -&gt; c where                                                                  \n    divide :: a -&gt; b -&gt; c                                                                            \n\ninstance Divide Int Int Int where                                                                    \n    divide = div\n\ninstance Divide Int Double Double where                                                              \n    divide = (/) . fromIntegral                                                                      \n\ninstance Divide Double Int Double where                                                              \n    divide = (. fromIntegral) . (/)                                                                  \n\ninstance Divide Double Double Double where                                                           \n    divide = (/)\n</code></pre>\n\n<p>One other thing I should also add is that it seems like <code>FunctionalDependencies</code> and <code>MultiParamTypeClasses</code> are also quite a bit more concise (for the examples above anyway) as you only have to write the type once, and you don't have to come up with a dummy type name which you then have to type for every instance like you do with <code>TypeFamilies</code>:</p>\n\n<pre><code>instance FooBar LongTypeName LongerTypeName where\n    FooBarResult LongTypeName LongerTypeName = LongestTypeName\n    fooBar = someFunction\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>instance FooBar LongTypeName LongerTypeName LongestTypeName where\n    fooBar = someFunction\n</code></pre>\n\n<p>So unless I am convinced otherwise it really seems like I should just not bother with <code>TypeFamilies</code> and use solely <code>FunctionalDependencies</code> and <code>MultiParamTypeClasses</code>. Because as far as I can tell it will make my code more concise, more consistent (one less extension to care about), and will also give me more flexibility such as with open type relationships or bijective relations (potentially the latter is solver by GHC 8).</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469709515, "post_id": 38636436, "comment_id": 64656129, "body": "Possible related quesiton: <a href=\"http://stackoverflow.com/questions/37236892/force-stack-to-rebuild-an-installed-package/37237777#37237777\" title=\"force stack to rebuild an installed package\">stackoverflow.com/questions/37236892/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469719330, "post_id": 38639959, "comment_id": 64664175, "body": "Packages installed by stack are located deep within ~/.stack/snapshots/..."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1469719486, "post_id": 38639959, "comment_id": 64664283, "body": "@ErikR That is configuration dependent. Some configurations may go to .local, others may go to .stack, others may go to .stack-work"}, {"owner": {"reputation": 2313, "user_id": 414314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/900102177e7623ea58df296267b51295?s=128&d=identicon&r=PG", "display_name": "franssu", "link": "https://stackoverflow.com/users/414314/franssu"}, "edited": false, "score": 2, "creation_date": 1506790813, "post_id": 38639959, "comment_id": 79964321, "body": "what is &lt;pkg-id&gt;, how do I find it ?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 2313, "user_id": 414314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/900102177e7623ea58df296267b51295?s=128&d=identicon&r=PG", "display_name": "franssu", "link": "https://stackoverflow.com/users/414314/franssu"}, "edited": false, "score": 1, "creation_date": 1506954551, "post_id": 38639959, "comment_id": 80009277, "body": "@franssu <code>ghc-pkg field &lt;package-name&gt; id</code>"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 6, "creation_date": 1524294788, "post_id": 38639959, "comment_id": 86923129, "body": "Sometimes you have to do <code>stack exec ghc-pkg unregister ...</code>."}, {"owner": {"reputation": 19603, "user_id": 339843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/53a8a18baa2eda6e6758c3e522f77c24?s=128&d=identicon&r=PG", "display_name": "tofutim", "link": "https://stackoverflow.com/users/339843/tofutim"}, "edited": false, "score": 0, "creation_date": 1589091254, "post_id": 38639959, "comment_id": 109151180, "body": "i don&#39;t have ghc-pkg"}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 16, "last_activity_date": 1469719532, "last_edit_date": 1469719532, "creation_date": 1469717771, "answer_id": 38639959, "question_id": 38636436, "link": "https://stackoverflow.com/questions/38636436/how-to-uninstall-a-haskell-package-installed-with-stack/38639959#38639959", "title": "How to uninstall a Haskell package installed with stack?", "body": "<p>As <code>stack --help</code> says, uninstall doesn't do anything. You can read about this <a href=\"https://github.com/commercialhaskell/stack/issues/361\" rel=\"noreferrer\">on the stack github</a> where this feature was requested, but it ended up being closed without the desire to add the behavior to stack, for various reasons. So, officially, there is no way to use stack to uninstall a package. </p>\n\n<p>To remove a package that stack installed, you need to manually do so. This entails using ghc-pkg unregister and then finding the location of the package on your system and removing it via another tool or simply <code>rm</code>. For example, </p>\n\n<pre><code>stack install &lt;package name&gt;\n# Now remove the package\nghc-pkg unregister &lt;pkg-id&gt;\ncd /path/to/stack/packages # This could be something like ~/.local/bin, but is configuration dependent\nrm &lt;package name&gt;\n</code></pre>\n"}], "owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11358, "favorite_count": 7, "accepted_answer_id": 38639959, "answer_count": 1, "score": 30, "last_activity_date": 1483476213, "creation_date": 1469709027, "last_edit_date": 1483476213, "question_id": 38636436, "link": "https://stackoverflow.com/questions/38636436/how-to-uninstall-a-haskell-package-installed-with-stack", "title": "How to uninstall a Haskell package installed with stack?", "body": "<p>How can I uninstall a Haskell package installed globally with stack tool?</p>\n\n<p><code>stack --help</code> shows that uninstall command is deprecated.</p>\n\n<pre><code>  uninstall                DEPRECATED: This command performs no actions, and is\n                           present for documentation only\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469701380, "post_id": 38633218, "comment_id": 64650556, "body": "Taking a brief glance at the docs, it looks like <code>Unbox</code> doesn\u2019t actually have any methods\u2014you should be able to just define <code>instance Unbox Colour</code> as long as you have also defined <code>instance Data.Vector.Generic.Vector Vector Colour</code> and <code>instance Data.Vector.Generic.Mutable.MVector MVector Colour</code>."}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469704479, "post_id": 38633218, "comment_id": 64652622, "body": "@AlexisKing Those instances are what confuse me. What on earth is <code>Data.Vector.Generic.Vector Vector</code> exactly?"}], "answers": [{"tags": [], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "is_accepted": true, "score": 6, "last_activity_date": 1469708547, "creation_date": 1469708547, "answer_id": 38636251, "question_id": 38633218, "link": "https://stackoverflow.com/questions/38633218/storing-an-enum-type-in-an-unboxed-vector/38636251#38636251", "title": "Storing an Enum type in an unboxed Vector", "body": "<p>One approach is to use <a href=\"https://hackage.haskell.org/package/vector-th-unbox-0.2.1.2/docs/Data-Vector-Unboxed-Deriving.html\" rel=\"noreferrer\"><code>Data.Vector.Unboxed.Deriving</code></a>, which uses template Haskell to define the correct instances for the new types in terms of existing types with <code>Unbox</code> instances.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TypeFamilies, TemplateHaskell #-}\nmodule Enum where\n\n\nimport qualified Data.Vector.Unboxed as U\nimport Data.Vector.Generic.Base\nimport Data.Vector.Generic.Mutable\nimport Data.Vector.Unboxed.Deriving\nimport Data.Word\n\n\n\ndata Colour = Red | Blue | Green\n   deriving (Eq, Ord, Enum, Bounded, Read, Show)\n\ncolourToWord8 :: Colour -&gt; Word8\ncolourToWord8 c =\n    case c of\n      Red -&gt; 0\n      Blue -&gt; 1\n      Green -&gt; 2\n\nword8ToColour :: Word8 -&gt; Colour\nword8ToColour w =\n    case w of\n      0 -&gt; Red\n      1 -&gt; Blue\n      _ -&gt; Green\n\n\nderivingUnbox \"Colour\"\n  [t| Colour -&gt; Word8 |]\n  [| colourToWord8 |]\n  [| word8ToColour |]\n\n\ntest n = U.generate n (word8ToColour . fromIntegral . (`mod` 3))\n</code></pre>\n\n<p>Of course this wastes space in this case because we only use 2 of the 8 bits in <code>Word8</code>.</p>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 38636251, "answer_count": 1, "score": 6, "last_activity_date": 1469719111, "creation_date": 1469700263, "question_id": 38633218, "link": "https://stackoverflow.com/questions/38633218/storing-an-enum-type-in-an-unboxed-vector", "title": "Storing an Enum type in an unboxed Vector", "body": "<p>Suppose I have something like this:</p>\n\n<pre><code>data Colour = Red | Blue | Green\n   deriving (Eq, Ord, Enum, Bounded, Read, Show)\n</code></pre>\n\n<p>And I want to have an unboxed <code>Vector</code> of <code>Colour</code>s. I obviously cannot do this directly (because <code>Colour</code> isn't an instance of <code>Unbox</code>), but I also can't tell how I would write the <code>Unbox</code> instance for <code>Colour</code>. The the documentation for <code>Unbox</code> doesn't seem to say how you make something an instance of it (or at least, not in a way I understand).</p>\n"}, {"tags": ["haskell", "vector"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469691539, "post_id": 38629806, "comment_id": 64644008, "body": "You say you want the minimum value in the list but <code>-1.03999</code> is nowhere in the list. Perhaps you want something like <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:minimumBy\" rel=\"nofollow noreferrer\"><code>minimumBy</code></a>"}, {"owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469691683, "post_id": 38629806, "comment_id": 64644098, "body": "Sorry , the header is a bit misleading,  I don&#39;t want to get the minimum from  a list, I want to get the minimum value which will be determined by urvalFun as demonstrated above"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1469691838, "post_id": 38629806, "comment_id": 64644192, "body": "Sounds exactly like what <code>minimumBy</code> does, check that out."}, {"owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1469694752, "post_id": 38629806, "comment_id": 64645943, "body": "okey, I will examine it more. However, I hope someone still could see whats wrong with my code"}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "edited": false, "score": 0, "creation_date": 1469701392, "post_id": 38631280, "comment_id": 64650564, "body": "this is completely wrong.  you can&#39;t say that if you found the least number , in this case 0.304  then that does not imply that  &#39;urvalFun 2 (&quot;a&quot;,&quot;b&quot;,0.304)&#39; will be the smallest value. In this case this just happens to correct but not in general"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "edited": false, "score": 2, "creation_date": 1469701728, "post_id": 38631280, "comment_id": 64650809, "body": "Right, I have no idea what your code does so I made a best guess. If you can explain in English what you want then somebody can better help you. Please see my edits, perhaps that is what you&#39;re trying to accomplish."}, {"owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "edited": false, "score": 0, "creation_date": 1469702735, "post_id": 38631280, "comment_id": 64651489, "body": "it is actually what I wanted to do - the &quot;second case&quot; in your post."}], "tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": false, "score": 3, "last_activity_date": 1469702148, "last_edit_date": 1469702148, "creation_date": 1469695432, "answer_id": 38631280, "question_id": 38629806, "link": "https://stackoverflow.com/questions/38629806/get-the-minimum-value/38631280#38631280", "title": "Get the minimum value", "body": "<p>First you need a way to get the minimum element to pass to <code>urvalFun</code>. This can be done with <code>minimumBy</code>.</p>\n\n<p>Observe the following</p>\n\n<pre><code>\u03bb&gt; let ls = [(\"a\",\"d\",0.52),(\"a\",\"e\",0.824),(\"a\",\"b\",0.304)]                                                                                                                                                        \n\u03bb&gt; let min = minimumBy (\\(_,_,c) (_,_,c') -&gt; compare c c') ls                                                                                                                                                       \n\u03bb&gt; urvalFun 3 min ls                                                                                                                                                                                                \n-1.0399999999999998 \n</code></pre>\n\n<p>Or maybe this is what you intended:</p>\n\n<pre><code>\u03bb&gt; minimum [ urvalFun 3 x ls | x &lt;- ls]                                                                                                                                                                             \n-1.0399999999999998\n</code></pre>\n\n<p>If you also want to alter n from 0 to 3 or something, then this can be further modified. I'd suggest stating in english what you want your function to do.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1469709469, "last_edit_date": 1469709469, "creation_date": 1469709038, "answer_id": 38636443, "question_id": 38629806, "link": "https://stackoverflow.com/questions/38629806/get-the-minimum-value/38636443#38636443", "title": "Get the minimum value", "body": "<p>You want to find the value in a given list which minimizes your function.</p>\n\n<p>I'll work with a simpler example than yours: finding the string with minimum length. You'll be able to adapt this to your case by replacing the <code>length</code> function.</p>\n\n<pre><code>&gt; import Data.Foldable\n&gt; let list = [\"hello\", \"world!\", \"here\", \"is\", \"fine\"]\n&gt; minimumBy (comparing length) list\n\"is\"\n</code></pre>\n\n<p>The above works, but it will call <code>length</code> every time it performs a comparison, i.e. roughly twice the length of the list. It is also possible to avoid this, and use <code>length</code> only once per element, by precomputing it:</p>\n\n<pre><code>&gt; snd $ minimumBy (comparing fst) [ (length x, x) | x &lt;- list ]\n</code></pre>\n\n<p>We first pair each string with its length, take the minimum length-string pair according to the length only, and finally take only the string in such pair.</p>\n\n<p>By the way, I'd recommend you avoid functions such as <code>get1</code> to access tuples: they are not idiomatic in Haskell code, which usually exploits pattern matching for the same effect: for instance</p>\n\n<pre><code>urvalFun:: Int -&gt; (String,String,Double)-&gt;[(String,String,Double) ]-&gt;Double\nurvalFun size (s1,s2,d) diMat =\n   (fromIntegral size - 2)*d - distDiff s1 s2 diMat + distDiff s2 s1 diMat\n</code></pre>\n\n<p>looks more readable.</p>\n\n<p><code>head,tail</code> are also particularly dangerous since they are partial: they will crash your program if you ever use them on a empty list, without providing much explanation.</p>\n\n<p>In general, when working with lists, using indexes, or counter variables to count up to the length of the list, is typically not needed and not idiomatic. One can often simply resort to pattern matching and recursion, or even to standard fold/map functions.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469714341, "last_edit_date": 1469714341, "creation_date": 1469713072, "answer_id": 38638136, "question_id": 38629806, "link": "https://stackoverflow.com/questions/38629806/get-the-minimum-value/38638136#38638136", "title": "Get the minimum value", "body": "<p>Note that for a list of size 3 your <code>getMin</code> function may be written:</p>\n\n<pre><code>getMin' [x,y,z]\n  = minimum [  urvalFun 3 x [x,y,z]\n            ,  urvalFun 3 y [y,z,x]\n            ,  urvalFun 3 z [z,x,y]\n            ]\n</code></pre>\n\n<p>You can create the sequence of arguments to the <code>urvalFun</code> function with zip and and a helper function:</p>\n\n<pre><code>rotate (x:xs) = xs ++ [x]\n\nzip \"xyzw\" (iterate rotate \"xyzw\")\n  = [ ('x', \"xyzw\"),\n      ('y', \"yzwx\"),\n      ('z', \"zwxy\"),\n      ('w', \"wxyz\") ]\n</code></pre>\n\n<p>Thus:</p>\n\n<pre><code>import Data.List\n\ngetMin tuples = minimum (zipWith go tuples (iterate rotate tuples))\n  where n = length tuples\n        go (x,xs) = urvalFun n x xs\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1469714341, "creation_date": 1469691082, "last_edit_date": 1469694671, "question_id": 38629806, "link": "https://stackoverflow.com/questions/38629806/get-the-minimum-value", "title": "Get the minimum value", "body": "<p>I have a function 'getMin' which should return the minimum value. This function uses another function 'urvalFun' in order to determine this minimim value. Here is a demonstration of 'urvalFun'</p>\n\n<pre><code>get1:: (String,String,Double ) -&gt; String\nget1  (x,_,_ )  = x\n\nget2 :: (String,String,Double)-&gt; String\nget2 (_,x,_) = x\n\nget3:: (String,String,Double)-&gt;Double\nget3 (_,_,x) = x\n\ndistDiff:: String-&gt; String-&gt;[(String,String,Double)] -&gt;Double  \ndistDiff a b diMat = sum [z |(x,y,z)&lt;- diMat, (x == a &amp;&amp; y /= b)\n|| (y == a &amp;&amp; x /= b)  ]\n\nurvalFun:: Int -&gt; (String,String,Double)-&gt;[(String,String,Double) ]-&gt;Double\nurvalFun size triple diMat  =  ((fromIntegral size)-2)*(get3 triple)\n         -  ( (distDiff (get1 triple) (get2 triple) diMat ) + (distDiff (get2 triple) \n        (get1 triple) diMat ))\n</code></pre>\n\n<p>Its not necessary to understand this chunck of code, the only thing that is important is that if i evaluate:</p>\n\n<pre><code>urvalFun 3 (\"a\",\"b\",0.304)  [(\"a\",\"b\",0.304),(\"a\",\"d\",0.52),(\"a\",\"e\",0.824)]\n</code></pre>\n\n<p>this will evaluate to -1.03999</p>\n\n<pre><code> urvalFun 3 (\"a\",\"d\",0.52)  [(\"a\",\"b\",0.304),(\"a\",\"d\",0.52),(\"a\",\"e\",0.824)]\n</code></pre>\n\n<p>this will evaluate to - 0.60799</p>\n\n<pre><code>urvalFun 3 (\"a\",\"e\",0.824)  [(\"a\",\"b\",0.304),(\"a\",\"d\",0.52),(\"a\",\"e\",0.824)]\n</code></pre>\n\n<p>this will evaluate to 1.1e^-16</p>\n\n<p>now we know that calling urvalFun with (\"a\",\"b\",0.304) and  [(\"a\",\"b\",0.304),(\"a\",\"d\",0.52),(\"a\",\"e\",0.824)] will get the value which is the smallest. I want to create a function 'getMin' which will return this minimum value (with the same vector as in the above examples as a parameter) ,as shown above. The problem is that it won't work I have no clue why</p>\n\n<pre><code>getMin:: [(String,String,Double)]-&gt;Double\ngetMin diMat  = inner 0 diMat 2000\n  where\n  inner 3 diMat min = min\n  inner n diMat min\n    |current &gt; min = inner (n + 1)  (diMatMinus ++ [(head diMat) ])  min\n    |otherwise = inner (n+1) (diMatMinus ++ [(head diMat) ]) current\n  current = urvalFun (length diMat) (head diMat) diMat\n  diMatMinus = tail diMat\n</code></pre>\n\n<p>try to evaluate for example</p>\n\n<pre><code>getMin  [(\"a\",\"e\",0.824),(\"a\",\"d\",0.52),(\"a\",\"b\",0.304)]\n</code></pre>\n\n<p>which will evaluate to  -1.1e^-16</p>\n\n<p>which is not want i intended because I want this to return -1.03999</p>\n\n<p>Could someone help me out here?</p>\n\n<p>(this code is a little bit  ad hoc but it is under construction, I am just doing some tests right now) </p>\n\n<p>notice that i have rearranged the vector so that the triple (\"a\",\"b\",0.304) is the last element in the vector.  </p>\n"}, {"tags": ["haskell", "operators"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1469683349, "post_id": 38627567, "comment_id": 64639759, "body": "Haskell lists are linked lists, and appending lists is an O(<i>n</i>) operation in strict languages. In Haskell, however, it\u2019s not quite as straightforward: laziness allows that work to be put off until the list is used, effectively distributing the cost over the length of the list. As you mention, this laziness can make time and space complexities difficult to reason about in Haskell, but I think the same advice for other languages applies to Haskell, too: write for clarity first, and optimize for speed if and only if you both need it to go faster <i>and</i> you\u2019ve profiled to find a bottleneck."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469683352, "post_id": 38627567, "comment_id": 64639761, "body": "it&#39;s both - it&#39;s harder to reason about your code, it usually slows down your code quite a bit and you can very often work around using it - but it all depends on the circumstances and IMO your questions is to unspecific to be a good fit for SO"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469686142, "post_id": 38627567, "comment_id": 64640925, "body": "@Carsten: I&#39;m a little confused about your remark regarding &quot;it usually slows down your code&quot;. While this is certainly true with the canonical tail-recursive factorial example, is this really quite common amongst everyday programs? I thought the benefit to something like Haskell over one of the more popular outsider languages like Ruby and Python was the optimizations afforded by the rich typing system.  If you really believe that my questions are not specific enough, what about in the example I provided, save only the last question (which was my intention, and I think ThreeFx figured it out."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469687830, "post_id": 38627567, "comment_id": 64641803, "body": "you should not worry if I think the question is no fit for SO - it&#39;s not about the question but about SO"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469688184, "post_id": 38627567, "comment_id": 64641991, "body": "I&#39;m not worrying, I just think it is a fit for SO. ThreeFx was able to help me significantly with that, and I hope many others as well."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1469730627, "post_id": 38627567, "comment_id": 64671309, "body": "the canonical answer is <a href=\"https://stackoverflow.com/questions/13879260/why-are-difference-lists-more-efficient-than-regular-concatenation/13879693#13879693\">this</a>, but see also <a href=\"http://stackoverflow.com/questions/14938584/haskell-foldl-poor-performance-with/14942678#14942678\">this one</a>."}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469685715, "post_id": 38627688, "comment_id": 64640720, "body": "Can this be generalized such that foldl should be used with left-associative operators all the time? What do we do with foldl&#39;? EDIT: If an operation is both left and right associative, does that mean that foldl &lt;op&gt; &lt;vals&gt; == foldr &lt;op&gt; &lt;vals&gt;? And, under what circumstances is foldl &lt;otherop&gt; &lt;vals&gt; != foldr &lt;otherop&gt; &lt;vals&gt;?   And does Haskell really not notice this bottleneck? I thought the compiler was supposed to be among the best in the world (specifically referring to the GHC here), to not optimize this seems folly (although I may be out of my league...)."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469686074, "post_id": 38627688, "comment_id": 64640890, "body": "@JackBrandt No, at least not as a general rule. Imagine <code>(^)</code> (or <code>(-)</code>): These operators produce different results when used in left and right folds, respectively. It depends on what you want it to do. <code>foldl&#39;</code> is an entirely different matter, it is a strict version of the standard <code>foldl</code> and should almost always be preferred over <code>foldl</code>, except when you explicitly want to build up thunks."}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469686847, "post_id": 38627688, "comment_id": 64641236, "body": "Can you expand on why anyone would want to build up thunks? It seems rather counterintuitive to popular understanding. Also, the mathematical examples were really quite useful for understanding the difference b/t folds."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469687010, "post_id": 38627688, "comment_id": 64641328, "body": "@JackBrandt It&#39;s less the thunks than it is the advantage of using a lazy consuming function. Whereas <code>foldl&#39;</code> will crash given <code>undefined</code>in its list, the lazy <code>foldl</code> <i>may</i> return given that your function is lazy enough. You might want to have a look at <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow noreferrer\">this</a> example."}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469687219, "post_id": 38627688, "comment_id": 64641460, "body": "So why doesn&#39;t the compiler automatically recognize these cases and provide the best version in the compiled code?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1469687623, "post_id": 38627688, "comment_id": 64641691, "body": "@JackBrandt Oh I didn&#39;t notice the edits to your comment. I think any fold using an <i>associative</i> operation (that&#39;s the term for operators which are arbitrarily associative) produces equal results for <code>foldl</code> and <code>foldr</code>. Any operator which is not <i>associative</i> will produce different results for <code>foldl</code> and <code>foldr</code>. Since I sadly have no clue about the GHC optimizer, I cannot answer your question, although the other users are certainly able to help you in that regard."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1469711351, "post_id": 38627688, "comment_id": 64657676, "body": "The reason <code>foldr</code> is better has nothing to do with the associativity of <code>(++)</code>.  It&#39;s because of how <code>(++)</code> has to work when concatenating immutable linked lists.  It must create new <code>(:)</code> constructors for each element in its left argument, but it doesn&#39;t do anything at all with the right argument.  Therefore, if you stack up a left-biased tree of calls to <code>(++)</code> it repeatedly copies the same elements. If you stack up a right-biased tree, it only copies the elements it needs to once."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 9, "last_activity_date": 1469729416, "last_edit_date": 1469729416, "creation_date": 1469683433, "answer_id": 38627688, "question_id": 38627567, "link": "https://stackoverflow.com/questions/38627567/avoiding-in-haskell/38627688#38627688", "title": "Avoiding ++ in Haskell", "body": "<p><strong>It depends.</strong></p>\n\n<p>Consider the expression</p>\n\n<pre><code>foldl (++) [] list\n</code></pre>\n\n<p>This expression concatenates a list of lists into a single list, but has aforementioned quadratic complexity. This happens because the implementation of <code>(++)</code> traverses the entire left list and prepends each element to the right list (while keeping the correct order of course).</p>\n\n<p>Using a right fold, we get linear complexity:</p>\n\n<pre><code>foldr (++) [] list\n</code></pre>\n\n<p>This is due to the <code>(++)</code> operator's implementation, which traverses only the left argument and prepends it to the right.</p>\n\n<pre><code>[1,2] ++ [3,4] ++ [5,6]\n</code></pre>\n\n<p>is equal to</p>\n\n<pre><code>-- Example as created by foldr\n[1,2] ++ ([3,4] ++ [5,6])\n== [1,2] ++ [3,4,5,6]\n== [1,2,3,4,5,6] -- all good, no element traversed more than once\n</code></pre>\n\n<p>which only traverses each list element once.</p>\n\n<p>Now switching the parentheses around to the first two lists is more expensive, since now some elements are traversed multiple times, which is inefficient.</p>\n\n<pre><code>-- Example as created by foldl\n([1,2] ++ [3,4]) ++ [5,6]\n== [1,2,3,4] ++ [5,6]\n== [1,2,3,4,5,6] -- the sublist [1,2] was traversed twice due to the ordering of the appends\n</code></pre>\n\n<p>All in all, watch out for such cases and you should be fine.</p>\n"}], "owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 0, "accepted_answer_id": 38627688, "answer_count": 1, "score": 5, "last_activity_date": 1469729416, "creation_date": 1469682813, "question_id": 38627567, "link": "https://stackoverflow.com/questions/38627567/avoiding-in-haskell", "title": "Avoiding ++ in Haskell", "body": "<p>In <a href=\"https://codereview.stackexchange.com/questions/48895/haskellsplitat\">this answer on CodeReview</a>, the question asker and the answerer both seem to show disdain for the (++) operator. Is this due to it's speed (causing the algorithm to explicitly run in O(n^2) where n is the length of the list iirc)? Is this a pre-optimization if not otherwise tested, as Haskell is known for being difficult to reason about time complexity? Should others avoid the (++) operator in their programs? </p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1469679530, "post_id": 38626963, "comment_id": 64638668, "body": "well yes - <code>return</code> is used to pull values up into your monad - as every other function you just have to look at the types (<code>return</code> is not what you know from C-like languages) - aside from this: why use the monad-instance of <code>(-&gt;) a</code> here at all? it just obfuscates everything - is this some exercise?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1469679619, "post_id": 38626963, "comment_id": 64638686, "body": "see: <code>\\n -&gt; (n+)</code> already has the desired type <code>Int -&gt; (Int -&gt; Int)</code> (your monad is <code>(-&gt;) Int</code>) - but of course <code>d+d</code> has not (it has type <code>Int</code>) - so you use <code>return (d+d) = \\ _ -&gt; (d+d)</code> (remember <code>the </code>\\d -&gt; ...` in <code>&gt;&gt;= (\\d -&gt; ...)</code> needs to return a monadic value - that is a <code>Int -&gt; a</code> here )"}, {"owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1469680754, "post_id": 38626963, "comment_id": 64638974, "body": "@Carsten: Nice answer, I think you can answer the question for me accept the question unless better answers come along. BTW, I&#39;m new to Haskell, so I&#39;m trying to understand what monad in Haskell is."}, {"owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "edited": false, "score": 1, "creation_date": 1469680946, "post_id": 38626963, "comment_id": 64639028, "body": "This question does not deserve the down-vote, imho. Because it is an honest question by a beginner."}, {"owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "edited": false, "score": 0, "creation_date": 1469681317, "post_id": 38626963, "comment_id": 64639147, "body": "@prosseek, if I may, I think your approach to figuring out how to make it work is flawed: you are looking for &quot;rules&quot; which would give you an &quot;algorithm&quot; of sort, whereas I think the right approach is simply to understand the types of each part of the expression and how it works."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1469691022, "post_id": 38626963, "comment_id": 64643641, "body": "@prosseek You have asked a bunch of questions which are tailored to only one specific monad, the <code>(-&gt;) a</code> monad, which is not that much used. To get what&#39;s a monad is about I&#39;d recommend you also play with other monads. Start from e.g. <code>Maybe</code> and <code>[]</code> and <code>Either e</code>, and then move to <code>State s</code>, <code>IO</code>, etc. Just focusing on one monad will not make you understand the whole picture."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 8, "last_activity_date": 1469682837, "creation_date": 1469682837, "answer_id": 38627573, "question_id": 38626963, "link": "https://stackoverflow.com/questions/38626963/when-to-use-or-not-to-use-return-in-haskells-monad-expression/38627573#38627573", "title": "When to use or not to use &#39;return&#39; in Haskell&#39;s monad expression", "body": "<p>The <code>return</code> function in Haskell has little to do with the <code>return</code> keyword in imperative programming languages\u2014it\u2019s just an ordinary function with an ordinary type signature:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p>Basically, <code>return</code> takes any old value and \u201clifts\u201d it into a monad. It\u2019s a little clearer what this function does when you replace the <code>m</code> with a concrete type, like <code>Maybe</code>:</p>\n\n<pre><code>return :: a -&gt; Maybe a\n</code></pre>\n\n<p>There\u2019s only one implementation of the above function, and that\u2019s <code>Just</code>, so <code>return = Just</code> for the <code>Maybe</code> monad.</p>\n\n<p>In your case, you are using the function monad, <code>(-&gt;) r</code>, also often called the \u201creader\u201d monad. Performing the same substitution as with <code>Maybe</code>, we get the following signature:</p>\n\n<pre><code>return :: a -&gt; r -&gt; a\n</code></pre>\n\n<p>This function <em>also</em> has only one implementation, which is to ignore its second argument and return its first. This is what <code>const</code> does, so <code>return = const</code> for functions.</p>\n\n<hr>\n\n<p>The question of \u201cwhen to use <code>return</code>\u201d is a reasonable one, but it should make more sense after understanding the above: you need to use <code>return</code> when the value returned from a function passed to <code>&gt;&gt;=</code> is not monadic, so it needs to be \u201clifted\u201d. For example, the following would be a type error:</p>\n\n<pre><code>Just 3 &gt;&gt;= \\x -&gt; x + 1\n</code></pre>\n\n<p>Specifically, the right hand side needs to return a <code>Maybe Int</code>, but it only returns an <code>Int</code>. Therefore, we can use <code>return</code> to produce a value of the correct type:</p>\n\n<pre><code>Just 3 &gt;&gt;= \\x -&gt; return (x + 1)\n</code></pre>\n\n<p>However, consider a similar expression. In the following case, using <code>return</code> would be a type error:</p>\n\n<pre><code>Just [(\"a\", 1), (\"b\", 2)] &gt;&gt;= \\l -&gt; lookup \"c\"\n</code></pre>\n\n<p>That\u2019s because the result of the <code>lookup</code> function is <em>already</em> a <code>Maybe Int</code> value, so using <code>return</code> would produce a <code>Maybe (Maybe Int)</code>, which would be wrong.</p>\n\n<p>Returning to your example using the function monad, <code>(n+)</code> is already a function of type <code>Int -&gt; Int</code>, so using <code>return</code> would be incorrect (it would produce a function of type <code>Int -&gt; Int -&gt; Int</code>). However, <code>d + d</code> is just a value of type <code>Int</code>, so you need <code>return</code> to lift the value into the monad.</p>\n\n<hr>\n\n<p>It\u2019s worth noting that, in both cases, you could always replace <code>return</code> with its underlying implementation. You could use <code>Just</code> instead of <code>return</code> when using the <code>Maybe</code> monad, and you could use <code>const</code> instead of <code>return</code> when using the function monad. However, there are two good reasons to use <code>return</code>:</p>\n\n<ol>\n<li><p>Using <code>return</code> lets you write functions that work with more than one kind of monad. That is, <code>return</code> gets you <em>polymorphism</em>.</p></li>\n<li><p>It\u2019s extremely idiomatic to use <code>return</code> to lift plain values into a monadic type, so it\u2019s clearer and less noisy to always see <code>return</code> instead of seeing many different functions with different names.</p></li>\n</ol>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 1, "accepted_answer_id": 38627573, "answer_count": 1, "score": 1, "last_activity_date": 1469682837, "creation_date": 1469679015, "last_edit_date": 1495535325, "question_id": 38626963, "link": "https://stackoverflow.com/questions/38626963/when-to-use-or-not-to-use-return-in-haskells-monad-expression", "title": "When to use or not to use &#39;return&#39; in Haskell&#39;s monad expression", "body": "<p>I have a function a that 1) computes <code>(argument+) argument</code>, and 2) doubles it (<a href=\"https://stackoverflow.com/questions/38626030/interpreting-haskell-monad-example\">Interpreting Haskell monad example</a>). </p>\n\n<pre><code>a :: Int -&gt; Int \na = (id &gt;&gt;= (\\n -&gt; (n+))) &gt;&gt;= (\\d -&gt; return (d + d))\n</code></pre>\n\n<p>In this function, I <strong>should</strong> use return to prevent errors.</p>\n\n<p>However in this triple function that returns <code>((argument+) argument)+ argument)</code> to triple the input argument. I cannot use the return.</p>\n\n<pre><code>triplex :: Int -&gt; Int \ntriplex = (id &gt;&gt;= (\\n -&gt; (n+))) &gt;&gt;= (\\d -&gt; (d+))\n</code></pre>\n\n<p>From these examples, I guess simply the rule of <code>return</code> is 1) we use <code>return</code> when we return values, 2) we don't use <code>return</code> when we return a partial function. But I'm not sure this is correct understanding. So, Is there a rule behind this <code>return</code> in Haskell?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "edited": false, "score": 0, "creation_date": 1469801478, "post_id": 38626215, "comment_id": 64702829, "body": "Downvote without any comments on what&#39;s wrong with the question? I didn&#39;t expect to see this kind of cowardice from a Haskell tagged question."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1469675583, "creation_date": 1469675583, "answer_id": 38626494, "question_id": 38626215, "link": "https://stackoverflow.com/questions/38626215/equivalence-of-m-a-f-g-and-m-a-f-g-in-haskell/38626494#38626494", "title": "Equivalence of (M a &gt;&gt;= f) &gt;&gt;= g and M a &gt;&gt;= (f &gt;&gt;= g) in Haskell", "body": "<p>This equivalence is the third of the <a href=\"https://wiki.haskell.org/Monad_laws\">Monad Laws</a> and concerns itself  with associativity, so it is no surprise that <code>triple2</code> and <code>triple3</code> are equivalent. After all the  <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645\"><code>(-&gt;) r</code> monad</a> obeys the monad laws. The third monad law states that</p>\n\n<pre><code>(m &gt;&gt;= f) &gt;&gt;= g \u2261 m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\n</code></pre>\n\n<p>In your case, you have <code>m = id</code>, <code>f = \\n -&gt; (n+)</code>, and <code>g = \\d -&gt; (d+)</code>. To prove why this law holds, we need to look at the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645\">definition of <code>(&gt;&gt;=)</code> for this monad</a>. From this link, we get that</p>\n\n<pre><code>f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<p>To verify the third monad law with this definition of <code>(&gt;&gt;=)</code>, we'll use a couple rules:</p>\n\n<ul>\n<li><em>Definition of <code>(&gt;&gt;=)</code>:</em> <code>f &gt;&gt;= k \u2261 \\ r -&gt; k (f r) r</code></li>\n<li><em>Beta transformation:</em> <a href=\"https://wiki.haskell.org/Beta_reduction\">basically function application</a></li>\n<li><em>Function currying:</em> <code>(f x) y \u2261 f x y</code></li>\n</ul>\n\n<p>Now for the proof:</p>\n\n<pre><code>(m &gt;&gt;= f) &gt;&gt;= g\n  \u2261 (\\ r1 -&gt; f (m r1) r1) &gt;&gt;= g                             (Definition of (&gt;&gt;=))\n  \u2261 \\ r2 -&gt; g ((\\ r1 -&gt; f (m r1) r1) r2) r2                 (Definition of (&gt;&gt;=))\n  \u2261 \\ r2 -&gt; g (f (m r2) r2) r2                              (Beta transformation)\n  \u2261 \\ r2 -&gt; g ((f (m r2)) r2) r2                            (Function currying)\n  \u2261 \\ r2 -&gt; (\\ r1 -&gt; g ((f (m r2)) r1) r1) r2               (Beta transformation)\n  \u2261 \\ r2 -&gt; ((\\ x -&gt; (\\ r1 -&gt; g ((f x) r1) r1)) (m r2)) r2  (Beta transformation)\n  \u2261 \\ r2 -&gt; ((\\ x -&gt; f x &gt;&gt;= g) (m r2)) r2                  (Definition of (&gt;&gt;=)) \n  \u2261 \\ r2 -&gt; (\\ x -&gt; f x &gt;&gt;= g) (m r2) r2                    (Function currying) \n  \u2261 m &gt;&gt;= (\\ x -&gt; f x &gt;&gt;= g)                                (Definition of (&gt;&gt;=))  \n</code></pre>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 38626494, "answer_count": 1, "score": -2, "last_activity_date": 1469676187, "creation_date": 1469673189, "last_edit_date": 1469676187, "question_id": 38626215, "link": "https://stackoverflow.com/questions/38626215/equivalence-of-m-a-f-g-and-m-a-f-g-in-haskell", "title": "Equivalence of (M a &gt;&gt;= f) &gt;&gt;= g and M a &gt;&gt;= (f &gt;&gt;= g) in Haskell", "body": "<p>I have two Haskell functions that are equivalent. </p>\n\n<pre><code>triple :: Int -&gt; Int\ntriple = do\n  n &lt;- id\n  d &lt;- (n+)\n  (d+)\n\ntriple2 :: Int -&gt; Int  \ntriple2 = (id &gt;&gt;= (\\n -&gt; (n+))) &gt;&gt;= (\\d -&gt; (d+))    \n</code></pre>\n\n<p>The signature of <code>&gt;&gt;=</code> is <code>M a -&gt;  (a -&gt; M b) -&gt; M b</code>, so the parenthesis are used to stress the relation ship <code>((Ma &gt;&gt;= f) &gt;&gt;= f2)</code> or <code>M b &gt;&gt; f2</code>.</p>\n\n<p>However, this triple3 is also the same equivalent function as triple or triple2.</p>\n\n<pre><code>triple3 :: Int -&gt; Int  \ntriple3 = id &gt;&gt;= (\\n -&gt; (n+) &gt;&gt;= (\\d -&gt; (d+)))\n</code></pre>\n\n<p>What is the logic behind these equivalences?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1469672290, "post_id": 38626030, "comment_id": 64637094, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/5310203/how-to-use-instances-of-monad-and-confusion-about\">How to use (-&gt;) instances of Monad and confusion about (-&gt;)</a>"}], "answers": [{"tags": [], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "is_accepted": true, "score": 2, "last_activity_date": 1469677952, "last_edit_date": 1469677952, "creation_date": 1469677567, "answer_id": 38626753, "question_id": 38626030, "link": "https://stackoverflow.com/questions/38626030/interpreting-haskell-monad-example/38626753#38626753", "title": "Interpreting Haskell monad example", "body": "<p>We can rewrite equivalent triple2 function as follows:</p>\n\n<pre><code>triple2 = (id &gt;&gt;= (\\n -&gt; (n+))) &gt;&gt;= (\\d -&gt; (d+))\n</code></pre>\n\n<p>With <code>f = \\n -&gt; (n+)</code>, we have <code>triple2 = (id &gt;&gt; f) &gt;&gt; f</code>.</p>\n\n<p>From the definition of <code>&gt;&gt;=</code> in (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-645</a>), we have </p>\n\n<h3>1. id >>= f</h3>\n\n<pre><code>\\r -&gt; f (id r) r = \\r -&gt; f r r = \\r -&gt; (r+) r\n</code></pre>\n\n<h3>2. (id >>= f) >>= f</h3>\n\n<pre><code>x = id &gt;&gt;= f = \\r -&gt; (r+) r\nx r = (r+) r\nx &gt;&gt; f = \\r -&gt; f (x r) r = f ((r+) r) r = ((r+) r)+ r\n</code></pre>\n\n<p>so <code>((10+) 10)+ 10</code> makes <code>30</code></p>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 38626753, "answer_count": 1, "score": -2, "last_activity_date": 1469677952, "creation_date": 1469671827, "last_edit_date": 1469676734, "question_id": 38626030, "link": "https://stackoverflow.com/questions/38626030/interpreting-haskell-monad-example", "title": "Interpreting Haskell monad example", "body": "<p>I have this Haskell code that triples input value.</p>\n\n<pre><code>triple :: Int -&gt; Int\ntriple = do\n  n &lt;- id\n  d &lt;- (n+)\n  (d+)\n</code></pre>\n\n<p>How does this code work? With an example <code>triple 10</code>, how the argument <code>10</code> is mapped/assigned to <code>id</code>, <code>n</code> and <code>d</code> to get the return value of 30?</p>\n\n<p>My understandig is as follows:</p>\n\n<p>We can decompose <code>triple</code> function with two subfunctions <code>tripleA</code> and <code>tripleB</code> as follows:</p>\n\n<pre><code>triple :: Int -&gt; Int\ntriple = tripleA &gt;&gt;= (\\d -&gt; tripleB d)\n\ntripleA :: Int -&gt; Int\ntripleA = id &gt;&gt;= (\\n -&gt; (n+))\n\ntripleB :: Int -&gt; Int -&gt; Int\ntripleB d = (d+)\n</code></pre>\n\n<p>Now we can see that the function <code>tripleA</code> gets an input, assign it to <code>id</code> function to return the value itself, and map it to the function <code>(\\n -&gt; (n+))</code> to return <code>(10+) 10</code>.</p>\n\n<p>Likewise, tripleB also makes <code>(20+) 20</code>, so I expect the results as 40, but the correct answer is 30. </p>\n\n<p>What is wrong with my interpretation?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 1, "creation_date": 1469681292, "post_id": 38625317, "comment_id": 64639138, "body": "You can examine the (usually pretty readable but for uniquified naming) code that GHC produces for derived instances by compiling with <code>-ddump-deriv</code>. Check section 6.13.1 of the GHC Users Guide for a list of all of the intermediate forms you can get GHC to barf up."}], "answers": [{"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 1, "last_activity_date": 1469666254, "creation_date": 1469666254, "answer_id": 38625351, "question_id": 38625317, "link": "https://stackoverflow.com/questions/38625317/clean-way-to-derive-eq/38625351#38625351", "title": "Clean way to derive Eq", "body": "<p>GHC's deriving does exactly what you describe. Given a data type <code>data X = A ... | B ... | C ...</code> it declares two values equal when they have the same constructor and all of the arguments to the constructor are equal as well. This implies that there must be an <code>Eq</code> constraint on all of the arguments of every constructor. If they are concrete types then deriving will fail at compile time if an <code>Eq</code> instance cannot be found. If they are variables then the <code>Eq</code> constraint is passed up into the <code>instance</code> definition.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 1, "last_activity_date": 1469672394, "last_edit_date": 1469672394, "creation_date": 1469666322, "answer_id": 38625360, "question_id": 38625317, "link": "https://stackoverflow.com/questions/38625317/clean-way-to-derive-eq/38625360#38625360", "title": "Clean way to derive Eq", "body": "<p>The derived instance of <code>Eq</code> returns <code>True</code> for two objects <code>x</code> and <code>y</code> if both of the below are true:</p>\n\n<ul>\n<li><code>x</code> and <code>y</code> were produced by the same data constructor (and therefore also have fields of the same types)</li>\n<li>The respective fields of <code>x</code> and <code>y</code> are equal to each other (via their respecitve <code>Eq</code> instances)</li>\n</ul>\n\n<p>For example, consider</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>The derived <code>Eq</code> instance looks like this:</p>\n\n<pre><code>instance Eq a =&gt; Eq (Maybe a) where\n   Nothing == Nothing  = True\n  (Just x) == (Just y) = x == y\n         _ == _        = False\n</code></pre>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 38625360, "answer_count": 2, "score": 0, "last_activity_date": 1469672394, "creation_date": 1469665998, "question_id": 38625317, "link": "https://stackoverflow.com/questions/38625317/clean-way-to-derive-eq", "title": "Clean way to derive Eq", "body": "<p>I'd like to declare an AST as an instance of Eq but don't want to repeat the same steps for every constructor (2 expr are the same if all their sub-terms are the same). So first question is, is the GHC \"deriving\" sufficient? What does it do? If not, is there a clean way to avoid repetition? Maybe generic programming? </p>\n"}]