[{"tags": ["haskell", "cookies", "http-headers", "servant", "haskell-wai"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1555544045, "post_id": 55736279, "comment_id": 98152404, "body": "Take a look at this page: <a href=\"http://hackage.haskell.org/package/wai-3.2.2/docs/Network-Wai.html#t:Response\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wai-3.2.2/docs/&hellip;</a>"}, {"owner": {"reputation": 1147, "user_id": 4918563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/726bb0a4339cebbfa272e71a51d340f1?s=128&d=identicon&r=PG&f=1", "display_name": "7puns", "link": "https://stackoverflow.com/users/4918563/7puns"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1555545846, "post_id": 55736279, "comment_id": 98152716, "body": "Thanks for your response. I am taking a look at the link."}], "answers": [{"tags": [], "owner": {"reputation": 1147, "user_id": 4918563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/726bb0a4339cebbfa272e71a51d340f1?s=128&d=identicon&r=PG&f=1", "display_name": "7puns", "link": "https://stackoverflow.com/users/4918563/7puns"}, "is_accepted": true, "score": 0, "last_activity_date": 1555609228, "last_edit_date": 1555609228, "creation_date": 1555570932, "answer_id": 55740705, "question_id": 55736279, "link": "https://stackoverflow.com/questions/55736279/is-there-a-way-to-access-cookie-headers-for-a-wai-web-app/55740705#55740705", "title": "Is there a way to access cookie headers for a Wai Web App?", "body": "<p>I had to use a custom Wai Middleware to log the cookie headers in the requests. Wai Middleware is <code>Application -&gt; Application</code>. The details are presented below in case someone finds it useful.</p>\n\n<pre><code>logRequestHeaders :: Application -&gt; Application\nlogRequestHeaders incoming request outgoing = do\n   let headerList = requestHeaders request\n   liftIO $ mapM_ print headerList\n   incoming request outgoing\n</code></pre>\n"}], "owner": {"reputation": 1147, "user_id": 4918563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/726bb0a4339cebbfa272e71a51d340f1?s=128&d=identicon&r=PG&f=1", "display_name": "7puns", "link": "https://stackoverflow.com/users/4918563/7puns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 55740705, "answer_count": 1, "score": 0, "last_activity_date": 1555656735, "creation_date": 1555536784, "last_edit_date": 1555656735, "question_id": 55736279, "link": "https://stackoverflow.com/questions/55736279/is-there-a-way-to-access-cookie-headers-for-a-wai-web-app", "title": "Is there a way to access cookie headers for a Wai Web App?", "body": "<p>I have a Servant web application. I need to access the cookie headers for debugging purposes. From the browser, I can access the headers including the cookie headers. From the server, I use Wai's RequestLogger to log requests. The results do not show the cookie headers, however. </p>\n\n<p>Is there a way to access the cookie headers in a Wai application?</p>\n"}, {"tags": ["javascript", "haskell", "webview"], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1556083299, "post_id": 55739584, "comment_id": 98311198, "body": "Thanks. That works. Remaining question is to get info from a textfield using <code>getElementById</code>. That would already help me get forward with <code>webviewhs</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1556096590, "post_id": 55739584, "comment_id": 98317479, "body": "@Madderote Are you asking that as a question, or simply making a comment about  what you have left to learn? If you&#39;re asking a question, it would be better to ask it as a completely new question and not write it as a comment."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1556174706, "post_id": 55739584, "comment_id": 98349060, "body": "Reading it now it seems like a new question. Will repost."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1556179762, "post_id": 55739584, "comment_id": 98351551, "body": "Thanks @Madderote! It doesn&#39;t look like your question is up yet, but I&#39;ll definitely have a look at it when it is."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1556288983, "post_id": 55739584, "comment_id": 98399442, "body": "@bradm: <a href=\"https://stackoverflow.com/questions/55869718/haskell-webviewhs-getelementbyid-from-a-webpage\" title=\"haskell webviewhs getelementbyid from a webpage\">stackoverflow.com/questions/55869718/&hellip;</a> ;-)"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 1, "last_activity_date": 1555564952, "creation_date": 1555564952, "answer_id": 55739584, "question_id": 55733340, "link": "https://stackoverflow.com/questions/55733340/haskell-webviewhs-textfields-and-returns-to-haskell/55739584#55739584", "title": "Haskell Webviewhs textfields and returns to Haskell", "body": "<p>The problem is in <code>WHS.withWindowLoop</code>. Referring to <a href=\"https://lettier.github.io/webviewhs/#v:withWindowLoop\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n\n<blockquote>\n  <p>Creates a window for you. Accepts a function that is called with each iteration of the window loop. If the accepted function returns <code>False</code>, the loop is exited and the window is destroyed. <strong>If the accepted function returns <code>True</code>, the loop is continued</strong> provided it can.</p>\n</blockquote>\n\n<p>(my emphasis)</p>\n\n<p>Note that the last parameter of <code>withWindowLoop</code> is invoked repeatedly until it returns <code>False</code>. However, you are always returning <code>True</code>, meaning that the dialog box is repeatedly opened without ever finishing the loop. I can see two ways out of this problem:</p>\n\n<ul>\n<li>Use <code>WHC.createWindow</code> instead; this function simply creates a window and returns it, without looping. This is the approach used <a href=\"https://github.com/lettier/webviewhs/blob/master/examples/how-do-i-open-an-alert-dialog.hs\" rel=\"nofollow noreferrer\">in the relevant example</a>.</li>\n<li>Keep on using <code>withWindowLoop</code>, but return <code>False</code> instead of <code>True</code>. This will stop the loop immediately after one iteration.</li>\n<li><s>If you really want to use <code>withWindowLoop</code>, then you could declare an <code>IORef</code> which is <code>True</code> at first, then changed to <code>False</code> after one iteration. That approach isn't very idiomatic though.</s> (Don't use this approach, it doesn't work, it actually launches the dialog box twice, and it's much more complicated than needed anyway)</li>\n</ul>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 55739584, "answer_count": 1, "score": 0, "last_activity_date": 1555564952, "creation_date": 1555523255, "last_edit_date": 1555523773, "question_id": 55733340, "link": "https://stackoverflow.com/questions/55733340/haskell-webviewhs-textfields-and-returns-to-haskell", "title": "Haskell Webviewhs textfields and returns to Haskell", "body": "<p>I've discovered <code>webviewhs</code> and tried it recently. It just works and I think it can do what I need it to do. Samples are abundant, but I would need some pointers of Haskell experts.</p>\n\n<pre><code>{-# LANGUAGE\n    OverloadedStrings\n  , QuasiQuotes\n#-}\n\nimport Data.Text\nimport Language.Javascript.JMacro\nimport qualified Graphics.UI.Webviewhs as WHS\n\nmain :: IO ()\nmain =\n  WHS.withWindowLoop\n    WHS.WindowParams\n      { WHS.windowParamsTitle      = \"webviewhs - How do I run some JavaScript inside the window?\"\n        -- This could be a localhost URL to your single-page application (SPA).\n      , WHS.windowParamsUri        = \"\"\n      , WHS.windowParamsWidth      = 800\n      , WHS.windowParamsHeight     = 600\n      , WHS.windowParamsResizable  = True\n      , WHS.windowParamsDebuggable = True\n      }\n    -- This is the callback JavaScript can execute.\n    (\\ _window stringFromJavaScript -&gt; print stringFromJavaScript) $\n    -- This function runs every window loop.\n    -- Return True to continue the loop or False to exit the loop.\n    \\ window -&gt; do\n      let string = \"Hello from Haskell.\" :: Text\n      -- runJavaScript returns either True on success or False on failure.\n      WHS.runJavaScript\n        window\n        [jmacro|\n          alert (\"Yahoo! Alert windows, but little too persistent!\");\n          window.external.invoke(\"Hello from JavaScript.\");\n        |]\n</code></pre>\n\n<p>If I use the code above, the alert-dialog (test) keeps popping up. I would love to have it gone after <code>ok</code>. I also tried several times to get information (<code>document.getElementById</code>) from a sites' <code>input</code> field. Cannot get that to work. For me <code>webviewhs</code> is the missing link in Haskell and I would really like to get it to work.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "edited": false, "score": 0, "creation_date": 1555512795, "post_id": 55730446, "comment_id": 98139681, "body": "Thanks! Is there a mod for Non-Integral Types too?"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "reply_to_user": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "edited": false, "score": 2, "creation_date": 1555513114, "post_id": 55730446, "comment_id": 98139889, "body": "@Laurens Also note that doing <code>if something then True else False</code> is exactly the same as doing <code>something</code>. So in your case you only need <code>save dist dur speed = modulus &lt; dur</code>"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1555520413, "post_id": 55730446, "comment_id": 98143898, "body": "Not that I know of.  I have this small function: <code>truncateSigFigsGeneric :: RealFrac a =&gt; Int -&gt; a -&gt; a truncateSigFigsGeneric n f = (fromInteger $ round $ f * (10^n)) &#47; (10.0^^n) </code>"}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1555512653, "creation_date": 1555512653, "answer_id": 55730446, "question_id": 55729661, "link": "https://stackoverflow.com/questions/55729661/various-type-errors-when-trying-to-make-this-piece-of-code-work-what-types-does/55730446#55730446", "title": "Various Type errors when trying to make this piece of Code work. What types does this function need?", "body": "<p>Haskell's <code>mod</code> only works on Integral types, and <code>/</code> only works on Fractional.  No type is both, so you'll need to be explicit about where you want to convert.  One option is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>save :: Double -&gt; Integer -&gt; Double -&gt; Bool\nsave dist dur speed\n    |modulus&lt;dur = True\n    |otherwise   = False\n    where modulus = mod (round (dist/(speed/3.6))) (2*dur)\n</code></pre>\n\n<p>If you want all the inputs to be the same type, you can insert additional conversions.</p>\n"}], "owner": {"reputation": 23, "user_id": 10255887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2915bdc5d5f64cf239284336e9741483?s=128&d=identicon&r=PG&f=1", "display_name": "Laurens", "link": "https://stackoverflow.com/users/10255887/laurens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1555515295, "answer_count": 1, "score": -1, "last_activity_date": 1555513936, "creation_date": 1555510514, "last_edit_date": 1555513936, "question_id": 55729661, "link": "https://stackoverflow.com/questions/55729661/various-type-errors-when-trying-to-make-this-piece-of-code-work-what-types-does", "closed_reason": "Duplicate", "title": "Various Type errors when trying to make this piece of Code work. What types does this function need?", "body": "<p>Im trying to make this function work:</p>\n\n<pre><code>save dist dur speed\n    |modulus&lt;dur = True\n    |otherwise   = False\n    where modulus = mod (dist/(speed/3.6)) (2*dur)\n</code></pre>\n\n<p>depending on which type declaration I use, im hit with different errors. I intend to use the function on Ints.</p>\n\n<p>I tried writing </p>\n\n<pre><code>save :: Int-&gt;Int-&gt;Int-&gt;Bool\n</code></pre>\n\n<p>and converting the Ints into more general numbers by doing </p>\n\n<pre><code>save :: Int -&gt; Int -&gt; Int -&gt; Bool\nsave dist dur speed\n    |modulus&lt;dur = True\n    |otherwise   = False\n    where ndist=fromIntegral dist\n          ndur=fromIntegral dur\n          nspeed=fromIntegral nspeed\n          modulus = mod (ndist/(nspeed/3.6)) (2*ndur)\n</code></pre>\n\n<p>With this try I get the error:</p>\n\n<pre><code> * No instance for (Fractional Int) arising from a use of `/'\n    * In the second argument of `(/)', namely `(nspeed / 3.6)'\n      In the first argument of `mod', namely `(ndist / (nspeed / 3.6))'\n      In the expression: mod (ndist / (nspeed / 3.6)) (2 * ndur)\n  |\n8 |           modulus = mod (ndist/(nspeed/3.6)) (2*ndur)\n  |                                 ^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I hope You can tell me how to make this function work and perhaps how to write it in a normal way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2530, "user_id": 3946047, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c236700abcfe23472d68334d54610451?s=128&d=identicon&r=PG", "display_name": "Peter Kraume", "link": "https://stackoverflow.com/users/3946047/peter-kraume"}, "edited": false, "score": 4, "creation_date": 1555508749, "post_id": 55728872, "comment_id": 98136962, "body": "please provide more information and error messages"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 3, "creation_date": 1555508930, "post_id": 55728872, "comment_id": 98137083, "body": "<code>xs</code> is always gonna be a list, so it will never equal <code>x</code>. Also if it&#39;s not an assignment, there are library functions for this, have a look at <code>takeWhile</code> and <code>group</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1555509257, "post_id": 55728872, "comment_id": 98137310, "body": "I have fixed the markdown syntax in your post; however, I wasn&#39;t sure exactly how to fix one part of it. Please review my edits and make sure the location of <code>else</code> in the post matches the way you&#39;ve included <code>else</code> in the file you&#39;re trying to load."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1555522794, "last_edit_date": 1555522794, "creation_date": 1555522416, "answer_id": 55733138, "question_id": 55728872, "link": "https://stackoverflow.com/questions/55728872/how-to-print-same-characters-in-a-row-in-haskell/55733138#55733138", "title": "how to print same characters in a row in haskell", "body": "<pre><code>round :: String -&gt; String\n</code></pre>\n\n<p>You say your function takes a string as input and produces a string as output.  This is good and consistent with your example of <code>round \"gggiiss\" == \"ggg\"</code>.</p>\n\n<pre><code>round [] = []\n</code></pre>\n\n<p>Your base case is an empty list input is an empty list output, sounds good.</p>\n\n<pre><code>round [x] = [x]\n</code></pre>\n\n<p>Another base case of a single element.  So I suppose that means the next case will require two or more elements right? ...</p>\n\n<pre><code>round (x:xs) = ...\n</code></pre>\n\n<p>Oh no, what happened here?  You require only one element (<code>xs</code> can be <code>[]</code>).  You probably wanted two element and the rest of the list <code>round (x1:x2:xs) ...</code>.</p>\n\n<pre><code>if xs == x \n</code></pre>\n\n<p>Well that makes no sense.  You can't compare the list, xs (such as <code>\"ggiiss\"</code>), with a single value, x (such as <code>'g'</code>).   If you used <code>x1</code> and <code>x2</code> as I showed above then <code>x1 == x2</code> would make sense as those are both characters.</p>\n\n<pre><code>then [x] ++ xs + round(xs)\n</code></pre>\n\n<p>What does it mean to add two strings togther, <code>xs + round xs</code>?  A more sensible strategy is probably concatenation <code>then [x1] ++ round (x2:xs)</code>.  I preserved the <code>x2</code> so in the recursive case you'd compare for the correct character.</p>\n\n<pre><code>else [x]\n</code></pre>\n\n<p>It is probably a copy/paste issue, but that <code>else</code> should be indented as far as the <code>then</code> case.  The final code is:</p>\n\n<pre><code>rnd :: String -&gt; String\nrnd []=[]\nrnd [x]=[x]\nrnd (x1:x2:xs) = if x1 == x2 then [x1] ++ rnd(x2:xs) else [x1]\n</code></pre>\n\n<p>P.S. You are getting downvotes for a number of reasons.  I'm guessing, but chief among them is that you didn't post the full \"here is the code\", \"this is the intent\", \"here is how I'm invoking the code\", and \"here is the error\".  SO is pretty explicit about asking users to post errors and expectations with the code and users have grown restless when that doesn't happen.</p>\n"}], "owner": {"reputation": 1, "user_id": 11374104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3384e26089669f7f19cdb25ee68122fe?s=128&d=identicon&r=PG&f=1", "display_name": "yo-yo", "link": "https://stackoverflow.com/users/11374104/yo-yo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1555522794, "creation_date": 1555508292, "last_edit_date": 1555509163, "question_id": 55728872, "link": "https://stackoverflow.com/questions/55728872/how-to-print-same-characters-in-a-row-in-haskell", "title": "how to print same characters in a row in haskell", "body": "<p>when I enter for example gggiiss as input, the output should be ggg.</p>\n\n<pre><code>round :: String -&gt; String\nround []=[]\nround [x]=[x]\nround (x:xs) = if xs == x then [x] ++ xs + round(xs)\nelse [x]\n</code></pre>\n\n<p>Code above is what I've written but I've got a lot of errors which I don't understand. Anyone knows how to correct it? Given that the first line of the code is compulsory</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1748, "user_id": 936652, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Uwfmf.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/936652/christophe"}, "is_accepted": true, "score": 0, "last_activity_date": 1555512265, "last_edit_date": 1555512265, "creation_date": 1555511913, "answer_id": 55730188, "question_id": 55728474, "link": "https://stackoverflow.com/questions/55728474/how-can-i-shift-just-the-letters-and-not-the-symbols-whitespaces/55730188#55730188", "title": "How can I shift just the letters and not the symbols/whitespaces?", "body": "<p>The script below yields the expected result:</p>\n\n<pre><code>import Data.Char (ord, chr)\n\n--lowercase letter to int conversion\nlet2int :: Char -&gt; Int\nlet2int c = ord c - ord 'a'\n\n--int to lowercase letter conversion\nint2let :: Int -&gt; Char\nint2let n = chr(ord 'a' + n)\n\ntext2ints :: String -&gt; [Int]\ntext2ints xs = map (let2int) xs\n\nints2text :: [Int] -&gt; String\nints2text xs = map (int2let) xs\n\nvigenere_encrypt :: String -&gt; String -&gt; String\nvigenere_encrypt key plaintext = zipWith merge plaintext (ints2text n)\n  where n = map (`mod` 26) (zipWith (+)  keyCycle intPlainText)\n        keyCycle = (cycle(text2ints key))\n        intPlainText = text2ints plaintext\n        merge a b = case a of\n          ' ' -&gt; ' '\n          otherwise -&gt; b\n\nmain = do\n  print $ vigenere_encrypt \"abc\" \"hello rita\"\n</code></pre>\n\n<p>Note: the code does not skip white spaces but only overwrites them... so practically speaking it means that the the number of spaces will have an impact on the encrypted string. Otherwise the program would be slightly more complex.</p>\n"}], "owner": {"reputation": 53, "user_id": 11373911, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fo6azdYkKmo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rezTtiHXp1bJaYBmtCbK0qrNAfl0g/mo/photo.jpg?sz=128", "display_name": "Guilherme Lima", "link": "https://stackoverflow.com/users/11373911/guilherme-lima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55730188, "answer_count": 1, "score": 0, "last_activity_date": 1555513922, "creation_date": 1555507130, "last_edit_date": 1555513922, "question_id": 55728474, "link": "https://stackoverflow.com/questions/55728474/how-can-i-shift-just-the-letters-and-not-the-symbols-whitespaces", "title": "How can I shift just the letters and not the symbols/whitespaces?", "body": "<p>I successfully implemented the vigen\u00e9re cipher in Haskell but it is shifting the whitespaces too. How can I shift only the letters (lower case)?</p>\n\n<p>As an example, lets say I want to encrypt \"hello rita\" with \"abc\" as the key. It is printing out \"hfnlpprjva\" instead of \"hfnlp rjva\".</p>\n\n<p><strong>Here's the main method:</strong></p>\n\n<pre><code>vigenere_encrypt :: String -&gt; String -&gt; String\nvigenere_encrypt key plaintext = ints2text n\n  where n = map (`mod` 26) (zipWith (+)  keyCycle intPlainText)\n        keyCycle = (cycle(text2ints key))\n        intPlainText = text2ints plaintext\n</code></pre>\n\n<p><strong>And here are the auxiliary functions:</strong> </p>\n\n<pre><code>--lowercase letter to int conversion\nlet2int :: Char -&gt; Int\nlet2int c = ord c - ord 'a'\n\n--int to lowercase letter conversion\nint2let :: Int -&gt; Char\nint2let n = chr(ord 'a' + n)\n\ntext2ints :: String -&gt; [Int]\ntext2ints xs = map (let2int) xs\n\nints2text :: [Int] -&gt; String\nints2text xs = map (int2let) xs\n</code></pre>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 3, "creation_date": 1555506346, "post_id": 55727699, "comment_id": 98135368, "body": "Are there specific concrete types that you&#39;re looking to use this with? This function can&#39;t be derived for just any two functors."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1555506997, "post_id": 55727699, "comment_id": 98135785, "body": "Or any two applicatives."}, {"owner": {"reputation": 343, "user_id": 2746760, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e2a4c6393f3fae7c69fb8586e6111050?s=128&d=identicon&r=PG&f=1", "display_name": "Neal Alexander", "link": "https://stackoverflow.com/users/2746760/neal-alexander"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1555508130, "post_id": 55727699, "comment_id": 98136573, "body": "@4castle: Sorry I didn&#39;t think things through well enough. I&#39;m looking for a generalized zip that can handle and convert different sequence types automatically."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555510818, "post_id": 55727699, "comment_id": 98138399, "body": "I think you would need to provide the natural transformation from one functor to the other yourself; even assuming you can get the function out of the applicative <code>f</code> and apply it to the <code>g a</code> to get a <code>g b</code>, you still need something with type <code>g b -&gt; f b</code> to get your final result."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555510996, "post_id": 55727699, "comment_id": 98138502, "body": "(Probably <i>two</i> natural transformations, the other to get a <code>g (a -&gt; b)</code> from <code>f (a -&gt; b)</code> in the first place.)"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555519320, "post_id": 55729511, "comment_id": 98143360, "body": "<code>foo [(+1),(+2),(+3)] (V.fromList [5,6,7,8])</code> works, <code>foo [(+1),(+2),(+3)] (V.fromList [5,6])</code> bombs with <code>&quot;Non-exhaustive patterns in lambda&quot;</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1555523647, "post_id": 55729511, "comment_id": 98145369, "body": "Yes, I was aware the function was partial, but I don&#39;t think there&#39;s a clear alternative.  You could <code>cycle</code> the list from <code>g</code>, which seems like a terrible idea, or you could restrict the function to <code>f</code> that are isomorphic to <code>[]</code> (e.g., use constraint <code>IsList f</code>)."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1555510115, "creation_date": 1555510115, "answer_id": 55729511, "question_id": 55727699, "link": "https://stackoverflow.com/questions/55727699/applicative-typeclass-based-on-two-different-functors/55729511#55729511", "title": "Applicative typeclass based on two different functors", "body": "<p>From your comment, I think you might be trying to construct:</p>\n\n<pre><code>import Data.Foldable\nimport Data.Traversable\nfoo :: (Traversable f, Foldable g) =&gt; f (a -&gt; b) -&gt; g a -&gt; f b\nfoo f g = snd $ mapAccumR (\\(a:as) fab -&gt; (as, fab a)) (toList g) f\n</code></pre>\n\n<p>This allows, for example:</p>\n\n<pre><code>&gt; import qualified Data.Vector as V\n&gt; foo [(+1),(+2),(+3)] (V.fromList [5,6,7])\n[8,8,8]\n&gt; \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1555523770, "post_id": 55732893, "comment_id": 98145434, "body": "Note that there is <code>fromList</code> from <code>IsList</code>, so that would work, and many standard list-isomorphic sequences will support it (e.g., <code>Vector</code> already as an instance)."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1555527497, "last_edit_date": 1555527497, "creation_date": 1555521261, "answer_id": 55732893, "question_id": 55727699, "link": "https://stackoverflow.com/questions/55727699/applicative-typeclass-based-on-two-different-functors/55732893#55732893", "title": "Applicative typeclass based on two different functors", "body": "<p><del>I don't know of any general <code>fromList</code>.</del>  I would write the concrete version, or at most generalize over the input types.  Here are examples with <code>Vector</code>, ignoring that <code>Data.Vector.zip</code> already exists.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Vector as V\nimport Data.Vector (Vector)\nimport Data.Foldable\nimport GHC.Exts (IsList(fromList))\n\nzipV1 :: Vector (a -&gt; b) -&gt; Vector a -&gt; Vector b\nzipV1 fs as = V.fromList (zipWith ($) (V.toList fs) (V.toList as))\n\nzipV2 :: (Foldable f, Foldable g, IsList (f b)) =&gt; f (a -&gt; b) -&gt; g a -&gt; f b\nzipV2 fs as = fromList (zipWith ($) (toList fs) (toList as))\n</code></pre>\n\n<p>You could use <code>IsList</code> instead of <code>Foldable</code> in the second example.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1555545070, "last_edit_date": 1555545070, "creation_date": 1555525442, "answer_id": 55733838, "question_id": 55727699, "link": "https://stackoverflow.com/questions/55727699/applicative-typeclass-based-on-two-different-functors/55733838#55733838", "title": "Applicative typeclass based on two different functors", "body": "<p>One general concept of \"sequence type\" is a free monoid. Since you're looking at polymorphic sequence types, we can build on <code>Traversable</code>.</p>\n\n<pre><code>class Semigroup1 t where\n  (&lt;=&gt;) :: t a -&gt; t a -&gt; t a\n\nclass Semigroup1 t =&gt; Monoid1 t where\n  mempty1 :: t a\n</code></pre>\n\n<p>See note below.</p>\n\n<pre><code>class (Traversable t, Monoid1 t) =&gt; Sequence t where\n  singleton :: a -&gt; t a\n</code></pre>\n\n<p>How is that a sequence type? Very inefficiently. But we could add a bunch of methods with default implementations to make it efficient. Here are some basic functions:</p>\n\n<pre><code>cons :: Sequence t =&gt; a -&gt; t a -&gt; t a\ncons x xs = singleton x &lt;=&gt; xs\n\nfromList\n  :: (Foldable f, Sequence t)\n  =&gt; f a -&gt; t a\nfromList = foldr cons mempty1\n\nuncons :: Sequence t =&gt; t a -&gt; Maybe (a, t a)\nuncons xs = case toList xs of\n  y:ys -&gt; Just (y, fromList ys)\n  [] -&gt; Nothing\n</code></pre>\n\n<p>With these tools, you can zip any two sequences to make a third.</p>\n\n<pre><code>zipApp :: (Foldable t, Foldable u, Sequence v) = t (a -&gt; b) -&gt; u a -&gt; v b\nzipApp fs xs = fromList $ zipWith ($) (toList fs) (toList xs)\n</code></pre>\n\n<hr>\n\n<h3>Note on recent GHC versions</h3>\n\n<p>For bleeding edge GHC, you can use <code>QuantifiedConstraints</code> and <code>RankNTypes</code> and <code>ConstraintKinds</code> and define</p>\n\n<pre><code>type Semigroup1 t = forall a. Semigroup (t a)\n\ntype Monoid1 t = forall a. Monoid (t a)\n</code></pre>\n\n<p>Doing it this way would let you write, e.g.,</p>\n\n<pre><code>fromList = foldMap singleton\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1555528641, "post_id": 55734521, "comment_id": 98147538, "body": "A practical example of <code>Day</code>: my &quot;process-streaming&quot; library uses <code>Day</code> internally to combine handlers for the stdin, stdout and stderr of an external process into a single <code>Applicative</code>. <a href=\"http://hackage.haskell.org/package/process-streaming-0.9.3.0/docs/System-Process-Streaming.html#t:Streams\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/process-streaming-0.9.3.0/docs/&hellip;</a> It also uses the <code>Lift</code> trick."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 5, "last_activity_date": 1555536384, "last_edit_date": 1555536384, "creation_date": 1555528498, "answer_id": 55734521, "question_id": 55727699, "link": "https://stackoverflow.com/questions/55727699/applicative-typeclass-based-on-two-different-functors/55734521#55734521", "title": "Applicative typeclass based on two different functors", "body": "<p>(Following a suggestion from @dfeuer in the comments.)</p>\n\n<p>There is a construction called <a href=\"http://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Day.html\" rel=\"noreferrer\">day convolution</a> that lets you preserve the distinction between two functors when performing applicative operations, and delay the moment of transforming one into the other.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Day.html#t:Day\" rel=\"noreferrer\"><code>Day</code></a> type is simply a pair of functorial values, together with a function that combines their respective results:</p>\n\n<pre><code>data Day f g a = forall b c. Day (f b) (g c) (b -&gt; c -&gt; a)\n</code></pre>\n\n<p>Notice that the actual return values of the functors are existencialized; the return value of the composition is that of the function.</p>\n\n<p><code>Day</code> has advantages over other ways of combining applicative functors. Unlike <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Sum.html\" rel=\"noreferrer\"><code>Sum</code></a>, the composition is still applicative. Unlike <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\"><code>Compose</code></a>, the composition is \"unbiased\" and doesn't impose a nesting order. Unlike <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Product.html\" rel=\"noreferrer\"><code>Product</code></a>, it lets us easily combine applicative actions with <em>different</em> return types, we just need to provide a suitable adapter function.</p>\n\n<p>For example, here are two <code>Day ZipList (Vec Nat2) Char</code> values:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\nimport           Data.Functor.Day -- from \"kan-extensions\"\nimport           Data.Type.Nat -- from \"fin\"\nimport           Data.Vec.Lazy -- from \"vec\"\nimport           Control.Applicative\n\nday1 :: Day ZipList (Vec Nat2) Char\nday1 = Day (pure ()) ('b' ::: 'a' ::: VNil) (flip const)\n\nday2 :: Day ZipList (Vec Nat2) Char\nday2 = Day (ZipList \"foo\") (pure ()) const\n</code></pre>\n\n<p>(<a href=\"http://hackage.haskell.org/package/fin-0.0.1/docs/Data-Type-Nat.html#t:Nat2\" rel=\"noreferrer\"><code>Nat2</code></a> is from the <a href=\"http://hackage.haskell.org/package/fin-0.0.1/docs/Data-Type-Nat.html\" rel=\"noreferrer\">fin</a> package, it is used to parameterize a fixed-size <code>Vec</code> from <a href=\"http://hackage.haskell.org/package/vec-0.1/docs/Data-Vec-Lazy.html\" rel=\"noreferrer\">vec</a>.)</p>\n\n<p>We can zip them together just fine:</p>\n\n<pre><code>res :: Day ZipList (Vec Nat2) (Char,Char)\nres = (,) &lt;$&gt; day1 &lt;*&gt; day2\n</code></pre>\n\n<p>And then transform the <code>Vec</code> into a <code>ZipList</code> and collapse the <code>Day</code>:</p>\n\n<pre><code>res' :: ZipList (Char,Char)\nres' = dap $ trans2 (ZipList . toList) res\n\nghci&gt; res'\nZipList {getZipList = [('b','f'),('a','o')]}\n</code></pre>\n\n<p>Using the <a href=\"http://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Day.html#v:dap\" rel=\"noreferrer\"><code>dap</code></a> and <a href=\"http://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Day.html#v:trans2\" rel=\"noreferrer\"><code>trans2</code></a> functions.</p>\n\n<p>Possible performance catch: when we lift one of the functors to <code>Day</code>, the other is given a dummy <code>pure ()</code> value. But this is dead weight when combining <code>Day</code>s with <code>(&lt;*&gt;)</code>. One can work smarter by wrapping the functors in <a href=\"http://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Applicative-Lift.html\" rel=\"noreferrer\"><code>Lift</code></a> for transformers, to get faster operations for the simple \"pure\" cases.</p>\n"}], "owner": {"reputation": 343, "user_id": 2746760, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e2a4c6393f3fae7c69fb8586e6111050?s=128&d=identicon&r=PG&f=1", "display_name": "Neal Alexander", "link": "https://stackoverflow.com/users/2746760/neal-alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 55734521, "answer_count": 4, "score": 3, "last_activity_date": 1555545070, "creation_date": 1555504506, "last_edit_date": 1555537258, "question_id": 55727699, "link": "https://stackoverflow.com/questions/55727699/applicative-typeclass-based-on-two-different-functors", "title": "Applicative typeclass based on two different functors", "body": "<p>Is there something similar to the <code>Applicative</code> type class, but where there are two functors for each side of the application which are different?</p>\n\n<p>i.e. <code>(&lt;*&gt;) :: (Functor f, Functor g) =&gt; f (a -&gt; b) -&gt; g a -&gt; f b</code> </p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555476502, "post_id": 55720028, "comment_id": 98119925, "body": "Exactly which regex library are you using?"}, {"owner": {"reputation": 1, "user_id": 11371803, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SKL5bjjMGRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7xg_WTfx1kzGw7fUwHYHrdv1HiQ/mo/photo.jpg?sz=128", "display_name": "Prakhar Nair", "link": "https://stackoverflow.com/users/11371803/prakhar-nair"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555476854, "post_id": 55720028, "comment_id": 98120014, "body": "I&#39;m using the Text.Regex.PCRE library for this. If that&#39;s not what you were asking for sorry, I&#39;m still new to haskell."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555476949, "post_id": 55720028, "comment_id": 98120045, "body": "Thanks @PrakharNair, that&#39;s exactly what I wanted to know. Haskell has lots of regex libraries and they all behave slightly differently."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477030, "post_id": 55720028, "comment_id": 98120065, "body": "Also @PrakharNair, could you edit your question to format your code properly? You can do it by highlighting your code block and pressing <code>Control+K</code>."}, {"owner": {"reputation": 1, "user_id": 11371803, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SKL5bjjMGRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7xg_WTfx1kzGw7fUwHYHrdv1HiQ/mo/photo.jpg?sz=128", "display_name": "Prakhar Nair", "link": "https://stackoverflow.com/users/11371803/prakhar-nair"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477146, "post_id": 55720028, "comment_id": 98120106, "body": "Sorry about that, just fixed it."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477310, "post_id": 55720028, "comment_id": 98120165, "body": "A few questions on your code now: what is <code>RE</code> for? How is it related to the <code>regex-pcre</code> library you&#39;re using? As far as I can see <code>atMost2As</code> should be <code>(Symbol A :+: Symbol A) :|: (Symbol A :|: Empty)</code> - is this what you wanted to know?"}, {"owner": {"reputation": 1, "user_id": 11371803, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SKL5bjjMGRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7xg_WTfx1kzGw7fUwHYHrdv1HiQ/mo/photo.jpg?sz=128", "display_name": "Prakhar Nair", "link": "https://stackoverflow.com/users/11371803/prakhar-nair"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477490, "post_id": 55720028, "comment_id": 98120221, "body": "Oh, okay I see. Yeah RE was the structure provided, but since I was having issues with that I wanted to see if I could use <code>regex-pcre</code>. What you see makes a lot more sense, thank you very much for the assistance, it&#39;ll help me finish the rest of the assignment."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477566, "post_id": 55720028, "comment_id": 98120244, "body": "You&#39;re welcome @PrakhairNair. Should I put my solution as an answer?"}, {"owner": {"reputation": 1, "user_id": 11371803, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SKL5bjjMGRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7xg_WTfx1kzGw7fUwHYHrdv1HiQ/mo/photo.jpg?sz=128", "display_name": "Prakhar Nair", "link": "https://stackoverflow.com/users/11371803/prakhar-nair"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555477729, "post_id": 55720028, "comment_id": 98120290, "body": "Yes, I think that made a lot of sense, and I&#39;m honestly surprised I didn&#39;t think about it like that!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1555509778, "post_id": 55720028, "comment_id": 98137676, "body": "Voting to close for exactly the same reason I voted to close <a href=\"https://stackoverflow.com/questions/55619622/i-need-help-understanding-how-to-do-the-function-in-haskell-atmost2as\">this exact question</a> last week."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 1, "last_activity_date": 1555477858, "creation_date": 1555477858, "answer_id": 55720319, "question_id": 55720028, "link": "https://stackoverflow.com/questions/55720028/having-problems-implemeting-regex-into-haskell/55720319#55720319", "title": "Having problems implemeting Regex into Haskell", "body": "<pre><code>atMost2As :: RE ABC\natMost2As = undefined \n</code></pre>\n\n<p>As I mentioned in the comments, a reasonable implementation for this could be:</p>\n\n<pre><code>atMost2As = (a :+: a) :|: (a :|: Empty)\n  where\n    a = Symbol A\n</code></pre>\n\n<p>This describes a regex where there are at most two <code>a</code>s: either there are two <code>a</code>s, or there is one <code>a</code>, or the solution is <code>Empty</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 11371803, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SKL5bjjMGRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7xg_WTfx1kzGw7fUwHYHrdv1HiQ/mo/photo.jpg?sz=128", "display_name": "Prakhar Nair", "link": "https://stackoverflow.com/users/11371803/prakhar-nair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1555477858, "creation_date": 1555476161, "last_edit_date": 1555477136, "question_id": 55720028, "link": "https://stackoverflow.com/questions/55720028/having-problems-implemeting-regex-into-haskell", "title": "Having problems implemeting Regex into Haskell", "body": "<p>So I have an assignment due and it's asking to utilize RegEx with Haskell to come up with a solution. I will link it at the bottom. Basically, my issues does not lie within the Regex, I understand how to find 2As using Regex normally, but when it comes to Haskell and this declaration, I don't know how to actually go about this without finding an error. </p>\n\n<p>I've tried my own implementations of the RegEx: which is [AA]{2} in the case of just finding 2 As, but I cannot for the life of me figure out how to make it work in Haskell, and the declaration given was much more confusing. </p>\n\n<pre><code>module Project3 where\n\ndata RE a\n    = Symbol a\n    | Empty\n    | RE a :+: RE a\n    | RE a :|: RE a\n    | Repeat (RE a)\n    | Plus (RE a)\n    deriving (Show, Read, Eq, Ord)\n\ndata ABC = A | B | C deriving (Show, Read, Eq, Ord)\n\n\natMost2As :: RE ABC\natMost2As = undefined \n</code></pre>\n\n<p>This is the current problem. I have been trying to mess around with '=~ \"[AA]{2}\"', and similar concepts, but I still am getting errors since this does not expect arguments. </p>\n\n<p>The language for atMost2As includes exactly those strings in which A occurs no more than twice, is what it is supposed to yield. Overall I can't find the issue.</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 7, "last_activity_date": 1555465397, "creation_date": 1555465397, "answer_id": 55718756, "question_id": 55718727, "link": "https://stackoverflow.com/questions/55718727/disambiguate-the-operator-in-aeson-in-haskell/55718756#55718756", "title": "Disambiguate the .= operator in Aeson in Haskell", "body": "<p>If you're OK with defining <code>.=</code> in your file to be the one from Aeson, you can simply hide the import of <code>.=</code> from <code>Control.Lens</code>:</p>\n\n<pre><code>import Control.Lens hiding ((.=))\n</code></pre>\n\n<p>Outer brackets are the import hiding list, inner brackets required due to <code>.=</code> being an operator - that is, having a name with non-alphanumeric characters.</p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1555570452, "post_id": 55718758, "comment_id": 98158311, "body": "The trouble with this is that it just adds an additional ambiguity if defined at the top level. (If defined locally, it just shadows the top-level definitions, of course.) This notation can be used inline, though: either <code>&quot;code&quot; Data.Aeson..= recCode</code>, or <code>&quot;code&quot; A..= recCode</code> given <code>import qualified Data.Aeson as A</code>. Still, hiding the Lens import\u2014or better, using an explicit import list and omitting <code>(.=)</code> from it\u2014is preferable."}], "tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": false, "score": 2, "last_activity_date": 1555465420, "creation_date": 1555465420, "answer_id": 55718758, "question_id": 55718727, "link": "https://stackoverflow.com/questions/55718727/disambiguate-the-operator-in-aeson-in-haskell/55718758#55718758", "title": "Disambiguate the .= operator in Aeson in Haskell", "body": "<p>The answer can be found by reading the error output more carefully to see two periods, and surrounding the (whole thing) with parens as an operator.  This works</p>\n\n<pre><code>(.=) = (Data.Aeson..=)\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 55718756, "answer_count": 2, "score": 1, "last_activity_date": 1555465420, "creation_date": 1555465166, "question_id": 55718727, "link": "https://stackoverflow.com/questions/55718727/disambiguate-the-operator-in-aeson-in-haskell", "title": "Disambiguate the .= operator in Aeson in Haskell", "body": "<p>I am trying to rename keys when serializing an object to json.</p>\n\n<p>I understand the way to do that is to, rather than just using deriving generic, define an instance with custom key names like so:</p>\n\n<pre><code>-- instance ToJSON R2  -- old\ninstance ToJSON R2 where\n  toJSON (R2 recCode recDate) = object [ \"code\" .= recCode , \"date\" .= recDate ]\n-- new\n</code></pre>\n\n<p>However, this gives me:</p>\n\n<pre><code>&lt;interactive&gt;:2:70: error:\n    Ambiguous occurrence \u2018.=\u2019\n    It could refer to either \u2018Data.Aeson..=\u2019, imported from \u2018Data.Aeson\u2019 (and originally defined in \u2018aeson-1.3.1.1:Data.Aeson.Types.ToJSON\u2019)\n                          or \u2018Control.Lens..=\u2019, imported from \u2018Control.Lens\u2019 (and originally defined in \u2018Control.Lens.Setter\u2019)\n</code></pre>\n\n<p>My attempt to fix this was to explicitly force the meaning of the <code>.=</code> operator by defining it in my code, eg:</p>\n\n<pre><code>(.=) = Data.Aeson.(.=)\n</code></pre>\n\n<p>This was a guess, but seems like the wrong syntax.  I added the parens by analogy to the following resources:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/aeson-0.6.1.0/docs/src/Data-Aeson-Types-Class.html#.%3D\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/aeson-0.6.1.0/docs/src/Data-Aeson-Types-Class.html#.%3D</a></li>\n<li><a href=\"http://www.stephendiehl.com/posts/protolude.html\" rel=\"nofollow noreferrer\">http://www.stephendiehl.com/posts/protolude.html</a></li>\n<li><a href=\"https://stackoverflow.com/a/18372384/1052117\">https://stackoverflow.com/a/18372384/1052117</a></li>\n</ul>\n\n<p>This gave me this error:</p>\n\n<pre><code>(.=) = Data.Aeson (.=)\n\n&lt;interactive&gt;:1:8: error:\n    Not in scope: data constructor \u2018Data.Aeson\u2019\n    No module named \u2018Data\u2019 is imported.\n</code></pre>\n\n<p>What is the correct syntax to say, \"let <code>.=</code> be unambiguously the <code>.=</code> from <code>Data.Aeson</code>\" ?</p>\n"}, {"tags": ["haskell", "syntax", "function-call"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1555449994, "post_id": 55716800, "comment_id": 98114175, "body": "Looks just like a bracketing error to me. <code>Node (state act Root 0 [])</code> says you&#39;re giving the <code>Node</code> constructor 1 parameter, whose value as <code>state act Root 0 []</code>. I believe you meant the same with no parentheses: <code>Node state act Root 0 []</code>, which is how you apply 5 arguments to a function in Haskell."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1555450549, "post_id": 55716800, "comment_id": 98114375, "body": "Haskell functions are called <code>fun arg1 arg2 arg4</code>, not <code>fun (arg1 arg2 arg3)</code> \u2014 the latter is read like <code>fun(arg1(arg2, arg3))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1555450092, "creation_date": 1555450092, "answer_id": 55716860, "question_id": 55716800, "link": "https://stackoverflow.com/questions/55716800/node-is-applied-to-too-few-arguments-even-though-there-are-exact-number/55716860#55716860", "title": "&quot;\u2018Node\u2019 is applied to too few arguments&quot; even though there are exact number", "body": "<p>Parentheses are used for grouping expressions. <code>(length \"hello\" + 2)</code> is a single value, not 4.</p>\n\n<p>Similarly, <code>Node (...)</code> applies <code>Node</code> to a single argument: <code>(state act Root 0 [])</code>. Obviously that's wrong (and would require <code>state</code> to be a function taking four arguments).</p>\n\n<p>The solution is to just remove the parentheses:</p>\n\n<pre><code>Node state act Root 0 []\n</code></pre>\n\n<p>Now <code>Node</code> is applied to five arguments.</p>\n"}], "owner": {"reputation": 35, "user_id": 11355899, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CSjma9U_d88/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DWp_YTCLzhRz2zjqVHFLjHd50HZTw/mo/photo.jpg?sz=128", "display_name": "Cruceru Vlad", "link": "https://stackoverflow.com/users/11355899/cruceru-vlad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 55716860, "answer_count": 1, "score": 0, "last_activity_date": 1555779385, "creation_date": 1555449775, "last_edit_date": 1555779385, "question_id": 55716800, "link": "https://stackoverflow.com/questions/55716800/node-is-applied-to-too-few-arguments-even-though-there-are-exact-number", "title": "&quot;\u2018Node\u2019 is applied to too few arguments&quot; even though there are exact number", "body": "<p><code>s</code> and <code>a</code> are type variables. \nIn the constructor the first two param are the data, then its parent, its level in the graph and then a list of its children.</p>\n\n<pre><code>data Node s a = Root | Node s a (Node s a) Int [Node s a]\ncreateRoot :: (ProblemState s a) =&gt; s-&gt; a -&gt; Node s a\ncreateRoot state act= Node (state act Root 0 [])\n</code></pre>\n\n<p>And I've passed the exact same amount of 5 arguments to Node constructor, however I'm getting errors.</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Node s a\u2019\n              with actual type \u2018a1\n                                -&gt; Node s1 a1 -&gt; Int -&gt; [Node s1 a1] -&gt; Node s1 a1\u2019\n\u2022 Probable cause: \u2018Node\u2019 is applied to too few arguments\n  In the expression: Node (state act Root 0 [])\n  In an equation for \u2018createRoot\u2019:\n      createRoot state act = Node (state act Root 0 [])\n\u2022 Relevant bindings include\n    act :: a (bound at Search.hs:43:24)\n    state :: s (bound at Search.hs:43:18)\n    createRoot :: s -&gt; a -&gt; Node s a (bound at Search.hs:43:1)\n</code></pre>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555449969, "post_id": 55716502, "comment_id": 98114163, "body": "In general, you can use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-PackageImports\" rel=\"nofollow noreferrer\"><code>PackageImports</code></a> for things like this."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555450624, "post_id": 55716502, "comment_id": 98114404, "body": "Related: <a href=\"https://stackoverflow.com/questions/38636436/how-to-uninstall-a-haskell-package-installed-with-stack\" title=\"how to uninstall a haskell package installed with stack\">stackoverflow.com/questions/38636436/&hellip;</a>"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1555451005, "post_id": 55716502, "comment_id": 98114506, "body": "In my experience, you&#39;re not really supposed to be using stack to install things globally. It just leads to headaches like this every single time. Instead, you can create a sandbox environment for your project directory, and all dependencies (including your ghc binary) will be managed independently inside that directory. <a href=\"https://docs.haskellstack.org/en/stable/README/#quick-start-guide\" rel=\"nofollow noreferrer\">resource</a>"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555451340, "post_id": 55716502, "comment_id": 98114616, "body": "In your specific case here, as far as I can tell, <a href=\"http://hackage.haskell.org/package/regex-pcre\" rel=\"nofollow noreferrer\">regex-pcre</a> and <a href=\"http://hackage.haskell.org/package/regex-pcre-builtin\" rel=\"nofollow noreferrer\">regex-pcre-builtin</a> are different builds of the same package, so they should be interchangeable. Since <code>regex-pcre-text</code>  requires <code>regex-pcre-builtin</code>, as long as none of your dependencies require <code>regex-pcre</code> I would remove that. Then when you import <code>Text.Regex.PCRE</code>, it&#39;ll use <code>regex-pcre-builtin</code>, which should work as expected."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555451488, "post_id": 55716502, "comment_id": 98114658, "body": "Simply <code>import Text.Regex.PCRE</code> produces <code>&lt;interactive&gt;:1:1: error: Ambiguous module name \u2018Text.Regex.PCRE\u2019: it was found in multiple packages: regex-pcre-0.94.4 regex-pcre-builtin-0.94.4.8.8.35</code>"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555451971, "post_id": 55716502, "comment_id": 98114798, "body": "Yes, that means <code>Text.Regex.PCRE</code> was found in both <code>regex-pcre</code> (which I assume you had installed earlier) and <code>regex-pcre-builtin</code> (which was installed as a dependency of <code>regex-pcre-text</code>, and should be equivalent to <code>regex-pcre</code> as far as I can tell)."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555452223, "post_id": 55716502, "comment_id": 98114860, "body": "In response to your Update 1, <code>ghc-pkg unregister</code> takes a package id, which can be retrieved by doing <code>ghc-pkg field regex-pcre-text id</code> (according to the comments in the linked answer). Although I get the feeling that doing this won&#39;t unregister any of the dependencies, so you&#39;d have to do those manually. Or, alternatively, you can unregister <code>regex-pcre</code> since <code>regex-pcre-builtin</code> appears to be the same interface."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1555514727, "post_id": 55728759, "comment_id": 98140961, "body": "Thanks, this was exactly it---I both had to run it outside of a project directory and it likely succeeded even though it displayed an error message, which confused me.  Doing this fixed my problem."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1555507913, "creation_date": 1555507913, "answer_id": 55728759, "question_id": 55716502, "link": "https://stackoverflow.com/questions/55716502/haskell-stack-how-to-revert-ambiguous-module-names-found-in-multiple-packages-g/55728759#55728759", "title": "Haskell stack, how to revert ambiguous module names found in multiple packages globally", "body": "<p>The issue is that <code>regexp-pcre-text</code> installed its dependency <code>regex-pcre-builtin</code> which caused the conflict.  You want to run <em>both</em> of the following commands in the global project (i.e., outside of any specific project directory):</p>\n\n<pre><code>$ stack exec ghc-pkg unregister regex-pcre-text\n$ stack exec ghc-pkg unregister regex-pcre-builtin\n</code></pre>\n\n<p>You already ran the first, and I suspect it completed successfully, despite the warning message about the <code>abi-depends</code> fields, so you just need to run the second.</p>\n\n<p>(These <em>could</em> be combined into a single command:</p>\n\n<pre><code>$ stack exec ghc-pkg unregister regex-pcre-text regex-pcre-builtin\n</code></pre>\n\n<p>but given you already removed the first package, I believe this would fail with a message that <code>regex-pcre-text</code> wasn't found.)</p>\n\n<p>The solution mentioned by @DarthFennec is to use the <code>PackageImports</code> extension to resolve the conflict.  From GHCi, it would look like this, to use the module from the <code>regex-pcre</code> package even with both packages installed:</p>\n\n<pre><code>Prelude&gt; :set -XPackageImports\nPrelude&gt; import \"regex-pcre\" Text.Regex.PCRE\nPrelude Text.Regex.PCRE&gt;\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 0, "accepted_answer_id": 55728759, "answer_count": 1, "score": 2, "last_activity_date": 1555507913, "creation_date": 1555448276, "last_edit_date": 1555451395, "question_id": 55716502, "link": "https://stackoverflow.com/questions/55716502/haskell-stack-how-to-revert-ambiguous-module-names-found-in-multiple-packages-g", "title": "Haskell stack, how to revert ambiguous module names found in multiple packages globally", "body": "<p>While <a href=\"https://stackoverflow.com/questions/55716009/what-is-this-haskell-regex-error-telling-me-no-instance-for-regexlike-regex-te#comment98112794_55716009\">trying to debug a different question</a>, I installed a package that seems to conflict with some of my other installed packages.</p>\n\n<p>I ran </p>\n\n<pre><code>$ stack install regex-pcre-text\nregex-pcre-builtin-0.94.4.8.8.35: configure\nregex-tdfa-1.2.3.1: download\nregex-pcre-builtin-0.94.4.8.8.35: build\nregex-tdfa-1.2.3.1: configure\nregex-tdfa-1.2.3.1: build\nregex-pcre-builtin-0.94.4.8.8.35: copy/register\nregex-tdfa-1.2.3.1: copy/register\nregex-tdfa-text-1.0.0.3: download    \nregex-tdfa-text-1.0.0.3: configure   \nregex-tdfa-text-1.0.0.3: build       \nregex-tdfa-text-1.0.0.3: copy/register\nregex-pcre-text-0.94.0.1: download    \nregex-pcre-text-0.94.0.1: configure   \nregex-pcre-text-0.94.0.1: build       \nregex-pcre-text-0.94.0.1: copy/register\nCompleted 4 action(s).                \n</code></pre>\n\n<p>I can no longer simply import </p>\n\n<pre><code>Text.Regex.PCRE\n</code></pre>\n\n<p>When I try, I now see:</p>\n\n<pre><code>$ stack ghci\nPrelude&gt; :set -XOverloadedStrings\nPrelude&gt; import Text.Regex.PCRE\n</code></pre>\n\n<p>Yields</p>\n\n<pre><code>&lt;no location info&gt;: error:\n    Ambiguous module name \u2018Text.Regex.PCRE\u2019:\n      it was found in multiple packages:\n      regex-pcre-0.94.4 regex-pcre-builtin-0.94.4.8.8.35\n</code></pre>\n\n<p>I would like to revert my installation to the earlier state such that code on my machine that imports <code>Text.Regex.PCRE</code> without qualification continues to work as it used to. </p>\n\n<p>However, it looks like stack does not have a clear uninstall:</p>\n\n<pre><code>$ stack uninstall regex-pcre-text\n\nError: stack does not manage installations in global locations. The only global mutation stack performs is executable copying. For the default executable destination, please run stack path --local-bin\n</code></pre>\n\n<p>I hesitate to simply run this <code>stack path --local-bin</code> because I don't know what it's going to do, or whether it can be reversed (which was my error in installing the above package in the first place).  What is the right fix for my import problem?</p>\n\n<h2>Update 1</h2>\n\n<p>I tried suggestions <a href=\"https://stackoverflow.com/questions/38636436/how-to-uninstall-a-haskell-package-installed-with-stack\">here</a>:</p>\n\n<pre><code>$ ghc-pkg unregister regex-pcre-text\nghc-pkg: cannot find package regex-pcre-text\n\n$ stack exec ghc-pkg unregister regex-pcre-text\nignoring (possibly broken) abi-depends field for packages\n</code></pre>\n"}, {"tags": ["haskell", "pcre"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1555446466, "post_id": 55716009, "comment_id": 98112704, "body": "In your manual tests you use <code>String</code>, not <code>Text</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1555446529, "post_id": 55716009, "comment_id": 98112728, "body": "Hmm, I don&#39;t understand.  I have set overloadedstrings in my ghci session. So I should be using a text, right?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1555446551, "post_id": 55716009, "comment_id": 98112738, "body": "Why would it use <code>Text</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1555446706, "post_id": 55716009, "comment_id": 98112794, "body": "Have you tried using <a href=\"https://hackage.haskell.org/package/regex-pcre-text\" rel=\"nofollow noreferrer\"><code>Text.Regex.PCRE.Text</code></a>?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555447432, "post_id": 55716009, "comment_id": 98113079, "body": "In the Haddock, I don&#39;t see <code>Text</code> anywhere in the derives for <code>RegexLike</code>, just <code>String</code> and <code>ByteString</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1555448572, "post_id": 55716009, "comment_id": 98113594, "body": "<code>OverloadedStrings</code> means that a string literal can be used to create values of multiple different types, not just <code>Text</code>. In your tests, you don&#39;t specify a type for the string literals, so they default to <code>String</code>. In <code>cparse</code>, the declared type for <code>raw</code> forces the use to <code>Text</code>; <code>OverloadedStrings</code> just means that <code>&#39;^\\\\$&quot;</code> will have type <code>Text</code>, not that <code>=~</code> will work with <code>Text</code>."}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555445880, "creation_date": 1555445880, "question_id": 55716009, "link": "https://stackoverflow.com/questions/55716009/what-is-this-haskell-regex-error-telling-me-no-instance-for-regexlike-regex-te", "title": "What is this haskell regex error telling me: No instance for (RegexLike Regex Text) arising from a use of \u2018=~\u2019", "body": "<p>I'm making a parser function for small strings that contain currency information.</p>\n\n<p>I'm getting an error message about the regex syntax, <code>=~</code>, that is unclear to me.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings, FlexibleContexts, RankNTypes, KindSignatures, DataKinds #-}\nimport Data.Time\nimport Data.Text as T\nimport Text.Regex.PCRE\n\ndata Currency = USD | EUR | JPN deriving (Show, Generic)\n\n-- -- Currency part\ncparse :: Text -&gt; Currency\ncparse raw\n    | (raw =~ \"^\\\\$\" :: Bool) = USD\n    | (raw =~ \"^\u00a5\" :: Bool)   = JPN\n    | (raw =~ \"^\u20ac\" :: Bool)   = EUR\n    | (raw =~ \"USD$\" :: Bool) = USD\n    | (raw =~ \"JPN$\" :: Bool) = JPN\n    | (raw =~ \"EUR$\" :: Bool) = EUR\n    | otherwise               = USD\n</code></pre>\n\n<p>My tests for these conditions work as expected:</p>\n\n<pre><code>Prelude Text.Regex.PCRE&gt; (\"$12\" =~ \"^\\\\$\" :: Bool)\nTrue\nPrelude Text.Regex.PCRE&gt; (\"\u00a512\" =~ \"^\\\\$\" :: Bool)\nFalse\nPrelude Text.Regex.PCRE&gt; (\"\u00a512\" =~ \"^\u00a5\" :: Bool)\nTrue\nPrelude Text.Regex.PCRE&gt; (\"12USD\" =~ \"USD$\" :: Bool)\nTrue\nPrelude Text.Regex.PCRE&gt; (\"12USF\" =~ \"USD$\" :: Bool)\nFalse\n</code></pre>\n\n<p>But when I try to define this function, here's my error:</p>\n\n<pre><code>&lt;interactive&gt;:14:8: error:\n    \u2022 No instance for (RegexLike Regex Text) arising from a use of \u2018=~\u2019\n    \u2022 In the expression: (raw =~ \"^\\\\$\" :: Bool)\n      In a stmt of a pattern guard for\n                     an equation for \u2018cparse\u2019:\n        (raw =~ \"^\\\\$\" :: Bool)\n      In an equation for \u2018cparse\u2019:\n          cparse raw\n            | (raw =~ \"^\\\\$\" :: Bool) = USD\n            | (raw =~ \"^\u00a5\" :: Bool) = JPN\n            | (raw =~ \"^\u20ac\" :: Bool) = EUR\n            | (raw =~ \"USD$\" :: Bool) = USD\n            | (raw =~ \"JPN$\" :: Bool) = JPN\n            | (raw =~ \"EUR$\" :: Bool) = EUR\n            | otherwise = USD\n</code></pre>\n\n<p>Since the regex itself works, I don't think I'm using the regex library incorrectly, even though that is what the error strongly says.</p>\n\n<p>My hunch is something is wrong in the way I wrote my guard, but I can't tell what.  What am I getting wrong?</p>\n"}, {"tags": ["haskell", "stream", "expression", "evaluation", "let"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "edited": false, "score": 0, "creation_date": 1555445908, "post_id": 55715909, "comment_id": 98112460, "body": "This is actually a practice problem for an exam coming up and the solution was said to be [1,2,4,8]"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "edited": false, "score": 3, "creation_date": 1555445948, "post_id": 55715909, "comment_id": 98112477, "body": "@csj Then either the practice problem is wrong, or you copied it down wrong. If you type into GHCi exactly what you posted in your question (after doing <code>:set +m</code> of course), it will give you <code>[1,3,9,27]</code>."}, {"owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "edited": false, "score": 0, "creation_date": 1555447352, "post_id": 55715909, "comment_id": 98113041, "body": "oh I&#39;m so sorry it was supposed to be * not + for b, I just edited the question"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1556096315, "post_id": 55715909, "comment_id": 98317305, "body": "<code>f a</code> returns same values as <code>iterate (*a) 1</code> of course, but it does it in a very different, radically slower way (is quadratic instead of linear). this can be seen if we reduce it step by step."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 6, "last_activity_date": 1555447479, "last_edit_date": 1555447479, "creation_date": 1555445394, "answer_id": 55715909, "question_id": 55715331, "link": "https://stackoverflow.com/questions/55715331/haskell-let-expressions-evaluation/55715909#55715909", "title": "Haskell Let Expressions Evaluation", "body": "<p>Here's a step-by-step explanation:</p>\n\n<pre><code>let a = 2\n    b = 1:[i * 2 | i &lt;- b]\n    f a = 1:[i * a | i &lt;- (f a)]\nin take (a+2) (f (head (tail b) ))\n</code></pre>\n\n<p>There's two different variables called <code>a</code> in there, and one shadows the other, so first let's rename one of them to avoid accidentally mixing them up:</p>\n\n<pre><code>let outer_a = 2\n    b = 1:[i * 2 | i &lt;- b]\n    f a = 1:[i * a | i &lt;- (f a)]\nin take (outer_a+2) (f (head (tail b) ))\n</code></pre>\n\n<p>Now we can substitute in <code>outer_a</code> and evaluate the <code>+</code>:</p>\n\n<pre><code>let b = 1:[i * 2 | i &lt;- b]\n    f a = 1:[i * a | i &lt;- (f a)]\nin take 4 (f (head (tail b) ))\n</code></pre>\n\n<p>Rewrite the list comprehensions in terms of <code>map</code>:</p>\n\n<pre><code>let b = 1:map (* 2) b\n    f a = 1:map (* a) (f a)\nin take 4 (f (head (tail b) ))\n</code></pre>\n\n<p>Use <code>iterate</code> instead of explicit recursion:</p>\n\n<pre><code>let b = iterate (* 2) 1\n    f a = iterate (* a) 1\nin take 4 (f (head (tail b) ))\n</code></pre>\n\n<p>Evaluate the first two steps of <code>b</code>:</p>\n\n<pre><code>let b = 1:2:iterate (* 2) 4\n    f a = iterate (* a) 1\nin take 4 (f (head (tail b) ))\n</code></pre>\n\n<p>Substitute in <code>b</code>:</p>\n\n<pre><code>let f a = iterate (* a) 1\nin take 4 (f (head (tail (1:2:iterate (* 2) 4)) ))\n</code></pre>\n\n<p>Evaluate <code>tail</code>:</p>\n\n<pre><code>let f a = iterate (* a) 1\nin take 4 (f (head (2:iterate (* 2) 4) ))\n</code></pre>\n\n<p>Evaluate <code>head</code>:</p>\n\n<pre><code>let f a = iterate (* a) 1\nin take 4 (f 2)\n</code></pre>\n\n<p>Substitute in <code>f a</code>:</p>\n\n<pre><code>take 4 (iterate (* 2) 1)\n</code></pre>\n\n<p>Evaluate <code>iterate</code> a few times:</p>\n\n<pre><code>take 4 (1:2:4:8:iterate (* 2) 16)\n</code></pre>\n\n<p>Evaluate <code>take</code>:</p>\n\n<pre><code>[1,2,4,8]\n</code></pre>\n\n<p>And we're done.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1556035009, "last_edit_date": 1556035009, "creation_date": 1555952763, "answer_id": 55798127, "question_id": 55715331, "link": "https://stackoverflow.com/questions/55715331/haskell-let-expressions-evaluation/55798127#55798127", "title": "Haskell Let Expressions Evaluation", "body": "<p>To see what's going on we carefully name each entity as it comes into being:</p>\n\n<pre><code>let a   = 2\n    b   = 1 : [i * 2 | i &lt;- b]\n    f a = 1 : [i * a | i &lt;- f a]\nin  take (a+2) (f (head (tail b)))\n==\nlet b        = (b1:bs1)\n    (b1:bs1) = 1 : [i * 2 | i &lt;- b]\nin  take 4 (f (head (tail b)))\n==\nlet b1  = 1\n    bs1 = [i * 2 | i &lt;- (b1:bs1)]\nin  take 4 (f (head bs1))\n==\nlet b1  = 1\n    bs1 = [i * 2 | i &lt;- [b1]] ++ [i * 2 | i &lt;- bs1]\nin  take 4 (f (head bs1))\n==\nlet bs1 = [i * 2 | i &lt;- [1]] ++ [i * 2 | i &lt;- bs1]\nin  take 4 (f (head bs1))\n==\nlet bs1      = (b2:bs2)\n    (b2:bs2) = [1 * 2] ++ [i * 2 | i &lt;- bs1]\nin  take 4 (f b2)\n==\nlet (b2:bs2) = 2 : [i * 2 | i &lt;- (b2:bs2)]\nin  take 4 (f b2)\n==\nlet bs2      =     [i * 2 | i &lt;- (2:bs2)]\n    f a      = 1 : [i * a | i &lt;- f a]     -- same as before\nin  take 4 (f 2)\n==\nlet xs       = f 2\n    f 2      = 1 : [i * 2 | i &lt;- f 2] \nin  take 4 xs\n==\nlet (x1:xs1) = 1 : [i * 2 | i &lt;- f 2]\nin  take 4 (x1:xs1)\n==\nlet xs1      =     [i * 2 | i &lt;- f 2]\nin  take 4 (1:xs1)\n==\nlet xs1      =     [i * 2 | i &lt;- f 2]\nin  1 : take 3 xs1\n==\nlet (x2:xs2) =     [i * 2 | i &lt;- (y1:ys1)]\n    (y1:ys1) = 1 : [i * 2 | i &lt;- f 2]\nin  1 : take 3 (x2:xs2)\n==\nlet (x2:xs2) =     [i * 2 | i &lt;- (1:ys1)]\n    ys1      =     [i * 2 | i &lt;- f 2]\nin  1 : take 3 (x2:xs2)\n==\nlet (x2:xs2) = 2 : [i * 2 | i &lt;- ys1]\n    ys1      =     [i * 2 | i &lt;- f 2]\nin  1 : take 3 (x2:xs2)\n==\nlet xs2      =     [i * 2 | i &lt;- ys1]\n    ys1      =     [i * 2 | i &lt;- f 2]\nin  1 : take 3 (2:xs2)\n==\nlet xs2      =     [i * 2 | i &lt;- ys1]\n    ys1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : take 2 xs2\n==\nlet (x3:xs3) =     [i * 2 | i &lt;- (y2:ys2)]\n    (y2:ys2) =     [i * 2 | i &lt;- (z1:zs1)]\n    (z1:zs1) = 1 : [i * 2 | i &lt;- f 2]\nin  1 : 2 : take 2 (x3:xs3)\n==\nlet (x3:xs3) =     [i * 2 | i &lt;- (y2:ys2)]\n    (y2:ys2) = 2 : [i * 2 | i &lt;- zs1]\n    zs1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : take 2 (x3:xs3)\n==\nlet (x3:xs3) = 4 : [i * 2 | i &lt;- ys2]\n    ys2      =     [i * 2 | i &lt;- zs1]\n    zs1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : take 2 (x3:xs3)\n==\nlet xs3      =     [i * 2 | i &lt;- ys2]\n    ys2      =     [i * 2 | i &lt;- zs1]\n    zs1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : 4 : take 1 xs3\n==\nlet (x4:xs4) =     [i * 2 | i &lt;- (y3:ys3)]\n    (y3:ys3) =     [i * 2 | i &lt;- (z2:zs2)]\n    (z2:zs2) =     [i * 2 | i &lt;- (w1:ws1)]\n    (w1:ws1) = 1 : [i * 2 | i &lt;- f 2]\nin  1 : 2 : 4 : take 1 (x4:xs4)\n==\nlet (x4:xs4) =     [i * 2 | i &lt;- (y3:ys3)]\n    (y3:ys3) =     [i * 2 | i &lt;- (z2:zs2)]\n    (z2:zs2) = 2 : [i * 2 | i &lt;- ws1]\n    ws1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : 4 : take 1 (x4:xs4)\n==\nlet (x4:xs4) =     [i * 2 | i &lt;- (y3:ys3)]\n    (y3:ys3) = 4 : [i * 2 | i &lt;- zs2]\n    zs2      =     [i * 2 | i &lt;- ws1]\n    ws1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : 4 : take 1 (x4:xs4)\n==\nlet (x4:xs4) = 8 : [i * 2 | i &lt;- ys3]\n    ys3      =     [i * 2 | i &lt;- zs2]\n    zs2      =     [i * 2 | i &lt;- ws1]\n    ws1      =     [i * 2 | i &lt;- f 2]\nin  1 : 2 : 4 : take 1 (x4:xs4)\n==\n    1 : 2 : 4 : 8 : take 0 xs4\n==\n    1 : 2 : 4 : 8 : []\n</code></pre>\n\n<p>In the above derivation we used the property of list comprehensions where</p>\n\n<pre><code>  [ ... | ... &lt;- (xs   ++   ys)] \n=== \n  [ ... | ... &lt;- xs ] ++ [ ... | ... &lt;- ys]\n</code></pre>\n\n<p>so that</p>\n\n<pre><code>  [ ... | ... &lt;- (x : ys)] \n=== \n  [ ... | ... &lt;- [x] ] ++ [ ... | ... &lt;- ys]\n</code></pre>\n\n<p><code>f a</code> produces the same results as <code>iterate (* a) 1</code>, but operationally it is very much different. While the latter is linear, the former is a quadratic function, w.r.t. its time complexity. </p>\n\n<p>To see what it means in practice, compare the timings for:</p>\n\n<pre><code>&gt; f 1.01 !! 4000\n1.9297236994732192e17\n(1.28 secs, 1614556912 bytes)\n\n&gt; iterate (* 1.01) 1 !! 4000\n1.9297236994732192e17\n(0.00 secs, 12990984 bytes)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1556035009, "creation_date": 1555442699, "last_edit_date": 1556032323, "question_id": 55715331, "link": "https://stackoverflow.com/questions/55715331/haskell-let-expressions-evaluation", "title": "Haskell Let Expressions Evaluation", "body": "<p>I am doing practice problems that evaluate a let expression and I don't understand the output of this one.</p>\n\n<p>Here is the expression:</p>\n\n<pre><code>let a = 2\n    b = 1:[i * 2 | i &lt;- b]\n    f a = 1:[i * a | i &lt;- (f a)]\nin take (a+2) (f (head (tail b) ))\n</code></pre>\n\n<p>The output is supposed to be [1,2,4,8]. Could someone please explain step by step why this is the output</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1555442828, "post_id": 55715272, "comment_id": 98111166, "body": "Are you using the <code>QuasiQuotes</code> extension?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1555442919, "post_id": 55715272, "comment_id": 98111202, "body": "The parser seems to think you are using a <code>+|</code> operator with no right operand."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1557911753, "creation_date": 1557911753, "answer_id": 56145677, "question_id": 55715272, "link": "https://stackoverflow.com/questions/55715272/haskell-regex-a-section-must-be-enclosed-in-parentheses-thus/56145677#56145677", "title": "Haskell regex, a section must be enclosed in parentheses thus", "body": "<p>If you turn on the <code>QuasiQuotes</code> language extension, GHC will parse <code>[re|\\d+|]</code> differently, as the string <code>\\d+</code> passed to the quasi-quoter <code>re</code>. BTW I'm not sure you have the right imports, since <a href=\"http://hackage.haskell.org/package/pcre-heavy-1.0.0.2/docs/Text-Regex-PCRE-Heavy.html#g:4\" rel=\"nofollow noreferrer\">the <code>re</code> quasi-quoter seems to come from <code>pcre-heavy</code>'s <code>Text.Regex.PCRE.Heavy</code> module</a>.</p>\n\n<p>So the below should work from GHCi:</p>\n\n<pre><code>Prelude Data.Text&gt; :set -XQuasiQuotes\nPrelude Data.Text&gt; import Text.Regex.PCRE.Heavy\nPrelude Data.Text Text.Regex.PCRE.Heavy&gt; gsub [re|\\d+|] \"x\" \"1 and 2 and 3\" :: Text\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557911753, "creation_date": 1555442498, "question_id": 55715272, "link": "https://stackoverflow.com/questions/55715272/haskell-regex-a-section-must-be-enclosed-in-parentheses-thus", "title": "Haskell regex, a section must be enclosed in parentheses thus", "body": "<p>I'm working from <a href=\"https://learning.oreilly.com/library/view/practical-web-development/9781484237397/html/461381_1_En_2_Chapter.xhtml\" rel=\"nofollow noreferrer\">this text</a>, where I see the example:</p>\n\n<pre><code>&gt; gsub [re|\\d+|] \"x\" \"1 and 2 and 3\" :: Text -- 7\n\"x and x and x\"\n</code></pre>\n\n<p>Similarly, I'd like to use gsub to replace /non/ digits with nulls, but what seemed like a pretty straightforward translation fails:</p>\n\n<pre><code>Prelude Text.Regex.Posix&gt; gsub [re|\\D+|] \"\" \"$57.72\" :: Float\n\n&lt;interactive&gt;:14:7: error:\n    A section must be enclosed in parentheses thus: (re |\\ D +|)\n</code></pre>\n\n<p>Then I notice, even the original example fails for me with the same error:</p>\n\n<pre><code>Prelude Text.Regex.Posix Data.Text&gt; gsub [re|\\d+|] \"x\" \"1 and 2 and 3\" :: Text\n\n&lt;interactive&gt;:17:7: error:\n    A section must be enclosed in parentheses thus: (re |\\ d +|)\n</code></pre>\n\n<p>Why is the interpreter telling me to do something different from what works in this example and how do I get some kind of text substitution with regex to work?</p>\n"}, {"tags": ["haskell", "polymorphism", "functor", "fold", "foldable"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1555445470, "post_id": 55715194, "comment_id": 98112274, "body": "It&#39;s because a <code>Foldable</code> instance is a kind of &quot;container&quot;, and doesn&#39;t care what type is inside it. Your own type could be made polymorphic by replacing the <code>String</code> with any arbitrary type - and that wouldn&#39;t change anything about the structure."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 3, "creation_date": 1555446201, "post_id": 55715194, "comment_id": 98112581, "body": "See also <a href=\"https://stackoverflow.com/questions/39634504/is-there-anything-we-lose-with-monofoldable\" title=\"is there anything we lose with monofoldable\">stackoverflow.com/questions/39634504/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 4183550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-XPi65j6sWQQ/AAAAAAAAAAI/AAAAAAAAAEg/fKumkAmyHbg/photo.jpg?sz=128", "display_name": "ionree", "link": "https://stackoverflow.com/users/4183550/ionree"}, "edited": false, "score": 0, "creation_date": 1555490430, "post_id": 55718483, "comment_id": 98125887, "body": "Thanks! I feel like most of the details still fly over my head, but you&#39;ve given me some great pointers to explore!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 377, "user_id": 4183550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-XPi65j6sWQQ/AAAAAAAAAAI/AAAAAAAAAEg/fKumkAmyHbg/photo.jpg?sz=128", "display_name": "ionree", "link": "https://stackoverflow.com/users/4183550/ionree"}, "edited": false, "score": 0, "creation_date": 1555537651, "post_id": 55718483, "comment_id": 98150910, "body": "@ionree In case it helps, a few more words on optics: one of the things they allow us is, so to say, supply substitutes for functor/foldable/traversable/etc. instances on the fly (and, as seen here, those substitutes don&#39;t necessarily have to be polymorphic)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1555463185, "last_edit_date": 1555463185, "creation_date": 1555462852, "answer_id": 55718483, "question_id": 55715194, "link": "https://stackoverflow.com/questions/55715194/why-cant-a-non-polymorphic-type-implement-foldable-in-haskell/55718483#55718483", "title": "Why can&#39;t a non-polymorphic type implement Foldable in Haskell?", "body": "<blockquote>\n  <p>To me it seems like folding over non-polymorphic types like in this case would be perfectly reasonable, but obviously I'm missing something.</p>\n</blockquote>\n\n<p>It is perfectly reasonable indeed. One way of folding a monomorphic container is using <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.11.0/docs/Data-MonoTraversable.html#t:MonoFoldable\" rel=\"noreferrer\"><code>MonoFoldable</code></a>. Another is using <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Fold.html\" rel=\"noreferrer\">a <code>Fold</code> from <em>lens</em></a>, or from some other optics library:</p>\n\n<pre><code>import Control.Lens\n\ndata Expr = String String | Cons Expr Expr\n  deriving (Show)\n\n-- A Traversal can also be used as a Fold.\n-- strings :: Applicative f =&gt; (String -&gt; f String) -&gt; (Expr -&gt; f Expr) \nstrings :: Traversal' Expr String\nstrings f (String s) = String &lt;$&gt; f s\nstrings f (Cons l r) = Cons &lt;$&gt; strings f l &lt;*&gt; strings f r \n</code></pre>\n\n\n\n<pre><code>GHCi&gt; hello = Cons (String \"hello\") (Cons (String \"World\") (String \"!\"))\nGHCi&gt; toListOf strings hello\n[\"hello\",\"World\",\"!\"]\nGHCi&gt; import Data.Monoid\nGHCi&gt; foldMapOf strings (Sum . length) hello\nSum {getSum = 11}\n</code></pre>\n\n<p>As for why <code>Foldable</code> instances have kind <code>* -&gt; *</code> rather than <code>*</code>,  I would put it down to a combination of simplicity and historical reasons. Historically speaking, <code>Foldable</code> is an offshoot of <code>Traversable</code>, and it is worth noting that, while monomorphic traversals can be useful, their limitations are rather more striking than those which affect monomorphic folds (for instance, you can't recover <code>fmap</code> from them, but merely a monomorphic <code>omap</code>). Finally, the Q&amp;A suggested by Joseph Sible, <a href=\"https://stackoverflow.com/q/39634504/2751851\"><em>Is there anything we lose with MonoFoldable?</em></a>, includes some interesting discussion of potential reasons for not outright replacing <code>Foldable</code> with  <code>MonoFoldable</code>.</p>\n"}], "owner": {"reputation": 377, "user_id": 4183550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-XPi65j6sWQQ/AAAAAAAAAAI/AAAAAAAAAEg/fKumkAmyHbg/photo.jpg?sz=128", "display_name": "ionree", "link": "https://stackoverflow.com/users/4183550/ionree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 55718483, "answer_count": 1, "score": 4, "last_activity_date": 1555463749, "creation_date": 1555442142, "last_edit_date": 1555463749, "question_id": 55715194, "link": "https://stackoverflow.com/questions/55715194/why-cant-a-non-polymorphic-type-implement-foldable-in-haskell", "title": "Why can&#39;t a non-polymorphic type implement Foldable in Haskell?", "body": "<p>Say I have some simplified lisp-style <code>Expr</code> type as follows</p>\n\n<pre><code>data Expr = String String | Cons Expr Expr\n  deriving (Show)\n</code></pre>\n\n<p>I can create lists as Cons-cells of Cons-cells:</p>\n\n<pre><code>Cons (String \"hello\") (Cons (String \"World\") (String \"!\"))\n</code></pre>\n\n<p>From this I would like to implement <code>Foldable</code> for <code>Expr</code> to fold over these cons lists - but that's not possible, since <code>Foldable</code> requires a type of kind <code>* -&gt; *</code> (i.e. polymorphic with exactly one type parameter), wheres my <code>Expr</code> has kind <code>*</code>.</p>\n\n<p>Why is that? To me it seems like folding over non-polymorphic types like in this case would be perfectly reasonable, but obviously I'm missing something.</p>\n"}, {"tags": ["haskell", "time"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 3, "creation_date": 1555445232, "post_id": 55714487, "comment_id": 98112180, "body": "Your code is a little confusing ... it looks like parts of this are from a <code>.hs</code> file and other parts are from a <code>ghci</code> session. In any case, I think the problem is <code>myUTC &lt;- ptime myDate</code>. You can only use the <code>&lt;-</code> notation when you&#39;re in a <code>do</code> block, pulling a value out of a monad (in this case, the <code>ghci</code> prompt is an implicit <code>do</code> block in the <code>IO</code> monad). Instead try <code>let myUTC = ptime myDate</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555445920, "post_id": 55714487, "comment_id": 98112468, "body": "Thanks, it&#39;s been confusing to me, too.  I&#39;m using an ihaskell notebook in jupyter."}], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": true, "score": 0, "last_activity_date": 1556172351, "creation_date": 1556172351, "answer_id": 55842783, "question_id": 55714487, "link": "https://stackoverflow.com/questions/55714487/text-friendly-way-of-parsing-text-timestamps-in-haskell/55842783#55842783", "title": "Text friendly way of parsing text timestamps in Haskell", "body": "<p>@DarthFennec was right.  Replace</p>\n\n<pre><code>myUTC &lt;- ptime myDate\n</code></pre>\n\n<p>With</p>\n\n<pre><code>myUTC = ptime myDate\n</code></pre>\n\n<p>I would not have understood that from the error above.  This is not related to Text or Data.Time.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 55842783, "answer_count": 1, "score": 0, "last_activity_date": 1556172351, "creation_date": 1555439272, "question_id": 55714487, "link": "https://stackoverflow.com/questions/55714487/text-friendly-way-of-parsing-text-timestamps-in-haskell", "title": "Text friendly way of parsing text timestamps in Haskell", "body": "<p>I have some timestamps (with additional text around them) I am parsing.  I understand I <a href=\"https://stackoverflow.com/questions/4174372/haskell-date-parsing-and-formatting\">can parse time strings generally</a> with Data.Time.</p>\n\n<p>However, after I convert the datetime from a Text to a String with unpack, I don't understand how to parse this error:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings #-}\n\nimport Data.Time.Parse\nimport Data.Text as T\n\nmyDate = \"D2017/01/01\" \n\n:t parseTimeOrError\n\nptime :: Text -&gt; UTCTime \nptime dt = parseTimeOrError True defaultTimeLocale \"D%Y/%d/%M\" (T.unpack dt) :: UTCTime\n-- here the T.unpack is because the :t tells us parseTimeOrError takes a string\n-- not a Text.\n\nmyUTC &lt;- ptime myDate\n\nprint myUTC\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>parseTimeOrError :: forall t. ParseTime t =&gt; Bool -&gt; TimeLocale -&gt; String -&gt; String -&gt; t\n&lt;interactive&gt;:1:10: error:\n    \u2022 Couldn't match expected type \u2018IO a0\u2019 with actual type \u2018UTCTime\u2019\n    \u2022 In the first argument of \u2018GHC.GHCi.ghciStepIO :: forall a. IO a -&gt; IO a\u2019, namely \u2018(ptime myDate)\u2019\n      In a stmt of an interactive GHCi command: myUTC &lt;- GHC.GHCi.ghciStepIO :: forall a. IO a -&gt; IO a (ptime myDate)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 2, "creation_date": 1555435859, "post_id": 55713641, "comment_id": 98107946, "body": "The pattern <code>(x:xs)</code> will assign the first element to <code>x</code> and the tail of the cons list to <code>xs</code>. When the list is empty, it will not match because there is no first element."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1555436165, "post_id": 55713641, "comment_id": 98108097, "body": "<code>null []</code> is always true, since the empty list is, well, the empty list."}, {"owner": {"reputation": 1, "user_id": 3862714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DCUyB.jpg?s=128&g=1", "display_name": "shaner tahir", "link": "https://stackoverflow.com/users/3862714/shaner-tahir"}, "edited": false, "score": 0, "creation_date": 1555436577, "post_id": 55713641, "comment_id": 98108261, "body": "ok ,but when i run this code no problem , I want to tell me the list empty when running this code  (safetail []) , while not tell me empty, show me exception why?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3862714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DCUyB.jpg?s=128&g=1", "display_name": "shaner tahir", "link": "https://stackoverflow.com/users/3862714/shaner-tahir"}, "edited": false, "score": 0, "creation_date": 1555439042, "post_id": 55714073, "comment_id": 98109403, "body": "thank you, my bro, for your helping, very useful"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1555441412, "last_edit_date": 1555441412, "creation_date": 1555437463, "answer_id": 55714073, "question_id": 55713641, "link": "https://stackoverflow.com/questions/55713641/non-exhaustive-patterns-in-function-safetail/55714073#55714073", "title": "Non-exhaustive patterns in function safetail", "body": "<p>You need to use two cases; the pattern match is preventing your function from even being <em>called</em> (successfully) on an empty list.</p>\n\n<pre><code>safetail [] = error \"Empty\"\nsafetail (_:xs) = xs\n</code></pre>\n\n<p>That said, there's a certain amount of irony to a function with \"safe\" in its name raising a runtime exception. Either return an empty list</p>\n\n<pre><code>safetail :: [a] -&gt; [a]\nsafetail [] = []\nsafetail (_:xs) = xs\n</code></pre>\n\n<p>or change your function type to make it total. E.g.,</p>\n\n<pre><code>safetail :: [a] -&gt; Maybe [a]\nsafetail [] = Nothing\nsafetail (_:xs) = Just xs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 3862714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DCUyB.jpg?s=128&g=1", "display_name": "shaner tahir", "link": "https://stackoverflow.com/users/3862714/shaner-tahir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1555514394, "answer_count": 1, "score": -6, "last_activity_date": 1555441412, "creation_date": 1555435732, "last_edit_date": 1555438670, "question_id": 55713641, "link": "https://stackoverflow.com/questions/55713641/non-exhaustive-patterns-in-function-safetail", "closed_reason": "Duplicate", "title": "Non-exhaustive patterns in function safetail", "body": "<p>What is wrong with my code?</p>\n\n<pre><code>safetail (x:xs)= if null []==True then  xs else  error \"Empty\"\n</code></pre>\n\n<p>When I run my code it shows me an exception:</p>\n\n<blockquote>\n<pre><code>Input safetail []\n*** Exception: safetail.hs:1:1-62: Non-exhaustive patterns in function safetail\n</code></pre>\n</blockquote>\n"}, {"tags": ["string", "list", "haskell", "int"], "comments": [{"owner": {"reputation": 7264, "user_id": 146452, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/55e2e2dbef238cbc9d9a3b914b9a65a5?s=128&d=identicon&r=PG", "display_name": "mclark1129", "link": "https://stackoverflow.com/users/146452/mclark1129"}, "edited": false, "score": 6, "creation_date": 1555422648, "post_id": 55709785, "comment_id": 98100309, "body": "Hi Eli, it&#39;d be more helpful if you could show us an example of what you&#39;ve tried so far, and what the current output is vs the expected output (or any errors you might be running into)."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1555424148, "post_id": 55709785, "comment_id": 98101351, "body": "<code>words</code> and <code>lines</code> might be helpful functions in your attempt. As regards lining the columns up, you&#39;ll could try taking the <code>maximum</code> of <code>length</code> across the strings and <code>replicate</code> prefaced <code>&#39; &#39;</code> characters to make the widths equal."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1555424252, "post_id": 55709785, "comment_id": 98101424, "body": "Do you know what algorithm you&#39;d use and are having trouble implementing or are you having trouble figuring out even algorithmically what to do?  If you are looking for a pre-packaged pretty printing solution suggestion then that is explicitly off topic, but people on reddit will likely be quite helpful."}, {"owner": {"reputation": 13, "user_id": 11366547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0446bc086fd7d3d075955a6fcc04d8d3?s=128&d=identicon&r=PG&f=1", "display_name": "Eli H.", "link": "https://stackoverflow.com/users/11366547/eli-h"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1555425314, "post_id": 55709785, "comment_id": 98102139, "body": "@ThomasM.DuBuisson I&#39;m having trouble figuring out what to even do. So far I&#39;ve managed to go through the 2D List and turn them all internal integer elements into Strings but what I want is to grab the elements and form them into a single String."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1555426183, "post_id": 55709785, "comment_id": 98102733, "body": "Turning them into  <i>a</i> string is easy.  You can <code>concat</code> the whole list of strings.  However, you want to pad out each value with spaces to make each column a matching length.  Can you work through the algorithm that would achieve this?"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1555436526, "post_id": 55711849, "comment_id": 98108245, "body": "In the example the width needed depends on the maximum length item in the column, so it would be a <code>maximum . map length &lt;$&gt; transpose</code> style operation."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1555453552, "post_id": 55711849, "comment_id": 98115191, "body": "@ThomasM.DuBuisson yes, that would be the logical next step, for the OP to ask themself, &quot;why the width of 10?&quot;. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1555428936, "creation_date": 1555428936, "answer_id": 55711849, "question_id": 55709785, "link": "https://stackoverflow.com/questions/55709785/haskell-2d-list-of-ints-to-string/55711849#55711849", "title": "Haskell - 2D List of Ints to String", "body": "<p>Playing at the REPL can help.</p>\n\n<pre><code>&gt; :t '1'\n'1' :: Char\n\n&gt; :t \"1\"\n\"1\" :: [Char]\n\n&gt; ['1','2']\n\"12\" :: [Char]\n\n&gt; :t concat\nconcat :: [[a]] -&gt; [a]\n\n&gt; concat ( map show [1,2,3,4] )\n.....\n\n&gt; concat [ show x | x &lt;- [1,2,3,4] ]\n.....\n\n&gt; concat [ \" \" ++ ( ensureWidth 9 (show x) ) | x &lt;- [1,2,3,4] ]\n.....\n\n&gt; :t replicate\nreplicate :: Int -&gt; a -&gt; [a]\n\n&gt; replicate 2 '1'\n\"11\" :: [Char]\n</code></pre>\n\n<p>Now you need to write the function</p>\n\n<pre><code>ensureWidth w s = replicate n ' ' ++ s\n</code></pre>\n\n<p>but what <code>n</code> to use? You will need to know the length of <code>s</code>, for that. Function <a href=\"https://hoogle.haskell.org/?hoogle=length\" rel=\"nofollow noreferrer\"><code>length</code></a> can help.</p>\n"}], "owner": {"reputation": 13, "user_id": 11366547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0446bc086fd7d3d075955a6fcc04d8d3?s=128&d=identicon&r=PG&f=1", "display_name": "Eli H.", "link": "https://stackoverflow.com/users/11366547/eli-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 55711849, "answer_count": 1, "score": -1, "last_activity_date": 1555428936, "creation_date": 1555422527, "last_edit_date": 1555427173, "question_id": 55709785, "link": "https://stackoverflow.com/questions/55709785/haskell-2d-list-of-ints-to-string", "title": "Haskell - 2D List of Ints to String", "body": "<p>I'm looking to convert a 2D list to a formatted string.</p>\n\n<pre><code>table :: [[Int]] -&gt; String\n\nInput: [[11,2,30],[4,555,9]]\n\nOutput: \" 11   2 30 \\n  4 555   6 \\n\"\n\n        11   2  30\n         4 555   9\n</code></pre>\n\n<p>Basically would need to be able to print out in a grid-shape and maintain formatting to account for the max value.</p>\n\n<p>I know for simple lists I can map show <code>[1,2,3,4] -&gt; [\"1\",\"2\",\"3\",\"4\"]</code> according to ghci. That seems to keep it as a list though?</p>\n\n<p>Not sure how I can traverse the 2D and keep concatenating as a string and adding <code>\\n</code> as needed. </p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "edited": false, "score": 2, "creation_date": 1555420449, "post_id": 55709024, "comment_id": 98098809, "body": "<code>many1</code> is already a monadic type, so you do not need to use <code>return</code> with it. Just type <code>many1 section</code>. &quot;return&quot; is not a keyword in Haskell; it is a function that embeds a value in a monad: <code>return :: Monad m =&gt; a -&gt; m a</code>"}, {"owner": {"reputation": 53, "user_id": 2704049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed3990d3f9c26549a7645a1f9431d2ce?s=128&d=identicon&r=PG&f=1", "display_name": "citrus", "link": "https://stackoverflow.com/users/2704049/citrus"}, "reply_to_user": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "edited": false, "score": 0, "creation_date": 1555432763, "post_id": 55709024, "comment_id": 98106436, "body": "Thanks! That gets rid of the type error, but I get a runtime error of &quot;Error (line 12, column 1): unexpected end of input expecting white space or &quot;##&quot;  &quot;. I have the feeling that I&#39;m not separating/terminating sections properly, but I don&#39;t know how I should."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1555443781, "post_id": 55709024, "comment_id": 98111565, "body": "@citrus That seems like it&#39;s running <code>headingLine</code> at the end of the file, after the whole thing has been parsed already. If you now have <code>many1 section</code> at the end of your <code>model</code> function, but you forgot to remove the previous four lines, that would cause it to try to parse at least four sections, when there are only three."}, {"owner": {"reputation": 53, "user_id": 2704049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed3990d3f9c26549a7645a1f9431d2ce?s=128&d=identicon&r=PG&f=1", "display_name": "citrus", "link": "https://stackoverflow.com/users/2704049/citrus"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555525496, "post_id": 55709024, "comment_id": 98146173, "body": "@DarthFennec: Thanks, that worked! I forgot to remove the other lines."}], "owner": {"reputation": 53, "user_id": 2704049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed3990d3f9c26549a7645a1f9431d2ce?s=128&d=identicon&r=PG&f=1", "display_name": "citrus", "link": "https://stackoverflow.com/users/2704049/citrus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555439488, "creation_date": 1555420319, "last_edit_date": 1555439488, "question_id": 55709024, "link": "https://stackoverflow.com/questions/55709024/how-to-return-multiple-parsed-adts-in-parsec", "title": "How to return multiple parsed ADTs in Parsec?", "body": "<p>I'm using Parsec to parse a file that looks like this:</p>\n\n<pre><code>## public_id\n\nANALOG-CLOCK\n\n## name\n\nAnalog Wall Clock\nSome more text...\n\n## domain\n\nTime measurement\n\nMore text here...\n</code></pre>\n\n<p>except that the file can have a variable number of sections, where each section starts with a \"## \" line and may contain 0+ content lines.</p>\n\n<pre><code>type Model = [Section]\n\ndata Section = Section String [String]\n               deriving Show\n\n\nheadingLine :: Parser String\nheadingLine = do\n  try (string \"##\")\n  spaces\n  title &lt;- many1 (noneOf \"\\r\\n\")\n  char '\\n'\n  return title\n\n\nnonHeadingLine :: Parser String\nnonHeadingLine = do\n  try (noneOf \"#\")\n  contents &lt;- many1 (noneOf \"\\r\\n\")\n  char '\\n'\n  return contents\n\n\nsection :: Parser Section\nsection = do\n  title &lt;- headingLine\n  contentLines &lt;- many1 nonHeadingLine\n  spaces\n  return $ Section title contentLines\n\n\nmodel :: Parser Model\nmodel = do\n  s1 &lt;- section\n  s2 &lt;- section\n  s3 &lt;- section\n  return [s1, s2, s3]\n  --return $ many1 section\n\n\nmain :: IO ()\nmain = do\n  modelStr &lt;- readFile \"analog3.md\"\n  let result = do parse model \"\" modelStr\n  case result of\n    Left  err -&gt; putStrLn $ \"Error \" ++ show err\n    Right mdl -&gt; putStrLn $ show mdl\n</code></pre>\n\n<p>I want the output to look something like this:</p>\n\n<pre><code>[Section \"public_id\" \"ANALOG-CLOCK\",Section \"name\" \"Analog Wall Clock\",Section \"domain\" \"Time measurement\"]\n</code></pre>\n\n<p>The code works when I have exactly one content line per section and produces the above output.</p>\n\n<p>I have two problems:</p>\n\n<p>1) The code doesn't work when I have more than one content line per section, and </p>\n\n<p>2) When I use <code>return $ many1 section</code> instead of <code>return [s1, s2, s3]</code>, I get a type error \"Couldn't match type \u2018Text.Parsec.Prim.ParsecT\nString () Data.Functor.Identity.Identity [Section]\u2019 with \u2018[Section]\u2019 \".</p>\n\n<p>How do I get it to handle more than one content line and how do I get it to process more than one section? Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1555421822, "post_id": 55709281, "comment_id": 98099737, "body": "So there is no way to both deconstruct and match variables, I thought so. That does work fine, thanks !"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1555422020, "last_edit_date": 1555422020, "creation_date": 1555421053, "answer_id": 55709281, "question_id": 55708898, "link": "https://stackoverflow.com/questions/55708898/how-to-guard-this-case/55709281#55709281", "title": "How to guard this case", "body": "<p>I would start by defining a helper function that closes over <code>host</code> and <code>time</code>. Along side that, you can name the pair <code>(host, time)</code> as it will be used in two different places in the definition of the helper.</p>\n\n<p>The helper uses a <code>case</code> expression to pattern-match only the head of an inner list, rather than trying to match the entire host list.</p>\n\n<p>In the pattern that matches a host/time pair, you need to use a separate variable to capture the existing host, <em>then</em> compare that to <code>host</code> in a guard. You can only match <em>literals</em> directly in a pattern</p>\n\n<pre><code>processMatch :: String -&gt; POSIXTime -&gt; [[(String, POSIXTime)]] -&gt; [[(String, POSIXTime)]]\nprocessmatch host time lst = go lst\n    where newPair = (host, time)\n          go [] = [[newPair]]\n          go (head:tail) = case head of\n                            (h,t):rest | h == host -&gt;((h,t):newPair:rest):tail\n                            otherwise -&gt; head : go tail\n</code></pre>\n\n<hr>\n\n<p>As an aside, a previous typo used an undefined name <code>first</code>, which came from an at-pattern in a previous version of the answer. It's probably actually worth using, but I'll mention here rather than edit the main answer:</p>\n\n<pre><code>first@(h,_):rest | h == host -&gt; (first:newPair:rest):tail\n</code></pre>\n\n<p>This accomplishes two things: 1) it avoids the repetition of <code>(h,t)</code> on both sides; 2) it avoids giving a name to the matched time, which you don't really care about as long as you have <code>first</code> to refer to the pair itself.</p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 55709281, "answer_count": 1, "score": 0, "last_activity_date": 1555422020, "creation_date": 1555419959, "question_id": 55708898, "link": "https://stackoverflow.com/questions/55708898/how-to-guard-this-case", "title": "How to guard this case", "body": "<p>I have this function to try and \"register\" matches in a list of lists :</p>\n\n<pre><code>processMatch :: String -&gt; POSIXTime -&gt; [[(String, POSIXTime)]] -&gt; [[(String, POSIXTime)]]\nprocessMatch host time hostList =\ncase hostList of\n  []                 -&gt; [[(host, time)]]\n  ((host, t):x):tail -&gt; ((host, t):(host, time):x):tail\n  x:t                -&gt; x:(processMatch host time t)\n</code></pre>\n\n<p>The problem with this is that host is re-declared with a new value, instead of being a condition. So whatever host matches, I end up just adding it to the first matche's list.\nI imagine I need to use a guard instead, but I can't figure out how to deconstruct my lists like that in a guard, is it even possible ?</p>\n\n<p>I could just do it another way with a few conditions but I'm curious to know if it's even possible to do it simply like that.\nThanks !</p>\n"}, {"tags": ["sockets", "haskell", "tcp"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1555420633, "post_id": 55708742, "comment_id": 98098915, "body": "I think you want to use the <code>forever</code> function. It is documented in Control.Monad as common approach to network sockets inputs. <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1555431283, "post_id": 55708742, "comment_id": 98105685, "body": "So you&#39;re trying to connect to the server with the Chrome web browser(?) It looks to me like Chrome sends a HTTP request, your program replies with <code>Hi!!</code> (not a valid HTTP response), Chrome closes the network connection, your program crashes trying to write to a closed socket. See what happens if you send a valid HTTP reply..."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1555442927, "post_id": 55708742, "comment_id": 98111205, "body": "Now i realised that the chrome extension actually tries to open a <code>websocket</code> while my haskell program binds a raw <code>socket</code>."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1555442951, "post_id": 55708742, "comment_id": 98111211, "body": "@lsmor He&#39;s doing the recursive call properly, which amounts to the same thing as using <code>forever</code> and should work just fine. But yes, <code>forever</code> would probably be more idiomatic."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555443196, "post_id": 55708742, "comment_id": 98111322, "body": "Yeah, websockets are different from raw TCP sockets. It looks like websockets use an HTTP header section for the initial handshake, but later allow full-duplex communication a bit like raw TCP. <a href=\"https://tools.ietf.org/html/rfc6455\" rel=\"nofollow noreferrer\">reference</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1555492166, "creation_date": 1555492166, "answer_id": 55723909, "question_id": 55708742, "link": "https://stackoverflow.com/questions/55708742/how-to-send-and-receive-messages-from-socket-in-haskell/55723909#55723909", "title": "How to send and receive messages from socket in Haskell", "body": "<p>The server worked just fine.The problem was that i was trying to connect using <code>Chrome Simple WebSocket Client</code> extension , which as the name says , tries to open a <code>WebSocket</code> connection , while my server handles simple <code>Socket</code> ones.</p>\n\n<p>I tried connecting to the server using <code>telnet</code> and it worked just fine (both sending and receiveing).</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "accepted_answer_id": 55723909, "answer_count": 1, "score": 1, "last_activity_date": 1555492166, "creation_date": 1555419443, "last_edit_date": 1555445269, "question_id": 55708742, "link": "https://stackoverflow.com/questions/55708742/how-to-send-and-receive-messages-from-socket-in-haskell", "title": "How to send and receive messages from socket in Haskell", "body": "<p>I am trying to create a <code>TCP</code> server in Haskell and so far i am not able to open a connection from a google browser extension and keep it open:</p>\n\n<p><strong>Error</strong></p>\n\n<p><code>Server.exe: Network.Socket.sendBuf: failed (Unknown error)</code></p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>import Network.Socket\nimport qualified Network.Socket.ByteString as B\nimport Data.ByteString.Char8(pack,unpack)\n\nmain::IO()\nmain=do\n    sock&lt;-socket AF_INET Stream 0\n    bind sock (SockAddrInet 8500 iNADDR_ANY)\n    listen sock 3\n    (csock,_)&lt;-accept sock\n    loop csock\n\nloop::Socket-&gt;IO()\nloop csock=do\n    print \"Begining of loop\"\n   -- dat&lt;-B.recv csock 2000\n    sent&lt;-B.send  csock $ pack \"Hi!!\"\n  --  print $ unwords  [\"Received :\",unpack dat]\n    print \"End of loop\"\n    loop csock\n</code></pre>\n\n<p>I have tried first only with sending messages and i get the up error, if i uncomment the lines with <code>recv</code> it hangs</p>\n\n<p><strong>Output with commented lines</strong></p>\n\n<pre><code>\"Begining of loop\"\n\"End of loop\"\n\"Begining of loop\"\n\"End of loop\"\n\"Begining of loop\"\n\"End of loop\"\n\"Begining of loop\"\nServer.exe: Network.Socket.sendBuf: failed (Unknown error)\n</code></pre>\n\n<p><strong>Output with uncommented lines</strong></p>\n\n<pre><code>\"Begining of loop\"\n\"Received : GET / HTTP/1.1\\r\\nHost: localhost:8500\\r\\nConnection: Upgrade\\r\\nPragma: no-cache\\r\\nCache-Control: no-cache\\r\\nUpgrade: websocket\\r\\nOrigin: chrome-extension://pfdhoblngboilpfeibdedpjgfnlcodoo\\r\\nSec-WebSocket-Version: 13\\r\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like\nGecko) Chrome/73.0.3683.103 Safari/537.36\\r\\nAccept-Encoding: gzip, deflate, br\\r\\nAccept-Language: en,en-US;q=0.9,ro;q=0.8\\r\\nSec-WebSocket-Key: WY87jPXNRfk/WM5T20O8Jg==\\r\\nSec-WebSocket-Extensions: permessage-deflate; client_max_window_bits\\r\\n\\r\\n\"\n\"End of loop\"\n\"Begining of loop\"\n</code></pre>\n\n<p><strong>P.S</strong>\nI am using <code>Simple WebSocket Client</code>-extension on Chrome and in both cases the connection appears \"Opening\" and not \"Opened\" even though the program runs a couple of iterations as you can see in the output(s)</p>\n"}, {"tags": ["haskell", "tree", "fold"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1555419610, "post_id": 55708462, "comment_id": 98098260, "body": "Note that <code>foldr</code> and <code>foldl</code> consumes lists to produce something, while <code>foldTree</code> consumes a tree to produce something. You can&#39;t replace one with the other, since they consume different things. (Unrelated: you should use pattern matching instead of guards and partial accessors. Functions like <code>head, tail, leftSub, rightSub, value</code> are dangerous since they crash your program on the wrong argument, and above they can be replaced by pattern matching -- e.g. <code>f [] = a ; f (x:xs) = use x xs</code> instead of <code>f l | null l = a | otherwise = use (head l) (tail l)</code>)"}, {"owner": {"reputation": 88, "user_id": 8250648, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NHgpXWOigQw/AAAAAAAAAAI/AAAAAAAABm8/YL5_BTD51HA/photo.jpg?sz=128", "display_name": "ZM-", "link": "https://stackoverflow.com/users/8250648/zm"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1555420785, "post_id": 55708462, "comment_id": 98099030, "body": "Thanks @chi! That is an erroneous assumption I was making, and I think you answered my question. Appreciate the pattern matching tip :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1555432202, "post_id": 55708462, "comment_id": 98106163, "body": "@chi, <code>foldl</code> and <code>foldr</code> aren&#39;t just for lists. What do you mean? ZM-, note that <code>foldr</code> is the correct way to convert to a list in order. <code>foldl</code> is the correct way to convert to a list in reverse order. Doing it the other way around is usually less lazy and less efficient."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555433480, "post_id": 55708462, "comment_id": 98106798, "body": "creating a tree from its enumeration list  is  nondeterministic -- there are many possible trees of different shapes housing the same list of elements. and -1 because the question is unclear, and the body contradicted the title."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1555435047, "post_id": 55708462, "comment_id": 98107582, "body": "@dfeuer The OP says they want to &quot;create a tree from a list&quot;. I&#39;m saying that in such case <code>foldTree</code> won&#39;t help, since it requires a tree. The fact that you can also <code>foldr,foldl</code> over any foldable is not really relevant here (unless I am missing something?)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1555436196, "post_id": 55708462, "comment_id": 98108106, "body": "@chi, I think you&#39;re right about that, but that your statement was potentially confusing. I know that you know at least as much as I do about this stuff; I just want to make sure communication is as clear as possible."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1555454431, "post_id": 55708462, "comment_id": 98115420, "body": "@chi the problem was that the very first line in the <i>body</i> said they wanted to make a list from a tree - the exact opposite from the title. so it would be relevant, if that was their intent (as I unfortunately assumed, at first)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1555434594, "last_edit_date": 1555434594, "creation_date": 1555422139, "answer_id": 55709660, "question_id": 55708462, "link": "https://stackoverflow.com/questions/55708462/tree-from-list-using-foldtree/55709660#55709660", "title": "Tree From List using FoldTree", "body": "<p>You seem to be confused about the different folds.</p>\n\n<p>List-related folds <code>foldr</code> and <code>foldl</code> consume a list (or, more in general, a foldable) to produce something else (which might not be a list).</p>\n\n<p>The tree-related fold <code>foldTree</code> consumes a tree to produce something else (which might not be a tree).</p>\n\n<p>Hence, you can not switch from one to the other: if you only have a list as input, you do not have a tree to call <code>foldTree</code> with.</p>\n"}], "owner": {"reputation": 88, "user_id": 8250648, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NHgpXWOigQw/AAAAAAAAAAI/AAAAAAAABm8/YL5_BTD51HA/photo.jpg?sz=128", "display_name": "ZM-", "link": "https://stackoverflow.com/users/8250648/zm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 55709660, "answer_count": 1, "score": -2, "last_activity_date": 1555434594, "creation_date": 1555418619, "last_edit_date": 1555432453, "question_id": 55708462, "link": "https://stackoverflow.com/questions/55708462/tree-from-list-using-foldtree", "title": "Tree From List using FoldTree", "body": "<p>I am trying to create a tree from a list.</p>\n\n<p>I have written the function using foldl and foldr (latter not shown)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>treeFromList l\n    | null l = error \"no elements in list\"\n    | otherwise = foldl insertIfAbsent (initTree (head l)) (tail l)\n</code></pre>\n\n<p>where the Tree DS is defined in a separate module as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tree a = EmptyTree | Node a (Tree a) (Tree a) deriving Show\n\ninitTree x = (Node x EmptyTree EmptyTree)\n</code></pre>\n\n<p>and <code>treeFold</code> is manually written (not derived) as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldTree f acc t\n    | (empty t) = acc\n    | otherwise = foldTree f outerVal (leftSub t) \n        where\n        outerVal = f (value t) rightVal \n        rightVal = foldTree f acc (rightSub t)\n</code></pre>\n\n<p>After giving this some thought, I believe this cannot be done because of a type conflict. In theory, the tree would need to be build up in the accumulator while the list is constantly reduced/folded over.</p>\n\n<p>On the contrary, I was able to convert to <code>foldl</code> version to <code>foldr</code>, and apparently <code>foldr</code> can be expressed using <code>foldTree</code>.</p>\n\n<p>Any suggestions? Thank you!</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1555412354, "post_id": 55706425, "comment_id": 98093974, "body": "Sounds like you might want to look at the Reader monad. (It&#39;s indeed similar to the State monad, but the state is read only.)"}, {"owner": {"reputation": 2765, "user_id": 2071258, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6da5a603fd4dcea53e578bcfac0c178b?s=128&d=identicon&r=PG", "display_name": "Laurent LA RIZZA", "link": "https://stackoverflow.com/users/2071258/laurent-la-rizza"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555414298, "post_id": 55706425, "comment_id": 98095081, "body": "@RobinZigmond: OK. What you seem to mean is : if I define the <code>Context</code> type as in the question, and define <code>type Action = ReaderT Context IO</code>, I can do <code>(reader conn)</code>, <code>(reader builder)</code> and <code>liftIO $ do ...</code> ?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1555415139, "post_id": 55706425, "comment_id": 98095585, "body": "Not quite - <code>(ReaderT Context IO) b</code>, modulo <code>newtype</code> wrapping, is equivalent to <code>Context -&gt; IO b</code> - so it doesn&#39;t include your <code>a</code> argument. You could of course rearrange the order of the arguments and use a function <code>a -&gt; ReaderT Context IO b</code>"}, {"owner": {"reputation": 2765, "user_id": 2071258, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6da5a603fd4dcea53e578bcfac0c178b?s=128&d=identicon&r=PG", "display_name": "Laurent LA RIZZA", "link": "https://stackoverflow.com/users/2071258/laurent-la-rizza"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1555418046, "post_id": 55706425, "comment_id": 98097237, "body": "So <code>(new)type Action a b = a -&gt; ReaderT Context IO b</code>would be a proper monadically composable function type. (the monad being <code>ReaderT Context IO</code>) I think I get it now."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1555419197, "post_id": 55706425, "comment_id": 98097974, "body": "Using you own monad you can define your own helpers like <code>getConnection :: Action a Connection</code>. You probably want to define a <code>MonadIO (Action a)</code> instance as well, so that you can run things like <code>liftIO (putStrLn &quot;hello&quot;)</code> in your custom monad."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1555429537, "post_id": 55706425, "comment_id": 98104720, "body": "There is a lot of good discussion here. Could the results be edited into the answer? That would improve it a lot."}], "answers": [{"tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": false, "score": 1, "last_activity_date": 1555456052, "creation_date": 1555456052, "answer_id": 55717735, "question_id": 55706425, "link": "https://stackoverflow.com/questions/55706425/how-to-hide-context-and-the-io-monad-into-another-monad/55717735#55717735", "title": "How to hide context and the `IO` monad into another monad?", "body": "<blockquote>\n  <p>[..] the main problem being that I have to pass my <code>Connection</code> and <code>Builder</code> all around.</p>\n</blockquote>\n\n<p>So these are part of an \"environment\" that You read from (repeatedly).  That's what the <code>Reader</code> monad is for.  The package <code>mtl</code> contains the monad transformer <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\"><code>ReaderT</code></a> which adds reader functionality to a base monad, in Your case <code>IO</code>.</p>\n\n<h2>Demo:</h2>\n\n<p>Assuming a simple action, like ..</p>\n\n<pre><code>no_action :: Connection -&gt; Builder -&gt; Int -&gt; IO Int\nno_action _ _ i = return (i + 1)\n</code></pre>\n\n<p>You can put this into a new Monad which is like <code>IO</code> but with access to both connection and builder by defining a <code>Context</code> and applying the monad transformer:</p>\n\n<pre><code>data Context = Context { connection :: Connection\n                       , builder :: Builder }\ntype CBIO b = ReaderT Context IO b\n</code></pre>\n\n<p>Lifting Your actions into this new (combined) monad deserves a function on its own:</p>\n\n<pre><code>liftCBIO :: (Connection -&gt; Builder -&gt; a -&gt; IO b) -&gt; (a -&gt; CBIO b)\nliftCBIO f v = do\n    context &lt;- ask\n    liftIO (f (connection context) (builder context) v)\n</code></pre>\n\n<p>Then You can either always write <code>(liftCBIO no_action) num</code> or ...</p>\n\n<pre><code>cbio_no_action = liftCBIO no_action\n</code></pre>\n\n<p>... and <code>cbio_no_action num</code>.</p>\n\n<p>To actually run Your new monad You'd use <code>runReaderT</code> .. but this also deserves a better name:</p>\n\n<pre><code>runWithInIO = flip runReaderT\n</code></pre>\n\n<p>You could also change this to incorporate building the <code>Context</code>, if You like.</p>\n\n<p>Using the above then looks like that:</p>\n\n<pre><code>main = do\n    i &lt;- runWithInIO (Context Connection Builder) $ do\n        a &lt;- cbio_no_action 20\n        liftIO $ putStrLn \"Halfway through!\"\n        b &lt;- cbio_no_action 30\n        return (a + b)\n    putStrLn $ show i\n</code></pre>\n\n<p><a href=\"https://ideone.com/lQp86T\" rel=\"nofollow noreferrer\">(Full demo on ideone)</a></p>\n"}], "owner": {"reputation": 2765, "user_id": 2071258, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6da5a603fd4dcea53e578bcfac0c178b?s=128&d=identicon&r=PG", "display_name": "Laurent LA RIZZA", "link": "https://stackoverflow.com/users/2071258/laurent-la-rizza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1555481021, "creation_date": 1555411825, "last_edit_date": 1555481021, "question_id": 55706425, "link": "https://stackoverflow.com/questions/55706425/how-to-hide-context-and-the-io-monad-into-another-monad", "title": "How to hide context and the `IO` monad into another monad?", "body": "<p>I am trying to implement a small desktop application, using <code>HDBC</code> and <code>Haskell.GI</code>. I build my windows and dialogs using glade, and load them with <code>GtkBuilder</code>. After implementing a couple of scenarios, I end up using the same pattern throughout, composing \"actions\" in <code>do</code> blocks that have a signature of:</p>\n\n<pre><code>Connection -&gt; Builder -&gt; a -&gt; IO b\n</code></pre>\n\n<p>These \"actions\" compose in the context of the <code>IO</code> monad, the main problem being that I have to pass my <code>Connection</code> and <code>Builder</code> all around. Another problem I foresee is that if I ever want to add another external dependency to my application, (access to an image scanner, for instance) I will have to change the signature of all my \"actions\", and more importantly, their arity.</p>\n\n<p>What I could do: I could define a type synonym:</p>\n\n<pre><code>type Action a b = Connection -&gt; Builder -&gt; a -&gt; IO b\n</code></pre>\n\n<p>I could also create a named tuple to eliminate the arity problem:</p>\n\n<pre><code>data Context =\n    Context {\n        conn :: Connection,\n        builder :: Builder}\n</code></pre>\n\n<p>But still, that does not solve the fact that, every time I want to access the database, I will have to call <code>(conn ctx)</code> or use a <code>let</code> binding in every action.</p>\n\n<p>What I feel would be ideal would be to make my own monad, in which I could compose my actions and I would not speak explicitly about my <code>Connection</code> or <code>Builder</code> values.</p>\n\n<p>How would I go defining a monad like this, knowing that <code>IO</code> is already a monad?</p>\n\n<p>As an aside, has it anything to do with the <code>State</code> monad?</p>\n"}, {"tags": ["haskell", "types", "functor"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1555396693, "post_id": 55701842, "comment_id": 98085142, "body": "Yes, exactly.     ."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555421714, "post_id": 55701842, "comment_id": 98099670, "body": "Put another way: <code>Tree</code> is a recursive type; if you don&#39;t recursively call <code>fmap</code>, you aren&#39;t really mapping the function over the entire tree; you&#39;re just applying it to its root."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 8, "last_activity_date": 1555397169, "last_edit_date": 1555397169, "creation_date": 1555396752, "answer_id": 55702010, "question_id": 55701842, "link": "https://stackoverflow.com/questions/55701842/can-one-partially-apply-functor/55702010#55702010", "title": "Can one partially apply functor", "body": "<blockquote>\n  <p>Does it mean that all <code>a</code>-s within the <code>Tree</code> must somehow become <code>b</code>-s ? and i am only dealing with the non-functor one in the first case ? ^</p>\n</blockquote>\n\n<p>Yes, that\u2019s right. You\u2019re trying to implement <code>fmap :: (a -&gt; b) -&gt; Tree a -&gt; Tree b</code>, but when you write:</p>\n\n<pre><code>fmap f (Node t left right) = Node (f t) left right\n</code></pre>\n\n<p>You\u2019re attempting to call <code>Node :: b -&gt; Tree b -&gt; Tree b -&gt; Tree b</code> with arguments <code>f t :: b</code>, <code>left :: Tree a</code>, and <code>right :: Tree a</code>. The only way you have of turning a <code>Tree a</code> into a <code>Tree b</code> is via <code>fmap f :: Tree a -&gt; Tree b</code>, which is why this:</p>\n\n<pre><code>fmap f (Node t left right) = Node (f t) (fmap f left) (fmap f right)\n</code></pre>\n\n<p>Works as expected.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 55702010, "answer_count": 1, "score": 6, "last_activity_date": 1555452773, "creation_date": 1555396094, "last_edit_date": 1555452773, "question_id": 55701842, "link": "https://stackoverflow.com/questions/55701842/can-one-partially-apply-functor", "title": "Can one partially apply functor", "body": "<p>I am trying to implement <code>fmap</code> for the following type:</p>\n\n<pre><code>data Tree a = Leaf a | Node a (Tree a) (Tree a) | Empty deriving (Eq,Show)\n</code></pre>\n\n\n\n<pre><code>instance Functor Tree where\n        fmap _ Empty=Empty\n        fmap f (Leaf x)=Leaf (f x)\n        fmap f (Node t left right)=Node (f t) left right\n</code></pre>\n\n<p>I keep getting type mismatch error:</p>\n\n<p><strong>Error</strong></p>\n\n<pre><code>* Couldn't match type `a' with `b'\n      `a' is a rigid type variable bound by\n        the type signature for:\n          fmap :: forall a b. (a -&gt; b) -&gt; Tree a -&gt; Tree b\n        at Monad.hs:8:9-12\n      `b' is a rigid type variable bound by\n        the type signature for:\n          fmap :: forall a b. (a -&gt; b) -&gt; Tree a -&gt; Tree b\n        at Monad.hs:8:9-12\n      Expected type: Tree b\n        Actual type: Tree a\n</code></pre>\n\n<p>Why do i get this error but when i am also applying <code>fmap</code> to the child nodes it compiles without problem:</p>\n\n<pre><code>fmap f (Node t left right) = Node (f t) (fmap f left) (fmap f right)\n</code></pre>\n\n<p>Does it mean that all <code>a</code>-s within the <code>Tree</code> must somehow become <code>b</code>-s ? and i am only dealing with the non-functor one in the first case ?\n                       ^</p>\n"}, {"tags": ["haskell", "reflection", "types", "generic-programming"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1555386432, "post_id": 55700144, "comment_id": 98082066, "body": "The problem is that <code>Constr</code> by itself just doesn&#39;t have enough data inside. The types of arguments are all hidden within <code>gmapQ</code>. <code>Constr</code> is just a bunch of string names, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Data.html#Constr\" rel=\"nofollow noreferrer\">take a look at its source</a>. And same applies to <code>DataType</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1555387654, "post_id": 55700144, "comment_id": 98082335, "body": "@FyodorSoikin It&#39;s really not that helpful to say &quot;look, here&#39;s the source, it just doesn&#39;t work.&quot; That frames it as a inexplicable bug when it&#39;s a design choice. @OP The principle of <code>Data</code> is that you operate on <i>values</i>. The facilities for inspecting the abstract structure of a type are not present in <code>Data</code>; that&#39;s not what it is for. <code>Data</code> is for walking the concrete structure of a value and its subvalues. You can&#39;t peek at a constructor&#39;s fields without having values for them, and using <code>undefined</code> is a brute-force band-aid. The correct tool to abstractly analyze a type is <code>Generic</code>."}, {"owner": {"reputation": 516, "user_id": 2016295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e6a79aa97060725367ba529cbf258f4?s=128&d=identicon&r=PG", "display_name": "Joomy Korkut", "link": "https://stackoverflow.com/users/2016295/joomy-korkut"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1555411145, "post_id": 55700144, "comment_id": 98093242, "body": "@HTNW I&#39;m fine with bruce-force band-aids as long as the clients of my functions don&#39;t see how it&#39;s implemented or don&#39;t get runtime errors. I want to avoid <code>Generic</code> because type-level hackery has problems of its own. See the accepted answer for how to use <code>Data</code> for this."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1555429625, "post_id": 55700144, "comment_id": 98104762, "body": "@JoomyKorkut Well, now I&#39;m interested. What&#39;s goes wrong with <code>Generic</code>?"}, {"owner": {"reputation": 516, "user_id": 2016295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e6a79aa97060725367ba529cbf258f4?s=128&d=identicon&r=PG", "display_name": "Joomy Korkut", "link": "https://stackoverflow.com/users/2016295/joomy-korkut"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1555430243, "post_id": 55700144, "comment_id": 98105097, "body": "@HTNW I can&#39;t go into full detail here but for what I want to do, I&#39;d need to have separate type class instances for <code>D1</code>,<code>C1</code>,<code>S1</code>,<code>U1</code>,<code>V1</code>,<code>:+:</code>,<code>:*:</code>,<code>Rec0</code> etc. I can go deep into the shape of an ADT, but I lose the big picture, keeping track of the initial point is more difficult, checking if a type is recursive or if it&#39;s mutually recursive via <code>Generic</code> is more difficult than it is with <code>Data</code> and <code>Typeable</code>. Not to mention that I&#39;d have to do it in type-level instead of value-level. Harder to understand and harder to present in a paper."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1555394513, "creation_date": 1555394513, "answer_id": 55701481, "question_id": 55700144, "link": "https://stackoverflow.com/questions/55700144/getting-the-argument-types-of-a-constructor-using-data-and-typeable/55701481#55701481", "title": "Getting the argument types of a constructor using Data and Typeable", "body": "<p>You can't get a list of argument types out of a <code>Constr</code>, because it just doesn't have enough data in it: it's a bunch of strings, nothing more.</p>\n\n<p>However, there is a way to achieve your bigger goal: you just need to carry the <code>Data</code> dictionary around with you, and what better way to do it than an existential type!</p>\n\n<pre><code>data D = forall a. Data a =&gt; D a\n\nallConstrArgs :: D -&gt; [[D]]\nallConstrArgs d = constrArgs d &lt;$&gt; allConstrs d\n\nconstrArgs :: D -&gt; Constr -&gt; [D]\nconstrArgs (D a) c = gmapQ D $ mkConstr a c\n    where\n        mkConstr :: forall a. Data a =&gt; a -&gt; Constr -&gt; a\n        mkConstr _ = fromConstr\n\nallConstrs :: D -&gt; [Constr]\nallConstrs (D a) = case dataTypeRep $ dataTypeOf a of\n    AlgRep constrs -&gt; constrs\n    _ -&gt; []\n\nmkD :: forall a. Data a =&gt; D\nmkD = D (undefined :: a)\n</code></pre>\n\n<p>Here the type <code>D</code> serves solely to wrap the <code>Data</code> dictionary - the actual value <code>a</code> will always be <code>undefined</code>, and never actually evaluated, so that's fine. The value <code>D</code> thus serves as a value-level representation of a type, such that upon destructuring you get a <code>Data</code> instance for that type in scope. </p>\n\n<p>The function <code>constrArgs</code> takes a type representation <code>D</code> and a constructor <code>Constr</code>, and returns a list of that constructor's parameters, each represented as <code>D</code> as well - so now you can feed its output back into its input! It does this by using <code>gmapQ</code>, whose first argument type perfectly fits the <code>D</code> constructor.</p>\n\n<p><code>mkD</code> is just a utility function meant to hide the unpleasantness of <code>undefined</code> and to be used with <code>TypeApplications</code>, e.g. <code>mkD @Int</code>.</p>\n\n<p>And here's usage:</p>\n\n<pre><code>data X = X0 Int | X1 String deriving (Typeable, Data)\ndata Y = Y0 String | Y1 Bool | Y2 Char deriving (Typeable, Data)\ndata Z = ZX X | ZY Y deriving (Typeable, Data)\n\ntypName :: D -&gt; String\ntypName (D a) = dataTypeName $ dataTypeOf a\n\nmain = do\n    -- Will print [[\"Prelude.Int\"],[\"Prelude.[]\"]]\n    print $ map typName &lt;$&gt; allConstrArgs (mkD @X)\n\n    -- Will print [[\"Prelude.[]\"],[\"Bool\"],[\"Prelude.Char\"]]\n    print $ map typName &lt;$&gt; allConstrArgs (mkD @Y)\n\n    -- Will print [[\"X\"],[\"Y\"]]\n    print $ map typName &lt;$&gt; allConstrArgs (mkD @Z)\n</code></pre>\n\n<p>Note that you will need the following extensions for this to work: <code>ScopedTypeVariables, DeriveDataTypeable, GADTs, AllowAmbiguousTypes, TypeApplications</code></p>\n"}], "owner": {"reputation": 516, "user_id": 2016295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e6a79aa97060725367ba529cbf258f4?s=128&d=identicon&r=PG", "display_name": "Joomy Korkut", "link": "https://stackoverflow.com/users/2016295/joomy-korkut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 55701481, "answer_count": 1, "score": 3, "last_activity_date": 1555406818, "creation_date": 1555385348, "last_edit_date": 1555406818, "question_id": 55700144, "link": "https://stackoverflow.com/questions/55700144/getting-the-argument-types-of-a-constructor-using-data-and-typeable", "title": "Getting the argument types of a constructor using Data and Typeable", "body": "<p>I'm playing around with Haskell's <a href=\"https://hackage.haskell.org/package/base/docs/Data-Data.html\" rel=\"nofollow noreferrer\">Data</a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Typeable.html\" rel=\"nofollow noreferrer\">Typeable</a>, and I'm stuck trying to get the arguments of a function without a type variable being available in the context.</p>\n\n<p>Let me clarify what I mean. As long as I have the type variable <code>a</code> quantified like below, I can use <code>fromConstr</code> and obtain a list of <code>DataType</code> or <code>TypeRep</code> as I wish:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>constrArgs :: forall a. Data a =&gt; Constr -&gt; [DataType]\nconstrArgs c = gmapQ f (fromConstr c :: a)\n  where f :: forall d. Data d =&gt; d -&gt; DataType\n        f _ = dataTypeOf @d undefined\n</code></pre>\n\n<p>(I realize the <code>undefined</code> and <code>fromConstr</code> are nontotal but laziness saves us here.)</p>\n\n<p>However, if I try to avoid quantifying <code>a</code>, I can no longer do a type ascription to the result of <code>fromConstr</code>. I wonder if there is a way to write a function with the following type signature:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>constrArgs' :: Constr -&gt; [DataType]\n</code></pre>\n\n<p>My end goal is to write a function that gives a list of lists of <code>DataType</code>s, a sublist for each constructor, each sublist containing the argument types of that constructor. Using the first version, it's not difficult to write a function with the type signature: (definition elided)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>allConstrArgs :: forall a. Data a =&gt; [[DataType]]\n</code></pre>\n\n<p>The problem with this is that I cannot apply <code>allConstrArgs</code> to the results of itself, because there is no way to go from <code>DataType</code> to a type-level value.</p>\n\n<p>So, in order to amend that, can we write a function that has the following type?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>allConstrsArgs' :: DataType -&gt; [[DataType]]\n</code></pre>\n\n<p>I looked around in the base library but I'm failing to see how this can be achieved.</p>\n"}, {"tags": ["haskell", "postgresql-simple"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555387362, "post_id": 55699557, "comment_id": 98082268, "body": "What is <code>ToRow</code>?"}, {"owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555413215, "post_id": 55699557, "comment_id": 98094474, "body": "Sorry the ToRow is a typeclass for postgresql-simple i will edit the question to show that"}], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "edited": false, "score": 0, "creation_date": 1555639075, "post_id": 55720723, "comment_id": 98187427, "body": "But when i save the type UserDetails type into my database i save it into a table with more columns than type fields are present and each record field maps accordingly to the column of the same name in the database."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "edited": false, "score": 0, "creation_date": 1555642395, "post_id": 55720723, "comment_id": 98187981, "body": "How do you save your <code>UserDetails</code> type into your database?  Is it not with an <code>insert</code> query?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1555480212, "creation_date": 1555480212, "answer_id": 55720723, "question_id": 55699557, "link": "https://stackoverflow.com/questions/55699557/how-to-serialize-a-type-to-specified-database-columns/55720723#55720723", "title": "How to Serialize a Type to specified database columns", "body": "<p><code>postgresql-simple</code> doesn't pay any attention to database column names.  It just expects the count and order of columns serialized or deserialized by the <code>ToRow</code>/<code>FromRow</code> instances will match the count and order of columns in the SQL query.  You can use the generic instance for <code>ToRow UserEditDetails</code> as long as the query you're feeding it to matches the four columns in the right order.  For example, if you have the following definition and generic <code>ToRow</code> instance:</p>\n\n<pre><code>data UserEditDetails = UserEditDetails\n  { ued_email :: Maybe Text\n  , ued_phone_number :: Maybe Text\n  , ued_address :: Maybe Text\n  , ued_name :: Maybe Text\n  } deriving (Show, Generic, ToRow)\n</code></pre>\n\n<p>then I believe the following query will work fine:</p>\n\n<pre><code>do let q = \"update user_table set email=?, phone_number=?, address=?, name=? \"\n           ++ \"where user_id=?\"\n   execute conn q $ (UserEditDetails\n                      (Just \"me@example.invalid\")\n                      (Just \"555-1212\")\n                      (Just \"123 Fake Street\")\n                      (Just \"Bob Jones\"))\n                    :. Only (15 :: Int)  -- user_id 15\n</code></pre>\n\n<p>Note that the generic instances from <code>FromRow</code> and <code>ToRow</code> are equivalent to:</p>\n\n<pre><code>instance ToRow UserEditDetails where\n  toRow (UserEditDetails a b c d) = [toField a, toField b, toField c, toField d]\ninstance FromRow UserEditDetails where\n  fromRow = UserEditDetails &lt;$&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field\n</code></pre>\n\n<p>The fields are anonymous and there's no place to give specific database columns anyway.</p>\n"}], "owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1555480212, "creation_date": 1555380281, "last_edit_date": 1555413499, "question_id": 55699557, "link": "https://stackoverflow.com/questions/55699557/how-to-serialize-a-type-to-specified-database-columns", "title": "How to Serialize a Type to specified database columns", "body": "<p>I am using postgresql-simple in a haskell application, and i want to be able to serialize a data type to a row in my database that doesn't have a 1 to 1 mapping of the record fields used in the data type  because i am using them in other data types. (I'm Fairly New to Haskell but I think this involves using the Identifier data constructor).</p>\n\n<p>Example I have a database table Users with the following columns: user_id, email, name, password, address, phone_number</p>\n\n<p>now I have a type with the following format:</p>\n\n<pre><code>data UserDetails = UserDetails {\n  user_id :: Int,\n  email :: Text,\n  phone_number :: Maybe (Text),\n  password :: Text,\n  name :: Maybe (Text),\n  address :: Maybe (Text),\n} deriving (Show, Generic, FromRow)\n</code></pre>\n\n<p>And i can have a generic ToRow implemented for this type no problem since the record fields are the same as the column names, but I have another type that i want to generate a ToRow instance for which is:</p>\n\n<pre><code>data UserEditDetails = UserEditDetails {\n  ued_email :: Maybe (Email),\n  ued_phone_number :: Maybe (Text),\n  ued_address :: Maybe (Text),\n  ued_name :: Maybe (Text),\n} deriving (Show, Generic)\n</code></pre>\n\n<p>how would i implement a ToRow instance of this type or more generally how can i write a ToRow instance like the following pseudo code</p>\n\n<pre><code>instance ToRow UserEditDetails where\n  toRow a = (columnname, ued_email a)... etc\n</code></pre>\n\n<p>hopefully it has a function similar to Aeson where you can easily write something like:</p>\n\n<pre><code>instance ToJSON Login where\n  toJSON = genericToJSON defaultOptions { fieldLabelModifier = drop 4 }\n</code></pre>\n\n<p>but i havent found this.</p>\n"}, {"tags": ["haskell", "web-hosting", "happstack"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1555352192, "post_id": 55694769, "comment_id": 98072710, "body": "It&#39;s very likely to work (if you recompile on linux). If you own a PC you might want to try one of the &quot;live&quot; linux distributions. Some can run from a USB stick, and do not require you to install anything on the hard drive, at the price of being slow-ish on IO. Using such a live distro, you can install stack, ghc, etc. (all on the USB key). Once you confirm that your program works fine, you can then buy/rent a linux host that fits your budget. Note that you windows exe won&#39;t run on linux, but you can recompile your app on linux and get a working linux executable."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1555354463, "post_id": 55694769, "comment_id": 98073628, "body": "Note it&#39;s very easy to just setup a Linux VM on windows to compile your project as a linux executable."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1555374586, "post_id": 55694769, "comment_id": 98079809, "body": "Recently I had to deploy a Haskell website as well which I was building on Windows. I also did what @Cubic suggested: I made an Ubuntu VM using VMWare, <code>git clone</code>d my project onto it, and built it. For the actual deployment, I used Amazon Elastic Beanstalk along with Docker (see <a href=\"https://www.reddit.com/r/haskell/comments/arzynu/installing_haskell_on_ec2_instance/egtvtlv?utm_source=share&amp;utm_medium=web2x\" rel=\"nofollow noreferrer\">here</a> for some more details). (Continued in next comment...)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1555374600, "post_id": 55694769, "comment_id": 98079812, "body": "... Note that if you&#39;re using a recent version of Windows you may be able to use the <a href=\"https://docs.microsoft.com/en-us/windows/wsl/faq\" rel=\"nofollow noreferrer\">Windows Subsystem for Linux</a> instead of a VM."}], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 10956534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2df8c89062ac55a17601e33aeb91f4?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/10956534/david"}, "edited": false, "score": 0, "creation_date": 1555598774, "post_id": 55695315, "comment_id": 98173846, "body": "Thanks all - I now have it up and running! Wasn&#39;t entirely painless. In summary, here&#39;s what I did:"}, {"owner": {"reputation": 187, "user_id": 10956534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2df8c89062ac55a17601e33aeb91f4?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/10956534/david"}, "edited": false, "score": 0, "creation_date": 1555599180, "post_id": 55695315, "comment_id": 98174043, "body": "1) Install VMware &amp; Ubuntu (I couldn&#39;t get &quot;live&quot; (USB stick) distro to work, nor WSL). 2) Download Haskell, happstack-server, copy my source over, recompile. 3) Installed docker, created Dockfile, built &amp; tested docker image. 4) Created (free) docker account &amp; repo and pushed my image to it. 5) Created AWS account, started a (free) EC2 ubuntu image. 6) installed docker, ran my image - it magically downloaded, runs and works!"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1555996151, "post_id": 55695315, "comment_id": 98277177, "body": "NB: you can also compile Linux binaries in Docker for Windows."}, {"owner": {"reputation": 187, "user_id": 10956534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2df8c89062ac55a17601e33aeb91f4?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/10956534/david"}, "edited": false, "score": 0, "creation_date": 1556432709, "post_id": 55695315, "comment_id": 98432580, "body": "Thanks Jeremy - this was what I was hoping initially, but couldn&#39;t figure out how to do it. Are there some instructions somewhere? Is it a gch compile flag?"}], "tags": [], "owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "is_accepted": true, "score": 4, "last_activity_date": 1555353153, "creation_date": 1555353153, "answer_id": 55695315, "question_id": 55694769, "link": "https://stackoverflow.com/questions/55694769/how-can-i-host-a-haskell-website-build-on-windows-on-centos-ubuntu/55695315#55695315", "title": "(How) can I host a Haskell website build on Windows on CentOS / Ubuntu?", "body": "<p>Your .exe would not run on CentOS/Ubuntu without some kind of emulation. I would not recommend going down this path as it tends to run really slow in my experience. It has something to do with how thunks are allocated on Windows vs how thunks are allocated on Linux, and emulating one of them on the other is just asking for trouble. </p>\n\n<p>If you google around, you can find people talking about cross compiling Haskell from Windows to Linux, but it seems rough.</p>\n\n<p>If you want to run your website on CentOS or Ubuntu, then you should compile it on one of those distributions. If you aren't using anything that's Windows specific in your code, then you should just be able to compile your code for your target without changing anything (Haskell is much easier to work with on Linux in my experience).</p>\n\n<p>Someone else suggested downloading a \"live\" distro, and that would probably be the easiest way to get started compiling your code for CentOS/Ubuntu.</p>\n"}], "owner": {"reputation": 187, "user_id": 10956534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2df8c89062ac55a17601e33aeb91f4?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/10956534/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 55695315, "answer_count": 1, "score": -1, "last_activity_date": 1555353153, "creation_date": 1555350686, "last_edit_date": 1555351767, "question_id": 55694769, "link": "https://stackoverflow.com/questions/55694769/how-can-i-host-a-haskell-website-build-on-windows-on-centos-ubuntu", "title": "(How) can I host a Haskell website build on Windows on CentOS / Ubuntu?", "body": "<p>I've built a website in Haskell (using Happstack) that I now want to host somewhere. I built it on Windows, using ghc to produce a file called website.exe. It's my first program in Haskell, and first website, but works very well when I run the .exe in Windows and type localhost:8000 into my browser.</p>\n\n<p>I understand (from <a href=\"https://stackoverflow.com/questions/51064865/how-to-host-a-happstack-website\">Q 51064865</a>) that I need a VPS to host it, but what kind of OS do I need? I'd guess Windows, but that seems very expensive. Would my exe run on CentOS or Ubuntu? (tbh I'm not 100% sure what these are - but it seems a lot cheaper to get a VPS with them!) Can I make ghc compiler (running on Windows) generate an executable that would?</p>\n\n<p>My objective is to host the website cheaply (I'm not expecting any income from it), and am open to any suggestions.</p>\n\n<p>Sorry if the question is dumb/already answered somewhere.</p>\n"}, {"tags": ["haskell", "random", "sha", "bytestring"], "answers": [{"comments": [{"owner": {"reputation": 418, "user_id": 336879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/304a917272a2cf18e14934ad00303f90?s=128&d=identicon&r=PG", "display_name": "Adjam", "link": "https://stackoverflow.com/users/336879/adjam"}, "edited": false, "score": 0, "creation_date": 1555345341, "post_id": 55693330, "comment_id": 98069637, "body": "I&#39;ve tried Data.Bytestring, it just throws different errors"}, {"owner": {"reputation": 418, "user_id": 336879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/304a917272a2cf18e14934ad00303f90?s=128&d=identicon&r=PG", "display_name": "Adjam", "link": "https://stackoverflow.com/users/336879/adjam"}, "edited": false, "score": 0, "creation_date": 1555346043, "post_id": 55693330, "comment_id": 98069999, "body": "I tried it with Data.Bytestring.Lazy and it throws similar errors. Thanks for the effort though!"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 0, "last_activity_date": 1555345631, "last_edit_date": 1555345631, "creation_date": 1555344853, "answer_id": 55693330, "question_id": 55693172, "link": "https://stackoverflow.com/questions/55693172/trying-to-pass-a-random-string-to-sha-in-haskell/55693330#55693330", "title": "Trying to pass a random string to SHA in Haskell", "body": "<p>You need <code>Data.ByteString.Lazy</code>, not <code>Data.ByteString.Char8</code>.</p>\n\n<p>In general, you almost never want <code>Data.ByteString.Char8</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1555346049, "creation_date": 1555346049, "answer_id": 55693640, "question_id": 55693172, "link": "https://stackoverflow.com/questions/55693172/trying-to-pass-a-random-string-to-sha-in-haskell/55693640#55693640", "title": "Trying to pass a random string to SHA in Haskell", "body": "<p>Just use the lazy bytestrings as @leftaroundabout mentioned.  Your try didn't work because you want to pack from Strings, so you need to import the .Char8 module to achieve that:</p>\n\n<pre><code>import Data.ByteString.Lazy.Char8 as C\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1555350835, "creation_date": 1555350835, "answer_id": 55694804, "question_id": 55693172, "link": "https://stackoverflow.com/questions/55693172/trying-to-pass-a-random-string-to-sha-in-haskell/55694804#55694804", "title": "Trying to pass a random string to SHA in Haskell", "body": "<p>The issue is that a <code>ByteString</code> is a sequence of bytes, while a <code>String</code> is a sequence of chars. There are many ways to turn chars into bytes, so you need to specify which encoding you want. Most likely, you want an ASCII or UTF8 encoding. If so, you can use this solution below, which converts strings into \"UTF8 bytes\" as needed.</p>\n\n<pre><code>import Data.Digest.Pure.SHA\nimport System.Random\nimport qualified Data.ByteString.Lazy as C\nimport qualified Data.ByteString.Lazy.UTF8 as U\n\nmain :: IO ()\n\nmain = do\n  num &lt;- randomIO :: IO Float\n\n  let x = U.fromString (show (num*10000000))\n\n  print x\n\n  let a = sha256 x\n\n      b = hmacSha256 (U.fromString \"key\") (U.fromString \"some test message\")\n  mapM_ print [showDigest a, showDigest b]\n</code></pre>\n"}], "owner": {"reputation": 418, "user_id": 336879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/304a917272a2cf18e14934ad00303f90?s=128&d=identicon&r=PG", "display_name": "Adjam", "link": "https://stackoverflow.com/users/336879/adjam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 55694804, "answer_count": 3, "score": 1, "last_activity_date": 1555350835, "creation_date": 1555344286, "last_edit_date": 1555346001, "question_id": 55693172, "link": "https://stackoverflow.com/questions/55693172/trying-to-pass-a-random-string-to-sha-in-haskell", "title": "Trying to pass a random string to SHA in Haskell", "body": "<p>I'm trying to pass a random string (which happens to be a number) \"4176730.5\" to SHA in Haskell to get a larger random string like \"2d711642b726b04401627ca9fbac32f5c8530fb1903cc4db02258717921a4881\".</p>\n\n<p>I have this code to generate a random number and cast it to a string</p>\n\n<pre><code>  num &lt;- randomIO :: IO Float\n\n  let x = C.pack (show (num*10000000))\n\n  print x\n</code></pre>\n\n<p>but when I pass it to SHA with</p>\n\n<pre><code>  let a = sha256 x\n</code></pre>\n\n<p>I get the error </p>\n\n<pre><code>Couldn't match expected type \u2018Data.ByteString.Lazy.Internal.ByteString\u2019\n            with actual type \u2018C.ByteString\u2019\n</code></pre>\n\n<p>I've tried casting my number to C.ByteString, but I think there are two types of Bytestring, according to the Haskell compiler. </p>\n\n<p>The full code is: </p>\n\n<pre><code>import Data.Digest.Pure.SHA\nimport System.Random\nimport qualified Data.ByteString.Char8 as C\n\nmain :: IO ()\n\nmain = do\n  num &lt;- randomIO :: IO Float\n\n  let x = C.pack (show (num*10000000))\n\n  print x\n\n  let a = sha256 x\n\n      b = hmacSha256 \"key\" \"some test message\"\n  mapM_ print [showDigest a, showDigest b]\n</code></pre>\n\n<p>Seeing as how there are apparently two types of Bytestring, and I'm casting to the wrong one, how do I cast my random string correctly?</p>\n\n<p>Further to @Cubic's answer below if I replace \n    import qualified Data.ByteString.Char8 as C\nwith </p>\n\n<pre><code>import qualified Data.ByteString.Lazy as C\n</code></pre>\n\n<p>I just get these errors</p>\n\n<pre><code>Couldn't match type \u2018Char\u2019 with \u2018GHC.Word.Word8\u2019\nExpected type: [GHC.Word.Word8]\n  Actual type: String\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Couldn't match expected type \u2018C.ByteString\u2019\n            with actual type \u2018[Char]\u2019\n</code></pre>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1555339369, "post_id": 55691337, "comment_id": 98066181, "body": "I tried to <a href=\"https://books.google.com/books?id=olp7lAtpRX0C&amp;printsec=frontcover&amp;dq=programming+in+haskell&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwi_59SPqtLhAhXimOAKHRnIBOYQ6AEIKDAA#v=onepage&amp;q=only%20one%20way&amp;f=false\" rel=\"nofollow noreferrer\">find this text</a> in the book so I could check that the context doesn&#39;t change the meaning, but it doesn&#39;t seem to appear (in the edition Google Books has, at least). What page/chapter/section is that from? Are you sure you&#39;re quoting it precisely? Tiny variants in wording can matter a lot with these things."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1555342768, "post_id": 55691337, "comment_id": 98068220, "body": "I wonder if the author meant any function obeying the function laws must be fmap?"}, {"owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1555343537, "post_id": 55691337, "comment_id": 98068675, "body": "@DanielWagner page 163, third paragraph from the bottom. It looks like the book you linked is the first edition, whereas I&#39;m reading the second edition."}, {"owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1555343556, "post_id": 55691337, "comment_id": 98068690, "body": "@augustss I believe that must be what he meant."}], "answers": [{"comments": [{"owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "edited": false, "score": 0, "creation_date": 1555338768, "post_id": 55691492, "comment_id": 98065808, "body": "Just as I expected. Thanks :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1555338831, "post_id": 55691492, "comment_id": 98065849, "body": "But that&#39;s <i>not</i> what the quote is claiming! For instance <code>const []</code> has type <code>q -&gt; [a] -&gt; [b]</code>, not <code>Functor f =&gt; (a-&gt;b) -&gt; f a -&gt; f b</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1555339043, "post_id": 55691492, "comment_id": 98065984, "body": "@leftaroundabout I think the &quot;any given parameterised type&quot; bit indicates that they are talking about <code>(a -&gt; b) -&gt; F a -&gt; F b</code> for concrete choices of <code>F</code> (...say, <code>F = []</code>), not <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>. But perhaps more context is needed to say for sure."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555339403, "post_id": 55691492, "comment_id": 98066212, "body": "you could maybe simplify the <code>maybeIt&#39;sFmapLol</code> example by taking progressively longer chunks and <i>diagonalizing</i> that matrix! or something :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555339553, "post_id": 55691492, "comment_id": 98066295, "body": "@WillNess I don&#39;t think so. Let&#39;s shorten <code>maybeIt&#39;sFmapLol ixf elemf</code> to <code>g</code> for a moment; there&#39;s no guarantee that <code>g (xs ++ ys) = g xs ++ g ys</code> -- that is, that giving it longer lists produces things that start with the same suffix as the short list -- which you would need for taking progressively longer chunks to be correct."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555339965, "post_id": 55691492, "comment_id": 98066571, "body": "@WillNess For a concrete example, consider <code>notFmap f [] = []; notFmap f xs = [f (last xs)]</code>, for which the true answer of <code>notFmap f xs</code> is not the diagonalization of <code>notFmap f</code> applied to any collection of prefixes of <code>xs</code>. It is an example of the general case given in the answer via <code>notFmap = maybeIt&#39;sFmapLol $ \\case 0 -&gt; []; n -&gt; [n-1]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555340104, "post_id": 55691492, "comment_id": 98066666, "body": "ah, you mean it would not be general enough! it&#39;s fair. yes, my scheme would preserve every element, just mix their order. <code>[f (last xs)]</code> is a nice and simple example, maybe you ought to include it in the answer too. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1555426363, "post_id": 55691492, "comment_id": 98102849, "body": "looks like it is a bad wording, in the book. just before that quote the author refers to a passage where he explicitly mentions following the laws and the uniqueness of fmap. so he probably meant that as the context, and the wording in the quoted sentence was just sloppy in that it assumed that context, without saying so explicitly."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1555340600, "last_edit_date": 1555340600, "creation_date": 1555338713, "answer_id": 55691492, "question_id": 55691337, "link": "https://stackoverflow.com/questions/55691337/any-function-with-the-same-polymorphic-type-as-fmap-must-be-equal-to-fmap/55691492#55691492", "title": "Any function with the same polymorphic type as fmap must be equal to fmap?", "body": "<p>It is a mistake. Here's some examples of functions with the same type as <code>fmap</code> for lists that are not <code>fmap</code>:</p>\n\n<pre><code>\\f -&gt; const []\n\\f -&gt; concatMap (replicate 2 . f)\n\\f -&gt; map (f . head) . chunksOf 2\n\\f -&gt; map f . reverse\n</code></pre>\n\n<p>There are many more. In general, given a function <code>ixf</code> from list lengths to lists of numbers no bigger than that length (that is, valid indices into the list), we can build</p>\n\n<pre><code>maybeIt'sFmapLol :: (Int -&gt; [Int]) -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\nmaybeIt'sFmapLol ixf elemf xs = [map elemf xs !! ix | ix &lt;- ixf (length xs)]\n</code></pre>\n\n<p>Use suitably lazy variants of <code>Int</code> to handle infinite lists. A similar function schema can be cooked up for other container-like functors.</p>\n"}, {"comments": [{"owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "edited": false, "score": 0, "creation_date": 1555343650, "post_id": 55691902, "comment_id": 98068739, "body": "Aha! That makes a lot of sense."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1555348276, "post_id": 55691902, "comment_id": 98071012, "body": "&quot;in principle the quote is correct&quot; Is it, if you take into account existence of types which can&#39;t be made into functors? I think it isn&#39;t, and &quot;only one way&quot; needs to be changed &quot;at most one way&quot;."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1555354679, "post_id": 55691902, "comment_id": 98073724, "body": "@AlexeyRomanov I don&#39;t think he&#39;s saying that any parameterised type can be a functor, I think he&#39;s saying that you can only have a single Functor implementation for any parameterised type (as opposed to potentially multiple). It&#39;s clearly meant to be a plain english description rather than rigorous language."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555410782, "post_id": 55691902, "comment_id": 98093007, "body": "this answer literally makes no sense to me. If I have to write a function with a signature <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>, the <i>only</i> thing I know about <code>f</code> is that it is a <code>Functor</code>. And the only thing I can use then, is <code>fmap</code>. Not &quot;equivalent&quot; -- there simple is nothing else at my disposal to use! (discounting bottoms of course). I can&#39;t assume that it is an Applicative or Monad, even. <i>Nothing.</i> And if I know something about a <i>specific</i> <code>f</code> and am using that specific thing to write this function, I can&#39;t use the constraint in the type -- <i>by definition</i>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555413885, "post_id": 55691902, "comment_id": 98094868, "body": "@WillNess ok. Well as it stands, your comment doesn&#39;t make a whole lot of sense <i>to me</i>; elaborate what you mean? It seems you&#39;re just confirming what I wrote in the middle paragraph."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555426066, "post_id": 55691902, "comment_id": 98102661, "body": "I don&#39;t know. &quot;will indeed also in practice obey the functor laws&quot; seems to imply there are some options here for us to write <i>something</i>. there simply aren&#39;t, <code>fmap</code> is all we have. unless you consider something like <code>foo g f = sum [1..10] `seq` fmap g f</code> as a possibility, which I wasn&#39;t... so maybe it&#39;s just semantics. OTOH a question &quot;is a function with fmap&#39;s signature <i>for some specific <code>f</code>, so, without the constraint</i> (optionally -- abiding by functor laws) always equivalent to <code>fmap</code>?&quot; seems much more meaningful. that&#39;s what I meant."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555793684, "post_id": 55691902, "comment_id": 98227328, "body": "@WillNess What about something like <code>flip (flip fmap)</code> as an option?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1555793876, "post_id": 55691902, "comment_id": 98227368, "body": "@AlexeyRomanov that is in every meaningful sense the same as <code>fmap</code>. Certainly, it is <i>extensionally equal</i> to <code>fmap</code>, and will practice probably even compile to the same machine code. Different source code does <i>not</i> mean two functions are different."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1555794213, "post_id": 55691902, "comment_id": 98227437, "body": "@leftaroundabout Yes, and I understood that to be the point of the answer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1555831456, "post_id": 55691902, "comment_id": 98232596, "body": "@AlexeyRomanov and hence my comment. :) fmap is fmap is fmap. for me, this says nothing. If fmap is the only tool at your disposal, a tool you&#39;re going to end up using is, non-surprisingly, fmap."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1555841482, "post_id": 55691902, "comment_id": 98234575, "body": "@WillNess But you can use <code>fmap</code> to produce functions that <i>aren&#39;t</i> <code>fmap</code>, e.g. <code>void</code>, <code>(&lt;$)</code>, <code>flip fmap</code>. It&#39;s just that none of them end up having type <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>, and that anything you write using <code>fmap</code> with that type does end up being the same as <code>fmap</code>. As a counter-example, there <i>is</i> more than one way to implement <code>Applicative f =&gt; f a -&gt; f b -&gt; f a</code>: <code>const</code> and <code>(&lt;*)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1555841735, "post_id": 55691902, "comment_id": 98234627, "body": "...and perhaps more remarkably, <code>Applicative f =&gt; (a-&gt;b-&gt;c)-&gt;f a-&gt;f b-&gt;f c</code> has both <code>liftA2</code> and <code>flip . liftA2 . flip</code>, which are <i>not</i> equivalent."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1555843732, "post_id": 55691902, "comment_id": 98235097, "body": "Or maybe even a closer analogy is that you can write infinitely many functions with the same type as <code>(&lt;*&gt;)</code> which aren&#39;t equivalent to it, e.g. <code>\\f x -&gt; (f &lt;* x &lt;* ... &lt;* x) &lt;*&gt; x</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1555850230, "post_id": 55691902, "comment_id": 98236378, "body": "@AlexeyRomanov of course you can go sideways but the question was how to &#39;get to the target&#39;. And Applicative has lots of &quot;tools to use&quot;, not just one (and <i>two</i> effectful values). the only substantive thing in play here is <code>fmap id === id</code>, which I now see, thanks to your comments."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1555340122, "creation_date": 1555340122, "answer_id": 55691902, "question_id": 55691337, "link": "https://stackoverflow.com/questions/55691337/any-function-with-the-same-polymorphic-type-as-fmap-must-be-equal-to-fmap/55691902#55691902", "title": "Any function with the same polymorphic type as fmap must be equal to fmap?", "body": "<p>You've misread what the author was saying.</p>\n\n<blockquote>\n  <p>...any function with <strong>the same polymorphic type as <code>fmap</code></strong>...</p>\n</blockquote>\n\n<p>This means, any function with the signature</p>\n\n<pre><code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>must be equivalant to <code>fmap</code>. (Unless you permit bottom values, of course.)</p>\n\n<p>That statement is true; it can be seen quite easily if you try to define such a function: because you know nothing about <code>f</code> except that it's a functor, the only way to obtain a non-\u22a5 <code>f b</code> value is by fmapping over the <code>f a</code> one.</p>\n\n<p>What's a bit less clear cut is the logical implication in the quote:</p>\n\n<blockquote>\n  <p>there is only one way to make any given parameterised type into a functor, and <strong>hence</strong> any function with the same polymorphic type as fmap must be equal to fmap.</p>\n</blockquote>\n\n<p>I think what the author means there is, because a <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> function must necessarily invoke <code>fmap</code>, and because <code>fmap</code> is always <em>the only</em> valid functor-mapping for a parameterised type, any <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> will indeed also in practice obey the functor laws, i.e. it will be <em>the</em> <code>fmap</code>.</p>\n\n<p>I agree that the \u201chence\u201d is a bit badly phrased, but in principle the quote is correct.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1555354464, "post_id": 55693333, "comment_id": 98073629, "body": "In fact all that is necessary to verify is <code>fmap id = id</code> , the other comes for free"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1555345212, "last_edit_date": 1555345212, "creation_date": 1555344854, "answer_id": 55693333, "question_id": 55691337, "link": "https://stackoverflow.com/questions/55691337/any-function-with-the-same-polymorphic-type-as-fmap-must-be-equal-to-fmap/55693333#55693333", "title": "Any function with the same polymorphic type as fmap must be equal to fmap?", "body": "<p>I think that the quote refers to this scenario. Assume we define a parameterized type:</p>\n\n<pre><code>data F a = .... -- whatever\n</code></pre>\n\n<p>for which we can write not only one, but two <code>fmap</code> implementations</p>\n\n<pre><code>fmap1 :: (a -&gt; b) -&gt; F a -&gt; F b\nfmap2 :: (a -&gt; b) -&gt; F a -&gt; F b\n</code></pre>\n\n<p>satisfying the functor laws</p>\n\n<pre><code>fmap1 id = id\nfmap1 (f . g) = fmap1 f . fmap1 g\nfmap2 id = id\nfmap2 (f . g) = fmap2 f . fmap2 g\n</code></pre>\n\n<p>Under these assumptions, we have that <code>fmap1 = fmap2</code>.</p>\n\n<p>This is a theoretical consequence of the \"free theorem\" associated to <code>fmap</code>'s polymorphic type (see the comment under <a href=\"https://www.schoolofhaskell.com/user/edwardk/snippets/fmap\" rel=\"nofollow noreferrer\">Lemma 1</a>).\nPragmatically, this ensures that the instance we obtain from <code>deriving Functor</code> is the only possible one.</p>\n"}], "owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 55691902, "answer_count": 3, "score": 4, "last_activity_date": 1555345212, "creation_date": 1555338226, "question_id": 55691337, "link": "https://stackoverflow.com/questions/55691337/any-function-with-the-same-polymorphic-type-as-fmap-must-be-equal-to-fmap", "title": "Any function with the same polymorphic type as fmap must be equal to fmap?", "body": "<p>I'm reading the second edition of Programming in Haskell and I've came across this sentence:</p>\n\n<blockquote>\n  <p>... there is only one way to make any given parameterised type into a functor, and hence any function with the same polymorphic type as <code>fmap</code> must be equal to <code>fmap</code>.</p>\n</blockquote>\n\n<p>This doesn't seem right to me, though. I can see that there is only one <em>valid</em> definition of <code>fmap</code> for each <code>Functor</code> type, but surely I could define any number of functions with the type <code>(a -&gt; b) -&gt; f a -&gt; f b</code> which aren't equivalent to each other?</p>\n\n<p>Why is this the case? Or, is it just a mistake by the author?</p>\n"}, {"tags": ["haskell", "constraint-kinds"], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1555343129, "post_id": 55690926, "comment_id": 98068460, "body": "You can also make a type class <code>class Empty a</code> with no methods and a trivial <code>instance Empty a</code>.  It\u2019s not quite what you asked for, but it should work."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1555336988, "creation_date": 1555336988, "answer_id": 55690926, "question_id": 55690357, "link": "https://stackoverflow.com/questions/55690357/higher-kinded-empty-constraint/55690926#55690926", "title": "Higher kinded empty constraint", "body": "<p>You'll need to give it an explicit additional argument in the class declaration.</p>\n\n<pre><code>class Category k where\n  type Obj k a :: Constraint\n</code></pre>\n\n<p>Then it's easy to define the instances using the lower-kinded <code>()</code> empty constraint.</p>\n\n<pre><code>instance Category (-&gt;) where\n  type Obj (-&gt;) a = ()\n</code></pre>\n"}], "owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 55690926, "answer_count": 1, "score": 2, "last_activity_date": 1555336988, "creation_date": 1555335135, "last_edit_date": 1555336926, "question_id": 55690357, "link": "https://stackoverflow.com/questions/55690357/higher-kinded-empty-constraint", "title": "Higher kinded empty constraint", "body": "<p>I want to have an empty constraint at a higher kind.</p>\n\n<p>Suppose I have the following class:</p>\n\n<pre><code>class Category k where\n  type Obj k :: * -&gt; Constraint\n  id  :: Obj k a =&gt; a `k` a\n  (.) :: (Obj k a, Obj k b, Obj k c) =&gt; b `k` c -&gt; a `k` b -&gt; a `k` c\n</code></pre>\n\n<p>Now I want to make an instance for functions such that it doesn't constrain the elements in any way. What do I give as an instance for <code>Obj</code>?</p>\n\n<pre><code>instance Category (-&gt;) where\n  type Obj (-&gt;) = ?\n  id    = \\a -&gt; a\n  f . g = \\a -&gt; f (g a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1555335633, "post_id": 55690195, "comment_id": 98063972, "body": "Yikes. There&#39;s a <i>lot</i> of errors. Covering them all would cover about half the material of a complete Haskell tutorial. Maybe you&#39;d better start with some simpler list-manipulation functions to get some practice with the basics before trying a sorting algorithm. Say, <code>sum</code> for adding up all the numbers in a list; <code>and</code> for checking if a list has <code>False</code> anywhere in it; <code>length</code> for finding out how many elements a list has; maybe a specialized <code>filter</code> or something that takes a <code>[Char]</code> and returns a list of the upper-case characters from it; and so on."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1555336597, "creation_date": 1555336597, "answer_id": 55690798, "question_id": 55690195, "link": "https://stackoverflow.com/questions/55690195/correction-to-the-code-of-mergesort-and-merge-in-haskell/55690798#55690798", "title": "correction to the code of mergesort and merge in haskell", "body": "<p>As it stands, the only error the compiler gives is this one:</p>\n\n<pre><code>test.hs:8:34: error: parse error on input \u2018|\u2019\n  |\n8 |                                  | comparision &gt; 0 = x:xs\n  |                                  ^\n</code></pre>\n\n<p>Therefore I will assume this is the one you are stuck on, and talk about how to fix this problem.</p>\n\n<p>The basic issue is that guards (that is, the syntactic form where there's a pipe character <code>|</code> followed by a condition) are only allowed at binding sites (like function equations or inside <code>case</code> statements). You've included yours at an incorrect position. It's not completely clear what you mean those guards to do, so I'm not too certain how to help you put them in the correct position.</p>\n\n<p>Perhaps the best help I can give is to describe what they mean with some abstract examples, and let you figure out where you want them to go instead. Take this as an example:</p>\n\n<pre><code>f x y | cond1 = val1\n      | cond2 = val2\n      | cond3 = val3\n</code></pre>\n\n<p>This defines a new function named <code>f</code>, which takes two arguments. It names the arguments <code>x</code> and <code>y</code>. Then, to decide what value to return, it checks the guards, looking for the first one that evaluates to <code>True</code>. So if <code>cond1</code> evaluates to <code>True</code>, the function returns <code>val1</code>; if <code>cond1</code> evaluates to <code>False</code> but <code>cond2</code> evaluates to <code>True</code>, the function returns <code>val2</code>; if <code>cond1</code> and <code>cond2</code> evaluate to <code>False</code> but <code>cond3</code> evaluates to <code>True</code>, the function returns <code>val3</code>. (..and if all three conditions evaluate to <code>False</code>, it throws a runtime exception.)</p>\n\n<p>Now let's look at the syntax you used:</p>\n\n<pre><code>mergesort (x:xs) = if xs &gt;=2 then mergesort xs else mergesort(x:xs)\n                                 | comparision &gt; 0 = x:xs\n                                 | comparision &lt;= 0 =  xs:x\n</code></pre>\n\n<p>It here you are defining a new function named <code>mergesort</code> that accepts one argument. It matches that argument against the pattern <code>x:xs</code>. Then it appears to return the result of <code>if xs &gt;=2 then mergesort xs else mergesort(x:xs)</code>. But what are these two extra guards doing? I don't know. Perhaps you are imagining that if <code>comparision &gt; 0</code>, then the function will return <code>x:xs</code> <em>instead</em> of <code>if xs &gt;=2 then ... else ...</code>. If so, you should write it this way:</p>\n\n<pre><code>mergesort (x:xs) | comparision &gt; 0 = x:xs\n                 | comparision &lt;= 0 = xs:x\n                 | otherwise = if x &gt;=2 then mergesort xs else mergesort(x:xs)\n</code></pre>\n\n<p>Or perhaps you are imagining that if <code>comparision &gt; 0</code>, then the recursive call will use <code>x:xs</code> instead of <code>(x:xs)</code>. If so, you should write it this way:</p>\n\n<pre><code>mergesort (x:xs) | comparision &gt; 0 = if x &gt;=2 then mergesort xs else mergesort(x:xs)\n                 | comparision &lt;= 0 = if x &gt;=2 then mergesort xs else mergesort(xs:x)\n</code></pre>\n\n<p>I'm not sure what was intended.</p>\n\n<p>Anyway, hopefully this helps you resolve your parse error, and gets you to the point where you can look at the next compiler errors and take a stab at fixing those yourself.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1555408154, "post_id": 55691493, "comment_id": 98091456, "body": "your last advice could also be phrased as &quot;write lots of very short functions first, and use <i>them</i> to implement your main function. don&#39;t try to write it all out at once. define a separate function for each separate step in your algorithm first.&quot;"}], "tags": [], "owner": {"reputation": 183, "user_id": 7938987, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFuHh.png?s=128&g=1", "display_name": "Foobie Bletch", "link": "https://stackoverflow.com/users/7938987/foobie-bletch"}, "is_accepted": false, "score": 2, "last_activity_date": 1586308188, "last_edit_date": 1586308188, "creation_date": 1555338720, "answer_id": 55691493, "question_id": 55690195, "link": "https://stackoverflow.com/questions/55690195/correction-to-the-code-of-mergesort-and-merge-in-haskell/55691493#55691493", "title": "correction to the code of mergesort and merge in haskell", "body": "<p>A couple questions to ask yourself: </p>\n\n<ol>\n<li>What, specifically, are you trying to do with the functions <code>merge</code> and <code>mergesort</code>? Suppose I have a list I want sorted -- just one list, not yet split up. Which function should I call to use your implementation of the merge sort?</li>\n<li>Based on the type signature <code>mergesort :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, how many arguments should <code>mergesort</code> have?</li>\n<li>What are the types of <code>x</code> and <code>xs</code>? Are all functions you're applying to variables defined for those types? I see the functions <code>-</code>, <code>:</code>, <code>&gt;=</code>, and <code>mergesort</code>. The types given for those functions (except for <code>mergesort</code>) by ghci's <code>:t</code> are as follows:\n\n<ul>\n<li><code>(-) :: Num a =&gt; a -&gt; a -&gt; a</code>. This means:\n\n<ol>\n<li><code>(-)</code> takes two arguments of the same type. This type must belong to the typeclass <code>Num</code> -- that is, it must be some kind of number.</li>\n<li><code>(-)</code> returns a single value of that type.</li>\n</ol></li>\n<li><code>(:) :: a -&gt; [a] -&gt; [a]</code>. This means:\n\n<ol>\n<li><code>(:)</code> takes an argument of one type, and another argument that is a <em>list</em> of values of that type.</li>\n<li><code>(:)</code> returns a list of values of that type.</li>\n</ol></li>\n<li><code>(&gt;=) :: Ord a =&gt; a -&gt; a -&gt; Bool</code>. This means:\n\n<ol>\n<li><code>(&gt;=)</code> takes two arguments of the same type. This type must belong to the <code>Ord</code> typeclass -- that is, it must be possible to compare two values of that type and say that one value is greater than, less than, or equal to the other value. (In <code>Prelude</code>, this includes all members of typeclass <code>Num</code>.)</li>\n<li><code>(&gt;=)</code> returns a <code>Bool</code>.</li>\n</ol></li>\n</ul></li>\n</ol>\n\n<p>You should also think about how you want to structure your implementation. Think about how the merge sort works. Look at the steps, think about how you can implement those steps as functions, and how you can connect those steps together with one <code>mergesort</code> function. Once you have a design planned out, <em>then</em> you should worry about the syntax.</p>\n"}], "owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1586308188, "creation_date": 1555334632, "question_id": 55690195, "link": "https://stackoverflow.com/questions/55690195/correction-to-the-code-of-mergesort-and-merge-in-haskell", "title": "correction to the code of mergesort and merge in haskell", "body": "<pre><code>merge ::(ord a) =&gt; [a] -&gt;[a] -&gt; [a]\nmerge [][] = []\nmerge [a][b] = [[a,b]|a&lt;-mergesort [a],b&lt;- mergesort [b]]\n\nmergesort ::(a -&gt; Bool) -&gt; [a] -&gt; [a]\nmergesort [] = []\nmergesort (x:xs) = if xs &gt;=2 then mergesort xs else mergesort(x:xs)\n                                 | comparision &gt; 0 = x:xs\n                                 | comparision &lt;= 0 =  xs:x\n                                  where comparision = x-xs\n</code></pre>\n\n<p>That is the code what I've written for merge and mergesort and is not right of course.</p>\n\n<p>Could you give some advises to correct the code?\nplese don't give me the answers....</p>\n"}, {"tags": ["string", "haskell", "infinite-loop", "accumulate", "left-recursion"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1555330760, "post_id": 55688744, "comment_id": 98061016, "body": "Remember that all data in Haskell is immutable\u2014you cannot change a variable. When you write <code>let str = str ++ &quot;nothing&quot;</code>, Haskell reads that as <i>&quot;Construct a new value called <code>str</code>, which has the property that <code>str = str ++ &quot;nothing&quot;</code>,&quot;</i> in other words a never-ending recursive computation."}], "answers": [{"comments": [{"owner": {"reputation": 80, "user_id": 7196404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oesDG.jpg?s=128&g=1", "display_name": "Dean", "link": "https://stackoverflow.com/users/7196404/dean"}, "edited": false, "score": 0, "creation_date": 1555330141, "post_id": 55688838, "comment_id": 98060662, "body": "The problem is im trying to add a bunch of strings to the end of that string , so if i dont use recursion it will just overwrite everytime. Im very new to Haskell"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1555330329, "post_id": 55688838, "comment_id": 98060766, "body": "@radrow Agreed, even if I&#39;d rather have a <code>let nonrec</code> -- the non-recursive / shadowing definition <code>let x = f x in ...</code>  is not that common (at least in Haskell). This is a very minor point, though."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 80, "user_id": 7196404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oesDG.jpg?s=128&g=1", "display_name": "Dean", "link": "https://stackoverflow.com/users/7196404/dean"}, "edited": false, "score": 1, "creation_date": 1555330469, "post_id": 55688838, "comment_id": 98060838, "body": "@Deano Build a list of all the strings you want to append and then return <code>albumStr ++ concat listOfStrings</code>. Remember that you can&#39;t modify the global value of <code>albumStr</code> (probably you don&#39;t even need that), but only create a new string."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1555330007, "creation_date": 1555330007, "answer_id": 55688838, "question_id": 55688744, "link": "https://stackoverflow.com/questions/55688744/why-does-haskell-stop-when-trying-to-add-a-string-to-the-end-of-this-string/55688838#55688838", "title": "Why does haskell stop when trying to add a string to the end of this string?", "body": "<p>The equation</p>\n\n<pre><code>albumStr = albumStr ++ \"nothing\"\n</code></pre>\n\n<p>defines a string recursively, and does not use the globally defined <code>albumStr</code> at all. The recursion hangs immediately (it similar to an infinite loop).</p>\n\n<p>Turning on warnings reports the shadowing of the global name.</p>\n\n<p>If you do not want a recursive definition, use another variable name:</p>\n\n<pre><code>albumStr2 = albumStr ++ \"nothing\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555338432, "post_id": 55688873, "comment_id": 98065614, "body": "you &quot;have to&quot; only if it&#39;s a <code>let</code>-binding. but not if it&#39;s a <code>do</code>-binding."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 9, "last_activity_date": 1555330121, "creation_date": 1555330121, "answer_id": 55688873, "question_id": 55688744, "link": "https://stackoverflow.com/questions/55688744/why-does-haskell-stop-when-trying-to-add-a-string-to-the-end-of-this-string/55688873#55688873", "title": "Why does haskell stop when trying to add a string to the end of this string?", "body": "<p>Unlike ML, Haskell does not have a <code>rec</code> keyword to mark recursive definitions. Instead all definitions can be recursive, meaning that in every variable definition, the defined variable is already in scope during its definition.</p>\n\n<p>So in <code>let albumStr = albumStr ++ \"nothing\"</code>, the <code>albumStr</code> on the right of the <code>=</code> refers to the one defined on the left of the <code>=</code> - not the one defined in line 1. Therefore the definition is infinitely recursive and loops forever.</p>\n\n<p>If you want to define a variable based on another one, you have to give it a different name:</p>\n\n<pre><code>let localAlbumStr = albumStr ++ \"nothing\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1555332331, "creation_date": 1555332331, "answer_id": 55689516, "question_id": 55688744, "link": "https://stackoverflow.com/questions/55688744/why-does-haskell-stop-when-trying-to-add-a-string-to-the-end-of-this-string/55689516#55689516", "title": "Why does haskell stop when trying to add a string to the end of this string?", "body": "<p>In <code>do</code> notation, you can write </p>\n\n<pre><code>do { albumStr &lt;- pure (albumStr ++ \"nothing\") \n   ; ... \n   } \n</code></pre>\n\n<p>and it would (seem to) work.</p>\n\n<p>While <code>let</code> (and function) bindings in Haskell are recursive, <code>do</code> bindings are not.</p>\n\n<p>Instead, a shadowing variable is automatically created, which is actually a new variable with the same name. The code to the right of <code>&lt;-</code> lies in the scope above the binding; the code to the left of <code>&lt;-</code> is in a new, wider scope (that includes the earlier one).</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/11922134/849891\">how to increment a variable in functional programming</a> </li>\n</ul>\n"}], "owner": {"reputation": 80, "user_id": 7196404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oesDG.jpg?s=128&g=1", "display_name": "Dean", "link": "https://stackoverflow.com/users/7196404/dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 55688873, "answer_count": 3, "score": 4, "last_activity_date": 1555332331, "creation_date": 1555329642, "last_edit_date": 1555331183, "question_id": 55688744, "link": "https://stackoverflow.com/questions/55688744/why-does-haskell-stop-when-trying-to-add-a-string-to-the-end-of-this-string", "title": "Why does haskell stop when trying to add a string to the end of this string?", "body": "<p>I am trying to add a string to the end of a string in Haskell.</p>\n\n<pre><code>    albumStr = \"\"\nmain = do\n let albumStr = albumStr ++ \"nothing\"\n print albumStr\n</code></pre>\n\n<p>Whenever i run this it just gets stuck on \n\"\nin the console and i have to terminate it.</p>\n\n<p>Why? and how do i add a string to another string in this way?</p>\n\n<p>Edit:\nHow do i add multiple strings to the end of a current string without overwritting it.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1555329050, "post_id": 55688193, "comment_id": 98060096, "body": "Perhaps you meant <code>type Matrix a = Array Ind (Row a)</code>?"}, {"owner": {"reputation": 4230, "user_id": 1804317, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/84f00e56b203aec51a3104f1ed30c3da?s=128&d=identicon&r=PG", "display_name": "Jakob Abfalter", "link": "https://stackoverflow.com/users/1804317/jakob-abfalter"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1555330559, "post_id": 55688193, "comment_id": 98060885, "body": "Ohh yes indeed, thanks! What a stupid mistake"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1555331375, "post_id": 55688193, "comment_id": 98061368, "body": "you could also write <code>... deriving (Eq,Ord,Enum,Show,  Ix  )</code>."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1555330682, "creation_date": 1555330682, "answer_id": 55689052, "question_id": 55688193, "link": "https://stackoverflow.com/questions/55688193/static-array-with-custom-index-type-in-haskell/55689052#55689052", "title": "Static Array with custom Index type in Haskell", "body": "<p>The error message is unhelpful, but you just need to add some brackets:</p>\n\n<pre><code>type Matrix a = Array Ind (Row a)\n</code></pre>\n\n<p>You're saying that the element type should be <code>Row a</code>. Without the brackets, it's trying to pass <code>Row</code> and <code>a</code> as separate type arguments &mdash; which doesn't work.</p>\n"}], "owner": {"reputation": 4230, "user_id": 1804317, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/84f00e56b203aec51a3104f1ed30c3da?s=128&d=identicon&r=PG", "display_name": "Jakob Abfalter", "link": "https://stackoverflow.com/users/1804317/jakob-abfalter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 55689052, "answer_count": 1, "score": 0, "last_activity_date": 1555330682, "creation_date": 1555327612, "question_id": 55688193, "link": "https://stackoverflow.com/questions/55688193/static-array-with-custom-index-type-in-haskell", "title": "Static Array with custom Index type in Haskell", "body": "<p>I am trying to build a static Array in Haskell with a custom Enum Index type and have implemented the required functions like this:</p>\n\n<pre><code>data Ind = One | Two | Three | Four deriving (Eq,Ord,Enum,Show)\n\ninstance Ix Ind where\n  range (m,n)             = [m..n]\n  inRange (m,n) i         = m &lt;= i &amp;&amp; i &lt;= n\n  index b i | inRange b i = fromEnum i\n            | otherwise   = -1\n  rangeSize (m,n) = (index (m,n) n ) + 1\n</code></pre>\n\n<p>With this I am now trying to build a matrix type:</p>\n\n<pre><code>type Row a    = Array Ind a\ntype Matrix a = Array Ind Row a\n</code></pre>\n\n<p>However, I am getting this error on the Matrix type:</p>\n\n<pre><code> Illegal type \"Array Ind Row a\" in constructor application\n</code></pre>\n\n<p>Could anybody explain to me what this error means and what I am doing wrong?</p>\n"}, {"tags": ["haskell", "syntax-error", "indentation", "do-notation", "guard-clause"], "answers": [{"comments": [{"owner": {"reputation": 740, "user_id": 7691338, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/f4b2de6527387c39909be02577dc5910?s=128&d=identicon&r=PG&f=1", "display_name": "peterxz", "link": "https://stackoverflow.com/users/7691338/peterxz"}, "edited": false, "score": 0, "creation_date": 1555330412, "post_id": 55688440, "comment_id": 98060812, "body": "thank you! what is the purpose of &quot;readLines :: Handle -&gt; IO ()&quot; ?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 740, "user_id": 7691338, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/f4b2de6527387c39909be02577dc5910?s=128&d=identicon&r=PG&f=1", "display_name": "peterxz", "link": "https://stackoverflow.com/users/7691338/peterxz"}, "edited": false, "score": 1, "creation_date": 1555330572, "post_id": 55688440, "comment_id": 98060894, "body": "it is the function&#39;s type signature. <code>readLines</code> is the function&#39;s name, <code>::</code> means &quot;has a type of&quot; <code>A -&gt; B</code> means &quot;a function from values of type <code>A</code> to values of type <code>B</code>&quot;."}, {"owner": {"reputation": 740, "user_id": 7691338, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/f4b2de6527387c39909be02577dc5910?s=128&d=identicon&r=PG&f=1", "display_name": "peterxz", "link": "https://stackoverflow.com/users/7691338/peterxz"}, "edited": false, "score": 0, "creation_date": 1555333289, "post_id": 55688440, "comment_id": 98062453, "body": "thanks! is it necessary to declare the signature or just (very) useful?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 740, "user_id": 7691338, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/f4b2de6527387c39909be02577dc5910?s=128&d=identicon&r=PG&f=1", "display_name": "peterxz", "link": "https://stackoverflow.com/users/7691338/peterxz"}, "edited": false, "score": 0, "creation_date": 1555333781, "post_id": 55688440, "comment_id": 98062739, "body": "the latter . :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1555329023, "last_edit_date": 1555329023, "creation_date": 1555328610, "answer_id": 55688440, "question_id": 55688093, "link": "https://stackoverflow.com/questions/55688093/correct-indentation-rules-using-guards/55688440#55688440", "title": "Correct indentation rules using guards", "body": "<p>You could restructure your code for this, like</p>\n\n<pre><code>readLines :: Handle -&gt; IO ()\nreadLines inputFile  =  g =&lt;&lt; hIsEOF inputFile\n    where                  -- hIsEOF :: Handle -&gt; IO Bool\n      g endof\n            | endof = return () \n            | otherwise = do \n                          inpStr &lt;- hGetLine inputFile\n                          print inpStr\n                          readLines inputFile\n</code></pre>\n\n<p>The guards,  <code>|  ...</code>, belong to function definitions or case expressions. They can't appear in <code>do</code> block by themselves.</p>\n\n<p><code>g =&lt;&lt; hIsEOF inputFile</code> is a shorter way to write</p>\n\n<pre><code>readLines inputFile  =  do {  endof &lt;- hIsEOF inputFile\n                           ;  g endof\n                           }\n    where\n      g endof\n            | endof = .....\n</code></pre>\n\n<p>But a simpler option is just to use <code>if ... then ... else ...</code> in the <code>do</code> block in the first place:</p>\n\n<pre><code>readLines inputFile = \n        do { endof &lt;- hIsEOF inputFile \n           ; if endof \n                then return() \n                else do { inpStr &lt;- hGetLine inputFile\n                        ; print inpStr\n                        ; readLines inputFile\n                        }}\n</code></pre>\n\n<p>Yet another is using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=lambdacase#extension-LambdaCase\" rel=\"nofollow noreferrer\">LambdaCase</a> to inline the <code>g</code> definition:</p>\n\n<pre><code>readLines :: Handle -&gt; IO ()\nreadLines inputFile  =  hIsEOF inputFile &gt;&gt;=\n    (\\ case { True -&gt; return () \n            ; _    -&gt; do \n                          inpStr &lt;- hGetLine inputFile\n                          print inpStr\n                          readLines inputFile })\n</code></pre>\n\n<p>And case clauses <em>can have guards</em> (though here we didn't need them).</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1555401174, "last_edit_date": 1555401174, "creation_date": 1555400782, "answer_id": 55703068, "question_id": 55688093, "link": "https://stackoverflow.com/questions/55688093/correct-indentation-rules-using-guards/55703068#55703068", "title": "Correct indentation rules using guards", "body": "<p>As Will Ness explains in his answer, indentation is not your issue here\u2014the problem is that you\u2019re trying to use a guard (<code>| \u2026</code>) after a statement in a <code>do</code> block, but guards can only ever appear between patterns and bodies in (1) function equations:</p>\n\n<pre><code>function param1 param2\n  | guard1 = body1\n  | guard2 = body2\n  \u2026\n</code></pre>\n\n<p>And (2) <code>case</code> expressions:</p>\n\n<pre><code>case expr of\n  pattern1\n    | guard1 -&gt; body1\n    | guard2 -&gt; body2\n  pattern2\n    | guard3 -&gt; body3\n  \u2026\n</code></pre>\n\n<p>So you probably want an <code>if</code> expression instead. As for the rules of indentation, your code is indented correctly, but you don\u2019t need as much whitespace as you\u2019re using: the basic rules are:</p>\n\n<ul>\n<li><p>Certain keywords such as <code>do</code>, <code>let</code>, <code>where</code>, and <code>of</code> begin <em>layout blocks</em></p></li>\n<li><p>Within those blocks, everything must be indented past the first column of the first line in the block</p></li>\n<li><p>If an expression wraps across multiple lines, the lines following the first must be indented</p></li>\n</ul>\n\n<p>So a rule of thumb that always works is to simply add a newline and indent by some number of spaces (e.g. 2 or 4) after every such keyword:</p>\n\n<pre><code>readFile filename = do -- newline+indent to begin block\n  inputFile &lt;- openFile filename ReadMode\n  readLines inputFile\n  hClose inputFile\n\nreadLines inputFile = do -- newline+indent to begin block\n  endof &lt;- hIsEOF inputFile\n  if endof -- indent to continue if expression\n    then return () \n    else do -- newline+indent to begin block\n      inpStr &lt;- hGetLine inputFile\n      print inpStr\n      readLines inputFile\n</code></pre>\n\n<p>The alternative style is to start a block on the same line as the layout keyword; then everything needs to have the same alignment as that line:</p>\n\n<pre><code>readFile filename = do inputFile &lt;- openFile filename ReadMode\n                       readLines inputFile\n                       hClose inputFile\n\nreadLines inputFile = do endof &lt;- hIsEOF inputFile\n                         if endof\n                           then return () \n                           else do inpStr &lt;- hGetLine inputFile\n                                   print inpStr\n                                   readLines inputFile\n</code></pre>\n\n<p>I prefer to avoid this style because it leads to deep indentation, which also depends on the width of the code before it.</p>\n\n<p>Both of these styles are desugared to the following code with explicit delimiters, which you can also write yourself to get a better feel for how layout works:</p>\n\n<pre><code>readFile filename = do {\n  inputFile &lt;- openFile filename ReadMode;\n  readLines inputFile;\n  hClose inputFile;\n};\n\nreadLines inputFile = do {\n  endof &lt;- hIsEOF inputFile; \n  if endof\n    then return () \n    else do {\n      inpStr &lt;- hGetLine inputFile;\n      print inpStr;\n      readLines inputFile;\n    };\n};\n</code></pre>\n\n<p>One thing that often trips people up is that <code>let</code> also introduces a layout block for defining multiple bindings in the same block. So if you write a <code>let</code> statement or <code>let</code>\u2026<code>in</code>\u2026 expression with a long definition, then you need to either write it aligned:</p>\n\n<pre><code>let example1 = some very long definition\n      that we need to wrap across lines\n    example2 = another binding for illustration\n--  ^ everything must be aligned past this column\nin example1 . example2\n</code></pre>\n\n<p>Or use the same newline+indent style as for everything else:</p>\n\n<pre><code>let\n  example1 = some very long definition\n    that we need to wrap across lines\n  example2 = another binding for illustration\nin example1 . example2\n</code></pre>\n\n<p>Finally, as a convenience, <code>if x then return () else y</code> can be written <code>unless x y</code> or <code>when (not x) y</code> using <code>unless</code> or <code>when</code> from <code>Control.Monad</code>:</p>\n\n<pre><code>import Control.Monad (unless)\n\n\u2026\n  endof &lt;- hIsEOF inputFile\n  unless endof $ do\n    inpStr &lt;- hGetLine inputFile\n    print inpStr\n    readLines inputFile\n</code></pre>\n\n<p>Furthermore, you may see the <code>$</code> omitted before <code>do</code> (and other block keywords like <code>case</code> and <code>\\</code>) in code that enables the <code>BlockArguments</code> extension:</p>\n\n<pre><code>{-# LANGUAGE BlockArguments #-}\nimport Control.Monad (unless)\n\n\u2026\n  endof &lt;- hIsEOF inputFile\n  unless endof do -- no need for $\n    inpStr &lt;- hGetLine inputFile\n    print inpStr\n    readLines inputFile\n</code></pre>\n"}], "owner": {"reputation": 740, "user_id": 7691338, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/f4b2de6527387c39909be02577dc5910?s=128&d=identicon&r=PG&f=1", "display_name": "peterxz", "link": "https://stackoverflow.com/users/7691338/peterxz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1555401174, "creation_date": 1555327279, "last_edit_date": 1555329986, "question_id": 55688093, "link": "https://stackoverflow.com/questions/55688093/correct-indentation-rules-using-guards", "title": "Correct indentation rules using guards", "body": "<p>I've looked at questions regarding indentation, which were of no help. My indentation also looks correct but according to the compiler it isnt.\nWhat is the correct indentation and what are the rules?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readFile filename = do \n                    inputFile &lt;- openFile filename ReadMode\n                    readLines inputFile\n                    hClose inputFile\n\nreadLines inputFile = \n        do endof &lt;- hIsEOF inputFile \n            | endof = return() \n            | otherwise = do \n                          inpStr &lt;- hGetLine inputFile\n                          print inpStr\n                          readLines inputFile\n</code></pre>\n\n<p>Using all spaces and no tabs.\nError:\n\"parse error on input '|' \n| endof = return() \"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1555330140, "post_id": 55688065, "comment_id": 98060661, "body": "How are you viewing the result? Are you viewing it via GHCi, or <code>show</code>ing it, or <code>print</code>ing it, or what? My guess is that GHC adds the quotes when it prints the value, as the default pretty-printing style for strings is that they are printed with quotes surrounding them."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1555335966, "post_id": 55688065, "comment_id": 98064158, "body": "Fixed some grammar. Added some layout to clarify output."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1555402276, "post_id": 55688065, "comment_id": 98087927, "body": "<code>Show</code> is intended for rendering a simple string representation of a value as a Haskell expression, which can be copied and pasted as Haskell code, or parsed using <code>Read</code>. That\u2019s why <code>instance Show String</code> returns text with quote marks. It\u2019s fine for basic testing and debugging, but if you want output formatted in a custom way, you should write custom functions producing strings formatted the way you want\u2014which may of course use <code>Show</code> for basic things like numbers. For more complex formatting, there are libraries such as <code>pretty</code>, which also provides a <code>Pretty</code> typeclass for this purpose."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555405593, "post_id": 55698186, "comment_id": 98089843, "body": "this doesn&#39;t show <i>how to use</i> this function, to actually do what the OP asks for. they are &quot; really new in Haskell&quot;."}], "tags": [], "owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "is_accepted": false, "score": 1, "last_activity_date": 1555424317, "last_edit_date": 1555424317, "creation_date": 1555368213, "answer_id": 55698186, "question_id": 55688065, "link": "https://stackoverflow.com/questions/55688065/how-to-remove-the-quotation-mark-in-string/55698186#55698186", "title": "how to remove the quotation mark in string", "body": "<p>If all you are trying to do is make the states prettier, you can provide your own display function:</p>\n\n<pre><code>-- |Display a list of strings without quotation marks\nshowLStr :: [String] -&gt; String\nshowLStr p  = \"[\" ++ intercalate \",\" p ++ \"]\"\n</code></pre>\n\n<p>The <code>intercalate</code> function puts the <code>\",\"</code> between each element of the list of strings.</p>\n\n<pre><code>showLStr [\"A1\", \"A2\", \"A3\"]\n</code></pre>\n\n<p>should display as</p>\n\n<pre><code>[A1,A2,A3]\n</code></pre>\n\n<p>Edit: Now you can use <code>showLStr</code> to display the game state:</p>\n\n<pre><code>showGameState :: GameState -&gt; String\nshowGameState (GameState chords) =\n  \"GameState [\" ++ (intercalate \",\" $ map showLStr chords) ++ \"]\"\n\n-- |Make GameState \"Show\"-able\ninstance Show GameState where\n  show = showGameState\n\nshowGuess :: ([Pitch],GameState) -&gt; String\nshowGuess (pitch, gameState) = showLStr pitch ++ \", \" ++ show gameState\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11362820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b36363e6b9310199e2a800a2def73665?s=128&d=identicon&r=PG&f=1", "display_name": "trolle", "link": "https://stackoverflow.com/users/11362820/trolle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555424317, "creation_date": 1555327178, "last_edit_date": 1555335966, "question_id": 55688065, "link": "https://stackoverflow.com/questions/55688065/how-to-remove-the-quotation-mark-in-string", "title": "how to remove the quotation mark in string", "body": "<p>I'm really new in Haskell. perhaps this is a simple question for the master coder. I want to remove the quotation mark outside the string. such as \"A1\" to A1. </p>\n\n<p>I tried my best to solve this problem. but it doesn't work. I already used read :: Read a => String -> a, id function, and  regular expression.</p>\n\n<pre><code>initialGuess :: ([Pitch],GameState)\ninitialGuess = (startGuess, GameState (chords))\n      where startGuess = [\"A1\", \"B1\", \"C1\"] \n      standard = [[n, o] | n &lt;- ['A'..'G'], o &lt;- ['1'..'3']]  &lt;br/&gt;\n      chords = [[a,b,c] | a &lt;- standard, b &lt;- standard, c &lt;-  \n               standard, a /= b, b /= c, a /= c]  \n</code></pre>\n\n<p>initialGuess aim to takes no input arguments.And returns a pair of an initial guess and a game state. Running this code I can get </p>\n\n<blockquote>\n  <p>[\"A1\",\"B1\",\"C1\"],GameState [[\"A1\",\"A2\",\"A3\"],[\"A1\",\"A2\",\"B1\"],[\"A1\",\"A2\",\"B2\"],[\"A1\",\"A2\",\"B3\"],[\"A1\",\"A2\",\"C1\"]................[\"A1\",\"A2\",\"C2\"],[\"A1\",\"A2\",\"C3\"],[\"A1\",\"A2\",\"D1\"],[\"A1\",\"A2\",\"D2\"],[\"A1\",\"A2\",\"D3\"]]</p>\n</blockquote>\n\n<p>however, I want to remove these quotation marks such as </p>\n\n<blockquote>\n  <p>[A1,B1,C1],GameState [[A1,A2,A3],[A1,A2,B1],[A1,A2,B2],[A1,A2,B3],[A1,A2,C1]................[A1,A2,C2],[A1,A2,C3],[A1,A2,D1],[A1,A2,D2],[A1,A2,D3]]</p>\n</blockquote>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1555407770, "post_id": 55699366, "comment_id": 98091201, "body": "Ah ! I didn&#39;t think of looking in Replace, that&#39;s a weird place to put it imho. Thanks a lot, that works perfectly :)"}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 1, "last_activity_date": 1555378578, "creation_date": 1555378578, "answer_id": 55699366, "question_id": 55686276, "link": "https://stackoverflow.com/questions/55686276/capture-group-names-with-regex/55699366#55699366", "title": "Capture group names with regex", "body": "<p>You'll find the API you need in the <a href=\"https://hackage.haskell.org/package/regex-1.0.2.0/docs/Text-RE-Replace.html\" rel=\"nofollow noreferrer\">Text.RE.Replace</a> docs; I think one of the functions with names that start with <code>capture</code> will be what you're looking for. Here's an example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Data.Text\nimport Text.RE.Replace\nimport Text.RE.TDFA.String\n\nneedle :: CaptureID\nneedle = IsCaptureName . CaptureName . pack $ \"needle\"\n\nmain :: IO ()\nmain = do\n  re &lt;- compileRegex \"-${needle}([a-z]+)-\"\n  let match = \"haystack contains the -word- you want\" ?=~ re\n  if matched match\n  then print $ captureText needle match\n  else print \"(no match)\"\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 55699366, "answer_count": 1, "score": 1, "last_activity_date": 1555378578, "creation_date": 1555320784, "question_id": 55686276, "link": "https://stackoverflow.com/questions/55686276/capture-group-names-with-regex", "title": "Capture group names with regex", "body": "<p>I'm trying to use the regex package (with TDFA) and the only reference I can find for named captures group is a quasi quoter (cp) and no explanation.\nBasically I have regexs in a config files, compiled at runtime with compileRegex, applied to lines and I'm looking to extract a couple of specific captures group out of that, with names I do know at compile time.</p>\n\n<p>So I'm looking for a function that would take the <code>Matches a</code>, a string (the capture group name) and would return I guess a <code>Maybe a</code>, depending on whether that capture group did match or not ? Or even just a way to extract the capture group names from the <code>Match a</code>, that would be enough.</p>\n\n<p>The doc mentions the quasi quoter cp, but no explanation as to how it's supposed to be used, and I'm not even sure I could use if if I knew because I compile my regex at runtime.</p>\n\n<p>Would anyone have examples with named capture groups ?\nThanks</p>\n"}, {"tags": ["haskell", "filter", "find"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 2, "creation_date": 1555320181, "post_id": 55686052, "comment_id": 98055643, "body": "<code>find1</code> needs a base case for the empty list? And if you just want the first result, use <code>head</code> but know it is unsafe (gives an error if no matching element in the list is found)"}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1555329478, "post_id": 55686052, "comment_id": 98060332, "body": "It seems that OP is looking for a reimplementation of <code>filter</code> (instead of <code>find</code>). He seems to call <code>filter</code> by the name of <code>find</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "edited": false, "score": 0, "creation_date": 1555328555, "post_id": 55688306, "comment_id": 98059821, "body": "Thanks for imporve my function but unfortunately it was not the awnsere I was looking for. I&#180;m still looking for the function find implemented with filter. Best regards :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555329371, "post_id": 55688306, "comment_id": 98060278, "body": "I gave it twice, as <code>take 1 $ find2 ...</code>, or <code>find22</code>, no? :) Do you mean you need <code>take 1</code> or <code>listToMaybe</code> implementation hints?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555329809, "post_id": 55688306, "comment_id": 98060490, "body": "I&#39;ve added something, but I must say that answering multi-pronged questions isn&#39;t fun. It makes for a confused mess of an answer. In the future please always ask one question about one particular code snippet."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1555453969, "last_edit_date": 1555453969, "creation_date": 1555328043, "answer_id": 55688306, "question_id": 55686052, "link": "https://stackoverflow.com/questions/55686052/how-to-implement-the-function-find-with-the-filter-function/55688306#55688306", "title": "How to implement the function find with the filter function?", "body": "<p>To \"cut a list\" to only have one, head element in it, use <code>take 1</code>:</p>\n\n<pre><code>&gt; take 1 [1..]\n[1]\n\n&gt; take 1 []\n[]\n\n&gt; take 1 $ find2 (&gt; 4) [1..10]\n[5]\n\n&gt; take 1 $ find2 (&gt; 14) [1..10]\n[]\n</code></pre>\n\n<p>If you need to implement your own <code>take 1</code> function, just write down its equations according to every possible input case:</p>\n\n<pre><code>take1 [] = []\ntake1 (x:xs) = [x]\n</code></pre>\n\n<p>Or with <code>filter</code>, </p>\n\n<pre><code>findWithFilter p xs = take1 $ filter p xs\n</code></pre>\n\n<p>Your <code>find1</code> definition doesn't correspond to the output you show. Rather, the following definition would:</p>\n\n<pre><code>find1 e (x:xs) = if e x then [x]     -- you had `x`\n                   else find1 e xs\nfind1 _ []     = []                  -- the missing clause\n</code></pre>\n\n<p>It is customary to call your predicate <code>p</code>, not <code>e</code>, as a mnemonic device. It is highly advisable to add type signatures to all your top-level definitions.</p>\n\n<p>If you have difficulty in writing it yourself you can start without the signature, then ask GHCi which type did it infer, than use that signature <em>if it indeed expresses your intent</em> -- otherwise it means you've coded something different:</p>\n\n<pre><code>&gt; :t find1\nfind1 :: (t -&gt; Bool) -&gt; [t] -&gt; [t]\n</code></pre>\n\n<p>This seems alright as a first attempt. </p>\n\n<p>Except, you actually intended that there would never be more than 1 element in the output list: it's either <code>[]</code> or <code>[x]</code> for some <code>x</code>, never more than one.</p>\n\n<p>The list <code>[]</code> type is too permissive here, so it is not a perfect fit.</p>\n\n<p>Such a type does exist though. It is called <code>Maybe</code>: values of type <code>Maybe t</code> can be either <code>Nothing</code> or <code>Just x</code> for some <code>x :: t</code> (read: <code>x</code> has type <code>t</code>):</p>\n\n<pre><code>import Data.Maybe  (listToMaybe)\n\nfind22 p xs = listToMaybe $ filter p xs\n</code></pre>\n\n<p>We didn't even have to <code>take 1</code> here: the function <code>listToMaybe :: [a] -&gt; Maybe a</code> (read: has a type of function with input in <code>[a]</code> and output in <code>Maybe a</code>) already takes at most one element from its input list, as the result type doesn't allow for more than one element -- it simply has no more room in it. Thus it expresses our intent correctly: at most one element is produced, if any:</p>\n\n<pre><code>&gt; find22 (&gt; 4) [1..10]\nJust 5\n\n&gt; find22 (&gt; 14) [1..10]\nNothing\n</code></pre>\n\n<p>Do add full signature above its definition, when you're sure it is what you need:</p>\n\n<pre><code>find22 :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\n</code></pre>\n\n<p>Next, implement <code>listToMaybe</code> yourself. To do this, just follow the types, and write equations enumerating the cases of possible input, producing an appropriate value of the output type in each case, just as we did with <code>take1</code> above.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 55688306, "answer_count": 1, "score": -3, "last_activity_date": 1555453969, "creation_date": 1555319990, "last_edit_date": 1555320239, "question_id": 55686052, "link": "https://stackoverflow.com/questions/55686052/how-to-implement-the-function-find-with-the-filter-function", "title": "How to implement the function find with the filter function?", "body": "<p>I'm making some exercise to practice my Haskell skills. My task is to implement the Haskell function <code>find</code> by myself with the <code>filter</code> function.</p>\n\n<p>I already implemented the <code>find</code> function without the <code>filter</code> function (see codeblock below) but now my problem is to implement it with <code>filter</code> function.</p>\n\n<pre><code>-- This is the `find` function without `filter` and it's working for me.\n\nfind1 e (x:xs)= if e x then x\n        else find1 e xs\n\n-- This is the find function with the filter function \n\nfind2 e xs = filter e xs\n</code></pre>\n\n<p>The result of <code>find1</code> is right</p>\n\n<blockquote>\n<pre><code>*Main&gt; find1(&gt;4)[1..10]\nOutput : [5].\n</code></pre>\n</blockquote>\n\n<p>But my actual task to write the function with filter gives me the</p>\n\n<blockquote>\n<pre><code>*Main&gt; find2(&gt;4)[1..10]\nOutput : [5,6,7,8,9,10].\n</code></pre>\n</blockquote>\n\n<p>My wanted result for <code>find2</code> is the result of <code>find1</code>.</p>\n"}, {"tags": ["list", "function", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 7, "creation_date": 1555317636, "post_id": 55685344, "comment_id": 98054333, "body": "What&#39;s wrong with <code>[1..n]</code>? It&#39;s a perfectly valid expression which you can output from a function (for example). As for putting a <code>1</code> at the end, that&#39;s just <code>[1..n] ++ [1]</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1555317687, "post_id": 55685344, "comment_id": 98054363, "body": "You could also <code>take n (iterate (+1) 1)</code> to get a finite sublist."}], "answers": [{"tags": [], "owner": {"reputation": 6008, "user_id": 1983772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f429722c8167802b89cbe4d324aa1e?s=128&d=identicon&r=PG", "display_name": "Norrius", "link": "https://stackoverflow.com/users/1983772/norrius"}, "is_accepted": true, "score": 10, "last_activity_date": 1555317857, "creation_date": 1555317857, "answer_id": 55685439, "question_id": 55685344, "link": "https://stackoverflow.com/questions/55685344/how-to-generate-a-list-of-natural-numbers-from-1-n/55685439#55685439", "title": "How to generate a list of natural numbers from 1....n?", "body": "<p>It's literally as simple as:</p>\n\n<pre><code>f :: Int -&gt; [Int]\nf n = [1..n] ++ [1]\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 55685439, "answer_count": 1, "score": 0, "last_activity_date": 1555320432, "creation_date": 1555317459, "last_edit_date": 1555320432, "question_id": 55685344, "link": "https://stackoverflow.com/questions/55685344/how-to-generate-a-list-of-natural-numbers-from-1-n", "title": "How to generate a list of natural numbers from 1....n?", "body": "<p>I am currently trying to, inside my function, generate a list. The user will pass in one parameter, which will be an <code>Int</code>. The function's job is to generate a list, starting from <code>1</code>, and going up to <code>n</code>. So the list would look something like</p>\n\n<pre><code>[1....n]\n</code></pre>\n\n<p>What I have done thus far is this:</p>\n\n<pre><code>iterate (+1) 1\n</code></pre>\n\n<p>While this provides the correct pattern, it goes on forever. How would I be able to stop at <code>n</code>? In addition, how would I be able to append <code>'1'</code> at the end of the list, as such:</p>\n\n<pre><code>[1...n,1]\n</code></pre>\n"}, {"tags": ["haskell", "type-variables"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11361479, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BF3AQMnzjyk/AAAAAAAAAAI/AAAAAAAAADU/MV7e5X-jLzk/photo.jpg?sz=128", "display_name": "Ervan Darnell", "link": "https://stackoverflow.com/users/11361479/ervan-darnell"}, "edited": false, "score": 0, "creation_date": 1555386125, "post_id": 55683667, "comment_id": 98081990, "body": "Yes!  Thank you.  I appreciate your understanding my problem and giving constructive feedback.  The real solution here was &quot;class Functor c e | c -&gt; e&quot;.  For reference, I was not actually trying to use a scoped type variable.  I am used to do being able to do so from a C++ background, where you can connect the element and collection of element type directly.  So, Haskell left me confused."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 3, "user_id": 11361479, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BF3AQMnzjyk/AAAAAAAAAAI/AAAAAAAAADU/MV7e5X-jLzk/photo.jpg?sz=128", "display_name": "Ervan Darnell", "link": "https://stackoverflow.com/users/11361479/ervan-darnell"}, "edited": false, "score": 0, "creation_date": 1555386964, "post_id": 55683667, "comment_id": 98082187, "body": "@ErvanDarnell You&#39;re very welcome. (Also, if my answer solved your problem, could you accept it? Once it&#39;s accepted this question is marked as &#39;solved&#39;.)"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1555310077, "creation_date": 1555310077, "answer_id": 55683667, "question_id": 55683246, "link": "https://stackoverflow.com/questions/55683246/cannot-seem-to-use-a-type-expression-with-a-type-variable-in-an-instance-declara/55683667#55683667", "title": "Cannot seem to use a type expression with a type variable in an instance declaration with a function needing an explicit type", "body": "<p>The issue is that in Haskell, type variables aren't scoped: that is, if you define <code>instance Arith (V3 e)</code>, you can't use <code>e</code> inside the instance; if you try to, GHC will interpret it as being a completely separate type variable. Luckily, you can use <code>{-# LANGUAGE ScopedTypeVariables #-}</code> to enable scoped type variables. If you do that, you'll also find you need to add an extra <code>Arith e =&gt;</code> constraint; adding this will allow it to compile successfully.</p>\n\n<p>(Aside: when dealing with <code>MultiParamTypeClasses</code>, <code>{-# LANGUAGE FunctionalDependencies #-}</code> is also incredibly useful; I would personally use it in a case like this, as it removes the need for explicit type declarations for <code>neg</code>. The idea is that you define instead <code>class Functor c e | c -&gt; e</code>, which basically means that the type for <code>c</code> determines the type for <code>e</code> as well. I won't describe it here, but I would <strong>highly</strong> encourage you to look it up.)</p>\n"}], "owner": {"reputation": 3, "user_id": 11361479, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BF3AQMnzjyk/AAAAAAAAAAI/AAAAAAAAADU/MV7e5X-jLzk/photo.jpg?sz=128", "display_name": "Ervan Darnell", "link": "https://stackoverflow.com/users/11361479/ervan-darnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 55683667, "answer_count": 1, "score": 0, "last_activity_date": 1555318002, "creation_date": 1555307731, "last_edit_date": 1555318002, "question_id": 55683246, "link": "https://stackoverflow.com/questions/55683246/cannot-seem-to-use-a-type-expression-with-a-type-variable-in-an-instance-declara", "title": "Cannot seem to use a type expression with a type variable in an instance declaration with a function needing an explicit type", "body": "<p>I cannot find anyway in Haskell to specify the type of the call to '<strong>neg</strong>':</p>\n\n<pre><code>instance Arith (V3 e) where neg x = vfmap (neg :: e-&gt;e)  x \n</code></pre>\n\n<p><strong>(V3 e)</strong> and <strong>e</strong> are both instances of <strong>Arith</strong>.  Here I want to call the '<strong>neg</strong>' already defined for the type <strong>'e'</strong>.  But this requires an explicit type on the '<strong>neg</strong>' call and no expression can resolve the type?  If use a specific instance of <strong>'e'</strong>, it si fine.</p>\n\n<p><code>vfmap (neg :: Dist-&gt;Dist ) x</code>  -- this works (but is not general enough)\n<code>vfmap (neg :: e-&gt;e) x</code> --  No instance for (<strong>Arith e1</strong>) arising from a use of <strong>\u2018neg</strong>\u2019 \n<code>vfmap neg e</code> -- Ambiguous type variable \u2018e0\u2019 arising from a use of \u2018neg\u2019\n      prevents the constraint \u2018(Arith e0)\u2019 from being solved.\n<code>vfmap (neg :: Arith e =&gt; e-&gt;e) x</code> -- ditto</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts, InstanceSigs #-}\ndata Dist = Inch Float deriving (Show)\n\nclass Arith a where\n   neg :: a-&gt;a\n\ninstance Arith Dist where\n   neg (Inch x) = Inch (-x)\n\ndata V2 e = V2 e e    deriving (Show) \ndata V3 e = V3 e e e  deriving (Show)\n\nclass VMap c e where\n   vfmap :: (e-&gt;e)-&gt;c-&gt;c\n\ninstance VMap (V2 e) e where\n   vfmap f (V2 x1 x2) = V2 (f x1) (f x2)\ninstance VMap (V3 e) e where\n   vfmap f (V3 x1 x2 x3) = V3 (f x1) (f x2) (f x3)\n\n-- 2 &amp; 3 point vectors should also be Arith\ninstance Arith (V2 Dist) where \n   neg x = vfmap (neg :: Dist-&gt;Dist) x -- works, but must have type on neg\n\ninstance Arith (V3 e) where \n   neg x = vfmap (neg :: Arith e =&gt; e-&gt;e)  x -- nothing here seems to work\n</code></pre>\n\n<p><strong>vfmap</strong> can be applied to a (<strong>V2 e</strong>) or a (<strong>V3 e</strong>), either vector type for a vector of any <strong>Arith</strong> element type.</p>\n\n<p>This won't seem to compile when the element type is a type variable, e.g.</p>\n\n<p>\u2022 Ambiguous type variable \u2018<strong>e0</strong>\u2019 arising from an expression type signature\n      prevents the constraint \u2018<strong>(Arith e0)</strong>\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018<strong>e0</strong>\u2019 should be.</p>\n"}, {"tags": ["haskell", "lambda", "syntax", "functional-programming", "io-monad"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 2, "creation_date": 1555291559, "post_id": 55681476, "comment_id": 98047276, "body": "The <code>fp</code> is a FilePath (which is really just a string).  The <code>h</code> in the lambda expression is the <code>Handle</code> that is inside the IO monad that <code>openFile</code> returns.  See <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.htm&zwnj;&#8203;l</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1555291944, "post_id": 55681476, "comment_id": 98047349, "body": "<code>\\h</code> is not really an entity in itself; it is merely a part of the lambda function <code>\\h -&gt; hPutChar fp c</code>."}, {"owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "edited": false, "score": 0, "creation_date": 1555293149, "post_id": 55681476, "comment_id": 98047535, "body": "I misled myself thinking that the <code>h</code> and <code>\\h</code> on the same line referred to the same entity!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555338670, "post_id": 55681476, "comment_id": 98065731, "body": "the importance of staying engaged and talking in the comments: thanks to your above comment your misunderstanding (that &quot;<code>\\h</code>&quot; is an entity in itself) finally became clear and could be addressed! / ++"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1555291726, "creation_date": 1555291726, "answer_id": 55681581, "question_id": 55681476, "link": "https://stackoverflow.com/questions/55681476/is-h-a-handle-or-a-lambda-function-or-both/55681581#55681581", "title": "Is h a handle or a lambda function (or both)?", "body": "<p>There is no recursion going on here. <code>h</code> is indeed a <code>Handle</code>. If you've programmed in C, the rough equivalent is a <code>FILE</code>. The handle consists of a file descriptor, buffers, and whatever else is needed to perform I/O on the attached file/pipe/terminal/whatever. <code>openFile</code> takes a path, opens the requested file (or device), and provides a handle that you can use to manipulate the requested file.</p>\n\n<pre><code>bracket\n  (openFile fp WriteMode)\n  hClose\n  (\\h -&gt; hPutChar h c)\n</code></pre>\n\n<p>This opens the file to produce a handle. That handle is passed to the third function, which binds it to <code>h</code> and passes it to <code>hPutChar</code> to output a character. Then in the end, <code>bracket</code> passes the handle to <code>hClose</code> to close the file.</p>\n\n<p>If exceptions didn't exist, you could implement <code>bracket</code> like this:</p>\n\n<pre><code>bracket\n  :: IO resource\n  -&gt; (resource -&gt; IO x)\n  -&gt; (resource -&gt; IO a)\n  -&gt; IO a\nbracket first last middle = do\n  resource &lt;- first\n  result &lt;- middle resource\n  last resource\n  pure result\n</code></pre>\n\n<p>But <code>bracket</code> actually has to install an exception handler to endure that <code>last</code> is called even if an exception occurs.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1555292094, "creation_date": 1555292094, "answer_id": 55681614, "question_id": 55681476, "link": "https://stackoverflow.com/questions/55681476/is-h-a-handle-or-a-lambda-function-or-both/55681614#55681614", "title": "Is h a handle or a lambda function (or both)?", "body": "<p>Let's have a look at the type of <code>bracket</code> (quoted as it appears in your Haskell Wiki link):</p>\n\n<pre><code>bracket :: IO a        -- computation to run first (\"acquire resource\")\n        -&gt; (a -&gt; IO b) -- computation to run last (\"release resource\")\n        -&gt; (a -&gt; IO c) -- computation to run in-between\n        -&gt; IO c\n</code></pre>\n\n<p>In your use case, the first argument, <code>openFile fp WriteMode</code> is an <code>IO Handle</code> value, a computation that produces a handle corresponding to the <code>fp</code> path. The third argument, <code>\\h -&gt; hPutChar h c</code>, is a function that takes a handle and returns a computation that writes to it. The idea is that the function you pass as the third argument specifies how the resource produced by the first argument will be used.</p>\n"}, {"comments": [{"owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "edited": false, "score": 1, "creation_date": 1555336437, "post_id": 55690299, "comment_id": 98064432, "body": "&quot;h in \\ h -&gt; is the lambda function&#39;s parameter&quot; -- That&#39;s what I was missing, as well as the understanding that <code>bracket</code> fed the result of its first computation into it&#39;s in-between computation (which @dfeuer summarized quite well). I was incorrectly reading the anonymous function&#39;s parameter as the anonymous function&#39;s &quot;name&quot;. \ud83d\udc4d"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1555340383, "last_edit_date": 1555340383, "creation_date": 1555334968, "answer_id": 55690299, "question_id": 55681476, "link": "https://stackoverflow.com/questions/55681476/is-h-a-handle-or-a-lambda-function-or-both/55690299#55690299", "title": "Is h a handle or a lambda function (or both)?", "body": "<pre><code>hPutChar :: Handle -&gt; Char -&gt; IO ()\n</code></pre>\n\n<p>is a pure Haskell function, which, given two arguments <code>h :: Handle</code> and <code>c :: Char</code>, produces a pure Haskell value of type <code>IO ()</code>, an  \"<code>IO</code> action\":</p>\n\n<pre><code>         h :: Handle      c :: Char\n---------------------------------------------\nhPutChr  h                c          :: IO ()\n</code></pre>\n\n<p>This \"action\" is simply a Haskell value, but when it appears inside the <code>IO</code> monad <code>do</code> block under <code>main</code>, it becomes <em>executed</em> by the Haskell run-time system and <em>then</em> it actually performs the I/O operation of putting a character <code>c</code> into  a filesystem's entity referred to by the handle <code>h</code>.</p>\n\n<p>As for the lambda function, the actual unambiguous syntax is </p>\n\n<pre><code>(\\ h -&gt; ... ) \n</code></pre>\n\n<p>where the white space between <code>\\</code> and <code>h</code> is optional, and the whole <code>(.......)</code> expression is the lambda expression. So there is <em>no</em> \"<code>\\h</code> entity\": </p>\n\n<ul>\n<li><code>(\\ ... -&gt; ... )</code> is the lambda-expression syntax; </li>\n<li><code>h</code> in <code>\\ h -&gt;</code> is the lambda function's parameter, </li>\n<li><code>...</code> in <code>(\\ h -&gt; ... )</code> is the lambda function's body.</li>\n</ul>\n\n<p><code>bracket</code> calls the <code>(\\h -&gt; hPutChar h c)</code> lambda function with the result produced by <code>(openFile fp WriteMode)</code> I/O <em>computation</em>, which is the handle of the file name referred to by <code>fp</code>, opened according to the mode <code>WriteMode</code>.</p>\n\n<p>Main thing to understand about the Haskell monadic IO is that \"computation\" is not a function: it is the actual (here, I/O) computation performing the actual file open -- which produces the handle -- which is then used by the run-time system to call the <em>pure Haskell function</em> <code>(\\ h -&gt; ...)</code> with it. </p>\n\n<p>This <em>layering</em> (of pure Haskell \"world\" and the impure I/O \"world\") is the essence of .... yes, <em>Monad</em>. An I/O computation does something, finds some value, uses it to call a pure Haskell function, which creates a new computation, which is then run, feeds <em>its</em> results into the next pure function, etc. etc.</p>\n\n<p>So we keep our purity <em>in Haskell</em> by only <em>talking</em> about the impure stuff. Talking is not doing.</p>\n\n<p><em>Or is it?</em></p>\n"}], "owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 55690299, "answer_count": 3, "score": 0, "last_activity_date": 1555340383, "creation_date": 1555290531, "last_edit_date": 1555334455, "question_id": 55681476, "link": "https://stackoverflow.com/questions/55681476/is-h-a-handle-or-a-lambda-function-or-both", "title": "Is h a handle or a lambda function (or both)?", "body": "<p>I am looking at a simple IO program from <a href=\"https://en.wikibooks.org/wiki/Haskell/Libraries/IO\" rel=\"nofollow noreferrer\">the Haskell Wikibook</a>. The construction presented on that page works just fine, but I'm trying to understand \"how\". </p>\n\n<p>The <code>writeChar</code> function below takes a filepath (as a string) and a character, and it writes the character to the file at the given path. The function uses a <a href=\"https://wiki.haskell.org/Bracket_pattern\" rel=\"nofollow noreferrer\">bracket</a> to ensure that the file opens and closes properly. Of the three computations run in the bracket, the \"computation to run in-between\"---as I understand it---is a lambda function that returns the result of <code>hPutChar h c</code>. </p>\n\n<p>Now, <code>hPutChar</code> itself has a declaration of <code>hPutChar :: Handle -&gt; Char -&gt; IO ()</code>. This is where I'm lost. I seem to be passing <code>h</code> as the handle to <code>hPutChar</code>. I would expect a handle somehow to reference the file opened as <code>fp</code>, but instead it appears to be recursively calling the lambda function <code>\\h</code>. I don't see how this lambda function calling itself recursively knows to write <code>c</code> to the file at <code>fp</code>.</p>\n\n<p>I would like to understand why the last line of this function shouldn't read <code>(\\h -&gt; hPutChar fp c)</code>. Attempting to run it that way results in \"Couldn't match type \u2018[Char]\u2019 with \u2018Handle\u2019\" which I consider sensible given that hPutChar expects a Handle datatype as opposed to a string.</p>\n\n<pre><code>import Control.Exception\nwriteChar :: FilePath -&gt; Char -&gt; IO ()\nwriteChar fp c =\n    bracket\n      (openFile fp WriteMode)\n      hClose\n      (\\h -&gt; hPutChar h c)\n</code></pre>\n"}, {"tags": ["haskell", "filtering", "list-comprehension"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555286211, "post_id": 55681019, "comment_id": 98046456, "body": "If you&#39;re trying to re-implement the built-in <code>filter</code>, then you should notice that your type signature is wrong - the &quot;real&quot; <code>filter</code> also takes a function argument of type <code>a -&gt; Bool</code>. Also function names (other than constructors) have to start with a lowercase letter."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1555286226, "post_id": 55681019, "comment_id": 98046462, "body": "No, there&#39;s no built-in function called <code>Filter</code>, nor any other function starting with an uppercase character since that&#39;s syntactically invalid. <b>Only</b> constructors and types can start with an uppercase character, neither function names nor variables can."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1555286357, "post_id": 55681019, "comment_id": 98046477, "body": "Aside from capitalization issues, <code>[x:xs]</code> only matches a list that contains exactly one  non-empty list. Also, the function associated with quicksort is commonly called <code>partition</code>, which more accurately reflects what it does."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "edited": false, "score": 0, "creation_date": 1555315290, "post_id": 55681132, "comment_id": 98053280, "body": "Thanks for your helps!! Could you tell me what is the differences between (x:xs) and [x:xs]. And in this case we prefer the (x:xs)?"}, {"owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "edited": false, "score": 0, "creation_date": 1555315542, "post_id": 55681132, "comment_id": 98053384, "body": "Could I write other Characters for example &quot;x&quot; instead of &quot;xs&quot; or that is a convention oder rule in the code &quot; filter p xs = [x | x &lt;- xs, p x]&quot;. I can see the logic of the code. xs stands for the tail of the list we need."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "edited": false, "score": 0, "creation_date": 1555324671, "post_id": 55681132, "comment_id": 98057851, "body": "@FengxiangHu you can try it out in GHCi. For instance, <code>[1:[2,3,4]]</code> gives <code>[[1,2,3,4]]</code>, i.e. a list containing a single list (which has four elements). Whereas <code>(1:[2,3,4])</code> is just <code>1:[2,3,4]</code> in parentheses, i.e. it&#39;s simply the four-integer list <code>[1,2,3,4]</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1555329757, "post_id": 55681132, "comment_id": 98060468, "body": "<code>[x:xs]</code> matches any list which contains a single element, and that element matches <code>x:xs</code>. In other words, it matches a non-empty list of lists, with <code>x</code> being the first such list and <code>xs</code> being the remaining list of lists. 99% of the time, that isn&#39;t what you want."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1555332878, "post_id": 55681132, "comment_id": 98062225, "body": "@MathematicalOrchid am I confused here, or your comment above isn&#39;t quite right? :)"}, {"owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "edited": false, "score": 0, "creation_date": 1555351809, "post_id": 55681132, "comment_id": 98072541, "body": "(1:[2,3,4])  i.e  ([1,2,3,4]). I think that means a single element in Tupel"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 5, "last_activity_date": 1555305398, "last_edit_date": 1555305398, "creation_date": 1555286700, "answer_id": 55681132, "question_id": 55681019, "link": "https://stackoverflow.com/questions/55681019/correction-of-just-a-part-of-a-piece-of-code-filter-of-quicksort-in-haskell/55681132#55681132", "title": "correction of just a part of a piece of code &quot; Filter &quot; of quicksort in Haskell", "body": "<p>When you're pattern matching on the <code>:</code> constructor, use <code>(x:xs)</code>. <code>[x:xs]</code> is something different.</p>\n\n<p>Always lowercase the first letter of identifiers.  This is a syntax rule in Haskell, not just a convention.</p>\n\n<p><code>filter</code> takes a function of type <code>(a -&gt; Bool)</code> as a parameter. It doesn't require an <code>Ord a</code> instance.</p>\n\n<p>In a list comprehension, the generator term <code>x &lt;- xs</code> must go to the left of any terms that use <code>x</code> (i.e. <code>p x</code>).</p>\n\n<pre><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter p xs = [x | x &lt;- xs, p x]\n\nquickSort :: Ord a =&gt; [a] -&gt; [a]\nquickSort [] = []\nquickSort (x:xs) = quickSort mini ++ [x] ++ quickSort maxi\n    where\n        mini = filter (&lt; x) xs\n        maxi = filter (&gt;= x) xs\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 55681132, "answer_count": 1, "score": -2, "last_activity_date": 1555305736, "creation_date": 1555285338, "last_edit_date": 1555305736, "question_id": 55681019, "link": "https://stackoverflow.com/questions/55681019/correction-of-just-a-part-of-a-piece-of-code-filter-of-quicksort-in-haskell", "title": "correction of just a part of a piece of code &quot; Filter &quot; of quicksort in Haskell", "body": "<pre><code>Filter :: (Ord a) =&gt; [a] -&gt; [a]\n Filter [X:XS] = [[c|c&lt;X, c&lt;-XS ] ++ [X] ++ [c| c &gt;X , c&lt;-XS ]]\n quickSort :: Ord a =&gt; [a] -&gt; [a]\n quickSort [] = []\n quickSort [x:xs] = quickSort mini ++ [x] + quickSort maxi\n       where\n           mini = filter xs\n           maxi = filter xs   \n</code></pre>\n\n<hr>\n\n<p>Is the function \"Filter\" with list comprehension correct? I know there is a built-in function \"Filter\" in Haskell-Libraries. But I tried to write the code by myself...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 3, "creation_date": 1555283899, "post_id": 55680877, "comment_id": 98046059, "body": "You have the right signature for your <code>Show</code> instance. What have you tried for the implementation?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1555283965, "post_id": 55680877, "comment_id": 98046074, "body": "I think this is pretty straightforward - just pattern-match on your 2 constructors, and use recursion for the <code>List</code> one. The <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:intersperse\" rel=\"nofollow noreferrer\">intersperse</a> function should be useful for the recursive case."}, {"owner": {"reputation": 271, "user_id": 2971804, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1060b0c4526852d2f309998a2d199f7?s=128&d=identicon&r=PG&f=1", "display_name": "Juvie22", "link": "https://stackoverflow.com/users/2971804/juvie22"}, "edited": false, "score": 0, "creation_date": 1555283989, "post_id": 55680877, "comment_id": 98046079, "body": "I am pretty noob in thinking functionally. I don&#39;t manage to find a rule. Now I&#39;m playing with show (Elem a) = show a ++ &quot;, &quot;     show (List (x:xs)) = &quot;[&quot; ++ show x ++ &quot;]&quot; ++ (concat (fmap show xs))"}], "answers": [{"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 3, "creation_date": 1555284326, "post_id": 55680904, "comment_id": 98046148, "body": "While this works if all you want is <i>an</i> instance, OP was pretty specific about how they wanted the output to look, so the automatically-derived instance does not suffice in this case."}, {"owner": {"reputation": 271, "user_id": 2971804, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1060b0c4526852d2f309998a2d199f7?s=128&d=identicon&r=PG&f=1", "display_name": "Juvie22", "link": "https://stackoverflow.com/users/2971804/juvie22"}, "edited": false, "score": 0, "creation_date": 1555284373, "post_id": 55680904, "comment_id": 98046157, "body": "yes, but this will just print the standard constructors. I want a custom show method to pretty print the NestedList"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1555285071, "post_id": 55680904, "comment_id": 98046289, "body": "Your quote is only about derived (i.e. automatically generated) instances of <code>Show</code>. Nothing is said or implied about manually written instances."}, {"owner": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "edited": false, "score": 1, "creation_date": 1555285214, "post_id": 55680904, "comment_id": 98046306, "body": "Manual instances are usually reserved for cases where it is meaningless to actually show the data. Think of a widget in a graphical toolkit, for instance. It has long been convention to use Show to convert data to a machine representation. Hijacking Show to make your data pretend to look like actual Haskell strings is counter-intuitive and will confuse other users. It&#39;s not impossible to do so, it might just not be in the interests of OP."}], "tags": [], "owner": {"reputation": 3516, "user_id": 1057102, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9f1412fdce8dc8873cf8b5590501faf7?s=128&d=identicon&r=PG&f=1", "display_name": "sleblanc", "link": "https://stackoverflow.com/users/1057102/sleblanc"}, "is_accepted": false, "score": 0, "last_activity_date": 1555284347, "last_edit_date": 1555284347, "creation_date": 1555284120, "answer_id": 55680904, "question_id": 55680877, "link": "https://stackoverflow.com/questions/55680877/instantiate-show-typeclass-for-a-custom-nestedlist-type/55680904#55680904", "title": "Instantiate Show typeclass for a custom NestedList type", "body": "<p>You do not have to implement Show, just ask the compiler to derive it:</p>\n\n<pre><code>data NestedList a = Elem a | List [NestedList a]\nderiving Show\n</code></pre>\n\n<p>The Show typeclass is typically reserved for printing values in a format that can be read back by the language. </p>\n\n<blockquote>\n  <p>Derived instances of Show have the following properties, which are compatible with derived instances of Text.Read.Read: * The result of show is a syntactically correct Haskell expression containing only constants, given the fixity declarations in force at the point where the type is declared. It contains only the constructor names defined in the data type, parentheses, and spaces. When labelled constructor fields are used, braces, commas, field names, and equal signs are also used.</p>\n</blockquote>\n\n<p>By convention, your function should be defined separately from the Show typeclass instance. </p>\n"}, {"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1555331531, "post_id": 55681018, "comment_id": 98061466, "body": "@MathematicalOrchid good point. I can&#39;t try it right now but that could well work :)"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 4, "last_activity_date": 1555285306, "creation_date": 1555285306, "answer_id": 55681018, "question_id": 55680877, "link": "https://stackoverflow.com/questions/55680877/instantiate-show-typeclass-for-a-custom-nestedlist-type/55681018#55681018", "title": "Instantiate Show typeclass for a custom NestedList type", "body": "<p>I believe this is the instance you want:</p>\n\n<pre><code>data NestedList a = Elem a | List [NestedList a]\n\ninstance (Show a) =&gt; Show (NestedList a) where\n    show (Elem a) = show a\n    show (List xs) = \"[\" ++ intercalate \", \" (map show xs) ++ \"]\"\n</code></pre>\n\n<p>Note that you will need to import <code>intercalate</code> from <code>Data.List</code>. (This is different from <code>intersperse</code> which I mentioned in my comment - apologies that in haste I picked the wrong one.)</p>\n\n<p>I hope this makes sense when you've seen it - we simply borrow the <code>show</code> instance for <code>a</code> to treat the <code>Elem a</code> case. Then the <code>List</code> case displays all the elements, puts the string <code>\", \"</code> between each, and encloses the whole in square brackets.</p>\n\n<p>Proof that it works on your example:</p>\n\n<pre><code>Prelude Data.List&gt; :{\nPrelude Data.List| let a = List [List[Elem 2], Elem 1, List[Elem 1, Elem 2],\nPrelude Data.List|               List[List[Elem 2, Elem 3]], Elem 5]\nPrelude Data.List| :}\nPrelude Data.List&gt; a\n[[2], 1, [1, 2], [[2, 3]], 5]\n</code></pre>\n"}], "owner": {"reputation": 271, "user_id": 2971804, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1060b0c4526852d2f309998a2d199f7?s=128&d=identicon&r=PG&f=1", "display_name": "Juvie22", "link": "https://stackoverflow.com/users/2971804/juvie22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1501, "favorite_count": 0, "accepted_answer_id": 55681018, "answer_count": 2, "score": 0, "last_activity_date": 1555285306, "creation_date": 1555283705, "last_edit_date": 1555284967, "question_id": 55680877, "link": "https://stackoverflow.com/questions/55680877/instantiate-show-typeclass-for-a-custom-nestedlist-type", "title": "Instantiate Show typeclass for a custom NestedList type", "body": "<p>I have defined the following custom type of arbitrary deep lists</p>\n\n<pre><code>data NestedList a\n    = Elem a\n    | List [NestedList a]\n</code></pre>\n\n<p>and I want to instantiate Show and pretty print my nested lists, but I don't have any idea about how the show function should look for my type</p>\n\n<pre><code>instance (Show a) =&gt; Show (NestedList a) where\n</code></pre>\n\n<p>for example if we have </p>\n\n<pre><code>let a = List [List[Elem 2], Elem 1, List[Elem 1, Elem 2],\n              List[List[Elem 2, Elem 3]], Elem 5]\n</code></pre>\n\n<p>I want <code>show a</code> to print </p>\n\n<pre><code>\"[[2], 1, [1, 2], [[2, 3]], 5]\"\n</code></pre>\n\n<p>How can I implement the <code>show</code> function?</p>\n"}, {"tags": ["algorithm", "haskell", "tree", "mapping", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1555277206, "post_id": 55680121, "comment_id": 98044806, "body": "If a node <code>x</code> in <code>X</code> has a corresponding node <code>y</code> in <code>Y</code>, are all the nodes in <code>Y</code> that correspond to descendants of <code>x</code> also descendants of <code>y</code>?"}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1555277891, "post_id": 55680121, "comment_id": 98044979, "body": "@danidiaz no, not necessarily."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1555286127, "post_id": 55680121, "comment_id": 98046443, "body": "I think zippers are indeed what you want here."}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1555517841, "post_id": 55680121, "comment_id": 98142644, "body": "Is it worth transforming my data into a Data.Tree so that I can use Data.Tree.Zipper? Or should I just implement my own zipper? Are there any gotchas on either route which I should be aware of?"}], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": false, "score": 0, "last_activity_date": 1585069254, "creation_date": 1585069254, "answer_id": 60835764, "question_id": 55680121, "link": "https://stackoverflow.com/questions/55680121/how-to-represent-mapping-between-two-trees-in-haskell/60835764#60835764", "title": "How to represent mapping between two trees in Haskell?", "body": "<p>You can label the tree nodes with <code>Int</code> id's, and walk around them with zippers (using <code>Data.Tree</code> and <code>Data.Tree.Zipper</code> is a good idea because there's no need to reinvent the wheel).  You can then attach auxiliary attributes to the nodes using a <code>Data.IntMap</code> to map node id's to whatever you want.  In particular, you can create an <code>IntMap</code> to map from a node id to the <code>TreePos Full Int</code> for that node so you can explore the parent, siblings, and children of that node. </p>\n"}], "owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 330, "favorite_count": 2, "answer_count": 1, "score": 16, "last_activity_date": 1585069254, "creation_date": 1555276735, "question_id": 55680121, "link": "https://stackoverflow.com/questions/55680121/how-to-represent-mapping-between-two-trees-in-haskell", "title": "How to represent mapping between two trees in Haskell?", "body": "<p>I'm trying to implement a tree-processing algorithm in Haskell, and (due to the fact this is my first Haskell program!), am struggling with the design of the data structures.  Can any of the FP gurus out there lend a hand?</p>\n\n<p>I'll start by describing the important characteristics of the algorithm, sketch out how I would approach this using an imperative language, and finish with the stumbling baby-steps I have made so far in Haskell.</p>\n\n<h1>The problem</h1>\n\n<p>I won't describe the full algorithm in detail, but the salient points are as follows:</p>\n\n<ul>\n<li>The algorithm operates on two rose trees, X and Y.</li>\n<li>The first phase of the algorithm computes some derived properties for each node, based on its label and attributes, and those of its descendants.</li>\n<li>These derived properties are used to compute a partial mapping between the two trees, such that a node in X may be associated with a node in Y and vice versa.  Because the mapping is partial, any node in X or Y may either be mapped (i.e. have a partner the other tree), or alternatively may be unmapped.</li>\n<li>The final phase of the algorithm optimises these mappings, via a sequence of operations which inspect parent / children / siblings of mapped nodes.</li>\n</ul>\n\n<p>The data structures must therefore have the following characteristics:</p>\n\n<ul>\n<li>Given a reference to a node, provide access the parent of that node, siblings of that node, and children of that node.</li>\n<li>Given a node in an input tree, permit <em>annotation</em> of that node with additional information (derived properties, and an optional reference to a node in the other tree).</li>\n</ul>\n\n<h1>Sketch of an imperative solution</h1>\n\n<p>If I was to implement this algorithm using an imperative language, the solution would look something like the following.</p>\n\n<p>Let's assume that the starting point is the following definition of the input tree:</p>\n\n<pre><code>struct node {\n    // Identifier for this node, unique within the containing tree\n    size_t id;\n\n    // Label of this node\n    enum label label;\n\n    // Attributes of this node\n    // An attribute can be assumed to be a key-value pair\n    // Details of the attributes themselves aren't material to this\n    // discussion, so the \"attribute\" type is left opaque\n    struct attribute **attributes;\n    size_t n_attributes;\n\n    // Pointer to parent of this node\n    // NULL iff this node is root\n    struct node *parent;\n\n    // Pointer to first child of this node\n    // NULL iff this node is leaf\n    struct node *child;\n\n    // Double-linked list of siblings of this node\n    struct node *prev;\n    struct node *next;\n};\n</code></pre>\n\n<p>The pointers embedded in each node clearly support the up / down / left / right traversals required by the algorithm.</p>\n\n<p>Annotation can be implemented by defining the following structure:</p>\n\n<pre><code>struct algo_node {\n    // Pointer to input node which has been wrapped\n    struct node *node;\n\n    // Derived properties computed by first phase of the algorithm\n    // Details of the properties themselves aren't material to this\n    // discussion, so the \"derived\" type is left opaque\n    struct derived props;\n\n    // Pointer to corresponding node in the other tree\n    // NULL iff this node is unmatched\n    struct node *match;\n};\n</code></pre>\n\n<p>The first phase of the algorithm constructs an <code>algo_node</code> for each <code>node</code> in each of the input trees.</p>\n\n<p>Mapping from an <code>algo_node</code> to a <code>node</code> is trivial: follow the embedded <code>*node</code> pointer.  Mapping in the other direction can be supported by storing <code>algo_node</code>s in an array, indexed by the <code>id</code> of the input node.</p>\n\n<p>This is of course just one possible implementation.  Many variations are possible, including</p>\n\n<ul>\n<li>Abstracting the children linked list behind a <code>list</code> or <code>queue</code> interface, rather than storing three raw pointers</li>\n<li>Instead of associating the input tree with the algorithm tree via indices, encode parent / child / sibling relationships directly in <code>struct algo_node</code></li>\n</ul>\n\n<h1>Moving to Haskell</h1>\n\n<p>Let's start with the following definition of the input tree:</p>\n\n<pre><code>data Tree = Leaf Label Attributes\n          | Node Label Attributes [Tree]\n</code></pre>\n\n<p>Augmentation of each node with an id can be achieved as follows:</p>\n\n<pre><code>data AnnotatedTree = Tree Int\n\naddIndex :: Int -&gt; AnnotatedTree -&gt; (AnnotatedTree, Int)\n\nindexedTree = addIndex 0 tree\n</code></pre>\n\n<p>Similarly, we can write a function which computes derived properties:</p>\n\n<pre><code>data AnnotatedTree = Tree DerivedProperties\n\ncomputeDerived :: DerivedProperties -&gt; AnnotatedTree -&gt; (AnnotatedTree, DerivedProperties)\n\nderivedTree = computeDerived DefaultDerived tree\n</code></pre>\n\n<p>The above snippets can be adjusted with little work, such that <code>AnnotatedTree</code> contains both the index and the derived properties.</p>\n\n<p>However, I don't know where to begin with representing mappings between the two trees.  Based on some reading, I have some half-baked ideas ...</p>\n\n<ul>\n<li>Define <code>AnnotatedTree</code> to contain a path from the root of the other tree to the mapped node - encoded as a list of indices into each successive children list, <code>[Integer]</code>\n\n<ul>\n<li>Use a zipper (of which I currently have a fairly loose understanding) to access the mapped node (or its parent / children / siblings) via the path</li>\n<li>Or perhaps use a lens (... of which I have an even less clear understanding!) to do the same</li>\n</ul></li>\n<li>Define <code>AnnotatedTree</code> to contain a reference to the mapped node directly, as a <code>Maybe Tree</code>\n\n<ul>\n<li>But then I don't see a way to walk to parent / siblings of the mapped node</li>\n</ul></li>\n</ul>\n\n<p>... but I could really do with some guidance on which (if any) of these are worth pursuing.</p>\n\n<p>Any help would be much appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1555278037, "post_id": 55679603, "comment_id": 98045019, "body": "How do you plan to take the maximum of two things if the two things aren&#39;t <code>Ord</code>? Complex numbers are <code>Fractional</code>, but they certainly aren&#39;t ordered. What&#39;s the max of <code>-1+i</code> and <code>1-i</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555288726, "post_id": 55679603, "comment_id": 98046864, "body": "If we don&#39;t need to worry about <code>RE</code>, you should remove it from the question. You can write a function of type <code>Fractional a =&gt; a -&gt; a</code> that demonstrates your problem without it."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1555330492, "post_id": 55679603, "comment_id": 98060851, "body": "Is there a specific reason you need to be able to use any possible number type? If you want all the types to be <code>Int</code>, just say <code>Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 6, "last_activity_date": 1555278082, "creation_date": 1555278082, "answer_id": 55680275, "question_id": 55679603, "link": "https://stackoverflow.com/questions/55679603/convert-ord-to-fractional/55680275#55680275", "title": "Convert Ord to Fractional", "body": "<blockquote>\n  <p>Ideally I want a function that converts an ord to a fractional.</p>\n</blockquote>\n\n<p>Many more things can be ordered than are fractional, eg. <code>\"abcd\" &lt; \"abce\"</code>, but what is <code>\"abcd\" / \"abce\"</code>?</p>\n\n<blockquote>\n  <p>I'm stuck with a number that is a fractional and ord though there are no functions that convert that number into an int. </p>\n</blockquote>\n\n<p>If you all know is <code>Fractional</code> and <code>Ord</code>, how do you know a sensible <code>-&gt; Integer</code> conversion exists? For instance, consider <code>Data.Complex Double</code> (basically just a complex number) - we can add, subtract, divide even (ie. it is <code>Fractional</code>) but what would make mathematical sense as an answer for <code>toInteger (1 + i)</code>? There isn't a good definition.</p>\n\n<p>It's unclear what exactly you're trying to achieve, but, the closest I can think of is, adding a <code>RealFrac a</code> constraint. This would provide you with the functions you want (eg. <code>truncate</code>, <code>round</code>, <code>ceiling</code>, <code>floor</code>) for converting to <code>Integral</code> types.</p>\n"}], "owner": {"reputation": 11, "user_id": 8373223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f034c8b69d1170634a42d27292375587?s=128&d=identicon&r=PG&f=1", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/8373223/juan-cruz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555278082, "creation_date": 1555272694, "question_id": 55679603, "link": "https://stackoverflow.com/questions/55679603/convert-ord-to-fractional", "title": "Convert Ord to Fractional", "body": "<p>How do I convert an Ord number given by max function into a fractional.\nOr how do I convert a number with 2 constraints (x::(Ord a, Fractional a) => a) into an int? </p>\n\n<p>don't worry about RE</p>\n\n<pre><code>seemore :: (Fractional a) =&gt; RE b -&gt; a -&gt; a\nseemore (a:+:b) x = seemore (a) (x) + seemore b x\nseemore (a:|:b) x = max (seemore a y) (seemore b z)\n   where y = x\n         z = x\nseemore (Symbol a) x = x\nseemore Empty x = 0\nseemore (Repeat(a)) x = 1/0\nseemore (Plus(a)) x = 1/0\n</code></pre>\n\n<p>in the \"seemore :: (Fractional a)\" part I need to add Ord a into that constraint, or else it fails. But then I'm stuck with a number that is a fractional and ord though there are no functions that convert that number into an int. Ideally I want a function that converts an ord to a fractional.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1555251974, "post_id": 55675988, "comment_id": 98037763, "body": "I don&#39;t understand the question, perhaps you can explain better what you mean by \u201cstop when it reaches 1000 calls\u201d. Also I think the example could be simplified more."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1555259924, "creation_date": 1555259924, "answer_id": 55677625, "question_id": 55675988, "link": "https://stackoverflow.com/questions/55675988/how-can-i-stop-a-function-after-a-certain-number-of-recursive-calls/55677625#55677625", "title": "How can I stop a function after a certain number of recursive calls?", "body": "<p>As I understand it, happy numbers are those where the sequence generated by <code>happy</code> converges to 1, so you can return <code>True</code>, but <em>unhappy</em> numbers are those where the sequence continues forever.  You'd like to return <code>False</code>, but right now your code just loops on unhappy numbers.  (For example, <code>happy 1</code> returns <code>True</code>, but <code>happy 2</code> hangs.)</p>\n\n<p>The usual way of doing this is to introduce a new parameter that serves as a countdown.  The hint you were given was to introduce an auxiliary function <code>happy'</code> so that you wouldn't have to change the type signature of <code>happy</code>.  Try defining:</p>\n\n<pre><code>happy :: Integer -&gt; Bool\nhappy x = happy' 1000 x\n\nhappy' :: Integer -&gt; Integer -&gt; Bool\nhappy' countDown x\n   | x == 1 = True\n   | otherwise = (happy' (countDown - 1) . squareSum . digits) x\n</code></pre>\n\n<p>So far, this \"solution\" will still run forever, but now you have a <code>countDown</code> parameter!  You should be able to add a new guarded case that checks if the <code>countDown</code> has expired to return <code>False</code>.</p>\n"}], "owner": {"reputation": 39, "user_id": 11248089, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HvqPECHw034/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rda3KbdXlEBYuEdWw0eSbzfv3gQhQ/mo/photo.jpg?sz=128", "display_name": "xentaquadrin", "link": "https://stackoverflow.com/users/11248089/xentaquadrin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "closed_date": 1555799418, "accepted_answer_id": 55677625, "answer_count": 1, "score": 0, "last_activity_date": 1555259924, "creation_date": 1555249629, "last_edit_date": 1555259921, "question_id": 55675988, "link": "https://stackoverflow.com/questions/55675988/how-can-i-stop-a-function-after-a-certain-number-of-recursive-calls", "closed_reason": "Duplicate", "title": "How can I stop a function after a certain number of recursive calls?", "body": "<p>I need to count recursive calls of a function called happy. I got a hint, I can do it with an auxiliary function. I just cant figure it out, how should i implement it. The recursion should stop when it reaches 1000 calls.</p>\n\n<pre><code>digits :: Integer -&gt; [Integer]\ndigits x \n | x &lt; 1     = []\n | x == 1    = [1]\n | otherwise = x `mod` 10 : digits (x `div` 10)\n\nsquareSum :: [Integer] -&gt; Integer\nsquareSum (x:xs) = sum (map (^2) (x:xs))\n\nhappy :: Integer -&gt; Bool\nhappy x\n | x == 1 = True\n | otherwise = (happy . squareSum . digits) x\n\nhappyNumbers :: [Integer]\nhappyNumbers = filter happy [1..500]\n</code></pre>\n\n<p><code>digits</code> function gets an integer, and creates a list with its digits.</p>\n\n<p><code>squareSum</code> function squares these digits, and summarizes them.</p>\n\n<p><code>happy</code> is the function where it calls itself over and over, but i need to stop it when it reaches 1000 calls.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1555247797, "post_id": 55675685, "comment_id": 98036542, "body": "Since you use <code>getChar</code> the cursor is simply placed after that character. You probably want to add a <code>getLine</code> before the one you marked to put the cursor to the next line first."}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1555253656, "post_id": 55675685, "comment_id": 98038272, "body": "@MichaelLitchard I have removed the image and included output in text format"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1555253699, "post_id": 55675685, "comment_id": 98038282, "body": "@user10731678 Thanks. :) I removed downvote."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1555257499, "post_id": 55675685, "comment_id": 98039366, "body": "You linked to a question that has the exact same root cause as yours, but didn&#39;t actually apply the recommended fix from the link!"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1555253807, "post_id": 55676185, "comment_id": 98038315, "body": "@MichaelLitchard I will!"}], "tags": [], "owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "is_accepted": true, "score": 2, "last_activity_date": 1555250911, "creation_date": 1555250911, "answer_id": 55676185, "question_id": 55675685, "link": "https://stackoverflow.com/questions/55675685/getline-not-working-as-intended-being-skipped/55676185#55676185", "title": "&#39;getLine&#39; not working as intended, being skipped", "body": "<p>Thanks to Willem Van Onsem's comment on my original question I have been able to find a solution. I added a \"getLine\" after the line 'putStrLn \"Insert a position\"' so the code now looks like;</p>\n\n<pre><code>import System.Environment   \nimport System.Directory  \nimport System.IO \nimport Data.List  \n\nmain :: IO ()\nmain = do \n      putStrLn \"Insert a string\"\n      word &lt;- getLine\n      putStrLn \"Insert a char\"\n      char &lt;- getChar\n      putStrLn \"Insert a position\"\n      temp &lt;- getLine *line that has been added*\n      pos &lt;- getLine\n      let x = (read pos :: Int)\n      putStrLn \"Adding char to list...\"\n      let newS = [(insertChar char word x)]\n      putStrLn \"Printed list: \"\n      print (newS)\n      putStrLn \"Insert file name\"\n      file &lt;- getLine\n      putStrLn \"Adding new string to file...\"\n      add file newS\n\ninsertChar :: a -&gt; [a] -&gt; Int -&gt; [a]\ninsertChar x ys     1 = x:ys\ninsertChar x (y:ys) n = y:insertChar x ys (n-1)\n\nadd :: String -&gt; [String] -&gt; IO ()  \nadd fileName [item] = appendFile fileName item\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555328470, "post_id": 55677230, "comment_id": 98059777, "body": "As stated in the question this did not work for me. I have also tried to put it in my main function like you suggest here but it instead closes GHCI completely"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555334213, "post_id": 55677230, "comment_id": 98063027, "body": "@user10731678 Wow! Now <i>that</i> is worth a fresh question, if it can be reliably reproduced. Include the code that closes ghci, and the exact things you do to load/run the code."}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555357608, "post_id": 55677230, "comment_id": 98074919, "body": "I cannot seem to replicate GHCI closing (not really sure why?), however removing the &#39;temp -&gt; getLine&#39; and placing &#39;hSetBuffering stdin NoBuffering&#39; in my main function and importing it at the top creates the original problem"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555360329, "post_id": 55677230, "comment_id": 98075959, "body": "@Seb I can&#39;t reproduce. After deleting your comments, adding the <code>hSetBuffering</code> line, and calling <code>runhaskell test.hs</code>, when I type <code>foo</code> followed by an enter, then <code>i</code> (followed by no enter!) it immediately proceeds to ask me for a position; entering <code>3</code> followed by enter causes it to print <code>[&quot;foio&quot;]</code>. The same happens if I substitute typing <code>main</code> (and pressing enter) in <code>ghci test.hs</code> instead of using <code>runhaskell</code>. Can you describe in similar detail the sequence of actions you&#39;re taking and the behavior it displays?"}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555410153, "post_id": 55677230, "comment_id": 98092608, "body": "I have edited my question above to show what I have been doing using &#39;hSetBuffering stdin NoBuffering&#39;. I am Running it through GHCI by first loading it and then running the &#39;main&#39; function, &#39;:l TextEditor.hs&#39; followed by &#39;main&#39; (as seen in the error section of the question). It still skips the line where the user can input a position"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555437410, "post_id": 55677230, "comment_id": 98108625, "body": "@Seb Can you please describe in detail what input actions you take once <code>main</code> starts? In particular, I suspect that you are mistakenly pressing &quot;enter&quot; after entering a character at the &quot;Insert a char&quot; prompt."}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555437852, "post_id": 55677230, "comment_id": 98108837, "body": "I am indeed pressing &quot;enter&quot; after entering a character. I am confused on how else I am meant to trigger the rest of the program without pressing enter? I press enter after main. I then input my string and press enter. I input my character and press enter, the error occurs"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555439665, "post_id": 55677230, "comment_id": 98109717, "body": "@Seb Enter after <code>main</code>, good. Input your string and press enter, good. Then press a character, and do not press enter. The program will proceed to prompt you with &quot;Insert a position&quot; instantly, and you can then enter your position and press enter."}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555499895, "post_id": 55677230, "comment_id": 98131349, "body": "This is all very bizarre. It simply does not carry on unless I press enter. Main -&gt; enter -&gt; insert a string -&gt; abc -&gt; enter -&gt; insert a char -&gt; d -&gt; nothing unless I press enter and then the error is produced."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555506891, "post_id": 55677230, "comment_id": 98135715, "body": "@Seb Huh. Okay, this question definitely isn&#39;t a dupe; though I can&#39;t reproduce that behavior here. What version of GHC are you using? Are you super-duper sure that you&#39;ve saved the file and are loading the file you saved to (I know that sounds dumb, but... I&#39;ve seen it before...)?"}, {"owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "edited": false, "score": 0, "creation_date": 1555507254, "post_id": 55677230, "comment_id": 98135983, "body": "Version is 8.6.3, yes just double checked. Everything saved and loaded correctly. I understand it may not be best practice but I am going to mark the solution above as correct. It looks odd from a code perspective but from a UI point of view it works"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1555257371, "creation_date": 1555257371, "answer_id": 55677230, "question_id": 55675685, "link": "https://stackoverflow.com/questions/55675685/getline-not-working-as-intended-being-skipped/55677230#55677230", "title": "&#39;getLine&#39; not working as intended, being skipped", "body": "<p>You imported the right stuff, but never actually called it! Try this:</p>\n\n<pre><code>main = do\n    hSetBuffering stdin NoBuffering\n    -- ...all the rest of your original main, exactly as it used to be\n</code></pre>\n\n<p>This way, when it gets to the <code>getChar</code> line, it will return from the <code>getChar</code> as soon as you press a key -- not wait until you press enter. The UI will make more sense, and the code will, too, because you don't need to swallow a phantom newline that the user didn't actually want to enter anyway.</p>\n"}], "owner": {"reputation": 53, "user_id": 10731678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725e4b5bfacbcda23a7de6c20a20cd49?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/10731678/seb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 55676185, "answer_count": 2, "score": 1, "last_activity_date": 1555506814, "creation_date": 1555247675, "last_edit_date": 1555409922, "question_id": 55675685, "link": "https://stackoverflow.com/questions/55675685/getline-not-working-as-intended-being-skipped", "title": "&#39;getLine&#39; not working as intended, being skipped", "body": "<p>I am fairly new to Haskell and am writing some simple text/file manipulation functions. I am currently attempting to modify a string before adding it to a file.</p>\n\n<p>I have a function 'insertChar' which adds a character at any given position in a string (using the solution of problem 21 from 99 problems in Haskell <a href=\"https://wiki.haskell.org/99_questions/21_to_28\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/99_questions/21_to_28</a>). </p>\n\n<pre><code>import System.Environment   \nimport System.Directory  \nimport System.IO \nimport Data.List  \n\nmain :: IO ()\nmain = do \n      putStrLn \"Insert a string\"\n      word &lt;- getLine\n      putStrLn \"Insert a char\"\n      char &lt;- getChar\n      putStrLn \"Insert a position\"\n      pos &lt;- getLine *line which is skipped*\n      let x = (read pos :: Int) *converts string into int*\n      putStrLn \"Adding char to list...\"\n      let newS = [(insertChar char word x)] *result of insertChar is set to \n      newS*\n      putStrLn \"Printed list: \"\n      print (newS) *print new string*\n      putStrLn \"Insert file name\"\n      file &lt;- getLine\n      putStrLn \"Adding new string to file...\"\n      add file newS\n\ninsertChar :: a -&gt; [a] -&gt; Int -&gt; [a]\ninsertChar x ys     1 = x:ys\ninsertChar x (y:ys) n = y:insertChar x ys (n-1)\n\nadd :: String -&gt; [String] -&gt; IO ()  \nadd fileName [item] = appendFile fileName item\n</code></pre>\n\n<p>The user is asked to enter a string, then a character they wish to add to this string and finally the position in the string where they wish to add the character. I can input the string fine but when I press enter after inputting the character, the 'getLine' for inputting the position is skipped and the following error is produced;</p>\n\n<pre><code>GHCI&gt;main\nInsert a string\nhello world\nInsert a char\ns\nInsert a position\nAdding char to list...\nPrinted list:\n[\"*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>I have seen this stack overflow post; <a href=\"https://stackoverflow.com/questions/5605983/haskell-skipping-getline\">haskell -skipping getLine</a> </p>\n\n<p>and have attempted to follow that answer changing the code to; </p>\n\n<pre><code>import System.Environment   \nimport System.Directory   \nimport System.IO (hSetBuffering, stdin, BufferMode(NoBuffering)) *New line*\nimport Data.List  \n\nmain :: IO ()\nmain = do \n      hSetBuffering stdin NoBuffering *New line*\n      putStrLn \"Insert a string\"\n      word &lt;- getLine\n      putStrLn \"Insert a char\"\n      char &lt;- getChar\n      putStrLn \"Insert a position\"\n      pos &lt;- getLine \n      let x = (read pos :: Int) \n      putStrLn \"Adding char to list...\"\n      let newS = [(insertChar char word x)] \n      putStrLn \"Printed list: \"\n      print (newS)\n      putStrLn \"Insert file name\"\n      file &lt;- getLine\n      putStrLn \"Adding new string to file...\"\n      add file newS\n\ninsertChar :: a -&gt; [a] -&gt; Int -&gt; [a]\ninsertChar x ys     1 = x:ys\ninsertChar x (y:ys) n = y:insertChar x ys (n-1)\n\nadd :: String -&gt; [String] -&gt; IO ()  \nadd fileName [item] = appendFile fileName item\n</code></pre>\n\n<p>However, it still produces the same error. Any clue what I am doing wrong?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 5, "last_activity_date": 1555245236, "last_edit_date": 1555245236, "creation_date": 1555244875, "answer_id": 55675247, "question_id": 55675228, "link": "https://stackoverflow.com/questions/55675228/something-about-elem-function-in-a-list/55675247#55675247", "title": "something about elem function in a list", "body": "<p>The problem is that you intend to use <code>Strings</code> (aka <code>[Char]</code> in haskell), but you are not using the proper sintax, check the difference here:</p>\n\n<pre><code>Prelude Data.List&gt; :t 'A'\n'A' :: Char\nPrelude Data.List&gt; :t \"A\"\n\"A\" :: [Char]\n</code></pre>\n\n<p>Now lets take the type signature of <code>elem</code>:</p>\n\n<pre><code>Prelude Data.List&gt; :t elem\nelem :: (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>Let's check now about <code>Foldable</code> and <code>Eq</code>, <code>Eq a</code> means that <code>a</code> type can be check for equality,and, lets simply think of foldable as a collection, or data structure that can be visited element by element for now. \nSo, we have that <code>elem</code> takes an item of type <code>a</code>, a \"collection\" of type <code>a</code> and return a <code>Bool</code>, so, if we have a collection of <code>[Char]</code> we need to provide an element of the same type.\nNow, as mentioned before, if we use string, and a list of strings, our \"final\" <code>elem</code> type would be <code>[Char] -&gt; [[Char]] -&gt; Bool</code>. Lets try it:</p>\n\n<pre><code>Prelude Data.List&gt; elem \"A1\" [\"A1\", \"A2\"]\nTrue\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11358945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QFUmbuJVJcI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcU-34wtdEoyWhoMcOyr7Bt4BlRFw/mo/photo.jpg?sz=128", "display_name": "\u5218lllqwehhh", "link": "https://stackoverflow.com/users/11358945/%e5%88%98lllqwehhh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1555430855, "creation_date": 1555244696, "last_edit_date": 1555430855, "question_id": 55675228, "link": "https://stackoverflow.com/questions/55675228/something-about-elem-function-in-a-list", "title": "something about elem function in a list", "body": "<p>I have some issues about elem function.\nThe elem function can return a bool value when the list contains the specific value. eg. elem 1 [1,2,3,5] return true.</p>\n\n<p>The question is if the list is made up with string. For instance the list is ['A2','A1']. how can I use the elem function.  I used elem 'A2' ['A1','A2'] but it doesn't work.</p>\n"}, {"tags": ["list", "haskell", "filter", "higher-order-functions", "map-function"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555240711, "post_id": 55674656, "comment_id": 98034556, "body": "What error message do you get? That definition of <code>p</code> is working fine for me in GHCi."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555240772, "post_id": 55674656, "comment_id": 98034572, "body": "As for how to use <code>map</code> and <code>filter</code> to get the same result as your list comprehension - what combination have you tried? Do you know which functions to apply <code>map</code> and <code>filter</code> to?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555241357, "post_id": 55674656, "comment_id": 98034719, "body": "@RobinZigmond  My error message is  &lt;interactive&gt;:4:1: error: Variable not in scope : p :: Integer -&gt; t"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555241443, "post_id": 55674656, "comment_id": 98034738, "body": "@RobinZigmond I have not tried much yet it&#180;s my second day with Haskell and i&#180;m a bit  overwhelmed."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555249256, "post_id": 55674656, "comment_id": 98036968, "body": "I wouldn&#39;t recommend trying to do all this in an interactive session. I think that&#39;s ultimately the cause of your out of scope error. Try moving the definitions into a file and loading it into GHCi with <code>:l</code>"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1605182397, "last_edit_date": 1605182397, "creation_date": 1555250411, "answer_id": 55676108, "question_id": 55674656, "link": "https://stackoverflow.com/questions/55674656/how-to-combine-filter-and-mapping-in-haskell/55676108#55676108", "title": "How to combine filter and mapping in Haskell", "body": "<p>You already have everything you need here. You wrote</p>\n<pre><code>let res = [ x^2 | x &lt;- [0..10], <b>mod x 2==0</b>, <b>x/=0</b> ]</code></pre>\n<p>But this means you could also write</p>\n<pre><code>let res = [ y^2 | y &lt;- [ x | x &lt;- [0..10] \n                           , <b>(mod x 2==0 && x/=0)</b> ] ]\n~=\nlet res = [ y^2 | y &lt;- [ x | x &lt;- [0..10], <b>test x</b> ] ]\n   where\n   <b>test x</b> = (mod x 2==0 && x/=0)\n~=\nlet res = [ y^2 | y &lt;- baz <b>[0..10]</b> ]\n   where\n   baz <b>xs</b> = [ x | x &lt;- <b>xs</b>, test x ]\n   test x = (mod x 2==0 && x/=0)\n~=\nlet res = [ sqr y | y &lt;- bar <b>test</b> [0..10] ]\n   where\n   sqr y = y^2\n   bar <b>p</b> xs = [ x | x &lt;- xs, <b>p</b> x ]\n   test x = (mod x 2==0 && x/=0)\n~=\nlet res = quux <b>( bar test [0..10] )</b>\n   where\n   quux <b>ys</b> = [ sqr y | y &lt;- <b>ys</b> ]\n   sqr y = y^2\n   bar p xs = [ x | x &lt;- xs, p x ]\n   test x = (mod x 2==0 && x/=0)\n~=\nlet res = foo <b>sqr</b> ( bar test [0..10] )\n   where\n   foo <b>f</b> ys = [ <b>f</b> y | y &lt;- ys ]\n   sqr y = y^2\n   bar p xs = [ x | x &lt;- xs, p x ]\n   test x = (mod x 2==0 && x/=0)</code></pre>\n<p>So now we do have the two functions, <code>foo f ys</code> for mapping a function <code>f</code> over a list <code>ys</code>,  and <code>bar p xs</code> for testing each element of <code>xs</code> by a predicate <code>p</code> and filtering out all that fail to pass that test (i.e. all <code>x</code>s such that <code>p x == False</code>). And, it turns out, <em>we already had</em> their definitions!</p>\n<p>All we needed to extract them from our raw code was <em>abstraction</em>.</p>\n<pre><code>let res = <b>map</b> sqr ( <b>filter</b> test [0..10] )\n   where\n   sqr y = y^2\n   test x = (mod x 2==0 && x/=0)</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2214, "favorite_count": 0, "accepted_answer_id": 55676108, "answer_count": 1, "score": 2, "last_activity_date": 1605182397, "creation_date": 1555240524, "last_edit_date": 1555311936, "question_id": 55674656, "link": "https://stackoverflow.com/questions/55674656/how-to-combine-filter-and-mapping-in-haskell", "title": "How to combine filter and mapping in Haskell", "body": "<p>I'm making some exercises with haskell. My Task is to create a list of squares of even numbers without 0 from the list <code>[0..10]</code>.</p>\n\n<p>I already made it with the list comprehension in Haskell (Take a look in the code block below.) but now my task is to implement this with the function <code>map</code> and <code>filter</code> .</p>\n\n<pre><code>List comprehension in Haskell:\n[x^2 | x &lt;- [0..10], mod x 2==0, x/=0]\n\n\nf = (\\x -&gt; (x^2))\np = (\\x -&gt; mod x 2 == 0 &amp;&amp; x/=0)\n\nmap1 :: (a-&gt;b) -&gt; [a] -&gt; [b]\nmap1 f [] = []\nmap1 f (x:xs) = f x : map1 f xs\n\nfilter1 :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter1 p [] = []\nfilter1 p (x:xs)\n | p x = x:filter p xs\n | otherwise = filter1 p xs\n</code></pre>\n\n<p>I implemented the <code>map</code> and <code>filter</code> function ( I know it is superfluous but it practices me ) and I have a square function. Now the problem is to combine the <code>map</code> with the <code>filter</code> and I also get an <code>error</code> message at <code>p = (\\x -&gt; mod x 3 == 0 &amp;&amp; x/=0)</code>.</p>\n\n<p>My error message is <code>&lt;interactive&gt;:4:1: error: Variable not in scope : p :: Integer -&gt; t</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2956272"}, "edited": false, "score": 2, "creation_date": 1555219061, "post_id": 55672079, "comment_id": 98030264, "body": "Because <code>foldr ... xs</code> returns a function, which takes a list and then populates it with elements from <code>xs</code>. Initially this function is <code>id</code> (which means that it doesn&#39;t change the list). Then each <code>foldr</code> iteration modifies the function: it adds the current element and then performs the rest (i.e. adds already seen elements)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1555224256, "post_id": 55672079, "comment_id": 98031052, "body": "Essentially, any function <code>f :: ... -&gt; ... -&gt; b</code> accepts an arbitrarily large number of arguments. This is because <code>b</code> can be <code>A1 -&gt; ... -&gt; An -&gt; T</code> making it possible to apply the function &quot;result of <code>f</code>&quot; to <code>n</code> additional arguments. For instance, <code>id :: b -&gt; b</code> allows <code>id (+) 3 4</code>. That being said, I regard &quot;<code>foldr</code> with &gt;3 arguments&quot; as a sort of antipattern, since IMO explicit recursion would be more clear. Above the <code>empty</code> argument is not always bound to the empty list, creating more confusion."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 5, "last_activity_date": 1555222722, "last_edit_date": 1555222722, "creation_date": 1555219841, "answer_id": 55672239, "question_id": 55672079, "link": "https://stackoverflow.com/questions/55672079/foldr-with-4-arguments/55672239#55672239", "title": "foldr with 4 arguments?", "body": "<p>Think of it this way. Every function accepts exactly one argument. It may return another function (that accepts one argument). The thing that looks like a multi-argument call</p>\n\n<pre><code>f a b c\n</code></pre>\n\n<p>is actually parsed as</p>\n\n<pre><code>((f a) b) c\n</code></pre>\n\n<p>that is, a chain of single-argument function applications. A function type</p>\n\n<pre><code>f :: a -&gt; b -&gt; c -&gt; d\n</code></pre>\n\n<p>can be decomposed to</p>\n\n<pre><code>f :: a -&gt; (b -&gt; (c -&gt; d))\n</code></pre>\n\n<p>i.e. a function returning a function returning a function. We usually regard it as a function of three arguments. But can it accept more than three? Yes, if <code>d</code> happens to be another function type. </p>\n\n<p>This is exactly what happens with your <code>fold</code> example. The function that you pass as the first argument to <code>foldr</code> accepts three arguments, which is exactly the same as accepting two arguments and returning another function. Now the (simplified) type of <code>foldr</code> is </p>\n\n<pre><code>(a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>but if you look at the first argument of it, you see it's a function of three arguments. Which is, as we have seen, exactly the same as a function that acceora two arguments and returns a function. So the <code>b</code> happens to be a function type. Since <code>b</code> is also the the return tuoe of <code>foldr</code> when applied to three arguments</p>\n\n<pre><code>foldr (\\x fId empty -&gt; fId (x : empty)) id\n</code></pre>\n\n<p>and it's a function, it can now be applied to another argument</p>\n\n<pre><code>(foldr (\\x fId empty -&gt; fId (x : empty)) id xs) []\n</code></pre>\n\n<p>I let you figure out what <code>b</code> actually is.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1555241518, "last_edit_date": 1555241518, "creation_date": 1555234541, "answer_id": 55673843, "question_id": 55672079, "link": "https://stackoverflow.com/questions/55672079/foldr-with-4-arguments/55673843#55673843", "title": "foldr with 4 arguments?", "body": "<p>First of all the variables naming is atrocious. I always use <code>r</code> for the second argument to a foldr's reducer function, as a mnemonic for the \"recursive result\". \"<code>empty</code>\" is too overloaded with meaning; it is better to use some neutral name so it is easier to see what it is without any preconceived notions:</p>\n\n<pre><code>myReverse :: [a] -&gt; [a]\nmyReverse xs = foldr (\\x r n -&gt; r (x : n)) id xs []\n</code></pre>\n\n<p>By virtue of foldr's definition,</p>\n\n<pre><code>foldr f z (x:xs)  ===  f x (foldr f z xs)\n</code></pre>\n\n<p>i.e.</p>\n\n<pre><code>myReverse [a,b,c,...,z]\n     = <b>foldr (\\x r n -> r (x : n)) id [a,b,c,...,z]</b> []\n     = (\\x r n -> r (x : n)) a <b>(foldr (\\x r n -> r (x : n)) id [b,c,...,z])</b> []\n     = (\\x r n -> r (x : n)) \n         a \n           <b>(foldr (\\x r n -> r (x : n)) id [b,c,...,z])</b>\n             []\n     = let { x = a\n           ; r = <b>foldr (\\x r n -> r (x : n)) id [b,c,...,z]</b>\n           ; n = []\n           }\n       in r (x : n)\n     = <b>foldr (\\x r n -> r (x : n)) id [b,c,...,z]</b> (a : [])\n     = <b>foldr (\\x r n -> r (x : n)) id [b,c,...,z]</b> [a]\n     = ....\n     = <b>foldr (\\x r n -> r (x : n)) id [c,...,z]</b> (b : [a])\n     = <b>foldr (\\x r n -> r (x : n)) id [c,...,z]</b> [b,a]\n     = ....\n     = <b>foldr (\\x r n -> r (x : n)) id []</b> [z,...,c,b,a]\n     = <b>id</b> [z,...,c,b,a]</code></pre>\n\n<p>I hope this illustration makes it clearer what is going on there. The extra argument is expected by the reducer function, which is pushed into action by <code>foldr</code> ... resulting in the operational equivalent of</p>\n\n<pre><code>     = foldl (\\n x -> (x : n)) [] [a,b,c,...,z]</code></pre>\n\n<p>As it turns out, <code>myReverse</code> implementation is using the equivalence</p>\n\n<pre><code>foldl (flip f) n xs  ===  foldr (\\x r -&gt; r . f x) id xs n\n</code></pre>\n"}], "owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 55672239, "answer_count": 2, "score": 2, "last_activity_date": 1555241518, "creation_date": 1555217763, "question_id": 55672079, "link": "https://stackoverflow.com/questions/55672079/foldr-with-4-arguments", "title": "foldr with 4 arguments?", "body": "<p>I am struggling to understand why this code taken from the <a href=\"https://wiki.haskell.org/99_questions/Solutions/5\" rel=\"nofollow noreferrer\">haskell.org exercise page</a>  typechecks (and works as a list reversal function):</p>\n\n<pre><code>myReverse :: [a] -&gt; [a]\nmyReverse xs = foldr (\\x fId empty -&gt; fId (x : empty)) id xs []\n</code></pre>\n\n<p>My first point of confusion is that foldr accepts 3 arguments, not 4 :</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>so I am guessing that <code>myReverse</code> is equivalent to:</p>\n\n<pre><code>myReverse xs = foldr ((\\x fId empty -&gt; fId (x : empty)) id) xs []\n</code></pre>\n\n<p>but then this should not work either since in the lambda, <code>x</code> is a list element rather than a function ...</p>\n"}, {"tags": ["haskell", "types", "type-signature"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1555217826, "post_id": 55672045, "comment_id": 98030095, "body": "<code>ScopedTypeVariables</code> is the thing to Google. I&#39;ll come back and add a proper answer when I&#39;m not on a phone, if someone else hasn&#39;t by then."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555235446, "post_id": 55672045, "comment_id": 98033309, "body": "or, you could just omit the type signature <code>someLogic :: [a] -&gt; [b]</code>, if you don&#39;t really need it. and in that simple code, you don&#39;t need it."}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555235550, "post_id": 55672045, "comment_id": 98033338, "body": "@WillNess, Yes, that is one way to go. But I have all warnings on, so it would annoy me."}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "closed_date": 1555224607, "answer_count": 0, "score": 0, "last_activity_date": 1555235380, "creation_date": 1555217306, "last_edit_date": 1555235380, "question_id": 55672045, "link": "https://stackoverflow.com/questions/55672045/how-to-specify-that-two-type-variables-are-the-same", "closed_reason": "Duplicate", "title": "How to specify that two type variables are the same?", "body": "<p>Say code like this:</p>\n\n<pre><code>fun :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfun f as = someLogic as\n  where someLogic :: [a] -&gt; [b]\n        someLogic xs = map f xs\n</code></pre>\n\n<p>The last line would be complained by compiler that type <code>a</code> for \"<code>f</code>\" is not the same as type <code>a</code> for \"<code>someLogic</code>\".</p>\n\n<p>So what could I do to let the compiler know that both types <code>a</code> are the same thing?</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "multiset", "bag"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555194672, "post_id": 55670409, "comment_id": 98027158, "body": "This is a typical case of a <code>fold</code>."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1555194842, "post_id": 55670409, "comment_id": 98027187, "body": "If you can rely on <code>Ord</code>, sorting them first is going to make for a cleaner implementation and also be more efficient than anything that can be done with <code>Eq</code> alone."}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555195164, "post_id": 55670409, "comment_id": 98027242, "body": "@WillemVanOnsem I&#39;ll take a look at fold really quick."}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1555195184, "post_id": 55670409, "comment_id": 98027249, "body": "@Ry Unfortunately, this is the function declaration that I have to use."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1555202618, "post_id": 55670409, "comment_id": 98028357, "body": "Hint: you don&#39;t want to insert <code>x</code> into an empty bag, you want to insert it into the bag that already has the contents of <code>xs</code> inside -- that is, the bag constructed by <code>multi xs</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 1, "last_activity_date": 1555266390, "creation_date": 1555266390, "answer_id": 55678601, "question_id": 55670409, "link": "https://stackoverflow.com/questions/55670409/haskell-multiset-bag-representation/55678601#55678601", "title": "Haskell: Multiset (Bag) Representation", "body": "<p>As you said, you've figured out the algorithm; you can translate it almost directly into Haskell:</p>\n\n<pre><code>-- So, my algorithm should be: take the list, say [1,2,3,4];\nmulti :: Eq a =&gt; [a] -&gt; Bag a\n-- go through each element in the list\nmulti [] = []\nmulti (x:xs) =\n  -- and for each of these elements, call add with the parameters being the current element\n  -- and the bag.\n  let returnedBag = add x theBag\n  -- For the next element, do the same - pass the element, with the bag that was returned \n  -- from the previous add call.\n  in doTheSame xs returnedBag\n</code></pre>\n\n<p>Of course, this doesn't quite work, because two definitions are missing: what is <code>doTheSame</code>, and what is <code>theBag</code>? Well, we'd want <code>doTheSame</code> to mean everything in the body of <code>multi</code> right now, but notice that we want to pass two arguments to <code>doTheSame</code> instead of the one that <code>multi</code> takes. So let's try making <code>doTheSame</code> its own function:</p>\n\n<pre><code>-- So, my algorithm should be: take the list, say [1,2,3,4];\nmulti :: Eq a =&gt; [a] -&gt; Bag a\n-- go through each element in the list\nmulti elts = doTheSame elts ???\n  where\n  doTheSame [] theBag = ???\n  doTheSame (x:xs) theBag =\n    -- and for each of these elements, call add with the parameters being the current element\n    -- and the bag.\n    let returnedBag = add x theBag\n    -- For the next element, do the same - pass the element, with the bag that was returned \n    -- from the previous add call.\n    in doTheSame xs returnedBag\n</code></pre>\n\n<p>This solves what <code>theBag</code> is\u2014it's just whatever's passed to <code>doTheSame</code>. But now we have some <code>???</code> placeholders in there which need to be filled with something. What should <code>multi</code> do when it's done processing elements? Return the bag it has been building, no doubt:</p>\n\n<pre><code>-- So, my algorithm should be: take the list, say [1,2,3,4];\nmulti :: Eq a =&gt; [a] -&gt; Bag a\n-- go through each element in the list\nmulti elts = doTheSame elts ???\n  where\n  doTheSame [] theBag = theBag\n  doTheSame (x:xs) theBag =\n    -- and for each of these elements, call add with the parameters being the current element\n    -- and the bag.\n    let returnedBag = add x theBag\n    -- For the next element, do the same - pass the element, with the bag that was returned \n    -- from the previous add call.\n    in doTheSame xs returnedBag\n</code></pre>\n\n<p>And what about the <code>???</code> first given to <code>doTheSame</code>? That must be the bag that you start with\u2014presumably, an empty bag. (You'll need to define what that is for yourself.)</p>\n\n<pre><code>-- So, my algorithm should be: take the list, say [1,2,3,4];\nmulti :: Eq a =&gt; [a] -&gt; Bag a\n-- go through each element in the list\nmulti elts = doTheSame elts emptyBag\n  where\n  doTheSame [] theBag = theBag\n  doTheSame (x:xs) theBag =\n    -- and for each of these elements, call add with the parameters being the current element\n    -- and the bag.\n    let returnedBag = add x theBag\n    -- For the next element, do the same - pass the element, with the bag that was returned \n    -- from the previous add call.\n    in doTheSame xs returnedBag\n</code></pre>\n\n<p>This code works, assuming you have a definition of <code>add</code> and <code>emptyBag</code>! But you might want to tidy it up a little. A more experienced Haskell programmer would probably use some shorter names, and bring <code>returnedBag</code> inline:</p>\n\n<pre><code>-- So, my algorithm should be: take the list, say [1,2,3,4]; go through each element in the\n-- list - and for each of these elements, call add with the parameters being the current\n-- element and the bag. For the next element, do the same - pass the element, with the bag\n-- that was returned from the previous add call.\nmulti :: Eq a =&gt; [a] -&gt; Bag a\nmulti elts = go elts emptyBag\n  where go [] bag = bag\n        go (x:xs) bag = go xs (add x bag)\n</code></pre>\n\n<p>This code is exactly the same as the previous\u2014the only reason to prefer one over the other is whether you find one easier to read. (Never underestimate the importance of being able to read your own code, and never <em>overestimate</em> your ability to do so after some time has passed and it's no longer fresh in your mind!)</p>\n\n<hr>\n\n<p>Extra credit:</p>\n\n<p>This kind of recursion is very common in functional languages in general, and is typically called a <em>fold</em>. A fold starts with some data (in this case, an empty bag), walks over a list or list-like structure, and for each element in that structure, uses a function (in this case, add) to combine the data with the element to make new data, which is used on the next element, and so on, returning the final value of the data (in this case, a bag with all your elements). Since this is a common pattern, in Haskell, there is a function called <code>foldl</code> (for <em>left fold</em>, since you're processing your list elements starting from the left) that takes just a combining function, an initial value, and a list, and does all the rest of the work for you:</p>\n\n<pre><code>multi :: Eq a =&gt; [a] -&gt; Bag a\nmulti elts = foldl (\\bag x -&gt; add x bag) emptyBag elts\n</code></pre>\n\n<p>While you're still learning about recursion and the basics of Haskell, I wouldn't try too hard to write code in the style of that last version of <code>multi</code>. But once you've done the <code>where go</code> trick a few times and have gotten sick of writing all that out every time, go look up <code>foldl</code> and <code>foldr</code> and take the next step!</p>\n"}], "owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 55678601, "answer_count": 1, "score": 0, "last_activity_date": 1555266390, "creation_date": 1555194597, "question_id": 55670409, "link": "https://stackoverflow.com/questions/55670409/haskell-multiset-bag-representation", "title": "Haskell: Multiset (Bag) Representation", "body": "<p>Currently, I am working on trying to take a list of integers (Int), and put them into a multiset representation. For a little background, the representation would look like this:</p>\n\n<pre><code>*user passes in a list:* [1,2,3,4]\n*multiset representation:* [(1,1),(2,1),(3,1),(4,1)]\n</code></pre>\n\n<p>I have written two functions: <em>add</em> and <em>del</em>. <em>add</em> takes an integer and a bag, and inserts the integer into the bag. It checks for duplicates - if there are, it simply increments the counter (second element of coordinate in bag) by 1. It then returns that bag.</p>\n\n<p>So, my algorithm should be: take the list, say [1,2,3,4]; go through each element in the list - and for each of these elements, call <em>add</em> with the parameters being the current element and the bag. For the next element, do the same - pass the element, with the bag that was returned from the previous <em>add</em> call.</p>\n\n<p>Here's what I'm shaky on: how would I actually code this? I've put my (not so good) attempt down below. I've figured out the algorithm completely, but am unsure of how to execute this. Any tips in the right direction would be great.</p>\n\n<pre><code>multi :: Eq a =&gt; [a] -&gt; Bag a\nmulti [] = []\nmulti (x:xs) = ins x []\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1555190872, "post_id": 55669976, "comment_id": 98026286, "body": "You need an extra pair of parentheses around the pattern: <code>(\\(f1:f2:f3:f4:f5:f6:f7:f8:f9:[_]) -&gt; Record f1 f2 f3 f4 f5 f6 f7 f8 f9)</code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 7, "creation_date": 1555190936, "post_id": 55669976, "comment_id": 98026308, "body": "The <code>[_]</code> is also wrong, you want just <code>_</code>. <code>[_]</code> is a pattern matching a list with exactly one element in it."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1555191246, "post_id": 55669976, "comment_id": 98026381, "body": "Are you sure you want a custom data type with 9 fields, all of the same type? This is going to get very cumbersome very quickly (it&#39;s pretty painful just seeing the brief code in your question). I don&#39;t know the use case, but I would strongly advise, at the very least, using record syntax if each piece of data has some simple characterisation."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555191378, "post_id": 55669976, "comment_id": 98026415, "body": "@RobinZigmond no.  My next step is to change this and use smart constructors, but need to crawl before I can run. Couldn&#39;t do much at all before I could pattern match and have it compile."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1555191662, "post_id": 55669976, "comment_id": 98026486, "body": "I appreciate the help everybody, but it really isn&#39;t easy to learn this stuff.  Answers are often varying degrees of venomous RTFM and &quot;closed-duplicate.&quot;  I&#39;ve read the books, but need practice, and asking for help on the internet takes some thick skin.  As you can see, the compiler wasn&#39;t super helpful here, but I appreciate you all helped me find the error.  It saved me maybe half a day of not understanding the bug and not having much to go on."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1555191929, "post_id": 55669976, "comment_id": 98026568, "body": "Also, even with @duplode spelling it out for me, my initial error reading that was <code>parseRecords = map ((\\f1:f2:.. ) -&gt;</code>   rather than <code>parseRecords = map (\\(f1:f2:.. ) -&gt; </code> Note to be careful on what is being <code>\\lamba</code>&#39;d for anyone else reading this in the future."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1555233076, "last_edit_date": 1555233076, "creation_date": 1555230202, "answer_id": 55673334, "question_id": 55669976, "link": "https://stackoverflow.com/questions/55669976/why-is-this-lambda-function-a-parse-error-with-pattern-matching-and-cons-operato/55673334#55673334", "title": "Why is this lambda function a parse error with pattern matching and cons operator?", "body": "<p>Just like you need parentheses around patterns in function bindings,</p>\n\n<pre><code>f <b>(</b>x:xs<b>)</b> = ...</code></pre>\n\n<p>you need parentheses around patterns in lambdas:</p>\n\n<pre><code>parseRecords = map (\\ <b>(</b>f1:f2:f3:f4:f5:f6:f7:f8:f9:_<b>)</b> -> Record f1 f2 f3 f4 f5 f6 f7 f8 f9)\n                      -------pattern----------------\n                   ------------------lambda function--------------------------------------</code></pre>\n\n<p>Sometimes parentheses can be omitted, but not always. The list patterns are:</p>\n\n<pre><code><b>[]</b>           matches     []\n<b>(</b>x:xs<b>)</b>       matches     [x, ...]      so that   (x:xs)   == [x]   ++ xs\n<b>(</b>x:y:xs<b>)</b>     matches     [x, y, ...]   so that   (x:y:xs) == [x]   ++ (y:xs)\n                                                          == [x,y] ++ xs\n..... and so on ......\n</code></pre>\n\n<p>This is because <code>:</code> associates to the right, so <code>(x:y:xs)</code> is actually <code>(x:(y:xs))</code>. </p>\n\n<p>Lastly, <code>_</code> is a wildcard. It is like a variable pattern like <code>x</code> or <code>y</code> or <code>xs</code>, but without a name. Each <code>_</code> is different from another, as if it was named with a unique, though missing, name.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 55673334, "answer_count": 1, "score": 3, "last_activity_date": 1555233076, "creation_date": 1555190386, "question_id": 55669976, "link": "https://stackoverflow.com/questions/55669976/why-is-this-lambda-function-a-parse-error-with-pattern-matching-and-cons-operato", "title": "Why is this lambda function a parse error with pattern matching and cons operator?", "body": "<p>I am trying to parse a record from a lists of lists (continuing from <a href=\"https://stackoverflow.com/questions/55643003/from-a-list-of-lists-to-a-list-of-data-records\">this question</a>).</p>\n\n<p>Here's my record</p>\n\n<pre><code>data Record = Record Text Text Text Text Text Text Text Text Text deriving (Show, Generic)\n</code></pre>\n\n<p>This syntax works:</p>\n\n<pre><code>parseRecords :: [[Text]] -&gt; [Record]\nparseRecords = map (\\[f1,f2,f3,f4,f5,f6,f7,f8,f9,_] -&gt; Record f1 f2 f3 f4 f5 f6 f7 f8 f9)\n</code></pre>\n\n<p>This syntax checks, but has me fixed at 10 parameters.  I would rather be able to have more than that and ignore the ones greater by pattern matching them into a [_] list I will not pass along.  I tried the following:</p>\n\n<pre><code>parseRecords = map (\\f1:f2:f3:f4:f5:f6:f7:f8:f9:[_] -&gt; Record f1 f2 f3 f4 f5 f6 f7 f8 f9)\n</code></pre>\n\n<p>This, however, fails with:</p>\n\n<pre><code>Parse error (line 27, column 24): parse error on input \u2018:\u2019\n</code></pre>\n\n<p>I could have sworn I saw this kind of pattern matching used in lambdas before.  What am I missing that my colon operators are a parse error?  It is hard to interrogate what's going wrong.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1555187189, "post_id": 55669547, "comment_id": 98025350, "body": "It filters the list such that only even numbers are retained."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1555187594, "creation_date": 1555187594, "answer_id": 55669626, "question_id": 55669547, "link": "https://stackoverflow.com/questions/55669547/i-dont-see-what-does-even-in-the-piece-of-code-do/55669626#55669626", "title": "I don&#39;t see what does &quot;even&quot; in the piece of code do?", "body": "<p>A Haskell list comprehension expression has three types of elements at the right side of the list comprehension:</p>\n\n<ol>\n<li><em>generators</em>, of the form <code>var &lt;- list-expr</code>;</li>\n<li><em>filters</em> of the form <code>bool-expr</code>; and</li>\n<li><em>local definitions</em> of the form <code>let var = expr</code>.</li>\n</ol>\n\n<p>The <code>even x</code> part is thus a <em>filter</em>. It means that only if the filter is satisfied, so <code>even x</code> results in <code>True</code>, that element is a candidate for the rest of the list comprehension and thus eventually result in a branch of elements added to the list.</p>\n\n<p>So here the expression thus has two components:</p>\n\n<pre><code>[x | x &lt;- xs, even x ]\n--   \\__ __/  \\__ _/\n--      v        v\n--  generator  filter\n</code></pre>\n\n<p>we thus iterate over the elements in <code>xs</code> and then for each element check if that element is <code>even</code>, if it is, we add <code>x</code> to the result.</p>\n\n<p>The above can however be written as just:</p>\n\n<pre><code>filter even xs\n</code></pre>\n\n<p>which basically describe what we do here: we filter a list <code>xs</code> such that the result is a list that only contains the elements of <code>xs</code> that are even.</p>\n"}], "owner": {"reputation": 35, "user_id": 9636252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-se2aT8NeoNw/AAAAAAAAAAI/AAAAAAAAABI/EMsRhEk5SlI/photo.jpg?sz=128", "display_name": "Fengxiang Hu", "link": "https://stackoverflow.com/users/9636252/fengxiang-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555188274, "creation_date": 1555187044, "last_edit_date": 1555188274, "question_id": 55669547, "link": "https://stackoverflow.com/questions/55669547/i-dont-see-what-does-even-in-the-piece-of-code-do", "title": "I don&#39;t see what does &quot;even&quot; in the piece of code do?", "body": "<pre><code>ghci&gt; let xxs=[[1,3,5,2,3,1,2,4,5],[1,2,3,4,5,6,7,8,9],[1,2,4,2,1,6,3,1,3,2,3,6]] \nghci&gt; [[x|x&lt;-   xs,even x]|xs&lt;- xxs]\n[[2,2,4],[2,4,6,8],[2,4,2,6,2,6]]\n</code></pre>\n\n<p>This piece of code relates to list comprehension. But i don't see how the program goes with \"even\"</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1555185510, "post_id": 55669233, "comment_id": 98024922, "body": "You probably want something like <code>Data.Array.Array Int SomeTypeHere</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1555185588, "post_id": 55669233, "comment_id": 98024943, "body": "<code>Data.Array.Ix</code> is a class, not a type"}], "answers": [{"tags": [], "owner": {"reputation": 286, "user_id": 9214910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22383025a510d1498c6cb790c140763?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Metcalf", "link": "https://stackoverflow.com/users/9214910/leif-metcalf"}, "is_accepted": false, "score": 1, "last_activity_date": 1555186507, "last_edit_date": 1555186507, "creation_date": 1555186106, "answer_id": 55669420, "question_id": 55669233, "link": "https://stackoverflow.com/questions/55669233/haskell-looking-to-add-array-field-in-data-structure/55669420#55669420", "title": "Haskell: Looking to add array field in data structure", "body": "<p><code>Data.Array.Ix</code> is not a type, but rather a class of types which can be used as an index for an array (like <code>Int</code>).</p>\n\n<p>You may want to use either <code>Array</code> from <code>Data.Array.IArray</code> (For immutable arrays), or <code>IOArray</code> / <code>STArray</code> from <code>Data.Array.IO</code> or <code>Data.Array.ST</code> (For mutable arrays). Something like this would work:</p>\n\n<pre><code>import Data.Array.IArray\n\ntype SomeType = String\n\ndata Level = Level\n  { a :: Data.Array Int SomeType\n  } deriving (Show, Eq, Ord)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1555186685, "creation_date": 1555186685, "answer_id": 55669490, "question_id": 55669233, "link": "https://stackoverflow.com/questions/55669233/haskell-looking-to-add-array-field-in-data-structure/55669490#55669490", "title": "Haskell: Looking to add array field in data structure", "body": "<p><code>Ix</code> is not a type, but a typeclass that the <code>Data.Array</code> functions use to provide indexing of different shapes of array. If you want an array itself, you need to use the <code>Array</code> type. It has two type parameters: the type of indices into the array, such as <code>Int</code> (for a 1D array) or <code>(Int, Int)</code> (for a 2D array), and the type of elements.</p>\n\n<p>So for example, a 1D array of characters would have the type <code>Array Int Char</code>; you can create arrays using functions like <code>array</code>, <code>listArray</code>, or <code>accumArray</code>, e.g. in GHCi:</p>\n\n<pre><code>-- A 5-element array of characters\n&gt; example1 = listArray (0, 4) \"abcde\"\n\n&gt; example1 ! 2\n'c'\n\n-- A 3-element array of strings\n&gt; example2 = array (0, 2) [(0, \"this\"), (1, \"that\"), (2, \"other\")] :: Array Int String\n\n&gt; example2 ! 2\n\"other\"\n\n&gt; example2 ! 3\n*** Exception: Ix{Int}.index: Index (3) out of range ((0,2))\n</code></pre>\n\n<p>A 2D array of integers would have the type <code>Array (Int, Int) Int</code>:</p>\n\n<pre><code>-- A 3x3 matrix of numbers\n&gt; example3 = listArray ((0, 0), (2, 2)) [1..9]\n\n&gt; example3\narray ((0,0),(2,2)) [((0,0),1),((0,1),2),((0,2),3),((1,0),4),((1,1),5),((1,2),6),((2,0),7),((2,1),8),((2,2),9)]\n\n&gt; elems example3\n[1,2,3,4,5,6,7,8,9]\n\n&gt; bounds example3\n((0,0),(2,2))\n\n&gt; example3 ! (1, 2)\n6\n</code></pre>\n\n<p>So for instance if you wanted to represent a Tic-Tac-Toe board, you might use something along the lines of:</p>\n\n<pre><code>import Data.Array\n\ndata Board = Board\n    { boardCells :: Array (Int, Int) Move\n    } deriving (Show, Eq, Ord)\n\ndata Move = Empty | X | O\n</code></pre>\n\n<p>Which types you use depend on the actual problem you\u2019re solving, of course.</p>\n"}], "owner": {"reputation": 35, "user_id": 11355899, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CSjma9U_d88/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DWp_YTCLzhRz2zjqVHFLjHd50HZTw/mo/photo.jpg?sz=128", "display_name": "Cruceru Vlad", "link": "https://stackoverflow.com/users/11355899/cruceru-vlad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 55669490, "answer_count": 2, "score": 1, "last_activity_date": 1555186685, "creation_date": 1555184666, "question_id": 55669233, "link": "https://stackoverflow.com/questions/55669233/haskell-looking-to-add-array-field-in-data-structure", "title": "Haskell: Looking to add array field in data structure", "body": "<p>I'm new to Haskell.\nI want to add an array field to my data structure, something like this:</p>\n\n<pre><code>data Level = Level\n    { a :: Data.Array.Ix\n    } deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>But I don't know how to declare the field's type. It keeps giving me errors.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3869, "user_id": 1009546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63ef706ed0517098e827bf5da5d64dfb?s=128&d=identicon&r=PG", "display_name": "battlmonstr", "link": "https://stackoverflow.com/users/1009546/battlmonstr"}, "edited": false, "score": 0, "creation_date": 1555158407, "post_id": 55665043, "comment_id": 98017543, "body": "What is the meaning of <code>(i,j):f</code> ? I feel that if you demangled your code into separate functions, it would be easer to understand, test and debug. I&#39;d try to define a separate function for &quot;f&quot;, and a separate function for the generator step inside f. The problem might be that you are referring to &quot;v&quot; inside the definition of &quot;v&quot;, which makes a loop. Actually you don&#39;t need &quot;A[i]&quot; as an array to solve the problem, because you only need 2 top values A[i] and A[j] and i/j are always going forward."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 3869, "user_id": 1009546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63ef706ed0517098e827bf5da5d64dfb?s=128&d=identicon&r=PG", "display_name": "battlmonstr", "link": "https://stackoverflow.com/users/1009546/battlmonstr"}, "edited": false, "score": 0, "creation_date": 1555158696, "post_id": 55665043, "comment_id": 98017618, "body": "If you change it all into a list instead of array, then the code works. I think the recursive definition isn&#39;t playing well with the array-ness somehow. I also agree with @battlmonstr that this is a slightly messy implementation."}, {"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1555160667, "post_id": 55665043, "comment_id": 98018195, "body": "@ATayler If I use list instead of array then I&#39;ll have to use <code>++</code> function to append the new item at the end of the list. Keeping the list in reverse to get rid of <code>++</code> will make going forward infeasible."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1555161511, "post_id": 55665043, "comment_id": 98018432, "body": "@Kakaji that didn&#39;t seem to be the case, I modified it to get rid of arrays without needing <code>(++)</code> anywhere, not sure what you did."}], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1555161724, "post_id": 55665657, "comment_id": 98018490, "body": "Thank you! I did not know about this <code>~</code> pattern matching. Did a reading on the same."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 1, "creation_date": 1555162253, "post_id": 55665657, "comment_id": 98018654, "body": "@Kakaji You could avoid lazy patterns and use <code>head</code> and <code>tail</code> instead. Usually they are a bad idea, but here we can&#39;t really avoid some &quot;partial&quot; code. Also note that <code>arrayListLazy</code> has to assume that the input list is long enough to cover all the indices between the bounds."}, {"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 1, "creation_date": 1555163087, "post_id": 55665657, "comment_id": 98018883, "body": "I just checked that using <code>head</code> and <code>tail</code> can be used to get rid of lazy pattern matching as you said. Adding my own versions of <code>head</code> and <code>tail</code> without using lazy pattern matching in their implementations also does the trick. Do you know why delegating pattern matching to separate functions &quot;simulates&quot; lazy pattern matching?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1555165010, "post_id": 55665657, "comment_id": 98019399, "body": "@Kakaji Matching against a constructor like <code>:</code> in <code>(e:ys)</code> forces the argument to be evaluated at that time. Matching against a variable <code>xs</code> does not evaluate anything, and <code>tail xs</code> will only force <code>xs</code> when it&#39;s actually needed (like lazy pattern matching)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1555159880, "creation_date": 1555159880, "answer_id": 55665657, "question_id": 55665043, "link": "https://stackoverflow.com/questions/55665043/array-indexing-triggers-repeated-evaluation-of-the-element/55665657#55665657", "title": "Array indexing triggers repeated evaluation of the element?", "body": "<p>The issue is that <code>arrayList</code> forces all the spine of the list too early, before the array is actually built. That makes the recursion loop forever.</p>\n\n<p>We can, however, fix that using a helper function as follows.</p>\n\n<pre><code>-- A spine-lazy version of arrayList\narrayListLazy :: (Int, Int) -&gt; [a] -&gt; A.Array Int a\narrayListLazy (lo,hi) xs = A.array (lo,hi) $ go lo xs\n   where\n   go i _ | i &gt; hi = []\n   go i ~(e:ys) = (i, e) : go (succ i) ys\n\nfirstK :: Int -&gt; [(Int,Int)]\nfirstK k = A.elems v where \n    v = arrayListLazy (0,k-1) $ (0,0):f 1 0 0\n    f c i j \n        | c == k = [] \n        | otherwise = traceShow (c,i,j) $\n            let (ix,iy) = v A.! i \n                (jx,jy) = v A.! j \n                iv      = compute (ix+1) iy \n                jv      = compute jx (jy+1)\n            in  if iv &lt; jv \n                    then (ix+1,iy):f (c+1) (i+1) j \n                else if iv &gt; jv \n                    then (jx,jy+1):f (c+1) i (j+1)\n                    else (ix+1,iy):f (c+1) (i+1) (j+1)\n</code></pre>\n\n<p>Small test:</p>\n\n<pre><code>&gt; firstK 10\n[(0,0),(1,0),(0,1),(2,0),(1,1),(0,2),(3,0),(2,1),(1,2),(4,0)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1555162414, "post_id": 55665931, "comment_id": 98018698, "body": "Thank you for sharing your snippet and introducing me to <code>unfoldr</code> and <code>uncurry</code> functions. I agree that pattern matching looks prettier than if/else branches. Please correct me if I am wrong but it appears to me that <code>!!</code> has a time complexity of O(n) making the overall complexity O(k^2). I was looking for an O(k) solution."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 1, "creation_date": 1555163679, "post_id": 55665931, "comment_id": 98019040, "body": "Yup, there is that :( I&#39;ll make that clear in the answer."}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 1, "last_activity_date": 1555163697, "last_edit_date": 1555163697, "creation_date": 1555161710, "answer_id": 55665931, "question_id": 55665043, "link": "https://stackoverflow.com/questions/55665043/array-indexing-triggers-repeated-evaluation-of-the-element/55665931#55665931", "title": "Array indexing triggers repeated evaluation of the element?", "body": "<p>An alternative approach using the same idea,</p>\n\n<pre><code>firstK k = take k $ l\n  where l = (0,0) : unfoldr (\\(i,j) -&gt; Just $ case compare (uncurry compute $ first (1+) $ l!!i) (uncurry compute $ second (1+) $ l!!j) of\n          LT -&gt; (first (1+) $ l!!i, (i+1,j))\n          EQ -&gt; (first (1+) $ l!!i, (i+1,j+1))\n          GT -&gt; (second (1+) $ l!!j, (i,j+1))) (0,0)\n</code></pre>\n\n<p>Not especially tidy, but you can see where it's going In particular, the pattern matching <code>case compare _ _ of ...</code> is imo better than <code>if a &gt; b else if a &lt; b else ..</code>.</p>\n\n<p>EDIT: Albeit worse time-complexity.</p>\n"}, {"comments": [{"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1555192583, "post_id": 55667824, "comment_id": 98026704, "body": "Very beautiful! Thank you for this!!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1555175521, "last_edit_date": 1555175521, "creation_date": 1555174466, "answer_id": 55667824, "question_id": 55665043, "link": "https://stackoverflow.com/questions/55665043/array-indexing-triggers-repeated-evaluation-of-the-element/55667824#55667824", "title": "Array indexing triggers repeated evaluation of the element?", "body": "<p>chi's answer discusses in detail the exact problem with your code, and the fix that would let you keep your implementation idea but get the answer you're hoping for. But I think it's also interesting to see how a native Haskell speaker would approach the same algorithm: I'm going to just use native lists, and instead of a pointer into an array I'll use the list's pointers themselves to track where we are. It looks like this:</p>\n\n<pre><code>vs :: [(Int,Int)]\nvs = (0,0) : merge [(a+1, b) | (a, b) &lt;- vs] [(a, b+1) | (a, b) &lt;- vs] where\n    compute (a,b) = fromIntegral a + fromIntegral b * sqrt 2\n    merge xs@(xh:xt) ys@(yh:yt) = case compare (compute xh) (compute yh) of\n        LT -&gt; xh:merge xt ys\n        EQ -&gt; xh:merge xt yt\n        GT -&gt; yh:merge xs yt\n</code></pre>\n\n<p>In the recursive call to <code>merge</code>, using <code>xt</code> (instead of <code>xs</code>) is akin to incrementing your <code>i</code> pointer; using <code>yt</code> (instead of <code>ys</code>) is akin to incrementing your <code>j</code> pointer.</p>\n\n<p>One nice thing about <code>vs</code> is that you don't have to declare ahead of time how many pairs you want -- you just get a lazy infinite list of them (up to rounding issues with using <code>Double</code> for <code>compute</code> of course!). The code is also significantly shorter. Here's an example run in ghci:</p>\n\n<pre><code>&gt; take 10 vs\n[(0,0),(1,0),(0,1),(2,0),(1,1),(0,2),(3,0),(2,1),(1,2),(4,0)]\n</code></pre>\n"}], "owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 55665657, "answer_count": 3, "score": 3, "last_activity_date": 1555175521, "creation_date": 1555155685, "last_edit_date": 1555156312, "question_id": 55665043, "link": "https://stackoverflow.com/questions/55665043/array-indexing-triggers-repeated-evaluation-of-the-element", "title": "Array indexing triggers repeated evaluation of the element?", "body": "<p>I am writing a program to generate first k numbers of the form </p>\n\n<p><a href=\"https://i.stack.imgur.com/Nb4GD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Nb4GD.png\" alt=\"enter image description here\"></a>,</p>\n\n<p>where <em>a</em> and <em>b</em> are non-negative integers. </p>\n\n<p>The algorithm I am using exploits the fact that every number in this series is generated from adding either 1 or sqrt(2) to a previous number in the series, with the series starting at 0. We'll collect the numbers in the series in an array where each element is expected to be evaluated lazily on demand. The first number in the series is 0 so we'll initialize the first element of the array with 0. We'll maintain two pointers <em>i</em> and <em>j</em> both starting at index 0 (first number in the series). The next number in the series is <em>min(A[i]+1, A[j]+sqrt(2))</em>. If the next number in the series comes from pointer <em>i</em> then pointer <em>i</em> will be incremented (as we never want to add \n1 to A[i] again) and similarly if the next number in the series comes from pointer <em>j</em> then <em>j</em> will be incremented to point to next index i.e <em>j+1</em>. Both <em>i</em> and <em>j</em> will be incremented if <em>A[i] + 1 = A[j] + sqrt(2)</em>. </p>\n\n<p>I think the snippet below captures the above algorithm, however, upon running the code in ghci, it looks like function <code>f</code> is being called repeatedly with parameters 1 0 0 and the program never finishes. I don't understand how this call is being made although it seems like the call is being triggered by <code>v A.! i</code>. </p>\n\n<pre><code>import qualified Data.Array as A \nimport Debug.Trace \n\ncompute :: Int -&gt; Int -&gt; Double\ncompute x y = (fromIntegral x) + (fromIntegral y) * (sqrt 2)\n\nfirstK :: Int -&gt; [(Int,Int)]\nfirstK k = A.elems v where \n    v = A.listArray (0,k-1) $ (0,0):f 1 0 0\n    f c i j \n        | c == k = [] \n        | otherwise = traceShow (c,i,j) $\n            let (ix,iy) = v A.! i \n                (jx,jy) = v A.! j \n                iv      = compute (ix+1) iy \n                jv      = compute jx (jy+1)\n            in  if iv &lt; jv \n                    then (ix+1,iy):f (c+1) (i+1) j \n                else if iv &gt; jv \n                    then (jx,jy+1):f (c+1) i (j+1)\n                    else (ix+1,iy):f (c+1) (i+1) (j+1)\n</code></pre>\n\n<p>Output - </p>\n\n<pre><code>\u03bb&gt; firstK 50\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n(1,0,0)\n...\n...\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1555140379, "post_id": 55662840, "comment_id": 98013644, "body": "Have you tried <code>rDeepSeq</code> instead of <code>rSeq</code>? Isn&#39;t your sorting definition just a baseless recursion?"}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1555140441, "post_id": 55662840, "comment_id": 98013657, "body": "Oh, why am I so stupid.... Let me fix the sort first."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 2, "creation_date": 1555146956, "post_id": 55662840, "comment_id": 98014972, "body": "was all it took changing to <code>rDeepSeq</code>? Perhaps you can post the complete and working code as an answer, just for posterity&#39;s sake :)"}], "answers": [{"tags": [], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "is_accepted": false, "score": 4, "last_activity_date": 1555147357, "creation_date": 1555147357, "answer_id": 55663936, "question_id": 55662840, "link": "https://stackoverflow.com/questions/55662840/please-help-understanding-haskell-parallel/55663936#55663936", "title": "Please help understanding Haskell Parallel", "body": "<p>Following @ATayler 's suggestion, I did following changes.</p>\n\n<ol>\n<li>Enable <code>DeriveGeneric</code></li>\n<li>Import <code>GHC.Generics</code></li>\n<li>Derive <code>Generic</code> for all my types.</li>\n<li>Make functions I need:</li>\n</ol>\n\n<pre><code>parMap :: (NFData b) =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\nparMap f = withStrategy (parList rdeepseq). map f\nparFilter :: (NFData a) =&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]\nparFilter f = withStrategy (parList rdeepseq) . filter f\nparZipWith :: (NFData c) =&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nparZipWith f as = withStrategy (parList rdeepseq). zipWith f as\nparSortBy :: (NFData a) =&gt; (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nparSortBy f = withStrategy (parList rdeepseq) . sortBy f\n</code></pre>\n\n<ol start=\"5\">\n<li>Call them when appropriate.</li>\n</ol>\n\n<p>Now the time cut to 1/3 of the original single threaded one, with full CPU used. Not sure if there can be other major optimizing.</p>\n"}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555147357, "creation_date": 1555138093, "last_edit_date": 1555140516, "question_id": 55662840, "link": "https://stackoverflow.com/questions/55662840/please-help-understanding-haskell-parallel", "title": "Please help understanding Haskell Parallel", "body": "<p>I have read some docs, using fibonacci as example. Then I started trying to parallelise my code mostly working with list. My code did not get any faster.</p>\n\n<p>Sample code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parMap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nparMap f = withStrategy (parList rseq) . map f\n\nparZipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nparZipWith f as = withStrategy (parList rseq) . zipWith f as\n\nmain = do\n  let rips = parMap parseIPRange [] -- huge list of items like \"192.168.3.1/24\"\n      result = parZipWith checkSubnets rips (tail rips ++ [IPRange 0 0])\n  print result\n</code></pre>\n\n<p>I think I must have misunderstood the whole thing.</p>\n\n<p>PS: The whole thing is a migrating of <a href=\"https://github.com/magicloud/ip_helper\" rel=\"nofollow noreferrer\">https://github.com/magicloud/ip_helper</a>, which is Rust with Rayon.</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 7, "last_activity_date": 1555134351, "creation_date": 1555134351, "answer_id": 55662437, "question_id": 55662192, "link": "https://stackoverflow.com/questions/55662192/building-a-list-of-all-branches-in-a-tree/55662437#55662437", "title": "Building a list of all branches in a tree", "body": "<p>We'll use a recursive approach. Let's start with a rough skeleton:</p>\n\n<pre><code>everyBranch :: Tree a -&gt; [[a]]\neveryBranch EmptyT = _something\neveryBranch (NodeT v (Tree l) (Tree r)) = _somethingElse\n</code></pre>\n\n<p>Now we'll fill in the holes. (This syntax is known as 'typed holes': if you run the above program through GHC, it will give you an error message with the type of the value which should be in the hole.) Now, I'm not sure about the first case: depending on your need, it could be <code>[]</code> (no branches) or <code>[[]]</code> (one branch with no elements), so we'll come back to this later. For the second case, we need a way to construct a list of branches given the <code>v</code>alue and the <code>l</code>eft and <code>r</code>ight subtrees. How do we do that? We'll recursively find every branch in the <code>l</code>eft tree, and every branch in the <code>r</code>ight tree, and then we'll prepend <code>v</code> to both:</p>\n\n<pre><code>everyBranch :: Tree a -&gt; [[a]]\neveryBranch EmptyT = _something\neveryBranch (NodeT v l r) = map (v:) $ everyBranch l ++ everyBranch r\n</code></pre>\n\n<p>Now, let's go back to <code>EmptyT</code>. Consider a very simple tree: <code>NodeT 1 EmptyT EmptyT</code>. In this case, <code>everyBranch</code> should return <code>[[1]]</code>. Let's invoke <code>everyBranch</code> 'by hand' on this tree:</p>\n\n<p>(I use <code>\u2514\u2192</code> to mean 'evaluate sub-expression recursively', and <code>=&gt;</code> meaning 'expression evaluates to')</p>\n\n<pre><code>everyBranch (NodeT 1 EmptyT EmptyT)\n=&gt; map (1:) $ everyBranch EmptyT ++ everyBranch EmptyT\n   \u2514\u2192 everyBranch EmptyT\n      =&gt; _something\n=&gt; map (1:) $ _something ++ _something\n</code></pre>\n\n<p>So here, we want <code>map (1:) $ _something ++ _something</code> to be equal to <code>[[1]]</code>. What is <code>_something</code>? Well, it turns out that if <code>_something</code> is <code>[]</code>, then <code>map (1:) $ [] ++ []</code> is <code>[]</code>, which isn't what we want. On the other hand, if <code>_something</code> is <code>[[]]</code>, then <code>map (1:) $ [[]] ++ [[]]</code> is <code>[[1], [1]]</code> - which isn't what we want either. It looks like we need a slightly different approach. What we'll do is, we'll add another case specifically for these sort of trees:</p>\n\n<pre><code>everyBranch :: Tree a -&gt; [[a]]\neveryBranch EmptyT = _something\neveryBranch (NodeT v EmptyT EmptyT) = [[v]]\neveryBranch (NodeT v l r) = map (v:) $ everyBranch l ++ everyBranch r\n</code></pre>\n\n<p>Now, if we test this a bit (albeit using some random value for <code>_something</code> to stop it from giving us errors), we find that it works for all binary trees. As mentioned though, we still need to figure out that <code>_something</code> value. This value will only matter in two cases: empty trees (in which case it will trivially match <code>EmptyT</code>), and trees with only one subtree (in which case either <code>l</code> or <code>r</code> will match <code>EmptyT</code>). I will leave it as an exercise for you to determine what value to put there, how it will affect the result, and why it affects it that way.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1555284674, "last_edit_date": 1555284674, "creation_date": 1555226702, "answer_id": 55672941, "question_id": 55662192, "link": "https://stackoverflow.com/questions/55662192/building-a-list-of-all-branches-in-a-tree/55672941#55672941", "title": "Building a list of all branches in a tree", "body": "<p>We can derive and use <code>Foldable</code>, to fold into an ad-hoc monoid to do the job:</p>\n\n<pre><code>data Tree a = EmptyT\n            | NodeT a ( Tree a ) ( Tree a )\n            deriving (Show, Functor, Foldable)\n\ndata T a = T a                    -- tip\n         | N [[a]]                -- node\n         | TN (a,[[a]])           -- tip  &lt;&gt; node\n         | NN ([[a]],[[a]])       -- node &lt;&gt; node\n         deriving Show\n\ninstance Monoid (T a) where\n    mempty = N []           -- (tip &lt;&gt; node &lt;&gt; node)  is what we actually want\n    mappend (T a)  (N as) = TN (a,as)           -- tip  &lt;&gt; node\n    mappend (N as) (N bs) = NN (as,bs)          -- node &lt;&gt; node\n\n    mappend (T a) (NN ([],[])) = N ([[a]])      -- tip  &lt;&gt; (node &lt;&gt; node)\n    mappend (T a) (NN (as,bs)) = N (map (a:) as ++ map (a:) bs) \n\n    mappend (TN (a,[])) (N []) = N ([[a]])      -- (tip &lt;&gt; node) &lt;&gt; node\n    mappend (TN (a,as)) (N bs) = N (map (a:) as ++ map (a:) bs)\n\nallPaths :: Tree a -&gt; [[a]]\nallPaths (foldMap T -&gt; N ps) = ps\n</code></pre>\n\n<p>The <code>allPaths</code> function definition uses <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=viewpatterns#extension-ViewPatterns\" rel=\"nofollow noreferrer\"><code>ViewPatterns</code></a>. Testing,</p>\n\n<pre><code>&gt; allPaths $ NodeT 1 (NodeT 2 (NodeT 3 EmptyT EmptyT) EmptyT) \n                     (NodeT 5 EmptyT EmptyT)\n[[1,2,3],[1,5]]\n\n&gt; allPaths $ NodeT 1 (NodeT 2 (NodeT 3 EmptyT EmptyT) (NodeT 4 EmptyT EmptyT)) \n                     (NodeT 5 EmptyT EmptyT)\n[[1,2,3],[1,2,4],[1,5]]\n</code></pre>\n\n<p><code>(tip &lt;&gt; node &lt;&gt; node)</code> is what we really want, but <code>&lt;&gt;</code> is binary, and we don't know (and shouldn't rely on it if we did) the actual order in which the parts will be combined into the whole by the derived definition of <code>foldMap</code>,</p>\n\n<pre><code>foldMap T EmptyT          ==  N []\nfoldMap T (NodeT a lt rt) ==  T a &lt;&gt; foldMap T lt &lt;&gt; foldMap T rt\n                              -- but in what order? \n</code></pre>\n\n<p>So we \"fake\", it by delaying the actual combination until all three parts are available. </p>\n\n<p>Or we could forgo the derivation route altogether, use the above laws as the definition of a custom <code>foldMap</code> with a ternary combination, and end up with ... the equivalent of the recursive code in the other answer -- much shorter overall, without the utilitarian cruft of one-off auxiliary types that need to be hidden behind module walls, and self-evidently non-partial, unlike what we've ended up with, here.</p>\n\n<p>So maybe it's not so great. I'll post it anyway, as a counterpoint.</p>\n"}], "owner": {"reputation": 11, "user_id": 11354552, "user_type": "registered", "profile_image": "https://graph.facebook.com/409992806454863/picture?type=large", "display_name": "Totto Bennington", "link": "https://stackoverflow.com/users/11354552/totto-bennington"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1555284674, "creation_date": 1555131754, "last_edit_date": 1555167087, "question_id": 55662192, "link": "https://stackoverflow.com/questions/55662192/building-a-list-of-all-branches-in-a-tree", "title": "Building a list of all branches in a tree", "body": "<p>I need to make function returns all possible branches from a tree\nwith this form:</p>\n\n<pre><code>data Tree a = EmptyT | NodeT a ( Tree a ) ( Tree a ) deriving (Show)\n\neveryBranch :: Tree a -&gt; [[a]]\n</code></pre>\n\n<p>I'm not sure how to approach this... xD\nI'm still a newbie in Haskell.</p>\n\n<p>Let's say that I have:</p>\n\n<pre><code>            1\n           / \\\n          2   3\n         /\\  / \\\n        4  5 7  8\n</code></pre>\n\n<p>I want to get: <code>[[1,2,4], [1,2,5], [1,3,8], [1,3,7]]</code></p>\n"}, {"tags": ["haskell", "lazy-evaluation", "space-leak"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555104712, "post_id": 55659315, "comment_id": 98007790, "body": "It looks to me like your space leak and <code>O(1)</code> examples have the same structure (a right fold), just with a different operator. I may be wrong, but I can&#39;t see any way for a compiler to tell the difference in a majority of cases."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1555109398, "post_id": 55659315, "comment_id": 98008975, "body": "Could you make your examples a bit more specific?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1555402911, "post_id": 55659315, "comment_id": 98088270, "body": "Space leaks are often an emergent property of the program. A somewhat trivial example is the familiar <code>foldr (+) 0 [1..1000000 :: Int]</code>, which builds a million-item-long chain of nested thunks, before that gives you an answer. That it does that isn&#39;t the fault of the code for <code>foldr</code>, nor the code for <code>+</code>; both are perfectly reasonable considered independently (we could not, for example, use <code>foldl&#39;</code> instead of <code>foldr</code> everywhere, we&#39;d just get different leaks). The space leak arises from their use together. Other examples can involve far more pieces."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1555403337, "post_id": 55659315, "comment_id": 98088481, "body": "So I don&#39;t think the compiler can just look at patterns in the &quot;local&quot; code as it&#39;s compiling and spot a space leak. It would need to be a more complicated full-program analysis. But I&#39;m not sure I&#39;m following what you mean by &quot;space leaks consuming memory differently than valid lazy algorithms&quot;, or why persistent data structures would be a counterexample, so I don&#39;t know if my reasoning is actually addressing your question to provide an answer."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1555102569, "creation_date": 1555102569, "question_id": 55659315, "link": "https://stackoverflow.com/questions/55659315/do-space-leaks-consume-memory-differently-than-valid-lazy-algorithms", "title": "Do space leaks consume memory differently than valid lazy algorithms?", "body": "<p>Space leak is usually defined by execution of a program that consumes more space than necessary. Is such definition compatible with algorithms that require lazy evaluation for amortized time efficiency?</p>\n\n<p>I wonder if these tend to exhibit different pattern in thunk structures. For example, a trivial space leak might look like this:</p>\n\n<pre><code>1 + (2 + 3 + ...)\n</code></pre>\n\n<p>Would it be normal for a lazy algorithm like tree search produce thunk structures of similar sizes? </p>\n\n<p>I have a suspicion that the proper lazy evaluation patterns would tend to look different making actual leaks easier to spot. For example, the structure could look like this:</p>\n\n<pre><code>[...] : a : b : c\n</code></pre>\n\n<p>Where <code>[...]</code> part is the prefix that has no references and could have been already garbage collected. In such case, lazy algorithm could well run on <code>O(1)</code> space and there can't be a space leak making the distinction very clear.</p>\n\n<p>I wonder if that's common or there is a wider spectrum of trade-offs to make between space and time efficiency in lazy languages.</p>\n\n<p>EDIT: A possible counter example - persistent structures. Are they easy to distinguish from space leaks?</p>\n"}, {"tags": ["function", "variables", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555102076, "post_id": 55659200, "comment_id": 98006961, "body": "How did you create your first Coord variable?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1555102259, "post_id": 55659200, "comment_id": 98007018, "body": "Shouldn&#39;t this be <code>type Coord a = [(a, a)]</code>? Or <code>newtype Coord a = Coord [(a, a)]</code>."}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555102324, "post_id": 55659200, "comment_id": 98007033, "body": "@that other guy I call the function using the first coordinate; for example, in my function call, I would type &quot;foo (1,2)&quot;"}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555102377, "post_id": 55659200, "comment_id": 98007050, "body": "@WillemVanOnsem Well, if I were to accept any type in my coordinates, then yeah, but I only want integers; for example, I only want (1,2), (23, 12), (0, 1), etc. and not any other type."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555102480, "post_id": 55659200, "comment_id": 98007092, "body": "@DarrelGulseth Your post says you&#39;ve defined Coord as a list. Do you actually have <code>type Coord = (Int, Int)</code> instead? Or are you running <code>foo [(1,2)]</code>? If you haven&#39;t actually tried to run it yet, please do so and sort that out first (you can use <code>foo = undefined</code> until you figure out what to do with it)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1555102652, "post_id": 55659200, "comment_id": 98007150, "body": "@DarrelGulseth: but then I don&#39;t see why (a) you use an <code>a</code> type parameter anyway, since it is not used in the &quot;body&quot; of the <code>type</code> clause, and (b) why you add an <code>Eq</code> constraint."}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555103028, "post_id": 55659200, "comment_id": 98007278, "body": "@that other guy Yes, I meant to type foo [(1,2)]"}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555103065, "post_id": 55659200, "comment_id": 98007283, "body": "@Willem Van Onsem Ok, I will change those two, as they&#39;re not necessary."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555103148, "post_id": 55659200, "comment_id": 98007312, "body": "Would you know how to do this if you had a <code>[(Int, Int)]</code> instead of a <code>Coord</code>?"}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1555103404, "post_id": 55659200, "comment_id": 98007397, "body": "@that other guy No, I wouldn&#39;t; I wouldn&#39;t be sure how to declare that list, you know? So I would need to create a new list [(Int, Int)]. But how do I do this? I only know how to access the one that was given to me as a parameter."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555103556, "post_id": 55659200, "comment_id": 98007451, "body": "@DarrelGulseth &quot;Well, if I were to accept any type in my coordinates, then yeah, but I only want integers&quot; Then you don&#39;t need the <code>a</code>. Should be <code>type Coord = [(Int, Int)]</code>"}, {"owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555103791, "post_id": 55659200, "comment_id": 98007525, "body": "@DarthFennec But that&#39;s what I have, right?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1555103911, "post_id": 55659200, "comment_id": 98007559, "body": "@DarrelGulseth I see <code>type Coord a = [(Int, Int)]</code>. There&#39;s an <code>a</code> in there that does nothing useful for you, unless you&#39;re accepting any type."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555105351, "post_id": 55659569, "comment_id": 98007999, "body": "Possibly more &quot;advanced&quot; (although not really), but you can simplify this considerably by definding it as <code>multiplyXBy2 = map (\\(x, y) -&gt; (2*x, y))</code>. Or even <code>multiplyXBy2 = (map . first) (*2)</code> (if you <code>import Control.Arrow</code>)."}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 5, "last_activity_date": 1555104043, "creation_date": 1555104043, "answer_id": 55659569, "question_id": 55659200, "link": "https://stackoverflow.com/questions/55659200/using-variables-inside-functions/55659569#55659569", "title": "Using Variables inside Functions", "body": "<p>This would be the manual way of doing something to each element in a list:</p>\n\n<pre><code>type Coord = [(Int, Int)]\n\nmultiplyXBy2 :: Coord -&gt; Coord\nmultiplyXBy2 [] = []\nmultiplyXBy2 ((x, y):rest) = (x*2, y) : multiplyXBy2 rest\n</code></pre>\n\n<p>Here's an invocation via <code>ghci</code>:</p>\n\n<pre><code>*Main&gt; multiplyXBy2 [(1,2), (3,4)]\n[(2,2),(6,4)]\n</code></pre>\n\n<p>For the very basics of using a language, such as how to access list elements passed into a function or how to programmatically build a list, please consider following a tutorial such as LYAH's <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"noreferrer\">Syntax in Functions</a> or RWH's <a href=\"http://book.realworldhaskell.org/read/defining-types-streamlining-functions.html\" rel=\"noreferrer\">Defining Types, Streamlining Functions</a></p>\n"}], "owner": {"reputation": 133, "user_id": 10982955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a8eac35f4b0969915fa0a0d5d9c813?s=128&d=identicon&r=PG&f=1", "display_name": "Darrel Gulseth", "link": "https://stackoverflow.com/users/10982955/darrel-gulseth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 55659569, "answer_count": 1, "score": -2, "last_activity_date": 1555111511, "creation_date": 1555101979, "last_edit_date": 1555111511, "question_id": 55659200, "link": "https://stackoverflow.com/questions/55659200/using-variables-inside-functions", "title": "Using Variables inside Functions", "body": "<p>Let's say I have a data type called \"Coord\" which is defined as such:</p>\n\n<pre><code>type Coord a = [(Int, Int)]\n</code></pre>\n\n<p>I want to create a variable of type \"Coord\" to use in my function below. The function takes in a variable of type Coord, and multiplies the x coordinate of each item in the list by 2. It then stores each of these new coordinates in a NEW Coord variable; I'm not sure how to create/declare/use this new variable that I aim to return.</p>\n\n<pre><code>foo :: (Eq a) =&gt; Coord a -&gt; Coord a\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1555108076, "post_id": 55658982, "comment_id": 98008718, "body": "Moving your cabal file to <code>MyProject</code> (and adjusting all references as appropriate) would bring <code>MyProject&#47;Frontend</code> into the source tree, thus avoiding the problem noted in that error message. (I have successfully used <code>data-dir</code> and <code>data-files</code> in that way for a project of mine.)"}, {"owner": {"reputation": 58, "user_id": 5530077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jnRm0fuQCJs/AAAAAAAAAAI/AAAAAAAAAkA/jMd1E5dynLo/photo.jpg?sz=128", "display_name": "Alex Gagn&#233;", "link": "https://stackoverflow.com/users/5530077/alex-gagn%c3%a9"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1555327592, "post_id": 55658982, "comment_id": 98059340, "body": "I wanted to avoid doing this, but looks like it&#39;s going to be my best option, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1555177659, "creation_date": 1555177659, "answer_id": 55668277, "question_id": 55658982, "link": "https://stackoverflow.com/questions/55658982/is-it-possible-to-output-a-static-file-in-bin-when-building-with-cabal-or-stack/55668277#55668277", "title": "Is it possible to output a static file in bin when building with Cabal or Stack?", "body": "<p>You can use the <a href=\"https://www.stackage.org/package/file-embed\" rel=\"nofollow noreferrer\"><code>file-embed</code></a> package to use Template Haskell to embed the contents of files or directories directly into your executable. <code>wai-app-static</code> uses this, for example, to create a self contained static file server if requested.</p>\n"}], "owner": {"reputation": 58, "user_id": 5530077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jnRm0fuQCJs/AAAAAAAAAAI/AAAAAAAAAkA/jMd1E5dynLo/photo.jpg?sz=128", "display_name": "Alex Gagn&#233;", "link": "https://stackoverflow.com/users/5530077/alex-gagn%c3%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1555177659, "creation_date": 1555100692, "question_id": 55658982, "link": "https://stackoverflow.com/questions/55658982/is-it-possible-to-output-a-static-file-in-bin-when-building-with-cabal-or-stack", "title": "Is it possible to output a static file in bin when building with Cabal or Stack?", "body": "<p>I want to output static html files alongside my build output (giving access to these files to my Haskell program).</p>\n\n<p>Here is my current project structure:</p>\n\n<pre><code>MyProject/FrontEnd -- contains static html, js and css files.\nMyProject/Backend -- contains the stack Haskell project\n</code></pre>\n\n<p>I want that when I run <code>stack build</code> inside the Backend directory, it both builds my Haskell project and then copies the Frontend directory and puts it in the build output, alongside my executable.</p>\n\n<p>I'm not super familiar with Cabal or Stack, but I've looked mostly inside the cabal documentation and saw that there was the <code>data-dir</code> parameter, that looks like it does what I want, but even when adding:\n<code>data-dir: ..\\Frontend</code> in my cabal file, I get this warning:\n<code>data-dir: ..\\Frontend' is a relative path outside of the source tree. This will not work when generating a tarball with 'sdist'.</code> and the files are not present in the output.</p>\n\n<p>I haven't seen a similar flag in Stack.</p>\n\n<p>Is it possible to do what I want? Or I am going to have to create my own script to do this for me (call stack build, and then output the files manually)?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1555100059, "creation_date": 1555100059, "answer_id": 55658835, "question_id": 55658710, "link": "https://stackoverflow.com/questions/55658710/how-to-remove-empty-lists-from-a-nested-list-using-comprehension-in-haskell/55658835#55658835", "title": "How to remove Empty Lists from a nested List using comprehension in Haskell", "body": "<p>You can add some extra filtering, and prevent doing the same list comprehension twice with a <code>let</code> clause, like:</p>\n\n<pre><code>removingOnlyPosOdds xxs = [ ys | xs &lt;- xxs, <b>let ys =</b> [x | x &lt;-xs, not (odd x &amp;&amp; x &gt; 0 )], <b>not (null ys)</b>  ]</code></pre>\n\n<p>Or we can just add some extra filtering, like:</p>\n\n<pre><code>removingOnlyPosOdds :: Integral i =&gt; [[i]] -&gt; [[i]]\nremovingOnlyPosOdds = <b>filter (not . null)</b> . map (filter (\\x -&gt; not (odd x &amp;&amp; x &gt; 0)))</code></pre>\n\n<p>or even more pointfree:</p>\n\n<pre><code>import Control.Monad(liftM2)\n\nremovingOnlyPosOdds :: Integral i =&gt; [[i]] -&gt; [[i]]\nremovingOnlyPosOdds = filter (not . null) . map (filter (not . liftM2 (&&) odd (>0)))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; removingOnlyPosOdds [[-3],[-5,8],[1,3,5,7,9],[],[4,6,8,10],[1,3,6,7,9],[],[1]]\n[[-3],[-5,8],[4,6,8,10],[6]]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11353448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/964759e1c3921c3201b1273a19d75f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Flora", "link": "https://stackoverflow.com/users/11353448/flora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 1, "accepted_answer_id": 55658835, "answer_count": 1, "score": 4, "last_activity_date": 1555100059, "creation_date": 1555099367, "last_edit_date": 1555099805, "question_id": 55658710, "link": "https://stackoverflow.com/questions/55658710/how-to-remove-empty-lists-from-a-nested-list-using-comprehension-in-haskell", "title": "How to remove Empty Lists from a nested List using comprehension in Haskell", "body": "<p>I just started learning Haskell and I started looking into understanding comprehension which allows me to form a subset by giving conditions to a bigger set.</p>\n\n<p>I tried to make a comprehension that takes a nested list (containing other integer lists) and removes all the positive odd numbers from them and empty inner lists.</p>\n\n<pre><code>testList= [-3]:[-5,8]:[[1,3,5,7,9],[],[4,6,8,10],[1,3,6,7,9],[],[1]]\n\nremovingOnlyPosOdds xxs = [ [x | x &lt;-xs, not (odd x &amp;&amp; x &gt; 0 )] | xs &lt;- xxs, [] /= xs ] \n\n</code></pre>\n\n<p><code>testList</code> before applying the comprehension function on it looked like:</p>\n\n<p><code>[[-3],[-5,8],[1,3,5,7,9],[],[4,6,8,10],[1,3,6,7,9],[],[1]]</code></p>\n\n<p>After applying <code>removingOnlyPosOdds</code> testList</p>\n\n<pre><code>The outcome was \n[[-3],[-5,8],[],[4,6,8,10],[6],[]] \n</code></pre>\n\n<hr>\n\n<p>So what I realised that <code>\"[] /= xs\"</code> in the function description was removing the already existent </p>\n\n<p><code>\"[]\"</code> inner lists in <code>testList</code> only; but not the new ones that were formed caused by me removing positive odd numbers from the inner lists.</p>\n\n<p>What should be my next step in order to remove those as well code wise?</p>\n\n<p>I want it to look like</p>\n\n<p><code>[[-3],[-5,8],[4,6,8,10],[6]]</code></p>\n\n<p>Is there a way to generalise the comprehension to do it in one go? </p>\n\n<p>Or is there another approach which would be much better to deal with the removal of things (like the empty inner lists )and to make a more specified set?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1555079361, "post_id": 55653894, "comment_id": 97996492, "body": "Just the same, except that the arrow is <code>-&gt;</code>, and a <code>Boolean</code> is a <code>Bool</code>, so <code>type Set = Int -&gt; Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 10, "last_activity_date": 1555079468, "creation_date": 1555079468, "answer_id": 55653950, "question_id": 55653894, "link": "https://stackoverflow.com/questions/55653894/type-alias-for-a-characteristic-function/55653950#55653950", "title": "Type alias for a characteristic function", "body": "<p>This is almost exactly the same as in Scala, except that in Haskell</p>\n\n<ol>\n<li>the arrow is denoted as <code>-&gt;</code>, <code>=&gt;</code> is used for type constraints; and</li>\n<li>a <code>Boolean</code> in Haskell is a <code>Bool</code>.</li>\n</ol>\n\n<p>So we can define this as:</p>\n\n<pre><code>type Set = Int <b>-&gt;</b> Bool</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 981584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc453cebfbdf43c8cca4e7eaeb3b9e49?s=128&d=identicon&r=PG", "display_name": "NathanL", "link": "https://stackoverflow.com/users/981584/nathanl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1555079468, "creation_date": 1555079288, "question_id": 55653894, "link": "https://stackoverflow.com/questions/55653894/type-alias-for-a-characteristic-function", "title": "Type alias for a characteristic function", "body": "<p>In Scala, we can define a type alias for a characteristic function like</p>\n\n<pre><code>      type Set = Int =&gt; Boolean\n</code></pre>\n\n<p>In Haskell, how can we achieve the same goal?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1555074532, "post_id": 55652293, "comment_id": 97993185, "body": "<code>mzero</code> comes from the <code>MonadPlus</code> type class, in <code>Control.Monad</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1555075163, "post_id": 55652293, "comment_id": 97993633, "body": "<a href=\"https://hoogle.haskell.org/?hoogle=mzero\" rel=\"nofollow noreferrer\">Hoogle</a> will tell you what to import: any of Control.Monad, Distribution.Compat.Prelude.Internal, Control.Monad.Compat, Protolude, Protolude.Monad, Turtle, ClassyPrelude, RIO, Universum.Monad.Reexport, Rebase.Prelude, LLVM.Prelude,Relude.Monad.Reexport, Stack.Prelude, Yesod.Paginator.Prelude, Control.Monad.Free, OpenSuse.Prelude, Hledger.Web.Import, with Control.Monad being the most common and sanest choice."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11351680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87fea23b47b0bf2dc32ab3ef53a54455?s=128&d=identicon&r=PG&f=1", "display_name": "Elsie Meow", "link": "https://stackoverflow.com/users/11351680/elsie-meow"}, "edited": false, "score": 2, "creation_date": 1555075110, "post_id": 55652435, "comment_id": 97993595, "body": "Is there anything in the help or hoogle tooling, etc., that would have helped me identify this without asking?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1555075201, "last_edit_date": 1555075201, "creation_date": 1555074801, "answer_id": 55652435, "question_id": 55652293, "link": "https://stackoverflow.com/questions/55652293/whats-mzero-in-this-aeson-example/55652435#55652435", "title": "What&#39;s mzero in this aeson example?", "body": "<p><code>mzero</code> is part of the <code>MonadPlus</code> typeclass, defined in <code>Control.Monad</code>.</p>\n\n<pre><code>&gt; import Control.Monad\n&gt; :info MonadPlus\nclass (GHC.Base.Alternative m, Monad m) =&gt;\n      MonadPlus (m :: * -&gt; *) where\n  mzero :: m a\n  mplus :: m a -&gt; m a -&gt; m a\n</code></pre>\n\n<p>It serves as the identity for the <code>mplus</code> function, so that <code>mplus mzero x == x</code> and <code>mplux x mzero == x</code>.</p>\n\n<p>The use of <code>mzero</code> in instances of <code>FromJSON</code> is mentioned in the documentation:</p>\n\n<blockquote>\n  <p>When writing an instance, use empty, mzero, or fail to make a conversion fail, e.g. if an Object is missing a required key, or the value is of the wrong type.</p>\n</blockquote>\n\n<p>So in your quoted instance</p>\n\n<pre><code>instance FromJSON Colour where\n  parseJSON (String s) = return $ case s of\n        \"blue\" -&gt; Blue\n        \"green\" -&gt; Green\n        _ -&gt; Yellow\n  parseJSON _ = mzero\n</code></pre>\n\n<p><code>mzero</code> indicates that no JSON value other than a <code>String</code> can be interpreted as encoding a <code>Colour</code> value.</p>\n"}], "owner": {"reputation": 21, "user_id": 11351680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87fea23b47b0bf2dc32ab3ef53a54455?s=128&d=identicon&r=PG&f=1", "display_name": "Elsie Meow", "link": "https://stackoverflow.com/users/11351680/elsie-meow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1555075201, "creation_date": 1555074390, "question_id": 55652293, "link": "https://stackoverflow.com/questions/55652293/whats-mzero-in-this-aeson-example", "title": "What&#39;s mzero in this aeson example?", "body": "<p>I saw this question on SO and am trying to replicate it:\n<a href=\"https://stackoverflow.com/questions/25504231/haskell-reusing-fromjson-instances-with-lenses-lens-aeson-and-nested-json\">Haskell: Reusing FromJSON instances with lenses, lens-aeson, and nested JSON</a></p>\n\n<p>However, when I run what I think should be a complete example, I get an error.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>import Data.Aeson\nimport Data.Aeson.Lens\nimport Control.Lens\nimport Data.Aeson.Types\n\ndata Colour = Yellow | Green | Blue\n\ninstance FromJSON Colour where\n  parseJSON (String s) = return $ case s of\n        \"blue\" -&gt; Blue\n        \"green\" -&gt; Green\n        _ -&gt; Yellow\n  parseJSON _ = mzero\n\ninstance ToJSON Colour where\n  toJSON Yellow = String \"yellow\"\n  toJSON Blue   = String \"blue\"\n  toJSON Green  = String \"green\"\n\nparseColour :: String -&gt; Maybe Colour\nparseColour j = j ^? key \"info\" . key \"colour\" . _JSON\n\nparseColour \"{ \\\"info\\\": { \\\"colour\\\": \\\"yellow\\\" } }\"\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code> &lt;interactive&gt;:7:17: error: Variable not in scope: mzero :: Parser Colour\n</code></pre>\n\n<p>A lot of searches show an mzero variable used like this, successfully.  I can't tell if it's something imported from a package or just an arbitrary variable name and I'm misusing the function.  Either way, it's not clear to me why copying this code from the question seems to fail on this.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1555073087, "post_id": 55651807, "comment_id": 97992296, "body": "I&#39;m afraid you&#39;re going to have to rethink your logic here. For one thing, you&#39;re automatically including the first element of the list (<code>x</code>), which you obviously don&#39;t want to do (if <code>n</code> is non-zero)."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1555073394, "post_id": 55651939, "comment_id": 97992489, "body": "I would also highlight the fact that you replaced <code>n + 1</code> with <code>n - 1</code>."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 4, "last_activity_date": 1555073469, "last_edit_date": 1555073469, "creation_date": 1555073169, "answer_id": 55651939, "question_id": 55651807, "link": "https://stackoverflow.com/questions/55651807/how-to-code-the-function-drop-without-the-prelude-module-in-haskell/55651939#55651939", "title": "How to code the function drop without the prelude module in Haskell?", "body": "<p>The idea of drop is to skip the <code>n</code> first items, so just <strong>discard</strong> them recursively until you reach <em>0</em>:</p>\n\n<pre><code>drop:: Int -&gt; [a] -&gt; [a]\ndrop _ []     = []\ndrop 0 xs     = xs\ndrop n (_:xs) = drop (n-1) xs\n</code></pre>\n\n<p>The important base case that you miss is <code>drop 0 xs = xs</code>, so if I have nothing to <strong>drop</strong> I just return what I got.\nAlso note that we decrement (<code>(n-1)</code>) not increment in the recursive call, otherwise you will never reach to the base case.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10656336"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 55651939, "answer_count": 1, "score": 0, "last_activity_date": 1555073469, "creation_date": 1555072685, "last_edit_date": 1555072966, "question_id": 55651807, "link": "https://stackoverflow.com/questions/55651807/how-to-code-the-function-drop-without-the-prelude-module-in-haskell", "title": "How to code the function drop without the prelude module in Haskell?", "body": "<p>I want to write some prelude functions by myself in <code>Haskell</code> to understand it better and to exercise a bit with it. I already coded the <code>TAKE</code> function but I have some problems with the <code>DROP</code> function.</p>\n\n<pre><code>take1 :: Int -&gt; [a] -&gt; [a]\n\ntake1 _ [] = []\n\ntake1 0 _ = []\n\ntake1 n (x:xs) = x:take1 (n-1) xs \n\n-- Input: take 5 [1,2,3,4,5,6,7] \n\n-- Output: [1,2,3,4,5]\n\n--This is the take Function and its working.\n\ndrop1 :: Int -&gt; [a] -&gt; [a]\n\ndrop1 _ [] = []\n\ndrop1 n (x:xs) = x : drop1 (n+1) xs \n\n-- Input: drop 5 [1,2,3,4,5,6,7,8,9,10] \n\n-- Output: [6,7,8,9,10] \n\n-- It\u00b4s printing out the whole List and not the wanted result.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555065991, "post_id": 55649812, "comment_id": 97988479, "body": "It looks to me that you can simply declare <code>Main.Rational</code> and <code>Integer</code> individual instances of <code>Increment</code>, this is even a richer way to represent these, since know we &quot;retain&quot; the knowledge in the type system that the <code>inc</code> of a <code>Rational</code> is still a <code>Rational</code>."}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555066455, "post_id": 55649812, "comment_id": 97988694, "body": "I have havent I?....the point being is that the modules that define the functions, don&#39;t know if they are operating on Rationals or Integers ever, and over time, more &quot;Number&quot; types will be added, and when they are, you want to know which functions now fail (because the interesection of the typeclasses of each the wrapperd dicrimated types will shrink)"}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555066644, "post_id": 55649812, "comment_id": 97988796, "body": "ah.....the above comment doest really make sense...of course it the function can look inside disciminatd union at any given point....but over time the union will grow, so if it does, the code will no longer compile....EVEN if in principle nothing else has broken."}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1555067213, "post_id": 55649812, "comment_id": 97989099, "body": "MY comment...didnt make sense..yours did"}], "answers": [{"comments": [{"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555068927, "post_id": 55650615, "comment_id": 97990051, "body": "I&#39;ll have to thnk about this.....I&#39;m not sure if the problem hasnt just been kicked down the road, rather than solved."}], "tags": [], "owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "is_accepted": false, "score": 1, "last_activity_date": 1555068444, "creation_date": 1555068444, "answer_id": 55650615, "question_id": 55649812, "link": "https://stackoverflow.com/questions/55649812/a-way-to-simulate-union-types-without-type-operators/55650615#55650615", "title": "a way to simulate Union types without type operators", "body": "<p>So this IS the expression problem, so type classes solve this specific case.</p>\n\n<p>you take the function you want to make general over some as yet undefined universe of types</p>\n\n<pre><code>&gt; class Add2 a where \n&gt;   add2' :: a -&gt; a\n\n&gt; newtype Number' a = Number' a\n\n&gt; instance (Increment a) =&gt; Add2 (Number' a) where\n&gt;   add2' (Number' x) = Number' $ inc (inc x)\n\n&gt; three = add2 (Int 1)\n</code></pre>\n\n<p>and then make any type that inhabits the required preconditions in terms of type classes, inhabit the typeclass for your generalised \"function\".</p>\n\n<p>you then implement your new \"Number\" data types, and create instances of them where they make sense.</p>\n"}, {"comments": [{"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555147696, "post_id": 55657004, "comment_id": 98015160, "body": "ahha, so my expression problem answer sort of is correct, but I simply end up creating instances that are syntactically identical...let me try your answer, I think it may do exactly what I want, I assume rankN is very much a Haskell thing, there&#39;s no way to map this into industrial OO type systems?"}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555168787, "post_id": 55657004, "comment_id": 98020415, "body": "hmmm...so actually this isnt quite what I&#39;m after, not your fault, its quite difficult to explain, I want &quot;apply&quot; to allow ANY function that could be applied to Rat and Int...in my classic typeclass answer, I have to &quot;prove&quot; that the function can be applied by explicitly implementing it. In your example, you are showing that a specific precondition on any function means the function can be applied in general"}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555169204, "post_id": 55657004, "comment_id": 98020526, "body": "I&#39;ll have a think about this...I may be asking for a contradictory thing.."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555169521, "post_id": 55657004, "comment_id": 98020614, "body": "@MrD The way that you convince the compiler that a function can be applied to both <code>Rat</code> and <code>Int</code> is by making it a typeclass method and making instances of that class for both <code>Rat</code> and <code>Int</code>. Once you&#39;ve done that, you can add that constraint to the rank-2 type of <code>apply</code> and be on your way."}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1555185941, "post_id": 55657004, "comment_id": 98025050, "body": "yep...I think I answered the typeclass bit, and you&#39;ve answered the apply bit...as with a lot of these things the problem is actually trying to vocalise the question...I want various different functions to be defined against &quot;Number&quot;...when someone updates Number, without knowing anything about the functions or type classes...when a function project is recompiled it fail, if it cannot &quot;work&quot;, I&#39;ll flag your answer as an answer..it IS to the question I&#39;ve posed, but I&#39;m not too sure I&#39;ve asked the right question...I think I&#39;ll just have to try."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1555102193, "last_edit_date": 1555102193, "creation_date": 1555090664, "answer_id": 55657004, "question_id": 55649812, "link": "https://stackoverflow.com/questions/55649812/a-way-to-simulate-union-types-without-type-operators/55657004#55657004", "title": "a way to simulate Union types without type operators", "body": "<p>You can accept only functions that make use of <code>Increment</code> methods (and do not make use of any non-<code>Increment</code>al functionality) like this:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\napply :: (forall a. Increment a =&gt; a -&gt; a) -&gt; Number -&gt; Number\napply f (Rat r) = Rat (f r)\napply f (Int i) = Int (f i)\n</code></pre>\n\n<p>You can now pass <code>add2</code> to <code>apply</code> if you like:</p>\n\n<pre><code>&gt; apply add2 (Rat (Rational 3 4))\nRat (Rational 11 4)\n</code></pre>\n\n<p>In this <em>specific</em> case, implementing <code>apply</code> amounts to exactly the same thing as supplying an <code>Increment</code> instance for <code>Number</code> itself:</p>\n\n<pre><code>instance Increment Number where\n    inc (Rat r) = Rat (inc r)\n    inc (Int i) = Int (inc i)\n</code></pre>\n\n<p>...and now you don't even need the mediating <code>apply</code> function to apply <code>add2</code>:</p>\n\n<pre><code>&gt; add2 (Rat (Rational 3 4))\nRat (Rational 11 4)\n</code></pre>\n\n<p>But this is a pretty special case; it won't always be so easy to just implement the appropriate classes for <code>Number</code>, and you will need to resort to something like the higher-rank types we used in <code>apply</code> instead.</p>\n"}], "owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 55657004, "answer_count": 2, "score": 0, "last_activity_date": 1555102193, "creation_date": 1555065624, "last_edit_date": 1555068460, "question_id": 55649812, "link": "https://stackoverflow.com/questions/55649812/a-way-to-simulate-union-types-without-type-operators", "title": "a way to simulate Union types without type operators", "body": "<p>I have done this before using type operators, but I want to exclude those because I want to be able to do it with a smaller hammer, because I actually want to do it in another language, and I'm not too sure type operators do quite what I want.</p>\n\n<p>The setup is two data types, Integer and...</p>\n\n<pre><code>&gt; data Rational = Rational Integer Integer deriving Show\n</code></pre>\n\n<p>two type classes with sensible instances...</p>\n\n<pre><code>&gt; class Divide2 a where\n&gt;   divide2 :: a -&gt; a\n\n&gt; class Increment a where\n&gt;   inc :: a -&gt; a\n\n&gt; instance Increment Main.Rational where\n&gt;   inc (Rational a b) = Rational (a + b) b\n\n&gt; instance Divide2 Main.Rational where\n&gt;   divide2 (Rational a b) = Rational a (2 * b)\n\n&gt; instance Increment Integer where\n&gt;   inc x = x + 1\n</code></pre>\n\n<p>I can define things that work instances of one type class or the other</p>\n\n<pre><code>&gt; div4 x = divide2 (divide2 x)\n\n&gt; add2 :: Increment c =&gt; c -&gt; c\n&gt; add2 = inc . inc\n</code></pre>\n\n<p>and then I want to take the union of these two data types...so the obvious thing to do is use a discriminated </p>\n\n<pre><code>&gt; data Number = Rat Main.Rational | Int Integer\n</code></pre>\n\n<p>now...in my scenario, the functions that act on this union, exist in one distinct module (a binary, I'm not familiar with Haskells binaries)</p>\n\n<p>but the data types themselves are defined in another</p>\n\n<p>So clearly I can define some functions that (in principle) can potentially \"work\" on this union, e.g. functions that act on values of instances of Increment....and some that don't, e.g. one in Divide2</p>\n\n<p>So how do I write a function, against this discriminated union, that applys a function to values in the union, that will compile for functions on Increment, but don't compile on functions on Divide2...I'll have a go here, and fall flat on my face.</p>\n\n<pre><code>&gt; apply (Rat r) f = f r\n&gt; apply (Int i) f = f i\n</code></pre>\n\n<p>.</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018Main.Rational\u2019\n                  with actual type \u2018Integer\u2019\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018i\u2019\n      In the expression: f i\n      In an equation for \u2018apply\u2019: apply (Int i) f = f i\n   |\n86 | &gt; apply (Int i) f = f i    |                       ^\nFailed, no modules loaded.\n</code></pre>\n\n<p>as expected, the inference says its got to be an Rational because of the first call, but its an Integer...</p>\n\n<p>but \"clearly\"...if I could make haskell suspect disbelief...like some sort of macro...then the function</p>\n\n<pre><code>&gt; apply (Int 1) add2\n</code></pre>\n\n<p>does make sense, and moreover, makes sense for any value of Number I care to choose.</p>\n\n<p>so the obvious thing to do is to make Number a member of anything in the intersection of the set of type classes each member is in....</p>\n\n<pre><code>&gt; instance Increment Number where\n&gt;   inc (Rat r) = inc (Rat r)\n&gt;   inc (Int i) = inc (Int i)\n</code></pre>\n\n<p>and then ghc implements \"apply\" itself...I CAN as well map this solution back into other languages by some explicit dictionary passing...but I have hundreds, if not thousands of tiny typeclasses (I may even have to consider all their combinations as well).</p>\n\n<p>so really I want to know is there some type magic (existential? rankn?) that means that I CAN write \"apply\" against Number, without resorting to some dependent type magic, or have to implement instances of type classes on the discriminated union.</p>\n\n<p>P.S. I can do limited dependent type magic...but its a last resort,</p>\n\n<p>Edit...</p>\n\n<p>The code that contains the functions defined on Number can of course match the disciminated values, but if they do, then whenever union is extended, they will fail to compile (ok, they don't have to match each case individally, but unless they do, they can't extract the wrapped value to apply the function, because it wont know the type)</p>\n\n<p>Hmmm...written down it looks like the expression problem, in fact it IS the expression problem...I know of many solutions then...I just don't usually like any of them...let me knock up the canonical Haskell solution to this using type classes.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 1, "creation_date": 1555034198, "post_id": 55643194, "comment_id": 97976765, "body": "Just to be clear as to why your functions didnt work: the first one (that you now corrected) just failed the pattern matching: <code>[a,b,c]</code> is a list with three elements, which is different from a 3-tuple <code>(a,b,c)</code> . the second one failed because <code>Rec</code> is a data constructor, but acts just like a function. In fact if you type <code>:t Rec</code> in your GHCi you will find something like <code>Rec :: Text -&gt; Text -&gt; Text -&gt; Rec</code>, so you cannot pass it a tuple, which is exactly what the error says. You can fix this by &#39;uncurrying&#39; it with <code>uncurry3</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 0, "creation_date": 1555089426, "post_id": 55643194, "comment_id": 98002057, "body": "Thanks.  How would you apply the uncurry3 fix?  Is that replace <code>print $ fmap (\\x -&gt; Rec (f x)) recs                             where f [a,b,c] = (a,b,c)  </code> with <code>print $ fmap (\\x -&gt; Rec $ uncurry3 x) recs</code>?"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 0, "creation_date": 1555110972, "post_id": 55643194, "comment_id": 98009260, "body": "other way round, look at the type signature of uncurry: <code>(\\x -&gt; uncurry3 Rec x)</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 0, "creation_date": 1555117549, "post_id": 55643194, "comment_id": 98010332, "body": "I&#39;m seeing <code>:t uncurry3</code> <code>uncurry3 :: forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; (a, b, c) -&gt; d</code> and <code>print $ fmap (\\x -&gt; uncurry3 Rec x) recs</code> yielding <code>Couldn&#39;t match type \u2018[Text]\u2019 with \u2018(Text, Text, Text)\u2019       Expected type: [(Text, Text, Text)]         Actual type: [[Text]]</code>"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 0, "creation_date": 1555117826, "post_id": 55643194, "comment_id": 98010365, "body": "Yeah you need to apply <code>f</code> in order to get a tuple from the list. Edited the comment now"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 1, "creation_date": 1555117892, "post_id": 55643194, "comment_id": 98010374, "body": "Doesn&#39;t let me edit but should be <code>(\\x -&gt; uncurry3 Rec (f x))</code>"}], "tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": true, "score": 5, "last_activity_date": 1555033511, "last_edit_date": 1555033511, "creation_date": 1555032075, "answer_id": 55643194, "question_id": 55643003, "link": "https://stackoverflow.com/questions/55643003/from-a-list-of-lists-to-a-list-of-data-records/55643194#55643194", "title": "From a list of lists to a list of data records", "body": "<p>This works:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    contents &lt;- T.readFile \"./dat.txf\" \n    let seps = splitOn \"^\\n\" contents\n    let recs = fmap (splitOn \"\\n\") seps\n    -- print $ fmap (\\[x, y, z] -&gt; Rec x y z) recs\n    let tada = fmap (\\[x, y, z] -&gt; Rec x y z) recs\n    mapM_ print tada\n\nmain\n</code></pre>\n\n<p>Produces:</p>\n\n<pre><code>Rec \"Good\" \"id123\" \"\"\nRec \"Bad\" \"id456\" \"\"\nRec \"Middle\" \"id789\" \"\"\n</code></pre>\n\n<p>The <code>\\anonymous</code> function can take a <code>\\[l,i,s,t]</code>.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 55643194, "answer_count": 1, "score": 0, "last_activity_date": 1555033511, "creation_date": 1555030109, "last_edit_date": 1555031852, "question_id": 55643003, "link": "https://stackoverflow.com/questions/55643003/from-a-list-of-lists-to-a-list-of-data-records", "title": "From a list of lists to a list of data records", "body": "<p>I'm parsing a file that looks like this:</p>\n\n<pre><code>Good\nid123\n^\nBad\nid456\n^\nMiddle\nid789\n</code></pre>\n\n<p>Records are separated by <code>^\\n</code>, and fields within that record\nare separated simply by <code>newlines</code>.</p>\n\n<p>Reading this file and splitting, I end up with a list of lists that looks like this:</p>\n\n<pre><code>[[\"Good\",\"id123\",\"\"],[\"Bad\",\"id456\",\"\"],[\"Middle\",\"id789\",\"\"]]\n</code></pre>\n\n<p>However, I fail to turn this into a list of Rec types.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings #-}\nimport Data.Text as T\nimport Data.Text.IO as T\n\ndata Rec = Rec Text Text Text deriving Show  -- simple\n\nmain :: IO ()\nmain = do\n    contents &lt;- T.readFile \"./dat.txf\" \n    let seps = splitOn \"^\\n\" contents\n    let recs = fmap (splitOn \"\\n\") seps\n    print recs\n\nmain\n</code></pre>\n\n<p>Produces</p>\n\n<pre><code>[[\"Good\",\"id123\",\"\"],[\"Bad\",\"id456\",\"\"],[\"Middle\",\"id789\",\"\"]]\n</code></pre>\n\n<p>As expected.  But trying to take this to the next step and turn these into Recs, with:</p>\n\n<pre><code>main_ :: IO ()\nmain_ = do\n    contents &lt;- T.readFile \"./dat.txf\" \n    let seps = splitOn \"^\\n\" contents\n    let recs = fmap (splitOn \"\\n\") seps\n    print recs\n    print $ fmap (\\(x, y, z) -&gt; Rec x y z) recs\n    -- print $ fmap (\\r -&gt; Rec r) recs\n    -- let m = fmap (\\x -&gt; Rec [(x,x,x)]) recs \n    -- print m\n    -- print $ fmap (\\x -&gt; Rec t3 x) recs\n    -- where t3 [x,y,z] = (x,y,z)\n\nmain_\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>&lt;interactive&gt;:7:44: error:\n    \u2022 Couldn't match type \u2018[Text]\u2019 with \u2018(Text, Text, Text)\u2019\n      Expected type: [(Text, Text, Text)]\n        Actual type: [[Text]]\n    \u2022 In the second argument of \u2018fmap\u2019, namely \u2018recs\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018fmap (\\ (x, y, z) -&gt; Rec x y z) recs\u2019\n      In a stmt of a 'do' block: print $ fmap (\\ (x, y, z) -&gt; Rec x y z) recs\n</code></pre>\n\n<p>or</p>\n\n<pre><code>main__ :: IO ()\nmain__ = do\n    contents &lt;- T.readFile \"./dat.txf\" \n    let seps = splitOn \"^\\n\" contents\n    let recs = fmap (splitOn \"\\n\") seps\n    print recs\n    print $ fmap (\\x -&gt; Rec (f x)) recs\n                            where f [a,b,c] = (a,b,c)    \nmain__\n\n&lt;interactive&gt;:7:30: error:\n    \u2022 Couldn't match expected type \u2018Text\u2019 with actual type \u2018(Text, Text, Text)\u2019\n    \u2022 In the first argument of \u2018Rec\u2019, namely \u2018(f x)\u2019\n      In the expression: Rec (f x)\n      In the first argument of \u2018fmap\u2019, namely \u2018(\\ x -&gt; Rec (f x))\u2019\n</code></pre>\n\n<p>What am I missing to turn the <code>[[Text]]</code> into <code>[Rec]</code> ?</p>\n"}, {"tags": ["haskell", "ihaskell", "overloaded-strings"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1555020684, "post_id": 55641833, "comment_id": 97973965, "body": "<a href=\"https://hoogle.haskell.org/?hoogle=readFile\" rel=\"nofollow noreferrer\">readFile</a> has type <code>FilePath -&gt; IO String</code>. Using <code>OverloadedStrings</code> does not magically mean all <code>String</code> values turn into <code>Text</code> (or <code>ByteString</code> etc.), it just makes string <i>literals</i> polymorphic. It&#39;s just like with numbers, the literal <code>2</code>, say, can be any instance of <code>Num</code>, but this doesn&#39;t mean that you can use a function that returns an <code>Int</code> and use its result as if it were a <code>Double</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": true, "score": 0, "last_activity_date": 1556172870, "creation_date": 1556172870, "answer_id": 55842889, "question_id": 55641833, "link": "https://stackoverflow.com/questions/55641833/how-can-i-set-overloadedstrings-in-an-ihaskell-notebook/55842889#55842889", "title": "How can I set OverloadedStrings in an ihaskell notebook?", "body": "<p>Good news: the notebook above does have OverloadedStrings loaded correctly.  The problem is you need to read the file with:</p>\n\n<pre><code>T.readFile\n</code></pre>\n\n<p>So</p>\n\n<pre><code>main :: IO ()\nmain = do\n  text &lt;- T.readFile \"./data.txt\"\n  print $ T.lines text\n</code></pre>\n\n<p>This was confusing because the error highlighted <code>T.lines</code> rather than <code>readFile.</code> It turns out <code>readFile</code> does not produce a form of textual data that will automatically cast to the format required by <code>T.lines</code> (it produces <code>String</code>, not <code>Text</code>).  You had to know that there is an entirely other function to call that does do that. The type system will not convert between these string-like formats for you.  You must do this yourself by calling a file-reading function that explicitly returns a <code>Text</code>: here, <code>T.readFile</code>.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 55842889, "answer_count": 1, "score": -1, "last_activity_date": 1556172870, "creation_date": 1555020437, "question_id": 55641833, "link": "https://stackoverflow.com/questions/55641833/how-can-i-set-overloadedstrings-in-an-ihaskell-notebook", "title": "How can I set OverloadedStrings in an ihaskell notebook?", "body": "<p>I understand from the <a href=\"https://nbviewer.jupyter.org/github/gibiansky/IHaskell/blob/master/notebooks/IHaskell.ipynb\" rel=\"nofollow noreferrer\">sample notebook</a> that I should be able to enable and disable extensions as follows:</p>\n\n<pre><code>-- We can disable extensions. \n:ext NoEmptyDataDecls \ndata Thing\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 \u2018Thing\u2019 has no constructors (EmptyDataDecls permits this)\n    \u2022 In the data declaration for \u2018Thing\u2019\n\n-- And enable extensions.\n:ext EmptyDataDecls\ndata Thing\n</code></pre>\n\n<p>However, when I try this with OverloadedStrings, I do not see any success.  You can see from the below that T.lines is looking for String rather than Text. Why?</p>\n\n<p><a href=\"https://i.stack.imgur.com/9Wu2M.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9Wu2M.png\" alt=\"enter image description here\"></a></p>\n\n<p>What am I misunderstanding or doing wrong?</p>\n"}, {"tags": ["haskell", "text", "ghci", "haskell-prelude"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1555020404, "post_id": 55641569, "comment_id": 97973882, "body": "That <code>import Prelude hiding (lines)</code> statement needs to be inside your <code>mydat.hs</code> file, not in ghci."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1555021235, "post_id": 55641569, "comment_id": 97974145, "body": "What you&#39;re supposed to do is namespace <code>Data.Text</code>. Sometimes I find myself using the same functions from <code>Data.List</code>, <code>Data.Text</code>, <code>Data.Text.Lazy</code>, <code>Data.ByteString</code>, and/or <code>Data.ByteString.Lazy</code>, and by far the easiest way to deal with all of this is to just namespace everything. This also makes it much clearer where your <code>lines</code> came from to anyone else reading your code (most people expect common prelude functions to be from prelude unless they&#39;re namespaced)."}], "answers": [{"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": true, "score": 3, "last_activity_date": 1555098749, "creation_date": 1555098749, "answer_id": 55658589, "question_id": 55641569, "link": "https://stackoverflow.com/questions/55641569/concisely-give-priority-to-non-prelude-functions-in-ghci/55658589#55658589", "title": "Concisely give priority to non-Prelude functions in ghci", "body": "<p>This is not possible (speaking about GHC 8.6.4).</p>\n\n<p>One thing you may do is to qualify <code>Prelude</code> instead:</p>\n\n<pre><code>import qualified Prelude\n</code></pre>\n\n<p>optionally <code>as P</code>, which will require you to explicitly type <code>Prelude.</code> (or <code>P.</code>) before any name from this library.</p>\n\n<p>If you use other <code>Prelude</code> functions frequently you may hide only colliding identifiers by writing</p>\n\n<pre><code>import Prelude hiding (lines)\n</code></pre>\n\n<p>which will remove <code>Prelude.lines</code> from the namespace.</p>\n\n<p>If you want to use <code>lines</code> from <code>Prelude</code> somewhere in the file anyway, you could import this particular identifier as qualified:</p>\n\n<pre><code>import           Prelude hiding (lines)\nimport qualified Prelude as P (lines)\n</code></pre>\n\n<p>I am afraid that it is everything you can do.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 55658589, "answer_count": 1, "score": 4, "last_activity_date": 1555098749, "creation_date": 1555018753, "question_id": 55641569, "link": "https://stackoverflow.com/questions/55641569/concisely-give-priority-to-non-prelude-functions-in-ghci", "title": "Concisely give priority to non-Prelude functions in ghci", "body": "<p>I have the following imports:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings,  DefaultSignatures,  TypeOperators,  FlexibleContexts, RecordWildCards, FlexibleInstances, ExtendedDefaultRules #-}\n\nimport qualified Data.Map as Map\nimport qualified Data.Set as Set\nimport Data.Text\nimport GHC.Generics\nimport Data.DateTime\nimport Data.Aeson\n</code></pre>\n\n<p>I try to use the function <code>lines</code> to break on newline, and this function exists in both <code>Prelude</code> and <code>Data.Text</code>, and I get the following:</p>\n\n<pre><code>$ stack ghci\nPrelude&gt; :set -XOverloadedStrings\nPrelude&gt; :l mydat.hs\n[1 of 1] Compiling Main             ( mydat.hs, interpreted )\n\nmydat.hs:39:13: error:\n    Ambiguous occurrence \u2018lines\u2019\n    It could refer to either \u2018Prelude.lines\u2019,\n                             imported from \u2018Prelude\u2019 at mydat.hs:1:1\n                             (and originally defined in \u2018base-4.11.1.0:Data.OldList\u2019)\n                          or \u2018Data.Text.lines\u2019,\n                             imported from \u2018Data.Text\u2019 at mydat.hs:7:1-16\n   |\n39 |     print $ lines text\n   |             ^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>It's clear from the error message that this is failing because <code>lines</code> exists in both <code>Prelude</code> and <code>Data.Text.lines</code>.</p>\n\n<p>What I'd like is to tell ghci to take /any/ function imported besides Prelude over\nany function defined in Prelude, particularly with text.</p>\n\n<p>I thought one way to do this would be to explicitly, selectively hide <code>Prelude.lines</code>:</p>\n\n<pre><code>$ stack ghci\nPrelude&gt; :set -XOverloadedStrings -XNoImplicitPrelude\nPrelude&gt; import Prelude hiding (lines)\nPrelude&gt; :l mydat.hs\n[1 of 1] Compiling Main             ( mydat.hs, interpreted )\n\nmydat.hs:13:23: error:\n    Not in scope: type constructor or class \u2018Float\u2019\n    Perhaps you meant \u2018UFloat\u2019 (imported from GHC.Generics)\n</code></pre>\n\n<p>But this doesn't seem feasible: if I try to just hide one prelude function, I lose all the other functions I actually want.</p>\n\n<p>What's the right way to keep <code>Data.Text</code> functions and hide them from  collisions with <code>Prelude.*</code>?  Am I stuck name-spacing everything with </p>\n\n<pre><code>import Data.Text as T\n</code></pre>\n\n<p>And using, for example:</p>\n\n<pre><code>T.lines \n</code></pre>\n\n<p>?  </p>\n\n<p>If so, that seems a bit cumbersome, and would suggest making a Prelude package that is essentially PreludeWithoutPreludeText loading all the rest except this one--given the utility of <code>OverloadedStrings</code>.</p>\n"}, {"tags": ["haskell", "generics", "overloaded-strings"], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1555015904, "post_id": 55640936, "comment_id": 97972496, "body": "Huh.  Is there a syntax that would ask my ghci session to match the pragma requested on the module I&#39;m loading?  I&#39;m trying to load a lot of pragma as I work on this file--it seems like it would be easy to miss something in `:set -XOverloadedStrings -XDeriveGeneric&quot; etc., and kind of cumbersome to type up given it&#39;s already in the file."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1555016166, "post_id": 55640936, "comment_id": 97972576, "body": "@Mittenchops not as far as I\u2019m aware, and I don\u2019t think it\u2019d be as useful as you\u2019re imagining, because many language extensions aren\u2019t needed at use side (and in this case it\u2019s unneeded in your definition). You can set s number of default extensions to turn on though, depending on how exactly you start ghci."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1555049133, "post_id": 55640936, "comment_id": 97980209, "body": "Add your favorites to <code>~&#47;.ghci</code>"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 7, "last_activity_date": 1555015729, "creation_date": 1555015729, "answer_id": 55640936, "question_id": 55640770, "link": "https://stackoverflow.com/questions/55640770/haskell-using-overloadedstrings-but-getting-char-error-anyway/55640936#55640936", "title": "Haskell using OverloadedStrings, but getting [Char] error anyway", "body": "<p>You have enabled \u02cbOverloadedStrings\u02cb in your file, but that doesn\u2019t enable it in ghci as well. You\u2019d need \u02cb:set -XOverloadedStrings\u02cb for that. Note that the extension affects places where you write string literals, it doesn\u2019t matter whether or not it was enabled where you defined your data type.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 55640936, "answer_count": 1, "score": 0, "last_activity_date": 1555015796, "creation_date": 1555015017, "last_edit_date": 1555015796, "question_id": 55640770, "link": "https://stackoverflow.com/questions/55640770/haskell-using-overloadedstrings-but-getting-char-error-anyway", "title": "Haskell using OverloadedStrings, but getting [Char] error anyway", "body": "<p>I understand from questions like <a href=\"https://stackoverflow.com/questions/37894987/couldnt-match-expected-type-text-with-actual-type-char\">this</a> and <a href=\"https://stackoverflow.com/questions/38366802/error-couldnt-match-expected-type-char-with-actual-type-char\">this</a> that using the <code>PRAGMA OverloadedStrings</code> means I should be able to use Text as my string-type.</p>\n\n<p>However, as I test out <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">my data types</a> with Text, I get the following error:</p>\n\n<pre><code>$ stack ghci\nPrelude&gt; :l myfile.hs\nOk, one module loaded.\n*Main&gt; Rec \"asd\" \"m\"\n\n&lt;interactive&gt;:46:5: error:\n    \u2022 Couldn't match expected type \u2018Text\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the first argument of \u2018Rec\u2019, namely \u2018\"asd\"\u2019\n      In the expression: Rec \"asd\" \"m\"\n      In an equation for \u2018it\u2019: it = Rec \"asd\" \"m\"\n\n&lt;interactive&gt;:46:11: error:\n    \u2022 Couldn't match expected type \u2018Text\u2019 with actual type \u2018[Char]\u2019\n    \u2022 In the second argument of \u2018Rec\u2019, namely \u2018\"m\"\u2019\n      In the expression: Rec \"asd\" \"m\"\n      In an equation for \u2018it\u2019: it = Rec \"asd\" \"m\"\n</code></pre>\n\n<p>My code is as follows:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings,  DefaultSignatures,  TypeOperators,  FlexibleContexts, RecordWildCards, FlexibleInstances, ExtendedDefaultRules #-}\n\nimport qualified Data.Map as Map\nimport qualified Data.Set as Set\n-- import qualified Data.Text as T\nimport Data.Text (Text)\nimport GHC.Generics\n\ndata Rec  = Rec {\n     recCategory :: Text,\n     recId :: Text\n     } deriving Generic\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p>I see in <a href=\"https://stackoverflow.com/questions/26778415/using-overloaded-strings\">this question</a> a suggestion to:</p>\n\n<blockquote>\n  <p>EDIT You may also want to add default (Text) to the top of your module\n  to have it use Text instead of String by default.</p>\n</blockquote>\n\n<p>But it's not clear to me what the syntax would be that allows this default</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1555015957, "post_id": 55640713, "comment_id": 97972515, "body": "I\u2019m unsure what you\u2019re going for here. Your parentheses are wrong, that\u2019s foldr not foldl. The issue also isn\u2019t really in any way about commutativity, foldl already looks like what you\u2019d want to rewrite it to, it still isn\u2019t strict though."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1555016200, "post_id": 55640713, "comment_id": 97972590, "body": "In addition to Cubic&#39;s remarks, I believe you mean &quot;associative&quot; rather than &quot;commutative&quot;."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1555017279, "post_id": 55640713, "comment_id": 97972966, "body": "Thanks, I changed the question."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1555019981, "post_id": 55640713, "comment_id": 97973768, "body": "Note that in floating-point arithmetic, operations like <code>+</code> or <code>*</code> are <a href=\"https://en.wikipedia.org/wiki/Associative_property#Nonassociativity_of_floating_point_calculation\" rel=\"nofollow noreferrer\">not actually associative</a>; due to rounding errors, you can get very different results when using <code>foldr</code> vs <code>foldl</code> on the same list of numbers."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1555020599, "post_id": 55640713, "comment_id": 97973947, "body": "If the operation is known to be strict and associative, why not just use <code>foldl&#39;</code> anyway? The Prelude provides that function for this exact reason."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1555020815, "post_id": 55640713, "comment_id": 97974005, "body": "@SilvioMayolo - to be pedantic, <code>foldl&#39;</code> is not in Prelude, only in <code>Data.List</code> (agreed on always using that over <code>foldl</code> though)"}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1555100554, "post_id": 55640713, "comment_id": 98006380, "body": "<code>foldr</code> won&#39;t run in constant space because it is not tail recursive, that strictness won&#39;t save you at all"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1555017457, "creation_date": 1555014785, "last_edit_date": 1555017457, "question_id": 55640713, "link": "https://stackoverflow.com/questions/55640713/mark-associative-function-as-strict-in-haskell-to-avoid-space-leaks", "title": "Mark associative function as strict in Haskell to avoid space leaks", "body": "<p>For long time, I had difficulty in understanding why \"simple\" folds cause space leaks in Haskell. This <a href=\"https://queue.acm.org/detail.cfm?id=2538488\" rel=\"nofollow noreferrer\">article</a> is very helpful, but in a surprising way.</p>\n\n<p>I'll briefly quote the example of <code>foldr</code> applied to <code>+</code> which evaluates like this:</p>\n\n<pre><code>1 + (2 + sum1 [3..n])\n</code></pre>\n\n<p>Instead of:</p>\n\n<pre><code>(1 + 2) + sum1 [3..n]\n</code></pre>\n\n<p>As the comment suggests, even this isn't strict enough to run in constant space.</p>\n\n<p>This looks like the \"obvious\" thing compiler should do when function is known to be strict and associative. Should rewrite rules be used for this purpose? It's the only option I'm aware of (other than rewriting each instance manually).</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1555011824, "post_id": 55639928, "comment_id": 97970853, "body": "<code>getAnyTest s = head (optimalTests s)</code> or <code>getAnyTest = head . optimalTests</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1555013769, "post_id": 55639928, "comment_id": 97971621, "body": "There&#39;s no real way to answer this question (correctly) without knowing how <code>optimalTests</code> is defined. It may produce tests lazily, or it may not."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1555209716, "post_id": 55639928, "comment_id": 98029207, "body": "What we <i>can</i> say is that <code>head</code> will only scrutinize the first constructor of the list, regardless of what <code>optimalTests</code> does first."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1555011701, "post_id": 55640014, "comment_id": 97970782, "body": "Also, just to be clear....  <code>getAnyTest</code> itself is also defined lazily, so it won&#39;t even evaluate the first item unless you call <code>getAnyTest</code> in the main IO action."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1555013832, "post_id": 55640014, "comment_id": 97971649, "body": "You&#39;re just speculating on how <code>optimalTests</code> is structured. It could actually realize all the tests before yielding any."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 0, "last_activity_date": 1555011553, "creation_date": 1555011553, "answer_id": 55640014, "question_id": 55639928, "link": "https://stackoverflow.com/questions/55639928/will-this-function-be-evaluated-lazily/55640014#55640014", "title": "Will this function be evaluated lazily?", "body": "<p>You are correct, it will only create the first value, nothing else...</p>\n\n<p>You could test this by returning an array that crashes on the second element.</p>\n\n<pre><code>optimalTests _ = [aValidValue, error \"crash!\"]\n</code></pre>\n\n<p>If the program doesn't crash (it won't), that means it never tried to evaluate the second item.</p>\n"}, {"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": false, "score": 3, "last_activity_date": 1555012737, "creation_date": 1555012737, "answer_id": 55640263, "question_id": 55639928, "link": "https://stackoverflow.com/questions/55639928/will-this-function-be-evaluated-lazily/55640263#55640263", "title": "Will this function be evaluated lazily?", "body": "<p>I'd recommend messing about with the <code>:print</code> and <code>:sprint</code> commands in <code>ghci</code> to see lazy evaluation in action. For example:</p>\n\n<pre><code>Prelude&gt; let names = [\"Joe\", \"Jen\", \"Anne\"]\nPrelude&gt; let hellos = map ((++) \"Hello \") names\nPrelude&gt; head hellos\n\"Hello Joe\"\nPrelude&gt; :sprint hellos\nhellos = \"Hello Joe\" : _\nPrelude&gt; length hellos\n3\nPrelude&gt; :sprint hellos\nhellos = [\"Hello Joe\",_,_]\nPrelude&gt; last hellos\n\"Hello Anne\"\nPrelude&gt; :sprint hellos\nhellos = [\"Hello Joe\",_,\"Hello Anne\"]\n\n</code></pre>\n\n<p>That way you can see how the list is progressively evaluated as you call different functions on it. The <code>_</code> represents an unevaluated thunk.</p>\n\n<p>You could load your code into <code>ghci</code> and experiment in a similar way. Just make sure you assign things to variables or they will be evaluated by the REPL.</p>\n"}], "owner": {"reputation": 13, "user_id": 11347194, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42b4caad4fcd45ff7bb556e2078635eb?s=128&d=identicon&r=PG&f=1", "display_name": "Lostinfrance", "link": "https://stackoverflow.com/users/11347194/lostinfrance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1555015196, "creation_date": 1555011156, "last_edit_date": 1555015196, "question_id": 55639928, "link": "https://stackoverflow.com/questions/55639928/will-this-function-be-evaluated-lazily", "title": "Will this function be evaluated lazily?", "body": "<p>I'm trying to understand if the following function will be evaluated lazily.</p>\n\n<p>My understanding is \"head\" will take the first item from a list. Will optimalTests just evaluate the first item in [Test] or will all Tests in [Test] be created before head is subsequently called?</p>\n\n<pre><code>optimalTests :: State -&gt; [Test]\n\n--implementation here\n\ngetAnyTest :: State -&gt; Test\n\ngetAnyTest s = head(optimalTests s)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555010621, "post_id": 55639712, "comment_id": 97970307, "body": "The lazy one has to build up a giant list in memory before you actually call <code>putStr</code>. The strict one is calling <code>putStr</code> on each value immediately, and discarding the result of the action. No list is built, and constant space is used."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555010830, "post_id": 55639712, "comment_id": 97970408, "body": "@chepner I didn&#39;t show my c version, but it also calls <code>fwrite</code> per byte, so I doubt that an excess of <code>putStr</code> calls would make a difference."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555015761, "post_id": 55639712, "comment_id": 97972443, "body": "@chepner How does that explain why the lazy one is faster?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555017922, "post_id": 55639712, "comment_id": 97973159, "body": "Oh, good question. I had the two mixed up."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555020791, "post_id": 55639712, "comment_id": 97973997, "body": "I feel like the lazy one writes more than one byte at a time, no?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1555033700, "post_id": 55639712, "comment_id": 97976681, "body": "How are you compiling/running/timing?"}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1555081062, "post_id": 55644862, "comment_id": 97997570, "body": "You are correct....  I put in nanosecond level timing around <code>B.putStr</code> and <code>fwrite</code>, and can clearly see that the former is about 10x slower....  Now the question is why, and how do I get around this.  Either way, I&#39;ll consider this question solved."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1555104703, "last_edit_date": 1555104703, "creation_date": 1555045874, "answer_id": 55644862, "question_id": 55639712, "link": "https://stackoverflow.com/questions/55639712/in-ghc-why-is-the-lazy-version-of-this-small-program-so-much-faster-than-the-lo/55644862#55644862", "title": "In GHC- Why is the lazy version of this small program so much faster than the loop based variant?", "body": "<p><em>Updated:</em>  Added possible source of problem and a solution.</p>\n\n<p>I don't think it has anything to do with lazy I/O.  If you rewrite the strict I/O version to write two bytes at once:</p>\n\n<pre><code>theValueOne = B.singleton 1\nmain = replicateM_ 50000000 $ B.putStr (theValueOne &lt;&gt; theValueOne)\n</code></pre>\n\n<p>that halves the time.  Write ten bytes at once:</p>\n\n<pre><code>theValueOne = B.singleton 1\nmain = replicateM_ 10000000 $ B.putStr (foldMap id (replicate 10 theValueOne))\n</code></pre>\n\n<p>and it's already faster than the lazy I/O version.</p>\n\n<p>The issue is that there's a bit of overhead in a <code>B.hPutStr</code> call, much more than the overhead of a C <code>fwrite</code> call, and it's just not a particularly efficient way to write a single byte.</p>\n\n<p>A good chunk of the overhead comes from the fact that Haskell I/O buffers have immutable metadata.  Even though the buffer <em>content</em> itself is mutable, the pointers to valid data within the buffer <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-IO-Buffer.html\" rel=\"nofollow noreferrer\">are immutable</a>, and so writing a single byte requires a heap allocation of a new <code>GHC.IO.Buffer.Buffer</code> structure which GHC can't optimize away</p>\n\n<p>One solution is to use a hand-crafted buffering structure with a mutable pointer.  The following works, and it's about twice as fast as the lazy I/O version in the original question.</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Monad\nimport Data.IORef\nimport Data.Word\nimport Foreign.ForeignPtr\nimport Foreign.Ptr\nimport Foreign.Storable\nimport System.IO\n\ndata WriteBuffer = WriteBuffer\n  { handle :: !Handle\n  , capacity :: !Int\n  , used :: !(IORef Int)\n  , content :: !(ForeignPtr Word8)\n  }\n\nnewBuffer :: Handle -&gt; IO WriteBuffer\nnewBuffer h = do\n  hSetBinaryMode h True\n  hSetBuffering h NoBuffering\n  WriteBuffer h cap &lt;$&gt; newIORef 0 &lt;*&gt; mallocForeignPtrBytes cap\n  where cap = 4096\n\nflushBuffer :: WriteBuffer -&gt; IO ()\nflushBuffer WriteBuffer{..} = do\n  n &lt;- readIORef used\n  withForeignPtr content $ \\p -&gt; hPutBuf handle p n\n  writeIORef used 0\n\nwriteByte :: Word8 -&gt; WriteBuffer -&gt; IO ()\nwriteByte w buf@(WriteBuffer{..}) = do\n  n &lt;- readIORef used\n  withForeignPtr content $ \\p -&gt; poke (plusPtr p n) w\n  let n' = n + 1\n  writeIORef used n'\n  when (n' == capacity) $\n    flushBuffer buf\n\nmain :: IO ()\nmain = do\n  b &lt;- newBuffer stdout\n  replicateM_ 100000000 (writeByte 1 b)\n  flushBuffer b\n</code></pre>\n\n<p>Someone ironically, converting this to a version using an immutable counter  and passing the <code>WriteBuffer</code> as state through <code>foldM</code> doubles the speed again, so it's about 4 times as fast as the lazy I/O version in the original question:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Monad\nimport Data.Word\nimport Foreign.ForeignPtr\nimport Foreign.Ptr\nimport Foreign.Storable\nimport System.IO\n\ndata WriteBuffer = WriteBuffer\n  { handle :: !Handle\n  , capacity :: !Int\n  , used :: !Int\n  , content :: !(ForeignPtr Word8)\n  }\n\nnewBuffer :: Handle -&gt; IO WriteBuffer\nnewBuffer h = do\n  hSetBinaryMode h True\n  hSetBuffering h NoBuffering\n  WriteBuffer h cap 0 &lt;$&gt; mallocForeignPtrBytes cap\n  where cap = 4096\n\nflushBuffer :: WriteBuffer -&gt; IO WriteBuffer\nflushBuffer buf@WriteBuffer{..} = do\n  withForeignPtr content $ \\p -&gt; hPutBuf handle p used\n  return $ buf { used = 0 }\n\nwriteByte :: Word8 -&gt; WriteBuffer -&gt; IO WriteBuffer\nwriteByte w buf@(WriteBuffer{..}) = do\n  withForeignPtr content $ \\p -&gt; poke (plusPtr p used) w\n  let used' = used + 1\n      buf' = buf { used = used' }\n  if (used' == capacity)\n    then flushBuffer buf'\n    else return buf'\n\nmain :: IO ()\nmain = do\n  b &lt;- newBuffer stdout\n  b' &lt;- foldM (\\s _ -&gt; writeByte 1 s) b [(1::Int)..100000000]\n  void (flushBuffer b')\n</code></pre>\n\n<p>The reason this one is so fast seems to be that GHC is able to optimize away the <code>WriteBuffer</code> constructor entirely from the fold and just pass around unboxed pointers and integers in the loop.  My guess is that if I modified the mutable version above to avoid boxing and unboxing the integer in the <code>used</code> IORef, it would be similarly fast.</p>\n"}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 55644862, "answer_count": 1, "score": 2, "last_activity_date": 1555104703, "creation_date": 1555010307, "question_id": 55639712, "link": "https://stackoverflow.com/questions/55639712/in-ghc-why-is-the-lazy-version-of-this-small-program-so-much-faster-than-the-lo", "title": "In GHC- Why is the lazy version of this small program so much faster than the loop based variant?", "body": "<p>These two programs do the same thing, but one runs 10x faster.</p>\n\n<p>This takes approx. 10 seconds on my machine:</p>\n\n<pre><code>import Control.Monad\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Lazy as BL\n\ntheValueOne=B.singleton 1\n\nmain = replicateM_ 100000000 $ B.putStr theValueOne\n</code></pre>\n\n<p>The second version uses output-lazy IO.  It is done in about 1 second (as fast as c):</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\n\nmain = BL.putStr $ BL.pack $ replicate 100000000 1\n</code></pre>\n\n<p>Question: Why is the non-lazy version so slow?  More importantly, how can I make it fast?  (I've tried recursion, <code>forM</code>, modifying the output buffer using <code>hSetBuffering</code>...  Nothing has made a difference)</p>\n\n<hr>\n\n<p>Note- This is more than just an academic question.  The non-lazy version is an extremely simplified version of an executable my company uses in production, which is also slow in the same way.  It would be nearly impossible to re-architect the larger program around the analogous lazy solution.</p>\n"}, {"tags": ["haskell", "pragma"], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 12, "last_activity_date": 1555010859, "creation_date": 1555010859, "answer_id": 55639847, "question_id": 55639706, "link": "https://stackoverflow.com/questions/55639706/haskell-derivegeneric-pragma-not-being-recognized/55639847#55639847", "title": "Haskell DeriveGeneric pragma not being recognized", "body": "<p>You also need to import <code>GHC.Generics</code>:</p>\n\n<pre><code>-- other imports\nimport GHC.Generics\n-- more imports\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 55639847, "answer_count": 1, "score": 3, "last_activity_date": 1555010971, "creation_date": 1555010274, "question_id": 55639706, "link": "https://stackoverflow.com/questions/55639706/haskell-derivegeneric-pragma-not-being-recognized", "title": "Haskell DeriveGeneric pragma not being recognized", "body": "<p>I have the following at the top of my Haskell file:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric,  OverloadedStrings,  DefaultSignatures,  TypeOperators,  FlexibleContexts, RecordWildCards, FlexibleInstances, ExtendedDefaultRules #-}\n\nmodule Main where\n\nimport qualified Data.Map as Map\nimport qualified Data.Set as Set\nimport Data.Text (Text)\nimport Data.DateTime\nimport Data.Aeson\n\nnewtype Price = Price Float deriving Generic\n</code></pre>\n\n<p>However, when I run:</p>\n\n<pre><code>$ stack ghci\n...\nPrelude&gt; :l myfile.hs\n\n[1 of 1] Compiling Main             ( myfile.hs, interpreted )\n\nmyfile.hs:13:38: error:\n    Not in scope: type constructor or class \u2018Generic\u2019\n   |\n13 | newtype Price = Price Float deriving Generic\n   |                                      ^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>It seems to not accept my pragma for generics.  What am I doing wrong?  Looking at <a href=\"https://stackoverflow.com/questions/50314032/deriving-generic-doesnt-work-even-though-derivegeneric-is-on\">similar questions</a>, this seems like it should work.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 1, "creation_date": 1555003956, "post_id": 55638219, "comment_id": 97967484, "body": "Think about what the types <code>a</code>, <code>b</code>, and <code>f</code> are."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1555004246, "post_id": 55638219, "comment_id": 97967628, "body": "<code>fmap</code> is a method (in fact the only one) of the <code>Functor</code> typeclass. (Your type signature above is missing the <code>Functor f</code> constraint.)  As such, it has no &quot;standard&quot; definition, it needs to be defined separately for each <code>Functor</code> instance. However, each individual &quot;version&quot; of <code>fmap</code> is usually easy to define. For example <code>fmap</code> for lists is just <code>map</code>, and that has a very simple recursive definition if for some reason you don&#39;t want to use library function."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555004405, "post_id": 55638219, "comment_id": 97967704, "body": "And since you&#39;re only learning, I would say it&#39;s not worth worrying about Functors and <code>fmap</code> until you are more comfortable with the language, and typeclasses in particular. But certainly familiarise yourself with <code>map</code>. And I can thoroughly recommend <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">learnyouahaskell.com/chapters</a> as a brilliant resource for learning Haskell from scratch."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 2, "creation_date": 1555005486, "post_id": 55638219, "comment_id": 97968126, "body": "<code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code> is a type, not a definition."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555014314, "post_id": 55638219, "comment_id": 97971848, "body": "@RobinZigmond, in fact not the only one. <code>&lt;$</code> is the other one."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1555015860, "post_id": 55638219, "comment_id": 97972475, "body": "@dfeuer good point. I always forget that. (Of course it has a default implementation so I assume it&#39;s rare to actually define it.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1555016670, "post_id": 55638219, "comment_id": 97972757, "body": "@RobinZigmond, for non-recursive types, it usually doesn&#39;t help. For recursive ones, <i>derived</i> instances usually do a good job. But hand-written recursive ones usually need help to be optimal. Also, a few types (like <code>Data.Sequence.Seq</code>) can pull magic tricks with <code>&lt;$</code> performance."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1555004917, "creation_date": 1555004917, "answer_id": 55638474, "question_id": 55638219, "link": "https://stackoverflow.com/questions/55638219/can-fmap-be-written-as-a-function-instead-of-being-called-from-the-library/55638474#55638474", "title": "Can fmap be written as a function instead of being called from the library?", "body": "<p>You can certainly write specific functions like <code>mapList :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> and <code>mapMaybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code>.  It sounds as though you haven't learned about type classes yet; you will need them to generalize <code>mapList</code> &amp; <code>mapMaybe</code> to <code>fmap</code>.</p>\n\n<p>You can also read the <strong>source</strong> links in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fmap\" rel=\"nofollow noreferrer\">the docs for <code>fmap</code></a></p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 5, "last_activity_date": 1555006165, "creation_date": 1555006165, "answer_id": 55638766, "question_id": 55638219, "link": "https://stackoverflow.com/questions/55638219/can-fmap-be-written-as-a-function-instead-of-being-called-from-the-library/55638766#55638766", "title": "Can fmap be written as a function instead of being called from the library?", "body": "<p><code>fmap</code> is a member of the <code>Functor</code> typeclass, defined like so:</p>\n\n<pre><code>class Functor f where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>This means that each type that\u2019s an instance of <code>Functor</code> has its own specialised implementation of <code>fmap</code>:</p>\n\n<pre><code>-- For making type signatures in instances explicit\n{-# LANGUAGE InstanceSigs #-}\n\ninstance Functor Maybe where\n  fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n  fmap f (Just x) = Just (f x)\n  fmap f Nothing = Nothing\n\ninstance Functor [] where\n  fmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n  fmap f (x : xs) = f x : fmap f xs\n  fmap f [] = []\n  -- Or: fmap = map\n</code></pre>\n\n<p>When you call <code>fmap</code> at a particular type, the compiler automatically selects the appropriate instance to use:</p>\n\n<pre><code>-- For making type arguments explicit\n{-# LANGUAGE TypeApplications #-}\n\nfmap succ (Just 1)\n==\nfmap @Maybe succ (Just 1)\n==\nJust 2\n\nfmap succ [1, 2, 3]\n==\nfmap @[] succ [1, 2, 3]\n==\n[2, 3, 4]\n</code></pre>\n\n<p>You could of course use specialised functions directly instead of <code>fmap</code>\u2014we would just have separate functions <code>fmapMaybe</code>, <code>fmapList</code> (<code>map</code>), <code>fmapEither</code>, <code>fmapIO</code>, and so on. However, the advantage of using <code>fmap</code>, or typeclasses in general, is that you can write <em>polymorphic</em> functions, which work on <em>any</em> instance of that typeclass:</p>\n\n<pre><code>fmapBoth :: (Functor f) =&gt; (a -&gt; b) -&gt; f (a, a) -&gt; f (b, b)\nfmapBoth f m = fmap (\\ (x, y) -&gt; (f x, f y)) m\n\nfmapBoth succ (Just (1, 2))\n==\nfmapBoth @Maybe succ (Just (1, 2))\n==\nJust (2, 3)\n\nfmapBoth succ [(1, 2), (2, 3)]\n==\nfmapBoth @[] succ [(1, 2), (2, 3)]\n==\n[(2, 3), (3, 4)]\n</code></pre>\n\n<p>Internally, GHC implements this by passing the particular implementation of <code>fmap</code> as an extra argument to the function you defined:</p>\n\n<pre><code>fmapBoth'\n  :: ((a -&gt; b) -&gt; f a -&gt; f b)\n  -&gt; (a -&gt; b)\n  -&gt; f (a, a)\n  -&gt; f (b, b)\nfmapBoth' fmapF f m = fmapF (\\ (x, y) -&gt; (f x, f y)) m\n\nfmapBoth @[] succ [(1, 2), (2, 3)]\n==\nfmapBoth' map succ [(1, 2), (2, 3)]\n==\nmap (\\ (x, y) -&gt; (succ x, succ y)) [(1, 2), (2, 3)]\n==\n[(2, 3), (3, 4)]\n</code></pre>\n\n<p>So you can think of a typeclass constraint like <code>Num a =&gt; \u2026</code> or <code>Functor f =&gt; \u2026</code> as an additional argument to a function, which happens to be passed implicitly by the compiler, containing a record of all the methods in the particular typeclass. (In fact, the <code>ImplicitParams</code> extension lets you use this machinery for implicit arguments of <em>any</em> type, although that extension isn\u2019t widely used, since there are generally better alternatives like <code>Reader</code>.)</p>\n\n<p>Part of the advantage of using <code>fmap</code> instead of specialised functions is that it lets you \u201ccode to the interface, not the implementation\u201d\u2014for example, if you\u2019re using lists in your program and later want to change to <code>Vector</code> for performance reasons, if you\u2019ve used polymorphic functions like <code>fmap</code> everywhere, then you can simply swap out the type and your code will continue to work without modification\u2014but if you\u2019ve used the <code>map</code> particular to lists, then you will need to update every call site.</p>\n\n<p>The original purpose of typeclasses was to <em>avoid</em> having specialised functions for things like comparisons (<code>Eq</code> and <code>Ord</code>) and arithmetic (<code>Num</code>)\u2014if we didn\u2019t have this polymorphism, then we would need separate functions like <code>eqInt</code>, <code>eqFloat</code>, <code>eqChar</code>, &amp;c. everywhere. Typeclasses let us abstract over this and write <code>==</code> regardless of the particular type, and have the compiler insert a call to the appropriate function.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 55638766, "answer_count": 2, "score": 2, "last_activity_date": 1555006165, "creation_date": 1555003909, "question_id": 55638219, "link": "https://stackoverflow.com/questions/55638219/can-fmap-be-written-as-a-function-instead-of-being-called-from-the-library", "title": "Can fmap be written as a function instead of being called from the library?", "body": "<p>i'm trying to understand fmap in relation to a function and I was wondering if there was a \"simple\" way to write out a function that accomplishes the same fmap instead of calling it from the function library?</p>\n\n<p>I'm new to haskell so when I'm checking references, I see a lot of things that my class hasn't gone over yet - and I'm trying to stay ahead of the curve because it's extremely hard and moves quickly.</p>\n\n<p>The library definition of fmap is:</p>\n\n<pre><code> fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>I'm wondering if, with some other function, <code>fmap</code> could be written like a helper function to the function implementing <code>fmap</code>.</p>\n\n<p>The output would then be exactly as if <code>fmap</code> was used but instead we replaced it with a helper function that accomplishes the same task. Is it even possible?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1554996028, "post_id": 55635934, "comment_id": 97963173, "body": "It seems to me that you&#39;re mixing up a true binary tree (which would have a rather different-looking <code>data</code> declaration) with your version where you pass a list of subtrees. (To be a true binary tree that list would only ever have 2 elements, but this type doesn&#39;t enforce that, and you&#39;ve given an example with 3.)"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1555007711, "post_id": 55635934, "comment_id": 97969074, "body": "A postorder traversal is where you process all of the children of the branch, and then process the value in the branch. You&#39;re not storing values in the branches though, only in the leaves, so the idea of a postorder or preorder traversal is meaningless with this structure. What the code you wrote would actually do (if written properly) is process the third child, fourth child, etc on to the last child, then the first child, then the second child, in that order. I doubt that&#39;s what you&#39;re going for."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "edited": false, "score": 1, "creation_date": 1554999830, "post_id": 55636718, "comment_id": 97965432, "body": "What does &lt;$&gt; mean? Could I substitute something else for it? I&#39;m unfamiliar with it."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1555000377, "post_id": 55636718, "comment_id": 97965749, "body": "@Francis <code>&lt;$&gt;</code> is the infix alias of <code>fmap</code>. It&#39;s use is equivalent to <code>fmap postord right</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "edited": false, "score": 1, "creation_date": 1555000816, "post_id": 55636718, "comment_id": 97965969, "body": "Is there any way I can write that as a helper function instead using &lt;$&gt;? It&#39;s too advanced for me and I&#39;m wondering if I can show the way it&#39;s working instead of calling &lt;$&gt; of fmap?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1555003267, "post_id": 55636718, "comment_id": 97967153, "body": "@Francis Are you familiar with <code>map</code>? For lists, <code>fmap = map</code>"}, {"owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "edited": false, "score": 0, "creation_date": 1555014502, "post_id": 55636718, "comment_id": 97971920, "body": "I aligned with respect to @chepner&#39;s answer."}], "tags": [], "owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "is_accepted": false, "score": 0, "last_activity_date": 1555014452, "last_edit_date": 1555014452, "creation_date": 1554998359, "answer_id": 55636718, "question_id": 55635934, "link": "https://stackoverflow.com/questions/55635934/postorder-traversal-of-binary-tree-with-recursive-data-type/55636718#55636718", "title": "Postorder traversal of binary tree with recursive data type", "body": "<p>Don't know if I understood your question, but what about this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>postord :: BiTree a -&gt; [a]\npostord (L x) = [x]\npostord (N cs) = concatMap postord cs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1555008027, "last_edit_date": 1555008027, "creation_date": 1555006219, "answer_id": 55638780, "question_id": 55635934, "link": "https://stackoverflow.com/questions/55635934/postorder-traversal-of-binary-tree-with-recursive-data-type/55638780#55638780", "title": "Postorder traversal of binary tree with recursive data type", "body": "<p><code>N</code> doesn't have specific left and right children, and it certainly doesn't have any distinguished root value; it <em>just</em> has an arbitrary list of children.</p>\n\n<p>You <code>BiTree</code> only stores values in the leaves. The only thing to do with an <code>N</code> value is map <code>postord</code> on to each child, and concatenate the results into a single list. (As such, there's no real difference between the pre-, in-, and post-order traversals.)</p>\n\n<pre><code>postord :: BiTree a -&gt; [a]\npostord (L x)         = [x]\npostord (N children)  = concatMap postord children\n</code></pre>\n\n<p>Now, if you had a type that <em>did</em> store values in the internal nodes, your type might look like</p>\n\n<pre><code>data BiTree a = L a | N a [BiTree a]\n</code></pre>\n\n<p>Then your post-order traversal would have to account for the value stored in an internal node, similar to your previous attempt.</p>\n\n<pre><code>postord :: BiTree a -&gt; [a]\npostord (L x) = [x]\npostord (N v children) = concatMap postord children ++ [v]\n</code></pre>\n\n<p>Appending a single value to a longer list isn't ideal, but that's a problem for another question.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11340751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 55638780, "answer_count": 2, "score": 0, "last_activity_date": 1555014452, "creation_date": 1554995820, "question_id": 55635934, "link": "https://stackoverflow.com/questions/55635934/postorder-traversal-of-binary-tree-with-recursive-data-type", "title": "Postorder traversal of binary tree with recursive data type", "body": "<p>I'm trying to create a function for a post-order traversal of a recursive data type that creates an binary tree where the examples could create as many child leafs as possible. I've tried to set the nodes to left:root:right but the error doesn't recognize them - however, it would recognize (y:ys). It also recognizes root as an Int no matter if I use () or [] or nothing around it. What am I missing?</p>\n\n<p>This is the data type and some easy examples to test it with:</p>\n\n<pre><code>data BiTree a = L a\n            | N [BiTree a]\n\nex1 :: BiTree Int\nex1 = N [(L 1),(L 1),(L 3)]\n\nex2 :: BiTree Int\nex2 = N [(L 1),(N[(L 2),(L 3)]),(L 4)]\n</code></pre>\n\n<p>Here's the code I wrote:</p>\n\n<pre><code>postord :: BiTree a -&gt; [Int]\npostord (L x)                  = [x]\npostord (N (left:root:right))  = postord (N right) ++ postord (N left) ++ [root]\n</code></pre>\n\n<p>Here's the error:</p>\n\n<pre><code>* Couldn't match expected type `Int' with actual type `BiTree a'\n* In the expression: root\n  In the second argument of `(++)', namely `[root]'\n  In the second argument of `(++)', namely\n    `postord (N left) ++ [root]'\n* Relevant bindings include\n    right :: [BiTree a] (bound at try.hs:21:23)\n    root :: BiTree a (bound at try.hs:21:18)\n    left :: BiTree a (bound at try.hs:21:13)\n    postord :: BiTree a -&gt; [Int] (bound at try.hs:20:1)\n|\n21 | postord (N (left:root:right)) = postord (N right) ++ postord (N left) ++ [root]\n|                                                         ^^^^\n</code></pre>\n\n<p>I don't understand why left:right:root won't bind, and why recalling postord in the list with appends won't compile a list of every node within the right node, left node, and root as it is.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1554993528, "post_id": 55635083, "comment_id": 97961487, "body": "Hint: you need to pull from 2 separate lists (not a concatenation of 2), and the &quot;numbers&quot; list should be the infinite list <code>[1..]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 5380134, "user_type": "registered", "profile_image": "https://graph.facebook.com/634477866654806/picture?type=large", "display_name": "Jack Barber", "link": "https://stackoverflow.com/users/5380134/jack-barber"}, "edited": false, "score": 0, "creation_date": 1554997051, "post_id": 55635383, "comment_id": 97963818, "body": "Thank you very much, but how would it get it to have &quot;a&quot;, &quot;b&quot; ... &quot;z&quot; at the start of the list?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 17, "user_id": 5380134, "user_type": "registered", "profile_image": "https://graph.facebook.com/634477866654806/picture?type=large", "display_name": "Jack Barber", "link": "https://stackoverflow.com/users/5380134/jack-barber"}, "edited": false, "score": 3, "creation_date": 1554998274, "post_id": 55635383, "comment_id": 97964575, "body": "@JackBarber, use <code>++</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1555008939, "post_id": 55635383, "comment_id": 97969623, "body": "Pull <code>x</code> from <code>[0..]</code>, and replace <code>show x</code> with <code>(if x == 0 then [] else show x)</code>."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 5, "last_activity_date": 1555038671, "last_edit_date": 1555038671, "creation_date": 1554994099, "answer_id": 55635383, "question_id": 55635083, "link": "https://stackoverflow.com/questions/55635083/how-to-make-an-infinite-list-of-a-z-concatenated-with-1-then-2-etc/55635383#55635383", "title": "How to make an infinite list of a..z concatenated with 1, then 2, etc", "body": "<p>Use a comprehension a an infinite sequence:</p>\n\n<pre><code>Prelude&gt; let variables = [l:show x | x &lt;- [1..],  l &lt;- ['a'..'z']]\nPrelude&gt; take 100 variables\n[\"a1\",\"b1\",\"c1\",\"d1\",\"e1\",\"f1\",\"g1\",\"h1\",\"i1\",\"j1\",\"k1\",\"l1\",\"m1\",\"n1\",\"o1\",\"p1\",\"q1\",\"r1\",\"s1\",\"t1\",\"u1\",\"v1\",\"w1\",\"x1\",\"y1\",\"z1\",\"a2\",\"b2\",\"c2\",\"d2\",\"e2\",\"f2\",\"g2\",\"h2\",\"i2\",\"j2\",\"k2\",\"l2\",\"m2\",\"n2\",\"o2\",\"p2\",\"q2\",\"r2\",\"s2\",\"t2\",\"u2\",\"v2\",\"w2\",\"x2\",\"y2\",\"z2\",\"a3\",\"b3\",\"c3\",\"d3\",\"e3\",\"f3\",\"g3\",\"h3\",\"i3\",\"j3\",\"k3\",\"l3\",\"m3\",\"n3\",\"o3\",\"p3\",\"q3\",\"r3\",\"s3\",\"t3\",\"u3\",\"v3\",\"w3\",\"x3\",\"y3\",\"z3\",\"a4\",\"b4\",\"c4\",\"d4\",\"e4\",\"f4\",\"g4\",\"h4\",\"i4\",\"j4\",\"k4\",\"l4\",\"m4\",\"n4\",\"o4\",\"p4\",\"q4\",\"r4\",\"s4\",\"t4\",\"u4\",\"v4\"]\n</code></pre>\n\n<p>Just use <code>(++)</code> over that list and <code>['a'..'z']</code> to prepend the single char lists, notice that since <code>'a' :: char</code> you need to transform it to <code>String</code> beforehand</p>\n\n<pre><code>Prelude&gt; let variables = [l:[] | l &lt;- ['a'..'z']] ++ [l:show x | x &lt;- [1..],  l &lt;- ['a'..'z']]\nPrelude&gt; take 100 variables\n[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\",\"a1\",\"b1\",\"c1\",\"d1\",\"e1\",\"f1\",\"g1\",\"h1\",\"i1\",\"j1\",\"k1\",\"l1\",\"m1\",\"n1\",\"o1\",\"p1\",\"q1\",\"r1\",\"s1\",\"t1\",\"u1\",\"v1\",\"w1\",\"x1\",\"y1\",\"z1\",\"a2\",\"b2\",\"c2\",\"d2\",\"e2\",\"f2\",\"g2\",\"h2\",\"i2\",\"j2\",\"k2\",\"l2\",\"m2\",\"n2\",\"o2\",\"p2\",\"q2\",\"r2\",\"s2\",\"t2\",\"u2\",\"v2\",\"w2\",\"x2\",\"y2\",\"z2\",\"a3\",\"b3\",\"c3\",\"d3\",\"e3\",\"f3\",\"g3\",\"h3\",\"i3\",\"j3\",\"k3\",\"l3\",\"m3\",\"n3\",\"o3\",\"p3\",\"q3\",\"r3\",\"s3\",\"t3\",\"u3\",\"v3\"]\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 5380134, "user_type": "registered", "profile_image": "https://graph.facebook.com/634477866654806/picture?type=large", "display_name": "Jack Barber", "link": "https://stackoverflow.com/users/5380134/jack-barber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555038671, "creation_date": 1554993263, "question_id": 55635083, "link": "https://stackoverflow.com/questions/55635083/how-to-make-an-infinite-list-of-a-z-concatenated-with-1-then-2-etc", "title": "How to make an infinite list of a..z concatenated with 1, then 2, etc", "body": "<p>I'm trying to create an infinite list in Haskell which takes the letters a..z and then repeats them suffixed with 1 (\"a1 ... z1\"), then 2 (\"a2\"..\"z2\"), etc. </p>\n\n<p>At the moment the furthest I've got is using a list comprehension to generate a list of every string combination possible from the two lists of a-z and 1-9,\nhowever I can't figure out how to then apply this to my problem. I have also tried to use the map function but couldn't figure how to apply it to my problem either</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>variables :: [Var]\nvariables = [x : y | y &lt;- \"\" : variables, x &lt;- ['a'..'z'] ++ ['0'..'9']]\n</code></pre>\n\n<p>Typing <code>[variables !! i | i &lt;- [0,1,25,26,27,100,3039]]</code> into ghci should give:\n<code>[\"a\",\"b\",\"z\",\"a1\",\"b1\",\"w3\",\"x116\"]</code>, but at the moment the result I'm getting is: <code>[\"a\",\"b\",\"z\",\"0\",\"1\",\"2b\",\"plb\"]</code>. Any help would be much appreciated</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1554998633, "creation_date": 1554998633, "answer_id": 55636812, "question_id": 55634152, "link": "https://stackoverflow.com/questions/55634152/the-constraint-matched-an-in-instance-declaration-monolocalbinds/55636812#55636812", "title": "The constraint matched an in instance declaration - MonoLocalBinds", "body": "<p>I think you are just asking for constraint synonyms?</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n\ntype FooThenBar foo bar b = (Foo foo bar, Bar bar b)\n\nf' :: (FooThenBar foo bar b) =&gt; foo -&gt; b\nf' x = bar (foo x)\n\ng' = f' (A (B \"1\"))  -- \"1\"\n</code></pre>\n"}], "owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 55636812, "answer_count": 1, "score": 2, "last_activity_date": 1555068388, "creation_date": 1554990722, "last_edit_date": 1555010569, "question_id": 55634152, "link": "https://stackoverflow.com/questions/55634152/the-constraint-matched-an-in-instance-declaration-monolocalbinds", "title": "The constraint matched an in instance declaration - MonoLocalBinds", "body": "<p>The code is intended to take simple type classes that (at this point) model functional relationships between types.</p>\n\n<pre><code>&gt; {-# LANGUAGE MultiParamTypeClasses #-}\n&gt; {-# LANGUAGE ScopedTypeVariables #-}\n&gt; {-# LANGUAGE AllowAmbiguousTypes #-}\n&gt; {-# LANGUAGE FlexibleInstances #-}\n&gt; {-# LANGUAGE FlexibleContexts #-}\n&gt; {-# LANGUAGE FunctionalDependencies #-}\n\n&gt; class Foo a b | a -&gt; b where\n&gt;     foo :: a -&gt; b\n&gt;     \n&gt; class Bar a b | a -&gt; b where\n&gt;     bar :: a -&gt; b\n\n&gt; data A a = A a\n&gt; data B b = B b\n\n&gt; instance Foo (A a) a where\n&gt;   foo (A a) = a\n\n&gt; instance Bar (B b) b where\n&gt;   bar (B b) = b\n\n&gt; f :: (Bar bar b, Foo foo bar) =&gt; foo -&gt; b\n&gt; f x = bar (foo x)\n\n&gt; --g :: String\n&gt; g = f (A (B \"1\"))\n</code></pre>\n\n<p>Imagine thats there's lots of these typeclasses, that you want to compose tother, but if you specify the types explicitly you don't want to specify every single one, you want a short hand or an alias for them</p>\n\n<p>maybe compose these typeclasses into new typeclasses so that ammending one of the axiomatic classes, will automatically flow through to the derived ones.</p>\n\n<pre><code>&gt; class (Foo foo bar,Bar bar a) =&gt; FooThenBar foo bar a where\n</code></pre>\n\n<p>and you can define</p>\n\n<pre><code>&gt; f' :: (FooThenBar foo bar b) =&gt; foo -&gt; b\n&gt; f' x = bar (foo x)\n</code></pre>\n\n<p>but you can't go</p>\n\n<pre><code>&gt; f' x = bar (foo x)\n&gt; g' = f' (A (B \"1\"))\n</code></pre>\n\n<p>because the type of (A (B \"1\")), doesnt inhabit FooThenBar...</p>\n\n<p>so you create an instance...</p>\n\n<pre><code>&gt; instance (Bar bar b, Foo foo bar) =&gt; FooThenBar foo bar b\n</code></pre>\n\n<p>and GHC complains</p>\n\n<pre><code>\u2022 The constraint \u2018FooThenBar foo bar b\u2019\n    matches an instance declaration\n  instance (Bar bar b, Foo foo bar) =&gt; FooThenBar foo bar b\n    -- Defined at catdog.lhs:37:12\n  This makes type inference for inner bindings fragile;\n    either use MonoLocalBinds, or simplify it using the instance\n\u2022 In the type signature: f' :: (FooThenBar foo bar b) =&gt; foo -&gt; b\n</code></pre>\n\n<p>ok...you put the MonoLocalBinds in...</p>\n\n<pre><code>&gt; {-# LANGUAGE MonoLocalBinds #-}\n</code></pre>\n\n<p>and it works...but there is a bit of an alarm bell going off...I'm obviously logically saying...</p>\n\n<p>FooThenBar a b c &lt;=> (Foo a b, Bar b c)</p>\n\n<p>is that a problem?...I potentially want to create a LOT of these, I feel as if I'm sort of abusing the system, and Ghc is hinting this may cause problems later?</p>\n"}, {"tags": ["haskell", "parallel-processing", "stm"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1554984570, "post_id": 55631884, "comment_id": 97955359, "body": "I&#39;ve not used STM before, but it seems your proposed explanation is plausible, there is nothing preventing other threads executing between the 2nd and 3rd liftIO. If you want to print directly the new value, i would use <code>liftIO $ print =&lt;&lt; atomically (stateTVar counter (\\c -&gt; (c+1,c+1)))</code> (might need to massage that a bit)"}], "answers": [{"tags": [], "owner": {"reputation": 24594, "user_id": 148195, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/386f66584492acb26272c930891400e6?s=128&d=identicon&r=PG", "display_name": "mk12", "link": "https://stackoverflow.com/users/148195/mk12"}, "is_accepted": false, "score": 2, "last_activity_date": 1554996531, "last_edit_date": 1554996531, "creation_date": 1554986831, "answer_id": 55632877, "question_id": 55631884, "link": "https://stackoverflow.com/questions/55631884/questions-about-parallelism-and-do/55632877#55632877", "title": "Questions about parallelism and `do`", "body": "<p>There are a couple problems with your code. First, as you point out, anything can happen in between the 2nd and 3rd <code>liftIO</code>s (that is, between incrementing the counter and reading it again). You can restructure the code like this to fix that:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n  counter &lt;- newTVarIO 0\n  scotty 3000 $\n    get \"/:word\" $ do\n      -- wrap IO in do-block to avoid repeating liftIO\n      liftIO $ do\n        threadDelay 1000000\n        -- Remember the value instead of reading it again.\n        value &lt;- atomically $ do\n          x &lt;- readTVar counter\n          let x' = x + 1\n          writeTVar counter x'\n          return x'\n        print value\n      beam &lt;- param \"word\"\n      html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]\n</code></pre>\n\n<p>This will fix the missing numbers and duplicated numbers. However, the output still looks messy because of interleaved <code>print</code> results. You could fix that by following the suggestion in <a href=\"https://stackoverflow.com/questions/2981984/can-i-ensure-that-haskell-performs-atomic-io\">Can I ensure that Haskell performs atomic IO?</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n  counter &lt;- newTVarIO 0\n  -- Create a lock for printing.\n  lock &lt;- newMVar ()\n  scotty 3000 $\n    get \"/:word\" $ do\n      liftIO $ do\n        threadDelay 1000000\n        value &lt;- atomically $ do\n          x &lt;- readTVar counter\n          let x' = x + 1\n          writeTVar counter x'\n          return x'\n        -- Hold a lock while printing.\n        withMVar lock $ \\_ -&gt; print value\n      beam &lt;- param \"word\"\n      html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]\n</code></pre>\n\n<p>This cleans up the output, but it still doesn't guarantee the numbers will be printed in sequence, since anything can happen in between the <code>atomically</code> and <code>withMVar</code> sections. When I ran it, as expected the output was mostly in sequence (numbers 1 through 2180) but with a few exceptions.</p>\n\n<p>There might be a way of performing both the increment and print atomically, but the STM monad isn't designed to make that easy. In particular, see all the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Conc.html#v:atomically\" rel=\"nofollow noreferrer\">warnings about using unsafe IO with <code>atomically</code></a>.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1555025600, "creation_date": 1554983641, "last_edit_date": 1555025600, "question_id": 55631884, "link": "https://stackoverflow.com/questions/55631884/questions-about-parallelism-and-do", "title": "Questions about parallelism and `do`", "body": "<p>I have the following Scotty app:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Web.Scotty\nimport Data.Monoid (mconcat)\nimport Control.Concurrent.STM\nimport Control.Monad.IO.Class\nimport Control.Concurrent\n\nmain :: IO ()\nmain = do\n  counter &lt;- newTVarIO 0\n  scotty 3000 $\n    get \"/:word\" $ do\n      liftIO $ threadDelay 1000000\n      liftIO $ atomically $ do\n        counter' &lt;- readTVar counter\n        writeTVar counter (counter' + 1)\n      liftIO $ do\n        counter' &lt;- atomically (readTVar counter)\n        print counter'\n      beam &lt;- param \"word\"\n      html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]\n</code></pre>\n\n<p>And am invoking the exposed endpoint like this (200 concurrent requests):</p>\n\n<pre><code>wrk -c 200 -t 20 -d 10 http://127.0.0.1:3000/z\n</code></pre>\n\n<p>I was expecting the value of the <code>counter'</code> to be printed sequentially. However, some numbers are missing, and some are duplicated (for example <code>147</code> is there twice, but <code>146</code> is not there at all).</p>\n\n<p>Two questions:</p>\n\n<ol>\n<li><p>The only way this can happen I think is that the second <code>liftIO</code> is not necessarily followed by the third <code>liftIO</code>. Is this correct? Or is there another explanation for it?</p></li>\n<li><p>How can I print the value of <code>counter'</code> in the second <code>liftIO</code>? I'm not sure how to place it between (or after) <code>readTVar</code> and <code>writeTVar</code>.</p></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1554979667, "post_id": 55630542, "comment_id": 97952566, "body": "I&#39;m certainly no expert on any of this, but for worry #1 what I think is happening is that, when you omit the type signature, GHC is seeing that it needs to have an instance <code>Foo (A String) b</code> and can&#39;t figure out what <code>b</code> is. I guess it&#39;s not capable of seeing that your script has only one such instance in this case (with <code>b</code> being <code>String</code>) - if you had more than one then it would certainly have just cause to complain about an ambiguity."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1554979882, "post_id": 55630542, "comment_id": 97952679, "body": "as for the second one, this is even further away from my comfort zone, but I would guess that GHC has no idea what <code>a1</code> is, and can&#39;t read the constraints as saying &quot;I want there to be some type <code>a1</code> for which the constraints <code>Bar a1 b</code> and <code>Foo a2 a1</code> hold simultaneously&quot;. Not sure how you could set this up (or if it&#39;s possible at all) so I will leave that to others more knowledgeable."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1554980493, "post_id": 55630813, "comment_id": 97952995, "body": "Nice answer, I thought of Functional Dependencies (although it&#39;s something else I&#39;m very inexpert on) but for some reason I momentarily (and incorrectly!) thought they were for type declarations rather than classes."}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1554982888, "post_id": 55630813, "comment_id": 97954418, "body": "achchchc....of course...I have in a previous dabble into Haskell, done the dependent type stuff...the other way (type functions?) but yes...I completely get it....this cog is now engaged"}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1554983021, "post_id": 55630813, "comment_id": 97954498, "body": "as an aside....why does GHC infer a type, that it then afterwards rejects?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1554984133, "post_id": 55630813, "comment_id": 97955099, "body": "@MrD I don&#39;t quite understand what you&#39;re asking there - could you elaborate?"}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1554985490, "post_id": 55630813, "comment_id": 97955918, "body": "&quot;so ghc is telling me the type it inferred without a type declaration, its now not sure about!&quot;....in my original code, I ask GHCi for the type of f....and then paste the type into the code....but the GHC rejects this type."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 1, "creation_date": 1554988695, "post_id": 55630813, "comment_id": 97958045, "body": "@MrD The problem is that, although GHC knows there is a <code>Foo a2 a1</code> instance lying around, and that <code>x :: a2</code>, it doesn&#39;t know that you definitely want <code>foo x :: a1</code> and not, say, <code>foo x :: Int</code> or something else, hence it doesn&#39;t know to use the <code>Foo a2 a1</code> instance instead of, say, searching for a <code>Foo a2 Int</code> instance in its global list of instances. You can tell it what you want by adding an explicit <code>forall</code> to the type signature, <code>f :: forall a1 a2 b. (Bar a1 b, Foo a2 a1) =&gt; a2 -&gt; b</code>, and adding a type annotation to the body, <code>f x = bar (foo x :: a1)</code>."}, {"owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "edited": false, "score": 0, "creation_date": 1554989292, "post_id": 55630813, "comment_id": 97958501, "body": "ok...I don&#39;t massive understand...but lets leave it there...more cogs need to reengage"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 2, "last_activity_date": 1554980097, "creation_date": 1554980097, "answer_id": 55630813, "question_id": 55630542, "link": "https://stackoverflow.com/questions/55630542/haskell-type-class-confusion-inferred-types-cannot-be-deduced/55630813#55630813", "title": "Haskell type class confusion, inferred types cannot be deduced", "body": "<p>Let's look at your example again:</p>\n\n<pre><code>&gt; class Foo a b where\n&gt;     foo :: a -&gt; b\n</code></pre>\n\n<p>The problem here is that a given <code>a</code> could correspond to multiple given <code>b</code>s; you could have, for example, both <code>instance Foo Int Char</code> and <code>instance Foo Int Bool</code>. This causes the problems with type inference you've been seeing.</p>\n\n<pre><code>&gt; f1 x = foo x\n&gt; f2 x = bar x\n\n&gt; x1 :: String\n&gt; x1 = f1 $ A \"1\"\n&gt; x2 :: String\n&gt; x2 = f2 $ B \"1\"\n</code></pre>\n\n<p>Here, for example, you've specified both <code>a</code> and <code>b</code>, so GHC knows you're talking about <code>instance (A String) String</code>. When you remove the signatures, GHC doesn't know what <code>b</code> to use. You haven't defined any other instances, and you don't intend to, but GHC doesn't know that.</p>\n\n<p>So how do we fix this problem? We use <code>{-# LANGUAGE FunctionalDependencies #-}</code>:</p>\n\n<pre><code>&gt; class Foo a b | a -&gt; b where\n&gt;     foo :: a -&gt; b\n</code></pre>\n\n<p>Basically, this tells GHC that for any given <code>a</code>, there is only one corresponding <code>b</code>. This should resolve your problems (although admittedly I haven't tested this yet). For more on functional dependencies, see <a href=\"https://stackoverflow.com/a/20040343/7345298\">this SO answer</a>, which also addresses your <code>bar (foo x)</code> problem.</p>\n"}], "owner": {"reputation": 1249, "user_id": 2088029, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a7ae522f4de7727b0baaaef4d813d6?s=128&d=identicon&r=PG", "display_name": "MrD at KookerellaLtd", "link": "https://stackoverflow.com/users/2088029/mrd-at-kookerellaltd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 55630813, "answer_count": 1, "score": 0, "last_activity_date": 1554980097, "creation_date": 1554979257, "question_id": 55630542, "link": "https://stackoverflow.com/questions/55630542/haskell-type-class-confusion-inferred-types-cannot-be-deduced", "title": "Haskell type class confusion, inferred types cannot be deduced", "body": "<p>Apologies, I dabble in Haskell in a minor way, once ever 2 years, and then I can't get my head around it.</p>\n\n<p>Its best to just do the example.</p>\n\n<pre><code>&gt; {-# LANGUAGE MultiParamTypeClasses #-}\n&gt; {-# LANGUAGE ScopedTypeVariables #-}\n&gt; {-# LANGUAGE AllowAmbiguousTypes #-}\n&gt; {-# LANGUAGE FlexibleInstances #-}\n&gt; {-# LANGUAGE FlexibleContexts #-}\n\n\n&gt; class Foo a b where\n&gt;     foo :: a -&gt; b\n&gt;     \n&gt; class Bar a b where\n&gt;     bar :: a -&gt; b\n\n&gt; data A a = A a\n&gt; data B b = B b\n\n&gt; instance Foo (A a) a where\n&gt;   foo (A a) = a\n\n&gt; instance Bar (B b) b where\n&gt;   bar (B b) = b\n</code></pre>\n\n<p>so, what I THINK I'm doing is create to data types and then defining two functions based on the the membership of the datatype in the class....</p>\n\n<p>so this works....</p>\n\n<pre><code>&gt; f1 x = foo x\n&gt; f2 x = bar x\n\n&gt; x1 :: String\n&gt; x1 = f1 $ A \"1\"\n&gt; x2 :: String\n&gt; x2 = f2 $ B \"1\"\n</code></pre>\n\n<p>simple...</p>\n\n<p>worry #1...if I remove the type declaration of x1 and x2, ghc complains</p>\n\n<pre><code>\u2022 Ambiguous type variable \u2018b1\u2019 arising from a use of \u2018f1\u2019\n      prevents the constraint \u2018(Foo (A [Char]) b1)\u2019 from being solved.\n      Relevant bindings include x1 :: b1 (bound at catdog.lhs:27:3)\n      Probable fix: use a type annotation to specify what \u2018b1\u2019 should be.\n      These potential instance exist:\n        instance Foo (A a) a -- Defined at catdog.lhs:17:12\n    \u2022 In the expression: f1 $ A \"1\"\n      In an equation for \u2018x1\u2019: x1 = f1 $ A \"1\"\n   |\n27 | &gt; x1 = f1 $ A \"1\"    |        ^^^^^^^^^^\n</code></pre>\n\n<p>which is a worry, isnt it obvious?...and this sort of thing will happen again.....</p>\n\n<p>if I write</p>\n\n<pre><code>&gt; f x = bar (foo x)\n</code></pre>\n\n<p>to me a perfectly reasonable thing...ghc agrees!</p>\n\n<p>I ask it for the type...I get</p>\n\n<pre><code>f :: (Bar a1 b, Foo a2 a1) =&gt; a2 -&gt; b\n</code></pre>\n\n<p>I can buy that.</p>\n\n<p>like a good programmer I paste the type in </p>\n\n<pre><code>&gt; f :: (Bar a1 b, Foo a2 a1) =&gt; a2 -&gt; b\n&gt; f x = bar (foo x)\n</code></pre>\n\n<p>and \"BOOM\"...</p>\n\n<pre><code>\u2022 Could not deduce (Foo a2 a0) arising from a use of \u2018foo\u2019\n      from the context: (Bar a1 b, Foo a2 a1)\n        bound by the type signature for:\n                   f :: forall a1 b a2. (Bar a1 b, Foo a2 a1) =&gt; a2 -&gt; b\n        at catdog.lhs:32:3-39\n      The type variable \u2018a0\u2019 is ambiguous\n      Relevant bindings include\n        x :: a2 (bound at catdog.lhs:33:5)\n        f :: a2 -&gt; b (bound at catdog.lhs:33:3)\n      These potential instance exist:\n        instance Foo (A a) a -- Defined at catdog.lhs:17:12\n    \u2022 In the first argument of \u2018bar\u2019, namely \u2018(foo x)\u2019\n      In the expression: bar (foo x)\n      In an equation for \u2018f\u2019: f x = bar (foo x)\n   |\n33 | &gt; f x = bar (foo x)    |              ^^^^^\n</code></pre>\n\n<p>so ghc is telling me the type it inferred without a type declaration, its now not sure about!</p>\n\n<p>now...there is usually one cog in my head that gets turned backwards by using scala or f# or some other OO style type system, that I have to turn the other way around....am I going mad?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1554967109, "post_id": 55626462, "comment_id": 97945409, "body": "There is a lot of context missing here. (What does the <code>parse</code> function do? What is <code>globals</code>? And many others. I had a brief glance at the source but don&#39;t have time to trace all these things.) But one thing that is apparent is that it is <code>ast</code> which represents the stateful computation (wrapped in a <code>newtype</code> wrapper, which <code>runState</code> unwraps). And that <code>parse</code> returns an <code>Either</code> value in which such a stateful computation represents a success. So the first step in understanding the what the stateful computation is would be to understand <code>parse</code>."}], "answers": [{"comments": [{"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "edited": false, "score": 0, "creation_date": 1555266532, "post_id": 55661596, "comment_id": 98042080, "body": "Very detailed explanation. There may be a typo: <code>ast :: State Env (Contract (Check Type, SourcePos))</code>"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "edited": false, "score": 0, "creation_date": 1555306400, "post_id": 55661596, "comment_id": 98049914, "body": "Actually, I think the extra <code>Env</code> is correct, though I don&#39;t understand the details of how that returned <code>Env</code> differs from the <code>Env</code> passed through the state."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1555124458, "creation_date": 1555124458, "answer_id": 55661596, "question_id": 55626462, "link": "https://stackoverflow.com/questions/55626462/how-to-understand-evalstate-in-this-state-monad-haskell-code-snippet/55661596#55661596", "title": "How to understand evalState in this State Monad Haskell code snippet?", "body": "<p>The function <code>evalState</code> has type:</p>\n\n<pre><code>evalState :: State s a -&gt; s -&gt; a\n</code></pre>\n\n<p>The type of the first argument, namely <code>State s a</code>, is actually isomorphic to the function type <code>s -&gt; (a, s)</code>.  What this means formally is that there exist two functions that convert between them:</p>\n\n<pre><code>runState :: State s a -&gt; (s -&gt; (a, s))\nstate :: (s -&gt; (a, s)) -&gt; State s a\n</code></pre>\n\n<p>and if you apply one of these functions and then the other, you get back what you started with (i.e., they are inverses, and their composition is the identity function).</p>\n\n<p>Less formally, it means that wherever you see <code>State s a</code> you can pretend it's the type <code>s -&gt; (a, s)</code> and vice versa, since you can convert back and forth at will using these utility functions <code>runState</code> and <code>state</code>.</p>\n\n<p><strong>Therefore,</strong> all <code>evalState</code> does is take a first argument that's isomorphic to a stateful computation <code>s -&gt; (a, s)</code> and runs it using an initial state given by its second argument.  It then throws away the final state <code>s</code> and yields the final result of the computation.</p>\n\n<p>Since it's the <em>first</em> argument to <code>evalState</code> that's the stateful computation, it's actually the <code>ast</code> returned when <code>parse parser source code</code> succeeds that's the stateful transformation <code>s -&gt; (a, s)</code> you're looking for.</p>\n\n<p>That is, the value <code>ast</code> has type:</p>\n\n<pre><code>ast :: State Env (Contract (Check Type, Env, SourcePos))\n</code></pre>\n\n<p>which is isomorphic to:</p>\n\n<pre><code>ast :: Env -&gt; (Contract (Check Type, Env, SourcePos), Env)\n</code></pre>\n\n<p>so it's a stateful transformation that operates on a state consisting of an environment (list of symbol tables) and yields a contract.  All <code>evalState</code> does is pass this stateful transformation an initial state/environment consisting of a singleton representing the global symbol table and then yields its final contract result (throwing away the final list of symbol tables, since it's no longer important once the contract is generated).</p>\n\n<p>So, the way this compiler is designed, it compiles code into an \"abstract syntax tree\" that, instead of being a tree-like data structure, is actually a function giving a stateful transformation over an environment state that produces a contract; <code>evalState</code> just \"runs\" the transformation to generate the contract.</p>\n"}], "owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 55661596, "answer_count": 1, "score": -1, "last_activity_date": 1555124458, "creation_date": 1554966037, "last_edit_date": 1554967928, "question_id": 55626462, "link": "https://stackoverflow.com/questions/55626462/how-to-understand-evalstate-in-this-state-monad-haskell-code-snippet", "title": "How to understand evalState in this State Monad Haskell code snippet?", "body": "<p>I am looking at <a href=\"https://github.com/sriharikapu/Spedn/blob/304fe50c9b8a2e8f2c51f0434f15b076fb2b40ec/spedn/library/Compiler.hs\" rel=\"nofollow noreferrer\">this compiler code snippet</a> and do not understand what <code>evalState</code> does, being new to State Monad. </p>\n\n<pre><code>compileToAst :: FilePath -&gt; String -&gt; Either Errors (Contract (Check Type, Env, SourcePos))\ncompileToAst source code = case parse parser source code of\n    Right ast -&gt; let ast'            = evalState ast [globals]\n                     errors          = lefts $ map ann $ toList ast'\n                     ann (a, _, pos) = a `extend` sourcePosPretty pos\n                 in if null errors then Right ast' else Left errors\n    Left err  -&gt; Left [(SyntaxError $ parseErrorTextPretty err, sourcePosPretty . NE.head $ errorPos err)]\n</code></pre>\n\n<p>Assuming stateful computation is in the form of <code>s -&gt; (a, s)</code>, \n<code>ast</code> is a monad, <code>[globals]</code> is <code>s</code>, and <code>evalState ast [globals]</code> returns type <code>a</code>. Where can I find the stateful computation definition transforming <code>s</code> to new <code>s</code> and yielding result <code>a</code>?</p>\n"}, {"tags": ["haskell", "haskell-stack", "intero"], "answers": [{"comments": [{"owner": {"reputation": 716, "user_id": 3507206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848870b4043d5ca319aa3111cb55845b?s=128&d=identicon&r=PG", "display_name": "tejasbubane", "link": "https://stackoverflow.com/users/3507206/tejasbubane"}, "edited": false, "score": 1, "creation_date": 1555058828, "post_id": 55645337, "comment_id": 97984548, "body": "Setting these options in <code>~&#47;.stack&#47;config.yaml</code> worked. Thanks!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1555048701, "creation_date": 1555048701, "answer_id": 55645337, "question_id": 55625381, "link": "https://stackoverflow.com/questions/55625381/intero-always-installs-isolated-ghc/55645337#55645337", "title": "Intero always installs isolated GHC", "body": "<p>The emacs mode is probably trying to install the <code>intero</code> binary outside the context of your project, to ensure that the <code>intero</code> binary isn't affected by the project's library choices. I'm guessing that setting <code>system-ghc: true</code> in your user config file (<code>~/.stack/config.yaml</code>) instead will solve this problem.</p>\n\n<p>You may also want to set <code>install-ghc: false</code> to disable automatic GHC installation.</p>\n"}], "owner": {"reputation": 716, "user_id": 3507206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848870b4043d5ca319aa3111cb55845b?s=128&d=identicon&r=PG", "display_name": "tejasbubane", "link": "https://stackoverflow.com/users/3507206/tejasbubane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 55645337, "answer_count": 1, "score": 3, "last_activity_date": 1555048701, "creation_date": 1554960939, "last_edit_date": 1554978851, "question_id": 55625381, "link": "https://stackoverflow.com/questions/55625381/intero-always-installs-isolated-ghc", "title": "Intero always installs isolated GHC", "body": "<p>I opened a Haskell file on a fresh installation of Emacs &amp; Intero. While booting up, intero is trying to install an isolated GHC. This even though my project has <code>stack.yaml</code> which has <code>system-ghc: true</code>. Running <code>stack install</code> in this directory does <code>not</code> reinstall GHC.</p>\n\n<p>Is there any way to make Intero use system ghc instead of reinstalling?</p>\n"}]